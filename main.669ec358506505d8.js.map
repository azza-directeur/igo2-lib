{"version":3,"file":"main.669ec358506505d8.js","mappings":"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,UAAU/C,eAAeC,EAAI,IAGvD3F,UAAW+F,IACV,MAAMsD,EAAkBD,EAAS1H,IAAI8G,GAC/B7C,EAAO0D,EAAgBR,cAC7BQ,EAAgBZ,UAAU08P,eAAex/P,EAAMI,GAC/CtL,GAAO,EACR,EAET,SCzKIgpD,GAAYC,eACd0hN,SAGFC,QACGC,gBAAgBd,IAChBlyM,MAAO/4C,GAAQvV,QAAQU,IAAI6U,uBCd9B,IAAAloB,GAAA,CACA,aACA,gBACA,YACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,mBACA,gBACA,WACA,cACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,aACA,gBACA,YACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,eACA,YACA,eACA,YACA,eACA,YACA,eACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,YACA,gBACA,mBACA,gBACA,mBACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,sBACA,kBACA,qBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,gBACA,mBACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,gBACA,mBACA,eACA,aACA,gBACA,iBACA,oBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,cACA,iBACA,aACA,gBACA,cACA,iBACA,cACA,mBACA,sBACA,iBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,mBACA,sBACA,aACA,gBACA,gBACA,mBACA,eACA,kBACA,gBACA,mBACA,gBACA,oBAIA,SAAAk0Q,EAAAhkQ,GACA,IAAAxJ,EAAAytQ,GAAAjkQ,GACA,OAAAkkQ,EAAA1tQ,EACA,CACA,SAAAytQ,GAAAjkQ,GACA,IAAAkkQ,EAAAlwQ,EAAAlE,GAAAkQ,GAAA,CACA,IAAA2d,EAAA,IAAA7f,MAAA,uBAAAkC,EAAA,KACA,MAAA2d,EAAA2kC,KAAA,mBACA3kC,CACA,CACA,OAAA7tB,GAAAkQ,EACA,CACAgkQ,EAAA3sQ,KAAA,WACA,OAAAE,OAAAF,KAAAvH,GACA,EACAk0Q,EAAA9qQ,QAAA+qQ,GACAE,GAAAC,QAAAJ,EACAA,EAAAxtQ,GAAA","names":["Base64","static","getByte","s","i","charCodeAt","getByte64","this","ALPHA","indexOf","charAt","decode","b10","pads","imax","length","x","String","PADCHAR","push","fromCharCode","join","encode","customCacheHasher","parameters","map","param","HttpParams","toString","undefined","JSON","parse","stringify","userAgent","Bowser","window","navigator","Clipboard","copy","element","successful","textArea","createTextArea","selectText","copyTextToClipboard","destroyTextArea","text","document","createElement","value","body","appendChild","removeChild","getOSName","oldContentEditable","contentEditable","oldReadOnly","readOnly","range","createRange","selection","getSelection","contenteditable","readonly","selectNodeContents","removeAllRanges","addRange","setSelectionRange","select","compareVersion","execCommand","StringUtils","diff","s1","s2","p","changeData","getChanges","nextS","slice","mtc","ins","sbs","nextThis","del","result","getMatchingSubstring","l","m","match","slen","o","fis","isThisLonger","longer","shorter","bi","split","len","cd","fil","sub","rc","rotateArray","array","n","res","Array","isValidNumber","isNaN","Number","isOctalNumber","startsWith","ChangeType","ADDED","DELETED","MODIFIED","ChangeUtils","findChanges","obj1","obj2","ignoreKeys","items","added","deleted","modified","obj1Clone","obj2Clone","fromItem","index","findIndex","id","change","type","toItem","splice","fromItemClone","toItemClone","keysChanged","compareObject","oldValue","newValue","itemAdded","baseKey","keys","Set","Object","forEach","key","keyString","isArray","concat","DomUtils","create","doc","tagName","options","el","remove","node","parentNode","downloadContent","content","mimeType","fileName","downloadFromUri","uri","setAttribute","style","display","click","encodeURIComponent","ObjectUtils","resolve","obj","keysArray","replace","current","shift","isObject","item","Date","mergeDeep","target","source","ignoreUndefined","output","assign","filter","copyDeep","src","prop","hasOwnProperty","removeDuplicateCaseInsensitive","summaryCapitalizeObject","capitalizeObject","upperCaseCount","property","upperCaseProperty","toUpperCase","count","capitalizedProperty","capitalizedPropertyObject","singlePossibility","paramClosestToLowercase","f","toLowerCase","reduce","prev","y","removeUndefined","removeNull","naturalCompare","a","b","direction","nullsFirst","nullScore","ax","bx","_","$1","$2","Infinity","an","bn","nn","localeCompare","objectsAreEquivalent","obj1Props","getOwnPropertyNames","obj2Props","removeKeys","_obj","isEmpty","NumberUtils","roundToNDecimal","num","decimal","roundFactor","Math","pow","round","strEnum","S4","random","substring","uuid","SubjectStatus","Error","Done","Working","Waiting","Watcher","status$","Subject","status$$","status","_status","next","subscribe","callback","scope","watch","pipe","distinctUntilChanged","handleStatusChange","call","unsubscribe","unwatch","ActivityService","counter$","BehaviorSubject","ids","constructor","register","unregister","factory","ɵfac","providedIn","ActivityInterceptor","activityService","intercept","req","activity","headers","get","actReq","clone","delete","handle","finalize","i0","i1","IgoActivityModule","forRoot","ngModule","providers","provide","HTTP_INTERCEPTORS","useClass","multi","version","lib","releaseDate","CONFIG_DEPRECATED","showMenuButton","alternativeKey","mayBeRemoveIn","menuButtonReverseColor","ALTERNATE_CONFIG_FROM_DEPRECATION","Map","entries","deprecatedKey","ConfigService","config","httpClient","configDeprecated","handler","HttpClient","getConfig","handleDeprecatedConfig","handleDeprecationPossibility","message","console","error","warn","load","baseConfig","default","path","Promise","_reject","catchError","log","throwError","configResponse","CONFIG_OPTIONS","InjectionToken","provideConfigOptions","useValue","configFactory","configService","IgoConfigModule","APP_INITIALIZER","useFactory","deps","LanguageLoader","prefix","suffix","getTranslation","lang","igoLocale$","appLocale$","forkJoin","translations","acc","defaultLanguageLoader","http","provideDefaultLanguageLoader","loader","TranslateLoader","HttpBackend","IgoMissingTranslationHandler","params","translateService","langs","substr","IgoLanguageModule","TranslateModule","missingTranslationHandler","MissingTranslationHandler","IgoMessageModule","CommonModule","ToastrModule","positionClass","timeOut","extendedTimeOut","titleClass","messageClass","closeButton","progressBar","enableHtml","tapToDismiss","maxOpened","preventDuplicates","resetTimeoutOnDuplicate","countDuplicates","includeTitleDuplicates","MessageType","ERROR","ALERT","WARNING","INFO","SUCCESS","SHOW","LanguageService","translate","language","language$","getBrowserLang","getLanguage","setDefaultLang","setLanguage","combineLatest","use","reloadLang","MessageService","injector","languageService","messages$","activeMessageTranslations","debounceTime","r","toastr","toasts","toast","activeMessageTranslation","find","amt","toastId","translatedTextInterpolateParams","textInterpolateParams","translatedTitleInterpolateParams","titleInterpolateParams","k","instant","textKey","titleKey","first","toastRef","componentInstance","title","ToastrService","showError","httpError","caught","messageType","toastrConfig","iconClasses","currentDate","from","to","showIcon","handleTemplate","messageShown","success","info","show","alert","handleNgxToastr","translatedTitlenterpolateParams","translatedTitle","activeToast","warning","removeAllAreNotError","mess","template","html","Injector","i2","ErrorInterceptor","originalReq","interceptError","errorContainer","handleError","handleCaughtError","handleUncaughtError","HttpErrorResponse","errorObj","statusText","url","toDisplay","messageService","IgoErrorModule","parentModule","dbConfig","name","objectStoresMeta","store","storeConfig","keyPath","autoIncrement","storeSchema","keypath","unique","IgoCoreModule","matIconRegistry","domSanitizer","addSvgIconSet","bypassSecurityTrustResourceUrl","HttpClientModule","NgxIndexedDBModule","ROUTE_SERVICE_OPTIONS","RouteService","router","route","centerKey","zoomKey","projectionKey","contextKey","searchKey","visibleOnLayersKey","visibleOffLayersKey","directionsCoordKey","directionsOptionsKey","toolKey","wmsUrlKey","wmsLayersKey","wmtsUrlKey","wmtsLayersKey","arcgisUrlKey","arcgisLayersKey","iarcgisUrlKey","iarcgisLayersKey","tarcgisUrlKey","tarcgisLayersKey","vectorKey","queryParams","decodeURIComponent","location","search","includes","pair","navigate","Media","Mobile","Tablet","Desktop","MediaOrientation","Portrait","Landscape","MediaService","media$","orientation$","breakpointObserver","observe","Breakpoints","HandsetLandscape","matches","HandsetPortrait","TabletLandscape","TabletPortrait","WebLandscape","WebPortrait","getMedia","getOrientation","isTouchScreen","documentElement","isMobile","isDesktop","StorageScope","SESSION","LOCAL","StorageServiceEventEnum","REMOVED","CLEARED","BaseStorage","storageChange$","sessionStorage","getItem","localStorage","set","previousValue","setItem","currentValue","event","removeItem","clear","StorageService","super","getNumber","v","endposition","CompressionService","base64Index","indexBase64","generateBase64Index","compressBlob","blob","Observable","observer","reader","FileReader","readAsDataURL","onload","base64","valueOf","text64","compressed","compressStringBase64","object","decompressBlob","compressedData","decompressed","decompressStringBase64","byteCharacters","atob","byteNumbers","byteArray","Uint8Array","Blob","out","bits","chr","rem","c","j","NetworkService","stateChangeEventEmitter","EventEmitter","onlineSubscription","offlineSubscription","previousMessageId","state","connection","onLine","checkNetworkState","fromEvent","messageObj","emitEvent","emit","ngOnDestroy","currentState","reportState","startWith","RegexService","getAll","IgoActionbarModule","MatButtonModule","MatIconModule","MatTooltipModule","MatMenuModule","MatListModule","MatCardModule","MatCheckboxModule","IgoActionModule","IgoMatBadgeIconModule","MatBadgeModule","IgoCollapsibleModule","ConfirmDialogComponent","dialogRef","confirmMessage","selectors","decls","vars","consts","rf","ctx","close","ConfirmDialogService","dialog","open","disableClose","afterClosed","IgoConfirmDialogModule","imports","MatDialogModule","IgoContextMenuModule","IgoCustomHtmlModule","MatInputModule","DOMService","getDom","dom","_this","_asyncToGenerator","response","err","toPromise","IgoDOMModule","IgoDrapDropModule","IgoDynamicOutletModule","DynamicComponent","componentFactory","componentRef","subscriptions","inputs","inputs$$","subscribers","setTarget","createComponent","updateInputs","updateSubscribers","destroy","unobserveAllInputs","unsubscribeAll","instance","propName","unobserveInput","inputValue","observeInput","setInputValue","onUpdateInputs","prototype","getPrototypeOf","descriptor","getOwnPropertyDescriptor","outputs","emitter","subscriber","_subscriber","observable","values","DynamicComponentService","resolver","componentCls","resolveComponentFactory","IgoDynamicComponentModule","IgoFlexibleModule","IgoFormFormModule","FormsModule","ReactiveFormsModule","IgoFormFieldModule","MatFormFieldModule","MatSelectModule","IgoFormGroupModule","FormService","formBuilder","form","fields","groups","control","group","field","addControl","validator","validators","getValidators","setValidators","disabled","extendFieldConfig","partial","validatorOption","validatorStr","getValidator","Validators","FormFieldService","component","getFieldByType","IgoFormModule","IgoEntitySelectorModule","IgoStopPropagationModule","IgoEntityTablePaginatorModule","MatPaginatorModule","IgoImageModule","IgoEntityTableModule","MatTableModule","MatAutocompleteModule","MatSortModule","MatDatepickerModule","IgoEntityModule","InteractiveTourLoader","jsonURL","allToursOptions","getPathToConfigFile","loadConfigTour","getJSON","data","e","getTourOptionData","toolName","nameInConfigFile","InteractiveTourService","mediaService","interactiveTourLoader","shepherdService","previousStep","nextIndex","isAppHaveTour","haveTour","isToolHaveTourConfig","disabledTourButton","stepConfig","conditions","condition","querySelector","isTourDisplayInMobile","getButtons","buttonKind","classes","getAction","actionName","addProgress","self","nbTry","checkExist","setInterval","getCurrentStep","attachTo","cancel","clearInterval","currentStepElement","getElement","querySelectorAll","classList","add","header","stepsArray","steps","progress","className","innerText","insertBefore","checkNext","tour","service","complete","nextStep","_setupModal","executeAction","step","actionConfig","action","executeActionPromise","waitFor","maxTry","maxWait","getShepherdSteps","shepherdSteps","on","position","floatingUIOptions","middleware","offset","mainAxis","beforeShowPromise","all","beforeChange","beforeShow","buttons","noBackButton","class","highlightClass","scrollTo","scrollToElement","canClickTarget","disableInteraction","when","onShow","hide","onHide","startTour","defaultStepOptions","cancelIcon","enabled","modal","confirmCancel","addSteps","tourObject","start","i3","IgoInteractiveTourModule","IgoKeyValueModule","IgoClickoutModule","IgoListModule","IgoPanelModule","IgoSpinnerModule","MatProgressSpinnerModule","IgoTableModule","CdkTableModule","EntityTableColumnRenderer","Default","HTML","UnsanitizedHTML","Editable","Icon","ButtonGroup","EntityTableScrollBehavior","Auto","Instant","Smooth","EntityTableSelectionState","None","All","Some","getEntityProperty","entity","t","safeObject","getEntityId","meta","idProperty","getEntityTitle","titleProperty","getEntityIcon","icon","iconProperty","EntityStateManager","change$","ReplaySubject","getKey","size","setMany","entities","setAll","update","changes","exclusive","updateMany","updateManyExclusive","reverse","reverseMany","reversedChanges","reverseChanges","updateAll","allKeys","getAllKeys","some","changeKey","bunch","storeKeys","EntityView","source$","values$","values$$","lifted","joins","filter$","filters$","filterIndex","sort$","getKey$","count$","empty$","empty","_index","all$","firstBy","clause","firstBy$","manyBy","manyBy$","sort","createIndex","addFilter","removeFilter","lift","observables$","liftJoinedSource","liftSource","skip","_values","filters","processValues","setValues","sources$","joinData","computeJoinedValue","joinIndex","filterValues","sortValues","clauses","every","v1","v2","valueAccessor","generateIndex","EntityStore","entities$","view","stateView","getProperty","pristine","_pristine","createStateManager","createDataView","createStateView","softClear","updateCount","insert","insertMany","deleteMany","currentRecord","statesAreTheSame","revision","ref","record","newState","currentStateIsEmpty","newStateIsEmpty","EntityStoreWithStrategy","strategies","addStrategy","strategy","activate","_strategy","bindStore","removeStrategy","unbindStore","getStrategyOfType","activateStrategyOfType","deactivateStrategyOfType","deactivate","EntityStoreWatcher","cdRef","innerStateIndex","entities$$","state$$","setChangeDetector","setStore","teardownObservers","setupObservers","detectChanges","onEntitiesChange","onStateChange","changesDetected","storeIndex","innerIndex","storeValue","innerValue","EntityStoreStrategy","stores","active","active$","doDeactivate","doActivate","EntityStoreFilterCustomFuncStrategy","filterStore","unfilterStore","filterAll","unfilterAll","filterClauseFunc","filterId","EntityStoreFilterSelectionStrategy","has","selected","ctx_r0","emptyValue","emptyText","ctx_r1","multiSelectValue","multiText$","record_r3","ctx_r2","titleAccessor","EntitySelectorComponent","selected$","selected$$","watcher","multiAllText","multiNoneText","placeholder","selectedChange","ngOnInit","records","onSelectFromStore","onSelectionChange","multiSelect","_value","updateMultiToggleWithEntities","$event","EntitySelectorComponent_mat_option_3_Template","EntitySelectorComponent_mat_option_4_Template","EntitySelectorComponent_ng_template_5_Template","StopPropagationDirective","onClick","stopPropagation","hostBindings","EntityTablePaginatorComponent","hidePageSize","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons","count$$","entitySortChange$$","paginationLabelTranslation$$","entitySortChange$","paginatorOptions","page","paginatorChange","paginator","ngOnChanges","emitPaginator","firstPage","initPaginatorOptions","translateLabels","label","_intl","firstPageLabel","getRangeLabel","rangeLabel","itemsPerPageLabel","lastPageLabel","nextPageLabel","previousPageLabel","of","startIndex","max","min","viewQuery","MatPaginator","ImageErrorDirective","errorImageUrl","hideError","onError","nativeElement","EntityTableRowDirective","renderer","selectOnClick","highlightSelection","_selected","toggleSelected","scroll","scrollBehavior","addCls","selectedCls","highlightedCls","removeCls","scrollIntoView","scrollMode","behavior","block","inline","cls","addClass","removeClass","SanitizeHtmlPipe","_sanitizer","transform","bypassSecurityTrustHtml","pure","SecureImagePipe","HttpHeaders","activityInterceptor","regexDepot","RegExp","test","responseType","switchMap","onloadend","_r10","ctx_r9","onToggleRows","checked","selectionState_r8","ctx_r7","entityTableSelectionState","EntityTableComponent_th_3_ng_container_1_ng_container_1_Template","ctx_r6","selectionState$","EntityTableComponent_th_3_ng_container_1_Template","selectMany","shiftKey","preventDefault","record_r11","_r14","$implicit","ctx_r13","onShiftToggleRow","rowIsSelected","ctx_r15","onToggleRow","column_r16","tooltip","EntityTableComponent_ng_container_5_ng_container_1_th_1_Template","EntityTableComponent_ng_container_5_ng_container_2_th_1_Template","ctx_r32","getCellClass","record_r31","getValue","ctx_r37","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_ng_template_2_img_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_ng_template_2_ng_template_3_Template","ctx_r34","isImg","_r38","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_td_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_ng_template_2_Template","ctx_r30","isUrl","_r33","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_ng_container_1_Template","ctx_r48","record_r47","ctx_r53","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_ng_template_2_img_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_ng_template_2_ng_template_3_Template","ctx_r50","_r54","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_td_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_ng_template_2_Template","ctx_r46","_r49","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_ng_container_1_Template","_r79","record_r63","ctx_r77","onDateChange","_r76","ctx_r67","_r85","onFocus","onChange","onBlur","_r93","ctx_r91","onValueChange","ctx_r69","getValidationAttributeValue","_r99","ctx_r97","ctx_r70","_r105","ctx_r103","onBooleanValueChange","ctx_r71","option_r110","_r113","ctx_r111","onSelectValueChange","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_select_6_mat_option_1_Template","ctx_r72","multiple","domainValues","ctx_r73","_r74","option_r119","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_div_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_3_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_4_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_checkbox_5_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_select_6_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_input_7_Template","_r122","ctx_r120","onAutocompleteValueChange","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_mat_option_10_Template","ctx_r64","formGroup","filteredOptions","ctx_r126","ctx_r131","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_ng_template_1_img_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_ng_template_1_ng_template_3_Template","ctx_r128","_r132","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_td_0_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_ng_template_1_Template","ctx_r66","_r127","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_td_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_ng_template_2_Template","ctx_r62","isEdition","_r65","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_ng_container_1_Template","_r147","ctx_r143","record_r142","ctx_r144","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_td_1_mat_icon_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_td_1_mat_icon_2_Template","ctx_r141","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_td_1_Template","_r162","button_r156","record_r154","ctx_r160","onButtonClick","color","_r167","ctx_r165","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_ng_container_1_button_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_ng_container_1_button_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_ng_container_1_Template","ctx_r155","editMode","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_span_2_Template","ctx_r153","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_ng_container_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_1_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_2_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_3_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_4_Template","EntityTableComponent_ng_container_5_ng_container_3_ng_container_5_Template","columnRenderer_r24","ctx_r19","entityTableColumnRenderer","EntityTableComponent_ng_container_5_ng_container_1_Template","EntityTableComponent_ng_container_5_ng_container_2_Template","EntityTableComponent_ng_container_5_ng_container_3_Template","columnIsSortable","getColumnRenderer","ctx_r3","getHeaderClass","record_r173","_r175","ctx_r174","onRowSelect","ctx_r176","onRowClick","ctx_r4","getRowClass","_r178","ctx_r177","ctx_r5","__decorate","Cacheable","maxCacheCount","tslib_es6","w6","Function","EntityTableComponent","_focusMonitor","_elementRef","ngControl","_parentForm","_controlName","_defaultErrorStateMatcher","dateAdapter","UntypedFormGroup","selection$$","dataSource$$","lastRecordCheckedKey","_paginator","dataSource","sortNullsFirst","withPaginator","entityClick","entitySelectChange","entitySortChange","columns","column","visible","selectionCheckbox","MatTableDataSource","fixedHeader","tableHeight","setLocale","handleDatasource","getColumnKeyWithoutPropertiesTag","properties","controls","setValue","option","viewValue","moment","format","enableEdit","validation","mandatory","setControl","parseInt","valueChanges","filterNormalized","normalize","formControlValue","linkColumnForce","date","utc","newKey","disable","unsubscribeStore","firstSelected","firstSelectedStateviewPosition","pageMax","pageToReach","floor","computeSelectionState","getTrackByFunction","refresh","onSort","toggle","selectNode","stopImmediatePropagation","recordIndex","lastRecordChecked","indexes","_record","selectedRecords","selectionCount","sortable","pop","list_id","list_option","edition","validationType","getTableClass","func","headerClassFunc","rowClassFunc","tableFunc","cellClassFunc","columnFunc","clickFunc","features","MatFormFieldControl","useExisting","EntityTableComponent_th_3_Template","EntityTableComponent_td_4_Template","EntityTableComponent_ng_container_5_Template","EntityTableComponent_tr_6_Template","EntityTableComponent_tr_7_Template","EntityTableComponent_igo_entity_table_paginator_8_Template","_c0","Toolbox","activeTool$","toolbar$","activeTool$$","activeToolHistory","tool","tools$","setToolbar","toolbar","initStore","getTool","getTools","setTools","tools","getToolbar","activateTool","activatePreviousTool","deactivateTool","previous","clearActiveToolHistory","setActiveTool","ToolService","toolbox","IgoToolboxModule","IgoToolModule","IgoWidgetOutletModule","WidgetService","dynamicComponentService","widgetCls","IgoWidgetModule","IgoWorkspaceSelectorModule","IgoWorkspaceWidgetOutletModule","IgoWorkspaceModule","ColorPickerFormFieldModule","ActionbarMode","Dock","Overlay","Context","ActionStore","icon$","ActionbarItemComponent_mat_list_item_0_button_4_mat_icon_2_Template","disabled$","withIcon","_r6","ActionbarItemComponent_mat_list_item_0_button_4_Template","ActionbarItemComponent_mat_list_item_0_span_5_Template","withTooltip","tooltip$","ngClass$","withTitle","_r9","ctx_r8","checkCondition$","ActionbarItemComponent_mat_list_item_1_mat_checkbox_4_Template","ActionbarItemComponent","noDisplay$","ngClass$$","disabled$$","availability$$","icon$$","checkCondition$$","tooltip$$","noDisplay$$","display$$","noDisplay","trigger","args","ngClass","updateNgClass","isObservable","updateIcon","checkCondition","updateCheckCondition","updateTooltip","availability","available","ActionbarItemComponent_mat_list_item_0_Template","ActionbarItemComponent_mat_list_item_1_Template","checkbox","_r8","scrollUp","onTriggerAction","toggleCollapseAction","action_r13","_r15","ctx_r14","ctx_r12","ActionbarComponent_mat_list_0_3_ng_template_0_Template","_r17","ctx_r16","scrollDown","ActionbarComponent_mat_list_0_div_1_Template","ActionbarComponent_mat_list_0_igo_actionbar_item_2_Template","ActionbarComponent_mat_list_0_3_Template","ActionbarComponent_mat_list_0_div_4_Template","heightCondition","positionConditionTop","withToggleButton","collapsed","positionConditionLow","action_r20","_r22","ctx_r21","ActionbarComponent_div_1_ng_template_7_Template","_r18","iconColor","overlayClass","xPosition","yPosition","action_r24","_r26","ctx_r25","ctx_r23","ActionbarComponent_mat_card_2_ng_template_2_Template","ActionbarComponent","overlay","elRef","actionbarMode","heightCondition$","positionConditionTop$","positionConditionLow$","mode","horizontal","scrollActive","_overlayClass","isCollapsed","withTitleClass","withIconClass","horizontalClass","clientHeight","scrollHeight","scrollTop","scrollBy","hostVars","ActionbarComponent_mat_list_0_Template","ActionbarComponent_div_1_Template","ActionbarComponent_mat_card_2_Template","LongPressDirective","touchTimeout","touchDuration","onlyIOS","longpress","touchstart","touches","touchEnd","setTimeout","touchend","clearTimeout","DynamicOutletComponent","dynamicComponent","eq","inputsAreEquivalents","subscribersAreEquivalents","renderComponent","ViewContainerRef","DynamicOutletComponent_ng_template_0_Template","IgoFormFieldComponent","compType","formControlIsRequired","required","getControlErrorMessage","messages","errorMessages","errors","getFieldComponent","getFieldInputs","getFieldSubscribers","FormFieldComponent","formFieldService","fieldInputs","fieldSubscribers","fieldOptions","disableSwitch","formControl","FormFieldComponent_ng_container_0_Template","getFieldNgClass","field_r3","FormGroupComponent_div_0_div_1_Template","getErrorMessage","FormGroupComponent","getFieldColSpan","colSpan","cols","ngContentSelectors","FormGroupComponent_div_0_Template","FormGroupComponent_mat_error_3_Template","_r3","onDisableSwitchClick","FormFieldTextComponent","toggleDisabled","enable","FormFieldTextComponent_mat_icon_2_Template","FormFieldTextComponent_mat_error_3_Template","choice_r3","_r5","FormFieldSelectComponent","choices","choices$","FormFieldSelectComponent_mat_option_2_Template","FormFieldSelectComponent_mat_icon_4_Template","FormFieldSelectComponent_mat_error_5_Template","FormFieldTextareaComponent","FormFieldTextareaComponent_mat_icon_3_Template","FormFieldTextareaComponent_mat_error_4_Template","FormComponent","formData","autocomplete","submitForm","hasButtons","children","setData","onSubmit","getData","getAllFormFields","updateDataWithFormField","reset","_c2","FlexibleComponent","main","initial","_initial","_collapsed","expanded","_expanded","initialMobile","_initialMobile","collapsedMobile","_collapsedMobile","expandedMobile","_expandedMobile","_direction","_state","sizes","setSize","transitionTime","mediaService$$","media","height","width","startInteractiveTour","getClass","_r7","discoverTitleInLocale$","InteractiveTourComponent_ng_container_0_button_1_Template","InteractiveTourComponent_ng_container_0_ng_template_2_Template","styleButton","_r2","InteractiveTourComponent","interactiveTourService","toolService","tourToStart","getTourToStart","activeToolName","isActiveTool","isToolHaveTour","showTourButton","inMobileAndShow","InteractiveTourComponent_ng_container_0_Template","SpinnerComponent","shown$","shown","SpinnerActivityDirective","spinner","counter$$","TableDataSource","DataSource","_database","_model","_sort","_filterChange","connect","merge","dataChange","sortChange","getFilteredData","getSortedData","disconnect","filterable","propertyA","propertyB","TableActionColor","primary","accent","_r11","ctx_r10","masterToggle","hasValue","isAllSelected","row_r12","isSelected","TableComponent_ng_container_8_ng_container_1_th_1_Template","TableComponent_ng_container_8_ng_container_2_th_1_Template","ctx_r26","model","row_r27","_c1","TableComponent_ng_container_8_ng_container_3_td_1_Template","ctx_r29","row_r30","TableComponent_ng_container_8_ng_template_4_td_0_Template","TableComponent_ng_container_8_ng_container_1_Template","TableComponent_ng_container_8_ng_container_2_Template","TableComponent_ng_container_8_ng_container_3_Template","TableComponent_ng_container_8_ng_template_4_Template","_r20","action_r34","_r36","row_r32","ctx_r35","handleClickAction","ctx_r33","getActionColor","TableComponent_td_11_button_1_Template","actions","row_r38","_r40","ctx_r39","TableComponent","database","hasFilterInput","_hasFIlterInput","displayedColumns","SelectionModel","displayed","unshift","changed","ngAfterViewInit","colorId","row","MatSort","TableComponent_div_1_Template","TableComponent_th_6_Template","TableComponent_td_7_Template","TableComponent_ng_container_8_Template","TableComponent_th_10_Template","TableComponent_td_11_Template","TableComponent_tr_12_Template","TableComponent_tr_13_Template","TableDatabase","copiedData","ToolComponent","ToolboxColor","White","Grey","Primary","toolSlideInOut","speed","transition","animate","actionStore","toolbarWithTitle$","_r4","onAnimationStart","onAnimationComplete","animation$","tool_r2","getToolInputs","ToolboxComponent","isActive","toolbar$$","animating$","animating$$","classColorGrey","classColorPrimary","onToolbarChange","onActiveToolChange","onAnimate","_tool","_toolbox","activeTool","toolActivated","childrenToolActivated","parent","unAnimate","animation","ToolboxComponent_igo_actionbar_0_Template","ToolboxComponent_div_2_Template","changeDetection","widget","getEffectiveSubscribers","WidgetOutletComponent","baseSubscribers","onCancel","onComplete","destroyWidget","baseSubscriber","WidgetOutletComponent_igo_dynamic_outlet_0_Template","WorkspaceStore","activeWorkspace$","activateWorkspace","workspace","deactivateWorkspace","Workspace","widget$","widgetInputs$","widgetSubscribers$","entityStore","hasWidget","deactivateWidget","activateWidget","WorkspaceSelectorComponent","getWorkspaceTitle","onSelectedChange","widget_r1","ngIf","onWidgetCancel","onWidgetComplete","WorkspaceWidgetOutletComponent","WorkspaceWidgetOutletComponent_ng_container_0_Template","ColorPickerFormFieldComponent","setAlpha","outputFormat","onTouch","hexColor","setFormat","_hexColor","tinycolor","toHexString","writeValue","registerOnChange","fn","registerOnTouched","toRgbString","toHsvString","closePicker","NG_VALUE_ACCESSOR","forwardRef","dep_r2","DocViewerComponent_ng_container_5_li_4_Template","dependencies","DocViewerComponent","subtitle","DocViewerComponent_ng_container_5_Template","AppHomeRoutingModule","RouterModule","forChild","AppHomeComponent","ExampleModule","MatDividerModule","DocViewerModule","SharedModule","MatGridListModule","AppHomeModule","codeUrl","configUrl","SRC_PATH","ExampleViewerComponent","codeFolder","configFolder","ExampleViewerComponent_a_5_Template","ExampleViewerComponent_a_6_Template","AppActivityRoutingModule","AppActivityComponent","idsActivity","counter","AppActivityModule","environment","production","igo","projections","code","alias","def","extent","auth","intern","allowAnonymous","interactiveTour","tourInMobile","importExport","catalog","sources","queryFormat","queryHtmlTarget","regFilters","tooltipType","searchSources","storedqueriesreverse","nominatim","icherche","searchUrl","order","limit","showAdvancedSettings","coordinatesreverse","showInPointerSummary","icherchereverse","ilayer","AppConfigRoutingModule","AppConfigComponent","configLanguage","AppConfigModule","AppLanguageRoutingModule","AppLanguageComponent","app","changeLanguage","AppLanguageModule","AppMediaRoutingModule","AppMediaComponent","orientation","AppMediaModule","AppMessageRoutingModule","AppMessageComponent","AppMessageModule","AppRequestRoutingModule","AppRequestComponent","callHttp","rep","callHttpError","AppRequestModule","AppActionRoutingModule","AppActionComponent","added$","AppActionModule","AppSalutationComponent","AppExplanationComponent","AppDynamicComponentRoutingModule","AppDynamicComponentComponent","toggleComponent","AppDynamicComponentModule","AppEntityTableRoutingModule","AppEntityTableComponent","description","image","AppEntityTableModule","selected_r1","AppEntitySelectorRoutingModule","AppEntitySelectorComponent","getTitle","AppEntitySelectorComponent_div_3_Template","AppEntitySelectorModule","fillForm","clearForm","form_r1","data$","submitDisabled","AppFormRoutingModule","AppFormComponent","formService","form$","valueChanges$$","valid","AppFormComponent_igo_form_2_Template","AppFormModule","AppTableRoutingModule","AppTableComponent","showName","handleSelect","rows","AppTableModule","cursorPointer","PanelComponent","withHeader","_withHeader","PanelComponent_div_0_Template","AppSalutationToolComponent","ChangeDetectorRef","AppAboutToolComponent","AppToolRoutingModule","AppToolComponent","panelTitle","activateSalutationTool","AppToolComponent_button_3_Template","AppToolComponent_button_5_Template","AppToolModule","AppSalutationWidgetComponent","AppWidgetRoutingModule","AppWidgetComponent","widgetService","AppWidgetModule","TokenService","tokenKey","token","jwtDecode","isExpired","jwt","currentTime","getTime","exp","AuthService","tokenService","authenticate$","logged$","redirectUrl","languageForce","anonymous","hasAuthService","authenticated","globalCacheBusterNotifier","login","username","password","myHeader","encodePassword","loginCall","loginWithToken","infosUser","typeConnection","loginAnonymous","post","tap","logout","isAuthenticated","getToken","decodeToken","goToRedirectUrl","loginRoute","navigateByUrl","homeRoute","getUserInfo","getProfils","updateUser","user","patch","logged","isAnonymous","isAdmin","tokenDecoded","locale","i4","AuthGoogleComponent","authService","appRef","apiKey","clientId","loadSDKGoogle","loadPlatform","handleSignInClick","gapi","auth2","getAuthInstance","signIn","handleSignOutClick","signOut","handleClientLoad","initClient","client","init","discoveryDocs","then","updateTextButton","isSignedIn","listen","updateSigninStatus","loginGoogle","access_token","btn","innerHTML","tick","fjs","getElementsByTagName","js","loading","AuthInternComponent","_allowAnonymous","fb","loginUser","errorMsg","AuthInternComponent_button_18_Template","AuthInternComponent_div_19_Template","AuthFacebookComponent","appId","loadSDKFacebook","subscribeEvents","FB","Event","statusChangeCallback","loginFacebook","authResponse","accessToken","getElementById","AuthMicrosoftComponent","msalService","msalGuardConfig","_destroying$","broadcastService","PublicClientApplication","cache","cacheLocation","MsalBroadcastService","inProgress$","InteractionStatus","takeUntil","checkAccount","loginMicrosoft","loginPopup","getConf","authRequest","setActiveAccount","account","acquireTokenSilent","tokenId","idToken","catch","_ref","InteractionRequiredAuthError","acquireTokenPopup","_x","apply","arguments","conf","MSAL_GUARD_CONFIG","MsalServiceb2c","redirectHash","logger","hash","initializeWrapperLibrary","WrapperSKU","Angular","initialize","request","acquireTokenRedirect","silentRequest","handleRedirectObservable","handleRedirectPromise","loginRedirect","logoutRequest","logoutRedirect","logoutPopup","ssoSilent","getLogger","setLogger","MSAL_INSTANCE","MsalBroadcastServiceb2c","msalInstance","_msalSubject","msalSubject$","_inProgress","asObservable","Startup","addEventCallback","EventMessageUtils","getInteractionStatusFromEvent","verbose","eventType","AuthMicrosoftb2cComponent","browserAuthOptions","loginMicrosoftb2c","onLogin","_r13","_r19","ctx_r18","AuthFormComponent_div_0_div_2_igo_auth_google_4_Template","AuthFormComponent_div_0_div_2_igo_auth_microsoft_5_Template","AuthFormComponent_div_0_div_2_igo_auth_microsoftb2c_6_Template","AuthFormComponent_div_0_div_2_igo_auth_facebook_7_Template","AuthFormComponent_div_0_div_2_igo_auth_intern_8_Template","google","microsoft","microsoftb2c","facebook","_r21","ctx_r20","_r24","home","AuthFormComponent_div_0_div_4_button_4_Template","AuthFormComponent_div_0_div_1_Template","AuthFormComponent_div_0_div_2_Template","AuthFormComponent_div_0_div_3_Template","AuthFormComponent_div_0_div_4_Template","backgroundDisable","showLoginDiv","showAlreadyConnectedDiv","showLogoutDiv","AuthFormComponent","isLogoutRoute","_backgroundDisable","hasAlreadyConnectedDiv","_hasAlreadyConnectedDiv","hasLogoutDiv","_hasLogoutDiv","_showAlreadyConnectedDiv","_showLogoutDiv","isLoginRoute","analyzeRoute","getName","logoutRoute","firstName","sourceId","events","NavigationStart","changeEvent","currentRoute","AuthFormComponent_div_0_Template","AuthInterceptor","refreshInProgress","trustHosts","hostsWithCredentials","hostsWithAuthByKey","hostname","withCredentials","handleHostsWithCredentials","hostWithKey","handleHostsAuthByKey","refreshToken","href","host","authReq","hashUser","Md5","hashStr","interceptXhr","xhr","setRequestHeader","alterUrlWithKeyAuth","urlDecomposed","urlWithKeyAdded","paramsToKeep","reqUrl","hostWithCredentials","domainRegFilters","hostWithAuthByKey","keyProperty","keyValue","MSALConfigFactory","msConf","redirectUri","authority","MSALConfigFactoryb2c","MSALAngularConfigFactory","interactionType","InteractionType","Popup","scopes","loginHint","MSALAngularConfigFactoryb2c","provideAuthMicrosoft","MsalService","AuthStorageService","userIgo","preference","mergePreference","IgoAuthModule","MsalModule","AppAuthFormRoutingModule","AppAuthFormComponent","AppAuthFormModule","IgoMetadataModule","generateIdFromSourceOptions","wms","generateWMSIdFromSourceOptions","wmts","generateWMTSIdFromSourceOptions","xyz","generateXYZIdFromSourceOptions","feature","generateFeatureIdFromSourceOptions","wfs","generateWfsIdFromSourceOptions","arcgisrest","generateArcgisRestIdFromSourceOptions","imagearcgisrest","tilearcgisrest","osm","_options","tiledebug","generateId","layers","LAYERS","chain","standardizeUrl","layer","featureTypes","origin","urlStandardized","dataService","ol","legend","createOlSource","getLegend","setLegend","FeatureDataSource","sourceOptions","getSourceFormatFromOptions","olSourceVector","olFormatCls","formatType","olformat","formatOptions","onUnwatch","queryTitle","OSMDataSource","olSourceOSM","XYZDataSource","olSourceXYZ","OgcFilterOperatorType","BasicNumericOperator","Basic","BasicAndSpatial","Spatial","Time","OgcFilterOperator","BBOX","PropertyIsBetween","Contains","During","PropertyIsEqualTo","PropertyIsGreaterThan","PropertyIsGreaterThanOrEqualTo","Intersects","PropertyIsNull","PropertyIsLessThan","PropertyIsLessThanOrEqualTo","PropertyIsLike","PropertyIsNotEqualTo","Within","And","Or","Not","OgcFilterWriter","filterSequence","operators","spatial","fieldRestrict","defineOgcFiltersDefaultOptions","ogcFiltersOptions","fieldNameGeometry","srcType","ogcFiltersDefaultValue","editable","geometryName","advancedOgcFilters","pushButtons","checkboxes","radioButtons","buildFilter","proj","ourBboxFilter","enableBbox","filterAssembly","olfilter","getCode","checkIgoFiltersProperties","bundleFilter","wfsOptions","srsName","featureNS","featurePrefix","query","olFormatWFS","writeGetFeature","XMLSerializer","serializeToString","filterObject","logicalArray","createFilter","operator","logical","filterOptions","wfsPropertyName","propertyName","wfsPattern","pattern","wfsMatchCase","matchCase","wfsWildCard","wildCard","wfsSingleChar","singleChar","wfsEscapeChar","escapeChar","wfsLowerBoundary","lowerBoundary","wfsUpperBoundary","upperBoundary","wfsGeometryName","wfsExtent","wfsWktGeometry","wkt_geometry","wfsSrsName","wfsBegin","parseFilterOptionDate","begin","minDate","wfsEnd","end","maxDate","wfsExpression","expression","geometry","olFormatWKT","readGeometry","dataProjection","featureProjection","defineInterfaceFilterSequence","level","addInterfaceFilter","computeAllowedOperators","defaultOperatorsType","allowedOperators","fieldsHasSpatialOperator","includeContains","effectiveOperators","srcField","allowedOperatorsType","igoOgcFilterObject","parentLogical","filterid","sliderOptions","igoSpatialSelector","igoSNRC","filterArray","addFilterProperties","rebuiltIgoOgcFilterObjectFromSequence","sequence","nextElement","lastProcessedFilter","lastParentLogical","uiFilter","computeIgoSelector","computedSelectors","selector","bundles","bundle","selectorType","selectorGroup","handleOgcFiltersAppliedValue","ogcFilters","filterQueryStringSelector","filterQueryStringAdvancedFilters","pushConditions","formatGroupAndFilter","checkboxConditions","selectorsCorr","verifyMultipleEnableds","radioConditions","selectConditions","filterQueryString","formatProcessedOgcFilter","enableds","list","selectorBundle","g","bundleCondition","selectorsType","ogcselector","enabledSelector","processedFilter","layersOrTypenames","appliedFilter","layerOrTypenames","defaultValue","isValid","defaultEpsg","defaultMaxFeatures","defaultWfsVersion","defaultFieldNameGeometry","gmlRegex","buildUrl","randomParam","paramsWFS","queryStringValues","formatWFSQueryString","igoFilters","ogcFilterWriter","filterOrBox","filterOrPush","xmlFilter","baseUrl","download","dynamicUrl","dataSourceOptions","epsg","forceDefaultOutputFormat","versionWfs200","urlWfs","effectiveCount","effectiveStartIndex","epsgCode","paramMaxFeatures","cnt","maxFeatures","srs","valueReference","sourceFields","fieldsNames","sourcefield","separator","getFeature","getpropertyvalue","checkWfsParams","wfsDataSourceOptions","getFormatFromOptions","OlFormat","gmlFormat","olFormatGML2","olFormatGML32","olFormatGML3","olFormatOSMXML","WFSDataSource","wfsService","authInterceptor","mostRecentIdCallOGCFilter","sf","getSourceFieldsFromWFS","setOgcFilters","resolution","wfsProj","olProjection","currentExtent","olproj","OlLoadingStrategy","triggerEvent","notify","DataService","WFSService","defineFieldAndValuefromWFS","getfeatureSourceField","wfsGetFeature","nb","d","fieldList","fieldListWoGeom","fieldListWoGeomStr","olFormats","effectiveOlFormats","gmlDataSourceOptions","sourceFieldsToRetrieveValues","concatMap","allowGml","firstFeature","readFeatures","getKeys","getGeometryName","processingArray","chunkSize","results","mfeatures","loopFeatures","built_properties_value","kv","getProperties","boundedBy","fieldType","featureProperties","QueryFormat","GML2","GML3","GEOJSON","GEOJSON2","ESRIJSON","TEXT","HTMLGML2","QueryFormatMimeType","QueryHtmlTarget","IFRAME","BLANK","WMSDataSource","mapLabel","timeFilter","timeFilter$","sourceParams","dpi","DPI","MAP_RESOLUTION","FORMAT_OPTIONS","refreshIntervalSec","wfsCheckup","buildDynamicDownloadUrlFromParamsWFS","sourceField","initOgcFilters","calendarModeYear","FILTER","updateParams","timeFilterableDataSourceOptions","timeFilterable","setTimeFilter","igoRefresh","asWFSDataSourceOptions","olSourceImageWMS","ratio","scale","projParam","contentDependent","projection","contentDependentLegend","VERSION","currentStyle","createDefaultTileGrid","projectionExtent","getExtent","extentGetWidth","resolutions","matrixIds","z","olTileGridWMTS","extentGetTopLeft","WMTSDataSource","tileGrid","olSourceWMTS","CartoDataSource","crossOrigin","olSourceCarto","htmlString","layerOptions","types","oneType","cartocss","colors","layer_name","ArcGISRestDataSource","esrijsonFormat","olFormatEsriJSON","attributions","overlaps","time","customParams","bind","olloadingstrategy","legendInfo","svg","legendElement","htmlImgSrc","contentType","imageData","uniqueValueInfos","symbol","createSVG","stroke","strokeWidth","outlineColor","outline","fill","ImageArcGISRestDataSource","renderingRule","ImageArcGISRest","layerId","TileArcGISRestDataSource","olSourceTileArcGISRest","TileDebugDataSource","baseOptions","TileGrid","TileDebug","WebSocketDataSource","ws","createWebSocket","WebSocket","onmessage","onMessage","onclose","onClose","onerror","onopen","onOpen","featureAdded","readFeature","featureToRemove","getFeatureById","getId","removeFeature","addFeature","MVTDataSource","mvtFormat","featureClass","olFormatMVT","olSourceVectorTile","ClusterDataSource","olSourceCluster","stringToLonLat","str","mapProjection","opts","lonLat","coordStr","negativeLon","degreesLon","minutesLon","secondsLon","directionLon","decimalLon","negativeLat","degreesLat","minutesLat","secondsLat","directionLat","decimalLat","zone","radius","lon","lat","projectionStr","projectionRegex","lonlatCoord","lonLatPattern","lonLatRegex","dmsCoord","dmsCoordPattern","dmsRegex","patternUtm","utmRegex","patternMtm","mtmRegex","ddCoord","patternDd","ddRegex","dmdCoord","patternDmd","dmdRegex","patternBELL","bellRegex","mmCoord","mmPattern","mmRegex","isXYCoords","toLocaleUpperCase","trim","parseFloat","convertDMSToDD","epsgUtm","epsgMtm","forceNA","dest","abs","degrees","minutes","seconds","neg","dd","convertDDToDMS","lonLatDD","lonLatDMS","ceil","int","toFixed","formatScale","getResolutionFromScale","inchesPerMeter","ctrlKeyDown","originalEvent","altKey","MAC","metaKey","ctrlKey","roundCoordTo","coord","roundCoordToString","EsriStyleGenerator","_converters","_renderers","esriPMS","_convertEsriPMS","esriSFS","_convertEsriSFS","esriSLS","_convertEsriSLS","esriSMS","_convertEsriSMS","esriTS","_convertEsriTS","uniqueValue","_renderUniqueValue","simple","_renderSimple","classBreaks","_renderClassBreaks","_convertPointToPixel","point","_transformColor","_getResolutionForScale","units","mpu","rotation","_transformAngle","angle","olstyle","font","weight","family","textBaseline","verticalAlignment","textAlign","horizontalAlignment","offsetX","xoffset","offsetY","yoffset","_convertOutline","lineDash","ol3Rad","PI","points","radius2","_convertLabelingInfo","labelingInfo","mapUnits","styles","ii","labelExpression","maxScale","minScale","minResolution","maxResolution","getText","setText","defaultSymbol","defaultStyle","classBreakInfos","classBreakInfo","classMinValue","minValue","classMaxValue","field1","infos","me","generateStyle","layerInfo","drawingInfo","styleFunctions","drawingInfoStyle","labelingInfoStyleFunctions","TimeFilterType","DATE","TIME","DATETIME","YEAR","TimeFilterStyle","CALENDAR","SLIDER","MapService","getMap","setMap","TypeCapabilities","CapabilitiesService","mapService","parsers","WMSCapabilities","WMTSCapabilities","esriJSON","EsriJSON","getWMSOptions","getCapabilities","capabilities","parseWMSOptions","getWMTSOptions","parseWMTSOptions","getCartoOptions","jsonp","mapId","cartoOptions","parseCartoOptions","getArcgisOptions","serviceCapabilities","arcgisOptions","parseArcgisOptions","getImageArcgisOptions","legendUrl","parseTileOrImageArcgisOptions","getTileArcgisOptions","fromObject","_i","read","findDataSourceInCapabilities","Capability","Layer","metadata","DataURL","abstract","Abstract","keywordList","KeywordList","queryable","getTimeFilter","legendOptions","Style","getStyle","isExtentInGeographic","EX_GeographicBoundingBox","queryFormatMimeTypePriority","Request","GetFeatureInfo","Format","keyEnum","_layerOptionsFromSource","Title","MaxScaleDenominator","MinScaleDenominator","OnlineResource","extern","stepDate","Contents","Identifier","optionsFromCapabilities","ouputOptions","layer_definition","olAttribution","copyrightText","timeExtent","timeInfo","setTime","toUTCString","serviceDescription","displayField","layerName","layerArray","Name","dimension","Dimension","minMaxDim","stylesAvailable","ProjectionService","registerProjection","utmZone","mtmZone","lon0","proj4","defs","olproj4","setExtent","OptionsService","DataSourceService","capabilitiesService","optionsService","wfsDataSourceService","projectionService","datasources$","createAsyncDataSource","context","detailedContextUri","createOSMDataSource","createFeatureDataSource","createWFSDataSource","wmsContext","createWMSDataSource","createWMTSDataSource","createXYZDataSource","createTileDebugDataSource","createCartoDataSource","createArcGISRestDataSource","createArcGISRestImageDataSource","createWebSocketDataSource","createMVTDataSource","createTileArcGISRestDataSource","createClusterDataSource","observables","optionsFromApi","optionsMerged","getArcgisRestOptions","i5","i6","geoDBService","layerDBService","legendCollapsed","firstLoadComponent","olLoadingProblem","hasBeenVisible$","hasBeenVisible$$","resolution$$","isIgoInternalLayer","zIndex","getZIndex","setZIndex","baseLayer","opacity","setOpacity","isInResolutionsRange","isInResolutionsRange$","setMaxResolution","updateInResolutionsRange","getMaxResolution","setMinResolution","getMinResolution","setVisible","visible$","showOnEachLayerVisibility","showMessage","displayed$","showInLayerList","createOlLayer","maxScaleDenom","minScaleDenom","unobserveResolution","observeResolution","viewController","resolution$","getResolution","LinkedProperties","OPACITY","VISIBLE","OGCFILTERS","MINRESOLUTION","MAXRESOLUTION","ZINDEX","TIMEFILTER","TooltipType","TITLE","ABSTRACT","CUSTOM","ImageWatcher","loaded","handleLoadStart","handleLoadEnd","handleLoadError","un","__watchers__","watcherIndex","params_","TileWatcher","tile","VectorWatcher","olSource","getUrl","ImageLayer","valStatus","olOptions","olLayerImage","getSource","setImageLoadFunction","customLoader","interceptor","XMLHttpRequest","alteredUrlWithKeyAuth","abort","getImage","arrayBufferView","TextDecoder","imageUrl","URL","createObjectURL","send","TileLayer","tileLayer","olLayerTile","tileSource","setTileLoadFunction","modifiedUrl","FEATURE","FeatureMotion","Move","Zoom","featureToOl","projectionOut","olFeature","OlFormatGeoJSON","setId","mapTitle","getEntityRevision","featureFromOl","projectionIn","olLayer","exclude","excludeOffline","idColumn","olFormat","writeGeometryObject","getGeometry","excludeAttribute","excludeAttributeOffline","getRevision","computeOlFeaturesExtent","olFeatures","olextent","featureExtent","computeOlFeatureExtent","olExtent","olFeatureExtent","olFeatureProjection","olGeometry","scaleExtent","featuresAreOutOfView","featuresExtent","edgeRatio","edgesRatio","viewExtent","featuresAreTooDeepInView","areaRatio","mapExtent","mapExtentArea","featuresExtentArea","getZoom","moveToOlFeatures","motion","getOlProjection","zoomToExtent","moveToExtent","hideOlFeature","setStyle","tryBindStoreLayer","VectorLayer","bindLayer","addLayer","FeatureStore","searchDocument","_searchDocument","setLayerFeatures","viewScale","checkLayer","setLayerOlFeatures","setStoreOlFeatures","clearLayer","computeOlFeaturesDiff","olFeaturesMap","olFeaturesToRemove","newOlFeature","olFeaturesToAddIds","getFeatures","removeOlFeaturesFromLayer","addOlFeaturesToLayer","setLayerExtent","viewProjection","addFeatures","FeatureStoreInMapExtentStrategy","stores$$","states$$","empty$$","watchStore","skipWhile","updateEntitiesInExtent","unwatchStore","unwatchAll","state$","inMapExtent","entitiesInMapExtent","entitiesWithNoGeom","FeatureStoreInMapResolutionStrategy","updateEntitiesInResolution","mapResolution","inMapResolution","GeoPropertiesStrategy","propertyTypeDetectorService","updateEntitiesPropertiesState","layers$","pairwise","prevLayers","currentLayers","prevLayersId","layersId","geoService","firstN","distinctValues","containGeoServices","entry","valuedAreGeoservices","isGeoService","geoServiceAssociations","getGeoService","propertiesForLayerName","propertyForLayerName","urlProperty","layerNameProperty","geoServiceStates","geoServiceAssociation","arcgisLayerName","appliedLayerName","potentialLayerId","LAYER","haveGeoServiceProperties","geoServiceState","urlValue","layerNameValue","entitiesToProcess","FeatureStoreLoadingStrategy","setMotion","subscription","onFeaturesChange","selectMotion","getFeatureId","FeatureStoreLoadingLayerStrategy","onSourceChanges","flatMap","cluster","OlDragSelectInteraction","OlDragBoxInteraction","FeatureStoreSelectionStrategy","mapClickListener","olDragSelectInteraction","olDragSelectInteractionEndKey","overlayStore","_overlayStore","createOverlayStore","unselectAll","deactivateSelection","unlistenToMapClick","removeDragBoxInteraction","addOverlayLayer","listenToMapClick","dragBox","addDragBoxInteraction","watchAll","removeOverlayLayer","stores$","onMapClick","unByKey","getFeaturesAtPixel","pixel","hitTolerance","layerFilter","onSelectFromMap","olInteractions","getInteractions","getArray","olInteraction","addInteraction","onDragBoxEnd","removeInteraction","mapBrowserEvent","getFeaturesInExtent","overlayFeaturesKeys","featuresKeys","doMotion","groupedFeatures","groupFeaturesByStore","unselectAllFeaturesFromStore","selectFeaturesFromStore","overlayLayer","createOverlayLayer","exportable","browsable","removeLayer","FeatureStoreSearchIndexStrategy","initStoreSearchIndex","Document","tokenize","onEntitiesChanges","percentDistinctValueRatio","featuresProperties","fp","igoSearchID","toIndex","columnsToNotIndex","contentToIndex","searchIndex","sf2","columnsToIndex","propertiesToIndex","tryAddLoadingStrategy","tryAddSelectionStrategy","createOverlayMarkerStyle","markerColor","markerOutlineColor","svgIconColor","svgOutlineColor","newColor","ColorAsArray","newOutlineColor","anchor","overflow","StyleService","createStyle","olStyle","parsedStyle","parseStyle","labelMinResolution","labelMaxResolution","labelMinResolutionFromScale","labelMaxResolutionFromScale","attribute","getLabel","styleOptions","olCls","getOlCls","_key","olKey","getOlKey","createStyleByAttribute","styleByAttribute","guessTypeFeature","labelStyle","baseStyle","val","OlFeature","createClusterStyle","clusterParam","layerStyle","clusterRanges","minRadius","maxRadius","showRange","dynamicRadius","clusterRadius","radiusMin","getRadius","image_","setRadius","radiusCalc","labelMatch","labelToGet","matchAll","getType","createOverlayLayerStyle","createOverlayDefaultStyle","markerStyle","createBufferStyle","strokeRGBA","fillRGBA","bufferRadius","customStyle","fillColor","strokeColor","fillWithOpacity","strokeWithOpacity","overlayDataSource","setFeatures","removeOlFeature","addOlFeatures","addOlFeature","removeFeatures","LayerWatcher","propertyChange$","unwatchLayer","setPropertyChange","watchLayer","evt","layer$$","MapViewAction","MapController","olMap","observerKeys","getOlMap","setOlMap","MapViewController","rotation$","padding","maxZoomOnExtent","maxLayerZoomExtent","extent$","extent$$","states","stateIndex","stateHistory","olView","getView","setPadding","top","right","bottom","left","onMoveEnd","monitorRotation","getRotation","getProjection","getCenter","center","calculateExtent","getSize","getScale","getScaleFromResolution","unit","getUnits","zoomIn","zoomTo","zoomOut","zoom","cancelAnimations","duration","easing","oleasing","resetRotation","hasPreviousState","hasNextState","previousState","setStateIndex","nextState","clearStateHistory","setInitialState","fromCenter","toCenter","distCenter","sqrt","fromExtent","fromSize","xSize","maxZoom","fit","isFinished","setState","viewStatesAreEqual","state1","state2","tolerance","trunc","GeolocationOverlayType","Position","PositionDirection","Accuracy","Buffer","MapGeolocationController","storageService","arrowRotation","subscriptions$$","geolocationOverlay","positionFeatureStyle","accuracyFeatureStyle","bufferStyle","buffer","bufferStroke","bufferFill","showBufferRadius","arrowStyle","displacement","rotateWithView","geolocation","emissionIntervalSeconds$","position$","tracking$","followPosition$","lastPosition","_buffer","handleFeatureCreation","accuracyThreshold","_accuracyThreshold","olGeolocation","tracking","getTracking","setTracking","followPosition","_followPosition","deleteGeolocationFeatures","deleteFeatureByType","onPositionChange","trackingOptions","enableHighAccuracy","maximumAge","timeout","interval","updateArrowFeatureOrientation","position4326","coordinates","dateTime","arrowFeature","getFeatureByType","isMoving","distanceBetweenPoints","accuracy","theta","atan2","coord1","coord2","olSphere","addOnChangedListener","listener","deleteChangedListener","updateGeolocationOptions","geolocate","alwaysTracking","storedTracking","storedFollowPosition","geolocateProperties","altitude","altitudeAccuracy","heading","timestamp","handleViewFromFeatures","featureById","positionGeometry","Point","accuracyGeometry","fromCircle","OlCircle","positionFeature","positionFeatureArrow","accuracyFeature","positionFeatureExists","positionFeatureArrowExists","accuracyFeatureExists","setGeometry","bufferFeature","bufferFeatureExists","bufferGeometry","edgeRatios","areOutOfView","getLinkedLayersOptions","linkedLayers","getIgoLayerByLinkId","linkId","getRootParentByProperty","layerToUse","parentLayer","hasParentLayer","getDirectParentLayerByProperty","layerHasLinkWithProperty","hasLinkWithProperty","layerLLOptions","links","currentLinkId","parents","pl","linkedIds","getDirectChildLayersByProperty","link","lid","getAllChildLayersByProperty","knownChildLayers","childLayers","cl","getDirectParentLayerByDeletion","syncedDelete","getDirectChildLayersByDeletion","getAllChildLayersByDeletion","initLayerSyncFromRootParentLayers","rootLayersByProperty","plbp","IgoMap","forcedOffline$","layersAddedByClick$","queryResultsOverlay","searchResultsOverlay","geolocationController","swipeEnabled$","mapCenter$","selectedFeatures$","bufferDataSource","layerWatcher","mapViewOptions","defaultOptions","attribution","projectionCode","olControlAttribution","scaleLine","olControlScaleLine","interactions","altShiftDragRotate","doubleClickZoom","keyboard","mouseWheelZoom","shiftDragZoom","dragPan","pinchRotate","pinchZoom","olinteraction","setView","once","pc","handleLayerPropertyChange","propertyChange","initiatorIgoLayer","isLayerProperty","isDatasourceProperty","rootParentByProperty","clbp","resolutionPropertyHasChanged","initiatorIgoLayerSourceType","initiatorIgoLayerOgcFilterableDataSourceOptions","getUid","lLayerType","appliedOgcFilter","getParams","appliedTimeFilter","updateView","viewOptions","constrainResolution","updateControls","getControls","removeControl","changeBaseLayer","bl","getBaseLayers","setMinZoom","minZoom","setMaxZoom","getLayerById","getLayerByAlias","getLayerByOlUId","olUId","getLayerByOlLayer","addLayers","offsetZIndex","offsetBaseLayerZIndex","addedLayers","doAddLayer","setLayers","removeLayers","newLayers","layersToRemove","removeLayerFromIDB","handleLinkedLayersDeletion","linkedLayer","linkedIndex","doRemoveLayer","srcLayer","rootParentByDeletion","getRootParentByDeletion","layerHasLinkDeletion","hasLinkWithSyncedDelete","clbd","removeAllLayers","raiseLayer","getLayerIndex","moveLayer","raiseLayers","lowerLayer","lowerLayers","reverseLayers","layerTo","zIndexFrom","existingLayer","maxZIndex","sortLayersByZIndex","layer1","layer2","_layer","MapBrowserComponent","activityId","_view","_controls","PointerPositionDirective","lastTimeoutRequest","pointerMoveListener","pointerPositionDelay","pointerPositionCoord","listenToMapPointerMove","unlistenToMapPointerMove","onPointerEvent","delay","dragging","lonlat","coordinate","featureRandomStyleFunction","circle","cos","featureRandomStyle","hoverFeatureMarkerStyle","olStyles","backgroundFill","backgroundStroke","pointerPositionSummaryMarkerStyle","HoverFeatureDirective","styleService","pointerHoverFeatureStore","store$$","layers$$","selectionLayer","selectionMVT","mvtStyleOptions","singleClickMapListener","hoverFeatureId","igoHoverFeatureDelay","igoHoverFeatureEnabled","mouseout","subscribeToPointerStore","olLayerVectorTile","renderMode","declutter","olVectorTileSource","createHoverStyle","hoverStyle","localHoverStyle","hasLabelStyle","unsubscribeToPointerStore","unlistenToMapSingleClick","resultsUnderPointerPosition","addFeatureOverlay","onMapEvent","onMapSingleClickEvent","topMostOlLayer","maximumZindex","getPixelFromCoordinate","forEachFeatureAtPixel","mapFeature","layerOL","igoLayer","ol_uid","canProcessHover","olLayerVector","myLayerVector","localOlFeature","handleRenderFeature","setLayerStyleFromOptions","featuresToLoad","myLabelOlFeature","setProperties","labelGeom","OlGeom","myLayerVectorTile","igoStyle","setSource","mvtFeatures","localFeature","RenderFeature","hoverEntity","hoverSummary","getHoverSummary","summary","geom","getOrientedFlatCoordinates","coords","flatCoords","idx","zoneMtm","lonMin","deltaLon","zoneUtm","computeProjectionsConstraints","projectionsLimitations","projFromConfig","nad83","wgs84","webMercator","utm","mtm","minZone","maxZone","InsertSourceInsertDBEnum","System","User","geoNetworkService","trackFeatureListenerId","initialOpacityValue","initialVisibleValue","initialMinResValue","initialMaxResValue","so","preload","bypassResolution","bypassVisible","flash","idbInfo","storeToIdb","firstLoad","maintainFeaturesInIdb","trackFeature","enableTrackFeature","vector","vectorSource","failure","customWFSLoader","setLoader","idbLoader","customIDBLoader","maintainOptionsInIdb","zip","deleteByKey","igoStyleObject","olStyleToBasicIgoStyle","layerOlStyle","getFill","getColor","getStroke","layerData","contextUri","insertEvent","dsFeatures","geojsonObject","writeFeatures","listenerKey","vectorContext","getVectorContext","frameState","flashGeom","elapsed","elapsedRatio","easeOut","getStyleFunction","style2","styleClone","setColor","setWidth","getWidth","drawGeometry","render","stopAnimation","centerMapOnFeature","feat","setCenter","getCoordinates","disableTrackFeature","alteredUrl","nbOfFeature","threshold","idAssociatedCall","removeLoadedExtent","responseText","getFormat","DOMParser","parseFromString","readProjection","responseXML","layerID","VectorTileLayer","vectorTile","vectorTileSource","onLoad","computeMVTOptionsOnHover","vectorTileLayerOptions","GeoDBService","ngxIndexedDBService","compression","dbName","collisionsMap","_newData","regionID","insertSource","compress","subject","geoDBData","object$","getByID","dbObject","currentRegionID","collisions","customUpdate","deleteRequest","isDeleted","getRegionCountByID","getRegionByID","datas","IDBKey","IDBKeyRange","only","getAllByIndex","deleteByRegionID","dbRequest","openCursor","keyRange","lowerBound","DBMode","openCursorByIndex","resetCounters","resetCollisionsMap","revertCollisions","getByKey","take","newData","GeoNetworkService","networkService","networkOnline","simpleGetOptions","getOnline","getOffline","isOnline","LayerDBService","layerDBData","LayerService","dataSourceService","createLayer","createTileLayer","createVectorLayer","createImageLayer","_layerOptions","createVectorTileLayer","createAsyncLayer","handleLegacyStyles","serviceStyle","clusterBaseStyle","layerOptionsOl","applyMapboxStyle","legacyStyleOptions","legacyOption","mapboxStyle","getStuff","sprite","getAbsoluteUrl","res2","stylefunction","createAsyncIdbLayers","layersOptions","idbl","i7","CatalogItemType","Group","TypeCatalog","baselayers","composite","QueryService","queryEnabled","defaultFeatureCount","featureCount","previousMessageIds","queryLayer","getQueryUrl","urlGml","mergeMap","gmlRes","mergedGML","mergeGML","imposedGeom","imposedProperties","extractData","urlGmls","checkScaleAndResolution","requestDataForHTMLGML2","checkScale","checkResolution","olmline","olgeom","pts","ptsArray","firstFeatureType","olmpoly","nbFeatures","bbox","getQueryParams","bboxExtent","titleContent","queryTileField","olmpts","returnGeometry","queryTitleContent","featureGeometryCoordinates","featureGeometryType","appendLineString","appendPolygon","convexHull","cross","lower","upper","imposedGeometry","queryDataSource","allowedFieldsAndAlias","getAllowedFieldsAndAlias","extractGML3Data","extractGeoJSONData","extractEsriJSONData","extractTextData","extractHtmlData","extractGML2Data","geomToAdd","createGeometryFromUrlClick","wmsDatasource","FEATURE_COUNT","getQueryTitle","sourceTitle","searchParams","bboxRaw","clickx","clicky","clickx1","clicky1","wktPoly","wmsParser","featureToResult","parser","htmlTarget","crs","bodyTagStart","bodyTagEnd","lastIndexOf","striptags","queryString","pairs","featureOL","featureGeometry","GEOMETRIE","shape","SHAPE","SHAPE_S","SHAPE_L","SHAPE_P","the_geom","geom32198","datasource","forceGML2","queryUrls","getCustomQueryUrl","WMSGetFeatureInfoOptions","INFO_FORMAT","getMimeInfoFormat","QUERY_LAYERS","getFeatureInfoUrl","sql","queryPrecision","tileArcGISRestDatasource","deltaX","deltaY","mime","getLabelMatch","layerIsQueryable","olLayerFeatureIsQueryable","layerFeatureIsQueryable","queryLayerFeatures","QueryDirective","queryService","queries$$","queryFeatures","queryFeaturesHitTolerance","queryFeaturesCondition","waitForAllQueries","cancelOngoingQueries","queries$","doQueryFeatures","queryLayers","query$","clickedFeatures","values_","queryFormatAsWms","newFeature","nom","id_","_icon","OlRenderFeature","renderFeatureFromOl","olRenderFeature","geometryType","ends","getEnds","OlPolygon","getFlatCoordinates","OlPoint","OlLineString","dragExtent","forEachFeatureIntersectingExtent","olDragSelectInteractionOnQuery","SearchSource","getDefaultOptions","showInSettings","settings","featureStoresWithIndex","storesWithIndex","_featureStoresWithIndex","setWorkspaces","workspaces","fw","datasets","setParamFromSetting","setting","saveInStorage","confValue","displayOrder","storageOptions","getHashtagsValid","term","settingsName","hashtags","searchSourceSetting","getSettingsValues","hashtagsValid","hashtag","hashtagKey","QuerySearchSource","GoogleLinks","getGoogleMapsCoordLink","getGoogleStreetViewLink","getGoogleMapsNameLink","encodeURI","OsmLinks","getOpenStreetMapLink","getOpenStreetCamLink","PropertyTypeDetectorService","regexService","geoServiceRegexes","getGeoServiceRegexes","getPropertyType","geoServiceRegex","availableProperties","matchingGeoservice","Catalog","removable","externalProvider","forcedProperties","matrixSet","requestEncoding","groupImpose","groupSeparator","sortDirection","setCrossOriginAnonymous","showLegend","profils","WMSCatalog","_collectCatlogItems","collectCatalogItems","WMTSCatalog","BaselayersCatalog","ArcGISRestCatalog","TileOrImageArcGISRestCatalog","typeCatalog","CompositeCatalog","CatalogService","loadCatalogs","contextConfig","catalogConfig","apiUrl","catalogsFromConfig","baseLayers","baseLayersCatalog","catalogsFromApi$","catalogs","_response","EMPTY","loadCatalogItems","newCatalog","CatalogFactory","createInstanceCatalog","loadCatalogBaseLayerItems","getCatalogBaseLayersOptions","loadCatalogWMSLayerItems","getCatalogCapabilities","Service","finalLayers","flattenWmsCapabilities","capabilitiesCapabilityLayer","includeRecursiveItems","modifiedParent","modifiedLayer","ff","loadCatalogWMTSLayerItems","getWMTSItems","loadCatalogArcGISRestItems","getArcGISRESTItems","loadCatalogCompositeLayerItems","compositeCatalog","catalogsFromInstance","request1$","request2$","flatDeepLayer","arr","pushImposeGroup","outGroupImpose","address","flatLayer","obs","request3$","recursiveGroupByLayerAddress","keyFn","layerTitle","outItem","indicesMatchTitle","indicesMatchNewMetadataUrl","bInd","nPosition","newMetadataUrl","groupByGroupId","groupId","ind","ix","computeForcedProperties","layerNameFromCatalog","returnProperty","metadataUrl","metadataAbstract","metadataAbstractAll","metadataUrlAll","forcedPropertiesForAllLayers","forcedProperty","prepareCatalogItemLayer","idParent","layersQueryFormat","configuredQueryFormat","retrieveLayerInfoFormat","baseSourceOptions","propertiesToForce","baseAbstract","layerOnlineResource","layerPrepare","prepareCatalogItemGroup","itemListIn","regexes","idGroup","groupItem","testLayerRegexes","layerItem","itemsPrepare","loopLevel","findCatalogInfoFormat","ServiceIdentification","regex","currentLayerInfoFormat","baseInfoFormat","configuredInfoFormat","specific","catalogService","onGroupAddedChange","onLayerAddedChange","item_r1","catalogAllowLegend","toggleCollapsedGroup","CatalogBrowserComponent_ng_template_1_ng_container_0_Template","CatalogBrowserComponent_ng_template_1_ng_container_1_Template","isGroup","isLayer","CatalogBrowserComponent","layerService","currentItems","addLayerToMap","removeLayerFromMap","addGroupToMap","removeGroupFromMap","addLayersToMap","removeLayersFromMap","security","currLayer","sortCatalogItemsByTitle","returnItem","titleA","titleB","CatalogBrowserComponent_ng_template_1_Template","IgoBadgeIconDirective","igoMatBadgeIcon","getNamedSvgIcon","svgObj","updateSvg","matBadgeHidden","hidden","updateHidden","matBadgeDisabled","updateDisabled","igoMatBadgeInverseColor","inverseColor","updateColor","igoMatBadgeInheritColor","inheritColor","igoMatBadgeColor","igoMatBadgeBackgroundColor","backgroundColor","badge","originalColor","alignItems","justifyContent","background","getComputedStyle","getPropertyValue","MetadataService","openMetadata","MetadataButtonComponent","metadataService","_color","MetadataAbstractComponent","MetadataButtonComponent_button_0_Template","MAT_DIALOG_DATA","MetadataAbstractComponent_mat_dialog_content_4_Template","MetadataAbstractComponent_mat_dialog_content_5_Template","CollapseDirective","_target","collapseTarget","expandTarget","item_r6","toggleLegendItem","computeItemTitle","style_r18","onChangeStyle","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_4_mat_option_4_Template","ctx_r11","_r29","ctx_r27","onLoadImage","imgGraphValue","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_1_img_1_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_1_small_2_Template","ctx_r22","imagesHeight","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_1_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_div_2_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_mat_list_item_1_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_4_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_div_5_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_div_2_Template","LayerLegendComponent_ng_container_0_ng_container_1_ng_container_1_Template","items_r1","LayerLegendComponent_ng_container_0_ng_container_1_Template","LayerLegendComponent_ng_container_0_ng_template_2_Template","LayerLegendComponent","updateLegendOnResolutionChange","legendItems$","renderedLegends","lastlLegend","listStyles","STYLES","onViewControllerStateChange","getLegendGraphic","obsLegGraph","leg","transfertToggleLegendItem","newLegends","outLegends","lastLegends","layerLegend","localLayerOptions","wmsDataSourceOptions","updateLegend","legendItems","sA","sa","elemRef","renderedLegend","LayerLegendComponent_ng_container_0_Template","igoLayer$","CatalogBrowserLayerComponent","inRange$","isPreview$","isVisible$","isPreview$$","layerLegendShown$","mouseInsideAdd","addedChange","addedLayerIsPreview","isVisible","computeTitleTooltip","layerTooltip","layerMetadata","onMouseEvent","onToggleClick","askForLegend","haveGroup","oLayer","getBadgeIcon","computeTooltip","CatalogBrowserLayerComponent_mat_icon_1_Template","CatalogBrowserLayerComponent_button_5_Template","CatalogBrowserLayerComponent_igo_layer_legend_20_Template","ListItemDirective","focused","_focused","beforeFocus","beforeUnfocus","toggleFocusedClass","focus","unfocus","beforeSelect","beforeUnselect","toggleSelectedClass","unselect","_disabled","beforeDisable","beforeEnable","toggleDisabledClass","getOffsetTop","offsetTop","focusedCls","disabledCls","CatalogBrowserGroupComponent_button_5_mat_icon_1_Template","_r16","onLayerPreview","ctx_r17","item_r12","CatalogBrowserGroupComponent_ng_template_13_ng_container_0_Template","CatalogBrowserGroupComponent_ng_template_13_ng_container_1_Template","CatalogBrowserGroupComponent","preview$","toggleCollapsed","layerAddedChange","evaluateAdded","evaluateDisabled","onToggleCollapsed","tryToggleGroup","onTitleClick","CatalogBrowserGroupComponent_button_5_Template","CatalogBrowserGroupComponent_ng_container_6_Template","CatalogBrowserGroupComponent_ng_template_9_Template","CatalogBrowserGroupComponent_ng_template_13_Template","LayerListToolService","keyword","sortAlpha","onlyVisible","onlyInRange","keywordInitialized","sortedAlphaInitialized","onlyVisibleInitialized","onlyInRangeInitialized","check","layerCheck","toggleVisibility","eyeTooltip","queryBadgeHidden$","inResolutionRange$","toggleLayerTool","LayerItemComponent","activeLayer","_activeLayer","selectionMode","layerTool$","showLegend$","tooltipText","selectAll","_selectAll","network$$","toggleLegendOnVisibilityChange","expandLegendIfVisible","orderable","lowerDisabled","raiseDisabled","queryBadge","toggleLegend","updateQueryBadge","onResolutionChange","toggleLegendOnClick","inResolutionRange","LayerItemComponent_mat_checkbox_1_Template","LayerItemComponent_button_5_Template","LayerItemComponent_button_6_Template","LayerItemComponent_button_7_Template","LayerItemComponent_igo_layer_legend_10_Template","LayerListControlsEnum","always","never","LayerListSelectVisibleEnum","ALL_VISIBLE","ALL_HIDDEN","MIXED","NULL","LayerListDisplacement","Raise","Lower","onAppliedFilterAndSortChange","toggleSelectionMode","layersAreAllVisible","layerFilterAndSortOptions","selectAllCheck","layersChecked","layersCheck","layer_r11","getLowerLayer","getUpperLayer","expandLegendOfVisibleLayers","layerItemChangeDetection$","LayerListComponent_ng_template_6_igo_layer_item_0_Template","excludeBaseLayers","zoomLayerExtents","LayerListComponent_igo_panel_8_button_2_Template","_r28","moveActiveLayer","layerListDisplacement","ctx_r31","changeOpacity","LayerListComponent_igo_panel_8_button_21_Template","isLayerRemovable","badgeOpacity","activeLayerExtentIsValid","templateLayerToolbar","checkOpacity","_r39","ctx_r38","zoomLayersExtents","_r41","ctx_r40","ctx_r42","ctx_r43","ctx_r44","LayerListComponent_igo_panel_9_mat_slider_25_Template","LayerListComponent_igo_panel_9_button_26_Template","isAllLayersRemovable","statusSelectedLayersCheck","lowerDisabledSelection","raiseDisabledSelection","_r32","activeLayersExtentAreValid","LayerListComponent","thresholdToFilterAndSort","showToolbar$","layerTool","hideSelectedLayers","activeLayer$","change$$","ogcButton","timeButton","_map","_layers","removeProblemLayerInList","floatLabel","appliedFilterAndSort","_keyword","_onlyVisible","_sortedAlpha","isUpperBaselayer","isLowerBaselayer","raisableLayers","lowerableLayers","layersCheckedOpacity","toggleOpacity","selectAllCheck$","selectAllCheck$$","debounce","timer","computeShowToolbar","computeLayers","checks","lay","showButtonZoomToExtent","layerExtent","layersExtent","clearKeyword","actiontype","fromUi","sortedLayersToMove","layersToMove","base","mapIndex","currentLayer","previousLayer","raisableLayer","layersToRaise","checkItems","getElementsByClassName","itemFocused","targetToScroll","nextLayer","lowerableLayer","layersToLower","layersOut","filterLayers","sortLayersByTitle","sortLayersByZindex","onKeywordChange","showToolbar","keepLayerIds","layerKeywords","kw","localKeyword","dataSourceType","keywordRegex","keywordInList","statusSelectedLayers","findTrue","findFalse","eventMapIndex","isScrolledIntoView","elemSource","elem","docViewTop","elemTop","layersList","contentQueries","dirIndex","LayerListComponent_igo_layer_list_tool_0_Template","LayerListComponent_div_2_Template","LayerListComponent_ng_template_6_Template","LayerListComponent_igo_panel_8_Template","LayerListComponent_igo_panel_9_Template","clearTerm","LayerListToolComponent","onlyVisible$","sortAlpha$","term$","onlyVisible$$","sortAlpha$$","term$$","toggleSortAlpha","toggleOnlyVisible","LayerListToolComponent_button_4_Template","toggleShowAllLegends","showAllLegendsValue","layer_r9","LayerLegendListComponent_ng_template_6_igo_layer_legend_item_0_Template","LayerLegendListComponent","hasVisibleOrInRangeLayers$","hasVisibleAndNotInRangeLayers$","layersInUi$","showAllLegend","allowShowAllLegends","allLegendsShown","computeShownLayers","shownLayers","LayerLegendListComponent_mat_slide_toggle_1_Template","LayerLegendListComponent_mat_divider_3_Template","LayerLegendListComponent_ng_template_6_Template","LayerLegendListComponent_p_8_Template","LayerLegendListComponent_p_12_Template","LayerLegendListComponent_p_16_Template","LayerLegendListComponent_p_20_Template","LayerLegendItemComponent","ClickoutDirective","clickout","handleMouseClick","contains","ListComponent","navigation","_navigation","_selection","selectedItem","_selectedItem","focusedItem","_focusedItem","navigationEnabled","listItems$$","listItems","handleKeyboardEvent","enableNavigation","focusNext","toArray","igoList","getFocusedIndex","offsetHeight","focusPrevious","disableNavigation","scrollToItem","findSelectedItem","findFocusedItem","item2","handleItemBeforeSelect","handleItemSelect","handleItemBeforeFocus","handleItemFocus","IgoLayerModule","MatSlideToggleModule","MatSliderModule","i8","i9","i10","i11","i12","i13","i14","i15","i16","IgoCatalogBrowserModule","predefinedCatalog_r7","predefinedCatalog_r8","type_r9","addedCatalog","emailAddress","AddCatalogDialogComponent","defaultAddedCatalogType","addedCatalogType$$","predefinedCatalogsList$","typeCapabilities","predefinedCatalogs","storeViewAll$$","updateValueAndValidity","computePredefinedCatalogList","changeUrlOrTitle","patchValue","addCatalog","AddCatalogDialogComponent_mat_option_11_Template","AddCatalogDialogComponent_mat_option_18_Template","AddCatalogDialogComponent_mat_option_23_Template","AddCatalogDialogComponent_span_24_Template","AddCatalogDialogComponent_span_25_Template","_r0","catalog_r2","onCatalogRemove","onCatalogSelect","addCatalogDialog","CatalogLibaryComponent","addCatalogAllowed","catalogSelectChange","addingCatalog$$","addedCatalogs","getCatalogs","unsubscribeAddingCatalog","predefinedCatalog","mapName","ServiceType","catalogToAdd","newCatalogs","CatalogLibaryComponent_ng_template_1_Template","CatalogLibaryComponent_div_3_Template","removeCatalogFromLibrary","CatalogLibaryItemComponent","catalogRemove","CatalogLibaryItemComponent_mat_icon_4_Template","CatalogLibaryItemComponent_button_5_Template","CatalogLibaryItemComponent_button_6_Template","IgoCatalogLibraryModule","IgoCatalogModule","IgoDownloadModule","IgoDrawModule","MatButtonToggleModule","BrowserModule","BrowserAnimationsModule","MatRadioModule","IgoFeatureDetailsModule","IgoFeatureFormModule","IgoFeatureModule","IgoGeometryFormFieldModule","IgoGeometryModule","FilterableDataSourcePipe","arg","isTimeFilterable","isOgcFilterable","TimeFilterButtonComponent_div_1_igo_time_filter_item_2_Template","timeFilterCollapse","TimeFilterButtonComponent","TimeFilterButtonComponent_button_0_Template","TimeFilterButtonComponent_div_1_Template","handleDateChange","startDate","endDate","getRangeMaxDate","getRangeMinDate","TimeFilterFormComponent_div_0_div_1_Template","TimeFilterFormComponent_div_0_div_2_Template","isRange","year_r21","_r23","year","ctx_r24","handleYearChange","TimeFilterFormComponent_div_1_div_1_mat_option_4_Template","listYears","startYear_r27","endYear_r28","_r30","startYear","TimeFilterFormComponent_div_1_div_2_mat_option_5_Template","endYear","TimeFilterFormComponent_div_1_div_2_mat_option_10_Template","startListYears","endListYears","TimeFilterFormComponent_div_1_div_1_Template","TimeFilterFormComponent_div_1_div_2_Template","ctx_r36","_r35","_r34","handleSliderYearChange","TimeFilterFormComponent_div_3_p_9_Template","ctx_r41","toggleFilterState","playYear","resetFilter","handleSliderValue","playIcon","resetIcon","_r47","handleSliderDateChange","_r45","_r44","ctx_r49","playFilter","dateToNumber","handleSliderTooltip","TimeFilterFormComponent","initStartYear","initEndYear","valueArray","yearChange","mySlider","getStepDefinition","timeInterval","getTimezoneOffset","is","getFullYear","checkFilterValue","storeCurrentFilterValue","timeFromWms","newStartListYears","newEndListYears","setupDateOutput","applyTypeChange","handleListYearChange","handleListYearStartChange","newDate","setSliderThumbLabel","thumbLabel","findThumbLabel","childNodes","textContent","stopFilter","that","newMinDateNumber","maxDateNumber","getRoundedDate","toDateString","toTimeString","setSeconds","setHours","setMinutes","getDay","selectedHour","getHours","selectedMinute","getMinutes","atMinute","coeff","asMilliseconds","MatSlider","TimeFilterFormComponent_div_0_Template","TimeFilterFormComponent_div_1_Template","TimeFilterFormComponent_div_3_Template","TimeFilterFormComponent_div_4_Template","TimeFilterService","filterByDate","newdateform","newdateformStart","newdateformEnd","dates","reformatDateTime","filterByYear","years","month","getMonth","day","getUTCDate","hour","getUTCHours","minute","getUTCMinutes","toggleFiltersCollapsed","TimeFilterItemComponent_mat_list_item_0_button_4_Template","_r1","filtersCollapsed","TimeFilterItemComponent","timeFilterService","TimeFilterItemComponent_mat_list_item_0_Template","TimeFilterItemComponent_igo_layer_legend_5_Template","layer_r1","TimeFilterListComponent","TimeFilterListComponent_ng_template_1_Template","WktService","wktToFeature","wkt","wktProj","featureProj","olWKT","extentToWkt","epsgTO","extentProj","roundCoordinateArray","wktLine","wktMultiPoints","coordinateArray","roundArray","snrcToWkt","snrc","ew","sn","snrc250kIndex","snrc50kIndex","snrc1m","snrc250k","snrc50k","ar1m","part1m","part250k","part50k","partEW","partSN","unit1mEW","unit1mSN","unit250kEW","unit250kSN","unit50kEW","unit50kSN","index250kEW","index250kSN","index50kEW","index50kSN","increment250kEW","increment250kSN","increment50kEW","increment50kSN","unitPerTypeEW","unitPerTypeSN","ul","lr","ur","ll","field_r12","clearSelectedField","currentFilter","inputClearable","updateFieldsList","changeField","OgcFilterFormComponent_mat_form_field_14_mat_option_10_Template","OgcFilterFormComponent_mat_form_field_14_button_12_Template","selectedField$","filteredFields$","operator_r20","igoSpatialSelector_r22","changeSpatialSelector","OgcFilterFormComponent_mat_form_field_28_mat_option_2_Template","igoSpatialSelectors","value_r28","clearProperty","updateValuesList","changeProperty","OgcFilterFormComponent_mat_form_field_30_mat_option_5_Template","OgcFilterFormComponent_mat_form_field_30_button_7_Template","_r25","detectProperty","filteredValues$","isClearable","changeSNRC","OgcFilterFormComponent_mat_form_field_35_button_3_Template","changeMapExtentGeometry","OgcFilterFormComponent_ng_container_37_button_1_Template","value_r49","_r51","_r53","ctx_r52","ctx_r54","ctx_r55","ctx_r56","changeNumericProperty","OgcFilterFormComponent_mat_form_field_40_mat_option_5_Template","OgcFilterFormComponent_mat_form_field_40_button_7_Template","_r46","value_r60","_r62","ctx_r61","ctx_r59","_r64","ctx_r63","ctx_r65","OgcFilterFormComponent_mat_form_field_41_mat_option_5_Template","OgcFilterFormComponent_mat_form_field_41_button_7_Template","_r57","_r69","ctx_r68","pos","OgcFilterFormComponent","wktService","ogcFilterOperator","allOgcFilterOperators","ogcFilterOperators$","inputOperator","fields$","currentFilterIsSpatial$","defaultStepMillisecond","refreshFilters","_snrc","activeFilters","interfaceOgcFilters","sFields","excludeFromOgcFilters","sfs","currentFilterIsSpatial","_filterFields","_filterValues","detectedProperty","deleteFilter","changeLogical","changeOperator","changeCaseSensitive","refreshFilter","changeSNRCGeometry","isSpatial","isTemporalOperator","OgcFilterFormComponent_mat_form_field_14_Template","OgcFilterFormComponent_mat_option_25_Template","OgcFilterFormComponent_mat_form_field_28_Template","OgcFilterFormComponent_mat_form_field_30_Template","OgcFilterFormComponent_mat_form_field_35_Template","OgcFilterFormComponent_ng_container_37_Template","OgcFilterFormComponent_mat_form_field_40_Template","OgcFilterFormComponent_mat_form_field_41_Template","OgcFilterFormComponent_igo_ogc_filter_time_42_Template","_c3","_c4","refreshFunc","currentFilter_r3","OgcFilterableFormComponent_1_ng_template_0_Template","OgcFilterableFormComponent","MAT_SELECT_CONFIG","overlayPanelClass","MAT_AUTOCOMPLETE_DEFAULT_OPTIONS","OgcFilterableFormComponent_igo_ogc_filter_selection_0_Template","OgcFilterableFormComponent_1_Template","OGCFilterService","filterByOgc","filterString","setOgcWFSFiltersOptions","wfsDatasource","setOgcWMSFiltersOptions","filtered","_r12","addFilterToSequence","addFilterDisabled","OgcFilterableItemComponent_div_9_igo_layer_legend_2_Template","changeOgcFilterType","OgcFilterableItemComponent","ogcFilterService","lastRunOgcFilter","defaultLogicalParent","hasActiveSpatialFilter","filtersAreEditable","hasSelector","lastLevel","firstFieldName","includedFields","datasourceOptions","firstOperatorName","force","af","rebuildFilter","ogcDataSource","ogcLayer","isAdvancedOgcFilters","changeOgcFiltersAdvancedOgcFilters","OgcFilterableItemComponent_mat_icon_2_Template","OgcFilterableItemComponent_span_3_Template","OgcFilterableItemComponent_button_5_Template","OgcFilterableItemComponent_button_6_Template","OgcFilterableItemComponent_div_9_Template","OgcFilterableItemComponent_section_11_Template","layer_r2","OgcFilterableListComponent","OgcFilterableListComponent_div_1_Template","OgcFilterableListComponent_ng_template_3_Template","OgcFilterButtonComponent_div_1_igo_ogc_filterable_item_2_Template","ogcFilterCollapse","OgcFilterButtonComponent","currentPushButtonGroup","gr","cntPushButtons","cb","button","currentCheckboxGroup","cntCheckboxes","currentRadioButtonsGroup","cntRadioButtons","radio","currentSelectGroup","cntSelect","currentAutocompleteGroup","cntAutocomplete","filterActiveValue","OgcFilterButtonComponent_button_0_Template","OgcFilterButtonComponent_div_1_Template","OGCFilterTimeService","stepMillisecond","stepIsYearDuration","months","weeks","days","hours","stepIsMonthDuration","stepIsWeekDuration","week","stepIsDayDuration","stepIsHourDuration","stepIsMinuteDuration","addStep","toDate","subtractStep","subtract","selectorGroup_r11","currentPushButtonsGroup","OgcFilterSelectionComponent_div_1_div_1_div_2_mat_option_4_Template","getPushButtonsGroups","ogcPushButton_r16","selector_r2","getToolTip","getButtonColor","OgcFilterSelectionComponent_div_1_div_1_ng_container_3_mat_button_toggle_4_Template","bundle_r14","bundleIsVertical","OgcFilterSelectionComponent_div_1_div_1_div_2_Template","OgcFilterSelectionComponent_div_1_div_1_ng_container_3_Template","selectorGroup_r23","currentCheckboxesGroup","OgcFilterSelectionComponent_div_1_div_2_div_2_mat_option_4_Template","getCheckboxesGroups","ogcCheckbox_r29","_r31","displayLessResults","displayMoreResults","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_p_5_u_1_Template","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_p_5_u_2_Template","ctx_r28","isLessResults","bundle_r26","isMoreResults","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_mat_checkbox_4_Template","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_p_5_Template","OgcFilterSelectionComponent_div_1_div_2_div_2_Template","OgcFilterSelectionComponent_div_1_div_2_ng_container_3_Template","selectorGroup_r43","OgcFilterSelectionComponent_div_1_div_3_div_2_mat_option_4_Template","getRadioButtonsGroups","emptyRadioButtons","ogcRadioButton_r52","_r59","ctx_r58","_r61","ctx_r60","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_p_6_u_1_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_p_6_u_2_Template","bundle_r46","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_mat_radio_button_4_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_mat_radio_button_5_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_p_6_Template","unfiltered","OgcFilterSelectionComponent_div_1_div_3_div_2_Template","OgcFilterSelectionComponent_div_1_div_3_ng_container_3_Template","selectorGroup_r66","_r68","OgcFilterSelectionComponent_div_1_div_4_div_2_mat_option_4_Template","getSelectGroups","_r75","ctx_r74","emptySelect","_r80","ctx_r79","selectAllSelected","ctx_r81","toggleAllSelection","bundle_r69","ctx_r83","selectOptionClick","ctx_r78","ogcSelect_r82","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_div_6_mat_checkbox_4_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_div_6_mat_option_5_Template","_r91","ctx_r89","ctx_r87","ogcSelect_r88","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_ng_template_7_mat_option_1_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_mat_button_4_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_div_6_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_ng_template_7_Template","_r72","OgcFilterSelectionComponent_div_1_div_4_div_2_Template","OgcFilterSelectionComponent_div_1_div_4_ng_container_3_Template","autocompleteGroup_r96","_r98","OgcFilterSelectionComponent_div_1_div_5_div_2_mat_option_4_Template","ctx_r93","getAutocompleteGroups","_r103","ctx_r102","emptyAutocomplete","ogcAutocomplete_r108","_r110","ctx_r109","autocompleteOptionClick","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_form_field_5_mat_option_6_Template","bundle_r99","ctx_r101","displayFn","filteredOgcAutocomplete","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_button_4_Template","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_mat_form_field_5_Template","ctx_r94","OgcFilterSelectionComponent_div_1_div_5_div_2_Template","OgcFilterSelectionComponent_div_1_div_5_ng_container_3_Template","OgcFilterSelectionComponent_div_1_div_1_Template","OgcFilterSelectionComponent_div_1_div_2_Template","OgcFilterSelectionComponent_div_1_div_3_Template","OgcFilterSelectionComponent_div_1_div_4_Template","OgcFilterSelectionComponent_div_1_div_5_Template","ctx_r113","OgcFilterSelectionComponent_div_2_h3_2_Template","OgcFilterSelectionComponent_div_2_h3_3_Template","_r115","ctx_r114","ctx_r116","ctx_r117","OgcFilterSelectionComponent","domService","sel","checkboxesIndex","radioButtonsIndex","baseIndex","_currentFilter","selectEnabled$","selectEnableds$","autocompleteEnabled$","applyFiltersTimeout","ogcFiltersSelectors","ogcSelector","pushButtonsGroup","checkboxesGroup","radioButtonsGroup","selectGroup","autocompleteGroup","selectEnabled","compSelect","applyFilters","selectEnableds","autocompleteEnabled","buildForm","selectMulti","getSelectEnabled","getSelectDomValues","getAutocompleteEnabled","getAutocompleteDomValues","onPushButtonsChangeGroup","onCheckboxesChangeGroup","onRadioButtonsChangeGroup","onSelectChangeGroup","onAutocompleteChangeGroup","toolTip","_this2","domSelectors","domValues","domSelector","filterDOM","domOptions","newBundle","comp","_this3","pushButton","vertical","currentOgcSelection","markAsUntouched","deselect","newStatus","isUserInput","currentGroups","currentGroup","selectorsLength","OgcFilterSelectionComponent_div_1_Template","OgcFilterSelectionComponent_div_2_Template","SpatialFilterType","Predefined","Polygon","SpatialFilterItemType","Address","Thematics","queryType_r1","SpatialFilterTypeComponent","_store","queryType","selectedTypeIndex","UntypedFormControl","spatialType","activeDrawType","selectedQueryType","eventQueryType","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange","onTypeChange","onDrawTypeChange","SpatialFilterTypeComponent_mat_option_8_Template","SpatialFilterService","urlFilterList","AdmRegion","Arrond","CircFed","CircProv","DirReg","MRC","Mun","RegTour","bornes","hydro","routes","getKeyByValue","loadFilterList","featureCollection","loadThematicsList","loadFilterItem","itemType","thematic","urlItem","bufferInput","simplified","loc","loadItemById","featureType","featureCode","loadBufferGeometry","filterType","bufferOutput","MeasureType","Length","Area","MeasureLengthUnit","Meters","Kilometers","Miles","Feet","MeasureLengthUnitAbbreviation","MeasureAreaUnit","SquareMeters","SquareKilometers","SquareMiles","SquareFeet","Hectares","Acres","MeasureAreaUnitAbbreviation","metersToKilometers","metersToFeet","metersToMiles","squareMetersToSquareKilometers","squareMetersToSquareMiles","squareMetersToSquareFeet","squareMetersToHectares","squareMetersToAcres","metersToUnit","conversion","squareMetersToUnit","formatMeasure","measure","parts","toLocaleString","minimumFractionDigits","maximumFractionDigits","unitAbbr","createMeasureInteractionStyle","measureOlGeometryLength","olGetLength","measureOlGeometryArea","olGetArea","measureOlGeometry","area","lengths","coordinatesLength","olSegment","updateOlGeometryMidpoints","olMidpoints","olMidpointPoint","getOlGeometryMidpoints","midpointsLength","midpointCoordinate","getCoordinateAt","olMidpoint","setCoordinates","expectedNumber","clearOlMidpointTooltip","olTooltip","removeOverlay","getTooltipsOfOlGeometry","olTooltips","getOlTooltipsAtMidpoints","olCenterTooltip","getOlTooltipAtCenter","olCenter","createOlTooltipAtPoint","olPoint","srcGeomType","OlOverlay","stopEvent","setPosition","entities_r4","measureUnit_r5","SpatialFilterListComponent","spatialFilterService","_queryType","_zone","zoneWithBuffer","bufferFormControl","selectedZone","measureUnit","measureUnits","formValueChanges$$","bufferValueChanges$$","featureGeom","onZoneChange","onMeasureUnitChange","SpatialFilterListComponent_mat_option_10_Template","SpatialFilterListComponent_mat_option_22_Template","KeyValuePipe","keyValues","property_r3","openSecureUrl","getEmbeddedLinkText","FeatureDetailsComponent_table_0_tr_2_td_1_Template","FeatureDetailsComponent_table_0_tr_2_td_2_Template","FeatureDetailsComponent_table_0_tr_2_td_3_Template","FeatureDetailsComponent_table_0_tr_2_td_4_Template","FeatureDetailsComponent_table_0_tr_2_td_5_Template","FeatureDetailsComponent_table_0_tr_2_td_6_Template","FeatureDetailsComponent_table_0_tr_2_td_7_Template","FeatureDetailsComponent_table_0_tr_2_td_8_Template","isEmbeddedLink","isDoc","FeatureDetailsComponent_table_0_tr_2_Template","filterFeatureProperties","htmlSanitizer","urlSanitizer","FeatureDetailsComponent","sanitizer","unsubscribe$","ready","_source","_feature","selectFeature","routeEvent","htmlDisplayEvent","isHtmlDisplay","docOrImage","fileUrl","div","getAttribute","offlineButtonState","Route","FeatureDetailsComponent_table_0_Template","FeatureDetailsComponent_iframe_1_Template","createDrawInteractionStyle","createDrawHoleInteractionStyle","getMousePositionFromOlGeometryEvent","olEvent","DrawControl","start$","end$","changes$","modify$","select$","abort$","freehand$","ispredefinedRadius$","predefinedRadius$","radiusDrawEnd$","keyDown$$","olGeometryType","olInteractionStyle","olDrawingLayer","olDrawInteraction","olSelectInteraction","olModifyInteraction","onDrawStartKey","onDrawEndKey","onDrawAbortKey","onDrawKey","mousePosition","radiusVal","radiusValData","radiusCercle","olDrawingLayerSource","drawingLayer","createOlInnerOverlayLayer","interactionStyle","activateModifyAndSelect","clearOlInnerOverlaySource","removeOlInnerOverlayLayer","removeOlInteractions","addOlInnerOverlayLayer","addOlInteractions","setOlInteractionStyle","setGeometryType","getGeometryType","OlVectorLayer","drawingLayerSource","OlVectorSource","drawingLayerStyle","OlDraw","maxPoints","freehand","stopClick","freehandCondition","onDrawStart","onDrawEnd","OlModify","OlSelect","doubleClick","onSelect","unsubscribeKeyDown","olGeometryEvent","subscribeKeyDown","removeLastPoint","finishDrawing","abortDrawing","ModifyControl","olOverlayLayer","onModifyStartKey","onModifyEndKey","onModifyKey","olModifyInteractionIsActive","olTranslateInteraction","onTranslateStartKey","onTranslateEndKey","onTranslateKey","olTranslateInteractionIsActive","olDrawInteractionIsActive","drawKeyUp$$","drawKeyDown$$","removedOlInteractions","olLinearRingsLayer","olOuterGeometry","olOverlaySource","olLinearRingsSource","modify","createOlLinearRingsLayer","removeOlModifyInteraction","removeOlTranslateInteraction","removeOlDrawInteraction","addOlDrawInteraction","addOlTranslateInteraction","activateTranslateInteraction","addOlModifyInteraction","activateModifyInteraction","setOlGeometry","addOlLinearRingsLayer","removeOlLinearRingsLayer","clearOlLinearRingsSource","drawStyle","deactivateModifyInteraction","onModifyStart","onModifyEnd","subscribeToKeyDown","unsubscribeToKeyDown","OlTranslate","deactivateTranslateInteraction","onTranslateStart","onTranslateEnd","getOlGeometry","intersectsCoordinate","subscribeToDrawKeyDown","unsubscribeToDrawKeyDown","subscribeToDrawKeyUp","activateDrawInteraction","unsubscribeToDrawKeyUp","deactivateDrawInteraction","linearRingCoordinates","getLinearRing","addLinearRingToOlGeometry","_linearRingCoordinates","updateLinearRingOfOlGeometry","addLinearRingToOlPolygon","olPolygon","olLinearRing","appendLinearRing","OlLinearRing","newCoordinates","getLinearRings","measureLengthUnit","measureAreaUnit","perimeter","MeasurerDialogComponent","onNoClick","MeasurerDialogComponent_table_4_Template","MeasurerDialogComponent_table_5_Template","onToggleDisplayLines","displayLines","onToggleDisplayDistance","displayDistance","onToggleDisplayAreas","displayAreas","onLengthUnitChange","measureType","measure_r17","measureUnitsAuto","activeMeasureType","onAreaUnitChange","MeasurerComponent_ng_container_29_igo_measurer_item_1_Template","MeasurerComponent_ng_container_29_igo_measurer_item_2_Template","_r27","onCalculateClick","onDeleteClick","MeasurerComponent","tableTemplate","hasLine$","hasArea$","measure$","showTooltips","drawControlIsDisabled","drawLineControl","drawPolygonControl","modifyControl","activeOlGeometry","activeLengthUnit","activeAreaUnit","onFeatureAddedKey","onFeatureRemovedKey","activeDrawControl","drawStart$$","drawEnd$$","drawChanges$$","modifyStart$$","modifyEnd$$","modifyChanges$$","selectedFeatures$$","olDrawSource","setActiveMeasureType","_activeMeasureType","minSegmentLength","table","drawControlIsActive","createDrawLineControl","createDrawPolygonControl","createModifyControl","toggleDrawControl","updateTooltipsOfOlSource","checkDistanceAreaToggle","deactivateModifyControl","freezeStore","onMeasureTypeChange","onToggleDrawControl","deactivateDrawControl","onToggleMeasureUnitsAuto","onDisplayDistance","onDisplayLines","onDisplayAreas","updateTooltipsOfOlGeometry","sum","openDialog","selectedFeature","drawingLayerFeature","onModifyClick","_olFeature","activateModifyControl","clearTooltipsOfOlGeometry","many","updateMeasureOfOlGeometry","objectsExists","objectExist","OlStyle","activateDrawControl","drawControl","onDrawChanges","clearMeasures","clearTooltipsOfOlSource","finalizeMeasureOfOlGeometry","addFeatureToStore","onModifyChanges","_measure","featureId","OlGeoJSON","olMidpointsTooltips","updateOlTooltipsAtMidpoints","typeGeom","updateOlTooltip","updateOlTooltipAtCenter","updateOlGeometryCenter","centerCoordinate","olGetCenter","showTooltipsOfOlGeometry","shouldShowTooltip","addOverlay","forEachFeature","showTooltipsOfOlSource","_unit","_type","computeTooltipInnerHTML","MeasurerComponent_mat_divider_13_Template","MeasurerComponent_mat_slide_toggle_15_Template","MeasurerComponent_mat_divider_17_Template","MeasurerComponent_mat_slide_toggle_20_Template","MeasurerComponent_mat_slide_toggle_22_Template","MeasurerComponent_mat_divider_24_Template","MeasurerComponent_ng_container_29_Template","MeasurerComponent_mat_divider_31_Template","MeasurerComponent_button_35_Template","MeasurerComponent_button_38_Template","MeasureFormatPipe","onDrawControlChange","onfreehandControlChange","freehandDrawIsActive","measureUnit_r15","SpatialFilterItemComponent_div_7_mat_option_7_Template","measureUnit_r19","SpatialFilterItemComponent_div_8_mat_option_7_Template","radiusFormControl","onItemTypeChange","item_r23","selectedThematics","node_r35","onToggleChange","node_r39","childrensToggle","treeControl","isExpanded","hasChildrenSelected","SpatialFilterItemComponent_div_14_mat_header_cell_3_Template","SpatialFilterItemComponent_div_14_mat_header_cell_5_Template","SpatialFilterItemComponent_div_14_mat_header_row_6_Template","SpatialFilterItemComponent_div_14_mat_row_7_Template","SpatialFilterItemComponent_div_14_mat_tree_node_9_Template","SpatialFilterItemComponent_div_14_mat_nested_tree_node_10_Template","hasChild","clearSearch","disabledClearSearch","ctx_r45","clearDrawZone","_r48","ctx_r47","toggleVisibleList","SpatialFilterItemComponent_div_28_button_1_Template","entityChange","listIsVisible","SpatialFilterItemComponent","geometryTypes","drawGuide$","drawStyle$","PointStyle","overlayStyle","PolyStyle","overlayStyle$","allLayers","thematicLength","_thematicLength","toggleSearch","itemTypeChange","thematicChange","drawZoneEvent","bufferEvent","radiusEvent","freehandControl","predefinedRadius","clearButtonEvent","clearSearchEvent","export","openWorkspace","selectedItemType","selectedSourceAddress","NestedTreeControl","childrens","thematics","MatTreeNestedDataSource","value$","value$$","radiusChanges$$","bufferChanges$$","geometryTypeField","drawGuideField","drawGuide","drawGuidePlaceholder","drawZone","limits","child","selectedRecordStrategy","selectionStrategy","detach","isPolygon","isPoint","isPredefined","collapse","expand","numSelected","numNodes","bool","selectedThematicsName","nodeSelected","toggleSearchButton","createTableTemplate","clearButton","disableSearchButton","formValue","typeColumn","nameColumn","SpatialFilterItemComponent_mat_slide_toggle_5_Template","SpatialFilterItemComponent_mat_slide_toggle_6_Template","SpatialFilterItemComponent_div_7_Template","SpatialFilterItemComponent_div_8_Template","SpatialFilterItemComponent_mat_radio_button_13_Template","SpatialFilterItemComponent_div_14_Template","SpatialFilterItemComponent_button_16_Template","SpatialFilterItemComponent_button_17_Template","SpatialFilterItemComponent_button_27_Template","SpatialFilterItemComponent_div_28_Template","sliderMode","modeChange","changePropertyByPass","beginValue","restrictedToStep","endValue","yearOnlyInputChange","yearSelected","onlyYearBegin","filterStateDisable","calendarView","handleDate","onlyYearEnd","hour_r27","minute_r28","changeTemporalProperty","OgcFilterTimeComponent_div_3_div_2_div_10_mat_option_6_Template","OgcFilterTimeComponent_div_3_div_2_div_10_mat_option_12_Template","beginHourFormControl","beginHours","beginMinuteFormControl","beginMinutes","hour_r37","minute_r38","OgcFilterTimeComponent_div_3_div_2_div_11_div_9_mat_option_6_Template","OgcFilterTimeComponent_div_3_div_2_div_11_div_9_mat_option_12_Template","endHourFormControl","endHours","endMinuteFormControl","endMinutes","_r43","monthSelected","OgcFilterTimeComponent_div_3_div_2_div_11_div_9_Template","filterEndFunction","calendarType","OgcFilterTimeComponent_div_3_div_2_div_10_Template","OgcFilterTimeComponent_div_3_div_2_div_11_Template","ctx_r51","filterBeginFunction","OgcFilterTimeComponent_div_3_div_1_Template","OgcFilterTimeComponent_div_3_div_2_Template","calendarTypeYear","OgcFilterTimeComponent","ogcFilterTimeService","_beginValue","_endValue","_defaultMin","_defaultMax","_defaultDisplayFormat","_defaultSliderModeEnabled","endDatepickerTime","beginDatepickerTime","beginTime","endTime","stepMilliseconds","sliderInterval","displayFormat","parseFilter","handleMin","handleMax","getUTCFullYear","isCalendarYearMode","setFilterStateDisable","updateHoursMinutesArray","updateValues","dateFilter","intervalInt","_now","endOf","getDateFromStringWithoutTime","valueTmp","getDateTime","dateStringFromYearNotime","toISOString","datePicker","dateValue","monthDiff","dateValuePlus1","monthDiffPlus1","asYears","asMonths","weekDiff","weekDiffPlus1","asWeeks","dayDiff","_mod","asDays","hourDiff","asHours","valuetmp","valuetmp2","handleMinuteIncrement","handleHourIncrement","fullBeginHoursArray","checkEndValue","fullEndHoursArray","fullBeginMinutesArray","fullEndMinutesArray","beginTmp","endTmp","restrictToStep","stringDate","dateItems","minDefaultDate","maxDefaultDate","minDefaultISOString","maxDefaultISOString","filterOriginConfig","toLocaleDateString","OgcFilterTimeComponent_mat_slide_toggle_1_Template","OgcFilterTimeComponent_div_2_Template","OgcFilterTimeComponent_div_3_Template","OgcFilterTimeSliderComponent","slider","sliderValue","calculatedStep","_defaultSliderInterval","beginMillisecond","maxMillisecond","sliderDisplayWith","calculateStep","handleSliderInput","dateTmp","toAdd","_emitInputEvent","matSliderChange","dateBeginTmp","dateEndTmp","startOf","GeometryFormFieldInputComponent","olGeoJSON","defaultDrawStyleRadius","olGeometryEnds$$","olGeometryChanges$$","createMeasureTooltip","activeControl","_geometryType","deactivateControl","createDrawControl","toggleControl","_drawControlIsActive","_freehandDrawIsActive","_predefinedRadius","controlOptions","_drawStyle","olGuideStyle","getGuideStyleFromDrawStyle","_overlayStyle","addGeoJSONToOverlay","olModify","features_","addOlOverlayLayer","onTouched","updateDrawStyleWithDrawGuide","activateControl","onOlGeometryEnds","onOlGeometryChanges","removeMeasureTooltip","updateMeasureTooltip","circleToPoint","lastIndex","lastLength","olLastMidpoint","innerHtml","guideStyle","GeometryFormFieldInputComponent_ng_template_0_Template","IgoFilterModule","MAT_DATE_LOCALE","MatTabsModule","MatTreeModule","MatOptionModule","MatNativeDateModule","MatDatetimepickerModule","MatNativeDatetimeModule","i17","i18","i19","i20","i21","i22","i23","i24","i25","i26","i27","i28","i29","IgoImportExportModule","IgoMapModule","measureUnit_r1","MeasurerItemComponent","measure$$","auto","toggleAutoUnit","_auto","computeBestMeasureUnit","computeBestAreaUnit","converted","possibleUnits","computeBestLengthUnit","MeasurerItemComponent_mat_option_8_Template","IgoMeasurerModule","IgoMeasureModule","IgoPrintModule","querySearchSourceFactory","IgoQueryModule","DirectionsSource","DirectionsSourceService","directionsSourceServiceFactory","provideDirectionsSourceService","IgoDirectionsModule","DragDropModule","sourceCanSearch","sourceCanReverseSearch","reverseSearch","sourceCanReverseSearchAsSummary","findDiff","str1","str2","computeTermSimilarity","caseSensitive","termFrom","termTo","totalDiff","delta","SearchSourceService","getSources","getEnabledSources","enableSourcesByType","SearchService","searchSourceService","termIsValid","distance","getEnabledOnly","searchType","asPointerSummary","reverseSourceFonction","reverseSearchCoordsFormat","reverseSearchSources","searchSourceServiceFactory","IChercheSearchResultFormatter","formatResult","IgoHttpParameterCodec","encodeKey","encodeValue","decodeKey","decodeValue","IChercheSearchSource","formatter","title$","hashtagsLieuxToKeep","getAllowedTypes","ecmax","showAdvancedParams","Boolean","computeRequestParams","getSearch","extractResults","typeSetting","typesMatched","computeOptionsParam","q","computeTerm","xMin","yMin","xMax","yMax","encoder","dataToResult","computeProperties","dataType","titleHtml","highlight","title2","title3","score","nextPage","propertiesBlacklist","googleLinksProperties","GoogleMaps","googleMaps","googleMapsNom","pointOnFeature","municipalite","GoogleStreetView","routing","keep","h","cacheHasher","IChercheReverseSearchSource","getReverseSearch","getSubtitle","computeExtent","subtitleHtml","pointerSummaryTitle","defaultIChercheSearchResultFormatterFactory","ichercheSearchSourceFactory","provideIChercheSearchSource","ichercheReverseSearchSourceFactory","provideIChercheReverseSearchSource","CoordinatesSearchResultFormatter","CoordinatesReverseSearchSource","reverseSearchCoordsFormatEnabled","dataDMS","lonLatConversion","rawCoord3857","convertedLonLat","igo2CoordFormat","utmZoneFromLonLat","utmName","rawCoordUtm","mtmZoneFromLonLat","long","mtmName","rawCoordMtm","rawCoord","numericEpsgCode","roundedCoordString","roundedCoordStringDMS","circleGeometry","polygonGeometry","writer","writeGeometry","OpenStreetMap","defaultCoordinatesSearchResultFormatterFactory","CoordinatesReverseSearchSourceFactory","_projectionService","provideCoordinatesReverseSearchSource","LayerListBindingDirective","layersOrResolutionChange$$","layersVisibility$$","setLayersVisibilityStatus","visibles","allLayersAreVisible","toggleTrackFeature","TrackFeatureButtonComponent","TrackFeatureButtonComponent_button_0_Template","ILayerSearchResultFormatter","allowedKey","dataR","ILayerSearchSource","computeSearchRequestParams","computeLayerOptions","groupTitle","extractQueryParamsFromSourceUrl","formatOpt","urls","urlOpt","ilayerSearchResultFormatterFactory","ilayerSearchSourceFactory","provideILayerSearchSource","IgoSearchSelectorModule","IgoSearchSettingsModule","IgoSearchBarModule","IgoSearchResultsModule","IgoSearchModule","OgcFilterComponent","OgcFilterWidget","ogcFilterWidgetFactory","provideOgcFilterWidget","IgoOgcFilterModule","IgoWorkspaceUpdatorModule","IgoConfirmationPopupModule","IgoGeoWorkspaceModule","StyleListService","styleList","getStyleList","baseStyleList","styleListResponse","STYLELIST_OPTIONS","provideStyleListOptions","styleListFactory","styleListService","IgoStyleListModule","FontType","Arial","ArialBlack","Verdana","Tahoma","TrebuchetMS","Impact","TimesNewRoman","Georgia","AmericanTypewriter","Courier","LucidaConsole","BrushScriptMT","ComicSansMS","DrawStyleService","labelsAreShown","fontSize","fontStyle","getFillColor","setFillColor","getStrokeColor","setStrokeColor","getStrokeWidth","getLabelsAreShown","toggleLabelsAreShown","setIcon","getIcon","getFontSize","setFontSize","getFontStyle","setFontStyle","getOffsetX","setOffsetX","getOffsetY","setOffsetY","createIndividualElementStyle","fontSizeAndStyle","labelsAreOffset","textToShow","textIgoStyleObject","flatCoordinates","IgoStyleModule","FeatureDetailsDirective","feature$","routingEvent","setFeature","bindClicking","routeElement","addEventListener","IgoOverlayModule","DownloadService","DSOptions","currentProj","outputFormatDownload","baseurl","openDownload","DownloadButtonComponent","downloadService","DownloadButtonComponent_button_0_Template","GeometryType","LineString","Circle","LabelType","Coordinates","Custom","CoordinatesUnit","DecimalDegree","DegreesMinutesSeconds","DrawIconService","icons","getIconsList","getIcons","getPath","createInteractionStyle","Olstyle","DDtoDMS","onLabelTypeChange","option_r8","optionAvailable","getProperLengthLabel","DrawPopupComponent_ng_container_3_mat_radio_group_14_mat_radio_button_1_Template","arrayBuiltInType","option_r12","DrawPopupComponent_ng_container_3_ng_container_15_mat_checkbox_1_Template","unit_r17","onChangeCoordinateUnit","DrawPopupComponent_ng_container_3_div_16_mat_option_8_Template","currentCoordinates","coordinatesMeasureUnit","allCoordinatesUnits","unit_r22","getLengthUnitEnum","onChangeLengthUnit","DrawPopupComponent_ng_container_3_div_17_mat_option_8_Template","lengthLabelT","currentLength","lengthMeasureUnit","allLengthUnits","unit_r27","getAreaUnitEnum","onChangeAreaUnit","DrawPopupComponent_ng_container_3_div_18_mat_option_10_Template","currentArea","areaMeasureUnit","allAreaUnits","DrawPopupComponent_ng_container_3_mat_radio_group_14_Template","DrawPopupComponent_ng_container_3_ng_container_15_Template","DrawPopupComponent_ng_container_3_div_16_Template","DrawPopupComponent_ng_container_3_div_17_Template","DrawPopupComponent_ng_container_3_div_18_Template","cancelDrawing","confirm","customOrPredefined","labelType","labelFlag","polygonCheck","noLabelButton","getLabelLength","currentLabel","DrawPopupComponent","confirmFlag","lengthInMeters","areaInMetersSquare","coordinatesInDD","currentCoordinatesUnit","longlatDD","labelLength","longitudeLatitude","longitude","latitude","point4326","circularPolygon","buildArrayType","input","lengthUnit","areaUnit","coordinatesUnit","selectOptions","currentOption","getLength","DrawPopupComponent_ng_container_3_Template","DrawPopupComponent_ng_container_4_Template","DrawShorcutsComponent","openPicker","getFeatureFillColor","fontSelect_r9","StyleModalDrawingComponent","drawStyleService","styleModalData","linestringOnly","buildStyleData","drawingStyle","allFontStyles","getFeatureFontSize","getFeatureFontStyle","getFeatureStrokeColor","getFeatureOffsetX","getFeatureOffsetY","StyleModalDrawingComponent_ng_container_6_Template","StyleModalDrawingComponent_mat_option_27_Template","DrawLayerPopupComponent","labelString","onToggleFreehandMode","freehandMode","measureUnit_r12","DrawComponent_div_23_mat_option_7_Template","layer_r15","activeDrawingLayer","deleteDrawings","icon_html_r22","onIconChange","DrawComponent_mat_form_field_44_div_6_Template","DrawComponent_mat_form_field_44_mat_option_10_Template","openStyleModalDialog","DrawComponent","drawIconService","_stores","drawControls","_drawControls","_activeDrawingLayer","activeLayerChange","drawControlsEvent","layersIDEvent","activeStore","layerCounterID","draw$","activeDrawingLayerSource","drawSelect$$","strokeForm","radiusFormControlChange$$","Subscription","numberOfDrawings","isCreatingNewLayer","currGeometryType","draw","editLabelDrawing","dc","onLayerChange","changeRadius","newTitle","isNewLayer","autoFocus","onFontChange","onColorChange","onOffsetLabelChange","openDrawDialog","isDrawEnd","updateLabelOfOlGeometry","updateLabelType","updateMeasureUnit","updateFontSizeAndStyle","updateFillAndStrokeColor","updateOffset","onSelectDraw","updateHeightTable","clearLabelsOfOlGeometry","onModifyDraw","longLat","radiusLabel","olGeometryLength","lengthLabel","circleArea","areaLabel","olGeometryArea","replaceFeatureInStore","labelTypeAndUnit","olGeometryCoordinates","entityCoordinates","rad","center4326","lon4326","lat4326","extent4326","getDistance","setupLayer","onToggleLabels","selectionChange","olGeometryFeature","openShorcutsDialog","elementStyle","toggleIsChecked","isCircle","numberId","isAnIcon","onGeometryTypeChange","_label","fontStyle_","fillColor_","strokeColor_","offsetX_","offsetY_","typeOfLabel","labelType_","measureUnit_","updateActiveLayer","isLineString","radiusMeters","pointStyle","selectedMeasureUnit","DrawComponent_mat_slide_toggle_22_Template","DrawComponent_div_23_Template","DrawComponent_mat_option_32_Template","DrawComponent_button_36_Template","DrawComponent_button_39_Template","DrawComponent_mat_form_field_44_Template","DrawComponent_button_49_Template","OgcFilterableListBindingDirective","GeometryFormFieldComponent","geometryType$","GeometryFormFieldComponent_div_3_Template","GeometryFormFieldComponent_mat_form_field_4_Template","ImportError","ImportInvalidFileError","setPrototypeOf","ImportUnreadableFileError","ImportNothingToImportError","ImportSizeError","ImportSRSError","ImportOgreServerError","padTo2Digits","padStart","handleFileImportSuccess","file","confirmDialogService","handleNothingToImportError","computeLayerTitleFromFile","dformat","getDate","addLayerAndFeaturesStyledToMap","imposedSourceOptions","imposedLayerOptions","addLayerAndFeaturesToMap","randomStyle","searchIndexEnabled","handleInvalidFileImportError","handleUnreadbleFileImportError","handleSizeFileImportError","sizeMb","handleSRSImportError","handleOgreServerImportError","getFileExtension","ImportService","GeoJSON","GML","GPX","KML","Shapefile","ogreUrl","clientSideFileSizeMax","importConfig","clientSideFileSizeMaxMb","formats","allowedExtensions","formatExtensionAssociation","import","importAsync","getFileImporter","extension","zipMimeTypes","allowedZipMimeTypes","allowedMimeTypes","importFile","importFileWithOgre","importer","parseFeaturesFromFile","readAsText","FormData","append","parseFeaturesFromGeoJSON","errMsg","msg","writeFeatureObject","ExportFormat","EncodingFormat","ExportError","ExportInvalidFileError","ExportNothingToExportError","ExportService","CSVcomma","CSVsemicolon","aggregateInComment","gpxAggregateInComment","encoding","exportOlFeatures","generateFeature","exportAsync","excludePrefix","generateAggregatedFeature","comment","nothingToExport","ogreFormats","noOgreFallbacks","exportToFile","exportWithOgre","encodingType","featuresText","UTF8","acceptCharset","enctype","LATIN1","featuresJson","encodedProperties","geojsonField","outputNameField","outputName","ogreFormat","outputFormatField","submit","CustomHtmlComponent","_html","projection_r6","translateKey","ImportExportComponent_form_8_mat_option_7_p_1_Template","ImportExportComponent_form_8_mat_option_7_p_2_Template","inputProj","ImportExportComponent_form_8_mat_option_7_Template","importFiles","files","importForm","projections$","invalid","loading$","fileSizeMb","importHtmlClarifications","ImportExportComponent_section_9_div_1_Template","ImportExportComponent_section_9_igo_custom_html_2_Template","layer_r29","onlySelectedClick","inLayersIdToExportSelectionOnly","onlySelected","ImportExportComponent_form_12_mat_option_10_mat_slide_toggle_4_Template","layerHasSelectedFeatures","format_r40","ImportExportComponent_form_12_ng_container_18_mat_option_1_Template","formats$","encoding_r43","ImportExportComponent_form_12_div_23_ng_container_6_mat_option_1_Template","encodings$","ImportExportComponent_form_12_div_23_ng_container_6_Template","exportHtmlClarifications","ImportExportComponent_form_12_span_9_Template","ImportExportComponent_form_12_mat_option_10_Template","ImportExportComponent_form_12_ng_container_18_Template","ImportExportComponent_form_12_mat_option_20_Template","ImportExportComponent_form_12_div_22_Template","ImportExportComponent_form_12_div_23_Template","ImportExportComponent_form_12_div_24_Template","ImportExportComponent_form_12_div_25_Template","ImportExportComponent_form_12_div_26_Template","handleExportFormSubmit","ImportExportComponent_form_12_igo_custom_html_36_Template","getLayerTitleById","exportableLayers$","forceNaming","combineLayers","ImportExportComponent","importService","exportService","controlFormat","exportableLayers$$","formats$$","encodings$$","formLayer$$","exportOptions$$","espgCodeRegex","projectionsConstraints","popupChecked","previousLayerSpecs$","selectFirstProj","_projectionsLimitations","computeProjections","selectedMode","selectMode","exportOptions$","exportOptionsChange","popupAllowed","loadConfig","configFileSizeMb","exportOptions","computeFormats","handlePopup","handlePreviousLayerSpecs","selectedLayers","previousSpecs","encodings","configProjection","getWorkspaceByLayerId","wksFromLayerId","wksFromLayer","layersWithSelection","specs","onFileImportSuccess","onFileImportError","preCheck","p2","closed","onPopupBlockedError","geomTypesCSV","featuresCSV","filename","layerIndex","dSOptions","wks","featureInMapExtent","geomTypes","featureGeomType","currentGeomType","geomType","circular","gpxFeatureCnt","previousFeature","currentFeature","titleEmptyRows","createTitleEmptyRows","onFileExportError","onFileExportSuccess","titleRow","headerRow","emptyRow","previousFeatureKeys","firstKeyPrevious","currentFeatureKeys","firstKeyCurrent","previousKey","firstKeyAll","sameKeys","unset","importExportOptions","allowToStoreLayer","importWithStyle","handleFileImportError","extraMessage","handleFileExportError","handleNothingToExportError","loadEncodings","encodingDefaultValue","appliedformats","formatsType","onlyUrl","onlyVector","vectorAndUrl","customList","allowedFormats","validateListFormat","configImportExportFormats","validatedListFormat","commonFormats","layersWithCustomFormats","previousCustomListFormats","finalFormats","modeChanged","handleFileExportSuccess","onImportExportChange","ImportExportComponent_form_8_Template","ImportExportComponent_section_9_Template","ImportExportComponent_section_10_Template","ImportExportComponent_form_12_Template","ExportButtonComponent","layerIsExportable","workspaceId","ExportButtonComponent_button_0_Template","ZoomButtonComponent","getMinZoom","getMaxZoom","onGeolocationClick","GeolocateButtonComponent","tracking$$","ngAfterContentInit","GeolocateButtonComponent_div_0_Template","HomeExtentButtonComponent","extentOverride","centerOverride","zoomOverride","homeExtentButtonExtent","homeExtentButtonCenter","homeExtentButtonZoom","computeHomeExtent","WakeLockButtonComponent","noSleep","NoSleep","satisfies","ie","edge","chrome","firefox","opera","safari","disableWakeLock","enableWakeLock","toggleWakeLock","rotated$","azimuthRounded","rotationRounded","currentStyle$","RotationButtonComponent","showIfNoRotation","radians","deg","bearingToAzimuth","RotationButtonComponent_div_0_Template","OverlayAction","ZoomIfOutMapExtent","OverlayService","features$","OverlayDirective","overlayService","features$$","olFormatGeoJSON","handleFeatures","jsGeoPdfPlugin","jsPDFAPI","setGeoArea","pdfExt","geoExt","minx","maxx","maxy","miny","bounds","bbox_obj","internal","newAdditionalObject","bounds_obj","proj_obj","objId","title_obj","bbox_id","write","PrintOutputFormat","PrintPaperFormat","PrintOrientation","PrintResolution","PrintSaveImageFormat","PrintLegendPosition","PrintService","zipFile","nbFileToProcess","imgSizeAdded","TEXTPDFFONT","titleFont","titleFontStyle","subtitleFont","subtitleFontStyle","commentFont","commentFontStyle","commentFontSize","print","paperFormat","legendPostion","legendPosition","GeoPdfPlugin","jsPDF","API","dimensions","margins","titleSizes","subtitleSizes","A1","A0","fontSizeInPt","getTextPdfObjectSizeAndMarg","addTextInPdfDoc","marginLeft","showProjection","showScale","addProjScale","addComment","addMap","handleMeasureLayer","addGeoRef","addLegendSamePage","addLegend","saveDoc","docHeight","getHeight","pdf_extents","pdf_units2points","canvasOverlayHTMLMeasures","mapOverlayMeasuresHTML","getOverlayContainer","html2canvas","addCanvas","getLayersLegendHtml","legends","getLayersLegends","legendUrls","images$","getDataImage","rxMap","dataImage","htmlImg","dataImages","getLayersLegendImage","doZipFile","canvas","useCORS","removeHtmlElement","generateCanvaFileToZip","saveCanvasImageAsFile","pageWidth","setFont","textMarginLeft","textDimensions","getTextDimensions","w","commentMarginLeft","commentMarginBottom","textToAdd","textFont","textFontStyle","textFontSize","textMarginTop","isComment","splitTextToSize","heightPixels","textProjScale","_this4","imageSize","pourcentageReduction","imgData","addPage","toDataURL","addImage","_this5","marginsLegend","defineNbFileToProcess","ms","getImageSizeToFitPdf","rect","docSize","_this6","mapSize","viewResolution","dimensionPixels","setMapResolution","_ref2","mapCanvas","getViewport","mapResultCanvas","drawMap","resetOriginalMapSize","drawMapControls","mapStatus$$","mapStatus","_x2","initialSize","widthPixels","scaling","setResolution","updateSize","renderSync","_this7","handleCanvas","mapContextResult","getContext","parentElement","globalAlpha","matrix","CanvasRenderingContext2D","setTransform","fillStyle","fillRect","drawImage","_this8","mapOverlayHTML","getOverlayContainerStopEvent","cloneNode","addNorthDirection","addAttribution","canvasOverlayHTML","allowTaint","northDirection","HTMLButton","HTMLattribution","downloadMapImage","printResolution","_this9","initialMapSize","_ref3","addLegendToImage","newCanvas","newContext","positionHCanvas","commentWidth","measureText","positionHProjScale","commentNbLine","positionHComment","fillText","projectionScaleText","CommentLengthToCut","positionLastBlank","commentCurrentLine","positionFirstCutChar","fileNameWithExt","tfwFileNameWithExt","tiwContent","getWorldFileInformation","addFileToZip","saveAs","saveFileProcessing","_x3","setMapImageResolution","scaleFactor","newMapSize","_this10","canvasLegend","canvasHeight","canvasWidth","legendHeight","legendWidth","legendX","legendY","strokeRect","renderMap","save","returnPromise","pageHeight","canHeight","canWidth","heightRatio","widthRatio","maxRatio","currentResolution","nameWithExt","blobFormat","toBlob","JSZip","msSaveBlob","msToBlob","getZipFile","generateAsync","maxLength","legendPosition_r9","PrintFormComponent_mat_option_43_ng_container_1_Template","PrintFormComponent_mat_option_43_ng_container_2_Template","outputFormat_r13","paperFormat_r14","imageFormat_r15","resolution_r16","orientation_r17","PrintFormComponent","outputFormats","paperFormats","orientations","imageFormats","legendPositions","isPrintService","imageFormat","imageFormatField","Jpeg","onlySelf","Pdf","paperFormatField","Letter","orientationField","landscape","resolutionField","legendPositionField","none","titleField","subtitleField","commentField","showProjectionField","showScaleField","showLegendField","doZipFileField","minLength","handleFormSubmit","toggleImageSaveProp","clearValidators","changeCommentLength","A2","A3","A4","A5","PrintFormComponent_mat_error_8_Template","PrintFormComponent_mat_error_16_Template","PrintFormComponent_mat_error_24_Template","PrintFormComponent_mat_option_43_Template","PrintFormComponent_mat_option_52_Template","PrintFormComponent_mat_option_61_Template","PrintFormComponent_mat_option_70_Template","PrintFormComponent_mat_option_79_Template","PrintFormComponent_mat_option_88_Template","maxlength","PrintComponent","printService","_outputFormat","_paperFormat","_orientation","_imageFormat","_legendPosition","_resolution","DirectionsFormat","SourceDirectionsType","Trip","ProposalType","Coord","Text","DirectionType","Stop","Vertex","DirectionRelativePositionType","Start","Intermediate","End","updateStoreSorting","stopsStore","computeRelativePosition","totalLength","relativePosition","addStopToStore","stops","positions","stop","maxPosition","insertPosition","stopToUpdate","directionsStyle","vertexStyle","stopStyle","routeStyle","formatDistance","formatDuration","formatInstruction","modifier","stepPosition","exit","lastStep","directive","cssClass","translatedDirection","translateBearing","bearing","translatedModifier","translateModifier","aggregatedDirection","coma","cntSuffix","instruction","DirectionsService","directionsSourceService","directionsOptions","routeSource","downloadDirection","align","addInstructions","setPageHeaderFooter","setHTMLTableContent","directionsInstruction","tblBody","cellImage","cellText","img","span","spanDistance","verticalAlign","matListItem","iconsArray","iconName","iconCanvas","formattedDirection","maneuver","bearing_after","HTMLtable","autoTable","startY","titlePosition","margin","columnStyles","cellWidth","theme","didDrawCell","cell","section","raw","pageCount","getNumberOfPages","now","logo","setPage","baseline","getCurrentPageInfo","pageNumber","DOCUMENT","StopsStore","storeInitialized$","clearStops","StopsFeatureStore","RoutesFeatureStore","StepFeatureStore","stop_r1","clearStop","result_r12","DirectionsInputsComponent_div_1_mat_optgroup_9_mat_option_1_Template","source_r10","removeStop","DirectionsInputsComponent_div_1_div_10_button_4_Template","onStopEnter","onStopLeave","stopIsDragged","onInputFocus","setStopText","DirectionsInputsComponent_div_1_button_6_Template","chooseProposal","DirectionsInputsComponent_div_1_mat_optgroup_9_Template","DirectionsInputsComponent_div_1_div_10_Template","getNgClass","getPlaceholder","stopWithHover","getOptionText","searchProposals","DirectionsInputsComponent","invalidKeys","onMapClickEventKeys","stopsFeatureStore","coordRoundedDecimals","stopInputHasFocus","unlistenMapSingleClick","geomCoord","validateTerm","keyIsValid","extra","removeStopFromStore","computeStopsPosition","stopsToComputePosition","drop","moveStops","previousIndex","currentIndex","fromIndex","moveItemInArray","listenMapSingleClick","roundedCoord","olProj","olObservable","DirectionsInputsComponent_div_1_Template","resetStops","zoomRoute","copyDirectionsToClipboard","copyLinkToClipboard","printDirections","DirectionsButtonsComponent","directionsService","activeRoute","routesFeatureStore","zoomToActiveRoute$","stepFeatureStore","addStop","directionsBody","directionsToText","indent","activeRouteDirective","wayPointList","wayPointsCnt","stopText","localCnt","formatStep","routingOptions","directionsKey","stopsCoordinates","directionsUrl","pathname","DirectionsButtonsComponent_button_4_Template","DirectionsButtonsComponent_button_7_Template","DirectionsButtonsComponent_button_9_Template","DirectionsButtonsComponent_button_11_Template","DirectionsButtonsComponent_button_13_Template","direction_r5","cnt_r6","changeRoute","activeDirection","DirectionsResultsComponent_div_0_mat_form_field_1_mat_option_6_Template","directions","step_r10","showSegment","cnt_r11","DirectionsResultsComponent_div_0_mat_form_field_1_Template","DirectionsResultsComponent_div_0_mat_divider_2_Template","onStepsListBlur","DirectionsResultsComponent_div_0_mat_list_item_8_Template","DirectionsResultsComponent","activeFeatureWithDirection","showRouteSegmentGeometry","vertexId","lastPoint","olGeom","geojsonGeom","previousVertex","DirectionsResultsComponent_div_0_Template","DirectionsComponent","searchService","zoomRoute$$","storeEmpty$$","storeChange$$","routesQueries$$","selectStopInteraction","translateStop","selectedRoute","focusOnStop","isTranslating","previousStops","searchs$$","directionControlIsActive","initEntityStores","initStopsFeatureStore","loadingStrategy","initRoutesFeatureStore","initStepFeatureStore","initOlInteraction","u","freezeStores","interaction","monitorEmptyEntityStore","monitorEntityStoreChange","monitorActiveRouteZoom","routeExtent","executeStopTranslation","olCondition","selectCoordinates","addedStop","onStopInputHasFocusChange","translatedStopId","translationCoordinates","translatedStop","handleStopDiff","handleStopsFeature","getRoutes","cancelSearch","simplifiedStops","stopIdToProcess","changedStop","researches","isCoord","requests$","sp","storedSource","addStopOverlay","stopFeature","isOverview","stopsWithCoordinates","roundedCoordinates","routeResponse","overview","alternatives","continue_straight","addDirectionToRoutesFeatureStore","previousRoute","routeFeatureStore","addStopToStopsFeatureStore","stopColor","previousStop","stopFeatureStore","stopOpacity","onToggleDirectionsControl","OsrmDirectionsSource","_name","directionsParams","getRouteParams","getRoute","extractRoutesData","formatRoute","waypoints","geometries","roadNetworkRoute","stepsUI","legs","sourceType","weight_name","osrmDirectionsSourcesFactory","provideOsrmDirectionsSource","SEARCH_TYPES","SearchPointerSummaryDirective","pointerSearchStore","reverseSearch$$","hasPointerReverseSearchSource","searchPointerSummaryFeatureId","igoSearchPointerSummaryDelay","igoSearchPointerSummaryEnabled","mouseleave","ngAfterContentChecked","unsubscribeReverseSearch","entitiesToPointerOverlay","computeSummaryClosestFeature","closestResultByType","summarizedClosestType","processedSummarizedClosestType","typeIndex","addPointerOverlay","onSearchCoordinate","sortByOrder","r1","r2","_results","onSearch","research","newResults","pointerSummary","CadastreSearchSource","endsWith","getCadastre","numero","lot","computeGeometry","NoLot","cadastreSearchSourceFactory","provideCadastreSearchSource","NominatimSearchSource","place_id","display_name","osm_type","boundingbox","computeTermTags","tag","computeTermSettings","nominatimSearchSourceFactory","provideNominatimSearchSource","StoredQueriesSearchSource","resultTitle","storedQueriesOptions","multipleFieldsQuery","defaultResultTitle","storedquery_id","splitPrefix","outputformat","srsname","storedqueriesParams","termSplitter","resultArray","extractWFSData","idxEnd","resultTotLenght","patternGml3","geojson","wfsfeatures","splittedTerm","remainingTerm","splitterRegex","wfsversion","StoredQueriesReverseSearchSource","longField","latField","longLatParams","doc_type","storedqueriesSearchSourceFactory","provideStoredQueriesSearchSource","storedqueriesReverseSearchSourceFactory","provideStoredQueriesReverseSearchSource","WorkspaceSearchSource","limitValue","fswi","termToUse","gettedIndex","sortedResultToProcess","resultsCnt","subtitleHtml2","workspaceSearchSourceFactory","provideWorkspaceSearchSource","searchType_r2","getSearchTypeTitle","SearchSelectorComponent","searchType$","searchType$$","searchTypes","setSearchType","searchTypeChange","onSetSearchType","onSearchTypeChange","SearchSelectorComponent_mat_radio_button_8_Template","checkUncheckAllSources","searchSourcesAllEnabled","source_r6","settingValue_r18","setting_r13","settingsValueCheckedRadioButton","getAvailableHashtagsValues","SearchSettingsComponent_ng_container_7_ng_container_7_span_6_mat_radio_button_2_Template","checkUncheckAll","allEnabled","settingValue_r32","settingsValueCheckedCheckbox","displayBlock","SearchSettingsComponent_ng_container_7_ng_container_7_span_7_div_1_Template","SearchSettingsComponent_ng_container_7_ng_container_7_span_7_mat_checkbox_3_Template","getAvailableValues","SearchSettingsComponent_ng_container_7_ng_container_7_span_6_Template","SearchSettingsComponent_ng_container_7_ng_container_7_span_7_Template","_r42","onCheckSearchSource","SearchSettingsComponent_ng_container_7_button_3_Template","SearchSettingsComponent_ng_container_7_button_4_Template","SearchSettingsComponent_ng_container_7_ng_container_7_Template","changePointerReverseSearch","pointerSummaryEnabled","SearchSettingsComponent","lastKeyTime","searchResultsGeometryEnabled","searchSourceChange","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","hasReverseSearchSourcesForPointerSummary","getSearchSources","textSearchSources","computeSourcesCheckAllBehavior","settingValue","computeSettingCheckAllBehavior","enabledSourcesCnt","disabledSourcesCnt","storage","changeSearchResultsGeometry","SearchSettingsComponent_div_6_Template","SearchSettingsComponent_ng_container_7_Template","SearchSettingsComponent_mat_slide_toggle_11_Template","onClearButtonClick","onSearchSettingsChange","SearchBarComponent","placeholder$","stream$","stream$$","researches$$","showSearchButton","withDivider","setTerm","_reverseSearchCoordsFormatEnabled","appearance","searchSelector","searchSettings","searchTermChange","clearFeature","searchSettingsChange","onSetTerm","handlePlaceholder","configValue","onKeyup","doSearch","reverseCoordEvent","slug","ss","rawTerm","terms","onResearchCompleted","SearchBarComponent_mat_label_3_Template","SearchBarComponent_button_10_Template","SearchBarComponent_mat_divider_12_Template","SearchBarComponent_button_14_Template","SearchBarComponent_igo_search_selector_15_Template","SearchBarComponent_igo_search_settings_16_Template","showIcons","tooltipHtml","SearchResultsItemComponent_ng_template_3_span_0_Template","onZoomHandler","SearchResultsItemComponent","withZoomButton","zoomEvent","getEntityTitleHtml","titleHtmlProperty","hideBtn","showBtn","SearchResultsItemComponent_mat_icon_1_Template","SearchResultsItemComponent_div_2_Template","SearchResultsItemComponent_ng_template_3_Template","SearchResultsItemComponent_button_6_Template","SaveFeatureDialogComponent","filteredLayers$","SaveFeatureDialogComponent_mat_option_13_Template","addFeatureToLayer","addFeatureToLayerTooltip$","SearchResultAddButtonComponent","layersSubcriptions","saveSearchResultInLayer","currEvent","Stroke","Fill","searchLayer","SearchResultAddButtonComponent_button_0_Template","SearchResultAddButtonComponent_button_1_Template","CollapsibleComponent","_title","group_r4","SearchResultsComponent_igo_list_0_ng_template_1_igo_collapsible_0_ng_container_1_Template","computeGroupTitle","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_1_ng_container_0_Template","result_r20","resultFocus","resultUnfocus","onResultSelect","templateSearchToolbar","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_3_ng_template_0_Template","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_3_span_1_Template","results_r17","SearchResultsComponent_igo_list_0_ng_template_1_igo_collapsible_0_Template","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_1_Template","SearchResultsComponent_igo_list_0_ng_template_1_ng_template_3_Template","searchResultMode","Grouped","SearchResultsComponent_igo_list_0_ng_template_1_Template","results$","SearchResultsComponent_igo_list_1_ng_template_2_mat_tab_1_ng_container_1_Template","group_r39","SearchResultsComponent_igo_list_1_ng_template_2_mat_tab_1_Template","SearchResultsComponent_igo_list_1_ng_template_4_ng_template_0_ng_container_0_Template","group_r42","SearchResultsComponent_igo_list_1_ng_template_4_ng_template_0_Template","result_r47","_r56","group_r44","SearchResultsComponent_igo_list_1_ng_template_6_ng_template_0_Template","SearchResultsComponent_igo_list_1_ng_template_6_span_1_Template","SearchResultsComponent_igo_list_1_ng_container_1_Template","SearchResultsComponent_igo_list_1_ng_template_2_Template","SearchResultsComponent_igo_list_1_ng_template_4_Template","SearchResultsComponent_igo_list_1_ng_template_6_Template","SearchResultMode","Flat","SearchResultsComponent","showResultsCount","settingsChange$$","pageIterator","tabsMode","_term","settingsChange$","resultSelect","moreResults","resultMouseenter","resultMouseleave","_results$","liftResults","groupResults","grouped","sourceResults","SearchResultsComponent_igo_list_0_Template","SearchResultsComponent_igo_list_1_Template","WfsWorkspace","getLayerWksOptionTabQuery","queryOptions","tabQuery","getLayerWksOptionMapQuery","mapQueryOnOpenTab","getInResolutionRange","getCommonVectorSelectedStyle","markerOpacity","fillOpacity","strokeOpacity","getCommonVectorStyle","isOlFeature","markerColorAsArray","markerColorRGB","mapExtentStrategyActiveToolTip","addOrRemoveLayer","addedLayerId","ws$","geoServiceAction","getGeoServiceAction","geoServiceProperties","relations","columnsFromFeatures","col","cellClass","relationsColumn","relation","class_icon","createFilterInMapExtentOrResolutionStrategy","WfsWorkspaceService","zoomAuto","createWorkspace","srcId","createFeatureStore","inMapExtentStrategy","geoPropertiesStrategy","inMapResolutionStrategy","confQueryOverlayStyle","FeatureWorkspace","FeatureWorkspaceService","searchStrategy","ConfirmationPopupComponent","cancelAction","confirmedAction","EditionWorkspace","adding$","_deleteFeature","getDomainValues","modifyStyle","newFeaturefilterClauseFunc","editFeaturefilterClauseFunc","edit","deleteFeature","deleteUrl","columnName","editFeature","editionOpt","original_properties","original_geometry","idkey","addWithDraw","featureOl","createModifyInteraction","olCollection","Collection","EditionWorkspaceService","relationLayers$","rowsInMapExtentCheckCondition$","wktFormat","WKT","geoJsonFormat","wksConfig","wmsLinkId","wfsLinkId","linkProperties","hasOgcFilters","clonedLinks","workspaceLayer","rendererType","modifyButton","deleteButton","saveFeature","cancelEdit","validateFeature","sanitizeParameter","addUrl","addHeaders","modifyProtocol","modifyUrl","protocole","modifyHeaders","modifyFeature","hasGeometry","projDest","geomDatabaseProj","refreshMap","removeZ","relationLayers","fromSave","wfsOlLayer","wmsOlLayer","_t","WmsWorkspaceService","printable","WorkspaceSelectorDirective","wfsWorkspaceService","wmsWorkspaceService","editionWorkspaceService","featureWorkspaceService","changeWorkspace","rowsInMapExtentCheckCondition","workspaceStore","onLayersChange","adding","editableLayers","layerIsEditable","editableLayersIds","workspacesToAdd","getOrCreateWorkspace","workspacesToRemove","wmsWks","getLayerFillColor","StyleModalLayerComponent","initialValues","defaultValues","getLayerStrokeColor","arrayColor","setLayerFillColor","cAA","setLayerStrokeColor","StyleModalLayerComponent_div_6_Template","StyleModalLayerButtonComponent","infoContent","InfoSectionComponent","InfoSectionComponent_div_0_Template","pointerCoord","AppSimpleMapRoutingModule","AppSimpleMapComponent","pointerCoordDelay","onPointerMove","AppSimpleMapComponent_p_9_Template","AppSimpleMapModule","AppLayerRoutingModule","AppLayerComponent","AppLayerComponent_ng_template_10_Template","AppLayerModule","AppLegendRoutingModule","AppLegendComponent","AppLegendModule","AppOverlayRoutingModule","AppOverlayComponent","AppOverlayModule","AppGeometryRoutingModule","AppGeometryComponent","AppGeometryComponent_igo_form_5_Template","AppGeometryModule","AppFeatureRoutingModule","AppFeatureComponent","AppFeatureModule","AppHoverRoutingModule","AppHoverComponent","pointerHoverFeatureDelay","AppHoverModule","AppMeasureRoutingModule","AppMeasureComponent","AppMeasureModule","AppDrawRoutingModule","AppDrawComponent","AppDrawModule","feature_r3","AppQueryComponent_ng_container_5_div_1_Template","features_r1","AppQueryRoutingModule","AppQueryComponent","feature1","olLineString","feature2","feature3","handleQueryResults","AppQueryComponent_ng_container_5_Template","AppQueryModule","AppCatalogRoutingModule","AppCatalogComponent","catalogStore","catalogItemStore","onCatalogSelectChange","AppCatalogModule","IgoContextImportExportModule","TypePermission","null","ContextService","context$","contexts$","ours","defaultContextId$","editedContext$","importedContext","toolsChanged$","mapViewFromRoute","defaultContextUri","_defaultContextUri","basePath","contextListFile","readParamsFromRoute","handleContextsChange","loadContexts","permissions","getById","getDetails","getDefault","getContextByUri","getProfilByUser","setDefault","defaultContextId","hideContext","showContext","imported","contexts","contextCreated","permission","contextCloned","addToolAssociation","contextId","toolId","deleteToolAssociation","getPermissions","addPermissionAssociation","profil","typePermission","deletePermissionAssociation","permissionId","getLocalContexts","getLocalContext","urlBase","resBase","resMerge","l2","t2","err2","loadDefaultContext","loadFct","direct","_context","addContextToList","setContext","loadContext","contextParam","handleContextMessage","currentContext","keepCurrentView","loadEditedContext","setEditedContext","getContextFromMap","igoMap","global","getContextFromLayers","extraFeatures","layerFound","contextLayer","layerFoundAs","olVectorSource","getExtraFeatures","catalogLayer","Cluster","cleanedOlFeatures","contextToLoad","getContextLayers","mapLayers","permissionError","titleContext","keepCurrentContext","editedContext","findContext","editedFound","public","found","MapContextDirective","contextService","context$$","handleContextChange","viewContext","controlsContext","scaleLineOption","minWidth","collectFeaturesFromExtraFeatures","LayerContextDirective","contextLayers","removeLayersOnContextChange","layersAndIndex$","handleAddLayers","addImportedFeaturesStyledToMap","addImportedFeaturesToMap","featureKeys","computeLayerVisibilityFromUrl","currentLayerid","contextParams","visibleOnLayersParams","visibleOffLayersParams","visiblelayers","invisiblelayers","PoiService","IgoContextMapButtonModule","IgoContextManagerModule","IgoShareMapModule","IgoSidenavModule","MatSidenavModule","IgoContextModule","ContextExportService","ContextImportService","parseContextFromFile","ContextImportExportComponent_form_9_mat_option_18_Template","userControlledLayerList","ContextImportExportComponent","contextImportService","contextExportService","layerList","activeImportExport","contextOptions","contextTitle","addContextToContextList","ContextImportExportComponent_div_8_Template","ContextImportExportComponent_form_9_Template","ContextListControlsEnum","BookmarkDialogComponent","iconImage","favoriteClick","ContextItemComponent_button_1_mat_icon_2_Template","ContextItemComponent_button_1_img_3_Template","managePermissions","ContextItemComponent_div_5_button_1_Template","ContextItemComponent_div_5_button_4_Template","ContextItemComponent_div_5_button_5_Template","ContextItemComponent_div_5_button_6_Template","ContextItemComponent_div_5_button_7_Template","ContextItemComponent_div_5_button_8_Template","ContextItemComponent_div_5_button_9_Template","canShare","ContextItemComponent","showFavorite","favorite","manageTools","ContextItemComponent_button_1_Template","ContextItemComponent_button_2_Template","ContextItemComponent_div_5_Template","clearFilter","ContextListComponent_mat_form_field_2_button_6_Template","toggleSort","user_r17","child_r24","userSelection","getPermission","ContextListComponent_ng_container_10_button_4_Template","ContextListComponent_ng_container_10_button_5_Template","ContextListComponent_ng_container_10_mat_checkbox_9_Template","indeterminate","childs","context_r36","selectedContext","_r50","groupContexts_r32","titleMapping","ContextListComponent_ng_template_17_igo_collapsible_0_ng_template_2_Template","context_r54","ctx_r57","ContextListComponent_ng_template_17_1_ng_template_0_Template","ContextListComponent_ng_template_17_igo_collapsible_0_Template","ContextListComponent_ng_template_17_1_Template","ContextListComponent","contextsInitial","_contexts","_selectedContext","_defaultContextId","showHiddenContexts","filterPermissionsChanged","shared","users","showHidden","sortedAlpha","showContextFilter","thresholdToFilter","filterContextsList","createContext","sortContextsList","updateContexts","publics","showFilter","contextsList","parentPermission","childrenPermission","ContextListComponent_mat_form_field_2_Template","ContextListComponent_button_4_Template","ContextListComponent_button_5_Template","ContextListComponent_igo_actionbar_6_Template","ContextListComponent_button_7_Template","ContextListComponent_ng_container_10_Template","ContextListComponent_ng_template_17_Template","ContextListBindingDirective","contexts$$","selectedContext$$","defaultContextId$$","onEdit","onSave","contextFromMap","msgSuccess","onFavorite","onManageTools","onManagePermissions","onDelete","onClone","onCreate","onShowContext","onHideContext","storedContextUri","authenticate","profilsAcc","cur","ContextFormComponent","btnSubmitText","_btnSubmitText","uriSplit","ContextFormComponent_span_8_Template","ContextEditComponent","ContextEditComponent_igo_context_form_0_Template","ContextEditBindingDirective","editedContext$$","submitSuccessed","handleEditedContextChange","scopeChanged","ContextPermissionsComponent_div_0_div_2_mat_radio_button_8_Template","profil_r11","onProfilSelected","ContextPermissionsComponent_div_0_form_3_mat_option_6_Template","permission_r19","removePermission","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_igo_collapsible_0_ng_template_2_button_7_Template","profilTitle","canWrite","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_igo_collapsible_0_ng_template_2_Template","groupPermissions_r16","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_igo_collapsible_0_Template","ContextPermissionsComponent_div_0_igo_list_4_ng_template_1_Template","ContextPermissionsComponent_div_0_div_1_Template","ContextPermissionsComponent_div_0_div_2_Template","ContextPermissionsComponent_div_0_form_3_Template","ContextPermissionsComponent_div_0_igo_list_4_Template","ContextPermissionsComponent","_permissions","_profils","baseUrlProfils","addPermission","profilTitleNormalized","ContextPermissionsComponent_div_0_Template","ContextPermissionsBindingDirective","onAddPermission","onRemovePermission","onScopeChanged","permissionsArray","ShareMapService","getUrlWithApi","formValues","createContextShared","updateContextShared","getUrlWithoutApi","publicShareOption","llc","layerlistControls","querystring","visibleKey","invisibleKey","visibleLayers","invisibleLayers","layersUrl","layersToLoop","contextLayersID","addedLayersQueryParamsWms","makeLayersByService","addedLayersQueryParamsWmts","addedLayersQueryParamsArcgisRest","addedLayersQueryParamsImageArcgisRest","addedLayersQueryParamsTileArcgisRest","arrayCenter","typeService","addedLayersByService","layerVersion","linkUrl","addedLayer","addedLayerPosition","definedUrl","addedLayersQueryParams","linkUrlKey","layersKey","linkUrlQueryParams","layersQueryParams","ShareMapUrlComponent_div_13_h4_1_Template","ShareMapUrlComponent_div_13_li_4_Template","ShareMapUrlComponent_div_13_li_6_Template","ShareMapUrlComponent_div_13_li_8_Template","ShareMapUrlComponent_div_13_li_10_Template","ShareMapUrlComponent_div_13_li_12_Template","ShareMapUrlComponent_div_13_h4_14_Template","ShareMapUrlComponent_div_13_li_17_Template","ShareMapUrlComponent_div_13_li_19_Template","ShareMapUrlComponent_div_13_li_21_Template","ShareMapUrlComponent_div_13_li_23_Template","ShareMapUrlComponent","shareMapService","mapState$$","resetUrl","ShareMapUrlComponent_div_13_Template","ShareMapUrlComponent_igo_custom_html_15_Template","userId","ShareMapApiComponent","idContextShared","createUrl","ShareMapApiComponent_span_10_Template","ShareMapApiComponent_button_18_Template","ShareMapApiComponent_button_19_Template","ShareMapApiComponent_div_20_Template","ShareMapComponent","hasApi","ShareMapComponent_mat_tab_group_0_Template","ShareMapComponent_igo_share_map_url_1_Template","IgoAppSearchBarModule","IgoAppSearchResultsToolModule","IgoAppSearchModule","openGuide","guide_r7","formatFileName","headerHtml","AboutToolComponent","_headerHtml","_discoverTitleInLocale","discoverTitleInLocale","trainingGuideURLs","baseUrlProfil","baseUrlGuide","guides","guide","AboutToolComponent_button_2_Template","AboutToolComponent_button_3_Template","AboutToolComponent_button_6_Template","AboutToolComponent_igo_custom_html_7_Template","ImportExportType","ImportExportMode","ImportExportState","importExportType$","selectedMode$","setImportExportType","setMode","setsExportOptions","ToolState","importExportState","openSidenav$","toolToActivateFromOptions","toolToActivate","ContextState","toolState","onContextChange","updateTools","contextTool","baseTool","parentIndex","StorageState","igoStorageService","handleZoomAuto","getWorkspaceActions","selectOnlyCheckCondition$","ogcFilterWidget","zoomAuto$","maximize$","datePipe","noElementSelected","filterStrategy","totalPagesExp","tableWidth","horizontalPageBreak","cellPadding","minCellWidth","didDrawPage","putTotalPages","returnActions","FeatureActionsService","storageState","storageChange$$","loadActions","buildActions","storageChange","WfsActionsService","EditionActionsService","WorkspaceState","featureActionsService","wfsActionsService","editionActionsService","workspacePanelExpanded","workspaceEnabled$","workspaceMaximize$","actionMaximize$$","rowsInMapExtentCheckCondition$$","selectOnlyCheckCondition$$","activeWorkspace$$","activeWorkspaceWidget$$","activeWorkspaceWidget$","workspace$","workspaceSelection","workspaceSelection$","initWorkspaces","maximized","setWorkspaceIsMaximized","rowsInMapExtent","selectOnly","setActiveWorkspaceById","wksFromId","setActiveWorkspaceByTitle","wksFromTitle","teardownWorkspaces","MapState","_legendToolShowAll","applyNewLayers","layer_r5","AdvancedSwipeComponent_div_0_mat_option_12_Template","startSwipe","swipe","searchEmit","catalogEmit","contextEmit","AdvancedSwipeComponent","mapState","listForSwipe","AdvancedSwipeComponent_div_0_Template","AdvancedSwipeComponent_ng_template_1_Template","projection_r11","translatedValue","AdvancedCoordinatesComponent","formattedScale$","currentCenterDefaultProj","inMtmZone","inLambert2","defaultProj","currentZones","setScaleValue","currentMtmZone","currentUtmZone","back2quebec","updateProjectionsZoneChange","checkLambert","tempInputProj","positionInList","updateZoneMtmUtm","displayCenter","modifiedProj","pushMtm","tk","iter","currentExtentWGS","AdvancedCoordinatesComponent_mat_form_field_2_Template","AdvancedCoordinatesComponent_ng_template_3_Template","AdvancedCoordinatesComponent_mat_form_field_5_Template","AdvancedCoordinatesComponent_ng_template_6_Template","AdvancedCoordinatesComponent_mat_option_17_Template","AdvancedMapToolComponent","toggleTracking","toggleFollow","MapProximityState","defaultProximityRadiusValue","enabled$","proximityRadiusValue$","proximitylocationType$","proximityFeatureStore","subs$$","currentPositionCoordinate$","subscribeProximityMonitor","currentPos","locationType","proximityRadiusValue","roundedCoordLonLat","layerToMonitor","layerSource","olFeaturesAtCoordinate","getFeaturesAtCoordinate","olFeatureAtCoordinate","featureAtThisPosition","closestOlFeature","getClosestFeatureToCoordinate","closestOlGeom","closestFeature","geometryClosestPoint","getClosestPoint","lineLength","coordFromCalculatedDistance","layerSrcId","layerSrcTitle","coord_r4","coord2_r6","MapProximityToolComponent","mapProximityState","maxDistance","userDefinedMapCenter","userDefinedFollowPosition","onLocationTypeChange","MapProximityToolComponent_mat_form_field_3_Template","MapProximityToolComponent_mat_form_field_5_Template","MapProximityToolComponent_button_7_Template","WorkspaceButtonComponent","workspaceState","hasWorkspace$","hasWorkspace$$","layer$","WorkspaceButtonComponent_button_0_Template","activateExport","MapDetailsToolComponent_igo_layer_list_0_ng_template_1_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_p_4_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_mat_list_item_5_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_mat_list_item_6_Template","MapDetailsToolComponent_ng_template_2_mat_list_0_mat_list_item_7_Template","layerAdditionAllowed","searchToolInToolbar","catalogToolInToolbar","contextToolInToolbar","MapDetailsToolComponent_ng_template_2_mat_list_0_Template","delayedShowEmptyMapContent","MapDetailsToolComponent","layerListControls","filterSortOptions","MapDetailsToolComponent_igo_layer_list_0_Template","MapDetailsToolComponent_ng_template_2_Template","LayerLegendListBindingDirective","onShowAllLegends","showAllLegendsValue$","MapLegendToolComponent_1_ng_template_0_Template","visibleLayers$","MapLegendToolComponent_ng_template_6_mat_list_0_p_4_Template","MapLegendToolComponent_ng_template_6_mat_list_0_mat_list_item_5_Template","MapLegendToolComponent_ng_template_6_mat_list_0_mat_list_item_6_Template","MapLegendToolComponent_ng_template_6_mat_list_0_mat_list_item_7_Template","MapLegendToolComponent_ng_template_6_mat_list_0_Template","MapLegendToolComponent","visibleOrInRangeLayers$$","visibleOrInRangeLayers$","visibleOrInRangeLayers","MapLegendToolComponent_igo_layer_legend_list_0_Template","MapLegendToolComponent_1_Template","MapLegendToolComponent_p_3_Template","MapLegendToolComponent_ng_template_6_Template","MapToolComponent","MapToolComponent_ng_template_4_Template","LayerListToolState","keyword$","selectedTab$","setKeyword","setSortAlpha","setOnlyVisible","setSelectedTab","tab","getLayerListControls","activateTimeFilter","activateOgcFilter","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_style_modal_layer_button_0_Template","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_time_filter_button_3_Template","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_ogc_filter_button_4_Template","MapToolsComponent_igo_layer_list_5_ng_template_1_igo_export_button_5_Template","isStyleEditButton","isTimeFilterButton","isOGCFilterButton","isExportButton","onLayerListChange","MapToolsComponent_igo_layer_list_5_ng_template_1_Template","MapToolsComponent_10_ng_template_0_Template","MapToolsComponent_ng_template_15_mat_list_0_p_4_Template","MapToolsComponent_ng_template_15_mat_list_0_mat_list_item_5_Template","MapToolsComponent_ng_template_15_mat_list_0_mat_list_item_6_Template","MapToolsComponent_ng_template_15_mat_list_0_mat_list_item_7_Template","MapToolsComponent_ng_template_15_mat_list_0_Template","MapToolsComponent","layerListToolState","selectedTabAtOpening","_layerListControls","stateOptions","stateKeyword","stateOnlyVisible","stateSortAlpha","tabGroup","selectedTab","userSelectedTab","tabChanged","appliedFilters","MapToolsComponent_igo_layer_list_5_Template","MapToolsComponent_igo_layer_legend_list_9_Template","MapToolsComponent_10_Template","MapToolsComponent_p_12_Template","MapToolsComponent_ng_template_15_Template","SearchState","searchLayerStores","searchOverlayStyle","searchOverlayStyleSelection","searchOverlayStyleFocus","focusedOrResolution$$","selectedOrResolution$$","searchTermSplitter$","searchTerm$","searchDisabled$","searchResultsGeometryEnabled$","searchSettingsChange$","selectedResult$","createCustomFilterTermStrategy","wksSource","searchableWks","monitorLayerDeletion","activateCustomFilterTermStrategy","deactivateCustomFilterTermStrategy","enableSearch","disableSearch","setSearchTerm","searchTerm","setSearchSettingsChange","setSelectedResult","setSearchResultsGeometryStatus","ContextManagerToolComponent","toolToOpenOnContextChange","editContext","ContextEditorToolComponent","ContextPermissionManagerToolComponent","ContextShareToolComponent","CatalogState","_catalogStore","catalogItemsStores","clearCatalogItemsStores","getCatalogItemsStore","setCatalogItemsStore","store_r1","CatalogBrowserToolComponent","catalogState","store$","catalog$$","authenticate$$","CatalogBrowserToolComponent_igo_catalog_browser_0_Template","CatalogLibraryToolComponent","DirectionState","DirectionsToolComponent","directionState","contextState","currentContextUri","DrawState","layersID","deletedStore","drawControlIndex","DrawingToolComponent","drawState","addLayersID","addDrawControls","OgcFilterToolComponent","ActiveOgcFilterToolComponent","feature_r1","SpatialFilterToolComponent","activeLayers","iterator","selectedFeature$","spatialListStore","moveendKey","getOutputType","getOutputQueryType","activateExportTool","re","layerToOpenWks","zeroResults","selectWorkspaceEntity","getOutputToggleSearch","loadThematics","getOutputClearSearch","clearMap","tryAddFeaturesToMap","featuresPoint","featuresLinePoly","idPoint","idLinePoly","tryAddPointToMap","tryAddLayerToMap","zoomToFeatureExtent","_internal","featuresOl","createSvgIcon","pushLayer","xmlSerializer","SpatialFilterToolComponent_ng_container_4_Template","MatIconRegistry","TimeFilterListBindingDirective","TimeFilterToolComponent","ActiveTimeFilterToolComponent","ImportExportToolComponent","importExportType","importExportShowBothType","selectType","userSelectedType","userSelectedMode","importExportTypeChange","ImportExportToolComponent_mat_tab_group_0_Template","ImportExportToolComponent_igo_import_export_1_Template","ImportExportToolComponent_igo_context_import_export_2_Template","MeasureState","getOverlays","MeasurerToolComponent","measureState","PrintToolComponent","result_r6","isSelectedResultOutOfView$","toggleTopPanel","SearchResultsToolComponent_igo_flexible_2_igo_panel_8_button_4_Template","featureTitle","topPanelState$","onResultFocus","onResultUnfocus","SearchResultsToolComponent_igo_flexible_2_ng_template_5_Template","SearchResultsToolComponent_igo_flexible_2_igo_panel_8_Template","topPanelState","SearchResultsToolComponent","searchState","topPanelStateDefault","hasFeatureEmphasisOnSelection","showResultsGeometries$$","getRoute$$","shownResultsGeometries","shownResultsEmphasisGeometries","focusedResult$","isSelectedResultOutOfView$$","abstractFocusedResult","abstractSelectedResult","debouncedEmpty$","debouncedEmpty$$","searchTerm$$","topPanelState$$","computeElementRef","adjustTopPanel","buildResultEmphasis","monitorResultOutOfView","searchResults","clearFeatureEmphasis","selectedResult","selectedOlFeatureExtent","abstractResult","computedStyle","zIndexOffset","shownResult","tryAddFeatureToMap","routingCoordLoaded","currentCoord","SearchResultsToolComponent_div_0_Template","SearchResultsToolComponent_igo_flexible_2_Template","ElementRef","ContextMenuDirective","viewContainerRef","elementRef","overlayRef","menuContext","menuPosition","onContextMenu","TouchEvent","pageX","pageY","MouseEvent","positionStrategy","flexibleConnectedTo","withPositions","originX","originY","overlayX","overlayY","scrollStrategy","scrollStrategies","attach","TemplatePortal","clickTarget","overlayElement","dispose","result_r7","AppSearchRoutingModule","AppSearchComponent","osmLayer","mapBrowser","searchStore","igoReverseSearchCoordsFormatEnabled","onPointerSummaryStatusChange","onSearchTermChange","onReverseCoordsFormatStatusChange","searchCoordinate","openGoogleMaps","openGoogleStreetView","removeFeatureFromMap","onContextMenuOpen","mapPosition","getCoordinateFromPixel","contextmenuPoint","getBoundingClientRect","scrollY","scrollX","AppSearchComponent_span_2_Template","AppSearchComponent_ng_template_9_Template","AppSearchComponent_igo_panel_11_Template","AppSearchComponent_ng_template_12_Template","AppSearchModule","AppPrintRoutingModule","AppPrintComponent","AppPrintModule","AppImportExportRoutingModule","AppImportExportComponent","AppImportExport","AppDirectionsRoutingModule","AppDirectionsComponent","AppDirectionsModule","AppTimeFilterRoutingModule","AppTimeFilterComponent","AppTimeFilterModule","AppOgcFilterRoutingModule","AppOgcFilterComponent","AppOgcFilterModule","AppSpatialFilterRoutingModule","AppSpatialFilterComponent","AppSpatialFilterComponent_ng_container_12_Template","AppSpatialFilterModule","workspace_r2","AppWorkspaceComponent_ng_container_5_igo_entity_table_paginator_1_Template","workspace_r7","workspacePaginator","AppWorkspaceComponent_ng_container_7_igo_actionbar_1_Template","AppWorkspaceComponent_ng_container_7_igo_entity_table_2_Template","AppWorkspaceComponent_ng_container_7_mat_card_content_4_Template","AppWorkspaceRoutingModule","AppWorkspaceComponent","selectedWorkspace$","AppWorkspaceComponent_ng_container_5_Template","AppWorkspaceComponent_ng_container_7_Template","AppWorkspaceModule","AppContextRoutingModule","AppContextComponent","AppContextComponent_ng_template_15_Template","AppContextModule","HttpClientJsonpModule","redirectTo","pathMatch","AppRoutingModule","useHash","AppComponent","changeDetectorRef","mobileQuery","_mobileQueryListener","matchMedia","detectOldBrowser","handleSplashScreen","NavigationEnd","_removeSplashScreen","intro","stylesheet","removeEventListener","getBrowser","defaultTooltipOptions","showDelay","hideDelay","touchendHideDelay","disableTooltipInteractivity","AppModule","bootstrap","MAT_FORM_FIELD_DEFAULT_OPTIONS","appInitializerFactory","ApplicationRef","MAT_TOOLTIP_DEFAULT_OPTIONS","DatePipe","MatToolbarModule","HammerModule","applicationRef","isStable","setTranslation","enableProdMode","__NgCli_bootstrap_1","bootstrapModule","webpackContext","webpackContextResolve","__webpack_require__","module","exports"],"sourceRoot":"webpack:///","sources":["./packages/utils/src/lib/base64.ts","./packages/utils/src/lib/cache.utils.ts","./packages/utils/src/lib/user-agent.ts","./packages/utils/src/lib/clipboard.ts","./packages/utils/src/lib/string-utils.ts","./packages/utils/src/lib/change.interface.ts","./packages/utils/src/lib/change.ts","./packages/utils/src/lib/dom.utils.ts","./packages/utils/src/lib/file.ts","./packages/utils/src/lib/object-utils.ts","./packages/utils/src/lib/number-utils.ts","./packages/utils/src/lib/strenum.ts","./packages/utils/src/lib/uuid.ts","./packages/utils/src/lib/watcher.ts","./packages/core/src/lib/activity/activity.service.ts","./packages/core/src/lib/activity/activity.interceptor.ts","./packages/core/src/lib/activity/activity.module.ts","./packages/core/src/lib/config/version.ts","./packages/core/src/lib/config/config-deprecated.ts","./packages/core/src/lib/config/config.service.ts","./packages/core/src/lib/config/config.provider.ts","./packages/core/src/lib/config/config.module.ts","./packages/core/src/lib/language/shared/language.loader.ts","./packages/core/src/lib/language/shared/language.provider.ts","./packages/core/src/lib/language/shared/missing-translation.guard.ts","./packages/core/src/lib/language/language.module.ts","./packages/core/src/lib/message/message.module.ts","./packages/core/src/lib/message/shared/message.enum.ts","./packages/core/src/lib/language/shared/language.service.ts","./packages/core/src/lib/message/shared/message.service.ts","./packages/core/src/lib/request/error.interceptor.ts","./packages/core/src/lib/request/error.module.ts","./packages/core/src/lib/core.module.ts","./packages/core/src/lib/route/route.service.ts","./packages/core/src/lib/media/media.enum.ts","./packages/core/src/lib/media/media.service.ts","./packages/core/src/lib/storage/storage.interface.ts","./packages/core/src/lib/storage/storage.ts","./packages/core/src/lib/storage/storage.service.ts","./packages/core/src/lib/compression/compression.service.ts","./packages/core/src/lib/network/network.service.ts","./packages/core/src/lib/regex/regex.service.ts","./packages/common/src/lib/action/actionbar/actionbar.module.ts","./packages/common/src/lib/action/action.module.ts","./packages/common/src/lib/badge-icon/badge-icon.module.ts","./packages/common/src/lib/collapsible/collapsible.module.ts","./packages/common/src/lib/confirm-dialog/confirm-dialog.component.ts","./packages/common/src/lib/confirm-dialog/confirm-dialog.component.html","./packages/common/src/lib/confirm-dialog/confirm-dialog.service.ts","./packages/common/src/lib/confirm-dialog/confirm-dialog.module.ts","./packages/common/src/lib/context-menu/context-menu.module.ts","./packages/common/src/lib/custom-html/custom-html.module.ts","./packages/common/src/lib/dom/dom.service.ts","./packages/common/src/lib/dom/dom.module.ts","./packages/common/src/lib/drag-drop/drag-drop.module.ts","./packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.module.ts","./packages/common/src/lib/dynamic-component/shared/dynamic-component.ts","./packages/common/src/lib/dynamic-component/shared/dynamic-component.service.ts","./packages/common/src/lib/dynamic-component/dynamic-component.module.ts","./packages/common/src/lib/flexible/flexible.module.ts","./packages/common/src/lib/form/form/form.module.ts","./packages/common/src/lib/form/form-field/form-field.module.ts","./packages/common/src/lib/form/form-group/form-group.module.ts","./packages/common/src/lib/form/shared/form.service.ts","./packages/common/src/lib/form/shared/form-field.service.ts","./packages/common/src/lib/form/form.module.ts","./packages/common/src/lib/entity/entity-selector/entity-selector.module.ts","./packages/common/src/lib/stop-propagation/stop-propagation.module.ts","./packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.module.ts","./packages/common/src/lib/image/image.module.ts","./packages/common/src/lib/entity/entity-table/entity-table.module.ts","./packages/common/src/lib/entity/entity.module.ts","./packages/common/src/lib/interactive-tour/interactive-tour.loader.ts","./packages/common/src/lib/interactive-tour/interactive-tour.service.ts","./packages/common/src/lib/interactive-tour/interactive-tour.module.ts","./packages/common/src/lib/keyvalue/keyvalue.module.ts","./packages/common/src/lib/clickout/clickout.module.ts","./packages/common/src/lib/list/list.module.ts","./packages/common/src/lib/panel/panel.module.ts","./packages/common/src/lib/spinner/spinner.module.ts","./packages/common/src/lib/table/table.module.ts","./packages/common/src/lib/entity/shared/entity.enums.ts","./packages/common/src/lib/entity/shared/entity.utils.ts","./packages/common/src/lib/entity/shared/state.ts","./packages/common/src/lib/entity/shared/view.ts","./packages/common/src/lib/entity/shared/store.ts","./packages/common/src/lib/entity/shared/store-strategy.ts","./packages/common/src/lib/entity/shared/watcher.ts","./packages/common/src/lib/entity/shared/strategies/strategy.ts","./packages/common/src/lib/entity/shared/strategies/filter-custom-function.ts","./packages/common/src/lib/entity/shared/strategies/filter-selection.ts","./packages/common/src/lib/entity/entity-selector/entity-selector.component.html","./packages/common/src/lib/entity/entity-selector/entity-selector.component.ts","./packages/common/src/lib/stop-propagation/stop-propagation.directive.ts","./packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.component.ts","./packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.component.html","./packages/common/src/lib/image/image-error.directive.ts","./packages/common/src/lib/entity/entity-table/entity-table-row.directive.ts","./packages/common/src/lib/custom-html/custom-html.pipe.ts","./packages/common/src/lib/image/secure-image.pipe.ts","./packages/common/src/lib/entity/entity-table/entity-table.component.html","./packages/common/src/lib/entity/entity-table/entity-table.component.ts","./packages/common/src/lib/tool/shared/toolbox.ts","./packages/common/src/lib/tool/shared/tool.service.ts","./packages/common/src/lib/tool/toolbox/toolbox.module.ts","./packages/common/src/lib/tool/tool.module.ts","./packages/common/src/lib/widget/widget-outlet/widget-outlet.module.ts","./packages/common/src/lib/widget/shared/widget.service.ts","./packages/common/src/lib/widget/widget.module.ts","./packages/common/src/lib/workspace/workspace-selector/workspace-selector.module.ts","./packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.module.ts","./packages/common/src/lib/workspace/workspace.module.ts","./packages/common/src/lib/color-picker-form-field/color-picker-form-field.module.ts","./packages/common/src/lib/action/shared/action.enums.ts","./packages/common/src/lib/action/shared/store.ts","./packages/common/src/lib/action/actionbar/actionbar-item.component.html","./packages/common/src/lib/action/actionbar/actionbar-item.component.ts","./packages/common/src/lib/action/actionbar/actionbar.component.html","./packages/common/src/lib/action/actionbar/actionbar.component.ts","./packages/common/src/lib/context-menu/long-press.directive.ts","./packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.component.ts","./packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.component.html","./packages/common/src/lib/form/shared/form-field-component.ts","./packages/common/src/lib/form/shared/form.utils.ts","./packages/common/src/lib/form/form-field/form-field.component.html","./packages/common/src/lib/form/form-field/form-field.component.ts","./packages/common/src/lib/form/form-group/form-group.component.html","./packages/common/src/lib/form/form-group/form-group.component.ts","./packages/common/src/lib/form/form-field/form-field-text.component.html","./packages/common/src/lib/form/form-field/form-field-text.component.ts","./packages/common/src/lib/form/form-field/form-field-select.component.html","./packages/common/src/lib/form/form-field/form-field-select.component.ts","./packages/common/src/lib/form/form-field/form-field-textarea.component.html","./packages/common/src/lib/form/form-field/form-field-textarea.component.ts","./packages/common/src/lib/form/form/form.component.ts","./packages/common/src/lib/form/form/form.component.html","./packages/common/src/lib/flexible/flexible.component.ts","./packages/common/src/lib/flexible/flexible.component.html","./packages/common/src/lib/interactive-tour/interactive-tour.component.html","./packages/common/src/lib/interactive-tour/interactive-tour.component.ts","./packages/common/src/lib/spinner/spinner.component.ts","./packages/common/src/lib/spinner/spinner.component.html","./packages/common/src/lib/spinner/spinner-activity.directive.ts","./packages/common/src/lib/table/table-datasource.ts","./packages/common/src/lib/table/table-action-color.enum.ts","./packages/common/src/lib/table/table.component.html","./packages/common/src/lib/table/table.component.ts","./packages/common/src/lib/table/table-database.ts","./packages/common/src/lib/tool/shared/tool-component.ts","./packages/common/src/lib/tool/shared/toolbox.enums.ts","./packages/common/src/lib/tool/toolbox/toolbox.animation.ts","./packages/common/src/lib/tool/toolbox/toolbox.component.html","./packages/common/src/lib/tool/toolbox/toolbox.component.ts","./packages/common/src/lib/widget/widget-outlet/widget-outlet.component.html","./packages/common/src/lib/widget/widget-outlet/widget-outlet.component.ts","./packages/common/src/lib/workspace/shared/store.ts","./packages/common/src/lib/workspace/shared/workspace.ts","./packages/common/src/lib/workspace/workspace-selector/workspace-selector.component.ts","./packages/common/src/lib/workspace/workspace-selector/workspace-selector.component.html","./packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.component.html","./packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.component.ts","./packages/common/src/lib/color-picker-form-field/color-picker-form-field.component.ts","./packages/common/src/lib/color-picker-form-field/color-picker-form-field.component.html","./demo/src/app/components/doc-viewer/doc-viewer.component.html","./demo/src/app/components/doc-viewer/doc-viewer.component.ts","./demo/src/app/core/home/home-routing.module.ts","./demo/src/app/core/home/home.component.ts","./demo/src/app/core/home/home.component.html","./demo/src/app/components/example/example.module.ts","./demo/src/app/components/doc-viewer/doc-viewer.module.ts","./demo/src/app/shared/shared.module.ts","./demo/src/app/core/home/home.module.ts","./demo/src/app/components/example/example-viewer/example-viewer.component.html","./demo/src/app/components/example/example-viewer/example-viewer.component.ts","./demo/src/app/core/activity/activity-routing.module.ts","./demo/src/app/core/activity/activity.component.ts","./demo/src/app/core/activity/activity.component.html","./demo/src/app/core/activity/activity.module.ts","./demo/src/environments/environment.prod.ts","./demo/src/app/core/config/config-routing.module.ts","./demo/src/app/core/config/config.component.ts","./demo/src/app/core/config/config.component.html","./demo/src/app/core/config/config.module.ts","./demo/src/app/core/language/language-routing.module.ts","./demo/src/app/core/language/language.component.ts","./demo/src/app/core/language/language.component.html","./demo/src/app/core/language/language.module.ts","./demo/src/app/core/media/media-routing.module.ts","./demo/src/app/core/media/media.component.ts","./demo/src/app/core/media/media.component.html","./demo/src/app/core/media/media.module.ts","./demo/src/app/core/message/message-routing.module.ts","./demo/src/app/core/message/message.component.ts","./demo/src/app/core/message/message.component.html","./demo/src/app/core/message/message.module.ts","./demo/src/app/core/request/request-routing.module.ts","./demo/src/app/core/request/request.component.ts","./demo/src/app/core/request/request.component.html","./demo/src/app/core/request/request.module.ts","./demo/src/app/common/action/action-routing.module.ts","./demo/src/app/common/action/action.component.ts","./demo/src/app/common/action/action.component.html","./demo/src/app/common/action/action.module.ts","./demo/src/app/common/dynamic-component/dynamic-component.component.ts","./demo/src/app/common/dynamic-component/dynamic-component-routing.module.ts","./demo/src/app/common/dynamic-component/dynamic-component.component.html","./demo/src/app/common/dynamic-component/dynamic-component.module.ts","./demo/src/app/common/entity-table/entity-table-routing.module.ts","./demo/src/app/common/entity-table/entity-table.component.ts","./demo/src/app/common/entity-table/entity-table.component.html","./demo/src/app/common/entity-table/entity-table.module.ts","./demo/src/app/common/entity-selector/entity-selector.component.html","./demo/src/app/common/entity-selector/entity-selector-routing.module.ts","./demo/src/app/common/entity-selector/entity-selector.component.ts","./demo/src/app/common/entity-selector/entity-selector.module.ts","./demo/src/app/common/form/form.component.html","./demo/src/app/common/form/form-routing.module.ts","./demo/src/app/common/form/form.component.ts","./demo/src/app/common/form/form.module.ts","./demo/src/app/common/table/table-routing.module.ts","./demo/src/app/common/table/table.component.ts","./demo/src/app/common/table/table.component.html","./demo/src/app/common/table/table.module.ts","./packages/common/src/lib/panel/panel.component.html","./packages/common/src/lib/panel/panel.component.ts","./demo/src/app/common/tool/tool.component.html","./demo/src/app/common/tool/tool.component.ts","./demo/src/app/common/tool/tool-routing.module.ts","./demo/src/app/common/tool/tool.module.ts","./demo/src/app/common/widget/widget.component.ts","./demo/src/app/common/widget/widget-routing.module.ts","./demo/src/app/common/widget/widget.component.html","./demo/src/app/common/widget/widget.module.ts","./packages/auth/src/lib/shared/token.service.ts","./packages/auth/src/lib/shared/auth.service.ts","./packages/auth/src/lib/auth-form/auth-google.component.ts","./packages/auth/src/lib/auth-form/auth-google.component.html","./packages/auth/src/lib/auth-form/auth-intern.component.html","./packages/auth/src/lib/auth-form/auth-intern.component.ts","./packages/auth/src/lib/auth-form/auth-facebook.component.ts","./packages/auth/src/lib/auth-form/auth-facebook.component.html","./packages/auth/src/lib/auth-form/auth-microsoft.component.ts","./packages/auth/src/lib/auth-form/auth-microsoft.component.html","./packages/auth/src/lib/shared/auth-msalServiceb2c.service..ts","./packages/auth/src/lib/shared/auth-msalBroadcastServiceb2c.service.ts","./packages/auth/src/lib/auth-form/auth-microsoftb2c.component.ts","./packages/auth/src/lib/auth-form/auth-microsoftb2c.component.html","./packages/auth/src/lib/auth-form/auth-form.component.html","./packages/auth/src/lib/auth-form/auth-form.component.ts","./packages/auth/src/lib/shared/auth.interceptor.ts","./packages/auth/src/lib/shared/auth-microsoft.provider.ts","./packages/auth/src/lib/shared/protected.directive.ts","./packages/auth/src/lib/shared/storage.service.ts","./packages/auth/src/lib/auth.module.ts","./demo/src/app/auth/auth-form/auth-form-routing.module.ts","./demo/src/app/auth/auth-form/auth-form.component.ts","./demo/src/app/auth/auth-form/auth-form.component.html","./demo/src/app/auth/auth-form/auth-form.module.ts","./packages/geo/src/lib/metadata/metadata.module.ts","./packages/geo/src/lib/utils/id-generator.ts","./packages/geo/src/lib/datasource/shared/datasources/datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/feature-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/osm-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/xyz-datasource.ts","./packages/geo/src/lib/filter/shared/ogc-filter.enum.ts","./packages/geo/src/lib/filter/shared/ogc-filter.ts","./packages/geo/src/lib/datasource/shared/datasources/wms-wfs.utils.ts","./packages/geo/src/lib/datasource/shared/datasources/wfs-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/data.service.ts","./packages/geo/src/lib/datasource/shared/datasources/wfs.service.ts","./packages/geo/src/lib/query/shared/query.enums.ts","./packages/geo/src/lib/datasource/shared/datasources/wms-datasource.ts","./packages/geo/src/lib/datasource/utils/tilegrid.ts","./packages/geo/src/lib/datasource/shared/datasources/wmts-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/carto-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/arcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/imagearcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/tilearcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/tiledebug-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/websocket-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/mvt-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/cluster-datasource.ts","./packages/geo/src/lib/map/shared/map.utils.ts","./packages/geo/src/lib/style/shared/datasource/esri-style-generator.ts","./packages/geo/src/lib/filter/shared/time-filter.enum.ts","./packages/geo/src/lib/map/shared/map.service.ts","./packages/geo/src/lib/datasource/shared/capabilities.service.ts","./packages/geo/src/lib/map/shared/projection.service.ts","./packages/geo/src/lib/datasource/shared/options/options.service.ts","./packages/geo/src/lib/datasource/shared/datasource.service.ts","./packages/geo/src/lib/layer/shared/layers/layer.ts","./packages/geo/src/lib/layer/shared/layers/layer.interface.ts","./packages/geo/src/lib/layer/utils/image-watcher.ts","./packages/geo/src/lib/layer/utils/tile-watcher.ts","./packages/geo/src/lib/layer/utils/vector-watcher.ts","./packages/geo/src/lib/layer/shared/layers/image-layer.ts","./packages/geo/src/lib/layer/shared/layers/tile-layer.ts","./packages/geo/src/lib/feature/shared/feature.enums.ts","./packages/geo/src/lib/feature/shared/feature.utils.ts","./packages/geo/src/lib/feature/shared/feature-store.utils.ts","./packages/geo/src/lib/feature/shared/store.ts","./packages/geo/src/lib/feature/shared/strategies/in-map-extent.ts","./packages/geo/src/lib/feature/shared/strategies/in-map-resolution.ts","./packages/geo/src/lib/feature/shared/strategies/geo-properties.ts","./packages/geo/src/lib/feature/shared/strategies/loading.ts","./packages/geo/src/lib/feature/shared/strategies/loading-layer.ts","./packages/geo/src/lib/feature/shared/strategies/selection.ts","./packages/geo/src/lib/feature/shared/strategies/search.ts","./packages/geo/src/lib/feature/shared/strategies.utils.ts","./packages/geo/src/lib/style/shared/overlay/overlay-marker-style.utils.ts","./packages/geo/src/lib/style/style-service/style.service.ts","./packages/geo/src/lib/style/shared/overlay/overlay-style.utils.ts","./packages/geo/src/lib/overlay/shared/overlay.ts","./packages/geo/src/lib/overlay/shared/overlay.utils.ts","./packages/geo/src/lib/map/utils/layer-watcher.ts","./packages/geo/src/lib/map/shared/map.enums.ts","./packages/geo/src/lib/map/shared/controllers/controller.ts","./packages/geo/src/lib/map/shared/controllers/view.ts","./packages/geo/src/lib/map/shared/controllers/geolocation.interface.ts","./packages/geo/src/lib/map/shared/controllers/geolocation.ts","./packages/geo/src/lib/map/shared/linkedLayers.utils.ts","./packages/geo/src/lib/map/shared/map.ts","./packages/geo/src/lib/map/map-browser/map-browser.component.ts","./packages/geo/src/lib/map/map-browser/map-browser.component.html","./packages/geo/src/lib/map/shared/map-pointer-position.directive.ts","./packages/geo/src/lib/style/shared/feature/feature-style.ts","./packages/geo/src/lib/map/shared/hover-feature.directive.ts","./packages/geo/src/lib/map/shared/projection.utils.ts","./packages/geo/src/lib/offline/geoDB/geoDB.enums.ts","./packages/geo/src/lib/layer/shared/layers/vector-layer.ts","./packages/geo/src/lib/style/shared/vector/conversion.utils.ts","./packages/geo/src/lib/layer/shared/layers/vectortile-layer.ts","./packages/geo/src/lib/layer/utils/layer.utils.ts","./packages/geo/src/lib/offline/geoDB/geoDB.service.ts","./packages/geo/src/lib/offline/shared/geo-network.service.ts","./packages/geo/src/lib/offline/layerDB/layerDB.service.ts","./packages/geo/src/lib/layer/shared/layer.service.ts","./packages/geo/src/lib/catalog/shared/catalog.enum.ts","./packages/geo/src/lib/query/shared/query.service.ts","./packages/geo/src/lib/query/shared/query.utils.ts","./packages/geo/src/lib/query/shared/query.directive.ts","./packages/geo/src/lib/search/shared/sources/source.ts","./packages/geo/src/lib/query/shared/query-search-source.ts","./packages/geo/src/lib/utils/googleLinks.ts","./packages/geo/src/lib/utils/osmLinks.ts","./packages/geo/src/lib/utils/propertyTypeDetector/propertyTypeDetector.service.ts","./packages/geo/src/lib/catalog/shared/catalog.abstract.ts","./packages/geo/src/lib/catalog/shared/catalogs.ts","./packages/geo/src/lib/catalog/shared/catalog.service.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.ts","./packages/common/src/lib/badge-icon/badge-icon.directive.ts","./packages/geo/src/lib/metadata/shared/metadata.service.ts","./packages/geo/src/lib/metadata/metadata-button/metadata-button.component.html","./packages/geo/src/lib/metadata/metadata-button/metadata-abstract.component.html","./packages/geo/src/lib/metadata/metadata-button/metadata-button.component.ts","./packages/common/src/lib/collapsible/collapse.directive.ts","./packages/geo/src/lib/layer/layer-legend/layer-legend.component.html","./packages/geo/src/lib/layer/layer-legend/layer-legend.component.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.ts","./packages/common/src/lib/list/list-item.directive.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.ts","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.service.ts","./packages/geo/src/lib/layer/layer-item/layer-item.component.html","./packages/geo/src/lib/layer/layer-item/layer-item.component.ts","./packages/geo/src/lib/layer/layer-list/layer-list.enum.ts","./packages/geo/src/lib/layer/layer-list/layer-list.component.html","./packages/geo/src/lib/layer/layer-list/layer-list.component.ts","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.html","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.ts","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.html","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.ts","./packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.ts","./packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.html","./packages/common/src/lib/clickout/clickout.directive.ts","./packages/common/src/lib/list/list.component.ts","./packages/common/src/lib/list/list.component.html","./packages/geo/src/lib/layer/layer.module.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.module.ts","./packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.html","./packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library.component.html","./packages/geo/src/lib/catalog/catalog-library/catalog-library.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.html","./packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library.module.ts","./packages/geo/src/lib/catalog/catalog.module.ts","./packages/geo/src/lib/download/download.module.ts","./packages/geo/src/lib/draw/draw/draw.module.ts","./packages/geo/src/lib/feature/feature-details/feature-details.module.ts","./packages/geo/src/lib/feature/feature-form/feature-form.module.ts","./packages/geo/src/lib/feature/feature.module.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.module.ts","./packages/geo/src/lib/geometry/geometry.module.ts","./packages/geo/src/lib/filter/shared/filterable-datasource.pipe.ts","./packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.html","./packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.ts","./packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.html","./packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.ts","./packages/geo/src/lib/filter/shared/time-filter.service.ts","./packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.html","./packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.ts","./packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.html","./packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.ts","./packages/geo/src/lib/wkt/shared/wkt.service.ts","./packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.html","./packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.ts","./packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.html","./packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.ts","./packages/geo/src/lib/filter/shared/ogc-filter.service.ts","./packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.html","./packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.ts","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.html","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.ts","./packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.html","./packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.ts","./packages/geo/src/lib/filter/shared/ogc-filter-time.service.ts","./packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.html","./packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.ts","./packages/geo/src/lib/filter/shared/spatial-filter.enum.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.ts","./packages/geo/src/lib/filter/shared/spatial-filter.service.ts","./packages/geo/src/lib/measure/shared/measure.enum.ts","./packages/geo/src/lib/measure/shared/measure.utils.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.ts","./packages/common/src/lib/keyvalue/keyvalue.pipe.ts","./packages/geo/src/lib/feature/feature-details/feature-details.component.html","./packages/geo/src/lib/feature/feature-details/feature-details.component.ts","./packages/geo/src/lib/geometry/shared/geometry.utils.ts","./packages/geo/src/lib/geometry/shared/controls/draw.ts","./packages/geo/src/lib/geometry/shared/controls/modify.ts","./packages/geo/src/lib/layer/shared/layer.enums.ts","./packages/geo/src/lib/measure/measurer/measurer-dialog.component.html","./packages/geo/src/lib/measure/measurer/measurer-dialog.component.ts","./packages/geo/src/lib/measure/measurer/measurer.component.html","./packages/geo/src/lib/measure/measurer/measurer.component.ts","./packages/geo/src/lib/measure/measurer/measure-format.pipe.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.html","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.html","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.html","./packages/geo/src/lib/filter/filter.module.ts","./packages/geo/src/lib/import-export/import-export.module.ts","./packages/geo/src/lib/map/map.module.ts","./packages/geo/src/lib/measure/measurer/measurer-item.component.html","./packages/geo/src/lib/measure/measurer/measurer-item.component.ts","./packages/geo/src/lib/measure/measurer/measurer.module.ts","./packages/geo/src/lib/measure/measure.module.ts","./packages/geo/src/lib/print/print.module.ts","./packages/geo/src/lib/query/shared/query-search-source.providers.ts","./packages/geo/src/lib/query/query.module.ts","./packages/geo/src/lib/directions/directions-sources/directions-source.ts","./packages/geo/src/lib/directions/shared/directions-source.service.ts","./packages/geo/src/lib/directions/directions.module.ts","./packages/geo/src/lib/search/shared/search.utils.ts","./packages/geo/src/lib/search/shared/search-source.service.ts","./packages/geo/src/lib/search/shared/search.service.ts","./packages/geo/src/lib/search/shared/search-source-service.providers.ts","./packages/geo/src/lib/search/shared/sources/icherche.ts","./packages/geo/src/lib/search/shared/sources/icherche.providers.ts","./packages/geo/src/lib/search/shared/sources/coordinates.ts","./packages/geo/src/lib/search/shared/sources/coordinates.providers.ts","./packages/geo/src/lib/layer/layer-list/layer-list-binding.directive.ts","./packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.html","./packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.ts","./packages/geo/src/lib/search/shared/sources/ilayer.ts","./packages/geo/src/lib/search/shared/sources/ilayer.providers.ts","./packages/geo/src/lib/search/search-selector/search-selector.module.ts","./packages/geo/src/lib/search/search-settings/search-settings.module.ts","./packages/geo/src/lib/search/search-bar/search-bar.module.ts","./packages/geo/src/lib/search/search-results/search-results.module.ts","./packages/geo/src/lib/search/search.module.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.html","./packages/geo/src/lib/workspace/widgets/widgets.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.module.ts","./packages/geo/src/lib/workspace/workspace-selector/workspace-selector.module.ts","./packages/geo/src/lib/workspace/workspace-updator/workspace-updator.module.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.module.ts","./packages/geo/src/lib/workspace/workspace.module.ts","./packages/geo/src/lib/style/style-list/style-list.service.ts","./packages/geo/src/lib/style/style-list/style-list.provider.ts","./packages/geo/src/lib/style/style-list/style-list.module.ts","./packages/geo/src/lib/style/shared/font.enum.ts","./packages/geo/src/lib/style/style-service/draw-style.service.ts","./packages/geo/src/lib/style/style.module.ts","./packages/geo/src/lib/feature/feature-details/feature-details.directive.ts","./packages/geo/src/lib/overlay/overlay.module.ts","./packages/geo/src/lib/download/shared/download.service.ts","./packages/geo/src/lib/download/download-button/download-button.component.html","./packages/geo/src/lib/download/download-button/download-button.component.ts","./packages/geo/src/lib/draw/shared/draw.enum.ts","./packages/geo/src/lib/draw/shared/draw-icon.service.ts","./packages/geo/src/lib/draw/shared/draw.utils.ts","./packages/geo/src/lib/draw/draw/draw-popup.component.html","./packages/geo/src/lib/draw/draw/draw-popup.component.ts","./packages/geo/src/lib/draw/draw/draw-shorcuts.component.ts","./packages/geo/src/lib/draw/draw/draw-shorcuts.component.html","./packages/geo/src/lib/style/style-modal/drawing/style-modal-drawing.component.html","./packages/geo/src/lib/style/style-modal/drawing/style-modal-drawing.component.ts","./packages/geo/src/lib/draw/draw/draw-layer-popup.component.ts","./packages/geo/src/lib/draw/draw/draw-layer-popup.component.html","./packages/geo/src/lib/draw/draw/draw.component.html","./packages/geo/src/lib/draw/draw/draw.component.ts","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list-binding.directive.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.component.html","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.component.ts","./packages/geo/src/lib/import-export/shared/import.errors.ts","./packages/geo/src/lib/import-export/shared/import.utils.ts","./packages/geo/src/lib/import-export/shared/import.service.ts","./packages/geo/src/lib/import-export/shared/export.type.ts","./packages/geo/src/lib/import-export/shared/export.errors.ts","./packages/geo/src/lib/import-export/shared/export.service.ts","./packages/common/src/lib/custom-html/custom-html.component.ts","./packages/common/src/lib/custom-html/custom-html.component.html","./packages/geo/src/lib/import-export/import-export/import-export.component.html","./packages/geo/src/lib/import-export/import-export/import-export.component.ts","./packages/geo/src/lib/import-export/shared/export.utils.ts","./packages/geo/src/lib/import-export/export-button/export-button.component.html","./packages/geo/src/lib/import-export/export-button/export-button.component.ts","./packages/geo/src/lib/map/zoom-button/zoom-button.component.ts","./packages/geo/src/lib/map/zoom-button/zoom-button.component.html","./packages/geo/src/lib/map/geolocate-button/geolocate-button.component.html","./packages/geo/src/lib/map/geolocate-button/geolocate-button.component.ts","./packages/geo/src/lib/map/home-extent-button/home-extent-button.component.ts","./packages/geo/src/lib/map/home-extent-button/home-extent-button.component.html","./packages/geo/src/lib/map/wake-lock-button/wake-lock-button.component.ts","./packages/geo/src/lib/map/wake-lock-button/wake-lock-button.component.html","./packages/geo/src/lib/map/rotation-button/rotation-button.component.html","./packages/geo/src/lib/map/rotation-button/rotation-button.component.ts","./packages/geo/src/lib/overlay/shared/overlay.enum.ts","./packages/geo/src/lib/overlay/shared/overlay.service.ts","./packages/geo/src/lib/overlay/shared/overlay.directive.ts","./packages/geo/src/lib/print/shared/geopdf.ts","./packages/geo/src/lib/print/shared/print.type.ts","./packages/geo/src/lib/print/shared/print.service.ts","./packages/geo/src/lib/layer/utils/outputLegend.ts","./packages/geo/src/lib/print/print-form/print-form.component.html","./packages/geo/src/lib/print/print-form/print-form.component.ts","./packages/geo/src/lib/print/print/print.component.ts","./packages/geo/src/lib/print/print/print.component.html","./packages/geo/src/lib/directions/shared/directions.enum.ts","./packages/geo/src/lib/directions/shared/directions.utils.ts","./packages/geo/src/lib/directions/shared/directions.service.ts","./packages/geo/src/lib/directions/shared/store.ts","./packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.html","./packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.ts","./packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.html","./packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.ts","./packages/geo/src/lib/directions/directions-results/directions-results.component.html","./packages/geo/src/lib/directions/directions-results/directions-results.component.ts","./packages/geo/src/lib/directions/directions.component.ts","./packages/geo/src/lib/directions/directions.component.html","./packages/geo/src/lib/directions/directions-sources/osrm-directions-source.ts","./packages/geo/src/lib/directions/directions-sources/directions-source.provider.ts","./packages/geo/src/lib/search/shared/search.enums.ts","./packages/geo/src/lib/search/shared/search-pointer-summary.directive.ts","./packages/geo/src/lib/search/shared/sources/cadastre.ts","./packages/geo/src/lib/search/shared/sources/cadastre.providers.ts","./packages/geo/src/lib/search/shared/sources/nominatim.ts","./packages/geo/src/lib/search/shared/sources/nominatim.providers.ts","./packages/geo/src/lib/search/shared/sources/storedqueries.ts","./packages/geo/src/lib/search/shared/sources/storedqueries.providers.ts","./packages/geo/src/lib/search/shared/sources/workspace.ts","./packages/geo/src/lib/search/shared/sources/workspace.providers.ts","./packages/geo/src/lib/search/search-selector/search-selector.component.html","./packages/geo/src/lib/search/search-selector/search-selector.component.ts","./packages/geo/src/lib/search/search-settings/search-settings.component.html","./packages/geo/src/lib/search/search-settings/search-settings.component.ts","./packages/geo/src/lib/search/search-bar/search-bar.component.html","./packages/geo/src/lib/search/search-bar/search-bar.component.ts","./packages/geo/src/lib/search/search-results/search-results-item.component.html","./packages/geo/src/lib/search/search-results/search-results-item.component.ts","./packages/geo/src/lib/search/search-results/save-feature-dialog.component.html","./packages/geo/src/lib/search/search-results/save-feature-dialog.component.ts","./packages/geo/src/lib/search/search-results/search-results-add-button.component.html","./packages/geo/src/lib/search/search-results/search-results-add-button.component.ts","./packages/common/src/lib/collapsible/collapsible.component.ts","./packages/common/src/lib/collapsible/collapsible.component.html","./packages/geo/src/lib/search/search-results/search-results.component.html","./packages/geo/src/lib/search/search-results/search-results.component.ts","./packages/geo/src/lib/workspace/shared/wfs-workspace.ts","./packages/geo/src/lib/style/shared/vector/commonVectorStyle.ts","./packages/geo/src/lib/workspace/shared/workspace.utils.ts","./packages/geo/src/lib/workspace/shared/wfs-workspace.service.ts","./packages/geo/src/lib/workspace/shared/feature-workspace.ts","./packages/geo/src/lib/workspace/shared/feature-workspace.service.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.html","./packages/geo/src/lib/workspace/shared/edition-workspace.ts","./packages/geo/src/lib/workspace/shared/edition-workspace.service.ts","./packages/geo/src/lib/workspace/shared/wms-workspace.service.ts","./packages/geo/src/lib/workspace/workspace-selector/workspace-selector.directive.ts","./packages/geo/src/lib/style/style-modal/layer/style-modal-layer.component.html","./packages/geo/src/lib/style/style-modal/layer/style-modal-layer.component.ts","./packages/geo/src/lib/style/style-modal/layer-button/style-modal-layer-button.component.ts","./packages/geo/src/lib/style/style-modal/layer-button/style-modal-layer-button.component.html","./packages/geo/src/lib/map/info-section/info-section.component.html","./packages/geo/src/lib/map/info-section/info-section.component.ts","./demo/src/app/geo/simple-map/simple-map.component.html","./demo/src/app/geo/simple-map/simple-map-routing.module.ts","./demo/src/app/geo/simple-map/simple-map.component.ts","./demo/src/app/geo/simple-map/simple-map.module.ts","./demo/src/app/geo/layer/layer.component.html","./demo/src/app/geo/layer/layer-routing.module.ts","./demo/src/app/geo/layer/layer.component.ts","./demo/src/app/geo/layer/layer.module.ts","./demo/src/app/geo/legend/legend-routing.module.ts","./demo/src/app/geo/legend/legend.component.ts","./demo/src/app/geo/legend/legend.component.html","./demo/src/app/geo/legend/legend.module.ts","./demo/src/app/geo/overlay/overlay-routing.module.ts","./demo/src/app/geo/overlay/overlay.component.ts","./demo/src/app/geo/overlay/overlay.component.html","./demo/src/app/geo/overlay/overlay.module.ts","./demo/src/app/geo/geometry/geometry.component.html","./demo/src/app/geo/geometry/geometry-routing.module.ts","./demo/src/app/geo/geometry/geometry.component.ts","./demo/src/app/geo/geometry/geometry.module.ts","./demo/src/app/geo/feature/feature-routing.module.ts","./demo/src/app/geo/feature/feature.component.ts","./demo/src/app/geo/feature/feature.component.html","./demo/src/app/geo/feature/feature.module.ts","./demo/src/app/geo/hover/hover-routing.module.ts","./demo/src/app/geo/hover/hover.component.ts","./demo/src/app/geo/hover/hover.component.html","./demo/src/app/geo/hover/hover.module.ts","./demo/src/app/geo/measure/measure-routing.module.ts","./demo/src/app/geo/measure/measure.component.ts","./demo/src/app/geo/measure/measure.component.html","./demo/src/app/geo/measure/measure.module.ts","./demo/src/app/geo/draw/draw-routing.module.ts","./demo/src/app/geo/draw/draw.component.ts","./demo/src/app/geo/draw/draw.component.html","./demo/src/app/geo/draw/draw.module.ts","./demo/src/app/geo/query/query.component.html","./demo/src/app/geo/query/query-routing.module.ts","./demo/src/app/geo/query/query.component.ts","./demo/src/app/geo/query/query.module.ts","./demo/src/app/geo/catalog/catalog-routing.module.ts","./demo/src/app/geo/catalog/catalog.component.ts","./demo/src/app/geo/catalog/catalog.component.html","./demo/src/app/geo/catalog/catalog.module.ts","./packages/context/src/lib/context-import-export/context-import-export.module.ts","./packages/context/src/lib/context-manager/shared/context.enum.ts","./packages/context/src/lib/context-manager/shared/context.service.ts","./packages/context/src/lib/context-manager/shared/map-context.directive.ts","./packages/context/src/lib/context-import-export/shared/context-import.utils.ts","./packages/context/src/lib/context-manager/shared/layer-context.directive.ts","./packages/context/src/lib/context-map-button/poi-button/shared/poi.service.ts","./packages/context/src/lib/context-map-button/context-map-button.module.ts","./packages/context/src/lib/context-manager/context-manager.module.ts","./packages/context/src/lib/share-map/share-map.module.ts","./packages/context/src/lib/sidenav/sidenav.module.ts","./packages/context/src/lib/context.module.ts","./packages/context/src/lib/context-import-export/shared/context-export.errors.ts","./packages/context/src/lib/context-import-export/shared/context-export.service.ts","./packages/context/src/lib/context-import-export/shared/context-import.errors.ts","./packages/context/src/lib/context-import-export/shared/context-import.service.ts","./packages/context/src/lib/context-import-export/context-import-export/context-import-export.component.html","./packages/context/src/lib/context-import-export/context-import-export/context-import-export.component.ts","./packages/context/src/lib/context-import-export/shared/context-export.utils.ts","./packages/context/src/lib/context-manager/context-list/context-list.enum.ts","./packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.ts","./packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.html","./packages/context/src/lib/context-manager/context-item/context-item.component.html","./packages/context/src/lib/context-manager/context-item/context-item.component.ts","./packages/context/src/lib/context-manager/context-list/context-list.component.html","./packages/context/src/lib/context-manager/context-list/context-list.component.ts","./packages/context/src/lib/context-manager/context-list/context-list-binding.directive.ts","./packages/context/src/lib/context-manager/context-form/context-form.component.html","./packages/context/src/lib/context-manager/context-form/context-form.component.ts","./packages/context/src/lib/context-manager/context-edit/context-edit.component.html","./packages/context/src/lib/context-manager/context-edit/context-edit.component.ts","./packages/context/src/lib/context-manager/context-edit/context-edit-binding.directive.ts","./packages/context/src/lib/context-manager/context-permissions/context-permissions.component.html","./packages/context/src/lib/context-manager/context-permissions/context-permissions.component.ts","./packages/context/src/lib/context-manager/context-permissions/context-permissions-binding.directive.ts","./packages/context/src/lib/share-map/shared/share-map.service.ts","./packages/context/src/lib/share-map/share-map/share-map-url.component.html","./packages/context/src/lib/share-map/share-map/share-map-url.component.ts","./packages/context/src/lib/share-map/share-map/share-map-api.component.html","./packages/context/src/lib/share-map/share-map/share-map-api.component.ts","./packages/context/src/lib/share-map/share-map/share-map.component.html","./packages/context/src/lib/share-map/share-map/share-map.component.ts","./packages/integration/src/lib/search/search-bar/search-bar.module.ts","./packages/integration/src/lib/search/search-results-tool/search-results-tool.module.ts","./packages/integration/src/lib/search/search.module.ts","./packages/integration/src/lib/about/about-tool/about-tool.component.html","./packages/integration/src/lib/about/about-tool/about-tool.component.ts","./packages/integration/src/lib/import-export/import-export.state.ts","./packages/integration/src/lib/tool/tool.state.ts","./packages/integration/src/lib/context/context.state.ts","./packages/integration/src/lib/storage/storage.state.ts","./packages/integration/src/lib/workspace/shared/workspace.utils.ts","./packages/integration/src/lib/workspace/shared/feature-actions.service.ts","./packages/integration/src/lib/workspace/shared/wfs-actions.service.ts","./packages/integration/src/lib/workspace/shared/edition-actions.service.ts","./packages/integration/src/lib/workspace/workspace.state.ts","./packages/integration/src/lib/map/map.state.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-swipe/advanced-swipe.component.html","./packages/integration/src/lib/map/advanced-map-tool/advanced-swipe/advanced-swipe.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-coordinates/advanced-coordinates.component.html","./packages/integration/src/lib/map/advanced-map-tool/advanced-coordinates/advanced-coordinates.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-map-tool.component.ts","./packages/integration/src/lib/map/advanced-map-tool/advanced-map-tool.component.html","./packages/integration/src/lib/map/map-proximity.state.ts","./packages/integration/src/lib/map/map-proximity-tool/map-proximity-tool.component.html","./packages/integration/src/lib/map/map-proximity-tool/map-proximity-tool.component.ts","./packages/integration/src/lib/workspace/workspace-button/workspace-button.component.html","./packages/integration/src/lib/workspace/workspace-button/workspace-button.component.ts","./packages/integration/src/lib/map/map-details-tool/map-details-tool.component.html","./packages/integration/src/lib/map/map-details-tool/map-details-tool.component.ts","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list-binding.directive.ts","./packages/integration/src/lib/map/map-legend/map-legend-tool.component.html","./packages/integration/src/lib/map/map-legend/map-legend-tool.component.ts","./packages/integration/src/lib/map/map-tool/map-tool.component.html","./packages/integration/src/lib/map/map-tool/map-tool.component.ts","./packages/integration/src/lib/map/layer-list-tool.state.ts","./packages/integration/src/lib/map/map-tools/map-tools.component.html","./packages/integration/src/lib/map/map-tools/map-tools.component.ts","./packages/integration/src/lib/search/search.state.ts","./packages/integration/src/lib/context/context-manager-tool/context-manager-tool.component.ts","./packages/integration/src/lib/context/context-manager-tool/context-manager-tool.component.html","./packages/integration/src/lib/context/context-editor-tool/context-editor-tool.component.ts","./packages/integration/src/lib/context/context-editor-tool/context-editor-tool.component.html","./packages/integration/src/lib/context/context-permission-manager-tool/context-permission-manager-tool.component.ts","./packages/integration/src/lib/context/context-permission-manager-tool/context-permission-manager-tool.component.html","./packages/integration/src/lib/context/context-share-tool/context-share-tool.component.ts","./packages/integration/src/lib/context/context-share-tool/context-share-tool.component.html","./packages/integration/src/lib/catalog/catalog.state.ts","./packages/integration/src/lib/catalog/catalog-browser-tool/catalog-browser-tool.component.html","./packages/integration/src/lib/catalog/catalog-browser-tool/catalog-browser-tool.component.ts","./packages/integration/src/lib/catalog/catalog-library-tool/catalog-library-tool.component.ts","./packages/integration/src/lib/catalog/catalog-library-tool/catalog-library-tool.component.html","./packages/integration/src/lib/directions/directions.state.ts","./packages/integration/src/lib/directions/directions-tool/directions-tool.component.ts","./packages/integration/src/lib/directions/directions-tool/directions-tool.component.html","./packages/integration/src/lib/draw/draw.state.ts","./packages/integration/src/lib/draw/drawing-tool/drawing-tool.component.ts","./packages/integration/src/lib/draw/drawing-tool/drawing-tool.component.html","./packages/integration/src/lib/filter/ogc-filter-tool/ogc-filter-tool.component.ts","./packages/integration/src/lib/filter/ogc-filter-tool/ogc-filter-tool.component.html","./packages/integration/src/lib/filter/active-ogc-filter-tool/active-ogc-filter-tool.animation.ts","./packages/integration/src/lib/filter/active-ogc-filter-tool/active-ogc-filter-tool.component.ts","./packages/integration/src/lib/filter/active-ogc-filter-tool/active-ogc-filter-tool.component.html","./packages/integration/src/lib/filter/spatial-filter-tool/spatial-filter-tool.component.html","./packages/integration/src/lib/filter/spatial-filter-tool/spatial-filter-tool.component.ts","./packages/geo/src/lib/filter/time-filter-list/time-filter-list-binding.directive.ts","./packages/integration/src/lib/filter/time-filter-tool/time-filter-tool.component.ts","./packages/integration/src/lib/filter/time-filter-tool/time-filter-tool.component.html","./packages/integration/src/lib/filter/active-time-filter-tool/active-time-filter-tool.animation.ts","./packages/integration/src/lib/filter/active-time-filter-tool/active-time-filter-tool.component.ts","./packages/integration/src/lib/filter/active-time-filter-tool/active-time-filter-tool.component.html","./packages/integration/src/lib/import-export/import-export-tool/import-export-tool.component.html","./packages/integration/src/lib/import-export/import-export-tool/import-export-tool.component.ts","./packages/integration/src/lib/measure/measure.state.ts","./packages/integration/src/lib/measure/measurer-tool/measurer-tool.component.ts","./packages/integration/src/lib/measure/measurer-tool/measurer-tool.component.html","./packages/integration/src/lib/print/print-tool/print-tool.component.ts","./packages/integration/src/lib/print/print-tool/print-tool.component.html","./packages/integration/src/lib/search/search-results-tool/search-results-tool.component.html","./packages/integration/src/lib/search/search-results-tool/search-results-tool.component.ts","./packages/common/src/lib/context-menu/context-menu.directive.ts","./demo/src/app/geo/search/search.component.html","./demo/src/app/geo/search/search-routing.module.ts","./demo/src/app/geo/search/search.component.ts","./demo/src/app/geo/search/search.module.ts","./demo/src/app/geo/print/print-routing.module.ts","./demo/src/app/geo/print/print.component.ts","./demo/src/app/geo/print/print.component.html","./demo/src/app/geo/print/print.module.ts","./demo/src/app/geo/import-export/import-export-routing.module.ts","./demo/src/app/geo/import-export/import-export.component.ts","./demo/src/app/geo/import-export/import-export.component.html","./demo/src/app/geo/import-export/import-export.module.ts","./demo/src/app/geo/directions/directions-routing.module.ts","./demo/src/app/geo/directions/directions.component.ts","./demo/src/app/geo/directions/directions.component.html","./demo/src/app/geo/directions/directions.module.ts","./demo/src/app/geo/time-filter/time-filter-routing.module.ts","./demo/src/app/geo/time-filter/time-filter.component.ts","./demo/src/app/geo/time-filter/time-filter.component.html","./demo/src/app/geo/time-filter/time-filter.module.ts","./demo/src/app/geo/ogc-filter/ogc-filter-routing.module.ts","./demo/src/app/geo/ogc-filter/ogc-filter.component.ts","./demo/src/app/geo/ogc-filter/ogc-filter.component.html","./demo/src/app/geo/ogc-filter/ogc-filter.module.ts","./demo/src/app/geo/spatial-filter/spatial-filter.component.html","./demo/src/app/geo/spatial-filter/spatial-filter-routing.module.ts","./demo/src/app/geo/spatial-filter/spatial-filter.component.ts","./demo/src/app/geo/spatial-filter/spatial-filter.module.ts","./demo/src/app/geo/workspace/workspace.component.html","./demo/src/app/geo/workspace/workspace-routing.module.ts","./demo/src/app/geo/workspace/workspace.component.ts","./demo/src/app/geo/workspace/workspace.module.ts","./demo/src/app/context/context/context.component.html","./demo/src/app/context/context/context-routing.module.ts","./demo/src/app/context/context/context.component.ts","./demo/src/app/context/context/context.module.ts","./demo/src/app/app-routing.module.ts","./demo/src/app/app.component.ts","./demo/src/app/app.component.html","./demo/src/app/app.module.ts","./demo/src/main.ts","./node_modules/moment/locale/ sync ^\\.\\/.*$"],"sourcesContent":["/* eslint-disable */\n\nconst ALPHA =\n  'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\nexport class Base64 {\n  private static PADCHAR: string = '=';\n  private static ALPHA: string = ALPHA;\n\n  private static getByte(s: string, i: number): number {\n    const x = s.charCodeAt(i);\n    return x;\n  }\n\n  private static getByte64(s: string, i: number): number {\n    const idx = this.ALPHA.indexOf(s.charAt(i));\n    return idx;\n  }\n\n  public static decode(s: string): string {\n    let pads = 0,\n      i,\n      b10,\n      imax = s.length,\n      x = [];\n\n    s = String(s);\n\n    if (imax === 0) {\n      return s;\n    }\n\n    if (s.charAt(imax - 1) === this.PADCHAR) {\n      pads = 1;\n      if (s.charAt(imax - 2) === this.PADCHAR) {\n        pads = 2;\n      }\n      imax -= 4;\n    }\n\n    for (i = 0; i < imax; i += 4) {\n      b10 =\n        (this.getByte64(s, i) << 18) |\n        (this.getByte64(s, i + 1) << 12) |\n        (this.getByte64(s, i + 2) << 6) |\n        this.getByte64(s, i + 3);\n      x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255, b10 & 255));\n    }\n\n    switch (pads) {\n      case 1:\n        b10 =\n          (this.getByte64(s, i) << 18) |\n          (this.getByte64(s, i + 1) << 12) |\n          (this.getByte64(s, i + 2) << 6);\n        x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255));\n        break;\n      case 2:\n        b10 = (this.getByte64(s, i) << 18) | (this.getByte64(s, i + 1) << 12);\n        x.push(String.fromCharCode(b10 >> 16));\n        break;\n    }\n\n    return x.join('');\n  }\n\n  public static encode(s: string): string {\n    s = String(s);\n\n    let i,\n      b10,\n      x = [],\n      imax = s.length - (s.length % 3);\n\n    if (s.length === 0) {\n      return s;\n    }\n\n    for (i = 0; i < imax; i += 3) {\n      b10 =\n        (this.getByte(s, i) << 16) |\n        (this.getByte(s, i + 1) << 8) |\n        this.getByte(s, i + 2);\n      x.push(this.ALPHA.charAt(b10 >> 18));\n      x.push(this.ALPHA.charAt((b10 >> 12) & 63));\n      x.push(this.ALPHA.charAt((b10 >> 6) & 63));\n      x.push(this.ALPHA.charAt(b10 & 63));\n    }\n\n    switch (s.length - imax) {\n      case 1:\n        b10 = this.getByte(s, i) << 16;\n        x.push(\n          this.ALPHA.charAt(b10 >> 18) +\n            this.ALPHA.charAt((b10 >> 12) & 63) +\n            this.PADCHAR +\n            this.PADCHAR\n        );\n        break;\n      case 2:\n        b10 = (this.getByte(s, i) << 16) | (this.getByte(s, i + 1) << 8);\n        x.push(\n          this.ALPHA.charAt(b10 >> 18) +\n            this.ALPHA.charAt((b10 >> 12) & 63) +\n            this.ALPHA.charAt((b10 >> 6) & 63) +\n            this.PADCHAR\n        );\n        break;\n    }\n\n    return x.join('');\n  }\n}\n","import { HttpParams } from '@angular/common/http';\n\nexport function customCacheHasher(parameters: unknown[]): unknown[] {\n  return parameters.map((param) => {\n    if (param instanceof HttpParams) {\n      return param.toString();\n    }\n    return param !== undefined ? JSON.parse(JSON.stringify(param)) : param;\n  });\n}\n","import * as Bowser from 'bowser';\n\nexport interface UserAgent extends Bowser.Parser.Parser {\n  compareVersion: (version: string) => boolean;\n}\n\nexport const userAgent = Bowser.getParser(\n  window.navigator.userAgent\n) as UserAgent;\n","import { userAgent } from './user-agent';\n\nexport class Clipboard {\n  static copy(element: HTMLTextAreaElement | string): boolean {\n    let successful = false;\n    if (typeof element === 'string') {\n      const textArea = Clipboard.createTextArea(element);\n      Clipboard.selectText(textArea);\n      successful = Clipboard.copyTextToClipboard();\n      Clipboard.destroyTextArea(textArea);\n    } else {\n      Clipboard.selectText(element);\n      successful = Clipboard.copyTextToClipboard();\n    }\n    return successful;\n  }\n\n  private static createTextArea(text: string): HTMLTextAreaElement {\n    const textArea = document.createElement('textArea') as HTMLTextAreaElement;\n    textArea.value = text;\n    document.body.appendChild(textArea);\n    return textArea;\n  }\n\n  private static destroyTextArea(textArea) {\n    document.body.removeChild(textArea);\n  }\n\n  private static selectText(textArea) {\n    if (userAgent.getOSName() === 'iOS') {\n      const oldContentEditable = textArea.contentEditable;\n      const oldReadOnly = textArea.readOnly;\n      const range = document.createRange();\n      const selection = window.getSelection();\n\n      textArea.contenteditable = true;\n      textArea.readonly = false;\n      range.selectNodeContents(textArea);\n      selection.removeAllRanges();\n      selection.addRange(range);\n      textArea.setSelectionRange(0, 999999);\n      textArea.contentEditable = oldContentEditable;\n      textArea.readOnly = oldReadOnly;\n    } else {\n      textArea.select();\n    }\n  }\n\n  private static copyTextToClipboard(): boolean {\n    if (!(userAgent.getOSName() === 'iOS' && userAgent.compareVersion('<10'))) {\n      return document.execCommand('copy');\n    }\n    return false;\n  }\n}\n","export class StringUtils {\n  static diff(s1: string, s2: string, p = 4): string {\n    if (!s1 && !s2) {\n      return '';\n    }\n    if (!s1) {\n      return '<span class=\"inserted\">' + s2 + '</span>';\n    }\n    if (!s2) {\n      return '<span class=\"deleted\">' + s1 + '</span>';\n    }\n    s1 = s1.toString();\n    s2 = s2.toString();\n    const changeData = StringUtils.getChanges(s1, s2, '', p);\n    const nextS = s2.slice(\n      changeData.mtc.length + changeData.ins.length + changeData.sbs.length\n    ); // remaining part of \"s\"\n    const nextThis = s1.slice(\n      changeData.mtc.length + changeData.del.length + changeData.sbs.length\n    ); // remaining part of \"this\"\n    let result = ''; // the glorious result\n    if (changeData.del.length > 0) {\n      changeData.del = '<span class=\"deleted\">' + changeData.del + '</span>';\n    }\n    if (changeData.ins.length > 0) {\n      changeData.ins = '<span class=\"inserted\">' + changeData.ins + '</span>';\n    }\n    result = changeData.mtc + changeData.del + changeData.ins + changeData.sbs;\n    result +=\n      nextThis !== '' || nextS !== ''\n        ? StringUtils.diff(nextThis, nextS, p)\n        : '';\n    return result;\n  }\n\n  private static getMatchingSubstring(s, l, m) {\n    // returns the first matching substring in-between the two strings\n    let i = 0;\n    let match = false;\n    const slen = s.length;\n    const o = { fis: slen, mtc: m, sbs: '' }; // temporary object used to construct the cd (change data) object\n\n    while (i < slen) {\n      l[i] === s[i]\n        ? match\n          ? (o.sbs += s[i]) // o.sbs holds the matching substring itsef\n          : ((match = true), (o.fis = i), (o.sbs = s[i]))\n        : match\n        ? (i = slen) // stop after the first found substring\n        : (i = i);\n      ++i;\n    }\n    return o;\n  }\n\n  private static getChanges(s1, s2, m, p) {\n    const isThisLonger = s1.length >= s1.length ? true : false;\n    let [longer, shorter] = isThisLonger ? [s1, s2] : [s2, s1]; // assignment of longer and shorter by es6 destructuring\n    let bi = 0; // base index designating the index of first mismacthing character in both strings\n\n    while (shorter[bi] === longer[bi] && bi < shorter.length) {\n      ++bi;\n    } // make bi the index of first mismatching character\n    longer = longer.split('').slice(bi); // as the longer string will be rotated it is converted into array\n    shorter = shorter.slice(bi); // shorter and longer now starts from the first mismatching character\n\n    const len = longer.length; // length of the longer string\n    let cd: any = {\n      fis: shorter.length, // the index of matching string in the shorter string\n      fil: len, // the index of matching string in the longer string\n      sbs: '', // the matching substring itself\n      mtc: m + s2.slice(0, bi)\n    }; // if exists mtc holds the matching string at the front\n    let sub: any = { sbs: '' }; // returned substring per 1 character rotation of the longer string\n\n    if (shorter !== '') {\n      for (let rc = 0; rc < len && sub.sbs.length < p; rc++) {\n        // rc -> rotate count, p -> precision factor\n        sub = StringUtils.getMatchingSubstring(\n          shorter,\n          StringUtils.rotateArray(longer, rc),\n          cd.mtc\n        ); // rotate longer string 1 char and get substring\n        sub.fil =\n          rc < len - sub.fis\n            ? sub.fis + rc // mismatch is longer than the mismatch in short\n            : sub.fis - len + rc; // mismatch is shorter than the mismatch in short\n        if (sub.sbs.length > cd.sbs.length) {\n          cd = sub; // only keep the one with the longest substring.\n        }\n      }\n    }\n    // insert the mismatching delete subsrt and insert substr to the cd object and attach the previous substring\n    [cd.del, cd.ins] = isThisLonger\n      ? [longer.slice(0, cd.fil).join(''), shorter.slice(0, cd.fis)]\n      : [shorter.slice(0, cd.fis), longer.slice(0, cd.fil).join('')];\n    return cd.del.indexOf(' ') === -1 ||\n      cd.ins.indexOf(' ') === -1 ||\n      cd.del === '' ||\n      cd.ins === '' ||\n      cd.sbs === ''\n      ? cd\n      : StringUtils.getChanges(cd.del, cd.ins, cd.mtc, p);\n  }\n\n  private static rotateArray(array, n) {\n    const len = array.length;\n    const res = new Array(array.length);\n    if (n % len === 0) {\n      return array.slice();\n    } else {\n      for (let i = 0; i < len; i++) {\n        res[i] = array[(i + (len + (n % len))) % len];\n      }\n    }\n    return res;\n  }\n\n  static isValidNumber(value: string): boolean {\n    return !isNaN(Number(value));\n  }\n\n  static isOctalNumber(value: string): boolean {\n    return (\n      StringUtils.isValidNumber(value) &&\n      value.startsWith('0') &&\n      value.length > 1\n    );\n  }\n}\n","export enum ChangeType {\n  ADDED = 'added',\n  DELETED = 'deleted',\n  MODIFIED = 'modified'\n}\n\nexport interface Change {\n  type: ChangeType;\n  keysChanged?: {\n    key: string;\n    newValue: any;\n    oldValue: any;\n  }[];\n}\n\nexport interface GroupingChanges {\n  added: ChangeItem[];\n  deleted: ChangeItem[];\n  modified: ChangeItem[];\n}\n\nexport interface ChangeItem {\n  change: Change;\n  value: any;\n  oldValue?: any;\n  newValue?: any;\n}\n","import { StringUtils } from './string-utils';\nimport { GroupingChanges, ChangeType } from './change.interface';\n\nexport class ChangeUtils {\n  static findChanges(\n    obj1: any[],\n    obj2: any[],\n    ignoreKeys: string[] = []\n  ): GroupingChanges {\n    const items: GroupingChanges = {\n      added: [],\n      deleted: [],\n      modified: []\n    };\n\n    if (!obj1 || !obj2) {\n      return items;\n    }\n\n    const obj1Clone: any = [...obj1];\n    const obj2Clone: any = [...obj2];\n\n    for (const fromItem of obj1Clone) {\n      const index = obj2Clone.findIndex((s) => s.id === fromItem.id);\n\n      if (index === -1) {\n        items.deleted.push({\n          change: { type: ChangeType.DELETED },\n          value: fromItem\n        });\n        continue;\n      }\n\n      const toItem = obj2Clone.splice(index, 1)[0];\n      const fromItemClone = JSON.parse(JSON.stringify(fromItem));\n      const toItemClone = JSON.parse(JSON.stringify(toItem));\n\n      const keysChanged = ChangeUtils.compareObject(\n        fromItemClone,\n        toItemClone,\n        undefined,\n        ignoreKeys\n      );\n\n      if (keysChanged.length) {\n        items.modified.push({\n          change: {\n            type: ChangeType.MODIFIED,\n            keysChanged\n          },\n          value: fromItemClone,\n          oldValue: fromItem,\n          newValue: toItem\n        });\n      }\n    }\n\n    items.added = obj2Clone.map((itemAdded) => {\n      return {\n        change: { type: ChangeType.ADDED },\n        value: itemAdded\n      };\n    });\n\n    return items;\n  }\n\n  private static compareObject(fromItem, toItem, baseKey?, ignoreKeys = []) {\n    const fromItemClone = JSON.parse(JSON.stringify(fromItem));\n    const toItemClone = JSON.parse(JSON.stringify(toItem));\n\n    const keys: any = new Set([\n      ...Object.keys(fromItem),\n      ...Object.keys(toItem)\n    ]);\n    let keysChanged = [];\n    keys.forEach((key) => {\n      const keyString = baseKey ? `${baseKey}.${key}` : key;\n      if (ignoreKeys.indexOf(keyString) !== -1) {\n        return;\n      }\n\n      if (Array.isArray(fromItem[key])) {\n        fromItem[key] = fromItem[key].join(',<br>');\n      }\n      if (Array.isArray(toItem[key])) {\n        toItem[key] = toItem[key].join(',<br>');\n      }\n\n      if (\n        typeof fromItem[key] === 'object' &&\n        typeof toItem[key] === 'object' &&\n        fromItem[key] !== null &&\n        toItem[key] !== null\n      ) {\n        keysChanged = keysChanged.concat(\n          this.compareObject(fromItem[key], toItem[key], keyString)\n        );\n      } else {\n        if (fromItem[key] !== toItem[key]) {\n          keysChanged.push({\n            key: keyString,\n            oldValue: fromItemClone[key],\n            newValue: toItemClone[key]\n          });\n          fromItem[key] = StringUtils.diff(fromItem[key], toItem[key]);\n        }\n      }\n    });\n\n    return keysChanged;\n  }\n}\n","export class DomUtils {\n  static create<K extends keyof HTMLElementTagNameMap>(\n    doc: Document,\n    tagName: K,\n    options?: Partial<HTMLElementTagNameMap[K]>\n  ): HTMLElementTagNameMap[K] {\n    const el = doc.createElement(tagName);\n\n    for (const key in options) {\n      el[key] = options[key];\n    }\n\n    return el;\n  }\n\n  static remove(node: HTMLElement | SVGElement): void {\n    if (!node.parentNode) {\n      return;\n    }\n    node.parentNode.removeChild(node);\n  }\n}\n","/**\n * Trigger download of a file\n *\n * @param content File content\n * @param mimeType File mime type\n * @param fileName File name\n */\nexport function downloadContent(\n  content: string,\n  mimeType: string,\n  fileName: string\n) {\n  const uri = `data:${mimeType},${encodeURIComponent(content)}`;\n  downloadFromUri(uri, fileName);\n}\n\n/**\n * Trigger download of a file\n *\n * @param content File content\n * @param mimeType File mime type\n * @param fileName File name\n */\nexport function downloadFromUri(uri: string, fileName: string) {\n  const element = document.createElement('a');\n  element.setAttribute('href', uri);\n  element.setAttribute('download', fileName);\n  element.style.display = 'none';\n  document.body.appendChild(element);\n\n  element.click();\n\n  document.body.removeChild(element);\n}\n","export class ObjectUtils {\n  static resolve(obj: object, key: string): any {\n    const keysArray = key.replace(/\\[/g, '.').replace(/\\]/g, '').split('.');\n    let current = obj;\n    while (keysArray.length) {\n      if (typeof current !== 'object') {\n        return undefined;\n      }\n      current = current[keysArray.shift()];\n    }\n\n    return current;\n  }\n\n  static isObject(item: object) {\n    return (\n      item &&\n      typeof item === 'object' &&\n      !Array.isArray(item) &&\n      item !== null &&\n      !(item instanceof Date)\n    );\n  }\n\n  static mergeDeep(\n    target: object,\n    source: object,\n    ignoreUndefined = false\n  ): any {\n    const output = Object.assign({}, target);\n    if (ObjectUtils.isObject(target) && ObjectUtils.isObject(source)) {\n      Object.keys(source)\n        .filter((key) => !ignoreUndefined || source[key] !== undefined)\n        .forEach((key) => {\n          if (ObjectUtils.isObject(source[key])) {\n            if (!(key in target)) {\n              Object.assign(output, { [key]: source[key] });\n            } else {\n              output[key] = ObjectUtils.mergeDeep(\n                target[key],\n                source[key],\n                ignoreUndefined\n              );\n            }\n          } else {\n            Object.assign(output, { [key]: source[key] });\n          }\n        });\n    }\n    return output;\n  }\n\n  static copyDeep(src): any {\n    const target = Array.isArray(src) ? [] : {};\n    for (const prop in src) {\n      if (src.hasOwnProperty(prop)) {\n        const value = src[prop];\n        if (value && typeof value === 'object') {\n          target[prop] = this.copyDeep(value);\n        } else {\n          target[prop] = value;\n        }\n      }\n    }\n    return target;\n  }\n\n  static removeDuplicateCaseInsensitive(obj: object) {\n    const summaryCapitalizeObject = {};\n    const capitalizeObject = {};\n    const upperCaseCount = [];\n\n    for (const property in obj) {\n      if (obj.hasOwnProperty(property)) {\n        const upperCaseProperty = property.toUpperCase();\n        if (!summaryCapitalizeObject.hasOwnProperty(upperCaseProperty)) {\n          summaryCapitalizeObject[upperCaseProperty] = [\n            { [property]: obj[property] }\n          ];\n        } else {\n          summaryCapitalizeObject[upperCaseProperty].push({\n            [property]: obj[property]\n          });\n        }\n        // counting the number of uppercase lettersMna\n        upperCaseCount.push({\n          key: property,\n          count: property.replace(/[^A-Z]/g, '').length\n        });\n      }\n    }\n    for (const capitalizedProperty in summaryCapitalizeObject) {\n      if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\n        if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\n          const capitalizedPropertyObject =\n            summaryCapitalizeObject[capitalizedProperty];\n          if (capitalizedPropertyObject.length === 1) {\n            // for single params (no duplicates)\n            const singlePossibility = capitalizedPropertyObject[0];\n            capitalizeObject[capitalizedProperty] =\n              singlePossibility[Object.keys(singlePossibility)[0]];\n          } else if (capitalizedPropertyObject.length > 1) {\n            // defining the closest to lowercase property\n            const paramClosestToLowercase = upperCaseCount\n              .filter(\n                (f) => f.key.toLowerCase() === capitalizedProperty.toLowerCase()\n              )\n              .reduce((prev, current) => {\n                return prev.y < current.y ? prev : current;\n              });\n            capitalizeObject[paramClosestToLowercase.key.toUpperCase()] =\n              obj[paramClosestToLowercase.key];\n          }\n        }\n      }\n    }\n    for (const property in obj) {\n      if (obj.hasOwnProperty(property)) {\n        delete obj[property];\n      }\n    }\n\n    for (const property in capitalizeObject) {\n      if (capitalizeObject.hasOwnProperty(property)) {\n        obj[property] = capitalizeObject[property];\n      }\n    }\n  }\n\n  static removeUndefined(obj: object): any {\n    const output = {};\n    if (ObjectUtils.isObject(obj)) {\n      Object.keys(obj)\n        .filter((key) => obj[key] !== undefined)\n        .forEach((key) => {\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\n            output[key] = ObjectUtils.removeUndefined(obj[key]);\n          } else {\n            output[key] = obj[key];\n          }\n        });\n\n      return output;\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map((o) => ObjectUtils.removeUndefined(o));\n    }\n\n    return obj;\n  }\n\n  static removeNull(obj: object): any {\n    const output = {};\n    if (ObjectUtils.isObject(obj)) {\n      Object.keys(obj)\n        .filter((key) => obj[key] !== null)\n        .forEach((key) => {\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\n            output[key] = ObjectUtils.removeNull(obj[key]);\n          } else {\n            output[key] = obj[key];\n          }\n        });\n\n      return output;\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map((o) => ObjectUtils.removeNull(o));\n    }\n\n    return obj;\n  }\n\n  static naturalCompare(a, b, direction = 'asc', nullsFirst?: boolean) {\n    if (direction === 'desc') {\n      b = [a, (a = b)][0];\n    }\n\n    // nullsFirst = undefined : end if direction = 'asc', first if direction = 'desc'\n    // nullsFirst = true : always first\n    // nullsFirst = false : always end\n    if (\n      a === null ||\n      a === '' ||\n      a === undefined ||\n      b === null ||\n      b === '' ||\n      b === undefined\n    ) {\n      const nullScore =\n        a === b\n          ? 0\n          : a === undefined\n          ? 3\n          : b === undefined\n          ? -3\n          : a === null\n          ? 2\n          : b === null\n          ? -2\n          : a === ''\n          ? 1\n          : -1;\n      if (direction === 'desc') {\n        return nullsFirst !== false ? nullScore : nullScore * -1;\n      }\n      return nullsFirst === true ? nullScore * -1 : nullScore;\n    }\n\n    const ax = [];\n    const bx = [];\n    a = '' + a;\n    b = '' + b;\n\n    a.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\n      ax.push([$1 || Infinity, $2 || '']);\n    });\n\n    b.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\n      bx.push([$1 || Infinity, $2 || '']);\n    });\n\n    while (ax.length && bx.length) {\n      const an = ax.shift();\n      const bn = bx.shift();\n      const nn = an[0] - bn[0] || an[1].localeCompare(bn[1]);\n      if (nn) {\n        return nn;\n      }\n    }\n\n    return ax.length - bx.length;\n  }\n\n  /**\n   * Return true if two object are equivalent.\n   * Objects are considered equivalent if they have the same properties and\n   * if all of their properties (first-level only) share the same value.\n   * @param obj1 First object\n   * @param obj2 Second object\n   * @returns Whether two objects arer equivalent\n   */\n  static objectsAreEquivalent(obj1: object, obj2: object): boolean {\n    if (obj1 === obj2) {\n      return true;\n    }\n\n    const obj1Props = Object.getOwnPropertyNames(obj1);\n    const obj2Props = Object.getOwnPropertyNames(obj2);\n    if (obj1Props.length !== obj2Props.length) {\n      return false;\n    }\n\n    for (const prop of obj1Props) {\n      if (obj1[prop] !== obj2[prop]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Return a new object with an array of keys removed\n   * @param obj Source object\n   * @param keys Keys to remove\n   * @returns A new object\n   */\n  static removeKeys(obj: object, keys: string[]): object {\n    const newObj = Object.keys(obj)\n      .filter((key) => keys.indexOf(key) < 0)\n      .reduce((_obj, key) => {\n        _obj[key] = obj[key];\n        return _obj;\n      }, {});\n\n    return newObj;\n  }\n\n  static isEmpty(obj: object): boolean {\n    return Object.keys(obj).length === 0;\n  }\n}\n","export class NumberUtils {\n  static roundToNDecimal(num: number, decimal: number = 3): number {\n    const roundFactor = Math.pow(10, decimal);\n    return Math.round(num * roundFactor) / roundFactor;\n  }\n}\n","/** Utility function to create a K:V from a list of strings */\nexport function strEnum<T extends string>(o: Array<T>): { [K in T]: K } {\n  return o.reduce((res, key) => {\n    res[key] = key;\n    return res;\n  }, Object.create(null));\n}\n","export function S4() {\n  // eslint-disable-next-line no-bitwise\n  return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n}\n\nexport function uuid() {\n  const id = `${S4()}${S4()}-${S4()}-${S4()}-${S4()}-${S4()}${S4()}${S4()}`;\n  return id.toLowerCase();\n}\n","import { Subject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nexport enum SubjectStatus {\n  Error = 0,\n  Done = 1,\n  Working = 2,\n  Waiting = 3\n}\n\nexport abstract class Watcher {\n  public status$ = new Subject<SubjectStatus>();\n  protected status$$: Subscription;\n\n  get status(): SubjectStatus {\n    return this._status;\n  }\n  set status(value: SubjectStatus) {\n    this._status = value;\n    this.status$.next(value);\n  }\n  private _status: SubjectStatus;\n\n  protected abstract watch();\n\n  protected abstract unwatch();\n\n  subscribe(callback: Function, scope?: any) {\n    this.watch();\n\n    this.status$$ = this.status$\n      .pipe(distinctUntilChanged())\n      .subscribe((status: SubjectStatus) => {\n        this.handleStatusChange(status);\n        callback.call(scope, this);\n      });\n  }\n\n  unsubscribe() {\n    this.unwatch();\n    if (this.status$$ !== undefined) {\n      this.status$$.unsubscribe();\n      this.status$$ = undefined;\n    }\n    this.status = SubjectStatus.Waiting;\n  }\n\n  protected handleStatusChange(status: SubjectStatus) {}\n}\n","import { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { uuid } from '@igo2/utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ActivityService {\n  public counter$ = new BehaviorSubject<number>(0);\n\n  private ids: string[] = [];\n\n  constructor() {}\n\n  register(): string {\n    const id = uuid();\n    this.ids.push(id);\n    this.counter$.next(this.ids.length);\n\n    return id;\n  }\n\n  unregister(id: string) {\n    const index = this.ids.indexOf(id);\n    if (index === -1) {\n      return;\n    }\n    this.ids.splice(index, 1);\n\n    this.counter$.next(this.ids.length);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport {\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpRequest\n} from '@angular/common/http';\n\nimport { Observable } from 'rxjs';\nimport { finalize } from 'rxjs/operators';\n\nimport { ActivityService } from './activity.service';\n\n@Injectable()\nexport class ActivityInterceptor implements HttpInterceptor {\n  constructor(private activityService: ActivityService) {}\n\n  intercept(\n    req: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const activity = req.headers.get('activityInterceptor');\n    if (activity) {\n      const actReq = req.clone({\n        headers: req.headers.delete('activityInterceptor')\n      });\n      if (activity === 'false') {\n        return next.handle(actReq);\n      }\n    }\n\n    const id = this.activityService.register();\n\n    return next.handle(req).pipe(\n      finalize(() => {\n        this.activityService.unregister(id);\n      })\n    );\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\n\nimport { ActivityInterceptor } from './activity.interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoActivityModule {\n  static forRoot(): ModuleWithProviders<IgoActivityModule> {\n    return {\n      ngModule: IgoActivityModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: ActivityInterceptor,\n          multi: true\n        }\n      ]\n    };\n  }\n}\n","export interface Version {\r\n  lib: string;\r\n  releaseDate: number;\r\n}\r\n\r\nexport const version: Version = {\r\n  lib: '16.0.0-rc.1',\r\n  releaseDate: 1695395320530\r\n};\r\n","import { DeprecatedOptions, AlternateConfigOptions } from './config.interface';\r\n\r\nexport const CONFIG_DEPRECATED: { [key: string]: DeprecatedOptions } = {\r\n  showMenuButton: {\r\n    alternativeKey: 'menu.button.visible',\r\n    mayBeRemoveIn: new Date('2024-06-06')\r\n  },\r\n  menuButtonReverseColor: {\r\n    alternativeKey: 'menu.button.useThemeColor',\r\n    mayBeRemoveIn: new Date('2024-06-06')\r\n  }\r\n};\r\n\r\nexport const ALTERNATE_CONFIG_FROM_DEPRECATION = new Map<\r\n  string,\r\n  AlternateConfigOptions\r\n>(\r\n  Object.entries(CONFIG_DEPRECATED)\r\n    .filter(([_, options]) => options.alternativeKey)\r\n    .map(([key, options]) => [\r\n      options.alternativeKey,\r\n      {\r\n        deprecatedKey: key\r\n      } satisfies AlternateConfigOptions\r\n    ])\r\n);\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpBackend, HttpClient } from '@angular/common/http';\r\nimport { throwError } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { ConfigOptions } from './config.interface';\r\nimport { version } from './version';\r\nimport {\r\n  ALTERNATE_CONFIG_FROM_DEPRECATION,\r\n  CONFIG_DEPRECATED\r\n} from './config-deprecated';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ConfigService {\r\n  private config: object = {};\r\n  private httpClient: HttpClient;\r\n  private configDeprecated = new Map(Object.entries(CONFIG_DEPRECATED));\r\n\r\n  constructor(handler: HttpBackend) {\r\n    this.httpClient = new HttpClient(handler);\r\n  }\r\n\r\n  /**\r\n   * Use to get the data found in config file\r\n   */\r\n  public getConfig(key: string): any {\r\n    const value = ObjectUtils.resolve(this.config, key);\r\n\r\n    const isDeprecated = this.configDeprecated.get(key);\r\n    if (isDeprecated) {\r\n      this.handleDeprecatedConfig(key);\r\n    } else if (value === undefined) {\r\n      return this.handleDeprecationPossibility(key);\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  private handleDeprecatedConfig(key: string): void {\r\n    const options = this.configDeprecated.get(key);\r\n\r\n    let message = `This config (${key}) is deprecated and will be removed shortly`;\r\n    if (options.alternativeKey) {\r\n      message += ` You should use this key (${options.alternativeKey}) as an alternate solution`;\r\n    }\r\n\r\n    const currentDate = new Date();\r\n    currentDate >= options.mayBeRemoveIn\r\n      ? console.error(message)\r\n      : console.warn(message);\r\n  }\r\n\r\n  private handleDeprecationPossibility(key: string): any {\r\n    const options = ALTERNATE_CONFIG_FROM_DEPRECATION.get(key);\r\n    if (!options) {\r\n      return;\r\n    }\r\n\r\n    return this.getConfig(options.deprecatedKey);\r\n  }\r\n\r\n  /**\r\n   * This method loads \"[path]\" to get all config's variables\r\n   */\r\n  public load(options: ConfigOptions) {\r\n    const baseConfig = options.default || {};\r\n    if (!options.path) {\r\n      this.config = baseConfig;\r\n      return true;\r\n    }\r\n\r\n    return new Promise((resolve, _reject) => {\r\n      this.httpClient\r\n        .get(options.path)\r\n        .pipe(\r\n          catchError((error: any): any => {\r\n            console.log(`Configuration file ${options.path} could not be read`);\r\n            resolve(true);\r\n            return throwError(error.error || 'Server error');\r\n          })\r\n        )\r\n        .subscribe((configResponse: object) => {\r\n          this.config = ObjectUtils.mergeDeep(\r\n            ObjectUtils.mergeDeep({ version }, baseConfig),\r\n            configResponse\r\n          );\r\n          resolve(true);\r\n        });\r\n    });\r\n  }\r\n}\r\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\n\nimport { ConfigService } from './config.service';\nimport { ConfigOptions } from './config.interface';\n\nexport let CONFIG_OPTIONS = new InjectionToken<ConfigOptions>('configOptions');\n\nexport function provideConfigOptions(options: ConfigOptions) {\n  return {\n    provide: CONFIG_OPTIONS,\n    useValue: options\n  };\n}\n\nexport function configFactory(\n  configService: ConfigService,\n  options: ConfigOptions\n) {\n  return () => configService.load(options);\n}\n\nexport function provideConfigLoader() {\n  return {\n    provide: APP_INITIALIZER,\n    useFactory: configFactory,\n    multi: true,\n    deps: [ConfigService, CONFIG_OPTIONS]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { provideConfigOptions, provideConfigLoader } from './config.provider';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoConfigModule {\n  static forRoot(): ModuleWithProviders<IgoConfigModule> {\n    return {\n      ngModule: IgoConfigModule,\n      providers: [provideConfigOptions({}), provideConfigLoader()]\n    };\n  }\n}\n","import { HttpBackend, HttpClient } from '@angular/common/http';\n\nimport { forkJoin, map } from 'rxjs';\n\nimport { TranslateLoader } from '@ngx-translate/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { ConfigService } from '../../config/config.service';\n\nexport class LanguageLoader implements TranslateLoader {\n  private httpClient: HttpClient;\n\n  constructor(\n    handler: HttpBackend,\n    private prefix?: string | string[],\n    private suffix: string = '.json',\n    private config?: ConfigService\n  ) {\n    this.httpClient = new HttpClient(handler);\n  }\n\n  public getTranslation(lang: string): any {\n    const igoLocale$ = this.httpClient.get(`locale/libs_locale/${lang}.json`);\n\n    if (this.config && !this.prefix) {\n      const prefix = this.config.getConfig('language.prefix');\n      this.prefix = !prefix || Array.isArray(prefix) ? prefix : [prefix];\n    }\n\n    if (!this.prefix || this.prefix.length === 0) {\n      return igoLocale$;\n    }\n\n    const appLocale$ = (this.prefix as string[]).map((prefix) =>\n      this.httpClient.get(`${prefix}${lang}${this.suffix}`)\n    );\n\n    const locale$ = forkJoin([igoLocale$, ...appLocale$]);\n\n    return locale$.pipe(\n      map((translations) => {\n        return translations.reduce(\n          (acc, current) => ObjectUtils.mergeDeep(acc, current),\n          {}\n        );\n      })\n    );\n  }\n}\n","import { HttpBackend } from '@angular/common/http';\nimport { TranslateLoader } from '@ngx-translate/core';\n\nimport { ConfigService } from '../../config/config.service';\nimport { LanguageLoader } from './language.loader';\n\nexport function defaultLanguageLoader(\n  http: HttpBackend,\n  config?: ConfigService\n) {\n  return new LanguageLoader(http, undefined, undefined, config);\n}\n\nexport function provideLanguageLoader(loader?) {\n  return {\n    provide: TranslateLoader,\n    useFactory: loader || defaultLanguageLoader,\n    deps: [HttpBackend]\n  };\n}\n\nexport function provideDefaultLanguageLoader(loader?) {\n  return {\n    provide: TranslateLoader,\n    useFactory: loader || defaultLanguageLoader,\n    deps: [HttpBackend, ConfigService]\n  };\n}\n","import {\n  MissingTranslationHandler,\n  MissingTranslationHandlerParams\n} from '@ngx-translate/core';\n\nexport class IgoMissingTranslationHandler implements MissingTranslationHandler {\n  handle(params: MissingTranslationHandlerParams) {\n    if (!params.translateService.langs.length) {\n      const error =\n        'Translations are not yet loaded. \\\n         Check that the LanguageService is injected.';\n      throw new Error(error);\n    }\n\n    if (params.key.substr(0, 4) === 'igo.') {\n      throw new Error(`The Key \"${params.key}\" is missing in locale file.`);\n    } else {\n      return params.key;\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport {\n  TranslateModule,\n  MissingTranslationHandler\n} from '@ngx-translate/core';\n\nimport { provideDefaultLanguageLoader } from './shared/language.provider';\nimport { IgoMissingTranslationHandler } from './shared/missing-translation.guard';\n\n@NgModule({\n  imports: [\n    TranslateModule.forRoot({\n      missingTranslationHandler: {\n        provide: MissingTranslationHandler,\n        useClass: IgoMissingTranslationHandler\n      }\n    })\n  ],\n  declarations: [],\n  exports: [TranslateModule]\n})\nexport class IgoLanguageModule {\n  static forRoot(): ModuleWithProviders<IgoLanguageModule> {\n    return {\n      ngModule: IgoLanguageModule,\n      providers: [provideDefaultLanguageLoader()]\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { GlobalConfig, ToastrModule } from 'ngx-toastr';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    ToastrModule.forRoot({\n      positionClass: 'toast-bottom-right',\n      timeOut: 10000,\n      extendedTimeOut: 10000,\n      titleClass: 'mat-subtitle-2',\n      messageClass: 'toast-message',\n      closeButton: true,\n      progressBar: true,\n      enableHtml: true,\n      tapToDismiss: true,\n      maxOpened: 4,\n      preventDuplicates: true,\n      resetTimeoutOnDuplicate: true,\n      countDuplicates: false,\n      includeTitleDuplicates: true\n    } as GlobalConfig)\n  ],\n  declarations: [],\n  exports: []\n})\nexport class IgoMessageModule {\n  static forRoot(): ModuleWithProviders<IgoMessageModule> {\n    return {\n      ngModule: IgoMessageModule,\n      providers: []\n    };\n  }\n}\n","export enum MessageType {\n  ERROR = 'error',\n  ALERT = 'warning', // todo delete (transition to ngx-toastr)\n  WARNING = 'warning',\n  INFO = 'info',\n  SUCCESS = 'success',\n  SHOW = 'show'\n}\n","import { Injectable } from '@angular/core';\nimport { TranslateService } from '@ngx-translate/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LanguageService {\n  private language: string;\n  readonly language$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  constructor(public translate: TranslateService) {\n    this.language = this.translate.getBrowserLang();\n    const lang = this.getLanguage();\n    this.translate.setDefaultLang(lang);\n    this.language$.next(lang);\n  }\n\n  public getLanguage(): string {\n    return this.language.match(/en|fr/) ? this.language : 'en';\n  }\n\n  public setLanguage(language: string) {\n    this.language = language.match(/en|fr/) ? language : 'en';\n    combineLatest([\n      this.translate.use(this.language),\n      this.translate.reloadLang(this.language)\n    ]).subscribe(() => {\n      this.language$.next(this.language);\n    });\n  }\n}\n","import { Injectable, Inject, Injector } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BehaviorSubject, forkJoin } from 'rxjs';\n\nimport { ConfigService } from '../../config/config.service';\n\nimport { Message, MessageOptions } from './message.interface';\nimport { ActiveToast, IndividualConfig, ToastrService } from 'ngx-toastr';\nimport { MessageType } from './message.enum';\nimport { LanguageService } from '../../language/shared/language.service';\nimport { debounceTime, first } from 'rxjs/operators';\n\ninterface ActiveMessageTranslation {\n  id: number;\n  titleKey: string;\n  textKey: string;\n  textInterpolateParams?: Object;\n  titleInterpolateParams?: Object;\n}\n@Injectable({\n  providedIn: 'root'\n})\nexport class MessageService {\n  public messages$ = new BehaviorSubject<Message[]>([]);\n  private options?: MessageOptions;\n  private activeMessageTranslations: ActiveMessageTranslation[] = [];\n\n  constructor(\n    @Inject(Injector) private injector: Injector,\n    private configService: ConfigService,\n    private languageService: LanguageService\n  ) {\n    this.options = this.configService.getConfig('message');\n    this.languageService.language$.pipe(debounceTime(500)).subscribe((r) => {\n      if (this.toastr.toasts.length === 0) {\n        this.activeMessageTranslations = [];\n      }\n      this.toastr.toasts.map((toast) => {\n        const activeMessageTranslation = this.activeMessageTranslations.find(\n          (amt) => amt.id === toast.toastId\n        );\n        if (activeMessageTranslation) {\n          const translatedTextInterpolateParams = {\n            ...activeMessageTranslation.textInterpolateParams\n          };\n          const translatedTitleInterpolateParams = {\n            ...activeMessageTranslation.titleInterpolateParams\n          };\n\n          if (activeMessageTranslation.textInterpolateParams) {\n            Object.keys(activeMessageTranslation.textInterpolateParams).map(\n              (k) => {\n                if (k) {\n                  translatedTextInterpolateParams[k] =\n                    this.languageService.translate.instant(\n                      activeMessageTranslation.textInterpolateParams[k]\n                    );\n                }\n              }\n            );\n          }\n          if (activeMessageTranslation.titleInterpolateParams) {\n            Object.keys(activeMessageTranslation.titleInterpolateParams).map(\n              (k) => {\n                if (k) {\n                  translatedTitleInterpolateParams[k] =\n                    this.languageService.translate.instant(\n                      activeMessageTranslation.titleInterpolateParams[k]\n                    );\n                }\n              }\n            );\n          }\n\n          forkJoin([\n            this.languageService.translate.get(\n              activeMessageTranslation.textKey,\n              translatedTextInterpolateParams\n            ),\n            this.languageService.translate.get(\n              activeMessageTranslation.titleKey,\n              translatedTitleInterpolateParams\n            )\n          ])\n            .pipe(first())\n            .subscribe((res: [string, string]) => {\n              toast.toastRef.componentInstance.message = res[0];\n              toast.toastRef.componentInstance.title = res[1];\n            });\n        }\n      });\n    });\n  }\n\n  private get toastr(): ToastrService {\n    return this.injector.get(ToastrService);\n  }\n\n  showError(httpError: HttpErrorResponse) {\n    httpError.error.caught = true;\n    return this.error(httpError.error.message, httpError.error.title);\n  }\n\n  message(message: Message) {\n    const messageType = message.type;\n    this.toastr.toastrConfig.iconClasses[messageType] = `toast-${messageType}`;\n\n    this.messages$.next(this.messages$.value.concat([message]));\n\n    message.options = message.options || ({} as MessageOptions);\n    const currentDate = new Date();\n\n    message.options.from = message.options.from\n      ? message.options.from\n      : new Date('1 jan 1900');\n    message.options.to = message.options.to\n      ? message.options.to\n      : new Date('1 jan 3000');\n    if (typeof message.options.from === 'string') {\n      message.options.from = new Date(\n        Date.parse(message.options.from.replace(/-/g, ' '))\n      );\n    }\n    if (typeof message.options.to === 'string') {\n      message.options.to = new Date(\n        Date.parse(message.options.to.replace(/-/g, ' '))\n      );\n    }\n    if (\n      currentDate > message.options.from &&\n      currentDate < message.options.to\n    ) {\n      if (message.showIcon === false) {\n        this.toastr.toastrConfig.iconClasses[\n          messageType\n        ] = `toast-${messageType} toast-no-icon`;\n      }\n      message = this.handleTemplate(message);\n\n      if (message.text) {\n        let messageShown: ActiveToast<any>;\n        switch (message.type) {\n          case MessageType.SUCCESS:\n            messageShown = this.success(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n          case MessageType.ERROR:\n            messageShown = this.error(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n          case MessageType.INFO:\n            messageShown = this.info(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n          case MessageType.SHOW:\n            messageShown = this.show(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n          case MessageType.ALERT:\n          case MessageType.WARNING:\n            messageShown = this.alert(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n          default:\n            messageShown = this.info(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams\n            );\n            break;\n        }\n        message.options.id = messageShown.toastId;\n      }\n    }\n  }\n\n  success(\n    text: string,\n    title: string = 'igo.core.message.success',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    return this.handleNgxToastr(\n      'success',\n      text,\n      title,\n      options,\n      textInterpolateParams,\n      titleInterpolateParams\n    );\n  }\n\n  error(\n    text: string,\n    title: string = 'igo.core.message.error',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    return this.handleNgxToastr(\n      'error',\n      text,\n      title,\n      options,\n      textInterpolateParams,\n      titleInterpolateParams\n    );\n  }\n\n  info(\n    text: string,\n    title: string = 'igo.core.message.info',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    return this.handleNgxToastr(\n      'info',\n      text,\n      title,\n      options,\n      textInterpolateParams,\n      titleInterpolateParams\n    );\n  }\n\n  alert(\n    text: string,\n    title: string = 'igo.core.message.alert',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    return this.handleNgxToastr(\n      'alert',\n      text,\n      title,\n      options,\n      textInterpolateParams,\n      titleInterpolateParams\n    );\n  }\n\n  show(\n    text: string,\n    title: string = 'igo.core.message.info',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    return this.handleNgxToastr(\n      'show',\n      text,\n      title,\n      options,\n      textInterpolateParams,\n      titleInterpolateParams\n    );\n  }\n\n  private handleNgxToastr(\n    type: 'alert' | 'info' | 'error' | 'success' | 'show',\n    text: string,\n    title: string,\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object\n  ): ActiveToast<any> {\n    const translatedTextInterpolateParams = { ...textInterpolateParams };\n    const translatedTitlenterpolateParams = { ...titleInterpolateParams };\n\n    if (textInterpolateParams) {\n      Object.keys(textInterpolateParams).map((k) => {\n        if (textInterpolateParams[k]) {\n          translatedTextInterpolateParams[k] =\n            this.languageService.translate.instant(textInterpolateParams[k]);\n        }\n      });\n    }\n    if (titleInterpolateParams) {\n      Object.keys(titleInterpolateParams).map((k) => {\n        if (k) {\n          translatedTitlenterpolateParams[k] =\n            this.languageService.translate.instant(titleInterpolateParams[k]);\n        }\n      });\n    }\n\n    const message = this.languageService.translate.instant(\n      text,\n      translatedTextInterpolateParams\n    );\n    const translatedTitle = this.languageService.translate.instant(\n      title,\n      translatedTitlenterpolateParams\n    );\n\n    let activeToast;\n    switch (type) {\n      case 'success':\n        activeToast = this.toastr.success(message, translatedTitle, options);\n        break;\n      case 'error':\n        activeToast = this.toastr.error(message, translatedTitle, options);\n        break;\n      case 'show':\n      case 'info':\n        activeToast = this.toastr.info(message, translatedTitle, options);\n        break;\n      case 'alert':\n        activeToast = this.toastr.warning(message, translatedTitle, options);\n        break;\n    }\n    this.activeMessageTranslations.push({\n      id: activeToast.toastId,\n      titleKey: title,\n      textKey: text,\n      textInterpolateParams,\n      titleInterpolateParams\n    });\n    return activeToast;\n  }\n\n  remove(id?: number) {\n    this.toastr.remove(id);\n  }\n\n  removeAllAreNotError() {\n    for (const mess of this.messages$.value) {\n      if (mess.type !== MessageType.ERROR) {\n        this.remove(mess.options.id);\n      }\n    }\n  }\n\n  private handleTemplate(message: Message): Message {\n    if (!this.options?.template || message.html) {\n      return message;\n    }\n\n    let html = this.options?.template;\n    html = html.replace('${text}', message.text);\n    html = html.replace('${title}', message.title);\n\n    message.html = undefined;\n    message.text = html;\n    message.title = undefined;\n    return message;\n  }\n}\n","import { Injectable, Injector } from '@angular/core';\nimport {\n  HttpInterceptor,\n  HttpHandler,\n  HttpRequest,\n  HttpEvent,\n  HttpErrorResponse\n} from '@angular/common/http';\n\nimport { Observable, throwError } from 'rxjs';\nimport { catchError, finalize } from 'rxjs/operators';\n\nimport { MessageService } from '../message/shared/message.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ErrorInterceptor implements HttpInterceptor {\n  constructor(private injector: Injector) {}\n\n  intercept(\n    originalReq: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const interceptError = originalReq.headers.get('interceptError');\n    const req = originalReq.clone({\n      headers: originalReq.headers.delete('interceptError')\n    });\n    if (interceptError === 'false') {\n      return next.handle(req);\n    }\n    const errorContainer = { httpError: undefined };\n    return next.handle(req).pipe(\n      catchError((error) => this.handleError(error, errorContainer)),\n      finalize(() => {\n        this.handleCaughtError(errorContainer);\n        this.handleUncaughtError(errorContainer);\n      })\n    );\n  }\n\n  private handleError(\n    httpError: HttpErrorResponse,\n    errorContainer: { httpError: HttpErrorResponse }\n  ) {\n    if (httpError instanceof HttpErrorResponse) {\n      const errorObj = httpError.error === 'object' ? httpError.error : {};\n      errorObj.message = httpError.error?.message || httpError.statusText;\n      errorObj.caught = false;\n\n      httpError = new HttpErrorResponse({\n        error: errorObj,\n        headers: httpError.headers,\n        status: httpError.status,\n        statusText: httpError.statusText,\n        url: httpError.url\n      });\n    }\n\n    errorContainer.httpError = httpError;\n    return throwError(httpError);\n  }\n\n  private handleCaughtError(errorContainer: { httpError: HttpErrorResponse }) {\n    const httpError = errorContainer.httpError;\n    if (httpError && httpError.error.toDisplay) {\n      httpError.error.caught = true;\n      const messageService = this.injector.get(MessageService);\n      messageService.error(httpError.error.message, httpError.error.title);\n    }\n  }\n\n  private handleUncaughtError(errorContainer: {\n    httpError: HttpErrorResponse;\n  }) {\n    const httpError = errorContainer.httpError;\n    if (httpError && !httpError.error.caught) {\n      const messageService = this.injector.get(MessageService);\n      httpError.error.caught = true;\n      messageService.error(\n        'igo.core.errors.uncaught.message',\n        'igo.core.errors.uncaught.title'\n      );\n    }\n  }\n}\n","import {\n  NgModule,\n  ModuleWithProviders,\n  Optional,\n  SkipSelf\n} from '@angular/core';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\n\nimport { ErrorInterceptor } from './error.interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoErrorModule {\n  static forRoot(): ModuleWithProviders<IgoErrorModule> {\n    return {\n      ngModule: IgoErrorModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: ErrorInterceptor,\n          multi: true\n        }\n      ]\n    };\n  }\n\n  constructor(@Optional() @SkipSelf() parentModule: IgoErrorModule) {\n    if (parentModule) {\n      throw new Error(\n        'IgoErrorModule is already loaded. Import it in the AppModule only'\n      );\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { HttpClientModule } from '@angular/common/http';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { MatIconRegistry } from '@angular/material/icon';\n\nimport { IgoActivityModule } from './activity/activity.module';\nimport { IgoConfigModule } from './config/config.module';\nimport { IgoLanguageModule } from './language/language.module';\nimport { IgoMessageModule } from './message/message.module';\nimport { IgoErrorModule } from './request/error.module';\nimport { DBConfig, NgxIndexedDBModule } from 'ngx-indexed-db';\n\nconst dbConfig: DBConfig = {\n  name: 'igo2DB',\n  version: 2,\n  objectStoresMeta: [\n    {\n      store: 'geoData',\n      storeConfig: { keyPath: 'url', autoIncrement: false },\n      storeSchema: [\n        { name: 'regionID', keypath: 'regionID', options: { unique: false } }\n      ]\n    },\n    {\n      store: 'layerData',\n      storeConfig: { keyPath: 'layerId', autoIncrement: false },\n      storeSchema: [\n        {\n          name: 'layerOptions',\n          keypath: 'layerOptions',\n          options: { unique: false }\n        },\n        {\n          name: 'sourceOptions',\n          keypath: 'sourceOptions',\n          options: { unique: false }\n        }\n      ]\n    }\n  ]\n};\n@NgModule({\n  imports: [\n    CommonModule,\n    HttpClientModule,\n    IgoActivityModule.forRoot(),\n    IgoConfigModule.forRoot(),\n    IgoErrorModule.forRoot(),\n    IgoLanguageModule.forRoot(),\n    IgoMessageModule.forRoot(),\n    NgxIndexedDBModule.forRoot(dbConfig)\n  ],\n  declarations: [],\n  exports: [\n    IgoActivityModule,\n    IgoConfigModule,\n    IgoErrorModule,\n    IgoLanguageModule,\n    IgoMessageModule\n  ]\n})\nexport class IgoCoreModule {\n  static forRoot(): ModuleWithProviders<IgoCoreModule> {\n    return {\n      ngModule: IgoCoreModule,\n      providers: []\n    };\n  }\n\n  constructor(matIconRegistry: MatIconRegistry, domSanitizer: DomSanitizer) {\n    matIconRegistry.addSvgIconSet(\n      domSanitizer.bypassSecurityTrustResourceUrl(\n        './assets/igo2/core/icons/mdi.svg'\n      )\n    );\n  }\n}\n","import { Injectable, Inject, InjectionToken, Optional } from '@angular/core';\nimport { ActivatedRoute, Params, Router } from '@angular/router';\nimport { Observable } from 'rxjs';\n\nimport { RouteServiceOptions } from './route.interface';\n\nexport let ROUTE_SERVICE_OPTIONS = new InjectionToken<RouteServiceOptions>(\n  'routeServiceOptions'\n);\n\nexport function provideRouteServiceOptions(options: RouteServiceOptions) {\n  return {\n    provide: ROUTE_SERVICE_OPTIONS,\n    useValue: options\n  };\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RouteService {\n  public options: RouteServiceOptions;\n\n  constructor(\n    private router: Router,\n    public route: ActivatedRoute,\n    @Inject(ROUTE_SERVICE_OPTIONS)\n    @Optional()\n    options: RouteServiceOptions\n  ) {\n    const defaultOptions = {\n      centerKey: 'center',\n      zoomKey: 'zoom',\n      projectionKey: 'projection',\n      contextKey: 'context',\n      searchKey: 'search',\n      visibleOnLayersKey: 'visiblelayers',\n      visibleOffLayersKey: 'invisiblelayers',\n      directionsCoordKey: 'routing',\n      directionsOptionsKey: 'routingOptions',\n      toolKey: 'tool',\n      wmsUrlKey: 'wmsUrl',\n      wmsLayersKey: 'wmsLayers',\n      wmtsUrlKey: 'wmtsUrl',\n      wmtsLayersKey: 'wmtsLayers',\n      arcgisUrlKey: 'arcgisUrl',\n      arcgisLayersKey: 'arcgisLayers',\n      iarcgisUrlKey: 'iarcgisUrl',\n      iarcgisLayersKey: 'iarcgisLayers',\n      tarcgisUrlKey: 'tarcgisUrl',\n      tarcgisLayersKey: 'tarcgisLayers',\n      vectorKey: 'vector'\n    };\n    this.options = Object.assign({}, defaultOptions, options);\n  }\n\n  get queryParams(): Observable<Params> {\n    let url = decodeURIComponent(location.search);\n    if (url.includes('¢er=')) {\n      url = url.replace('¢er', '&center');\n      const queryParams: any = url\n        .slice(1)\n        .split('&')\n        .map((p) => p.split('='))\n        .reduce((obj, pair) => {\n          const [key, value] = pair.map(decodeURIComponent);\n          obj[key] = value;\n          return obj;\n        }, {});\n      this.router.navigate([], { queryParams });\n    }\n    return this.route.queryParams;\n  }\n}\n","export enum Media {\n  Mobile = 'mobile',\n  Tablet = 'tablet',\n  Desktop = 'desktop'\n}\n\nexport enum MediaOrientation {\n  Portrait = 'portrait',\n  Landscape = 'landscape'\n}\n","import { Injectable } from '@angular/core';\nimport { Breakpoints, BreakpointObserver } from '@angular/cdk/layout';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Media, MediaOrientation } from './media.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MediaService {\n  public media$ = new BehaviorSubject<Media>(undefined);\n  public orientation$ = new BehaviorSubject<MediaOrientation>(undefined);\n\n  constructor(breakpointObserver: BreakpointObserver) {\n    breakpointObserver\n      .observe([Breakpoints.HandsetLandscape])\n      .subscribe((res) => {\n        if (res.matches) {\n          this.media$.next(Media.Mobile);\n          this.orientation$.next(MediaOrientation.Landscape);\n        }\n      });\n\n    breakpointObserver\n      .observe([Breakpoints.HandsetPortrait])\n      .subscribe((res) => {\n        if (res.matches) {\n          this.media$.next(Media.Mobile);\n          this.orientation$.next(MediaOrientation.Portrait);\n        }\n      });\n\n    breakpointObserver\n      .observe([Breakpoints.TabletLandscape])\n      .subscribe((res) => {\n        if (res.matches) {\n          this.media$.next(Media.Tablet);\n          this.orientation$.next(MediaOrientation.Landscape);\n        }\n      });\n\n    breakpointObserver\n      .observe([Breakpoints.TabletPortrait])\n      .subscribe((res) => {\n        if (res.matches) {\n          this.media$.next(Media.Tablet);\n          this.orientation$.next(MediaOrientation.Portrait);\n        }\n      });\n\n    breakpointObserver.observe([Breakpoints.WebLandscape]).subscribe((res) => {\n      if (res.matches) {\n        this.media$.next(Media.Desktop);\n        this.orientation$.next(MediaOrientation.Landscape);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.WebPortrait]).subscribe((res) => {\n      if (res.matches) {\n        this.media$.next(Media.Desktop);\n        this.orientation$.next(MediaOrientation.Portrait);\n      }\n    });\n  }\n\n  getMedia(): Media {\n    return this.media$.value;\n  }\n\n  getOrientation(): MediaOrientation {\n    return this.orientation$.value;\n  }\n\n  isTouchScreen(): boolean {\n    return 'ontouchstart' in document.documentElement ? true : false;\n  }\n\n  isMobile(): boolean {\n    const media = this.getMedia();\n    return media === 'mobile';\n  }\n\n  isDesktop(): boolean {\n    const media = this.getMedia();\n    return media === 'desktop';\n  }\n}\n","export enum StorageScope {\n  SESSION = 'Session',\n  LOCAL = 'Local'\n}\n\nexport interface StorageOptions {\n  key: string;\n}\n\nexport interface StorageServiceEvent {\n  key?: string;\n  scope: StorageScope;\n  event: StorageServiceEventEnum;\n  previousValue?: any;\n  currentValue?: any;\n}\n\nexport enum StorageServiceEventEnum {\n  ADDED = 'Added',\n  MODIFIED = 'Modified',\n  REMOVED = 'Removed',\n  CLEARED = 'Cleared'\n}\n","import { ConfigService } from '../config/config.service';\nimport {\n  StorageScope,\n  StorageOptions,\n  StorageServiceEvent,\n  StorageServiceEventEnum\n} from './storage.interface';\nimport { BehaviorSubject } from 'rxjs';\n\nexport abstract class BaseStorage<T extends StorageOptions = StorageOptions> {\n  protected options?: T;\n\n  public storageChange$: BehaviorSubject<StorageServiceEvent> =\n    new BehaviorSubject(undefined);\n\n  constructor(config: ConfigService) {\n    this.options = config.getConfig('storage') || { key: 'igo' };\n  }\n\n  /**\n   * Use to get the data found in storage file\n   */\n  get(key: string, scope?: StorageScope): string | object | boolean | number {\n    let value: any;\n\n    if (!scope || scope === StorageScope.SESSION) {\n      value = sessionStorage.getItem(`${this.options.key}.${key}`);\n    }\n\n    if (scope === StorageScope.LOCAL || (!value && !scope)) {\n      value = localStorage.getItem(`${this.options.key}.${key}`);\n    }\n\n    if (value) {\n      try {\n        value = JSON.parse(value);\n      } catch {\n        value = value;\n      }\n    }\n\n    return value;\n  }\n\n  set(\n    key: string,\n    value: string | object | boolean | number,\n    scope: StorageScope = StorageScope.LOCAL\n  ) {\n    const previousValue = this.get(key, scope);\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.setItem(\n        `${this.options.key}.${key}`,\n        JSON.stringify(value)\n      );\n    } else {\n      localStorage.setItem(`${this.options.key}.${key}`, JSON.stringify(value));\n    }\n    const currentValue = this.get(key, scope);\n\n    if (currentValue !== previousValue) {\n      this.storageChange$.next({\n        key,\n        scope,\n        event:\n          previousValue !== undefined\n            ? StorageServiceEventEnum.MODIFIED\n            : StorageServiceEventEnum.ADDED,\n        previousValue,\n        currentValue\n      });\n    }\n  }\n\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\n    const previousValue = this.get(key, scope);\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.removeItem(`${this.options.key}.${key}`);\n    } else {\n      localStorage.removeItem(`${this.options.key}.${key}`);\n    }\n    this.storageChange$.next({\n      key,\n      scope,\n      event: StorageServiceEventEnum.REMOVED,\n      previousValue\n    });\n  }\n\n  clear(scope: StorageScope = StorageScope.LOCAL) {\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.clear();\n    } else {\n      localStorage.clear();\n    }\n    this.storageChange$.next({ scope, event: StorageServiceEventEnum.CLEARED });\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '../config/config.service';\nimport { StorageOptions } from './storage.interface';\nimport { BaseStorage } from './storage';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageService extends BaseStorage<StorageOptions> {\n  constructor(private config: ConfigService) {\n    super(config);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, Observer } from 'rxjs';\nimport { CompressedData } from './compressedData.interface';\n\nfunction getNumber(v: number, endposition: number, length: number) {\n  /* tslint:disable:no-bitwise*/\n  const mask = (1 << length) - 1;\n  return (v >> endposition) & mask;\n  /* tslint:enable:no-bitwise*/\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CompressionService {\n  private base64Index = new Map<string, number>();\n  private indexBase64 = new Map<number, string>();\n\n  constructor() {\n    this.generateBase64Index();\n  }\n\n  private generateBase64Index() {\n    // https://fr.wikipedia.org/wiki/Base64\n    // A-Z => [0, 25]\n    for (let i = 0; i < 26; i++) {\n      this.base64Index.set(String.fromCharCode('A'.charCodeAt(0) + i), i);\n      this.indexBase64.set(i, String.fromCharCode('A'.charCodeAt(0) + i));\n    }\n    // a-z => [26, 51]\n    for (let i = 0; i < 26; i++) {\n      this.base64Index.set(String.fromCharCode('a'.charCodeAt(0) + i), i + 26);\n      this.indexBase64.set(i + 26, String.fromCharCode('a'.charCodeAt(0) + i));\n    }\n    // 0-9 => [52, 61]\n    for (let i = 0; i < 10; i++) {\n      this.base64Index.set(String.fromCharCode('0'.charCodeAt(0) + i), i + 52);\n      this.indexBase64.set(i + 52, String.fromCharCode('0'.charCodeAt(0) + i));\n    }\n    // + / => [62, 63]\n    this.base64Index.set('+', 62);\n    this.base64Index.set('/', 63);\n    this.indexBase64.set(62, '+');\n    this.indexBase64.set(63, '/');\n  }\n\n  compressBlob(blob: Blob): Observable<CompressedData> {\n    if (!blob) {\n      return;\n    }\n\n    const observable = new Observable((observer: Observer<CompressedData>) => {\n      const reader = new FileReader();\n      reader.readAsDataURL(blob);\n      reader.onload = () => {\n        const base64 = reader.result.valueOf() as string;\n        const text64 = base64.substr(base64.indexOf(',') + 1);\n        const compressed = this.compressStringBase64(text64);\n        const compressedData: CompressedData = {\n          length: text64.length,\n          type: blob.type,\n          object: compressed\n        };\n        observer.next(compressedData);\n      };\n    });\n    return observable;\n  }\n\n  decompressBlob(compressedData: CompressedData): Blob {\n    /* tslint:disable:no-bitwise*/\n    const object = compressedData.object;\n    const length = compressedData.length;\n    const decompressed: string = this.decompressStringBase64(object, length);\n    const byteCharacters = atob(decompressed);\n    const byteNumbers = new Array(byteCharacters.length);\n    for (let i = 0; i < byteCharacters.length; i++) {\n      byteNumbers[i] = byteCharacters.charCodeAt(i);\n    }\n    const byteArray = new Uint8Array(byteNumbers);\n    const blob = new Blob([byteArray], { type: compressedData.type });\n    /* tslint:enable:no-bitwise*/\n    return blob;\n  }\n\n  private compressStringBase64(s: string): string {\n    /* tslint:disable:no-bitwise*/\n    let out = '';\n    let bits = 16;\n    let chr = 0;\n    let rem = 0;\n    for (const c of s) {\n      const value = this.base64Index.get(c);\n      if (bits > 6) {\n        bits -= 6;\n        chr += value << bits;\n      } else {\n        rem = 6 - bits;\n        chr += value >> rem;\n        out += String.fromCharCode(chr);\n        chr = value << (16 - rem);\n        bits = 16 - rem;\n      }\n    }\n    if (s.length % 8 !== 0) {\n      out += String.fromCharCode(chr);\n    }\n    /* tslint:enable:no-bitwise*/\n    return String.fromCharCode(9731) + out;\n  }\n\n  private decompressStringBase64(c: string, length: number): string {\n    /* tslint:disable:no-bitwise*/\n    if (!c) {\n      return;\n    }\n\n    if (c.charCodeAt(0) !== 9731) {\n      return c;\n    }\n\n    let chr = 0;\n    let rem = 0;\n    let bits = 16;\n    let out = '';\n    let j = 1;\n    let value = c.charCodeAt(j);\n    for (let i = 0; i < length; i++) {\n      if (bits > 6) {\n        bits -= 6;\n        chr = getNumber(value, bits, 6);\n        out += this.indexBase64.get(chr);\n      } else {\n        rem = 6 - bits;\n        chr = getNumber(value, 0, bits) << rem;\n        value = c.charCodeAt(++j);\n        chr += getNumber(value, 16 - rem, rem);\n        out += this.indexBase64.get(chr);\n        bits = 16 - rem;\n      }\n    }\n    return out;\n    /* tslint:enable:no-bitwise*/\n  }\n}\n","import { Injectable, EventEmitter, OnDestroy, Injector } from '@angular/core';\nimport { Observable, Subscription, fromEvent } from 'rxjs';\nimport { debounceTime, startWith } from 'rxjs/operators';\n\nimport { MessageService } from '../message/shared/message.service';\nimport { ConnectionState } from './network.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NetworkService implements OnDestroy {\n  private stateChangeEventEmitter = new EventEmitter<ConnectionState>();\n  private onlineSubscription: Subscription;\n  private offlineSubscription: Subscription;\n  private previousMessageId;\n\n  private state: ConnectionState = {\n    connection: window.navigator.onLine\n  };\n\n  constructor(\n    private messageService: MessageService,\n    private injector: Injector\n  ) {\n    this.checkNetworkState();\n  }\n\n  private checkNetworkState() {\n    this.onlineSubscription = fromEvent(window, 'online').subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      const messageObj = this.messageService.info(\n        'igo.core.network.online.message',\n        'igo.core.network.online.title'\n      );\n      this.previousMessageId = messageObj.toastId;\n      this.state.connection = true;\n      this.emitEvent();\n    });\n\n    this.offlineSubscription = fromEvent(window, 'offline').subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      const messageObj = this.messageService.info(\n        'igo.core.network.offline.message',\n        'igo.core.network.offline.title'\n      );\n      this.previousMessageId = messageObj.toastId;\n      this.state.connection = false;\n      this.emitEvent();\n    });\n  }\n\n  private emitEvent() {\n    this.stateChangeEventEmitter.emit(this.state);\n  }\n\n  ngOnDestroy(): void {\n    try {\n      this.offlineSubscription.unsubscribe();\n      this.onlineSubscription.unsubscribe();\n    } catch (e) {}\n  }\n\n  currentState(reportState = true): Observable<ConnectionState> {\n    return reportState\n      ? this.stateChangeEventEmitter.pipe(\n          debounceTime(300),\n          startWith(this.state)\n        )\n      : this.stateChangeEventEmitter.pipe(debounceTime(300));\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { ConfigService } from '../config/config.service';\nimport { RegexOptions } from './regex.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RegexService {\n  protected options: RegexOptions;\n\n  constructor(private config: ConfigService) {\n    this.options = this.config.getConfig('regex');\n  }\n\n  getAll() {\n    return this.options;\n  }\n\n  get(key) {\n    if (this.options) {\n      return this.options[key];\n    }\n    return;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { ActionbarComponent } from './actionbar.component';\nimport { ActionbarItemComponent } from './actionbar-item.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatMenuModule,\n    MatListModule,\n    MatCardModule,\n    MatCheckboxModule\n  ],\n  exports: [ActionbarComponent],\n  declarations: [ActionbarComponent, ActionbarItemComponent]\n})\nexport class IgoActionbarModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoActionbarModule } from './actionbar/actionbar.module';\n\n@NgModule({\n  imports: [CommonModule, IgoActionbarModule],\n  exports: [IgoActionbarModule],\n  declarations: [],\n  providers: []\n})\nexport class IgoActionModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { IgoBadgeIconDirective } from './badge-icon.directive';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatIconModule } from '@angular/material/icon';\n\n@NgModule({\n  imports: [MatBadgeModule, MatIconModule],\n  declarations: [IgoBadgeIconDirective],\n  exports: [MatBadgeModule, IgoBadgeIconDirective]\n})\nexport class IgoMatBadgeIconModule {\n  static forRoot(): ModuleWithProviders<IgoMatBadgeIconModule> {\n    return {\n      ngModule: IgoMatBadgeIconModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { CollapseDirective } from './collapse.directive';\nimport { CollapsibleComponent } from './collapsible.component';\n\n@NgModule({\n  imports: [MatIconModule, MatListModule],\n  declarations: [CollapsibleComponent, CollapseDirective],\n  exports: [CollapsibleComponent, CollapseDirective]\n})\nexport class IgoCollapsibleModule {\n  static forRoot(): ModuleWithProviders<IgoCollapsibleModule> {\n    return {\n      ngModule: IgoCollapsibleModule,\n      providers: []\n    };\n  }\n}\n","import { Component } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\n@Component({\n  selector: 'igo-confirm-dialog',\n  templateUrl: './confirm-dialog.component.html',\n  styleUrls: ['./confirm-dialog.component.scss']\n})\nexport class ConfirmDialogComponent {\n  public confirmMessage: string;\n\n  constructor(public dialogRef: MatDialogRef<ConfirmDialogComponent>) {}\n}\n","<h2 mat-dialog-title class=\"mat-typography\">\n  {{ 'igo.common.confirmDialog.title' | translate }}\n</h2>\n<div mat-dialog-content class=\"mat-typography\">{{ confirmMessage }}</div>\n<div mat-dialog-actions>\n  <button mat-button color=\"primary\" (click)=\"dialogRef.close(true)\">\n    {{ 'igo.common.confirmDialog.confirmBtn' | translate }}\n  </button>\n  <button mat-button (click)=\"dialogRef.close(false)\">\n    {{ 'igo.common.confirmDialog.cancelBtn' | translate }}\n  </button>\n</div>\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { LanguageService } from '@igo2/core';\n\nimport { Observable } from 'rxjs';\n\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\n\n@Injectable()\nexport class ConfirmDialogService {\n  constructor(\n    private dialog: MatDialog,\n    private languageService: LanguageService\n  ) {}\n\n  public open(message: string): Observable<any> {\n    const dialogRef = this.dialog.open(ConfirmDialogComponent, {\n      disableClose: false\n    });\n    dialogRef.componentInstance.confirmMessage =\n      this.languageService.translate.instant(message);\n\n    return dialogRef.afterClosed();\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\nimport { ConfirmDialogService } from './confirm-dialog.service';\n\n@NgModule({\n  imports: [MatButtonModule, MatDialogModule, IgoLanguageModule],\n  declarations: [ConfirmDialogComponent],\n  exports: [ConfirmDialogComponent],\n  providers: [ConfirmDialogService]\n})\nexport class IgoConfirmDialogModule {\n  static forRoot(): ModuleWithProviders<IgoConfirmDialogModule> {\n    return {\n      ngModule: IgoConfirmDialogModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { ContextMenuDirective } from './context-menu.directive';\nimport { LongPressDirective } from './long-press.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [ContextMenuDirective, LongPressDirective],\n  exports: [ContextMenuDirective, LongPressDirective]\n})\nexport class IgoContextMenuModule {\n  static forRoot(): ModuleWithProviders<IgoContextMenuModule> {\n    return {\n      ngModule: IgoContextMenuModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { CustomHtmlComponent } from './custom-html.component';\nimport { SanitizeHtmlPipe } from './custom-html.pipe';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatInputModule,\n    MatButtonModule,\n    IgoLanguageModule\n  ],\n  exports: [SanitizeHtmlPipe, CustomHtmlComponent],\n  declarations: [SanitizeHtmlPipe, CustomHtmlComponent]\n})\nexport class IgoCustomHtmlModule {\n  static forRoot(): ModuleWithProviders<IgoCustomHtmlModule> {\n    return {\n      ngModule: IgoCustomHtmlModule\n    };\n  }\n}\n","import { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { catchError, map } from 'rxjs/operators';\nimport { throwError } from 'rxjs';\n\nimport { DOMOptions, DOMValue } from './dom.interfaces';\nimport { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DOMService {\n  constructor(private http: HttpClient) {}\n\n  async getDom(dom: DOMOptions): Promise<DOMValue[]> {\n    const url = dom.url;\n    let result: DOMValue[];\n\n    await this.http\n      .get<any>(url)\n      .pipe(\n        map((response) => {\n          result = response;\n          return response;\n        }),\n        catchError((err: HttpErrorResponse) => {\n          return throwError(err);\n        })\n      )\n      .toPromise();\n\n    return result;\n  }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { DOMService } from './dom.service';\n\n@NgModule({\n  providers: [DOMService]\n})\nexport class IgoDOMModule {\n  static forRoot(): ModuleWithProviders<IgoDOMModule> {\n    return {\n      ngModule: IgoDOMModule,\n      providers: [DOMService]\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { DragAndDropDirective } from './drag-drop.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [DragAndDropDirective],\n  exports: [DragAndDropDirective]\n})\nexport class IgoDrapDropModule {\n  static forRoot(): ModuleWithProviders<IgoDrapDropModule> {\n    return {\n      ngModule: IgoDrapDropModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { DynamicOutletComponent } from './dynamic-outlet.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [CommonModule],\n  exports: [DynamicOutletComponent],\n  declarations: [DynamicOutletComponent]\n})\nexport class IgoDynamicOutletModule {}\n","import {\n  ComponentFactory,\n  ComponentRef,\n  ViewContainerRef\n} from '@angular/core';\n\nimport { Observable, Subscription } from 'rxjs';\n\n/**\n * This class is used in the DynamicComponentOutlet component. It holds\n * a reference to a component factory and can render that component\n * in a target element on demand. It's also possible to set inputs\n * and to subscribe to outputs.\n */\nexport class DynamicComponent<C> {\n  /**\n   * Component reference\n   */\n  private componentRef: ComponentRef<C>;\n\n  /**\n   * Subscriptions to the component's outputs. Those need\n   * to be unsubscribed when the component is destroyed.\n   */\n  private subscriptions: Subscription[] = [];\n\n  /**\n   * Component target element\n   */\n  private target: ViewContainerRef;\n\n  /**\n   * Component inputs\n   */\n  private inputs: { [key: string]: any } = {};\n\n  /**\n   * Subscriptions to the component's async inputs\n   */\n  private inputs$$: { [key: string]: Subscription } = {};\n\n  /**\n   * Subscribers to the component's outputs\n   */\n  private subscribers: { [key: string]: (event: any) => void } = {};\n\n  constructor(private componentFactory: ComponentFactory<C>) {}\n\n  /**\n   * Render the component to a target element.\n   * Set it's inputs and subscribe to it's outputs.\n   * @param target Target element\n   */\n  setTarget(target: ViewContainerRef) {\n    this.target = target;\n    this.componentRef = target.createComponent(this.componentFactory);\n    this.updateInputs(this.inputs);\n    this.updateSubscribers(this.subscribers);\n  }\n\n  /**\n   * Destroy this component. That means, removing from it's target\n   * element and unsubscribing to it's outputs.\n   */\n  destroy() {\n    if (this.target !== undefined) {\n      this.target.clear();\n    }\n    if (this.componentRef !== undefined) {\n      this.componentRef.destroy();\n      this.componentRef = undefined;\n    }\n    this.unobserveAllInputs();\n    this.unsubscribeAll();\n  }\n\n  /**\n   * Update the component inputs. This is an update so any\n   * key not defined won't be overwritten.\n   */\n  updateInputs(inputs: { [key: string]: any }) {\n    this.inputs = inputs;\n    if (this.componentRef === undefined) {\n      return;\n    }\n\n    const instance = this.componentRef.instance;\n    const allowedInputs = this.componentFactory.inputs;\n    allowedInputs.forEach(\n      (value: { propName: string; templateName: string }) => {\n        const key = value.propName;\n\n        this.unobserveInput(key);\n\n        const inputValue = inputs[key];\n        if (inputs.hasOwnProperty(key)) {\n          if (inputValue instanceof Observable) {\n            this.observeInput(key, inputValue);\n          } else {\n            this.setInputValue(instance, key, inputValue);\n          }\n        }\n      }\n    );\n\n    if (typeof (instance as any).onUpdateInputs === 'function') {\n      (instance as any).onUpdateInputs();\n    }\n  }\n\n  /**\n   * Set an instance's input value\n   * @param instance Component instance\n   * @param key Input key\n   * @param value Input value\n   */\n  private setInputValue(instance: C, key: string, value: any) {\n    const currentValue = instance[key];\n    if (value === currentValue) {\n      return;\n    }\n\n    const prototype = Object.getPrototypeOf(instance);\n    const descriptor = Object.getOwnPropertyDescriptor(prototype, key);\n    if (descriptor !== undefined && descriptor.set !== undefined) {\n      descriptor.set.call(instance, value);\n    } else {\n      instance[key] = value;\n    }\n  }\n\n  /**\n   * Update the component subscribers. This is an update so any\n   * key not defined won't be overwritten.\n   */\n  updateSubscribers(subscribers: { [key: string]: (event: any) => void }) {\n    this.subscribers = subscribers;\n    if (this.componentRef === undefined) {\n      return;\n    }\n\n    const instance = this.componentRef.instance;\n    const allowedSubscribers = this.componentFactory.outputs;\n    allowedSubscribers.forEach(\n      (value: { propName: string; templateName: string }) => {\n        const key = value.propName;\n        if (subscribers.hasOwnProperty(key)) {\n          const emitter = instance[key];\n          const subscriber = subscribers[key];\n          if (Array.isArray(subscriber)) {\n            subscriber.forEach((_subscriber) => {\n              this.subscriptions.push(emitter.subscribe(_subscriber));\n            });\n          } else {\n            this.subscriptions.push(emitter.subscribe(subscriber));\n          }\n        }\n      }\n    );\n  }\n\n  /**\n   * Subscribe to an observable input and update the component's input value\n   * accordingly\n   * @param key Input key\n   * @param observable Observable\n   */\n  private observeInput(key: string, observable: Observable<any>) {\n    this.inputs$$[key] = observable.subscribe((value: any) => {\n      const instance = this.componentRef.instance;\n      this.setInputValue(instance, key, value);\n\n      if (typeof (instance as any).onUpdateInputs === 'function') {\n        (instance as any).onUpdateInputs();\n      }\n    });\n  }\n\n  /**\n   * Unsubscribe to an observable input\n   * @param key Input key\n   */\n  private unobserveInput(key: string) {\n    if (this.inputs$$[key] !== undefined) {\n      this.inputs$$[key].unsubscribe();\n      this.inputs$$[key] = undefined;\n    }\n  }\n\n  /**\n   * Unsubscribe to all outputs.\n   */\n  private unobserveAllInputs() {\n    Object.values(this.inputs$$).forEach((s: Subscription | undefined) => {\n      if (s !== undefined) {\n        s.unsubscribe();\n      }\n    });\n    this.inputs$$ = {};\n  }\n\n  /**\n   * Unsubscribe to all outputs.\n   */\n  private unsubscribeAll() {\n    this.subscriptions.forEach((s: Subscription) => s.unsubscribe());\n    this.subscriptions = [];\n  }\n}\n","import { ComponentFactoryResolver, Injectable } from '@angular/core';\n\nimport { DynamicComponent } from './dynamic-component';\n\n/**\n * Service to creates DynamicComponent instances from base component classes\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DynamicComponentService {\n  constructor(private resolver: ComponentFactoryResolver) {}\n\n  /**\n   * Creates a DynamicComponent instance from a base component class\n   * @param componentCls The component class\n   * @returns DynamicComponent instance\n   */\n  create(componentCls: any): DynamicComponent<any> {\n    const factory = this.resolver.resolveComponentFactory(componentCls as any);\n    return new DynamicComponent<typeof componentCls>(factory);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoDynamicOutletModule } from './dynamic-outlet/dynamic-outlet.module';\nimport { DynamicComponentService } from './shared/dynamic-component.service';\n\n@NgModule({\n  imports: [CommonModule, IgoDynamicOutletModule],\n  exports: [IgoDynamicOutletModule],\n  providers: [DynamicComponentService]\n})\nexport class IgoDynamicComponentModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { FlexibleComponent } from './flexible.component';\n\n@NgModule({\n  imports: [],\n  declarations: [FlexibleComponent],\n  exports: [FlexibleComponent]\n})\nexport class IgoFlexibleModule {\n  static forRoot(): ModuleWithProviders<IgoFlexibleModule> {\n    return {\n      ngModule: IgoFlexibleModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { FormComponent } from './form.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [CommonModule, FormsModule, ReactiveFormsModule],\n  exports: [FormComponent, FormsModule, ReactiveFormsModule],\n  declarations: [FormComponent]\n})\nexport class IgoFormFormModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoDynamicOutletModule } from '../../dynamic-component/dynamic-outlet/dynamic-outlet.module';\n\nimport { FormFieldComponent } from './form-field.component';\nimport { FormFieldSelectComponent } from './form-field-select.component';\nimport { FormFieldTextComponent } from './form-field-text.component';\nimport { FormFieldTextareaComponent } from './form-field-textarea.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    IgoLanguageModule,\n    IgoDynamicOutletModule\n  ],\n  exports: [\n    FormFieldComponent,\n    FormFieldSelectComponent,\n    FormFieldTextComponent,\n    FormFieldTextareaComponent\n  ],\n  declarations: [\n    FormFieldComponent,\n    FormFieldSelectComponent,\n    FormFieldTextComponent,\n    FormFieldTextareaComponent\n  ]\n})\nexport class IgoFormFieldModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatFormFieldModule } from '@angular/material/form-field';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoFormFieldModule } from '../form-field/form-field.module';\nimport { FormGroupComponent } from './form-group.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatFormFieldModule,\n    IgoLanguageModule,\n    IgoFormFieldModule\n  ],\n  exports: [FormGroupComponent],\n  declarations: [FormGroupComponent]\n})\nexport class IgoFormGroupModule {}\n","import { Injectable } from '@angular/core';\nimport { UntypedFormBuilder, Validators, ValidatorFn } from '@angular/forms';\n\nimport {\n  Form,\n  FormField,\n  FormFieldConfig,\n  FormFieldGroup,\n  FormFieldGroupConfig\n} from './form.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FormService {\n  constructor(private formBuilder: UntypedFormBuilder) {}\n\n  form(fields: FormField[], groups: FormFieldGroup[]): Form {\n    const control = this.formBuilder.group({});\n    fields.forEach((field: FormField) => {\n      control.addControl(field.name, field.control);\n    });\n    groups.forEach((group: FormFieldGroup) => {\n      control.addControl(group.name, group.control);\n    });\n\n    return { fields, groups, control };\n  }\n\n  group(config: FormFieldGroupConfig, fields: FormField[]): FormFieldGroup {\n    const options = config.options || {};\n    const control = this.formBuilder.group({});\n    fields.forEach((field: FormField) => {\n      control.addControl(field.name, field.control);\n    });\n\n    if (options.validator) {\n      const validators = this.getValidators(options.validator); // convert string to actual validator\n      control.setValidators(validators);\n    }\n\n    return Object.assign({}, config, { fields, control }) as FormFieldGroup;\n  }\n\n  field(config: FormFieldConfig): FormField {\n    const options = config.options || {};\n    const state = {\n      value: '',\n      disabled: options.disabled\n    };\n    const control = this.formBuilder.control(state);\n\n    if (options.validator) {\n      const validators = this.getValidators(options.validator); // convert string to actual validator\n      control.setValidators(validators);\n    }\n\n    return Object.assign({ type: 'text' }, config, { control }) as FormField;\n  }\n\n  extendFieldConfig(\n    config: FormFieldConfig,\n    partial: Partial<FormFieldConfig>\n  ): FormFieldConfig {\n    const options = Object.assign(\n      {},\n      config.options || {},\n      partial.options || {}\n    );\n    const inputs = Object.assign({}, config.inputs || {}, partial.inputs || {});\n    const subscribers = Object.assign(\n      {},\n      config.subscribers || {},\n      partial.subscribers || {}\n    );\n    return Object.assign({}, config, { options, inputs, subscribers });\n  }\n\n  private getValidators(\n    validatorOption: string | string[] | ValidatorFn\n  ): ValidatorFn | ValidatorFn[] {\n    if (Array.isArray(validatorOption)) {\n      return validatorOption.map((validatorStr) => {\n        return this.getValidator(validatorStr);\n      });\n    }\n\n    return this.getValidator(validatorOption);\n  }\n\n  private getValidator(validatorStr: string | ValidatorFn): ValidatorFn {\n    if (typeof validatorStr !== 'string') {\n      return validatorStr;\n    }\n\n    // regex pattern to extract arguments from string for e.g applying on \"minLength(8)\" would extract 8\n    const re = /^([a-zA-Z]{3,15})\\((.{0,20})\\)$/;\n    const match = validatorStr.match(re);\n\n    if (!match) {\n      return Validators[validatorStr];\n    }\n\n    const name = match[1];\n    const args = match[2];\n    return Validators[name](args);\n  }\n}\n","import { Injectable } from '@angular/core';\n\n/**\n * Service where all available form fields are registered.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class FormFieldService {\n  static fields: { [key: string]: any } = {};\n\n  static register(type: string, component: any) {\n    FormFieldService.fields[type] = component;\n  }\n\n  constructor() {}\n\n  /**\n   * Return field component by type\n   * @param type Field type\n   * @returns Field component\n   */\n  getFieldByType(type: string): any {\n    return FormFieldService.fields[type];\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFormFormModule } from './form/form.module';\nimport { IgoFormGroupModule } from './form-group/form-group.module';\nimport { IgoFormFieldModule } from './form-field/form-field.module';\nimport { FormService } from './shared/form.service';\nimport { FormFieldService } from './shared/form-field.service';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [CommonModule, IgoFormGroupModule, IgoFormFieldModule],\n  exports: [IgoFormFormModule, IgoFormGroupModule, IgoFormFieldModule],\n  declarations: [],\n  providers: [FormService, FormFieldService]\n})\nexport class IgoFormModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { EntitySelectorComponent } from './entity-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [CommonModule, FormsModule, MatSelectModule],\n  exports: [EntitySelectorComponent],\n  declarations: [EntitySelectorComponent]\n})\nexport class IgoEntitySelectorModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { StopDropPropagationDirective } from './stop-drop-propagation.directive';\nimport { StopPropagationDirective } from './stop-propagation.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [StopDropPropagationDirective, StopPropagationDirective],\n  exports: [StopDropPropagationDirective, StopPropagationDirective]\n})\nexport class IgoStopPropagationModule {\n  static forRoot(): ModuleWithProviders<IgoStopPropagationModule> {\n    return {\n      ngModule: IgoStopPropagationModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { EntityTablePaginatorComponent } from './entity-table-paginator.component';\nimport { MatPaginatorModule } from '@angular/material/paginator';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [MatPaginatorModule],\n  exports: [EntityTablePaginatorComponent],\n  declarations: [EntityTablePaginatorComponent]\n})\nexport class IgoEntityTablePaginatorModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { ImageErrorDirective } from './image-error.directive';\nimport { SecureImagePipe } from './secure-image.pipe';\n\n@NgModule({\n  imports: [],\n  declarations: [SecureImagePipe, ImageErrorDirective],\n  exports: [SecureImagePipe, ImageErrorDirective]\n})\nexport class IgoImageModule {\n  static forRoot(): ModuleWithProviders<IgoImageModule> {\n    return {\n      ngModule: IgoImageModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSortModule } from '@angular/material/sort';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\n\nimport { IgoStopPropagationModule } from '../../stop-propagation/stop-propagation.module';\nimport { IgoCustomHtmlModule } from '../../custom-html/custom-html.module';\nimport { EntityTableRowDirective } from './entity-table-row.directive';\nimport { EntityTableComponent } from './entity-table.component';\nimport { MatPaginatorModule } from '@angular/material/paginator';\nimport { IgoEntityTablePaginatorModule } from '../entity-table-paginator/entity-table-paginator.module';\nimport { IgoImageModule } from '../../image/image.module';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatSelectModule } from '@angular/material/select';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatTableModule,\n    MatAutocompleteModule,\n    MatSortModule,\n    MatIconModule,\n    MatButtonModule,\n    MatCheckboxModule,\n    MatPaginatorModule,\n    MatSelectModule,\n    IgoStopPropagationModule,\n    IgoCustomHtmlModule,\n    IgoEntityTablePaginatorModule,\n    IgoImageModule,\n    IgoLanguageModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatInputModule,\n    MatDatepickerModule,\n    MatTooltipModule\n  ],\n  exports: [EntityTableComponent],\n  declarations: [EntityTableComponent, EntityTableRowDirective]\n})\nexport class IgoEntityTableModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoEntitySelectorModule } from './entity-selector/entity-selector.module';\nimport { IgoEntityTableModule } from './entity-table/entity-table.module';\nimport { IgoEntityTablePaginatorModule } from './entity-table-paginator/entity-table-paginator.module';\n\n@NgModule({\n  imports: [CommonModule],\n  exports: [\n    IgoEntitySelectorModule,\n    IgoEntityTableModule,\n    IgoEntityTablePaginatorModule\n  ],\n  declarations: []\n})\nexport class IgoEntityModule {}\n","import { catchError } from 'rxjs/operators';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { Injectable } from '@angular/core';\nimport { InteractiveTourOptions } from './interactive-tour.interface';\nimport { ConfigService } from '@igo2/core';\n\n@Injectable()\nexport class InteractiveTourLoader {\n  private jsonURL: string;\n  private allToursOptions;\n\n  constructor(\n    private http: HttpClient,\n    private configService: ConfigService\n  ) {\n    this.jsonURL = this.getPathToConfigFile();\n  }\n\n  public loadConfigTour() {\n    this.getJSON().subscribe(\n      (data) => {\n        this.allToursOptions = data;\n      },\n      (err) => {\n        throw new Error(\n          `Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.`\n        );\n      }\n    );\n  }\n\n  public getPathToConfigFile(): string {\n    return (\n      this.configService.getConfig('interactiveTour.pathToConfigFile') ||\n      './config/interactiveTour.json'\n    );\n  }\n\n  public getJSON(): Observable<any> {\n    return this.http.get(this.jsonURL).pipe(\n      catchError((e) => {\n        e.error.caught = true;\n        throw e;\n      })\n    );\n  }\n\n  public getTourOptionData(toolName): InteractiveTourOptions {\n    if (this.allToursOptions === undefined) {\n      return undefined;\n    }\n    let nameInConfigFile = toolName;\n    nameInConfigFile = nameInConfigFile.replace(/\\s/g, '');\n    return this.allToursOptions[nameInConfigFile];\n  }\n}\n","import { Injectable } from '@angular/core';\r\nimport { ShepherdService } from 'angular-shepherd';\r\nimport Shepherd from 'shepherd.js';\r\nimport { offset } from '@floating-ui/dom';\r\n\r\nimport { ConfigService, MediaService, LanguageService } from '@igo2/core';\r\nimport { InteractiveTourLoader } from './interactive-tour.loader';\r\nimport {\r\n  InteractiveTourOptions,\r\n  InteractiveTourStep,\r\n  InteractiveTourAction\r\n} from './interactive-tour.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class InteractiveTourService {\r\n  private previousStep: InteractiveTourStep;\r\n  private nextIndex = 1;\r\n\r\n  constructor(\r\n    private configService: ConfigService,\r\n    private mediaService: MediaService,\r\n    private languageService: LanguageService,\r\n    private interactiveTourLoader: InteractiveTourLoader,\r\n    private shepherdService: ShepherdService\r\n  ) {\r\n    if (this.isAppHaveTour()) {\r\n      this.interactiveTourLoader.loadConfigTour();\r\n    }\r\n  }\r\n\r\n  public isAppHaveTour() {\r\n    const haveTour = this.configService.getConfig(\r\n      'interactiveTour.activateInteractiveTour'\r\n    );\r\n    if (haveTour === undefined) {\r\n      return true;\r\n    } else {\r\n      return haveTour;\r\n    }\r\n  }\r\n\r\n  public isToolHaveTourConfig(toolName: string): boolean {\r\n    const checkTourActiveOptions =\r\n      this.interactiveTourLoader.getTourOptionData(toolName);\r\n    if (checkTourActiveOptions === undefined) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  public disabledTourButton(toolName: string): boolean {\r\n    const stepConfig: InteractiveTourOptions =\r\n      this.interactiveTourLoader.getTourOptionData(toolName);\r\n\r\n    if (stepConfig?.conditions) {\r\n      for (const condition of stepConfig?.conditions) {\r\n        if (document.querySelector(condition) === null) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public isMobile(): boolean {\r\n    return this.mediaService.isMobile();\r\n  }\r\n\r\n  public isTourDisplayInMobile(): boolean {\r\n    const showInMobile = this.configService.getConfig(\r\n      'interactiveTour.tourInMobile'\r\n    );\r\n    if (showInMobile === undefined) {\r\n      return true;\r\n    }\r\n    return this.configService.getConfig('interactiveTour.tourInMobile');\r\n  }\r\n\r\n  private getButtons(buttonKind?: 'first' | 'last' | 'noBackButton') {\r\n    if (buttonKind === 'noBackButton') {\r\n      return [\r\n        {\r\n          classes: 'shepherd-button-primary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.nextButton'\r\n          ),\r\n          type: 'next'\r\n        }\r\n      ];\r\n    }\r\n    if (buttonKind === 'first') {\r\n      return [\r\n        {\r\n          classes: 'shepherd-button-secondary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.exitButton'\r\n          ),\r\n          type: 'cancel'\r\n        },\r\n        {\r\n          classes: 'shepherd-button-primary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.nextButton'\r\n          ),\r\n          type: 'next'\r\n        }\r\n      ];\r\n    }\r\n\r\n    if (buttonKind === 'last') {\r\n      return [\r\n        {\r\n          classes: 'shepherd-button-secondary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.backButton'\r\n          ),\r\n          type: 'back'\r\n        },\r\n        {\r\n          classes: 'shepherd-button-primary',\r\n          text: this.languageService.translate.instant(\r\n            'igo.common.interactiveTour.exitButton'\r\n          ),\r\n          type: 'cancel'\r\n        }\r\n      ];\r\n    }\r\n\r\n    return [\r\n      {\r\n        classes: 'shepherd-button-secondary',\r\n        text: this.languageService.translate.instant(\r\n          'igo.common.interactiveTour.backButton'\r\n        ),\r\n        type: 'back'\r\n      },\r\n      {\r\n        classes: 'shepherd-button-primary',\r\n        text: this.languageService.translate.instant(\r\n          'igo.common.interactiveTour.nextButton'\r\n        ),\r\n        type: 'next'\r\n      }\r\n    ];\r\n  }\r\n\r\n  private getAction(actionName: string) {\r\n    const action = {\r\n      click: 'click'\r\n    };\r\n    return action[actionName.toLowerCase()];\r\n  }\r\n\r\n  private addProgress() {\r\n    const self = this as any;\r\n    let nbTry = 0;\r\n    const maxTry = 21;\r\n    const checkExist = setInterval(() => {\r\n      if (self.getCurrentStep()) {\r\n        if (\r\n          self.getCurrentStep().options.attachTo.element &&\r\n          !document.querySelector(\r\n            self.getCurrentStep().options.attachTo.element\r\n          )\r\n        ) {\r\n          self.cancel();\r\n          clearInterval(checkExist);\r\n          return;\r\n        } else {\r\n          const currentStepElement = self.getCurrentStep().getElement();\r\n          if (currentStepElement) {\r\n            const shepherdList = currentStepElement.querySelectorAll(\r\n              '.shepherd-content, .shepherd-text'\r\n            );\r\n            shepherdList.forEach((element) => {\r\n              element.classList.add('mat-typography');\r\n            });\r\n          }\r\n          const header = currentStepElement\r\n            ? currentStepElement.querySelector('.shepherd-header')\r\n            : undefined;\r\n\r\n          nbTry++;\r\n          if (header || nbTry > maxTry) {\r\n            clearInterval(checkExist);\r\n          }\r\n\r\n          if (header) {\r\n            const stepsArray = self.steps;\r\n            const progress = document.createElement('span');\r\n            progress.className = 'shepherd-progress';\r\n            progress.innerText = `${\r\n              stepsArray.indexOf(self.getCurrentStep()) + 1\r\n            }/${stepsArray.length}`;\r\n            header.insertBefore(\r\n              progress,\r\n              currentStepElement.querySelector('.shepherd-cancel-icon')\r\n            );\r\n          }\r\n        }\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  private checkNext(index, tour, service) {\r\n    if (tour.getCurrentStep()) {\r\n      if (\r\n        tour.getCurrentStep().options.attachTo.element &&\r\n        document.querySelector(tour.getCurrentStep().options.attachTo.element)\r\n      ) {\r\n        tour.complete();\r\n        return;\r\n      }\r\n\r\n      if (index.index === tour.steps.length - 1) {\r\n        tour.complete();\r\n        return;\r\n      }\r\n\r\n      tour.steps.splice(index.index, 1);\r\n      const nextStep = tour.steps[index.index];\r\n      if (\r\n        nextStep.options.attachTo.element &&\r\n        !document.querySelector(nextStep.options.attachTo.element)\r\n      ) {\r\n        service.checkNext(index, tour, service);\r\n      } else {\r\n        tour._setupModal();\r\n        tour.show(nextStep.id);\r\n      }\r\n    }\r\n  }\r\n\r\n  private executeAction(\r\n    step: InteractiveTourStep,\r\n    actionConfig: InteractiveTourAction\r\n  ) {\r\n    if (!actionConfig) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      actionConfig.condition &&\r\n      ((actionConfig.condition.charAt(0) === '!' &&\r\n        document.querySelector(actionConfig.condition.slice(1))) ||\r\n        (actionConfig.condition.charAt(0) !== '!' &&\r\n          !document.querySelector(actionConfig.condition)))\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    const element: HTMLElement = document.querySelector(\r\n      actionConfig.element || step.element\r\n    ) as HTMLElement;\r\n    const action = this.getAction(actionConfig.action);\r\n    if (element && action) {\r\n      element[action]();\r\n    }\r\n  }\r\n\r\n  private executeActionPromise(\r\n    step: InteractiveTourStep,\r\n    actionConfig: InteractiveTourAction\r\n  ) {\r\n    return new Promise<void>((resolve) => {\r\n      this.executeAction(step, actionConfig);\r\n      if (!actionConfig || !actionConfig.waitFor) {\r\n        resolve();\r\n        return;\r\n      }\r\n      let nbTry = 0;\r\n      const maxTry = actionConfig.maxWait ? actionConfig.maxWait / 100 : 20;\r\n      const checkExist = setInterval(() => {\r\n        nbTry++;\r\n        if (nbTry > maxTry || document.querySelector(actionConfig.waitFor)) {\r\n          clearInterval(checkExist);\r\n          resolve();\r\n        }\r\n      }, 100);\r\n    });\r\n  }\r\n\r\n  private getShepherdSteps(stepConfig: InteractiveTourOptions) {\r\n    const shepherdSteps: Shepherd.Step.StepOptions[] = [];\r\n\r\n    let i = 0;\r\n    for (const step of stepConfig.steps) {\r\n      shepherdSteps.push({\r\n        attachTo: {\r\n          element: step.element,\r\n          on: (step.position || stepConfig.position) as any // PopperPlacement\r\n        },\r\n        floatingUIOptions: {\r\n          middleware: [offset({ mainAxis: 15 })]\r\n        },\r\n        beforeShowPromise: () => {\r\n          return Promise.all([\r\n            this.executeActionPromise(\r\n              this.previousStep,\r\n              this.previousStep ? this.previousStep.beforeChange : undefined\r\n            ),\r\n            this.executeActionPromise(step, step.beforeShow)\r\n          ]);\r\n        },\r\n        buttons: this.getButtons(\r\n          i === 0\r\n            ? 'first'\r\n            : i + 1 === stepConfig.steps.length\r\n            ? 'last'\r\n            : stepConfig.steps[i].noBackButton\r\n            ? 'noBackButton'\r\n            : undefined\r\n        ),\r\n        classes: step.class,\r\n        highlightClass: step.highlightClass,\r\n        scrollTo: step.scrollToElement || stepConfig.scrollToElement || true,\r\n        canClickTarget: step.disableInteraction\r\n          ? !step.disableInteraction\r\n          : undefined,\r\n        title: this.languageService.translate.instant(\r\n          step.title || stepConfig.title\r\n        ),\r\n        text: [this.languageService.translate.instant(step.text)],\r\n        when: {\r\n          show: () => {\r\n            this.executeAction(step, step.onShow);\r\n          },\r\n          hide: () => {\r\n            this.previousStep = step;\r\n            this.executeAction(step, step.onHide);\r\n          }\r\n        }\r\n      } satisfies Shepherd.Step.StepOptions);\r\n      i++;\r\n    }\r\n\r\n    return shepherdSteps;\r\n  }\r\n\r\n  public startTour(toolName: string) {\r\n    const stepConfig: InteractiveTourOptions =\r\n      this.interactiveTourLoader.getTourOptionData(toolName);\r\n\r\n    this.shepherdService.defaultStepOptions = {\r\n      classes: stepConfig.class,\r\n      highlightClass: stepConfig.highlightClass,\r\n      canClickTarget: stepConfig.disableInteraction\r\n        ? !stepConfig.disableInteraction\r\n        : true,\r\n      cancelIcon: {\r\n        enabled: true\r\n      }\r\n    };\r\n\r\n    const shepherdSteps = this.getShepherdSteps(stepConfig);\r\n\r\n    this.shepherdService.modal = true;\r\n    this.shepherdService.confirmCancel = false;\r\n    this.shepherdService.addSteps(shepherdSteps);\r\n\r\n    this.shepherdService.tourObject.on('show', this.addProgress);\r\n    this.shepherdService.tourObject.on('cancel', (index) => {\r\n      this.checkNext(index, this.shepherdService.tourObject, this);\r\n    });\r\n\r\n    this.shepherdService.start();\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { InteractiveTourService } from './interactive-tour.service';\nimport { InteractiveTourComponent } from './interactive-tour.component';\nimport { InteractiveTourLoader } from './interactive-tour.loader';\n\n@NgModule({\n  declarations: [InteractiveTourComponent],\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule\n  ],\n  providers: [InteractiveTourService, InteractiveTourLoader],\n  exports: [InteractiveTourComponent]\n})\nexport class IgoInteractiveTourModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { KeyValuePipe } from './keyvalue.pipe';\n\n@NgModule({\n  imports: [],\n  declarations: [KeyValuePipe],\n  exports: [KeyValuePipe]\n})\nexport class IgoKeyValueModule {\n  static forRoot(): ModuleWithProviders<IgoKeyValueModule> {\n    return {\n      ngModule: IgoKeyValueModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { ClickoutDirective } from './clickout.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [ClickoutDirective],\n  exports: [ClickoutDirective]\n})\nexport class IgoClickoutModule {\n  static forRoot(): ModuleWithProviders<IgoClickoutModule> {\n    return {\n      ngModule: IgoClickoutModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { IgoClickoutModule } from '../clickout/clickout.module';\n\nimport { ListItemDirective } from './list-item.directive';\nimport { ListComponent } from './list.component';\n\n@NgModule({\n  imports: [CommonModule, MatIconModule, MatListModule, IgoClickoutModule],\n  declarations: [ListItemDirective, ListComponent],\n  exports: [ListItemDirective, ListComponent]\n})\nexport class IgoListModule {\n  static forRoot(): ModuleWithProviders<IgoListModule> {\n    return {\n      ngModule: IgoListModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { PanelComponent } from './panel.component';\n\n@NgModule({\n  imports: [CommonModule],\n  exports: [PanelComponent],\n  declarations: [PanelComponent]\n})\nexport class IgoPanelModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\n\nimport { SpinnerActivityDirective } from './spinner-activity.directive';\nimport { SpinnerComponent } from './spinner.component';\n\n@NgModule({\n  imports: [CommonModule, MatProgressSpinnerModule],\n  declarations: [SpinnerActivityDirective, SpinnerComponent],\n  exports: [SpinnerActivityDirective, SpinnerComponent]\n})\nexport class IgoSpinnerModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { CdkTableModule } from '@angular/cdk/table';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSortModule } from '@angular/material/sort';\nimport { MatTableModule } from '@angular/material/table';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { TableComponent } from './table.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    CdkTableModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTableModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSortModule,\n    MatCheckboxModule,\n    IgoLanguageModule\n  ],\n  declarations: [TableComponent],\n  exports: [TableComponent]\n})\nexport class IgoTableModule {\n  static forRoot(): ModuleWithProviders<IgoTableModule> {\n    return {\n      ngModule: IgoTableModule,\n      providers: []\n    };\n  }\n}\n","export enum EntityOperationType {\n  Insert = 'Insert',\n  Update = 'Update',\n  Delete = 'Delete'\n}\n\nexport enum EntityTableColumnRenderer {\n  Default = 'Default',\n  HTML = 'HTML',\n  UnsanitizedHTML = 'UnsanitizedHTML',\n  Editable = 'Editable',\n  Icon = 'Icon',\n  ButtonGroup = 'ButtonGroup'\n}\n\nexport enum EntityTableScrollBehavior {\n  Auto = 'auto',\n  Instant = 'instant',\n  Smooth = 'smooth'\n}\n\nexport enum EntityTableSelectionState {\n  None = 'None',\n  All = 'All',\n  Some = 'Some'\n}\n","import { t } from 'typy';\n\nimport { EntityKey } from './entity.interfaces';\n\n/**\n * Get an entity's named property. Nested properties are supported\n * with the dotted notation. (i.e 'author.name')\n *\n * Note: this method is a 'best attempt' at getting an entity's property.\n * It fits the most common cases but you might need to explicitely define\n * a property getter when using an EntityStore, for example.\n * @param entity Entity\n * @param property Property name\n * @returns Property value\n */\nexport function getEntityProperty(entity: object, property: string): any {\n  return t(entity, property).safeObject;\n}\n\n/**\n * Get an entity's id. An entity's id can be one of:\n * 'entity.meta.id', 'entity.meta.idProperty' or 'entity.id'.\n *\n * Note: See the note in the 'getEntityProperty' documentation.\n * @param entity Entity\n * @returns Entity id\n */\nexport function getEntityId(entity: object): EntityKey {\n  const meta = (entity as any).meta || {};\n  return meta.id ? meta.id : getEntityProperty(entity, meta.idProperty || 'id');\n}\n\n/**\n * Get an entity's title. An entity's title can be one of:\n * 'entity.meta.title', 'entity.meta.titleProperty' or 'entity.title'.\n * @param entity Entity\n * @returns Entity title\n */\nexport function getEntityTitle(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.title\n    ? meta.title\n    : getEntityProperty(entity, meta.titleProperty || 'title');\n}\n\n/**\n * Get an entity's HTML title. An entity's HTML title can be one of:\n * 'entity.meta.titleHtml', 'entity.meta.titleHtmlProperty' or 'entity.titleHtml'.\n * @param entity Entity\n * @returns Entity HTML title\n */\nexport function getEntityTitleHtml(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.titleHtml\n    ? meta.titleHtml\n    : getEntityProperty(entity, meta.titleHtmlProperty || 'titleHtml');\n}\n\n/**\n * Get an entity's icon. An entity's icon can be one of:\n * 'entity.meta.icon', 'entity.meta.iconProperty' or 'entity.icon'.\n * @param entity Entity\n * @returns Entity icon\n */\nexport function getEntityIcon(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.icon\n    ? meta.icon\n    : getEntityProperty(entity, meta.iconProperty || 'icon');\n}\n\n/**\n * Get an entity's revision.\n * @param entity Entity\n * @returns Entity revision\n */\nexport function getEntityRevision(entity: object): number {\n  const meta = (entity as any).meta || {};\n  return meta.revision || 0;\n}\n","import { ReplaySubject } from 'rxjs';\n\nimport { EntityKey, EntityState } from './entity.interfaces';\nimport { getEntityId } from './entity.utils';\n\ninterface EntityStateManagerOptions<E extends object> {\n  getKey?: (entity: object) => EntityKey;\n  index?: Map<EntityKey, E>;\n}\n\n/**\n * This class is used to track a store's entities state\n */\nexport class EntityStateManager<\n  E extends object,\n  S extends EntityState = EntityState\n> {\n  /**\n   * State index\n   */\n  readonly index = new Map<EntityKey, S>();\n\n  /**\n   * Change emitter\n   */\n  readonly change$ = new ReplaySubject<void>(1);\n\n  /**\n   * Method to get an entity's id\n   */\n  readonly getKey: (E) => EntityKey;\n\n  constructor(private options: EntityStateManagerOptions<E> = {}) {\n    this.getKey = options.getKey ? options.getKey : getEntityId;\n\n    this.next();\n  }\n\n  /**\n   * Clear state\n   */\n  clear() {\n    if (this.index.size > 0) {\n      this.index.clear();\n      this.next();\n    }\n  }\n\n  /**\n   * Get an entity's state\n   * @param entity Entity\n   * @returns State\n   */\n  get(entity: E): S {\n    return (this.index.get(this.getKey(entity)) || {}) as S;\n  }\n\n  /**\n   * Set an entity's state\n   * @param entity Entity\n   * @param state State\n   */\n  set(entity: E, state: S) {\n    this.setMany([entity], state);\n  }\n\n  /**\n   * Set many entitie's state\n   * @param entitie Entities\n   * @param state State\n   */\n  setMany(entities: E[], state: S) {\n    entities.forEach((entity: E) => {\n      this.index.set(this.getKey(entity), Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Set state of all entities that already have a state. This is not\n   * the same as setting the state of all the store's entities.\n   * @param state State\n   */\n  setAll(state: S) {\n    Array.from(this.index.keys()).forEach((key: EntityKey) => {\n      this.index.set(key, Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Update an entity's state\n   * @param entity Entity\n   * @param changes State changes\n   */\n  update(entity: E, changes: Partial<S>, exclusive = false) {\n    this.updateMany([entity], changes, exclusive);\n  }\n\n  /**\n   * Update many entitie's state\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  updateMany(entities: E[], changes: Partial<S>, exclusive = false) {\n    if (exclusive === true) {\n      return this.updateManyExclusive(entities, changes);\n    }\n\n    entities.forEach((entity: E) => {\n      const state = Object.assign({}, this.get(entity), changes);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Reversee an entity's state\n   * @param entity Entity\n   * @param keys State keys to reverse\n   */\n  reverse(entity: E, keys: string[]) {\n    this.reverseMany([entity], keys);\n  }\n\n  /**\n   * Reverse many entitie's state\n   * @param entitie Entities\n   * @param keys State keys to reverse\n   */\n  reverseMany(entities: E[], keys: string[]) {\n    entities.forEach((entity: E) => {\n      const currentState = this.get(entity);\n      const changes = keys.reduce(\n        (acc: { [key: string]: boolean }, key: string) => {\n          acc[key] = currentState[key] || false;\n          return acc;\n        },\n        {}\n      ) as Partial<S>;\n      const reversedChanges = this.reverseChanges(changes);\n      const state = Object.assign({}, currentState, reversedChanges);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Update state of all entities that already have a state. This is not\n   * the same as updating the state of all the store's entities.\n   * @param changes State\n   */\n  updateAll(changes: Partial<S>) {\n    const allKeys = this.getAllKeys();\n    Array.from(allKeys).forEach((key: EntityKey) => {\n      const state = Object.assign({}, this.index.get(key), changes);\n      this.index.set(key, state);\n    });\n    this.next();\n  }\n\n  /**\n   * When some state changes are flagged as 'exclusive', reverse\n   * the state of all other entities. Changes are reversable when\n   * they are boolean.\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  private updateManyExclusive(entities: E[], changes: Partial<S>) {\n    const reverseChanges = this.reverseChanges(changes);\n\n    const keys = entities.map((entity: E) => this.getKey(entity));\n    const allKeys = new Set(keys.concat(Array.from(this.getAllKeys())));\n    allKeys.forEach((key: EntityKey) => {\n      const state = this.index.get(key) || ({} as S);\n\n      if (keys.indexOf(key) >= 0) {\n        this.index.set(key, Object.assign({}, state, changes));\n      } else {\n        // Update only if the reverse changes would modify\n        // a key already present in the current state\n        const shouldUpdate = Object.keys(reverseChanges).some(\n          (changeKey: string) => {\n            return (\n              state[changeKey] !== undefined &&\n              state[changeKey] !== reverseChanges[changeKey]\n            );\n          }\n        );\n        if (shouldUpdate === true) {\n          this.index.set(key, Object.assign({}, state, reverseChanges));\n        }\n      }\n    });\n\n    this.next();\n  }\n\n  /**\n   * Compute a 'reversed' version of some state changes.\n   * Changes are reversable when they are boolean.\n   * @param changes State changes\n   * @returns Reversed state changes\n   */\n  private reverseChanges(changes: Partial<S>): Partial<S> {\n    return Object.entries(changes).reduce(\n      (reverseChanges: Partial<S>, bunch: [string, any]) => {\n        const [changeKey, value] = bunch;\n        if (typeof value === typeof true) {\n          (reverseChanges as object)[changeKey] = !value;\n        }\n        return reverseChanges;\n      },\n      {}\n    );\n  }\n\n  /**\n   * Return all the keys in that state and in the store it's bound to, if any.\n   * @returns Set of keys\n   */\n  private getAllKeys(): Set<EntityKey> {\n    const storeKeys = Array.from(this.options?.index?.keys() ?? []);\n    return new Set(Array.from(this.index.keys()).concat(storeKeys));\n  }\n\n  /**\n   * Emit 'change' event\n   */\n  private next() {\n    this.change$.next();\n  }\n}\n","import { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\nimport { debounceTime, map, skip } from 'rxjs/operators';\n\nimport { ObjectUtils, uuid } from '@igo2/utils';\nimport {\n  EntityKey,\n  EntityFilterClause,\n  EntitySortClause,\n  EntityJoinClause\n} from './entity.interfaces';\n\n/**\n * An entity view streams entities from an observable source. These entities\n * can be filtered or sorted without affecting the source. A view can also\n * combine data from multiple sources, joined together.\n */\nexport class EntityView<E extends object, V extends object = E> {\n  /**\n   * Observable stream of values\n   */\n  readonly values$ = new BehaviorSubject<V[]>([]);\n\n  /**\n   * Subscription to the source (and joined sources) values\n   */\n  private values$$: Subscription;\n\n  /**\n   * Whether this view has been lifted\n   */\n  private lifted = false;\n\n  /**\n   * Join clauses\n   */\n  private joins: EntityJoinClause[] = [];\n\n  /**\n   * Observable of a filter clause\n   */\n  private filter$ = new BehaviorSubject(undefined);\n\n  /**\n   * Observable of filter clauses\n   */\n  private filters$: BehaviorSubject<EntityFilterClause[]> = new BehaviorSubject(\n    []\n  );\n\n  /**\n   * Filters index\n   */\n  private filterIndex: Map<string, EntityFilterClause> = new Map();\n\n  /**\n   * Observable of a sort clause\n   */\n  private sort$ = new BehaviorSubject(undefined);\n\n  /**\n   * Method for indexing\n   */\n  get getKey(): (V) => EntityKey {\n    return this.getKey$.value;\n  }\n  private getKey$: BehaviorSubject<(V) => EntityKey> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Number of entities\n   */\n  readonly count$ = new BehaviorSubject<number>(0);\n  get count(): number {\n    return this.count$.value;\n  }\n\n  /**\n   * Whether the store is empty\n   */\n  readonly empty$ = new BehaviorSubject<boolean>(true);\n  get empty(): boolean {\n    return this.empty$.value;\n  }\n\n  /**\n   * Store index\n   */\n  get index(): Map<EntityKey, V> {\n    return this._index;\n  }\n  private _index: Map<EntityKey, V>;\n\n  constructor(private source$: BehaviorSubject<E[]>) {}\n\n  /**\n   * Get a value from the view by key\n   * @param key Key\n   * @returns Value\n   */\n  get(key: EntityKey): V {\n    if (this._index === undefined) {\n      throw new Error(\n        'This view has no index, therefore, this method is unavailable.'\n      );\n    }\n    return this.index.get(key);\n  }\n\n  /**\n   * Get all the values\n   * @returns Array of values\n   */\n  all(): V[] {\n    return this.values$.value;\n  }\n\n  /**\n   * Observe all the values\n   * @returns Observable of values\n   */\n  all$(): BehaviorSubject<V[]> {\n    return this.values$;\n  }\n\n  /**\n   * Get the first value that respects a criteria\n   * @returns A value\n   */\n  firstBy(clause: EntityFilterClause<V>): V {\n    return this.values$.value.find(clause);\n  }\n\n  /**\n   * Observe the first value that respects a criteria\n   * @returns Observable of a value\n   */\n  firstBy$(clause: EntityFilterClause<V>): Observable<V> {\n    return this.values$.pipe(map((values: V[]) => values.find(clause)));\n  }\n\n  /**\n   * Get all the values that respect a criteria\n   * @returns Array of values\n   */\n  manyBy(clause: EntityFilterClause<V>): V[] {\n    return this.values$.value.filter(clause);\n  }\n\n  /**\n   * Observe all the values that respect a criteria\n   * @returns Observable of values\n   */\n  manyBy$(clause: EntityFilterClause<V>): Observable<V[]> {\n    return this.values$.pipe(map((values: V[]) => values.filter(clause)));\n  }\n\n  /**\n   * Clear the filter and sort and unsubscribe from the source\n   */\n  clear() {\n    this.filter(undefined);\n    this.sort(undefined);\n  }\n\n  destroy() {\n    if (this.values$$ !== undefined) {\n      this.values$$.unsubscribe();\n    }\n    this.clear();\n  }\n\n  /**\n   * Create an index\n   * @param getKey Method to get a value's id\n   * @returns The view\n   */\n  createIndex(getKey: (E) => EntityKey): EntityView<E, V> {\n    this._index = new Map();\n    this.getKey$.next(getKey);\n    return this;\n  }\n\n  /**\n   * Join another source to the stream (chainable)\n   * @param clause Join clause\n   * @returns The view\n   */\n  join(clause: EntityJoinClause): EntityView<E, V> {\n    if (this.lifted === true) {\n      throw new Error(\n        'This view has already been lifted, therefore, no join is allowed.'\n      );\n    }\n    this.joins.push(clause);\n    return this;\n  }\n\n  /**\n   * Filter values (chainable)\n   * @param clause Filter clause\n   * @returns The view\n   */\n  filter(clause: EntityFilterClause<V>): EntityView<E, V> {\n    this.filter$.next(clause);\n    return this;\n  }\n\n  /**\n   * @param clause Filter clause\n   * @returns The filter id\n   */\n  addFilter(clause: EntityFilterClause<V>): string {\n    const id = uuid();\n    this.filterIndex.set(id, clause);\n    this.filters$.next(Array.from(this.filterIndex.values()));\n    return id;\n  }\n\n  /**\n   * Remove a filter by id\n   * @param clause Filter clause\n   */\n  removeFilter(id: string) {\n    this.filterIndex.delete(id);\n    this.filters$.next(Array.from(this.filterIndex.values()));\n  }\n\n  /**\n   * Sort values (chainable)\n   * @param clauseSort clause\n   * @returns The view\n   */\n  sort(clause: EntitySortClause<V>): EntityView<E, V> {\n    this.sort$.next(clause);\n    return this;\n  }\n\n  /**\n   * Create the final observable\n   * @returns Observable\n   */\n  lift() {\n    this.lifted = true;\n    const source$ =\n      this.joins.length > 0 ? this.liftJoinedSource() : this.liftSource();\n    const observables$ = [\n      source$,\n      this.filters$,\n      this.filter$,\n      this.sort$,\n      this.getKey$\n    ];\n\n    this.values$$ = combineLatest(observables$)\n      .pipe(skip(1), debounceTime(5))\n      .subscribe((bunch: any[]) => {\n        const [_values, filters, filter, sort, getKey] = bunch;\n        const values = this.processValues(_values, filters, filter, sort);\n        const generateIndex = getKey !== undefined;\n        this.setValues(values, generateIndex);\n      });\n  }\n\n  /**\n   * Create the source observable when no joins are defined\n   * @returns Observable\n   */\n  private liftSource(): Observable<V[]> {\n    return this.source$ as any as Observable<V[]>;\n  }\n\n  /**\n   * Create the source observable when joins are defined\n   * @returns Observable\n   */\n  private liftJoinedSource(): Observable<V[]> {\n    const sources$ = [\n      this.source$,\n      combineLatest(this.joins.map((join: EntityJoinClause) => join.source))\n    ];\n\n    return combineLatest(sources$).pipe(\n      map((bunch: [E[], any[]]) => {\n        const [entities, joinData] = bunch;\n        return entities.reduce((values: V[], entity: E) => {\n          const value = this.computeJoinedValue(entity, joinData);\n          if (value !== undefined) {\n            values.push(value);\n          }\n          return values;\n        }, []);\n      })\n    );\n  }\n\n  /**\n   * Apply joins to a source's entity and return the final value\n   * @returns Final value\n   */\n  private computeJoinedValue(entity: E, joinData: any[]): V | undefined {\n    let value = entity as Partial<V>;\n    let joinIndex = 0;\n    while (value !== undefined && joinIndex < this.joins.length) {\n      value = this.joins[joinIndex].reduce(value, joinData[joinIndex]);\n      joinIndex += 1;\n    }\n    return value as V;\n  }\n\n  /**\n   * Filter and sort values before streaming them\n   * @param values Values\n   * @param filters Filter clauses\n   * @param filter Filter clause\n   * @param sort Sort clause\n   * @returns Filtered and sorted values\n   */\n  private processValues(\n    values: V[],\n    filters: EntityFilterClause[],\n    filter: EntityFilterClause,\n    sort: EntitySortClause\n  ): V[] {\n    values = values.slice(0);\n    values = this.filterValues(values, filters.concat([filter]));\n    values = this.sortValues(values, sort);\n    return values;\n  }\n\n  /**\n   * Filter values\n   * @param values Values\n   * @param filters Filter clauses\n   * @returns Filtered values\n   */\n  private filterValues(values: V[], clauses: EntityFilterClause[]): V[] {\n    if (clauses.length === 0) {\n      return values;\n    }\n\n    return values.filter((value: V) => {\n      return clauses\n        .filter((clause: EntityFilterClause) => clause !== undefined)\n        .every((clause: EntityFilterClause) => clause(value));\n    });\n  }\n\n  /**\n   * Sort values\n   * @param values Values\n   * @param sort Sort clause\n   * @returns Sorted values\n   */\n  private sortValues(values: V[], clause: EntitySortClause): V[] {\n    if (clause === undefined) {\n      return values;\n    }\n    return values.sort((v1: V, v2: V) => {\n      return ObjectUtils.naturalCompare(\n        clause.valueAccessor(v1),\n        clause.valueAccessor(v2),\n        clause.direction,\n        clause.nullsFirst\n      );\n    });\n  }\n\n  /**\n   * Set value and optionally generate an index\n   * @param values Values\n   * @param generateIndex boolean\n   */\n  private setValues(values: V[], generateIndex: boolean) {\n    if (generateIndex === true) {\n      this._index = this.generateIndex(values);\n    }\n\n    this.values$.next(values);\n\n    const count = values.length;\n    const empty = count === 0;\n    this.count$.next(count);\n    this.empty$.next(empty);\n  }\n\n  /**\n   * Generate a complete index of all the values\n   * @param entities Entities\n   * @returns Index\n   */\n  private generateIndex(values: V[]): Map<EntityKey, V> {\n    const entries = values.map((value: V) => [this.getKey(value), value]);\n    return new Map(entries as [EntityKey, V][]);\n  }\n}\n","import { BehaviorSubject } from 'rxjs';\n\nimport { EntityStateManager } from './state';\nimport { EntityView } from './view';\nimport { EntityKey, EntityState, EntityRecord } from './entity.interfaces';\nimport { getEntityId, getEntityProperty } from './entity.utils';\n\nexport interface EntityStoreOptions {\n  getKey?: (entity: object) => EntityKey;\n  getProperty?: (entity: object, property: string) => any;\n}\n\n/**\n * An entity store class holds any number of entities\n * as well as their state. It can be observed, filtered and sorted and\n * provides methods to insert, update or delete entities.\n */\nexport class EntityStore<\n  E extends object = object,\n  S extends EntityState = EntityState\n> {\n  /**\n   * Observable of the raw entities\n   */\n  readonly entities$ = new BehaviorSubject<E[]>([]);\n\n  /**\n   * Number of entities\n   */\n  readonly count$ = new BehaviorSubject<number>(0);\n  get count(): number {\n    return this.count$.value;\n  }\n\n  /**\n   * Whether the store is empty\n   */\n  readonly empty$ = new BehaviorSubject<boolean>(true);\n  get empty(): boolean {\n    return this.empty$.value;\n  }\n\n  /**\n   * Entity store state\n   */\n  readonly state: EntityStateManager<E, S>;\n\n  /**\n   * View of all the entities\n   */\n  readonly view: EntityView<E>;\n\n  /**\n   * View of all the entities and their state\n   */\n  readonly stateView: EntityView<E, EntityRecord<E, S>>;\n\n  /**\n   * Method to get an entity's id\n   */\n  readonly getKey: (E) => EntityKey;\n\n  /**\n   * Method to get an entity's named property\n   */\n  readonly getProperty: (E, prop: string) => any;\n\n  /**\n   * Store index\n   */\n  get index(): Map<EntityKey, E> {\n    return this._index;\n  }\n  private _index: Map<EntityKey, E>;\n\n  /**\n   * Store index\n   */\n  get pristine(): boolean {\n    return this._pristine;\n  }\n  private _pristine: boolean = true;\n\n  constructor(entities: E[], options: EntityStoreOptions = {}) {\n    this.getKey = options.getKey ? options.getKey : getEntityId;\n    this.getProperty = options.getProperty\n      ? options.getProperty\n      : getEntityProperty;\n\n    this.state = this.createStateManager();\n    this.view = this.createDataView();\n    this.stateView = this.createStateView();\n\n    this.view.lift();\n    this.stateView.lift();\n\n    if (entities.length > 0) {\n      this.load(entities);\n    } else {\n      this._index = this.generateIndex(entities);\n    }\n  }\n\n  /**\n   * Get an entity from the store by key\n   * @param key Key\n   * @returns Entity\n   */\n  get(key: EntityKey): E {\n    return this.index.get(key);\n  }\n\n  /**\n   * Get all entities in the store\n   * @returns Array of entities\n   */\n  all(): E[] {\n    return this.entities$.value;\n  }\n\n  /**\n   * Set this store's entities\n   * @param entities Entities\n   */\n  load(entities: E[], pristine: boolean = true) {\n    this._index = this.generateIndex(entities);\n    this._pristine = pristine;\n    this.next();\n  }\n\n  /**\n   * Clear the store's entities but keep the state and views intact.\n   * Views won't return any data but future data will be subject to the\n   * current views filter and sort\n   */\n  softClear() {\n    if (this.index && this.index.size > 0) {\n      this.index.clear();\n      this._pristine = true;\n      this.next();\n    } else if (this.index) {\n      this.updateCount();\n    }\n  }\n\n  /**\n   * Clear the store's entities, state and views\n   */\n  clear() {\n    this.stateView.clear();\n    this.view.clear();\n    this.state.clear();\n    this.softClear();\n  }\n\n  destroy() {\n    this.stateView.destroy();\n    this.view.destroy();\n    this.clear();\n  }\n\n  /**\n   * Insert an entity into the store\n   * @param entity Entity\n   */\n  insert(entity: E) {\n    this.insertMany([entity]);\n  }\n\n  /**\n   * Insert many entities into the store\n   * @param entities Entities\n   */\n  insertMany(entities: E[]) {\n    entities.forEach((entity: E) =>\n      this.index.set(this.getKey(entity), entity)\n    );\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Update or insert an entity into the store\n   * @param entity Entity\n   */\n  update(entity: E) {\n    this.updateMany([entity]);\n  }\n\n  /**\n   * Update or insert many entities into the store\n   * @param entities Entities\n   */\n  updateMany(entities: E[]) {\n    entities.forEach((entity: E) =>\n      this.index.set(this.getKey(entity), entity)\n    );\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Delete an entity from the store\n   * @param entity Entity\n   */\n  delete(entity: E) {\n    this.deleteMany([entity]);\n  }\n\n  /**\n   * Delete many entities from the store\n   * @param entities Entities\n   */\n  deleteMany(entities: E[]) {\n    entities.forEach((entity: E) => this.index.delete(this.getKey(entity)));\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Generate a complete index of all the entities\n   * @param entities Entities\n   * @returns Index\n   */\n  private generateIndex(entities: E[]): Map<EntityKey, E> {\n    const entries = entities.map((entity: E) => [this.getKey(entity), entity]);\n    return new Map(entries as [EntityKey, E][]);\n  }\n\n  /**\n   * Push the index's entities into the entities$ observable\n   */\n  private next() {\n    this.entities$.next(Array.from(this.index.values()));\n    this.updateCount();\n  }\n\n  /**\n   * Update the store's count and empty\n   */\n  private updateCount() {\n    const count = this.index.size;\n    const empty = count === 0;\n    this.count$.next(count);\n    this.empty$.next(empty);\n  }\n\n  /**\n   * Create the entity state manager\n   * @returns EntityStateManager\n   */\n  private createStateManager() {\n    return new EntityStateManager<E, S>({\n      getKey: this.getKey,\n      index: this.index\n    });\n  }\n\n  /**\n   * Create the data view\n   * @returns EntityView<E>\n   */\n  private createDataView() {\n    return new EntityView<E>(this.entities$);\n  }\n\n  /**\n   * Create the state view\n   * @returns EntityView<EntityRecord<E>>\n   */\n  private createStateView() {\n    return new EntityView<E, EntityRecord<E, S>>(this.view.all$())\n      .join({\n        source: this.state.change$,\n        reduce: (entity: E): EntityRecord<E, S> => {\n          const key = this.getKey(entity);\n          const state = this.state.get(entity);\n          const currentRecord = this.stateView.get(key);\n\n          if (\n            currentRecord !== undefined &&\n            currentRecord.entity === entity &&\n            this.statesAreTheSame(currentRecord.state, state)\n          ) {\n            return currentRecord;\n          }\n\n          const revision = currentRecord ? currentRecord.revision + 1 : 1;\n          const ref = `${key}-${revision}`;\n          return { entity, state, revision, ref };\n        }\n      })\n      .createIndex((record: EntityRecord<E, S>) => this.getKey(record.entity));\n  }\n\n  private statesAreTheSame(currentState: S, newState: S): boolean {\n    if (currentState === newState) {\n      return true;\n    }\n\n    const currentStateIsEmpty = Object.keys(currentState).length === 0;\n    const newStateIsEmpty = Object.keys(newState).length === 0;\n    return currentStateIsEmpty && newStateIsEmpty;\n  }\n}\n","import { EntityState } from './entity.interfaces';\nimport { EntityStoreStrategy } from './strategies/strategy';\nimport { EntityStore, EntityStoreOptions } from './store';\n\nexport class EntityStoreWithStrategy<\n  E extends object = object,\n  S extends EntityState = EntityState\n> extends EntityStore<E, S> {\n  /**\n   * Strategies\n   */\n  private strategies: EntityStoreStrategy[] = [];\n\n  constructor(entities: E[], options: EntityStoreOptions = {}) {\n    super(entities, options);\n  }\n\n  /**\n   * Add a strategy to this store\n   * @param strategy Entity store strategy\n   * @returns Entity store\n   */\n  addStrategy(\n    strategy: EntityStoreStrategy,\n    activate: boolean = false\n  ): EntityStore {\n    const existingStrategy = this.strategies.find(\n      (_strategy: EntityStoreStrategy) => {\n        return strategy.constructor === _strategy.constructor;\n      }\n    );\n    if (existingStrategy !== undefined) {\n      throw new Error(\n        'A strategy of this type already exists on that EntityStore.'\n      );\n    }\n\n    this.strategies.push(strategy);\n    strategy.bindStore(this);\n\n    if (activate === true) {\n      strategy.activate();\n    }\n\n    return this;\n  }\n\n  /**\n   * Remove a strategy from this store\n   * @param strategy Entity store strategy\n   * @returns Entity store\n   */\n  removeStrategy(strategy: EntityStoreStrategy): EntityStore {\n    const index = this.strategies.indexOf(strategy);\n    if (index >= 0) {\n      this.strategies.splice(index, 1);\n      strategy.unbindStore(this);\n    }\n    return this;\n  }\n\n  /**\n   * Return strategies of a given type\n   * @param type Entity store strategy class\n   * @returns Strategies\n   */\n  getStrategyOfType(type: typeof EntityStoreStrategy): EntityStoreStrategy {\n    return this.strategies.find((strategy: EntityStoreStrategy) => {\n      return strategy instanceof type;\n    });\n  }\n\n  /**\n   * Activate strategies of a given type\n   * @param type Entity store strategy class\n   */\n  activateStrategyOfType(type: typeof EntityStoreStrategy) {\n    const strategy = this.getStrategyOfType(type);\n    if (strategy !== undefined) {\n      strategy.activate();\n    }\n  }\n\n  /**\n   * Deactivate strategies of a given type\n   * @param type Entity store strategy class\n   */\n  deactivateStrategyOfType(type: typeof EntityStoreStrategy) {\n    const strategy = this.getStrategyOfType(type);\n    if (strategy !== undefined) {\n      strategy.deactivate();\n    }\n  }\n}\n","import { ChangeDetectorRef } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { skip } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { EntityKey } from './entity.interfaces';\n\nimport { EntityStore } from './store';\n\n/**\n * This class is used to synchronize a component's changes\n * detection with an EntityStore changes. For example, it is frequent\n * to have a component subscribe to a store's selected entity and, at the same time,\n * this component provides a way to select an entity with, let's say, a click.\n *\n * This class automatically handles those case and triggers the compoent's\n * change detection when needed.\n *\n * Note: If the component observes the store's stateView, a workspace is\n * probably not required because the stateView catches any changes to the\n * entities and their state.\n */\nexport class EntityStoreWatcher<E extends object> {\n  /**\n   * Component change detector\n   */\n  private cdRef: ChangeDetectorRef;\n\n  /**\n   * Entity store\n   */\n  private store: EntityStore<E>;\n\n  /**\n   * Component inner state\n   */\n  private innerStateIndex = new Map<EntityKey, { [key: string]: any }>();\n\n  /**\n   * Subscription to the store's entities\n   */\n  private entities$$: Subscription;\n\n  /**\n   * Subscription to the store's state\n   */\n  private state$$: Subscription;\n\n  constructor(store?: EntityStore<E>, cdRef?: ChangeDetectorRef) {\n    this.setChangeDetector(cdRef);\n    this.setStore(store);\n  }\n\n  destroy() {\n    this.setChangeDetector(undefined);\n    this.setStore(undefined);\n  }\n\n  /**\n   * Bind this workspace to a store and start watching for changes\n   * @param store Entity store\n   */\n  setStore(store?: EntityStore<E>) {\n    if (store === undefined) {\n      this.teardownObservers();\n      this.innerStateIndex.clear();\n      this.store = undefined;\n      return;\n    }\n\n    this.setStore(undefined);\n    this.store = store;\n    this.setupObservers();\n    this.detectChanges();\n  }\n\n  /**\n   * Bind this workspace to a component's change detector\n   * @param cdRef Change detector\n   */\n  setChangeDetector(cdRef?: ChangeDetectorRef) {\n    this.cdRef = cdRef;\n  }\n\n  /**\n   * Set up observers on a store's entities and their state\n   * @param store Entity store\n   */\n  private setupObservers() {\n    this.teardownObservers();\n\n    this.entities$$ = this.store.entities$.subscribe((entities: E[]) =>\n      this.onEntitiesChange(entities)\n    );\n\n    this.state$$ = this.store.state.change$\n      .pipe(skip(1))\n      .subscribe(() => this.onStateChange());\n  }\n\n  /**\n   * Teardown store observers\n   */\n  private teardownObservers() {\n    if (this.entities$$ !== undefined) {\n      this.entities$$.unsubscribe();\n    }\n    if (this.state$$ !== undefined) {\n      this.state$$.unsubscribe();\n    }\n    this.entities$$ = undefined;\n    this.state$$ = undefined;\n  }\n\n  /**\n   * When the entities change, always trigger the changes detection\n   */\n  private onEntitiesChange(entities: E[]) {\n    this.detectChanges();\n  }\n\n  /**\n   * When the entities state change, trigger the change detection\n   * only if the component has not handled these changes yet. For example,\n   * the component might have initiated thoses changes itself.\n   */\n  private onStateChange() {\n    let changesDetected = false;\n    const storeIndex = this.store.state.index;\n    const innerIndex = this.innerStateIndex;\n\n    if (storeIndex.size !== innerIndex.size) {\n      changesDetected = this.detectChanges();\n    }\n\n    const storeKeys = Array.from(storeIndex.keys());\n    for (const key of storeKeys) {\n      const storeValue = storeIndex.get(key);\n      const innerValue = innerIndex.get(key);\n      if (changesDetected === false) {\n        if (innerValue === undefined) {\n          changesDetected = this.detectChanges();\n        } else if (!ObjectUtils.objectsAreEquivalent(storeValue, innerValue)) {\n          changesDetected = this.detectChanges();\n        }\n      }\n\n      this.innerStateIndex.set(key, Object.assign({}, storeValue));\n    }\n  }\n\n  /**\n   * Trigger the change detection of the workspace is bound to a change detector\n   */\n  private detectChanges() {\n    if (this.cdRef !== undefined) {\n      this.cdRef.detectChanges();\n    }\n    return true;\n  }\n}\n","import { BehaviorSubject } from 'rxjs';\n\nimport { EntityStoreStrategyOptions } from '../entity.interfaces';\nimport { EntityStore } from '../store';\n\n/**\n * Entity store strategies. They can do pretty much anything during a store's\n * lifetime. For example, they may act as triggers when something happens.\n * Sharing a strategy is a good idea when multiple strategies would have\n * on cancelling effect on each other.\n *\n * At creation, strategy is inactive and needs to be manually activated.\n */\nexport class EntityStoreStrategy {\n  /**\n   * Feature store\n   * @internal\n   */\n  protected stores: EntityStore[] = [];\n\n  /**\n   * Whether this strategy is active\n   * @internal\n   */\n  get active(): boolean {\n    return this.active$.value;\n  }\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  constructor(protected options: EntityStoreStrategyOptions = {}) {\n    this.options = options;\n  }\n\n  /**\n   * Activate the strategy. If it's already active, it'll be deactivated\n   * and activated again.\n   */\n  activate() {\n    if (this.active === true) {\n      this.doDeactivate();\n    }\n    this.active$.next(true);\n    this.doActivate();\n  }\n\n  /**\n   * Activate the strategy. If it's already active, it'll be deactivated\n   * and activated again.\n   */\n  deactivate() {\n    this.active$.next(false);\n    this.doDeactivate();\n  }\n\n  /**\n   * Bind this strategy to a store\n   * @param store Feature store\n   */\n  bindStore(store: EntityStore) {\n    if (this.stores.indexOf(store) < 0) {\n      this.stores.push(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from store\n   * @param store Feature store\n   */\n  unbindStore(store: EntityStore) {\n    const index = this.stores.indexOf(store);\n    if (index >= 0) {\n      this.stores.splice(index, 1);\n    }\n  }\n\n  /**\n   * Do the stataegy activation\n   * @internal\n   */\n  protected doActivate() {}\n\n  /**\n   * Do the strategy deactivation\n   * @internal\n   */\n  protected doDeactivate() {}\n}\n","import { EntityStoreStrategyFuncOptions } from '../entity.interfaces';\nimport { EntityStore } from '../store';\nimport { EntityStoreStrategy } from './strategy';\n\n/**\n * When active, this strategy filters a store's stateView to return\n * selected entities only.\n */\nexport class EntityStoreFilterCustomFuncStrategy extends EntityStoreStrategy {\n  constructor(protected options: EntityStoreStrategyFuncOptions) {\n    super(options);\n  }\n\n  /**\n   * Store / filter ids map\n   */\n  private filters: Map<EntityStore, string> = new Map();\n\n  /**\n   * Bind this strategy to a store and start filtering it\n   * @param store Entity store\n   */\n  bindStore(store: EntityStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.filterStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop filtering it\n   * @param store Entity store\n   */\n  unbindStore(store: EntityStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unfilterStore(store);\n    }\n  }\n\n  /**\n   * Start filtering all stores\n   * @internal\n   */\n  protected doActivate() {\n    this.filterAll();\n  }\n\n  /**\n   * Stop filtering all stores\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unfilterAll();\n  }\n\n  /**\n   * Filter all stores\n   */\n  private filterAll() {\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\n  }\n\n  /**\n   * Unfilter all stores\n   */\n  private unfilterAll() {\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\n  }\n\n  /**\n   * Filter a store and add it to the filters map\n   */\n  private filterStore(store: EntityStore) {\n    this.filters.set(\n      store,\n      store.stateView.addFilter(this.options.filterClauseFunc)\n    );\n  }\n\n  /**\n   * Unfilter a store and delete it from the filters map\n   */\n  private unfilterStore(store: EntityStore) {\n    const filterId = this.filters.get(store);\n    if (filterId === undefined) {\n      return;\n    }\n\n    store.stateView.removeFilter(filterId);\n    this.filters.delete(store);\n  }\n}\n","import { EntityRecord } from '../entity.interfaces';\nimport { EntityStore } from '../store';\nimport { EntityStoreStrategy } from './strategy';\n\n/**\n * When active, this strategy filters a store's stateView to return\n * selected entities only.\n */\nexport class EntityStoreFilterSelectionStrategy extends EntityStoreStrategy {\n  /**\n   * Store / filter ids map\n   */\n  private filters: Map<EntityStore, string> = new Map();\n\n  /**\n   * Bind this strategy to a store and start filtering it\n   * @param store Entity store\n   */\n  bindStore(store: EntityStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.filterStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop filtering it\n   * @param store Entity store\n   */\n  unbindStore(store: EntityStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unfilterStore(store);\n    }\n  }\n\n  /**\n   * Start filtering all stores\n   * @internal\n   */\n  protected doActivate() {\n    this.filterAll();\n  }\n\n  /**\n   * Stop filtering all stores\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unfilterAll();\n  }\n\n  /**\n   * Filter all stores\n   */\n  private filterAll() {\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\n  }\n\n  /**\n   * Unfilter all stores\n   */\n  private unfilterAll() {\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\n  }\n\n  /**\n   * Filter a store and add it to the filters map\n   */\n  private filterStore(store: EntityStore) {\n    if (this.filters.has(store)) {\n      return;\n    }\n\n    const filter = (record: EntityRecord<object>) => {\n      return record.state.selected === true;\n    };\n    this.filters.set(store, store.stateView.addFilter(filter));\n  }\n\n  /**\n   * Unfilter a store and delete it from the filters map\n   */\n  private unfilterStore(store: EntityStore) {\n    const filterId = this.filters.get(store);\n    if (filterId === undefined) {\n      return;\n    }\n\n    store.stateView.removeFilter(filterId);\n    this.filters.delete(store);\n  }\n}\n","<mat-form-field class=\"igo-entity-selector\" subscriptSizing=\"dynamic\">\n  <mat-select\n    [disabled]=\"disabled\"\n    [value]=\"selected$ | async\"\n    [multiple]=\"multi\"\n    [placeholder]=\"placeholder\"\n    (selectionChange)=\"onSelectionChange($event)\"\n  >\n    <mat-option\n      *ngIf=\"emptyText !== undefined && multi === false\"\n      [value]=\"emptyValue\"\n      >{{ emptyText }}</mat-option\n    >\n    <mat-option *ngIf=\"multi === true\" [value]=\"multiSelectValue\">{{\n      multiText$ | async\n    }}</mat-option>\n    <ng-template ngFor let-record [ngForOf]=\"store.stateView.all$() | async\">\n      <mat-option [value]=\"record.entity\">\n        {{ titleAccessor(record.entity) }}\n      </mat-option>\n    </ng-template>\n  </mat-select>\n</mat-form-field>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { EntityRecord } from '../shared/entity.interfaces';\nimport { EntityStore } from '../shared/store';\nimport { EntityStoreWatcher } from '../shared/watcher';\nimport { getEntityTitle } from '../shared/entity.utils';\n\n@Component({\n  selector: 'igo-entity-selector',\n  templateUrl: './entity-selector.component.html',\n  styleUrls: ['./entity-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class EntitySelectorComponent implements OnInit, OnDestroy {\n  /**\n   * The selected entity\n   * @internal\n   */\n  readonly selected$ = new BehaviorSubject<object>(undefined);\n\n  /**\n   * The current multi select option text\n   * @internal\n   */\n  readonly multiText$ = new BehaviorSubject<string>(undefined);\n\n  readonly multiSelectValue = { id: 'IGO_MULTI_SELECT' };\n\n  readonly emptyValue = { id: 'IGO_EMPTY_SELECT' };\n\n  /**\n   * Subscription to the selected entity\n   */\n  private selected$$: Subscription;\n\n  /**\n   * Store watcher\n   */\n  private watcher: EntityStoreWatcher<object>;\n\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Title accessor\n   */\n  @Input() titleAccessor: (object) => string = getEntityTitle;\n\n  /**\n   * Text to display when nothing is selected\n   */\n  @Input() emptyText: string = undefined;\n\n  /**\n   * Wheter selecting many entities is allowed\n   */\n  @Input() multi: boolean = false;\n\n  /**\n   * Text to display for the select all option\n   */\n  @Input() multiAllText: string = 'All';\n\n  /**\n   * Text to display for the select none option\n   */\n  @Input() multiNoneText: string = 'None';\n\n  /**\n   * Field placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Wheter the selector is disabled or not\n   */\n  @Input() disabled: boolean = false;\n\n  /**\n   * Event emitted when the selection changes\n   */\n  @Output() selectedChange = new EventEmitter<{\n    selected: boolean;\n    value: object | object[];\n  }>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Create a store watcher and subscribe to the selected entity\n   * @internal\n   */\n  ngOnInit() {\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n    this.selected$$ = this.store.stateView\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\n      .subscribe((records: EntityRecord<object>[]) => {\n        const entities = records.map(\n          (record: EntityRecord<object>) => record.entity\n        );\n        this.onSelectFromStore(entities);\n      });\n  }\n\n  /**\n   * Unsubscribe to the selected entity and destroy the store watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n    this.selected$$.unsubscribe();\n  }\n\n  /**\n   * On selection change, update the store's state and emit an event\n   * @internal\n   */\n  onSelectionChange(event: { value: object | undefined }) {\n    const values = event.value instanceof Array ? event.value : [event.value];\n\n    const multiSelect = values.find(\n      (_value: object) => _value === this.multiSelectValue\n    );\n    let entities = values.filter(\n      (_value: object) => _value !== this.multiSelectValue\n    );\n    if (multiSelect !== undefined) {\n      if (entities.length === this.store.count) {\n        entities = [];\n      } else if (entities.length < this.store.count) {\n        entities = this.store.all();\n      }\n    }\n\n    entities = entities.filter((entity: object) => entity !== this.emptyValue);\n    if (entities.length === 0) {\n      this.store.state.updateAll({ selected: false });\n    } else {\n      this.store.state.updateMany(entities, { selected: true }, true);\n    }\n\n    const value = this.multi ? entities : event.value;\n    this.selectedChange.emit({ selected: true, value });\n  }\n\n  private onSelectFromStore(entities: object[]) {\n    if (this.multi === true) {\n      this.selected$.next(entities);\n    } else {\n      const entity = entities.length > 0 ? entities[0] : undefined;\n      this.selected$.next(entity);\n    }\n\n    this.updateMultiToggleWithEntities(entities);\n  }\n\n  private updateMultiToggleWithEntities(entities: object[]) {\n    if (\n      entities.length === this.store.count &&\n      this.multiText$.value !== this.multiNoneText\n    ) {\n      this.multiText$.next(this.multiNoneText);\n    } else if (\n      entities.length < this.store.count &&\n      this.multiText$.value !== this.multiAllText\n    ) {\n      this.multiText$.next(this.multiAllText);\n    }\n  }\n}\n","import { Directive, HostListener } from '@angular/core';\n\n@Directive({\n  selector: '[igoStopPropagation]'\n})\nexport class StopPropagationDirective {\n  @HostListener('click', ['$event'])\n  public onClick(event: any): void {\n    event.stopPropagation();\n  }\n}\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnChanges,\n  ViewChild,\n  Output,\n  EventEmitter,\n  OnDestroy\n} from '@angular/core';\n\nimport { EntityStore } from '../shared';\nimport { MatPaginator, PageEvent } from '@angular/material/paginator';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LanguageService, MediaService } from '@igo2/core';\nimport { EntityTablePaginatorOptions } from './entity-table-paginator.interface';\n\n@Component({\n  selector: 'igo-entity-table-paginator',\n  templateUrl: './entity-table-paginator.component.html',\n  styleUrls: ['./entity-table-paginator.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class EntityTablePaginatorComponent implements OnChanges, OnDestroy {\n  public disabled: boolean = false;\n  public hidePageSize: boolean = false;\n  public pageIndex: number = 0;\n  public pageSize: number = 50;\n  public pageSizeOptions: number[] = [5, 10, 20, 50, 100, 200];\n  public showFirstLastButtons: boolean = true;\n  private count$$: Subscription;\n  private entitySortChange$$: Subscription;\n  private paginationLabelTranslation$$: Subscription[] = [];\n\n  @Input() entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(\n    false\n  );\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Paginator options\n   */\n  @Input()\n  paginatorOptions: EntityTablePaginatorOptions;\n\n  /**\n   * Event emitted when the paginator changes the page size or page index.\n   */\n  @Output() page: EventEmitter<PageEvent>;\n\n  public length: number = 0;\n\n  /**\n   * Paginator emitted.\n   */\n  @Output() paginatorChange: EventEmitter<MatPaginator> =\n    new EventEmitter<MatPaginator>();\n\n  constructor(\n    private languageService: LanguageService,\n    private mediaService: MediaService\n  ) {}\n\n  @ViewChild(MatPaginator, { static: true }) paginator: MatPaginator;\n\n  ngOnChanges() {\n    this.unsubscribeAll();\n    this.count$$ = this.store.stateView.count$.subscribe((count) => {\n      this.length = count;\n      this.emitPaginator();\n    });\n    this.entitySortChange$$ = this.entitySortChange$.subscribe(() => {\n      if (this.paginator) {\n        this.paginator.firstPage();\n      }\n    });\n    this.initPaginatorOptions();\n    this.translateLabels();\n  }\n\n  initPaginatorOptions() {\n    this.disabled = this.paginatorOptions?.disabled || this.disabled;\n    this.pageIndex = this.paginatorOptions?.pageIndex || this.pageIndex;\n    this.pageSize = this.paginatorOptions?.pageSize || this.pageSize;\n    this.pageSizeOptions =\n      this.paginatorOptions?.pageSizeOptions || this.pageSizeOptions;\n    if (this.mediaService.isMobile()) {\n      this.showFirstLastButtons = false;\n      this.hidePageSize = true;\n    } else {\n      this.showFirstLastButtons =\n        this.paginatorOptions?.showFirstLastButtons ||\n        this.showFirstLastButtons;\n      this.hidePageSize =\n        this.paginatorOptions?.hidePageSize || this.hidePageSize;\n    }\n  }\n\n  translateLabels() {\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.firstPageLabel')\n        .subscribe((label: string) => {\n          this.paginator._intl.firstPageLabel = label;\n        })\n    );\n\n    this.paginator._intl.getRangeLabel = this.rangeLabel;\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.itemsPerPageLabel')\n        .subscribe((label: string) => {\n          this.paginator._intl.itemsPerPageLabel = label;\n        })\n    );\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.lastPageLabel')\n        .subscribe((label: string) => {\n          this.paginator._intl.lastPageLabel = label;\n        })\n    );\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.nextPageLabel')\n        .subscribe((label: string) => {\n          this.paginator._intl.nextPageLabel = label;\n        })\n    );\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.previousPageLabel')\n        .subscribe((label: string) => {\n          this.paginator._intl.previousPageLabel = label;\n        })\n    );\n  }\n\n  rangeLabel = (page: number, pageSize: number, length: number) => {\n    const of: BehaviorSubject<string> = new BehaviorSubject('');\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate\n        .get('igo.common.paginator.of')\n        .subscribe((label: string) => {\n          of.next(label);\n        })\n    );\n    if (length === 0 || pageSize === 0) {\n      return `0 ${of.value} ${length}`;\n    }\n    length = Math.max(length, 0);\n    const startIndex = page * pageSize;\n    const endIndex =\n      startIndex < length\n        ? Math.min(startIndex + pageSize, length)\n        : startIndex + pageSize;\n    return `${startIndex + 1} - ${endIndex} ${of.value} ${length}`;\n  };\n\n  private unsubscribeAll() {\n    this.paginationLabelTranslation$$.map((sub) => sub.unsubscribe());\n    if (this.count$$) {\n      this.count$$.unsubscribe();\n    }\n    if (this.entitySortChange$$) {\n      this.entitySortChange$$.unsubscribe();\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.unsubscribeAll();\n  }\n\n  emitPaginator() {\n    this.paginatorChange.emit(this.paginator);\n  }\n}\n","<mat-paginator\n  [disabled]=\"disabled\"\n  [hidePageSize]=\"hidePageSize\"\n  [length]=\"length\"\n  [pageIndex]=\"pageIndex\"\n  [pageSize]=\"pageSize\"\n  [pageSizeOptions]=\"pageSizeOptions\"\n  [showFirstLastButtons]=\"showFirstLastButtons\"\n  (page)=\"emitPaginator()\"\n>\n</mat-paginator>\n","import { Directive, HostListener, Input, ElementRef } from '@angular/core';\n\n@Directive({\n  selector: '[igoImageError]'\n})\nexport class ImageErrorDirective {\n  @Input() errorImageUrl: string = './assets/igo2/common/images/na.png';\n  @Input() hideError: boolean = false;\n\n  constructor(private el: ElementRef) {}\n\n  @HostListener('error', ['$event'])\n  public onError(event: any): void {\n    if (this.hideError) {\n      this.el.nativeElement.style.display = 'none';\n    } else {\n      event.target.src = this.errorImageUrl;\n    }\n  }\n}\n","import {\n  Directive,\n  Input,\n  ElementRef,\n  Renderer2,\n  EventEmitter,\n  Output,\n  HostListener\n} from '@angular/core';\n\nimport scrollIntoView from 'scroll-into-view-if-needed';\n\nimport { EntityTableScrollBehavior } from '../shared/entity.enums';\n\n/**\n * Directive that handles an entity table row click and selection.\n */\n@Directive({\n  selector: '[igoEntityTableRow]'\n})\nexport class EntityTableRowDirective {\n  /**\n   * Class added to a selected row\n   */\n  static selectedCls = 'igo-entity-table-row-selected';\n\n  /**\n   * Class added to a highlighted row\n   */\n  static highlightedCls = 'igo-entity-table-row-highlighted';\n\n  /**\n   * Whether a row supports selection\n   */\n  @Input() selection = false;\n\n  /**\n   * Whether clicking a row should select it (if selection is true)\n   */\n  @Input() selectOnClick: boolean = true;\n\n  /**\n   * Whether the selected row should be highlighted\n   */\n  @Input() highlightSelection: boolean = true;\n\n  /**\n   * Whether a row is selected\n   */\n  @Input()\n  set selected(value: boolean) {\n    if (this.selection === false) {\n      return;\n    }\n    if (value === this._selected) {\n      return;\n    }\n\n    this.toggleSelected(value);\n    this.scroll();\n  }\n  get selected(): boolean {\n    return this._selected;\n  }\n  private _selected = false;\n\n  /**\n   * Scroll behavior on selection\n   */\n  @Input()\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\n\n  /**\n   * Event emitted when a row is selected\n   */\n  @Output() select = new EventEmitter<EntityTableRowDirective>();\n\n  /**\n   * When a row is clicked, select it if it's supported\n   * @ignore\n   */\n  @HostListener('click')\n  onClick() {\n    if (this.selection === false || this.selectOnClick === false) {\n      return;\n    }\n\n    this.toggleSelected(true);\n    this.select.emit(this);\n  }\n\n  constructor(\n    private renderer: Renderer2,\n    private el: ElementRef\n  ) {}\n\n  /**\n   * Select a row and add or remove the selected class from it\n   * @param selected Whether the row should be selected\n   */\n  private toggleSelected(selected: boolean) {\n    this._selected = selected;\n    if (selected === true) {\n      this.addCls(EntityTableRowDirective.selectedCls);\n      if (this.highlightSelection === true) {\n        this.addCls(EntityTableRowDirective.highlightedCls);\n      }\n    } else {\n      this.removeCls(EntityTableRowDirective.selectedCls);\n      this.removeCls(EntityTableRowDirective.highlightedCls);\n    }\n  }\n\n  /**\n   * Scroll to the selected row\n   */\n  private scroll() {\n    if (this._selected === true) {\n      scrollIntoView(this.el.nativeElement, {\n        scrollMode: 'if-needed',\n        behavior: 'smooth',\n        block: 'end',\n        inline: 'nearest'\n      });\n    }\n  }\n\n  /**\n   * Add the selected CSS class\n   */\n  private addCls(cls: string) {\n    this.renderer.addClass(this.el.nativeElement, cls);\n  }\n\n  /**\n   * Remove the selected CSS class\n   */\n  private removeCls(cls: string) {\n    this.renderer.removeClass(this.el.nativeElement, cls);\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml } from '@angular/platform-browser';\n\n@Pipe({ name: 'sanitizeHtml' })\nexport class SanitizeHtmlPipe implements PipeTransform {\n  constructor(private _sanitizer: DomSanitizer) {}\n  transform(v: string): SafeHtml {\n    return this._sanitizer.bypassSecurityTrustHtml(v);\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\n\nimport { Cacheable } from 'ts-cacheable';\nimport { Observable } from 'rxjs';\nimport { catchError, switchMap } from 'rxjs/operators';\nimport { ConfigService } from '@igo2/core';\n\n@Pipe({\n  name: 'secureImage'\n})\nexport class SecureImagePipe implements PipeTransform {\n  constructor(\n    private http: HttpClient,\n    private configService?: ConfigService\n  ) {}\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  transform(url: string): Observable<string> {\n    const headers = new HttpHeaders({\n      'Content-Type': 'text/plain',\n      activityInterceptor: 'false',\n      interceptError: 'false'\n    });\n\n    const regexDepot = new RegExp(\n      this.configService?.getConfig('depot.url') + '.*?(?=\"|$)'\n    );\n    if (regexDepot.test(url)) {\n      url = url.match(regexDepot)[0];\n    }\n\n    return this.http\n      .get(url, {\n        headers,\n        responseType: 'blob'\n      })\n      .pipe(\n        catchError((err) => {\n          err.error.caught = true;\n          err.error.toDisplay = false;\n          throw err;\n        }),\n        switchMap((blob) => {\n          return new Observable((observer) => {\n            const reader = new FileReader();\n            reader.readAsDataURL(blob);\n            reader.onloadend = () => {\n              observer.next(reader.result);\n              observer.complete();\n            };\n          });\n        })\n      ) as Observable<string>;\n  }\n}\n","<div class=\"table-container\" [ngStyle]=\"{ height: tableHeight }\">\n  <table\n    id=\"currentWorkspaceTable\"\n    mat-table\n    matSort\n    [ngClass]=\"getTableClass()\"\n    [dataSource]=\"dataSource\"\n    [trackBy]=\"getTrackByFunction()\"\n    (matSortChange)=\"onSort($event)\"\n  >\n    <ng-container matColumnDef=\"selectionCheckbox\" class=\"mat-cell-checkbox\">\n      <th mat-header-cell *matHeaderCellDef>\n        <ng-container *ngIf=\"selectMany\">\n          <ng-container *ngIf=\"selectionState$ | async as selectionState\">\n            <mat-checkbox\n              (change)=\"onToggleRows($event.checked)\"\n              [checked]=\"selectionState === entityTableSelectionState.All\"\n              [indeterminate]=\"\n                selectionState === entityTableSelectionState.Some\n              \"\n            >\n            </mat-checkbox>\n          </ng-container>\n        </ng-container>\n      </th>\n      <td mat-cell *matCellDef=\"let record\">\n        <mat-checkbox\n          (mousedown)=\"$event.shiftKey ? $event.preventDefault() : null\"\n          (click)=\"\n            $event.shiftKey\n              ? onShiftToggleRow(!rowIsSelected(record), record, $event)\n              : $event.stopPropagation()\n          \"\n          (change)=\"onToggleRow($event.checked, record)\"\n          [checked]=\"rowIsSelected(record)\"\n        >\n        </mat-checkbox>\n      </td>\n    </ng-container>\n\n    <ng-container\n      [matColumnDef]=\"column.name\"\n      *ngFor=\"let column of template.columns\"\n    >\n      <ng-container *ngIf=\"columnIsSortable(column)\">\n        <th\n          mat-header-cell\n          *matHeaderCellDef\n          mat-sort-header\n          [matTooltip]=\"column.tooltip ? column.tooltip : undefined\"\n          class=\"mat-body-1\"\n        >\n          {{ column.title }}\n        </th>\n      </ng-container>\n\n      <ng-container *ngIf=\"!columnIsSortable(column)\">\n        <th\n          mat-header-cell\n          *matHeaderCellDef\n          [matTooltip]=\"column.tooltip ? column.tooltip : undefined\"\n          class=\"mat-body-1\"\n        >\n          {{ column.title }}\n        </th>\n      </ng-container>\n\n      <ng-container *ngIf=\"getColumnRenderer(column) as columnRenderer\">\n        <ng-container\n          *ngIf=\"columnRenderer === entityTableColumnRenderer.Default\"\n        >\n          <ng-container *matCellDef=\"let record\">\n            <td\n              mat-cell\n              class=\"mat-cell-text\"\n              *ngIf=\"!isUrl(getValue(record, column)); else isAnUrlDefault\"\n              [ngClass]=\"getCellClass(record, column)\"\n            >\n              {{ getValue(record, column) }}\n            </td>\n            <ng-template #isAnUrlDefault>\n              <td\n                mat-cell\n                class=\"mat-cell-text\"\n                [ngClass]=\"getCellClass(record, column)\"\n              >\n                <a\n                  href=\"{{ getValue(record, column) }}\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  (click)=\"$event.stopPropagation()\"\n                >\n                  <img\n                    igoImageError\n                    *ngIf=\"isImg(getValue(record, column)); else notImg\"\n                    src=\"{{ getValue(record, column) | secureImage | async }}\"\n                    width=\"50\"\n                    heigth=\"auto\"\n                  />\n                  <ng-template #notImg\n                    ><span\n                      >{{ 'igo.common.entity-table.targetHtmlUrl' | translate }}\n                    </span></ng-template\n                  >\n                </a>\n              </td>\n            </ng-template>\n          </ng-container>\n        </ng-container>\n        <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.HTML\">\n          <ng-container *matCellDef=\"let record\">\n            <td\n              mat-cell\n              class=\"mat-cell-text\"\n              *ngIf=\"!isUrl(getValue(record, column)); else isAnUrlHTML\"\n              [ngClass]=\"getCellClass(record, column)\"\n              [innerHTML]=\"getValue(record, column)\"\n            ></td>\n            <ng-template #isAnUrlHTML>\n              <td\n                mat-cell\n                class=\"mat-cell-text\"\n                [ngClass]=\"getCellClass(record, column)\"\n              >\n                <a\n                  href=\"{{ getValue(record, column) }}\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  (click)=\"$event.stopPropagation()\"\n                >\n                  <img\n                    igoImageError\n                    *ngIf=\"isImg(getValue(record, column)); else notImg\"\n                    src=\"{{ getValue(record, column) | secureImage | async }}\"\n                    width=\"50\"\n                    heigth=\"auto\"\n                  />\n                  <ng-template #notImg\n                    ><span\n                      >{{ 'igo.geo.targetHtmlUrl' | translate }}\n                    </span></ng-template\n                  >\n                </a>\n              </td>\n            </ng-template>\n          </ng-container>\n        </ng-container>\n        <ng-container\n          *ngIf=\"columnRenderer === entityTableColumnRenderer.UnsanitizedHTML\"\n        >\n          <ng-container *matCellDef=\"let record\">\n            <td\n              mat-cell\n              class=\"mat-cell-text edition\"\n              [formGroup]=\"formGroup\"\n              *ngIf=\"isEdition(record); else isUnsanitizedHTML\"\n              [ngClass]=\"getCellClass(record, column)\"\n            >\n              <div class=\"date-picker\" *ngIf=\"column.type === 'date'\">\n                <mat-datepicker-toggle\n                  matSuffix\n                  [for]=\"picker\"\n                ></mat-datepicker-toggle>\n                <input\n                  matInput\n                  [matDatepicker]=\"picker\"\n                  [formControlName]=\"column.name\"\n                  value=\"{{ getValue(record, column) }}\"\n                  (dateChange)=\"onDateChange(column.name, record, $event)\"\n                />\n                <mat-datepicker #picker></mat-datepicker>\n              </div>\n              <input\n                matInput\n                type=\"time\"\n                *ngIf=\"column.type === 'time'\"\n                [formControlName]=\"column.name\"\n                step=\"900\"\n                (focus)=\"column.onFocus($event)\"\n                (keypress)=\"column.onChange($event)\"\n                (blur)=\"column.onBlur($event)\"\n              />\n              <input\n                matInput\n                type=\"number\"\n                class=\"class_number_edition\"\n                *ngIf=\"column.type === 'number'\"\n                [formControlName]=\"column.name\"\n                step=\"{{ column.step }}\"\n                value=\"{{ getValue(record, column) }}\"\n                (input)=\"onValueChange(column.name, record, $event)\"\n                readonly=\"{{ getValidationAttributeValue(column, 'readonly') }}\"\n                required=\"{{\n                  getValidationAttributeValue(column, 'mandatory')\n                }}\"\n                min=\"{{ getValidationAttributeValue(column, 'minValue') }}\"\n                max=\"{{ getValidationAttributeValue(column, 'maxValue') }}\"\n              />\n              <input\n                matInput\n                type=\"text\"\n                *ngIf=\"!column.type || column.type === 'string'\"\n                [formControlName]=\"column.name\"\n                value=\"{{ getValue(record, column) }}\"\n                (input)=\"onValueChange(column.name, record, $event)\"\n                readonly=\"{{ getValidationAttributeValue(column, 'readonly') }}\"\n                required=\"{{\n                  getValidationAttributeValue(column, 'mandatory')\n                }}\"\n              />\n              <mat-checkbox\n                *ngIf=\"column.type === 'boolean'\"\n                [formControlName]=\"column.name\"\n                [checked]=\"getValue(record, column)\"\n                (change)=\"onBooleanValueChange(column.name, record, $event)\"\n              ></mat-checkbox>\n              <mat-select\n                *ngIf=\"column.type === 'list'\"\n                required=\"{{\n                  getValidationAttributeValue(column, 'mandatory')\n                }}\"\n                [formControlName]=\"column.name\"\n                [multiple]=\"column.multiple\"\n                (selectionChange)=\"\n                  onSelectValueChange(column.name, record, $event)\n                \"\n                [value]=\"getValue(record, column)\"\n              >\n                <mat-option\n                  *ngFor=\"let option of column.domainValues\"\n                  [value]=\"option.id\"\n                  [disabled]=\"option.disabled\"\n                >\n                  {{ option.value }}\n                </mat-option>\n              </mat-select>\n              <input\n                matInput\n                type=\"text\"\n                [formControlName]=\"column.name\"\n                *ngIf=\"column.type === 'autocomplete'\"\n                [matAutocomplete]=\"auto\"\n                required=\"{{\n                  getValidationAttributeValue(column, 'mandatory')\n                }}\"\n                value=\"{{ getValue(record, column) }}\"\n                readonly=\"{{ getValidationAttributeValue(column, 'readonly') }}\"\n              />\n              <mat-autocomplete\n                #auto=\"matAutocomplete\"\n                (optionSelected)=\"\n                  onAutocompleteValueChange(column, record, $event)\n                \"\n                panelWidth=\"430px\"\n              >\n                <mat-option\n                  *ngFor=\"let option of filteredOptions[column.name] | async\"\n                  [value]=\"option.id\"\n                >\n                  {{ option.value }}\n                </mat-option>\n              </mat-autocomplete>\n            </td>\n            <ng-template #isUnsanitizedHTML>\n              <td\n                mat-cell\n                class=\"mat-cell-text\"\n                *ngIf=\"\n                  !isUrl(getValue(record, column));\n                  else isAnUrlUnsanitizedHTML\n                \"\n                [ngClass]=\"getCellClass(record, column)\"\n                [innerHTML]=\"getValue(record, column) | sanitizeHtml\"\n              ></td>\n              <ng-template #isAnUrlUnsanitizedHTML>\n                <td\n                  mat-cell\n                  class=\"mat-cell-text\"\n                  [ngClass]=\"getCellClass(record, column)\"\n                >\n                  <a\n                    href=\"{{ getValue(record, column) }}\"\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    (click)=\"$event.stopPropagation()\"\n                  >\n                    <img\n                      igoImageError\n                      *ngIf=\"isImg(getValue(record, column)); else notImg\"\n                      src=\"{{ getValue(record, column) | secureImage | async }}\"\n                      width=\"50\"\n                      heigth=\"auto\"\n                    />\n                    <ng-template #notImg\n                      ><span\n                        >{{ 'igo.geo.targetHtmlUrl' | translate }}\n                      </span></ng-template\n                    >\n                  </a>\n                </td>\n              </ng-template>\n            </ng-template>\n          </ng-container>\n        </ng-container>\n        <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.Icon\">\n          <td\n            mat-cell\n            *matCellDef=\"let record\"\n            class=\"mat-cell-text\"\n            [ngClass]=\"getCellClass(record, column)\"\n          >\n            <mat-icon\n              *ngIf=\"column.onClick\"\n              svgIcon=\"{{ getValue(record, column) || column.icon }}\"\n              (click)=\"column.onClick($event)\"\n            ></mat-icon>\n            <mat-icon\n              *ngIf=\"!column.onClick\"\n              svgIcon=\"{{ getValue(record, column) || column.icon }}\"\n            ></mat-icon>\n          </td>\n        </ng-container>\n        <ng-container\n          *ngIf=\"columnRenderer === entityTableColumnRenderer.ButtonGroup\"\n        >\n          <ng-container *matCellDef=\"let record\">\n            <td\n              mat-cell\n              class=\"mat-cell-text\"\n              [ngClass]=\"getCellClass(record, column)\"\n            >\n              <span *ngFor=\"let button of getValue(record, column)\">\n                <ng-container\n                  *ngIf=\"\n                    isEdition(record) === button.editMode ||\n                    button.editMode === undefined\n                  \"\n                >\n                  <button\n                    *ngIf=\"button.style === 'mat-icon-button'\"\n                    igoStopPropagation\n                    mat-icon-button\n                    [color]=\"button.color\"\n                    (mousedown)=\"onButtonClick(button.click, record)\"\n                    [disabled]=\"button.disabled\"\n                  >\n                    <mat-icon svgIcon=\"{{ button.icon }}\"></mat-icon>\n                  </button>\n                  <button\n                    *ngIf=\"button.style !== 'mat-icon-button'\"\n                    igoStopPropagation\n                    mat-mini-fab\n                    [color]=\"button.color\"\n                    (mousedown)=\"onButtonClick(button.click, record)\"\n                    [disabled]=\"button.disabled\"\n                  >\n                    <mat-icon svgIcon=\"{{ button.icon }}\"></mat-icon>\n                  </button>\n                </ng-container>\n              </span>\n            </td>\n          </ng-container>\n        </ng-container>\n      </ng-container>\n    </ng-container>\n\n    <tr\n      mat-header-row\n      *matHeaderRowDef=\"headers; sticky: fixedHeader\"\n      [ngClass]=\"getHeaderClass()\"\n    ></tr>\n    <tr\n      mat-row\n      igoEntityTableRow\n      *matRowDef=\"let record; columns: headers\"\n      [scrollBehavior]=\"scrollBehavior\"\n      [ngClass]=\"getRowClass(record)\"\n      [selection]=\"selection\"\n      [selected]=\"rowIsSelected(record)\"\n      (select)=\"onRowSelect(record)\"\n      (click)=\"onRowClick(record)\"\n    ></tr>\n  </table>\n  <igo-entity-table-paginator\n    *ngIf=\"withPaginator\"\n    [store]=\"store\"\n    [paginatorOptions]=\"paginatorOptions\"\n    [entitySortChange$]=\"entitySortChange$\"\n    (paginatorChange)=\"paginatorChange($event)\"\n  >\n  </igo-entity-table-paginator>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy,\n  OnChanges,\n  SimpleChanges,\n  ElementRef,\n  Optional,\n  Self\n} from '@angular/core';\n\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\n\nimport {\n  EntityKey,\n  EntityRecord,\n  EntityState,\n  EntityStore,\n  EntityTableTemplate,\n  EntityTableColumn,\n  EntityTableColumnRenderer,\n  EntityTableSelectionState,\n  EntityTableScrollBehavior\n} from '../shared';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { MatTableDataSource } from '@angular/material/table';\nimport { EntityTablePaginatorOptions } from '../entity-table-paginator/entity-table-paginator.interface';\nimport { MatFormFieldControl } from '@angular/material/form-field';\nimport {\n  UntypedFormBuilder,\n  NgControl,\n  NgForm,\n  FormControlName,\n  UntypedFormGroup\n} from '@angular/forms';\nimport { FocusMonitor } from '@angular/cdk/a11y';\nimport { DateAdapter, ErrorStateMatcher } from '@angular/material/core';\nimport { map } from 'rxjs/operators';\nimport { default as moment } from 'moment';\nimport { StringUtils } from '@igo2/utils';\n\n@Component({\n  selector: 'igo-entity-table',\n  templateUrl: './entity-table.component.html',\n  styleUrls: ['./entity-table.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    { provide: MatFormFieldControl, useExisting: EntityTableComponent }\n  ]\n})\nexport class EntityTableComponent implements OnInit, OnChanges, OnDestroy {\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public formGroup: UntypedFormGroup = new UntypedFormGroup({});\n\n  public filteredOptions = {};\n\n  /**\n   * Reference to the column renderer types\n   * @internal\n   */\n  entityTableColumnRenderer = EntityTableColumnRenderer;\n\n  /**\n   * Reference to the selection's state\n   * @internal\n   */\n  entityTableSelectionState = EntityTableSelectionState;\n\n  /**\n   * Observable of the selection,s state\n   * @internal\n   */\n  readonly selectionState$: BehaviorSubject<EntityTableSelectionState> =\n    new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the store's selection\n   */\n  private selection$$: Subscription;\n\n  /**\n   * Subscription to the dataSource\n   */\n  private dataSource$$: Subscription;\n\n  /**\n   * The last record checked. Useful for selecting\n   * multiple records by holding the shift key and checking\n   * checkboxes.\n   */\n  private lastRecordCheckedKey: EntityKey;\n\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Table paginator\n   */\n  @Input() set paginator(value: MatPaginator) {\n    this._paginator = value;\n    this.dataSource.paginator = value;\n  }\n\n  get paginator(): MatPaginator {\n    return this._paginator;\n  }\n  private _paginator: MatPaginator;\n\n  /**\n   * Table template\n   */\n  @Input() template: EntityTableTemplate;\n\n  /**\n   * Scroll behavior on selection\n   */\n  @Input()\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\n\n  /**\n   * Whether nulls should be first when sorting\n   */\n  @Input()\n  sortNullsFirst: boolean = false;\n\n  /**\n   * Show the table paginator or not. False by default.\n   */\n  @Input()\n  withPaginator: boolean = false;\n\n  /**\n   * Paginator options\n   */\n  @Input()\n  paginatorOptions: EntityTablePaginatorOptions;\n\n  /**\n   * Event emitted when an entity (row) is clicked\n   */\n  @Output() entityClick = new EventEmitter<object>();\n\n  /**\n   * Event emitted when an entity (row) is selected\n   */\n  @Output() entitySelectChange = new EventEmitter<{\n    added: object[];\n  }>();\n\n  /**\n   * Event emitted when the table sort is changed.\n   */\n  @Output() entitySortChange: EventEmitter<{\n    column: EntityTableColumn;\n    direction: string;\n  }> = new EventEmitter(undefined);\n\n  /**\n   * Table headers\n   * @internal\n   */\n  get headers(): string[] {\n    let columns = this.template.columns\n      .filter((column: EntityTableColumn) => column.visible !== false)\n      .map((column: EntityTableColumn) => column.name);\n\n    if (this.selectionCheckbox === true) {\n      columns = ['selectionCheckbox'].concat(columns);\n    }\n\n    return columns;\n  }\n\n  /**\n   * Data source consumable by the underlying material table\n   * @internal\n   */\n  dataSource = new MatTableDataSource<object>();\n\n  /**\n   * Whether selection is supported\n   * @internal\n   */\n  get selection(): boolean {\n    return this.template.selection || false;\n  }\n\n  /**\n   * Whether a selection checkbox should be displayed\n   * @internal\n   */\n  get selectionCheckbox(): boolean {\n    return this.template.selectionCheckbox || false;\n  }\n\n  /**\n   * Whether selection many entities should eb supported\n   * @internal\n   */\n  get selectMany(): boolean {\n    return this.template.selectMany || false;\n  }\n\n  /**\n   * Whether selection many entities should eb supported\n   * @internal\n   */\n  get fixedHeader(): boolean {\n    return this.template.fixedHeader === undefined\n      ? true\n      : this.template.fixedHeader;\n  }\n\n  get tableHeight(): string {\n    return this.template.tableHeight ? this.template.tableHeight : 'auto';\n  }\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private formBuilder: UntypedFormBuilder,\n    protected _focusMonitor: FocusMonitor,\n    protected _elementRef: ElementRef<HTMLElement>,\n    @Optional() @Self() public ngControl: NgControl,\n    @Optional() protected _parentForm: NgForm,\n    @Optional() protected _controlName: FormControlName,\n    protected _defaultErrorStateMatcher: ErrorStateMatcher,\n    private dateAdapter: DateAdapter<Date>\n  ) {\n    this.dateAdapter.setLocale('fr-CA');\n  }\n\n  /**\n   * Track the selection state to properly display the selection checkboxes\n   * @internal\n   */\n  ngOnInit() {\n    this.handleDatasource();\n    this.dataSource.paginator = this.paginator;\n  }\n\n  /**\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const store = changes.store;\n    if (store && store.currentValue !== store.previousValue) {\n      this.handleDatasource();\n    }\n  }\n\n  /**\n   * Process text or number value change (edition)\n   */\n  onValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.target.value;\n  }\n\n  /**\n   * Process boolean value change (edition)\n   */\n  onBooleanValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.checked;\n  }\n\n  /**\n   * Process select value change (edition)\n   */\n  onSelectValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.value;\n  }\n\n  /**\n   * Process autocomplete value change (edition)\n   */\n  onAutocompleteValueChange(\n    column: EntityTableColumn,\n    record: EntityRecord<any>,\n    event\n  ) {\n    this.formGroup.controls[column.name].setValue(event.option.viewValue);\n    const key = this.getColumnKeyWithoutPropertiesTag(column.name);\n    record.entity.properties[key] = event.option.value;\n  }\n\n  /**\n   * Process date value change (edition)\n   */\n  onDateChange(column: string, record: EntityRecord<any>, event) {\n    const format = 'YYYY-MM-DD';\n    const value = moment(event.value).format(format);\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = value;\n  }\n\n  /**\n   * Enable edition mode for one row\n   * More than one row can be edited at the same time\n   */\n  private enableEdit(record: EntityRecord<any>) {\n    const item = record.entity.properties || record.entity;\n    this.template.columns.forEach((column) => {\n      column.title =\n        column.validation?.mandatory && !column.title.includes('*')\n          ? column.title + ' *'\n          : column.title;\n\n      const key = this.getColumnKeyWithoutPropertiesTag(column.name);\n      if (column.type === 'boolean') {\n        if (!item[key] || item[key] === null) {\n          item[key] = false;\n        } else if (typeof item[key] === 'string') {\n          item[key] = JSON.parse(item[key].toLowerCase());\n        }\n        this.formGroup.setControl(\n          column.name,\n          this.formBuilder.control(item[key])\n        );\n      } else if (column.type === 'list') {\n        if (column.multiple) {\n          this.formGroup.setControl(\n            column.name,\n            this.formBuilder.control([item[key]])\n          );\n        } else {\n          this.formGroup.setControl(\n            column.name,\n            this.formBuilder.control(item[key])\n          );\n\n          typeof item[key] === 'string'\n            ? this.formGroup.controls[column.name].setValue(parseInt(item[key]))\n            : this.formGroup.controls[column.name].setValue(item[key]);\n        }\n      } else if (column.type === 'autocomplete') {\n        this.formGroup.setControl(\n          column.name,\n          this.formBuilder.control(item[key])\n        );\n\n        this.filteredOptions[column.name] = new Observable<any[]>();\n        this.filteredOptions[column.name] = this.formGroup.controls[\n          column.name\n        ].valueChanges.pipe(\n          map((value) => {\n            if (value?.length) {\n              return column.domainValues?.filter((option) => {\n                const filterNormalized = value\n                  ? value\n                      .toLowerCase()\n                      .normalize('NFD')\n                      .replace(/[\\u0300-\\u036f]/g, '')\n                  : '';\n                const featureNameNormalized = option.value\n                  .toLowerCase()\n                  .normalize('NFD')\n                  .replace(/[\\u0300-\\u036f]/g, '');\n                return featureNameNormalized.includes(filterNormalized);\n              });\n            }\n          })\n        );\n\n        let formControlValue = item[key];\n        column.domainValues.forEach((option) => {\n          if (\n            typeof formControlValue === 'string' &&\n            StringUtils.isValidNumber(formControlValue) &&\n            !StringUtils.isOctalNumber(formControlValue)\n          ) {\n            formControlValue = parseInt(formControlValue);\n          }\n          if (\n            option.value === formControlValue ||\n            option.id === formControlValue\n          ) {\n            formControlValue = option.value;\n          }\n        });\n\n        this.formGroup.controls[column.name].setValue(formControlValue);\n        if (this.isEdition(record) && column.linkColumnForce) {\n          const entity = record.entity as any;\n          this.formGroup.controls[column.name].setValue(\n            entity?.properties[\n              this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)\n            ]\n          );\n        }\n      } else if (column.type === 'date') {\n        if (column.visible !== false) {\n          if (item[key]) {\n            let date = moment(item[key]);\n            item[key] = date.utc().format('YYYY-MM-DD');\n            this.formGroup.setControl(\n              column.name,\n              this.formBuilder.control(item[key])\n            );\n          } else {\n            const newKey = this.getColumnKeyWithoutPropertiesTag(column.name);\n            record.entity.properties[newKey] = null;\n            this.formGroup.setControl(\n              column.name,\n              this.formBuilder.control(null)\n            );\n          }\n        }\n      } else {\n        this.formGroup.setControl(\n          column.name,\n          this.formBuilder.control(item[key])\n        );\n      }\n\n      if (\n        this.formGroup.controls[column.name] &&\n        this.getValidationAttributeValue(column, 'readonly')\n      ) {\n        this.formGroup.controls[column.name].disable();\n      }\n    });\n  }\n\n  private handleDatasource() {\n    this.unsubscribeStore();\n    this.selection$$ = this.store.stateView\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\n      .subscribe((records: EntityRecord<object>[]) => {\n        const firstSelected = records[0];\n        const firstSelectedStateviewPosition = this.store.stateView\n          .all()\n          .indexOf(firstSelected);\n        const pageMax = this.paginator\n          ? this.paginator.pageSize * (this.paginator.pageIndex + 1)\n          : 0;\n        const pageMin = this.paginator ? pageMax - this.paginator.pageSize : 0;\n\n        if (\n          this.paginator &&\n          (firstSelectedStateviewPosition < pageMin ||\n            firstSelectedStateviewPosition >= pageMax)\n        ) {\n          const pageToReach = Math.floor(\n            firstSelectedStateviewPosition / this.paginator.pageSize\n          );\n          this.dataSource.paginator.pageIndex = pageToReach;\n        }\n        this.selectionState$.next(this.computeSelectionState(records));\n      });\n    this.dataSource$$ = this.store.stateView.all$().subscribe((all) => {\n      if (all[0]) {\n        this.enableEdit(all[0]);\n      }\n      this.dataSource.data = all;\n    });\n  }\n\n  /**\n   * Unbind the store watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unsubscribeStore();\n  }\n\n  private unsubscribeStore() {\n    if (this.selection$$) {\n      this.selection$$.unsubscribe();\n    }\n    if (this.dataSource$$) {\n      this.dataSource$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Trackby function\n   * @param record Record\n   * @param index Record index\n   * @internal\n   */\n  getTrackByFunction() {\n    return (index: number, record: EntityRecord<object, EntityState>) => {\n      return record.ref;\n    };\n  }\n\n  /**\n   * Trigger a refresh of thre table. This can be useful when\n   * the data source doesn't emit a new value but for some reason\n   * the records need an update.\n   * @internal\n   */\n  refresh() {\n    this.cdRef.detectChanges();\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.paginator = event;\n  }\n\n  /**\n   * On sort, sort the store\n   * @param event Sort event\n   * @internal\n   */\n  onSort(event: { active: string; direction: string }) {\n    const direction = event.direction;\n    const column = this.template.columns.find(\n      (c: EntityTableColumn) => c.name === event.active\n    );\n\n    if (direction === 'asc' || direction === 'desc') {\n      this.store.stateView.sort({\n        valueAccessor: (record: EntityRecord<object>) =>\n          this.getValue(record, column),\n        direction,\n        nullsFirst: this.sortNullsFirst\n      });\n      this.entitySortChange.emit({ column, direction });\n      this.entitySortChange$.next(true);\n    } else {\n      this.store.stateView.sort(undefined);\n    }\n  }\n\n  /**\n   * When an entity is clicked, emit an event\n   * @param record Record\n   * @internal\n   */\n  onRowClick(record: EntityRecord<object>) {\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n    this.entityClick.emit(record.entity);\n  }\n\n  /**\n   * When an entity is selected, select it in the store and emit an event. Even if\n   * \"many\" is set to true, this method always select a single, exclusive row. Selecting\n   * multiple rows should be achieved by using the checkboxes.\n   * @param record Record\n   * @internal\n   */\n  onRowSelect(record: EntityRecord<object>) {\n    if (this.selection === false) {\n      return;\n    }\n\n    const entity = record.entity;\n    this.store.state.update(entity, { selected: true }, true);\n    this.entitySelectChange.emit({ added: [entity] });\n  }\n\n  /**\n   * Select or unselect all rows at once. On select, emit an event.\n   * @param toggle Select or unselect\n   * @internal\n   */\n  onToggleRows(toggle: boolean) {\n    if (this.selection === false) {\n      return;\n    }\n\n    this.store.state.updateAll({ selected: toggle });\n    if (toggle === true) {\n      const entities = this.store.stateView\n        .all()\n        .map((record: EntityRecord<object>) => record.entity);\n      this.entitySelectChange.emit({ added: [entities] });\n    }\n  }\n\n  /**\n   * When an entity is toggled, select or unselect it in the store. On select,\n   * emit an event.\n   * @param toggle Select or unselect\n   * @param record Record\n   * @internal\n   */\n  onToggleRow(toggle: boolean, record: EntityRecord<object>) {\n    if (this.selection === false) {\n      return;\n    }\n\n    const entity = record.entity;\n    const exclusive = toggle === true && !this.selectMany;\n    this.store.state.update(entity, { selected: toggle }, exclusive);\n    if (toggle === true) {\n      this.entitySelectChange.emit({ added: [entity] });\n    }\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n  }\n\n  /**\n   * When an entity is toggled, select or unselect it in the store. On select,\n   * emit an event.\n   * @param toggle Select or unselect\n   * @param record Record\n   * @internal\n   */\n  onShiftToggleRow(\n    toggle: boolean,\n    record: EntityRecord<object>,\n    event: MouseEvent\n  ) {\n    if (this.selection === false) {\n      return;\n    }\n\n    if (this.selectMany === false || this.lastRecordCheckedKey === undefined) {\n      this.onToggleRow(toggle, record);\n      return;\n    }\n\n    // This is a workaround mat checkbox wrong behavior\n    // when the shift key is held.\n    // See https://github.com/angular/components/issues/6232\n    const range = window.document.createRange();\n    range.selectNode(event.target as HTMLElement);\n    window.getSelection().removeAllRanges();\n    window.getSelection().addRange(range);\n    event.stopImmediatePropagation();\n\n    const records = this.store.stateView.all();\n    const recordIndex = records.indexOf(record);\n    const lastRecordChecked = this.store.stateView.get(\n      this.lastRecordCheckedKey\n    );\n    const lastRecordIndex = records.indexOf(lastRecordChecked);\n    const indexes = [recordIndex, lastRecordIndex];\n    const selectRecords = records.slice(\n      Math.min(...indexes),\n      Math.max(...indexes) + 1\n    );\n\n    const entities = selectRecords.map(\n      (_record: EntityRecord<object>) => _record.entity\n    );\n    this.store.state.updateMany(entities, { selected: toggle });\n    if (toggle === true) {\n      this.entitySelectChange.emit({ added: entities });\n    }\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n  }\n\n  /**\n   * Compute the selection state\n   * @returns Whether all, some or no rows are selected\n   * @internal\n   */\n  private computeSelectionState(\n    selectedRecords: EntityRecord<object>[]\n  ): EntityTableSelectionState {\n    const states = EntityTableSelectionState;\n    const selectionCount = selectedRecords.length;\n    return selectionCount === 0\n      ? states.None\n      : selectionCount === this.store.stateView.count\n      ? states.All\n      : states.Some;\n  }\n\n  /**\n   * Whether a column is sortable\n   * @param column Column\n   * @returns True if a column is sortable\n   * @internal\n   */\n  columnIsSortable(column: EntityTableColumn): boolean {\n    let sortable = column.sort;\n    if (sortable === undefined) {\n      sortable = this.template.sort === undefined ? false : this.template.sort;\n    }\n    return sortable;\n  }\n\n  /**\n   * Whether a row is should be selected based on the underlying entity state\n   * @param record Record\n   * @returns True if a row should be selected\n   * @internal\n   */\n  rowIsSelected(record: EntityRecord<object>): boolean {\n    const state = record.state;\n    return state.selected ? state.selected : false;\n  }\n\n  isImg(value) {\n    if (this.isUrl(value)) {\n      return (\n        ['jpg', 'png', 'gif'].indexOf(value.split('.').pop().toLowerCase()) !==\n        -1\n      );\n    } else {\n      return false;\n    }\n  }\n\n  isUrl(value) {\n    if (typeof value === 'string') {\n      return (\n        value.slice(0, 8) === 'https://' || value.slice(0, 7) === 'http://'\n      );\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Method to access an entity's values\n   * @param record Record\n   * @param column Column\n   * @returns Any value\n   * @internal\n   */\n  getValue(record: EntityRecord<object>, column: EntityTableColumn): any {\n    const entity = record.entity;\n    let value;\n    if (column.valueAccessor !== undefined) {\n      return column.valueAccessor(entity, record);\n    }\n    if (this.template.valueAccessor !== undefined) {\n      return this.template.valueAccessor(entity, column.name, record);\n    }\n    value = this.store.getProperty(entity, column.name);\n\n    if (column.type === 'boolean') {\n      if (value === undefined || value === null || value === '') {\n        value = false;\n      } else if (typeof value !== 'boolean' && value !== undefined) {\n        if (typeof value === 'number') {\n          value = Boolean(value);\n        } else {\n          value = JSON.parse(value.toLowerCase());\n        }\n      }\n      if (!this.isEdition(record)) {\n        value = value ? '&#10003;' : ''; // check mark\n      }\n    } else if (column.type === 'list' && value && column.domainValues) {\n      const entity = record.entity as any;\n      if (column.multiple) {\n        let list_id;\n        typeof value === 'string'\n          ? (list_id = value.match(/[\\w.-]+/g).map(Number))\n          : (list_id = value);\n        let list_option = [];\n\n        column.domainValues.forEach((option) => {\n          if (list_id.includes(option.id)) {\n            if (record.edition) {\n              list_option.push(option.id);\n            } else {\n              list_option.push(option.value);\n            }\n          }\n        });\n\n        this.isEdition(record) ? (value = list_id) : (value = list_option);\n      } else {\n        if (!this.isEdition(record) && column.linkColumnForce) {\n          value =\n            entity?.properties[\n              this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)\n            ];\n        } else {\n          column.domainValues.forEach((option) => {\n            if (\n              typeof value === 'string' &&\n              StringUtils.isValidNumber(value) &&\n              !StringUtils.isOctalNumber(value)\n            ) {\n              value = parseInt(value);\n            }\n            if (option.value === value || option.id === value) {\n              this.isEdition(record)\n                ? (value = option.id)\n                : (value = option.value);\n            }\n          });\n        }\n      }\n    } else if (column.type === 'autocomplete' && value && column.domainValues) {\n      const entity = record.entity as any;\n      if (!this.isEdition(record) && column.linkColumnForce) {\n        value =\n          entity?.properties[\n            this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)\n          ];\n      } else {\n        column.domainValues.forEach((option) => {\n          if (\n            typeof value === 'string' &&\n            StringUtils.isValidNumber(value) &&\n            !StringUtils.isOctalNumber(value)\n          ) {\n            value = parseInt(value);\n          }\n          if (option.value === value || option.id === value) {\n            value = option.value;\n          }\n        });\n      }\n    } else if (column.type === 'date') {\n      if (this.isEdition(record)) {\n        if (value) {\n          let date = moment(value);\n          value = date.format();\n          this.formGroup.controls[column.name].setValue(value);\n        }\n      } else if (!this.isEdition(record) && value === null) {\n        value = '';\n      }\n    }\n\n    if (value === undefined) {\n      value = '';\n    }\n\n    return value;\n  }\n\n  /**\n   * Method to access an entity's validation values\n   * @param column Column\n   * @param validationType string\n   * @returns Any value (false if no validation or not the one concerned)\n   * @internal\n   */\n  getValidationAttributeValue(\n    column: EntityTableColumn,\n    validationType: string\n  ): any {\n    if (\n      column.validation !== undefined &&\n      column.validation[validationType] !== undefined\n    ) {\n      return column.validation[validationType];\n    } else {\n      return false;\n    }\n  }\n\n  public isEdition(record) {\n    return record.entity.edition ? true : false;\n  }\n\n  /**\n   * Return the type of renderer of a column\n   * @param column Column\n   * @returns Renderer type\n   * @internal\n   */\n  getColumnRenderer(column: EntityTableColumn): EntityTableColumnRenderer {\n    if (column.renderer !== undefined) {\n      return column.renderer;\n    }\n    return EntityTableColumnRenderer.Default;\n  }\n\n  /**\n   * Return the table ngClass\n   * @returns ngClass\n   * @internal\n   */\n  getTableClass(): { [key: string]: boolean } {\n    return {\n      'igo-entity-table-with-selection': this.selection\n    };\n  }\n\n  /**\n   * Return a header ngClass\n   * @returns ngClass\n   * @internal\n   */\n  getHeaderClass(): { [key: string]: boolean } {\n    const func = this.template.headerClassFunc;\n    if (func instanceof Function) {\n      return func();\n    }\n    return {};\n  }\n\n  /**\n   * Return a row ngClass\n   * @param record Record\n   * @returns ngClass\n   * @internal\n   */\n  getRowClass(record: EntityRecord<object>): { [key: string]: boolean } {\n    const entity = record.entity;\n    const func = this.template.rowClassFunc;\n    if (func instanceof Function) {\n      return func(entity, record);\n    }\n    return {};\n  }\n\n  /**\n   * Return a row ngClass\n   * @param record Record\n   * @param column Column\n   * @returns ngClass\n   * @internal\n   */\n  getCellClass(\n    record: EntityRecord<object>,\n    column: EntityTableColumn\n  ): { [key: string]: boolean } {\n    const entity = record.entity;\n    const cls = {};\n\n    const tableFunc = this.template.cellClassFunc;\n    if (tableFunc instanceof Function) {\n      Object.assign(cls, tableFunc(entity, column, record));\n    }\n\n    const columnFunc = column.cellClassFunc;\n    if (columnFunc instanceof Function) {\n      Object.assign(cls, columnFunc(entity, record));\n    }\n\n    return cls;\n  }\n\n  /**\n   * When a button is clicked\n   * @param func Function\n   * @param record Record\n   * @internal\n   */\n  onButtonClick(\n    clickFunc: (entity: object, record?: EntityRecord<object>) => void,\n    record: EntityRecord<object>\n  ) {\n    this.enableEdit(record);\n    if (typeof clickFunc === 'function') {\n      clickFunc(record.entity, record);\n    }\n  }\n\n  /**\n   * Retrieve column name without his \"properties\" tag (useful for edition workspace properties)\n   */\n  public getColumnKeyWithoutPropertiesTag(column: string) {\n    if (column.includes('properties.')) {\n      return column.split('.')[1];\n    }\n    return column;\n  }\n}\n","import { EntityRecord, EntityStore } from '../../entity';\nimport { Tool, ToolboxOptions } from './tool.interface';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n/**\n * Service where all available tools and their component are registered.\n */\nexport class Toolbox {\n  /**\n   * Observable of the active tool\n   */\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\n\n  /**\n   * Ordered list of tool names to display in a toolbar\n   */\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\n\n  /**\n   * Observable of the active tool\n   */\n  private activeTool$$: Subscription;\n\n  /**\n   * Active tool history. Useful for activating the previous tool.\n   */\n  private activeToolHistory: string[] = [];\n\n  /**\n   * Tool store\n   */\n  private store = new EntityStore<Tool>([], {\n    getKey: (tool: Tool) => tool.name\n  });\n\n  get tools$(): BehaviorSubject<Tool[]> {\n    return this.store.entities$;\n  }\n\n  constructor(private options: ToolboxOptions = {}) {\n    this.setToolbar(options.toolbar);\n    this.initStore();\n  }\n\n  /**\n   * Destroy the toolbox\n   */\n  destroy() {\n    this.activeTool$$.unsubscribe();\n    this.store.destroy();\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return this.store.get(name);\n  }\n\n  /**\n   * Return all tools\n   * @returns Array of tools\n   */\n  getTools(): Tool[] {\n    return this.store.all();\n  }\n\n  /**\n   * Set tool configurations\n   * @param tools Tools\n   */\n  setTools(tools: Tool[]) {\n    this.store.load(tools);\n  }\n\n  /**\n   * Get toolbar\n   * @returns Toolbar value\n   */\n  getToolbar(): string[] {\n    return this.toolbar$.getValue();\n  }\n\n  /**\n   * Set toolbar\n   * @param toolbar A list of tool names\n   */\n  setToolbar(toolbar: string[]) {\n    this.toolbar$.next(toolbar || []);\n  }\n\n  /**\n   * Activate a tool (and deactivate other tools)\n   * @param name Tool name\n   * @param options Tool options\n   */\n  activateTool(name: string, options: { [key: string]: any } = {}) {\n    const tool = this.getTool(name);\n    if (tool === undefined) {\n      return;\n    }\n\n    this.store.state.update(tool, { active: true, options }, true);\n  }\n\n  /**\n   * Activate the previous tool, if any\n   */\n  activatePreviousTool() {\n    if (this.activeToolHistory.length <= 1) {\n      this.deactivateTool();\n      return;\n    }\n    const [previous, current] = this.activeToolHistory.splice(-2, 2);\n    this.activateTool(previous);\n  }\n\n  /**\n   * Activate the tool below, if any\n   */\n  /* activateBelowTool() {\n    const arrayTools = this.getToolbar();\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\n    if (arrayTools[index + 1] !== undefined) {\n      this.deactivateTool();\n      const below = arrayTools[index + 1];\n      this.activateTool(below);\n    } else {\n      this.deactivateTool();\n      const below = arrayTools[0];\n      this.activateTool(below);\n    }\n  } */\n\n  /**\n   * Activate the tool above, if any\n   */\n  /* activateAboveTool() {\n    const arrayTools = this.getToolbar();\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\n    if (arrayTools[index - 1] !== undefined) {\n      this.deactivateTool();\n      const above = arrayTools[index - 1];\n      this.activateTool(above);\n    } else {\n      this.deactivateTool();\n      const above = arrayTools[arrayTools.length - 1];\n      this.activateTool(above);\n    }\n  } */\n\n  /**\n   * Deactivate the active tool\n   */\n  deactivateTool() {\n    this.clearActiveToolHistory();\n    this.store.state.updateAll({ active: false });\n  }\n\n  /**\n   * Initialize the tool store and start observing the active tool\n   */\n  private initStore() {\n    this.store = new EntityStore<Tool>([], {\n      getKey: (entity: Tool) => entity.name\n    });\n\n    this.activeTool$$ = this.store.stateView\n      .firstBy$((record: EntityRecord<Tool>) => record.state.active === true)\n      .subscribe((record: EntityRecord<Tool>) => {\n        if (record === undefined) {\n          this.setActiveTool(undefined);\n          return;\n        }\n\n        const tool = record.entity;\n        const options = Object.assign(\n          {},\n          tool.options || {},\n          record.state.options || {}\n        );\n        this.setActiveTool(Object.assign({}, tool, { options }));\n      });\n  }\n\n  /**\n   * Set the active tool and update the tool history\n   * @param tool Tool\n   */\n  private setActiveTool(tool: Tool | undefined) {\n    this.activeTool$.next(tool);\n    if (tool === undefined) {\n      this.clearActiveToolHistory();\n    } else {\n      this.activeToolHistory = this.activeToolHistory\n        .filter((name: string) => name !== tool.name)\n        .concat([tool.name]);\n    }\n  }\n\n  /**\n   * Clear the tool history\n   */\n  private clearActiveToolHistory() {\n    this.activeToolHistory = [];\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { Tool } from './tool.interface';\nimport { Toolbox } from './toolbox';\n\n/**\n * Service where runtime tool configurations are registered\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ToolService {\n  static tools: { [key: string]: Tool } = {};\n\n  /**\n   * Toolbox that holds main tools\n   */\n  public toolbox: Toolbox = new Toolbox();\n\n  static register(tool: Tool) {\n    ToolService.tools[tool.name] = tool;\n  }\n\n  constructor() {\n    this.toolbox.setTools(this.getTools());\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return ToolService.tools[name];\n  }\n\n  /**\n   * Return all tools\n   * @returns tTols\n   */\n  getTools(): Tool[] {\n    return Object.values(ToolService.tools);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoActionModule } from '../../action/action.module';\nimport { IgoDynamicComponentModule } from '../../dynamic-component/dynamic-component.module';\n\nimport { ToolboxComponent } from './toolbox.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [CommonModule, IgoActionModule, IgoDynamicComponentModule],\n  exports: [ToolboxComponent],\n  declarations: [ToolboxComponent]\n})\nexport class IgoToolboxModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { ToolService } from './shared/tool.service';\nimport { IgoToolboxModule } from './toolbox/toolbox.module';\n\n@NgModule({\n  imports: [CommonModule],\n  exports: [IgoToolboxModule],\n  declarations: []\n})\nexport class IgoToolModule {\n  static forRoot(): ModuleWithProviders<IgoToolModule> {\n    return {\n      ngModule: IgoToolModule,\n      providers: [ToolService]\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoDynamicComponentModule } from '../../dynamic-component/dynamic-component.module';\n\nimport { WidgetOutletComponent } from './widget-outlet.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [CommonModule, IgoDynamicComponentModule],\n  exports: [WidgetOutletComponent],\n  declarations: [WidgetOutletComponent]\n})\nexport class IgoWidgetOutletModule {}\n","import { Injectable } from '@angular/core';\n\nimport { DynamicComponentService } from '../../dynamic-component/shared/dynamic-component.service';\n\nimport { Widget } from './widget';\nimport { WidgetComponent } from './widget.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WidgetService {\n  constructor(private dynamicComponentService: DynamicComponentService) {}\n\n  create(widgetCls: any): Widget {\n    return this.dynamicComponentService.create(widgetCls as WidgetComponent);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoWidgetOutletModule } from './widget-outlet/widget-outlet.module';\nimport { WidgetService } from './shared/widget.service';\n\n@NgModule({\n  imports: [CommonModule, IgoWidgetOutletModule],\n  exports: [IgoWidgetOutletModule],\n  declarations: [],\n  providers: [WidgetService]\n})\nexport class IgoWidgetModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoEntitySelectorModule } from '../../entity/entity-selector/entity-selector.module';\nimport { WorkspaceSelectorComponent } from './workspace-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [CommonModule, IgoEntitySelectorModule],\n  exports: [WorkspaceSelectorComponent],\n  declarations: [WorkspaceSelectorComponent]\n})\nexport class IgoWorkspaceSelectorModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoWidgetOutletModule } from '../../widget/widget-outlet/widget-outlet.module';\n\nimport { WorkspaceWidgetOutletComponent } from './workspace-widget-outlet.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [CommonModule, IgoWidgetOutletModule],\n  exports: [WorkspaceWidgetOutletComponent],\n  declarations: [WorkspaceWidgetOutletComponent]\n})\nexport class IgoWorkspaceWidgetOutletModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\nimport { IgoWorkspaceWidgetOutletModule } from './workspace-widget-outlet/workspace-widget-outlet.module';\n\n@NgModule({\n  imports: [CommonModule],\n  exports: [IgoWorkspaceSelectorModule, IgoWorkspaceWidgetOutletModule],\n  declarations: []\n})\nexport class IgoWorkspaceModule {}\n","import { NgModule } from '@angular/core';\nimport { ColorPickerFormFieldComponent } from './color-picker-form-field.component';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\n\n@NgModule({\n  imports: [\n    FormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    ReactiveFormsModule\n  ],\n  declarations: [ColorPickerFormFieldComponent],\n  exports: [ColorPickerFormFieldComponent]\n})\nexport class ColorPickerFormFieldModule {}\n","export enum ActionbarMode {\n  Dock = 'dock',\n  Overlay = 'overlay',\n  Context = 'context'\n}\n","import { EntityStore } from '../../entity';\nimport { Action } from './action.interfaces';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * actions.\n */\nexport class ActionStore extends EntityStore<Action> {}\n","<mat-list-item\n  *ngIf=\"!action.checkbox\"\n  class=\"actionbar-item\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\"\n  (click)=\"onClick()\"\n>\n  <button\n    *ngIf=\"withIcon\"\n    matListItemAvatar\n    mat-icon-button\n    [color]=\"color\"\n    [disabled]=\"disabled$ | async\"\n    [disableRipple]=\"true\"\n  >\n    <mat-icon *ngIf=\"withIcon\" svgIcon=\"{{ icon$ | async }}\"></mat-icon>\n  </button>\n  <span *ngIf=\"withTitle\" matLine>{{ title | translate }}</span>\n</mat-list-item>\n\n<mat-list-item\n  class=\"item-checkbox\"\n  *ngIf=\"action.checkbox\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\"\n>\n  <mat-checkbox\n    *ngIf=\"withTitle\"\n    (change)=\"action.handler()\"\n    [checked]=\"checkCondition$ | async\"\n  >\n    {{ title | translate }}\n  </mat-checkbox>\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription, isObservable } from 'rxjs';\n\nimport { Action } from '../shared/action.interfaces';\n\n/**\n * An action button\n */\n@Component({\n  selector: 'igo-actionbar-item',\n  templateUrl: './actionbar-item.component.html',\n  styleUrls: ['./actionbar-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ActionbarItemComponent implements OnInit, OnDestroy {\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly checkCondition$: BehaviorSubject<boolean> = new BehaviorSubject(\n    undefined\n  );\n\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly tooltip$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly noDisplay$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly ngClass$: BehaviorSubject<{ [key: string]: boolean }> =\n    new BehaviorSubject({});\n\n  private ngClass$$: Subscription;\n\n  private disabled$$: Subscription;\n\n  private availability$$: Subscription;\n\n  private icon$$: Subscription;\n\n  private checkCondition$$: Subscription;\n\n  private tooltip$$: Subscription;\n\n  private noDisplay$$: Subscription;\n\n  private display$$: Subscription;\n\n  /**\n   * Action\n   */\n  @Input() action: Action;\n\n  /**\n   * Color\n   */\n  @Input() color = 'default';\n\n  /**\n   * Whether the action title is displayed\n   */\n  @Input() withTitle = true;\n\n  /**\n   * Whether the action icon is displayed\n   */\n  @Input() withIcon = true;\n\n  /**\n   * Whether a tooltip should be shown\n   */\n  @Input() withTooltip = true;\n\n  /**\n   * Whether the action is disabled\n   */\n  @Input()\n  set disabled(value: boolean) {\n    this.disabled$.next(value);\n  }\n  get disabled(): boolean {\n    return this.disabled$.value;\n  }\n\n  /**\n   * Whether the action is display or not\n   */\n  @Input()\n  set noDisplay(value: boolean) {\n    this.noDisplay$.next(value);\n  }\n  get noDisplay(): boolean {\n    return this.noDisplay$.value;\n  }\n\n  /**\n   * Event emitted when the action button is clicked\n   */\n  @Output() trigger: EventEmitter<Action> = new EventEmitter();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return this.action.title;\n  }\n\n  constructor() {}\n\n  ngOnInit() {\n    const args = this.action.args || [];\n\n    if (this.action.ngClass !== undefined) {\n      this.ngClass$$ = this.action\n        .ngClass(...args)\n        .subscribe((ngClass: { [key: string]: boolean }) =>\n          this.updateNgClass(ngClass)\n        );\n    }\n\n    if (isObservable(this.action.icon)) {\n      this.icon$$ = this.action.icon.subscribe((icon: string) =>\n        this.updateIcon(icon)\n      );\n    } else {\n      this.updateIcon(this.action.icon);\n    }\n\n    if (isObservable(this.action.checkCondition)) {\n      this.checkCondition$$ = this.action.checkCondition.subscribe(\n        (checkCondition: boolean) => this.updateCheckCondition(checkCondition)\n      );\n    } else {\n      this.updateCheckCondition(this.action.checkCondition);\n    }\n\n    if (isObservable(this.action.tooltip)) {\n      this.tooltip$$ = this.action.tooltip.subscribe((tooltip: string) =>\n        this.updateTooltip(tooltip)\n      );\n    } else {\n      this.updateTooltip(this.action.tooltip);\n    }\n\n    if (this.action.availability !== undefined) {\n      this.availability$$ = this.action\n        .availability(...args)\n        .subscribe((available: boolean) => (this.disabled = !available));\n    }\n\n    this.disabled$$ = this.disabled$.subscribe((disabled: boolean) =>\n      this.updateNgClass({ 'igo-actionbar-item-disabled': disabled })\n    );\n\n    if (this.action.display !== undefined) {\n      this.display$$ = this.action\n        .display(...args)\n        .subscribe((display: boolean) => (this.noDisplay = !display));\n    }\n\n    this.noDisplay$$ = this.noDisplay$.subscribe((noDisplay: boolean) =>\n      this.updateNgClass({ 'igo-actionbar-item-no-display': noDisplay })\n    );\n  }\n\n  ngOnDestroy() {\n    if (this.ngClass$$ !== undefined) {\n      this.ngClass$$.unsubscribe();\n      this.ngClass$$ = undefined;\n    }\n\n    if (this.availability$$ !== undefined) {\n      this.availability$$.unsubscribe();\n      this.availability$$ = undefined;\n    }\n\n    if (this.display$$ !== undefined) {\n      this.display$$.unsubscribe();\n      this.display$$ = undefined;\n    }\n\n    if (this.checkCondition$$ !== undefined) {\n      this.checkCondition$$.unsubscribe();\n      this.checkCondition$$ = undefined;\n    }\n\n    if (this.icon$$ !== undefined) {\n      this.icon$$.unsubscribe();\n      this.icon$$ = undefined;\n    }\n\n    if (this.tooltip$$ !== undefined) {\n      this.tooltip$$.unsubscribe();\n      this.tooltip$$ = undefined;\n    }\n\n    this.disabled$$.unsubscribe();\n    this.noDisplay$$.unsubscribe();\n  }\n\n  /**\n   * When the action button is clicked, emit the 'trigger' event but don't\n   * invoke the action handler. This is handled by the parent component.\n   * @internal\n   */\n  onClick() {\n    if (this.disabled === true) {\n      return;\n    }\n    this.trigger.emit(this.action);\n  }\n\n  private updateNgClass(ngClass: { [key: string]: boolean }) {\n    this.ngClass$.next(Object.assign({}, this.ngClass$.value, ngClass));\n  }\n\n  private updateTooltip(tooltip: string) {\n    this.tooltip$.next(tooltip);\n  }\n\n  private updateCheckCondition(checkCondition: boolean) {\n    this.checkCondition$.next(checkCondition);\n  }\n\n  private updateIcon(icon: string) {\n    this.icon$.next(icon);\n  }\n}\n","<mat-list *ngIf=\"mode === actionbarMode.Dock\" matListItemIcon>\n  <div\n    *ngIf=\"heightCondition && positionConditionTop && isDesktop\"\n    id=\"topChevron\"\n  >\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.common.actionbar.scrollUp' | translate\"\n      (click)=\"scrollUp()\"\n    >\n      <mat-icon svgIcon=\"chevron-up\"></mat-icon>\n    </button>\n  </div>\n\n  <igo-actionbar-item\n    *ngIf=\"withToggleButton\"\n    color=\"accent\"\n    [withTitle]=\"false\"\n    [withIcon]=\"true\"\n    [color]=\"color\"\n    [disabled]=\"store.view.empty\"\n    [action]=\"toggleCollapseAction\"\n    (trigger)=\"onTriggerAction(toggleCollapseAction)\"\n  >\n  </igo-actionbar-item>\n\n  <ng-template\n    #buttonContent\n    *ngIf=\"!collapsed\"\n    ngFor\n    let-action\n    [ngForOf]=\"store.view.all$() | async\"\n  >\n    <igo-actionbar-item\n      color=\"accent\"\n      [withTitle]=\"withTitle\"\n      [withIcon]=\"withIcon\"\n      [withTooltip]=\"withTooltip\"\n      [color]=\"color\"\n      [disabled]=\"store.state.get(action).disabled\"\n      [action]=\"action\"\n      (trigger)=\"onTriggerAction(action)\"\n    >\n    </igo-actionbar-item>\n  </ng-template>\n\n  <div\n    *ngIf=\"heightCondition && positionConditionLow && isDesktop\"\n    id=\"lowChevron\"\n  >\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.common.actionbar.scrollDown' | translate\"\n      (click)=\"scrollDown()\"\n    >\n      <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n    </button>\n  </div>\n</mat-list>\n\n<div *ngIf=\"mode === actionbarMode.Overlay\">\n  <button\n    class=\"buttonOverlay\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.common.actionbar.icon' | translate\"\n    [matMenuTriggerFor]=\"actionbarMenu\"\n    [disabled]=\"store.view.empty\"\n    [color]=\"iconColor\"\n  >\n    <mat-icon [svgIcon]=\"icon\"></mat-icon>\n  </button>\n\n  <mat-menu\n    #actionbarMenu=\"matMenu\"\n    class=\"igo-compact-menu igo-no-min-width-menu\"\n    overlapTrigger=\"true\"\n    [xPosition]=\"xPosition\"\n    [yPosition]=\"yPosition\"\n    [class]=\"overlayClass\"\n  >\n    <mat-list>\n      <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n        <igo-actionbar-item\n          color=\"accent\"\n          [withTitle]=\"withTitle\"\n          [withIcon]=\"withIcon\"\n          [color]=\"color\"\n          [action]=\"action\"\n          (trigger)=\"onTriggerAction(action)\"\n        >\n        </igo-actionbar-item>\n      </ng-template>\n    </mat-list>\n  </mat-menu>\n</div>\n<mat-card\n  *ngIf=\"mode === actionbarMode.Context\"\n  class=\"context-menu-card mat-elevation-z4\"\n>\n  <mat-list>\n    <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n      <igo-actionbar-item\n        color=\"accent\"\n        [withTitle]=\"withTitle\"\n        [withIcon]=\"withIcon\"\n        [color]=\"color\"\n        [action]=\"action\"\n        (trigger)=\"onTriggerAction(action)\"\n      >\n      </igo-actionbar-item>\n      <br />\n    </ng-template>\n  </mat-list>\n</mat-card>\n","import {\n  Component,\n  Input,\n  HostBinding,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy,\n  OnChanges,\n  OnDestroy,\n  SimpleChanges,\n  ElementRef\n} from '@angular/core';\n\nimport { MediaService, Media } from '@igo2/core';\nimport { EntityStoreWatcher } from '../../entity';\nimport { Action } from '../shared/action.interfaces';\nimport { ActionbarMode } from '../shared/action.enums';\nimport { ActionStore } from '../shared/store';\nimport { Overlay } from '@angular/cdk/overlay';\nimport { BehaviorSubject } from 'rxjs';\n\n/**\n * A list of action buttons.\n * This component can be displayed in one of two way: 'dock' or 'overlay'\n */\n@Component({\n  selector: 'igo-actionbar',\n  templateUrl: './actionbar.component.html',\n  styleUrls: ['./actionbar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ActionbarComponent implements OnDestroy, OnChanges {\n  /**\n   * Reference to the ActionbarMode enum for use in the template\n   * @internal\n   */\n  actionbarMode = ActionbarMode;\n\n  /**\n   * Whether the actionbar is collapsed (Dock mode)\n   * @internal\n   */\n  collapsed = false;\n\n  /**\n   * Toggle collapse action (Dock)\n   * @internal\n   */\n  toggleCollapseAction = {\n    id: 'actionbar_toggle',\n    icon: 'dots-vertical',\n    handler: () => {\n      this.collapsed = !this.collapsed;\n    }\n  };\n\n  /**\n   * Action store watcher\n   * @internal\n   */\n  private watcher: EntityStoreWatcher<Action>;\n\n  /**\n   * Height Condition for scroll button\n   */\n  heightCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(\n    false\n  );\n\n  /**\n   * Position Condition for top scroll button\n   */\n  positionConditionTop$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(true);\n\n  /**\n   * Position Condition for low scroll button\n   */\n  positionConditionLow$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(true);\n\n  /**\n   * Action store\n   */\n  @Input() store: ActionStore;\n\n  /**\n   * Actionbar mode\n   */\n  @Input() mode: ActionbarMode = ActionbarMode.Dock;\n\n  /**\n   * Whether a toggle button should be displayed (Dock mode)\n   */\n  @Input() withToggleButton = false;\n\n  /**\n   * Whether a the actionbar should display buttons horizontally\n   */\n  @Input() horizontal = false;\n\n  /**\n   * Color\n   */\n  @Input() color = 'default';\n\n  /**\n   * Color of the button if action mode === overlay\n   */\n  @Input() iconColor = 'default';\n\n  /**\n   * Whether action titles are displayed\n   */\n  @Input() withTitle = true;\n\n  /**\n   * Whether action tooltips are displayed\n   */\n  @Input() withTooltip = true;\n\n  /**\n   * Whether action titles are displayed (condition for scroll button)\n   */\n  @Input() scrollActive = true;\n\n  /**\n   * Whether action icons are displayed\n   */\n  @Input() withIcon = true;\n\n  /**\n   * Which icon want to be shown\n   */\n  @Input() icon = 'dots-horizontal';\n\n  /**\n   * Overlay X position\n   */\n  @Input() xPosition = 'before';\n\n  /**\n   * Overlay Y position\n   */\n  @Input() yPosition = 'above';\n\n  /**\n   * Class to add to the actionbar overlay\n   */\n  @Input()\n  set overlayClass(value: string) {\n    this._overlayClass = value;\n  }\n  get overlayClass(): string {\n    return [this._overlayClass, 'igo-actionbar-overlay'].join(' ');\n  }\n  private _overlayClass = '';\n\n  @HostBinding('class.is-collapsed') isCollapsed = this.collapsed;\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.with-title')\n  get withTitleClass() {\n    return this.withTitle;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.with-icon')\n  get withIconClass() {\n    return this.withIcon;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.horizontal')\n  get horizontalClass() {\n    return this.horizontal;\n  }\n\n  get heightCondition(): boolean {\n    const el = this.elRef.nativeElement;\n    if (this.scrollActive === false) {\n      if (el.clientHeight < el.scrollHeight) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  get positionConditionTop(): boolean {\n    if (this.elRef.nativeElement.scrollTop === 0) {\n      return false;\n    }\n    return true;\n  }\n\n  get positionConditionLow(): boolean {\n    const el = this.elRef.nativeElement;\n    if (el.scrollTop >= el.scrollHeight - el.clientHeight) {\n      return false;\n    }\n    return true;\n  }\n\n  get isDesktop(): boolean {\n    return this.mediaService.getMedia() === Media.Desktop;\n  }\n\n  constructor(\n    public overlay: Overlay,\n    private elRef: ElementRef,\n    private cdRef: ChangeDetectorRef,\n    public mediaService: MediaService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const store = changes.store;\n    if (store && store.currentValue !== store.previousValue) {\n      if (this.watcher !== undefined) {\n        this.watcher.destroy();\n      }\n      this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n    }\n  }\n\n  /**\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n  }\n\n  /**\n   * Invoke the action handler\n   * @internal\n   */\n  onTriggerAction(action: Action) {\n    const args = action.args || [];\n    action.handler(...args);\n  }\n\n  scrollDown() {\n    this.elRef.nativeElement.scrollBy(0, 52);\n  }\n\n  scrollUp() {\n    this.elRef.nativeElement.scrollBy(0, -52);\n  }\n}\n","import {\n  Directive,\n  HostListener,\n  Output,\n  EventEmitter,\n  Input\n} from '@angular/core';\nimport { userAgent } from '@igo2/utils';\n\n/**\n * IgoLongPress trigger longpress event after a define duration.\n * This directive exist to patch the unavailable contextmenu event on iOS.\n * @param touchDuration touch duration in ms, default value is 400ms\n * @param iOSOnly define if longpress is triggered only for iOS, default value = true\n */\n@Directive({\n  selector: '[igoLongPress]'\n})\nexport class LongPressDirective {\n  private touchTimeout: any;\n  @Input() touchDuration: number = 400;\n  @Input() onlyIOS: boolean = true;\n  @Output() longpress = new EventEmitter();\n\n  constructor() {}\n\n  @HostListener('touchstart', ['$event'])\n  public touchstart(e: TouchEvent) {\n    if (e.touches.length > 1) {\n      this.touchEnd();\n      return;\n    }\n    this.touchTimeout = setTimeout(() => {\n      if (this.onlyIOS) {\n        if (userAgent.getOSName() === 'iOS') {\n          this.longpress.emit(e);\n        }\n      } else {\n        this.longpress.emit(e);\n      }\n    }, this.touchDuration);\n  }\n  @HostListener('touchmove')\n  @HostListener('touchcancel')\n  @HostListener('touchend')\n  public touchend() {\n    this.touchEnd();\n  }\n\n  private touchEnd() {\n    clearTimeout(this.touchTimeout);\n  }\n}\n","import {\n  Input,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy,\n  Component,\n  OnChanges,\n  OnDestroy,\n  SimpleChanges,\n  ViewContainerRef,\n  ViewChild\n} from '@angular/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { DynamicComponent } from '../shared/dynamic-component';\nimport { DynamicComponentService } from '../shared/dynamic-component.service';\n\n@Component({\n  selector: 'igo-dynamic-outlet',\n  templateUrl: 'dynamic-outlet.component.html',\n  styleUrls: ['dynamic-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DynamicOutletComponent implements OnChanges, OnDestroy {\n  /**\n   * The dynamic component base class or the dynamic component itself\n   */\n  @Input() component: DynamicComponent<any> | any;\n\n  /**\n   * The dynamic component inputs\n   */\n  @Input() inputs: { [key: string]: any } = {};\n\n  /**\n   * The subscribers to the dynamic component outputs\n   */\n  @Input() subscribers: { [key: string]: (event: any) => void } = {};\n\n  /**\n   * The dynamic component\n   */\n  private dynamicComponent: DynamicComponent<any>;\n\n  /**\n   * The view element to render the component to\n   * @ignore\n   */\n  @ViewChild('target', { read: ViewContainerRef, static: true })\n  private target: ViewContainerRef;\n\n  constructor(\n    private dynamicComponentService: DynamicComponentService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * If the dynamic component changes, create it.\n   * If the inputs or subscribers change, update the current component's\n   * inputs or subscribers.\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const component = changes.component;\n    const inputs = changes.inputs;\n    const subscribers = changes.subscribers;\n    const eq = ObjectUtils.objectsAreEquivalent;\n\n    if (!component || !component.currentValue) {\n      return;\n    }\n\n    if (component.currentValue !== component.previousValue) {\n      this.createComponent(component.currentValue);\n    } else {\n      const inputsAreEquivalents =\n        inputs && eq(inputs.currentValue || {}, inputs.previousValue || {});\n      const subscribersAreEquivalents =\n        subscribers &&\n        eq(subscribers.currentValue || {}, subscribers.previousValue || {});\n\n      if (inputsAreEquivalents === false) {\n        this.updateInputs();\n      }\n\n      if (subscribersAreEquivalents === false) {\n        this.updateSubscribers();\n      }\n    }\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * Destroy the dynamic component and all it's subscribers\n   * @internal\n   */\n  ngOnDestroy() {\n    if (this.dynamicComponent) {\n      this.dynamicComponent.destroy();\n    }\n  }\n\n  /**\n   * Create a  DynamicComponent out of the component class and render it.\n   * @internal\n   */\n  private createComponent(component: DynamicComponent<any> | any) {\n    if (this.dynamicComponent !== undefined) {\n      this.dynamicComponent.destroy();\n    }\n    this.dynamicComponent =\n      component instanceof DynamicComponent\n        ? component\n        : this.dynamicComponentService.create(component);\n    this.renderComponent();\n  }\n\n  /**\n   * Create and render the dynamic component. Set it's inputs and subscribers\n   * @internal\n   */\n  private renderComponent() {\n    this.updateInputs();\n    this.updateSubscribers();\n    this.dynamicComponent.setTarget(this.target);\n  }\n\n  /**\n   * Update the dynamic component inputs. This is an update so any\n   * key not defined won't be overwritten.\n   * @internal\n   */\n  private updateInputs() {\n    this.dynamicComponent.updateInputs(this.inputs);\n  }\n\n  /**\n   * Update the dynamic component subscribers. This is an update so any\n   * key not defined won't be overwritten.\n   * @internal\n   */\n  private updateSubscribers() {\n    this.dynamicComponent.updateSubscribers(this.subscribers);\n  }\n}\n","<ng-template #target></ng-template>\n","import { FormFieldService } from './form-field.service';\n\nexport function IgoFormFieldComponent(type: string): (cls: any) => any {\n  return (compType: any) => {\n    FormFieldService.register(type, compType);\n  };\n}\n","import { AbstractControl } from '@angular/forms';\n\nimport { Form, FormField, FormFieldGroup } from './form.interfaces';\n\nexport function formControlIsRequired(control: AbstractControl): boolean {\n  if (control.validator) {\n    const validator = control.validator({} as AbstractControl);\n    if (validator && validator.required) {\n      return true;\n    }\n  }\n\n  if ((control as any).controls) {\n    const requiredControl = Object.keys((control as any).controls).find(\n      (key: string) => {\n        return formControlIsRequired((control as any).controls[key]);\n      }\n    );\n    return requiredControl !== undefined;\n  }\n\n  return false;\n}\n\nexport function getDefaultErrorMessages(): { [key: string]: string } {\n  return {\n    required: 'igo.common.form.errors.required'\n  };\n}\n\nexport function getControlErrorMessage(\n  control: AbstractControl,\n  messages: { [key: string]: string }\n): string {\n  const errors = control.errors || {};\n  const errorKeys = Object.keys(errors);\n  const errorMessages = errorKeys\n    .map((key: string) => messages[key])\n    .filter((message: string) => message !== undefined);\n  return errorMessages.length > 0 ? errorMessages[0] : '';\n}\n\nexport function getAllFormFields(form: Form): FormField[] {\n  return form.groups.reduce((acc: FormField[], group: FormFieldGroup) => {\n    return acc.concat(group.fields);\n  }, [].concat(form.fields));\n}\n\nexport function getFormFieldByName(form: Form, name: string): FormField {\n  const fields = getAllFormFields(form);\n  return fields.find((field: FormField) => {\n    return field.name === name;\n  });\n}\n","<ng-container *ngIf=\"field !== undefined\">\n  <igo-dynamic-outlet\n    [component]=\"getFieldComponent()\"\n    [inputs]=\"getFieldInputs()\"\n    [subscribers]=\"getFieldSubscribers()\"\n  >\n  </igo-dynamic-outlet>\n</ng-container>\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\n\nimport {\n  FormField,\n  FormFieldInputs,\n  FormFieldOptions,\n  FormFieldSubscribers\n} from '../shared/form.interfaces';\nimport { FormFieldService } from '../shared/form-field.service';\nimport { getDefaultErrorMessages } from '../shared';\n\n/**\n * This component renders the proper form input based on\n * the field configuration it receives.\n */\n@Component({\n  selector: 'igo-form-field',\n  templateUrl: './form-field.component.html',\n  styleUrls: ['./form-field.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormFieldComponent {\n  /**\n   * Field configuration\n   */\n  @Input() field: FormField;\n\n  /**\n   * Field inputs cache\n   */\n  private fieldInputs: FormFieldInputs = undefined;\n\n  /**\n   * Field subscribers cache\n   */\n  private fieldSubscribers: FormFieldSubscribers = undefined;\n\n  get fieldOptions(): FormFieldOptions {\n    return this.field.options || {};\n  }\n\n  constructor(private formFieldService: FormFieldService) {}\n\n  getFieldComponent(): any {\n    return this.formFieldService.getFieldByType(this.field.type || 'text');\n  }\n\n  getFieldInputs(): FormFieldInputs {\n    if (this.fieldInputs !== undefined) {\n      return this.fieldInputs;\n    }\n\n    const errors = this.fieldOptions.errors || {};\n    this.fieldInputs = Object.assign(\n      {\n        placeholder: this.field.title,\n        disableSwitch: this.fieldOptions.disableSwitch || false\n      },\n      Object.assign({}, this.field.inputs || {}),\n      {\n        formControl: this.field.control,\n        errors: Object.assign({}, getDefaultErrorMessages(), errors)\n      }\n    );\n    return this.fieldInputs;\n  }\n\n  getFieldSubscribers(): FormFieldSubscribers {\n    if (this.fieldSubscribers !== undefined) {\n      return this.fieldSubscribers;\n    }\n\n    this.fieldSubscribers = Object.assign({}, this.field.subscribers || {});\n    return this.fieldSubscribers;\n  }\n}\n","<div *ngIf=\"group && group.fields.length > 0\" class=\"igo-form-group-fields\">\n  <div\n    *ngFor=\"let field of group.fields\"\n    class=\"igo-form-field-wrapper\"\n    [ngClass]=\"getFieldNgClass(field)\"\n  >\n    <igo-form-field [field]=\"field\"></igo-form-field>\n  </div>\n</div>\n\n<div class=\"igo-form-group-extra-content\">\n  <ng-content></ng-content>\n</div>\n\n<mat-error *ngIf=\"formControl.errors\">{{\n  getErrorMessage() | translate\n}}</mat-error>\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\nimport { UntypedFormGroup } from '@angular/forms';\n\nimport { getControlErrorMessage } from '../shared/form.utils';\nimport { FormField, FormFieldGroup } from '../shared/form.interfaces';\n\n/**\n * A configurable form, optionnally bound to an entity\n * (for example in case of un update). Submitting that form\n * emits an event with the form data but no other operation is performed.\n */\n@Component({\n  selector: 'igo-form-group',\n  templateUrl: './form-group.component.html',\n  styleUrls: ['./form-group.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormGroupComponent {\n  /**\n   * Form field group\n   */\n  @Input() group: FormFieldGroup;\n\n  /**\n   * Field placeholder\n   */\n  @Input() errors: { [key: string]: string };\n\n  /**\n   * Form group control\n   */\n  get formControl(): UntypedFormGroup {\n    return this.group.control;\n  }\n\n  constructor() {}\n\n  /**\n   * Return the number of columns a field should occupy.\n   * The maximum allowed is 2, even if the field config says more.\n   * @param field Field\n   * @returns Number of columns\n   * @internal\n   */\n  getFieldColSpan(field: FormField): number {\n    let colSpan = 2;\n    const options = field.options || {};\n    if (options.cols && options.cols > 0) {\n      colSpan = Math.min(options.cols, 2);\n    }\n\n    return colSpan;\n  }\n\n  /**\n   * Return the number of columns a field should occupy.\n   * The maximum allowed is 2, even if the field config says more.\n   * @param field Field\n   * @returns Number of columns\n   * @internal\n   */\n  getFieldNgClass(field: FormField): { [key: string]: boolean } {\n    const colspan = this.getFieldColSpan(field);\n    return { [`igo-form-field-colspan-${colspan}`]: true };\n  }\n\n  /**\n   * Get error message\n   */\n  getErrorMessage(): string {\n    const options = this.group.options || {};\n    return getControlErrorMessage(this.formControl, options.errors || {});\n  }\n}\n","<mat-form-field>\n  <input\n    matInput\n    [required]=\"required\"\n    [placeholder]=\"placeholder\"\n    [formControl]=\"formControl\"\n  />\n  <mat-icon\n    *ngIf=\"disableSwitch === true\"\n    class=\"igo-form-disable-switch\"\n    [svgIcon]=\"\n      (disabled$ | async) === true\n        ? 'checkbox-blank-outline'\n        : 'checkbox-marked-outline'\n    \"\n    (click)=\"onDisableSwitchClick()\"\n    matPrefix\n  >\n  </mat-icon>\n  <mat-error *ngIf=\"formControl.errors\">{{\n    getErrorMessage() | translate\n  }}</mat-error>\n</mat-form-field>\n","import {\n  Input,\n  Component,\n  ChangeDetectionStrategy,\n  OnInit\n} from '@angular/core';\nimport type { UntypedFormControl } from '@angular/forms';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport {\n  formControlIsRequired,\n  getControlErrorMessage\n} from '../shared/form.utils';\nimport { IgoFormFieldComponent } from '../shared/form-field-component';\n\n/**\n * This component renders a text field\n */\n@IgoFormFieldComponent('text')\n@Component({\n  selector: 'igo-form-field-text',\n  templateUrl: './form-field-text.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormFieldTextComponent implements OnInit {\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * The field's form control\n   */\n  @Input() formControl: UntypedFormControl;\n\n  /**\n   * Field placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Field placeholder\n   */\n  @Input() errors: { [key: string]: string };\n\n  /**\n   * Wheter a disable switch should be available\n   */\n  @Input() disableSwitch: boolean = false;\n\n  /**\n   * Whether the field is required\n   */\n  get required(): boolean {\n    return formControlIsRequired(this.formControl);\n  }\n\n  ngOnInit() {\n    this.disabled$.next(this.formControl.disabled);\n  }\n\n  /**\n   * Get error message\n   */\n  getErrorMessage(): string {\n    return getControlErrorMessage(this.formControl, this.errors);\n  }\n\n  onDisableSwitchClick() {\n    this.toggleDisabled();\n  }\n\n  private toggleDisabled() {\n    const disabled = !this.disabled$.value;\n    if (disabled === true) {\n      this.formControl.disable();\n    } else {\n      this.formControl.enable();\n    }\n    this.disabled$.next(disabled);\n  }\n}\n","<mat-form-field>\n  <mat-select\n    [required]=\"required\"\n    [placeholder]=\"placeholder\"\n    [formControl]=\"formControl\"\n  >\n    <mat-option *ngFor=\"let choice of choices$ | async\" [value]=\"choice.value\">\n      {{ choice.title }}\n    </mat-option>\n  </mat-select>\n  <mat-icon\n    *ngIf=\"disableSwitch === true\"\n    class=\"igo-form-disable-switch\"\n    [svgIcon]=\"\n      (disabled$ | async) === true\n        ? 'checkbox-blank-outline'\n        : 'checkbox-marked-outline'\n    \"\n    (click)=\"onDisableSwitchClick()\"\n    matPrefix\n  >\n  </mat-icon>\n  <mat-error *ngIf=\"formControl.errors\">{{\n    getErrorMessage() | translate\n  }}</mat-error>\n</mat-form-field>\n","import {\n  Input,\n  Component,\n  ChangeDetectionStrategy,\n  OnInit\n} from '@angular/core';\nimport type { UntypedFormControl } from '@angular/forms';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport {\n  formControlIsRequired,\n  getControlErrorMessage\n} from '../shared/form.utils';\nimport { FormFieldSelectChoice } from '../shared/form.interfaces';\nimport { IgoFormFieldComponent } from '../shared/form-field-component';\n\n/**\n * This component renders a select field\n */\n@IgoFormFieldComponent('select')\n@Component({\n  selector: 'igo-form-field-select',\n  templateUrl: './form-field-select.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormFieldSelectComponent implements OnInit {\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Select input choices\n   */\n  @Input()\n  set choices(value: FormFieldSelectChoice[]) {\n    this.choices$.next(value);\n  }\n  get choices(): FormFieldSelectChoice[] {\n    return this.choices$.value;\n  }\n  readonly choices$: BehaviorSubject<FormFieldSelectChoice[]> =\n    new BehaviorSubject([]);\n\n  /**\n   * The field's form control\n   */\n  @Input() formControl: UntypedFormControl;\n\n  /**\n   * Field placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Field placeholder\n   */\n  @Input() errors: { [key: string]: string };\n\n  /**\n   * Wheter a disable switch should be available\n   */\n  @Input() disableSwitch: boolean = false;\n\n  /**\n   * Whether the field is required\n   */\n  get required(): boolean {\n    return formControlIsRequired(this.formControl);\n  }\n\n  ngOnInit() {\n    this.disabled$.next(this.formControl.disabled);\n  }\n\n  /**\n   * Get error message\n   */\n  getErrorMessage(): string {\n    return getControlErrorMessage(this.formControl, this.errors);\n  }\n\n  onDisableSwitchClick() {\n    this.toggleDisabled();\n  }\n\n  private toggleDisabled() {\n    const disabled = !this.disabled$.value;\n    if (disabled === true) {\n      this.formControl.disable();\n    } else {\n      this.formControl.enable();\n    }\n    this.disabled$.next(disabled);\n  }\n}\n","<mat-form-field>\n  <textarea\n    matInput\n    [required]=\"required\"\n    [placeholder]=\"placeholder\"\n    [formControl]=\"formControl\"\n  >\n  </textarea>\n  <mat-icon\n    *ngIf=\"disableSwitch === true\"\n    class=\"igo-form-disable-switch\"\n    [svgIcon]=\"\n      (disabled$ | async) === true\n        ? 'checkbox-blank-outline'\n        : 'checkbox-marked-outline'\n    \"\n    (click)=\"onDisableSwitchClick()\"\n    matPrefix\n  >\n  </mat-icon>\n  <mat-error *ngIf=\"formControl.errors\">{{\n    getErrorMessage() | translate\n  }}</mat-error>\n</mat-form-field>\n","import {\n  Input,\n  Component,\n  ChangeDetectionStrategy,\n  OnInit\n} from '@angular/core';\nimport type { UntypedFormControl } from '@angular/forms';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport {\n  formControlIsRequired,\n  getControlErrorMessage\n} from '../shared/form.utils';\nimport { IgoFormFieldComponent } from '../shared/form-field-component';\n\n/**\n * This component renders a textarea field\n */\n@IgoFormFieldComponent('textarea')\n@Component({\n  selector: 'igo-form-field-textarea',\n  templateUrl: './form-field-textarea.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormFieldTextareaComponent implements OnInit {\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * The field's form control\n   */\n  @Input() formControl: UntypedFormControl;\n\n  /**\n   * Field placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Field placeholder\n   */\n  @Input() errors: { [key: string]: string };\n\n  /**\n   * Wheter a disable switch should be available\n   */\n  @Input() disableSwitch: boolean = false;\n\n  /**\n   * Whether the field is required\n   */\n  get required(): boolean {\n    return formControlIsRequired(this.formControl);\n  }\n\n  ngOnInit() {\n    this.disabled$.next(this.formControl.disabled);\n  }\n\n  /**\n   * Get error message\n   */\n  getErrorMessage(): string {\n    return getControlErrorMessage(this.formControl, this.errors);\n  }\n\n  onDisableSwitchClick() {\n    this.toggleDisabled();\n  }\n\n  private toggleDisabled() {\n    const disabled = !this.disabled$.value;\n    if (disabled === true) {\n      this.formControl.disable();\n    } else {\n      this.formControl.enable();\n    }\n    this.disabled$.next(disabled);\n  }\n}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  OnChanges,\n  SimpleChanges,\n  ChangeDetectionStrategy,\n  ViewChild,\n  ElementRef\n} from '@angular/core';\n\nimport { t } from 'typy';\n\nimport { Form, FormField, FormFieldGroup } from '../shared/form.interfaces';\nimport { getAllFormFields } from '../shared/form.utils';\n\n/**\n * A configurable form\n */\n@Component({\n  selector: 'igo-form',\n  templateUrl: './form.component.html',\n  styleUrls: ['./form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormComponent implements OnChanges {\n  /**\n   * Form\n   */\n  @Input() form: Form;\n\n  /**\n   * Input data\n   */\n  @Input() formData: { [key: string]: any };\n\n  /**\n   * Form autocomplete\n   */\n  @Input() autocomplete: string = 'off';\n\n  /**\n   * Event emitted when the form is submitted\n   */\n  @Output() submitForm = new EventEmitter<{ [key: string]: any }>();\n\n  @ViewChild('buttons', { static: true }) buttons: ElementRef;\n\n  get hasButtons(): boolean {\n    return this.buttons.nativeElement.children.length !== 0;\n  }\n\n  constructor() {}\n\n  /**\n   * Is the entity or the template change, recreate the form or repopulate it.\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const formData = changes.formData;\n    if (formData && formData.currentValue !== formData.previousValue) {\n      if (formData.currentValue === undefined) {\n        this.clear();\n      } else {\n        this.setData(formData.currentValue);\n      }\n    }\n  }\n\n  /**\n   * Transform the form data to a feature and emit an event\n   * @param event Form submit event\n   * @internal\n   */\n  onSubmit() {\n    this.submitForm.emit(this.getData());\n  }\n\n  getData(): { [key: string]: any } {\n    const data = {};\n    getAllFormFields(this.form).forEach((field: FormField) => {\n      this.updateDataWithFormField(data, field);\n    });\n    return data;\n  }\n\n  private setData(data: { [key: string]: any }) {\n    this.form.fields.forEach((field: FormField) => {\n      field.control.setValue(t(data, field.name).safeObject);\n    });\n\n    this.form.groups.forEach((group: FormFieldGroup) => {\n      group.fields.forEach((field: FormField) => {\n        field.control.setValue(t(data, field.name).safeObject);\n      });\n    });\n  }\n\n  private updateDataWithFormField(\n    data: { [key: string]: any },\n    field: FormField\n  ) {\n    const control = field.control;\n    if (!control.disabled) {\n      data[field.name] = control.value;\n    }\n  }\n\n  /**\n   * Clear form\n   */\n  private clear() {\n    this.form.control.reset();\n  }\n}\n","<form\n  [autocomplete]=\"autocomplete\"\n  [formGroup]=\"form.control\"\n  (ngSubmit)=\"onSubmit()\"\n>\n  <div\n    class=\"igo-form-body\"\n    [ngClass]=\"{ 'igo-form-body-with-buttons': hasButtons }\"\n  >\n    <div class=\"igo-form-content\">\n      <ng-content></ng-content>\n    </div>\n    <div #buttons class=\"igo-form-buttons\">\n      <ng-content select=\"[formButtons]\"></ng-content>\n    </div>\n  </div>\n</form>\n","import {\n  Component,\n  OnInit,\n  OnDestroy,\n  Input,\n  ViewChild,\n  ElementRef\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { Media, MediaService } from '@igo2/core';\n\nimport { FlexibleState, FlexibleDirection } from './flexible.type';\n\n@Component({\n  selector: 'igo-flexible',\n  templateUrl: './flexible.component.html',\n  styleUrls: ['./flexible.component.scss']\n})\nexport class FlexibleComponent implements OnInit, OnDestroy {\n  static transitionTime = 250;\n\n  @ViewChild('flexibleMain', { static: true }) main;\n\n  @Input()\n  get initial(): string {\n    return this._initial;\n  }\n  set initial(value: string) {\n    this._initial = value;\n  }\n  private _initial = '0';\n\n  @Input()\n  get collapsed(): string {\n    return this._collapsed;\n  }\n  set collapsed(value: string) {\n    this._collapsed = value;\n  }\n  private _collapsed = '0';\n\n  @Input()\n  get expanded(): string {\n    return this._expanded;\n  }\n  set expanded(value: string) {\n    this._expanded = value;\n  }\n  private _expanded = '100%';\n\n  @Input()\n  get initialMobile(): string {\n    return this._initialMobile;\n  }\n  set initialMobile(value: string) {\n    this._initialMobile = value;\n  }\n  private _initialMobile: string = this.expanded;\n\n  @Input()\n  get collapsedMobile(): string {\n    return this._collapsedMobile;\n  }\n  set collapsedMobile(value: string) {\n    this._collapsedMobile = value;\n  }\n  private _collapsedMobile: string = this.collapsed;\n\n  @Input()\n  get expandedMobile(): string {\n    return this._expandedMobile;\n  }\n  set expandedMobile(value: string) {\n    this._expandedMobile = value;\n  }\n  private _expandedMobile: string = this.expanded;\n\n  @Input()\n  get direction(): FlexibleDirection {\n    return this._direction;\n  }\n  set direction(value: FlexibleDirection) {\n    this._direction = value;\n  }\n  private _direction: FlexibleDirection = 'column';\n\n  @Input()\n  get state(): FlexibleState {\n    return this._state;\n  }\n  set state(value: FlexibleState) {\n    const sizes = {\n      initial: this.initial,\n      collapsed: this.collapsed,\n      expanded: this.expanded\n    };\n\n    if (this.mediaService.isMobile()) {\n      Object.assign(sizes, {\n        initial: this.initialMobile,\n        collapsed: this.collapsedMobile,\n        expanded: this.expandedMobile\n      });\n    }\n\n    const size = sizes[value];\n    if (size !== undefined) {\n      this.setSize(size);\n      setTimeout(() => {\n        this._state = value;\n      }, FlexibleComponent.transitionTime);\n    }\n  }\n  private _state: FlexibleState = 'initial';\n\n  private mediaService$$: Subscription;\n\n  constructor(\n    private el: ElementRef,\n    private mediaService: MediaService\n  ) {}\n\n  ngOnInit() {\n    this.el.nativeElement.className += this.direction;\n\n    // Since this component supports different sizes\n    // on mobile, force a redraw when the media changes\n    this.mediaService$$ = this.mediaService.media$.subscribe(\n      (media: Media) => (this.state = this.state)\n    );\n  }\n\n  ngOnDestroy() {\n    if (this.mediaService$$) {\n      this.mediaService$$.unsubscribe();\n    }\n  }\n\n  private setSize(size: string) {\n    this._state = 'transition';\n\n    if (this.direction === 'column') {\n      this.main.nativeElement.style.height = size;\n    } else if (this.direction === 'row') {\n      this.main.nativeElement.style.width = size;\n    }\n  }\n}\n","<div #flexibleMain class=\"igo-flexible-main {{ state }} {{ direction }}\">\n  <div class=\"igo-container\">\n    <ng-content></ng-content>\n  </div>\n</div>\n<div class=\"igo-flexible-fill\">\n  <div>\n    <div class=\"igo-container\">\n      <ng-content select=\"[igoFlexibleFill]\"></ng-content>\n    </div>\n  </div>\n</div>\n","<ng-container *ngIf=\"showTourButton\">\n  <button\n    *ngIf=\"styleButton === 'icon'; else raisedButton\"\n    (click)=\"startInteractiveTour()\"\n    [ngClass]=\"getClass()\"\n    color=\"primary\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"\n      disabledTourButton\n        ? ('igo.common.interactiveTour.disaledTooltipTourToolButton'\n          | translate)\n        : ('igo.common.interactiveTour.tooltipTourToolButton' | translate)\n    \"\n    [disabled]=\"disabledTourButton\"\n  >\n    <mat-icon iconPositionEnd svgIcon=\"presentation-play\"> </mat-icon>\n  </button>\n\n  <ng-template #raisedButton>\n    <button\n      (click)=\"startInteractiveTour()\"\n      [ngClass]=\"getClass()\"\n      color=\"primary\"\n      mat-raised-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"disabledTourButton\"\n    >\n      {{ 'igo.common.interactiveTour.buttonTitle' | translate }}\n      {{ discoverTitleInLocale$ | async | translate }}\n      <mat-icon\n        iconPositionEnd\n        svgIcon=\"presentation-play\"\n        [matTooltip]=\"\n          disabledTourButton\n            ? ('igo.common.interactiveTour.disaledTooltipTourToolButton'\n              | translate)\n            : ('igo.common.interactiveTour.tooltipTourToolButton' | translate)\n        \"\n      >\n      </mat-icon>\n    </button>\n  </ng-template>\n</ng-container>\n","import { Component, ViewEncapsulation, Input } from '@angular/core';\nimport { InteractiveTourService } from './interactive-tour.service';\nimport { ToolService } from '../tool/shared/tool.service';\nimport { Observable, of } from 'rxjs';\n\n@Component({\n  selector: 'igo-interactive-tour',\n  templateUrl: './interactive-tour.component.html',\n  styleUrls: ['./interactive-tour.component.scss'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class InteractiveTourComponent {\n  /**\n   * Toolbox that holds main tools\n   */\n  @Input() tourToStart: string = '';\n  @Input() styleButton: 'icon' | 'raised';\n  @Input() discoverTitleInLocale$: Observable<string> = of('IGO');\n\n  getClass() {\n    return {\n      'tour-button-tool-icon': this.styleButton === 'icon',\n      'tour-button-tool': this.styleButton === 'raised'\n    };\n  }\n\n  get toolbox() {\n    return this.toolService.toolbox;\n  }\n\n  getTourToStart() {\n    if (this.tourToStart) {\n      return this.tourToStart;\n    } else {\n      return this.activeToolName;\n    }\n  }\n\n  get activeToolName() {\n    if (this.toolbox) {\n      if (this.isActiveTool) {\n        return this.toolbox.activeTool$.getValue().name;\n      } else {\n        return 'global';\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  get isActiveTool(): boolean {\n    if (this.toolbox) {\n      return this.toolbox.activeTool$.getValue() !== undefined;\n    } else {\n      return undefined;\n    }\n  }\n\n  get isToolHaveTour(): boolean {\n    if (this.activeToolName === 'about' && !this.tourToStart) {\n      return false;\n    }\n    return this.interactiveTourService.isToolHaveTourConfig(\n      this.getTourToStart()\n    );\n  }\n\n  get showTourButton(): boolean {\n    // 2 conditions to show: have Tour on tool in Config file and if we are in mobile displayInMobile= true\n    let haveTour: boolean;\n    haveTour = this.isToolHaveTour;\n    if (haveTour === false) {\n      return false;\n    }\n\n    let inMobileAndShow: boolean;\n    if (this.interactiveTourService.isMobile()) {\n      inMobileAndShow = this.isTourDisplayInMobile;\n      if (inMobileAndShow === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  get isTourDisplayInMobile(): boolean {\n    return this.interactiveTourService.isTourDisplayInMobile();\n  }\n\n  get disabledTourButton(): boolean {\n    return this.interactiveTourService.disabledTourButton(this.activeToolName);\n  }\n\n  constructor(\n    private interactiveTourService: InteractiveTourService,\n    private toolService: ToolService\n  ) {}\n\n  startInteractiveTour() {\n    const tour = this.getTourToStart();\n    if (tour) {\n      this.interactiveTourService.startTour(tour);\n    } else {\n      return;\n    }\n  }\n}\n","import { Component, Input } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'igo-spinner',\n  templateUrl: './spinner.component.html',\n  styleUrls: ['./spinner.component.scss']\n})\nexport class SpinnerComponent {\n  public shown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  @Input()\n  set shown(value: boolean) {\n    this.shown$.next(value);\n  }\n  get shown(): boolean {\n    return this.shown$.value;\n  }\n\n  constructor() {}\n\n  show() {\n    this.shown = true;\n  }\n\n  hide() {\n    this.shown = false;\n  }\n}\n","<div\n  [ngClass]=\"{\n    'igo-spinner-container': true,\n    'igo-spinner-shown': (shown$ | async)\n  }\"\n>\n  <div class=\"igo-spinner-background\"></div>\n  <mat-progress-spinner\n    diameter=\"40\"\n    mode=\"indeterminate\"\n  ></mat-progress-spinner>\n</div>\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { ActivityService } from '@igo2/core';\nimport { SpinnerComponent } from './spinner.component';\n\n/**\n * A directive to bind a SpinnerComponent to the activity service.\n * The activity service tracks any HTTP request and this directive\n * will display the spinner it's attached to when the activity counter\n * is greater than 0.\n */\n@Directive({\n  selector: '[igoSpinnerActivity]'\n})\nexport class SpinnerActivityDirective implements OnInit, OnDestroy {\n  /**\n   * Subscription to the activity service counter\n   */\n  private counter$$: Subscription;\n\n  constructor(\n    @Self() private spinner: SpinnerComponent,\n    private activityService: ActivityService\n  ) {}\n\n  /**\n   * Subscribe to the activity service counter and display the spinner\n   * when it's is greater than 0.\n   * @internal\n   */\n  ngOnInit() {\n    this.counter$$ = this.activityService.counter$\n      .pipe(debounceTime(50))\n      .subscribe((count: number) => {\n        count > 0 ? this.spinner.show() : this.spinner.hide();\n      });\n  }\n\n  /**\n   * Unsubcribe to the activity service counter.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.counter$$.unsubscribe();\n  }\n}\n","import { DataSource } from '@angular/cdk/table';\nimport { MatSort } from '@angular/material/sort';\n\nimport { Observable, BehaviorSubject, merge } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { TableModel } from './table-model.interface';\nimport { TableDatabase } from './table-database';\n\nexport class TableDataSource extends DataSource<any> {\n  get filter(): string {\n    return this._filterChange.value;\n  }\n  set filter(filter: string) {\n    this._filterChange.next(filter);\n  }\n  private _filterChange = new BehaviorSubject('');\n\n  constructor(\n    private _database: TableDatabase,\n    private _model: TableModel,\n    private _sort: MatSort\n  ) {\n    super();\n  }\n\n  // Connect function called by the table to retrieve one stream containing\n  // the data to render.\n  connect(): Observable<any[]> {\n    if (!this._database) {\n      return merge([]);\n    }\n    const displayDataChanges = [\n      this._database.dataChange,\n      this._filterChange,\n      this._sort.sortChange\n    ];\n\n    return merge(...displayDataChanges).pipe(\n      map(() => {\n        return this.getFilteredData(this._database.data);\n      }),\n      map((data) => {\n        return this.getSortedData(data);\n      })\n    );\n  }\n\n  disconnect() {}\n\n  getFilteredData(data): any[] {\n    if (!this.filter) {\n      return data;\n    }\n    return data.slice().filter((item: any) => {\n      const searchStr: string = this._model.columns\n        .filter((c) => c.filterable)\n        .map((c) => ObjectUtils.resolve(item, c.name))\n        .join(' ')\n        .toLowerCase();\n\n      return searchStr.indexOf(this.filter.toLowerCase()) !== -1;\n    });\n  }\n\n  getSortedData(data): any[] {\n    if (!this._sort.active || this._sort.direction === '') {\n      return data;\n    }\n\n    return data.sort((a, b) => {\n      const propertyA: number | string = ObjectUtils.resolve(\n        a,\n        this._sort.active\n      );\n      const propertyB: number | string = ObjectUtils.resolve(\n        b,\n        this._sort.active\n      );\n\n      return ObjectUtils.naturalCompare(\n        propertyB,\n        propertyA,\n        this._sort.direction\n      );\n    });\n  }\n}\n","export enum TableActionColor {\n  primary,\n  accent,\n  warn\n}\n","<div class=\"table-box\">\n  <div class=\"table-header\" *ngIf=\"hasFilterInput\">\n    <mat-form-field floatPlaceholder=\"never\">\n      <input\n        matInput\n        #filter\n        [placeholder]=\"'igo.common.table.filter' | translate\"\n      />\n    </mat-form-field>\n  </div>\n\n  <div class=\"table-container\">\n    <table mat-table #table [dataSource]=\"dataSource\" matSort>\n      <!-- Checkbox Column -->\n      <ng-container matColumnDef=\"selectionCheckbox\">\n        <th mat-header-cell *matHeaderCellDef>\n          <mat-checkbox\n            (change)=\"$event ? masterToggle() : null\"\n            [checked]=\"selection.hasValue() && isAllSelected()\"\n            [indeterminate]=\"selection.hasValue() && !isAllSelected()\"\n          >\n          </mat-checkbox>\n        </th>\n        <td mat-cell *matCellDef=\"let row\">\n          <mat-checkbox\n            (click)=\"$event.stopPropagation()\"\n            (change)=\"$event ? selection.toggle(row) : null\"\n            [checked]=\"selection.isSelected(row)\"\n          >\n          </mat-checkbox>\n        </td>\n      </ng-container>\n\n      <ng-container\n        [matColumnDef]=\"column.name\"\n        *ngFor=\"let column of model.columns\"\n      >\n        <ng-container *ngIf=\"column.sortable\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>\n            {{ column.title }}\n          </th>\n        </ng-container>\n\n        <ng-container *ngIf=\"!column.sortable\">\n          <th mat-header-cell *matHeaderCellDef>{{ column.title }}</th>\n        </ng-container>\n\n        <ng-container *ngIf=\"!column.html; else cellHTML\">\n          <td\n            mat-cell\n            *matCellDef=\"let row\"\n            class=\"mat-cell-text\"\n            [ngClass]=\"\n              model.cellClassFunc ? model.cellClassFunc(row, column) : {}\n            \"\n          >\n            {{ getValue(row, column.name) }}\n          </td>\n        </ng-container>\n\n        <ng-template #cellHTML>\n          <td\n            mat-cell\n            *matCellDef=\"let row\"\n            class=\"mat-cell-text\"\n            [ngClass]=\"\n              model.cellClassFunc ? model.cellClassFunc(row, column) : {}\n            \"\n            [innerHTML]=\"getValue(row, column.name)\"\n          ></td>\n        </ng-template>\n      </ng-container>\n\n      <!-- Action Column -->\n      <ng-container matColumnDef=\"action\">\n        <th mat-header-cell *matHeaderCellDef></th>\n        <td mat-cell *matCellDef=\"let row\">\n          <button\n            *ngFor=\"let action of model.actions\"\n            mat-mini-fab\n            [color]=\"getActionColor(action.color)\"\n            (click)=\"handleClickAction($event, action, row)\"\n          >\n            <mat-icon svgIcon=\"{{ action.icon }}\"></mat-icon>\n          </button>\n        </td>\n      </ng-container>\n\n      <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\n      <tr\n        mat-row\n        *matRowDef=\"let row; columns: displayedColumns\"\n        [ngClass]=\"model.rowClassFunc ? model.rowClassFunc(row) : {}\"\n        (click)=\"selection.toggle(row)\"\n      ></tr>\n    </table>\n  </div>\n</div>\n","import {\n  Component,\n  ElementRef,\n  ViewChild,\n  Input,\n  Output,\n  OnChanges,\n  OnInit,\n  AfterViewInit,\n  EventEmitter\n} from '@angular/core';\nimport { MatSort } from '@angular/material/sort';\nimport { SelectionModel } from '@angular/cdk/collections';\n\nimport { debounceTime, distinctUntilChanged } from 'rxjs/operators';\nimport { fromEvent } from 'rxjs';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { TableModel } from './table-model.interface';\nimport { TableDatabase } from './table-database';\nimport { TableDataSource } from './table-datasource';\nimport { TableActionColor } from './table-action-color.enum';\n\n@Component({\n  selector: 'igo-table',\n  templateUrl: './table.component.html',\n  styleUrls: ['./table.component.scss']\n})\nexport class TableComponent implements OnChanges, OnInit, AfterViewInit {\n  @Input()\n  get database(): TableDatabase {\n    return this._database;\n  }\n  set database(value: TableDatabase) {\n    this._database = value;\n  }\n  private _database: TableDatabase;\n\n  @Input()\n  get model(): TableModel {\n    return this._model;\n  }\n  set model(value: TableModel) {\n    this._model = value;\n  }\n  private _model: TableModel;\n\n  @Input()\n  get hasFilterInput(): boolean {\n    return this._hasFIlterInput;\n  }\n  set hasFilterInput(value: boolean) {\n    this._hasFIlterInput = value;\n  }\n  private _hasFIlterInput = true;\n\n  public displayedColumns;\n  public dataSource: TableDataSource | null;\n  public selection = new SelectionModel<any>(true, []);\n\n  @Output()\n  select = new EventEmitter<{\n    added: any[];\n    removed: any[];\n    source: SelectionModel<any>;\n  }>();\n\n  @ViewChild('filter') filter: ElementRef;\n  @ViewChild(MatSort, { static: true }) sort: MatSort;\n\n  ngOnInit() {\n    this.dataSource = new TableDataSource(this.database, this.model, this.sort);\n\n    if (this.model) {\n      this.displayedColumns = this.model.columns\n        .filter((c) => c.displayed !== false)\n        .map((c) => c.name);\n\n      if (this.model.selectionCheckbox) {\n        this.displayedColumns.unshift('selectionCheckbox');\n      }\n      if (this.model.actions && this.model.actions.length) {\n        this.displayedColumns.push('action');\n      }\n    }\n\n    this.selection.changed.subscribe((e) => this.select.emit(e));\n  }\n\n  ngAfterViewInit() {\n    if (this.filter) {\n      fromEvent(this.filter.nativeElement, 'keyup')\n        .pipe(debounceTime(150), distinctUntilChanged())\n        .subscribe(() => {\n          if (!this.dataSource) {\n            return;\n          }\n          this.dataSource.filter = this.filter.nativeElement.value;\n        });\n    }\n  }\n\n  ngOnChanges(change) {\n    if (change.database) {\n      this.dataSource = new TableDataSource(\n        this.database,\n        this.model,\n        this.sort\n      );\n      this.selection.clear();\n    }\n  }\n\n  getActionColor(colorId: number): string {\n    return TableActionColor[colorId];\n  }\n\n  getValue(row, key) {\n    return ObjectUtils.resolve(row, key);\n  }\n\n  /** Whether the number of selected elements matches the total number of rows. */\n  isAllSelected() {\n    const numSelected = this.selection.selected.length;\n    const numRows = this.database.data.length;\n    return numSelected === numRows;\n  }\n\n  /** Selects all rows if they are not all selected; otherwise clear selection. */\n  masterToggle() {\n    this.isAllSelected()\n      ? this.selection.clear()\n      : this.database.data.forEach((row) => this.selection.select(row));\n  }\n\n  handleClickAction(event, action, row) {\n    event.stopPropagation();\n    action.click(row);\n  }\n}\n","import { BehaviorSubject } from 'rxjs';\n\nexport class TableDatabase {\n  /** Stream that emits whenever the data has been modified. */\n  dataChange: BehaviorSubject<any[]> = new BehaviorSubject<any[]>([]);\n  get data(): any[] {\n    return this.dataChange.value;\n  }\n\n  constructor(data?) {\n    if (data) {\n      this.dataChange.next(data);\n    }\n  }\n\n  set(data) {\n    this.dataChange.next(data);\n  }\n\n  add(item) {\n    const copiedData = this.data.slice();\n    copiedData.push(item);\n    this.set(copiedData);\n  }\n\n  remove(item) {\n    const copiedData = this.data.slice();\n    const index = copiedData.indexOf(item);\n    copiedData.splice(index, 1);\n    this.set(copiedData);\n  }\n}\n","import { Tool } from './tool.interface';\nimport { ToolService } from './tool.service';\n\nexport function ToolComponent(tool: Partial<Tool>): (cls: any) => any {\n  return (compType: any) => {\n    ToolService.register(\n      Object.assign({}, tool, {\n        component: compType\n      } as Tool)\n    );\n  };\n}\n","export enum ToolboxColor {\n  White = 'white',\n  Grey = 'grey',\n  Primary = 'primary'\n}\n","import {\n  trigger,\n  state,\n  style,\n  transition,\n  animate,\n  AnimationTriggerMetadata\n} from '@angular/animations';\n\nexport function toolSlideInOut(\n  speed = '300ms',\n  type = 'ease-in-out'\n): AnimationTriggerMetadata {\n  return trigger('toolSlideInOut', [\n    state(\n      'enter',\n      style({\n        transform: 'translate3d(0, 0, 0)'\n      })\n    ),\n    transition('void => enter', animate(speed + ' ' + type))\n  ]);\n}\n","<igo-actionbar\n  *ngIf=\"(toolbar$ | async).length > 0\"\n  [store]=\"actionStore\"\n  [withIcon]=\"true\"\n  [withTitle]=\"toolbarWithTitle$ | async\"\n  [withTooltip]=\"(toolbarWithTitle$ | async) === false\"\n  [scrollActive]=\"toolbarWithTitle$ | async\"\n  [horizontal]=\"false\"\n>\n</igo-actionbar>\n\n<div\n  *ngIf=\"activeTool$ | async as tool\"\n  class=\"igo-tool-container mat-body-1\"\n  [ngClass]=\"{\n    'igo-tool-container-with-toolbar': !actionStore.empty,\n    'igo-tool-container-with-animation': animate\n  }\"\n  [@toolSlideInOut]=\"animation$ | async\"\n  (@toolSlideInOut.start)=\"onAnimationStart()\"\n  (@toolSlideInOut.done)=\"onAnimationComplete()\"\n>\n  <igo-dynamic-outlet\n    [component]=\"tool.component\"\n    [inputs]=\"getToolInputs(tool)\"\n  >\n  </igo-dynamic-outlet>\n</div>\n","import {\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  HostBinding,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { Subscription, BehaviorSubject, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Action, ActionStore } from '../../action';\nimport { Tool } from '../shared/tool.interface';\nimport { ToolboxColor } from '../shared/toolbox.enums';\nimport { Toolbox } from '../shared/toolbox';\nimport { toolSlideInOut } from './toolbox.animation';\n\n@Component({\n  selector: 'igo-toolbox',\n  templateUrl: 'toolbox.component.html',\n  styleUrls: ['toolbox.component.scss'],\n  animations: [toolSlideInOut()],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ToolboxComponent implements OnInit, OnDestroy {\n  /**\n   * Observable of the active tool\n   */\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\n\n  get isActive(): boolean {\n    return !!this.activeTool$.value;\n  }\n\n  /**\n   * Store of actions that toggle tools\n   */\n  actionStore: ActionStore = new ActionStore([]);\n\n  /**\n   * Observable of he anmation state\n   */\n  animation$: BehaviorSubject<string> = new BehaviorSubject('none');\n\n  /**\n   * Observable of the toolbar\n   */\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\n\n  /**\n   * Whether the Toolbar should display actions' titles\n   */\n  toolbarWithTitle$: Observable<boolean> = this.activeTool$.pipe(\n    map((tool: Tool | undefined) => tool === undefined)\n  );\n\n  /**\n   * Subscription to the active tool\n   */\n  private activeTool$$: Subscription;\n\n  /**\n   * Subscription to the toolbar\n   */\n  private toolbar$$: Subscription;\n\n  /**\n   * Observable of the ongoing animation. This is useful when\n   * multiple animations are triggered at once i.e. when the user clicks\n   * too fast on different actions\n   */\n  private animating$ = new BehaviorSubject<boolean>(false);\n\n  /**\n   * Subscription to the ongoing animation\n   */\n  private animating$$: Subscription;\n\n  /**\n   * Toolbox\n   */\n  @Input() toolbox: Toolbox;\n\n  /**\n   * Whether the toolbox should animate the first tool entering\n   */\n  @Input() animate: boolean = false;\n\n  /**\n   * Color of Toolbox\n   */\n  @Input() color: ToolboxColor = ToolboxColor.White;\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.color-grey')\n  get classColorGrey() {\n    return this.color === ToolboxColor.Grey;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.color-primary')\n  get classColorPrimary() {\n    return this.color === ToolboxColor.Primary;\n  }\n\n  /**\n   * Initialize the toolbar and subscribe to the active tool\n   * @internal\n   */\n  ngOnInit() {\n    this.toolbar$$ = this.toolbox.toolbar$.subscribe((toolbar: string[]) =>\n      this.onToolbarChange(toolbar)\n    );\n    this.activeTool$$ = this.toolbox.activeTool$.subscribe((tool: Tool) =>\n      this.onActiveToolChange(tool)\n    );\n  }\n\n  /**\n   * Unsubscribe to the active tool and destroy the action store\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toolbar$$.unsubscribe();\n    this.activeTool$$.unsubscribe();\n    this.actionStore.destroy();\n  }\n\n  /**\n   * Track the starting animation\n   * @internal\n   */\n  onAnimationStart() {\n    this.animating$.next(true);\n  }\n\n  /**\n   * Untrack the completed animation\n   * @internal\n   */\n  onAnimationComplete() {\n    this.animating$.next(false);\n  }\n\n  /**\n   * Return a tool's inputs\n   * @param tool Tool\n   * @returns Tool inputs\n   * @internal\n   */\n  getToolInputs(tool: Tool): { [key: string]: any } {\n    return tool.options || {};\n  }\n\n  /**\n   * Initialize an action store\n   * @param toolbar Toolbar\n   */\n  private onToolbarChange(toolbar: string[]) {\n    this.setToolbar(toolbar);\n  }\n\n  /**\n   * Activate a tool and trigger an animation or not\n   * @param tool Tool to activate\n   */\n  private onActiveToolChange(tool: Tool) {\n    if (!this.animate) {\n      this.setActiveTool(tool);\n      return;\n    }\n    this.onAnimate(() => this.setActiveTool(tool));\n  }\n\n  /**\n   * Set the active tool\n   * @param tool Tool to activate\n   */\n  private setActiveTool(tool: Tool | undefined) {\n    if (tool === undefined) {\n      this.actionStore.state.updateAll({ active: false });\n    } else {\n      const action = this.actionStore.get(tool.name);\n      if (action !== undefined) {\n        this.actionStore.state.update(action, { active: true }, true);\n      }\n    }\n\n    this.activeTool$.next(tool);\n    if (this.animate) {\n      this.animation$.next('enter');\n    }\n  }\n\n  /**\n   * Initialize the toolbar\n   */\n  private setToolbar(toolbar: string[]) {\n    const actions = toolbar.reduce((acc: Action[], toolName: string) => {\n      const tool = this.toolbox.getTool(toolName);\n      if (tool === undefined) {\n        return acc;\n      }\n\n      acc.push({\n        id: tool.name,\n        title: tool.title,\n        icon: tool.icon,\n        // iconImage: tool.iconImage,\n        tooltip: tool.tooltip,\n        args: [tool, this.toolbox],\n        handler: (_tool: Tool, _toolbox: Toolbox) => {\n          _toolbox.activateTool(_tool.name);\n        },\n        ngClass: (_tool: Tool, _toolbox: Toolbox) => {\n          return this.toolbox.activeTool$.pipe(\n            map((activeTool: Tool) => {\n              let toolActivated = false;\n              if (activeTool !== undefined && _tool.name === activeTool.name) {\n                toolActivated = true;\n              }\n\n              let childrenToolActivated = false;\n              if (\n                activeTool !== undefined &&\n                _tool.name === activeTool.parent\n              ) {\n                childrenToolActivated = true;\n              }\n\n              return {\n                'tool-activated': toolActivated,\n                'children-tool-activated': childrenToolActivated\n              };\n            })\n          );\n        }\n      });\n      return acc;\n    }, []);\n    this.actionStore.load(actions);\n    this.toolbar$.next(toolbar);\n  }\n\n  /**\n   * Observe the ongoing animation and ignore any incoming animation\n   * while one is still ongoing.\n   * @param callback Callback to execute when the animation completes\n   */\n  private onAnimate(callback: () => void) {\n    this.unAnimate();\n    this.animating$$ = this.animating$.subscribe((animation: boolean) => {\n      if (!animation) {\n        callback.call(this);\n        this.unAnimate();\n      }\n    });\n  }\n\n  /**\n   * Stop observing an animation when it's complete\n   */\n  private unAnimate() {\n    if (this.animating$$) {\n      this.animating$$.unsubscribe();\n    }\n  }\n}\n","<igo-dynamic-outlet\n  *ngIf=\"widget\"\n  [component]=\"widget\"\n  [inputs]=\"inputs\"\n  [subscribers]=\"getEffectiveSubscribers()\"\n>\n</igo-dynamic-outlet>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnDestroy\n} from '@angular/core';\n\nimport { DynamicComponent } from '../../dynamic-component';\n\nimport { WidgetComponent } from '../shared/widget.interfaces';\n\n/**\n * This component dynamically renders a widget. It also subscribes\n * to the widget's 'cancel' and 'complete' events and destroys it\n * when any of those event is emitted.\n */\n@Component({\n  selector: 'igo-widget-outlet',\n  templateUrl: './widget-outlet.component.html',\n  styleUrls: ['./widget-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WidgetOutletComponent implements OnDestroy {\n  /**\n   * Widget subscribers to 'cancel' and 'complete'\n   * @internal\n   */\n  private baseSubscribers = {\n    cancel: (event: any) => this.onCancel(event),\n    complete: (event: any) => this.onComplete(event)\n  };\n\n  /**\n   * Widget\n   */\n  @Input() widget: DynamicComponent<WidgetComponent>;\n\n  /**\n   * Widget inputs\n   */\n  @Input() inputs: { [key: string]: any };\n\n  /**\n   * Widget subscribers\n   */\n  @Input() subscribers: { [key: string]: (event: any) => void } = {};\n\n  /**\n   * Event emitted when the widget emits 'complete'\n   */\n  @Output() complete = new EventEmitter<any>();\n\n  /**\n   * Event emitted when the widget emits 'cancel'\n   */\n  @Output() cancel = new EventEmitter<any>();\n\n  constructor() {}\n\n  /**\n   * Destroy the current widget and all it's inner subscriptions\n   * @internal\n   */\n  ngOnDestroy() {\n    this.destroyWidget();\n  }\n\n  /**\n   * Get the effective subscribers. That means a combination of the base\n   * subscribers and any subscriber given as input.\n   * @returns Combined subscribers\n   * @internal\n   */\n  getEffectiveSubscribers(): { [key: string]: (event: any) => void } {\n    const subscribers = Object.assign({}, this.subscribers);\n\n    // Base subscribers\n    Object.keys(this.baseSubscribers).forEach((key: string) => {\n      const subscriber = subscribers[key];\n      const baseSubscriber = this.baseSubscribers[key];\n      if (subscriber !== undefined) {\n        subscribers[key] = (event: any) => {\n          subscriber(event);\n          baseSubscriber(event);\n        };\n      } else {\n        subscribers[key] = baseSubscriber;\n      }\n    });\n\n    return subscribers;\n  }\n\n  /**\n   * When the widget emits 'cancel', propagate that event and destroy\n   * the widget\n   */\n  private onCancel(event: any) {\n    this.cancel.emit(event);\n    this.destroyWidget();\n  }\n\n  /**\n   * When the widget emits 'complete', propagate that event and destroy\n   * the widget\n   */\n  private onComplete(event: any) {\n    this.complete.emit(event);\n    this.destroyWidget();\n  }\n\n  /**\n   * Destroy the current widget\n   */\n  private destroyWidget() {\n    if (this.widget !== undefined) {\n      this.widget.destroy();\n    }\n    this.widget = undefined;\n  }\n}\n","import { EntityStore } from '../../entity';\nimport { Workspace } from './workspace';\nimport { BehaviorSubject } from 'rxjs';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * workspaces.\n */\nexport class WorkspaceStore extends EntityStore<Workspace> {\n  activeWorkspace$: BehaviorSubject<Workspace> = new BehaviorSubject(undefined);\n\n  /**\n   * Activate the an workspace workspace and deactivate the one currently active\n   * @param workspace Workspace\n   */\n  activateWorkspace(workspace: Workspace) {\n    const active = this.activeWorkspace$.value;\n    if (active !== undefined) {\n      active.deactivate();\n    }\n\n    this.deactivateWorkspace();\n    if (workspace !== undefined) {\n      this.state.update(workspace, { active: true, selected: true }, true);\n      this.activeWorkspace$.next(workspace);\n      workspace.activate();\n    }\n  }\n\n  /**\n   * Deactivate the current workspace\n   * @param workspace Workspace\n   */\n  deactivateWorkspace() {\n    const active = this.activeWorkspace$.value;\n    if (active !== undefined) {\n      active.deactivate();\n      this.activeWorkspace$.next(undefined);\n    }\n  }\n}\n","import { Subscription, BehaviorSubject, Subject } from 'rxjs';\n\nimport { ActionStore } from '../../action';\nimport { Widget } from '../../widget';\nimport { EntityStoreWithStrategy } from '../../entity';\n\nimport { WorkspaceOptions } from './workspace.interfaces';\n\n/**\n * This class is responsible of managing the relations between\n * entities and the actions that consume them. It also defines an\n * entity table template that may be used by an entity table component.\n */\nexport class Workspace<E extends object = object> {\n  /**\n   * Observable of the selected widget\n   */\n  readonly widget$ = new BehaviorSubject<Widget>(undefined);\n\n  /**\n   * Observable of the selected widget's inputs\n   */\n  readonly widgetInputs$ = new BehaviorSubject<{ [key: string]: any }>({});\n\n  /**\n   * Observable of the selected widget's subscribers\n   */\n  readonly widgetSubscribers$ = new BehaviorSubject<{\n    [key: string]: (event: any) => void;\n  }>({});\n\n  /**\n   * Subscription to the selected entity\n   */\n  private entities$$: Subscription;\n\n  /**\n   * State change that trigger an update of the actions availability\n   */\n  private change: Subject<void> = new Subject();\n\n  /**\n   * Subscription to state changes\n   */\n  private change$: Subscription;\n\n  /**\n   * Workspace id\n   */\n  get id(): string {\n    return this.options.id;\n  }\n\n  /**\n   * Workspace title\n   */\n  get title(): string {\n    return this.options.title;\n  }\n\n  /**\n   * Workspace title\n   */\n  get meta(): { [key: string]: any } {\n    return this.options.meta || {};\n  }\n\n  /**\n   * Entities store\n   */\n  get entityStore(): EntityStoreWithStrategy<E> {\n    return this.options.entityStore as EntityStoreWithStrategy<E>;\n  }\n\n  /**\n   * Actions store (some actions activate a widget)\n   */\n  get actionStore(): ActionStore {\n    return this.options.actionStore;\n  }\n\n  /**\n   * Selected widget\n   */\n  get widget(): Widget {\n    return this.widget$.value;\n  }\n\n  /**\n   * Whether a widget is selected\n   */\n  get hasWidget(): boolean {\n    return this.widget !== undefined;\n  }\n\n  constructor(protected options: WorkspaceOptions) {}\n\n  /**\n   * Whether this strategy is active\n   * @internal\n   */\n  get active(): boolean {\n    return this.active$.value;\n  }\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Activate the workspace. By doing that, the workspace will observe\n   * the selected entity (from the store) and update the actions availability.\n   * For example, some actions require an entity to be selected.\n   */\n  activate() {\n    if (this.active === true) {\n      this.deactivate();\n    }\n    this.active$.next(true);\n\n    if (this.entityStore !== undefined) {\n      this.entities$$ = this.entityStore.stateView\n        .all$()\n        .subscribe(() => this.onStateChange());\n    }\n\n    this.change.next();\n  }\n\n  /**\n   * Deactivate the workspace. Unsubcribe to the selected entity.\n   */\n  deactivate() {\n    this.active$.next(false);\n    this.deactivateWidget();\n\n    if (this.entities$$ !== undefined) {\n      this.entities$$.unsubscribe();\n    }\n    if (this.change$ !== undefined) {\n      this.change$.unsubscribe();\n    }\n  }\n\n  /**\n   * Activate a widget. In itself, activating a widget doesn't render it but,\n   * if an WorkspaceWidgetOutlet component is bound to this workspace, the widget will\n   * show up.\n   * @param widget Widget\n   * @param inputs Inputs the widget will receive\n   */\n  activateWidget(\n    widget: Widget,\n    inputs: { [key: string]: any } = {},\n    subscribers: { [key: string]: (event: any) => void } = {}\n  ) {\n    this.widget$.next(widget);\n    this.widgetInputs$.next(inputs);\n    this.widgetSubscribers$.next(subscribers);\n    this.change.next();\n  }\n\n  /**\n   * Deactivate a widget.\n   */\n  deactivateWidget() {\n    this.widget$.next(undefined);\n    this.change.next();\n  }\n\n  /**\n   * When the state changes, update the actions availability.\n   */\n  private onStateChange() {\n    this.change.next();\n  }\n}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { getEntityTitle } from '../../entity';\nimport { Workspace } from '../shared/workspace';\nimport { WorkspaceStore } from '../shared/store';\n\n/**\n * Drop list that activates the selected workspace emit an event.\n */\n@Component({\n  selector: 'igo-workspace-selector',\n  templateUrl: './workspace-selector.component.html',\n  styleUrls: ['./workspace-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WorkspaceSelectorComponent {\n  /**\n   * Store that holds the available workspaces.\n   */\n  @Input() store: WorkspaceStore;\n\n  /**\n   * Wheither the selector must be disabled or not.\n   */\n  @Input() disabled: boolean;\n\n  /**\n   * Event emitted when an workspace is selected or unselected\n   */\n  @Output() selectedChange = new EventEmitter<{\n    selected: boolean;\n    value: Workspace;\n  }>();\n\n  /**\n   * @internal\n   */\n  getWorkspaceTitle(workspace: Workspace): string {\n    return getEntityTitle(workspace);\n  }\n\n  /**\n   * When an workspace is manually selected, select it into the\n   * store and emit an event.\n   * @internal\n   * @param event The selection change event\n   */\n  onSelectedChange(event: { value: Workspace }) {\n    const workspace = event.value;\n    this.store.activateWorkspace(workspace);\n    this.selectedChange.emit({ selected: true, value: workspace });\n  }\n}\n","<igo-entity-selector\n  [store]=\"store\"\n  [multi]=\"false\"\n  [titleAccessor]=\"getWorkspaceTitle\"\n  [disabled]=\"disabled\"\n  (selectedChange)=\"onSelectedChange($event)\"\n>\n</igo-entity-selector>\n","<ng-container *ngIf=\"widget$ | async as widget\">\n  <igo-widget-outlet\n    [widget]=\"widget\"\n    [inputs]=\"widgetInputs$ | async\"\n    [subscribers]=\"widgetSubscribers$ | async\"\n    (cancel)=\"onWidgetCancel(widget)\"\n    (complete)=\"onWidgetComplete(widget)\"\n  >\n  </igo-widget-outlet>\n</ng-container>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Widget } from '../../widget';\nimport { Workspace } from '../shared/workspace';\n\n/**\n * This component dynamically render an Workspace's active widget.\n * It also deactivate that widget whenever the widget's component\n * emit the 'cancel' or 'complete' event.\n */\n@Component({\n  selector: 'igo-workspace-widget-outlet',\n  templateUrl: './workspace-widget-outlet.component.html',\n  styleUrls: ['./workspace-widget-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WorkspaceWidgetOutletComponent {\n  /**\n   * Workspace\n   */\n  @Input() workspace: Workspace;\n\n  /**\n   * Event emitted when a widget is deactivate which happens\n   * when the widget's component emits the 'cancel' or 'complete' event.\n   */\n  @Output() deactivateWidget = new EventEmitter<Widget>();\n\n  /**\n   * Observable of the workspace's active widget\n   * @internal\n   */\n  get widget$(): BehaviorSubject<Widget> {\n    return this.workspace.widget$;\n  }\n\n  /**\n   * Observable of the workspace's widget inputs\n   * @internal\n   */\n  get widgetInputs$(): BehaviorSubject<{ [key: string]: any }> {\n    return this.workspace.widgetInputs$;\n  }\n\n  /**\n   * Observable of the workspace's widget inputs\n   * @internal\n   */\n  get widgetSubscribers$(): BehaviorSubject<{\n    [key: string]: (event: any) => void;\n  }> {\n    return this.workspace.widgetSubscribers$;\n  }\n\n  constructor() {}\n\n  /**\n   * When a widget's component emit the 'cancel' event,\n   * deactivate that widget and emit the 'deactivateWidget' event.\n   * @param widget Widget\n   * @internal\n   */\n  onWidgetCancel(widget: Widget) {\n    this.workspace.deactivateWidget();\n    this.deactivateWidget.emit(widget);\n  }\n\n  /**\n   * When a widget's component emit the 'cancel' event,\n   * deactivate that widget and emit the 'deactivateWidget' event.\n   * @param widget Widget\n   * @internal\n   */\n  onWidgetComplete(widget: Widget) {\n    this.workspace.deactivateWidget();\n    this.deactivateWidget.emit(widget);\n  }\n}\n","import {\n  Component,\n  EventEmitter,\n  forwardRef,\n  Output,\n  OnInit\n} from '@angular/core';\nimport { Input } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport tinycolor from 'tinycolor2';\n\n@Component({\n  selector: 'igo-color-picker-form-field',\n  templateUrl: './color-picker-form-field.component.html',\n  styleUrls: ['./color-picker-form-field.component.scss'],\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => ColorPickerFormFieldComponent),\n      multi: true\n    }\n  ]\n})\nexport class ColorPickerFormFieldComponent\n  implements ControlValueAccessor, OnInit\n{\n  // native color picker can't give transparency\n  // set transparency manually\n  @Input() setAlpha: number = 1;\n\n  // by default native color picker gives hex result\n  @Input() outputFormat: 'hex' | 'rgba' | 'hsla' = 'rgba';\n\n  // default color\n  @Input() color: string = '#000';\n\n  // open and close native color picker event\n  @Output() open = new EventEmitter<boolean>();\n  @Output() close = new EventEmitter<boolean>();\n\n  onChange: any = () => {};\n  onTouch: any = () => {};\n\n  // final value we get as result with custom format\n  set value(value: string) {\n    value = !value ? this.color : value;\n    this.onChange(value);\n    this.onTouch(value);\n    this._value = value;\n  }\n  get value(): string {\n    return this._value;\n  }\n  public _value: string;\n\n  // native color picker accept hex format\n  set hexColor(value: string) {\n    this.value = this.setFormat(value);\n    this._hexColor = value;\n  }\n  get hexColor(): string {\n    return this._hexColor;\n  }\n  public _hexColor: string;\n\n  ngOnInit(): void {\n    if (this.color) {\n      this._hexColor = tinycolor(this.color)\n        .setAlpha(this.setAlpha)\n        .toHexString();\n    }\n  }\n\n  writeValue(value: string) {\n    this.value = value;\n  }\n\n  registerOnChange(fn: any) {\n    this.onChange = fn;\n  }\n\n  registerOnTouched(fn: any) {\n    this.onTouch = fn;\n  }\n\n  setFormat(color: string): string {\n    switch (this.outputFormat) {\n      case 'hex':\n        color = tinycolor(color).setAlpha(this.setAlpha).toHexString();\n        break;\n      case 'rgba':\n        color = tinycolor(color).setAlpha(this.setAlpha).toRgbString();\n        break;\n      case 'hsla':\n        color = tinycolor(color).setAlpha(this.setAlpha).toHsvString();\n        break;\n      default:\n        color = tinycolor(color).setAlpha(this.setAlpha).toRgbString();\n        break;\n    }\n    return color;\n  }\n\n  closePicker() {\n    setTimeout(() => {\n      this.close.emit(true);\n    }, 300);\n  }\n}\n","<mat-form-field\n  class=\"fill-field\"\n  floatLabel=\"always\"\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  subscriptSizing=\"dynamic\"\n>\n  <mat-label>{{ value }}</mat-label>\n  <input\n    matInput\n    [readonly]=\"true\"\n    (click)=\"open.emit(true)\"\n    (blur)=\"closePicker()\"\n    [(ngModel)]=\"hexColor\"\n    type=\"color\"\n  />\n</mat-form-field>\n","<h6 class=\"mat-subtitle-2 m-b-0\">{{ subtitle }}</h6>\n<h2>{{ title }}</h2>\n\n<div class=\"mat-body-1\">\n  <ng-container *ngIf=\"dependencies?.length\">\n    <label for=\"\">Dependencies:</label>\n    <ul>\n      <li *ngFor=\"let dep of dependencies\">{{ dep }}</li>\n    </ul>\n  </ng-container>\n  <ng-content></ng-content>\n</div>\n<!-- <mat-card appearance=\"outlined\">\n  <mat-card-header>\n    <mat-card-subtitle>{{subtitle}}</mat-card-subtitle>\n    <mat-card-title>{{title}}</mat-card-title>\n  </mat-card-header>\n  <mat-card-content>\n    <ng-container *ngIf=\"dependencies?.length\">\n        <label for=\"\">Dependencies:</label>\n        <ul>\n            <li *ngFor=\"let dep of dependencies\">{{dep}}</li>\n        </ul>\n        <br />\n    </ng-container>\n    <ng-content></ng-content>\n  </mat-card-content>\n</mat-card> -->\n","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'app-doc-viewer',\n  templateUrl: './doc-viewer.component.html',\n  styleUrls: ['./doc-viewer.component.scss']\n})\nexport class DocViewerComponent {\n  @Input() title: string;\n  @Input() subtitle: string;\n  @Input() dependencies: string[];\n}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppHomeComponent } from './home.component';\n\nconst routes: Routes = [\n  {\n    path: 'home',\n    component: AppHomeComponent\n  }\n];\n\nexport const AppHomeRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\nimport { InteractiveTourService } from '@igo2/common';\n\n@Component({\n  selector: 'app-home',\n  templateUrl: './home.component.html',\n  styleUrls: ['./home.component.scss']\n})\nexport class AppHomeComponent {\n  constructor(private interactiveTourService: InteractiveTourService) {}\n\n  startTour() {\n    this.interactiveTourService.startTour('global');\n  }\n}\n","<app-doc-viewer>\n  <div style=\"text-align: center\">\n    <h1 id=\"igo-title\">Welcome to IGO</h1>\n    <img class=\"igo-logo\" width=\"180\" src=\"assets/igo2/core/logo.png\" />\n  </div>\n\n  <p>\n    <igo-interactive-tour\n      tourToStart=\"global\"\n      menuIsOpen=\"true\"\n      styleButton=\"raised\"\n    >\n    </igo-interactive-tour>\n  </p>\n\n  <p class=\"mat-body-1\">\n    IGO2 library contains many components and services that may benefit any web\n    application. <br />\n    IGO2 library is open source project using Angular, Angular Material and\n    OpenLayers.\n  </p>\n\n  <h3>IGO2 library is divided into several elements:</h3>\n  <ul class=\"mat-body-1\">\n    <li>\n      <b>@igo2/utils</b> : Basic utilies without dependency (ex: base64,\n      clipboard, uuid)\n    </li>\n    <li>\n      <b>@igo2/core</b> : Element affecting the core of the application (ex:\n      config, language, message, media, request)\n    </li>\n    <li>\n      <b>@igo2/common</b> : Library containing reusable components (ex:\n      clickout, drag-drop, list, panel, spinner, table)\n    </li>\n    <li>\n      <b>@igo2/auth</b> : Library grouping the authentication and security\n      module\n    </li>\n    <li>\n      <b>@igo2/geo</b> : Library containing the geomatic components. Depends on\n      Openlayers.\n    </li>\n    <li>\n      <b>@igo2/context</b> : Library of components uniting @igo2/geo and\n      @igo2/auth\n    </li>\n    <li><b>@igo2/integration</b> : Library integrate basic components</li>\n  </ul>\n\n  <h2>Here are some links to help you start:</h2>\n  <ul>\n    <li>\n      <h2>\n        <a\n          target=\"_blank\"\n          rel=\"noopener\"\n          href=\"https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation\"\n          >Installation</a\n        >\n      </h2>\n    </li>\n    <li>\n      <h2>\n        <a target=\"_blank\" rel=\"noopener\" href=\"https://angular.io/docs\"\n          >Angular Documentation</a\n        >\n      </h2>\n    </li>\n  </ul>\n\n  <span class=\"mat-body-1\"\n    >*** Modules in <code>@igo2/core</code> must be imported only once</span\n  >\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { ExampleViewerComponent } from './example-viewer/example-viewer.component';\nimport { ExampleSeeCodeComponent } from './example-see-code/example-see-code.component';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\n@NgModule({\n  declarations: [ExampleViewerComponent, ExampleSeeCodeComponent],\n  exports: [ExampleViewerComponent],\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    MatCardModule,\n    MatDividerModule,\n    MatIconModule,\n    MatTooltipModule\n  ]\n})\nexport class ExampleModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { DocViewerComponent } from './doc-viewer.component';\nimport { MatCardModule } from '@angular/material/card';\n\n@NgModule({\n  declarations: [DocViewerComponent],\n  exports: [DocViewerComponent],\n  imports: [CommonModule, MatCardModule]\n})\nexport class DocViewerModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ExampleModule } from '../components/example/example.module';\nimport { DocViewerModule } from '../components/doc-viewer/doc-viewer.module';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatGridListModule } from '@angular/material/grid-list';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\n@NgModule({\n  declarations: [],\n  exports: [\n    CommonModule,\n    ExampleModule,\n    DocViewerModule,\n    MatCardModule,\n    MatButtonModule,\n    MatGridListModule,\n    MatIconModule,\n    MatInputModule,\n    MatTooltipModule\n  ],\n  imports: [CommonModule]\n})\nexport class SharedModule {}\n","import { NgModule } from '@angular/core';\n\nimport { AppHomeComponent } from './home.component';\nimport { AppHomeRoutingModule } from './home-routing.module';\nimport { IgoInteractiveTourModule } from '@igo2/common';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppHomeComponent],\n  imports: [AppHomeRoutingModule, IgoInteractiveTourModule, SharedModule],\n  exports: [AppHomeComponent]\n})\nexport class AppHomeModule {}\n","<mat-card appearance=\"outlined\">\n  <mat-card-header>\n    <mat-card-subtitle>\n      {{ title }}\n    </mat-card-subtitle>\n    <div class=\"actions\">\n      <a\n        *ngIf=\"codeFolder\"\n        mat-icon-button\n        [href]=\"codeUrl\"\n        target=\"_blank\"\n        matTooltip=\"View code example\"\n      >\n        <mat-icon svgIcon=\"code-tags\"></mat-icon>\n      </a>\n      <a\n        *ngIf=\"configFolder\"\n        mat-icon-button\n        [href]=\"configUrl\"\n        target=\"_blank\"\n        matTooltip=\"View config example\"\n      >\n        <mat-icon svgIcon=\"cog\"></mat-icon>\n      </a>\n    </div>\n  </mat-card-header>\n\n  <mat-divider class=\"m-b-16\"></mat-divider>\n\n  <mat-card-content class=\"mat-body-1\">\n    <ng-content></ng-content>\n  </mat-card-content>\n</mat-card>\n","import { Component, Input } from '@angular/core';\n\nconst SRC_PATH =\n  'https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src';\n\n@Component({\n  selector: 'app-example-viewer',\n  templateUrl: './example-viewer.component.html',\n  styleUrls: ['./example-viewer.component.scss']\n})\nexport class ExampleViewerComponent {\n  @Input() title: string;\n  @Input() codeFolder: string;\n  @Input() configFolder: string;\n\n  get codeUrl() {\n    return `${SRC_PATH}/app/${this.codeFolder}`;\n  }\n\n  get configUrl() {\n    return `${SRC_PATH}/${this.configFolder}`;\n  }\n}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppActivityComponent } from './activity.component';\n\nconst routes: Routes = [\n  {\n    path: 'activity',\n    component: AppActivityComponent\n  }\n];\n\nexport const AppActivityRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\n\nimport { ActivityService } from '@igo2/core';\n\n@Component({\n  selector: 'app-activity',\n  templateUrl: './activity.component.html',\n  styleUrls: ['./activity.component.scss']\n})\nexport class AppActivityComponent {\n  private idsActivity: string[] = [];\n\n  constructor(private activityService: ActivityService) {}\n\n  register() {\n    this.idsActivity.push(this.activityService.register());\n  }\n\n  unregister() {\n    this.activityService.unregister(this.idsActivity.pop());\n  }\n\n  get counter() {\n    return this.activityService.counter$.value;\n  }\n}\n","<app-doc-viewer title=\"Activity\" subtitle=\"Core\">\n  <p>Register activities in service. Use to display a loading icon</p>\n\n  <li>\n    Import <code>IgoActivityModule</code> only if you want register http calls\n  </li>\n  <li>Import <code>IgoActivityModule</code> only once</li>\n\n  <app-example-viewer codeFolder=\"core/activity\">\n    <div class=\"d-flex actions-container\">\n      <button mat-raised-button (click)=\"register()\">Register</button>\n      <button mat-raised-button (click)=\"unregister()\">Unregister</button>\n    </div>\n\n    <div class=\"mat-body-1 sub-content\">\n      <p>Counter: {{ counter }}</p>\n\n      <igo-spinner igoSpinnerActivity></igo-spinner>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoActivityModule } from '@igo2/core';\nimport { IgoSpinnerModule } from '@igo2/common';\n\nimport { AppActivityComponent } from './activity.component';\nimport { AppActivityRoutingModule } from './activity-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppActivityComponent],\n  imports: [\n    AppActivityRoutingModule,\n    SharedModule,\n    IgoActivityModule.forRoot(), // Only if you want register http calls\n    IgoSpinnerModule\n  ],\n  exports: [AppActivityComponent]\n})\nexport class AppActivityModule {}\n","interface Environment {\n  production: boolean;\n  igo: any;\n}\n\nexport const environment: Environment = {\n  production: true,\n  igo: {\n    projections: [\n      {\n        code: 'EPSG:32198',\n        alias: 'Quebec Lambert',\n        def: '+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs',\n        extent: [-886251.0296, 180252.9126, 897177.3418, 2106143.8139]\n      }\n    ],\n    auth: {\n      intern: {\n        enabled: true\n      },\n      allowAnonymous: true\n    },\n    interactiveTour: {\n      tourInMobile: true\n    },\n    importExport: {\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ogre'\n    },\n    language: {\n      prefix: './locale/'\n    },\n    catalog: {\n      sources: [\n        {\n          id: 'Gououvert',\n          title: 'Gouvouvert',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi'\n        },\n        {\n          id: 'DefiningInfoFormat',\n          title: 'Defining info_format',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          queryFormat: {\n            html: '*',\n            'application/json': [\n              'stations_meteoroutieres',\n              'histo_stations_meteoroutieres'\n            ]\n          },\n          queryHtmlTarget: 'iframe',\n          count: 30\n        },\n        {\n          id: 'catalogwithregex',\n          title: 'Filtered catalog by regex',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          regFilters: ['zpegt']\n        },\n        {\n          id: 'catalogwithtooltipcontrol',\n          title: 'Controling tooltip format',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          tooltipType: 'abstract' // or title\n        }\n      ]\n    },\n    searchSources: {\n      storedqueriesreverse: { enabled: false },\n      nominatim: {\n        enabled: false\n      },\n      icherche: {\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\n        order: 2,\n        enabled: true,\n        params: {\n          limit: '8'\n        },\n        showAdvancedSettings: true\n      },\n      coordinatesreverse: {\n        showInPointerSummary: true\n      },\n      icherchereverse: {\n        showInPointerSummary: true,\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\n        order: 3,\n        enabled: true\n      },\n      ilayer: {\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\n        order: 4,\n        enabled: true,\n        params: {\n          limit: '5'\n        }\n      }\n    }\n  }\n};\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppConfigComponent } from './config.component';\n\nconst routes: Routes = [\n  {\n    path: 'config',\n    component: AppConfigComponent\n  }\n];\n\nexport const AppConfigRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\nimport { ConfigService, LanguageOptions } from '@igo2/core';\n\n@Component({\n  selector: 'app-config',\n  templateUrl: './config.component.html',\n  styleUrls: ['./config.component.scss']\n})\nexport class AppConfigComponent {\n  public configLanguage: LanguageOptions;\n\n  constructor(private configService: ConfigService) {\n    this.configLanguage = this.configService.getConfig('language');\n  }\n}\n","<app-doc-viewer title=\"Config\" subtitle=\"Core\">\n  <p>Load config in your angular application</p>\n\n  <li>Import <code>IgoConfigModule</code> only once</li>\n\n  <app-example-viewer\n    title=\"Simple config\"\n    codeFolder=\"core/config\"\n    configFolder=\"environments\"\n  >\n    <p class=\"mat-body-1\">Config language: {{ configLanguage | json }}</p>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\nimport { IgoConfigModule, provideConfigOptions } from '@igo2/core';\n\nimport { environment } from '../../../environments/environment';\nimport { AppConfigComponent } from './config.component';\nimport { AppConfigRoutingModule } from './config-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppConfigComponent],\n  imports: [AppConfigRoutingModule, SharedModule, IgoConfigModule.forRoot()],\n  exports: [AppConfigComponent],\n  providers: [\n    provideConfigOptions({\n      default: environment.igo\n    })\n  ]\n})\nexport class AppConfigModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppLanguageComponent } from './language.component';\n\nconst routes: Routes = [\n  {\n    path: 'language',\n    component: AppLanguageComponent\n  }\n];\n\nexport const AppLanguageRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-language',\n  templateUrl: './language.component.html',\n  styleUrls: ['./language.component.scss']\n})\nexport class AppLanguageComponent {\n  public app = {\n    title: 'IGO'\n  };\n  constructor(private languageService: LanguageService) {}\n\n  changeLanguage(language: string) {\n    this.languageService.setLanguage(language);\n    console.log(this.languageService);\n  }\n}\n","<app-doc-viewer title=\"Language\" subtitle=\"Core\">\n  <p>Translate your angular application</p>\n\n  <li>Import <code>IgoLanguageModule</code> only once</li>\n  <li>\n    Configure the\n    <a\n      href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/locale\"\n      >locale files</a\n    >\n  </li>\n\n  <app-example-viewer codeFolder=\"core/language\">\n    <div class=\"d-flex actions-container\">\n      <button mat-raised-button (click)=\"changeLanguage('en')\">English</button>\n      <button mat-raised-button (click)=\"changeLanguage('fr')\">Français</button>\n    </div>\n\n    <div class=\"m-t-12\">\n      {{ 'welcome' | translate: app }}\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { AppLanguageComponent } from './language.component';\nimport { AppLanguageRoutingModule } from './language-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppLanguageComponent],\n  imports: [\n    AppLanguageRoutingModule,\n    SharedModule,\n    IgoLanguageModule.forRoot()\n  ],\n  exports: [AppLanguageComponent]\n})\nexport class AppLanguageModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppMediaComponent } from './media.component';\n\nconst routes: Routes = [\n  {\n    path: 'media',\n    component: AppMediaComponent\n  }\n];\n\nexport const AppMediaRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\n\nimport { MediaService } from '@igo2/core';\n\n@Component({\n  selector: 'app-media',\n  templateUrl: './media.component.html',\n  styleUrls: ['./media.component.scss']\n})\nexport class AppMediaComponent {\n  constructor(private mediaService: MediaService) {}\n\n  get media() {\n    return this.mediaService.getMedia();\n  }\n\n  get orientation() {\n    return this.mediaService.getOrientation();\n  }\n\n  get isTouchScreen() {\n    return this.mediaService.isTouchScreen();\n  }\n}\n","<app-doc-viewer title=\"Media\" subtitle=\"Core\">\n  <p>Detect type of media (mobile, tablet, desktop)</p>\n\n  <app-example-viewer codeFolder=\"core/media\">\n    <p>Current media: {{ media }}</p>\n    <p>Current orientation: {{ orientation }}</p>\n    <p>\n      Device mode:\n      {{ isTouchScreen ? 'Touch device' : 'Not a touch device ' }}\n    </p>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { AppMediaComponent } from './media.component';\nimport { AppMediaRoutingModule } from './media-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppMediaComponent],\n  imports: [AppMediaRoutingModule, SharedModule],\n  exports: [AppMediaComponent]\n})\nexport class AppMediaModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppMessageComponent } from './message.component';\n\nconst routes: Routes = [\n  {\n    path: 'message',\n    component: AppMessageComponent\n  }\n];\n\nexport const AppMessageRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\n\nimport { MessageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-message',\n  templateUrl: './message.component.html',\n  styleUrls: ['./message.component.scss']\n})\nexport class AppMessageComponent {\n  constructor(private messageService: MessageService) {}\n\n  success() {\n    this.messageService.success('Congratulations', 'Success');\n  }\n\n  info() {\n    this.messageService.info('Welcome to IGO', 'Info');\n  }\n\n  alert() {\n    this.messageService.alert('Warning', 'Alert');\n  }\n  error() {\n    this.messageService.error('There is a bug', 'Error');\n  }\n}\n","<app-doc-viewer title=\"Message\" subtitle=\"Core\">\n  <p>Show message to user.</p>\n\n  <li>Import <code>IgoMessageModule</code> only once</li>\n  <li>Dependencies: BrowserAnimationsModule</li>\n\n  <app-example-viewer codeFolder=\"core/message\">\n    <div class=\"d-flex m-t-16 actions-container\">\n      <button mat-raised-button (click)=\"success()\">Success message</button>\n      <button mat-raised-button color=\"primary\" (click)=\"info()\">\n        Info message\n      </button>\n      <button mat-raised-button color=\"accent\" (click)=\"alert()\">\n        Alert message\n      </button>\n      <button mat-raised-button color=\"warn\" (click)=\"error()\">\n        Error message\n      </button>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoMessageModule } from '@igo2/core';\n\nimport { AppMessageComponent } from './message.component';\nimport { AppMessageRoutingModule } from './message-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppMessageComponent],\n  imports: [AppMessageRoutingModule, SharedModule, IgoMessageModule.forRoot()],\n  exports: [AppMessageComponent]\n})\nexport class AppMessageModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppRequestComponent } from './request.component';\n\nconst routes: Routes = [\n  {\n    path: 'request',\n    component: AppRequestComponent\n  }\n];\n\nexport const AppRequestRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-request',\n  templateUrl: './request.component.html',\n  styleUrls: ['./request.component.scss']\n})\nexport class AppRequestComponent {\n  constructor(\n    private http: HttpClient,\n    public languageService: LanguageService\n  ) {}\n\n  callHttp() {\n    const url = 'https://geoegl.msp.gouv.qc.ca/apis/icherche/info';\n    this.http.get(url).subscribe((rep) => {\n      console.log(rep);\n    });\n  }\n\n  callHttpError() {\n    const url = '404';\n    this.http.get(url).subscribe((rep) => {\n      console.log(rep);\n    });\n  }\n}\n","<app-doc-viewer title=\"Request\" subtitle=\"Core\">\n  <p>Register http calls in console</p>\n\n  <li>\n    Import <code>IgoLoggingModule</code> only if you want register http calls in\n    console\n  </li>\n  <li>\n    Import <code>IgoErrorModule</code> only if you want register errors from\n    http call in console\n  </li>\n  <li>Import modules only once</li>\n\n  <app-example-viewer codeFolder=\"core/core\">\n    <div class=\"actions-container\">\n      <button mat-raised-button (click)=\"callHttp()\">Log</button>\n      <button mat-raised-button (click)=\"callHttpError()\">Error</button>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\nimport { HttpClientModule } from '@angular/common/http';\n\nimport { IgoErrorModule, IgoLanguageModule } from '@igo2/core';\n\nimport { AppRequestComponent } from './request.component';\nimport { AppRequestRoutingModule } from './request-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppRequestComponent],\n  imports: [\n    AppRequestRoutingModule,\n    SharedModule,\n    HttpClientModule,\n    IgoLanguageModule.forRoot(),\n    IgoErrorModule.forRoot() // Only if you want register errors from http call in console\n    // IgoLoggingModule.forRoot() // Only if you want register http calls in console\n  ],\n  exports: [AppRequestComponent]\n})\nexport class AppRequestModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppActionComponent } from './action.component';\n\nconst routes: Routes = [\n  {\n    path: 'action',\n    component: AppActionComponent\n  }\n];\n\nexport const AppActionRoutingModule = RouterModule.forChild(routes);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport {\n  Media,\n  MediaOrientation,\n  MediaService,\n  LanguageService\n} from '@igo2/core';\nimport { ActionStore, ActionbarMode } from '@igo2/common';\nimport { Overlay } from '@angular/cdk/overlay';\n\n@Component({\n  selector: 'app-action',\n  templateUrl: './action.component.html',\n  styleUrls: ['./action.component.scss']\n})\nexport class AppActionComponent implements OnInit, OnDestroy {\n  public store = new ActionStore([]);\n\n  private added$ = new BehaviorSubject(false);\n\n  get actionbarMode(): ActionbarMode {\n    const media = this.mediaService.media$.value;\n    const orientation = this.mediaService.orientation$.value;\n    if (media === Media.Desktop && orientation === MediaOrientation.Landscape) {\n      return ActionbarMode.Dock;\n    }\n    return ActionbarMode.Overlay;\n  }\n\n  constructor(\n    public overlay: Overlay,\n    private mediaService: MediaService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    this.store.load([\n      {\n        id: 'add',\n        title: 'Add',\n        icon: 'plus',\n        tooltip: 'Add Tooltip',\n        handler: () => {\n          alert('Add!');\n          this.added$.next(true);\n        }\n      },\n      {\n        id: 'edit',\n        title: 'Edit',\n        icon: 'pencil',\n        tooltip: 'Edit Tooltip',\n        args: ['1'],\n        handler: (item: string) => {\n          alert(`Edit item ${item}!`);\n        },\n        availability: () => this.added$\n      },\n      {\n        id: 'delete',\n        title: 'Delete',\n        tooltip: 'Delete Tooltip',\n        icon: 'delete',\n        handler: () => {\n          alert('Delete!');\n          this.added$.next(false);\n        },\n        availability: () => this.added$\n      }\n    ]);\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n}\n","<app-doc-viewer title=\"Action\" subtitle=\"Common\">\n  <app-example-viewer title=\"Action Bar\" codeFolder=\"common/action\">\n    <igo-actionbar\n      [store]=\"store\"\n      [withIcon]=\"true\"\n      [withTitle]=\"actionbarMode === 'overlay'\"\n      [horizontal]=\"true\"\n      [mode]=\"actionbarMode\"\n    >\n    </igo-actionbar>\n  </app-example-viewer>\n\n  <!-- <app-example-viewer title=\"Action context-menu\" codeFolder=\"common/action\">\n    <mat-card [igoContextMenu]=\"actionbarMenu\">\n      <mat-card-header>\n        <mat-card-subtitle>Common</mat-card-subtitle>\n        <mat-card-title>Action context-menu</mat-card-title>\n      </mat-card-header>\n      <div></div>\n    </mat-card>\n\n    <ng-template #actionbarMenu>\n      <igo-actionbar\n        [store]=\"store\"\n        [withIcon]=\"true\"\n        [horizontal]=\"true\"\n        [mode]=\"'context'\"\n      >\n      </igo-actionbar>\n    </ng-template>\n  </app-example-viewer> -->\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoActionModule, IgoContextMenuModule } from '@igo2/common';\n\nimport { AppActionComponent } from './action.component';\nimport { AppActionRoutingModule } from './action-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppActionComponent],\n  imports: [\n    SharedModule,\n    AppActionRoutingModule,\n    IgoActionModule,\n    IgoContextMenuModule\n  ],\n  exports: [AppActionComponent]\n})\nexport class AppActionModule {}\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { OnUpdateInputs } from '@igo2/common';\n\n@Component({\n  selector: 'app-salutation-component',\n  template: '<p>Hello, my name is {{name}}.</p>',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSalutationComponent implements OnUpdateInputs {\n  @Input() name: string;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n}\n\n@Component({\n  selector: 'app-explanation-component',\n  template:\n    '<p>I am a dynamic component, rendered into an IgoDynamicOutlet.</p>',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppExplanationComponent implements OnUpdateInputs {\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n}\n\n@Component({\n  selector: 'app-dynamic-component',\n  templateUrl: './dynamic-component.component.html',\n  styleUrls: ['./dynamic-component.component.scss']\n})\nexport class AppDynamicComponentComponent {\n  component: any = AppSalutationComponent;\n\n  inputs = { name: 'Bob' };\n\n  toggleComponent() {\n    this.component =\n      this.component === AppSalutationComponent\n        ? AppExplanationComponent\n        : AppSalutationComponent;\n  }\n}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppDynamicComponentComponent } from './dynamic-component.component';\n\nconst routes: Routes = [\n  {\n    path: 'dynamic-component',\n    component: AppDynamicComponentComponent\n  }\n];\n\nexport const AppDynamicComponentRoutingModule = RouterModule.forChild(routes);\n","<app-doc-viewer title=\"Dynamic Component\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/dynamic-component\">\n    <igo-dynamic-outlet [component]=\"component\" [inputs]=\"inputs\">\n    </igo-dynamic-outlet>\n\n    <button mat-flat-button color=\"primary\" (click)=\"toggleComponent()\">\n      Toggle Component\n    </button>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoDynamicComponentModule } from '@igo2/common';\n\nimport {\n  AppSalutationComponent,\n  AppExplanationComponent,\n  AppDynamicComponentComponent\n} from './dynamic-component.component';\nimport { AppDynamicComponentRoutingModule } from './dynamic-component-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [\n    AppSalutationComponent,\n    AppDynamicComponentComponent,\n    AppExplanationComponent\n  ],\n  imports: [\n    SharedModule,\n    AppDynamicComponentRoutingModule,\n    IgoDynamicComponentModule\n  ],\n  exports: [AppDynamicComponentComponent]\n})\nexport class AppDynamicComponentModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppEntityTableComponent } from './entity-table.component';\n\nconst routes: Routes = [\n  {\n    path: 'entity-table',\n    component: AppEntityTableComponent\n  }\n];\n\nexport const AppEntityTableRoutingModule = RouterModule.forChild(routes);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  EntityStore,\n  EntityTableButton,\n  getEntityProperty,\n  EntityTableColumnRenderer,\n  EntityTablePaginatorOptions\n} from '@igo2/common';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'app-entity-table',\n  templateUrl: './entity-table.component.html',\n  styleUrls: ['./entity-table.component.scss']\n})\nexport class AppEntityTableComponent implements OnInit, OnDestroy {\n  public store = new EntityStore([]);\n  public paginator: MatPaginator;\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public paginatorOptions: EntityTablePaginatorOptions = { pageSize: 10 };\n\n  public template = {\n    selection: true,\n    selectionCheckbox: true,\n    selectMany: true,\n    sort: true,\n    valueAccessor: (entity: object, name: string) => {\n      return getEntityProperty(entity, name);\n    },\n    columns: [\n      {\n        name: 'selected',\n        title: 'Selected',\n        valueAccessor: (entity: object) => {\n          return this.store.state.get(entity).selected\n            ? 'radiobox-marked'\n            : 'radiobox-blank';\n        },\n        renderer: EntityTableColumnRenderer.Icon\n      },\n      {\n        name: 'id',\n        title: 'ID'\n      },\n      {\n        name: 'name',\n        title: 'Name'\n      },\n      {\n        name: 'description',\n        title: 'Description',\n        renderer: EntityTableColumnRenderer.HTML\n      },\n      {\n        name: 'url',\n        title: 'Hyperlink'\n      },\n      {\n        name: 'image',\n        title: 'Image'\n      },\n      {\n        name: 'action',\n        title: '',\n        valueAccessor: (entity: object) => {\n          return [\n            {\n              icon: 'home',\n              color: 'warn',\n              click: (row) => {\n                console.log(row);\n              }\n            }\n          ] as EntityTableButton[];\n        },\n        renderer: EntityTableColumnRenderer.ButtonGroup\n      }\n    ]\n  };\n\n  constructor(private languageService: LanguageService) {}\n\n  ngOnInit() {\n    const ids = [2, 1, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13];\n\n    const entities = ids.map((id) => {\n      if (id === 3) {\n        return {\n          id,\n          name: `Name ${id}`,\n          description: `<b>Description ${id}</b>`,\n          url: 'https://igouverte.org',\n          image: 'https://www.igouverte.org/assets/img/NONEXISTINGIMAGE.png'\n        };\n      }\n      return {\n        id,\n        name: `Name ${id}`,\n        description: `<b>Description ${id}</b>`,\n        url: 'https://igouverte.org',\n        image: 'https://www.igouverte.org/assets/img/Igo_logoavec.png'\n      };\n    });\n    this.store.load(entities);\n  }\n\n  entitySortChange() {\n    this.entitySortChange$.next(true);\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.paginator = event;\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n}\n","<app-doc-viewer title=\"Entity Table\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/entity-table\">\n    <igo-entity-table\n      [store]=\"store\"\n      [withPaginator]=\"true\"\n      [paginatorOptions]=\"paginatorOptions\"\n      [template]=\"template\"\n      (entitySortChange)=\"entitySortChange()\"\n    >\n    </igo-entity-table>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport {\n  IgoEntityTableModule,\n  IgoEntityTablePaginatorModule\n} from '@igo2/common';\n\nimport { AppEntityTableComponent } from './entity-table.component';\nimport { AppEntityTableRoutingModule } from './entity-table-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppEntityTableComponent],\n  imports: [\n    AppEntityTableRoutingModule,\n    SharedModule,\n    IgoEntityTableModule,\n    IgoEntityTablePaginatorModule\n  ],\n  exports: [AppEntityTableComponent]\n})\nexport class AppEntityTableModule {}\n","<app-doc-viewer title=\"Entity Selector\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/entity-selector\">\n    <igo-entity-selector\n      [store]=\"store\"\n      [titleAccessor]=\"getTitle\"\n      [emptyText]=\"''\"\n      [placeholder]=\"'Select an entity'\"\n      (selectedChange)=\"onSelectedChange($event)\"\n    >\n    </igo-entity-selector>\n\n    <div *ngIf=\"selected$ | async as selected\">\n      <p>ID: {{ selected.id }}</p>\n      <p>Name: {{ selected.name }}</p>\n      <p>Description: <span [innerHtml]=\"selected.description\"></span></p>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppEntitySelectorComponent } from './entity-selector.component';\n\nconst routes: Routes = [\n  {\n    path: 'entity-selector',\n    component: AppEntitySelectorComponent\n  }\n];\n\nexport const AppEntitySelectorRoutingModule = RouterModule.forChild(routes);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport { EntityStore } from '@igo2/common';\n\ninterface DemoEntity {\n  id: string;\n  name: string;\n  description: string;\n}\n\n@Component({\n  selector: 'app-entity-selector',\n  templateUrl: './entity-selector.component.html',\n  styleUrls: ['./entity-selector.component.scss']\n})\nexport class AppEntitySelectorComponent implements OnInit, OnDestroy {\n  public store = new EntityStore([]);\n\n  public selected$ = new BehaviorSubject<DemoEntity>(undefined);\n\n  constructor(private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.store.load([\n      { id: '2', name: 'Name 2', description: '<b>Description 2</b>' },\n      { id: '1', name: 'Name 1', description: '<b>Description 1</b>' },\n      { id: '3', name: 'Name 3', description: '<b>Description 3</b>' }\n    ]);\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  getTitle(entity: DemoEntity): string {\n    return entity.name;\n  }\n\n  onSelectedChange(event: { selected: boolean; entity: DemoEntity }) {\n    this.selected$.next(event.entity);\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { IgoEntitySelectorModule } from '@igo2/common';\n\nimport { AppEntitySelectorComponent } from './entity-selector.component';\nimport { AppEntitySelectorRoutingModule } from './entity-selector-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppEntitySelectorComponent],\n  imports: [\n    SharedModule,\n    AppEntitySelectorRoutingModule,\n    IgoEntitySelectorModule\n  ],\n  exports: [AppEntitySelectorComponent]\n})\nexport class AppEntitySelectorModule {}\n","<app-doc-viewer title=\"Form\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/form\">\n    <igo-form\n      *ngIf=\"form$ | async as form\"\n      [form]=\"form\"\n      [formData]=\"data$ | async\"\n      (submitForm)=\"onSubmit($event)\"\n    >\n      <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n      <div formButtons class=\"actions-container\">\n        <button\n          mat-stroked-button\n          type=\"button\"\n          color=\"primary\"\n          (click)=\"fillForm()\"\n        >\n          Fill Form\n        </button>\n        <button\n          mat-stroked-button\n          type=\"button\"\n          color=\"primary\"\n          (click)=\"clearForm()\"\n        >\n          Clear Form\n        </button>\n        <button\n          mat-flat-button\n          type=\"submit\"\n          color=\"primary\"\n          [disabled]=\"submitDisabled\"\n        >\n          Submit\n        </button>\n      </div>\n    </igo-form>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppFormComponent } from './form.component';\n\nconst routes: Routes = [\n  {\n    path: 'form',\n    component: AppFormComponent\n  }\n];\n\nexport const AppFormRoutingModule = RouterModule.forChild(routes);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport { Form, FormService } from '@igo2/common';\n\n@Component({\n  selector: 'app-form',\n  templateUrl: './form.component.html',\n  styleUrls: ['./form.component.scss']\n})\nexport class AppFormComponent implements OnInit, OnDestroy {\n  form$ = new BehaviorSubject<Form>(undefined);\n\n  data$ = new BehaviorSubject<{ [key: string]: any }>(undefined);\n\n  submitDisabled = true;\n\n  private valueChanges$$: Subscription;\n\n  constructor(\n    private formService: FormService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    const fieldConfigs = [\n      {\n        name: 'id',\n        title: 'ID',\n        options: {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        options: {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'status',\n        title: 'Status',\n        type: 'select',\n        options: {\n          cols: 2\n        },\n        inputs: {\n          choices: [\n            { value: 1, title: 'Single' },\n            { value: 2, title: 'Married' }\n          ]\n        }\n      }\n    ];\n\n    const fields = fieldConfigs.map((config) => this.formService.field(config));\n    const form = this.formService.form(\n      [],\n      [this.formService.group({ name: 'info' }, fields)]\n    );\n\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\n      this.submitDisabled = !form.control.valid;\n    });\n\n    this.form$.next(form);\n  }\n\n  ngOnDestroy() {\n    this.valueChanges$$.unsubscribe();\n  }\n\n  fillForm() {\n    this.data$.next({\n      id: 1,\n      name: 'Bob',\n      status: 2\n    });\n  }\n\n  clearForm() {\n    this.form$.value.control.reset();\n  }\n\n  onSubmit(data: { [key: string]: any }) {\n    alert(JSON.stringify(data));\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { IgoFormModule } from '@igo2/common';\n\nimport { AppFormComponent } from './form.component';\nimport { AppFormRoutingModule } from './form-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppFormComponent],\n  imports: [SharedModule, AppFormRoutingModule, IgoFormModule],\n  exports: [AppFormComponent]\n})\nexport class AppFormModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppTableComponent } from './table.component';\n\nconst routes: Routes = [\n  {\n    path: 'table',\n    component: AppTableComponent\n  }\n];\n\nexport const AppTableRoutingModule = RouterModule.forChild(routes);\n","import { Component, OnInit } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { TableDatabase, TableActionColor } from '@igo2/common';\n\n@Component({\n  selector: 'app-table',\n  templateUrl: './table.component.html',\n  styleUrls: ['./table.component.scss']\n})\nexport class AppTableComponent implements OnInit {\n  public database: TableDatabase;\n\n  public model = {\n    columns: [\n      {\n        name: 'id',\n        title: 'ID',\n        sortable: false,\n        filterable: true\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        sortable: true,\n        filterable: true\n      },\n      {\n        name: 'description',\n        title: 'Description',\n        sortable: true,\n        filterable: true\n      }\n    ],\n    actions: [\n      {\n        icon: 'file-document',\n        color: TableActionColor.primary,\n        click: (row) => this.showName(row.name)\n      }\n    ],\n    selectionCheckbox: true\n  };\n\n  constructor(private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.database = new TableDatabase([\n      { id: '2', name: 'Name 2', description: 'Hello 2' },\n      { id: '1', name: 'Name 1', description: 'Bonjour 1' },\n      { id: '3', name: 'Name 3', description: 'Hola 3' }\n    ]);\n  }\n\n  showName(name) {\n    alert(name);\n  }\n\n  handleSelect(rows) {\n    console.log(rows);\n  }\n}\n","<app-doc-viewer title=\"Table\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/table\">\n    <igo-table\n      [database]=\"database\"\n      [model]=\"model\"\n      [hasFilterInput]=\"true\"\n      (select)=\"handleSelect($event)\"\n    >\n    </igo-table>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoTableModule } from '@igo2/common';\n\nimport { AppTableComponent } from './table.component';\nimport { AppTableRoutingModule } from './table-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppTableComponent],\n  imports: [SharedModule, AppTableRoutingModule, IgoTableModule],\n  exports: [AppTableComponent]\n})\nexport class AppTableModule {}\n","<div\n  *ngIf=\"withHeader\"\n  class=\"igo-panel-header\"\n  title=\"\"\n  [ngClass]=\"{ 'igo-cursor-pointer': cursorPointer === true }\"\n>\n  <div class=\"panel-left\">\n    <ng-content select=\"[panelLeftButton]\"></ng-content>\n  </div>\n  <h3 class=\"igo-panel-title\">\n    {{ title }}\n    <ng-content select=\"[panelHeader]\"></ng-content>\n  </h3>\n  <div class=\"panel-right\">\n    <ng-content select=\"[panelRightButton]\"></ng-content>\n  </div>\n</div>\n<div class=\"igo-panel-content\" title=\"\">\n  <ng-content></ng-content>\n</div>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  HostBinding\n} from '@angular/core';\n\n@Component({\n  selector: 'igo-panel',\n  templateUrl: './panel.component.html',\n  styleUrls: ['./panel.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PanelComponent {\n  @Input() title: string;\n\n  @Input()\n  @HostBinding('class.igo-panel-with-header')\n  get withHeader(): boolean {\n    return this._withHeader;\n  }\n  set withHeader(value: boolean) {\n    this._withHeader = value;\n  }\n  private _withHeader = true;\n\n  @Input() cursorPointer: boolean = false;\n}\n","<app-doc-viewer title=\"Tool\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/tool\">\n    <igo-panel [title]=\"panelTitle\">\n      <button\n        mat-icon-button\n        panelLeftButton\n        (click)=\"toolbox.activatePreviousTool()\"\n        *ngIf=\"activeTool$ | async\"\n      >\n        <mat-icon svgIcon=\"arrow-back\"></mat-icon>\n      </button>\n\n      <button\n        mat-icon-button\n        panelRightButton\n        (click)=\"toolbox.deactivateTool()\"\n        *ngIf=\"activeTool$ | async\"\n      >\n        <mat-icon svgIcon=\"menu\"></mat-icon>\n      </button>\n\n      <igo-toolbox\n        [toolbox]=\"toolbox\"\n        [animate]=\"true\"\n        color=\"primary\"\n      ></igo-toolbox>\n    </igo-panel>\n\n    <button\n      mat-flat-button\n      type=\"button\"\n      color=\"primary\"\n      (click)=\"activateSalutationTool()\"\n    >\n      Activate Salutation Tool\n    </button>\n  </app-example-viewer>\n</app-doc-viewer>\n","import {\n  Component,\n  OnInit,\n  OnDestroy,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  OnUpdateInputs,\n  Tool,\n  Toolbox,\n  ToolComponent,\n  ToolService\n} from '@igo2/common';\n\n@ToolComponent({\n  name: 'demo-salutation',\n  title: 'Salutation',\n  icon: 'account',\n  options: { name: 'Jack' }\n})\n@Component({\n  selector: 'app-salutation-tool',\n  template: ` <p>Hello, my name is {{ name }}.</p> `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSalutationToolComponent implements OnUpdateInputs {\n  @Input() name: string;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n}\n\n@ToolComponent({\n  name: 'demo-about',\n  title: 'About',\n  icon: 'information'\n})\n@Component({\n  selector: 'app-about-tool',\n  template: ` <p>I'm a tool inside a toolbox.</p> `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppAboutToolComponent {}\n\n@Component({\n  selector: 'app-tool',\n  templateUrl: './tool.component.html',\n  styleUrls: ['./tool.component.scss']\n})\nexport class AppToolComponent implements OnInit, OnDestroy {\n  toolbox = new Toolbox();\n\n  get activeTool$(): BehaviorSubject<Tool> {\n    return this.toolbox.activeTool$;\n  }\n\n  get panelTitle(): string {\n    return this.activeTool$.value ? this.activeTool$.value.title : 'Toolbox';\n  }\n\n  constructor(\n    private toolService: ToolService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    this.toolbox.setToolbar(['demo-salutation', 'demo-about']);\n    this.toolbox.setTools(this.toolService.getTools());\n  }\n\n  ngOnDestroy() {\n    this.toolbox.destroy();\n  }\n\n  activateSalutationTool() {\n    this.toolbox.activateTool('demo-salutation', { name: 'Bob' });\n  }\n}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppToolComponent } from './tool.component';\n\nconst routes: Routes = [\n  {\n    path: 'tool',\n    component: AppToolComponent\n  }\n];\n\nexport const AppToolRoutingModule = RouterModule.forChild(routes);\n","import { NgModule } from '@angular/core';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoPanelModule, IgoToolModule } from '@igo2/common';\n\nimport {\n  AppToolComponent,\n  AppSalutationToolComponent,\n  AppAboutToolComponent\n} from './tool.component';\nimport { AppToolRoutingModule } from './tool-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [\n    AppToolComponent,\n    AppSalutationToolComponent,\n    AppAboutToolComponent\n  ],\n  imports: [\n    SharedModule,\n    AppToolRoutingModule,\n    IgoLanguageModule,\n    IgoPanelModule,\n    IgoToolModule.forRoot()\n  ],\n  exports: [AppToolComponent]\n})\nexport class AppToolModule {}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport {\n  DynamicComponent,\n  OnUpdateInputs,\n  WidgetComponent,\n  WidgetService\n} from '@igo2/common';\n\n@Component({\n  selector: 'app-salutation-widget',\n  template: `\n    <p>Hello, my name is {{ name }}.</p>\n    <button mat-flat-button (click)=\"complete.emit(name)\">\n      Nice to meet you\n    </button>\n    <button mat-flat-button (click)=\"cancel.emit(name)\">Dismiss</button>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSalutationWidgetComponent\n  implements OnUpdateInputs, WidgetComponent\n{\n  @Input() name: string;\n\n  @Output() complete = new EventEmitter<string>();\n\n  @Output() cancel = new EventEmitter<string>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n}\n\n@Component({\n  selector: 'app-widget',\n  templateUrl: './widget.component.html',\n  styleUrls: ['./widget.component.scss']\n})\nexport class AppWidgetComponent {\n  widget: DynamicComponent<WidgetComponent>;\n\n  inputs = { name: 'Bob' };\n\n  constructor(private widgetService: WidgetService) {\n    this.widget = this.widgetService.create(AppSalutationWidgetComponent);\n  }\n\n  onWidgetComplete(name: string) {\n    alert(`${name} emitted event 'complete' then got automatically destroyed.`);\n  }\n\n  onWidgetCancel() {\n    alert(`Widget emitted event 'cancel' then got automatically destroyed.`);\n  }\n}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppWidgetComponent } from './widget.component';\n\nconst routes: Routes = [\n  {\n    path: 'widget',\n    component: AppWidgetComponent\n  }\n];\n\nexport const AppWidgetRoutingModule = RouterModule.forChild(routes);\n","<app-doc-viewer title=\"Widget\" subtitle=\"Common\">\n  <app-example-viewer codeFolder=\"common/widget\">\n    <igo-widget-outlet\n      [widget]=\"widget\"\n      [inputs]=\"inputs\"\n      (complete)=\"onWidgetComplete($event)\"\n      (cancel)=\"onWidgetCancel()\"\n    >\n    </igo-widget-outlet>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoWidgetModule } from '@igo2/common';\n\nimport {\n  AppSalutationWidgetComponent,\n  AppWidgetComponent\n} from './widget.component';\nimport { AppWidgetRoutingModule } from './widget-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppSalutationWidgetComponent, AppWidgetComponent],\n  imports: [\n    SharedModule,\n    AppWidgetRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoWidgetModule\n  ],\n  exports: [AppWidgetComponent]\n})\nexport class AppWidgetModule {}\n","import { Injectable, Injector } from '@angular/core';\nimport jwtDecode from 'jwt-decode';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthOptions } from './auth.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TokenService {\n  private options?: AuthOptions;\n  private tokenKey: string;\n\n  constructor(private injector: Injector) {\n    const config = this.injector.get<ConfigService>(ConfigService);\n    this.options = config.getConfig('auth');\n    this.tokenKey = this.options?.tokenKey;\n  }\n\n  set(token: string) {\n    localStorage.setItem(this.tokenKey, token);\n  }\n\n  remove() {\n    localStorage.removeItem(this.tokenKey);\n  }\n\n  get(): string {\n    return localStorage.getItem(this.tokenKey);\n  }\n\n  decode() {\n    const token = this.get();\n    if (!token) {\n      return;\n    }\n    return jwtDecode(token);\n  }\n\n  isExpired() {\n    const jwt = this.decode();\n    const currentTime = new Date().getTime() / 1000;\n    if (jwt && currentTime < jwt.exp) {\n      return false;\n    }\n    return true;\n  }\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Router } from '@angular/router';\n\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport { tap, catchError } from 'rxjs/operators';\nimport { globalCacheBusterNotifier } from 'ts-cacheable';\n\nimport { ConfigService, LanguageService, MessageService } from '@igo2/core';\nimport { Base64 } from '@igo2/utils';\n\nimport { User, IInfosUser } from './auth.interface';\nimport { TokenService } from './token.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  public authenticate$ = new BehaviorSubject<boolean>(undefined);\n  public logged$ = new BehaviorSubject<boolean>(undefined);\n  public redirectUrl: string;\n  public languageForce = false;\n  private anonymous = false;\n\n  get hasAuthService() {\n    return this.config.getConfig('auth.url') !== undefined;\n  }\n\n  constructor(\n    private http: HttpClient,\n    private tokenService: TokenService,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    @Optional() private router: Router\n  ) {\n    this.authenticate$.next(this.authenticated);\n    this.authenticate$.subscribe((authenticated) => {\n      this.logged$.next(authenticated);\n      globalCacheBusterNotifier.next();\n    });\n  }\n\n  login(username: string, password: string): Observable<void> {\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\n\n    const body = {\n      username,\n      password: this.encodePassword(password)\n    };\n\n    return this.loginCall(body, myHeader);\n  }\n\n  loginWithToken(\n    token: string,\n    type: string,\n    infosUser?: IInfosUser\n  ): Observable<void> {\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\n\n    const body = {\n      token,\n      typeConnection: type,\n      infosUser\n    };\n\n    return this.loginCall(body, myHeader);\n  }\n\n  loginAnonymous(): Observable<boolean> {\n    this.anonymous = true;\n    this.logged$.next(true);\n    return of(true);\n  }\n\n  refresh(): Observable<void> {\n    const url = this.config.getConfig('auth.url');\n    return this.http.post(`${url}/refresh`, {}).pipe(\n      tap((data: any) => {\n        this.tokenService.set(data.token);\n      }),\n      catchError((err) => {\n        err.error.caught = true;\n        throw err;\n      })\n    );\n  }\n\n  logout(): Observable<boolean> {\n    this.anonymous = false;\n    this.tokenService.remove();\n    this.authenticate$.next(false);\n    return of(true);\n  }\n\n  isAuthenticated(): boolean {\n    return !this.tokenService.isExpired();\n  }\n\n  getToken(): string {\n    return this.tokenService.get();\n  }\n\n  decodeToken() {\n    if (this.isAuthenticated()) {\n      return this.tokenService.decode();\n    }\n    return false;\n  }\n\n  goToRedirectUrl() {\n    if (!this.router) {\n      return;\n    }\n    const redirectUrl = this.redirectUrl || this.router.url;\n\n    const options = this.config.getConfig('auth') || {};\n    if (redirectUrl === options.loginRoute) {\n      const homeRoute = options.homeRoute || '/';\n      this.router.navigateByUrl(homeRoute);\n    } else if (redirectUrl) {\n      this.router.navigateByUrl(redirectUrl);\n    }\n  }\n\n  getUserInfo(): Observable<User> {\n    const url = this.config.getConfig('auth.url') + '/info';\n    return this.http.get<User>(url);\n  }\n\n  getProfils(): Observable<{ profils: string[] }> {\n    const url = this.config.getConfig('auth.url');\n    return this.http.get<{ profils: string[] }>(`${url}/profils`);\n  }\n\n  updateUser(user: User): Observable<User> {\n    const url = this.config.getConfig('auth.url');\n    return this.http.patch<User>(url, user);\n  }\n\n  private encodePassword(password: string) {\n    return Base64.encode(password);\n  }\n\n  // authenticated or anonymous\n  get logged(): boolean {\n    return this.authenticated || this.isAnonymous;\n  }\n\n  get isAnonymous(): boolean {\n    return this.anonymous;\n  }\n\n  get authenticated(): boolean {\n    return this.isAuthenticated();\n  }\n\n  get isAdmin(): boolean {\n    const token = this.decodeToken();\n    if (token && token.user && token.user.isAdmin) {\n      return true;\n    }\n    return false;\n  }\n\n  private loginCall(body, headers) {\n    const url = this.config.getConfig('auth.url');\n    return this.http.post(`${url}/login`, body, { headers }).pipe(\n      tap((data: any) => {\n        this.tokenService.set(data.token);\n        const tokenDecoded = this.decodeToken();\n        if (tokenDecoded && tokenDecoded.user) {\n          if (tokenDecoded.user.locale && !this.languageForce) {\n            this.languageService.setLanguage(tokenDecoded.user.locale);\n          }\n          if (tokenDecoded.user.isExpired) {\n            this.messageService.alert('igo.auth.error.Password expired');\n          }\n        }\n        this.authenticate$.next(true);\n      }),\n      catchError((err) => {\n        err.error.caught = true;\n        throw err;\n      })\n    );\n  }\n}\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter\n} from '@angular/core';\n\nimport { ConfigService, LanguageService } from '@igo2/core';\nimport { AuthGoogleOptions } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\n\n@Component({\n  selector: 'igo-auth-google',\n  templateUrl: './auth-google.component.html',\n  styleUrls: ['./auth-google.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthGoogleComponent {\n  private options?: AuthGoogleOptions;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private appRef: ApplicationRef\n  ) {\n    this.options = this.config.getConfig('auth.google');\n\n    if (this.options?.apiKey && this.options?.clientId) {\n      this.loadSDKGoogle();\n      this.loadPlatform();\n    } else {\n      console.warn(\n        'Google authentification needs \"apiKey\" and \"clientId\" options'\n      );\n    }\n  }\n\n  public handleSignInClick() {\n    (window as any).gapi.auth2.getAuthInstance().signIn();\n  }\n\n  public handleSignOutClick() {\n    (window as any).gapi.auth2.getAuthInstance().signOut();\n  }\n\n  private handleClientLoad() {\n    (window as any).gapi.load('client:auth2', () => this.initClient());\n  }\n\n  private initClient() {\n    (window as any).gapi.client\n      .init({\n        apiKey: this.options?.apiKey,\n        clientId: this.options?.clientId,\n        discoveryDocs: [\n          'https://people.googleapis.com/$discovery/rest?version=v1'\n        ],\n        scope: 'profile'\n      })\n      .then(() => {\n        this.handleSignOutClick();\n        this.updateTextButton();\n        (window as any).gapi.auth2\n          .getAuthInstance()\n          .isSignedIn.listen((rep) => {\n            this.updateSigninStatus(rep);\n          });\n      });\n  }\n\n  private updateSigninStatus(isSignedIn) {\n    this.updateTextButton();\n    if (isSignedIn) {\n      this.loginGoogle((window as any).gapi.client.getToken().access_token);\n    }\n  }\n\n  private updateTextButton() {\n    const btn = document.querySelector('span[id^=\"not_signed_\"]');\n    if (btn && this.languageService.getLanguage() !== 'en') {\n      if (btn.innerHTML === 'Sign in with Google') {\n        btn.innerHTML = this.languageService.translate.instant(\n          'igo.auth.google.login'\n        );\n      } else if (btn.innerHTML === 'Signed in with Google') {\n        btn.innerHTML = this.languageService.translate.instant(\n          'igo.auth.google.logged'\n        );\n      }\n    }\n  }\n\n  private loginGoogle(token) {\n    this.authService.loginWithToken(token, 'google').subscribe(() => {\n      this.appRef.tick();\n      this.login.emit(true);\n    });\n  }\n\n  private loadSDKGoogle() {\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'google-jssdk';\n    js.src = 'https://apis.google.com/js/api.js';\n    js.onload = () => {\n      this.handleClientLoad();\n    };\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n\n  private loadPlatform() {\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'google-platform';\n    js.src = 'https://apis.google.com/js/platform.js';\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n}\n","<div\n  class=\"g-signin2 google-login-button\"\n  data-height=\"40\"\n  data-width=\"265\"\n  data-longtitle=\"true\"\n></div>\n","<form [formGroup]=\"form\" role=\"form\" (ngSubmit)=\"loginUser(form.value)\">\n  <div>\n    <mat-form-field class=\"full-width\">\n      <mat-label>{{ 'igo.auth.user' | translate }}</mat-label>\n      <input\n        matInput\n        required\n        placeholder=\"{{ 'igo.auth.user' | translate }}\"\n        formControlName=\"username\"\n      />\n    </mat-form-field>\n  </div>\n\n  <div>\n    <mat-form-field class=\"full-width\">\n      <mat-label>{{ 'igo.auth.password' | translate }}</mat-label>\n      <input\n        matInput\n        required\n        type=\"password\"\n        placeholder=\"{{ 'igo.auth.password' | translate }}\"\n        formControlName=\"password\"\n      />\n    </mat-form-field>\n  </div>\n\n  <button mat-raised-button type=\"submit\">\n    {{ 'igo.auth.login' | translate }}\n  </button>\n  <button\n    *ngIf=\"allowAnonymous\"\n    mat-raised-button\n    class=\"anonymous\"\n    type=\"button\"\n    [disabled]=\"loading\"\n    (click)=\"loginAnonymous()\"\n  >\n    {{ 'igo.auth.accessAnonymous' | translate }}\n  </button>\n  <div *ngIf=\"error\">\n    <br />\n    <font size=\"3\" color=\"red\">{{ error }}</font>\n  </div>\n</form>\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  Input,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport {\n  Validators,\n  UntypedFormGroup,\n  UntypedFormBuilder\n} from '@angular/forms';\n\nimport { AuthService } from '../shared/auth.service';\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'igo-auth-intern',\n  templateUrl: './auth-intern.component.html',\n  styleUrls: ['./auth-intern.component.scss'],\n  changeDetection: ChangeDetectionStrategy.Default\n})\nexport class AuthInternComponent {\n  @Input()\n  get allowAnonymous(): boolean {\n    return this._allowAnonymous;\n  }\n  set allowAnonymous(value: boolean) {\n    this._allowAnonymous = value;\n  }\n  private _allowAnonymous = true;\n\n  public error = '';\n  public form: UntypedFormGroup;\n  public loading = false;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    public auth: AuthService,\n    private languageService: LanguageService,\n    fb: UntypedFormBuilder\n  ) {\n    this.form = fb.group({\n      username: ['', Validators.required],\n      password: ['', Validators.required]\n    });\n  }\n\n  loginUser(values: any) {\n    this.loading = true;\n    this.auth.login(values.username, values.password).subscribe(\n      () => {\n        this.login.emit(true);\n        this.loading = false;\n      },\n      (error: any) => {\n        try {\n          this.languageService.translate\n            .get('igo.auth.error.' + error.error.message)\n            .subscribe((errorMsg) => (this.error = errorMsg));\n        } catch (e) {\n          this.error = error.error.message;\n        }\n        this.loading = false;\n      }\n    );\n    return false;\n  }\n\n  loginAnonymous() {\n    this.auth.loginAnonymous().subscribe(() => {\n      this.login.emit(true);\n    });\n  }\n}\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter\n} from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthFacebookOptions } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\n\n@Component({\n  selector: 'igo-auth-facebook',\n  templateUrl: './auth-facebook.component.html',\n  styleUrls: ['./auth-facebook.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthFacebookComponent {\n  private options?: AuthFacebookOptions;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef\n  ) {\n    this.options = this.config.getConfig('auth.facebook');\n\n    if (this.options?.appId) {\n      this.loadSDKFacebook();\n    } else {\n      console.warn('Facebook authentification needs \"appId\" option');\n    }\n  }\n\n  private subscribeEvents() {\n    (window as any).FB.Event.subscribe('auth.statusChange', (rep) => {\n      this.statusChangeCallback(rep);\n    });\n  }\n\n  private statusChangeCallback(response) {\n    if (response.status === 'connected') {\n      const accessToken = response.authResponse.accessToken;\n      this.loginFacebook(accessToken);\n    }\n  }\n\n  private loginFacebook(token) {\n    this.authService.loginWithToken(token, 'facebook').subscribe(() => {\n      this.appRef.tick();\n      this.login.emit(true);\n    });\n  }\n\n  private loadSDKFacebook() {\n    if (document.getElementById('facebook-jssdk')) {\n      return;\n    }\n\n    const urlSDK =\n      'https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9';\n\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'facebook-jssdk';\n    js.src = `${urlSDK}&appId=${this.options?.appId}`;\n    js.onload = () => {\n      this.subscribeEvents();\n    };\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n}\n","<div\n  scope=\"public_profile,email\"\n  class=\"fb-login-button\"\n  data-max-rows=\"1\"\n  data-size=\"large\"\n  data-button-type=\"login_with\"\n  data-show-faces=\"false\"\n  data-auto-logout-link=\"false\"\n  data-use-continue-as=\"false\"\n></div>\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter,\n  Inject\n} from '@angular/core';\nimport {\n  MsalBroadcastService,\n  MsalService,\n  MSAL_GUARD_CONFIG\n} from '@azure/msal-angular';\nimport {\n  InteractionStatus,\n  AuthenticationResult,\n  PublicClientApplication,\n  PopupRequest,\n  SilentRequest,\n  InteractionRequiredAuthError\n} from '@azure/msal-browser';\nimport { ConfigService } from '@igo2/core';\nimport {\n  AuthMicrosoftOptions,\n  MSPMsalGuardConfiguration\n} from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\nimport { filter, takeUntil } from 'rxjs/operators';\nimport { Subject } from 'rxjs';\n\n@Component({\n  selector: 'igo-auth-microsoft',\n  templateUrl: './auth-microsoft.component.html',\n  styleUrls: ['./auth-microsoft.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthMicrosoftComponent {\n  private options?: AuthMicrosoftOptions;\n  private readonly _destroying$ = new Subject<void>();\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n  private broadcastService: MsalBroadcastService;\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef,\n    private msalService: MsalService,\n    @Inject(MSAL_GUARD_CONFIG)\n    private msalGuardConfig: MSPMsalGuardConfiguration[]\n  ) {\n    this.options = this.config.getConfig('auth.microsoft');\n\n    this.msalService.instance = new PublicClientApplication({\n      auth: this.options,\n      cache: {\n        cacheLocation: 'sessionStorage'\n      }\n    });\n\n    this.broadcastService = new MsalBroadcastService(\n      this.msalService.instance,\n      this.msalService\n    );\n\n    if (this.options?.clientId) {\n      this.broadcastService.inProgress$\n        .pipe(\n          filter(\n            (status: InteractionStatus) => status === InteractionStatus.None\n          ),\n          takeUntil(this._destroying$)\n        )\n        .subscribe(() => {\n          this.checkAccount();\n        });\n    } else {\n      console.warn('Microsoft authentification needs \"clientId\" option');\n    }\n  }\n\n  public loginMicrosoft() {\n    this.msalService\n      .loginPopup({ ...this.getConf().authRequest } as PopupRequest)\n      .subscribe((response: AuthenticationResult) => {\n        this.msalService.instance.setActiveAccount(response.account);\n        this.checkAccount();\n      });\n  }\n\n  private checkAccount() {\n    this.msalService.instance\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\n      .then((response: AuthenticationResult) => {\n        const tokenAccess = response.accessToken;\n        const tokenId = response.idToken;\n        this.authService\n          .loginWithToken(tokenAccess, 'microsoft', { tokenId })\n          .subscribe(() => {\n            this.appRef.tick();\n            this.login.emit(true);\n          });\n      })\n      .catch(async (error) => {\n        if (error instanceof InteractionRequiredAuthError) {\n          // fallback to interaction when silent call fails\n          return this.msalService.acquireTokenPopup(\n            this.getConf().authRequest as SilentRequest\n          );\n        }\n        console.log(error);\n      })\n      .catch((error) => {\n        console.log('Silent token fails');\n      });\n  }\n\n  private getConf(): MSPMsalGuardConfiguration {\n    return this.msalGuardConfig.filter((conf) => conf.type === 'add')[0];\n  }\n}\n","<button\n  class=\"microsoft-login-button\"\n  mat-raised-button\n  (click)=\"loginMicrosoft()\"\n>\n  <mat-icon svgIcon=\"microsoft\"></mat-icon>\n  {{ 'igo.auth.microsoft.login' | translate }}\n</button>\n","/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { Inject, Injectable } from '@angular/core';\nimport { Location } from '@angular/common';\nimport {\n  IPublicClientApplication,\n  EndSessionRequest,\n  EndSessionPopupRequest,\n  AuthenticationResult,\n  RedirectRequest,\n  SilentRequest,\n  PopupRequest,\n  SsoSilentRequest,\n  Logger,\n  WrapperSKU\n} from '@azure/msal-browser';\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\nimport { Observable, from } from 'rxjs';\nimport { IMsalService } from '@azure/msal-angular';\n\n@Injectable()\nexport class MsalServiceb2c implements IMsalService {\n  private redirectHash: string;\n  private logger: Logger;\n  private name = '@azure/msal-angular';\n  private version = '2.0.0-beta.2';\n  constructor(\n    @Inject(MSAL_INSTANCE) public instance: IPublicClientApplication,\n    private location: Location\n  ) {\n    const hash = this.location.path(true).split('#').pop();\n    if (hash) {\n      this.redirectHash = `#${hash}`;\n    }\n    this.instance.initializeWrapperLibrary(WrapperSKU.Angular, this.version);\n  }\n\n  initialize(): Observable<void> {\n    return from(this.instance.initialize());\n  }\n\n  acquireTokenPopup(request: PopupRequest): Observable<AuthenticationResult> {\n    return from(this.instance.acquireTokenPopup(request));\n  }\n  acquireTokenRedirect(request: RedirectRequest): Observable<void> {\n    return from(this.instance.acquireTokenRedirect(request));\n  }\n  acquireTokenSilent(\n    silentRequest: SilentRequest\n  ): Observable<AuthenticationResult> {\n    return from(this.instance.acquireTokenSilent(silentRequest));\n  }\n  handleRedirectObservable(hash?: string): Observable<AuthenticationResult> {\n    return from(this.instance.handleRedirectPromise(hash || this.redirectHash));\n  }\n  loginPopup(request?: PopupRequest): Observable<AuthenticationResult> {\n    return from(this.instance.loginPopup(request));\n  }\n  loginRedirect(request?: RedirectRequest): Observable<void> {\n    return from(this.instance.loginRedirect(request));\n  }\n  logout(logoutRequest?: EndSessionRequest): Observable<void> {\n    return from(this.instance.logout(logoutRequest));\n  }\n  logoutRedirect(logoutRequest?: EndSessionRequest): Observable<void> {\n    return from(this.instance.logoutRedirect(logoutRequest));\n  }\n  logoutPopup(logoutRequest?: EndSessionPopupRequest): Observable<void> {\n    return from(this.instance.logoutPopup(logoutRequest));\n  }\n  ssoSilent(request: SsoSilentRequest): Observable<AuthenticationResult> {\n    return from(this.instance.ssoSilent(request));\n  }\n  /**\n   * Gets logger for msal-angular.\n   * If no logger set, returns logger instance created with same options as msal-browser\n   */\n  getLogger(): Logger {\n    if (!this.logger) {\n      this.logger = this.instance.getLogger().clone(this.name, this.version);\n    }\n    return this.logger;\n  }\n  // Create a logger instance for msal-angular with the same options as msal-browser\n  setLogger(logger: Logger): void {\n    this.logger = logger.clone(this.name, this.version);\n    this.instance.setLogger(logger);\n  }\n}\n","/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { Inject, Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\nimport {\n  EventMessage,\n  EventMessageUtils,\n  IPublicClientApplication,\n  InteractionStatus\n} from '@azure/msal-browser';\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service.';\n\n@Injectable()\nexport class MsalBroadcastServiceb2c {\n  private _msalSubject: Subject<EventMessage>;\n  public msalSubject$: Observable<EventMessage>;\n  private _inProgress: BehaviorSubject<InteractionStatus>;\n  public inProgress$: Observable<InteractionStatus>;\n\n  constructor(\n    @Inject(MSAL_INSTANCE) private msalInstance: IPublicClientApplication,\n    private authService: MsalServiceb2c\n  ) {\n    this._msalSubject = new Subject<EventMessage>();\n    this.msalSubject$ = this._msalSubject.asObservable();\n\n    // InProgress as BehaviorSubject so most recent inProgress state will be available upon subscription\n    this._inProgress = new BehaviorSubject<InteractionStatus>(\n      InteractionStatus.Startup\n    );\n    this.inProgress$ = this._inProgress.asObservable();\n\n    this.msalInstance.addEventCallback((message: EventMessage) => {\n      this._msalSubject.next(message);\n      const status = EventMessageUtils.getInteractionStatusFromEvent(message);\n      if (status !== null) {\n        this.authService\n          .getLogger()\n          .verbose(\n            `BroadcastService - ${message.eventType} results in setting inProgress to ${status}`\n          );\n        this._inProgress.next(status);\n      }\n    });\n  }\n}\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter,\n  Inject\n} from '@angular/core';\n\nimport { MSAL_GUARD_CONFIG } from '@azure/msal-angular';\nimport {\n  InteractionStatus,\n  AuthenticationResult,\n  PublicClientApplication,\n  PopupRequest,\n  SilentRequest,\n  InteractionRequiredAuthError\n} from '@azure/msal-browser';\nimport { ConfigService } from '@igo2/core';\nimport {\n  AuthMicrosoftb2cOptions,\n  MSPMsalGuardConfiguration\n} from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\nimport { filter, takeUntil } from 'rxjs/operators';\nimport { Subject } from 'rxjs';\nimport { MsalBroadcastServiceb2c } from '../shared/auth-msalBroadcastServiceb2c.service';\nimport { MsalServiceb2c } from '../shared/auth-msalServiceb2c.service.';\n\n@Component({\n  selector: 'igo-auth-microsoftb2c',\n  templateUrl: './auth-microsoftb2c.component.html',\n  styleUrls: ['./auth-microsoftb2c.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthMicrosoftb2cComponent {\n  private options: AuthMicrosoftb2cOptions;\n  private readonly _destroying$ = new Subject<void>();\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n  private broadcastService: MsalBroadcastServiceb2c;\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef,\n    private msalService: MsalServiceb2c,\n    @Inject(MSAL_GUARD_CONFIG)\n    private msalGuardConfig: MSPMsalGuardConfiguration[]\n  ) {\n    this.options = this.config.getConfig('auth.microsoftb2c') || {};\n\n    this.msalService.instance = new PublicClientApplication({\n      auth: this.options.browserAuthOptions,\n      cache: {\n        cacheLocation: 'sessionStorage'\n      }\n    });\n\n    this.broadcastService = new MsalBroadcastServiceb2c(\n      this.msalService.instance,\n      this.msalService\n    );\n\n    if (this.options.browserAuthOptions.clientId) {\n      this.broadcastService.inProgress$\n        .pipe(\n          filter(\n            (status: InteractionStatus) => status === InteractionStatus.None\n          ),\n          takeUntil(this._destroying$)\n        )\n        .subscribe(() => {\n          this.checkAccount();\n        });\n    } else {\n      console.warn('Microsoft authentification needs \"clientId\" option');\n    }\n  }\n\n  public loginMicrosoftb2c() {\n    this.msalService\n      .loginPopup({ ...this.getConf().authRequest } as PopupRequest)\n      .subscribe((response: AuthenticationResult) => {\n        this.msalService.instance.setActiveAccount(response.account);\n        this.checkAccount();\n      });\n  }\n\n  private checkAccount() {\n    this.msalService.instance\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\n      .then((response: AuthenticationResult) => {\n        const token = response.idToken;\n        this.authService.loginWithToken(token, 'microsoftb2c').subscribe(() => {\n          this.appRef.tick();\n          this.login.emit(true);\n        });\n      })\n      .catch(async (error) => {\n        if (error instanceof InteractionRequiredAuthError) {\n          // fallback to interaction when silent call fails\n          return this.msalService.acquireTokenPopup(\n            this.getConf().authRequest as SilentRequest\n          );\n        }\n      })\n      .catch((error) => {\n        console.log('Silent token fails');\n      });\n  }\n\n  private getConf(): MSPMsalGuardConfiguration {\n    return this.msalGuardConfig.filter((conf) => conf.type === 'b2c')[0];\n  }\n}\n","<button\n  class=\"microsoft-login-button\"\n  mat-raised-button\n  (click)=\"loginMicrosoftb2c()\"\n>\n  <mat-icon svgIcon=\"microsoft\"></mat-icon>\n  {{ 'igo.auth.microsoftb2c.login' | translate }}\n</button>\n","<div *ngIf=\"visible\">\n  <div\n    *ngIf=\"!auth.logged && backgroundDisable\"\n    class=\"backgroundDisable\"\n  ></div>\n\n  <div *ngIf=\"!auth.logged && showLoginDiv\" class=\"login center-block\">\n    <h1>{{ 'igo.auth.connection' | translate }}</h1>\n\n    <igo-auth-google\n      *ngIf=\"options.google && options.google.enabled !== false\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-google>\n    <igo-auth-microsoft\n      *ngIf=\"options.microsoft && options.microsoft.enabled !== false\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-microsoft>\n    <igo-auth-microsoftb2c\n      *ngIf=\"options.microsoftb2c && options.microsoftb2c.enabled !== false\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-microsoftb2c>\n    <igo-auth-facebook\n      *ngIf=\"options.facebook && options.facebook.enabled !== false\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-facebook>\n    <igo-auth-intern\n      *ngIf=\"!options.intern || options.intern.enabled !== false\"\n      [allowAnonymous]=\"options.allowAnonymous\"\n      (login)=\"onLogin()\"\n    >\n    </igo-auth-intern>\n  </div>\n\n  <div\n    *ngIf=\"auth.logged && showAlreadyConnectedDiv\"\n    class=\"login center-block\"\n  >\n    <p>{{ 'igo.auth.welcome' | translate: user }}</p>\n    <button mat-raised-button type=\"button\" (click)=\"logout()\">\n      {{ 'igo.auth.signOut' | translate }}\n    </button>\n  </div>\n\n  <div *ngIf=\"showLogoutDiv\" class=\"login center-block\">\n    <p>{{ 'igo.auth.deconnection' | translate }}</p>\n    <button\n      *ngIf=\"options.homeRoute\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"home()\"\n    >\n      {{ 'igo.auth.home' | translate }}\n    </button>\n  </div>\n</div>\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  OnInit,\n  Input,\n  Optional,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Router, NavigationStart } from '@angular/router';\nimport { filter } from 'rxjs/operators';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthOptions } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\n\n@Component({\n  selector: 'igo-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.Default\n})\nexport class AuthFormComponent implements OnInit {\n  @Input()\n  get backgroundDisable(): boolean {\n    if (this.isLogoutRoute || this.isLogoutRoute) {\n      return false;\n    }\n    return this._backgroundDisable;\n  }\n  set backgroundDisable(value: boolean) {\n    this._backgroundDisable = value.toString() === 'true';\n  }\n  private _backgroundDisable = true;\n\n  @Input()\n  get hasAlreadyConnectedDiv(): boolean {\n    return this._hasAlreadyConnectedDiv;\n  }\n  set hasAlreadyConnectedDiv(value: boolean) {\n    this._hasAlreadyConnectedDiv = value.toString() === 'true';\n  }\n  private _hasAlreadyConnectedDiv = true;\n\n  @Input()\n  get hasLogoutDiv(): boolean {\n    return this._hasLogoutDiv;\n  }\n  set hasLogoutDiv(value: boolean) {\n    this._hasLogoutDiv = value.toString() === 'true';\n  }\n  private _hasLogoutDiv = true;\n\n  @Input()\n  get showAlreadyConnectedDiv(): boolean {\n    if (this.isLogoutRoute) {\n      return this.hasAlreadyConnectedDiv;\n    }\n    return this._showAlreadyConnectedDiv;\n  }\n  set showAlreadyConnectedDiv(value: boolean) {\n    this._showAlreadyConnectedDiv = value.toString() === 'true';\n  }\n  private _showAlreadyConnectedDiv = false;\n\n  @Input()\n  get showLogoutDiv(): boolean {\n    if (this.isLogoutRoute) {\n      return this.hasLogoutDiv;\n    }\n    return this._showLogoutDiv;\n  }\n  set showLogoutDiv(value: boolean) {\n    this._showLogoutDiv = value.toString() === 'true';\n  }\n  private _showLogoutDiv = false;\n\n  get showLoginDiv(): boolean {\n    if (!this.isLogoutRoute) {\n      return true;\n    }\n  }\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  public options?: AuthOptions;\n  public user;\n\n  public visible = true;\n\n  private isLoginRoute: boolean;\n  private isLogoutRoute: boolean;\n\n  constructor(\n    public auth: AuthService,\n    private config: ConfigService,\n    @Optional() private router: Router\n  ) {\n    this.options = this.config.getConfig('auth');\n    this.visible = Object.getOwnPropertyNames(this.options).length !== 0;\n  }\n\n  public ngOnInit() {\n    this.analyzeRoute();\n    this.getName();\n  }\n\n  public onLogin() {\n    this.auth.goToRedirectUrl();\n    this.getName();\n    this.login.emit(true);\n  }\n\n  public logout() {\n    this.auth.logout().subscribe(() => {\n      this.user = undefined;\n      if (this.router) {\n        if (this.options?.logoutRoute) {\n          this.router.navigate([this.options?.logoutRoute]);\n        } else if (this.options?.homeRoute) {\n          this.router.navigate([this.options?.homeRoute]);\n        }\n      }\n    });\n  }\n\n  public home() {\n    if (this.router && this.options?.homeRoute) {\n      this.router.navigate([this.options?.homeRoute]);\n    }\n  }\n\n  private getName() {\n    const tokenDecoded = this.auth.decodeToken();\n    if (tokenDecoded) {\n      this.user = {\n        name: tokenDecoded.user.firstName || tokenDecoded.user.sourceId\n      };\n    }\n  }\n\n  private analyzeRoute() {\n    if (!this.router) {\n      return;\n    }\n\n    this.router.events\n      .pipe(filter((event) => event instanceof NavigationStart))\n      .subscribe((changeEvent: any) => {\n        if (changeEvent.url) {\n          const currentRoute = changeEvent.url;\n          const logoutRoute = this.options?.logoutRoute;\n          const loginRoute = this.options?.loginRoute;\n\n          this.isLogoutRoute = currentRoute === logoutRoute;\n          this.isLoginRoute = currentRoute === loginRoute;\n\n          if (this.isLogoutRoute) {\n            this.auth.logout();\n          }\n        }\n      });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport {\n  HttpEvent,\n  HttpInterceptor,\n  HttpHandler,\n  HttpRequest\n} from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { Md5 } from 'ts-md5';\n\nimport { ConfigService } from '@igo2/core';\nimport { TokenService } from './token.service';\nimport { AuthByKeyOptions, WithCredentialsOptions } from './auth.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthInterceptor implements HttpInterceptor {\n  private refreshInProgress = false;\n  private trustHosts: string[];\n  private hostsWithCredentials: WithCredentialsOptions[];\n  private hostsWithAuthByKey: AuthByKeyOptions[];\n\n  constructor(\n    private config: ConfigService,\n    private tokenService: TokenService,\n    private http: HttpClient\n  ) {\n    this.trustHosts = this.config.getConfig('auth.trustHosts') || [];\n    this.trustHosts.push(window.location.hostname);\n\n    this.hostsWithCredentials =\n      this.config.getConfig('auth.hostsWithCredentials') || [];\n    this.hostsWithAuthByKey = this.config.getConfig('auth.hostsByKey') || [];\n  }\n\n  intercept(\n    originalReq: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const withCredentials = this.handleHostsWithCredentials(originalReq.url);\n    let req = originalReq.clone();\n    const hostWithKey = this.handleHostsAuthByKey(originalReq.url);\n    if (hostWithKey) {\n      req = req.clone({\n        params: req.params.set(hostWithKey.key, hostWithKey.value)\n      });\n    }\n    if (withCredentials) {\n      req = originalReq.clone({\n        withCredentials\n      });\n      return next.handle(req);\n    }\n    this.refreshToken();\n    const token = this.tokenService.get();\n    const element = document.createElement('a');\n    element.href = req.url;\n    if (element.host === '') {\n      element.href = element.href; // FIX IE11, DO NOT REMOVE\n    }\n\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\n      return next.handle(req);\n    }\n\n    const authHeader = `Bearer ${token}`;\n    let authReq = req.clone({\n      headers: req.headers.set('Authorization', authHeader)\n    });\n\n    const tokenDecoded: any = this.tokenService.decode();\n    if (\n      authReq.params.get('_i') === 'true' &&\n      tokenDecoded &&\n      tokenDecoded.user &&\n      tokenDecoded.user.sourceId\n    ) {\n      const hashUser = Md5.hashStr(tokenDecoded.user.sourceId) as string;\n      authReq = authReq.clone({\n        params: authReq.params.set('_i', hashUser)\n      });\n    } else if (authReq.params.get('_i') === 'true') {\n      authReq = authReq.clone({\n        params: authReq.params.delete('_i')\n      });\n    }\n\n    return next.handle(authReq);\n  }\n\n  interceptXhr(xhr, url: string): boolean {\n    const withCredentials = this.handleHostsWithCredentials(url);\n    if (withCredentials) {\n      xhr.withCredentials = withCredentials;\n      return true;\n    }\n\n    this.refreshToken();\n    const element = document.createElement('a');\n    element.href = url;\n\n    const token = this.tokenService.get();\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\n      return false;\n    }\n    xhr.setRequestHeader('Authorization', 'Bearer ' + token);\n    return true;\n  }\n\n  alterUrlWithKeyAuth(url: string): string {\n    const hostWithKey = this.handleHostsAuthByKey(url);\n    let interceptedUrl = url;\n    if (hostWithKey) {\n      const urlDecomposed = interceptedUrl.split(/[?&]/);\n      let urlWithKeyAdded = urlDecomposed.shift();\n      const paramsToKeep = urlDecomposed.filter((p) => p.length !== 0);\n      paramsToKeep.push(`${hostWithKey.key}=${hostWithKey.value}`);\n      if (paramsToKeep.length) {\n        urlWithKeyAdded += '?' + paramsToKeep.join('&');\n      }\n      return urlWithKeyAdded;\n    }\n    return;\n  }\n\n  private handleHostsWithCredentials(reqUrl: string) {\n    let withCredentials = false;\n    for (const hostWithCredentials of this.hostsWithCredentials) {\n      const domainRegex = new RegExp(hostWithCredentials.domainRegFilters);\n      if (domainRegex.test(reqUrl)) {\n        withCredentials =\n          hostWithCredentials.withCredentials !== undefined\n            ? hostWithCredentials.withCredentials\n            : undefined;\n        break;\n      }\n    }\n    return withCredentials;\n  }\n\n  private handleHostsAuthByKey(reqUrl: string): { key: string; value: string } {\n    let hostWithKey;\n    for (const hostWithAuthByKey of this.hostsWithAuthByKey) {\n      const domainRegex = new RegExp(hostWithAuthByKey.domainRegFilters);\n      if (domainRegex.test(reqUrl)) {\n        var replace = `${hostWithAuthByKey.keyProperty}=${hostWithAuthByKey.keyValue}`;\n        var keyAdded = new RegExp(replace, 'gm');\n        if (!keyAdded.test(reqUrl)) {\n          hostWithKey = {\n            key: hostWithAuthByKey.keyProperty,\n            value: hostWithAuthByKey.keyValue\n          };\n          break;\n        }\n      }\n    }\n    return hostWithKey;\n  }\n\n  refreshToken() {\n    const jwt = this.tokenService.decode();\n    const currentTime = new Date().getTime() / 1000;\n\n    if (\n      !this.refreshInProgress &&\n      jwt &&\n      currentTime < jwt.exp &&\n      currentTime > jwt.exp - 1800\n    ) {\n      this.refreshInProgress = true;\n\n      const url = this.config.getConfig('auth.url');\n      return this.http.post(`${url}/refresh`, {}).subscribe(\n        (data: any) => {\n          this.tokenService.set(data.token);\n          this.refreshInProgress = false;\n        },\n        (err) => {\n          err.error.caught = true;\n          return err;\n        }\n      );\n    }\n  }\n}\n","import {\n  MSAL_GUARD_CONFIG,\n  MSAL_INSTANCE,\n  MsalService\n} from '@azure/msal-angular';\n\nimport { PublicClientApplication, InteractionType } from '@azure/msal-browser';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { BrowserAuthOptions } from '@azure/msal-browser';\n\nimport {\n  AuthMicrosoftOptions,\n  MSPMsalGuardConfiguration\n} from './auth.interface';\n\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service.';\n\nexport function MSALConfigFactory(\n  config: ConfigService\n): PublicClientApplication {\n  const msConf: BrowserAuthOptions | null = config.getConfig('auth.microsoft');\n\n  msConf.redirectUri = msConf?.redirectUri || window.location.href;\n  msConf.authority =\n    msConf?.authority || 'https://login.microsoftonline.com/organizations';\n\n  const myMsalObj = new PublicClientApplication({\n    auth: msConf,\n    cache: {\n      cacheLocation: 'sessionStorage'\n    }\n  });\n\n  return myMsalObj;\n}\n\nexport function MSALConfigFactoryb2c(\n  config: ConfigService\n): PublicClientApplication {\n  const msConf: BrowserAuthOptions | null = config.getConfig(\n    'auth.microsoftb2c.browserAuthOptions'\n  );\n  msConf.redirectUri = msConf?.redirectUri || window.location.href;\n  msConf.authority =\n    msConf?.authority || 'https://login.microsoftonline.com/organizations';\n\n  const myMsalObj = new PublicClientApplication({\n    auth: msConf,\n    cache: {\n      cacheLocation: 'sessionStorage'\n    }\n  });\n\n  return myMsalObj;\n}\n\nexport function MSALAngularConfigFactory(\n  config: ConfigService\n): MSPMsalGuardConfiguration {\n  const msConf: AuthMicrosoftOptions = config.getConfig('auth.microsoft');\n\n  return {\n    interactionType: InteractionType.Popup,\n    authRequest: {\n      scopes: ['user.read'],\n      loginHint: 'todo'\n    },\n    type: 'add'\n  };\n}\n\nexport function MSALAngularConfigFactoryb2c(\n  config: ConfigService\n): MSPMsalGuardConfiguration {\n  const msConf: BrowserAuthOptions | null = config.getConfig(\n    'auth.microsoftb2c.browserAuthOptions'\n  );\n\n  return {\n    interactionType: InteractionType.Popup,\n    authRequest: {\n      scopes: [msConf?.clientId]\n    },\n    type: 'b2c'\n  };\n}\n\nexport function provideAuthMicrosoft(type?: string) {\n  if (type === 'b2c') {\n    return [\n      {\n        provide: MSAL_INSTANCE,\n        useFactory: MSALConfigFactoryb2c,\n        deps: [ConfigService]\n      },\n      {\n        provide: MSAL_GUARD_CONFIG,\n        useFactory: MSALAngularConfigFactoryb2c,\n        deps: [ConfigService],\n        multi: true\n      },\n      MsalServiceb2c\n    ];\n  } else {\n    return [\n      {\n        provide: MSAL_INSTANCE,\n        useFactory: MSALConfigFactory,\n        deps: [ConfigService]\n      },\n      {\n        provide: MSAL_GUARD_CONFIG,\n        useFactory: MSALAngularConfigFactory,\n        deps: [ConfigService],\n        multi: true\n      },\n      MsalService\n    ];\n  }\n}\n","import { Directive, ElementRef } from '@angular/core';\nimport { AuthService } from './auth.service';\n\n@Directive({\n  selector: '[igoProtected]'\n})\nexport class ProtectedDirective {\n  constructor(authentication: AuthService, el: ElementRef) {\n    if (!authentication.isAuthenticated()) {\n      el.nativeElement.parentNode.removeChild(el.nativeElement);\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { StorageScope, ConfigService, BaseStorage } from '@igo2/core';\nimport { AuthService } from './auth.service';\nimport { TokenService } from './token.service';\nimport { AuthStorageOptions } from './storage.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthStorageService extends BaseStorage<AuthStorageOptions> {\n  constructor(\n    config: ConfigService,\n    private http: HttpClient,\n    private authService: AuthService,\n    private tokenService: TokenService\n  ) {\n    super(config);\n\n    this.authService.authenticate$.subscribe((isAuthenticated) => {\n      if (isAuthenticated && this.options.url) {\n        this.http\n          .get(this.options.url)\n          .subscribe((userIgo: { preference: object }) => {\n            if (userIgo && userIgo.preference) {\n              for (const key of Object.keys(userIgo.preference)) {\n                const value = userIgo.preference[key];\n                super.set(key, value);\n              }\n            }\n          });\n      }\n    });\n  }\n\n  set(\n    key: string,\n    value: string | object | boolean | number,\n    scope: StorageScope = StorageScope.LOCAL\n  ) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      const preference = {};\n      preference[key] = value;\n      this.http.patch(this.options.url, { preference }).subscribe();\n    }\n    super.set(key, value, scope);\n  }\n\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      const preference = {};\n      preference[key] = undefined;\n      this.http.patch(this.options.url, { preference }).subscribe();\n    }\n    super.remove(key, scope);\n  }\n\n  clear(scope: StorageScope = StorageScope.LOCAL) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      this.http\n        .patch(\n          this.options.url,\n          { preference: {} },\n          {\n            params: {\n              mergePreference: 'false'\n            }\n          }\n        )\n        .subscribe();\n    }\n\n    let token: string;\n    if (scope === StorageScope.LOCAL) {\n      token = this.tokenService.get();\n    }\n\n    super.clear(scope);\n\n    if (token) {\n      this.tokenService.set(token);\n    }\n\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      this.http\n        .get(this.options.url)\n        .subscribe((userIgo: { preference: object }) => {\n          if (userIgo && userIgo.preference) {\n            for (const key of Object.keys(userIgo.preference)) {\n              const value = userIgo.preference[key];\n              super.set(key, value);\n            }\n          }\n        });\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MsalModule } from '@azure/msal-angular';\n\nimport { StorageService, IgoLanguageModule } from '@igo2/core';\n\nimport { AuthStorageService } from './shared/storage.service';\nimport { ProtectedDirective } from './shared/protected.directive';\nimport { AuthInterceptor } from './shared/auth.interceptor';\nimport { provideAuthMicrosoft } from './shared/auth-microsoft.provider';\n\nimport { AuthInternComponent } from './auth-form/auth-intern.component';\nimport { AuthFormComponent } from './auth-form/auth-form.component';\nimport { AuthGoogleComponent } from './auth-form/auth-google.component';\nimport { AuthFacebookComponent } from './auth-form/auth-facebook.component';\nimport { AuthMicrosoftComponent } from './auth-form/auth-microsoft.component';\nimport { AuthMicrosoftb2cComponent } from './auth-form/auth-microsoftb2c.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatIconModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    MsalModule\n  ],\n  declarations: [\n    AuthFormComponent,\n    AuthGoogleComponent,\n    AuthInternComponent,\n    AuthFacebookComponent,\n    AuthMicrosoftComponent,\n    AuthMicrosoftb2cComponent,\n    ProtectedDirective\n  ],\n  exports: [AuthFormComponent, ProtectedDirective]\n})\nexport class IgoAuthModule {\n  static forRoot(): ModuleWithProviders<IgoAuthModule> {\n    return {\n      ngModule: IgoAuthModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: AuthInterceptor,\n          multi: true\n        },\n        {\n          provide: StorageService,\n          useClass: AuthStorageService\n        },\n        ...provideAuthMicrosoft('add'),\n        ...provideAuthMicrosoft('b2c')\n      ]\n    };\n  }\n}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppAuthFormComponent } from './auth-form.component';\n\nconst routes: Routes = [\n  {\n    path: 'auth-form',\n    component: AppAuthFormComponent\n  }\n];\n\nexport const AppAuthFormRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss']\n})\nexport class AppAuthFormComponent {\n  private idsActivity: string[] = [];\n\n  constructor(private languageService: LanguageService) {}\n}\n","<app-doc-viewer\n  title=\"Authentification\"\n  subtitle=\"Auth\"\n  [dependencies]=\"['ConfigService', 'LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"auth/auth-form\" configFolder=\"environments\">\n    The dialog opens automatically if you are not logged in\n  </app-example-viewer>\n</app-doc-viewer>\n<igo-auth-form></igo-auth-form>\n","import { NgModule } from '@angular/core';\n\nimport { IgoAuthModule } from '@igo2/auth';\n\nimport { AppAuthFormComponent } from './auth-form.component';\nimport { AppAuthFormRoutingModule } from './auth-form-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppAuthFormComponent],\n  imports: [AppAuthFormRoutingModule, SharedModule, IgoAuthModule.forRoot()],\n  exports: [AppAuthFormComponent]\n})\nexport class AppAuthFormModule {}\n","import { MatDialogModule } from '@angular/material/dialog';\nimport { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport {\n  MetadataButtonComponent,\n  MetadataAbstractComponent\n} from './metadata-button/metadata-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule,\n    MatDialogModule\n  ],\n  exports: [MetadataButtonComponent, MetadataAbstractComponent],\n  declarations: [MetadataButtonComponent, MetadataAbstractComponent]\n})\nexport class IgoMetadataModule {\n  static forRoot(): ModuleWithProviders<IgoMetadataModule> {\n    return {\n      ngModule: IgoMetadataModule,\n      providers: []\n    };\n  }\n}\n","import { ArcGISRestDataSourceOptions } from './../datasource/shared/datasources/arcgisrest-datasource.interface';\nimport { Md5 } from 'ts-md5';\n\nimport { uuid } from '@igo2/utils';\n\nimport { AnyDataSourceOptions } from '../datasource/shared/datasources/any-datasource.interface';\nimport { DataSourceOptions } from '../datasource/shared/datasources/datasource.interface';\nimport { WMSDataSourceOptions } from '../datasource/shared/datasources/wms-datasource.interface';\nimport { WMTSDataSourceOptions } from '../datasource/shared/datasources/wmts-datasource.interface';\nimport { WFSDataSourceOptions } from '../datasource';\n\n/**\n * Generate a id from it's datasource options.\n * @param options Data source options\n * @returns A id\n */\nexport function generateIdFromSourceOptions(\n  options: DataSourceOptions\n): string {\n  const generators = {\n    wms: generateWMSIdFromSourceOptions,\n    wmts: generateWMTSIdFromSourceOptions,\n    xyz: generateXYZIdFromSourceOptions,\n    feature: generateFeatureIdFromSourceOptions,\n    wfs: generateWfsIdFromSourceOptions,\n    arcgisrest: generateArcgisRestIdFromSourceOptions,\n    imagearcgisrest: generateArcgisRestIdFromSourceOptions,\n    tilearcgisrest: generateArcgisRestIdFromSourceOptions,\n    osm: (_options: AnyDataSourceOptions) => 'OSM',\n    tiledebug: (_options: AnyDataSourceOptions) => 'tiledebug'\n  };\n  const generator = generators[options.type] || generateId;\n  return generator(options);\n}\n\n/**\n * Generate a id from WMS data source options\n * @param options WMS data source options\n * @returns A md5 hash of the the url and layers\n */\nexport function generateWMSIdFromSourceOptions(options: WMSDataSourceOptions) {\n  const layers = options.params.LAYERS;\n  const url = standardizeUrl(options.url);\n  const chain = 'wms' + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from WMTS data source options\n * @param options WMTS data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWMTSIdFromSourceOptions(\n  options: WMTSDataSourceOptions\n) {\n  const layer = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = 'wmts' + url + layer;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from XYZ data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateXYZIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  const url = standardizeUrl(options.url);\n  const chain = 'xyz' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateFeatureIdFromSourceOptions(\n  options: WMTSDataSourceOptions\n) {\n  if (!options.url) {\n    return generateId(options);\n  }\n  const url = standardizeUrl(options.url);\n  const chain = 'feature' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWfsIdFromSourceOptions(options: WFSDataSourceOptions) {\n  if (!options.url || !options.params) {\n    return generateId(options);\n  }\n  const url = standardizeUrl(options.url);\n  const chain = 'wfs' + url + options.params.featureTypes;\n  return Md5.hashStr(chain) as string;\n}\n/**\n * Generate a id from ArcGIS Rest data source options\n * @param options ArcGIS Rest data source options\n * @returns A md5 hash of the url and layers\n */\nexport function generateArcgisRestIdFromSourceOptions(\n  options: ArcGISRestDataSourceOptions\n) {\n  const layers = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = (options.type || 'arcgis') + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a unique id\n * @returns A uuid\n */\nexport function generateId(_options: AnyDataSourceOptions) {\n  return uuid();\n}\n\nexport function standardizeUrl(url: string): string {\n  const absUrl = url.charAt(0) === '/' ? window.location.origin + url : url;\n  const urlDecomposed = absUrl.split(/[?&]/);\n  let urlStandardized = urlDecomposed.shift();\n  const paramsToKeep = urlDecomposed.filter(\n    (p) => p.length !== 0 && p.charAt(0) !== '_'\n  );\n  if (paramsToKeep.length) {\n    urlStandardized += '?' + paramsToKeep.join('&');\n  }\n  return urlStandardized;\n}\n","import olSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\nimport olClusterSource from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSourceOptions, Legend } from './datasource.interface';\n\nimport { DataService } from './data.service';\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\nimport {\n  LegendMapViewOptions,\n  LegendOptions\n} from '../../../layer/shared/layers/legend.interface';\n\nexport abstract class DataSource {\n  public id: string;\n  public ol: olSource | olVectorSource<OlGeometry> | olClusterSource;\n  private legend: Legend[];\n\n  constructor(\n    public options: DataSourceOptions = {},\n    protected dataService?: DataService\n  ) {\n    this.options = options;\n    this.id = this.options.id || this.generateId();\n    this.ol = this.createOlSource();\n  }\n\n  protected abstract createOlSource(): olSource;\n\n  protected generateId(): string {\n    return generateIdFromSourceOptions(this.options);\n  }\n\n  public getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    return this.legend ? this.legend : [];\n  }\n\n  public setLegend(options: LegendOptions): Legend[] {\n    if (options.url) {\n      this.legend = [{ url: options.url }];\n    } else if (options.html) {\n      this.legend = [{ html: options.html }];\n    } else {\n      this.legend = [];\n    }\n\n    return this.legend;\n  }\n\n  protected abstract onUnwatch();\n}\n","import olSourceVector from 'ol/source/Vector';\nimport * as olformat from 'ol/format';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { FeatureDataSourceOptions } from './feature-datasource.interface';\n\nexport class FeatureDataSource extends DataSource {\n  public declare options: FeatureDataSourceOptions;\n  public declare ol: olSourceVector<OlGeometry>;\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const sourceOptions = {\n      format: this.getSourceFormatFromOptions(this.options)\n    };\n\n    return new olSourceVector(Object.assign(sourceOptions, this.options));\n  }\n\n  protected getSourceFormatFromOptions(options: FeatureDataSourceOptions) {\n    if (options.format) {\n      return options.format;\n    }\n    let olFormatCls;\n    const formatType = options.formatType;\n    if (!formatType) {\n      olFormatCls = olformat.GeoJSON;\n    } else {\n      olFormatCls = olformat[formatType];\n      if (olFormatCls === undefined) {\n        throw new Error('Invalid vector source format ${formatType}.');\n      }\n    }\n\n    const formatOptions = options.formatOptions;\n    let format;\n    if (formatOptions) {\n      format = new olFormatCls(formatOptions);\n    } else {\n      format = new olFormatCls();\n    }\n\n    return format;\n  }\n\n  public onUnwatch() {}\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n}\n","import olSourceOSM from 'ol/source/OSM';\n\nimport { DataSource } from './datasource';\nimport { OSMDataSourceOptions } from './osm-datasource.interface';\n\nexport class OSMDataSource extends DataSource {\n  public declare options: OSMDataSourceOptions;\n  public declare ol: olSourceOSM;\n\n  protected createOlSource(): olSourceOSM {\n    if (!this.options.url) {\n      this.options.url = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';\n    }\n    return new olSourceOSM(this.options);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceXYZ from 'ol/source/XYZ';\n\nimport { DataSource } from './datasource';\nimport { XYZDataSourceOptions } from './xyz-datasource.interface';\n\nexport class XYZDataSource extends DataSource {\n  public declare options: XYZDataSourceOptions;\n  public declare ol: olSourceXYZ;\n\n  protected createOlSource(): olSourceXYZ {\n    return new olSourceXYZ(this.options);\n  }\n\n  public onUnwatch() {}\n}\n","export enum OgcFilterOperatorType {\n  BasicNumericOperator = 'basicnumericoperator',\n  Basic = 'basic',\n  BasicAndSpatial = 'basicandspatial',\n  Spatial = 'spatial',\n  All = 'all',\n  Time = 'time'\n}\n\nexport enum OgcFilterOperator {\n  BBOX = 'BBox',\n  PropertyIsBetween = 'PropertyIsBetween',\n  Contains = 'Contains',\n  During = 'During',\n  PropertyIsEqualTo = 'PropertyIsEqualTo',\n  PropertyIsGreaterThan = 'PropertyIsGreaterThan',\n  PropertyIsGreaterThanOrEqualTo = 'PropertyIsGreaterThanOrEqualTo',\n  Intersects = 'Intersects',\n  PropertyIsNull = 'PropertyIsNull',\n  PropertyIsLessThan = 'PropertyIsLessThan',\n  PropertyIsLessThanOrEqualTo = 'PropertyIsLessThanOrEqualTo',\n  PropertyIsLike = 'PropertyIsLike',\n  PropertyIsNotEqualTo = 'PropertyIsNotEqualTo',\n  Within = 'Within',\n  And = 'And',\n  Or = 'Or',\n  Not = 'Not'\n}\n","import * as olfilter from 'ol/format/filter';\nimport olFormatWKT from 'ol/format/WKT';\nimport olFormatWFS, { WriteGetFeatureOptions } from 'ol/format/WFS';\nimport olGeometry from 'ol/geom/Geometry';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { uuid, ObjectUtils } from '@igo2/utils';\n\nimport {\n  OgcFilter,\n  IgoOgcFilterObject,\n  AnyBaseOgcFilterOptions,\n  OgcInterfaceFilterOptions,\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions,\n  IgoOgcSelector,\n  SelectorGroup,\n  OgcSelectorBundle\n} from './ogc-filter.interface';\nimport { OgcFilterOperatorType, OgcFilterOperator } from './ogc-filter.enum';\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport { default as moment } from 'moment';\nexport class OgcFilterWriter {\n  private filterSequence: OgcInterfaceFilterOptions[] = [];\n  public operators = {\n    [OgcFilterOperator.PropertyIsEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsNotEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsLike as string]: {\n      spatial: false,\n      fieldRestrict: ['string']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsBetween as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.During as string]: { spatial: false, fieldRestrict: [] },\n    [OgcFilterOperator.PropertyIsNull as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Intersects as string]: {\n      spatial: true,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Within as string]: { spatial: true, fieldRestrict: [] },\n    [OgcFilterOperator.Contains as string]: { spatial: true, fieldRestrict: [] }\n  };\n\n  defineOgcFiltersDefaultOptions(\n    ogcFiltersOptions: OgcFiltersOptions,\n    fieldNameGeometry: string,\n    srcType?: string\n  ): OgcFiltersOptions {\n    let ogcFiltersDefaultValue = true; // default values for wfs.\n    if (srcType && srcType === 'wms') {\n      ogcFiltersDefaultValue = false;\n    }\n\n    ogcFiltersOptions = ogcFiltersOptions || {};\n    ogcFiltersOptions.enabled =\n      ogcFiltersOptions.enabled === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.enabled;\n    ogcFiltersOptions.editable =\n      ogcFiltersOptions.editable === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.editable;\n    ogcFiltersOptions.geometryName = fieldNameGeometry;\n\n    ogcFiltersOptions.advancedOgcFilters = true;\n    if (\n      ogcFiltersOptions.enabled &&\n      (ogcFiltersOptions.pushButtons ||\n        ogcFiltersOptions.checkboxes ||\n        ogcFiltersOptions.radioButtons ||\n        ogcFiltersOptions.select ||\n        ogcFiltersOptions.autocomplete)\n    ) {\n      ogcFiltersOptions.advancedOgcFilters = false;\n    }\n    return ogcFiltersOptions;\n  }\n\n  public buildFilter(\n    filters?: IgoOgcFilterObject,\n    extent?: [number, number, number, number],\n    proj?: olProjection,\n    fieldNameGeometry?: string,\n    options?: OgcFilterableDataSourceOptions\n  ): string {\n    let ourBboxFilter;\n    let enableBbox: boolean;\n    if (/intersects|contains|within/gi.test(JSON.stringify(filters))) {\n      enableBbox = false;\n    } else {\n      enableBbox = true;\n    }\n    if (filters) {\n      fieldNameGeometry =\n        (filters as any).geometryName !== undefined\n          ? (filters as any).geometryName\n          : fieldNameGeometry;\n    }\n    if (extent && filters) {\n      ourBboxFilter = olfilter.bbox(fieldNameGeometry, extent, proj.getCode());\n    }\n    let filterAssembly: OgcFilter;\n    if (filters) {\n      filters = this.checkIgoFiltersProperties(\n        filters,\n        fieldNameGeometry,\n        proj\n      );\n      if (extent && enableBbox) {\n        filterAssembly = olfilter.and(\n          ourBboxFilter,\n          this.bundleFilter(filters, options)\n        );\n      } else {\n        filterAssembly = this.bundleFilter(filters, options);\n      }\n    } else {\n      return 'bbox=' + extent.join(',') + ',' + proj.getCode();\n    }\n\n    const wfsOptions: WriteGetFeatureOptions = {\n      srsName: '',\n      featureNS: '',\n      featurePrefix: '',\n      featureTypes: ['featureTypes'],\n      filter: filterAssembly,\n      outputFormat: '',\n      geometryName: fieldNameGeometry\n    };\n\n    const query = new olFormatWFS().writeGetFeature(wfsOptions);\n    const str = new XMLSerializer().serializeToString(query);\n    const regexp1 = /typenames *=|typename *=\\\"featureTypes\\\" *>/gi;\n    const regexp2 = /<\\/Query><\\/GetFeature>/gi;\n\n    return 'filter=' + str.split(regexp1)[1].split(regexp2)[0];\n  }\n\n  private bundleFilter(\n    filterObject: any,\n    options?: OgcFilterableDataSourceOptions\n  ) {\n    if (filterObject instanceof Array) {\n      const logicalArray = [];\n      filterObject.forEach((element) => {\n        logicalArray.push(this.bundleFilter(element, options));\n      });\n      return logicalArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return this.createFilter(\n          {\n            operator: filterObject.logical,\n            logicalArray: this.bundleFilter(filterObject.filters, options)\n          },\n          options\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.createFilter(\n          filterObject as AnyBaseOgcFilterOptions,\n          options\n        );\n      }\n    }\n  }\n\n  private createFilter(\n    filterOptions,\n    options?: OgcFilterableDataSourceOptions\n  ): OgcFilter {\n    const operator = filterOptions.operator;\n    const logicalArray = filterOptions.logicalArray;\n\n    const wfsPropertyName = filterOptions.propertyName;\n    const wfsPattern = filterOptions.pattern;\n    const wfsMatchCase = filterOptions.matchCase\n      ? filterOptions.matchCase\n      : true;\n    const wfsWildCard = filterOptions.wildCard ? filterOptions.wildCard : '*';\n    const wfsSingleChar = filterOptions.singleChar\n      ? filterOptions.singleChar\n      : '.';\n    const wfsEscapeChar = filterOptions.escapeChar\n      ? filterOptions.escapeChar\n      : '!';\n\n    const wfsLowerBoundary = filterOptions.lowerBoundary;\n    const wfsUpperBoundary = filterOptions.upperBoundary;\n\n    const wfsGeometryName = filterOptions.geometryName;\n    const wfsExtent = filterOptions.extent;\n    const wfsWktGeometry = filterOptions.wkt_geometry;\n    const wfsSrsName = filterOptions.srsName\n      ? filterOptions.srsName\n      : 'EPSG:3857';\n\n    const wfsBegin = this.parseFilterOptionDate(\n      filterOptions.begin,\n      options ? options.minDate : undefined\n    );\n    const wfsEnd = this.parseFilterOptionDate(\n      filterOptions.end,\n      options ? options.maxDate : undefined\n    );\n\n    const wfsExpression = filterOptions.expression;\n\n    let geometry: olGeometry;\n    if (wfsWktGeometry) {\n      const wkt = new olFormatWKT();\n      geometry = wkt.readGeometry(wfsWktGeometry, {\n        dataProjection: wfsSrsName,\n        featureProjection: wfsSrsName || 'EPSG:3857'\n      });\n    }\n\n    switch (operator.toLowerCase()) {\n      case OgcFilterOperator.BBOX.toLowerCase():\n        return olfilter.bbox(wfsGeometryName, wfsExtent, wfsSrsName);\n      case OgcFilterOperator.PropertyIsBetween.toLowerCase():\n        return olfilter.between(\n          wfsPropertyName,\n          wfsLowerBoundary || 1e40 * -1,\n          wfsUpperBoundary || 1e40\n        );\n      case OgcFilterOperator.Contains.toLowerCase():\n        return olfilter.contains(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.During.toLowerCase():\n        return olfilter.during(wfsPropertyName, wfsBegin, wfsEnd);\n      case OgcFilterOperator.PropertyIsEqualTo.toLowerCase():\n        return olfilter.equalTo(wfsPropertyName, wfsExpression, wfsMatchCase);\n      case OgcFilterOperator.PropertyIsGreaterThan.toLowerCase():\n        return olfilter.greaterThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo.toLowerCase():\n        return olfilter.greaterThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.Intersects.toLowerCase():\n        return olfilter.intersects(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.PropertyIsNull.toLowerCase():\n        return olfilter.isNull(wfsPropertyName);\n      case OgcFilterOperator.PropertyIsLessThan.toLowerCase():\n        return olfilter.lessThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo.toLowerCase():\n        return olfilter.lessThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLike.toLowerCase():\n        return olfilter.like(\n          wfsPropertyName,\n          wfsPattern\n            ? wfsPattern.replace(/[()_]/gi, wfsSingleChar)\n            : wfsWildCard,\n          wfsWildCard,\n          wfsSingleChar,\n          wfsEscapeChar,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.PropertyIsNotEqualTo.toLowerCase():\n        return olfilter.notEqualTo(\n          wfsPropertyName,\n          wfsExpression,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.Within.toLowerCase():\n        return olfilter.within(wfsGeometryName, geometry, wfsSrsName);\n      // LOGICAL\n      case OgcFilterOperator.And.toLowerCase():\n        return olfilter.and.apply(null, logicalArray);\n      case OgcFilterOperator.Or.toLowerCase():\n        return olfilter.or.apply(null, logicalArray);\n      case OgcFilterOperator.Not.toLowerCase():\n        return olfilter.not.apply(null, logicalArray);\n\n      default:\n        return undefined;\n    }\n  }\n\n  public defineInterfaceFilterSequence(\n    filterObject: any,\n    geometryName,\n    logical = '',\n    level = -1\n  ): OgcInterfaceFilterOptions[] {\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            element,\n            geometryName,\n            logical,\n            level\n          )\n        );\n      });\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        level = level + 1;\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            filterObject.filters,\n            geometryName,\n            filterObject.logical,\n            level\n          )\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        this.filterSequence.push(\n          this.addInterfaceFilter(filterObject, geometryName, level, logical)\n        );\n      }\n    }\n    return this.filterSequence;\n  }\n\n  public computeAllowedOperators(\n    fields?: SourceFieldsOptionsParams[],\n    propertyName?: string,\n    defaultOperatorsType?: OgcFilterOperatorType\n  ) {\n    let effectiveOperators: {} = {};\n    let allowedOperators;\n    let fieldsHasSpatialOperator: boolean;\n    let includeContains: boolean;\n\n    if (fields && propertyName) {\n      const srcField = fields.find((field) => field.name === propertyName);\n      allowedOperators =\n        srcField && srcField.allowedOperatorsType\n          ? srcField.allowedOperatorsType\n          : defaultOperatorsType;\n    }\n\n    if (fields) {\n      fields.map((field) => {\n        if (!field.allowedOperatorsType) {\n          return;\n        }\n        const allowedOperatorsType = field.allowedOperatorsType.toLowerCase();\n        if (\n          allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.Spatial.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.BasicAndSpatial.toLowerCase()\n        ) {\n          fieldsHasSpatialOperator = true;\n          if (\n            allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase()\n          ) {\n            includeContains = true;\n          }\n        }\n      });\n    }\n\n    allowedOperators = allowedOperators\n      ? allowedOperators\n      : OgcFilterOperatorType.BasicAndSpatial;\n\n    switch (allowedOperators.toLowerCase()) {\n      case OgcFilterOperatorType.All:\n        effectiveOperators = this.operators;\n        break;\n      case OgcFilterOperatorType.Spatial:\n        effectiveOperators = {\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicAndSpatial:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.Basic:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          }\n        };\n        break;\n      case OgcFilterOperatorType.Time:\n        effectiveOperators = {\n          [OgcFilterOperator.During]: { spatial: false, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicNumericOperator:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsGreaterThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          }\n        };\n        break;\n      default:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n    }\n\n    if (fieldsHasSpatialOperator) {\n      (effectiveOperators as any).Intersects = {\n        spatial: true,\n        fieldRestrict: []\n      };\n      (effectiveOperators as any).Within = { spatial: true, fieldRestrict: [] };\n      if (includeContains) {\n        (effectiveOperators as any).Contains = {\n          spatial: true,\n          fieldRestrict: []\n        };\n      }\n    }\n\n    return effectiveOperators;\n  }\n\n  public addInterfaceFilter(\n    igoOgcFilterObject?,\n    geometryName?,\n    level = 0,\n    parentLogical = 'Or'\n  ): OgcInterfaceFilterOptions {\n    if (!igoOgcFilterObject) {\n      igoOgcFilterObject = { operator: 'PropertyIsEqualTo' };\n    }\n    const f = {\n      propertyName: '',\n      operator: '',\n      active: '',\n      filterid: uuid(),\n      step: '',\n      begin: '',\n      end: '',\n      sliderOptions: {},\n      lowerBoundary: '',\n      upperBoundary: '',\n      expression: '',\n      pattern: '',\n      wildCard: '*',\n      singleChar: '.',\n      escapeChar: '!',\n      matchCase: true,\n      igoSpatialSelector: '',\n      igoSNRC: '',\n      geometryName: '',\n      geometry: '',\n      wkt_geometry: '',\n      extent: '',\n      srsName: '',\n      parentLogical: '',\n      level: 0\n    };\n\n    return Object.assign(\n      f,\n      {\n        parentLogical,\n        level,\n        geometryName\n      },\n      igoOgcFilterObject\n    );\n  }\n\n  public checkIgoFiltersProperties(\n    filterObject: any,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterArray = [];\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        filterArray.push(\n          this.checkIgoFiltersProperties(\n            element,\n            fieldNameGeometry,\n            proj,\n            active\n          )\n        );\n      });\n      return filterArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return Object.assign(\n          {},\n          {\n            logical: filterObject.logical,\n            filters: this.checkIgoFiltersProperties(\n              filterObject.filters,\n              fieldNameGeometry,\n              proj,\n              active\n            )\n          }\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.addFilterProperties(\n          filterObject as OgcInterfaceFilterOptions,\n          fieldNameGeometry,\n          proj,\n          active\n        );\n      }\n    }\n  }\n\n  private addFilterProperties(\n    igoOgcFilterObject: OgcInterfaceFilterOptions,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterid = igoOgcFilterObject.hasOwnProperty('filterid')\n      ? igoOgcFilterObject.filterid\n      : uuid();\n    const status = igoOgcFilterObject.hasOwnProperty('active')\n      ? igoOgcFilterObject.active\n      : active;\n\n    const srsName = igoOgcFilterObject.hasOwnProperty('srsName')\n      ? igoOgcFilterObject.srsName\n      : proj\n      ? proj.getCode()\n      : 'EPSG:3857';\n\n    return Object.assign(\n      {},\n      {\n        filterid,\n        active: status,\n        igoSpatialSelector: 'fixedExtent',\n        srsName\n      },\n      igoOgcFilterObject,\n      { geometryName: fieldNameGeometry }\n    );\n  }\n\n  public rebuiltIgoOgcFilterObjectFromSequence(\n    sequence: OgcInterfaceFilterOptions[]\n  ): IgoOgcFilterObject {\n    if (sequence instanceof Array) {\n      if (sequence.length >= 1) {\n        let lastParentLogical = sequence[0].parentLogical;\n        let nextElement: any;\n        let logicalArray = [];\n        let lastProcessedFilter;\n        sequence.forEach((uiFilter) => {\n          const element = Object.assign({}, uiFilter);\n          const index = sequence.indexOf(uiFilter);\n          if (index >= 0 && index < sequence.length - 1) {\n            nextElement = sequence[index + 1];\n          } else {\n            nextElement = element;\n          }\n          delete element.active;\n          delete element.filterid;\n          delete element.parentLogical;\n          logicalArray.push(element);\n\n          if (sequence.length === 1) {\n            lastProcessedFilter = element;\n          } else if (lastParentLogical !== nextElement.parentLogical) {\n            if (logicalArray.length === 1) {\n              console.log(\n                'You must set at ' +\n                  'least two operator in a logical (' +\n                  lastParentLogical +\n                  ')'\n              );\n            } else {\n              lastProcessedFilter = Object.assign(\n                {},\n                { logical: lastParentLogical, filters: logicalArray }\n              );\n              logicalArray = [lastProcessedFilter];\n              lastParentLogical = nextElement.parentLogical;\n            }\n          }\n        });\n        return lastProcessedFilter;\n      } else {\n        return undefined;\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  private computeIgoSelector(selectors: IgoOgcSelector): IgoOgcSelector {\n    if (\n      selectors.groups.every((group) => group.computedSelectors !== undefined)\n    ) {\n      return selectors;\n    }\n    let selector: IgoOgcSelector;\n    if (selectors.groups && selectors.bundles) {\n      if (!selectors.bundles.every((bundle) => bundle.id !== undefined)) {\n        throw new Error('You must set an id for each of your bundles');\n      }\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups.forEach((group) => {\n        group.title = group.title ? group.title : group.name;\n        group.enabled = group.enabled ? group.enabled : false;\n        group.computedSelectors = ObjectUtils.copyDeep(\n          selector.bundles.filter((b) => group.ids.includes(b.id))\n        );\n      });\n    } else if (!selectors.groups && selectors.bundles) {\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups = [\n        {\n          title: 'group1',\n          name: 'group1',\n          computedSelectors: ObjectUtils.copyDeep(selector.bundles)\n        } as SelectorGroup\n      ];\n    } else {\n      selector = {\n        bundles: selectors as any,\n        groups: [\n          {\n            title: 'group1',\n            name: 'group1',\n            computedSelectors: ObjectUtils.copyDeep(\n              selectors\n            ) as OgcSelectorBundle[]\n          } as SelectorGroup\n        ],\n        selectorType: selector.selectorType\n      };\n    }\n    if (!selector.groups.find((selectorGroup) => selectorGroup.enabled)) {\n      selector.groups[0].enabled = true;\n    }\n    return selector;\n  }\n\n  public handleOgcFiltersAppliedValue(\n    options: OgcFilterableDataSourceOptions,\n    fieldNameGeometry: string,\n    extent?: [number, number, number, number],\n    proj?: olProjection\n  ): string {\n    const ogcFilters = options.ogcFilters;\n    if (!ogcFilters) {\n      return;\n    }\n    const conditions = [];\n    let filterQueryStringSelector = '';\n    let filterQueryStringAdvancedFilters = '';\n    if (\n      ogcFilters.enabled &&\n      (ogcFilters.pushButtons ||\n        ogcFilters.checkboxes ||\n        ogcFilters.radioButtons ||\n        ogcFilters.select ||\n        ogcFilters.autocomplete)\n    ) {\n      let selectors;\n      if (ogcFilters.pushButtons) {\n        selectors = ogcFilters.pushButtons;\n        const pushConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of pushConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.checkboxes) {\n        selectors = ogcFilters.checkboxes;\n        const checkboxConditions = this.formatGroupAndFilter(\n          ogcFilters,\n          selectors\n        );\n        for (const condition of checkboxConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.radioButtons) {\n        selectors = ogcFilters.radioButtons;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const radioConditions = this.formatGroupAndFilter(\n          ogcFilters,\n          selectorsCorr\n        );\n        for (const condition of radioConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.select) {\n        selectors = ogcFilters.select;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const selectConditions = this.formatGroupAndFilter(\n          ogcFilters,\n          selectorsCorr\n        );\n        for (const condition of selectConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.autocomplete) {\n        selectors = ogcFilters.autocomplete;\n        const selectConditions = this.formatGroupAndFilter(\n          ogcFilters,\n          selectors\n        );\n        for (const condition of selectConditions) {\n          conditions.push(condition);\n        }\n      }\n\n      if (conditions.length >= 1) {\n        filterQueryStringSelector = this.buildFilter(\n          conditions.length === 1\n            ? conditions[0]\n            : { logical: 'And', filters: conditions },\n          extent,\n          proj,\n          ogcFilters.geometryName\n        );\n      }\n    }\n    if (ogcFilters.enabled && ogcFilters.filters) {\n      ogcFilters.geometryName = ogcFilters.geometryName || fieldNameGeometry;\n      const igoFilters = ogcFilters.filters;\n      filterQueryStringAdvancedFilters = this.buildFilter(\n        igoFilters,\n        extent,\n        proj,\n        ogcFilters.geometryName,\n        options\n      );\n    }\n\n    let filterQueryString = ogcFilters.advancedOgcFilters\n      ? filterQueryStringAdvancedFilters\n      : filterQueryStringSelector;\n    if (options.type === 'wms') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.LAYERS\n      );\n    }\n    if (options.type === 'wfs') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.featureTypes\n      );\n    }\n\n    return filterQueryString;\n  }\n\n  public verifyMultipleEnableds(selectors) {\n    selectors.bundles.forEach((bundle) => {\n      if (!bundle.multiple && bundle.selectors) {\n        const enableds = bundle.selectors.reduce(\n          (list, filter, index) =>\n            filter.enabled === true ? list.concat(index) : list,\n          []\n        );\n        if (enableds.length > 1) {\n          enableds.splice(0, 1);\n          enableds.forEach((index) => {\n            bundle.selectors[index].enabled = false;\n          });\n        }\n      }\n    });\n    return selectors;\n  }\n\n  public formatGroupAndFilter(ogcFilters: OgcFiltersOptions, selectors) {\n    selectors = this.computeIgoSelector(selectors);\n    const selectorBundle = selectors.groups.find(\n      (g) => g.enabled\n    ).computedSelectors;\n    const conditions = [];\n    selectorBundle.map((bundle) => {\n      const bundleCondition = [];\n      const selectorsType = bundle.selectors as any;\n      if (!selectorsType) {\n        return;\n      }\n      selectorsType\n        .filter((ogcselector) => ogcselector.enabled === true)\n        .forEach((enabledSelector) =>\n          bundleCondition.push(enabledSelector.filters)\n        );\n      if (bundleCondition.length === 1) {\n        conditions.push(bundleCondition[0]);\n      } else if (bundleCondition.length > 1) {\n        conditions.push({\n          logical: bundle.logical,\n          filters: bundleCondition\n        });\n      }\n    });\n\n    if (selectors.selectorType === 'pushButton') {\n      ogcFilters.pushButtons = selectors;\n    } else if (selectors.selectorType === 'checkbox') {\n      ogcFilters.checkboxes = selectors;\n    } else if (selectors.selectorType === 'radioButton') {\n      ogcFilters.radioButtons = selectors;\n    } else if (selectors.selectorType === 'select') {\n      ogcFilters.select = selectors;\n    } else if (selectors.selectorType === 'autocomplete') {\n      ogcFilters.autocomplete = selectors;\n    }\n    return conditions;\n  }\n\n  public formatProcessedOgcFilter(\n    processedFilter: string,\n    layersOrTypenames: string\n  ): string {\n    if (!processedFilter) {\n      return undefined;\n    }\n    let appliedFilter = '';\n    if (processedFilter.length === 0 && layersOrTypenames.indexOf(',') === -1) {\n      appliedFilter = processedFilter;\n    } else {\n      layersOrTypenames.split(',').forEach((layerOrTypenames) => {\n        appliedFilter = `${appliedFilter}(${processedFilter.replace(\n          'filter=',\n          ''\n        )})`;\n      });\n    }\n    appliedFilter = appliedFilter.replace(/\\(\\)/g, '');\n    const filterValue =\n      appliedFilter.length > 0\n        ? appliedFilter.replace('filter=', '')\n        : undefined;\n    return filterValue;\n  }\n\n  public parseFilterOptionDate(value: string, defaultValue?: string): string {\n    if (!value) {\n      return defaultValue;\n    } else if (value === 'today') {\n      return undefined;\n    } else if (moment(value).isValid()) {\n      return value;\n    } else {\n      return undefined;\n    }\n  }\n}\n","import { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\n\nimport * as OlFormat from 'ol/format';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport olFormatGML32 from 'ol/format/GML32';\nimport olFormatOSMXML from 'ol/format/OSMXML';\nimport olProjection from 'ol/proj/Projection';\n\nexport const defaultEpsg = 'EPSG:3857';\nexport const defaultMaxFeatures = 5000;\nexport const defaultWfsVersion = '2.0.0';\nexport const defaultFieldNameGeometry = 'geometry';\nexport const gmlRegex = new RegExp(/(.*)?gml(.*)?/gi);\nexport const jsonRegex = new RegExp(/(.*)?json(.*)?/gi);\n\n/**\n * This method build the WFS URL based on the layer property.\n * @param options  WFSDataSourceOptions The common wfs datasource options interface\n * @param extent  An extent like array [number, number, number, number]\n * @param proj  olProjection\n * @param ogcFilters  OgcFiltersOptions\n * @returns A string representing the datasource options, based on filter and views\n */\nexport function buildUrl(\n  options: WFSDataSourceOptions,\n  extent,\n  proj: olProjection,\n  ogcFilters: OgcFiltersOptions,\n  randomParam?: boolean\n): string {\n  const paramsWFS = options.paramsWFS;\n  const queryStringValues = formatWFSQueryString(\n    options,\n    undefined,\n    options.paramsWFS.srsName\n  );\n  let igoFilters;\n  if (ogcFilters && ogcFilters.enabled) {\n    igoFilters = ogcFilters.filters;\n  }\n  const ogcFilterWriter = new OgcFilterWriter();\n  const filterOrBox = ogcFilterWriter.buildFilter(\n    igoFilters,\n    extent,\n    proj,\n    ogcFilters.geometryName,\n    options\n  );\n  let filterOrPush = ogcFilterWriter.handleOgcFiltersAppliedValue(\n    options,\n    ogcFilters.geometryName,\n    extent,\n    proj\n  );\n\n  let prefix = 'filter';\n  if (!filterOrPush) {\n    prefix = 'bbox';\n    filterOrPush = extent.join(',') + ',' + proj.getCode();\n  }\n\n  paramsWFS.xmlFilter = ogcFilters.advancedOgcFilters\n    ? filterOrBox\n    : `${prefix}=${filterOrPush}`;\n  let baseUrl = queryStringValues.find((f) => f.name === 'getfeature').value;\n  const patternFilter = /(filter|bbox)=.*/gi;\n  baseUrl = patternFilter.test(paramsWFS.xmlFilter)\n    ? `${baseUrl}&${paramsWFS.xmlFilter}`\n    : baseUrl;\n  options.download = Object.assign({}, options.download, {\n    dynamicUrl: baseUrl\n  });\n  if (randomParam) {\n    baseUrl += `$&_t${new Date().getTime()}`;\n  }\n  return baseUrl.replace(/&&/g, '&');\n}\n\n/**\n * This method build/standardize WFS call query params based on the layer property.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @param count  Number: Used to control the number of feature. Used to bypass whe wfs datasource options interface (maxFeatures)\n * @param epsg  String: Used to control the EPSG code (es: 'EPSG3857'). Used to bypass whe wfs datasource options interface (srsName)\n * @param properties  String: Used to control the queried fields  (WFS service).\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function formatWFSQueryString(\n  dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n  count?: number,\n  epsg?: string,\n  properties?: string,\n  startIndex: number = 0,\n  forceDefaultOutputFormat: boolean = false\n): { name: string; value: string }[] {\n  const versionWfs200 = '2.0.0'; // not the same usage as defaultWfsVersion.\n  const url = dataSourceOptions.urlWfs;\n  const paramsWFS = dataSourceOptions.paramsWFS;\n  const effectiveCount = count || defaultMaxFeatures;\n  const effectiveStartIndex =\n    paramsWFS.version === versionWfs200 ? `startIndex=${startIndex}` : '';\n  const epsgCode = epsg || defaultEpsg;\n  let outputFormat = paramsWFS.outputFormat\n    ? `outputFormat=${paramsWFS.outputFormat}`\n    : '';\n  let version = paramsWFS.version\n    ? `version=${paramsWFS.version}`\n    : `version=${defaultWfsVersion}`;\n  const paramTypename =\n    paramsWFS.version === versionWfs200 ? 'typenames' : 'typename';\n  const featureTypes = `${paramTypename}=${paramsWFS.featureTypes}`;\n  const paramMaxFeatures =\n    paramsWFS.version === versionWfs200 ? 'count' : 'maxFeatures';\n  let cnt = count\n    ? `${paramMaxFeatures}=${effectiveCount}`\n    : paramsWFS.maxFeatures\n    ? `${paramMaxFeatures}=${paramsWFS.maxFeatures}`\n    : `${paramMaxFeatures}=${effectiveCount}`;\n  if (forceDefaultOutputFormat) {\n    outputFormat = '';\n    version = 'version=1.1.0';\n    cnt = cnt.replace('count', 'maxFeatures');\n  }\n\n  const srs = epsg\n    ? `srsname=${epsgCode}`\n    : paramsWFS.srsName\n    ? 'srsname=' + paramsWFS.srsName\n    : `srsname=${epsgCode}`;\n\n  let propertyName = '';\n  let valueReference = '';\n  if (properties) {\n    propertyName = `propertyName=${properties}`;\n    valueReference = `valueReference=${properties}`;\n  }\n  const sourceFields = dataSourceOptions.sourceFields;\n  if (!propertyName && sourceFields && sourceFields.length > 0) {\n    const fieldsNames = [];\n    dataSourceOptions.sourceFields.forEach((sourcefield) => {\n      fieldsNames.push(sourcefield.name);\n    });\n    propertyName = `propertyName=${fieldsNames.join(',')},${\n      paramsWFS.fieldNameGeometry\n    }`;\n  }\n\n  const separator = url.indexOf('?') === -1 ? '?' : '&';\n  const getCapabilities = `${url}${separator}service=WFS&request=GetCapabilities&${version}`;\n  let getFeature = `${url}${separator}service=WFS&request=GetFeature&${version}&${featureTypes}&`;\n  getFeature += `${outputFormat}&${srs}&${cnt}&${propertyName}&${effectiveStartIndex}`;\n\n  let getpropertyvalue = `${url}?service=WFS&request=GetPropertyValue&version=${versionWfs200}&${featureTypes}&`;\n  getpropertyvalue += `&${cnt}&${valueReference}`;\n\n  return [\n    { name: 'outputformat', value: outputFormat },\n    { name: 'version', value: version },\n    { name: 'typename', value: featureTypes },\n    { name: 'count', value: cnt },\n    { name: 'srsname', value: srs },\n    { name: 'propertyname', value: propertyName },\n    { name: 'valuereference', value: valueReference },\n    { name: 'getcapabilities', value: getCapabilities.replace(/&&/g, '&') },\n    { name: 'getfeature', value: getFeature.replace(/&&/g, '&') },\n    { name: 'getpropertyvalue', value: getpropertyvalue.replace(/&&/g, '&') }\n  ];\n}\n\n/**\n * Validate/Modify layer's wfs options based on :\n * 1- an Openlayers's issue with GML provided from WFS. Refer to\n * https://github.com/openlayers/openlayers/pull/6400\n * 2- Set default values for optionals parameters.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function checkWfsParams(wfsDataSourceOptions, srcType?: string) {\n  if (srcType && srcType === 'wfs') {\n    // reassignation of params to paramsWFS and url to urlWFS to have a common interface with wms-wfs datasources\n    wfsDataSourceOptions.paramsWFS = wfsDataSourceOptions.params;\n  }\n\n  const paramsWFS = wfsDataSourceOptions.paramsWFS;\n  wfsDataSourceOptions.urlWfs =\n    wfsDataSourceOptions.urlWfs || wfsDataSourceOptions.url;\n\n  paramsWFS.version = paramsWFS.version || defaultWfsVersion;\n  paramsWFS.fieldNameGeometry =\n    paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n  paramsWFS.maxFeatures = paramsWFS.maxFeatures || defaultMaxFeatures;\n\n  let outputFormat;\n  if (paramsWFS.outputFormat) {\n    outputFormat = paramsWFS.outputFormat;\n  }\n\n  if (gmlRegex.test(outputFormat) || !outputFormat) {\n    paramsWFS.version = '1.1.0';\n  }\n  return Object.assign({}, wfsDataSourceOptions);\n}\n\nexport function getFormatFromOptions(\n  options: WFSDataSourceOptions | WMSDataSourceOptions\n) {\n  const wfsOptions = options as WFSDataSourceOptions;\n\n  let olFormatCls;\n  const outputFormat = wfsOptions.paramsWFS.outputFormat\n    ? wfsOptions.paramsWFS.outputFormat\n    : undefined;\n\n  if (!outputFormat) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  if (OlFormat[outputFormat]) {\n    olFormatCls = OlFormat[outputFormat];\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gml2')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({\n      ...wfsOptions.formatOptions,\n      ...{ gmlFormat: olFormatGML2 }\n    });\n  } else if (outputFormat.toLowerCase().match('gml32')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({\n      ...wfsOptions.formatOptions,\n      ...{ gmlFormat: olFormatGML32 }\n    });\n  } else if (outputFormat.toLowerCase().match('gml3')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({\n      ...wfsOptions.formatOptions,\n      ...{ gmlFormat: olFormatGML3 }\n    });\n  } else if (outputFormat.toLowerCase().match('topojson')) {\n    olFormatCls = OlFormat.TopoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('geojson')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('esrijson')) {\n    olFormatCls = OlFormat.EsriJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('json')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gpx')) {\n    olFormatCls = OlFormat.GPX;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('WKT')) {\n    olFormatCls = OlFormat.WKT;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('osmxml')) {\n    olFormatCls = olFormatOSMXML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('kml')) {\n    olFormatCls = OlFormat.KML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  return new olFormatCls();\n}\n","import olSourceVector from 'ol/source/Vector';\nimport * as OlLoadingStrategy from 'ol/loadingstrategy';\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WFSService } from './wfs.service';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport {\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions\n} from '../../../filter/shared/ogc-filter.interface';\nimport {\n  defaultFieldNameGeometry,\n  checkWfsParams,\n  getFormatFromOptions,\n  buildUrl\n} from './wms-wfs.utils';\nimport { AuthInterceptor } from '@igo2/auth';\n\nexport class WFSDataSource extends DataSource {\n  public declare ol: olSourceVector<OlGeometry>;\n  public mostRecentIdCallOGCFilter: number = 0;\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  constructor(\n    public options: WFSDataSourceOptions,\n    protected wfsService: WFSService,\n    private authInterceptor?: AuthInterceptor\n  ) {\n    super(checkWfsParams(options, 'wfs'));\n\n    const ogcFilters = (this.options as OgcFilterableDataSourceOptions)\n      .ogcFilters;\n    const fieldNameGeometry =\n      this.options.paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n    const ogcFilterWriter = new OgcFilterWriter();\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters =\n      ogcFilterWriter.defineOgcFiltersDefaultOptions(\n        ogcFilters,\n        fieldNameGeometry\n      );\n    if (\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.enabled &&\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.editable &&\n      (options.sourceFields || []).filter((sf) => !sf.values).length > 0\n    ) {\n      this.wfsService.getSourceFieldsFromWFS(this.options);\n    }\n\n    if (ogcFilters?.pushButtons) {\n      ogcFilters.pushButtons.selectorType = 'pushButton';\n    }\n    if (ogcFilters?.checkboxes) {\n      ogcFilters.checkboxes.selectorType = 'checkbox';\n    }\n    if (ogcFilters?.radioButtons) {\n      ogcFilters.radioButtons.selectorType = 'radioButton';\n    }\n    if (ogcFilters?.select) {\n      ogcFilters.select.selectorType = 'select';\n    }\n    if (ogcFilters?.autocomplete) {\n      ogcFilters.autocomplete.selectorType = 'autocomplete';\n    }\n\n    this.setOgcFilters(\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters,\n      true\n    );\n  }\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const vectorSource = new olSourceVector({\n      format: getFormatFromOptions(this.options),\n      url: (extent, resolution, proj: olProjection) => {\n        const paramsWFS = this.options.paramsWFS;\n        const wfsProj = paramsWFS.srsName\n          ? new olProjection({ code: paramsWFS.srsName })\n          : proj;\n        const ogcFilters = (this.options as OgcFilterableDataSourceOptions)\n          .ogcFilters;\n        const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\n        paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\n        return buildUrl(this.options, currentExtent, wfsProj, ogcFilters);\n      },\n      strategy: OlLoadingStrategy.bbox\n    });\n    return vectorSource;\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    this.mostRecentIdCallOGCFilter += 1;\n    if (triggerEvent) {\n      this.ol.notify('ogcFilters', this.ogcFilters);\n    }\n  }\n\n  public onUnwatch() {}\n}\n","export abstract class DataService {\n  abstract getData(): string;\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { combineLatest, Observable, of } from 'rxjs';\nimport olFeature from 'ol/Feature';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { DataService } from './data.service';\nimport {\n  formatWFSQueryString,\n  gmlRegex,\n  defaultEpsg,\n  defaultMaxFeatures,\n  getFormatFromOptions\n} from './wms-wfs.utils';\nimport { concatMap } from 'rxjs/operators';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n@Injectable({\n  providedIn: 'root'\n})\nexport class WFSService extends DataService {\n  constructor(private http: HttpClient) {\n    super();\n  }\n\n  getData() {\n    console.log('This is defining a data service.');\n    return 'This is defining a data service.';\n  }\n\n  public getSourceFieldsFromWFS(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\n  ) {\n    if (\n      !dataSourceOptions.sourceFields ||\n      dataSourceOptions.sourceFields.length === 0\n    ) {\n      dataSourceOptions.sourceFields = [];\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(\n        (getfeatureSourceField) => {\n          dataSourceOptions.sourceFields = getfeatureSourceField;\n        }\n      );\n    } else {\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(\n        (getfeatureSourceField) => {\n          dataSourceOptions.sourceFields.forEach((sourcefield) => {\n            if (sourcefield.alias === undefined) {\n              sourcefield.alias = sourcefield.name; // to allow only a list of sourcefield with names\n            }\n            if (\n              sourcefield.values === undefined ||\n              sourcefield.values.length === 0\n            ) {\n              sourcefield.values = getfeatureSourceField.find(\n                (sf) => sf.name === sourcefield.name\n              ).values;\n            }\n          });\n        }\n      );\n    }\n  }\n\n  private wfsGetFeature(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n    nb: number = defaultMaxFeatures,\n    epsgCode: string = defaultEpsg,\n    propertyName?: string,\n    startIndex: number = 0,\n    forceDefaultOutputFormat: boolean = false\n  ): Observable<any> {\n    const queryStringValues = formatWFSQueryString(\n      dataSourceOptions,\n      nb,\n      epsgCode,\n      propertyName,\n      startIndex,\n      forceDefaultOutputFormat\n    );\n    const baseUrl = queryStringValues.find(\n      (f) => f.name === 'getfeature'\n    ).value;\n    const outputFormat = dataSourceOptions.paramsWFS.outputFormat;\n    if (\n      forceDefaultOutputFormat ||\n      gmlRegex.test(outputFormat) ||\n      !outputFormat\n    ) {\n      return this.http.get(baseUrl, { responseType: 'text' });\n    } else {\n      return this.http.get(baseUrl);\n    }\n  }\n\n  defineFieldAndValuefromWFS(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\n  ): Observable<any> {\n    return new Observable((d) => {\n      const sourceFields = [];\n      let fieldList;\n      let fieldListWoGeom;\n      let fieldListWoGeomStr;\n      let olFormats;\n      let effectiveOlFormats;\n\n      olFormats = getFormatFromOptions(dataSourceOptions);\n      const gmlDataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions =\n        JSON.parse(JSON.stringify(dataSourceOptions));\n      delete gmlDataSourceOptions.paramsWFS.outputFormat;\n      delete (gmlDataSourceOptions as WFSDataSourceOptions).formatOptions;\n\n      effectiveOlFormats = getFormatFromOptions(gmlDataSourceOptions);\n      let sourceFieldsToRetrieveValues = dataSourceOptions.sourceFields\n        ?.filter((f) => !f.values)\n        .map((f) => f.name);\n\n      // Validate if the service manage no outputformat (wfs 1.0.0 and GML is the default return)\n      this.wfsGetFeature(dataSourceOptions, 1, undefined, undefined, 0, true)\n        .pipe(\n          concatMap((res) =>\n            String(res).toLowerCase().includes('exception')\n              ? of(false)\n              : of(true)\n          ),\n          concatMap((allowGml) => {\n            // If the service return GML (return no exception)\n            return this.wfsGetFeature(dataSourceOptions, 1).pipe(\n              concatMap((firstFeature) => {\n                const features = olFormats.readFeatures(firstFeature);\n                fieldList = features[0].getKeys();\n                if (\n                  dataSourceOptions.sourceFields ||\n                  dataSourceOptions.sourceFields.length === 0\n                ) {\n                  sourceFieldsToRetrieveValues = fieldList;\n                }\n                fieldListWoGeom = fieldList.filter(\n                  (field) =>\n                    sourceFieldsToRetrieveValues.includes(field) &&\n                    field !== features[0].getGeometryName() &&\n                    !field.match(/boundedby/gi)\n                );\n                fieldListWoGeomStr = fieldListWoGeom.join(',');\n                const processingArray = [];\n                let startIndex = 0;\n                // If the service do not allow gml return, dice the call in multiple\n                // calls by increment of chunkSize with the original outputFormat\n                if (\n                  !allowGml &&\n                  dataSourceOptions.paramsWFS.version === '2.0.0' &&\n                  dataSourceOptions.paramsWFS.maxFeatures > defaultMaxFeatures\n                ) {\n                  const chunkSize = 1000;\n                  while (startIndex < dataSourceOptions.paramsWFS.maxFeatures) {\n                    processingArray.push(\n                      this.wfsGetFeature(\n                        dataSourceOptions,\n                        chunkSize,\n                        dataSourceOptions.paramsWFS.srsName,\n                        fieldListWoGeomStr,\n                        startIndex\n                      )\n                    );\n                    startIndex += chunkSize;\n                  }\n                  effectiveOlFormats = olFormats;\n                } else {\n                  processingArray.push(\n                    this.wfsGetFeature(\n                      dataSourceOptions,\n                      dataSourceOptions.paramsWFS.maxFeatures ||\n                        defaultMaxFeatures,\n                      dataSourceOptions.paramsWFS.srsName,\n                      fieldListWoGeomStr,\n                      0,\n                      true\n                    )\n                  );\n                }\n                return combineLatest(processingArray);\n              })\n            );\n          })\n        )\n        .subscribe((results) => {\n          let mfeatures: olFeature<OlGeometry>[] = [];\n          results.map((result) => {\n            const loopFeatures = effectiveOlFormats.readFeatures(result);\n            mfeatures = mfeatures.concat(loopFeatures);\n          });\n          this.built_properties_value(mfeatures).forEach((element) => {\n            sourceFields.push(element);\n          });\n          d.next(sourceFields);\n          d.complete();\n        });\n    });\n  }\n\n  private built_properties_value(features: olFeature<OlGeometry>[]): string[] {\n    if (features.length === 0) {\n      return [];\n    }\n    const kv = Object.assign({}, features[0].getProperties());\n    delete kv[features[0].getGeometryName()];\n    delete kv.boundedBy;\n    const sourceFields = [];\n    for (const property in kv) {\n      if (kv.hasOwnProperty(property)) {\n        const fieldType =\n          typeof features[0].get(property) === 'object'\n            ? undefined\n            : typeof features[0].get(property);\n        sourceFields.push({\n          name: property,\n          alias: property,\n          type: fieldType,\n          values: [kv[property]]\n        });\n      }\n    }\n    features.every((element) => {\n      const featureProperties = element.getProperties();\n      for (const key in featureProperties) {\n        if (featureProperties.hasOwnProperty(key) && key in kv) {\n          sourceFields\n            .filter((f) => f.name === key)\n            .forEach((v) => {\n              if (v.values.indexOf(featureProperties[key]) === -1) {\n                v.values.push(featureProperties[key]);\n              }\n            });\n        }\n      }\n      return true;\n    });\n    return sourceFields;\n  }\n}\n","export enum QueryFormat {\n  GML2 = 'gml2',\n  GML3 = 'gml3',\n  JSON = 'json',\n  GEOJSON = 'geojson',\n  GEOJSON2 = 'geojson2',\n  ESRIJSON = 'esrijson',\n  TEXT = 'text',\n  HTML = 'html',\n  HTMLGML2 = 'htmlgml2'\n}\n\nexport enum QueryFormatMimeType {\n  GML2 = 'application/vnd.ogc.gml',\n  GML3 = 'application/vnd.ogc.gml/3.1.1',\n  JSON = 'application/json',\n  GEOJSON = 'application/geojson',\n  GEOJSON2 = 'geojson',\n  ESRIJSON = 'application/json',\n  TEXT = 'text/plain',\n  HTML = 'text/html',\n  HTMLGML2 = 'text/html'\n}\n\nexport enum QueryHtmlTarget {\n  IFRAME = 'iframe',\n  BLANK = '_blank'\n}\n","import olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport {\n  TimeFilterableDataSourceOptions,\n  WMSDataSourceOptions\n} from './wms-datasource.interface';\nimport { WFSService } from './wfs.service';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport {\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions,\n  OgcFilterDuringOptions\n} from '../../../filter/shared/ogc-filter.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nimport {\n  formatWFSQueryString,\n  checkWfsParams,\n  defaultFieldNameGeometry\n} from './wms-wfs.utils';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { LegendMapViewOptions } from '../../../layer/shared/layers/legend.interface';\nimport { BehaviorSubject } from 'rxjs';\nimport { TimeFilterOptions } from '../../../filter';\n\nexport interface TimeFilterableDataSource extends WMSDataSource {\n  options: TimeFilterableDataSourceOptions;\n  timeFilter$: BehaviorSubject<TimeFilterOptions>;\n  setTimeFilter(ogcFilters: TimeFilterOptions, triggerEvent?: boolean);\n  filterByDate(date: Date | [Date, Date]);\n  filterByYear(year: string | [string, string]);\n}\n\nexport class WMSDataSource extends DataSource {\n  public declare ol: olSourceImageWMS;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  set timeFilter(value: TimeFilterOptions) {\n    (this.options as TimeFilterableDataSourceOptions).timeFilter = value;\n  }\n  get timeFilter(): TimeFilterOptions {\n    return (this.options as TimeFilterableDataSourceOptions).timeFilter;\n  }\n  readonly timeFilter$: BehaviorSubject<TimeFilterOptions> =\n    new BehaviorSubject(undefined);\n\n  constructor(\n    public options: WMSDataSourceOptions,\n    protected wfsService: WFSService\n  ) {\n    super(options);\n    const sourceParams: any = options.params;\n\n    const dpi = sourceParams.DPI || 96;\n    sourceParams.DPI = dpi;\n    sourceParams.MAP_RESOLUTION = dpi;\n    sourceParams.FORMAT_OPTIONS = 'dpi:' + dpi;\n\n    if (options.refreshIntervalSec && options.refreshIntervalSec > 0) {\n      setInterval(() => {\n        this.refresh();\n      }, options.refreshIntervalSec * 1000); // Convert seconds to MS\n    }\n\n    let fieldNameGeometry = defaultFieldNameGeometry;\n\n    // ####   START if paramsWFS\n    if (options.paramsWFS) {\n      const wfsCheckup = checkWfsParams(options, 'wms');\n      ObjectUtils.mergeDeep(options.paramsWFS, wfsCheckup.paramsWFS);\n\n      fieldNameGeometry =\n        options.paramsWFS.fieldNameGeometry || fieldNameGeometry;\n\n      options.download = Object.assign({}, options.download, {\n        dynamicUrl: this.buildDynamicDownloadUrlFromParamsWFS(options)\n      });\n    } //  ####   END  if paramsWFS\n\n    if (!options.sourceFields || options.sourceFields.length === 0) {\n      options.sourceFields = [];\n    } else {\n      options.sourceFields.forEach((sourceField) => {\n        sourceField.alias = sourceField.alias\n          ? sourceField.alias\n          : sourceField.name;\n        // to allow only a list of sourcefield with names\n      });\n    }\n    const initOgcFilters = (options as OgcFilterableDataSourceOptions)\n      .ogcFilters;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (!initOgcFilters) {\n      (options as OgcFilterableDataSourceOptions).ogcFilters =\n        ogcFilterWriter.defineOgcFiltersDefaultOptions(\n          initOgcFilters,\n          fieldNameGeometry,\n          'wms'\n        );\n    } else {\n      initOgcFilters.advancedOgcFilters =\n        initOgcFilters.pushButtons ||\n        initOgcFilters.checkboxes ||\n        initOgcFilters.radioButtons ||\n        initOgcFilters.select ||\n        initOgcFilters.autocomplete\n          ? false\n          : true;\n      if (initOgcFilters.advancedOgcFilters && initOgcFilters.filters) {\n        const filterDuring = initOgcFilters.filters as OgcFilterDuringOptions;\n        if (filterDuring.calendarModeYear) {\n          initOgcFilters.advancedOgcFilters = false;\n        }\n      }\n      if (initOgcFilters.pushButtons) {\n        initOgcFilters.pushButtons.selectorType = 'pushButton';\n      }\n      if (initOgcFilters.checkboxes) {\n        initOgcFilters.checkboxes.selectorType = 'checkbox';\n      }\n      if (initOgcFilters.radioButtons) {\n        initOgcFilters.radioButtons.selectorType = 'radioButton';\n      }\n      if (initOgcFilters.select) {\n        initOgcFilters.select.selectorType = 'select';\n      }\n      if (initOgcFilters.autocomplete) {\n        initOgcFilters.autocomplete.selectorType = 'autocomplete';\n      }\n    }\n\n    if (\n      sourceParams.LAYERS.split(',').length > 1 &&\n      initOgcFilters &&\n      initOgcFilters.enabled\n    ) {\n      console.log('*******************************');\n      console.log(\n        'BE CAREFULL, YOUR WMS LAYERS (' +\n          sourceParams.LAYERS +\n          ') MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! '\n      );\n      console.log('*******************************');\n    }\n\n    if (\n      options.paramsWFS &&\n      initOgcFilters &&\n      initOgcFilters.enabled &&\n      initOgcFilters.editable &&\n      (options.sourceFields || []).filter((sf) => !sf.values).length > 0\n    ) {\n      this.wfsService.getSourceFieldsFromWFS(options);\n    }\n\n    const filterQueryString = ogcFilterWriter.handleOgcFiltersAppliedValue(\n      options,\n      fieldNameGeometry\n    );\n    sourceParams.FILTER = filterQueryString;\n    this.ol.updateParams({ FILTER: sourceParams.FILTER });\n    this.setOgcFilters(initOgcFilters, true);\n\n    const timeFilterableDataSourceOptions =\n      options as TimeFilterableDataSourceOptions;\n    if (\n      timeFilterableDataSourceOptions?.timeFilterable &&\n      timeFilterableDataSourceOptions?.timeFilter\n    ) {\n      this.setTimeFilter(timeFilterableDataSourceOptions.timeFilter, true);\n    }\n  }\n\n  refresh() {\n    this.ol.updateParams({ igoRefresh: Math.random() });\n  }\n\n  private buildDynamicDownloadUrlFromParamsWFS(asWFSDataSourceOptions) {\n    const queryStringValues = formatWFSQueryString(asWFSDataSourceOptions);\n    const downloadUrl = queryStringValues.find(\n      (f) => f.name === 'getfeature'\n    ).value;\n    return downloadUrl;\n  }\n\n  protected createOlSource(): olSourceImageWMS {\n    return new olSourceImageWMS(Object.assign({ ratio: 1 }, this.options));\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    if (triggerEvent) {\n      this.ol.notify('ogcFilters', this.ogcFilters);\n    }\n  }\n\n  setTimeFilter(timeFilter: TimeFilterOptions, triggerEvent: boolean = false) {\n    this.timeFilter = timeFilter;\n    if (triggerEvent) {\n      this.timeFilter$.next(this.timeFilter);\n      this.ol.notify('timeFilter', this.ogcFilters);\n    }\n  }\n\n  getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    let legend = super.getLegend();\n    if (legend.length > 0 && style === undefined && !view?.scale) {\n      return legend;\n    }\n\n    let contentDependent = false;\n    let projParam;\n\n    if (\n      view?.size &&\n      view?.extent &&\n      view?.projection &&\n      this.options.contentDependentLegend\n    ) {\n      projParam =\n        this.params.VERSION === '1.3.0' || this.params.VERSION === undefined\n          ? 'CRS'\n          : 'SRS';\n      contentDependent = true;\n    }\n\n    const sourceParams = this.params;\n\n    let layers = [];\n    if (sourceParams.LAYERS !== undefined) {\n      layers = sourceParams.LAYERS.split(',');\n    }\n\n    const baseUrl = this.options.url.replace(/\\?$/, '');\n    const params = [\n      'REQUEST=GetLegendGraphic',\n      'SERVICE=WMS',\n      'FORMAT=image/png',\n      'SLD_VERSION=1.1.0',\n      `VERSION=${sourceParams.VERSION || '1.3.0'}`\n    ];\n    if (style !== undefined) {\n      params.push(`STYLE=${style}`);\n    }\n    if (view?.scale !== undefined) {\n      params.push(`SCALE=${view.scale}`);\n    }\n    if (contentDependent) {\n      params.push(`WIDTH=${view.size[0]}`);\n      params.push(`HEIGHT=${view.size[1]}`);\n      params.push(`BBOX=${view.extent.join(',')}`);\n      params.push(`${projParam}=${view.projection}`);\n    }\n\n    legend = layers.map((layer: string) => {\n      const separator = baseUrl.match(/\\?/) ? '&' : '?';\n      return {\n        url: `${baseUrl}${separator}${params.join('&')}&LAYER=${layer}`,\n        title: layers.length > 1 ? layer : undefined,\n        currentStyle: style === undefined ? undefined : (style as string)\n      };\n    });\n\n    return legend;\n  }\n\n  public onUnwatch() {}\n}\n\nexport interface TimeFilterableDataSource extends WMSDataSource {\n  options: TimeFilterableDataSourceOptions;\n  timeFilter$: BehaviorSubject<TimeFilterOptions>;\n  setTimeFilter(ogcFilters: TimeFilterOptions, triggerEvent?: boolean);\n  filterByDate(date: Date | [Date, Date]);\n  filterByYear(year: string | [string, string]);\n}\n","import olTileGridWMTS from 'ol/tilegrid/WMTS';\nimport * as olproj from 'ol/proj';\nimport {\n  getTopLeft as extentGetTopLeft,\n  getWidth as extentGetWidth\n} from 'ol/extent.js';\n\nexport function createDefaultTileGrid(epsg?: string): olTileGridWMTS {\n  const projection = epsg ? olproj.get(epsg) : olproj.get('EPSG:3857');\n  const projectionExtent = projection.getExtent();\n  const size = extentGetWidth(projectionExtent) / 256;\n  const resolutions = new Array(20);\n  const matrixIds = new Array(20);\n  for (let z = 0; z < 20; ++z) {\n    resolutions[z] = size / Math.pow(2, z);\n    matrixIds[z] = z;\n  }\n\n  return new olTileGridWMTS({\n    origin: extentGetTopLeft(projectionExtent),\n    resolutions,\n    matrixIds\n  });\n}\n","import { Options } from 'ol/source/WMTS';\nimport olSourceWMTS from 'ol/source/WMTS';\n\nimport { createDefaultTileGrid } from '../../utils/tilegrid';\nimport { DataSource } from './datasource';\nimport { WMTSDataSourceOptions } from './wmts-datasource.interface';\n\nexport class WMTSDataSource extends DataSource {\n  public declare options: WMTSDataSourceOptions;\n  public declare ol: olSourceWMTS;\n\n  constructor(options: WMTSDataSourceOptions) {\n    super(options);\n  }\n\n  protected createOlSource(): olSourceWMTS {\n    const sourceOptions = Object.assign(\n      {\n        tileGrid: createDefaultTileGrid(this.options.projection as string)\n      },\n      this.options\n    ) as Options;\n\n    return new olSourceWMTS(sourceOptions);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceCarto from 'ol/source/CartoDB';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { CartoDataSourceOptions } from './carto-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\n\nexport class CartoDataSource extends DataSource {\n  public declare ol: olSourceCarto;\n  public declare options: CartoDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceCarto {\n    const crossOrigin = this.options.crossOrigin\n      ? this.options.crossOrigin\n      : 'anonymous';\n    const sourceOptions = Object.assign(\n      {\n        crossOrigin\n      },\n      this.options\n    );\n    return new olSourceCarto(sourceOptions);\n  }\n\n  getLegend(): Legend[] {\n    const legend = super.getLegend();\n    if (legend.length > 0) {\n      return legend;\n    }\n\n    let htmlString = '<table>';\n    if (this.options.config.layers[0].legend !== null) {\n      this.options.config.layers[0].legend.items.forEach((f) => {\n        if (f.visible === true) {\n          htmlString +=\n            '<tr><td>' +\n            '<p><font size=\"5\" color=\"' +\n            f.value +\n            '\"> &#9679</font></p></td>' +\n            '<td>' +\n            f.name +\n            '</td></tr>';\n        }\n      });\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    } else {\n      // Try to build the legend from the cartocss options\n      const layerOptions = this.options.config.layers[0].options;\n      // All available cartocss style options\n      const types = [\n        'polygon-fill:',\n        'marker-fill:',\n        'shield-fill:',\n        'building-fill:',\n        'line-color:'\n      ];\n      for (const oneType of types) {\n        if (layerOptions.cartocss.includes(oneType)) {\n          const type = layerOptions.cartocss.split(oneType).pop();\n          const color = type.substr(0, type.indexOf(';'));\n          if (color.includes('ramp')) {\n            const colors = color.split(', (')[1].split(',');\n            const data = color.split(', (')[2].split(',');\n            for (let j = 0; j < colors.length; j++) {\n              colors[j] = colors[j].replace(/(\"|\\))/g, '');\n              data[j] = data[j].replace(/(\"|\\))/g, '');\n              if (data[j].replace(/\\s+/g, '') === '=') {\n                data[j] = 'Autres';\n              }\n              htmlString +=\n                '<tr><td>' +\n                '<p><font size=\"5\" color=\"' +\n                colors[j] +\n                '\"> &#9679</font></p></td>' +\n                '<td>' +\n                data[j] +\n                '</td></tr>';\n            }\n            break;\n          } else {\n            const title = layerOptions.layer_name\n              ? layerOptions.layer_name\n              : '';\n            htmlString +=\n              '<tr><td>' +\n              '<p><font size=\"5\" color=\"' +\n              color +\n              '\"> &#9679</font></p>' +\n              '</td><td>' +\n              title +\n              '</td></tr>';\n            break;\n          }\n        }\n      }\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    }\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceVector from 'ol/source/Vector';\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\nimport * as olloadingstrategy from 'ol/loadingstrategy';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { ArcGISRestDataSourceOptions } from './arcgisrest-datasource.interface';\n\nexport class ArcGISRestDataSource extends DataSource {\n  public declare ol: olSourceVector<OlGeometry>;\n  public declare options: ArcGISRestDataSourceOptions;\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const esrijsonFormat = new olFormatEsriJSON();\n    return new olSourceVector({\n      attributions: this.options.params.attributions,\n      overlaps: false,\n      format: esrijsonFormat,\n      url: function (extent, resolution, proj) {\n        const baseUrl = this.options.url + '/' + this.options.layer + '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        if (this.options.params.time) {\n          const time = `time=${this.options.params.time}`;\n          params.push(time);\n        }\n        if (this.options.params.customParams) {\n          this.options.params.customParams.forEach((element) => {\n            params.push(element);\n          });\n        }\n        return `${baseUrl}?${params.join('&')}`;\n      }.bind(this),\n      strategy: olloadingstrategy.bbox\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || legend.length > 0) {\n      return legend;\n    }\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n    let src: string;\n    let label: string;\n    let svg: string;\n\n    if (legendInfo.legend) {\n      for (const legendElement of legendInfo.legend) {\n        src = this.htmlImgSrc(\n          legendElement.contentType,\n          legendElement.imageData\n        );\n        label = legendElement.label\n          ? legendElement.label.replace('<Null>', 'Null')\n          : '';\n        htmlString +=\n          `<tr><td align='left'><img src=\"` +\n          src +\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      }\n    } else if (legendInfo.type === 'uniqueValue') {\n      for (const legendElement of legendInfo.uniqueValueInfos) {\n        label = legendElement.label.replace('<Null>', 'Null');\n        if (legendElement.symbol.type === 'esriPMS') {\n          src = this.htmlImgSrc(\n            legendElement.symbol.contentType,\n            legendElement.symbol.imageData\n          );\n          htmlString +=\n            `<tr><td align='left'><img src=\"` +\n            src +\n            `\" alt ='' /></td><td class=\"mat-typography\">` +\n            label +\n            '</td></tr>';\n        } else if (legendElement.symbol.type !== 'esriPMS') {\n          svg = this.createSVG(legendElement.symbol);\n          htmlString +=\n            `<tr><td align='left'>` +\n            svg +\n            `</td><td class=\"mat-typography\">` +\n            label +\n            '</td></tr>';\n        }\n      }\n    } else if (legendInfo.type === 'simple') {\n      label = legendInfo.label\n        ? legendInfo.label.replace('<Null>', 'Null')\n        : '';\n      if (legendInfo.symbol.type === 'esriPMS') {\n        src = this.htmlImgSrc(\n          legendInfo.symbol.contentType,\n          legendInfo.symbol.imageData\n        );\n        htmlString +=\n          `<tr><td align='left'><img src=\"` +\n          src +\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      } else if (legendInfo.symbol.type !== 'esriPMS') {\n        svg = this.createSVG(legendInfo.symbol);\n        htmlString +=\n          `<tr><td align='left'>` +\n          svg +\n          `</td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      }\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  htmlImgSrc(contentType: string, imageData: string): string {\n    return `data:${contentType};base64,${imageData}`;\n  }\n\n  createSVG(symbol): string {\n    let svg: string = '';\n\n    const color: Array<number> = symbol.color ? symbol.color : [0, 0, 0, 0];\n\n    if (symbol.type === 'esriSLS') {\n      const width: number = symbol.width ? symbol.width : 0;\n\n      const stroke: string =\n        `stroke:rgba(` +\n        color[0] +\n        ',' +\n        color[1] +\n        ',' +\n        color[2] +\n        ',' +\n        color[3] +\n        ')';\n      const strokeWidth: string = `stroke-width:` + width;\n\n      if (symbol.style === 'esriSLSSolid') {\n        svg =\n          `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` +\n          stroke +\n          ';' +\n          strokeWidth +\n          `\"/></svg>`;\n      } else if (symbol.style === 'esriSLSDash') {\n        const strokeDashArray: string = `stroke-dasharray=\"5,5\"`;\n        svg =\n          `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` +\n          stroke +\n          ';' +\n          strokeWidth +\n          `\" ` +\n          strokeDashArray +\n          `/></svg>`;\n      }\n    } else if (\n      symbol.style === 'esriSMSCircle' ||\n      symbol.style === 'esriSFSSolid'\n    ) {\n      const outlineColor = symbol.outline.color;\n      const outlineWidth = symbol.outline.width;\n      const size = symbol.size;\n\n      const stroke =\n        `stroke:rgba(` +\n        outlineColor[0] +\n        ',' +\n        outlineColor[1] +\n        ',' +\n        outlineColor[2] +\n        ',' +\n        outlineColor[3] +\n        ')';\n      const strokeWidth = `stroke-width:` + outlineWidth;\n      const fill =\n        `fill:rgba(` +\n        color[0] +\n        ',' +\n        color[1] +\n        ',' +\n        color[2] +\n        ',' +\n        color[3] +\n        ')';\n\n      if (symbol.style === 'esriSMSCircle') {\n        svg =\n          `<svg height=\"30\" width=\"30\"><circle cx=\"15\" cy=\"15\" r=\"` +\n          size / 2 +\n          `\" style=\"` +\n          stroke +\n          ';' +\n          strokeWidth +\n          ';' +\n          fill +\n          `\"/></svg>`;\n      } else {\n        svg =\n          `<svg height=\"30\" width=\"30\"><rect x=\"5\" y=\"5\" width=\"20\" height=\"20\" style =\"` +\n          stroke +\n          ';' +\n          strokeWidth +\n          ';' +\n          fill +\n          `\"/></svg>`;\n      }\n    }\n    return svg;\n  }\n\n  public onUnwatch() {}\n}\n","import ImageArcGISRest from 'ol/source/ImageArcGISRest';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { ArcGISRestImageDataSourceOptions } from './imagearcgisrest-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nexport class ImageArcGISRestDataSource extends DataSource {\n  public declare ol: ImageArcGISRest;\n  public declare options: ArcGISRestImageDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): ImageArcGISRest {\n    const params =\n      this.options.layer === undefined\n        ? this.options.params\n        : Object.assign(\n            { LAYERS: `show:${this.options.layer}` },\n            this.options.params\n          );\n\n    if (typeof params.renderingRule === 'object') {\n      params.renderingRule = JSON.stringify(params.renderingRule);\n    }\n\n    return new ImageArcGISRest({\n      ratio: 1,\n      params,\n      url: this.options.url\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (\n      legendInfo === undefined ||\n      this.options.layer === undefined ||\n      legend.length > 0\n    ) {\n      return legend;\n    }\n\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const legendElement of legendInfo.legend) {\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\n      const label = legendElement.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceTileArcGISRest from 'ol/source/TileArcGISRest';\nimport { Options } from 'ol/source/TileArcGISRest';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { TileArcGISRestDataSourceOptions } from './tilearcgisrest-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\n\nexport class TileArcGISRestDataSource extends DataSource {\n  public declare ol: olSourceTileArcGISRest;\n  public declare options: TileArcGISRestDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceTileArcGISRest {\n    return new olSourceTileArcGISRest(this.options as Options);\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (\n      legendInfo === undefined ||\n      this.options.layer === undefined ||\n      legend.length > 0\n    ) {\n      return legend;\n    }\n\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const legendElement of legendInfo.legend) {\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\n      const label = legendElement.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import TileDebug from 'ol/source/TileDebug';\nimport TileGrid from 'ol/tilegrid/TileGrid';\n\nimport { DataSource } from './datasource';\nimport { TileDebugDataSourceOptions } from './tiledebug-datasource.interface';\n\nexport class TileDebugDataSource extends DataSource {\n  public declare options: TileDebugDataSourceOptions;\n  public declare ol: TileDebug;\n\n  protected createOlSource(): TileDebug {\n    const baseOptions = JSON.parse(JSON.stringify(this.options)); // to avoid to alter the original options\n    if (this.options.tileGrid) {\n      delete baseOptions.tileGrid;\n      baseOptions.tileGrid = new TileGrid(this.options.tileGrid);\n    }\n    return new TileDebug(baseOptions);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceVector from 'ol/source/Vector';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { WebSocketDataSourceOptions } from './websocket-datasource.interface';\n\nexport class WebSocketDataSource extends FeatureDataSource {\n  public ws: WebSocket;\n  public declare options: WebSocketDataSourceOptions;\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    this.createWebSocket();\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    return super.createOlSource();\n  }\n\n  private createWebSocket() {\n    this.ws = new WebSocket(this.options.url);\n    this.ws.onmessage = this.onMessage.bind(this);\n\n    if (this.options.onclose) {\n      this.ws.onclose = this.onClose.bind(this);\n    }\n\n    if (this.options.onerror) {\n      this.ws.onerror = this.onError.bind(this);\n    }\n\n    if (this.options.onopen) {\n      this.ws.onopen = this.onOpen.bind(this);\n    }\n  }\n\n  onMessage(event) {\n    const featureAdded = this.options.format.readFeature(\n      event.data\n    ) as olFeature<OlGeometry>;\n\n    switch (this.options.onmessage) {\n      case 'update':\n        // ol don't add if same ID\n        const featureToRemove = this.ol.getFeatureById(featureAdded.getId());\n        if (featureToRemove) {\n          this.ol.removeFeature(featureToRemove);\n        }\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'delete':\n        this.ol.clear(true);\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'add':\n      default:\n        this.ol.addFeature(featureAdded);\n    }\n  }\n\n  onClose(event) {\n    // thrown message to user\n  }\n\n  onError(event) {\n    // thrown message to user\n  }\n\n  onOpen(event) {\n    // thrown message to user ?\n  }\n\n  public onUnwatch() {\n    this.ws.close();\n  }\n}\n","import { Md5 } from 'ts-md5';\nimport feature from 'ol/Feature';\nimport olSourceVectorTile from 'ol/source/VectorTile';\nimport olFormatMVT from 'ol/format/MVT';\n\nimport { uuid } from '@igo2/utils';\n\nimport { DataSource } from './datasource';\nimport { MVTDataSourceOptions } from './mvt-datasource.interface';\n\nexport class MVTDataSource extends DataSource {\n  public declare options: MVTDataSourceOptions;\n  public declare ol: olSourceVectorTile;\n\n  protected createOlSource(): olSourceVectorTile {\n    let mvtFormat;\n    if (this.options.featureClass === 'feature') {\n      mvtFormat = new olFormatMVT({ featureClass: feature });\n    } else {\n      mvtFormat = new olFormatMVT();\n    }\n    this.options.format = mvtFormat;\n    return new olSourceVectorTile(this.options);\n  }\n\n  protected generateId() {\n    if (!this.options.url) {\n      return uuid();\n    }\n    const chain = 'mvt' + this.options.url;\n    return Md5.hashStr(chain) as string;\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceCluster from 'ol/source/Cluster';\n\nimport { uuid } from '@igo2/utils';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { ClusterDataSourceOptions } from './cluster-datasource.interface';\n\nexport class ClusterDataSource extends FeatureDataSource {\n  public declare options: ClusterDataSourceOptions;\n  public declare ol: olSourceCluster;\n\n  protected createOlSource(): olSourceCluster {\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    this.options.source = super.createOlSource();\n    return new olSourceCluster(this.options);\n  }\n\n  protected generateId() {\n    return uuid();\n  }\n\n  public onUnwatch() {}\n}\n","import * as olproj from 'ol/proj';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { MAC } from 'ol/has';\n\nimport { NumberUtils } from '@igo2/utils';\n\nimport { MapViewState } from './map.interface';\nimport { Projection } from './projection.interfaces';\n\n/**\n * This method extracts a coordinate tuple from a string.\n * @param str Any string\n * @param mapProjection string Map Projection\n * @param opts.forceNA boolean Force North America Zone\n * @returns object:\n *             lonLat: Coordinate,\n *             message: Message of error,\n *             radius: radius of the confience of coordinate,\n *             conf: confidence of the coordinate}\n */\nexport function stringToLonLat(\n  str: string,\n  mapProjection: string,\n  opts: { forceNA?: boolean } = {}\n): {\n  lonLat: [number, number] | undefined;\n  message: string;\n  radius: number | undefined;\n  conf: number | undefined;\n} {\n  let lonLat: [number, number];\n  let coordStr: string;\n  let negativeLon: string;\n  let degreesLon: string;\n  let minutesLon: string;\n  let secondsLon: string;\n  let directionLon: string;\n  let decimalLon: string;\n  let negativeLat: string;\n  let degreesLat: string;\n  let minutesLat: string;\n  let secondsLat: string;\n  let directionLat: string;\n  let decimalLat: string;\n  let zone: string;\n  let radius: string;\n  let conf: string;\n  let lon: any;\n  let lat: any;\n\n  const projectionPattern = '(\\\\s*;\\\\s*[\\\\d]{4,6})';\n  const toProjection = '4326';\n  let projectionStr: string;\n  const projectionRegex = new RegExp(projectionPattern, 'g');\n\n  const lonlatCoord = '([-+])?([\\\\d]{1,3})([,.](\\\\d+))?';\n  const lonLatPattern = `${lonlatCoord}[\\\\s,]+${lonlatCoord}`;\n  const lonLatRegex = new RegExp(`^${lonLatPattern}$`, 'g');\n\n  const dmsCoord =\n    '([0-9]{1,2})[:|°]?\\\\s*([0-9]{1,2})?[:|\\'|′|’]?\\\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\\\s*[\"|″|”]?\\\\s*';\n  const dmsCoordPattern = `${dmsCoord}([N|S|E|W|O]),?\\\\s*${dmsCoord}([N|S|E|W|O])`;\n  const dmsRegex = new RegExp(`^${dmsCoordPattern}$`, 'gi');\n\n  const patternUtm =\n    '(UTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const utmRegex = new RegExp(`^${patternUtm}`, 'gi');\n\n  const patternMtm =\n    '(MTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const mtmRegex = new RegExp(`^${patternMtm}`, 'gi');\n\n  const ddCoord = '([-+])?(\\\\d{1,3})[,.](\\\\d+)';\n  const patternDd = `${ddCoord}\\\\s*[,]?\\\\s*${ddCoord}`;\n  const ddRegex = new RegExp(`^${patternDd}`, 'g');\n\n  const dmdCoord =\n    '([-+])?(\\\\d{1,3})[\\\\s,.]{1}(\\\\d{1,2})[\\\\s,.]{1}(\\\\d{1,2})[.,]?(\\\\d{1,5})?';\n  const patternDmd = `${dmdCoord}\\\\s*[,.]?\\\\s*${dmdCoord}`;\n  const dmdRegex = new RegExp(`^${patternDmd}`, 'g');\n\n  /* eslint-disable max-len */\n  const patternBELL =\n    'LAT\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,2})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*LONG\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,3})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*UNC\\\\s*[\\\\s:]?\\\\s*(\\\\d+)\\\\s*CONF\\\\s*[\\\\s:]?\\\\s*(\\\\d{1,3})';\n  const bellRegex = new RegExp(`^${patternBELL}?`, 'gi');\n\n  const mmCoord = '([-+]?\\\\d+)[,.]?(\\\\d+)?';\n  const mmPattern = `${mmCoord}[\\\\s,]+${mmCoord}`;\n  const mmRegex = new RegExp(`^${mmPattern}$`, 'g');\n\n  let isXYCoords = false;\n\n  str = str.toLocaleUpperCase().trim();\n\n  // Extract projection\n  if (projectionRegex.test(str)) {\n    [coordStr, projectionStr] = str.split(';').map((s) => s.trim());\n  } else {\n    coordStr = str;\n  }\n  if (lonLatRegex.test(coordStr)) {\n    [, negativeLon, lon, , decimalLon, negativeLat, lat, , decimalLat] =\n      coordStr.match(lonLatPattern);\n\n    lon = parseFloat((negativeLon ? negativeLon : '') + lon + '.' + decimalLon);\n    lat = parseFloat((negativeLat ? negativeLat : '') + lat + '.' + decimalLat);\n  } else if (dmsRegex.test(coordStr)) {\n    [\n      ,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      directionLon,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      directionLat\n    ] = coordStr.match(dmsCoordPattern);\n\n    if (directionLon === 'S' || directionLon === 'N') {\n      degreesLon = [degreesLat, (degreesLat = degreesLon)][0];\n      minutesLon = [minutesLat, (minutesLat = minutesLon)][0];\n      secondsLon = [secondsLat, (secondsLat = secondsLon)][0];\n      directionLon = [directionLat, (directionLat = directionLon)][0];\n    }\n\n    lon = convertDMSToDD(\n      parseFloat(degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat(degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (utmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternUtm);\n    const epsgUtm = Number(zone) < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgUtm,\n      'EPSG:4326'\n    );\n  } else if (mtmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternMtm);\n    const epsgMtm =\n      Number(zone) < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + Number(zone)}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgMtm,\n      'EPSG:4326'\n    );\n  } else if (dmdRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      decimalLat\n    ] = coordStr.match(patternDmd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (ddRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      decimalLat\n    ] = coordStr.match(patternDd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (bellRegex.test(coordStr)) {\n    [\n      ,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      ,\n      directionLat,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      ,\n      directionLon,\n      radius,\n      conf\n    ] = coordStr.match(patternBELL);\n\n    // Set default value for North America\n    if (!directionLon) {\n      directionLon = 'W';\n    }\n\n    // Check if real minutes or decimals\n    if (minutesLon && minutesLon.length > 2) {\n      lon = parseFloat(\n        (negativeLon ? negativeLon : '') + degreesLon + '.' + minutesLon\n      );\n    } else {\n      lon = convertDMSToDD(\n        parseFloat(degreesLon),\n        parseFloat(minutesLon),\n        parseFloat(secondsLon),\n        directionLon\n      );\n    }\n\n    if (minutesLat && minutesLat.length > 2) {\n      lat = parseFloat(\n        (negativeLat ? negativeLat : '') + degreesLat + '.' + minutesLat\n      );\n    } else {\n      lat = convertDMSToDD(\n        parseFloat(degreesLat),\n        parseFloat(minutesLat),\n        parseFloat(secondsLat),\n        directionLat\n      );\n    }\n  } else if (mmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, lon, decimalLon, lat, decimalLat] = coordStr.match(mmPattern);\n\n    if (decimalLon) {\n      lon = parseFloat(lon + '.' + decimalLon);\n    }\n\n    if (decimalLat) {\n      lat = parseFloat(lat + '.' + decimalLat);\n    }\n  } else {\n    return {\n      lonLat: undefined,\n      message: '',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n\n  if (opts.forceNA && !isXYCoords) {\n    // Set a negative coordinate for North America zone\n    if (lon > 0 && lat > 0) {\n      if (lon > lat) {\n        lon = -lon;\n      } else {\n        lat = -lat;\n      }\n    }\n\n    // Reverse coordinate to respect lonLat convention\n    if (lon > lat) {\n      lon = [lat, (lat = lon)][0];\n    }\n  }\n\n  lonLat = [Number(lon), Number(lat)] as [number, number];\n\n  // Reproject the coordinate if projection parameter have been set and coord is not 4326\n  if (\n    (projectionStr !== undefined && projectionStr !== toProjection) ||\n    lonLat[0] > 180 ||\n    lonLat[0] < -180 ||\n    lonLat[1] > 90 ||\n    lonLat[1] < -90\n  ) {\n    const source = projectionStr ? 'EPSG:' + projectionStr : mapProjection;\n    const dest = 'EPSG:' + toProjection;\n\n    try {\n      lonLat = olproj.transform(lonLat, source, dest) as [number, number];\n    } catch (e) {\n      return {\n        lonLat: undefined,\n        message: 'Projection ' + source + ' not supported',\n        radius: undefined,\n        conf: undefined\n      };\n    }\n  }\n  if (Math.abs(lonLat[0]) <= 180 && Math.abs(lonLat[1]) <= 90) {\n    return {\n      lonLat,\n      message: '',\n      radius: radius ? parseInt(radius, 10) : undefined,\n      conf: conf ? parseInt(conf, 10) : undefined\n    };\n  } else {\n    return {\n      lonLat: undefined,\n      message: 'Coordinate out of Longitude/Latitude bounds',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n}\n\n/**\n * Convert degrees minutes seconds to dd\n * @param degrees Degrees\n * @param minutes Minutes\n * @param seconds Seconds\n * @param direction Direction\n */\nfunction convertDMSToDD(\n  degrees: number,\n  minutes: number,\n  seconds: number,\n  direction: string\n) {\n  minutes = minutes || 0;\n  seconds = seconds || 0;\n\n  const neg = degrees < 0;\n  let dd = Math.abs(degrees) + minutes / 60 + seconds / 3600;\n\n  if (neg || direction === 'S' || direction === 'W') {\n    dd = -dd;\n  } // Don't do anything for N or E\n  return dd;\n}\n\n/**\n * Convert dd to degrees minutes seconds\n * @param lonLatDD longitude and latitude in dd\n * @param decimal number of decimals for seconds\n * @returns longitude and latitude in dms\n */\nexport function convertDDToDMS(\n  lonLatDD: [number, number],\n  decimal: number = 3\n): string[] {\n  const lonLatDMS = [];\n\n  lonLatDD.forEach((dd) => {\n    const degrees = dd < 0 ? Math.ceil(dd) : Math.floor(dd);\n    const int = dd < 0 ? (degrees - dd) * 60 : (dd - degrees) * 60;\n    const minutes = Math.floor(int);\n    const seconds = ((int - minutes) * 60).toFixed(decimal);\n\n    lonLatDMS.push(`${degrees}° ${minutes}' ${seconds}\"`);\n  });\n  return lonLatDMS;\n}\n\n/**\n * Return true of two view states are equal.\n * @param state1 View state\n * @param state2 View state\n * @returns True if the view states are equal\n */\nexport function viewStatesAreEqual(\n  state1: MapViewState,\n  state2: MapViewState\n): boolean {\n  if (state1 === undefined || state2 === undefined) {\n    return false;\n  }\n\n  const tolerance = 1 / 10000;\n  return (\n    state1.zoom === state2.zoom &&\n    Math.trunc(state1.center[0] / tolerance) ===\n      Math.trunc(state2.center[0] / tolerance) &&\n    Math.trunc(state1.center[1] / tolerance) ===\n      Math.trunc(state2.center[1] / tolerance)\n  );\n}\n\n/**\n * Format the scale to a human readable text\n * @param Scale of the map\n * @returns Human readable scale text\n */\nexport function formatScale(scale) {\n  scale = Math.round(scale);\n  if (scale < 10000) {\n    return scale + '';\n  }\n\n  scale = Math.round(scale / 1000);\n  if (scale < 1000) {\n    return scale + 'K';\n  }\n\n  scale = Math.round(scale / 1000);\n  return scale + 'M';\n}\n\n/**\n * Return the resolution from a scale denom\n * @param scale Scale denom\n * @param dpi DPI\n * @returns Resolution\n */\nexport function getResolutionFromScale(\n  scale: number,\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return scale / (inchesPerMeter * dpi);\n}\n\n/**\n * Return the resolution from a scale denom\n * @param Scale denom\n * @returns Resolution\n */\nexport function getScaleFromResolution(\n  resolution: number,\n  unit: string = 'm',\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return resolution * olproj.METERS_PER_UNIT[unit] * inchesPerMeter * dpi;\n}\n\n/**\n * Returns true if the CTRL key is pushed during an Ol MapBrowserPointerEvent\n * @param event OL MapBrowserPointerEvent\n * @returns Whether the CTRL key is pushed\n */\nexport function ctrlKeyDown(event: MapBrowserPointerEvent<any>): boolean {\n  const originalEvent = event.originalEvent;\n  return (\n    !originalEvent.altKey &&\n    (MAC ? originalEvent.metaKey : originalEvent.ctrlKey) &&\n    !originalEvent.shiftKey\n  );\n}\n\nexport function roundCoordTo(\n  coord: [number, number],\n  decimal: number = 3\n): [number, number] {\n  return [\n    NumberUtils.roundToNDecimal(coord[0], decimal),\n    NumberUtils.roundToNDecimal(coord[1], decimal)\n  ] as [number, number];\n}\n\nexport function roundCoordToString(\n  coord: [number, number],\n  decimal: number = 3\n): [string, string] {\n  return roundCoordTo(coord, decimal).map((r) => r.toString()) as [\n    string,\n    string\n  ];\n}\n\n/**\n * Returns an array of converted coordinates.\n * Conversion is done for every configured projections\n * and for the current UTM zone and MTM zone.\n * @param lonLat [number, number] array of the coordinate to transform.\n * @param projections  Projection[] Array of destination projection.\n * @param reverseCoords To reverse coords from latLon to lonLat (search option)\n * @returns Returns an array of converted coordinates.\n */\nexport function lonLatConversion(\n  lonLat: [number, number],\n  projections: Projection[]\n): {\n  code: string;\n  alias: string;\n  coord: [number, number];\n  igo2CoordFormat: string;\n}[] {\n  const rawCoord3857 = olproj.transform(lonLat, 'EPSG:4326', 'EPSG:3857') as [\n    number,\n    number\n  ];\n  const convertedLonLat = [\n    {\n      code: 'EPSG:3857',\n      alias: 'Web Mercator',\n      coord: rawCoord3857,\n      igo2CoordFormat: `${roundCoordTo(rawCoord3857).join(', ')} ; 3857`\n    }\n  ];\n\n  // detect the current utm zone.\n  const utmZone = utmZoneFromLonLat(lonLat);\n  const epsgUtm = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n  const utmName = `UTM-${utmZone}`;\n  const rawCoordUtm = olproj.transform(lonLat, 'EPSG:4326', epsgUtm) as [\n    number,\n    number\n  ];\n  convertedLonLat.push({\n    code: epsgUtm,\n    alias: 'UTM',\n    coord: rawCoordUtm,\n    igo2CoordFormat: `${utmName} ${roundCoordTo(rawCoordUtm).join(', ')}`\n  });\n\n  // detect the current mtm zone.\n  const mtmZone = mtmZoneFromLonLat(lonLat);\n  if (mtmZone) {\n    const epsgMtm =\n      mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n    const mtmName = `MTM-${mtmZone}`;\n    const rawCoordMtm = olproj.transform(lonLat, 'EPSG:4326', epsgMtm) as [\n      number,\n      number\n    ];\n    convertedLonLat.push({\n      code: epsgMtm,\n      alias: 'MTM',\n      coord: rawCoordMtm,\n      igo2CoordFormat: `${mtmName} ${roundCoordTo(rawCoordMtm).join(', ')}`\n    });\n  }\n\n  projections.forEach((projection) => {\n    const rawCoord = olproj.transform(lonLat, 'EPSG:4326', projection.code) as [\n      number,\n      number\n    ];\n    const numericEpsgCode = projection.code.split(':')[1];\n    convertedLonLat.push({\n      code: projection.code,\n      alias: projection.alias || projection.code,\n      coord: rawCoord,\n      igo2CoordFormat: `${roundCoordTo(rawCoord).join(\n        ', '\n      )} ; ${numericEpsgCode}`\n    });\n  });\n\n  return convertedLonLat;\n}\n\n/**\n * Detect the current utm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the UTM zone.\n * @returns number The UTM zone.\n */\nexport function utmZoneFromLonLat(lonLat: [number, number]) {\n  return Math.ceil((lonLat[0] + 180) / 6);\n}\n\n/**\n * Detect the current mtm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the MTM zone.\n * @returns number The MTM zone. Undefined if outside of the mtm application zone.\n */\nexport function mtmZoneFromLonLat(lonLat: [number, number]) {\n  const long = lonLat[0];\n  let mtmZone;\n  if (long < -51 && long > -54) {\n    mtmZone = 1;\n  }\n  if (long < -54 && long > -57) {\n    mtmZone = 2;\n  }\n  if (long < -57 && long > -60) {\n    mtmZone = 3;\n  }\n  if (long < -60 && long > -63) {\n    mtmZone = 4;\n  }\n  if (long < -63 && long > -66) {\n    mtmZone = 5;\n  }\n  if (long < -66 && long > -69) {\n    mtmZone = 6;\n  }\n  if (long < -69 && long > -72) {\n    mtmZone = 7;\n  }\n  if (long < -72 && long > -75) {\n    mtmZone = 8;\n  }\n  if (long < -75 && long > -78) {\n    mtmZone = 9;\n  }\n  if (long < -78 && long > -81) {\n    mtmZone = 10;\n  }\n  return mtmZone;\n}\n","import * as olstyle from 'ol/style';\nimport * as olproj from 'ol/proj';\n\nexport class EsriStyleGenerator {\n  public _converters: any;\n  public _renderers: any;\n\n  constructor() {\n    this._converters = {};\n    this._converters.esriPMS = EsriStyleGenerator._convertEsriPMS;\n    this._converters.esriSFS = EsriStyleGenerator._convertEsriSFS;\n    this._converters.esriSLS = EsriStyleGenerator._convertEsriSLS;\n    this._converters.esriSMS = EsriStyleGenerator._convertEsriSMS;\n    this._converters.esriTS = EsriStyleGenerator._convertEsriTS;\n    this._renderers = {};\n    this._renderers.uniqueValue = this._renderUniqueValue;\n    this._renderers.simple = this._renderSimple;\n    this._renderers.classBreaks = this._renderClassBreaks;\n  }\n  static _convertPointToPixel(point) {\n    return point / 0.75;\n  }\n  static _transformColor(color): [number, number, number, number] {\n    // alpha channel is different, runs from 0-255 but in ol3 from 0-1\n    return [color[0], color[1], color[2], color[3] / 255];\n  }\n\n  static _getResolutionForScale(scale, units) {\n    const dpi = 96;\n    const mpu = olproj.METERS_PER_UNIT[units];\n    const inchesPerMeter = 39.3701;\n    return parseFloat(scale) / (mpu * inchesPerMeter * dpi);\n  }\n\n  /* convert an Esri Text Symbol */\n  static _convertEsriTS(symbol) {\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    const text = symbol.text !== undefined ? symbol.text : undefined;\n    return new olstyle.Style({\n      text: new olstyle.Text({\n        fill: new olstyle.Fill({\n          color: EsriStyleGenerator._transformColor(symbol.color)\n        }),\n        font:\n          symbol.font.style +\n          ' ' +\n          symbol.font.weight +\n          ' ' +\n          symbol.font.size +\n          ' px ' +\n          symbol.font.family,\n        textBaseline: symbol.verticalAlignment,\n        textAlign: symbol.horizontalAlignment,\n        offsetX: EsriStyleGenerator._convertPointToPixel(symbol.xoffset),\n        offsetY: EsriStyleGenerator._convertPointToPixel(symbol.yoffset),\n        rotation,\n        text\n      })\n    });\n  }\n  /* convert an Esri Picture Marker Symbol */\n  static _convertEsriPMS(symbol) {\n    const src = 'data:' + symbol.contentType + ';base64, ' + symbol.imageData;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n\n    return new olstyle.Style({\n      image: new olstyle.Icon({\n        src,\n        rotation\n      })\n    });\n  }\n  /* convert an Esri Simple Fill Symbol */\n  static _convertEsriSFS(symbol) {\n    // there is no support in openlayers currently for fill patterns, so style is not interpreted\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    return new olstyle.Style({\n      fill,\n      stroke\n    });\n  }\n  static _convertOutline(outline) {\n    let lineDash;\n    const color = EsriStyleGenerator._transformColor(outline.color);\n    if (outline.style === 'esriSLSDash') {\n      lineDash = [5];\n    } else if (outline.style === 'esriSLSDashDot') {\n      lineDash = [5, 5, 1, 2];\n    } else if (outline.style === 'esriSLSDashDotDot') {\n      lineDash = [5, 5, 1, 2, 1, 2];\n    } else if (outline.style === 'esriSLSDot') {\n      lineDash = [1, 2];\n    } else if (outline.style === 'esriSLSNull') {\n      // line not visible, make color fully transparent\n      color[3] = 0;\n    }\n    return new olstyle.Stroke({\n      color,\n      lineDash,\n      width: EsriStyleGenerator._convertPointToPixel(outline.width)\n    });\n  }\n  /* convert an Esri Simple Line Symbol */\n  static _convertEsriSLS(symbol) {\n    return new olstyle.Style({\n      stroke: EsriStyleGenerator._convertOutline(symbol)\n    });\n  }\n  static _transformAngle(angle) {\n    if (angle === 0 || angle === undefined) {\n      return undefined;\n    }\n    const normalRad = (angle * Math.PI) / 180;\n    const ol3Rad = -normalRad + Math.PI / 2;\n    if (ol3Rad < 0) {\n      return 2 * Math.PI + ol3Rad;\n    } else {\n      return ol3Rad;\n    }\n  }\n  /* convert an Esri Simple Marker Symbol */\n  static _convertEsriSMS(symbol) {\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    const radius = EsriStyleGenerator._convertPointToPixel(symbol.size) / 2;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    if (symbol.style === 'esriSMSCircle') {\n      return new olstyle.Style({\n        image: new olstyle.Circle({\n          radius,\n          fill,\n          stroke\n        })\n      });\n    } else if (symbol.style === 'esriSMSCross') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: 0,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSDiamond') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSSquare') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSX') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSTriangle') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 3,\n          radius,\n          angle: 0,\n          rotation\n        })\n      });\n    }\n  }\n\n  _convertLabelingInfo(labelingInfo, mapUnits) {\n    const styles = [];\n    for (let i = 0, ii = labelingInfo.length; i < ii; ++i) {\n      const labelExpression = labelingInfo[i].labelExpression;\n      // only limited support for label expressions\n      const field = labelExpression.substr(\n        labelExpression.indexOf('[') + 1,\n        labelExpression.indexOf(']') - 1\n      );\n      const symbol = labelingInfo[i].symbol;\n      const maxScale = labelingInfo[i].maxScale;\n      const minScale = labelingInfo[i].minScale;\n      let minResolution = null;\n      if (maxScale !== 0) {\n        minResolution = EsriStyleGenerator._getResolutionForScale(\n          maxScale,\n          mapUnits\n        );\n      }\n      let maxResolution = null;\n      if (minScale !== 0) {\n        maxResolution = EsriStyleGenerator._getResolutionForScale(\n          minScale,\n          mapUnits\n        );\n      }\n      const style = this._converters[symbol.type].call(this, symbol);\n      styles.push(\n        (() => {\n          return function (feature, resolution) {\n            let visible = true;\n            if (this.minResolution !== null && this.maxResolution !== null) {\n              visible =\n                resolution < this.maxResolution &&\n                resolution >= this.minResolution;\n            } else if (this.minResolution !== null) {\n              visible = resolution >= this.minResolution;\n            } else if (this.maxResolution !== null) {\n              visible = resolution < this.maxResolution;\n            }\n            if (visible) {\n              const value = feature.get(this.field);\n              this.style.getText().setText(value);\n              return [this.style];\n            }\n          };\n        })().bind({\n          minResolution,\n          maxResolution,\n          field,\n          style\n        })\n      );\n    }\n    return styles;\n  }\n\n  _renderSimple(renderer) {\n    const style = this._converters[renderer.symbol.type].call(\n      this,\n      renderer.symbol\n    );\n    return (() => {\n      return () => {\n        return [style];\n      };\n    })();\n  }\n  _renderClassBreaks(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    const defaultStyle = this._converters[defaultSymbol.type].call(\n      this,\n      defaultSymbol\n    );\n    const field = renderer.field;\n    const classes = [];\n    for (let i = 0, ii = renderer.classBreakInfos.length; i < ii; ++i) {\n      const classBreakInfo = renderer.classBreakInfos[i];\n      let min;\n      if (\n        classBreakInfo.classMinValue === null ||\n        classBreakInfo.classMinValue === undefined\n      ) {\n        if (i === 0) {\n          min = renderer.minValue;\n        } else {\n          min = renderer.classBreakInfos[i - 1].classMaxValue;\n        }\n      } else {\n        min = classBreakInfo.classMinValue;\n      }\n      const max = classBreakInfo.classMaxValue;\n      const symbol = classBreakInfo.symbol;\n      const style = this._converters[symbol.type].call(this, symbol);\n      classes.push({ min, max, style });\n    }\n    return (() => {\n      return (feature) => {\n        const value = feature.get(field);\n        for (let i = 0, ii = classes.length; i < ii; ++i) {\n          let condition;\n          if (i === 0) {\n            condition = value >= classes[i].min && value <= classes[i].max;\n          } else {\n            condition = value > classes[i].min && value <= classes[i].max;\n          }\n          if (condition) {\n            return [classes[i].style];\n          }\n        }\n        return [defaultStyle];\n      };\n    })();\n  }\n  _renderUniqueValue(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    let defaultStyle = [];\n    if (defaultSymbol) {\n      defaultStyle = [\n        this._converters[defaultSymbol.type].call(this, defaultSymbol)\n      ];\n    }\n    const field = renderer.field1;\n    const infos = renderer.uniqueValueInfos;\n    const me = this;\n    return (() => {\n      const hash = {};\n      for (let i = 0, ii = infos.length; i < ii; ++i) {\n        const info = infos[i];\n        const symbol = info.symbol;\n        hash[info.value] = [me._converters[symbol.type].call(me, symbol)];\n      }\n\n      return (feature) => {\n        const style = hash[feature.get(field)];\n        return style ? style : defaultStyle;\n      };\n    })();\n  }\n  generateStyle(layerInfo, mapUnits) {\n    const drawingInfo = layerInfo.drawingInfo;\n    let styleFunctions = [];\n    const drawingInfoStyle = this._renderers[drawingInfo.renderer.type].call(\n      this,\n      drawingInfo.renderer\n    );\n    if (drawingInfoStyle !== undefined) {\n      styleFunctions.push(drawingInfoStyle);\n    }\n    if (layerInfo.labelingInfo) {\n      const labelingInfoStyleFunctions = this._convertLabelingInfo(\n        layerInfo.labelingInfo,\n        mapUnits\n      );\n      styleFunctions = styleFunctions.concat(labelingInfoStyleFunctions);\n    }\n    if (styleFunctions.length === 1) {\n      return styleFunctions[0];\n    } else {\n      return (() => {\n        return (feature, resolution) => {\n          let styles = [];\n          for (let i = 0, ii = styleFunctions.length; i < ii; ++i) {\n            const result = styleFunctions[i].call(null, feature, resolution);\n            if (result) {\n              styles = styles.concat(result);\n            }\n          }\n          return styles;\n        };\n      })();\n    }\n  }\n}\n","export enum TimeFilterType {\n  DATE = 'date',\n  TIME = 'time',\n  DATETIME = 'datetime',\n  YEAR = 'year'\n}\n\nexport enum TimeFilterStyle {\n  CALENDAR = 'calendar',\n  SLIDER = 'slider'\n}\n","import { Injectable } from '@angular/core';\n\nimport { IgoMap } from './map';\n\n/**\n * MapService\n *\n * This service tracks the IgoMap instance, if any.\n * Currently, only one map instance is supported\n * but support for multiple maps may be added in the future.\n * This will impact other services such as the OverlayService\n * because these maps won't be sharing overlayed features.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapService {\n  private map: IgoMap;\n\n  constructor() {}\n\n  getMap(): IgoMap {\n    return this.map;\n  }\n\n  setMap(map: IgoMap) {\n    this.map = map;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\nimport { Observable, forkJoin, of } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { WMSCapabilities, WMTSCapabilities, EsriJSON } from 'ol/format';\nimport { optionsFromCapabilities } from 'ol/source/WMTS.js';\nimport olAttribution from 'ol/control/Attribution';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { MapService } from '../../map/shared/map.service';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\nimport { EsriStyleGenerator } from '../../style/shared/datasource/esri-style-generator';\nimport {\n  QueryFormat,\n  QueryFormatMimeType\n} from '../../query/shared/query.enums';\n\nimport {\n  WMTSDataSourceOptions,\n  WMSDataSourceOptions,\n  CartoDataSourceOptions,\n  ArcGISRestDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions\n} from './datasources';\nimport {\n  LegendOptions,\n  ItemStyleOptions\n} from '../../layer/shared/layers/legend.interface';\nimport {\n  TimeFilterType,\n  TimeFilterStyle\n} from '../../filter/shared/time-filter.enum';\nimport * as olproj from 'ol/proj';\n\nexport enum TypeCapabilities {\n  wms = 'wms',\n  wmts = 'wmts',\n  arcgisrest = 'esriJSON',\n  imagearcgisrest = 'esriJSON',\n  tilearcgisrest = 'esriJSON'\n}\n\nexport type TypeCapabilitiesStrings = keyof typeof TypeCapabilities;\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CapabilitiesService {\n  private parsers = {\n    wms: new WMSCapabilities(),\n    wmts: new WMTSCapabilities(),\n    esriJSON: new EsriJSON()\n  };\n\n  constructor(\n    private http: HttpClient,\n    private mapService: MapService\n  ) {}\n\n  getWMSOptions(\n    baseOptions: WMSDataSourceOptions\n  ): Observable<WMSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = (baseOptions.params as any).VERSION;\n\n    return this.getCapabilities('wms', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n  }\n\n  getWMTSOptions(\n    baseOptions: WMTSDataSourceOptions\n  ): Observable<WMTSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = baseOptions.version;\n\n    const options = this.getCapabilities('wmts', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMTSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n    return options;\n  }\n\n  getCartoOptions(\n    baseOptions: CartoDataSourceOptions\n  ): Observable<CartoDataSourceOptions> {\n    const baseUrl =\n      'https://' +\n      baseOptions.account +\n      '.carto.com/api/v2/viz/' +\n      baseOptions.mapId +\n      '/viz.json';\n\n    return this.http\n      .jsonp(baseUrl, 'callback')\n      .pipe(\n        map((cartoOptions: any) =>\n          this.parseCartoOptions(baseOptions, cartoOptions)\n        )\n      );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const serviceCapabilities = this.getCapabilities(\n      'arcgisrest',\n      baseOptions.url\n    );\n    const arcgisOptions = this.http.get(baseUrl);\n    return forkJoin([arcgisOptions, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseArcgisOptions(baseOptions, res[0], res[1]);\n      })\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getImageArcgisOptions(\n    baseOptions:\n      | ArcGISRestImageDataSourceOptions\n      | TileArcGISRestDataSourceOptions\n  ): Observable<\n    ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\n  > {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const legendUrl = baseOptions.url + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities(\n      'imagearcgisrest',\n      baseOptions.url\n    );\n    const arcgisOptions = this.http.get(baseUrl);\n    const legend = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Image Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseTileOrImageArcgisOptions(\n          baseOptions,\n          res[0],\n          res[1],\n          res[2]\n        );\n      })\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getTileArcgisOptions(\n    baseOptions: TileArcGISRestDataSourceOptions\n  ): Observable<\n    ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\n  > {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const legendUrl = baseOptions.url + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities(\n      'tilearcgisrest',\n      baseOptions.url\n    );\n    const arcgisOptions = this.http.get(baseUrl);\n    const legendInfo = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Tile Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legendInfo, serviceCapabilities]).pipe(\n      map((res: any) =>\n        this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2])\n      )\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getCapabilities(\n    service: TypeCapabilitiesStrings,\n    baseUrl: string,\n    version?: string\n  ): Observable<any> {\n    const params = new HttpParams({\n      fromObject: {\n        request: 'GetCapabilities',\n        service: service.toUpperCase(),\n        version: version || '1.3.0',\n        _i: 'true'\n      }\n    });\n\n    let request;\n    if (TypeCapabilities[service] === 'esriJSON') {\n      request = this.http.get(baseUrl + '?f=json');\n    } else {\n      request = this.http.get(baseUrl, {\n        params,\n        responseType: 'text'\n      });\n    }\n\n    return request.pipe(\n      map((res) => {\n        if (TypeCapabilities[service] === 'esriJSON') {\n          return res as object;\n        }\n        if (\n          String(res).toLowerCase().includes('serviceexception') &&\n          String(res).toLowerCase().includes('access denied')\n        ) {\n          throw {\n            error: {\n              message: 'Service error getCapabilities: Access is denied'\n            }\n          };\n        } else {\n          return this.parsers[service].read(res);\n        }\n      }),\n      catchError((e) => {\n        if (typeof e.error !== 'undefined') {\n          e.error.caught = true;\n        }\n        throw e;\n      })\n    );\n  }\n\n  private parseWMSOptions(\n    baseOptions: WMSDataSourceOptions,\n    capabilities: any\n  ): WMSDataSourceOptions {\n    const layers = (baseOptions.params as any).LAYERS;\n    const layer = this.findDataSourceInCapabilities(\n      capabilities.Capability.Layer,\n      layers\n    );\n\n    if (!layer) {\n      throw {\n        error: {\n          message: 'Layer not found'\n        }\n      };\n    }\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\n    const abstract = layer.Abstract ? layer.Abstract : undefined;\n    const keywordList = layer.KeywordList ? layer.KeywordList : undefined;\n    let queryable = layer.queryable;\n    const timeFilter = this.getTimeFilter(layer);\n    const timeFilterable = timeFilter && Object.keys(timeFilter).length > 0;\n    const legendOptions = layer.Style ? this.getStyle(layer.Style) : undefined;\n    let isExtentInGeographic = true;\n    if (layer.EX_GeographicBoundingBox) {\n      layer.EX_GeographicBoundingBox.forEach((coord, index) => {\n        if (index < 2 && (coord > 180 || coord < -180)) {\n          isExtentInGeographic = false;\n        }\n        if (index >= 2 && (coord > 90 || coord < -90)) {\n          isExtentInGeographic = false;\n        }\n      });\n    } else {\n      isExtentInGeographic = false;\n    }\n\n    const extent = isExtentInGeographic\n      ? olproj.transformExtent(\n          layer.EX_GeographicBoundingBox,\n          'EPSG:4326',\n          this.mapService.getMap().projection\n        )\n      : undefined;\n\n    let queryFormat: QueryFormat;\n    const queryFormatMimeTypePriority = [\n      QueryFormatMimeType.GEOJSON,\n      QueryFormatMimeType.GEOJSON2,\n      QueryFormatMimeType.GML3,\n      QueryFormatMimeType.GML2,\n      QueryFormatMimeType.JSON,\n      QueryFormatMimeType.HTML\n    ];\n\n    for (const mimeType of queryFormatMimeTypePriority) {\n      if (\n        capabilities.Capability.Request.GetFeatureInfo.Format.indexOf(\n          mimeType\n        ) !== -1\n      ) {\n        const keyEnum = Object.keys(QueryFormatMimeType).find(\n          (key) => QueryFormatMimeType[key] === mimeType\n        );\n        queryFormat = QueryFormat[keyEnum];\n        break;\n      }\n    }\n    if (!queryFormat) {\n      queryable = false;\n    }\n\n    const options: WMSDataSourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title,\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        extent,\n        metadata: {\n          url: metadata ? metadata.OnlineResource : undefined,\n          extern: metadata ? true : undefined,\n          abstract,\n          keywordList\n        },\n        legendOptions\n      },\n      queryable,\n      queryFormat,\n      timeFilter: timeFilterable ? timeFilter : undefined,\n      timeFilterable: timeFilterable ? true : undefined,\n      minDate: timeFilterable ? timeFilter.min : undefined,\n      maxDate: timeFilterable ? timeFilter.max : undefined,\n      stepDate: timeFilterable ? timeFilter.step : undefined\n    });\n\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseWMTSOptions(\n    baseOptions: WMTSDataSourceOptions,\n    capabilities: any\n  ): WMTSDataSourceOptions {\n    // Put Title source in _layerOptionsFromSource. (For source & catalog in _layerOptionsFromSource, if not already on config)\n    const layer = capabilities.Contents.Layer.find(\n      (el) => el.Identifier === baseOptions.layer\n    );\n\n    const options = optionsFromCapabilities(capabilities, baseOptions);\n\n    const ouputOptions = Object.assign(options, baseOptions);\n    const sourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title\n      }\n    });\n\n    return ObjectUtils.mergeDeep(sourceOptions, ouputOptions);\n  }\n\n  private parseCartoOptions(\n    baseOptions: CartoDataSourceOptions,\n    cartoOptions: any\n  ): CartoDataSourceOptions {\n    const layers = [];\n    const params = cartoOptions.layers[1].options.layer_definition;\n    params.layers.forEach((element) => {\n      layers.push({\n        type: element.type.toLowerCase(),\n        options: element.options,\n        legend: element.legend\n      });\n    });\n    const options = ObjectUtils.removeUndefined({\n      config: {\n        version: params.version,\n        layers\n      }\n    });\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions,\n    arcgisOptions: any,\n    serviceCapabilities: any\n  ): ArcGISRestDataSourceOptions {\n    const title = arcgisOptions.name;\n    let legendInfo: any;\n\n    if (arcgisOptions.drawingInfo?.renderer) {\n      legendInfo = arcgisOptions.drawingInfo.renderer;\n    } else {\n      legendInfo = undefined;\n    }\n\n    let style;\n    if (arcgisOptions.drawingInfo) {\n      const styleGenerator = new EsriStyleGenerator();\n      const units = arcgisOptions.units === 'esriMeters' ? 'm' : 'degrees';\n      style = styleGenerator.generateStyle(arcgisOptions, units);\n    }\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        style,\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract:\n            arcgisOptions.description || serviceCapabilities.serviceDescription\n        }\n      },\n      legendInfo,\n      timeFilter,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    options.attributions = attributions;\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseTileOrImageArcgisOptions(\n    baseOptions:\n      | TileArcGISRestDataSourceOptions\n      | ArcGISRestImageDataSourceOptions,\n    arcgisOptions: any,\n    legend: any,\n    serviceCapabilities: any\n  ): TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions {\n    const title = arcgisOptions.name;\n    const legendInfo = legend.layers\n      ? legend.layers.find((x) => x.layerName === title)\n      : undefined;\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract:\n            arcgisOptions.description || serviceCapabilities.serviceDescription\n        }\n      },\n      legendInfo,\n      timeFilter,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    options.attributions = attributions;\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private findDataSourceInCapabilities(layerArray, name): any {\n    if (Array.isArray(layerArray)) {\n      let layer;\n      layerArray.find((value) => {\n        layer = this.findDataSourceInCapabilities(value, name);\n        return layer !== undefined;\n      }, this);\n\n      return layer;\n    } else if (layerArray.Layer) {\n      return this.findDataSourceInCapabilities(layerArray.Layer, name);\n    } else {\n      if (layerArray.Name && layerArray.Name === name) {\n        return layerArray;\n      }\n      return undefined;\n    }\n  }\n\n  getTimeFilter(layer) {\n    let dimension;\n\n    if (layer.Dimension) {\n      const timeFilter: any = {};\n      dimension = layer.Dimension[0];\n\n      if (dimension.values) {\n        const minMaxDim = dimension.values.split('/');\n        timeFilter.min = minMaxDim[0] !== undefined ? minMaxDim[0] : undefined;\n        timeFilter.max = minMaxDim[1] !== undefined ? minMaxDim[1] : undefined;\n        timeFilter.step = minMaxDim[2] !== undefined ? minMaxDim[2] : undefined;\n      }\n\n      if (dimension.default) {\n        timeFilter.value = dimension.default;\n      }\n      return timeFilter;\n    }\n  }\n\n  getStyle(Style): LegendOptions {\n    const styleOptions: ItemStyleOptions[] = Style.map((style) => {\n      return {\n        name: style.Name,\n        title: style.Title\n      };\n    })\n      // Handle repeat the style \"default\" in output  (MapServer or OpenLayer)\n      .filter(\n        (item, index, self) =>\n          self.findIndex((i: ItemStyleOptions) => i.name === item.name) ===\n          index\n      );\n\n    const legendOptions: LegendOptions = {\n      stylesAvailable: styleOptions\n    } as LegendOptions;\n\n    return legendOptions;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport proj4 from 'proj4';\nimport * as olproj from 'ol/proj';\nimport * as olproj4 from 'ol/proj/proj4';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { Projection } from './projection.interfaces';\n\n/**\n * When injected, this service automatically registers and\n * projection defined in the application config. A custom projection\n * needs to be registered to be usable by OL.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ProjectionService {\n  constructor(private config: ConfigService) {\n    const projections = this.config.getConfig('projections') || [];\n    projections.forEach((projection: Projection) => {\n      projection.alias = projection.alias ? projection.alias : projection.code;\n      this.registerProjection(projection);\n    });\n\n    // register all utm zones\n    for (let utmZone = 1; utmZone < 61; utmZone++) {\n      const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n      const def = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;\n      const proj: Projection = { code, def, extent: undefined };\n      this.registerProjection(proj);\n    }\n\n    // register all mtm zones\n    for (let mtmZone = 1; mtmZone < 11; mtmZone++) {\n      const code =\n        mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n      let lon0;\n      if (Number(mtmZone) <= 2) {\n        lon0 = -50 - Number(mtmZone) * 3;\n      } else if (Number(mtmZone) >= 12) {\n        lon0 = -81 - (Number(mtmZone) - 12) * 3;\n      } else {\n        lon0 = -49.5 - Number(mtmZone) * 3;\n      }\n      const def = `+proj=tmerc +lat_0=0 +lon_0=${lon0} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"`;\n      const proj: Projection = { code, def, extent: undefined };\n      this.registerProjection(proj);\n    }\n  }\n\n  /**\n   * Define a proj4 projection and register it in OL\n   * @param projection Projection\n   */\n  registerProjection(projection: Projection) {\n    proj4.defs(projection.code, projection.def);\n    olproj4.register(proj4);\n    if (projection.extent) {\n      olproj.get(projection.code).setExtent(projection.extent);\n    }\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport {\n  ArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  WMSDataSourceOptions\n} from '../datasources';\n\nexport abstract class OptionsService {\n  abstract getWMSOptions(\n    _baseOptions: WMSDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<WMSDataSourceOptions>;\n  abstract getArcgisRestOptions(\n    _baseOptions:\n      | ArcGISRestDataSourceOptions\n      | ArcGISRestImageDataSourceOptions\n      | TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<\n    | ArcGISRestDataSourceOptions\n    | ArcGISRestImageDataSourceOptions\n    | TileArcGISRestDataSourceOptions\n  >;\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { forkJoin, of, Observable, BehaviorSubject } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { CapabilitiesService } from './capabilities.service';\nimport { OptionsService } from './options/options.service';\nimport { WFSService } from './datasources/wfs.service';\nimport {\n  DataSource,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  XYZDataSource,\n  XYZDataSourceOptions,\n  TileDebugDataSource,\n  TileDebugDataSourceOptions,\n  WFSDataSource,\n  WFSDataSourceOptions,\n  WMTSDataSource,\n  WMTSDataSourceOptions,\n  WMSDataSource,\n  WMSDataSourceOptions,\n  CartoDataSource,\n  CartoDataSourceOptions,\n  ArcGISRestDataSource,\n  ArcGISRestDataSourceOptions,\n  ImageArcGISRestDataSource,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSource,\n  TileArcGISRestDataSourceOptions,\n  WebSocketDataSource,\n  AnyDataSourceOptions,\n  MVTDataSource,\n  MVTDataSourceOptions,\n  ClusterDataSource,\n  ClusterDataSourceOptions\n} from './datasources';\nimport { ObjectUtils } from '@igo2/utils';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { ProjectionService } from '../../map/shared/projection.service';\nimport { AuthInterceptor } from '@igo2/auth';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DataSourceService {\n  public datasources$ = new BehaviorSubject<DataSource[]>([]);\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    @Optional() private optionsService: OptionsService,\n    private wfsDataSourceService: WFSService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private projectionService: ProjectionService,\n    private authInterceptor?: AuthInterceptor\n  ) {}\n\n  createAsyncDataSource(\n    context: AnyDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<DataSource> {\n    if (!context.type) {\n      console.error(context);\n      throw new Error('Datasource needs a type');\n    }\n    let dataSource;\n    switch (context.type.toLowerCase()) {\n      case 'osm':\n        dataSource = this.createOSMDataSource(context as OSMDataSourceOptions);\n        break;\n      case 'vector':\n        dataSource = this.createFeatureDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'wfs':\n        dataSource = this.createWFSDataSource(context as WFSDataSourceOptions);\n        break;\n      case 'wms':\n        const wmsContext = context as WMSDataSourceOptions;\n        ObjectUtils.removeDuplicateCaseInsensitive(wmsContext.params);\n        dataSource = this.createWMSDataSource(wmsContext, detailedContextUri);\n        break;\n      case 'wmts':\n        dataSource = this.createWMTSDataSource(\n          context as WMTSDataSourceOptions\n        );\n        break;\n      case 'xyz':\n        dataSource = this.createXYZDataSource(context as XYZDataSourceOptions);\n        break;\n      case 'tiledebug':\n        dataSource = this.createTileDebugDataSource(\n          context as TileDebugDataSource\n        );\n        break;\n      case 'carto':\n        dataSource = this.createCartoDataSource(\n          context as CartoDataSourceOptions\n        );\n        break;\n      case 'arcgisrest':\n        dataSource = this.createArcGISRestDataSource(\n          context as ArcGISRestDataSourceOptions,\n          detailedContextUri\n        );\n        break;\n      case 'imagearcgisrest':\n        dataSource = this.createArcGISRestImageDataSource(\n          context as ArcGISRestImageDataSourceOptions,\n          detailedContextUri\n        );\n        break;\n      case 'websocket':\n        dataSource = this.createWebSocketDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'mvt':\n        dataSource = this.createMVTDataSource(context as MVTDataSourceOptions);\n        break;\n      case 'tilearcgisrest':\n        dataSource = this.createTileArcGISRestDataSource(\n          context as TileArcGISRestDataSourceOptions,\n          detailedContextUri\n        );\n        break;\n      case 'cluster':\n        dataSource = this.createClusterDataSource(\n          context as ClusterDataSourceOptions\n        );\n        break;\n      default:\n        console.error(context);\n        throw new Error('Invalid datasource type');\n    }\n\n    this.datasources$.next(this.datasources$.value.concat([dataSource]));\n\n    return dataSource;\n  }\n\n  private createOSMDataSource(\n    context: OSMDataSourceOptions\n  ): Observable<OSMDataSource> {\n    return new Observable((d) => d.next(new OSMDataSource(context)));\n  }\n\n  private createFeatureDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<FeatureDataSource> {\n    return new Observable((d) => d.next(new FeatureDataSource(context)));\n  }\n\n  private createWebSocketDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<WebSocketDataSource> {\n    return new Observable((d) => d.next(new WebSocketDataSource(context)));\n  }\n\n  private createWFSDataSource(\n    context: WFSDataSourceOptions\n  ): Observable<WFSDataSource> {\n    return new Observable((d) =>\n      d.next(\n        new WFSDataSource(\n          context,\n          this.wfsDataSourceService,\n          this.authInterceptor\n        )\n      )\n    );\n  }\n\n  private createWMSDataSource(\n    context: WMSDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<any> {\n    const observables = [];\n    if (context.optionsFromCapabilities && window.navigator.onLine) {\n      observables.push(\n        this.capabilitiesService.getWMSOptions(context).pipe(\n          catchError((e) => {\n            this.messageService.error(\n              'igo.geo.dataSource.unavailable',\n              'igo.geo.dataSource.unavailableTitle',\n              undefined,\n              { value: context.params.LAYERS }\n            );\n            throw e;\n          })\n        )\n      );\n    }\n\n    if (\n      this.optionsService &&\n      context.optionsFromApi &&\n      window.navigator.onLine\n    ) {\n      observables.push(\n        this.optionsService.getWMSOptions(context, detailedContextUri).pipe(\n          catchError((e) => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n\n    observables.push(of(context));\n\n    return forkJoin(observables).pipe(\n      map((options: WMSDataSourceOptions[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new WMSDataSource(optionsMerged, this.wfsDataSourceService);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createWMTSDataSource(\n    context: WMTSDataSourceOptions\n  ): Observable<WMTSDataSource> {\n    if (context.optionsFromCapabilities && window.navigator.onLine) {\n      return this.capabilitiesService.getWMTSOptions(context).pipe(\n        map((options: WMTSDataSourceOptions) => {\n          return options ? new WMTSDataSource(options) : undefined;\n        }),\n        catchError(() => {\n          this.messageService.error(\n            'igo.geo.dataSource.unavailable',\n            'igo.geo.dataSource.unavailableTitle',\n            undefined,\n            { value: context.layer }\n          );\n          return of(undefined);\n        })\n      );\n    }\n\n    return new Observable((d) => d.next(new WMTSDataSource(context)));\n  }\n\n  private createXYZDataSource(\n    context: XYZDataSourceOptions\n  ): Observable<XYZDataSource> {\n    return new Observable((d) => d.next(new XYZDataSource(context)));\n  }\n\n  private createTileDebugDataSource(\n    context: TileDebugDataSourceOptions\n  ): Observable<TileDebugDataSource> {\n    return new Observable((d) => d.next(new TileDebugDataSource(context)));\n  }\n\n  private createCartoDataSource(\n    context: CartoDataSourceOptions\n  ): Observable<CartoDataSource> {\n    if (context.mapId) {\n      return this.capabilitiesService\n        .getCartoOptions(context)\n        .pipe(\n          map((options: CartoDataSourceOptions) => new CartoDataSource(options))\n        );\n    }\n    return new Observable((d) => d.next(new CartoDataSource(context)));\n  }\n\n  private createArcGISRestDataSource(\n    context: ArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestDataSource> {\n    const observables = [];\n    if (window.navigator.onLine) {\n      observables.push(\n        this.capabilitiesService.getArcgisOptions(context).pipe(\n          catchError((e) => {\n            this.messageService.error(\n              'igo.geo.dataSource.unavailable',\n              'igo.geo.dataSource.unavailableTitle',\n              undefined,\n              { value: context.layer }\n            );\n            throw e;\n          })\n        )\n      );\n    }\n    if (\n      this.optionsService &&\n      context.optionsFromApi &&\n      window.navigator.onLine\n    ) {\n      observables.push(\n        this.optionsService\n          .getArcgisRestOptions(context, detailedContextUri)\n          .pipe(\n            catchError((e) => {\n              e.error.toDisplay = true;\n              e.error.title = this.languageService.translate.instant(\n                'igo.geo.dataSource.unavailableTitle'\n              );\n              e.error.message = this.languageService.translate.instant(\n                'igo.geo.dataSource.optionsApiUnavailable'\n              );\n              return of({});\n            })\n          )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createArcGISRestImageDataSource(\n    context: ArcGISRestImageDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestImageDataSourceOptions> {\n    const observables = [];\n\n    if (window.navigator.onLine) {\n      observables.push(\n        this.capabilitiesService.getImageArcgisOptions(context).pipe(\n          catchError((e) => {\n            this.messageService.error(\n              'igo.geo.dataSource.unavailable',\n              'igo.geo.dataSource.unavailableTitle',\n              undefined,\n              { value: context.params.LAYERS }\n            );\n            throw e;\n          })\n        )\n      );\n    }\n    if (\n      this.optionsService &&\n      context.optionsFromApi &&\n      window.navigator.onLine\n    ) {\n      observables.push(\n        this.optionsService\n          .getArcgisRestOptions(context, detailedContextUri)\n          .pipe(\n            catchError((e) => {\n              e.error.toDisplay = true;\n              e.error.title = this.languageService.translate.instant(\n                'igo.geo.dataSource.unavailableTitle'\n              );\n              e.error.message = this.languageService.translate.instant(\n                'igo.geo.dataSource.optionsApiUnavailable'\n              );\n              return of({});\n            })\n          )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ImageArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ImageArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createTileArcGISRestDataSource(\n    context: TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<TileArcGISRestDataSource> {\n    const observables = [];\n    if (window.navigator.onLine) {\n      observables.push(\n        this.capabilitiesService.getImageArcgisOptions(context).pipe(\n          catchError((e) => {\n            this.messageService.error(\n              'igo.geo.dataSource.unavailable',\n              'igo.geo.dataSource.unavailableTitle',\n              undefined,\n              { value: context.params.LAYERS }\n            );\n            throw e;\n          })\n        )\n      );\n    }\n    if (\n      this.optionsService &&\n      context.optionsFromApi &&\n      window.navigator.onLine\n    ) {\n      observables.push(\n        this.optionsService\n          .getArcgisRestOptions(context, detailedContextUri)\n          .pipe(\n            catchError((e) => {\n              e.error.toDisplay = true;\n              e.error.title = this.languageService.translate.instant(\n                'igo.geo.dataSource.unavailableTitle'\n              );\n              e.error.message = this.languageService.translate.instant(\n                'igo.geo.dataSource.optionsApiUnavailable'\n              );\n              return of({});\n            })\n          )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: TileArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new TileArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createMVTDataSource(\n    context: MVTDataSourceOptions\n  ): Observable<MVTDataSource> {\n    return new Observable((d) => d.next(new MVTDataSource(context)));\n  }\n\n  private createClusterDataSource(\n    context: ClusterDataSourceOptions\n  ): Observable<ClusterDataSource> {\n    return new Observable((d) => d.next(new ClusterDataSource(context)));\n  }\n}\n","import {\n  BehaviorSubject,\n  Observable,\n  Subject,\n  Subscription,\n  combineLatest\n} from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\n\nimport { AuthInterceptor } from '@igo2/auth';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { DataSource, Legend } from '../../../datasource';\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\n\nimport { LayerOptions } from './layer.interface';\nimport { Message, MessageService } from '@igo2/core';\nimport { GeoDBService } from '../../../offline/geoDB/geoDB.service';\nimport { LayerDBService } from '../../../offline/layerDB/layerDB.service';\nimport { MapBase } from '../../../map/shared/map.abstract';\n\nexport abstract class Layer {\n  public collapsed: boolean;\n  public dataSource: DataSource;\n  public legend: Legend[];\n  public legendCollapsed: boolean = true;\n  public firstLoadComponent: boolean = true;\n  public map: MapBase;\n  public ol: olLayer<olSource>;\n  public olLoadingProblem: boolean = false;\n  public status$: Subject<SubjectStatus>;\n  public hasBeenVisible$: BehaviorSubject<boolean> = new BehaviorSubject(\n    undefined\n  );\n  private hasBeenVisible$$: Subscription;\n  private resolution$$: Subscription;\n\n  /**\n   * Define if a layer is generated by code OR defined by layer/context user layer.\n   * Useful for filtering layers list in mapOffline.directive or in the sharemap...\n   * return false by default.\n   */\n  get isIgoInternalLayer(): boolean {\n    return this.options.isIgoInternalLayer || false;\n  }\n\n  get id(): string {\n    return this.options.id || this.dataSource.id;\n  }\n\n  get alias(): string {\n    return this.options.alias;\n  }\n\n  get title(): string {\n    return this.options.title;\n  }\n\n  set title(title: string) {\n    this.options.title = title;\n  }\n\n  get zIndex(): number {\n    return this.ol.getZIndex();\n  }\n\n  set zIndex(zIndex: number) {\n    this.ol.setZIndex(zIndex);\n  }\n\n  get baseLayer(): boolean {\n    return this.options.baseLayer;\n  }\n\n  set baseLayer(baseLayer: boolean) {\n    this.options.baseLayer = baseLayer;\n  }\n\n  get opacity(): number {\n    return this.ol.get('opacity');\n  }\n\n  set opacity(opacity: number) {\n    this.ol.setOpacity(opacity);\n  }\n\n  set isInResolutionsRange(value: boolean) {\n    this.isInResolutionsRange$.next(value);\n  }\n  get isInResolutionsRange(): boolean {\n    return this.isInResolutionsRange$.value;\n  }\n  readonly isInResolutionsRange$: BehaviorSubject<boolean> =\n    new BehaviorSubject(false);\n\n  set maxResolution(value: number) {\n    this.ol.setMaxResolution(value === 0 ? 0 : value || Infinity);\n    this.updateInResolutionsRange();\n  }\n  get maxResolution(): number {\n    return this.ol.getMaxResolution();\n  }\n\n  set minResolution(value: number) {\n    this.ol.setMinResolution(value || 0);\n    this.updateInResolutionsRange();\n  }\n  get minResolution(): number {\n    return this.ol.getMinResolution();\n  }\n\n  set visible(value: boolean) {\n    this.ol.setVisible(value);\n    this.visible$.next(value);\n    if (!this.hasBeenVisible$.value && value) {\n      this.hasBeenVisible$.next(value);\n    }\n    if (this.options?.messages && value) {\n      this.options?.messages\n        .filter((m) => m.options?.showOnEachLayerVisibility)\n        .map((message) => this.showMessage(message));\n    }\n  }\n  get visible(): boolean {\n    return this.visible$.value;\n  }\n  readonly visible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  get displayed(): boolean {\n    return this.visible && this.isInResolutionsRange;\n  }\n  readonly displayed$: Observable<boolean> = combineLatest([\n    this.isInResolutionsRange$,\n    this.visible$\n  ]).pipe(map((bunch: [boolean, boolean]) => bunch[0] && bunch[1]));\n\n  get showInLayerList(): boolean {\n    return this.options.showInLayerList !== false;\n  }\n\n  constructor(\n    public options: LayerOptions,\n    protected messageService?: MessageService,\n    protected authInterceptor?: AuthInterceptor,\n    protected geoDBService?: GeoDBService,\n    public layerDBService?: LayerDBService\n  ) {\n    this.dataSource = options.source;\n\n    this.ol = this.createOlLayer();\n    if (options.zIndex !== undefined) {\n      this.zIndex = options.zIndex;\n    }\n\n    if (options.baseLayer && options.visible === undefined) {\n      options.visible = false;\n    }\n\n    this.maxResolution =\n      options.maxResolution ||\n      getResolutionFromScale(Number(options.maxScaleDenom));\n    this.minResolution =\n      options.minResolution ||\n      getResolutionFromScale(Number(options.minScaleDenom));\n\n    this.visible = options.visible === undefined ? true : options.visible;\n    this.opacity = options.opacity === undefined ? 1 : options.opacity;\n\n    if (\n      options.legendOptions &&\n      (options.legendOptions.url || options.legendOptions.html)\n    ) {\n      this.legend = this.dataSource.setLegend(options.legendOptions);\n    }\n\n    this.legendCollapsed = options.legendOptions\n      ? options.legendOptions.collapsed\n        ? options.legendOptions.collapsed\n        : true\n      : true;\n\n    this.ol.set('_layer', this, true);\n  }\n\n  protected abstract createOlLayer(): olLayer<olSource>;\n\n  setMap(map: MapBase | undefined) {\n    this.map = map;\n\n    this.unobserveResolution();\n    if (map !== undefined) {\n      this.observeResolution();\n      this.hasBeenVisible$$ = this.hasBeenVisible$.subscribe(() => {\n        if (this.options.messages && this.visible) {\n          this.options.messages.map((message) => {\n            this.showMessage(message);\n          });\n        }\n      });\n    }\n  }\n\n  private showMessage(message: Message) {\n    if (!this.messageService) {\n      return;\n    }\n    message.title = message.title;\n    message.text = message.text;\n    this.messageService.message(message as Message);\n  }\n\n  private observeResolution() {\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(() =>\n      this.updateInResolutionsRange()\n    );\n  }\n\n  private unobserveResolution() {\n    if (this.resolution$$ !== undefined) {\n      this.resolution$$.unsubscribe();\n      this.resolution$$ = undefined;\n    }\n  }\n\n  private updateInResolutionsRange() {\n    if (this.map !== undefined) {\n      const resolution = this.map.viewController.getResolution();\n      const minResolution = this.minResolution;\n      const maxResolution =\n        this.maxResolution === undefined ? Infinity : this.maxResolution;\n      this.isInResolutionsRange =\n        resolution >= minResolution && resolution <= maxResolution;\n    } else {\n      this.isInResolutionsRange = false;\n    }\n  }\n}\n","import olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\nimport { Message } from '@igo2/core';\n\nimport { DataSource } from '../../../datasource/shared/datasources/datasource';\nimport { AnyDataSourceOptions } from '../../../datasource/shared/datasources/any-datasource.interface';\nimport { MapExtent } from '../../../map/shared/map.interface';\nimport { LegendOptions } from './legend.interface';\n\nexport interface LayerOptions {\n  isIgoInternalLayer?: boolean; // useful when mapOffline directive set the resolution of the layers.\n  source?: DataSource;\n  sourceOptions?: AnyDataSourceOptions;\n  title?: string;\n  id?: string;\n  alias?: string;\n  security?: LayerSecurityOptions;\n  baseLayer?: boolean;\n  opacity?: number;\n  visible?: boolean;\n  extent?: MapExtent;\n  zIndex?: number;\n  messages?: Message[];\n  minResolution?: number;\n  maxResolution?: number;\n  minScaleDenom?: number;\n  maxScaleDenom?: number;\n  showInLayerList?: boolean;\n  removable?: boolean;\n  workspace?: GeoWorkspaceOptions;\n  legendOptions?: LegendOptions;\n  ol?: olLayer<olSource>;\n  tooltip?: TooltipContent;\n  _internal?: { [key: string]: string };\n  active?: boolean;\n  check?: boolean;\n  linkedLayers?: LayersLink;\n  showButtonZoomToExtent?: boolean;\n}\n\nexport interface LayerSecurityOptions {\n  profils?: string[];\n}\n\nexport interface GeoWorkspaceOptions {\n  srcId?: string;\n  workspaceId?: string;\n  minResolution?: number;\n  maxResolution?: number;\n  enabled?: boolean;\n  queryOptions?: GeoWorkspaceQueryOptions;\n  pageSize?: number;\n  pageSizeOptions?: number[];\n  searchIndexEnabled?: boolean;\n  printable?: boolean;\n}\n\nexport interface GeoWorkspaceQueryOptions {\n  mapQueryOnOpenTab?: boolean;\n  tabQuery?: boolean;\n}\n\nexport interface LayersLink {\n  linkId: string;\n  links?: LayersLinkProperties[];\n}\nexport interface LayersLinkProperties {\n  linkedIds: string[];\n  syncedDelete: boolean;\n  properties: LinkedProperties[];\n}\n\nexport enum LinkedProperties {\n  OPACITY = 'opacity',\n  VISIBLE = 'visible',\n  OGCFILTERS = 'ogcFilters',\n  MINRESOLUTION = 'minResolution',\n  MAXRESOLUTION = 'maxResolution',\n  ZINDEX = 'zIndex',\n  TIMEFILTER = 'timeFilter'\n}\n\nexport interface GroupLayers {\n  title: string;\n  layers?: LayerOptions;\n  collapsed?: boolean;\n}\n\nexport interface TooltipContent {\n  type?: TooltipType;\n  text?: string;\n}\nexport enum TooltipType {\n  TITLE = 'title',\n  ABSTRACT = 'abstract',\n  CUSTOM = 'custom'\n}\n","import olSourceImage from 'ol/source/Image';\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\nimport { MessageService } from '@igo2/core';\nimport { ImageLayer } from '../shared/layers/image-layer';\n\nexport class ImageWatcher extends Watcher {\n  protected id: string;\n  protected loaded = 0;\n  protected loading = 0;\n\n  private source: olSourceImage;\n\n  private messageService: MessageService;\n\n  constructor(layer: ImageLayer, messageService: MessageService) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n    this.messageService = messageService;\n  }\n\n  protected watch() {\n    this.source.on(`imageloadstart`, (e) => this.handleLoadStart(e));\n    this.source.on(`imageloadend`, (e) => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, (e) => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, (e) => this.handleLoadError(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`imageloadstart`, (e) => this.handleLoadStart(e));\n    this.source.un(`imageloadend`, (e) => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, (e) => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, (e) => this.handleLoadError(e));\n  }\n\n  private handleLoadStart(event: any) {\n    if (!event.image.__watchers__) {\n      event.image.__watchers__ = [];\n    }\n    event.image.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.image.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.image.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.image.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n\n  private handleLoadError(event) {\n    if (!event.image.__watchers__) {\n      return;\n    }\n    this.messageService.error(\n      'igo.geo.dataSource.unavailable',\n      'igo.geo.dataSource.unavailableTitle',\n      undefined,\n      { value: event.target.params_.LAYERS }\n    );\n    this.loaded = -1;\n    this.loading = 0;\n    this.status = SubjectStatus.Error;\n  }\n}\n","import olSourceTile from 'ol/source/Tile';\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\n\nimport { TileLayer } from '../shared/layers/tile-layer';\nimport { VectorTileLayer } from '../shared/layers/vectortile-layer';\n\nexport class TileWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private source: olSourceTile;\n\n  constructor(layer: TileLayer | VectorTileLayer) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    this.source.on(`tileloadstart`, (e) => this.handleLoadStart(e));\n    this.source.on(`tileloadend`, (e) => this.handleLoadEnd(e));\n    this.source.on(`tileloaderror`, (e) => this.handleLoadEnd(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`tileloadstart`, (e) => this.handleLoadStart(e));\n    this.source.un(`tileloadend`, (e) => this.handleLoadEnd(e));\n    this.source.un(`tileloaderror`, (e) => this.handleLoadEnd(e));\n  }\n\n  private handleLoadStart(event: any) {\n    // This is to avoid increasing\n    // the number of loaded tiles if a tile was loading\n    // before subscribing to this watcher\n    if (!event.tile.__watchers__) {\n      event.tile.__watchers__ = [];\n    }\n    event.tile.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.tile.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.tile.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.tile.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import { uuid, Watcher, SubjectStatus } from '@igo2/utils';\n\nimport { VectorLayer } from '../shared/layers/vector-layer';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\n\nexport class VectorWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private layer: VectorLayer;\n\n  constructor(layer: VectorLayer) {\n    super();\n    this.layer = layer;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n    }\n\n    if (olSource.getUrl()) {\n      olSource.on(`featuresloadstart`, (e) => this.handleLoadStart(e));\n      olSource.on(`featuresloadend`, (e) => this.handleLoadEnd(e));\n      olSource.on(`featuresloaderror`, (e) => this.handleLoadEnd(e));\n    }\n  }\n\n  protected unwatch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n    }\n    if (olSource.getUrl()) {\n      olSource.un(`featuresloadstart`, (e) => this.handleLoadStart(e));\n      olSource.un(`featuresloadend`, (e) => this.handleLoadEnd(e));\n      olSource.un(`featuresloaderror`, (e) => this.handleLoadEnd(e));\n    }\n  }\n\n  private handleLoadStart(event: any) {\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event: any) {\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import olLayerImage from 'ol/layer/Image';\nimport olSourceImage from 'ol/source/Image';\n\nimport { AuthInterceptor } from '@igo2/auth';\n\nimport { ImageWatcher } from '../../utils';\nimport { IgoMap } from '../../../map/shared';\n\nimport { WMSDataSource } from '../../../datasource/shared/datasources/wms-datasource';\n\nimport { Layer } from './layer';\nimport { ImageLayerOptions } from './image-layer.interface';\nimport { ImageArcGISRestDataSource } from '../../../datasource/shared/datasources/imagearcgisrest-datasource';\nimport { MessageService } from '@igo2/core';\n\nexport class ImageLayer extends Layer {\n  public declare dataSource: WMSDataSource | ImageArcGISRestDataSource;\n  public declare options: ImageLayerOptions;\n  public declare ol: olLayerImage<olSourceImage>;\n\n  private watcher: ImageWatcher;\n\n  constructor(\n    options: ImageLayerOptions,\n    public messageService: MessageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new ImageWatcher(this, this.messageService);\n    this.status$ = this.watcher.status$;\n    this.status$.subscribe((valStatus) => {\n      if (valStatus === 0) {\n        this.olLoadingProblem = true;\n      }\n    });\n  }\n\n  protected createOlLayer(): olLayerImage<olSourceImage> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceImage\n    });\n\n    const image = new olLayerImage(olOptions);\n    if (this.authInterceptor) {\n      (image.getSource() as any).setImageLoadFunction((tile, src) => {\n        this.customLoader(tile, src, this.authInterceptor, this.messageService);\n      });\n    }\n\n    return image;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  private customLoader(\n    tile,\n    src: string,\n    interceptor: AuthInterceptor,\n    messageService: MessageService\n  ) {\n    const xhr = new XMLHttpRequest();\n\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(src);\n    let url = src;\n    if (alteredUrlWithKeyAuth) {\n      url = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', url);\n    const intercepted = interceptor.interceptXhr(xhr, url);\n    if (!intercepted) {\n      xhr.abort();\n      tile.getImage().src = url;\n      return;\n    }\n\n    xhr.responseType = 'arraybuffer';\n\n    xhr.onload = function () {\n      const arrayBufferView = new Uint8Array((this as any).response);\n      const responseString = new TextDecoder().decode(arrayBufferView);\n      if (responseString.includes('ServiceExceptionReport')) {\n        messageService.error(\n          'igo.geo.dataSource.optionsApiUnavailable',\n          'igo.geo.dataSource.unavailableTitle'\n        );\n      }\n      const blob = new Blob([arrayBufferView], { type: 'image/png' });\n      const urlCreator = window.URL;\n      const imageUrl = urlCreator.createObjectURL(blob);\n      tile.getImage().src = imageUrl;\n    };\n    xhr.send();\n  }\n}\n","import olLayerTile from 'ol/layer/Tile';\nimport olSourceTile from 'ol/source/Tile';\nimport Tile from 'ol/Tile';\n\nimport { TileWatcher } from '../../utils';\nimport { IgoMap } from '../../../map/shared';\n\nimport { OSMDataSource } from '../../../datasource/shared/datasources/osm-datasource';\nimport { WMTSDataSource } from '../../../datasource/shared/datasources/wmts-datasource';\nimport { XYZDataSource } from '../../../datasource/shared/datasources/xyz-datasource';\nimport { CartoDataSource } from '../../../datasource/shared/datasources/carto-datasource';\nimport { TileArcGISRestDataSource } from '../../../datasource/shared/datasources/tilearcgisrest-datasource';\nimport { TileDebugDataSource } from '../../../datasource/shared/datasources/tiledebug-datasource';\n\nimport { Layer } from './layer';\nimport { TileLayerOptions } from './tile-layer.interface';\n\nimport { MessageService } from '@igo2/core';\nimport { AuthInterceptor } from '@igo2/auth';\nexport class TileLayer extends Layer {\n  public declare dataSource:\n    | OSMDataSource\n    | WMTSDataSource\n    | XYZDataSource\n    | TileDebugDataSource\n    | CartoDataSource\n    | TileArcGISRestDataSource;\n  public declare options: TileLayerOptions;\n  public declare ol: olLayerTile<olSourceTile>;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: TileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService);\n\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerTile<olSourceTile> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol\n    });\n    const tileLayer = new olLayerTile(olOptions);\n    const tileSource = tileLayer.getSource();\n    tileSource.setTileLoadFunction((tile: Tile, url: string) => {\n      this.customLoader(tile, url, this.authInterceptor);\n    });\n\n    return tileLayer;\n  }\n\n  /**\n   * Custom loader for tile layer.\n   * @internal\n   * @param tile the current tile\n   * @param url the url string or function to retrieve the data\n   */\n  customLoader(tile, url: string, interceptor: AuthInterceptor) {\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    tile.getImage().src = modifiedUrl;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","export const FEATURE = 'Feature';\n\nexport enum FeatureMotion {\n  None,\n  Move,\n  Zoom,\n  Default\n}\n","import * as olextent from 'ol/extent';\nimport * as olproj from 'ol/proj';\nimport * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport type { GeometryLayout } from 'ol/geom/Geometry';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\nimport OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { uuid } from '@igo2/utils';\n\nimport {\n  EntityKey,\n  getEntityId,\n  getEntityTitle,\n  getEntityRevision,\n  getEntityIcon,\n  getEntityProperty\n} from '@igo2/common';\n\nimport { MapExtent, MapViewController } from '../../map/shared';\nimport { FEATURE, FeatureMotion } from './feature.enums';\nimport { Feature, FeatureGeometry } from './feature.interfaces';\n\n/**\n * Create an Openlayers feature object out of a feature definition.\n * The output object has a reference to the feature id.\n * @param feature Feature definition\n * @param projectionOut Feature object projection\n * @returns OpenLayers feature object\n */\nexport function featureToOl(\n  feature: Feature,\n  projectionOut: string,\n  getId?: (Feature) => EntityKey\n): OlFeature<OlGeometry> {\n  getId = getId ? getId : getEntityId;\n\n  const olFormat = new OlFormatGeoJSON();\n  const olFeature = olFormat.readFeature(feature, {\n    dataProjection: feature.projection,\n    featureProjection: projectionOut\n  });\n\n  olFeature.setId(getId(feature));\n\n  const title = getEntityTitle(feature);\n  if (title !== undefined) {\n    olFeature.set('_title', title, true);\n  }\n\n  if (feature.extent !== undefined) {\n    olFeature.set('_extent', feature.extent, true);\n  }\n\n  if (feature.projection !== undefined) {\n    olFeature.set('_projection', feature.projection, true);\n  }\n\n  const mapTitle = getEntityProperty(feature, 'meta.mapTitle');\n  if (mapTitle !== undefined) {\n    olFeature.set('_mapTitle', mapTitle, true);\n  }\n\n  olFeature.set('_entityRevision', getEntityRevision(feature), true);\n\n  const icon = getEntityIcon(feature);\n  if (icon !== undefined) {\n    olFeature.set('_icon', icon, true);\n  }\n\n  if (feature.meta && feature.meta.style) {\n    olFeature.set('_style', feature.meta.style, true);\n  }\n\n  if (feature.sourceId) {\n    olFeature.set('_sourceId', feature.sourceId, true);\n  }\n\n  return olFeature;\n}\n\nexport function renderFeatureFromOl(\n  olRenderFeature: OlRenderFeature,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let geom;\n  let title;\n  let exclude;\n  let excludeOffline;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    if (olLayer.get('sourceOptions')) {\n      exclude = olLayer.get('sourceOptions').excludeAttribute;\n      excludeOffline = olLayer.get('sourceOptions').excludeAttributeOffline;\n    }\n  } else {\n    title = olRenderFeature.get('_title');\n  }\n\n  const olFormat = new OlFormatGeoJSON();\n  const properties = olRenderFeature.getProperties();\n  const geometryType = olRenderFeature.getType();\n\n  if (geometryType === 'Polygon') {\n    const ends = olRenderFeature.getEnds() as number[];\n    geom = new OlPolygon(\n      olRenderFeature.getFlatCoordinates(),\n      'XY' as GeometryLayout,\n      ends\n    );\n  } else if (geometryType === 'Point') {\n    geom = new OlPoint(\n      olRenderFeature.getFlatCoordinates(),\n      'XY' as GeometryLayout\n    );\n  } else if (geometryType === 'LineString') {\n    geom = new OlLineString(\n      olRenderFeature.getFlatCoordinates(),\n      'XY' as GeometryLayout\n    );\n  }\n\n  const geometry = olFormat.writeGeometryObject(geom, {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  const id = olRenderFeature.getId() ? olRenderFeature.getId() : uuid();\n  const mapTitle = olRenderFeature.get('_mapTitle');\n  const extent = olproj.transformExtent(\n    olRenderFeature.getExtent(),\n    projectionIn,\n    projectionOut\n  ) as [number, number, number, number];\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent,\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olRenderFeature\n  };\n}\n/**\n * Create a feature object out of an OL feature\n * The output object has a reference to the feature id.\n * @param olFeature OL Feature\n * @param projectionIn OL feature projection\n * @param olLayer OL Layer\n * @param projectionOut Feature projection\n * @returns Feature\n */\nexport function featureFromOl(\n  olFeature: OlFeature<OlGeometry>,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let title;\n  let exclude;\n  let excludeOffline;\n  let idColumn; // for arcgisrest and tilearcgisrest source\n  const olFormat = new OlFormatGeoJSON();\n\n  const keys = olFeature.getKeys().filter((key: string) => {\n    return !key.startsWith('_') && key !== 'geometry';\n  });\n  const properties = keys.reduce((acc: object, key: string) => {\n    acc[key] = olFeature.get(key);\n    return acc;\n  }, {});\n\n  const geometry = olFormat.writeGeometryObject(olFeature.getGeometry(), {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    const sourceOptions = olLayer.get('sourceOptions');\n    if (sourceOptions) {\n      exclude = sourceOptions.excludeAttribute;\n      excludeOffline = sourceOptions.excludeAttributeOffline;\n      idColumn =\n        sourceOptions.idColumn ||\n        (sourceOptions.type === 'arcgisrest' ||\n        sourceOptions.type === 'tilearcgisrest'\n          ? 'OBJECTID'\n          : undefined);\n    }\n  } else {\n    title = olFeature.get('_title');\n  }\n  const mapTitle = olFeature.get('_mapTitle');\n  const id = olFeature.getId()\n    ? olFeature.getId()\n    : olFeature.get(idColumn)\n    ? olFeature.get(idColumn)\n    : uuid();\n  const newFeature = olFeature.get('_newFeature');\n\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent: olFeature.get('_extent'),\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      revision: olFeature.getRevision(),\n      style: olFeature.get('_style'),\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olFeature\n  };\n}\n\n/**\n * Compute an OL feature extent in it's map projection\n * @param map Map\n * @param olFeature OL feature\n * @returns Extent in the map projection\n */\nexport function computeOlFeatureExtent(\n  olFeature: OlFeature<OlGeometry>,\n  projection: olproj.Projection\n): [number, number, number, number] {\n  let olExtent = olextent.createEmpty();\n\n  const olFeatureExtent = olFeature.get('_extent');\n  const olFeatureProjection = olFeature.get('_projection');\n  if (olFeatureExtent !== undefined && olFeatureProjection !== undefined) {\n    olExtent = olproj.transformExtent(\n      olFeatureExtent,\n      olFeatureProjection,\n      projection\n    );\n  } else {\n    const olGeometry = olFeature.getGeometry();\n    if (olGeometry !== null) {\n      olExtent = olGeometry.getExtent();\n    }\n  }\n\n  return olExtent as [number, number, number, number];\n}\n\n/**\n * Compute a multiple OL features extent in their map projection\n * @param map Map\n * @param olFeatures OL features\n * @returns Extent in the map projection\n */\nexport function computeOlFeaturesExtent(\n  olFeatures: OlFeature<OlGeometry>[],\n  projection: olproj.Projection\n): [number, number, number, number] {\n  const extent = olextent.createEmpty();\n\n  olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const featureExtent = computeOlFeatureExtent(olFeature, projection);\n    olextent.extend(extent, featureExtent);\n  });\n\n  return extent as [number, number, number, number];\n}\n\n/**\n * Scale an extent.\n * @param extent Extent\n * @param Scaling factors for top, right, bottom and left directions, in that order\n * @returns Scaled extent\n */\nexport function scaleExtent(\n  extent: [number, number, number, number],\n  scale: [number, number, number, number]\n): [number, number, number, number] {\n  const [width, height] = olextent.getSize(extent);\n  return [\n    scale[3] ? extent[0] - width * scale[3] : extent[0],\n    scale[2] ? extent[1] - height * scale[2] : extent[1],\n    scale[1] ? extent[2] + width * scale[1] : extent[2],\n    scale[0] ? extent[3] + height * scale[0] : extent[3]\n  ];\n}\n\n/**\n * Return true if features are out of view.\n * If features are too close to the edge, they are considered out of view.\n * By default, we define the edge as 5% (0.05) of the extent size.\n * @param map Map\n * @param featuresExtent The features's extent\n * @param edgeRatio Number or Number[] Single value OR an array =>\n *  [top,right,bottom,left] directions, in that order\n * @returns Return true if features are out of view\n */\nexport function featuresAreOutOfView(\n  extent: MapExtent,\n  featuresExtent: [number, number, number, number],\n  edgeRatio: number | number[] = 0.05\n) {\n  const edgesRatio = Array.isArray(edgeRatio)\n    ? edgeRatio\n    : [edgeRatio, edgeRatio, edgeRatio, edgeRatio];\n  const scale = [-1, -1, -1, -1].map((x, i) => x * edgesRatio[i]);\n  const viewExtent = scaleExtent(\n    extent,\n    scale as [number, number, number, number]\n  );\n\n  return !olextent.containsExtent(viewExtent, featuresExtent);\n}\n\n/**\n * Return true if features are too deep into the view. This results\n * in features being too small.\n * Features are considered too small if their extent occupies less than\n * 1% of the map extent.\n * @param map Map\n * @param featuresExtent The features's extent\n * @param areaRatio The features extent to view extent acceptable ratio\n * @returns Return true if features are too deep in the view\n */\nexport function featuresAreTooDeepInView(\n  viewController: MapViewController,\n  featuresExtent: [number, number, number, number],\n  areaRatio?: number\n) {\n  // An area ratio of 0.004 means that the feature extent's width and height\n  // should be about 1/16 of the map extent's width and height\n  areaRatio = areaRatio ? areaRatio : 0.004;\n  const mapExtent = viewController.getExtent();\n  const mapExtentArea = olextent.getArea(mapExtent);\n  const featuresExtentArea = olextent.getArea(featuresExtent);\n\n  if (featuresExtentArea === 0 && viewController.getZoom() > 13) {\n    // In case it's a point\n    return false;\n  }\n\n  return featuresExtentArea / mapExtentArea < areaRatio;\n}\n\n/**\n * Fit view to include the features extent.\n * By default, this method will let the features occupy about 50% of the viewport.\n * @param map Map\n * @param olFeatures OL features\n * @param motion To motion to the new map view\n * @param scale If this is defined, the original view will be scaled\n *  by that factor before any logic is applied.\n */\nexport function moveToOlFeatures(\n  viewController: MapViewController,\n  olFeatures: OlFeature<OlGeometry>[],\n  motion: FeatureMotion = FeatureMotion.Default,\n  scale?: [number, number, number, number],\n  areaRatio?: number\n) {\n  const extent = viewController.getExtent();\n  const projection = viewController.getOlProjection();\n  const featuresExtent = computeOlFeaturesExtent(olFeatures, projection);\n  let viewExtent = featuresExtent;\n  if (scale !== undefined) {\n    viewExtent = scaleExtent(viewExtent, scale);\n  }\n\n  if (motion === FeatureMotion.Zoom) {\n    viewController.zoomToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Move) {\n    viewController.moveToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Default) {\n    if (\n      featuresAreOutOfView(extent, featuresExtent) ||\n      featuresAreTooDeepInView(viewController, featuresExtent, areaRatio)\n    ) {\n      viewController.zoomToExtent(viewExtent);\n    }\n  }\n}\n\n/**\n * Hide an OL feature\n * @param olFeature OL feature\n */\nexport function hideOlFeature(olFeature: OlFeature<OlGeometry>) {\n  olFeature.setStyle(new olstyle.Style({}));\n}\n\n/**\n * Compute a diff between a source array of Ol features and a target array\n * @param source Source array of OL features\n * @param starget Target array of OL features\n * @returns Features to add and remove\n */\nexport function computeOlFeaturesDiff(\n  source: OlFeature<OlGeometry>[],\n  target: OlFeature<OlGeometry>[]\n): {\n  add: OlFeature<OlGeometry>[];\n  remove: OlFeature<OlGeometry>[];\n} {\n  const olFeaturesMap = new Map();\n  target.forEach((olFeature: OlFeature<OlGeometry>) => {\n    olFeaturesMap.set(olFeature.getId(), olFeature);\n  });\n\n  const olFeaturesToRemove = [];\n  source.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const newOlFeature = olFeaturesMap.get(olFeature.getId());\n    if (newOlFeature === undefined) {\n      olFeaturesToRemove.push(olFeature);\n    } else if (\n      newOlFeature.get('_entityRevision') !== olFeature.get('_entityRevision')\n    ) {\n      olFeaturesToRemove.push(olFeature);\n    } else {\n      olFeaturesMap.delete(newOlFeature.getId());\n    }\n  });\n\n  const olFeaturesToAddIds = Array.from(olFeaturesMap.keys());\n  const olFeaturesToAdd = target.filter((olFeature: OlFeature<OlGeometry>) => {\n    return olFeaturesToAddIds.indexOf(olFeature.getId()) >= 0;\n  });\n\n  return {\n    add: olFeaturesToAdd,\n    remove: olFeaturesToRemove\n  };\n}\n","import { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureStore } from './store';\n\n/**\n * Try to bind a layer to a store if none is bound already.\n * The layer will also be added to the store's map.\n * If no layer is given to that function, a basic one will be created.\n * @param store The store to bind the layer\n * @param layer An optional VectorLayer\n */\nexport function tryBindStoreLayer(store: FeatureStore, layer?: VectorLayer) {\n  if (store.layer !== undefined) {\n    if (store.layer.map === undefined) {\n      store.map.addLayer(store.layer);\n    }\n    return;\n  }\n\n  layer = layer\n    ? layer\n    : new VectorLayer({\n        source: new FeatureDataSource()\n      });\n  store.bindLayer(layer);\n  if (store.layer.map === undefined) {\n    store.map.addLayer(store.layer);\n  }\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olextent from 'ol/extent';\n\nimport { Document } from 'flexsearch';\n\nimport { getEntityId, EntityKey, EntityStoreWithStrategy } from '@igo2/common';\n\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared';\nimport { IgoMap, MapExtent } from '../../map/shared';\n\nimport { FeatureMotion } from './feature.enums';\nimport { Feature, FeatureStoreOptions } from './feature.interfaces';\nimport {\n  computeOlFeaturesDiff,\n  featureFromOl,\n  featureToOl,\n  moveToOlFeatures,\n  computeOlFeaturesExtent\n} from './feature.utils';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * features and the map layer to display them on. Synchronization\n * between the store and the layer is handled by strategies.\n */\nexport class FeatureStore<\n  T extends Feature = Feature\n> extends EntityStoreWithStrategy<T> {\n  /**\n   * Vector layer to display the features on\n   */\n  layer: VectorLayer;\n\n  /**\n   * The map the layer is bound to\n   */\n  readonly map: IgoMap;\n\n  /**\n   * The layer's data source\n   */\n  get source(): FeatureDataSource {\n    return this.layer\n      ? (this.layer.dataSource as FeatureDataSource)\n      : undefined;\n  }\n\n  /**\n   * The searchable index of loaded feature. Computed if strategy is provided\n   */\n  set searchDocument(v: Document<T>) {\n    this._searchDocument = v;\n  }\n\n  get searchDocument(): Document<T> {\n    return this._searchDocument;\n  }\n  private _searchDocument: Document<T>;\n\n  constructor(entities: T[], options: FeatureStoreOptions) {\n    super(entities, options);\n    this.map = options.map;\n  }\n\n  /**\n   * Bind this store to a vector layer\n   * @param layer Vector layer\n   * @returns Feature store\n   */\n  bindLayer(layer: VectorLayer): FeatureStore {\n    this.layer = layer;\n    return this;\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible. Strategies\n   * make extensive use of that method.\n   * @param features Features\n   * @param motion Optional: The type of motion to perform\n   */\n  setLayerFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number,\n    getId?: (Feature) => EntityKey\n  ) {\n    getId = getId ? getId : getEntityId;\n    this.checkLayer();\n\n    const olFeatures = features.map((feature: Feature) =>\n      featureToOl(feature, this.map.projection, getId)\n    );\n    this.setLayerOlFeatures(olFeatures, motion, viewScale, areaRatio);\n  }\n\n  /**\n   * Set the store's features from an array of OL features.\n   * @param olFeatures Ol features\n   */\n  setStoreOlFeatures(olFeatures: OlFeature<OlGeometry>[]) {\n    this.checkLayer();\n\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n      return featureFromOl(olFeature, this.layer.map.projection);\n    });\n    this.load(features as T[]);\n  }\n\n  /**\n   * Remove all features from the layer\n   */\n  clearLayer() {\n    this.checkLayer();\n    this.source.ol.clear();\n  }\n\n  /**\n   * Check wether a layer is bound or not and throw an error if not.\n   */\n  private checkLayer() {\n    if (this.layer === undefined) {\n      throw new Error('This FeatureStore is not bound to a layer.');\n    }\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible.\n   * @param features Openlayers feature objects\n   * @param motion Optional: The type of motion to perform\n   */\n  public setLayerOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number\n  ) {\n    const olSource = this.layer.ol.getSource();\n    const diff = computeOlFeaturesDiff(olSource.getFeatures(), olFeatures);\n    if (diff.remove.length > 0) {\n      this.removeOlFeaturesFromLayer(diff.remove);\n    }\n\n    if (diff.add.length > 0) {\n      this.addOlFeaturesToLayer(diff.add);\n    }\n\n    if (diff.add.length > 0) {\n      // If features are added, do a motion toward the newly added features\n      moveToOlFeatures(\n        this.map.viewController,\n        diff.add,\n        motion,\n        viewScale,\n        areaRatio\n      );\n    } else if (diff.remove.length > 0) {\n      // Else, do a motion toward all the features\n      moveToOlFeatures(\n        this.map.viewController,\n        olFeatures,\n        motion,\n        viewScale,\n        areaRatio\n      );\n    }\n  }\n\n  setLayerExtent(): void {\n    let features = this.entities$.getValue();\n    let extent = olextent.createEmpty() as MapExtent;\n    let olFeatures = [];\n\n    features.forEach((feature) => {\n      olFeatures.push(featureToOl(feature, this.map.projection));\n    });\n    const featuresExtent = computeOlFeaturesExtent(\n      olFeatures,\n      this.map.viewProjection\n    );\n    olextent.extend(extent, featuresExtent);\n    this.layer.setExtent(extent);\n  }\n  /**\n   * Add features to the the layer\n   * @param features Openlayers feature objects\n   */\n  private addOlFeaturesToLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n    });\n    this.source.ol.addFeatures(olFeatures);\n  }\n\n  /**\n   * Remove features from the the layer\n   * @param features Openlayers feature objects\n   */\n  private removeOlFeaturesFromLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      this.source.ol.removeFeature(olFeature);\n    });\n  }\n}\n","import * as olextent from 'ol/extent';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreInMapExtentStrategyOptions } from '../feature.interfaces';\nimport { Subscription } from 'rxjs';\nimport { skipWhile } from 'rxjs/operators';\n\n/**\n * This strategy maintain the store features updated while the map is moved.\n * The features's state inside the map are tagged inMapExtent = true;\n */\nexport class FeatureStoreInMapExtentStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private states$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapExtentStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$\n      .pipe(skipWhile((empty) => !empty))\n      .subscribe(() => this.updateEntitiesInExtent(store));\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInExtent(store);\n    this.states$$.push(\n      store.layer.map.viewController.state$.subscribe(() => {\n        this.updateEntitiesInExtent(store);\n      })\n    );\n  }\n\n  private updateEntitiesInExtent(store) {\n    if (store?.layer?.map?.viewController) {\n      store.state.updateAll({ inMapExtent: false });\n      const mapExtent = store.layer.map.viewController.getExtent();\n      let entitiesInMapExtent = [];\n      let entitiesWithNoGeom = [];\n      for (const entity of store.entities$.value) {\n        if (entity.ol) {\n          if (\n            olextent.intersects(entity.ol.getGeometry().getExtent(), mapExtent)\n          ) {\n            entitiesInMapExtent.push(entity);\n          }\n        } else {\n          entitiesWithNoGeom.push(entity);\n        }\n      }\n      if (entitiesInMapExtent.length > 0) {\n        store.state.updateMany(\n          entitiesInMapExtent,\n          { inMapExtent: true },\n          false\n        );\n      }\n      if (entitiesWithNoGeom.length > 0) {\n        store.state.updateMany(\n          entitiesWithNoGeom,\n          { inMapExtent: true },\n          false\n        );\n      }\n    }\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.states$$.map((state) => state.unsubscribe());\n    if (this.empty$$) {\n      this.empty$$.unsubscribe();\n    }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreInMapResolutionStrategyOptions } from '../feature.interfaces';\nimport { Subscription } from 'rxjs';\n\n/**\n * This strategy maintain the store features updated while the map is scrolled.\n * The features's state inside the map's resolution are tagged inMapResolution = true;\n */\nexport class FeatureStoreInMapResolutionStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private resolution$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapResolutionStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$.subscribe(() =>\n      this.updateEntitiesInResolution(\n        store,\n        store.layer.map.viewController.getResolution()\n      )\n    );\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInResolution(\n      store,\n      store.layer.map.viewController.getResolution()\n    );\n    this.resolution$$.push(\n      store.layer.map.viewController.resolution$.subscribe((res) => {\n        this.updateEntitiesInResolution(store, res);\n      })\n    );\n  }\n\n  private updateEntitiesInResolution(store, mapResolution: number) {\n    if (\n      mapResolution > store.layer.minResolution &&\n      mapResolution < store.layer.maxResolution\n    ) {\n      store.state.updateAll({ inMapResolution: true });\n    } else {\n      store.state.updateAll({ inMapResolution: false });\n    }\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.resolution$$.map((state) => state.unsubscribe());\n    if (this.empty$$) {\n      this.empty$$.unsubscribe();\n    }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common';\nimport { CapabilitiesService } from '../../../datasource/shared/capabilities.service';\nimport { FeatureStore } from '../store';\nimport {\n  Feature,\n  FeatureStorePropertyTypeStrategyOptions\n} from '../feature.interfaces';\nimport { Subscription, debounceTime, pairwise } from 'rxjs';\nimport { PropertyTypeDetectorService } from '../../../utils/propertyTypeDetector/propertyTypeDetector.service';\nimport { ObjectUtils } from '@igo2/utils';\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\nimport { IgoMap } from '../../../map/shared/map';\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { GeoServiceDefinition } from '../../../utils';\n\n/**\n * This strategy maintain the store features updated to detect geoproperties\n * (wms/arcgis... layer and url).\n * The features's state inside the map are tagged haveGeoServiceProperties = true;\n */\nexport class GeoPropertiesStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private states$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  /**\n   * The map the layer is bound to\n   */\n  private readonly map: IgoMap;\n\n  constructor(\n    protected options: FeatureStorePropertyTypeStrategyOptions,\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\n    private capabilitiesService: CapabilitiesService\n  ) {\n    super(options);\n    this.map = options.map;\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesPropertiesState(store);\n    this.states$$.push(\n      this.map.layers$\n        .pipe(debounceTime(750), pairwise())\n        .subscribe(([prevLayers, currentLayers]) => {\n          let prevLayersId;\n          if (prevLayers) {\n            prevLayersId = prevLayers.map((l) => l.id);\n          }\n          const layers = currentLayers.filter(\n            (l) => !prevLayersId.includes(l.id)\n          );\n          this.updateEntitiesPropertiesState(store, layers);\n        })\n    );\n    this.states$$.push(\n      store.entities$.pipe(debounceTime(750)).subscribe((a) => {\n        this.updateEntitiesPropertiesState(store);\n      })\n    );\n  }\n\n  private updateEntitiesPropertiesState(store: FeatureStore, layers?: Layer[]) {\n    const layersId = this.map.layers.map((l) => l.id);\n    let entities: Feature[] = [];\n    if (layers) {\n      entities = store.entities$.value;\n    } else {\n      const allSV = store.stateView.all();\n      entities = allSV.length\n        ? store.stateView\n            .all()\n            .filter((s) => !s.state.geoService)\n            .map((e) => e.entity)\n        : store.entities$.value;\n    }\n    const sampling = entities.length >= 250 ? 250 : entities.length;\n    const firstN = entities.slice(0, sampling);\n    let allKeys = [];\n    firstN.map((e) => {\n      allKeys = allKeys.concat(Object.keys(e.properties || {}));\n    });\n    allKeys = [...new Set(allKeys)];\n    const distinctValues = {};\n    allKeys.map((k) => {\n      distinctValues[k] = [\n        ...new Set(entities.map((item) => item.properties[k]))\n      ];\n    });\n    const containGeoServices = {};\n    Object.entries(distinctValues).forEach((entry: [string, []]) => {\n      const [key, values] = entry;\n      const valuedAreGeoservices = values.filter((value) =>\n        this.propertyTypeDetectorService.isGeoService(value)\n      );\n      if (valuedAreGeoservices?.length) {\n        containGeoServices[key] = valuedAreGeoservices;\n      }\n    });\n    interface GeoServiceAssociation {\n      url: string;\n      layerNameProperty: string;\n      urlProperty: string;\n      geoService: GeoServiceDefinition;\n    }\n    const geoServiceAssociations: GeoServiceAssociation[] = [];\n    Object.entries(containGeoServices).forEach((entry: [string, []]) => {\n      const [key, values] = entry;\n      values.map((value) => {\n        const geoService = this.propertyTypeDetectorService.getGeoService(\n          value,\n          allKeys\n        );\n        if (geoService) {\n          const propertiesForLayerName = allKeys.filter((p) =>\n            geoService.propertiesForLayerName.includes(p)\n          );\n          // providing the the first matching regex;\n          const propertyForLayerName = propertiesForLayerName.length\n            ? propertiesForLayerName[0]\n            : undefined;\n          if (propertyForLayerName) {\n            geoServiceAssociations.push({\n              url: value,\n              urlProperty: key,\n              layerNameProperty: propertyForLayerName,\n              geoService\n            });\n          }\n        }\n      });\n    });\n    const geoServiceStates: {\n      geoServiceAssociation: GeoServiceAssociation;\n      state: any;\n    }[] = [];\n    geoServiceAssociations.map((geoServiceAssociation) => {\n      const url = geoServiceAssociation.url;\n      const type = geoServiceAssociation.geoService.type || 'wms';\n      distinctValues[geoServiceAssociation.layerNameProperty].map(\n        (layerName) => {\n          let appliedLayerName = layerName;\n          let arcgisLayerName = undefined;\n          if (\n            ['arcgisrest', 'imagearcgisrest', 'tilearcgisrest'].includes(type)\n          ) {\n            appliedLayerName = undefined;\n            arcgisLayerName = layerName;\n          }\n          const so = ObjectUtils.removeUndefined({\n            sourceOptions: {\n              type: type || 'wms',\n              url,\n              optionsFromCapabilities: true,\n              optionsFromApi: true,\n              params: {\n                LAYERS: appliedLayerName,\n                LAYER: arcgisLayerName\n              }\n            }\n          });\n          const potentialLayerId = generateIdFromSourceOptions(\n            so.sourceOptions\n          );\n          geoServiceStates.push({\n            geoServiceAssociation,\n            state: {\n              added: layersId.find((l) => l === potentialLayerId) !== undefined,\n              haveGeoServiceProperties: true,\n              type,\n              url,\n              layerName\n            }\n          });\n        }\n      );\n    });\n    geoServiceStates.map((geoServiceState) => {\n      const urlProperty = geoServiceState.geoServiceAssociation.urlProperty;\n      const layerNameProperty =\n        geoServiceState.geoServiceAssociation.layerNameProperty;\n\n      const urlValue = geoServiceState.state.url;\n      const layerNameValue = geoServiceState.state.layerName;\n      const entitiesToProcess = entities.filter(\n        (e) =>\n          e.properties[urlProperty] === urlValue &&\n          e.properties[layerNameProperty] === layerNameValue\n      );\n      const ns = {\n        geoService: geoServiceState.state\n      };\n      store.state.updateMany(entitiesToProcess, ns, true);\n    });\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.states$$.map((state) => state.unsubscribe());\n    if (this.empty$$) {\n      this.empty$$.unsubscribe();\n    }\n  }\n}\n","import { Subscription } from 'rxjs';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureMotion } from '../feature.enums';\nimport {\n  Feature,\n  FeatureStoreLoadingStrategyOptions\n} from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy loads a store's features into it's layer counterpart.\n * The store -> layer binding is a one-way binding. That means any entity\n * added to the store will be added to the layer but the opposite is false.\n *\n * Important: This strategy observes filtered entities, not raw entities. This\n * is not configurable yet.\n */\nexport class FeatureStoreLoadingStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's features\n   */\n  private stores$$ = new Map<FeatureStore, Subscription>();\n\n  private motion: FeatureMotion;\n\n  constructor(protected options: FeatureStoreLoadingStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for entities changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for entities changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Define the motion to apply on load\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for entities changes in a store.\n   * Important: Never observe a store's sorted entities. It makes no sense\n   * to display sorted entities (instead of unsorted) on a layer and it\n   * would potentially result in a lot of useless computation.\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    const subscription = store.view\n      .all$()\n      .subscribe((features: Feature[]) =>\n        this.onFeaturesChange(features, store)\n      );\n    this.stores$$.set(store, subscription);\n  }\n\n  /**\n   * Stop watching for entities changes in a store.\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const subscription = this.stores$$.get(store);\n    if (subscription !== undefined) {\n      subscription.unsubscribe();\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for entities changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach(\n      (entries: [FeatureStore, Subscription]) => {\n        entries[1].unsubscribe();\n      }\n    );\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features into a layer or clear the layer if the array of features is empty.\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onFeaturesChange(features: Feature[], store: FeatureStore) {\n    if (features.length === 0) {\n      store.clearLayer();\n    } else {\n      store.setLayerFeatures(\n        features,\n        this.selectMotion(store),\n        this.options.viewScale,\n        this.options.areaRatio,\n        this.options.getFeatureId\n      );\n    }\n  }\n\n  /**\n   * Selects the best motion\n   * @param store A FeatureStore to apply the motion\n   * @returns The motion selected\n   */\n  private selectMotion(store: FeatureStore) {\n    if (this.motion !== undefined) {\n      return this.motion;\n    }\n\n    if (store.pristine === true) {\n      // If features have just been loaded into the store, move/zoom on them\n      return FeatureMotion.Default;\n    } else if (store.count > store.view.count) {\n      // If features have been filtered, move/zoom on the remaining ones\n      return FeatureMotion.Default;\n    } else {\n      // On insert, update or delete, do nothing\n      return FeatureMotion.None;\n    }\n  }\n}\n","import OlEvent from 'ol/events/Event';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreLoadingLayerStrategyOptions } from '../feature.interfaces';\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\n\n/**\n * This strategy loads a layer's features into it's store counterpart.\n * The layer -> store binding is a one-way binding. That means any OL feature\n * added to the layer will be added to the store but the opposite is false.\n *\n * Important: In it's current state, this strategy is to meant to be combined\n * with a standard Loading strategy and it would probably cause recursion issues.\n */\nexport class FeatureStoreLoadingLayerStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n\n  constructor(protected options: FeatureStoreLoadingLayerStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.onSourceChanges(store);\n    const olSource = store.layer.ol.getSource();\n    olSource.on('change', (event: OlEvent) => {\n      this.onSourceChanges(store);\n    });\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach(\n      (entries: [FeatureStore, string]) => {}\n    );\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features from an OL source into a  store or clear the store if the source is empty\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onSourceChanges(store: FeatureStore) {\n    let olFeatures = store.layer.ol.getSource().getFeatures();\n\n    if (store.layer.dataSource instanceof ClusterDataSource) {\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\n        cluster.get('features')\n      );\n    }\n    if (olFeatures.length === 0) {\n      store.clear();\n    } else {\n      store.setStoreOlFeatures(olFeatures);\n    }\n  }\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlDragBoxInteraction, { DragBoxEvent } from 'ol/interaction/DragBox';\nimport { DragBoxEvent as OlDragBoxEvent } from 'ol/interaction/DragBox';\nimport { EventsKey } from 'ol/events';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\n\nimport { Subscription, combineLatest } from 'rxjs';\nimport { map, debounceTime, skip } from 'rxjs/operators';\n\nimport { EntityKey, EntityRecord, EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureDataSource } from '../../../datasource';\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../../map/shared/map';\nimport { ctrlKeyDown } from '../../../map/shared/map.utils';\n\nimport {\n  Feature,\n  FeatureStoreSelectionStrategyOptions\n} from '../feature.interfaces';\nimport { FeatureStore } from '../store';\nimport { FeatureMotion } from '../feature.enums';\n\nexport class OlDragSelectInteraction extends OlDragBoxInteraction {\n  constructor(options) {\n    super(options);\n  }\n}\n\n/**\n * This strategy synchronizes a store and a layer selected entities.\n * The store <-> layer binding is a two-way binding.\n *\n * In many cases, a single strategy bound to multiple stores\n * will yield better results that multiple strategies with each their\n * own store. In the latter scenario, a click on overlapping features\n * would trigger the strategy of each layer and they would cancel\n * each other as well as move the map view around needlessly.\n */\nexport class FeatureStoreSelectionStrategy extends EntityStoreStrategy {\n  /**\n   * Listener to the map click event that allows selecting a feature\n   * by clicking on the map\n   */\n  private mapClickListener;\n\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Subscription to all stores selected entities\n   */\n  private stores$$: Subscription;\n\n  private motion: FeatureMotion;\n\n  /**\n   * The map the layers belong to\n   */\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  /**\n   * A feature store that'll contain the selected features. It has it's own\n   * layer, shared by all the stores this staretgy is bound to.\n   */\n  get overlayStore(): FeatureStore {\n    return this._overlayStore;\n  }\n  private _overlayStore: FeatureStore;\n\n  constructor(protected options: FeatureStoreSelectionStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n    this._overlayStore = this.createOverlayStore();\n  }\n\n  /**\n   * Bind this strategy to a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Define the motion to apply on select\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Unselect all entities, from all stores\n   */\n  unselectAll() {\n    this.stores.forEach((store: FeatureStore) => {\n      store.state.updateAll({ selected: false });\n    });\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.overlayStore.source.ol.clear();\n    this.overlayStore.clear();\n  }\n\n  /**\n   * Deactivate the selection without removing the selection\n   * overlay.\n   */\n  deactivateSelection() {\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n    this.unwatchAll();\n  }\n\n  /**\n   * Add the overlay layer, setup the map click lsitener and\n   * start watching for stores selection\n   * @internal\n   */\n  protected doActivate() {\n    this.addOverlayLayer();\n    this.listenToMapClick();\n    if (this.options.dragBox === true) {\n      this.addDragBoxInteraction();\n    }\n    this.watchAll();\n  }\n\n  /**\n   * Remove the overlay layer, remove the map click lsitener and\n   * stop watching for stores selection\n   * @internal\n   */\n  protected doDeactivate() {\n    this.deactivateSelection();\n    this.removeOverlayLayer();\n  }\n\n  /**\n   * Create a single observable of all the stores. With a single observable,\n   * features can be added all at once to the overlay layer and a single\n   * motion can be performed. Multiple observable would have\n   * a cancelling effect on each other.\n   */\n  private watchAll() {\n    this.unwatchAll();\n\n    const stores$ = this.stores.map((store: FeatureStore) => {\n      return store.stateView\n        .manyBy$((record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        })\n        .pipe(\n          map((records: EntityRecord<Feature>[]) =>\n            records.map((record) => record.entity)\n          )\n        );\n    });\n    this.stores$$ = combineLatest(stores$)\n      .pipe(\n        debounceTime(5),\n        skip(1), // Skip intial selection\n        map((features: Array<Feature[]>) =>\n          features.reduce((a, b) => a.concat(b))\n        )\n      )\n      .subscribe((features: Feature[]) => this.onSelectFromStore(features));\n  }\n\n  /**\n   * Stop watching for selection in all stores.\n   */\n  private unwatchAll() {\n    if (this.stores$$ !== undefined) {\n      this.stores$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a 'singleclick' listener to the map that'll allow selecting\n   * features by clicking on the map. The selection will be performed\n   * only on the layers bound to this strategy.\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => {\n        this.onMapClick(event);\n      }\n    );\n  }\n\n  /**\n   * Remove the map click listener\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n  }\n\n  /**\n   * On map click, select feature at pixel\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onMapClick(event: MapBrowserPointerEvent<any>) {\n    const exclusive = !ctrlKeyDown(event);\n    const reverse = !exclusive;\n    const olFeatures = event.map.getFeaturesAtPixel(event.pixel, {\n      hitTolerance: this.options.hitTolerance || 0,\n      layerFilter: (olLayer) => {\n        const storeOlLayer = this.stores.find((store: FeatureStore) => {\n          return store.layer?.ol === olLayer;\n        });\n        return storeOlLayer !== undefined;\n      }\n    }) as OlFeature<OlGeometry>[];\n    this.onSelectFromMap(olFeatures, exclusive, reverse);\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteraction;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteraction = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteraction === undefined) {\n      olDragSelectInteraction = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteraction);\n      this.olDragSelectInteraction = olDragSelectInteraction;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteraction.on(\n      'boxend',\n      (event: DragBoxEvent) => this.onDragBoxEnd(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n\n  /**\n   * On dragbox end, select features in drag box\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onDragBoxEnd(event: OlDragBoxEvent) {\n    const exclusive = !ctrlKeyDown(event.mapBrowserEvent);\n    const target = event.target as any;\n    const extent = target.getGeometry().getExtent();\n    const olFeatures = this.stores.reduce(\n      (acc: OlFeature<OlGeometry>[], store: FeatureStore) => {\n        const olSource = store.layer.ol.getSource();\n        acc.push(...olSource.getFeaturesInExtent(extent));\n        return acc;\n      },\n      []\n    );\n    this.onSelectFromMap(olFeatures, exclusive, false);\n  }\n\n  /**\n   * When features are selected from the store, add\n   * them to this startegy's overlay layer (select on map)\n   * @param features Store features\n   */\n  private onSelectFromStore(features: Feature[]) {\n    const motion = this.motion;\n    const olOverlayFeatures = this.overlayStore.layer.ol\n      .getSource()\n      .getFeatures();\n    const overlayFeaturesKeys = olOverlayFeatures.map(\n      (olFeature: OlFeature<OlGeometry>) => olFeature.getId()\n    );\n    const featuresKeys = features.map(this.overlayStore.getKey);\n\n    let doMotion;\n    if (features.length === 0) {\n      doMotion = false;\n    } else {\n      doMotion =\n        overlayFeaturesKeys.length !== featuresKeys.length ||\n        !overlayFeaturesKeys.every(\n          (key: EntityKey) => featuresKeys.indexOf(key) >= 0\n        );\n    }\n\n    this.overlayStore.setLayerFeatures(\n      features,\n      doMotion ? motion : FeatureMotion.None,\n      this.options.viewScale,\n      this.options.areaRatio,\n      this.options.getFeatureId\n    );\n  }\n\n  /**\n   * When features are selected from the map, also select them\n   * in their store.\n   * @param olFeatures OL feature objects\n   */\n  private onSelectFromMap(\n    olFeatures: OlFeature<OlGeometry>[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    const groupedFeatures = this.groupFeaturesByStore(olFeatures);\n\n    this.stores.forEach((store: FeatureStore) => {\n      const features = groupedFeatures.get(store);\n      if (features === undefined && exclusive === true) {\n        this.unselectAllFeaturesFromStore(store);\n      } else if (features === undefined && exclusive === false) {\n        // Do nothing\n      } else {\n        this.selectFeaturesFromStore(store, features, exclusive, reverse);\n      }\n    });\n  }\n\n  /**\n   * Select features in store\n   * @param store: Feature store\n   * @param features Features\n   */\n  private selectFeaturesFromStore(\n    store: FeatureStore,\n    features: Feature[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    if (reverse === true) {\n      store.state.reverseMany(features, ['selected']);\n    } else {\n      store.state.updateMany(features, { selected: true }, exclusive);\n    }\n  }\n\n  /**\n   * Unselect all features from store\n   * @param store: Feature store\n   */\n  private unselectAllFeaturesFromStore(store: FeatureStore) {\n    store.state.updateAll({ selected: false });\n  }\n\n  /**\n   * This method returns a store -> features mapping from a list\n   * of OL selected features. OL features keep a reference to the store\n   * they are from.\n   * @param olFeatures: OL feature objects\n   * @returns Store -> features mapping\n   */\n  private groupFeaturesByStore(\n    olFeatures: OlFeature<OlGeometry>[]\n  ): Map<FeatureStore, Feature[]> {\n    const groupedFeatures = new Map<FeatureStore, Feature[]>();\n    if (olFeatures === null || olFeatures === undefined) {\n      return groupedFeatures;\n    }\n\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      const store = olFeature.get('_featureStore');\n      if (store === undefined) {\n        return;\n      }\n\n      let features = groupedFeatures.get(store);\n      if (features === undefined) {\n        features = [];\n        groupedFeatures.set(store, features);\n      }\n\n      const feature = store.get(olFeature.getId());\n      if (feature !== undefined) {\n        features.push(feature);\n      }\n    });\n\n    return groupedFeatures;\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay store\n   */\n  private createOverlayStore(): FeatureStore {\n    const overlayLayer = this.options.layer\n      ? this.options.layer\n      : this.createOverlayLayer();\n    return new FeatureStore([], { map: this.map }).bindLayer(overlayLayer);\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay layer\n   */\n  private createOverlayLayer(): VectorLayer {\n    return new VectorLayer({\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      style: undefined,\n      showInLayerList: false,\n      exportable: false,\n      browsable: false\n    });\n  }\n\n  /**\n   * Add the overlay store's layer to the map to display the selected\n   * features.\n   */\n  private addOverlayLayer() {\n    if (this.overlayStore.layer.map === undefined) {\n      this.map.addLayer(this.overlayStore.layer);\n    }\n  }\n\n  /**\n   * Remove the overlay layer from the map\n   */\n  private removeOverlayLayer() {\n    this.overlayStore.source.ol.clear();\n    this.map.removeLayer(this.overlayStore.layer);\n  }\n}\n","import { Document, DocumentOptions } from 'flexsearch';\nimport { EntityStoreStrategy } from '@igo2/common';\nimport { FeatureStore } from '../store';\nimport { FeatureStoreSearchIndexStrategyOptions } from '../feature.interfaces';\nimport { skipWhile } from 'rxjs/operators';\n\n/**\n *\n * This strategy loads a layer's features's properties into a searchable index.\n */\nexport class FeatureStoreSearchIndexStrategy extends EntityStoreStrategy {\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n\n  constructor(protected options: FeatureStoreSearchIndexStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for entities changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for entities changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  private initStoreSearchIndex(store) {\n    store.searchDocument = new Document({ tokenize: 'full' });\n  }\n\n  /**\n   * Watch for a store's entities changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n    this.initStoreSearchIndex(store);\n\n    store.entities$\n      .pipe(skipWhile((e) => !e.length))\n      .subscribe(() => this.onEntitiesChanges(store));\n  }\n\n  /**\n   * Stop watching for a store's entities changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      store.searchDocument = undefined;\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach(\n      (entries: [FeatureStore, string]) => {}\n    );\n    this.stores$$.clear();\n  }\n\n  /**\n   * Maintain searcahble index for every loaded entities\n   * @param store Feature store\n   */\n  private onEntitiesChanges(store: FeatureStore) {\n    const ratio = this.options.percentDistinctValueRatio || 2;\n    const featuresProperties = [];\n    store.index.forEach((value, key) => {\n      const fp = value.properties;\n      fp.igoSearchID = key;\n      featuresProperties.push(fp);\n    });\n    const toIndex = [];\n    let columnsToNotIndex = [];\n    let contentToIndex = [];\n    if (this.options.sourceFields) {\n      columnsToNotIndex = this.options.sourceFields.filter(\n        (sf) => !sf.searchIndex?.enabled\n      );\n      contentToIndex = this.options.sourceFields\n        .filter((sf) => sf.searchIndex?.enabled)\n        .map((sf2) => {\n          return Object.assign(\n            {},\n            { field: sf2.name, tokenize: 'full' },\n            sf2.searchIndex\n          );\n        });\n    } else {\n      if (featuresProperties.length) {\n        // THIS METHOD COMPUTE COLUMN DISTINCT VALUE TO FILTER WHICH COLUMN TO INDEX BASED ON A RATIO or discard float columns\n        const columns = Object.keys(featuresProperties[0]);\n        const columnsToIndex = [];\n        columnsToNotIndex = columns\n          .map((column) => {\n            const distinctValues = [\n              ...new Set(featuresProperties.map((item) => item[column]))\n            ];\n            // identify column to not index based on a ratio distinctValues/nb of features OR discart exclusive float column (ex: lat, long)\n            if (\n              (distinctValues.length / featuresProperties.length) * 100 <=\n                ratio ||\n              distinctValues.every((n) => Number(n) === n && n % 1 !== 0)\n            ) {\n              columnsToNotIndex.push(column);\n            } else {\n              columnsToIndex.push(column);\n            }\n          })\n          .filter((f) => f);\n        const keysToIndex = columnsToIndex.filter((f) => f !== 'igoSearchID');\n        contentToIndex = keysToIndex.map((key) => {\n          return { field: key, tokenize: 'full' };\n        });\n      }\n    }\n    store.index.forEach((value, key) => {\n      const propertiesToIndex = JSON.parse(JSON.stringify(value.properties));\n      columnsToNotIndex.map((c) => delete propertiesToIndex[c]);\n      if (Object.keys(propertiesToIndex).length) {\n        toIndex.push(propertiesToIndex);\n      }\n    });\n\n    if (toIndex.length === 0) {\n      this.initStoreSearchIndex(store);\n    } else {\n      store.searchDocument = new Document({\n        document: {\n          id: 'igoSearchID',\n          index: contentToIndex\n        } as DocumentOptions<any>\n      });\n      toIndex.map((i) => {\n        store.searchDocument.add(i.igoSearchID, i);\n      });\n    }\n  }\n}\n","import { FeatureStore } from './store';\nimport { FeatureStoreSelectionStrategy } from './strategies/selection';\nimport { FeatureStoreLoadingStrategy } from './strategies/loading';\n\n/**\n * Try to add a loading strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the loading strategy\n * @param strategy An optional loading strategy\n */\nexport function tryAddLoadingStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreLoadingStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreLoadingStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreLoadingStrategy);\n    return;\n  }\n\n  strategy = strategy ? strategy : new FeatureStoreLoadingStrategy({});\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n\n/**\n * Try to add a selection strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the selection strategy\n * @param [strategy] An optional selection strategy\n */\nexport function tryAddSelectionStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreSelectionStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreSelectionStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n    return;\n  }\n  strategy = strategy\n    ? strategy\n    : new FeatureStoreSelectionStrategy({\n        map: store.map\n      });\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n","import * as olstyle from 'ol/style';\nimport { asArray as ColorAsArray } from 'ol/color';\n\n/**\n * Create a marker style for points\n * @returns Style\n */\nexport function createOverlayMarkerStyle({\n  text,\n  opacity = 1,\n  markerColor = [0, 161, 222],\n  markerOutlineColor = [255, 255, 255]\n}: {\n  text?: string;\n  opacity?: number;\n  markerColor?: string | number[];\n  markerOutlineColor?: string | number[];\n} = {}): olstyle.Style {\n  let iconColor;\n  let svgIconColor;\n  let svgOutlineColor;\n  let svg;\n\n  const newColor = ColorAsArray(markerColor).slice(0);\n  const newOutlineColor = ColorAsArray(markerOutlineColor).slice(0);\n\n  if (\n    newColor.length === 4 &&\n    (typeof markerColor !== 'string' ||\n      /^#[0-9A-F]{8}$/i.test(markerColor as string))\n  ) {\n    opacity = newColor[3];\n  }\n\n  svgIconColor = `\"rgba(${newColor[0]},${newColor[1]},${newColor[2]},${opacity})\"`;\n  iconColor = markerColor;\n\n  svgOutlineColor = `\"rgb(${newOutlineColor[0]},${newOutlineColor[1]},${newOutlineColor[2]})\"`;\n\n  svg =\n    'data:image/svg+xml;utf8,<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" height=\"36\" width=\"36\" viewBox=\"0 0 36 36\">' +\n    '<path fill=' +\n    svgIconColor +\n    ' stroke=' +\n    svgOutlineColor +\n    ` stroke-width=\"2\" d=\"M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z\"></path>` +\n    '</svg>';\n\n  return new olstyle.Style({\n    image: new olstyle.Icon({\n      src: svg,\n      opacity,\n      anchor: [0.5, 0.92]\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import { Injectable } from '@angular/core';\n\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olStyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\n\nimport { createOverlayMarkerStyle } from '../shared/overlay/overlay-marker-style.utils';\nimport RenderFeature from 'ol/render/Feature';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\nimport { StyleByAttribute } from '../shared/vector/vector-style.interface';\nimport { ClusterParam } from '../../layer/shared/clusterParam';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleService {\n  public style: olStyle.Style;\n\n  /**\n   * Create a style based on a object as\n   * style: {\n   *       \"stroke\": {\n   *         \"color\": \"blue\",\n   *         \"lineDash\": [10, 5]\n   *       },\n   *       \"text\": {\n   *         \"minScaleDenom\": 50000,\n   *         \"maxScaleDenom\": 200000,\n   *         \"minResolution\": 100,\n   *         \"maxResolution\": 400,\n   *         \"attribute\": \"THE COLUMN NAME TO RETRIEVE THE LABEL VALUE\",\n   *         \"text\": \"MY HARCODED TEXT\",\n   *         \"stroke\": {\n   *           \"color\": \"blue\",\n   *           \"width\": 0.75\n   *         },\n   *         \"fill\": {\n   *           \"color\": \"black\"\n   *         },\n   *         \"font\": \"20px sans-serif\",\n   *         \"overflow\": true,\n   *         \"offsetX\": 10,\n   *         \"offsetY\": 20,\n   *         \"padding\": [2.5, 2.5, 2.5, 2.5]\n   *       },\n   *       \"width\": 5\n   *     }\n   *\n   * @param options\n   * @param feature feature to apply style on\n   * @param resolution current map resolution, to control label resolution range\n   * @returns\n   */\n  createStyle(\n    options: { [key: string]: any },\n    feature?: RenderFeature | OlFeature<OlGeometry>,\n    resolution?: number\n  ) {\n    if (!options) {\n      return createOverlayMarkerStyle();\n    }\n    if (typeof options === 'function' || options instanceof olStyle.Style) {\n      return options;\n    }\n    const parsedStyle = this.parseStyle('style', options);\n    if (parsedStyle.getText()) {\n      let labelMinResolution = 0;\n      let labelMaxResolution = Infinity;\n      if (options.text) {\n        const labelMinResolutionFromScale = options.text?.minScaleDenom\n          ? getResolutionFromScale(Number(options.text.minScaleDenom))\n          : undefined;\n        const labelMaxResolutionFromScale = options.text?.maxScaleDenom\n          ? getResolutionFromScale(Number(options.text.maxScaleDenom))\n          : undefined;\n        const minResolution = options.text?.minResolution\n          ? options.text.minResolution\n          : 0;\n        const maxResolution = options.text?.maxResolution\n          ? options.text.maxResolution\n          : Infinity;\n\n        labelMinResolution = labelMinResolutionFromScale || minResolution;\n        labelMaxResolution = labelMaxResolutionFromScale || maxResolution;\n      }\n      if (\n        options.text?.minScaleDenom ||\n        options.text?.maxScaleDenom ||\n        options.text?.minResolution ||\n        options.text?.maxResolution\n      ) {\n        if (\n          feature &&\n          resolution >= labelMinResolution &&\n          resolution <= labelMaxResolution\n        ) {\n          if (feature && options.text.attribute) {\n            parsedStyle\n              .getText()\n              .setText(this.getLabel(feature, options.text.attribute));\n          }\n        } else {\n          parsedStyle.setText();\n        }\n      }\n    }\n    return parsedStyle;\n  }\n\n  public parseStyle(key: string, value: any) {\n    const styleOptions = {};\n    const olCls = this.getOlCls(key);\n\n    if (olCls && value instanceof Object) {\n      Object.keys(value).forEach((_key) => {\n        const olKey = this.getOlKey(_key);\n        styleOptions[olKey] = this.parseStyle(_key, value[_key]);\n      });\n      return new olCls(styleOptions);\n    } else {\n      return value;\n    }\n  }\n\n  private getOlKey(key: any) {\n    let olKey;\n    switch (key.toLowerCase()) {\n      case 'circle':\n      case 'regularshape':\n      case 'icon':\n        olKey = 'image';\n        break;\n      default:\n        break;\n    }\n\n    return olKey || key;\n  }\n\n  private getOlCls(key: any) {\n    let olCls = olStyle[key.charAt(0).toUpperCase() + key.slice(1)];\n    if (key === 'regularshape') {\n      olCls = olStyle.RegularShape;\n    }\n    if (key === 'backgroundFill') {\n      olCls = olStyle.Fill;\n    }\n    if (key === 'backgroundStroke') {\n      olCls = olStyle.Stroke;\n    }\n\n    return olCls;\n  }\n\n  createStyleByAttribute(\n    feature: RenderFeature | OlFeature<OlGeometry>,\n    styleByAttribute: StyleByAttribute,\n    resolution: number\n  ) {\n    let style;\n    const type = styleByAttribute.type\n      ? styleByAttribute.type\n      : this.guessTypeFeature(feature);\n    const attribute = styleByAttribute.attribute;\n    const data = styleByAttribute.data;\n    const stroke = styleByAttribute.stroke;\n    const width = styleByAttribute.width;\n    const fill = styleByAttribute.fill;\n    const anchor = styleByAttribute.anchor;\n    const radius = styleByAttribute.radius;\n    const icon = styleByAttribute.icon;\n    const scale = styleByAttribute.scale;\n    const size = data ? data.length : 0;\n    const label = styleByAttribute.label\n      ? styleByAttribute.label.attribute\n      : undefined;\n    const labelMinResolutionFromScale = styleByAttribute.label?.minScaleDenom\n      ? getResolutionFromScale(Number(styleByAttribute.label.minScaleDenom))\n      : undefined;\n    const labelMaxResolutionFromScale = styleByAttribute.label?.maxScaleDenom\n      ? getResolutionFromScale(Number(styleByAttribute.label.maxScaleDenom))\n      : undefined;\n    const minResolution = styleByAttribute.label?.minResolution\n      ? styleByAttribute.label.minResolution\n      : 0;\n    const maxResolution = styleByAttribute.label?.maxResolution\n      ? styleByAttribute.label.maxResolution\n      : Infinity;\n\n    const labelMinResolution = labelMinResolutionFromScale || minResolution;\n    const labelMaxResolution = labelMaxResolutionFromScale || maxResolution;\n\n    let labelStyle = styleByAttribute.label?.style\n      ? this.parseStyle('text', styleByAttribute.label.style)\n      : undefined;\n    if (!labelStyle && label) {\n      labelStyle = new olStyle.Text();\n    }\n    const baseStyle = styleByAttribute.baseStyle;\n\n    if (labelStyle) {\n      if (\n        resolution >= labelMinResolution &&\n        resolution <= labelMaxResolution\n      ) {\n        labelStyle.setText(this.getLabel(feature, label));\n      } else {\n        labelStyle.setText('');\n      }\n    }\n\n    if (type === 'circle') {\n      for (let i = 0; i < size; i++) {\n        const val =\n          typeof feature.get(attribute) !== 'undefined' &&\n          feature.get(attribute) !== null\n            ? feature.get(attribute)\n            : '';\n        if (\n          val === data[i] ||\n          val.toString().match(new RegExp(data[i], 'gmi'))\n        ) {\n          if (icon) {\n            style = [\n              new olStyle.Style({\n                image: new olStyle.Icon({\n                  color: fill ? fill[i] : undefined,\n                  src: icon[i],\n                  scale: scale ? scale[i] : 1,\n                  anchor: anchor ? anchor[i] : [0.5, 0.5]\n                }),\n                text:\n                  labelStyle instanceof olStyle.Text ? labelStyle : undefined\n              })\n            ];\n            return style;\n          }\n          style = [\n            new olStyle.Style({\n              image: new olStyle.Circle({\n                radius: radius ? radius[i] : 4,\n                stroke: new olStyle.Stroke({\n                  color: stroke ? stroke[i] : 'black',\n                  width: width ? width[i] : 1\n                }),\n                fill: new olStyle.Fill({\n                  color: fill ? fill[i] : 'black'\n                })\n              }),\n              text: labelStyle instanceof olStyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (!(feature as OlFeature<OlGeometry>).getStyle()) {\n        if (baseStyle) {\n          style = this.createStyle(baseStyle, feature, resolution);\n          if (labelStyle) {\n            style.setText(labelStyle);\n          }\n          return style;\n        }\n        style = [\n          new olStyle.Style({\n            image: new olStyle.Circle({\n              radius: 4,\n              stroke: new olStyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olStyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          })\n        ];\n        return style;\n      }\n    } else if (type === 'regular') {\n      for (let i = 0; i < size; i++) {\n        const val =\n          typeof feature.get(attribute) !== 'undefined' &&\n          feature.get(attribute) !== null\n            ? feature.get(attribute)\n            : '';\n        if (\n          val === data[i] ||\n          val.toString().match(new RegExp(data[i], 'gmi'))\n        ) {\n          style = [\n            new olStyle.Style({\n              stroke: new olStyle.Stroke({\n                color: stroke ? stroke[i] : 'black',\n                width: width ? width[i] : 1\n              }),\n              fill: new olStyle.Fill({\n                color: fill ? fill[i] : 'rgba(255,255,255,0.4)'\n              }),\n              text: labelStyle instanceof olStyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (feature instanceof OlFeature) {\n        if (!feature.getStyle()) {\n          if (baseStyle) {\n            style = this.createStyle(baseStyle, feature, resolution);\n            if (labelStyle) {\n              style.setText(labelStyle);\n            }\n            return style;\n          }\n          style = [\n            new olStyle.Style({\n              stroke: new olStyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olStyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          ];\n          return style;\n        }\n      }\n    }\n  }\n\n  createClusterStyle(\n    feature: RenderFeature | OlFeature<OlGeometry>,\n    resolution: number,\n    clusterParam: ClusterParam = {},\n    layerStyle\n  ) {\n    let style;\n    const size = feature.get('features').length;\n    if (size !== 1) {\n      if (clusterParam.clusterRanges) {\n        for (const r of clusterParam.clusterRanges) {\n          if (\n            (!r.minRadius || r.minRadius <= size) &&\n            (!r.maxRadius || r.maxRadius >= size)\n          ) {\n            style = this.createStyle(r.style) as olStyle.Circle;\n\n            if (r.showRange) {\n              const text = new olStyle.Text({\n                text: size.toString(),\n                fill: new olStyle.Fill({\n                  color: '#fff'\n                })\n              });\n              style.setText(text);\n            }\n\n            if (r.dynamicRadius) {\n              let clusterRadius: number;\n              const radiusMin = style.getRadius();\n              clusterRadius = 5 * Math.log(size);\n              if (clusterRadius < radiusMin) {\n                clusterRadius = radiusMin;\n              }\n              style.image_.setRadius(clusterRadius);\n            }\n            break;\n          }\n        }\n      }\n\n      if (!style) {\n        let clusterRadius: number;\n        if (clusterParam.radiusCalc) {\n          clusterRadius = clusterParam.radiusCalc(size);\n        } else {\n          const radiusMin = 6;\n          clusterRadius = 5 * Math.log(size);\n          if (clusterRadius < radiusMin) {\n            clusterRadius = radiusMin;\n          }\n        }\n\n        style = [\n          new olStyle.Style({\n            image: new olStyle.Circle({\n              radius: clusterRadius,\n              stroke: new olStyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olStyle.Fill({\n                color: 'rgba(24, 134, 45, 0.5)'\n              })\n            }),\n            text: new olStyle.Text({\n              text: size.toString(),\n              fill: new olStyle.Fill({\n                color: '#fff'\n              })\n            })\n          })\n        ];\n      }\n    } else {\n      style = this.createStyle(layerStyle, feature, resolution);\n    }\n    return style;\n  }\n\n  getLabel(feature, labelMatch): string {\n    let label = labelMatch;\n    if (!label) {\n      return;\n    }\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach((v) => {\n      label = label.replace(v[0], feature.get(v[1]));\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.get(labelMatch) || labelMatch;\n    }\n\n    return label;\n  }\n\n  private guessTypeFeature(feature) {\n    switch (feature.getGeometry().getType()) {\n      case 'Point':\n      case 'MultiPoint':\n      case 'Circle':\n        return 'circle';\n      default:\n        return 'regular';\n    }\n  }\n}\n","import * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\nimport { StyleService } from '../../../style/style-service/style.service';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { createOverlayMarkerStyle } from './overlay-marker-style.utils';\n\n/**\n * Create an overlay style with markers for points and a basic stroke/fill\n * combination for lines and polygons\n * @returns Style function\n */\nexport function createOverlayLayerStyle(): (\n  olFeature: OlFeature<OlGeometry>,\n  resolution: number\n) => olstyle.Style {\n  const defaultStyle = createOverlayDefaultStyle();\n  const markerStyle = createOverlayMarkerStyle();\n\n  let style;\n\n  return (olFeature: OlFeature<OlGeometry>, resolution) => {\n    if (olFeature.getId() === 'bufferFeature') {\n      style = createBufferStyle(\n        olFeature.get('bufferStroke'),\n        2,\n        olFeature.get('bufferFill'),\n        olFeature.get('bufferText')\n      );\n      return style;\n    } else {\n      const customStyle = olFeature.get('_style');\n      if (customStyle) {\n        const styleService = new StyleService();\n        return styleService.createStyle(customStyle, olFeature, resolution);\n      }\n      const geometryType = olFeature.getGeometry().getType();\n      style = geometryType === 'Point' ? markerStyle : defaultStyle;\n      style.getText().setText(olFeature.get('_mapTitle'));\n      return style;\n    }\n  };\n}\n\n/**\n * Create a basic style for lines and polygons\n * @returns Style\n */\nexport function createOverlayDefaultStyle({\n  text,\n  strokeWidth = 2,\n  fillColor = [0, 161, 222, 0.3],\n  strokeColor = [0, 161, 222, 0.9]\n}: {\n  text?: string;\n  strokeWidth?: number;\n  fillColor?: string | number[];\n  strokeColor?: string | number[];\n} = {}): olstyle.Style {\n  const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n  const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeWithOpacity\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillWithOpacity\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n\nfunction createBufferStyle(\n  strokeRGBA: [number, number, number, number] = [0, 161, 222, 1],\n  strokeWidth: number = 2,\n  fillRGBA: [number, number, number, number] = [0, 161, 222, 0.15],\n  bufferRadius?\n): olstyle.Style {\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeRGBA\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillRGBA\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      font: '12px Calibri,sans-serif',\n      text: bufferRadius,\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  Feature,\n  FeatureMotion,\n  featureToOl,\n  moveToOlFeatures\n} from '../../feature/shared';\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\n\nimport { createOverlayLayer } from './overlay.utils';\nimport { MapBase } from '../../map/shared/map.abstract';\n\n/**\n * This class is simply a shortcut for adding features to a map.\n * It does nothing more than a standard layer but it's shipped with\n * a defautl style based on the geometry type of the features it contains.\n * @todo Enhance that by using a FeatureStore and strategies.\n */\nexport class Overlay<T extends MapBase = MapBase> {\n  /**\n   * The map to add the layer to\n   */\n  private map: T;\n\n  /**\n   * Overlay layer\n   */\n  private layer: VectorLayer;\n\n  /**\n   * Overlay layer's data source\n   */\n  get dataSource(): FeatureDataSource {\n    return this.layer.dataSource as FeatureDataSource;\n  }\n\n  constructor(map?: T) {\n    this.layer = createOverlayLayer();\n    this.setMap(map);\n  }\n\n  /**\n   * Bind this to a map and add the overlay layer to that map\n   * @param map Map\n   */\n  setMap(map: T) {\n    if (map === undefined) {\n      if (this.map !== undefined) {\n        this.map.ol.removeLayer(this.layer.ol);\n      }\n    } else {\n      map.ol.addLayer(this.layer.ol);\n    }\n    this.map = map;\n  }\n\n  /**\n   * Set the overlay features and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   * @param sourceId Optional: Remove features of certain sourceId (ex: 'Map' for query features)\n   */\n  setFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    sourceId?: string\n  ) {\n    if (sourceId) {\n      for (const olFeature of this.dataSource.ol.getFeatures()) {\n        if (olFeature.get('_sourceId') === sourceId) {\n          this.removeOlFeature(olFeature);\n        }\n      }\n    } else {\n      this.clear();\n    }\n    this.addFeatures(features, motion);\n  }\n\n  /**\n   * Add a feature to the  overlay and, optionally, move to it\n   * @param feature Feature\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addFeature(feature: Feature, motion: FeatureMotion = FeatureMotion.Default) {\n    this.addFeatures([feature], motion);\n  }\n\n  /**\n   * Add features to the  overlay and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    const olFeatures = [];\n    features.forEach((feature: Feature) => {\n      const olFeature = featureToOl(feature, this.map.projection);\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry === null) {\n        return;\n      }\n      olFeatures.push(olFeature);\n    });\n\n    this.addOlFeatures(olFeatures, motion);\n  }\n\n  /**\n   * Add a OpenLayers feature to the  overlay and, optionally, move to it\n   * @param olFeature OpenLayers Feature\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeature(\n    olFeature: OlFeature<OlGeometry>,\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.addOlFeatures([olFeature], motion);\n  }\n\n  /**\n   * Add OpenLayers features to the overlay and, optionally, move to them\n   * @param olFeatures OpenLayers Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.dataSource.ol.addFeatures(olFeatures);\n    moveToOlFeatures(this.map.viewController, olFeatures, motion);\n  }\n\n  /**\n   * Remove a feature from the overlay\n   * @param feature Feature\n   */\n  removeFeature(feature: Feature) {\n    this.removeFeatures([feature]);\n  }\n\n  /**\n   * Remove features from the overlay\n   * @param features Features\n   */\n  removeFeatures(features: Feature[]) {\n    features.forEach((feature: Feature) => {\n      if (feature.meta) {\n        if (this.dataSource.ol.getFeatureById(feature.meta.id)) {\n          this.removeOlFeature(\n            this.dataSource.ol.getFeatureById(feature.meta.id)\n          );\n        }\n      }\n    });\n  }\n\n  /**\n   * Remove an OpenLayers feature from the overlay\n   * @param olFeature OpenLayers Feature\n   */\n  removeOlFeature(olFeature: OlFeature<OlGeometry>) {\n    this.dataSource.ol.removeFeature(olFeature);\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.dataSource.ol.clear();\n  }\n}\n","import { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { createOverlayLayerStyle } from '../../style/shared/overlay/overlay-style.utils';\n\n/**\n * Create an overlay layer and it's source\n * @returns Overlay layer\n */\nexport function createOverlayLayer(): VectorLayer {\n  const overlayDataSource = new FeatureDataSource();\n  return new VectorLayer({\n    title: 'Overlay',\n    zIndex: 300,\n    source: overlayDataSource,\n    style: createOverlayLayerStyle()\n  });\n}\n","import { BehaviorSubject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { Watcher, SubjectStatus } from '@igo2/utils';\nimport { Layer, LinkedProperties } from '../../layer/shared/layers';\nimport { ObjectEvent } from 'ol/Object';\n\nexport class LayerWatcher extends Watcher {\n  public propertyChange$: BehaviorSubject<{\n    event: ObjectEvent;\n    layer: Layer;\n  }> = new BehaviorSubject(undefined);\n  private loaded = 0;\n  private loading = 0;\n  private layers: Layer[] = [];\n  private subscriptions: Subscription[] = [];\n\n  constructor() {\n    super();\n  }\n\n  watch() {}\n\n  unwatch() {\n    this.layers.forEach((layer) => this.unwatchLayer(layer), this);\n  }\n\n  setPropertyChange(change: ObjectEvent, layer: Layer) {\n    if (\n      ![\n        LinkedProperties.TIMEFILTER,\n        LinkedProperties.OGCFILTERS,\n        LinkedProperties.VISIBLE,\n        LinkedProperties.OPACITY,\n        LinkedProperties.MINRESOLUTION,\n        LinkedProperties.MAXRESOLUTION\n      ].includes(change.key as any)\n    ) {\n      return;\n    }\n    this.propertyChange$.next({ event: change, layer });\n  }\n\n  watchLayer(layer: Layer) {\n    if (layer.status$ === undefined) {\n      return;\n    }\n    layer.ol.on('propertychange', (evt) => this.setPropertyChange(evt, layer));\n    layer.dataSource.ol.on('propertychange', (evt) =>\n      this.setPropertyChange(evt, layer)\n    );\n\n    this.layers.push(layer);\n\n    const layer$$ = layer.status$\n      .pipe(distinctUntilChanged())\n      .subscribe((status) => {\n        if (status === SubjectStatus.Error) {\n          this.loading = 0;\n          this.loaded = -1;\n        }\n        if (status === SubjectStatus.Working) {\n          this.loading += 1;\n        } else if (status === SubjectStatus.Done) {\n          this.loaded += 1;\n        }\n\n        if (this.loaded >= this.loading) {\n          this.loading = this.loaded = 0;\n          this.status = SubjectStatus.Done;\n        } else if (this.loading > 0) {\n          this.status = SubjectStatus.Working;\n        }\n      });\n\n    this.subscriptions.push(layer$$);\n  }\n\n  unwatchLayer(layer: Layer) {\n    layer.ol.un('propertychange', (evt) => this.setPropertyChange(evt, layer));\n    layer.dataSource.ol.un('propertychange', (evt) =>\n      this.setPropertyChange(evt, layer)\n    );\n    layer.status$.next(SubjectStatus.Done);\n    const index = this.layers.indexOf(layer);\n    if (index >= 0) {\n      const status = (layer as any).watcher.status;\n      if (\n        [SubjectStatus.Working, SubjectStatus.Waiting].indexOf(status) !== -1\n      ) {\n        this.loaded += 1;\n      }\n      this.subscriptions[index].unsubscribe();\n      this.subscriptions.splice(index, 1);\n      this.layers.splice(index, 1);\n      (layer as any).watcher.unwatch();\n    }\n  }\n}\n","export enum MapViewAction {\n  Move,\n  Zoom\n}\n","import { EventsKey } from 'ol/events';\nimport OlMap from 'ol/Map';\nimport { unByKey } from 'ol/Observable';\n\n/**\n * Base map controller\n */\nexport class MapController {\n  /**\n   * OL Map\n   */\n  protected olMap: OlMap;\n\n  /**\n   * Array of observer keys\n   */\n  protected observerKeys: EventsKey[] = [];\n\n  /**\n   * Return the OL map this controller is bound to\n   * @returns OL Map\n   */\n  getOlMap(): OlMap {\n    return this.olMap;\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap !== undefined && this.getOlMap() !== undefined) {\n      throw new Error('This controller is already bound to a map.');\n    }\n\n    if (olMap === undefined) {\n      this.teardownObservers();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    this.observerKeys.forEach((key: EventsKey) => unByKey(key));\n    this.observerKeys = [];\n  }\n}\n","import OlMap from 'ol/Map';\nimport OlMapEvent from 'ol/MapEvent';\n\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport * as oleasing from 'ol/easing';\nimport * as olproj from 'ol/proj';\nimport OlProjection from 'ol/proj/Projection';\nimport OlView from 'ol/View';\n\nimport { MapViewAction } from '../map.enums';\nimport { MapExtent, MapViewState } from '../map.interface';\nimport { getScaleFromResolution, viewStatesAreEqual } from '../map.utils';\nimport { MapController } from './controller';\nimport { EventsKey } from 'ol/events';\nimport { ObjectEvent } from 'ol/Object';\n\nexport interface MapViewControllerOptions {\n  stateHistory: boolean;\n}\n\n/**\n * Controller to handle map view interactions\n */\nexport class MapViewController extends MapController {\n  /**\n   * Observable of the current rotation in radians\n   */\n  readonly rotation$ = new BehaviorSubject<number>(0);\n\n  /**\n   * Observable of the current resolution\n   */\n  resolution$ = new BehaviorSubject<number>(undefined);\n\n  /**\n   * Observable of the current state\n   */\n  state$ = new BehaviorSubject<MapViewState>(undefined);\n\n  /**\n   * View Padding\n   * Values in the array are top, right, bottom and left padding.\n   */\n  padding = [0, 0, 0, 0];\n\n  /**\n   * Max zoom after set extent\n   */\n  maxZoomOnExtent = 19;\n\n  /**\n   * Max extent possible when zooming\n   */\n  maxLayerZoomExtent: MapExtent;\n\n  /**\n   * Extent stream\n   */\n  private extent$ = new Subject<{ extent: MapExtent; action: MapViewAction }>();\n\n  /**\n   * Subscription to the movement stream\n   */\n  private extent$$: Subscription;\n\n  /**\n   * History of states\n   */\n  private states: MapViewState[] = [];\n\n  /**\n   * Current state index\n   */\n  private stateIndex: number = 0;\n\n  /**\n   * Whether the view controller should keep the view's state history\n   */\n  get stateHistory(): boolean {\n    return this.options ? this.options.stateHistory === true : false;\n  }\n\n  /**\n   * OL View\n   */\n  get olView(): OlView {\n    return this.olMap.getView();\n  }\n\n  constructor(private options?: MapViewControllerOptions) {\n    super();\n  }\n\n  setPadding(padding: {\n    top?: number;\n    bottom?: number;\n    left?: number;\n    right?: number;\n  }) {\n    // Values in the array are top, right, bottom and left padding.\n    if (padding.top || padding.top === 0) {\n      this.padding[0] = padding.top;\n    }\n    if (padding.right || padding.right === 0) {\n      this.padding[1] = padding.right;\n    }\n    if (padding.bottom || padding.bottom === 0) {\n      this.padding[2] = padding.bottom;\n    }\n    if (padding.left || padding.left === 0) {\n      this.padding[3] = padding.left;\n    }\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    super.setOlMap(olMap);\n    this.setupObservers();\n  }\n\n  /**\n   * Observe move moveend and subscribe to the extent stream\n   */\n  setupObservers() {\n    if (this.stateHistory === true) {\n      this.observerKeys.push(\n        this.olMap.on('moveend', (event: OlMapEvent) =>\n          this.onMoveEnd(event)\n        ) as EventsKey\n      );\n    }\n\n    this.extent$$ = this.extent$\n      .pipe(debounceTime(25))\n      .subscribe((value: { extent: MapExtent; action: MapViewAction }) => {\n        this.setExtent(value.extent, value.action);\n      });\n  }\n\n  monitorRotation() {\n    this.observerKeys.push(\n      this.olMap.getView().on('change:rotation', (evt: ObjectEvent) => {\n        this.rotation$.next(evt.target.getRotation());\n      }) as EventsKey\n    );\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    super.teardownObservers();\n    if (this.extent$$ !== undefined) {\n      this.extent$$.unsubscribe();\n      this.extent$$ = undefined;\n    }\n  }\n\n  /**\n   * Get the view's OL projection\n   * @returns OL projection\n   */\n  getOlProjection(): OlProjection {\n    return this.olView.getProjection();\n  }\n\n  /**\n   * Get the current map view center\n   * @param projection Output projection\n   * @returns Center\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    let center = this.olView.getCenter() as [number, number];\n    if (projection && center) {\n      center = olproj.transform(center, this.getOlProjection(), projection) as [\n        number,\n        number\n      ];\n    }\n    return center;\n  }\n\n  /**\n   * Get the current view extent\n   * @param projection Output projection\n   * @returns Extent\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    let extent = this.olView.calculateExtent(this.olMap.getSize());\n    if (projection && extent) {\n      extent = olproj.transformExtent(\n        extent,\n        this.getOlProjection(),\n        projection\n      );\n    }\n    return extent as [number, number, number, number];\n  }\n\n  /**\n   * Get the current scale\n   * @param dpi Dot per inches\n   * @returns View scale\n   */\n  getScale(dpi = 96) {\n    return getScaleFromResolution(\n      this.getResolution(),\n      this.getOlProjection().getUnits(),\n      dpi\n    );\n  }\n\n  /**\n   * Get the current resolution\n   * @returns Projection denominator\n   */\n  getResolution(): number {\n    return this.olView.getResolution();\n  }\n\n  /**\n   * Get the current zoom level\n   * @returns Zoom level\n   */\n  getZoom(): number {\n    return Math.round(this.olView.getZoom());\n  }\n\n  /**\n   * Zoom in\n   */\n  zoomIn() {\n    this.zoomTo(this.olView.getZoom() + 1);\n  }\n\n  /**\n   * Zoom out\n   */\n  zoomOut() {\n    this.zoomTo(this.olView.getZoom() - 1);\n  }\n\n  /**\n   * Zoom to specific zoom level\n   * @param zoom Zoom level\n   */\n  zoomTo(zoom: number) {\n    this.olView.cancelAnimations();\n    this.olView.animate({\n      zoom,\n      duration: 250,\n      easing: oleasing.easeOut\n    });\n  }\n\n  /**\n   * Move to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to move to\n   */\n  moveToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Move });\n  }\n\n  /**\n   * Zoom to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to zoom to\n   */\n  zoomToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Zoom });\n  }\n\n  /**\n   * Return the current view rotation\n   * @returns Rotation angle in radians\n   */\n  getRotation(): number {\n    return this.olView.getRotation();\n  }\n\n  /**\n   * Reset the view rotation to 0\n   */\n  resetRotation() {\n    this.olView.animate({ rotation: 0 });\n  }\n\n  /**\n   * Whether the view has a previous state\n   * @returns True if the view has a previous state\n   */\n  hasPreviousState(): boolean {\n    return this.states.length > 1 && this.stateIndex > 0;\n  }\n\n  /**\n   * Whether the view has a next state\n   * @returns True if the view has a next state\n   */\n  hasNextState(): boolean {\n    return this.states.length > 1 && this.stateIndex < this.states.length - 1;\n  }\n\n  /**\n   * Restore the previous view state\n   */\n  previousState() {\n    if (this.hasPreviousState()) {\n      this.setStateIndex(this.stateIndex - 1);\n    }\n  }\n\n  /**\n   * Restore the next view state\n   */\n  nextState() {\n    if (this.hasNextState()) {\n      this.setStateIndex(this.stateIndex + 1);\n    }\n  }\n\n  /**\n   * Clear the state history\n   */\n  clearStateHistory() {\n    this.states = [];\n    this.stateIndex = 0;\n  }\n\n  /**\n   * Update the the view to it's intial state\n   */\n  setInitialState() {\n    if (this.states.length > 0) {\n      this.setStateIndex(0);\n    }\n  }\n\n  /**\n   * Move to the extent retrieved from the stream\n   * @param extent Extent\n   * @param action Either zoom or move\n   * @param animation With or without animation to the target extent.\n   */\n  private setExtent(\n    extent: MapExtent,\n    action: MapViewAction,\n    animation: boolean = true\n  ) {\n    const olView = this.olView;\n    olView.cancelAnimations();\n    const duration = animation ? 500 : 0;\n    const zoom = olView.getZoom();\n\n    const fromCenter = olView.getCenter();\n    const toCenter = [\n      extent[0] + (extent[2] - extent[0]) / 2,\n      extent[1] + (extent[3] - extent[1]) / 2\n    ];\n    const distCenter = Math.sqrt(\n      Math.pow(fromCenter[0] - toCenter[0], 2) +\n        Math.pow(fromCenter[1] - toCenter[1], 2)\n    );\n    const fromExtent = olView.calculateExtent();\n    const fromSize = Math.sqrt(\n      Math.pow(fromExtent[2] - fromExtent[0], 2) +\n        Math.pow(fromExtent[3] - fromExtent[1], 2)\n    );\n    const toSize = Math.sqrt(\n      Math.pow(extent[2] - extent[0], 2) + Math.pow(extent[3] - extent[1], 2)\n    );\n    const moySize = (toSize + fromSize) / 2;\n    const xSize = distCenter / moySize;\n\n    const maxZoom =\n      action === MapViewAction.Move || zoom > this.maxZoomOnExtent\n        ? zoom\n        : this.maxZoomOnExtent;\n\n    olView.fit(extent, {\n      size: this.olMap.getSize(),\n      maxZoom,\n      padding: this.padding,\n      duration: xSize > 4 ? 0 : duration,\n      callback: (isFinished: boolean) => {\n        if (!isFinished) {\n          olView.fit(extent, {\n            size: this.olMap.getSize(),\n            maxZoom,\n            padding: this.padding,\n            duration: xSize > 4 ? 0 : duration\n          });\n        }\n      }\n    });\n  }\n\n  /**\n   * Set the view state index\n   * @param index State index\n   */\n  private setStateIndex(index: number) {\n    this.stateIndex = index;\n    this.setState(this.states[index]);\n  }\n\n  /**\n   * Set the view state\n   * @param state View state\n   */\n  private setState(state: MapViewState) {\n    this.olView.animate({\n      resolution: state.resolution,\n      center: state.center,\n      duration: 0\n    });\n  }\n\n  /**\n   * On move end, get the view state and record it.\n   * @param event Map event\n   */\n  private onMoveEnd(event: OlMapEvent) {\n    const resolution = this.getResolution();\n    if (this.resolution$.value !== resolution) {\n      this.resolution$.next(resolution);\n    }\n\n    const state = {\n      resolution,\n      center: this.getCenter(),\n      zoom: this.getZoom()\n    };\n\n    if (this.stateHistory === true) {\n      const stateIndex = this.stateIndex;\n      const stateAtIndex =\n        this.states.length === 0 ? undefined : this.states[stateIndex];\n      if (!viewStatesAreEqual(state, stateAtIndex)) {\n        this.states = this.states.slice(0, stateIndex + 1).concat([state]);\n        this.stateIndex = this.states.length - 1;\n      }\n    }\n\n    this.state$.next(state);\n  }\n}\n","import { ProjectionLike } from 'ol/proj';\n\nexport interface MapGeolocationControllerOptions {\n  projection: ProjectionLike;\n  accuracyThreshold?: number;\n  followPosition?: boolean;\n  buffer?: GeolocationBuffer;\n}\n\nexport interface MapGeolocationState {\n  position: number[];\n  projection: string;\n  accuracy: number;\n  altitude: number;\n  altitudeAccuracy: number;\n  heading: number;\n  speed: number;\n  enableHighAccuracy: boolean;\n  timestamp: Date;\n}\nexport interface GeolocationBuffer {\n  bufferRadius?: number;\n  bufferStroke?: [number, number, number, number];\n  bufferFill?: [number, number, number, number];\n  showBufferRadius?: boolean;\n}\n\nexport enum GeolocationOverlayType {\n  Position = 'position',\n  PositionDirection = 'positionDirection',\n  Accuracy = 'accuracy',\n  Buffer = 'buffer'\n}\n","import { BehaviorSubject, interval, Subscription } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\nimport OlMap from 'ol/Map';\nimport olGeolocation from 'ol/Geolocation';\nimport Geometry from 'ol/geom/Geometry';\nimport * as olproj from 'ol/proj';\nimport olFeature from 'ol/Feature';\nimport { MapController } from './controller';\nimport { Point, Polygon } from 'ol/geom';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport * as olSphere from 'ol/sphere';\nimport OlCircle from 'ol/geom/Circle';\nimport * as olstyle from 'ol/style';\nimport { StorageService, ConfigService } from '@igo2/core';\nimport { Overlay } from '../../../overlay/shared/overlay';\nimport { FeatureMotion } from '../../../feature/shared/feature.enums';\nimport { MapViewOptions } from '../map.interface';\nimport { MapBase } from '../map.abstract';\nimport {\n  computeOlFeaturesExtent,\n  featuresAreOutOfView,\n  hideOlFeature,\n  moveToOlFeatures\n} from '../../../feature/shared/feature.utils';\nimport {\n  GeolocationBuffer,\n  GeolocationOverlayType,\n  MapGeolocationControllerOptions,\n  MapGeolocationState\n} from './geolocation.interface';\n\n/**\n * Controller to handle map view interactions\n */\nexport class MapGeolocationController extends MapController {\n  private arrowRotation: number;\n  private subscriptions$$: Subscription[] = [];\n  private geolocationOverlay: Overlay;\n  private positionFeatureStyle: olstyle.Style | olstyle.Style[] =\n    new olstyle.Style({\n      image: new olstyle.Circle({\n        radius: 6,\n        fill: new olstyle.Fill({\n          color: '#3399CC'\n        }),\n        stroke: new olstyle.Stroke({\n          color: '#fff',\n          width: 2\n        })\n      })\n    });\n  private accuracyFeatureStyle: olstyle.Style | olstyle.Style[] =\n    new olstyle.Style({\n      stroke: new olstyle.Stroke({\n        color: 'rgba(120, 120, 120, 0.4)',\n        width: 1\n      }),\n      fill: new olstyle.Fill({\n        color: 'rgba(120, 120, 120, 0.4)'\n      })\n    });\n\n  private get bufferStyle(): olstyle.Style {\n    return new olstyle.Style({\n      stroke: new olstyle.Stroke({ width: 2, color: this.buffer.bufferStroke }),\n      fill: new olstyle.Fill({ color: this.buffer.bufferFill }),\n      text: new olstyle.Text({\n        textAlign: 'left',\n        offsetX: 10,\n        offsetY: -10,\n        font: '12px Calibri,sans-serif',\n        text: this.buffer.showBufferRadius\n          ? `${this.buffer.bufferRadius}m`\n          : '',\n        fill: new olstyle.Fill({ color: '#000' }),\n        stroke: new olstyle.Stroke({ color: '#fff', width: 3 })\n      })\n    });\n  }\n\n  private get arrowStyle(): olstyle.Style {\n    return new olstyle.Style({\n      image: new olstyle.RegularShape({\n        radius: 5.5,\n        fill: new olstyle.Fill({\n          color: 'rgba(0, 132, 202)'\n        }),\n        stroke: new olstyle.Stroke({\n          color: '#fff',\n          width: 1.5\n        }),\n        points: 3,\n        displacement: [0, 9],\n        rotation: this.arrowRotation,\n        rotateWithView: true\n      })\n    });\n  }\n\n  private geolocation: olGeolocation;\n\n  /**\n   * Observable of the current emission interval of the position. In seconds\n   */\n  public readonly emissionIntervalSeconds$: BehaviorSubject<number> =\n    new BehaviorSubject(5);\n\n  /**\n   * Observable of the current position\n   */\n  public readonly position$ = new BehaviorSubject<MapGeolocationState>(\n    undefined\n  );\n  /**\n   * Observable of the tracking state\n   */\n  public readonly tracking$ = new BehaviorSubject<boolean>(undefined);\n  /**\n   * Observable of the follow position state\n   */\n  public readonly followPosition$ = new BehaviorSubject<boolean>(undefined);\n\n  private lastPosition: { coordinates: number[]; dateTime: Date };\n\n  /**\n   * Whether the geolocate should show a buffer around the current position\n   */\n  set buffer(value: GeolocationBuffer) {\n    this._buffer = value;\n    this.handleFeatureCreation(this.position$.value);\n  }\n  get buffer(): GeolocationBuffer {\n    return this._buffer;\n  }\n  private _buffer: GeolocationBuffer;\n\n  /**\n   * Whether the geolocate controller accuracy threshold to store/show the position.\n   */\n  set accuracyThreshold(value: number) {\n    this._accuracyThreshold = value;\n    this.handleFeatureCreation(this.position$.value);\n  }\n\n  get accuracyThreshold(): number {\n    return this._accuracyThreshold;\n  }\n  private _accuracyThreshold;\n\n  get olGeolocation() {\n    return this.geolocation;\n  }\n\n  /**\n   * Whether the activate the geolocation.\n   */\n  get tracking() {\n    return this.geolocation.getTracking();\n  }\n\n  set tracking(value: boolean) {\n    this.geolocation.setTracking(value || false);\n    this.tracking$.next(value);\n    if (this.storageService && value !== undefined) {\n      this.storageService.set('geolocation.tracking', value);\n    }\n    if (!value) {\n      this.position$.next(undefined);\n    }\n  }\n\n  /**\n   * Whether the activate the view tracking of the current position\n   */\n  set followPosition(value: boolean) {\n    this._followPosition = value;\n    this.followPosition$.next(value);\n    if (this.configService?.getConfig('geolocate.followPosition') === false) {\n      this._followPosition = false;\n      this.followPosition$.next(false);\n    }\n    this.handleFeatureCreation(this.position$.value);\n    if (this.storageService && value !== undefined) {\n      this.storageService.set('geolocation.followPosition', value);\n    }\n  }\n\n  get followPosition() {\n    return this._followPosition;\n  }\n\n  private _followPosition;\n\n  constructor(\n    private map: MapBase,\n    private options?: MapGeolocationControllerOptions,\n    private storageService?: StorageService,\n    private configService?: ConfigService\n  ) {\n    super();\n    this.geolocationOverlay = new Overlay(this.map);\n    this._followPosition =\n      this.options && this.options.followPosition\n        ? this.options.followPosition\n        : false;\n\n    this._buffer =\n      this.options && this.options.buffer ? this.options.buffer : undefined;\n    this._accuracyThreshold =\n      this.options && this.options.accuracyThreshold\n        ? this.options.accuracyThreshold\n        : 5000;\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    super.setOlMap(olMap);\n    this.setupObservers();\n  }\n\n  private deleteGeolocationFeatures() {\n    this.deleteFeatureByType(GeolocationOverlayType.Position);\n    this.deleteFeatureByType(GeolocationOverlayType.PositionDirection);\n    this.deleteFeatureByType(GeolocationOverlayType.Accuracy);\n    this.deleteFeatureByType(GeolocationOverlayType.Buffer);\n  }\n\n  setupObservers() {\n    this.tracking$.subscribe((tracking) => {\n      if (tracking) {\n        this.onPositionChange(true, true);\n      } else {\n        this.deleteGeolocationFeatures();\n      }\n    });\n\n    this.geolocation = new olGeolocation({\n      // enableHighAccuracy must be set to true to have the heading value.\n      trackingOptions: {\n        enableHighAccuracy: true,\n        maximumAge: 10000,\n        timeout: 600000\n      },\n      projection: this.options.projection\n    });\n    let tracking = false;\n    this.subscriptions$$.push(\n      this.emissionIntervalSeconds$\n        .pipe(switchMap((value) => interval(value * 1000)))\n        .subscribe(() => {\n          if (tracking === this.tracking) {\n            this.onPositionChange(true);\n          } else {\n            tracking = this.tracking;\n            this.onPositionChange(true, true);\n          }\n        })\n    );\n\n    this.geolocation.on('change', (evt) => {\n      this.onPositionChange(false, false);\n    });\n  }\n\n  updateArrowFeatureOrientation(position: MapGeolocationState) {\n    const position4326 = olproj.transform(\n      position.position,\n      position.projection,\n      'EPSG:4326'\n    );\n    if (!this.lastPosition) {\n      this.lastPosition = { coordinates: position4326, dateTime: new Date() };\n      return;\n    }\n    const arrowFeature = this.getFeatureByType(\n      GeolocationOverlayType.PositionDirection\n    );\n    const isMoving =\n      position?.speed > 1.25 &&\n      this.distanceBetweenPoints(this.lastPosition.coordinates, position4326) >\n        0.003;\n    if (position.accuracy <= this.accuracyThreshold && isMoving) {\n      // Calculate the heading using current position and last recorded\n      // because ol heading not returning right value\n      var dx = position4326[1] - this.lastPosition.coordinates[1];\n      var dy = position4326[0] - this.lastPosition.coordinates[0];\n      var theta = Math.atan2(dy, dx);\n      if (theta < 0) theta = 2 * Math.PI + theta;\n      this.arrowRotation = theta;\n      if (arrowFeature) {\n        arrowFeature.setStyle(this.arrowStyle);\n      }\n      this.lastPosition = { coordinates: position4326, dateTime: new Date() };\n    } else {\n      if (\n        arrowFeature &&\n        new Date().getTime() - this.lastPosition.dateTime.getTime() > 3000\n      )\n        hideOlFeature(arrowFeature);\n    }\n  }\n\n  /**\n   * @returns distance in km between coord1 and coord2\n   */\n  private distanceBetweenPoints(coord1: number[], coord2: number[]): number {\n    return olSphere.getDistance(coord1, coord2) / 1000;\n  }\n\n  public addOnChangedListener(event: (geo: olGeolocation) => any) {\n    let listener = () => {\n      event(this.geolocation);\n    };\n    this.geolocation.on('change', listener);\n    return listener;\n  }\n\n  public deleteChangedListener(event: () => any) {\n    this.geolocation.un('change', event);\n  }\n\n  public updateGeolocationOptions(options: MapViewOptions) {\n    if (!options) {\n      return;\n    }\n    // todo maybe a dedicated interface for geolocation should be defined instead of putting these inside the mapviewoptions?\n    let tracking = options.geolocate;\n    let followPosition = options.alwaysTracking;\n    if (this.storageService) {\n      const storedTracking = this.storageService.get(\n        'geolocation.tracking'\n      ) as boolean;\n      if (storedTracking !== null && storedTracking !== undefined) {\n        tracking = storedTracking;\n      }\n\n      const storedFollowPosition = this.storageService.get(\n        'geolocation.followPosition'\n      ) as boolean;\n      if (storedFollowPosition !== null && storedFollowPosition !== undefined) {\n        followPosition = storedFollowPosition;\n      }\n    }\n    this.tracking = tracking;\n    this.followPosition = followPosition;\n    this.buffer = options.buffer;\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    if (this.subscriptions$$.length) {\n      this.subscriptions$$.map((s) => s.unsubscribe());\n    }\n    super.teardownObservers();\n  }\n\n  /**\n   * On position change, get the position, show it on the map and record it.\n   * @param emitEvent Map event\n   */\n  private onPositionChange(\n    emitEvent: boolean = false,\n    zoomTo: boolean = false\n  ) {\n    if (!this.tracking) {\n      return;\n    }\n    const geolocateProperties = this.geolocation.getProperties();\n\n    if (geolocateProperties.accuracy > this.accuracyThreshold) {\n      console.warn('Poor geolocation accuracy. No position are stored/shown');\n      this.position$.next(undefined);\n      return;\n    }\n\n    const position: MapGeolocationState = {\n      position: geolocateProperties.position,\n      projection: this.geolocation.getProjection().getCode(),\n      accuracy: geolocateProperties.accuracy,\n      altitude: geolocateProperties.altitude,\n      altitudeAccuracy: geolocateProperties.altitudeAccuracy,\n      heading: geolocateProperties.heading,\n      speed: geolocateProperties.speed,\n      enableHighAccuracy: geolocateProperties.trackingOptions\n        ?.enableHighAccuracy\n        ? true\n        : false,\n      timestamp: new Date()\n    };\n    this.handleFeatureCreation(position);\n    this.handleViewFromFeatures(position, zoomTo);\n    if (emitEvent) {\n      this.position$.next(position);\n    }\n  }\n\n  private getFeatureByType(type: GeolocationOverlayType): olFeature<Geometry> {\n    return this.geolocationOverlay.dataSource.ol.getFeatureById(type);\n  }\n\n  private deleteFeatureByType(type: GeolocationOverlayType) {\n    const featureById =\n      this.geolocationOverlay?.dataSource.ol.getFeatureById(type);\n    if (featureById) {\n      this.geolocationOverlay.dataSource.ol.removeFeature(featureById);\n    }\n  }\n\n  private handleFeatureCreation(position: MapGeolocationState) {\n    if (!position || !position.position) {\n      return;\n    }\n    const positionGeometry = new Point(position.position);\n    const accuracyGeometry = fromCircle(\n      new OlCircle(position.position, position.accuracy || 0)\n    );\n    let positionFeature = this.getFeatureByType(\n      GeolocationOverlayType.Position\n    );\n    let positionFeatureArrow = this.getFeatureByType(\n      GeolocationOverlayType.PositionDirection\n    );\n    let accuracyFeature = this.getFeatureByType(\n      GeolocationOverlayType.Accuracy\n    );\n    const positionFeatureExists = positionFeature ? true : false;\n    const positionFeatureArrowExists = positionFeatureArrow ? true : false;\n    const accuracyFeatureExists = accuracyFeature ? true : false;\n    if (!positionFeatureArrowExists) {\n      positionFeatureArrow = new olFeature<Point>({\n        geometry: positionGeometry\n      });\n      positionFeatureArrow.setId(GeolocationOverlayType.PositionDirection);\n      hideOlFeature(positionFeatureArrow);\n    }\n    if (!positionFeatureExists) {\n      positionFeature = new olFeature<Point>({ geometry: positionGeometry });\n      positionFeature.setId(GeolocationOverlayType.Position);\n      positionFeature.setStyle(this.positionFeatureStyle);\n    }\n    if (!accuracyFeatureExists) {\n      accuracyFeature = new olFeature<Polygon>({ geometry: accuracyGeometry });\n      accuracyFeature.setId(GeolocationOverlayType.Accuracy);\n      accuracyFeature.setStyle(this.accuracyFeatureStyle);\n    }\n\n    if (positionGeometry) {\n      positionFeatureExists\n        ? positionFeature.setGeometry(positionGeometry)\n        : this.geolocationOverlay.addOlFeature(\n            positionFeature,\n            FeatureMotion.None\n          );\n      positionFeatureArrowExists\n        ? positionFeatureArrow.setGeometry(positionGeometry)\n        : this.geolocationOverlay.addOlFeature(\n            positionFeatureArrow,\n            FeatureMotion.None\n          );\n      this.updateArrowFeatureOrientation(position);\n      accuracyFeatureExists\n        ? accuracyFeature.setGeometry(accuracyGeometry)\n        : this.geolocationOverlay.addOlFeature(\n            accuracyFeature,\n            FeatureMotion.None\n          );\n\n      if (this.buffer) {\n        let bufferFeature = this.getFeatureByType(\n          GeolocationOverlayType.Buffer\n        );\n        const bufferFeatureExists = bufferFeature ? true : false;\n        const bufferGeometry = new OlCircle(\n          position.position,\n          this.buffer.bufferRadius\n        );\n        if (!bufferFeatureExists) {\n          bufferFeature = new olFeature(bufferGeometry);\n          bufferFeature.setId(GeolocationOverlayType.Buffer);\n          bufferFeature.setStyle(this.positionFeatureStyle);\n        }\n        bufferFeature.setStyle(this.bufferStyle);\n        bufferFeatureExists\n          ? bufferFeature.setGeometry(bufferGeometry)\n          : this.geolocationOverlay.addOlFeature(\n              bufferFeature,\n              FeatureMotion.None\n            );\n      }\n    }\n  }\n  handleViewFromFeatures(\n    position: MapGeolocationState,\n    zoomTo: boolean = false\n  ) {\n    let positionFeature = this.getFeatureByType(\n      GeolocationOverlayType.Position\n    );\n    let positionFeatureArrow = this.getFeatureByType(\n      GeolocationOverlayType.PositionDirection\n    );\n    let accuracyFeature = this.getFeatureByType(\n      GeolocationOverlayType.Accuracy\n    );\n    let bufferFeature = this.getFeatureByType(GeolocationOverlayType.Buffer);\n    const features = [\n      positionFeature,\n      positionFeatureArrow,\n      accuracyFeature,\n      bufferFeature\n    ].filter((f) => f);\n    if (features.length > 0) {\n      const featuresExtent = computeOlFeaturesExtent(\n        features,\n        this.map.viewProjection\n      );\n      const edgeRatios =\n        position?.speed > 12.5\n          ? [0.25, 0.25, 0.25, 0.25]\n          : [0.15, 0.1, 0.1, 0.1];\n      const areOutOfView = featuresAreOutOfView(\n        this.map.getExtent(),\n        featuresExtent,\n        edgeRatios\n      );\n      let motion =\n        this.followPosition && areOutOfView\n          ? FeatureMotion.Move\n          : FeatureMotion.None;\n      if (zoomTo) {\n        motion = FeatureMotion.Zoom;\n      }\n      motion !== FeatureMotion.None\n        ? moveToOlFeatures(this.map.viewController, features, motion)\n        : undefined;\n    }\n  }\n}\n","import { ObjectEvent } from 'ol/Object';\nimport { getUid } from 'ol/util';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport {\n  OgcFilterableDataSource,\n  OgcFilterableDataSourceOptions\n} from '../../filter/shared/ogc-filter.interface';\nimport { Layer, LinkedProperties } from '../../layer/shared/layers';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport {\n  TimeFilterableDataSource,\n  TimeFilterableDataSourceOptions\n} from '../../datasource';\nimport { MapBase } from '../shared/map.abstract';\n\nexport function getLinkedLayersOptions(layer: Layer) {\n  return layer.options.linkedLayers;\n}\n\nexport function getIgoLayerByLinkId(map: MapBase, id: string) {\n  return map.layers.find((l) => l.options.linkedLayers?.linkId === id);\n}\n\nexport function layerHasLinkWithProperty(\n  layer: Layer,\n  property: LinkedProperties\n): boolean {\n  let hasLinkWithProperty = false;\n  const layerLLOptions = getLinkedLayersOptions(layer);\n  if (layerLLOptions?.links) {\n    const link = layerLLOptions.links.find((l) =>\n      l.properties.includes(property)\n    );\n    hasLinkWithProperty = link ? true : false;\n  }\n  return hasLinkWithProperty;\n}\n\nexport function layerHasLinkDeletion(layer: Layer): boolean {\n  let hasLinkWithSyncedDelete = false;\n  const layerLLOptions = getLinkedLayersOptions(layer);\n  if (layerLLOptions?.links) {\n    const link = layerLLOptions.links.find((l) => l.syncedDelete);\n    hasLinkWithSyncedDelete = link ? true : false;\n  }\n  return hasLinkWithSyncedDelete;\n}\n\nexport function getRootParentByProperty(\n  map: MapBase,\n  layer: Layer,\n  property: LinkedProperties\n): Layer {\n  let layerToUse = layer;\n  let parentLayer = layerToUse;\n  let hasParentLayer = true;\n  while (hasParentLayer) {\n    layerToUse = parentLayer;\n    parentLayer = getDirectParentLayerByProperty(map, layerToUse, property);\n    hasParentLayer = parentLayer ? true : false;\n  }\n  if (!hasParentLayer) {\n    if (!layerHasLinkWithProperty(layerToUse, property)) {\n      layerToUse = undefined;\n    }\n  }\n  return hasParentLayer ? parentLayer : layerToUse;\n}\n\nexport function getDirectParentLayerByProperty(\n  map: MapBase,\n  layer: Layer,\n  property: LinkedProperties\n): Layer {\n  if (layer?.options.linkedLayers?.linkId) {\n    const currentLinkId = layer.options.linkedLayers.linkId;\n    let parents = map.layers.filter((pl) => {\n      const linkedLayers = pl.options.linkedLayers;\n      if (linkedLayers && linkedLayers.links) {\n        const a = linkedLayers.links.find(\n          (l) =>\n            l.linkedIds.includes(currentLinkId) &&\n            l.properties.includes(property)\n        );\n        return a;\n      }\n    });\n    if (parents.length > 1) {\n      console.warn(`Your layer ${\n        layer.title || layer.id\n      } must only have 1 parent (${parents.map((p) => p.title || p.id)})\n            , The first parent (${\n              parents[0].title || parents[0].id\n            }) will be use to sync properties`);\n    }\n    return parents[0];\n  }\n}\n\nexport function getDirectChildLayersByProperty(\n  map: MapBase,\n  layer: Layer,\n  property: LinkedProperties\n): Layer[] {\n  let linkedIds = [];\n  if (layer?.options.linkedLayers?.links) {\n    layer.options.linkedLayers.links\n      .filter((l) => l.properties.includes(property))\n      .map((link) => {\n        linkedIds = linkedIds.concat(link.linkedIds);\n      });\n  }\n  return linkedIds.map((lid) => getIgoLayerByLinkId(map, lid));\n}\n\nexport function getAllChildLayersByProperty(\n  map: MapBase,\n  layer: Layer,\n  knownChildLayers: Layer[],\n  property: LinkedProperties\n): Layer[] {\n  let childLayers = getDirectChildLayersByProperty(map, layer, property);\n  childLayers.map((cl) => {\n    knownChildLayers.push(cl);\n    const directChildLayers = getDirectChildLayersByProperty(map, cl, property);\n    if (directChildLayers) {\n      getAllChildLayersByProperty(map, cl, knownChildLayers, property);\n    }\n  });\n  return knownChildLayers;\n}\n\nexport function getRootParentByDeletion(map: MapBase, layer: Layer): Layer {\n  let layerToUse = layer;\n  let parentLayer = layerToUse;\n  let hasParentLayer = true;\n  while (hasParentLayer) {\n    layerToUse = parentLayer;\n    parentLayer = getDirectParentLayerByDeletion(map, layerToUse);\n    hasParentLayer = parentLayer ? true : false;\n  }\n  if (!hasParentLayer) {\n    if (!layerHasLinkDeletion(layerToUse)) {\n      layerToUse = undefined;\n    }\n  }\n  return hasParentLayer ? parentLayer : layerToUse;\n}\n\nexport function getDirectParentLayerByDeletion(\n  map: MapBase,\n  layer: Layer\n): Layer {\n  if (layer.options.linkedLayers?.linkId) {\n    const currentLinkId = layer.options.linkedLayers.linkId;\n    let parents = map.layers.filter((pl) => {\n      const linkedLayers = pl.options.linkedLayers;\n      if (linkedLayers && linkedLayers.links) {\n        const a = linkedLayers.links.find(\n          (l) => l.linkedIds.includes(currentLinkId) && l.syncedDelete\n        );\n        return a;\n      }\n    });\n    if (parents.length > 1) {\n      console.warn(`Your layer ${\n        layer.title || layer.id\n      } must only have 1 parent (${parents.map((p) => p.title || p.id)})\n          , The first parent (${\n            parents[0].title || parents[0].id\n          }) will be use to sync properties`);\n    }\n    return parents[0];\n  }\n}\n\nexport function getDirectChildLayersByDeletion(\n  map: MapBase,\n  layer: Layer\n): Layer[] {\n  let linkedIds = [];\n  if (layer?.options.linkedLayers?.links) {\n    layer.options.linkedLayers.links\n      .filter((l) => l.syncedDelete)\n      .map((link) => {\n        linkedIds = linkedIds.concat(link.linkedIds);\n      });\n  }\n  return linkedIds.map((lid) => getIgoLayerByLinkId(map, lid));\n}\n\nexport function getAllChildLayersByDeletion(\n  map: MapBase,\n  layer: Layer,\n  knownChildLayers: Layer[]\n): Layer[] {\n  let childLayers = getDirectChildLayersByDeletion(map, layer);\n  childLayers.map((cl) => {\n    knownChildLayers.push(cl);\n    const directChildLayers = getDirectChildLayersByDeletion(map, cl);\n    if (directChildLayers) {\n      getAllChildLayersByDeletion(map, cl, knownChildLayers);\n    }\n  });\n  return knownChildLayers;\n}\n\nexport function initLayerSyncFromRootParentLayers(\n  map: MapBase,\n  layers: Layer[]\n) {\n  const rootLayersByProperty = {};\n  const keys = Object.keys(LinkedProperties);\n  keys.map((k) => {\n    rootLayersByProperty[LinkedProperties[k]] = [];\n  });\n  layers\n    .filter((l) => getLinkedLayersOptions(l))\n    .map((l) => {\n      keys.map((key) => {\n        const k = LinkedProperties[key];\n        const plbp = getRootParentByProperty(map, l, k as LinkedProperties);\n        const layers = rootLayersByProperty[k];\n        const layersId = layers.map((l) => l.id);\n        if (plbp && !layersId.includes(plbp.id)) {\n          rootLayersByProperty[k].push(plbp);\n        }\n      });\n    });\n  Object.keys(rootLayersByProperty).map((k) => {\n    const layers = rootLayersByProperty[k];\n    layers.map((l: Layer) => l.ol.notify(k, undefined));\n  });\n}\n\nexport function handleLayerPropertyChange(\n  map: MapBase,\n  propertyChange: ObjectEvent,\n  initiatorIgoLayer: Layer\n) {\n  if (!propertyChange) {\n    return;\n  }\n  const ogcFilterWriter = new OgcFilterWriter();\n  let isLayerProperty = true;\n  let isDatasourceProperty = true;\n  const key = propertyChange.key;\n  let newValue;\n  if (key === 'ogcFilters') {\n    isLayerProperty = false;\n    isDatasourceProperty = true;\n    newValue = (\n      initiatorIgoLayer.dataSource.options as OgcFilterableDataSourceOptions\n    ).ogcFilters;\n  } else if (key === 'timeFilter') {\n    isLayerProperty = false;\n    isDatasourceProperty = true;\n    newValue = (\n      initiatorIgoLayer.dataSource.options as TimeFilterableDataSourceOptions\n    ).timeFilter;\n  } else {\n    isLayerProperty = true;\n    isDatasourceProperty = false;\n    newValue = initiatorIgoLayer.ol.get(key);\n  }\n\n  const initiatorLinkedLayersOptions =\n    getLinkedLayersOptions(initiatorIgoLayer);\n  if (initiatorLinkedLayersOptions) {\n    let rootParentByProperty = getRootParentByProperty(\n      map,\n      initiatorIgoLayer,\n      key as LinkedProperties\n    );\n    if (!rootParentByProperty) {\n      rootParentByProperty = initiatorIgoLayer;\n    }\n\n    const clbp = [rootParentByProperty];\n    getAllChildLayersByProperty(\n      map,\n      rootParentByProperty,\n      clbp,\n      key as LinkedProperties\n    );\n\n    let resolutionPropertyHasChanged = false;\n    const initiatorIgoLayerSourceType =\n      initiatorIgoLayer.options.source.options.type;\n    const initiatorIgoLayerOgcFilterableDataSourceOptions = initiatorIgoLayer\n      .dataSource.options as OgcFilterableDataSourceOptions;\n    clbp.map((l) => {\n      if (\n        initiatorIgoLayer &&\n        l &&\n        getUid(initiatorIgoLayer.ol) !== getUid(l?.ol)\n      ) {\n        const lLayerType = l.options.source.options.type;\n        if (isLayerProperty) {\n          l.ol.set(key, newValue, true);\n          if (key === 'visible') {\n            l.visible$.next(newValue);\n          }\n          if (key === 'minResolution' || key === 'maxResolution') {\n            resolutionPropertyHasChanged = true;\n          }\n        } else if (isDatasourceProperty) {\n          if (key === 'ogcFilters') {\n            (l.dataSource as OgcFilterableDataSource).setOgcFilters(\n              newValue,\n              false\n            );\n            if (lLayerType === 'wfs') {\n              l.ol.getSource().refresh();\n            }\n            if (lLayerType === 'wms') {\n              let appliedOgcFilter;\n              if (initiatorIgoLayerSourceType === 'wfs') {\n                appliedOgcFilter = ogcFilterWriter.handleOgcFiltersAppliedValue(\n                  initiatorIgoLayerOgcFilterableDataSourceOptions,\n                  (initiatorIgoLayer.dataSource.options as any)\n                    .fieldNameGeometry,\n                  undefined,\n                  map.viewController.getOlProjection()\n                );\n              } else if (initiatorIgoLayerSourceType === 'wms') {\n                appliedOgcFilter = (\n                  initiatorIgoLayer.dataSource as WMSDataSource\n                ).ol.getParams().FILTER;\n              }\n              (l.dataSource as WMSDataSource).ol.updateParams({\n                FILTER: appliedOgcFilter\n              });\n            }\n          } else if (\n            l.dataSource instanceof WMSDataSource &&\n            key === 'timeFilter'\n          ) {\n            (l.dataSource as TimeFilterableDataSource).setTimeFilter(\n              newValue,\n              false\n            );\n            const appliedTimeFilter = (\n              initiatorIgoLayer.ol.getSource() as olSourceImageWMS\n            ).getParams().TIME;\n            l.dataSource.ol.updateParams({ TIME: appliedTimeFilter });\n          }\n        }\n      }\n    });\n    if (resolutionPropertyHasChanged) {\n      map.viewController.resolution$.next(map.viewController.resolution$.value);\n    }\n  }\n}\n","import olMap from 'ol/Map';\nimport olView, { ViewOptions } from 'ol/View';\nimport olControlAttribution from 'ol/control/Attribution';\nimport olControlScaleLine from 'ol/control/ScaleLine';\nimport * as olproj from 'ol/proj';\nimport * as olproj4 from 'ol/proj/proj4';\nimport OlProjection from 'ol/proj/Projection';\nimport * as olinteraction from 'ol/interaction';\nimport { getUid } from 'ol/util';\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\n\nimport proj4 from 'proj4';\nimport { BehaviorSubject, pairwise, skipWhile, Subject } from 'rxjs';\n\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { Layer, VectorLayer } from '../../layer/shared/layers';\nimport { Overlay } from '../../overlay/shared/overlay';\n\nimport { LayerWatcher } from '../utils/layer-watcher';\nimport {\n  MapViewOptions,\n  MapOptions,\n  MapAttributionOptions,\n  MapScaleLineOptions,\n  MapExtent,\n  MapControlsOptions\n} from './map.interface';\nimport { MapBase } from './map.abstract';\nimport { MapViewController } from './controllers/view';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { MapGeolocationController } from './controllers/geolocation';\nimport { StorageService, ConfigService } from '@igo2/core';\nimport { ObjectEvent } from 'ol/Object';\nimport {\n  getAllChildLayersByDeletion,\n  getRootParentByDeletion,\n  handleLayerPropertyChange,\n  initLayerSyncFromRootParentLayers\n} from './linkedLayers.utils';\n\n// TODO: This class is messy. Clearly define it's scope and the map browser's.\n// Move some stuff into controllers.\nexport class IgoMap implements MapBase {\n  public ol: olMap;\n  public forcedOffline$ = new BehaviorSubject<boolean>(false);\n  public layers$ = new BehaviorSubject<Layer[]>([]);\n  public layersAddedByClick$ = new BehaviorSubject<Layer[]>(undefined);\n  public status$: Subject<SubjectStatus>;\n  public propertyChange$: Subject<{ event: ObjectEvent; layer: Layer }>;\n  public overlay: Overlay;\n  public queryResultsOverlay: Overlay;\n  public searchResultsOverlay: Overlay;\n  public viewController: MapViewController;\n  public geolocationController: MapGeolocationController;\n  public swipeEnabled$ = new BehaviorSubject<boolean>(false);\n  public mapCenter$ = new BehaviorSubject<boolean>(false);\n  public selectedFeatures$ = new BehaviorSubject<Layer[]>(null);\n\n  public bufferDataSource: FeatureDataSource;\n\n  private layerWatcher: LayerWatcher;\n  private options: MapOptions;\n  private mapViewOptions: MapViewOptions;\n  private defaultOptions: Partial<MapOptions> = {\n    controls: { attribution: false }\n  };\n\n  get layers(): Layer[] {\n    return this.layers$.value;\n  }\n\n  /** @deprecated use projectionCode */\n  get projection(): string {\n    return this.projectionCode;\n  }\n\n  get viewProjection(): olproj.Projection {\n    return this.viewController.getOlProjection();\n  }\n\n  get projectionCode(): string {\n    return this.viewProjection.getCode();\n  }\n\n  constructor(\n    options?: MapOptions,\n    private storageService?: StorageService,\n    private configService?: ConfigService\n  ) {\n    this.options = Object.assign({}, this.defaultOptions, options);\n    this.layerWatcher = new LayerWatcher();\n    this.status$ = this.layerWatcher.status$;\n    this.propertyChange$ = this.layerWatcher.propertyChange$;\n    olproj4.register(proj4);\n    this.init();\n  }\n\n  init() {\n    const controls = [];\n    if (this.options.controls) {\n      if (this.options.controls.attribution) {\n        const attributionOpt = (\n          this.options.controls.attribution === true\n            ? {}\n            : this.options.controls.attribution\n        ) as MapAttributionOptions;\n        controls.push(new olControlAttribution(attributionOpt));\n      }\n      if (this.options.controls.scaleLine) {\n        const scaleLineOpt = (\n          this.options.controls.scaleLine === true\n            ? {}\n            : this.options.controls.scaleLine\n        ) as MapScaleLineOptions;\n        controls.push(new olControlScaleLine(scaleLineOpt));\n      }\n    }\n    let interactions = {};\n    if (this.options.interactions === false) {\n      interactions = {\n        altShiftDragRotate: false,\n        doubleClickZoom: false,\n        keyboard: false,\n        mouseWheelZoom: false,\n        shiftDragZoom: false,\n        dragPan: false,\n        pinchRotate: false,\n        pinchZoom: false\n      };\n    }\n\n    this.ol = new olMap({\n      interactions: olinteraction.defaults(interactions),\n      controls\n    });\n\n    this.setView(this.options.view || {});\n    this.viewController = new MapViewController({\n      stateHistory: true\n    });\n    this.viewController.setOlMap(this.ol);\n    this.overlay = new Overlay(this);\n    this.queryResultsOverlay = new Overlay(this);\n    this.searchResultsOverlay = new Overlay(this);\n    this.ol.once('rendercomplete', () => {\n      this.geolocationController = new MapGeolocationController(\n        this,\n        {\n          projection: this.viewController.getOlProjection()\n        },\n        this.storageService,\n        this.configService\n      );\n      this.geolocationController.setOlMap(this.ol);\n      if (this.geolocationController) {\n        this.geolocationController.updateGeolocationOptions(\n          this.mapViewOptions\n        );\n      }\n      this.layers$.pipe(pairwise()).subscribe(([prevLayers, currentLayers]) => {\n        let prevLayersId;\n        if (prevLayers) {\n          prevLayersId = prevLayers.map((l) => l.id);\n        }\n        const layers = currentLayers.filter(\n          (l) => !prevLayersId.includes(l.id)\n        );\n\n        for (const layer of layers) {\n          if (layer.options.linkedLayers) {\n            layer.ol.once('postrender', () => {\n              initLayerSyncFromRootParentLayers(this, layers);\n            });\n          }\n        }\n      });\n      this.viewController.monitorRotation();\n    });\n    this.propertyChange$\n      .pipe(skipWhile((pc) => !pc))\n      .subscribe((p) => handleLayerPropertyChange(this, p.event, p.layer));\n  }\n\n  setTarget(id: string) {\n    this.ol.setTarget(id);\n    if (id !== undefined) {\n      this.layerWatcher.subscribe(() => {}, null);\n    } else {\n      this.layerWatcher.unsubscribe();\n    }\n  }\n\n  updateView(options: MapViewOptions) {\n    const currentView = this.ol.getView();\n    const viewOptions: MapViewOptions = {\n      ...currentView.getProperties(),\n      ...options\n    };\n\n    if (options.zoom && options.resolution == null) {\n      viewOptions.resolution = undefined;\n    }\n\n    this.setView(viewOptions);\n    if (options.maxZoomOnExtent) {\n      this.viewController.maxZoomOnExtent = options.maxZoomOnExtent;\n    }\n    this.mapViewOptions = options;\n  }\n\n  /**\n   * Set the map view\n   * @param options Map view options\n   */\n  setView(options: MapViewOptions) {\n    if (this.viewController !== undefined) {\n      this.viewController.clearStateHistory();\n    }\n\n    const viewOptions: ViewOptions = { constrainResolution: true, ...options };\n    if (options.center) {\n      viewOptions.center = olproj.fromLonLat(\n        options.center,\n        options.projection\n      );\n    }\n\n    this.ol.setView(new olView(viewOptions));\n\n    if (options.maxLayerZoomExtent) {\n      this.viewController.maxLayerZoomExtent = options.maxLayerZoomExtent;\n    }\n  }\n\n  updateControls(value: MapControlsOptions) {\n    if (value === undefined) {\n      return;\n    }\n\n    const controls = [];\n    if (value.attribution) {\n      const attributionOpt = (\n        value.attribution === true ? {} : value.attribution\n      ) as MapAttributionOptions;\n      controls.push(new olControlAttribution(attributionOpt));\n    }\n    if (value.scaleLine) {\n      const scaleLineOpt = (\n        value.scaleLine === true ? {} : value.scaleLine\n      ) as MapScaleLineOptions;\n      controls.push(new olControlScaleLine(scaleLineOpt));\n    }\n\n    const currentControls = Object.assign([], this.ol.getControls().getArray());\n    currentControls.forEach((control) => {\n      this.ol.removeControl(control);\n    });\n    controls.forEach((control) => {\n      this.ol.addControl(control);\n    });\n  }\n\n  /**\n   * Deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    return this.viewController.getCenter(projection);\n  }\n\n  /**\n   * Deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    return this.viewController.getExtent(projection);\n  }\n\n  // TODO: Move to ViewController and update every place it's used\n  getZoom(): number {\n    return this.viewController.getZoom();\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (!baseLayer) {\n      return;\n    }\n\n    for (const bl of this.getBaseLayers()) {\n      bl.visible = false;\n    }\n\n    baseLayer.visible = true;\n\n    this.viewController.olView.setMinZoom(\n      baseLayer.dataSource.options.minZoom || (this.options.view || {}).minZoom\n    );\n    this.viewController.olView.setMaxZoom(\n      baseLayer.dataSource.options.maxZoom || (this.options.view || {}).maxZoom\n    );\n  }\n\n  getBaseLayers(): Layer[] {\n    return this.layers.filter((layer: Layer) => layer.baseLayer === true);\n  }\n\n  getLayerById(id: string): Layer {\n    return this.layers.find((layer: Layer) => layer.id && layer.id === id);\n  }\n\n  getLayerByAlias(alias: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => layer.alias && layer.alias === alias\n    );\n  }\n\n  getLayerByOlUId(olUId: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => getUid(layer.ol) && getUid(layer.ol) === olUId\n    );\n  }\n\n  getLayerByOlLayer(olLayer: olLayer<olSource>): Layer {\n    const olUId = getUid(olLayer);\n    return this.getLayerByOlUId(olUId);\n  }\n\n  /**\n   * Add a single layer\n   * @param layer Layer to add\n   * @param push DEPRECATED\n   */\n  addLayer(layer: Layer, push = true) {\n    this.addLayers([layer]);\n  }\n\n  /**\n   * Add many layers\n   * @param layers Layers to add\n   * @param push DEPRECATED\n   */\n  addLayers(layers: Layer[], push = true) {\n    let offsetZIndex = 0;\n    let offsetBaseLayerZIndex = 0;\n    const addedLayers = layers\n      .map((layer: Layer) => {\n        if (!layer) {\n          return;\n        }\n        const offset = layer.zIndex\n          ? 0\n          : layer.baseLayer\n          ? offsetBaseLayerZIndex++\n          : offsetZIndex++;\n        return this.doAddLayer(layer, offset);\n      })\n      .filter((layer: Layer | undefined) => layer !== undefined);\n    this.setLayers([].concat(this.layers, addedLayers));\n  }\n\n  /**\n   * Remove a single layer\n   * @param layer Layer to remove\n   */\n  removeLayer(layer: Layer) {\n    this.removeLayers([layer]);\n  }\n\n  /**\n   * Remove many layers\n   * @param layers Layers to remove\n   */\n  removeLayers(layers: Layer[]) {\n    const newLayers = this.layers$.value.slice(0);\n    const layersToRemove = [];\n    layers.forEach((layer: Layer) => {\n      if (layer instanceof VectorLayer) {\n        layer.removeLayerFromIDB();\n      }\n      const index = newLayers.indexOf(layer);\n      if (index >= 0) {\n        layersToRemove.push(layer);\n        newLayers.splice(index, 1);\n        this.handleLinkedLayersDeletion(layer, layersToRemove);\n        layersToRemove.map((linkedLayer) => {\n          const linkedIndex = newLayers.indexOf(linkedLayer);\n          if (linkedIndex >= 0) {\n            newLayers.splice(linkedIndex, 1);\n          }\n        });\n      }\n    });\n\n    layersToRemove.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.setLayers(newLayers);\n  }\n\n  /**\n   * Build a list of linked layers to delete\n   * @param srcLayer Layer that has triggered the deletion\n   * @param layersToRemove list to append the layer to delete into\n   */\n  handleLinkedLayersDeletion(srcLayer: Layer, layersToRemove: Layer[]) {\n    let rootParentByDeletion = getRootParentByDeletion(this, srcLayer);\n    if (!rootParentByDeletion) {\n      rootParentByDeletion = srcLayer;\n    }\n    const clbd = getAllChildLayersByDeletion(this, rootParentByDeletion, [\n      rootParentByDeletion\n    ]);\n    for (const layer of clbd) {\n      layersToRemove.push(layer);\n    }\n  }\n\n  /**\n   * Remove all layers\n   */\n  removeAllLayers() {\n    this.layers.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.layers$.next([]);\n  }\n\n  raiseLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index > 1) {\n      this.moveLayer(layer, index, index - 1);\n    }\n  }\n\n  raiseLayers(layers: Layer[]) {\n    for (const layer of layers) {\n      this.raiseLayer(layer);\n    }\n  }\n\n  lowerLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index < this.layers.length - 1) {\n      this.moveLayer(layer, index, index + 1);\n    }\n  }\n\n  lowerLayers(layers: Layer[]) {\n    const reverseLayers = layers.reverse();\n    for (const layer of reverseLayers) {\n      this.lowerLayer(layer);\n    }\n  }\n\n  moveLayer(layer: Layer, from: number, to: number) {\n    const layerTo = this.layers[to];\n    const zIndexTo = layerTo.zIndex;\n    const zIndexFrom = layer.zIndex;\n\n    if (layerTo.baseLayer || layer.baseLayer) {\n      return;\n    }\n\n    layer.zIndex = zIndexTo;\n    layerTo.zIndex = zIndexFrom;\n\n    this.layers[to] = layer;\n    this.layers[from] = layerTo;\n    this.layers$.next(this.layers.slice(0));\n  }\n\n  /**\n   * Add a layer to the OL map and start watching. If the layer is already\n   * added to this map, make it visible but don't add it one again.\n   * @param layer Layer\n   * @returns The layer added, if any\n   */\n  private doAddLayer(layer: Layer, offsetZIndex: number) {\n    if (layer.baseLayer && layer.visible) {\n      this.changeBaseLayer(layer);\n    }\n\n    const existingLayer = this.getLayerById(layer.id);\n    if (existingLayer !== undefined) {\n      existingLayer.visible = true;\n      return;\n    }\n\n    if (!layer.baseLayer && layer.zIndex) {\n      layer.zIndex += 10;\n    }\n\n    if (layer.zIndex === undefined || layer.zIndex === 0) {\n      const maxZIndex = Math.max(\n        layer.baseLayer ? 0 : 10,\n        ...this.layers\n          .filter(\n            (l) => l.baseLayer === layer.baseLayer && l.zIndex < 200 // zIndex > 200 = system layer\n          )\n          .map((l) => l.zIndex)\n      );\n      layer.zIndex = maxZIndex + 1 + offsetZIndex;\n    }\n\n    if (layer.baseLayer && layer.zIndex > 9) {\n      layer.zIndex = 10; // baselayer must have zIndex < 10\n    }\n\n    layer.setMap(this);\n    this.layerWatcher.watchLayer(layer);\n    this.ol.addLayer(layer.ol);\n\n    return layer;\n  }\n\n  /**\n   * Remove a layer from the OL map and stop watching\n   * @param layer Layer\n   */\n  private doRemoveLayer(layer: Layer) {\n    this.layerWatcher.unwatchLayer(layer);\n    this.ol.removeLayer(layer.ol);\n    layer.setMap(undefined);\n  }\n\n  /**\n   * Update the layers observable\n   * @param layers Layers\n   */\n  private setLayers(layers: Layer[]) {\n    this.layers$.next(this.sortLayersByZIndex(layers).slice(0));\n  }\n\n  /**\n   * Sort layers by descending zIndex\n   * @param layers Array of layers\n   * @returns The original array, sorted by zIndex\n   */\n  private sortLayersByZIndex(layers: Layer[]) {\n    // Sort by descending zIndex\n    return layers.sort(\n      (layer1: Layer, layer2: Layer) => layer2.zIndex - layer1.zIndex\n    );\n  }\n\n  /**\n   * Get layer index in the map's inenr array of layers\n   * @param layer Layer\n   * @returns The layer index\n   */\n  private getLayerIndex(layer: Layer) {\n    return this.layers.findIndex((_layer: Layer) => _layer === layer);\n  }\n}\n","import {\n  Component,\n  Input,\n  OnInit,\n  AfterViewInit,\n  OnDestroy\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { SubjectStatus } from '@igo2/utils';\nimport { ActivityService } from '@igo2/core';\n\nimport { IgoMap } from '../shared/map';\nimport { MapControlsOptions, MapViewOptions } from '../shared/map.interface';\n\n@Component({\n  selector: 'igo-map-browser',\n  templateUrl: './map-browser.component.html',\n  styleUrls: ['./map-browser.component.scss']\n})\nexport class MapBrowserComponent implements OnInit, AfterViewInit, OnDestroy {\n  private activityId: string;\n  private status$$: Subscription;\n\n  @Input() map: IgoMap;\n\n  @Input()\n  get view(): MapViewOptions {\n    return this._view;\n  }\n  set view(value: MapViewOptions) {\n    this._view = value;\n    if (this.map !== undefined) {\n      this.map.updateView(value);\n    }\n  }\n  private _view: MapViewOptions;\n\n  get controls(): MapControlsOptions {\n    return this._controls;\n  }\n\n  set controls(value: MapControlsOptions) {\n    this._controls = value;\n    if (this.map !== undefined) {\n      this.map.updateControls(value);\n    }\n  }\n  private _controls: MapControlsOptions;\n\n  public id = `igo-map-target-${new Date().getTime()}`;\n\n  constructor(private activityService: ActivityService) {}\n\n  ngOnInit() {\n    this.status$$ = this.map.status$.subscribe((status) =>\n      this.handleStatusChange(status)\n    );\n  }\n\n  ngAfterViewInit() {\n    this.map.setTarget(this.id);\n  }\n\n  ngOnDestroy() {\n    this.map.setTarget(undefined);\n    this.activityService.unregister(this.activityId);\n    this.status$$.unsubscribe();\n  }\n\n  private handleStatusChange(status: SubjectStatus) {\n    if (status === SubjectStatus.Working && this.activityId === undefined) {\n      this.activityId = this.activityService.register();\n    } else if (status === SubjectStatus.Done && this.activityId !== undefined) {\n      this.activityService.unregister(this.activityId);\n      this.activityId = undefined;\n    }\n  }\n}\n","<div [id]=\"id\" class=\"igo-map-browser-target\"></div>\n<ng-content></ng-content>\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  Self,\n  OnInit\n} from '@angular/core';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\n\nimport { transform } from 'ol/proj';\nimport { MediaService } from '@igo2/core';\nimport { unByKey } from 'ol/Observable';\n/**\n * This directive return the pointer coordinate (on click or pointermove)\n * in [longitude, latitude], delayed by in input (pointerMoveDelay)\n * to avoid too many emitted values.\n */\n@Directive({\n  selector: '[igoPointerPosition]'\n})\nexport class PointerPositionDirective implements OnInit, OnDestroy {\n  private lastTimeoutRequest;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * Delay before emitting an event\n   */\n  @Input() pointerPositionDelay: number = 1000;\n\n  /**\n   * Event emitted when the pointer move, delayed by pointerMoveDelay\n   */\n  @Output() pointerPositionCoord = new EventEmitter<[number, number]>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService\n  ) {}\n\n  /**\n   * Start listening to pointermove\n   * @internal\n   */\n  ngOnInit(): void {\n    this.listenToMapPointerMove();\n    this.listenToMapClick();\n  }\n\n  /**\n   * Stop listening to pointermove\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unlistenToMapClick();\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) =>\n        this.onPointerEvent(event, this.pointerPositionDelay)\n    );\n  }\n\n  /**\n   * On map click\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, 0)\n    );\n  }\n\n  /**\n   * Stop listening for map pointermove\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * emit delayed coordinate (longitude, latitude array) based on pointerMoveDelay or on click\n   * @param event OL map browser pointer event\n   */\n  private onPointerEvent(event: MapBrowserPointerEvent<any>, delay: number) {\n    if (event.dragging || this.mediaService.isTouchScreen()) {\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n\n    const lonlat = transform(\n      event.coordinate,\n      this.mapProjection,\n      'EPSG:4326'\n    ) as [number, number];\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.pointerPositionCoord.emit(lonlat);\n    }, delay);\n  }\n}\n","import * as olStyle from 'ol/style';\nimport * as olGeom from 'ol/geom';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { StyleService } from '../../style-service/style.service';\n\nexport function featureRandomStyleFunction(): (\n  olFeature: olFeature<OlGeometry>,\n  resolution: number\n) => olStyle.Style {\n  const r = Math.floor(Math.random() * 255);\n  const g = Math.floor(Math.random() * 255);\n  const b = Math.floor(Math.random() * 255);\n  const stroke = new olStyle.Stroke({\n    color: [r, g, b, 1],\n    width: 2\n  });\n  const fill = new olStyle.Fill({\n    color: [r, g, b, 0.4]\n  });\n  return (olFeature: olFeature<OlGeometry>, resolution: number) => {\n    const customStyle = olFeature.get('_style');\n    if (customStyle) {\n      if (\n        customStyle.circle &&\n        olFeature.get('rad') &&\n        olFeature.get('longitude') &&\n        olFeature.get('latitude')\n      ) {\n        const lonLat: [number, number] = [\n          olFeature.get('longitude'),\n          olFeature.get('latitude')\n        ];\n        const radius =\n          olFeature.get('rad') /\n          Math.cos((Math.PI / 180) * lonLat[1]) /\n          resolution;\n        customStyle.circle.radius = radius;\n      }\n      const styleService = new StyleService();\n      return styleService.createStyle(customStyle, undefined, resolution);\n    }\n    const style = new olStyle.Style({\n      stroke,\n      fill,\n      image: new olStyle.Circle({\n        radius: 5,\n        stroke,\n        fill\n      }),\n      text: olFeature.get('_mapTitle')\n        ? new olStyle.Text({\n            text: olFeature.get('_mapTitle').toString(),\n            offsetX: 5,\n            offsetY: -5,\n            font: '12px Calibri,sans-serif',\n            fill: new olStyle.Fill({ color: '#000' }),\n            stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\n            overflow: true\n          })\n        : undefined\n    });\n    return style;\n  };\n}\n\nexport function featureRandomStyle(): olStyle.Style {\n  const r = Math.floor(Math.random() * 255);\n  const g = Math.floor(Math.random() * 255);\n  const b = Math.floor(Math.random() * 255);\n  const stroke = new olStyle.Stroke({\n    color: [r, g, b, 1],\n    width: 2\n  });\n  const fill = new olStyle.Fill({\n    color: [r, g, b, 0.4]\n  });\n\n  const style = new olStyle.Style({\n    stroke,\n    fill,\n    image: new olStyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    })\n  });\n  return style;\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature olFeature\n * @returns OL style function\n */\nexport function hoverFeatureMarkerStyle(\n  feature: olFeature<olGeom.Geometry>,\n  resolution: number\n): olStyle.Style[] {\n  const olStyleText = new olStyle.Style({\n    text: new olStyle.Text({\n      text: feature.get('hoverSummary'),\n      textAlign: 'left',\n      textBaseline: 'top',\n      font: '12px Calibri,sans-serif',\n      fill: new olStyle.Fill({ color: '#000' }),\n      backgroundFill: new olStyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n      backgroundStroke: new olStyle.Stroke({\n        color: 'rgba(200, 200, 200, 0.75)',\n        width: 2\n      }),\n      stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true,\n      offsetX: 10,\n      offsetY: 20,\n      padding: [2.5, 2.5, 2.5, 2.5]\n    })\n  });\n  const olStyles = [olStyleText];\n  switch (feature.getGeometry().getType()) {\n    case 'Point':\n      olStyles.push(\n        new olStyle.Style({\n          image: new olStyle.Circle({\n            radius: 10,\n            stroke: new olStyle.Stroke({\n              color: 'blue',\n              width: 3\n            })\n          })\n        })\n      );\n      break;\n    default:\n      olStyles.push(\n        new olStyle.Style({\n          stroke: new olStyle.Stroke({\n            color: 'white',\n            width: 5\n          })\n        })\n      );\n      olStyles.push(\n        new olStyle.Style({\n          stroke: new olStyle.Stroke({\n            color: 'blue',\n            width: 3\n          })\n        })\n      );\n  }\n\n  return olStyles;\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature olFeature\n * @returns OL style function\n */\nexport function pointerPositionSummaryMarkerStyle(\n  feature: olFeature<OlGeometry>,\n  resolution: number\n): olStyle.Style {\n  return new olStyle.Style({\n    image: new olStyle.Icon({\n      src: './assets/igo2/geo/icons/cross_black_18px.svg'\n    }),\n\n    text: new olStyle.Text({\n      text: feature.get('pointerSummary'),\n      textAlign: 'left',\n      textBaseline: 'bottom',\n      font: '12px Calibri,sans-serif',\n      fill: new olStyle.Fill({ color: '#000' }),\n      backgroundFill: new olStyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n      backgroundStroke: new olStyle.Stroke({\n        color: 'rgba(200, 200, 200, 0.75)',\n        width: 2\n      }),\n      stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true,\n      offsetX: 10,\n      offsetY: -10,\n      padding: [2.5, 2.5, 2.5, 2.5]\n    })\n  });\n}\n","import {\n  Directive,\n  Input,\n  OnDestroy,\n  Self,\n  OnInit,\n  HostListener\n} from '@angular/core';\nimport olLayerVectorTile from 'ol/layer/VectorTile';\nimport olLayerVector from 'ol/layer/Vector';\n\nimport { Subscription } from 'rxjs';\nimport olVectorTileSource from 'ol/source/VectorTile';\n\nimport type { default as OlMapBrowserEvent } from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlFeature from 'ol/Feature';\nimport * as OlGeom from 'ol/geom';\n\nimport { EntityStore } from '@igo2/common';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { VectorLayer, Layer, VectorTileLayer } from '../../layer/shared/layers';\nimport { first } from 'rxjs/operators';\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\nimport { MediaService } from '@igo2/core';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { unByKey } from 'ol/Observable';\nimport RenderFeature from 'ol/render/Feature';\nimport { StyleByAttribute } from '../../style/shared/vector/vector-style.interface';\nimport { hoverFeatureMarkerStyle } from '../../style/shared/feature/feature-style';\nimport { SubjectStatus } from '@igo2/utils';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoHoverFeature]'\n})\nexport class HoverFeatureDirective implements OnInit, OnDestroy {\n  public store: FeatureStore<Feature>;\n  private pointerHoverFeatureStore: EntityStore<OlFeature<OlGeometry>> =\n    new EntityStore<OlFeature<OlGeometry>>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n\n  private selectionLayer: olLayerVectorTile;\n  private selectionMVT = {};\n  private mvtStyleOptions: StyleByAttribute;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private singleClickMapListener;\n\n  private hoverFeatureId: string = 'hoverFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoHoverFeatureDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoHoverFeatureEnabled: boolean = false;\n\n  @HostListener('mouseout')\n  mouseout() {\n    clearTimeout(this.lastTimeoutRequest);\n    this.clearLayer();\n  }\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService,\n    private styleService: StyleService\n  ) {}\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.listenToMapPointerMove();\n    this.subscribeToPointerStore();\n    this.listenToMapClick();\n\n    this.map.status$\n      .pipe(first((status) => status === SubjectStatus.Done))\n      .subscribe(() => {\n        this.store = new FeatureStore<Feature>([], { map: this.map });\n        this.initStore();\n      });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers: Layer[]) => {\n      if (this.store && !layers.find((l) => l.id === 'hoverFeatureId')) {\n        this.initStore();\n      }\n    });\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'hoverFeatureId',\n      title: 'hoverFeature',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: hoverFeatureMarkerStyle\n    });\n    tryBindStoreLayer(store, layer);\n\n    this.selectionLayer = new olLayerVectorTile({\n      map: this.map.ol,\n      zIndex: 901,\n      renderMode: 'vector',\n      declutter: true,\n      source: new olVectorTileSource({ projection: this.map.projection }),\n      style: (feature, resolution) => {\n        if (this.mvtStyleOptions && feature.getId() in this.selectionMVT) {\n          return this.createHoverStyle(\n            feature,\n            this.mvtStyleOptions,\n            resolution\n          );\n        }\n      }\n    });\n  }\n\n  createHoverStyle(\n    feature: RenderFeature | OlFeature<OlGeometry>,\n    hoverStyle: StyleByAttribute,\n    resolution: number\n  ) {\n    const localHoverStyle = { ...hoverStyle };\n    let label = hoverStyle.label ? hoverStyle.label.attribute : undefined;\n    let hasLabelStyle = hoverStyle.label?.style ? true : false;\n\n    if (!feature.get('_isLabel')) {\n      localHoverStyle.label = undefined;\n      hasLabelStyle = false;\n      label = undefined;\n    } else {\n      // clear the style for label....\n      const size = localHoverStyle.data ? localHoverStyle.data.length : 0;\n      const radius = [];\n      const stroke = [];\n      const width = [];\n      const fill = [];\n      for (let i = 0; i < size; i++) {\n        radius.push(0);\n        stroke.push('rgba(255, 255, 255, 0)');\n        width.push(0);\n        fill.push('rgba(255, 255, 255, 0)');\n      }\n      localHoverStyle.radius = radius;\n      localHoverStyle.stroke = stroke;\n      localHoverStyle.width = width;\n      localHoverStyle.fill = fill;\n    }\n    if (!hasLabelStyle && label) {\n      localHoverStyle.label.style = {\n        textAlign: 'left',\n        textBaseline: 'top',\n        font: '12px Calibri,sans-serif',\n        fill: { color: '#000' },\n        backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\n        backgroundStroke: { color: 'rgba(200, 200, 200, 0.75)', width: 2 },\n        stroke: { color: '#fff', width: 3 },\n        overflow: true,\n        offsetX: 10,\n        offsetY: 20,\n        padding: [2.5, 2.5, 2.5, 2.5]\n      };\n    }\n    return this.styleService.createStyleByAttribute(\n      feature,\n      localHoverStyle,\n      resolution\n    );\n  }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unlistenToMapSingleClick();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerHoverFeatureStore.entities$.subscribe(\n      (resultsUnderPointerPosition) => {\n        this.addFeatureOverlay(resultsUnderPointerPosition);\n      }\n    );\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: OlMapBrowserEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * On map singleclick\n   */\n  private listenToMapClick() {\n    this.singleClickMapListener = this.map.ol.on(\n      'singleclick',\n      (event: OlMapBrowserEvent<any>) => this.onMapSingleClickEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map singleclick\n   * @internal\n   */\n  private unlistenToMapSingleClick() {\n    unByKey(this.singleClickMapListener);\n    this.singleClickMapListener = undefined;\n  }\n\n  /**\n   * Trigger clear layer on singleclick.\n   * @param event OL map browser singleclick event\n   */\n  private onMapSingleClickEvent(event: OlMapBrowserEvent<any>) {\n    this.clearLayer();\n  }\n\n  /**\n   * Trigger hover when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: OlMapBrowserEvent<any>) {\n    if (\n      event.dragging ||\n      !this.igoHoverFeatureEnabled ||\n      this.mediaService.isTouchScreen()\n    ) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    let maximumZindex = -Infinity;\n    let topMostOlLayer;\n    const pixel = this.map.ol.getPixelFromCoordinate(event.coordinate);\n    this.lastTimeoutRequest = setTimeout(() => {\n      // retrieve the topmost layer with feature to only apply the hover on this layer.\n      this.map.ol.forEachFeatureAtPixel(\n        pixel,\n        (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\n          if (!layerOL) {\n            return;\n          }\n          const igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid);\n          if (!this.canProcessHover(igoLayer as any)) {\n            return;\n          }\n          if (igoLayer.zIndex <= maximumZindex) {\n            return;\n          }\n          maximumZindex = igoLayer.zIndex;\n          topMostOlLayer = layerOL;\n        },\n        {\n          hitTolerance: 10,\n          layerFilter: (olLayer) =>\n            olLayer instanceof olLayerVector ||\n            olLayer instanceof olLayerVectorTile\n        }\n      );\n      if (!topMostOlLayer) {\n        // To clear label\n        this.clearLayer();\n        this.pointerHoverFeatureStore.clear();\n        return;\n      }\n\n      this.map.ol.forEachFeatureAtPixel(\n        pixel,\n        (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\n          // To avoid flashing feature\n          if (\n            mapFeature.get('hoverSummary') === undefined &&\n            mapFeature.getProperties() !==\n              this.pointerHoverFeatureStore.all()[0]?.getProperties()\n          ) {\n            this.clearLayer();\n            let igoLayer;\n            if (layerOL instanceof olLayerVector) {\n              const myLayerVector = this.map.getLayerByOlUId(\n                (layerOL as any).ol_uid\n              ) as VectorLayer;\n              if (!this.canProcessHover(myLayerVector)) {\n                return;\n              }\n              let localOlFeature = this.handleRenderFeature(mapFeature);\n              this.setLayerStyleFromOptions(myLayerVector, localOlFeature);\n              const featuresToLoad = [localOlFeature];\n              localOlFeature.set('_isLabel', false);\n              const myLabelOlFeature = new OlFeature();\n              myLabelOlFeature.setProperties(localOlFeature.getProperties());\n              const labelGeom =\n                localOlFeature.getGeometry().getType() === 'Point'\n                  ? localOlFeature.getGeometry()\n                  : new OlGeom.Point(event.coordinate);\n              myLabelOlFeature.setGeometry(labelGeom);\n              myLabelOlFeature.setId(localOlFeature.getId());\n              myLabelOlFeature.set('_isLabel', true);\n              this.setLayerStyleFromOptions(myLayerVector, myLabelOlFeature);\n              featuresToLoad.push(myLabelOlFeature);\n              this.pointerHoverFeatureStore.load(featuresToLoad);\n              igoLayer = myLayerVector;\n              return true;\n            }\n            if (layerOL instanceof olLayerVectorTile) {\n              const myLayerVectorTile = this.map.getLayerByOlUId(\n                (layerOL as any).ol_uid\n              ) as VectorTileLayer;\n              if (!this.canProcessHover(myLayerVectorTile)) {\n                return;\n              }\n              if (\n                myLayerVectorTile?.options?.igoStyle?.styleByAttribute\n                  ?.hoverStyle\n              ) {\n                this.mvtStyleOptions =\n                  myLayerVectorTile.options.igoStyle.styleByAttribute.hoverStyle;\n              } else if (myLayerVectorTile?.options?.igoStyle?.hoverStyle) {\n                this.mvtStyleOptions =\n                  myLayerVectorTile.options.igoStyle.hoverStyle;\n              }\n              this.selectionLayer.setSource(layerOL.getSource());\n              layerOL\n                .getFeatures(event.pixel)\n                .then(\n                  (mvtFeatures: (RenderFeature | OlFeature<OlGeometry>)[]) => {\n                    if (!mvtFeatures.length) {\n                      this.selectionMVT = {};\n                      this.selectionLayer.changed();\n                      this.clearLayer();\n                      return;\n                    }\n                    const feature = mvtFeatures[0];\n                    if (!feature) {\n                      this.clearLayer();\n                      return;\n                    }\n                    let localOlFeature = this.handleRenderFeature(feature);\n                    localOlFeature.set('_isLabel', false);\n                    const myLabelOlFeature = new OlFeature();\n                    myLabelOlFeature.setProperties(\n                      localOlFeature.getProperties()\n                    );\n                    const labelGeom =\n                      localOlFeature.getGeometry().getType() === 'Point'\n                        ? localOlFeature.getGeometry()\n                        : new OlGeom.Point(event.coordinate);\n                    myLabelOlFeature.setGeometry(labelGeom);\n                    myLabelOlFeature.setId(localOlFeature.getId());\n                    myLabelOlFeature.set('_isLabel', true);\n                    this.setLayerStyleFromOptions(\n                      myLayerVectorTile,\n                      myLabelOlFeature\n                    );\n                    this.pointerHoverFeatureStore.load([myLabelOlFeature]);\n                    this.selectionMVT[feature.getId()] = localOlFeature;\n                    this.selectionLayer.changed();\n                  }\n                );\n              igoLayer = myLayerVectorTile;\n            }\n          }\n        },\n        {\n          hitTolerance: 10,\n          layerFilter: (olLayer) => olLayer === topMostOlLayer\n        }\n      );\n    }, this.igoHoverFeatureDelay);\n  }\n\n  canProcessHover(igoLayer: VectorLayer | VectorTileLayer): boolean {\n    if (!igoLayer) {\n      return false;\n    }\n    if (!igoLayer.visible) {\n      return false;\n    }\n    if (!igoLayer.options) {\n      return false;\n    }\n\n    if (\n      !igoLayer.options.igoStyle?.styleByAttribute &&\n      !igoLayer.options.igoStyle?.hoverStyle\n    ) {\n      return false;\n    }\n\n    if (\n      igoLayer.options.igoStyle?.styleByAttribute &&\n      !igoLayer.options.igoStyle?.styleByAttribute.hoverStyle &&\n      !igoLayer.options.igoStyle?.hoverStyle\n    ) {\n      return false;\n    }\n    return true;\n  }\n\n  handleRenderFeature(\n    feature: RenderFeature | OlFeature<OlGeometry>\n  ): OlFeature<OlGeometry> {\n    let localFeature: OlFeature<OlGeometry>;\n    if (feature instanceof RenderFeature) {\n      localFeature = new OlFeature({\n        geometry: this.getGeometry(feature)\n      });\n      localFeature.setId(feature.getId());\n    } else if (feature instanceof OlFeature) {\n      localFeature = feature;\n    }\n    localFeature.setProperties(feature.getProperties());\n    return localFeature;\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addFeatureOverlay(hoverEntity: OlFeature<OlGeometry>[]) {\n    if (hoverEntity.length > 0) {\n      const result = hoverEntity[0];\n      this.clearLayer();\n      const feature = new OlFeature({\n        geometry: result.getGeometry(),\n        meta: { id: this.hoverFeatureId },\n        hoverSummary: this.getHoverSummary(result.getProperties())\n      });\n\n      this.store.setLayerOlFeatures([feature], FeatureMotion.None);\n    }\n  }\n\n  private setLayerStyleFromOptions(\n    igoLayer: VectorLayer | VectorTileLayer,\n    feature: OlFeature<OlGeometry>\n  ) {\n    const resolution = this.store.layer.map.viewController.getResolution();\n    if (igoLayer?.options?.igoStyle?.styleByAttribute?.hoverStyle) {\n      this.store.layer.ol.setStyle(\n        this.createHoverStyle(\n          feature,\n          igoLayer.options.igoStyle.styleByAttribute.hoverStyle,\n          resolution\n        )\n      );\n      return;\n    }\n    if (igoLayer?.options?.igoStyle?.hoverStyle) {\n      this.store.layer.ol.setStyle(\n        this.createHoverStyle(\n          feature,\n          igoLayer.options.igoStyle.hoverStyle,\n          resolution\n        )\n      );\n    }\n  }\n\n  private getHoverSummary(properties): string {\n    let summary = '';\n    for (const [key, value] of Object.entries(properties)) {\n      if (!key.startsWith('_') && key !== 'geometry') {\n        summary += `${key}: ${value}` + '\\n';\n      }\n    }\n    return summary.length >= 2 ? summary.slice(0, -2) : summary;\n  }\n\n  private getGeometry(feature): OlGeom.Geometry {\n    let geom;\n    if (!feature.getOrientedFlatCoordinates) {\n      geom = feature.getGeometry();\n    } else {\n      const coords = feature.getOrientedFlatCoordinates();\n      const flatCoords = [];\n\n      coords.forEach((c, idx) => {\n        if (idx % 2 === 0) {\n          flatCoords.push([\n            parseFloat(coords[idx]),\n            parseFloat(coords[idx + 1])\n          ]);\n        }\n      });\n\n      // TODO: test MultiX\n      switch (feature.getType()) {\n        case 'Point':\n          geom = new OlGeom.Point(flatCoords);\n          break;\n        case 'Polygon':\n          geom = new OlGeom.Polygon([flatCoords]);\n          break;\n        case 'LineString':\n          geom = new OlGeom.LineString([flatCoords]);\n          break;\n      }\n    }\n\n    return geom;\n  }\n\n  /**\n   * Clear the pointer store features\n   */\n  private clearLayer() {\n    this.selectionMVT = {};\n    if (this.selectionLayer) {\n      this.selectionLayer.changed();\n    }\n    if (this.store) {\n      this.store.clearLayer();\n    }\n  }\n}\n","import { ProjectionsLimitationsOptions } from './projection.interfaces';\n\n/**\n * Return a number of zone MTM for a longitude for province of Quebec only\n * @param lon number\n * @returns zone\n */\nexport function zoneMtm(lon: number): number {\n  let lonMin = -54;\n  const lonMax = -81;\n  if (lon < lonMax || lon > lonMin) {\n    return 0;\n  } else {\n    const deltaLon = 3;\n    let zone = 2;\n    while (Math.abs(lon - lonMin) > deltaLon) {\n      lonMin = lonMin - deltaLon;\n      zone++;\n    }\n    return zone;\n  }\n}\n/**\n * Return a number of zone UTM for a longitude\n * @param lon number\n * @returns zone\n */\nexport function zoneUtm(lon: number): number {\n  let lonMin = -180;\n  const lonMax = 180;\n  const deltaLon = 6;\n  let zone = 1;\n  while (Math.abs(lon - lonMin) > deltaLon) {\n    lonMin = lonMin + deltaLon;\n    zone++;\n  }\n  return zone;\n}\n\n/**\n * Compute the contraints of projections\n * @param projectionsLimitations: ProjectionsLimitationsOptions\n * @returns projectionsContraints: ProjectionsLimitationsOptions\n */\nexport function computeProjectionsConstraints(\n  projectionsLimitations: ProjectionsLimitationsOptions\n): ProjectionsLimitationsOptions {\n  const mtmZone = projectionsLimitations.mtmZone;\n  const utmZone = projectionsLimitations.utmZone;\n  const projectionsConstraints = {\n    projFromConfig:\n      projectionsLimitations.projFromConfig === false ? false : true,\n    nad83: projectionsLimitations.nad83 === false ? false : true,\n    wgs84: projectionsLimitations.wgs84 === false ? false : true,\n    webMercator: projectionsLimitations.webMercator === false ? false : true,\n    utm: projectionsLimitations.utm === false ? false : true,\n    mtm: projectionsLimitations.mtm === false ? false : true,\n    utmZone: {\n      minZone: utmZone && utmZone.minZone ? utmZone.minZone : 17,\n      maxZone: utmZone && utmZone.maxZone ? utmZone.maxZone : 21\n    },\n    mtmZone: {\n      minZone: mtmZone && mtmZone.minZone ? mtmZone.minZone : 2,\n      maxZone: mtmZone && mtmZone.maxZone ? mtmZone.maxZone : 10\n    }\n  };\n  return projectionsConstraints;\n}\n","export enum InsertSourceInsertDBEnum {\n  System = 'system',\n  User = 'user'\n}\n","import olLayerVector from 'ol/layer/Vector';\nimport olSourceVector from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { unByKey } from 'ol/Observable';\nimport { easeOut } from 'ol/easing';\nimport { asArray as ColorAsArray } from 'ol/color';\nimport { getVectorContext } from 'ol/render';\nimport olFeature from 'ol/Feature';\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\nimport * as olformat from 'ol/format';\n\nimport { FeatureDataSource } from '../../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSource } from '../../../datasource/shared/datasources/wfs-datasource';\nimport { ArcGISRestDataSource } from '../../../datasource/shared/datasources/arcgisrest-datasource';\nimport { WebSocketDataSource } from '../../../datasource/shared/datasources/websocket-datasource';\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\n\nimport { VectorWatcher } from '../../utils';\nimport { IgoMap, MapExtent, getResolutionFromScale } from '../../../map/shared';\nimport { Layer } from './layer';\nimport { VectorLayerOptions } from './vector-layer.interface';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core';\nimport { WFSDataSourceOptions } from '../../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  buildUrl,\n  defaultMaxFeatures\n} from '../../../datasource/shared/datasources/wms-wfs.utils';\nimport { OgcFilterableDataSourceOptions } from '../../../filter/shared/ogc-filter.interface';\nimport {\n  GeoNetworkService,\n  SimpleGetOptions\n} from '../../../offline/shared/geo-network.service';\nimport {\n  catchError,\n  concatMap,\n  debounceTime,\n  delay,\n  first\n} from 'rxjs/operators';\nimport { GeoDBService } from '../../../offline/geoDB/geoDB.service';\nimport { fromEvent, of, zip } from 'rxjs';\nimport { InsertSourceInsertDBEnum } from '../../../offline/geoDB/geoDB.enums';\nimport { LayerDBService } from '../../../offline/layerDB/layerDB.service';\nimport { LayerDBData } from '../../../offline';\nimport BaseEvent from 'ol/events/Event';\nimport { olStyleToBasicIgoStyle } from '../../../style/shared/vector/conversion.utils';\nimport { FeatureDataSourceOptions } from '../../../datasource/shared/datasources/feature-datasource.interface';\nimport { ObjectUtils } from '@igo2/utils';\n\nexport class VectorLayer extends Layer {\n  public declare dataSource:\n    | FeatureDataSource\n    | WFSDataSource\n    | ArcGISRestDataSource\n    | WebSocketDataSource\n    | ClusterDataSource;\n  public declare options: VectorLayerOptions;\n  public declare ol: olLayerVector<olSourceVector<OlGeometry>>;\n  private watcher: VectorWatcher;\n  private trackFeatureListenerId;\n\n  get browsable(): boolean {\n    return this.options.browsable !== false;\n  }\n\n  get exportable(): boolean {\n    return this.options.exportable !== false;\n  }\n\n  constructor(\n    options: VectorLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor,\n    private geoNetworkService?: GeoNetworkService,\n    public geoDBService?: GeoDBService,\n    public layerDBService?: LayerDBService\n  ) {\n    super(\n      options,\n      messageService,\n      authInterceptor,\n      geoDBService,\n      layerDBService\n    );\n    this.watcher = new VectorWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVector<olSourceVector<OlGeometry>> {\n    const initialOpacityValue = this.options.opacity || 1;\n    const initialVisibleValue = this.options.visible !== false;\n    const initialMinResValue =\n      this.options.minResolution ||\n      getResolutionFromScale(Number(this.options.minScaleDenom));\n    const initialMaxResValue =\n      this.options.maxResolution ||\n      getResolutionFromScale(Number(this.options.maxScaleDenom));\n    const so = this.options.sourceOptions as FeatureDataSourceOptions;\n    if (this.dataSource instanceof FeatureDataSource) {\n      if (so?.preload?.bypassResolution || so?.preload?.bypassVisible) {\n        this.options.opacity = 0;\n        if (\n          so.preload.bypassResolution &&\n          (this.options.minResolution || this.options.maxResolution)\n        ) {\n          this.options.minResolution = 0;\n          this.options.maxResolution = Infinity;\n        }\n        if (so.preload.bypassVisible && !initialVisibleValue) {\n          this.options.visible = true;\n        }\n      }\n    }\n\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVector<OlGeometry>\n    });\n\n    if (this.options.animation) {\n      this.dataSource.ol.on(\n        'addfeature',\n        function (e) {\n          this.flash(e.feature);\n        }.bind(this)\n      );\n    }\n    if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\n      if (this.options.idbInfo.firstLoad) {\n        this.maintainFeaturesInIdb();\n      }\n      this.dataSource.ol.once('featuresloadend', () => {\n        this.dataSource.ol.on('addfeature', () => this.maintainFeaturesInIdb());\n        this.dataSource.ol.on('changefeature', () =>\n          this.maintainFeaturesInIdb()\n        );\n        this.dataSource.ol.on('clear', () => this.maintainFeaturesInIdb());\n        this.dataSource.ol.on('removefeature', () =>\n          this.maintainFeaturesInIdb()\n        );\n      });\n    }\n\n    if (\n      this.dataSource instanceof FeatureDataSource &&\n      (so?.preload?.bypassResolution || so?.preload?.bypassVisible)\n    ) {\n      this.dataSource.ol.once('featuresloadend', () => {\n        if (initialOpacityValue) {\n          this.opacity = initialOpacityValue;\n        }\n        if (so.preload.bypassResolution) {\n          this.minResolution = initialMinResValue;\n          this.maxResolution = initialMaxResValue;\n        }\n        if (so.preload.bypassVisible) {\n          this.visible = initialVisibleValue;\n        }\n      });\n    }\n\n    if (this.options.trackFeature) {\n      this.enableTrackFeature(this.options.trackFeature);\n    }\n\n    const vector = new olLayerVector(olOptions);\n    const vectorSource = vector.getSource() as olSourceVector<OlGeometry>;\n    const url = vectorSource.getUrl();\n    if (url) {\n      let loader;\n      const wfsOptions = olOptions.sourceOptions as WFSDataSourceOptions;\n      if (\n        wfsOptions?.type === 'wfs' &&\n        (wfsOptions.params || wfsOptions.paramsWFS)\n      ) {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customWFSLoader(\n            vectorSource,\n            wfsOptions,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      } else {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customLoader(\n            vectorSource,\n            url,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      }\n      if (loader) {\n        vectorSource.setLoader(loader);\n      }\n    } else if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\n      const idbLoader = (extent, resolution, proj, success, failure) => {\n        this.customIDBLoader(\n          vectorSource,\n          olOptions.id,\n          extent,\n          proj,\n          success,\n          failure\n        );\n      };\n      if (idbLoader) {\n        vectorSource.setLoader(idbLoader);\n      }\n    }\n\n    if (this.options.idbInfo?.storeToIdb && this.geoDBService) {\n      vector.once('sourceready', () => {\n        if (this.options.idbInfo.firstLoad) {\n          this.maintainOptionsInIdb();\n        }\n        fromEvent<BaseEvent>(vector, 'change')\n          .pipe(debounceTime(750))\n          .subscribe(() => this.maintainOptionsInIdb());\n        vector.on('change:zIndex', () => this.maintainOptionsInIdb());\n      });\n    }\n    return vector;\n  }\n\n  removeLayerFromIDB() {\n    if (this.geoDBService && this.layerDBService) {\n      zip(\n        this.geoDBService.deleteByKey(this.id),\n        this.layerDBService.deleteByKey(this.id)\n      ).subscribe();\n    }\n  }\n\n  private maintainOptionsInIdb() {\n    this.options.igoStyle.igoStyleObject = olStyleToBasicIgoStyle(this.ol);\n    const layerData: LayerDBData = ObjectUtils.removeUndefined({\n      layerId: this.id,\n      detailedContextUri: this.options.idbInfo.contextUri,\n      sourceOptions: {\n        id: this.id,\n        type: 'vector',\n        queryable: true\n      },\n      layerOptions: {\n        workspace: this.options.workspace,\n        zIndex: this.ol ? this.zIndex : 1000000,\n        id: this.id,\n        isIgoInternalLayer: this.isIgoInternalLayer,\n        title: this.title,\n        igoStyle: this.options.igoStyle,\n        idbInfo: Object.assign({}, this.options.idbInfo, { firstLoad: false })\n      },\n      insertEvent: `${this.title}-${this.id}-${new Date()}`\n    });\n    this.layerDBService.update(layerData);\n  }\n\n  private maintainFeaturesInIdb() {\n    const dsFeatures = this.dataSource.ol.getFeatures();\n    const geojsonObject = JSON.parse(\n      new olformat.GeoJSON().writeFeatures(dsFeatures, {\n        dataProjection: 'EPSG:4326',\n        featureProjection: this.dataSource.ol.getProjection() || 'EPSG:3857'\n      })\n    );\n    this.geoDBService.update(\n      this.id,\n      this.id,\n      geojsonObject,\n      InsertSourceInsertDBEnum.User,\n      `${this.title}-${this.id}-${new Date()}`\n    );\n  }\n\n  protected flash(feature) {\n    const start = new Date().getTime();\n    const listenerKey = this.ol.on('postrender', animate.bind(this));\n\n    function animate(event) {\n      const vectorContext = getVectorContext(event);\n      const frameState = event.frameState;\n      const flashGeom = feature.getGeometry().clone();\n      const elapsed = frameState.time - start;\n      const elapsedRatio = elapsed / this.options.animation.duration;\n      const opacity = easeOut(1 - elapsedRatio);\n      const newColor = ColorAsArray(this.options.animation.color || 'red');\n      newColor[3] = opacity;\n      let style = this.ol\n        .getStyleFunction()\n        .call(this, feature)\n        .find((style2) => {\n          return style2.getImage();\n        });\n      if (!style) {\n        style = this.ol.getStyleFunction().call(this, feature)[0];\n      }\n      const styleClone = style.clone();\n\n      switch (feature.getGeometry().getType()) {\n        case 'Point':\n          if (\n            styleClone.getImage() !== null &&\n            typeof styleClone.getImage().getRadius === 'function'\n          ) {\n            const radius =\n              easeOut(elapsedRatio) * (styleClone.getImage().getRadius() * 3);\n            styleClone.getImage().setRadius(radius);\n            styleClone.getImage().setOpacity(opacity);\n          }\n\n          break;\n        case 'LineString':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getStroke().setColor(newColor);\n            styleClone\n              .getImage()\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) *\n                  (styleClone.getImage().getStroke().getWidth() * 3)\n              );\n          }\n          if (styleClone.getStroke()) {\n            styleClone.getStroke().setColor(newColor);\n            styleClone\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) * (styleClone.getStroke().getWidth() * 3)\n              );\n          }\n          break;\n        case 'Polygon':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getFill().setColor(newColor);\n          }\n          if (styleClone.getFill()) {\n            styleClone.getFill().setColor(newColor);\n          }\n          break;\n      }\n\n      styleClone.setText('');\n      vectorContext.setStyle(styleClone);\n      vectorContext.drawGeometry(flashGeom);\n\n      if (elapsed > this.options.animation.duration) {\n        unByKey(listenerKey);\n        // remove last geometry\n        // there is a little flash before feature disappear, better solution ?\n        this.map.ol.render();\n        return;\n      }\n      // tell OpenLayers to continue postcompose animation\n      this.map.ol.render();\n    }\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  public setExtent(extent: MapExtent): void {\n    this.options.extent = extent;\n  }\n\n  public onUnwatch() {\n    this.dataSource.onUnwatch();\n    this.stopAnimation();\n  }\n\n  public stopAnimation() {\n    this.dataSource.ol.un(\n      'addfeature',\n      function (e) {\n        if (this.visible) {\n          this.flash(e.feature);\n        }\n      }.bind(this)\n    );\n  }\n\n  public enableTrackFeature(id: string | number) {\n    this.trackFeatureListenerId = this.dataSource.ol.on(\n      'addfeature',\n      this.trackFeature.bind(this, id)\n    );\n  }\n  public centerMapOnFeature(id: string | number) {\n    const feat = this.dataSource.ol.getFeatureById(id);\n    if (feat) {\n      this.map.ol\n        .getView()\n        .setCenter((feat.getGeometry() as any).getCoordinates());\n    }\n  }\n\n  public trackFeature(id, feat) {\n    if (feat.feature.getId() === id && this.visible) {\n      this.centerMapOnFeature(id);\n    }\n  }\n\n  public disableTrackFeature(id?: string | number) {\n    unByKey(this.trackFeatureListenerId);\n  }\n\n  /**\n   * Custom loader for a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param options olOptions from source\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param proj the projection to retrieve the data\n   * @param success success callback\n   * @param failure failure callback\n   * @param randomParam random parameter to ensure cache is not causing problems in retrieving new data\n   */\n  public customWFSLoader(\n    vectorSource,\n    options,\n    interceptor,\n    extent,\n    resolution,\n    proj,\n    success,\n    failure,\n    randomParam?: boolean\n  ) {\n    {\n      const paramsWFS = options.paramsWFS;\n      const wfsProj = paramsWFS.srsName\n        ? new olProjection({ code: paramsWFS.srsName })\n        : proj;\n      const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\n      paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\n      const url = buildUrl(\n        options,\n        currentExtent,\n        wfsProj,\n        (options as OgcFilterableDataSourceOptions).ogcFilters,\n        randomParam\n      );\n      let startIndex = 0;\n      if (\n        paramsWFS.version === '2.0.0' &&\n        paramsWFS.maxFeatures > defaultMaxFeatures\n      ) {\n        const nbOfFeature = 1000;\n        while (startIndex < paramsWFS.maxFeatures) {\n          let alteredUrl = url.replace(\n            'count=' + paramsWFS.maxFeatures,\n            'count=' + nbOfFeature\n          );\n          alteredUrl = alteredUrl.replace('startIndex=0', '0');\n          alteredUrl += '&startIndex=' + startIndex;\n          alteredUrl.replace(/&&/g, '&');\n          this.getFeatures(\n            vectorSource,\n            interceptor,\n            currentExtent,\n            wfsProj,\n            proj,\n            alteredUrl,\n            nbOfFeature,\n            success,\n            failure\n          );\n          startIndex += nbOfFeature;\n        }\n      } else {\n        this.getFeatures(\n          vectorSource,\n          interceptor,\n          currentExtent,\n          wfsProj,\n          proj,\n          url,\n          paramsWFS.maxFeatures,\n          success,\n          failure\n        );\n      }\n    }\n  }\n\n  /**\n   * Custom loader to get feature from a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param dataProjection the projection of the retrieved data\n   * @param featureProjection the projection of the created features\n   * @param url the url string to retrieve the data\n   * @param threshold the threshold to manage \"more features\" (TODO)\n   * @param success success callback\n   * @param failure failure callback\n   */\n  private getFeatures(\n    vectorSource: olSourceVector<OlGeometry>,\n    interceptor,\n    extent,\n    dataProjection,\n    featureProjection,\n    url: string,\n    threshold: number,\n    success,\n    failure\n  ) {\n    const idAssociatedCall = (this.dataSource as WFSDataSource)\n      .mostRecentIdCallOGCFilter;\n    const xhr = new XMLHttpRequest();\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', modifiedUrl);\n    if (interceptor) {\n      interceptor.interceptXhr(xhr, modifiedUrl);\n    }\n    const onError = () => {\n      vectorSource.removeLoadedExtent(extent);\n      failure();\n    };\n    xhr.onerror = onError;\n    xhr.onload = () => {\n      if (xhr.status === 200 && xhr.responseText.length > 0) {\n        const features = vectorSource\n          .getFormat()\n          .readFeatures(xhr.responseText, {\n            dataProjection,\n            featureProjection\n          }) as olFeature<OlGeometry>[];\n        // TODO Manage \"More feature\"\n        /*if (features.length === 0 || features.length < threshold ) {\n          console.log('No more data to download at this resolution');\n        }*/\n        // Avoids retrieving an older call that took longer to be process\n        if (\n          idAssociatedCall ===\n          (this.dataSource as WFSDataSource).mostRecentIdCallOGCFilter\n        ) {\n          vectorSource.addFeatures(features);\n          success(features);\n        } else {\n          success([]);\n        }\n      } else {\n        onError();\n      }\n    };\n    xhr.send();\n  }\n\n  /**\n   * Custom loader for vector layer.\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param url the url string or function to retrieve the data\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param projection the projection to retrieve the data\n   */\n  private customLoader(\n    vectorSource,\n    url,\n    interceptor,\n    extent,\n    resolution,\n    projection,\n    success,\n    failure\n  ) {\n    const xhr = new XMLHttpRequest();\n    let modifiedUrl = url;\n    if (typeof url !== 'function') {\n      const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n      if (alteredUrlWithKeyAuth) {\n        modifiedUrl = alteredUrlWithKeyAuth;\n      }\n    } else {\n      modifiedUrl = url(extent, resolution, projection);\n    }\n\n    if (this.geoNetworkService && typeof url !== 'function') {\n      const format = vectorSource.getFormat();\n      const type = format.getType();\n\n      let responseType = type;\n      const onError = () => {\n        vectorSource.removeLoadedExtent(extent);\n        failure();\n      };\n\n      const options: SimpleGetOptions = { responseType };\n      this.geoNetworkService.geoDBService\n        .get(url)\n        .pipe(delay(750))\n        .pipe(\n          concatMap((r) =>\n            r\n              ? of(r)\n              : this.geoNetworkService.get(modifiedUrl, options).pipe(\n                  first(),\n                  catchError((res) => {\n                    onError();\n                    throw res;\n                  })\n                )\n          )\n        )\n        .subscribe((content) => {\n          if (content) {\n            const format = vectorSource.getFormat();\n            const type = format.getType();\n            let source;\n            if (type === 'json' || type === 'text') {\n              source = content;\n            } else if (type === 'xml') {\n              source = content;\n              if (!source) {\n                source = new DOMParser().parseFromString(\n                  content,\n                  'application/xml'\n                );\n              }\n            } else if (type === 'arraybuffer') {\n              source = content;\n            }\n            if (source) {\n              const features = format.readFeatures(source, {\n                extent,\n                featureProjection: projection\n              });\n              vectorSource.addFeatures(features, format.readProjection(source));\n              success(features);\n            } else {\n              onError();\n            }\n          }\n        });\n    } else {\n      xhr.open('GET', modifiedUrl);\n      const format = vectorSource.getFormat();\n      if (format.getType() === 'arraybuffer') {\n        xhr.responseType = 'arraybuffer';\n      }\n      if (interceptor) {\n        interceptor.interceptXhr(xhr, modifiedUrl);\n      }\n\n      const onError = () => {\n        vectorSource.removeLoadedExtent(extent);\n        failure();\n      };\n      xhr.onerror = onError;\n      xhr.onload = () => {\n        // status will be 0 for file:// urls\n        if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\n          const type = format.getType();\n          let source;\n          if (type === 'json' || type === 'text') {\n            source = xhr.responseText;\n          } else if (type === 'xml') {\n            source = xhr.responseXML;\n            if (!source) {\n              source = new DOMParser().parseFromString(\n                xhr.responseText,\n                'application/xml'\n              );\n            }\n          } else if (type === 'arraybuffer') {\n            source = xhr.response;\n          }\n          if (source) {\n            const features = format.readFeatures(source, {\n              extent,\n              featureProjection: projection\n            });\n            vectorSource.addFeatures(features, format.readProjection(source));\n            success(features);\n          } else {\n            onError();\n          }\n        } else {\n          onError();\n        }\n      };\n      xhr.send();\n    }\n  }\n\n  /**\n   * Custom loader for vector layer.\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param layerID the url string or function to retrieve the data\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param projection the projection to retrieve the data\n   */\n  private customIDBLoader(\n    vectorSource,\n    layerID,\n    extent,\n    projection,\n    success,\n    failure\n  ) {\n    if (this.geoNetworkService) {\n      const onError = () => {\n        vectorSource.removeLoadedExtent(extent);\n        failure();\n      };\n      this.geoNetworkService.geoDBService.get(layerID).subscribe((content) => {\n        if (content) {\n          const format = vectorSource.getFormat();\n          const type = format.getType();\n          let source;\n          if (type === 'json' || type === 'text') {\n            source = content;\n          } else if (type === 'xml') {\n            source = content;\n            if (!source) {\n              source = new DOMParser().parseFromString(\n                content,\n                'application/xml'\n              );\n            }\n          } else if (type === 'arraybuffer') {\n            source = content;\n          }\n          if (source) {\n            const features = format.readFeatures(source, {\n              extent,\n              featureProjection: projection\n            });\n            vectorSource.addFeatures(features, format.readProjection(source));\n            success(features);\n          } else {\n            onError();\n          }\n        }\n      });\n    }\n  }\n}\n","import olLayerVector from 'ol/layer/Vector';\nimport olSourceVector from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nexport function olStyleToBasicIgoStyle(\n  layer: olLayerVector<olSourceVector<OlGeometry>>\n) {\n  const layerOlStyle = layer.getStyle();\n  if (typeof layerOlStyle === 'function' || layerOlStyle instanceof Array) {\n    return;\n  }\n\n  const rStyle = {\n    fill: {\n      color: layerOlStyle.getFill().getColor()\n    },\n    stroke: {\n      color: layerOlStyle.getStroke().getColor(),\n      width: 2\n    },\n    circle: {\n      fill: {\n        color: (layerOlStyle.getImage() as any).getFill().getColor()\n      },\n      stroke: {\n        color: (layerOlStyle.getImage() as any).getStroke().getColor(),\n        width: 2\n      },\n      radius: 5\n    }\n  };\n  return rStyle;\n}\n","import olLayerVectorTile from 'ol/layer/VectorTile';\nimport olSourceVectorTile from 'ol/source/VectorTile';\n\nimport { MVTDataSource } from '../../../datasource/shared/datasources/mvt-datasource';\n\nimport { Layer } from './layer';\nimport { VectorTileLayerOptions } from './vectortile-layer.interface';\nimport { TileWatcher } from '../../utils';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { IgoMap } from '../../../map/shared';\nimport { MessageService } from '@igo2/core';\nimport VectorTile from 'ol/VectorTile';\n\nexport class VectorTileLayer extends Layer {\n  public declare dataSource: MVTDataSource;\n  public declare options: VectorTileLayerOptions;\n  public declare ol: olLayerVectorTile;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: VectorTileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVectorTile {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVectorTile\n    });\n\n    const vectorTile = new olLayerVectorTile(olOptions);\n    const vectorTileSource = vectorTile.getSource() as olSourceVectorTile;\n\n    vectorTileSource.setTileLoadFunction((tile: VectorTile, url: string) => {\n      const loader = this.customLoader(\n        url,\n        tile.getFormat(),\n        this.authInterceptor,\n        tile.onLoad.bind(tile)\n      );\n      if (loader) {\n        tile.setLoader(loader);\n      }\n    });\n\n    return vectorTile;\n  }\n\n  /**\n   * Custom loader for vector tile layer. Modified from the loadFeaturesXhr function in ol\\featureloader.js\n   * @internal\n   * @param url the url string or function to retrieve the data\n   * @param format the format of the tile\n   * @param interceptor the interceptor of the data\n   * @param success On success event action to trigger\n   * @param failure On failure event action to trigger TODO\n   */\n  customLoader(url, format, interceptor, success, failure?) {\n    return (extent, resolution, projection) => {\n      const xhr = new XMLHttpRequest();\n      let modifiedUrl = url;\n      if (typeof url !== 'function') {\n        const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n        if (alteredUrlWithKeyAuth) {\n          modifiedUrl = alteredUrlWithKeyAuth;\n        }\n      } else {\n        modifiedUrl = url(extent, resolution, projection);\n      }\n      xhr.open('GET', modifiedUrl);\n      if (interceptor) {\n        interceptor.interceptXhr(xhr, modifiedUrl);\n      }\n\n      if (format.getType() === 'arraybuffer') {\n        xhr.responseType = 'arraybuffer';\n      }\n      xhr.onload = (event) => {\n        if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\n          const type = format.getType();\n          let source;\n          if (type === 'json' || type === 'text') {\n            source = xhr.responseText;\n          } else if (type === 'xml') {\n            source = xhr.responseXML;\n            if (!source) {\n              source = new DOMParser().parseFromString(\n                xhr.responseText,\n                'application/xml'\n              );\n            }\n          } else if (type === 'arraybuffer') {\n            source = xhr.response;\n          }\n          if (source) {\n            success.call(\n              this,\n              format.readFeatures(source, {\n                extent,\n                featureProjection: projection\n              }),\n              format.readProjection(source)\n            );\n          } else {\n            // TODO\n            failure.call(this);\n          }\n        } else {\n          // TODO\n          failure.call(this);\n        }\n      };\n      xhr.onerror = () => {\n        // TODO\n        failure.call(this);\n      };\n      xhr.send();\n    };\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","import { AnyLayerOptions } from '../shared/layers/any-layer.interface';\nimport { VectorTileLayerOptions } from '../shared/layers/vectortile-layer.interface';\n\nexport function computeMVTOptionsOnHover(layerOptions: AnyLayerOptions) {\n  const vectorTileLayerOptions = layerOptions as VectorTileLayerOptions;\n  if (\n    vectorTileLayerOptions.sourceOptions?.type === 'mvt' &&\n    (vectorTileLayerOptions.igoStyle?.styleByAttribute?.hoverStyle ||\n      vectorTileLayerOptions.igoStyle?.hoverStyle)\n  ) {\n    const fc = vectorTileLayerOptions.sourceOptions.featureClass;\n    vectorTileLayerOptions.sourceOptions.featureClass = fc ? fc : 'feature';\n  }\n  return layerOptions;\n}\n","import { Injectable } from '@angular/core';\nimport { DBMode, NgxIndexedDBService } from 'ngx-indexed-db';\nimport { Observable, of, Subject } from 'rxjs';\nimport { concatMap, first, map, take } from 'rxjs/operators';\nimport { CompressionService } from '@igo2/core';\nimport { GeoDBData } from './geoDB.interface';\nimport { InsertSourceInsertDBEnum } from './geoDB.enums';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class GeoDBService {\n  readonly dbName: string = 'geoData';\n  public collisionsMap: Map<number, string[]> = new Map();\n  public _newData: number = 0;\n\n  constructor(\n    private ngxIndexedDBService: NgxIndexedDBService,\n    private compression: CompressionService\n  ) {}\n\n  /**\n   * Only blob can be compressed\n   * @param url\n   * @param regionID\n   * @param object object to handle\n   * @param insertSource type of event user or system\n   * @param insertEvent Name of the event where the insert has been triggered\n   * @returns\n   */\n  update(\n    url: string,\n    regionID: any,\n    object: any,\n    insertSource: InsertSourceInsertDBEnum,\n    insertEvent: string\n  ): Observable<any> {\n    if (!object) {\n      return;\n    }\n    let compress = false;\n\n    const subject: Subject<GeoDBData> = new Subject();\n    let object$: Observable<any> = of(object);\n    if (object instanceof Blob) {\n      object$ = this.compression.compressBlob(object);\n      compress = true;\n    }\n    let geoDBData: GeoDBData;\n    object$\n      .pipe(\n        first(),\n        concatMap((object) => {\n          geoDBData = {\n            url,\n            regionID,\n            object: object,\n            compressed: compress,\n            insertSource,\n            insertEvent\n          };\n          return this.ngxIndexedDBService.getByID(this.dbName, url);\n        }),\n        concatMap((dbObject: GeoDBData) => {\n          if (!dbObject) {\n            this._newData++;\n            return this.ngxIndexedDBService.add(this.dbName, geoDBData);\n          } else {\n            const currentRegionID = dbObject.regionID;\n            if (currentRegionID !== regionID) {\n              const collisions = this.collisionsMap.get(currentRegionID);\n              if (collisions !== undefined) {\n                collisions.push(dbObject.url);\n                this.collisionsMap.set(currentRegionID, collisions);\n              } else {\n                this.collisionsMap.set(currentRegionID, [dbObject.url]);\n              }\n            }\n            return this.customUpdate(geoDBData);\n          }\n        })\n      )\n      .subscribe((response) => {\n        subject.next(response);\n        subject.complete();\n      });\n    return subject;\n  }\n\n  private customUpdate(geoDBData: GeoDBData): Observable<GeoDBData> {\n    const subject: Subject<GeoDBData> = new Subject();\n    const deleteRequest = this.ngxIndexedDBService.deleteByKey(\n      this.dbName,\n      geoDBData.url\n    );\n    deleteRequest\n      .pipe(\n        concatMap((isDeleted) =>\n          isDeleted\n            ? this.ngxIndexedDBService.add(this.dbName, geoDBData)\n            : of(undefined)\n        )\n      )\n      .subscribe((object) => {\n        if (object) {\n          subject.next(object);\n        }\n        subject.complete();\n      });\n    return subject;\n  }\n\n  get(url: string): Observable<any> {\n    return this.ngxIndexedDBService.getByID(this.dbName, url).pipe(\n      map((data: GeoDBData) => {\n        if (data) {\n          const object = data.object;\n          if (!data.compressed) {\n            return object;\n          }\n          return this.compression.decompressBlob(object);\n        }\n      })\n    );\n  }\n\n  getByID(url: string): Observable<any> {\n    return this.ngxIndexedDBService.getByID(this.dbName, url);\n  }\n\n  deleteByKey(url: string): Observable<any> {\n    return this.ngxIndexedDBService.deleteByKey(this.dbName, url);\n  }\n\n  getRegionCountByID(id: number): Observable<number> {\n    const subject: Subject<number> = new Subject();\n    const dbRequest = this.getRegionByID(id).subscribe((datas) => {\n      subject.next(datas.length);\n      subject.complete();\n    });\n    return subject;\n  }\n\n  getRegionByID(id: number): Observable<any[]> {\n    if (!id) {\n      return;\n    }\n\n    const IDBKey: IDBKeyRange = IDBKeyRange.only(id);\n    const dbRequest = this.ngxIndexedDBService.getAllByIndex(\n      this.dbName,\n      'regionID',\n      IDBKey\n    );\n    return dbRequest;\n  }\n\n  deleteByRegionID(id: number): Observable<any> {\n    if (!id) {\n      return;\n    }\n\n    const IDBKey: IDBKeyRange = IDBKeyRange.only(id);\n    const dbRequest = this.ngxIndexedDBService.getAllByIndex(\n      this.dbName,\n      'regionID',\n      IDBKey\n    );\n    dbRequest.subscribe((datas: GeoDBData[]) => {\n      datas.forEach((data) => {\n        this.ngxIndexedDBService.deleteByKey(this.dbName, data.url);\n      });\n    });\n    return dbRequest;\n  }\n\n  openCursor(\n    keyRange: IDBKeyRange = IDBKeyRange.lowerBound(0),\n    mode: DBMode = DBMode.readonly\n  ) {\n    const request = this.ngxIndexedDBService.openCursorByIndex(\n      this.dbName,\n      'regionID',\n      keyRange,\n      mode\n    );\n    return request;\n  }\n\n  resetCounters() {\n    this.resetCollisionsMap();\n    this._newData = 0;\n  }\n\n  resetCollisionsMap() {\n    this.collisionsMap = new Map();\n  }\n\n  revertCollisions() {\n    for (const [regionID, collisions] of this.collisionsMap) {\n      for (const url of collisions) {\n        this.ngxIndexedDBService\n          .getByKey(this.dbName, url)\n          .pipe(take(1))\n          .subscribe((dbObject: GeoDBData) => {\n            const updatedObject = dbObject;\n            updatedObject.regionID = regionID;\n            this.customUpdate(dbObject);\n          });\n      }\n    }\n  }\n\n  get newData(): number {\n    return this._newData;\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { ConnectionState, NetworkService } from '@igo2/core';\nimport { Observable } from 'rxjs';\nimport { GeoDBService } from '../geoDB/geoDB.service';\n\nexport enum ResponseType {\n  Arraybuffer = 'arraybuffer',\n  Blob = 'blob',\n  Text = 'text',\n  Json = 'json'\n}\nexport interface SimpleGetOptions {\n  responseType: ResponseType;\n  withCredentials?: boolean;\n}\n@Injectable({\n  providedIn: 'root'\n})\nexport class GeoNetworkService {\n  private networkOnline: boolean = true;\n  constructor(\n    private http: HttpClient,\n    public geoDBService: GeoDBService,\n    private networkService: NetworkService\n  ) {\n    this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.networkOnline = state.connection;\n    });\n  }\n\n  get(url: string, simpleGetOptions: SimpleGetOptions): Observable<any> {\n    if (window.navigator.onLine && this.networkOnline) {\n      return this.getOnline(url, simpleGetOptions);\n    }\n    return this.getOffline(url);\n  }\n\n  private getOnline(\n    url: string,\n    simpleGetOptions: SimpleGetOptions\n  ): Observable<any> {\n    let request;\n    switch (simpleGetOptions.responseType) {\n      // TODO Ajuster pour autre formats\n      case 'arraybuffer':\n        request = this.http.get(url, {\n          responseType: 'arraybuffer',\n          withCredentials: simpleGetOptions.withCredentials\n        });\n        break;\n      case 'blob':\n        request = this.http.get(url, {\n          responseType: 'blob',\n          withCredentials: simpleGetOptions.withCredentials\n        });\n        break;\n      case 'text':\n        request = this.http.get(url, {\n          responseType: 'text',\n          withCredentials: simpleGetOptions.withCredentials\n        });\n        break;\n      case 'json':\n        request = this.http.get(url, {\n          responseType: 'json',\n          withCredentials: simpleGetOptions.withCredentials\n        });\n        break;\n      default:\n        request = this.http.get(url, {\n          responseType: 'blob',\n          withCredentials: simpleGetOptions.withCredentials\n        });\n        break;\n    }\n    return request;\n  }\n\n  private getOffline(url: string): Observable<any> {\n    return this.geoDBService.get(url);\n  }\n\n  public isOnline() {\n    return this.networkOnline && window.navigator.onLine;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { NgxIndexedDBService } from 'ngx-indexed-db';\nimport { Observable, of, Subject } from 'rxjs';\nimport { concatMap, first } from 'rxjs/operators';\nimport { LayerDBData } from './layerDB.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerDBService {\n  readonly dbName: string = 'layerData';\n\n  constructor(private ngxIndexedDBService: NgxIndexedDBService) {}\n\n  /**\n   * This method allow to update the stored layer into the indexeddb (layerData)\n   * @param layerDBData\n   * @returns\n   */\n  update(layerDBData: LayerDBData): Observable<any> {\n    const subject: Subject<LayerDBData> = new Subject();\n    this.ngxIndexedDBService\n      .getByID(this.dbName, layerDBData.layerId)\n      .pipe(\n        first(),\n        concatMap((dbObject: LayerDBData) => {\n          if (!dbObject) {\n            return this.ngxIndexedDBService.add(this.dbName, layerDBData);\n          } else {\n            return this.customUpdate(layerDBData);\n          }\n        })\n      )\n      .subscribe((response) => {\n        subject.next(response);\n        subject.complete();\n      });\n    return subject;\n  }\n\n  private customUpdate(layerDBData: LayerDBData): Observable<LayerDBData> {\n    const subject: Subject<LayerDBData> = new Subject();\n    const deleteRequest = this.ngxIndexedDBService.deleteByKey(\n      this.dbName,\n      layerDBData.layerId\n    );\n    deleteRequest\n      .pipe(\n        concatMap((isDeleted) =>\n          isDeleted\n            ? this.ngxIndexedDBService.add(this.dbName, layerDBData)\n            : of(undefined)\n        )\n      )\n      .subscribe((object) => {\n        if (object) {\n          subject.next(object);\n        }\n        subject.complete();\n      });\n    return subject;\n  }\n\n  /**\n   * This method retrieve an idb layer definition\n   * @param layerId\n   * @returns\n   */\n  getByID(layerId: string): Observable<LayerDBData> {\n    return this.ngxIndexedDBService.getByID(this.dbName, layerId);\n  }\n\n  /**\n   * This method delete an idb layer definition\n   * @param layerId\n   * @returns\n   */\n  deleteByKey(layerId: string): Observable<boolean> {\n    return this.ngxIndexedDBService.deleteByKey(this.dbName, layerId);\n  }\n\n  /**\n   * This method retrive all idb layer definition\n   * @param layerId\n   * @returns\n   */\n  getAll(): Observable<LayerDBData[]> {\n    return this.ngxIndexedDBService.getAll(this.dbName);\n  }\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { combineLatest, Observable, of } from 'rxjs';\nimport { map, catchError, concatMap } from 'rxjs/operators';\nimport { stylefunction } from 'ol-mapbox-style';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { ObjectUtils } from '@igo2/utils';\nimport olLayerVectorTile from 'ol/layer/VectorTile';\n\nimport { Style } from 'ol/style';\nimport * as olStyle from 'ol/style';\n\nimport {\n  OSMDataSource,\n  FeatureDataSource,\n  XYZDataSource,\n  TileDebugDataSource,\n  WFSDataSource,\n  WMTSDataSource,\n  WMSDataSource,\n  CartoDataSource,\n  ImageArcGISRestDataSource,\n  ArcGISRestDataSource,\n  TileArcGISRestDataSource,\n  WebSocketDataSource,\n  MVTDataSource,\n  ClusterDataSource\n} from '../../datasource';\n\nimport { DataSourceService } from '../../datasource/shared/datasource.service';\n\nimport {\n  Layer,\n  ImageLayer,\n  ImageLayerOptions,\n  TileLayer,\n  TileLayerOptions,\n  VectorLayer,\n  VectorLayerOptions,\n  AnyLayerOptions,\n  VectorTileLayer,\n  VectorTileLayerOptions,\n  LayerOptions\n} from './layers';\n\nimport { computeMVTOptionsOnHover } from '../utils/layer.utils';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { MessageService } from '@igo2/core';\nimport { GeoNetworkService } from '../../offline/shared/geo-network.service';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport { LayerDBService } from '../../offline/layerDB/layerDB.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerService {\n  constructor(\n    private http: HttpClient,\n    private styleService: StyleService,\n    private dataSourceService: DataSourceService,\n    private geoNetworkService: GeoNetworkService,\n    private messageService: MessageService,\n    private layerDBService: LayerDBService,\n    @Optional() private authInterceptor: AuthInterceptor\n  ) {}\n\n  createLayer(layerOptions: AnyLayerOptions): Layer {\n    if (!layerOptions.source) {\n      return;\n    }\n\n    if (\n      layerOptions.source.options &&\n      layerOptions.source.options._layerOptionsFromSource\n    ) {\n      layerOptions = ObjectUtils.mergeDeep(\n        layerOptions.source.options._layerOptionsFromSource,\n        layerOptions || {}\n      );\n    }\n\n    let layer;\n    switch (layerOptions.source.constructor) {\n      case OSMDataSource:\n      case WMTSDataSource:\n      case XYZDataSource:\n      case TileDebugDataSource:\n      case CartoDataSource:\n      case TileArcGISRestDataSource:\n        layer = this.createTileLayer(layerOptions as TileLayerOptions);\n        break;\n      case FeatureDataSource:\n      case WFSDataSource:\n      case ArcGISRestDataSource:\n      case WebSocketDataSource:\n      case ClusterDataSource:\n        layer = this.createVectorLayer(layerOptions as VectorLayerOptions);\n        break;\n      case ImageArcGISRestDataSource:\n      case WMSDataSource:\n        layer = this.createImageLayer(layerOptions as ImageLayerOptions);\n        break;\n      case MVTDataSource:\n        const _layerOptions = computeMVTOptionsOnHover(layerOptions);\n        layer = this.createVectorTileLayer(\n          _layerOptions as VectorTileLayerOptions\n        );\n        break;\n      default:\n        break;\n    }\n\n    return layer;\n  }\n\n  createAsyncLayer(\n    _layerOptions: AnyLayerOptions,\n    detailedContextUri?: string\n  ): Observable<Layer> {\n    const layerOptions = computeMVTOptionsOnHover(_layerOptions);\n    if (layerOptions.source) {\n      return new Observable((d) => d.next(this.createLayer(layerOptions)));\n    }\n\n    return this.dataSourceService\n      .createAsyncDataSource(layerOptions.sourceOptions, detailedContextUri)\n      .pipe(\n        map((source) => {\n          if (source === undefined) {\n            return undefined;\n          }\n          return this.createLayer(Object.assign(layerOptions, { source }));\n        })\n      );\n  }\n\n  private createImageLayer(layerOptions: ImageLayerOptions): ImageLayer {\n    return new ImageLayer(\n      layerOptions,\n      this.messageService,\n      this.authInterceptor\n    );\n  }\n\n  private createTileLayer(layerOptions: TileLayerOptions): TileLayer {\n    return new TileLayer(\n      layerOptions,\n      this.messageService,\n      this.authInterceptor\n    );\n  }\n\n  private createVectorLayer(layerOptions: VectorLayerOptions): VectorLayer {\n    let style: Style[] | Style | OlStyleLike = layerOptions.style;\n    let igoLayer: VectorLayer;\n\n    if (!layerOptions.igoStyle) {\n      layerOptions.igoStyle = {};\n    }\n    const legacyStyleOptions = [\n      'styleByAttribute',\n      'hoverStyle',\n      'mapboxStyle',\n      'clusterBaseStyle',\n      'style'\n    ];\n    // handling legacy property.\n    this.handleLegacyStyles(layerOptions, legacyStyleOptions);\n    if (\n      layerOptions.igoStyle.igoStyleObject &&\n      !layerOptions.idbInfo?.storeToIdb\n    ) {\n      style = (feature, resolution) =>\n        this.styleService.createStyle(\n          layerOptions.igoStyle.igoStyleObject,\n          feature,\n          resolution\n        );\n    } else if (\n      layerOptions.igoStyle.igoStyleObject &&\n      layerOptions.idbInfo?.storeToIdb\n    ) {\n      // temporary fix todo : handle it with geostyler.\n      style = this.styleService.parseStyle(\n        'style',\n        layerOptions.igoStyle.igoStyleObject\n      );\n    }\n\n    if (layerOptions.source instanceof ArcGISRestDataSource) {\n      const source = layerOptions.source as ArcGISRestDataSource;\n      style = source.options.params.style;\n    } else if (layerOptions.igoStyle?.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.igoStyle.styleByAttribute,\n          resolution\n        );\n      };\n      igoLayer = new VectorLayer(\n        layerOptions,\n        this.messageService,\n        this.authInterceptor,\n        this.geoNetworkService,\n        this.geoNetworkService.geoDBService,\n        this.layerDBService\n      );\n    }\n\n    if (layerOptions.source instanceof ClusterDataSource) {\n      const serviceStyle = this.styleService;\n      const baseStyle = layerOptions.igoStyle.clusterBaseStyle;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createClusterStyle(\n          feature,\n          resolution,\n          layerOptions.clusterParam,\n          baseStyle\n        );\n      };\n      igoLayer = new VectorLayer(\n        layerOptions,\n        this.messageService,\n        this.authInterceptor,\n        this.geoNetworkService,\n        this.geoNetworkService.geoDBService,\n        this.layerDBService\n      );\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!igoLayer) {\n      igoLayer = new VectorLayer(\n        layerOptionsOl,\n        this.messageService,\n        this.authInterceptor,\n        this.geoNetworkService,\n        this.geoNetworkService.geoDBService,\n        this.layerDBService\n      );\n    }\n\n    this.applyMapboxStyle(igoLayer, layerOptionsOl as any);\n\n    return igoLayer;\n  }\n\n  private handleLegacyStyles(layerOptions, legacyStyleOptions: string[]) {\n    legacyStyleOptions.map((legacyOption) => {\n      if (layerOptions[legacyOption]) {\n        let newKey = legacyOption;\n        if (legacyOption === 'style') {\n          if (layerOptions[legacyOption] instanceof olStyle.Style) {\n            return;\n          }\n          if (typeof layerOptions[legacyOption] === 'object') {\n            newKey = 'igoStyleObject';\n          } else {\n            return;\n          }\n        }\n        layerOptions.igoStyle[newKey] = layerOptions[legacyOption];\n        delete layerOptions[legacyOption];\n        console.warn(`\n        The location of this style option (${legacyOption}) is deprecated.\n        Please move this property within igoStyle property.\n        Ex: ${legacyOption}: {...} must be transfered to igoStyle: { ${newKey}: {...} }\n        This legacy conversion will be deleted in 2024.\n        `);\n      }\n    });\n  }\n\n  private createVectorTileLayer(\n    layerOptions: VectorTileLayerOptions\n  ): VectorTileLayer {\n    let style: Style[] | Style | OlStyleLike;\n    let igoLayer: VectorTileLayer;\n\n    if (!layerOptions.igoStyle) {\n      layerOptions.igoStyle = {};\n    }\n    const legacyStyleOptions = [\n      'styleByAttribute',\n      'hoverStyle',\n      'mapboxStyle',\n      'style'\n    ];\n    // handling legacy property.\n    this.handleLegacyStyles(layerOptions, legacyStyleOptions);\n\n    if (layerOptions.igoStyle.igoStyleObject) {\n      style = (feature, resolution) =>\n        this.styleService.createStyle(\n          layerOptions.igoStyle.igoStyleObject,\n          feature,\n          resolution\n        );\n    }\n\n    if (layerOptions.igoStyle.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.igoStyle.styleByAttribute,\n          resolution\n        );\n      };\n      igoLayer = new VectorTileLayer(\n        layerOptions,\n        this.messageService,\n        this.authInterceptor\n      );\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!igoLayer) {\n      igoLayer = new VectorTileLayer(\n        layerOptionsOl,\n        this.messageService,\n        this.authInterceptor\n      );\n    }\n\n    this.applyMapboxStyle(igoLayer, layerOptionsOl);\n    return igoLayer;\n  }\n\n  private applyMapboxStyle(layer: Layer, layerOptions: VectorTileLayerOptions) {\n    if (layerOptions.igoStyle?.mapboxStyle) {\n      this.getStuff(layerOptions.igoStyle.mapboxStyle.url).subscribe((res) => {\n        if (res.sprite) {\n          const url = this.getAbsoluteUrl(\n            layerOptions.igoStyle.mapboxStyle.url,\n            res.sprite\n          );\n          this.getStuff(url + '.json').subscribe((res2) => {\n            stylefunction(\n              layer.ol as olLayerVectorTile,\n              res,\n              layerOptions.igoStyle.mapboxStyle.source,\n              undefined,\n              res2,\n              url + '.png'\n            );\n          });\n        } else {\n          stylefunction(\n            layer.ol as olLayerVectorTile,\n            res,\n            layerOptions.igoStyle.mapboxStyle.source\n          );\n        }\n      });\n    }\n  }\n\n  private getStuff(url: string) {\n    return this.http.get(url).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No style was found');\n        return of(err);\n      })\n    );\n  }\n\n  private getAbsoluteUrl(source, url) {\n    const r = new RegExp('^http|//', 'i');\n    if (r.test(url)) {\n      return url;\n    } else {\n      if (source.substr(source.length - 1) === '/') {\n        return source + url;\n      } else {\n        return source + '/' + url;\n      }\n    }\n  }\n\n  createAsyncIdbLayers(contextUri: string = '*'): Observable<Layer[]> {\n    return this.layerDBService.getAll().pipe(\n      concatMap((res) => {\n        const idbLayers =\n          contextUri !== '*'\n            ? res.filter((l) => l.detailedContextUri === contextUri)\n            : res;\n        const layersOptions: LayerOptions[] = idbLayers.map((idbl) =>\n          Object.assign({}, idbl.layerOptions, {\n            sourceOptions: idbl.sourceOptions\n          })\n        );\n        return combineLatest(\n          layersOptions.map((layerOptions) =>\n            this.createAsyncLayer(layerOptions)\n          )\n        );\n      })\n    );\n  }\n}\n","export enum CatalogItemType {\n  Layer = 'layer',\n  Group = 'group'\n}\n\nexport enum TypeCatalog {\n  wms,\n  wmts,\n  baselayers,\n  arcgisrest,\n  tilearcgisrest,\n  imagearcgisrest,\n  composite\n}\n\nexport type TypeCatalogStrings = keyof typeof TypeCatalog;\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, of } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\n\nimport { default as striptags } from 'striptags';\n\nimport * as olformat from 'ol/format';\nimport * as olextent from 'ol/extent';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\nimport olFeature from 'ol/Feature';\nimport * as olgeom from 'ol/geom';\n\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { uuid } from '@igo2/utils';\nimport {\n  Feature,\n  FeatureGeometry\n} from '../../feature/shared/feature.interfaces';\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport {\n  WMSDataSource,\n  CartoDataSource,\n  TileArcGISRestDataSource,\n  WMSDataSourceOptions,\n  ImageArcGISRestDataSource\n} from '../../datasource';\n\nimport {\n  QueryFormat,\n  QueryFormatMimeType,\n  QueryHtmlTarget\n} from './query.enums';\nimport {\n  QueryOptions,\n  QueryableDataSource,\n  QueryableDataSourceOptions,\n  QueryUrlData\n} from './query.interfaces';\nimport { MapExtent } from '../../map/shared/map.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class QueryService {\n  public queryEnabled = true;\n  public defaultFeatureCount = 20; // default feature count\n  public featureCount = 20; // feature count\n\n  private previousMessageIds = [];\n\n  constructor(\n    private http: HttpClient,\n    private messageService: MessageService,\n    private languageService: LanguageService\n  ) {}\n\n  query(layers: Layer[], options: QueryOptions): Observable<Feature[]>[] {\n    if (this.previousMessageIds.length) {\n      this.previousMessageIds.forEach((id) => {\n        this.messageService.remove(id);\n      });\n    }\n\n    const newLayers = layers\n      .filter((layer: Layer) => layer.visible && layer.isInResolutionsRange)\n      .map((layer: Layer) => this.queryLayer(layer, options));\n    // the directive accept array in this format [observable, observable...]\n    // if we use multiple 'url' in queryUrl so the result => this form [observable, observable, [observable, observable]]\n    // so we need to flat the array\n    let flatArray = [].concat.apply([], newLayers);\n    return flatArray;\n  }\n\n  queryLayer(\n    layer: Layer,\n    options: QueryOptions\n  ): Observable<Feature[]> | Observable<Feature[]>[] {\n    const url = this.getQueryUrl(\n      layer.dataSource,\n      options,\n      false,\n      layer.map.viewController.getExtent()\n    );\n    if (!url) {\n      return of([]);\n    }\n\n    const resolution: number = layer.map.viewController.getResolution();\n    const scale: number = layer.map.viewController.getScale();\n\n    if (\n      (layer.dataSource as QueryableDataSource).options.queryFormat ===\n      QueryFormat.HTMLGML2\n    ) {\n      if (typeof url === 'string') {\n        const urlGml = this.getQueryUrl(\n          layer.dataSource,\n          options,\n          true\n        ) as string;\n        return this.http.get(urlGml, { responseType: 'text' }).pipe(\n          mergeMap((gmlRes) => {\n            const mergedGML = this.mergeGML(gmlRes, url, layer);\n            const imposedGeom = mergedGML[0];\n            const imposedProperties = mergedGML[1];\n            return this.http\n              .get(url, { responseType: 'text' })\n              .pipe(\n                map((res) =>\n                  this.extractData(\n                    res,\n                    layer,\n                    options,\n                    url,\n                    imposedGeom,\n                    imposedProperties\n                  )\n                )\n              );\n          })\n        );\n      }\n      const urlGmls = this.getQueryUrl(layer.dataSource, options, true);\n      let observables: any = [];\n      for (let i = 0; i < urlGmls.length; i++) {\n        const element = urlGmls[i] as QueryUrlData;\n        if (this.checkScaleAndResolution(resolution, scale, element)) {\n          observables.push(\n            this.requestDataForHTMLGML2(element.url, url[i].url, layer, options)\n          );\n        }\n      }\n      return observables;\n    } else {\n      if (typeof url === 'string') {\n        const request = this.http.get(url, { responseType: 'text' });\n        return request.pipe(\n          map((res) => this.extractData(res, layer, options, url))\n        );\n      }\n      let observables: any = [];\n      for (let i = 0; i < url.length; i++) {\n        const element: QueryUrlData = url[i];\n        if (this.checkScaleAndResolution(resolution, scale, element)) {\n          const request = this.http.get(element.url, { responseType: 'text' });\n          observables.push(\n            request.pipe(\n              map((res) => this.extractData(res, layer, options, element.url))\n            )\n          );\n        }\n      }\n      return observables;\n    }\n  }\n\n  private requestDataForHTMLGML2(\n    urlGml: string,\n    url: string,\n    layer: Layer,\n    options: QueryOptions\n  ): Observable<Feature[]> {\n    return this.http.get(urlGml, { responseType: 'text' }).pipe(\n      mergeMap((gmlRes) => {\n        const mergedGML = this.mergeGML(gmlRes, url, layer);\n        const imposedGeom = mergedGML[0];\n        const imposedProperties = mergedGML[1];\n        return this.http\n          .get(url, { responseType: 'text' })\n          .pipe(\n            map((res) =>\n              this.extractData(\n                res,\n                layer,\n                options,\n                url,\n                imposedGeom,\n                imposedProperties\n              )\n            )\n          );\n      })\n    );\n  }\n\n  private checkScaleAndResolution(\n    resolution: number,\n    scale: number,\n    element: QueryUrlData\n  ): boolean {\n    let checkScale: boolean;\n    let checkResolution: boolean;\n\n    if (\n      !element.minResolution &&\n      !element.maxResolution &&\n      !element.minScale &&\n      !element.maxScale\n    ) {\n      return true;\n    } else {\n      /******************* checking Resolution *******************/\n      if (element.minResolution && element.maxResolution) {\n        // if \"minResolution\" and \"maxResolution\" exists check if resoltion is between\n        if (\n          resolution >= element.minResolution &&\n          resolution <= element.maxResolution\n        ) {\n          checkResolution = true;\n        }\n      } else {\n        // check if \"minResolution\" or \"maxResolution\" exists\n        if (element.minResolution && resolution >= element.minResolution) {\n          checkResolution = true;\n        }\n        if (element.maxResolution && resolution <= element.maxResolution) {\n          checkResolution = true;\n        }\n      }\n\n      /******************* checking Scale *******************/\n      if (element.minScale && element.maxScale) {\n        // if \"minScale\" and \"maxScale\" exists check if scale is between\n        if (scale > element.minScale && scale < element.maxScale) {\n          checkScale = true;\n        }\n      } else {\n        // check if \"minScale\" or \"maxScale\" exists\n        if (element.maxScale && scale <= element.maxScale) {\n          checkScale = true;\n        }\n        if (element.minScale && scale >= element.minScale) {\n          checkScale = true;\n        }\n      }\n\n      /******************* result of checking *******************/\n      if (checkScale === true && checkResolution === true) {\n        return true;\n      } else if (\n        (checkResolution === true && !checkScale) ||\n        (checkScale === true && !checkResolution)\n      ) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }\n\n  private mergeGML(\n    gmlRes,\n    url,\n    layer: Layer\n  ): [FeatureGeometry, { [key: string]: any }] {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(gmlRes);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      features = wmsParser.readFeatures(gmlRes);\n    }\n    const olmline = new olgeom.MultiLineString([]);\n    let pts;\n    const ptsArray = [];\n    let olmpoly = new olgeom.MultiPolygon([]);\n    let firstFeatureType;\n    const nbFeatures = features.length;\n\n    // Check if geometry intersect bbox\n    // for geoserver getfeatureinfo response in data projection, not call projection\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const bbox = bboxRaw.split(',');\n    const bboxExtent = olextent.createEmpty();\n    olextent.extend(bboxExtent, bbox);\n    const outBboxExtent = false;\n    let titleContent;\n    let queryTileField;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        queryTileField = dataSourceOptions.queryTitle;\n      }\n    }\n    features.map((feature) => {\n      if (queryTileField) {\n        let queryTitleContent = feature.getProperties()[queryTileField];\n        if (queryTitleContent) {\n          titleContent = !titleContent\n            ? queryTitleContent\n            : `${titleContent},${queryTitleContent}`;\n        }\n      }\n      /*  if (!feature.getGeometry().simplify(100).intersectsExtent(bboxExtent)) {\n        outBboxExtent = true;\n        // TODO: Check to project the geometry?\n      }*/\n      const featureGeometryCoordinates = (\n        feature.getGeometry() as any\n      ).getCoordinates();\n      const featureGeometryType = feature.getGeometry().getType();\n\n      if (!firstFeatureType && !outBboxExtent) {\n        firstFeatureType = featureGeometryType;\n      }\n      if (!outBboxExtent) {\n        switch (featureGeometryType) {\n          case 'Point':\n            if (nbFeatures === 1) {\n              pts = new olgeom.Point(featureGeometryCoordinates, 'XY');\n            } else {\n              ptsArray.push(featureGeometryCoordinates);\n            }\n            break;\n          case 'LineString':\n            olmline.appendLineString(\n              new olgeom.LineString(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'Polygon':\n            olmpoly.appendPolygon(\n              new olgeom.Polygon(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'MultiPolygon':\n            olmpoly = new olgeom.MultiPolygon(featureGeometryCoordinates, 'XY');\n            break;\n          default:\n            return;\n        }\n      }\n    });\n\n    let olmpts;\n    if (ptsArray.length === 0 && pts) {\n      olmpts = {\n        type: pts.getType(),\n        coordinates: pts.getCoordinates()\n      };\n    } else {\n      olmpts = {\n        type: 'Polygon',\n        coordinates: [this.convexHull(ptsArray)]\n      };\n    }\n\n    let returnGeometry;\n    switch (firstFeatureType) {\n      case 'LineString':\n        returnGeometry = {\n          type: olmline.getType(),\n          coordinates: olmline.getCoordinates()\n        };\n        break;\n      case 'Point':\n        returnGeometry = olmpts;\n        break;\n      case 'Polygon':\n        returnGeometry = {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n        break;\n      case 'MultiPolygon':\n        returnGeometry = {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n        break;\n    }\n    const imposedProperties = {};\n\n    if (queryTileField) {\n      imposedProperties[queryTileField] = titleContent;\n    }\n\n    return [returnGeometry, imposedProperties];\n  }\n\n  cross(a, b, o) {\n    return (a[0] - o[0]) * (b[1] - o[1]) - (a[1] - o[1]) * (b[0] - o[0]);\n  }\n\n  /**\n   * @param points An array of [X, Y] coordinates\n   * This method is use instead of turf.js convexHull because Turf needs at least 3 point to make a hull.\n   * https://en.wikibooks.org/wiki/Algorithm_Implementation/Geometry/Convex_hull/Monotone_chain#JavaScript\n   */\n  convexHull(points) {\n    points.sort((a, b) => {\n      return a[0] === b[0] ? a[1] - b[1] : a[0] - b[0];\n    });\n\n    const lower = [];\n    for (const point of points) {\n      while (\n        lower.length >= 2 &&\n        this.cross(lower[lower.length - 2], lower[lower.length - 1], point) <= 0\n      ) {\n        lower.pop();\n      }\n      lower.push(point);\n    }\n\n    const upper = [];\n    for (let i = points.length - 1; i >= 0; i--) {\n      while (\n        upper.length >= 2 &&\n        this.cross(\n          upper[upper.length - 2],\n          upper[upper.length - 1],\n          points[i]\n        ) <= 0\n      ) {\n        upper.pop();\n      }\n      upper.push(points[i]);\n    }\n\n    upper.pop();\n    lower.pop();\n    return lower.concat(upper);\n  }\n\n  private extractData(\n    res,\n    layer: Layer,\n    options: QueryOptions,\n    url: string,\n    imposedGeometry?,\n    imposedProperties?: { [key: string]: any }\n  ): Feature[] {\n    const queryDataSource = layer.dataSource as QueryableDataSource;\n\n    const allowedFieldsAndAlias = this.getAllowedFieldsAndAlias(layer);\n    let features = [];\n    switch (queryDataSource.options.queryFormat) {\n      case QueryFormat.GML3:\n        features = this.extractGML3Data(\n          res,\n          layer.zIndex,\n          allowedFieldsAndAlias\n        );\n        break;\n      case QueryFormat.JSON:\n      case QueryFormat.GEOJSON:\n      case QueryFormat.GEOJSON2:\n        features = this.extractGeoJSONData(\n          res,\n          layer.zIndex,\n          allowedFieldsAndAlias\n        );\n        break;\n      case QueryFormat.ESRIJSON:\n        features = this.extractEsriJSONData(\n          res,\n          layer.zIndex,\n          allowedFieldsAndAlias\n        );\n        break;\n      case QueryFormat.TEXT:\n        features = this.extractTextData(res);\n        break;\n      case QueryFormat.HTML:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url\n        );\n        break;\n      case QueryFormat.HTMLGML2:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url,\n          imposedGeometry,\n          imposedProperties\n        );\n        break;\n      case QueryFormat.GML2:\n      default:\n        features = this.extractGML2Data(res, layer, allowedFieldsAndAlias);\n        break;\n    }\n    if (\n      features.length > 0 &&\n      (features[0].geometry === null || !features[0].geometry)\n    ) {\n      const geomToAdd = this.createGeometryFromUrlClick(url);\n\n      for (const feature of features) {\n        feature.geometry = geomToAdd;\n      }\n    }\n\n    const wmsDatasource = layer.dataSource as WMSDataSource;\n    const featureCount = wmsDatasource.params?.FEATURE_COUNT\n      ? new RegExp('FEATURE_COUNT=' + this.featureCount)\n      : new RegExp('FEATURE_COUNT=' + this.defaultFeatureCount);\n\n    if (\n      featureCount.test(url) &&\n      ((wmsDatasource.params?.FEATURE_COUNT &&\n        this.featureCount > 1 &&\n        features.length === this.featureCount) ||\n        (!wmsDatasource.params?.FEATURE_COUNT &&\n          features.length === this.defaultFeatureCount))\n    ) {\n      const messageObj = this.messageService.info(\n        'igo.geo.query.featureCountMax',\n        undefined,\n        undefined,\n        { value: layer.title }\n      );\n      this.previousMessageIds.push(messageObj.toastId);\n    }\n\n    return features.map((feature: Feature, index: number) => {\n      const mapLabel = feature.properties[queryDataSource.mapLabel];\n\n      let exclude;\n      if (layer.options.sourceOptions?.type === 'wms') {\n        const sourceOptions = layer.options\n          .sourceOptions as WMSDataSourceOptions;\n        exclude = sourceOptions ? sourceOptions.excludeAttribute : undefined;\n      }\n\n      let title = this.getQueryTitle(feature, layer);\n      if (!title && features.length > 1) {\n        title = `${layer.title} (${index + 1})`;\n      } else if (!title) {\n        title = layer.title;\n      }\n\n      const meta = Object.assign({}, feature.meta || {}, {\n        id: uuid(),\n        title,\n        mapTitle: mapLabel,\n        sourceTitle: layer.title,\n        order: 1000 - layer.zIndex,\n        excludeAttribute: exclude\n      });\n\n      return Object.assign(feature, {\n        meta,\n        projection:\n          queryDataSource.options.type === 'carto'\n            ? 'EPSG:4326'\n            : options.projection\n      });\n    });\n  }\n\n  private createGeometryFromUrlClick(url) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const width = parseInt(searchParams.width, 10);\n    const height = parseInt(searchParams.height, 10);\n    const xPosition = parseInt(searchParams.i || searchParams.x, 10);\n    const yPosition = parseInt(searchParams.j || searchParams.y, 10);\n\n    const bbox = bboxRaw.split(',');\n    let threshold =\n      (Math.abs(parseFloat(bbox[0])) - Math.abs(parseFloat(bbox[2]))) * 0.05;\n\n    // for context in degree (EPSG:4326,4269...)\n    if (Math.abs(parseFloat(bbox[0])) < 180) {\n      threshold = 0.045;\n    }\n    const clickx =\n      parseFloat(bbox[0]) +\n      (Math.abs(parseFloat(bbox[0]) - parseFloat(bbox[2])) * xPosition) /\n        width -\n      threshold;\n    const clicky =\n      parseFloat(bbox[1]) +\n      (Math.abs(parseFloat(bbox[1]) - parseFloat(bbox[3])) * yPosition) /\n        height -\n      threshold;\n    const clickx1 = clickx + threshold * 2;\n    const clicky1 = clicky + threshold * 2;\n\n    const wktPoly =\n      'POLYGON((' +\n      clickx +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky +\n      '))';\n\n    const format = new olformat.WKT();\n    const tenPercentWidthGeom = format.readFeature(wktPoly);\n    const f = tenPercentWidthGeom.getGeometry() as any;\n\n    const newGeom = {\n      type: f.getType(),\n      coordinates: f.getCoordinates()\n    };\n\n    return newGeom;\n  }\n\n  private extractGML2Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(res);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      try {\n        features = wmsParser.readFeatures(res);\n      } catch (e) {\n        console.warn(\n          'query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.'\n        );\n      }\n    }\n\n    return features.map((feature) =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGML3Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML3();\n    let features = [];\n    try {\n      features = parser.readFeatures(res);\n    } catch (e) {\n      console.warn('query.service: GML3 is not well supported');\n    }\n    return features.map((feature) =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGeoJSONData(res, zIndex, allowedFieldsAndAlias?) {\n    let features = [];\n    try {\n      features = JSON.parse(res.replace(/(\\r|\\n)/g, ' ')).features;\n    } catch (e) {\n      console.warn('query.service: Unable to parse geojson', '\\n', res);\n    }\n    features.map(\n      (feature) =>\n        (feature.meta = {\n          id: uuid(),\n          order: 1000 - zIndex,\n          alias: allowedFieldsAndAlias\n        })\n    );\n    return features;\n  }\n\n  private extractEsriJSONData(res, zIndex, allowedFieldsAndAlias) {\n    if (res) {\n      try {\n        if (JSON.parse(res).error) {\n          return [];\n        }\n      } catch (e) {}\n    }\n    const parser = new olFormatEsriJSON();\n    const features = parser.readFeatures(res);\n\n    return features.map((feature) =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractTextData(res) {\n    // TODO\n    return [];\n  }\n\n  private extractHtmlData(\n    res,\n    htmlTarget: QueryHtmlTarget,\n    url,\n    imposedGeometry?,\n    imposedProperties?: { [key: string]: any }\n  ) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const projection = searchParams.crs || searchParams.srs || 'EPSG:3857';\n    const geomToAdd = this.createGeometryFromUrlClick(url);\n\n    if (\n      htmlTarget !== QueryHtmlTarget.BLANK &&\n      htmlTarget !== QueryHtmlTarget.IFRAME\n    ) {\n      htmlTarget = QueryHtmlTarget.IFRAME;\n    }\n\n    const bodyTagStart = res.toLowerCase().indexOf('<body>');\n    const bodyTagEnd = res.toLowerCase().lastIndexOf('</body>') + 7;\n    // replace \\r \\n  and ' ' with '' to validate if the body is really empty. Clear all the html tags from body\n    const body = striptags(\n      res.slice(bodyTagStart, bodyTagEnd).replace(/(\\r|\\n|\\s)/g, '')\n    );\n    if (body === '' || res === '') {\n      return [];\n    }\n\n    return [\n      {\n        type: FEATURE,\n        projection,\n        properties: Object.assign(\n          { target: htmlTarget, body: res, url },\n          imposedProperties\n        ),\n        geometry: imposedGeometry || geomToAdd\n      }\n    ];\n  }\n\n  private getQueryParams(url) {\n    const queryString = url.split('?');\n    if (!queryString[1]) {\n      return;\n    }\n    const pairs = queryString[1].split('&');\n\n    const result = {};\n    pairs.forEach((pair) => {\n      pair = pair.split('=');\n      result[pair[0]] = decodeURIComponent(pair[1] || '');\n    });\n    return result;\n  }\n\n  public featureToResult(\n    featureOL: olFeature<olgeom.Geometry>,\n    zIndex: number,\n    allowedFieldsAndAlias?\n  ): Feature {\n    const featureGeometry = featureOL.getGeometry() as any;\n    const properties: any = Object.assign({}, featureOL.getProperties());\n    delete properties.geometry;\n    delete properties.GEOMETRIE;\n    delete properties.boundedBy;\n    delete properties.shape;\n    delete properties.SHAPE;\n    delete properties.SHAPE_S;\n    delete properties.SHAPE_L;\n    delete properties.SHAPE_P;\n    delete properties.the_geom;\n    delete properties.geom;\n    delete properties.geom32198;\n\n    let geometry;\n    if (featureGeometry) {\n      geometry = {\n        type: featureGeometry.getType(),\n        coordinates: featureGeometry.getCoordinates()\n      };\n    }\n\n    return {\n      type: FEATURE,\n      projection: undefined,\n      properties,\n      geometry,\n      meta: {\n        id: uuid(),\n        order: 1000 - zIndex,\n        alias: allowedFieldsAndAlias\n      }\n    };\n  }\n\n  private getQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    forceGML2 = false,\n    mapExtent?: MapExtent\n  ): string | QueryUrlData[] {\n    let url;\n\n    if (datasource.options.queryUrls) {\n      return this.getCustomQueryUrl(datasource, options, mapExtent);\n    }\n\n    switch (datasource.constructor) {\n      case WMSDataSource:\n        const wmsDatasource = datasource as WMSDataSource;\n\n        const WMSGetFeatureInfoOptions = {\n          INFO_FORMAT:\n            wmsDatasource.params.INFO_FORMAT ||\n            this.getMimeInfoFormat(datasource.options.queryFormat),\n          QUERY_LAYERS: wmsDatasource.params.LAYERS,\n          FEATURE_COUNT:\n            wmsDatasource.params.FEATURE_COUNT || this.defaultFeatureCount\n        };\n\n        if (wmsDatasource.params.FEATURE_COUNT) {\n          this.featureCount = wmsDatasource.params.FEATURE_COUNT;\n        }\n\n        if (forceGML2) {\n          WMSGetFeatureInfoOptions.INFO_FORMAT = this.getMimeInfoFormat(\n            QueryFormat.GML2\n          );\n        }\n\n        url = wmsDatasource.ol.getFeatureInfoUrl(\n          options.coordinates,\n          options.resolution,\n          options.projection,\n          WMSGetFeatureInfoOptions\n        );\n        // const wmsVersion =\n        //   wmsDatasource.params.VERSION ||\n        //   wmsDatasource.params.version ||\n        //   '1.3.0';\n        // if (wmsVersion !== '1.3.0') {\n        //   url = url.replace('&I=', '&X=');\n        //   url = url.replace('&J=', '&Y=');\n        // }\n        break;\n      case CartoDataSource:\n        const cartoDatasource = datasource as CartoDataSource;\n        const baseUrl =\n          'https://' +\n          cartoDatasource.options.account +\n          '.carto.com/api/v2/sql?';\n        const format = 'format=GeoJSON';\n        const sql =\n          '&q=' + cartoDatasource.options.config.layers[0].options.sql;\n        const clause =\n          ' WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(';\n        const meters = cartoDatasource.options.queryPrecision\n          ? cartoDatasource.options.queryPrecision\n          : '1000';\n        const coordinates =\n          options.coordinates[0] +\n          ',' +\n          options.coordinates[1] +\n          '),3857),' +\n          meters +\n          '))';\n\n        url = `${baseUrl}${format}${sql}${clause}${coordinates}`;\n        break;\n      case ImageArcGISRestDataSource:\n      case TileArcGISRestDataSource:\n        const tileArcGISRestDatasource = datasource as TileArcGISRestDataSource;\n        const deltaX = Math.abs(mapExtent[0] - mapExtent[2]);\n        const deltaY = Math.abs(mapExtent[1] - mapExtent[3]);\n        const maxDelta = deltaX > deltaY ? deltaX : deltaY;\n        const clickBuffer = maxDelta * 0.005;\n        const threshold = tileArcGISRestDatasource.options.queryPrecision\n          ? tileArcGISRestDatasource.options.queryPrecision\n          : clickBuffer;\n        const extent = olextent.buffer(\n          olextent.boundingExtent([options.coordinates]),\n          threshold\n        );\n        const serviceUrl =\n          tileArcGISRestDatasource.options.url +\n          '/' +\n          tileArcGISRestDatasource.options.layer +\n          '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        url = `${serviceUrl}?${params.join('&')}`;\n        break;\n      default:\n        break;\n    }\n\n    return url;\n  }\n\n  private getMimeInfoFormat(queryFormat: string) {\n    let mime = 'application/vnd.ogc.gml';\n    const keyEnum = Object.keys(QueryFormat).find(\n      (key) => QueryFormat[key] === queryFormat\n    );\n    if (keyEnum) {\n      mime = QueryFormatMimeType[keyEnum];\n    }\n\n    return mime;\n  }\n\n  getAllowedFieldsAndAlias(layer: any) {\n    let allowedFieldsAndAlias;\n    if (\n      layer.options?.source?.options?.sourceFields &&\n      layer.options.source.options.sourceFields.length >= 1\n    ) {\n      allowedFieldsAndAlias = {};\n      layer.options.source.options.sourceFields.forEach((sourceField) => {\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\n        allowedFieldsAndAlias[sourceField.name] = alias;\n      });\n    }\n    return allowedFieldsAndAlias;\n  }\n\n  getQueryTitle(feature: Feature, layer: Layer): string {\n    let title;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\n      }\n    }\n\n    return title;\n  }\n\n  getLabelMatch(feature: Feature, labelMatch): string {\n    let label = labelMatch;\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach((v) => {\n      label = label.replace(v[0], feature.properties[v[1]]);\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.properties[labelMatch] || labelMatch;\n    }\n\n    return label;\n  }\n\n  /**\n   * @param datasource QueryableDataSource\n   * @param options QueryOptions\n   * @mapExtent extent of the map when click event\n   *\n   */\n\n  getCustomQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    mapExtent?: MapExtent\n  ): QueryUrlData[] {\n    const extent = olextent.getForViewAndSize(\n      options.coordinates,\n      options.resolution,\n      0,\n      [101, 101]\n    );\n\n    return datasource.options.queryUrls.map((item) => {\n      let data: QueryUrlData = {\n        url: item.url\n          .replace(/\\{bbox\\}/g, extent.join(','))\n          .replace(/\\{x\\}/g, options.coordinates[0].toString())\n          .replace(/\\{y\\}/g, options.coordinates[1].toString())\n          .replace(/\\{resolution\\}/g, options.resolution.toString())\n          .replace(/\\{srid\\}/g, options.projection.replace('EPSG:', ''))\n      };\n\n      // if the queryFormat changed to \"QueryFormat.HTMLGML2\": mapExtent will be undefined\n      // we need to check \"mapExtent\" befor replace variables in the url\n      if (mapExtent) {\n        data.url\n          .replace(/\\{xmin\\}/g, mapExtent[0].toString())\n          .replace(/\\{ymin\\}/g, mapExtent[1].toString())\n          .replace(/\\{xmax\\}/g, mapExtent[2].toString())\n          .replace(/\\{ymax\\}/g, mapExtent[3].toString());\n      }\n\n      if (item.maxResolution) {\n        data.maxResolution = item.maxResolution;\n      }\n\n      if (item.minResolution) {\n        data.minResolution = item.minResolution;\n      }\n\n      if (item.minScale) {\n        data.minScale = item.minScale;\n      }\n\n      if (item.maxScale) {\n        data.maxScale = item.maxScale;\n      }\n\n      return data;\n    });\n  }\n}\n","import OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\n\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { QueryableDataSource } from './query.interfaces';\n\n/**\n * Whether a layer is queryable\n * @param layer Layer\n * @returns True if the layer s squeryable\n */\nexport function layerIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryable === true;\n}\n\n/**\n * Whether an OL layer is queryable\n * @param layer Layer\n * @returns True if the ol layer is queryable\n */\nexport function olLayerIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined ? false : layerIsQueryable(layer);\n}\n\n/**\n * Whether a layer's feature is queryable\n * @param layer Layer\n * @returns True if the layer's feature is queryable\n */\nexport function layerFeatureIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryLayerFeatures !== undefined\n    ? dataSource.options.queryLayerFeatures === true\n    : true;\n}\n\n/**\n * Whether an OL Vector layer is queryable\n * @param layer Layer\n * @returns True if the ol vector layer is queryable\n */\nexport function olLayerFeatureIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined\n    ? false\n    : layerIsQueryable(layer) && layerFeatureIsQueryable(layer);\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  AfterViewInit,\n  Self\n} from '@angular/core';\n\nimport { Subscription, Observable, of, zip } from 'rxjs';\nimport { unByKey } from 'ol/Observable';\n\nimport OlFeature from 'ol/Feature';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { EventsKey } from 'ol/events';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { renderFeatureFromOl } from '../../feature/shared/feature.utils';\nimport { featureFromOl } from '../../feature/shared/feature.utils';\nimport { QueryService } from './query.service';\nimport { layerIsQueryable, olLayerFeatureIsQueryable } from './query.utils';\nimport { ctrlKeyDown } from '../../map/shared/map.utils';\nimport { OlDragSelectInteraction } from '../../feature/shared/strategies/selection';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { QueryableDataSourceOptions } from './query.interfaces';\n\n/**\n * This directive makes a map queryable with a click of with a drag box.\n * By default, all layers are queryable but this can ben controlled at\n * the layer level.\n */\n@Directive({\n  selector: '[igoQuery]'\n})\nexport class QueryDirective implements AfterViewInit, OnDestroy {\n  /**\n   * Subscriptions to ongoing queries\n   */\n  private queries$$: Subscription[] = [];\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * OL drag box interaction\n   */\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  /**\n   * Ol drag box \"end\" event key\n   */\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Whter to query features or not\n   */\n  @Input() queryFeatures: boolean = false;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesHitTolerance: number = 0;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesCondition: (olLayer: OlLayer<OlSource>) => boolean;\n\n  /**\n   * Whether all query should complete before emitting an event\n   */\n  @Input() waitForAllQueries: boolean = true;\n\n  /**\n   * Event emitted when a query (or all queries) complete\n   */\n  @Output() query = new EventEmitter<{\n    features: Feature[] | Feature[][];\n    event: MapBrowserPointerEvent<any>;\n  }>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map as any as IgoMap;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private queryService: QueryService\n  ) {}\n\n  /**\n   * Start listening to click and drag box events\n   * @internal\n   */\n  ngAfterViewInit() {\n    this.listenToMapClick();\n    this.addDragBoxInteraction();\n  }\n\n  /**\n   * Stop listening to click and drag box events and cancel ongoind requests\n   * @internal\n   */\n  ngOnDestroy() {\n    this.cancelOngoingQueries();\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n  }\n\n  /**\n   * On map click, issue queries\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * Issue queries from a map event and emit events with the results\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    this.cancelOngoingQueries();\n    if (!this.queryService.queryEnabled) {\n      return;\n    }\n\n    const queries$ = [];\n    if (this.queryFeatures) {\n      queries$.push(this.doQueryFeatures(event));\n    }\n\n    const resolution = this.map.ol.getView().getResolution();\n    const queryLayers = this.map.layers.filter(layerIsQueryable);\n    queries$.push(\n      ...this.queryService.query(queryLayers, {\n        coordinates: event.coordinate as [number, number],\n        projection: this.map.projection,\n        resolution\n      })\n    );\n\n    if (queries$.length === 0) {\n      return;\n    }\n\n    if (this.waitForAllQueries) {\n      this.queries$$.push(\n        zip(...queries$).subscribe((results: Feature[][]) => {\n          const features = [].concat(...results);\n          this.query.emit({ features, event });\n        })\n      );\n    } else {\n      this.queries$$ = queries$.map((query$: Observable<Feature[]>) => {\n        return query$.subscribe((features: Feature[]) => {\n          this.query.emit({ features, event });\n        });\n      });\n    }\n  }\n\n  /**\n   * Query features already present on the map\n   * @param event OL map browser pointer event\n   */\n  private doQueryFeatures(\n    event: MapBrowserPointerEvent<any>\n  ): Observable<Feature[]> {\n    const clickedFeatures = [];\n\n    if (event.type === 'singleclick') {\n      this.map.ol.forEachFeatureAtPixel(\n        event.pixel,\n        (featureOL: OlFeature<OlGeometry>, layerOL: any) => {\n          const layer = this.map.getLayerById(layerOL.values_._layer.id);\n          if (\n            (layer.dataSource.options as QueryableDataSourceOptions)\n              .queryFormatAsWms\n          ) {\n            return;\n          }\n          if (featureOL) {\n            if (featureOL.get('features')) {\n              for (const feature of featureOL.get('features')) {\n                const newFeature = featureFromOl(feature, this.map.projection);\n                newFeature.meta = {\n                  title: feature.values_.nom,\n                  id: layerOL.values_._layer.id + '.' + feature.id_,\n                  icon: feature.values_._icon,\n                  sourceTitle: layerOL.values_.title,\n                  alias: this.queryService.getAllowedFieldsAndAlias(layer)\n                  // title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n                };\n                clickedFeatures.push(newFeature);\n              }\n            } else if (featureOL instanceof OlRenderFeature) {\n              const newFeature = renderFeatureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title:\n                  this.queryService.getQueryTitle(newFeature, layer) ||\n                  newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            } else {\n              const newFeature = featureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title:\n                  this.queryService.getQueryTitle(newFeature, layer) ||\n                  newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            }\n          }\n        },\n        {\n          hitTolerance: this.queryFeaturesHitTolerance || 0,\n          layerFilter: this.queryFeaturesCondition\n            ? this.queryFeaturesCondition\n            : olLayerFeatureIsQueryable\n        }\n      );\n    } else if (event.type === 'boxend') {\n      const target = event.target as any;\n      const dragExtent = target.getGeometry().getExtent();\n      this.map.layers\n        .filter(layerIsQueryable)\n        .filter((layer) => layer instanceof VectorLayer && layer.visible)\n        .map((layer) => {\n          const featuresOL = layer.dataSource.ol as olVectorSource<OlGeometry>;\n          featuresOL.forEachFeatureIntersectingExtent(\n            dragExtent,\n            (olFeature: any) => {\n              const newFeature: Feature = featureFromOl(\n                olFeature,\n                this.map.projection,\n                layer.ol\n              );\n              newFeature.meta = {\n                id: layer.id + '.' + olFeature.getId(),\n                icon: olFeature.values_._icon,\n                sourceTitle: layer.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title:\n                  this.queryService.getQueryTitle(newFeature, layer) ||\n                  newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            }\n          );\n        });\n    }\n\n    return of(clickedFeatures);\n  }\n\n  /**\n   * Cancel ongoing requests, if any\n   */\n  private cancelOngoingQueries() {\n    this.queries$$.forEach((sub: Subscription) => sub.unsubscribe());\n    this.queries$$ = [];\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteractionOnQuery;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteractionOnQuery = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteractionOnQuery === undefined) {\n      olDragSelectInteractionOnQuery = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteractionOnQuery);\n      this.olDragSelectInteraction = olDragSelectInteractionOnQuery;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteractionOnQuery.on(\n      'boxend',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n}\n","import { ObjectUtils } from '@igo2/utils';\nimport { StorageService } from '@igo2/core';\nimport {\n  ISearchSourceParams,\n  SearchSourceOptions,\n  SearchSourceSettings\n} from './source.interfaces';\nimport { FeatureStore } from '../../../feature';\nimport { Workspace } from '@igo2/common';\n\n/**\n * Base search source class\n */\nexport class SearchSource {\n  /**\n   * Search source ID\n   * @internal\n   */\n  static id = '';\n\n  /**\n   * Search source type\n   * @internal\n   */\n  static type = '';\n\n  /**\n   * Search source options\n   * @internal\n   */\n  protected options: SearchSourceOptions;\n\n  /**\n   * Get search source's id\n   * @returns Search source's id\n   */\n  getId(): string {\n    throw new Error('You have to implement the method \"getId\".');\n  }\n  /**\n   * Get search source's type\n   * @returns Search source's type\n   */\n  getType(): string {\n    throw new Error('You have to implement the method \"getType\".');\n  }\n\n  /**\n   * Get search source's default options\n   * @returns Search source default options\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    throw new Error('You have to implement the method \"getDefaultOptions\".');\n  }\n\n  /**\n   * Search source's title\n   */\n  get title(): string {\n    return this.options.title;\n  }\n\n  /**\n   * Whether the search source is available\n   */\n  get available(): boolean {\n    return this.options.available !== false;\n  }\n\n  /**\n   * Whether the search source is enabled\n   */\n  set enabled(value: boolean) {\n    this.options.enabled = value;\n  }\n  get enabled(): boolean {\n    return this.available && this.options.enabled !== false;\n  }\n\n  get showInPointerSummary(): boolean {\n    const showInPointerSummary = this.options.showInPointerSummary;\n    return showInPointerSummary ? showInPointerSummary : false;\n  }\n\n  get showInSettings(): boolean {\n    const showInSettings = this.options.showInSettings;\n    return showInSettings === undefined ? true : showInSettings;\n  }\n\n  /**\n   * Search url\n   */\n  get searchUrl(): string {\n    return this.options.searchUrl;\n  }\n\n  /**\n   * Search query params\n   */\n  get params(): ISearchSourceParams | null {\n    return this.options.params;\n  }\n\n  /**\n   * Search settings\n   */\n  get settings(): SearchSourceSettings[] {\n    return this.options.settings === undefined ? [] : this.options.settings;\n  }\n\n  set featureStoresWithIndex(storesWithIndex: FeatureStore[]) {\n    this._featureStoresWithIndex = storesWithIndex;\n  }\n  get featureStoresWithIndex() {\n    return this._featureStoresWithIndex;\n  }\n  private _featureStoresWithIndex: FeatureStore[];\n\n  setWorkspaces(workspaces: Workspace[]) {\n    if (\n      workspaces.filter((fw) => (fw.entityStore as FeatureStore).searchDocument)\n        .length >= 1\n    ) {\n      this.options.available = true;\n    } else {\n      this.options.available = false;\n    }\n    const values = [];\n    this.featureStoresWithIndex = workspaces\n      .filter((fw) => (fw.entityStore as FeatureStore).searchDocument)\n      .map((fw) => {\n        values.push({\n          title: fw.title,\n          value: fw.title,\n          enabled: true\n        });\n        return fw.entityStore as FeatureStore;\n      });\n    const datasets = this.options.settings.find((s) => s.title === 'datasets');\n    if (datasets) {\n      datasets.values = values;\n    }\n    this.setParamFromSetting(datasets);\n  }\n\n  /**\n   * Set params from selected settings\n   */\n  setParamFromSetting(setting: SearchSourceSettings, saveInStorage = true) {\n    switch (setting.type) {\n      case 'radiobutton':\n        setting.values.forEach((conf) => {\n          if (conf.enabled) {\n            this.options.params = Object.assign(this.options.params || {}, {\n              [setting.name]: conf.value\n            });\n          }\n        });\n        break;\n      case 'checkbox':\n        let confValue = '';\n        setting.values\n          .filter((s) => s.available !== false)\n          .forEach((conf) => {\n            if (conf.enabled) {\n              confValue += conf.value + ',';\n            }\n          });\n        confValue = confValue.slice(0, -1);\n        this.options.params = Object.assign(this.options.params || {}, {\n          [setting.name]: confValue\n        });\n        break;\n    }\n\n    if (saveInStorage && this.storageService) {\n      this.storageService.set(this.getId() + '.options', {\n        params: this.options.params\n      });\n    }\n  }\n\n  /**\n   * Search results display order\n   */\n  get displayOrder(): number {\n    return this.options.order === undefined ? 99 : this.options.order;\n  }\n\n  constructor(\n    options: SearchSourceOptions,\n    private storageService?: StorageService\n  ) {\n    this.options = options;\n    if (this.storageService) {\n      const storageOptions = this.storageService.get(\n        this.getId() + '.options'\n      ) as object;\n      if (storageOptions) {\n        this.options = ObjectUtils.mergeDeep(this.options, storageOptions);\n      }\n    }\n\n    this.options = ObjectUtils.mergeDeep(\n      this.getDefaultOptions(),\n      this.options\n    );\n\n    // Set Default Params from Settings\n    this.settings.forEach((setting) => {\n      this.setParamFromSetting(setting, false);\n    });\n  }\n\n  /**\n   * Get hashtags valid\n   * @param hashtag hashtag from query\n   */\n  getHashtagsValid(term: string, settingsName: string): string[] {\n    const hashtags = term.match(/(#[A-Za-zÀ-ÿ-+]+)/g);\n    if (!hashtags) {\n      return undefined;\n    }\n\n    const searchSourceSetting = this.getSettingsValues(settingsName);\n    const hashtagsValid = [];\n    hashtags.forEach((hashtag) => {\n      searchSourceSetting.values.forEach((conf) => {\n        const hashtagKey = hashtag.substring(1);\n        if (typeof conf.value === 'string') {\n          const types = conf.value\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n            .split(',');\n          const index = types.indexOf(\n            hashtagKey\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '')\n          );\n          if (index !== -1) {\n            hashtagsValid.push(types[index]);\n          }\n        }\n        if (\n          conf.hashtags &&\n          conf.hashtags.indexOf(hashtagKey.toLowerCase()) !== -1\n        ) {\n          hashtagsValid.push(conf.value);\n        }\n      });\n    });\n\n    return hashtagsValid.filter((a, b) => hashtagsValid.indexOf(a) === b);\n  }\n\n  getSettingsValues(search: string): SearchSourceSettings {\n    return this.getDefaultOptions().settings.find(\n      (value: SearchSourceSettings) => {\n        return value.name === search;\n      }\n    );\n  }\n}\n","import { Injectable, Inject } from '@angular/core';\n\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { SearchSourceOptions } from '../../search/shared/sources/source.interfaces';\n/**\n * Map search source. For now it has no search capability. All it does\n * is act as a placeholder for the map query results' \"search source\".\n */\n@Injectable()\nexport class QuerySearchSource extends SearchSource {\n  static id = 'map';\n  static type = FEATURE;\n\n  constructor(@Inject('options') options: SearchSourceOptions) {\n    super(options);\n  }\n\n  getId(): string {\n    return QuerySearchSource.id;\n  }\n\n  getType(): string {\n    return QuerySearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Carte'\n    };\n  }\n}\n","export class GoogleLinks {\n  static getGoogleMapsCoordLink(lon, lat) {\n    return `https://www.google.com/maps/search/?api=1&query=${lat}%2C${lon}`;\n  }\n\n  static getGoogleStreetViewLink(lon, lat) {\n    return `https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${lat}%2C${lon}`;\n  }\n\n  static getGoogleMapsNameLink(name) {\n    const encodedName = encodeURI(name);\n    return `https://www.google.com/maps/search/?api=1&query=${encodedName}`;\n  }\n}\n","export class OsmLinks {\n  static getOpenStreetMapLink(lon, lat, zoom: number = 17) {\n    return `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=${zoom}/${lat}/${lon}`;\n  }\n\n  static getOpenStreetCamLink(lon, lat, zoom: number = 17) {\n    return `https://openstreetcam.org/map/@${lat},${lon},${zoom}z`;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { RegexService } from '@igo2/core';\nimport { GeoServiceDefinition } from './propertyTypeDetector.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PropertyTypeDetectorService {\n  public geoServiceRegexes: GeoServiceDefinition[] = [];\n\n  constructor(private regexService: RegexService) {\n    this.geoServiceRegexes = this.getGeoServiceRegexes();\n  }\n\n  getPropertyType(value) {\n    return typeof value;\n  }\n\n  private isUrl(value): boolean {\n    const regex = /^https?:\\/\\//;\n    return regex.test(value.toString());\n  }\n\n  isGeoService(value): boolean {\n    let isGeoService = false;\n    if (!this.isUrl) {\n      return;\n    }\n    for (const geoServiceRegex of this.geoServiceRegexes) {\n      const domainRegex = new RegExp(geoServiceRegex.url);\n      if (domainRegex.test(value)) {\n        isGeoService = true;\n        break;\n      }\n    }\n    return isGeoService;\n  }\n\n  getGeoService(\n    url: string,\n    availableProperties: string[]\n  ): GeoServiceDefinition {\n    if (!this.isGeoService(url)) {\n      return;\n    }\n    let matchingGeoservice: GeoServiceDefinition;\n    for (const geoServiceRegex of this.geoServiceRegexes) {\n      const domainRegex = new RegExp(geoServiceRegex.url);\n      if (domainRegex.test(url)) {\n        // providing the the first matching regex;\n        const matchingProperties = availableProperties.filter((p) =>\n          geoServiceRegex.propertiesForLayerName.includes(p)\n        );\n        matchingGeoservice = matchingProperties ? geoServiceRegex : undefined;\n        if (matchingGeoservice) {\n          break;\n        }\n      }\n    }\n    return matchingGeoservice;\n  }\n\n  private getGeoServiceRegexes(): GeoServiceDefinition[] {\n    return (this.regexService.get('geoservice') ||\n      []) as GeoServiceDefinition[];\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport { TooltipType } from '../../layer/shared';\nimport { TimeFilterOptions } from '../../filter/shared';\nimport { QueryFormat, QueryHtmlTarget } from '../../query/shared';\n\nimport { ICatalog, CatalogItem, CatalogItemGroup } from './catalog.interface';\nimport { TypeCatalogStrings } from './catalog.enum';\n\nexport abstract class Catalog implements ICatalog {\n  id: string;\n  title: string;\n  url: string;\n  removable?: boolean;\n  externalProvider?: boolean;\n  abstract?: string;\n  forcedProperties?: any[];\n  items?: CatalogItem[];\n  type?: TypeCatalogStrings;\n  version?: string;\n  matrixSet?: string;\n  requestEncoding?: string;\n  regFilters?: string[];\n  groupImpose?: CatalogItemGroup;\n  groupSeparator?: string;\n  timeFilter?: TimeFilterOptions;\n  queryFormat?: QueryFormat;\n  queryHtmlTarget?: QueryHtmlTarget;\n  queryParams?: { [key: string]: string };\n  sourceOptions?: { [key: string]: any };\n  count?: number;\n  tooltipType?: TooltipType.ABSTRACT | TooltipType.TITLE;\n  sortDirection?: 'asc' | 'desc';\n  setCrossOriginAnonymous?: boolean;\n  showLegend?: boolean;\n  profils?: string[];\n\n  constructor(options: Catalog) {\n    Object.assign(this, options);\n  }\n\n  public abstract collectCatalogItems(): Observable<CatalogItem[]>;\n}\n\nexport type CollectCatalogItemsFn = (\n  _this: Catalog\n) => Observable<CatalogItem[]>;\n","import { Observable } from 'rxjs';\nimport { Catalog, CollectCatalogItemsFn } from './catalog.abstract';\nimport { TypeCatalog } from './catalog.enum';\nimport {\n  CatalogItem,\n  CatalogItemGroup,\n  ICatalog,\n  ICompositeCatalog\n} from './catalog.interface';\n\nexport class WMSCatalog extends Catalog {\n  constructor(\n    options: Catalog,\n    private _collectCatlogItems: CollectCatalogItemsFn\n  ) {\n    super(options);\n    const sType: string = TypeCatalog[TypeCatalog.wms];\n    this.type = TypeCatalog[sType];\n  }\n\n  public collectCatalogItems(): Observable<CatalogItem[]> {\n    return this._collectCatlogItems(this);\n  }\n}\n\nexport class WMTSCatalog extends Catalog {\n  constructor(\n    options: Catalog,\n    private _collectCatlogItems: CollectCatalogItemsFn\n  ) {\n    super(options);\n    const sType: string = TypeCatalog[TypeCatalog.wmts];\n    this.type = TypeCatalog[sType];\n  }\n\n  public collectCatalogItems(): Observable<CatalogItem[]> {\n    return this._collectCatlogItems(this);\n  }\n}\n\nexport class BaselayersCatalog extends Catalog {\n  constructor(\n    options: Catalog,\n    private _collectCatlogItems: CollectCatalogItemsFn\n  ) {\n    super(options);\n    const sType: string = TypeCatalog[TypeCatalog.baselayers];\n    this.type = TypeCatalog[sType];\n  }\n\n  public collectCatalogItems(): Observable<CatalogItemGroup[]> {\n    return this._collectCatlogItems(this);\n  }\n}\n\nexport class ArcGISRestCatalog extends Catalog {\n  constructor(\n    options: Catalog,\n    private _collectCatlogItems: CollectCatalogItemsFn\n  ) {\n    super(options);\n    const sType: string = TypeCatalog[TypeCatalog.arcgisrest];\n    this.type = TypeCatalog[sType];\n  }\n\n  public collectCatalogItems() {\n    return this._collectCatlogItems(this);\n  }\n}\n\nexport class TileOrImageArcGISRestCatalog extends Catalog {\n  constructor(\n    options: Catalog,\n    public _collectCatlogItems: CollectCatalogItemsFn,\n    typeCatalog: TypeCatalog\n  ) {\n    super(options);\n    this.type = TypeCatalog[TypeCatalog[typeCatalog]];\n  }\n\n  public collectCatalogItems() {\n    return this._collectCatlogItems(this);\n  }\n}\n\nexport class CompositeCatalog extends Catalog implements ICompositeCatalog {\n  declare composite: ICatalog[];\n\n  constructor(\n    options: Catalog,\n    private _collectCatlogItems: CollectCatalogItemsFn\n  ) {\n    super(options);\n    const sType: string = TypeCatalog[TypeCatalog.composite];\n    this.type = TypeCatalog[sType];\n    this.url = null;\n  }\n\n  public collectCatalogItems(): Observable<CatalogItem[]> {\n    return this._collectCatlogItems(this);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { EMPTY, Observable, of, zip } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { uuid, ObjectUtils } from '@igo2/utils';\nimport { LanguageService, MessageService, ConfigService } from '@igo2/core';\nimport {\n  CapabilitiesService,\n  WMSDataSourceOptions,\n  WMSDataSourceOptionsParams,\n  WMTSDataSourceOptions,\n  ArcGISRestDataSourceOptions\n} from '../../datasource';\nimport { LayerOptions, ImageLayerOptions } from '../../layer/shared';\nimport { getResolutionFromScale } from '../../map/shared';\n\nimport {\n  CatalogItem,\n  CatalogItemLayer,\n  CatalogItemGroup,\n  ForcedProperty\n} from './catalog.interface';\nimport { Catalog } from './catalog.abstract';\nimport { CatalogItemType, TypeCatalog } from './catalog.enum';\nimport { QueryFormat } from '../../query/shared';\nimport { generateIdFromSourceOptions } from '../../utils';\nimport {\n  ArcGISRestCatalog,\n  BaselayersCatalog,\n  CompositeCatalog,\n  TileOrImageArcGISRestCatalog,\n  WMSCatalog,\n  WMTSCatalog\n} from './catalogs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CatalogService {\n  constructor(\n    private http: HttpClient,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private capabilitiesService: CapabilitiesService\n  ) {}\n\n  loadCatalogs(): Observable<Catalog[]> {\n    const contextConfig = this.config.getConfig('context') || {};\n    const catalogConfig = this.config.getConfig('catalog') || {};\n    const apiUrl = catalogConfig.url || contextConfig.url;\n    const catalogsFromConfig = catalogConfig.sources || [];\n\n    const observables$ = [];\n\n    if (apiUrl) {\n      // Base layers catalog\n      if (catalogConfig.baseLayers) {\n        const translate = this.languageService.translate;\n        const title = translate.instant('igo.geo.catalog.baseLayers');\n        const baseLayersCatalog = [\n          {\n            id: 'catalog.baselayers',\n            title,\n            url: `${apiUrl}/baselayers`,\n            type: 'baselayers'\n          }\n        ];\n        observables$.push(of(baseLayersCatalog));\n      }\n\n      // Catalogs from API\n      const catalogsFromApi$ = this.http\n        .get<Catalog[]>(`${apiUrl}/catalogs`)\n        .pipe(\n          map((catalogs) =>\n            catalogs.map((c: any) => Object.assign(c, c.options))\n          ),\n          catchError((_response: HttpErrorResponse) => EMPTY)\n        );\n      observables$.push(catalogsFromApi$);\n    }\n\n    // Catalogs from config\n    if (catalogsFromConfig.length > 0) {\n      observables$.push(\n        of(catalogsFromConfig).pipe(\n          map((catalogs: Catalog[]) =>\n            catalogs.map((c) => {\n              if (!c.id) {\n                c.id = uuid();\n              }\n              return c;\n            })\n          )\n        )\n      );\n    }\n\n    return zip(...observables$).pipe(\n      map((catalogs: Catalog[][]) => [].concat.apply([], catalogs))\n    ) as Observable<Catalog[]>;\n  }\n\n  loadCatalogItems(catalog: Catalog): Observable<CatalogItem[]> {\n    let newCatalog: Catalog;\n    newCatalog = CatalogFactory.createInstanceCatalog(catalog, this);\n    return newCatalog.collectCatalogItems();\n  }\n\n  loadCatalogBaseLayerItems(catalog: Catalog): Observable<CatalogItemGroup[]> {\n    return this.getCatalogBaseLayersOptions(catalog).pipe(\n      map((layersOptions: LayerOptions[]) => {\n        const items = layersOptions.map((layerOptions: LayerOptions) => {\n          return {\n            id: generateIdFromSourceOptions(layerOptions.sourceOptions),\n            title: layerOptions.title,\n            type: CatalogItemType.Layer,\n            externalProvider: catalog.externalProvider,\n            options: layerOptions\n          } as CatalogItemLayer;\n        });\n        return [\n          {\n            id: 'catalog.group.baselayers',\n            type: CatalogItemType.Group,\n            externalProvider: catalog.externalProvider,\n            title: catalog.title,\n            items\n          }\n        ];\n      })\n    );\n  }\n\n  private getCatalogBaseLayersOptions(\n    catalog: Catalog\n  ): Observable<LayerOptions[]> {\n    return this.http.get<LayerOptions[]>(catalog.url);\n  }\n\n  loadCatalogWMSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        const items = [];\n        if (!capabilities) {\n          return items;\n        }\n        if (\n          capabilities.Service &&\n          capabilities.Service.Abstract &&\n          capabilities.Service.Abstract.length\n        ) {\n          catalog.abstract = capabilities.Service.Abstract;\n        }\n        const finalLayers = [];\n        this.flattenWmsCapabilities(\n          capabilities.Capability.Layer,\n          0,\n          finalLayers,\n          catalog.groupSeparator\n        );\n        const capabilitiesCapabilityLayer = Object.assign(\n          {},\n          capabilities.Capability.Layer\n        );\n        capabilitiesCapabilityLayer.Layer = finalLayers.filter(\n          (f) => f.Layer.length !== 0\n        );\n        this.includeRecursiveItems(catalog, capabilitiesCapabilityLayer, items);\n        return items;\n      })\n    );\n  }\n\n  flattenWmsCapabilities(parent, level = 0, finalLayers, separator = ' / ') {\n    if (!finalLayers.includes(parent.Title)) {\n      const modifiedParent = Object.assign({}, parent);\n      modifiedParent.Layer = [];\n      finalLayers.push(modifiedParent);\n    }\n    for (const layer of parent.Layer) {\n      const modifiedLayer = Object.assign({}, layer);\n      if (level > 0) {\n        modifiedLayer.Title = parent.Title + separator + layer.Title;\n      }\n      if (layer.Layer) {\n        this.flattenWmsCapabilities(\n          modifiedLayer,\n          level + 1,\n          finalLayers,\n          separator\n        );\n      } else {\n        finalLayers.find((ff) => ff.Title === parent.Title).Layer.push(layer);\n      }\n    }\n  }\n\n  loadCatalogWMTSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => this.getWMTSItems(catalog, capabilities))\n    );\n  }\n\n  loadCatalogArcGISRestItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        return this.getArcGISRESTItems(catalog, capabilities);\n      })\n    );\n  }\n\n  loadCatalogCompositeLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    const compositeCatalog = (catalog as CompositeCatalog).composite;\n\n    const catalogsFromInstance = [] as Catalog[];\n    compositeCatalog.map((component: Catalog) => {\n      component.sortDirection = catalog.sortDirection; // propagate sortDirection with parent value\n      catalogsFromInstance.push(\n        CatalogFactory.createInstanceCatalog(component, this)\n      );\n    });\n\n    // get CatalogItems for each original Catalog-----------------------------------------------------\n    const request1$ = [];\n    catalogsFromInstance.map((component: Catalog) =>\n      request1$.push(component.collectCatalogItems())\n    );\n\n    // integrate imposed group -----------------------------------------------------\n    let request2$ = [];\n\n    function flatDeepLayer(arr) {\n      return arr.reduce(\n        (acc, val) =>\n          acc.concat(\n            val.type === CatalogItemType.Group ? flatDeepLayer(val.items) : val\n          ),\n        []\n      );\n    }\n\n    if (\n      Object.keys(compositeCatalog).find((k) => compositeCatalog[k].groupImpose)\n    ) {\n      const pushImposeGroup = (item, index) => {\n        const c = catalogsFromInstance[index];\n        const outGroupImpose = Object.assign({}, c.groupImpose);\n        outGroupImpose.address = c.id;\n        outGroupImpose.type = CatalogItemType.Group;\n        outGroupImpose.externalProvider = c.externalProvider;\n        if (outGroupImpose.sortDirection === undefined) {\n          outGroupImpose.sortDirection = c.sortDirection;\n        }\n        outGroupImpose.items = [];\n\n        const flatLayer = flatDeepLayer(item);\n        flatLayer.map(\n          (v) => (v.address = `${outGroupImpose.address}.${outGroupImpose.id}`)\n        );\n        outGroupImpose.items = flatLayer;\n\n        return outGroupImpose;\n      };\n\n      request2$ = request1$.map((obs, idx) =>\n        obs.pipe(\n          map((items) =>\n            compositeCatalog[idx].groupImpose\n              ? pushImposeGroup(items, idx)\n              : items\n          )\n        )\n      );\n    } else {\n      request2$ = request1$;\n    }\n\n    // concat Group -----------------------------------------------------\n    const request3$ = zip(...request2$).pipe(\n      map(\n        (output: CatalogItem[]) => [].concat(...output) // [].concat.apply([], result1\n      )\n    );\n\n    // merge Group (first level only) -----------------------------------------------------\n    const groupByGroupId = (data, keyFn) =>\n      data.reduce((acc, group) => {\n        const groupId = keyFn(group);\n        const ind = acc.find((x) => x.id === groupId);\n\n        if (!ind) {\n          acc[acc.length] = group;\n        } else {\n          const ix = acc.indexOf(ind);\n          if (acc[ix].address.split('|').indexOf(group.address) === -1) {\n            acc[ix].address = `${acc[ix].address}|${group.address}`;\n          }\n          acc[ix].items.push(...group.items);\n        }\n        return acc;\n      }, []);\n\n    // merge Layer for each Level (catalog, group(recursive))\n    const recursiveGroupByLayerAddress = (items, keyFn) =>\n      items.reduce((acc, item, idx, arr) => {\n        const layerTitle = keyFn(item);\n        const outItem = Object.assign({}, item);\n\n        if (item.type === CatalogItemType.Layer) {\n          // same title, same address => result: only one item is kept\n\n          // same title, address diff\n          const indicesMatchTitle = [];\n          const indicesMatchNewMetadataUrl = []; // metadata\n          const diffAddress = arr.filter((x, i) => {\n            let bInd = false;\n            if (x.title === layerTitle && x.type === CatalogItemType.Layer) {\n              if (i !== idx && x.address !== item.address) {\n                bInd = true;\n              }\n              indicesMatchTitle.push(i);\n            }\n            return bInd;\n          }); // $& i !== idx\n\n          if (diffAddress.length > 0) {\n            let nPosition = indicesMatchTitle.findIndex((x) => x === idx) + 1;\n            outItem.title = `${item.title} (${nPosition})`; // source: ${item.address.split('.')[0]}\n            nPosition =\n              indicesMatchNewMetadataUrl.findIndex((x) => x === idx) + 1;\n            outItem.newMetadataUrl = `${item.newMetadataUrl} (${nPosition})`; // source: ${item.address.split('.')[0]}\n          }\n\n          const exist = acc.find(\n            (x) => x.title === outItem.title && x.type === CatalogItemType.Layer\n          );\n          if (!exist) {\n            acc[acc.length] = outItem;\n          }\n        } else if (item.type === CatalogItemType.Group) {\n          outItem.items = recursiveGroupByLayerAddress(\n            item.items,\n            (layer) => layer.title\n          );\n          acc[acc.length] = outItem;\n        }\n\n        return acc;\n      }, []);\n\n    const request4$ = request3$.pipe(\n      map((output) => groupByGroupId(output, (group) => group.id)),\n      map((output) => [].concat(...output)),\n      map((data) => recursiveGroupByLayerAddress(data, (layer) => layer.title))\n    );\n\n    return request4$;\n  }\n\n  private getCatalogCapabilities(catalog: Catalog): Observable<any> {\n    const sType: string = TypeCatalog[catalog.type as string];\n    return this.capabilitiesService\n      .getCapabilities(sType as any, catalog.url, catalog.version)\n      .pipe(\n        catchError((e) => {\n          this.messageService.error(\n            catalog.title\n              ? 'igo.geo.catalog.unavailable'\n              : 'igo.geo.catalog.someUnavailable',\n            'igo.geo.catalog.unavailableTitle',\n            undefined,\n            catalog.title ? { value: catalog.title } : undefined\n          );\n          console.error(e);\n          return of(undefined);\n        })\n      );\n  }\n\n  private computeForcedProperties(\n    layerNameFromCatalog: string,\n    forcedProperties: ForcedProperty[]\n  ): ForcedProperty {\n    if (!forcedProperties || forcedProperties.length === 0) {\n      return;\n    }\n    const returnProperty: ForcedProperty = {\n      layerName: layerNameFromCatalog,\n      title: undefined,\n      metadataUrl: undefined,\n      metadataAbstract: undefined,\n      metadataAbstractAll: undefined,\n      metadataUrlAll: undefined\n    };\n    //process wildcard before\n    // if there is a * wildcard\n    const forcedPropertiesForAllLayers = forcedProperties.find(\n      (f) => f.layerName === '*'\n    );\n    if (forcedPropertiesForAllLayers) {\n      // metadataAbstractAll\n      if (forcedPropertiesForAllLayers.metadataAbstractAll) {\n        returnProperty.metadataAbstractAll =\n          forcedPropertiesForAllLayers.metadataAbstractAll;\n      }\n      // metadataUrlAll\n      if (forcedPropertiesForAllLayers.metadataUrlAll) {\n        returnProperty.metadataUrlAll =\n          forcedPropertiesForAllLayers.metadataUrlAll;\n      }\n    }\n    forcedProperties.map((forcedProperty) => {\n      // if match found\n      if (layerNameFromCatalog === forcedProperty.layerName) {\n        // title\n        if (forcedProperty.title) {\n          returnProperty.title = forcedProperty.title;\n        }\n        // metadataUrl\n        if (forcedProperty.metadataUrl) {\n          returnProperty.metadataUrl = forcedProperty.metadataUrl;\n        }\n        // metadataAbstract\n        if (forcedProperty.metadataAbstract) {\n          returnProperty.metadataAbstract = forcedProperty.metadataAbstract;\n        }\n      }\n    });\n    return returnProperty;\n  }\n\n  /// WMS\n\n  private prepareCatalogItemLayer(layer, idParent, layersQueryFormat, catalog) {\n    const configuredQueryFormat = this.retrieveLayerInfoFormat(\n      layer.Name,\n      layersQueryFormat\n    );\n\n    const legendOptions =\n      catalog.showLegend && layer.Style\n        ? this.capabilitiesService.getStyle(layer.Style)\n        : undefined;\n\n    const params = Object.assign({}, catalog.queryParams, {\n      LAYERS: layer.Name,\n      VERSION: catalog.version\n    } as WMSDataSourceOptionsParams);\n\n    const baseSourceOptions = {\n      type: 'wms',\n      url: catalog.url,\n      crossOrigin: catalog.setCrossOriginAnonymous ? 'anonymous' : undefined,\n      queryFormat: configuredQueryFormat,\n      queryHtmlTarget:\n        configuredQueryFormat === QueryFormat.HTML ||\n        configuredQueryFormat === QueryFormat.HTMLGML2\n          ? 'iframe'\n          : undefined,\n      optionsFromCapabilities: true\n    };\n\n    const sourceOptions = Object.assign(\n      {},\n      baseSourceOptions,\n      catalog.sourceOptions,\n      { params }\n    ) as WMSDataSourceOptions;\n\n    const propertiesToForce = this.computeForcedProperties(\n      layer.Name,\n      catalog.forcedProperties\n    );\n    let baseAbstract;\n    let extern = true;\n    if (layer.Abstract) {\n      baseAbstract = layer.Abstract;\n    } else if (!layer.Abstract && catalog.abstract) {\n      baseAbstract = catalog.abstract;\n    }\n    const layerOnlineResource =\n      layer?.DataURL && layer?.DataURL.length > 0\n        ? layer?.DataURL[0].OnlineResource\n        : undefined;\n\n    let metadataUrl =\n      propertiesToForce?.metadataUrl ||\n      propertiesToForce?.metadataUrlAll ||\n      layerOnlineResource;\n    let metadataAbstract =\n      propertiesToForce?.metadataAbstract ||\n      propertiesToForce?.metadataAbstractAll ||\n      baseAbstract;\n\n    if (\n      !propertiesToForce?.metadataUrl &&\n      !propertiesToForce?.metadataUrlAll &&\n      (propertiesToForce?.metadataAbstract ||\n        propertiesToForce?.metadataAbstractAll)\n    ) {\n      extern = false;\n    }\n    if (\n      propertiesToForce?.metadataAbstract &&\n      propertiesToForce?.metadataUrlAll\n    ) {\n      extern = false;\n    }\n\n    const layerPrepare = {\n      id: generateIdFromSourceOptions(sourceOptions),\n      type: CatalogItemType.Layer,\n      title: propertiesToForce?.title ? propertiesToForce.title : layer.Title,\n      address: idParent,\n      externalProvider: catalog.externalProvider || false,\n      options: {\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        metadata: {\n          url: metadataUrl,\n          extern,\n          abstract: metadataAbstract,\n          type: baseSourceOptions.type\n        },\n        legendOptions,\n        tooltip: { type: catalog.tooltipType },\n        sourceOptions\n      }\n    } as CatalogItem;\n\n    return ObjectUtils.removeUndefined(layerPrepare);\n  }\n\n  private prepareCatalogItemGroup(\n    itemListIn,\n    regexes,\n    idGroup,\n    layersQueryFormat,\n    catalog\n  ) {\n    const groupPrepare = {\n      id: idGroup,\n      type: CatalogItemType.Group,\n      title: itemListIn.Title,\n      address: catalog.id,\n      externalProvider: catalog.externalProvider || false,\n      sortDirection: catalog.sortDirection, // propagate sortDirection\n      items: itemListIn.Layer.reduce((items: CatalogItem[], layer: any) => {\n        if (layer.Layer !== undefined) {\n          // recursive, check next level\n          const idGroupItemNextLevel =\n            idGroup + `.group.${layer.Name || layer.Layer[0].Name}`;\n          const groupItem: CatalogItemGroup = this.prepareCatalogItemGroup(\n            layer,\n            regexes,\n            idGroupItemNextLevel,\n            layersQueryFormat,\n            catalog\n          );\n\n          items.push(groupItem);\n        } else {\n          if (this.testLayerRegexes(layer.Name, regexes) === false) {\n            return items;\n          }\n\n          const layerItem: CatalogItemLayer<ImageLayerOptions> =\n            this.prepareCatalogItemLayer(\n              layer,\n              idGroup,\n              layersQueryFormat,\n              catalog\n            );\n\n          items.push(layerItem);\n        }\n        return items;\n      }, [])\n    };\n    return groupPrepare;\n  }\n\n  private includeRecursiveItems(\n    catalog: Catalog,\n    itemListIn: any,\n    itemsPrepare: CatalogItem[],\n    loopLevel: number = 0\n  ) {\n    // Dig all levels until last level (layer object are not defined on last level)\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n    if (!itemListIn.Layer) {\n      return;\n    }\n\n    for (const item of itemListIn.Layer) {\n      if (item.Layer !== undefined) {\n        // recursive, check next level\n        this.includeRecursiveItems(catalog, item, itemsPrepare, loopLevel + 1);\n        continue;\n      }\n\n      const layersQueryFormat = this.findCatalogInfoFormat(catalog);\n\n      // group(with layers) and layer(without group) level 1\n      if (loopLevel !== 0) {\n        // TODO: Slice that into multiple methods\n        // Define object of group layer\n        const idGroupItem = `catalog.group.${itemListIn.Name || item.Name}`;\n        const groupItem = this.prepareCatalogItemGroup(\n          itemListIn,\n          regexes,\n          idGroupItem,\n          layersQueryFormat,\n          catalog\n        );\n\n        if (groupItem.items.length !== 0) {\n          itemsPrepare.push(groupItem);\n        }\n\n        // Break the group (don't add a group of layer for each of their layer!)\n        break;\n      } else {\n        // layer without group\n        if (this.testLayerRegexes(item.Name, regexes) !== false) {\n          const layerItem = this.prepareCatalogItemLayer(\n            item,\n            catalog.id,\n            layersQueryFormat,\n            catalog\n          );\n          itemsPrepare.push(layerItem);\n        }\n      }\n    }\n  }\n\n  /// WMTS\n\n  private getWMTSItems(\n    catalog,\n    capabilities: { [key: string]: any }\n  ): CatalogItemLayer[] {\n    if (!capabilities) {\n      return [];\n    }\n    const layers = capabilities.Contents.Layer;\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    if (\n      capabilities.ServiceIdentification &&\n      capabilities.ServiceIdentification.Abstract &&\n      capabilities.ServiceIdentification.Abstract.length\n    ) {\n      catalog.abstract = capabilities.ServiceIdentification.Abstract;\n    }\n\n    return layers\n      .map((layer: any) => {\n        const propertiesToForce = this.computeForcedProperties(\n          layer.Title,\n          catalog.forcedProperties\n        );\n        let extern = true;\n\n        let metadataUrl =\n          propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll;\n        let metadataAbstract =\n          propertiesToForce?.metadataAbstract ||\n          propertiesToForce?.metadataAbstractAll ||\n          catalog.abstract;\n\n        if (\n          !propertiesToForce?.metadataUrl &&\n          !propertiesToForce?.metadataUrlAll &&\n          (propertiesToForce?.metadataAbstract ||\n            propertiesToForce?.metadataAbstractAll)\n        ) {\n          extern = false;\n        }\n        if (\n          propertiesToForce?.metadataAbstract &&\n          propertiesToForce?.metadataUrlAll\n        ) {\n          extern = false;\n        }\n\n        if (this.testLayerRegexes(layer.Identifier, regexes) === false) {\n          return undefined;\n        }\n        const params = Object.assign({}, catalog.queryParams, {\n          version: '1.0.0'\n        });\n        const baseSourceOptions = {\n          type: 'wmts',\n          url: catalog.url,\n          crossOrigin: catalog.setCrossOriginAnonymous\n            ? 'anonymous'\n            : undefined,\n          layer: layer.Identifier,\n          matrixSet: catalog.matrixSet,\n          optionsFromCapabilities: true,\n          requestEncoding: catalog.requestEncoding || 'KVP',\n          style: 'default'\n        } as WMTSDataSourceOptions;\n        const sourceOptions = Object.assign(\n          {},\n          baseSourceOptions,\n          catalog.sourceOptions,\n          { params }\n        ) as WMTSDataSourceOptions;\n\n        return ObjectUtils.removeUndefined({\n          id: generateIdFromSourceOptions(sourceOptions),\n          type: CatalogItemType.Layer,\n          title: propertiesToForce?.title\n            ? propertiesToForce.title\n            : layer.Title,\n          address: catalog.id,\n          externalProvider: catalog.externalProvider,\n          options: {\n            sourceOptions,\n            metadata: {\n              url: metadataUrl,\n              extern,\n              abstract: metadataAbstract,\n              type: baseSourceOptions.type\n            }\n          }\n        } as CatalogItem);\n      })\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n  }\n\n  /// ERSI\n\n  private getArcGISRESTItems(catalog, capabilities): CatalogItemLayer[] {\n    if (!capabilities) {\n      return [];\n    }\n    const layers = !capabilities.layers\n      ? []\n      : capabilities.layers.filter(\n          (layer) => !layer.type || layer.type === 'Feature Layer'\n        );\n    if (!capabilities.layers) {\n      this.messageService.error(\n        'igo.geo.catalog.someUnavailable',\n        'igo.geo.catalog.unavailableTitle'\n      );\n    }\n\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    let abstract;\n    if (\n      capabilities.serviceDescription &&\n      capabilities.serviceDescription.length\n    ) {\n      const regex = /(<([^>]+)>)/gi;\n      abstract = capabilities.serviceDescription.replace(regex, '');\n    }\n\n    return layers\n      .map((layer: any) => {\n        const propertiesToForce = this.computeForcedProperties(\n          layer.name,\n          catalog.forcedProperties\n        );\n        let baseAbstract;\n        let extern = true;\n        if (layer.Abstract) {\n          baseAbstract = layer.Abstract;\n        } else if (!layer.Abstract && catalog.abstract) {\n          baseAbstract = catalog.abstract;\n        }\n\n        let metadataUrl =\n          propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll;\n        let metadataAbstract =\n          propertiesToForce?.metadataAbstract ||\n          propertiesToForce?.metadataAbstractAll ||\n          baseAbstract;\n\n        if (\n          !propertiesToForce?.metadataUrl &&\n          !propertiesToForce?.metadataUrlAll &&\n          (propertiesToForce?.metadataAbstract ||\n            propertiesToForce?.metadataAbstractAll)\n        ) {\n          extern = false;\n        }\n        if (\n          propertiesToForce?.metadataAbstract &&\n          propertiesToForce?.metadataUrlAll\n        ) {\n          extern = false;\n        }\n\n        if (this.testLayerRegexes(layer.id, regexes) === false) {\n          return undefined;\n        }\n        const baseSourceOptions = {\n          type: TypeCatalog[catalog.type],\n          url: catalog.url,\n          crossOrigin: catalog.setCrossOriginAnonymous\n            ? 'anonymous'\n            : undefined,\n          layer: layer.id as string,\n          queryable: true,\n          queryFormat: 'esrijson',\n          matrixSet: catalog.matrixSet,\n          optionsFromCapabilities: true,\n          style: 'default'\n        } as ArcGISRestDataSourceOptions;\n        const sourceOptions = Object.assign(\n          {},\n          baseSourceOptions,\n          catalog.sourceOptions\n        ) as ArcGISRestDataSourceOptions;\n        return ObjectUtils.removeUndefined({\n          id: generateIdFromSourceOptions(sourceOptions),\n          type: CatalogItemType.Layer,\n          title: propertiesToForce?.title\n            ? propertiesToForce.title\n            : layer.name,\n          externalProvider: catalog.externalProvider,\n          address: catalog.id,\n          options: {\n            sourceOptions,\n            minResolution: getResolutionFromScale(layer.maxScale),\n            maxResolution: getResolutionFromScale(layer.minScale),\n            metadata: {\n              url: metadataUrl,\n              extern,\n              abstract: metadataAbstract,\n              type: baseSourceOptions.type\n            }\n          }\n        } as CatalogItem);\n      })\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n  }\n\n  private testLayerRegexes(layerName: string, regexes: RegExp[]): boolean {\n    if (regexes.length === 0) {\n      return true;\n    }\n    return regexes.find((regex: RegExp) => regex.test(layerName)) !== undefined;\n  }\n\n  private retrieveLayerInfoFormat(\n    layerNameFromCatalog: string,\n    layersQueryFormat: { layer: string; queryFormat: QueryFormat }[]\n  ): QueryFormat {\n    const currentLayerInfoFormat = layersQueryFormat.find(\n      (f) => f.layer === layerNameFromCatalog\n    );\n    const baseInfoFormat = layersQueryFormat.find((f) => f.layer === '*');\n    let queryFormat: QueryFormat;\n    if (currentLayerInfoFormat) {\n      queryFormat = currentLayerInfoFormat.queryFormat;\n    } else if (baseInfoFormat) {\n      queryFormat = baseInfoFormat.queryFormat;\n    }\n    return queryFormat;\n  }\n\n  private findCatalogInfoFormat(\n    catalog: Catalog\n  ): { layer: string; queryFormat: QueryFormat }[] {\n    const layersQueryFormat: { layer: string; queryFormat: QueryFormat }[] = [];\n    if (!catalog.queryFormat) {\n      return layersQueryFormat;\n    }\n    Object.keys(catalog.queryFormat).forEach((configuredInfoFormat) => {\n      if (catalog.queryFormat[configuredInfoFormat] instanceof Array) {\n        catalog.queryFormat[configuredInfoFormat].forEach((layerName) => {\n          if (\n            !layersQueryFormat.find((specific) => specific.layer === layerName)\n          ) {\n            layersQueryFormat.push({\n              layer: layerName,\n              queryFormat: configuredInfoFormat as QueryFormat\n            });\n          }\n        });\n      } else {\n        if (\n          !layersQueryFormat.find(\n            (specific) =>\n              specific.layer === catalog.queryFormat[configuredInfoFormat]\n          )\n        ) {\n          layersQueryFormat.push({\n            layer: catalog.queryFormat[configuredInfoFormat],\n            queryFormat: configuredInfoFormat as QueryFormat\n          });\n        }\n      }\n    });\n    return layersQueryFormat;\n  }\n}\n\nclass CatalogFactory {\n  public static createInstanceCatalog(\n    options: Catalog,\n    catalogService: CatalogService\n  ): Catalog {\n    let catalog: Catalog;\n    if (options.hasOwnProperty('composite')) {\n      catalog = new CompositeCatalog(options, (catalog: Catalog) =>\n        catalogService.loadCatalogCompositeLayerItems(catalog)\n      );\n    } else if (options.type === TypeCatalog[TypeCatalog.baselayers]) {\n      catalog = new BaselayersCatalog(options, (catalog: Catalog) =>\n        catalogService.loadCatalogBaseLayerItems(catalog)\n      );\n    } else if (options.type === TypeCatalog[TypeCatalog.arcgisrest]) {\n      catalog = new ArcGISRestCatalog(options, (catalog: Catalog) =>\n        catalogService.loadCatalogArcGISRestItems(catalog)\n      );\n    } else if (options.type === TypeCatalog[TypeCatalog.tilearcgisrest]) {\n      catalog = new TileOrImageArcGISRestCatalog(\n        options,\n        (catalog: Catalog) =>\n          catalogService.loadCatalogArcGISRestItems(catalog),\n        TypeCatalog.tilearcgisrest\n      );\n    } else if (options.type === TypeCatalog[TypeCatalog.imagearcgisrest]) {\n      catalog = new TileOrImageArcGISRestCatalog(\n        options,\n        (catalog: Catalog) =>\n          catalogService.loadCatalogArcGISRestItems(catalog),\n        TypeCatalog.imagearcgisrest\n      );\n    } else if (options.type === TypeCatalog[TypeCatalog.wmts]) {\n      catalog = new WMTSCatalog(options, (catalog: Catalog) =>\n        catalogService.loadCatalogWMTSLayerItems(catalog)\n      );\n    } else {\n      catalog = new WMSCatalog(options, (catalog: Catalog) =>\n        catalogService.loadCatalogWMSLayerItems(catalog)\n      );\n    }\n\n    return catalog;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <igo-catalog-browser-group\n        [catalog]=\"catalog\"\n        [group]=\"item\"\n        [map]=\"map\"\n        [state]=\"store.state\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [collapsed]=\"store.count === 1 ? false : true\"\n        [toggleCollapsed]=\"toggleCollapsedGroup\"\n        (addedChange)=\"onGroupAddedChange($event)\"\n        (layerAddedChange)=\"onLayerAddedChange($event)\"\n      >\n      </igo-catalog-browser-group>\n    </ng-container>\n\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"item\"\n        [map]=\"map\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"store.state.get(item).added\"\n        (addedChange)=\"onLayerAddedChange($event)\"\n      >\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { zip, BehaviorSubject } from 'rxjs';\n\nimport { EntityStore, EntityStoreWatcher } from '@igo2/common';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { IgoMap } from '../../map/shared';\n\nimport {\n  Catalog,\n  CatalogItem,\n  CatalogItemLayer,\n  CatalogItemGroup,\n  CatalogItemState,\n  CatalogItemType,\n  AddedChangeEmitter,\n  AddedChangeGroupEmitter\n} from '../shared';\n\n/**\n * Component to browse a catalog's groups and layers and display them on a map.\n */\n@Component({\n  selector: 'igo-catalog-browser',\n  templateUrl: './catalog-browser.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserComponent implements OnInit, OnDestroy {\n  /**\n   * Catalog items store watcher\n   */\n  private watcher: EntityStoreWatcher<CatalogItem>;\n\n  // private resolution$$: Subscription;\n\n  get resolution$(): BehaviorSubject<number> {\n    return this.map.viewController.resolution$;\n  }\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Store holding the catalog's items\n   */\n  @Input() store: EntityStore<CatalogItem, CatalogItemState>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Whether a group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsedGroup: boolean = true;\n\n  constructor(\n    private layerService: LayerService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    const currentItems = this.map.layers.map((layer: Layer) => {\n      return {\n        id: layer.options.source.id,\n        title: layer.title,\n        type: CatalogItemType.Layer\n      };\n    });\n    this.store.state.updateMany(currentItems, { added: true }, true);\n    if (this.catalog && this.catalog.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.catalog.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n      });\n    }\n\n    const catalogShowLegend = this.catalog ? this.catalog.showLegend : false;\n    this.catalogAllowLegend = catalogShowLegend\n      ? catalogShowLegend\n      : this.catalogAllowLegend;\n\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n  }\n\n  ngOnDestroy() {\n    this.watcher.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * When a layer is added or removed, add or remove it from the map\n   * @internal\n   * @param event Layer added event\n   */\n  onLayerAddedChange(event: AddedChangeEmitter) {\n    const layer = event.layer;\n    this.store.state.update(layer, { added: event.added }, false);\n    event.added\n      ? this.addLayerToMap(layer, event)\n      : this.removeLayerFromMap(layer);\n  }\n\n  /**\n   * When a froup is added or removed, add or remove it from the map\n   * @internal\n   * @param event Group added event\n   */\n  onGroupAddedChange(event: AddedChangeGroupEmitter) {\n    const group = event.group;\n    this.store.state.update(group, { added: event.added }, false);\n    event.added\n      ? this.addGroupToMap(group, event)\n      : this.removeGroupFromMap(group);\n  }\n\n  /**\n   * Add layer to map\n   * @param layer Catalog layer\n   */\n  private addLayerToMap(layer: CatalogItemLayer, event?: AddedChangeEmitter) {\n    this.addLayersToMap([layer], event);\n  }\n\n  /**\n   * Remove layer from map\n   * @param layer Catalog layer\n   */\n  private removeLayerFromMap(layer: CatalogItemLayer) {\n    this.removeLayersFromMap([layer]);\n  }\n\n  /**\n   * Add multiple layers to map\n   * @param layers Catalog layers\n   */\n  private addLayersToMap(\n    layers: CatalogItemLayer[],\n    event: AddedChangeEmitter | AddedChangeGroupEmitter\n  ) {\n    const layers$ = layers.map((layer: CatalogItemLayer) => {\n      if (!layer.options.sourceOptions.optionsFromApi) {\n        layer.options.sourceOptions.optionsFromApi = true;\n      }\n      if (this.catalog.profils?.length) {\n        layer.options.security = { profils: this.catalog.profils };\n      }\n      return this.layerService.createAsyncLayer(layer.options);\n    });\n    zip(...layers$).subscribe((layers: Layer[]) => {\n      if (event.event.type === 'click' && event.added) {\n        this.map.layersAddedByClick$.next(layers);\n      }\n      this.store.state.updateMany(layers, { added: true });\n      this.map.addLayers(layers);\n    });\n  }\n\n  /**\n   * Remove multiple layers from map\n   * @param layers Catalog layers\n   */\n  private removeLayersFromMap(layers: CatalogItemLayer[]) {\n    layers.forEach((layer: CatalogItemLayer) => {\n      this.store.state.update(layer, { added: false });\n      if (layer.options.baseLayer === true) {\n        const currLayer = this.map.getLayerById(layer.options.id);\n        if (currLayer !== undefined) {\n          this.map.removeLayer(currLayer);\n        }\n      } else {\n        const currLayer = this.map.getLayerById(layer.id);\n        if (currLayer !== undefined) {\n          this.map.removeLayer(currLayer);\n        }\n      }\n    });\n  }\n\n  /**\n   * Sort the layers by title. asc or desc.\n   * @internal\n   */\n  private sortCatalogItemsByTitle(items: CatalogItem[], direction) {\n    const returnItem = items.sort((a, b) => {\n      const titleA = a.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      const titleB = b.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n\n      if (titleA < titleB) {\n        return -1;\n      }\n      if (titleA > titleB) {\n        return 1;\n      }\n      return 0;\n    });\n    switch (direction) {\n      case 'asc':\n        return returnItem;\n      case 'desc':\n        return returnItem.reverse();\n      default:\n        return items;\n    }\n  }\n\n  /**\n   * Add all the layers of a group to map\n   * @param group Catalog group\n   */\n  private addGroupToMap(\n    group: CatalogItemGroup,\n    event: AddedChangeGroupEmitter\n  ) {\n    let layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === false;\n    });\n    if (group.sortDirection !== undefined) {\n      layers = this.sortCatalogItemsByTitle(layers, group.sortDirection);\n    }\n    this.addLayersToMap(layers.reverse() as CatalogItemLayer[], event);\n  }\n\n  /**\n   * Remove all the layers of a group from map\n   * @param group Catalog group\n   */\n  private removeGroupFromMap(group: CatalogItemGroup) {\n    const layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === true;\n    });\n    this.removeLayersFromMap(layers as CatalogItemLayer[]);\n  }\n}\n","import { Directive, Input, ElementRef, OnInit } from '@angular/core';\nimport { MatIconRegistry } from '@angular/material/icon';\n\n/**\n * This directive allow to add an icon inside a matBadge.\n * A value must be set into the matBadge directive ex: matBadge=\"icon\".\n * The badge content will be overrided by this current directive.\n */\n@Directive({\n  selector: '[igoMatBadgeIcon]'\n})\nexport class IgoBadgeIconDirective implements OnInit {\n  @Input()\n  set igoMatBadgeIcon(value: string) {\n    this.matIconRegistry.getNamedSvgIcon(value).subscribe((svgObj) => {\n      this.svg = svgObj;\n      this.updateSvg();\n    });\n  }\n  private svg: SVGElement;\n\n  @Input()\n  set matBadgeHidden(value: boolean) {\n    this.hidden = value;\n    this.updateHidden();\n  }\n  private hidden = false;\n\n  @Input()\n  set matBadgeDisabled(value: boolean) {\n    this.disabled = value;\n    this.updateDisabled();\n  }\n  private disabled = false;\n\n  @Input()\n  set igoMatBadgeInverseColor(value: boolean) {\n    this.inverseColor = value;\n    this.updateColor();\n  }\n  private inverseColor = false;\n\n  @Input()\n  set igoMatBadgeInheritColor(value: boolean) {\n    this.inheritColor = value;\n    this.updateColor();\n  }\n  private inheritColor = false;\n\n  @Input()\n  set igoMatBadgeColor(value: string) {\n    this.color = value;\n    this.updateColor();\n  }\n  private color;\n\n  @Input()\n  set igoMatBadgeBackgroundColor(value: string) {\n    this.backgroundColor = value;\n    this.updateColor();\n  }\n  private backgroundColor;\n\n  get badge() {\n    return this.el.nativeElement.querySelector('.mat-badge-content');\n  }\n\n  private originalColor: string;\n\n  constructor(\n    private el: ElementRef,\n    private matIconRegistry: MatIconRegistry\n  ) {}\n\n  ngOnInit() {\n    this.badge.style.alignItems = 'center';\n    this.badge.style.justifyContent = 'center';\n\n    this.updateHidden();\n    this.updateColor();\n    this.updateSvg();\n  }\n\n  private updateSvg() {\n    if (!this.badge) {\n      return;\n    }\n    this.badge.innerHTML = '';\n    if (this.svg) {\n      this.badge.appendChild(this.svg);\n    }\n  }\n  private updateColor() {\n    if (!this.badge) {\n      return;\n    }\n\n    if (this.color || this.backgroundColor) {\n      this.badge.style.color = this.color ? this.color : '';\n      this.badge.style.background = this.backgroundColor\n        ? this.backgroundColor\n        : '';\n    } else if (this.inheritColor) {\n      if (this.inverseColor) {\n        this.badge.style.color = 'currentColor';\n        this.badge.style.background = 'none';\n      } else {\n        this.badge.style.color = '';\n        this.badge.style.background = 'currentColor';\n      }\n    } else if (!this.inheritColor) {\n      if (this.inverseColor) {\n        this.badge.style.color = window\n          .getComputedStyle(this.badge, null)\n          .getPropertyValue('background-color');\n        this.badge.style.background = 'none';\n      } else {\n        this.badge.style.color = '';\n        this.badge.style.background = '';\n      }\n    }\n    this.originalColor = this.badge.style.color;\n    this.updateDisabled();\n  }\n\n  private updateHidden() {\n    if (!this.badge) {\n      return;\n    }\n    this.badge.style.display = this.hidden ? 'none' : 'flex';\n  }\n\n  private updateDisabled() {\n    if (!this.badge || !this.inverseColor) {\n      return;\n    }\n    if (this.disabled) {\n      this.originalColor = this.badge.style.color;\n      this.badge.style.color = '#b9b9b9';\n    } else {\n      this.badge.style.color = this.originalColor;\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { MetadataOptions } from './metadata.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MetadataService {\n  constructor() {}\n\n  open(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      window.open(metadata.url, '_blank');\n    }\n  }\n}\n","<button\n  *ngIf=\"\n    (options && options.metadata && options.metadata.url) ||\n    (options && options.metadata && options.metadata.abstract)\n  \"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.metadata.show' | translate\"\n  [color]=\"color\"\n  (click)=\"openMetadata(options.metadata)\"\n>\n  <mat-icon svgIcon=\"information-outline\"></mat-icon>\n</button>\n","<h2 mat-dialog-title>{{ data.layerTitle }}</h2>\n<button class=\"close-button\" mat-button mat-dialog-close>X</button>\n<mat-dialog-content *ngIf=\"data.type !== 'arcgisrest'\" class=\"mat-typography\">\n  <h3>{{ data.abstract }}</h3>\n</mat-dialog-content>\n<mat-dialog-content *ngIf=\"data.type === 'arcgisrest'\" class=\"mat-typography\">\n  <h3 [innerHTML]=\"data.abstract\"></h3>\n</mat-dialog-content>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  Inject,\n  ViewEncapsulation\n} from '@angular/core';\nimport { MatDialog, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport {\n  MetadataOptions,\n  MetadataLayerOptions\n} from '../shared/metadata.interface';\nimport { MetadataService } from '../shared/metadata.service';\n\n@Component({\n  selector: 'igo-metadata-button',\n  templateUrl: './metadata-button.component.html',\n  styleUrls: ['./metadata-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MetadataButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(\n    private metadataService: MetadataService,\n    private dialog: MatDialog\n  ) {}\n\n  openMetadata(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      if (!metadata.url && metadata.abstract) {\n        this.dialog.open(MetadataAbstractComponent, {\n          data: {\n            layerTitle: this.layer.title,\n            abstract: metadata.abstract,\n            type: metadata.type\n          }\n        });\n      } else if (metadata.url) {\n        this.metadataService.open(metadata);\n      }\n    } else if (!metadata.extern && metadata.abstract) {\n      this.dialog.open(MetadataAbstractComponent, {\n        data: {\n          layerTitle: this.layer.title,\n          abstract: metadata.abstract,\n          type: metadata.type\n        }\n      });\n    }\n  }\n\n  get options(): MetadataLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n}\n\n@Component({\n  selector: 'igo-metadata-abstract',\n  templateUrl: './metadata-abstract.component.html',\n  styleUrls: ['./metadata-abstract.component.scss'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class MetadataAbstractComponent {\n  constructor(@Inject(MAT_DIALOG_DATA) public data: MetadataOptions) {}\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  HostListener,\n  ElementRef,\n  Renderer2\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoCollapse]'\n})\nexport class CollapseDirective {\n  @Input()\n  get target() {\n    return this._target;\n  }\n  set target(value: Element) {\n    this._target = value;\n  }\n  private _target: Element;\n\n  @Input()\n  get collapsed(): boolean {\n    return this._collapsed;\n  }\n  set collapsed(collapsed: boolean) {\n    collapsed ? this.collapseTarget() : this.expandTarget();\n    this._collapsed = collapsed;\n    this.toggle.emit(collapsed);\n  }\n  private _collapsed = false;\n\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\n\n  @HostListener('click')\n  click() {\n    this.collapsed = !this.collapsed;\n  }\n\n  constructor(\n    private renderer: Renderer2,\n    private el: ElementRef\n  ) {}\n\n  private collapseTarget() {\n    this.renderer.addClass(this.target, 'igo-collapsed');\n    this.renderer.addClass(this.el.nativeElement, 'collapsed');\n  }\n\n  private expandTarget() {\n    this.renderer.removeClass(this.target, 'igo-collapsed');\n    this.renderer.removeClass(this.el.nativeElement, 'collapsed');\n  }\n}\n","<ng-container *ngIf=\"legendItems$ | async as items\">\n  <ng-container *ngIf=\"items.length; else noItems\">\n    <ng-container *ngFor=\"let item of items.slice().reverse()\" #renderedLegends>\n      <div *ngIf=\"getLegend; else noItems\">\n        <mat-list-item *ngIf=\"item.title\">\n          <mat-icon\n            id=\"legend-toggle\"\n            class=\"igo-chevron\"\n            matListItemIcon\n            igoCollapse\n            [target]=\"legend\"\n            [collapsed]=\"item.collapsed\"\n            (toggle)=\"toggleLegendItem($event, item)\"\n            svgIcon=\"chevron-up\"\n          >\n          </mat-icon>\n          <span matListItemTitle>{{ computeItemTitle(item) | async }} </span>\n        </mat-list-item>\n        <div\n          #legend\n          class=\"igo-layer-legend\"\n          [ngClass]=\"{ 'with-title': item.title }\"\n        >\n          <div *ngIf=\"currentStyle !== undefined\">\n            <mat-form-field>\n              <mat-select\n                tooltip-position=\"below\"\n                matTooltipShowDelay=\"500\"\n                [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n                [(ngModel)]=\"currentStyle\"\n                (selectionChange)=\"onChangeStyle()\"\n              >\n                <mat-option *ngFor=\"let style of styles\" [value]=\"style.name\">{{\n                  style.title\n                }}</mat-option>\n              </mat-select>\n            </mat-form-field>\n          </div>\n          <div *ngIf=\"!item.collapsed\">\n            <div *ngIf=\"item.url\">\n              <img\n                igoImageError\n                *ngIf=\"item.imgGraphValue\"\n                hideError=\"true\"\n                #renderedLegend\n                id=\"{{ item.title }}\"\n                (load)=\"onLoadImage(item.title)\"\n                [src]=\"item.imgGraphValue\"\n                alt=\"{{ 'igo.geo.layer.legend.loadingLegendText' | translate }}\"\n              />\n              <small *ngIf=\"imagesHeight[item.title] < 16\">\n                {{ 'igo.geo.layer.legend.noLegendScale' | translate }}\n              </small>\n            </div>\n            <div\n              [ngStyle]=\"item.style\"\n              [innerHTML]=\"item.html | sanitizeHtml\"\n              *ngIf=\"item.html\"\n            ></div>\n          </div>\n        </div>\n      </div>\n    </ng-container>\n  </ng-container>\n\n  <ng-template #noItems>\n    <small>\n      {{ 'igo.geo.layer.legend.noLegendText' | translate }}\n    </small>\n  </ng-template>\n</ng-container>\n","import { HttpClient } from '@angular/common/http';\nimport {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  ViewChildren,\n  ElementRef,\n  ChangeDetectorRef\n} from '@angular/core';\nimport type { QueryList } from '@angular/core';\n\nimport { Subscription, BehaviorSubject, of, Observable } from 'rxjs';\n\nimport { Legend } from '../../datasource/shared/datasources/datasource.interface';\nimport { Layer } from '../shared/layers';\nimport {\n  LegendMapViewOptions,\n  ItemStyleOptions\n} from '../shared/layers/legend.interface';\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { catchError, map } from 'rxjs/operators';\nimport { LanguageService, ConfigService } from '@igo2/core';\nimport { WMSDataSource, WMSDataSourceOptions } from '../../datasource';\nimport { SecureImagePipe } from '@igo2/common';\n\n@Component({\n  selector: 'igo-layer-legend',\n  templateUrl: './layer-legend.component.html',\n  styleUrls: ['./layer-legend.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendComponent implements OnInit, OnDestroy {\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  /**\n   * Observable of the legend items\n   */\n  legendItems$: BehaviorSubject<Legend[]> = new BehaviorSubject([]);\n\n  /**\n   * Subscription to the map's resolution\n   */\n  private state$$: Subscription;\n\n  /**\n   * The available styles\n   */\n  public styles;\n\n  /**\n   * The style used to make the legend\n   */\n  public currentStyle;\n\n  /**\n   * The scale used to make the legend\n   */\n  private scale: number = undefined;\n\n  /**\n   * The extent used to make the legend\n   */\n  private view: LegendMapViewOptions = undefined;\n  /**\n   * Get list of images display\n   */\n  @ViewChildren('renderedLegend') renderedLegends: QueryList<ElementRef>;\n\n  /**\n   * List of size of images displayed\n   */\n  public imagesHeight: { [srcKey: string]: number } = {};\n\n  /**\n   * Layer\n   */\n  @Input() layer: Layer;\n\n  /**\n   * if getLegendGraphic is authorized\n   */\n  public getLegend = true;\n\n  /**\n   * activeLegend\n   */\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private languageService: LanguageService,\n    private configService: ConfigService,\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * On init, subscribe to the map's resolution and update the legend accordingly\n   */\n  ngOnInit() {\n    let lastlLegend = this.layer.legend;\n    this.styles = this.listStyles();\n    const sourceOptions = this.layer.options.source.options as any;\n    if (sourceOptions && sourceOptions.params && sourceOptions.params.STYLES) {\n      // if a styles is provided into the layers wms params\n      this.currentStyle = this.styles.find(\n        (style) => style.name === sourceOptions.params.STYLES\n      ).name;\n    } else if (!lastlLegend) {\n      // if no legend is manually provided\n      if (this.styles && this.styles.length > 1) {\n        this.currentStyle = this.styles[0].name;\n      }\n    } else if (this.styles && this.styles.length > 1) {\n      this.currentStyle = lastlLegend[0].currentStyle;\n    }\n    if (\n      typeof this.layer.options.legendOptions !== 'undefined' &&\n      this.layer.options.legendOptions.display === false\n    ) {\n      lastlLegend = [];\n    } else {\n      lastlLegend = this.layer.dataSource.getLegend(\n        this.currentStyle,\n        this.view\n      );\n    }\n\n    if (\n      this.updateLegendOnResolutionChange ||\n      (sourceOptions as WMSDataSourceOptions).contentDependentLegend\n    ) {\n      const state$ = this.layer.map.viewController.state$;\n      this.state$$ = state$.subscribe(() => this.onViewControllerStateChange());\n    } else if (lastlLegend && lastlLegend.length !== 0) {\n      this.legendItems$.next(lastlLegend);\n      for (const legend of lastlLegend) {\n        this.getLegendGraphic(legend);\n      }\n    }\n  }\n\n  /**\n   * On destroy, unsubscribe to the map's view state\n   */\n  ngOnDestroy() {\n    if (this.state$$ !== undefined) {\n      this.state$$.unsubscribe();\n    }\n  }\n\n  getLegendGraphic(item: Legend) {\n    if (item.url) {\n      const secureIMG = new SecureImagePipe(this.http, this.configService);\n      secureIMG\n        .transform(item.url)\n        .pipe(\n          catchError((err) => {\n            if (err.error) {\n              err.error.caught = true;\n              this.getLegend = false;\n              this.cdRef.detectChanges();\n              return err;\n            }\n          })\n        )\n        .subscribe((obsLegGraph) => {\n          const idx = this.legendItems$.value.findIndex(\n            (leg) => leg.title === item.title\n          );\n          const legendGraph = obsLegGraph as string;\n          this.legendItems$.value[idx].imgGraphValue = legendGraph;\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  toggleLegendItem(collapsed: boolean, item: Legend) {\n    item.collapsed = collapsed;\n  }\n\n  private transfertToggleLegendItem(newLegends: Legend[]): Legend[] {\n    const outLegends: Legend[] = newLegends;\n    const lastLegends = this.layer.legend;\n    for (let i = 0; i < lastLegends.length; i++) {\n      outLegends[i].collapsed = lastLegends[i].collapsed;\n    }\n    return outLegends;\n  }\n\n  computeItemTitle(layerLegend): Observable<string> {\n    const layerOptions = this.layer.dataSource.options as any;\n    if (layerOptions.type !== 'wms') {\n      return of(layerLegend.title);\n    }\n\n    const layers = layerOptions.params.LAYERS.split(',');\n    const localLayerOptions = JSON.parse(JSON.stringify(layerOptions)); // to avoid to alter the original options.\n    localLayerOptions.params.LAYERS = layers.find(\n      (layer) => layer === layerLegend.title\n    );\n    return this.capabilitiesService.getWMSOptions(localLayerOptions).pipe(\n      map((wmsDataSourceOptions) => {\n        return wmsDataSourceOptions._layerOptionsFromSource.title;\n      })\n    );\n  }\n\n  /**\n   * On resolution change, compute the effective scale level and update the\n   * legend accordingly.\n   * @param resolution Map resolution\n   */\n  private onViewControllerStateChange() {\n    this.view = {\n      resolution: this.layer.map.viewController.getResolution(),\n      extent: this.layer.map.viewController.getExtent(),\n      projection: this.layer.map.viewController.getOlProjection().getCode(),\n      scale: this.layer.map.viewController.getScale(),\n      size: this.layer.map.ol.getSize()\n    } as LegendMapViewOptions;\n    this.updateLegend();\n  }\n\n  /**\n   * Update the legend with scale level and style define\n   */\n  private updateLegend() {\n    let legendItems = this.layer.dataSource.getLegend(\n      this.currentStyle,\n      this.view\n    );\n    if (this.layer.legend && this.layer.legend.length > 1) {\n      legendItems = this.transfertToggleLegendItem(legendItems);\n    }\n    this.layer.legend = legendItems;\n\n    if (legendItems.length === 0 && this.legendItems$.value.length === 0) {\n      return;\n    }\n    this.legendItems$.next(legendItems);\n    for (const legend of this.legendItems$.value) {\n      this.getLegendGraphic(legend);\n    }\n  }\n\n  private listStyles() {\n    const layerOptions = this.layer.options;\n    if (layerOptions && layerOptions.legendOptions) {\n      const translate = this.languageService.translate;\n      const title = translate.instant('igo.geo.layer.legend.default');\n      let stylesAvailable = [{ name: '', title } as ItemStyleOptions];\n      if (layerOptions.legendOptions.stylesAvailable) {\n        stylesAvailable = stylesAvailable.concat(\n          layerOptions.legendOptions.stylesAvailable.filter(\n            (sA) =>\n              sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !==\n                'default' &&\n              sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !==\n                'defaut'\n          )\n        );\n      }\n      stylesAvailable\n        .filter((sa) => !sa.title)\n        .map((sa) => (sa.title = sa.name));\n      stylesAvailable.map(\n        (s) =>\n          (s.title =\n            s.title.charAt(0).toUpperCase() +\n            s.title.slice(1).replace(/_/g, ' '))\n      );\n      return stylesAvailable;\n    }\n    return;\n  }\n\n  onChangeStyle() {\n    this.updateLegend();\n    let STYLES = '';\n    if (this.layer.dataSource instanceof WMSDataSource) {\n      this.layer.dataSource.ol\n        .getParams()\n        .LAYERS.split(',')\n        .map((layer) => (STYLES += this.currentStyle + ','));\n      STYLES = STYLES.slice(0, -1);\n      this.layer.dataSource.ol.updateParams({ STYLES });\n    }\n  }\n\n  onLoadImage(id: string) {\n    let elemRef: HTMLImageElement;\n    if (this.renderedLegends.length === 1) {\n      elemRef = this.renderedLegends.first.nativeElement as HTMLImageElement;\n    } else {\n      elemRef = this.renderedLegends.find(\n        (renderedLegend) => renderedLegend.nativeElement.id === id\n      ).nativeElement as HTMLImageElement;\n    }\n    this.imagesHeight[id] = elemRef.height;\n  }\n}\n","<mat-list-item>\n  <mat-icon *ngIf=\"haveGroup()\" matListItemIcon svgIcon=\"blank\"></mat-icon>\n  <span\n    matListItemTitle\n    matTooltipShowDelay=\"500\"\n    [ngClass]=\"catalogAllowLegend ? 'igo-cataloglayer-title' : ''\"\n    (click)=\"askForLegend($event)\"\n    [matTooltip]=\"computeTitleTooltip()\"\n  >\n    {{ title }}\n  </span>\n\n  <div matListItemMeta>\n    <button *ngIf=\"layer.externalProvider\" disabled=\"true\" mat-icon-button>\n      <mat-icon\n        class=\"igo-cataloglayer-external-icon\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.catalog.externalProvider.layer' | translate\"\n        color=\"primary\"\n        (click)=\"$event.stopPropagation()\"\n        svgIcon=\"earth-arrow-right\"\n      >\n      </mat-icon>\n    </button>\n    <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n\n    <button\n      (mouseenter)=\"onMouseEvent($event)\"\n      (mouseleave)=\"onMouseEvent($event)\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"computeTooltip() | translate\"\n      [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n      (click)=\"onToggleClick($event)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        matBadge=\"icon\"\n        [igoMatBadgeIcon]=\"getBadgeIcon()\"\n        igoMatBadgeColor=\"rgba(0,0,0,0.87)\"\n        igoMatBadgeBackgroundColor=\"none\"\n        igoMatBadgeInverseColor=\"true\"\n        [matBadgeHidden]=\"\n          ((inRange$ | async) && (isVisible$ | async) === true) ||\n          ((inRange$ | async) && !added) ||\n          ((inRange$ | async) && (isPreview$ | async))\n        \"\n        [matBadgeDisabled]=\"(inRange$ | async) === false\"\n        matBadgeSize=\"small\"\n        matBadgePosition=\"after\"\n        [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\"\n      >\n      </mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n\n<div #legend class=\"igo-cataloglayer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"\n      (layerLegendShown$ | async) && (igoLayer$ | async) && catalogAllowLegend\n    \"\n    [layer]=\"igoLayer$ | async\"\n  >\n  </igo-layer-legend>\n</div>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\n\nimport { AddedChangeEmitter, CatalogItemLayer } from '../shared';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { first } from 'rxjs/operators';\nimport { Layer, TooltipType } from '../../layer/shared/layers';\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { IgoMap } from '../../map/shared';\n\n/**\n * Catalog browser layer item\n */\n@Component({\n  selector: 'igo-catalog-browser-layer',\n  templateUrl: './catalog-browser-layer.component.html',\n  styleUrls: ['./catalog-browser-layer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserLayerComponent implements OnInit, OnDestroy {\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public isVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private isPreview$$: Subscription;\n  private resolution$$: Subscription;\n  private layers$$: Subscription;\n  private lastTimeoutRequest;\n\n  public layerLegendShown$: BehaviorSubject<boolean> = new BehaviorSubject(\n    false\n  );\n  public igoLayer$ = new BehaviorSubject<Layer>(undefined);\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog layer\n   */\n  @Input() layer: CatalogItemLayer;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added = false;\n\n  /**\n   * Event emitted when the add/remove button is clicked\n   */\n  @Output() addedChange = new EventEmitter<AddedChangeEmitter>();\n\n  @Output() addedLayerIsPreview = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.layer);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.layer) || 'layers';\n  }\n\n  constructor(private layerService: LayerService) {}\n\n  ngOnInit(): void {\n    this.isPreview$$ = this.isPreview$.subscribe((value) =>\n      this.addedLayerIsPreview.emit(value)\n    );\n\n    this.layers$$ = this.map.layers$.subscribe(() => {\n      this.isVisible();\n    });\n\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(\n      (resolution) => {\n        this.isInResolutionsRange(resolution);\n        this.isVisible();\n      }\n    );\n  }\n\n  ngOnDestroy() {\n    this.isPreview$$.unsubscribe();\n    this.resolution$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  computeTitleTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return getEntityTitle(this.layer);\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  askForLegend(event) {\n    this.layerLegendShown$.next(!this.layerLegendShown$.value);\n    this.layerService\n      .createAsyncLayer(this.layer.options)\n      .pipe(first())\n      .subscribe((layer) => this.igoLayer$.next(layer));\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    if (event.type === 'mouseenter' && this.mouseInsideAdd) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove(event);\n          } else {\n            this.add(event);\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add(event);\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove(event);\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add(event: Event) {\n    if (!this.added) {\n      this.added = true;\n      this.addedChange.emit({ added: true, layer: this.layer, event });\n    }\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private remove(event: Event) {\n    if (this.added) {\n      this.added = false;\n      this.addedChange.emit({ added: false, layer: this.layer, event });\n    }\n  }\n\n  haveGroup(): boolean {\n    return !(!this.layer.address || this.layer.address.split('.').length === 1);\n  }\n\n  isInResolutionsRange(resolution: number) {\n    const minResolution =\n      !this.layer.options.minResolution ||\n      Number.isNaN(this.layer.options.minResolution)\n        ? 0\n        : this.layer.options.minResolution;\n    const maxResolution =\n      !this.layer.options.maxResolution ||\n      Number.isNaN(this.layer.options.maxResolution)\n        ? Infinity\n        : this.layer.options.maxResolution;\n    this.inRange$.next(\n      resolution >= minResolution && resolution <= maxResolution\n    );\n  }\n\n  isVisible() {\n    if (this.layer?.id) {\n      const oLayer = this.map.getLayerById(this.layer?.id);\n      oLayer\n        ? this.isVisible$.next(oLayer.visible)\n        : this.isVisible$.next(false);\n    }\n  }\n\n  getBadgeIcon() {\n    if (this.inRange$.getValue()) {\n      return this.isVisible$.getValue() ? '' : 'eye-off';\n    } else {\n      return 'eye-off';\n    }\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      if (this.isPreview$.value) {\n        return 'igo.geo.catalog.layer.addToMap';\n      } else if (this.inRange$.value) {\n        return this.isVisible$.value\n          ? 'igo.geo.catalog.layer.removeFromMap'\n          : 'igo.geo.catalog.layer.removeFromMapNotVisible';\n      } else {\n        return 'igo.geo.catalog.layer.removeFromMapOutRange';\n      }\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  ElementRef,\n  Renderer2,\n  HostListener,\n  EventEmitter\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoListItem]'\n})\nexport class ListItemDirective {\n  static focusedCls = 'igo-list-item-focused';\n  static selectedCls = 'igo-list-item-selected';\n  static disabledCls = 'igo-list-item-disabled';\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  @Input()\n  get focused() {\n    return this._focused;\n  }\n  set focused(value: boolean) {\n    if (value === this._focused) {\n      return;\n    }\n    if (this.disabled) {\n      return;\n    }\n\n    value ? this.beforeFocus.emit(this) : this.beforeUnfocus.emit(this);\n\n    this._focused = value;\n    if (this.selected !== true) {\n      this.toggleFocusedClass();\n    }\n\n    value ? this.focus.emit(this) : this.unfocus.emit(this);\n  }\n  private _focused = false;\n\n  @Input()\n  get selected() {\n    return this._selected;\n  }\n  set selected(value: boolean) {\n    if (value === this._selected) {\n      return;\n    }\n    if (this.disabled) {\n      return;\n    }\n\n    value ? this.beforeSelect.emit(this) : this.beforeUnselect.emit(this);\n\n    this._selected = value;\n    this._focused = value;\n    this.toggleSelectedClass();\n\n    value ? this.select.emit(this) : this.unselect.emit(this);\n  }\n  private _selected = false;\n\n  @Input()\n  get disabled() {\n    return this._disabled;\n  }\n  set disabled(value: boolean) {\n    if (value === this._disabled) {\n      return;\n    }\n\n    if (value === true) {\n      this.selected = false;\n    }\n\n    value ? this.beforeDisable.emit(this) : this.beforeEnable.emit(this);\n\n    this._disabled = value;\n    this.toggleDisabledClass();\n\n    value ? this.disable.emit(this) : this.enable.emit(this);\n  }\n  private _disabled = false;\n\n  @Output() beforeSelect = new EventEmitter<ListItemDirective>();\n  @Output() beforeFocus = new EventEmitter<ListItemDirective>();\n  @Output() beforeUnselect = new EventEmitter<ListItemDirective>();\n  @Output() beforeUnfocus = new EventEmitter<ListItemDirective>();\n  @Output() beforeDisable = new EventEmitter<ListItemDirective>();\n  @Output() beforeEnable = new EventEmitter<ListItemDirective>();\n  @Output() focus = new EventEmitter<ListItemDirective>();\n  @Output() unfocus = new EventEmitter<ListItemDirective>();\n  @Output() select = new EventEmitter<ListItemDirective>();\n  @Output() unselect = new EventEmitter<ListItemDirective>();\n  @Output() disable = new EventEmitter<ListItemDirective>();\n  @Output() enable = new EventEmitter<ListItemDirective>();\n\n  @HostListener('click')\n  onClick() {\n    this.selected = true;\n  }\n\n  constructor(\n    public renderer: Renderer2,\n    public el: ElementRef\n  ) {}\n\n  getOffsetTop(): number {\n    const padding = 5;\n\n    return this.el.nativeElement.offsetTop - padding;\n  }\n\n  private toggleFocusedClass() {\n    if (this.focused) {\n      this.addCls(ListItemDirective.focusedCls);\n    } else {\n      this.removeCls(ListItemDirective.focusedCls);\n    }\n  }\n\n  private toggleSelectedClass() {\n    if (this.selected) {\n      this.addCls(ListItemDirective.selectedCls);\n      this.removeCls(ListItemDirective.focusedCls);\n    } else {\n      this.removeCls(ListItemDirective.selectedCls);\n    }\n  }\n\n  private toggleDisabledClass() {\n    if (this.disabled) {\n      this.addCls(ListItemDirective.disabledCls);\n    } else {\n      this.removeCls(ListItemDirective.disabledCls);\n    }\n  }\n\n  private addCls(cls: string) {\n    this.renderer.addClass(this.el.nativeElement, cls);\n  }\n\n  private removeCls(cls: string) {\n    this.renderer.removeClass(this.el.nativeElement, cls);\n  }\n}\n","<mat-list-item>\n  <mat-icon\n    matListItemIcon\n    svgIcon=\"chevron-up\"\n    igoCollapse\n    class=\"igo-chevron\"\n    [target]=\"items\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"onToggleCollapsed($event)\"\n  >\n  </mat-icon>\n\n  <span\n    class=\"igo-catalog-group-title\"\n    matListItemTitle\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"title\"\n    (click)=\"onTitleClick()\"\n    >{{ title }}</span\n  >\n\n  <div matListItemMeta>\n    <button *ngIf=\"group.externalProvider\" disabled=\"true\" mat-icon-button>\n      <mat-icon\n        class=\"igo-cataloggroup-external-icon\"\n        *ngIf=\"group.externalProvider\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.catalog.externalProvider.group' | translate\"\n        color=\"primary\"\n        (click)=\"$event.stopPropagation()\"\n        svgIcon=\"earth-arrow-right\"\n      >\n      </mat-icon>\n    </button>\n\n    <ng-container\n      *ngIf=\"(added$ | async) && (preview$ | async) === false; else notadded\"\n    >\n      <button\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.catalog.group.removeFromMap' | translate\"\n        color=\"warn\"\n        [disabled]=\"disabled$ | async\"\n        (click)=\"onToggleClick($event)\"\n      >\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n    </ng-container>\n\n    <ng-template #notadded>\n      <button\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.catalog.group.addToMap' | translate\"\n        [disabled]=\"disabled$ | async\"\n        (click)=\"onToggleClick($event)\"\n      >\n        <mat-icon svgIcon=\"plus\"></mat-icon>\n      </button>\n    </ng-template>\n  </div>\n</mat-list-item>\n\n<div #items>\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <!-- todo: add display ans manage CatalogItemGroup -->\n    </ng-container>\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"item\"\n        [resolution]=\"resolution\"\n        [map]=\"map\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"state.get(item).added\"\n        (addedLayerIsPreview)=\"onLayerPreview($event)\"\n        (addedChange)=\"onLayerAddedChange($event)\"\n      >\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { EntityStore } from '@igo2/common';\nimport type { EntityStateManager } from '@igo2/common';\n\nimport {\n  AddedChangeEmitter,\n  AddedChangeGroupEmitter,\n  Catalog,\n  CatalogItem,\n  CatalogItemGroup,\n  CatalogItemState,\n  CatalogItemType\n} from '../shared';\nimport { IgoMap } from '../../map/shared';\n\n/**\n * Catalog browser group item\n */\n@Component({\n  selector: 'igo-catalog-browser-group',\n  templateUrl: './catalog-browser-group.component.html',\n  styleUrls: ['./catalog-browser-group.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserGroupComponent implements OnInit, OnDestroy {\n  /**\n   * Group's items store\n   * @internal\n   */\n  store = new EntityStore<CatalogItem, CatalogItemState>([]);\n\n  /**\n   * Whether all the layers of the group are added\n   * @internal\n   */\n  added$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  preview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Whether the toggle button is disabled\n   * @internal\n   */\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Catalog group\n   */\n  @Input() group: CatalogItemGroup;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Whether the group is collapsed\n   */\n  @Input() collapsed: boolean = true;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Whether the group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsed: boolean = true;\n\n  /**\n   * Parent catalog's items store state. Groups share a unique\n   * EntityState that tracks the group and it's layers state (whether they are added or not).\n   * Sharing a unique state would also allow us to expand this component to allow\n   * the selection of a layer while unselecting any layer already selected in another group.\n   * This could be useful to display some layer info before adding it, for example.\n   */\n  @Input() state: EntityStateManager<CatalogItem, CatalogItemState>;\n\n  /**\n   * Event emitted when the add/remove button of the group is clicked\n   */\n  @Output() addedChange = new EventEmitter<AddedChangeGroupEmitter>();\n\n  /**\n   * Event emitted when the add/remove button of a layer is clicked\n   */\n  @Output() layerAddedChange = new EventEmitter<AddedChangeEmitter>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return this.group.title;\n  }\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.load(this.group.items);\n    this.evaluateAdded();\n    this.evaluateDisabled(this.collapsed);\n    if (this.group.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.group.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n      });\n    }\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event: Event) {\n    this.added$.value ? this.remove(event) : this.add(event);\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleCollapsed(collapsed: boolean) {\n    this.evaluateDisabled(collapsed);\n  }\n\n  /**\n   * When a layer is added or removed, evaluate if all the layers of the group\n   * are now added or removed. If so, consider that the group itself is added\n   * or removed.\n   * @internal\n   * @param event Layer added change event\n   */\n  onLayerAddedChange(event: AddedChangeEmitter) {\n    this.layerAddedChange.emit(event);\n    this.tryToggleGroup(event);\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add(event: Event) {\n    this.added$.next(true);\n    this.addedChange.emit({\n      added: true,\n      group: this.group,\n      event\n    });\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private remove(event: Event) {\n    this.added$.next(false);\n    this.addedChange.emit({\n      added: false,\n      group: this.group,\n      event\n    });\n  }\n\n  onLayerPreview(event) {\n    this.preview$.next(event);\n  }\n\n  /**\n   * If all the layers of the group added or removed, add or remove the group itself.\n   * @param event The last layer added change event to occur\n   */\n  private tryToggleGroup(event: AddedChangeEmitter) {\n    const added = event.added;\n    const layer = event.layer;\n\n    const layersAdded = this.store.view\n      .all()\n      .filter((item: CatalogItem) => item.id !== layer.id)\n      .map((item: CatalogItem) => this.state.get(item).added || false);\n\n    if (layersAdded.every((value) => value === added)) {\n      added ? this.add(event.event) : this.remove(event.event);\n    } else if (this.added$.value === true) {\n      this.added$.next(false);\n    }\n  }\n\n  private evaluateAdded() {\n    const added = this.store.all().every((item: CatalogItem) => {\n      return (this.state.get(item).added || false) === true;\n    });\n    this.added$.next(added);\n  }\n\n  private evaluateDisabled(collapsed: boolean) {\n    let disabled = false;\n    if (this.toggleCollapsed === false) {\n      disabled = collapsed;\n    }\n    this.disabled$.next(disabled);\n  }\n\n  onTitleClick() {\n    this.collapsed = !this.collapsed;\n  }\n}\n","import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerListToolService {\n  public keyword: string;\n  public sortAlpha = false;\n  public onlyVisible = false;\n  public onlyInRange = false;\n  public keywordInitialized = false;\n  public sortedAlphaInitialized = false;\n  public onlyVisibleInitialized = false;\n  public onlyInRangeInitialized = false;\n\n  constructor() {}\n}\n","<mat-list-item class=\"igo-layer-list-item\">\n  <mat-checkbox\n    *ngIf=\"selectionMode\"\n    class=\"layerCheck\"\n    matListItemIcon\n    (change)=\"check()\"\n    [checked]=\"layerCheck\"\n  >\n  </mat-checkbox>\n  <span\n    matListItemTitle\n    class=\"igo-layer-title\"\n    [matTooltip]=\"tooltipText\"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleLegendOnClick()\"\n  >\n    {{ layer.title }}\n  </span>\n\n  <div matListItemMeta>\n    <button\n      *ngIf=\"!selectionMode\"\n      mat-icon-button\n      [color]=\"layer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"eyeTooltip | translate\"\n      (click)=\"toggleVisibility($event)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        matBadge=\"?\"\n        matBadgeColor=\"accent\"\n        matBadgeSize=\"small\"\n        matBadgePosition=\"after\"\n        [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n        [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n        [svgIcon]=\"(layer.visible$ | async) ? 'eye' : 'eye-off'\"\n      >\n      </mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"selectionMode\"\n      class=\"selection-eye\"\n      mat-icon-button\n      [color]=\"layer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        layer.visible\n          ? ('igo.geo.layer.hideLayer' | translate)\n          : ('igo.geo.layer.showLayer' | translate)\n      \"\n      (click)=\"toggleVisibility($event)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        matBadge=\"?\"\n        matBadgeColor=\"accent\"\n        matBadgeSize=\"small\"\n        matBadgePosition=\"after\"\n        [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n        [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n        [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\"\n      >\n      </mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"!selectionMode\"\n      class=\"actions-button\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.moreOptions' | translate\"\n      mat-icon-button\n      color=\"primary\"\n      (click)=\"toggleLayerTool()\"\n    >\n      <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"showLegend$ | async\"\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  >\n  </igo-layer-legend>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  Renderer2,\n  ElementRef,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { layerIsQueryable } from '../../query/shared/query.utils';\nimport { Layer, TooltipType } from '../shared/layers';\nimport { NetworkService, ConnectionState } from '@igo2/core';\n\n@Component({\n  selector: 'igo-layer-item',\n  templateUrl: './layer-item.component.html',\n  styleUrls: ['./layer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerItemComponent implements OnInit, OnDestroy {\n  public focusedCls = 'igo-layer-item-focused';\n\n  @Input()\n  get activeLayer() {\n    return this._activeLayer;\n  }\n  set activeLayer(value) {\n    if (\n      value &&\n      this.layer &&\n      value.id === this.layer.id &&\n      !this.selectionMode\n    ) {\n      this.layerTool$.next(true);\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n  }\n  private _activeLayer;\n\n  layerTool$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  queryBadgeHidden$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  @Input()\n  get selectAll() {\n    return this._selectAll;\n  }\n  set selectAll(value: boolean) {\n    this._selectAll = value;\n    if (value === true) {\n      this.layerCheck = true;\n    }\n  }\n  private _selectAll = false;\n\n  @Input() layerCheck;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n  private layers$$: Subscription;\n\n  layers$: BehaviorSubject<Layer> = new BehaviorSubject<Layer>(undefined);\n\n  @Input()\n  get layer() {\n    return this._layer;\n  }\n  set layer(value) {\n    this._layer = value;\n    this.layers$.next(value);\n  }\n  private _layer;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendIfVisible: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() orderable: boolean = true;\n\n  @Input() lowerDisabled: boolean = false;\n\n  @Input() raiseDisabled: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Input() selectionMode;\n\n  @Input() changeDetection;\n\n  get opacity() {\n    return this.layer.opacity * 100;\n  }\n  set opacity(opacity: number) {\n    this.layer.opacity = opacity / 100;\n  }\n\n  get eyeTooltip() {\n    if (this.inResolutionRange$.getValue() === false) {\n      return 'igo.geo.layer.notInResolution';\n    } else {\n      return this.layer.visible\n        ? 'igo.geo.layer.hideLayer'\n        : 'igo.geo.layer.showLayer';\n    }\n  }\n\n  @Output() action: EventEmitter<Layer> = new EventEmitter<Layer>(undefined);\n  @Output() checkbox = new EventEmitter<{\n    layer: Layer;\n    check: boolean;\n  }>();\n\n  constructor(\n    private networkService: NetworkService,\n    private renderer: Renderer2,\n    private elRef: ElementRef,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit() {\n    if (\n      this.layer.visible &&\n      this.expandLegendIfVisible &&\n      this.layer.firstLoadComponent === true\n    ) {\n      this.layer.firstLoadComponent = false;\n      this.layer.legendCollapsed = false;\n    }\n    this.toggleLegend(this.layer.legendCollapsed);\n    this.updateQueryBadge();\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService\n      .currentState()\n      .subscribe((state: ConnectionState) => {\n        this.state = state;\n        this.onResolutionChange();\n      });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layer && this.layer.options.active) {\n        this.layerTool$.next(true);\n        this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n      }\n    });\n\n    if (this.changeDetection) {\n      this.changeDetection.subscribe(() => this.cdRef.detectChanges());\n    }\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    this.toggleLegend(this.showLegend$.value);\n  }\n\n  toggleVisibility(event: Event) {\n    event.stopPropagation();\n    this.layer.visible = !this.layer.visible;\n    if (this.toggleLegendOnVisibilityChange) {\n      this.toggleLegend(!this.layer.visible);\n    }\n    this.updateQueryBadge();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    if (\n      inResolutionRange === false &&\n      this.updateLegendOnResolutionChange === true\n    ) {\n      this.toggleLegend(true);\n    }\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n\n  private updateQueryBadge() {\n    const hidden =\n      this.queryBadge === false ||\n      this.layer.visible === false ||\n      !layerIsQueryable(this.layer);\n    this.queryBadgeHidden$.next(hidden);\n  }\n\n  toggleLayerTool() {\n    this.layerTool$.next(!this.layerTool$.getValue());\n    if (this.layerTool$.getValue() === true) {\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n    this.action.emit(this.layer);\n  }\n\n  public check() {\n    this.layerCheck = !this.layerCheck;\n    this.checkbox.emit({ layer: this.layer, check: this.layerCheck });\n  }\n}\n","export enum LayerListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\nexport enum LayerListSelectVisibleEnum {\n  ALL_VISIBLE = 'ALL_VISIBLE',\n  ALL_HIDDEN = 'ALL_HIDDEN',\n  MIXED = 'MIXED',\n  NULL = 'NULL'\n}\n\nexport enum LayerListDisplacement {\n  Raise = 'raise',\n  Lower = 'lower'\n}\n","<igo-layer-list-tool\n  *ngIf=\"showToolbar$ | async\"\n  floatLabel=\"auto\"\n  [layersAreAllVisible]=\"layersAreAllVisible\"\n  [term]=\"layerFilterAndSortOptions.keyword\"\n  [onlyVisible]=\"layerFilterAndSortOptions.onlyVisible\"\n  [sortAlpha]=\"layerFilterAndSortOptions.sortAlpha\"\n  (appliedFilterAndSort)=\"onAppliedFilterAndSortChange($event)\"\n  (selection)=\"toggleSelectionMode($event)\"\n>\n</igo-layer-list-tool>\n\n<div *ngIf=\"selection\" class=\"select-all\">\n  <mat-checkbox\n    class=\"select-all-checkbox\"\n    [color]=\"!selectAllCheck && layersChecked.length > 0 ? 'accent' : 'primary'\"\n    (change)=\"selectAll()\"\n    [checked]=\"selectAllCheck\"\n    [indeterminate]=\"!selectAllCheck && layersChecked.length > 0\"\n  >\n    {{\n      selectAllCheck\n        ? ('igo.geo.layer.deselectAll' | translate)\n        : ('igo.geo.layer.selectAll' | translate)\n    }}\n  </mat-checkbox>\n</div>\n<mat-divider></mat-divider>\n\n<igo-list #igoList [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n    <igo-layer-item\n      *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n      igoListItem\n      [layer]=\"layer\"\n      [activeLayer]=\"activeLayer\"\n      [orderable]=\"orderable && !layer.baseLayer\"\n      [lowerDisabled]=\"getLowerLayer().id === layer.id\"\n      [raiseDisabled]=\"getUpperLayer().id === layer.id\"\n      [queryBadge]=\"queryBadge\"\n      [expandLegendIfVisible]=\"expandLegendOfVisibleLayers\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [selectionMode]=\"selection\"\n      [selectAll]=\"selectAllCheck\"\n      [layerCheck]=\"layer.options.check\"\n      [changeDetection]=\"layerItemChangeDetection$\"\n      (action)=\"toggleLayerTool($event)\"\n      (checkbox)=\"layersCheck($event)\"\n    >\n    </igo-layer-item>\n  </ng-template>\n</igo-list>\n\n<igo-panel\n  *ngIf=\"!selection && layerTool && activeLayer\"\n  class=\"igo-layer-actions-container\"\n  [title]=\"activeLayer.title\"\n>\n  <div class=\"igo-layer-button-group\">\n    <button\n      *ngIf=\"isLayerRemovable(activeLayer)\"\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.removeLayer' | translate\"\n      (click)=\"removeLayers()\"\n    >\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        sortAlpha || onlyVisible || keyword\n          ? ('igo.geo.layer.filterLowerLayer' | translate)\n          : ('igo.geo.layer.lowerLayer' | translate)\n      \"\n      [disabled]=\"lowerDisabled\"\n      (click)=\"moveActiveLayer(activeLayer, layerListDisplacement.Lower, true)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"lowerDisabled\"\n        svgIcon=\"arrow-down\"\n      ></mat-icon>\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        sortAlpha || onlyVisible || keyword\n          ? ('igo.geo.layer.filterRaiseLayer' | translate)\n          : ('igo.geo.layer.raiseLayer' | translate)\n      \"\n      [disabled]=\"raiseDisabled\"\n      (click)=\"moveActiveLayer(activeLayer, layerListDisplacement.Raise, true)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"raiseDisabled\"\n        svgIcon=\"arrow-up\"\n      ></mat-icon>\n    </button>\n\n    <!-- <label>{{ 'igo.geo.layer.opacity' | translate }} </label> -->\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"badgeOpacity\"\n        matBadgeColor=\"primary\"\n        matBadgeSize=\"medium\"\n        svgIcon=\"opacity\"\n      ></mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\" class=\"panel-opacity-menu\">\n      <mat-slider\n        id=\"opacity-slider\"\n        color=\"primary\"\n        discrete\n        step=\"5\"\n        [min]=\"0\"\n        [max]=\"100\"\n        [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n        (click)=\"$event.stopPropagation()\"\n        matTooltipShowDelay=\"500\"\n        tooltip-position=\"below\"\n        #ngSlider\n        ><input\n          matSliderThumb\n          [value]=\"opacity\"\n          (input)=\"\n            changeOpacity({\n              source: ngSliderThumb,\n              parent: ngSlider,\n              value: ngSliderThumb.value\n            })\n          \"\n          #ngSliderThumb=\"matSliderThumb\"\n        />\n      </mat-slider>\n    </mat-menu>\n\n    <button\n      *ngIf=\"activeLayerExtentIsValid(activeLayer)\"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayer' | translate\"\n      (click)=\"zoomLayerExtents(activeLayer)\"\n    >\n      <mat-icon\n        matBadgeColor=\"primary\"\n        matBadgeSize=\"medium\"\n        svgIcon=\"magnify-scan\"\n      ></mat-icon>\n    </button>\n\n    <ng-container\n      igoLayerItemToolbar\n      [ngTemplateOutlet]=\"templateLayerToolbar\"\n      [ngTemplateOutletContext]=\"{ layer: activeLayer }\"\n    >\n    </ng-container>\n\n    <ng-content select=\"[igoLayerItemToolbar]\"></ng-content>\n  </div>\n</igo-panel>\n\n<igo-panel\n  *ngIf=\"selection && layers.length > 0\"\n  class=\"igo-layer-actions-container\"\n  [title]=\"'igo.geo.layer.tools' | translate\"\n>\n  <div class=\"actions-buttons-multi\">\n    <button\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"\n        isAllLayersRemovable(layersChecked)\n          ? ('igo.geo.layer.removeSelectedLayers' | translate)\n          : ('igo.geo.layer.removeSelectedLayersRestriction' | translate)\n      \"\n      (click)=\"removeLayers(layersChecked)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"'!'\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"isAllLayersRemovable(layersChecked)\"\n        svgIcon=\"delete\"\n      ></mat-icon>\n    </button>\n\n    <button\n      class=\"eye-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"\n        statusSelectedLayersCheck === 'ALL_HIDDEN'\n          ? ('igo.geo.layer.showSelectedLayers' | translate)\n          : ('igo.geo.layer.hideSelectedLayers' | translate)\n      \"\n      (click)=\"toggleVisibility(layersChecked)\"\n    >\n      <mat-icon\n        [svgIcon]=\"\n          statusSelectedLayersCheck === 'ALL_HIDDEN' ? 'eye-off' : 'eye'\n        \"\n      ></mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        sortAlpha || onlyVisible || keyword\n          ? ('igo.geo.layer.filterLowerLayer' | translate)\n          : ('igo.geo.layer.lowerLayer' | translate)\n      \"\n      [disabled]=\"lowerDisabledSelection\"\n      (click)=\"lowerLayers(layersChecked)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"lowerDisabledSelection\"\n        svgIcon=\"arrow-down\"\n      ></mat-icon>\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        sortAlpha || onlyVisible || keyword\n          ? ('igo.geo.layer.filterRaiseLayer' | translate)\n          : ('igo.geo.layer.raiseLayer' | translate)\n      \"\n      [disabled]=\"raiseDisabledSelection\"\n      (click)=\"raiseLayers(layersChecked)\"\n    >\n      <mat-icon\n        aria-hidden=\"false\"\n        [matBadge]=\"sortAlpha || onlyVisible || keyword ? '!' : ''\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n        [matBadgeHidden]=\"raiseDisabledSelection\"\n        svgIcon=\"arrow-up\"\n      ></mat-icon>\n    </button>\n\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n    >\n      <mat-icon svgIcon=\"opacity\"></mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\" class=\"mat-menu-opacity-slider\">\n      <div id=\"opacity-menu\">\n        <!-- TODO: The 'tickInterval' property no longer exists -->\n        <mat-slider\n          *ngIf=\"layersChecked.length\"\n          id=\"opacity-slider\"\n          color=\"primary\"\n          thumbLabel\n          showTickMarks\n          step=\"5\"\n          [min]=\"0\"\n          [max]=\"100\"\n          [(ngModel)]=\"checkOpacity\"\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n          matTooltipShowDelay=\"500\"\n          tooltip-position=\"below\"\n          (click)=\"$event.stopPropagation()\"\n          ><input matSliderThumb />\n        </mat-slider>\n      </div>\n    </mat-menu>\n\n    <button\n      *ngIf=\"\n        layersChecked.length !== 0 && activeLayersExtentAreValid(layersChecked)\n      \"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayers' | translate\"\n      (click)=\"zoomLayersExtents(layersChecked)\"\n    >\n      <mat-icon svgIcon=\"magnify-scan\"></mat-icon>\n    </button>\n  </div>\n</igo-panel>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ContentChild,\n  OnInit,\n  OnDestroy,\n  Output,\n  EventEmitter,\n  ElementRef\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport scrollIntoView from 'scroll-into-view-if-needed';\n\nimport { FloatLabelType } from '@angular/material/form-field';\nimport {\n  LayerListControlsEnum,\n  LayerListDisplacement\n} from './layer-list.enum';\nimport { LayerListSelectVisibleEnum } from './layer-list.enum';\nimport {\n  BehaviorSubject,\n  ReplaySubject,\n  Subscription,\n  EMPTY,\n  timer\n} from 'rxjs';\nimport { debounce } from 'rxjs/operators';\nimport {\n  MetadataOptions,\n  MetadataLayerOptions\n} from '../../metadata/shared/metadata.interface';\nimport { LayerListControlsOptions } from '../layer-list-tool/layer-list-tool.interface';\nimport { IgoMap } from '../../map/shared/map';\nimport { Layer } from '../shared/layers/layer';\nimport { LinkedProperties } from '../shared/layers/layer.interface';\nimport { MatSliderChange } from '@angular/material/slider';\nimport * as olextent from 'ol/extent';\nimport {\n  getAllChildLayersByProperty,\n  getRootParentByProperty\n} from '../../map/shared/linkedLayers.utils';\n\n// TODO: This class could use a clean up. Also, some methods could be moved ealsewhere\n@Component({\n  selector: 'igo-layer-list',\n  templateUrl: './layer-list.component.html',\n  styleUrls: ['./layer-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerListComponent implements OnInit, OnDestroy {\n  orderable = true;\n  thresholdToFilterAndSort = 5;\n\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n\n  change$ = new ReplaySubject<void>(1);\n\n  showToolbar$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public layerTool: boolean;\n\n  public hideSelectedLayers: boolean = true;\n  activeLayer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\n\n  layersChecked: Layer[] = [];\n  public selection: boolean;\n\n  private change$$: Subscription;\n  private layers$$: Subscription;\n  public layerItemChangeDetection$ = new BehaviorSubject(undefined);\n\n  @ContentChild('igoLayerItemToolbar', /* TODO: add static flag */ {})\n  templateLayerToolbar: TemplateRef<any>;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = this.removeProblemLayerInList(value);\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n\n  set activeLayer(value: Layer) {\n    this._activeLayer = value;\n    this.activeLayer$.next(value);\n  }\n  get activeLayer(): Layer {\n    return this._activeLayer;\n  }\n  private _activeLayer: Layer;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input() layerFilterAndSortOptions: LayerListControlsOptions = {};\n\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n\n  get keyword(): string {\n    return this._keyword;\n  }\n  set keyword(value: string) {\n    this._keyword = value;\n    this.next();\n  }\n  private _keyword = undefined;\n\n  get onlyVisible(): boolean {\n    return this._onlyVisible;\n  }\n  set onlyVisible(value: boolean) {\n    this._onlyVisible = value;\n    this.next();\n  }\n  private _onlyVisible = false;\n\n  get sortAlpha(): boolean {\n    return this._sortedAlpha;\n  }\n  set sortAlpha(value: boolean) {\n    this._sortedAlpha = value;\n    this.next();\n  }\n  private _sortedAlpha = false;\n\n  get opacity() {\n    return Math.round(this.activeLayer$.getValue().opacity * 100);\n  }\n  set opacity(opacity: number) {\n    this.activeLayer$.getValue().opacity = opacity / 100;\n  }\n\n  get badgeOpacity() {\n    if (this.opacity === 100) {\n      return;\n    }\n    return this.opacity;\n  }\n\n  get raiseDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getUpperLayer().id === this.activeLayer.id ||\n      this.isUpperBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getLowerLayer().id === this.activeLayer.id ||\n      this.isLowerBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get raiseDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.raisableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.lowerableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get checkOpacity() {\n    return this.layersCheckedOpacity() * 100;\n  }\n  set checkOpacity(opacity: number) {\n    for (const layer of this.layersChecked) {\n      layer.opacity = opacity / 100;\n    }\n  }\n\n  get layerListDisplacement(): typeof LayerListDisplacement {\n    return LayerListDisplacement;\n  }\n\n  public toggleOpacity = false;\n\n  public selectAllCheck: boolean;\n  public selectAllCheck$ = new BehaviorSubject<boolean>(undefined);\n  private selectAllCheck$$: Subscription;\n\n  constructor(private elRef: ElementRef) {}\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.layers.length === 0 ? EMPTY : timer(50);\n        })\n      )\n      .subscribe(() => {\n        this.showToolbar$.next(this.computeShowToolbar());\n        this.layers$.next(this.computeLayers(this.layers.slice(0)));\n        this.appliedFilterAndSort.emit({\n          keyword: this.keyword,\n          sortAlpha: this.sortAlpha,\n          onlyVisible: this.onlyVisible\n        });\n      });\n\n    this.selectAllCheck$$ = this.selectAllCheck$.subscribe((value) => {\n      this.selectAllCheck = value;\n    });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layers) {\n        let checks = 0;\n        for (const layer of this.layers) {\n          layer.status$.subscribe((valStatus) => {\n            if (valStatus === 0) {\n              this.map.removeLayer(layer);\n            }\n          });\n          if (layer.options.active) {\n            this.activeLayer = layer;\n            this.layerTool = true;\n          }\n          if (layer.options.check) {\n            checks += 1;\n          }\n        }\n        if (this.excludeBaseLayers) {\n          this.selectAllCheck =\n            checks ===\n            this.layers.filter(\n              (lay) => lay.baseLayer !== true && lay.showInLayerList\n            ).length\n              ? true\n              : false;\n        } else {\n          this.selectAllCheck =\n            checks === this.layers.filter((lay) => lay.showInLayerList).length\n              ? true\n              : false;\n        }\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n    this.selectAllCheck$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  activeLayerExtentIsValid(layer: Layer): boolean {\n    let valid = false;\n    if (layer.options.showButtonZoomToExtent === false) {\n      return false;\n    }\n    const layerExtent = layer.options.extent;\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    if (layerExtent) {\n      if (maxLayerZoomExtent) {\n        valid = olextent.containsExtent(maxLayerZoomExtent, layerExtent);\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  activeLayersExtentAreValid(layers: Layer[]): boolean {\n    let valid = false;\n    const layersExtent = olextent.createEmpty();\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent && !layerExtent.includes(Infinity)) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n\n    if (!olextent.isEmpty(layersExtent)) {\n      if (maxLayerZoomExtent) {\n        valid = olextent.containsExtent(maxLayerZoomExtent, layersExtent);\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  zoomLayerExtents(layer: Layer) {\n    this.map.viewController.zoomToExtent(layer.options.extent);\n  }\n\n  zoomLayersExtents(layers: Layer[]) {\n    const layersExtent = olextent.createEmpty() as [\n      number,\n      number,\n      number,\n      number\n    ];\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n    this.map.viewController.zoomToExtent(layersExtent);\n  }\n\n  changeOpacity(event: MatSliderChange) {\n    this.opacity = event.value;\n  }\n\n  clearKeyword() {\n    this.keyword = undefined;\n  }\n\n  getLowerLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex < current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isLowerBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index + 1] &&\n      this.layers[index + 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  getUpperLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex > current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isUpperBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index - 1] &&\n      this.layers[index - 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  moveActiveLayer(\n    activeLayer: Layer,\n    actiontype: LayerListDisplacement,\n    fromUi: boolean = false\n  ) {\n    const sortedLayersToMove = [];\n    getRootParentByProperty(this.map, activeLayer, LinkedProperties.ZINDEX);\n    let rootParentByProperty = getRootParentByProperty(\n      this.map,\n      activeLayer,\n      LinkedProperties.ZINDEX\n    );\n    if (!rootParentByProperty) {\n      rootParentByProperty = activeLayer;\n    }\n    const layersToMove = [rootParentByProperty];\n    getAllChildLayersByProperty(\n      this.map,\n      rootParentByProperty,\n      layersToMove,\n      LinkedProperties.ZINDEX\n    );\n\n    this.layers.map((layer) => {\n      if (layersToMove.indexOf(layer) !== -1) {\n        sortedLayersToMove.push(layer);\n      }\n    });\n\n    if (actiontype === LayerListDisplacement.Raise) {\n      this.raiseLayers(sortedLayersToMove, fromUi);\n    } else if (actiontype === LayerListDisplacement.Lower) {\n      this.lowerLayers(sortedLayersToMove, fromUi);\n    }\n  }\n\n  /*\n   * For selection mode disabled attribute\n   */\n  raisableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const previousLayer = this.layers[mapIndex - 1];\n      if (\n        previousLayer &&\n        previousLayer.baseLayer !== true &&\n        !layers.find((lay) => previousLayer.id === lay.id) &&\n        currentLayer.baseLayer !== true\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  raisableLayer(index: number) {\n    if (index < 1) {\n      return false;\n    }\n\n    if (this.layers[index - 1].options.check) {\n      return this.raisableLayer(index - 1);\n    }\n    return true;\n  }\n\n  raiseLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToRaise = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.raisableLayer(index)) {\n        layersToRaise.push(layer);\n      }\n    }\n    this.map.raiseLayers(layersToRaise);\n    if (fromUi) {\n      setTimeout(() => {\n        const checkItems = this.elRef.nativeElement.getElementsByClassName(\n          'mat-checkbox-checked'\n        );\n        const itemFocused = this.elRef.nativeElement.getElementsByClassName(\n          'igo-layer-item-focused'\n        );\n        let targetToScroll;\n        if (checkItems.length) {\n          targetToScroll = checkItems[0];\n        }\n        if (itemFocused.length) {\n          targetToScroll = itemFocused[0];\n        }\n        if (targetToScroll) {\n          scrollIntoView(targetToScroll, {\n            scrollMode: 'if-needed',\n            behavior: 'smooth',\n            block: 'end',\n            inline: 'nearest'\n          });\n        }\n      }, 100);\n    }\n  }\n  /*\n   * For selection mode disabled attribute\n   */\n  lowerableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const nextLayer = this.layers[mapIndex + 1];\n      if (\n        nextLayer &&\n        nextLayer.baseLayer !== true &&\n        !layers.find((lay) => nextLayer.id === lay.id)\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  lowerableLayer(index: number) {\n    if (\n      index >\n      this.layers.filter((lay) => lay.baseLayer !== true).length - 2\n    ) {\n      return false;\n    }\n\n    if (this.layers[index + 1].options.check) {\n      return this.lowerableLayer(index + 1);\n    }\n    return true;\n  }\n\n  lowerLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToLower = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.lowerableLayer(index)) {\n        layersToLower.push(layer);\n      }\n    }\n    this.map.lowerLayers(layersToLower);\n    if (fromUi) {\n      setTimeout(() => {\n        const checkItems = this.elRef.nativeElement.getElementsByClassName(\n          'mat-checkbox-checked'\n        );\n        const itemFocused = this.elRef.nativeElement.getElementsByClassName(\n          'igo-layer-item-focused'\n        );\n        let targetToScroll;\n        if (checkItems.length) {\n          targetToScroll = checkItems[checkItems.length - 1];\n        }\n        if (itemFocused.length) {\n          targetToScroll = itemFocused[0];\n        }\n        if (targetToScroll) {\n          scrollIntoView(targetToScroll, {\n            scrollMode: 'if-needed',\n            behavior: 'smooth',\n            block: 'end',\n            inline: 'nearest'\n          });\n        }\n      }, 100);\n    }\n  }\n  private next() {\n    this.change$.next();\n  }\n\n  private computeLayers(layers: Layer[]): Layer[] {\n    let layersOut = this.filterLayers(layers);\n    if (this.sortAlpha) {\n      layersOut = this.sortLayersByTitle(layersOut);\n    } else {\n      layersOut = this.sortLayersByZindex(layersOut);\n    }\n    return layersOut;\n  }\n\n  onKeywordChange(term) {\n    this.keyword = term;\n  }\n\n  onAppliedFilterAndSortChange(appliedFilter: LayerListControlsOptions) {\n    this.keyword = appliedFilter.keyword;\n    this.onlyVisible = appliedFilter.onlyVisible;\n    this.sortAlpha = appliedFilter.sortAlpha;\n  }\n\n  private filterLayers(layers: Layer[]): Layer[] {\n    if (\n      this.layerFilterAndSortOptions.showToolbar === LayerListControlsEnum.never\n    ) {\n      return layers;\n    }\n    if (!this.keyword && !this.onlyVisible) {\n      return layers;\n    }\n\n    const keepLayerIds = layers.map((layer: Layer) => layer.id);\n\n    layers.forEach((layer: Layer) => {\n      const layerOptions = (layer.options as MetadataLayerOptions) || {};\n      const dataSourceOptions = layer.dataSource.options || {};\n      const metadata = layerOptions.metadata || ({} as MetadataOptions);\n      const keywords = metadata.keywordList || [];\n      const layerKeywords = keywords.map((kw: string) => {\n        return kw.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      });\n\n      if (this.keyword && layer.title) {\n        const localKeyword = this.keyword\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const layerTitle = layer.title\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const dataSourceType = dataSourceOptions.type || '';\n        const keywordRegex = new RegExp(localKeyword, 'gi');\n        const keywordInList =\n          layerKeywords.find((kw: string) => keywordRegex.test(kw)) !==\n          undefined;\n        if (\n          !keywordRegex.test(layerTitle) &&\n          !(this.keyword.toLowerCase() === dataSourceType.toLowerCase()) &&\n          !keywordInList\n        ) {\n          const index = keepLayerIds.indexOf(layer.id);\n          if (index > -1) {\n            keepLayerIds.splice(index, 1);\n          }\n        }\n      }\n\n      if (this.onlyVisible && layer.visible === false) {\n        const index = keepLayerIds.indexOf(layer.id);\n        if (index > -1) {\n          keepLayerIds.splice(index, 1);\n        }\n      }\n    });\n\n    return layers.filter(\n      (layer: Layer) => keepLayerIds.indexOf(layer.id) !== -1\n    );\n  }\n\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  private sortLayersByTitle(layers: Layer[]) {\n    return layers.sort((a, b) => {\n      if (this.normalize(a.title) < this.normalize(b.title)) {\n        return -1;\n      }\n      if (this.normalize(a.title) > this.normalize(b.title)) {\n        return 1;\n      }\n      return 0;\n    });\n  }\n\n  private normalize(str: string) {\n    return str\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .toLowerCase();\n  }\n\n  private computeShowToolbar(): boolean {\n    switch (this.layerFilterAndSortOptions.showToolbar) {\n      case LayerListControlsEnum.always:\n        return true;\n      case LayerListControlsEnum.never:\n        return false;\n      default:\n        if (\n          this.layers.length >= this.thresholdToFilterAndSort ||\n          this.keyword ||\n          this.onlyVisible\n        ) {\n          return true;\n        }\n        return false;\n    }\n  }\n\n  toggleLayerTool(layer) {\n    this.toggleOpacity = false;\n    if (this.layerTool && layer === this.activeLayer) {\n      this.layerTool = false;\n    } else {\n      this.layerTool = true;\n    }\n\n    for (const lay of this.layers) {\n      lay.options.active = false;\n    }\n    layer.options.active = true;\n    this.activeLayer = layer;\n  }\n\n  removeLayers(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      this.layersChecked = [];\n      for (const layer of layers) {\n        if (layer.options.removable !== false) {\n          layer.map.removeLayer(layer);\n        } else {\n          this.layersChecked.push(layer);\n        }\n      }\n    } else if (!layers && this.activeLayer.options.removable !== false) {\n      this.activeLayer.map.removeLayer(this.activeLayer);\n      this.layerTool = false;\n    }\n  }\n\n  toggleVisibility(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      for (const layer of layers) {\n        layer.visible = this.hideSelectedLayers;\n      }\n    }\n    this.layerItemChangeDetection$.next(true);\n  }\n\n  isLayerRemovable(layer: Layer): boolean {\n    return layer.options.removable !== false;\n  }\n\n  isAllLayersRemovable(layers: Layer[]): boolean {\n    return layers.every((l) => this.isLayerRemovable(l));\n  }\n\n  get statusSelectedLayersCheck(): LayerListSelectVisibleEnum {\n    let statusSelectedLayers: LayerListSelectVisibleEnum =\n      LayerListSelectVisibleEnum.NULL;\n    let findTrue: boolean = false;\n    let findFalse: boolean = false;\n\n    if (this.layersChecked.length === 0) {\n      statusSelectedLayers = LayerListSelectVisibleEnum.NULL;\n    } else {\n      statusSelectedLayers = LayerListSelectVisibleEnum.MIXED;\n      this.hideSelectedLayers = false;\n\n      for (const layer2 of this.layersChecked) {\n        if (layer2.visible === true) {\n          findTrue = true;\n        }\n        if (layer2.visible === false) {\n          findFalse = true;\n        }\n      }\n\n      if (findTrue === true && findFalse === false) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_VISIBLE;\n      }\n      if (findTrue === false && findFalse === true) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_HIDDEN;\n        this.hideSelectedLayers = true;\n      }\n    }\n\n    return statusSelectedLayers;\n  }\n\n  layersCheck(event: { layer: Layer; check: boolean }) {\n    event.layer.options.check = event.check;\n    if (event.check === true) {\n      const eventMapIndex = this.layers.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      for (const layer of this.layersChecked) {\n        const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n        if (eventMapIndex < mapIndex) {\n          this.layersChecked.splice(\n            this.layersChecked.findIndex((lay) => layer.id === lay.id),\n            0,\n            event.layer\n          );\n\n          if (this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter(\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\n              ).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          } else if (!this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter((lay) => lay.showInLayerList).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          }\n          return;\n        }\n      }\n      this.layersChecked.push(event.layer);\n    } else {\n      const index = this.layersChecked.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      this.layersChecked.splice(index, 1);\n    }\n\n    if (this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter(\n          (lay) => lay.baseLayer !== true && lay.showInLayerList\n        ).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    } else if (!this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter((lay) => lay.showInLayerList).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    }\n  }\n\n  toggleSelectionMode(value: boolean) {\n    this.selection = value;\n    this.activeLayer = undefined;\n    if (value === true) {\n      this.layerTool = false;\n      for (const layer of this.layers) {\n        if (layer.options.check) {\n          this.layersChecked.push(layer);\n        }\n      }\n    }\n  }\n\n  layersCheckedOpacity(): any {\n    if (this.layersChecked.length > 1) {\n      return 1;\n    } else {\n      const opacity = [];\n      for (const layer of this.layersChecked) {\n        opacity.push(layer.opacity);\n      }\n      return opacity;\n    }\n  }\n\n  selectAll() {\n    if (!this.selectAllCheck) {\n      for (const layer of this.layers) {\n        if (\n          this.excludeBaseLayers &&\n          layer.baseLayer !== true &&\n          layer.showInLayerList\n        ) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        } else if (!this.excludeBaseLayers && layer.showInLayerList) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        }\n      }\n      this.selectAllCheck$.next(true);\n    } else {\n      for (const layer of this.layers) {\n        layer.options.check = false;\n      }\n      this.layersChecked = [];\n      this.selectAllCheck$.next(false);\n    }\n  }\n\n  isScrolledIntoView(elemSource, elem) {\n    const docViewTop = elemSource.scrollTop;\n    const docViewBottom = docViewTop + elemSource.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.clientHeight;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  removeProblemLayerInList(layersList: Layer[]): Layer[] {\n    for (const layer of layersList) {\n      if (layer.olLoadingProblem === true) {\n        this.map.removeLayer(layer);\n      }\n    }\n    return layersList;\n  }\n}\n","<mat-form-field class=\"inputFilter\" [floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.layer.filterPlaceholder' | translate\"\n    [matTooltip]=\"'igo.geo.layer.subsetLayersListKeyword' | translate\"\n    matTooltipShowDelay=\"500\"\n    type=\"text\"\n    [(ngModel)]=\"term\"\n  />\n  <button\n    *ngIf=\"term\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    color=\"warn\"\n    (click)=\"clearTerm()\"\n  >\n    <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n</mat-form-field>\n\n<div class=\"actions-container\">\n  <button\n    class=\"sort-alpha\"\n    [color]=\"sortAlpha ? 'warn' : 'primary'\"\n    mat-icon-button\n    [matTooltip]=\"\n      sortAlpha\n        ? ('igo.geo.layer.sortMapOrder' | translate)\n        : ('igo.geo.layer.sortAlphabetically' | translate)\n    \"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleSortAlpha()\"\n  >\n    <mat-icon\n      [svgIcon]=\"sortAlpha ? 'sort-ascending' : 'sort-alphabetical-ascending'\"\n    ></mat-icon>\n  </button>\n\n  <button\n    class=\"only-visible\"\n    mat-icon-button\n    [disabled]=\"layersAreAllVisible && !onlyVisible\"\n    [color]=\"onlyVisible ? 'warn' : 'primary'\"\n    [matTooltip]=\"\n      onlyVisible\n        ? ('igo.geo.layer.resetLayersList' | translate)\n        : ('igo.geo.layer.subsetLayersListOnlyVisible' | translate)\n    \"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleOnlyVisible()\"\n  >\n    <mat-icon\n      aria-hidden=\"false\"\n      matBadge=\"icon\"\n      igoMatBadgeIcon=\"eye\"\n      igoMatBadgeInverseColor=\"true\"\n      igoMatBadgeInheritColor=\"true\"\n      [svgIcon]=\"onlyVisible ? 'filter-remove' : 'filter'\"\n    >\n    </mat-icon>\n  </button>\n\n  <button\n    class=\"selection-mode\"\n    mat-icon-button\n    color=\"primary\"\n    [matTooltip]=\"\n      selectionMode\n        ? ('igo.geo.layer.deactivateSelectionMode' | translate)\n        : ('igo.geo.layer.activateSelectionMode' | translate)\n    \"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleSelectionMode()\"\n  >\n    <mat-icon\n      [svgIcon]=\"\n        selectionMode\n          ? 'checkbox-multiple-marked-outline'\n          : 'checkbox-multiple-blank-outline'\n      \"\n    ></mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit,\n  EventEmitter,\n  Output,\n  OnDestroy\n} from '@angular/core';\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LayerListControlsOptions } from './layer-list-tool.interface';\n\n@Component({\n  selector: 'igo-layer-list-tool',\n  templateUrl: './layer-list-tool.component.html',\n  styleUrls: ['./layer-list-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerListToolComponent implements OnInit, OnDestroy {\n  public onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public term$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n  onlyVisible$$: Subscription;\n  sortAlpha$$: Subscription;\n  term$$: Subscription;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input()\n  set onlyVisible(value: boolean) {\n    this.onlyVisible$.next(value);\n  }\n  get onlyVisible(): boolean {\n    return this.onlyVisible$.value;\n  }\n\n  @Input()\n  set sortAlpha(value: boolean) {\n    this.sortAlpha$.next(value);\n  }\n  get sortAlpha(): boolean {\n    return this.sortAlpha$.value;\n  }\n\n  @Input()\n  set term(value: string) {\n    this.term$.next(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n\n  public selectionMode = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n  @Output() selection = new EventEmitter<boolean>();\n\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe((keyword) => {\n      this.appliedFilterAndSort.emit({\n        keyword,\n        onlyVisible: this.onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n\n    this.onlyVisible$$ = this.onlyVisible$.subscribe((onlyVisible) => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n    this.sortAlpha$$ = this.sortAlpha$.subscribe((sortAlpha) => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible: this.onlyVisible,\n        sortAlpha\n      });\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.onlyVisible$$.unsubscribe();\n    this.sortAlpha$$.unsubscribe();\n    this.term$$.unsubscribe();\n  }\n\n  clearTerm() {\n    this.term = undefined;\n  }\n  toggleSortAlpha() {\n    this.sortAlpha = !this.sortAlpha;\n  }\n\n  toggleOnlyVisible() {\n    this.onlyVisible = !this.onlyVisible;\n  }\n\n  toggleSelectionMode() {\n    this.selectionMode = !this.selectionMode;\n    this.selection.emit(this.selectionMode);\n  }\n}\n","<div class=\"layer-legend-list-container\">\n  <mat-slide-toggle\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.layer.legend.showAll' | translate\"\n    [checked]=\"showAllLegendsValue\"\n    class=\"mat-typography\"\n    *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"\n    [labelPosition]=\"'before'\"\n    (change)=\"toggleShowAllLegends($event.checked)\"\n  >\n    {{ 'igo.geo.layer.legend.showAll' | translate }}\n  </mat-slide-toggle>\n  <mat-divider\n    *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"\n  ></mat-divider>\n  <igo-list [navigation]=\"false\" [selection]=\"false\">\n    <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n      <igo-layer-legend-item\n        *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n        igoListItem\n        [layer]=\"layer\"\n        [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      >\n      </igo-layer-legend-item>\n    </ng-template>\n  </igo-list>\n  <p\n    class=\"layers-empty mat-typography\"\n    *ngIf=\"\n      !showAllLegendsValue &&\n      (layersInUi$ | async).length &&\n      (hasVisibleOrInRangeLayers$ | async) === false &&\n      (hasVisibleAndNotInRangeLayers$ | async) === false &&\n      allowShowAllLegends\n    \"\n  >\n    {{ 'igo.geo.layer.legend.noLayersVisibleWithShowAllButton' | translate }}\n  </p>\n  <p\n    class=\"layers-empty mat-typography\"\n    *ngIf=\"\n      !showAllLegendsValue &&\n      (layersInUi$ | async).length &&\n      (hasVisibleOrInRangeLayers$ | async) === false &&\n      (hasVisibleAndNotInRangeLayers$ | async) &&\n      allowShowAllLegends\n    \"\n  >\n    {{\n      'igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom' | translate\n    }}\n  </p>\n  <p\n    class=\"layers-empty mat-typography\"\n    *ngIf=\"\n      (layersInUi$ | async).length &&\n      (hasVisibleOrInRangeLayers$ | async) === false &&\n      (hasVisibleAndNotInRangeLayers$ | async) === false &&\n      !allowShowAllLegends\n    \"\n  >\n    {{ 'igo.geo.layer.legend.noLayersVisible' | translate }}\n  </p>\n  <p\n    class=\"layers-empty mat-typography\"\n    *ngIf=\"\n      (layersInUi$ | async).length &&\n      (hasVisibleOrInRangeLayers$ | async) === false &&\n      (hasVisibleAndNotInRangeLayers$ | async) &&\n      !allowShowAllLegends\n    \"\n  >\n    {{ 'igo.geo.layer.legend.noLayersVisibleButZoom' | translate }}\n  </p>\n</div>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy,\n  EventEmitter,\n  Output\n} from '@angular/core';\nimport { Layer } from '../shared';\nimport {\n  BehaviorSubject,\n  ReplaySubject,\n  Subscription,\n  EMPTY,\n  timer\n} from 'rxjs';\nimport { debounce } from 'rxjs/operators';\n\n@Component({\n  selector: 'igo-layer-legend-list',\n  templateUrl: './layer-legend-list.component.html',\n  styleUrls: ['./layer-legend-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendListComponent implements OnInit, OnDestroy {\n  orderable = true;\n\n  hasVisibleOrInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(\n    true\n  );\n  hasVisibleAndNotInRangeLayers$: BehaviorSubject<boolean> =\n    new BehaviorSubject(true);\n  layersInUi$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  showAllLegend: boolean = false;\n  public change$ = new ReplaySubject<void>(1);\n  private change$$: Subscription;\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() allowShowAllLegends: boolean = false;\n\n  @Input() showAllLegendsValue: boolean = false;\n\n  @Output() allLegendsShown = new EventEmitter<boolean>(false);\n\n  constructor() {}\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.layers.length === 0 ? EMPTY : timer(50);\n        })\n      )\n      .subscribe(() => {\n        const layers = this.computeShownLayers(this.layers.slice(0));\n        this.layers$.next(layers);\n        this.hasVisibleOrInRangeLayers$.next(\n          this.layers\n            .slice(0)\n            .filter((layer) => layer.baseLayer !== true)\n            .filter(\n              (layer) =>\n                layer.visible$.value && layer.isInResolutionsRange$.value\n            ).length > 0\n        );\n        this.hasVisibleAndNotInRangeLayers$.next(\n          this.layers\n            .slice(0)\n            .filter((layer) => layer.baseLayer !== true)\n            .filter(\n              (layer) =>\n                layer.visible$.value && !layer.isInResolutionsRange$.value\n            ).length > 0\n        );\n\n        this.layersInUi$.next(\n          this.layers\n            .slice(0)\n            .filter(\n              (layer) =>\n                layer.showInLayerList !== false &&\n                (!this.excludeBaseLayers || !layer.baseLayer)\n            )\n        );\n      });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n  }\n  private next() {\n    this.change$.next();\n  }\n  private computeShownLayers(layers: Layer[]) {\n    let shownLayers = layers.filter(\n      (layer: Layer) => layer.visible && layer.isInResolutionsRange\n    );\n    if (this.showAllLegendsValue) {\n      shownLayers = layers;\n    }\n    return this.sortLayersByZindex(shownLayers);\n  }\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  toggleShowAllLegends(toggle: boolean) {\n    this.showAllLegendsValue = toggle;\n    this.next();\n    this.allLegendsShown.emit(toggle);\n  }\n}\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { Layer, TooltipType } from '../shared/layers';\nimport { NetworkService, ConnectionState } from '@igo2/core';\n\n@Component({\n  selector: 'igo-layer-legend-item',\n  templateUrl: './layer-legend-item.component.html',\n  styleUrls: ['./layer-legend-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendItemComponent implements OnInit, OnDestroy {\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n\n  @Input() layer: Layer;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  constructor(private networkService: NetworkService) {}\n\n  ngOnInit() {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService\n      .currentState()\n      .subscribe((state: ConnectionState) => {\n        this.state = state;\n        this.onResolutionChange();\n      });\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n}\n","<mat-list-item class=\"igo-layer-list-item\">\n  <span\n    matListItemTitle\n    class=\"igo-layer-title\"\n    [matTooltip]=\"tooltipText\"\n    matTooltipShowDelay=\"500\"\n    >{{ layer.title }}</span\n  >\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  >\n  </igo-layer-legend>\n</div>\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Output\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoClickout]'\n})\nexport class ClickoutDirective {\n  @Output() clickout = new EventEmitter<MouseEvent>();\n\n  @HostListener('document:click', ['$event', '$event.target'])\n  handleMouseClick(event: MouseEvent, target: HTMLElement) {\n    if (!target) {\n      return;\n    }\n\n    if (!this.el.nativeElement.contains(target)) {\n      this.clickout.emit(event);\n    }\n  }\n\n  constructor(private el: ElementRef) {}\n}\n","import {\n  Component,\n  AfterViewInit,\n  OnInit,\n  OnDestroy,\n  Input,\n  ContentChildren,\n  HostListener,\n  ElementRef\n} from '@angular/core';\nimport type { QueryList } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport { ListItemDirective } from './list-item.directive';\n\n@Component({\n  selector: 'igo-list',\n  templateUrl: './list.component.html',\n  styleUrls: ['./list.component.scss']\n})\nexport class ListComponent implements AfterViewInit, OnInit, OnDestroy {\n  @Input()\n  get navigation() {\n    return this._navigation;\n  }\n  set navigation(value: boolean) {\n    this._navigation = value;\n  }\n  private _navigation = true;\n\n  @Input()\n  get selection() {\n    return this._selection;\n  }\n  set selection(value: boolean) {\n    this._selection = value;\n  }\n  private _selection = true;\n\n  get selectedItem() {\n    return this._selectedItem;\n  }\n  set selectedItem(value: ListItemDirective) {\n    this.focusedItem = value;\n    this._selectedItem = value;\n  }\n  private _selectedItem: ListItemDirective;\n\n  get focusedItem() {\n    return this._focusedItem;\n  }\n  set focusedItem(value: ListItemDirective) {\n    this._focusedItem = value;\n  }\n  private _focusedItem: ListItemDirective;\n\n  private navigationEnabled: boolean;\n  private listItems$$: Subscription;\n  private subscriptions: Subscription[] = [];\n\n  @ContentChildren(ListItemDirective, { descendants: true })\n  listItems: QueryList<ListItemDirective>;\n\n  @HostListener('document:keydown', ['$event'])\n  @HostListener('document:enter', ['$event'])\n  handleKeyboardEvent(event: KeyboardEvent) {\n    // It would be nice to be able to unsubscribe to the event\n    // completely but until ES7 this won't be possible because\n    // document events are not observables\n    if (this.navigationEnabled) {\n      if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {\n        event.preventDefault();\n        this.navigate(event.key);\n      } else if (event.key === 'Enter') {\n        this.select(this.focusedItem);\n      }\n    }\n  }\n\n  constructor(private el: ElementRef) {}\n\n  ngOnInit() {\n    this.enableNavigation();\n  }\n\n  ngAfterViewInit() {\n    if (this.listItems.length) {\n      this.init();\n    }\n\n    this.listItems$$ = this.listItems.changes.subscribe(\n      (items: ListItemDirective[]) => this.init()\n    );\n  }\n\n  ngOnDestroy() {\n    this.listItems$$.unsubscribe();\n  }\n\n  focus(item?: ListItemDirective) {\n    if (!this.selection) {\n      return;\n    }\n\n    this.unfocus();\n\n    // We need to make this check because dynamic\n    // lists such as in the search results list may fail\n    if (item !== undefined) {\n      item.focused = true;\n    }\n  }\n\n  unfocus() {\n    if (this.focusedItem !== undefined) {\n      this.focusedItem.focused = false;\n    }\n\n    this.focusedItem = undefined;\n  }\n\n  focusNext() {\n    const items = this.listItems.toArray();\n    let item;\n    const igoList = this.el.nativeElement;\n    let disabled = true;\n    let index = this.getFocusedIndex();\n    if (index === undefined) {\n      index = -1;\n    }\n\n    while (disabled && index < items.length - 1) {\n      index += 1;\n      item = items[index];\n      disabled = item.disabled;\n    }\n\n    if (item !== undefined) {\n      this.focus(item);\n    }\n\n    if (!items[index + 1]) {\n      igoList.scrollTop = igoList.scrollHeight - igoList.clientHeight;\n      return;\n    }\n\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\n      igoList.scrollTop =\n        item.el.nativeElement.offsetTop +\n        item.el.nativeElement.children[0].offsetHeight -\n        igoList.clientHeight;\n    }\n  }\n\n  focusPrevious() {\n    const items = this.listItems.toArray();\n    let item: ListItemDirective;\n    const igoList = this.el.nativeElement;\n    let disabled = true;\n    let index = this.getFocusedIndex();\n\n    while (disabled && index > 0) {\n      index -= 1;\n      item = items[index];\n      disabled = item.disabled;\n    }\n\n    if (item !== undefined) {\n      this.focus(item);\n    }\n\n    if (!items[index - 1]) {\n      igoList.scrollTop = 0;\n      return;\n    }\n\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\n      const padding = 3;\n      igoList.scrollTop = item.el.nativeElement.offsetTop - padding;\n    }\n  }\n\n  select(item?: ListItemDirective) {\n    if (!this.selection) {\n      return;\n    }\n\n    this.unselect();\n\n    if (item !== undefined) {\n      item.selected = true;\n    }\n  }\n\n  unselect() {\n    this.unfocus();\n\n    if (this.selectedItem !== undefined) {\n      this.selectedItem.selected = false;\n    }\n\n    this.selectedItem = undefined;\n  }\n\n  enableNavigation() {\n    if (this.navigation) {\n      this.navigationEnabled = true;\n    }\n  }\n\n  disableNavigation() {\n    this.navigationEnabled = false;\n  }\n\n  scrollToItem(item: ListItemDirective) {\n    this.el.nativeElement.scrollTop = item.getOffsetTop();\n  }\n\n  isScrolledIntoView(elem) {\n    const docViewTop =\n      this.el.nativeElement.scrollTop + this.el.nativeElement.offsetTop;\n    const docViewBottom = docViewTop + this.el.nativeElement.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.children[0].offsetHeight;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  private init() {\n    this.subscribe();\n\n    this.selectedItem = this.findSelectedItem();\n    this.focusedItem = this.findFocusedItem();\n\n    this.enableNavigation();\n  }\n\n  private subscribe() {\n    this.unsubscribe();\n\n    this.listItems.toArray().forEach((item) => {\n      this.subscriptions.push(\n        item.beforeSelect.subscribe((item2: ListItemDirective) =>\n          this.handleItemBeforeSelect(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.select.subscribe((item2: ListItemDirective) =>\n          this.handleItemSelect(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.beforeFocus.subscribe((item2: ListItemDirective) =>\n          this.handleItemBeforeFocus(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.focus.subscribe((item2: ListItemDirective) =>\n          this.handleItemFocus(item2)\n        )\n      );\n    }, this);\n  }\n\n  private unsubscribe() {\n    this.subscriptions.forEach((sub: Subscription) => sub.unsubscribe());\n    this.subscriptions = [];\n  }\n\n  private handleItemBeforeFocus(item: ListItemDirective) {\n    if (item !== this.focusedItem) {\n      this.unfocus();\n    }\n  }\n\n  private handleItemFocus(item: ListItemDirective) {\n    this.focusedItem = item;\n  }\n\n  private handleItemBeforeSelect(item: ListItemDirective) {\n    if (item !== this.focusedItem) {\n      this.unselect();\n    }\n  }\n\n  private handleItemSelect(item: ListItemDirective) {\n    this.selectedItem = item;\n  }\n\n  private findSelectedItem() {\n    return this.listItems.toArray().find((item) => item.selected);\n  }\n\n  private findFocusedItem() {\n    return this.listItems.toArray().find((item) => item.focused);\n  }\n\n  private getFocusedIndex() {\n    return this.listItems\n      .toArray()\n      .findIndex((item) => item === this.focusedItem);\n  }\n\n  private navigate(key: string) {\n    switch (key) {\n      case 'ArrowUp':\n        this.focusPrevious();\n        break;\n      case 'ArrowDown':\n        this.focusNext();\n        break;\n      default:\n        break;\n    }\n  }\n}\n","<mat-list\n  igoClickout\n  [ngClass]=\"{ selectable: selection }\"\n  (clickout)=\"disableNavigation()\"\n  (click)=\"enableNavigation()\"\n>\n  <ng-content></ng-content>\n</mat-list>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatMenuModule } from '@angular/material/menu';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatSliderModule } from '@angular/material/slider';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport {\r\n  IgoListModule,\r\n  IgoCollapsibleModule,\r\n  IgoImageModule,\r\n  IgoPanelModule,\r\n  IgoMatBadgeIconModule,\r\n  IgoCustomHtmlModule\r\n} from '@igo2/common';\r\n\r\nimport { LayerService } from './shared/layer.service';\r\nimport { StyleService } from '../style/style-service/style.service';\r\nimport { LayerListToolService } from './layer-list-tool/layer-list-tool.service';\r\nimport { LayerItemComponent } from './layer-item/layer-item.component';\r\nimport { LayerLegendComponent } from './layer-legend/layer-legend.component';\r\nimport { LayerListComponent } from './layer-list/layer-list.component';\r\nimport { LayerListToolComponent } from './layer-list-tool/layer-list-tool.component';\r\nimport { LayerListBindingDirective } from './layer-list/layer-list-binding.directive';\r\nimport { LayerLegendListBindingDirective } from './layer-legend-list/layer-legend-list-binding.directive';\r\nimport { TrackFeatureButtonComponent } from './track-feature-button/track-feature-button.component';\r\nimport { LayerLegendListComponent } from './layer-legend-list/layer-legend-list.component';\r\nimport { LayerLegendItemComponent } from './layer-legend-item/layer-legend-item.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    MatInputModule,\r\n    ReactiveFormsModule,\r\n    MatFormFieldModule,\r\n    CommonModule,\r\n    FormsModule,\r\n    MatDividerModule,\r\n    MatMenuModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatSlideToggleModule,\r\n    MatSelectModule,\r\n    MatTooltipModule,\r\n    MatListModule,\r\n    MatSliderModule,\r\n    MatBadgeModule,\r\n    MatCheckboxModule,\r\n    IgoLanguageModule,\r\n    IgoListModule,\r\n    IgoCollapsibleModule,\r\n    IgoImageModule,\r\n    IgoPanelModule,\r\n    IgoMatBadgeIconModule,\r\n    IgoCustomHtmlModule\r\n  ],\r\n  exports: [\r\n    LayerItemComponent,\r\n    LayerLegendItemComponent,\r\n    LayerLegendComponent,\r\n    LayerListComponent,\r\n    LayerListToolComponent,\r\n    LayerLegendListComponent,\r\n    LayerListBindingDirective,\r\n    LayerLegendListBindingDirective,\r\n    TrackFeatureButtonComponent\r\n  ],\r\n  declarations: [\r\n    LayerItemComponent,\r\n    LayerLegendItemComponent,\r\n    LayerLegendComponent,\r\n    LayerListComponent,\r\n    LayerListToolComponent,\r\n    LayerLegendListComponent,\r\n    LayerListBindingDirective,\r\n    LayerLegendListBindingDirective,\r\n    TrackFeatureButtonComponent\r\n  ]\r\n})\r\nexport class IgoLayerModule {\r\n  static forRoot(): ModuleWithProviders<IgoLayerModule> {\r\n    return {\r\n      ngModule: IgoLayerModule,\r\n      providers: [LayerService, StyleService, LayerListToolService]\r\n    };\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoMatBadgeIconModule,\n  IgoCollapsibleModule,\n  IgoListModule\n} from '@igo2/common';\n\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\nimport { CatalogBrowserComponent } from './catalog-browser.component';\nimport { CatalogBrowserLayerComponent } from './catalog-browser-layer.component';\nimport { CatalogBrowserGroupComponent } from './catalog-browser-group.component';\nimport { IgoLayerModule } from '../../layer/layer.module';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatButtonModule,\n    MatIconModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoMatBadgeIconModule,\n    IgoLanguageModule,\n    IgoListModule,\n    IgoCollapsibleModule,\n    IgoMetadataModule,\n    IgoLayerModule\n  ],\n  exports: [CatalogBrowserComponent],\n  declarations: [\n    CatalogBrowserComponent,\n    CatalogBrowserGroupComponent,\n    CatalogBrowserLayerComponent\n  ]\n})\nexport class IgoCatalogBrowserModule {}\n","<h1 mat-dialog-title class=\"mat-typography\">\n  {{ 'igo.geo.catalog.library.addTitle' | translate }}\n</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input\n          type=\"text\"\n          formControlName=\"title\"\n          placeholder=\"{{ 'igo.geo.printForm.title' | translate }}\"\n          matInput\n          [matAutocomplete]=\"auto2\"\n        />\n        <mat-autocomplete\n          #auto2=\"matAutocomplete\"\n          (optionSelected)=\"changeUrlOrTitle($event.option.value)\"\n        >\n          <mat-option\n            *ngFor=\"let predefinedCatalog of predefinedCatalogsList$ | async\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.title\"\n            [value]=\"predefinedCatalog\"\n          >\n            {{ predefinedCatalog.title }}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input\n          type=\"text\"\n          formControlName=\"url\"\n          placeholder=\"URL\"\n          matInput\n          [matAutocomplete]=\"auto\"\n        />\n        <mat-autocomplete\n          #auto=\"matAutocomplete\"\n          (optionSelected)=\"changeUrlOrTitle($event.option.value)\"\n        >\n          <mat-option\n            *ngFor=\"let predefinedCatalog of predefinedCatalogsList$ | async\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.url\"\n            [value]=\"predefinedCatalog\"\n          >\n            {{ predefinedCatalog.url }}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <mat-select formControlName=\"type\" placeholder=\"Type\">\n          <mat-option\n            *ngFor=\"let type of typeCapabilities\"\n            [value]=\"type\"\n            (click)=\"$event.stopPropagation()\"\n          >\n            <p matListItemTitle>{{ type }}</p>\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </form>\n  <span *ngIf=\"error && addedCatalog && emailAddress\">\n    <p class=\"error\">\n      {{\n        languageService.translate.instant(\n          'igo.geo.catalog.externalProvider.unavailableWithEmail',\n          { value: addedCatalog.url, email: emailAddress }\n        )\n      }}\n    </p>\n  </span>\n  <span *ngIf=\"error && addedCatalog && !emailAddress\">\n    <p class=\"error\">\n      {{\n        languageService.translate.instant('igo.geo.catalog.unavailable', {\n          value: addedCatalog.url\n        })\n      }}\n    </p>\n  </span>\n</div>\n<div mat-dialog-actions style=\"justify-content: center\">\n  <div class=\"igo-form-button-group add-catalog-button-top-padding\">\n    <button mat-raised-button type=\"button\" (click)=\"cancel()\">\n      {{ 'igo.geo.catalog.library.cancel' | translate }}\n    </button>\n    <button\n      id=\"addCatalogBtnDialog\"\n      mat-raised-button\n      type=\"button\"\n      color=\"primary\"\n      [disabled]=\"!form.valid\"\n      (click)=\"addCatalog(form.value)\"\n    >\n      {{ 'igo.geo.catalog.library.add' | translate }}\n    </button>\n  </div>\n</div>\n","import { LanguageService, ConfigService } from '@igo2/core';\nimport { Component, OnInit, OnDestroy, Optional, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport {\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { EntityStore } from '@igo2/common';\nimport { TypeCapabilities } from '../../datasource';\nimport { Catalog } from '../shared/catalog.abstract';\n\n@Component({\n  selector: 'igo-add-catalog-dialog',\n  templateUrl: './add-catalog-dialog.component.html',\n  styleUrls: ['./add-catalog-dialog.component.scss']\n})\nexport class AddCatalogDialogComponent implements OnInit, OnDestroy {\n  public form: UntypedFormGroup;\n  private defaultAddedCatalogType = 'wms';\n  private addedCatalogType$$: Subscription;\n  public predefinedCatalogsList$ = new BehaviorSubject<Catalog[]>([]);\n  typeCapabilities: string[];\n  predefinedCatalogs: Catalog[] = [];\n  store: EntityStore<Catalog>;\n  error = false;\n  addedCatalog: Catalog;\n  emailAddress: string;\n  private storeViewAll$$: Subscription;\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    public languageService: LanguageService,\n    private configService: ConfigService,\n    public dialogRef: MatDialogRef<AddCatalogDialogComponent>,\n    @Optional()\n    @Inject(MAT_DIALOG_DATA)\n    public data: {\n      predefinedCatalogs: Catalog[];\n      store: EntityStore<Catalog>;\n      error: boolean;\n      addedCatalog: Catalog;\n    }\n  ) {\n    this.store = data.store;\n    this.predefinedCatalogs = data.predefinedCatalogs;\n    this.error = data.error;\n    this.addedCatalog = data.addedCatalog;\n    this.form = this.formBuilder.group({\n      id: ['', []],\n      title: ['', []],\n      url: ['', [Validators.required]],\n      type: [this.defaultAddedCatalogType, [Validators.required]]\n    });\n  }\n\n  ngOnInit() {\n    this.store.state.clear();\n    this.typeCapabilities = Object.keys(TypeCapabilities);\n\n    this.addedCatalogType$$ = this.form\n      .get('type')\n      .valueChanges.subscribe((value) => {\n        if (value === 'wmts') {\n          this.form.get('title').setValidators(Validators.required);\n        } else {\n          this.form.get('title').setValidators([]);\n        }\n        this.form.get('title').updateValueAndValidity();\n      });\n\n    this.computePredefinedCatalogList();\n    this.storeViewAll$$ = this.store.view\n      .all$()\n      .subscribe(() => this.computePredefinedCatalogList());\n\n    this.emailAddress = this.configService.getConfig('emailAddress');\n  }\n\n  ngOnDestroy() {\n    this.addedCatalogType$$.unsubscribe();\n    this.storeViewAll$$.unsubscribe();\n  }\n\n  changeUrlOrTitle(catalog: Catalog) {\n    this.form.patchValue(catalog);\n    this.error = false;\n    this.computePredefinedCatalogList();\n  }\n\n  computePredefinedCatalogList() {\n    this.predefinedCatalogsList$.next(\n      this.predefinedCatalogs.filter((c) => !this.store.get(c.id))\n    );\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    this.error = false;\n    this.dialogRef.close(addedCatalog);\n  }\n\n  cancel() {\n    this.error = false;\n    this.dialogRef.close();\n  }\n}\n","<igo-list [navigation]=\"false\">\n  <ng-template ngFor let-catalog [ngForOf]=\"getCatalogs() | async\">\n    <igo-catalog-library-item\n      igoListItem\n      color=\"accent\"\n      [map]=\"map\"\n      [catalog]=\"catalog\"\n      (catalogRemove)=\"onCatalogRemove(catalog)\"\n      (select)=\"onCatalogSelect(catalog)\"\n    >\n    </igo-catalog-library-item>\n  </ng-template>\n</igo-list>\n\n<div *ngIf=\"addCatalogAllowed\" class=\"btnAddCatalog\">\n  <button\n    mat-raised-button\n    [matTooltip]=\"'igo.geo.catalog.library.addBtn' | translate\"\n    matTooltipPosition=\"above\"\n    color=\"primary\"\n    (click)=\"addCatalogDialog()\"\n  >\n    {{ 'igo.geo.catalog.library.addBtn' | translate }}\n    <mat-icon svgIcon=\"earth-plus\"></mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { EntityStore } from '@igo2/common';\nimport { MessageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\nimport { Observable, Subscription } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { Md5 } from 'ts-md5';\nimport { CapabilitiesService } from '../../datasource';\nimport { IgoMap } from '../../map/shared';\nimport { standardizeUrl } from '../../utils/id-generator';\nimport { Catalog } from '../shared/catalog.abstract';\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\n\n/**\n * Component to browse a list of available catalogs\n */\n@Component({\n  selector: 'igo-catalog-library',\n  templateUrl: './catalog-library.component.html',\n  styleUrls: ['./catalog-library.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogLibaryComponent implements OnInit, OnDestroy {\n  /**\n   * Store holding the catalogs\n   */\n  @Input() store: EntityStore<Catalog>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() addCatalogAllowed: boolean = false;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() predefinedCatalogs: Catalog[] = [];\n\n  /**\n   * Event emitted a catalog is selected or unselected\n   */\n  @Output() catalogSelectChange = new EventEmitter<{\n    selected: boolean;\n    catalog: Catalog;\n  }>();\n\n  submitDisabled = true;\n  private addingCatalog$$: Subscription;\n\n  get addedCatalogs(): Catalog[] {\n    return (this.storageService.get('addedCatalogs') || []) as Catalog[];\n  }\n  set addedCatalogs(catalogs: Catalog[]) {\n    this.storageService.set('addedCatalogs', catalogs);\n  }\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private messageService: MessageService,\n    private storageService: StorageService,\n    private dialog: MatDialog\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.state.clear();\n\n    this.predefinedCatalogs = this.predefinedCatalogs.map((c) => {\n      c.id = Md5.hashStr((c.type || 'wms') + standardizeUrl(c.url)) as string;\n      c.title = c.title === '' || !c.title ? c.url : c.title;\n      return c;\n    });\n  }\n\n  getCatalogs(): Observable<Catalog[]> {\n    return this.store.view.all$();\n  }\n\n  /**\n   * When a catalog is selected, update it's state in the store\n   * and emit the catalog select change event\n   * @internal\n   */\n  onCatalogSelect(catalog: Catalog) {\n    this.store.state.update(\n      catalog,\n      {\n        selected: true,\n        focused: true\n      },\n      true\n    );\n    this.catalogSelectChange.emit({ selected: true, catalog });\n  }\n\n  private unsubscribeAddingCatalog() {\n    if (this.addingCatalog$$) {\n      this.addingCatalog$$.unsubscribe();\n    }\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    if (!addedCatalog) {\n      return;\n    }\n    let id = Md5.hashStr(\n      addedCatalog.type + standardizeUrl(addedCatalog.url)\n    ) as string;\n    const predefinedCatalog = this.predefinedCatalogs.find(\n      (c) => c.id === addedCatalog.id\n    );\n\n    if (predefinedCatalog) {\n      addedCatalog.version = predefinedCatalog.version;\n      addedCatalog.externalProvider = predefinedCatalog.externalProvider;\n      id = predefinedCatalog.id;\n    }\n\n    if (this.store.get(id)) {\n      this.messageService.alert(\n        'igo.geo.catalog.library.inlist.message',\n        'igo.geo.catalog.library.inlist.title'\n      );\n      return;\n    }\n    this.unsubscribeAddingCatalog();\n\n    this.addingCatalog$$ = this.capabilitiesService\n      .getCapabilities(\n        addedCatalog.type as any,\n        addedCatalog.url,\n        addedCatalog.version\n      )\n      .pipe(\n        catchError((e) => {\n          if (e.error) {\n            this.addCatalogDialog(true, addedCatalog);\n            e.error.caught = true;\n            return e;\n          }\n          this.messageService.error(\n            'igo.geo.catalog.unavailable',\n            'igo.geo.catalog.unavailableTitle',\n            undefined,\n            { value: addedCatalog.url }\n          );\n          throw e;\n        })\n      )\n      .subscribe((capabilities) => {\n        let title;\n        let version;\n        switch (addedCatalog.type) {\n          case 'wms':\n            title = addedCatalog.title || capabilities.Service.Title;\n            version = addedCatalog.version || capabilities.version;\n            break;\n          case 'arcgisrest':\n          case 'imagearcgisrest':\n          case 'tilearcgisrest':\n            title = addedCatalog.title || capabilities.mapName;\n            break;\n          case 'wmts':\n            title =\n              addedCatalog.title ||\n              capabilities.ServiceIdentification.ServiceType;\n            break;\n          default:\n            title = addedCatalog.title;\n        }\n\n        const catalogToAdd = ObjectUtils.removeUndefined(\n          Object.assign(\n            {},\n            predefinedCatalog,\n            ObjectUtils.removeUndefined({\n              id,\n              title,\n              url: addedCatalog.url,\n              type: addedCatalog.type || 'wms',\n              externalProvider: addedCatalog.externalProvider || false,\n              removable: true,\n              version\n            })\n          ) as Catalog\n        );\n        this.store.insert(catalogToAdd);\n        const newCatalogs = this.addedCatalogs.slice(0);\n        newCatalogs.push(catalogToAdd);\n        this.addedCatalogs = newCatalogs;\n        this.unsubscribeAddingCatalog();\n      });\n  }\n\n  ngOnDestroy() {\n    this.unsubscribeAddingCatalog();\n  }\n\n  onCatalogRemove(catalog) {\n    this.store.delete(catalog);\n    this.addedCatalogs = this.addedCatalogs\n      .slice(0)\n      .filter((c) => c.id !== catalog.id);\n  }\n\n  addCatalogDialog(error?, addedCatalog?: Catalog) {\n    const dialogRef = this.dialog.open(AddCatalogDialogComponent, {\n      width: '700px',\n      data: {\n        predefinedCatalogs: this.predefinedCatalogs,\n        store: this.store,\n        error,\n        addedCatalog\n      }\n    });\n\n    dialogRef.afterClosed().subscribe((catalog) => {\n      this.addCatalog(catalog);\n    });\n  }\n}\n","<mat-list-item>\n  <span matListItemTitle>\n    {{ title }}\n  </span>\n  <div matListItemMeta>\n    <mat-icon\n      *ngIf=\"catalog.externalProvider\"\n      matListItemIcon\n      class=\"igo-external-provider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.catalog' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n      svgIcon=\"earth-arrow-right\"\n    >\n    </mat-icon>\n    <button\n      *ngIf=\"catalog.removable\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.library.remove' | translate\"\n      color=\"warn\"\n      (click)=\"removeCatalogFromLibrary($event)\"\n    >\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"igo-blank\"\n      *ngIf=\"!catalog.removable\"\n      disabled=\"true\"\n      mat-icon-button\n    >\n      <mat-icon svgIcon=\"blank\"></mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter\n} from '@angular/core';\n\nimport { getEntityTitle } from '@igo2/common';\nimport { IgoMap } from '../../map/shared';\nimport { Catalog } from '../shared/catalog.abstract';\n\n/**\n * Catalog library item\n */\n@Component({\n  selector: 'igo-catalog-library-item',\n  templateUrl: './catalog-library-item.component.html',\n  styleUrls: ['./catalog-library-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogLibaryItemComponent {\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  @Output() catalogRemove = new EventEmitter();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.catalog);\n  }\n\n  removeCatalogFromLibrary(event) {\n    event.stopPropagation();\n    this.catalogRemove.emit();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoListModule } from '@igo2/common';\n\nimport { CatalogLibaryComponent } from './catalog-library.component';\nimport { CatalogLibaryItemComponent } from './catalog-library-item.component';\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatDialogModule } from '@angular/material/dialog';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatBadgeModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoListModule,\n    IgoLanguageModule,\n    MatButtonModule,\n    MatFormFieldModule,\n    ReactiveFormsModule,\n    MatInputModule,\n    MatSelectModule,\n    MatAutocompleteModule,\n    MatDialogModule\n  ],\n  exports: [CatalogLibaryComponent, AddCatalogDialogComponent],\n  declarations: [\n    CatalogLibaryComponent,\n    CatalogLibaryItemComponent,\n    AddCatalogDialogComponent\n  ]\n})\nexport class IgoCatalogLibraryModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport {\n  IgoListModule,\n  IgoCollapsibleModule,\n  IgoMatBadgeIconModule\n} from '@igo2/common';\n\nimport { IgoCatalogBrowserModule } from './catalog-browser/catalog-browser.module';\nimport { IgoCatalogLibraryModule } from './catalog-library/catalog-library.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatIconModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoMatBadgeIconModule,\n    IgoListModule,\n    IgoCollapsibleModule\n  ],\n  exports: [IgoCatalogBrowserModule, IgoCatalogLibraryModule],\n  declarations: []\n})\nexport class IgoCatalogModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { DownloadButtonComponent } from './download-button/download-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule\n  ],\n  exports: [DownloadButtonComponent],\n  declarations: [DownloadButtonComponent]\n})\nexport class IgoDownloadModule {\n  static forRoot(): ModuleWithProviders<IgoDownloadModule> {\n    return {\n      ngModule: IgoDownloadModule\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatBadgeModule } from '@angular/material/badge';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { MatCheckboxModule } from '@angular/material/checkbox';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoEntityTableModule } from '@igo2/common';\r\nimport { DrawComponent } from './draw.component';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { DrawPopupComponent } from './draw-popup.component';\r\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\r\nimport { DrawLayerPopupComponent } from './draw-layer-popup.component';\r\n\r\nimport { BrowserModule } from '@angular/platform-browser';\r\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\r\n\r\nimport { MatRadioModule } from '@angular/material/radio';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    MatDividerModule,\r\n    MatFormFieldModule,\r\n    MatIconModule,\r\n    MatBadgeModule,\r\n    MatTooltipModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatListModule,\r\n    MatSelectModule,\r\n    MatSlideToggleModule,\r\n    MatDialogModule,\r\n    IgoLanguageModule,\r\n    IgoEntityTableModule,\r\n    BrowserModule,\r\n    BrowserAnimationsModule,\r\n    MatRadioModule,\r\n    MatCheckboxModule\r\n  ],\r\n  declarations: [\r\n    DrawComponent,\r\n    DrawPopupComponent,\r\n    DrawLayerPopupComponent,\r\n    DrawShorcutsComponent\r\n  ],\r\n  exports: [DrawComponent]\r\n})\r\nexport class IgoDrawModule {}\r\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule, IgoImageModule } from '@igo2/common';\n\nimport { FeatureDetailsComponent } from './feature-details.component';\nimport { FeatureDetailsDirective } from './feature-details.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    IgoLanguageModule,\n    IgoKeyValueModule,\n    IgoImageModule\n  ],\n  exports: [FeatureDetailsComponent, FeatureDetailsDirective],\n  declarations: [FeatureDetailsComponent, FeatureDetailsDirective]\n})\nexport class IgoFeatureDetailsModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFormModule } from '@igo2/common';\n\nimport { FeatureFormComponent } from './feature-form.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [CommonModule, IgoFormModule],\n  exports: [IgoFormModule, FeatureFormComponent],\n  declarations: [FeatureFormComponent]\n})\nexport class IgoFeatureFormModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFeatureDetailsModule } from './feature-details/feature-details.module';\nimport { IgoFeatureFormModule } from './feature-form/feature-form.module';\n\n@NgModule({\n  imports: [CommonModule],\n  exports: [IgoFeatureDetailsModule, IgoFeatureFormModule],\n  declarations: [],\n  providers: []\n})\nexport class IgoFeatureModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { GeometryFormFieldComponent } from './geometry-form-field.component';\nimport { GeometryFormFieldInputComponent } from './geometry-form-field-input.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    IgoLanguageModule\n  ],\n  exports: [GeometryFormFieldComponent, GeometryFormFieldInputComponent],\n  declarations: [GeometryFormFieldComponent, GeometryFormFieldInputComponent]\n})\nexport class IgoGeometryFormFieldModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoGeometryFormFieldModule } from './geometry-form-field/geometry-form-field.module';\n\n@NgModule({\n  imports: [CommonModule, IgoGeometryFormFieldModule],\n  exports: [IgoGeometryFormFieldModule],\n  declarations: [],\n  providers: []\n})\nexport class IgoGeometryModule {}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\nimport { TimeFilterableDataSource } from '../../datasource';\n\n@Pipe({\n  name: 'filterableDataSource'\n})\nexport class FilterableDataSourcePipe implements PipeTransform {\n  transform(value: Layer[], arg: string): Layer[] {\n    let layers;\n\n    if (arg === 'time') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as TimeFilterableDataSource;\n        return (\n          this.isTimeFilterable(datasource) &&\n          datasource.options.timeFilter !== undefined &&\n          Object.keys(datasource.options.timeFilter).length\n        );\n      });\n    }\n    if (arg === 'ogc') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as OgcFilterableDataSource;\n        return this.isOgcFilterable(datasource);\n      });\n    }\n    return layers;\n  }\n\n  private isTimeFilterable(dataSource: TimeFilterableDataSource) {\n    if (dataSource.options.type !== 'wms') {\n      return false;\n    }\n    return dataSource.options.timeFilterable;\n  }\n\n  private isOgcFilterable(dataSource: OgcFilterableDataSource): boolean {\n    let isOgcFilterable = false;\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      dataSource.options.ogcFilters.editable\n    ) {\n      isOgcFilterable = true;\n    }\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      (dataSource.options.ogcFilters.pushButtons ||\n        dataSource.options.ogcFilters.checkboxes ||\n        dataSource.options.ogcFilters.radioButtons ||\n        dataSource.options.ogcFilters.select ||\n        dataSource.options.ogcFilters.autocomplete)\n    ) {\n      isOgcFilterable = true;\n    }\n    return isOgcFilterable;\n  }\n}\n","<button\n  *ngIf=\"header && options.timeFilterable && options.timeFilter\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\"\n>\n  <mat-icon\n    aria-hidden=\"false\"\n    [matBadge]=\"badge\"\n    matBadgeColor=\"warn\"\n    matBadgeSize=\"medium\"\n    svgIcon=\"history\"\n  ></mat-icon>\n</button>\n\n<div\n  #ogcFilter\n  class=\"igo-layer-actions-container\"\n  *ngIf=\"header && options.timeFilterable && options.timeFilter\"\n>\n  <igo-time-filter-item\n    *ngIf=\"timeFilterCollapse && options.timeFilter\"\n    igoListItem\n    [header]=\"false\"\n    [layer]=\"layer\"\n  >\n  </igo-time-filter-item>\n</div>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit\n} from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map/shared';\nimport { WMSDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\nimport { TimeFilterableDataSourceOptions } from '../../datasource';\n\n@Component({\n  selector: 'igo-time-filter-button',\n  templateUrl: './time-filter-button.component.html',\n  styleUrls: ['./time-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TimeFilterButtonComponent implements OnInit {\n  public options: TimeFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.timeFilter as any;\n    if (filter && filter.enabled) {\n      return 1;\n    } else {\n      return;\n    }\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: IgoMap;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean = true;\n\n  public timeFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n  }\n}\n","<div *ngIf=\"style === 'calendar' && type !== 'year'\">\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n    <mat-form-field>\n      <mat-datetimepicker-toggle\n        class=\"time-filter-mat-datetimepicker-toggle\"\n        [for]=\"datetimePicker\"\n        matSuffix\n      ></mat-datetimepicker-toggle>\n      <mat-datetimepicker\n        #datetimePicker\n        type=\"{{ type }}\"\n        openOnFocus=\"true\"\n        timeInterval=\"5\"\n      ></mat-datetimepicker>\n      <input\n        matInput\n        autocomplete=\"false\"\n        placeholder=\"{{ 'igo.geo.timeFilter.date' | translate }}\"\n        [matDatetimepicker]=\"datetimePicker\"\n        [(ngModel)]=\"date\"\n        [min]=\"min\"\n        [max]=\"max\"\n        readonly=\"readonly\"\n        (dateChange)=\"handleDateChange($event)\"\n      />\n    </mat-form-field>\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle\n          class=\"time-filter-mat-datetimepicker-toggle\"\n          [for]=\"minDatetimePicker\"\n          matSuffix\n        ></mat-datetimepicker-toggle>\n        <mat-datetimepicker\n          #minDatetimePicker\n          type=\"{{ type }}\"\n          openOnFocus=\"true\"\n          timeInterval=\"5\"\n        ></mat-datetimepicker>\n        <input\n          matInput\n          autocomplete=\"false\"\n          placeholder=\"{{ 'igo.geo.timeFilter.startDate' | translate }}\"\n          [matDatetimepicker]=\"minDatetimePicker\"\n          [(ngModel)]=\"startDate\"\n          [min]=\"min\"\n          [max]=\"getRangeMaxDate()\"\n          readonly=\"readonly\"\n          (input)=\"(startDate)\"\n          (dateChange)=\"handleDateChange($event)\"\n        />\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle\n          class=\"time-filter-mat-datetimepicker-toggle\"\n          [for]=\"maxDatetimePicker\"\n          matSuffix\n        ></mat-datetimepicker-toggle>\n        <mat-datetimepicker\n          #maxDatetimePicker\n          type=\"{{ type }}\"\n          openOnFocus=\"true\"\n          timeInterval=\"5\"\n        ></mat-datetimepicker>\n        <input\n          matInput\n          autocomplete=\"false\"\n          placeholder=\"{{ 'igo.geo.timeFilter.endDate' | translate }}\"\n          [matDatetimepicker]=\"maxDatetimePicker\"\n          [(ngModel)]=\"endDate\"\n          [min]=\"getRangeMinDate()\"\n          [max]=\"max\"\n          readonly=\"readonly\"\n          (dateChange)=\"handleDateChange($event)\"\n        />\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n\n<div *ngIf=\"style === 'calendar' && type === 'year'\">\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n    <mat-form-field>\n      <mat-select\n        placeholder=\"{{ 'igo.geo.timeFilter.date' | translate }}\"\n        [(ngModel)]=\"year\"\n        (selectionChange)=\"handleYearChange($event)\"\n      >\n        <mat-option [value]=\"year\" *ngFor=\"let year of listYears\">{{\n          year\n        }}</mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-select\n          placeholder=\"{{ 'igo.geo.timeFilter.startDate' | translate }}\"\n          [(ngModel)]=\"startYear\"\n          (selectionChange)=\"handleYearChange($event)\"\n        >\n          <mat-option\n            [value]=\"startYear\"\n            *ngFor=\"let startYear of startListYears\"\n            >{{ startYear }}</mat-option\n          >\n        </mat-select>\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-select\n          placeholder=\"{{ 'igo.geo.timeFilter.endDate' | translate }}\"\n          [(ngModel)]=\"endYear\"\n          (selectionChange)=\"handleYearChange($event)\"\n        >\n          <mat-option [value]=\"endYear\" *ngFor=\"let endYear of endListYears\">{{\n            endYear\n          }}</mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n\n<br />\n<div\n  *ngIf=\"!isRange && style === 'slider' && type === 'year'\"\n  class=\"igo-col igo-col-100 igo-col-100-m mat-typography\"\n>\n  <span>{{ startYear }}</span>\n  <!-- TODO: The 'tickInterval' property no longer exists -->\n  <mat-slider\n    id=\"time-slider\"\n    step=\"{{ step }}\"\n    [min]=\"startYear\"\n    [max]=\"endYear\"\n    [color]=\"color\"\n    thumbLabel\n    [disabled]=\"!options.enabled || !layer.visible\"\n    #ngSlider\n    ><input\n      matSliderThumb\n      [value]=\"handleSliderValue()\"\n      (input)=\"\n        handleSliderYearChange({\n          source: ngSliderThumb,\n          parent: ngSlider,\n          value: ngSliderThumb.value\n        })\n      \"\n      #ngSliderThumb=\"matSliderThumb\"\n      (change)=\"\n        handleSliderYearChange({\n          source: ngSliderThumb,\n          parent: ngSlider,\n          value: ngSliderThumb.value\n        })\n      \"\n    />\n  </mat-slider>\n  <span>{{ endYear }}</span>\n  <p *ngIf=\"options.enabled\" class=\"date-below\">{{ year }}</p>\n  <div #actions class=\"igo-layer-actions-container\">\n    <mat-slide-toggle\n      (change)=\"toggleFilterState()\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n      [color]=\"color\"\n      [checked]=\"options.enabled\"\n      [disabled]=\"!layer.visible\"\n    >\n    </mat-slide-toggle>\n    <button\n      [disabled]=\"!options.enabled || !layer.visible\"\n      mat-icon-button\n      color=\"primary\"\n      (click)=\"playYear($event)\"\n    >\n      <mat-icon svgIcon=\"{{ playIcon }}\"></mat-icon>\n    </button>\n    <button\n      [disabled]=\"!options.enabled || !layer.visible\"\n      mat-icon-button\n      color=\"primary\"\n      (click)=\"resetFilter($event)\"\n    >\n      <mat-icon svgIcon=\"{{ resetIcon }}\"></mat-icon>\n    </button>\n  </div>\n</div>\n\n<div\n  *ngIf=\"style === 'slider' && type !== 'year'\"\n  class=\"igo-col igo-col-100 igo-col-100-m\"\n>\n  <!-- TODO: The 'tickInterval' property no longer exists -->\n  <mat-slider\n    id=\"time-slider\"\n    step=\"{{ step }}\"\n    [min]=\"dateToNumber(min)\"\n    [max]=\"dateToNumber(max)\"\n    thumbLabel\n    (selectionChange)=\"handleSliderDateChange($event)\"\n    #ngSlider\n    ><input\n      matSliderThumb\n      [value]=\"handleSliderValue()\"\n      (input)=\"\n        handleSliderDateChange({\n          source: ngSliderThumb,\n          parent: ngSlider,\n          value: ngSliderThumb.value\n        })\n      \"\n      #ngSliderThumb=\"matSliderThumb\"\n    />\n  </mat-slider>\n  <p class=\"date-below\">{{ handleSliderTooltip() }}</p>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n    <mat-icon svgIcon=\"{{ playIcon }}\"></mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  OnInit,\n  Input,\n  Output,\n  EventEmitter,\n  ViewChild\n} from '@angular/core';\nimport { DateAdapter } from '@angular/material/core';\nimport { MatSlider } from '@angular/material/slider';\nimport { default as moment } from 'moment';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterOptions } from '../shared/time-filter.interface';\nimport { TimeFilterType, TimeFilterStyle } from '../shared/time-filter.enum';\n\n@Component({\n  selector: 'igo-time-filter-form',\n  templateUrl: './time-filter-form.component.html',\n  styleUrls: ['./time-filter-form.component.scss']\n})\nexport class TimeFilterFormComponent implements OnInit {\n  @Input() layer: Layer;\n\n  @Input() options: TimeFilterOptions;\n\n  public color = 'primary';\n  public date: Date;\n  public startDate: Date;\n  public endDate: Date;\n  public year: any;\n  public startYear: any;\n  public endYear: any;\n  public initStartYear: any;\n  public initEndYear: any;\n  public listYears: Array<string> = [];\n  public startListYears: Array<string> = [];\n  public endListYears: Array<string> = [];\n\n  @Input()\n  set currentValue(value: string) {\n    if (value) {\n      if (this.type !== TimeFilterType.YEAR) {\n        const valueArray = value.split('/');\n        if (valueArray.length > 0) {\n          const startDate = new Date(valueArray[0]);\n          const endDate = new Date(valueArray[1]);\n          if (!isNaN(startDate.valueOf())) {\n            this.startDate = startDate;\n          }\n          if (!isNaN(endDate.valueOf())) {\n            this.endDate = endDate;\n          }\n        }\n      }\n    }\n  }\n\n  public interval: any;\n  public playIcon = 'play-circle';\n  public resetIcon = 'replay';\n\n  @Output() change: EventEmitter<Date | [Date, Date]> = new EventEmitter();\n  @Output()\n  yearChange: EventEmitter<string | [string, string]> = new EventEmitter();\n  @ViewChild(MatSlider) mySlider;\n\n  get type(): TimeFilterType {\n    return this.options.type === undefined\n      ? TimeFilterType.DATE\n      : this.options.type;\n  }\n\n  get isRange(): boolean {\n    return this.options.range === undefined ||\n      this.options.style === TimeFilterStyle.SLIDER\n      ? false\n      : this.options.range;\n  }\n\n  get style(): TimeFilterStyle {\n    return this.options.style === undefined\n      ? TimeFilterStyle.SLIDER\n      : this.options.style;\n  }\n\n  get step(): number {\n    let step = 10800000;\n    if (this.options.step === undefined) {\n      switch (this.type) {\n        case TimeFilterType.DATE:\n        case TimeFilterType.DATETIME:\n          step = 10800000;\n          break;\n        case TimeFilterType.TIME:\n          step = 3600000;\n          break;\n        case TimeFilterType.YEAR:\n          step = 31536000000;\n          break;\n        default:\n          step = 10800000;\n      }\n    } else {\n      step = this.getStepDefinition(this.options.step);\n    }\n\n    return step;\n  }\n\n  get timeInterval(): number {\n    return this.options.timeInterval === undefined\n      ? 2000\n      : this.options.timeInterval;\n  }\n\n  get min(): Date {\n    if (this.options.min) {\n      const min = new Date(this.options.min);\n      return new Date(min.getTime() + min.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get max(): Date {\n    if (this.options.max) {\n      const max = new Date(this.options.max);\n      return new Date(max.getTime() + max.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get is(): boolean {\n    return this.options.range === undefined ? false : this.options.range;\n  }\n\n  constructor(private dateAdapter: DateAdapter<Date>) {\n    this.dateAdapter.setLocale('fr');\n  }\n\n  ngOnInit() {\n    if (this.startDate === undefined) {\n      this.startDate = new Date(this.min);\n    }\n    if (this.endDate === undefined) {\n      this.endDate = new Date(this.max);\n    }\n    if (this.startYear === undefined) {\n      this.startYear = new Date(this.startDate).getFullYear();\n      this.initStartYear = this.startYear;\n    }\n    if (this.endYear === undefined) {\n      this.endYear = new Date(this.endDate).getFullYear();\n      this.initEndYear = this.endYear;\n    }\n\n    if (!this.isRange) {\n      for (let i = this.startYear; i <= this.endYear + 1; i++) {\n        this.listYears.push(i);\n      }\n    } else {\n      for (let i = this.startYear; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      for (let i = this.startYear + 1; i <= this.endYear; i++) {\n        this.endListYears.push(i);\n      }\n    }\n    this.options.enabled =\n      this.options.enabled === undefined ? true : this.options.enabled;\n    this.checkFilterValue();\n    if (this.options.enabled) {\n      if (!this.isRange && this.style === 'slider' && this.type === 'year') {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.storeCurrentFilterValue();\n      this.yearChange.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  storeCurrentFilterValue() {\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.options.value = this.year.toString();\n    }\n  }\n\n  checkFilterValue() {\n    const olSource = this.layer.dataSource.ol as olSourceImageWMS;\n    const timeFromWms = olSource.getParams().TIME;\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.year = new Date(timeFromWms.toString()).getFullYear() + 1;\n      } else if (this.options.value) {\n        this.year = new Date(this.options.value.toString()).getFullYear() + 1;\n      } else {\n        this.year = new Date(this.min).getFullYear() + 1;\n      }\n    } else if (\n      this.isRange &&\n      this.style === TimeFilterStyle.CALENDAR &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.startYear = parseInt(timeFromWms.substr(0, 4), 10);\n        this.endYear = parseInt(timeFromWms.substr(5, 4), 10);\n        const newStartListYears: any[] = [];\n        const newEndListYears: any[] = [];\n        for (let i = this.initStartYear; i < this.endYear; i++) {\n          newStartListYears.push(i);\n        }\n        for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n          newEndListYears.push(i);\n        }\n        this.startListYears = newStartListYears;\n        this.endListYears = newEndListYears;\n      }\n    }\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n  }\n\n  handleDateChange(event: any) {\n    this.setupDateOutput();\n    this.applyTypeChange();\n\n    // Only if is range, use 2 dates to make the range\n    if (this.isRange) {\n      this.change.emit([this.startDate, this.endDate]);\n    } else {\n      this.change.emit(this.startDate);\n    }\n  }\n\n  handleYearChange(event: any) {\n    if (this.isRange) {\n      this.endListYears = [];\n      for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n        this.endListYears.push(i);\n      }\n      this.startListYears = [];\n      for (let i = this.initStartYear + 1; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      this.yearChange.emit([this.startYear, this.endYear]);\n    } else {\n      this.yearChange.emit(this.year);\n    }\n  }\n\n  handleListYearChange(event: any) {\n    this.handleYearChange([this.startYear, this.endYear]);\n  }\n\n  handleListYearStartChange(event: any) {\n    this.change.emit([this.startDate, this.endDate]);\n  }\n\n  dateToNumber(date: Date): number {\n    let newDate;\n    if (date) {\n      newDate = new Date(date);\n    } else {\n      newDate = new Date(this.min);\n    }\n\n    return newDate.getTime();\n  }\n\n  setSliderThumbLabel(label: string) {\n    const thumbLabel = this.findThumbLabel(\n      this.mySlider._elementRef.nativeElement.childNodes\n    );\n    if (thumbLabel) {\n      thumbLabel.textContent = label;\n    }\n  }\n\n  findThumbLabel(test: any[]): any {\n    let thumbLabel;\n\n    test.forEach((value) => {\n      if (value.className === 'mat-slider-thumb-label-text') {\n        thumbLabel = value;\n      }\n\n      if (value.children.length > 0 && !thumbLabel) {\n        thumbLabel = this.findThumbLabel(value.childNodes);\n      }\n    }, this);\n    return thumbLabel;\n  }\n\n  toggleFilterState() {\n    this.options.enabled = !this.options.enabled;\n\n    if (this.options.enabled) {\n      if (\n        !this.isRange &&\n        TimeFilterStyle.SLIDER &&\n        this.type === TimeFilterType.YEAR\n      ) {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.stopFilter();\n      this.storeCurrentFilterValue();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  resetFilter(event: any) {\n    this.date = new Date(this.min);\n    this.year = this.date.getFullYear();\n    if (\n      !this.isRange &&\n      TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.yearChange.emit(this.year);\n    } else {\n      this.setupDateOutput();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(\n        (that) => {\n          let newMinDateNumber;\n          const maxDateNumber = new Date(that.max);\n\n          newMinDateNumber =\n            that.date === undefined ? that.min.getTime() : that.date.getTime();\n          newMinDateNumber += that.mySlider.step;\n          that.date = new Date(newMinDateNumber);\n\n          if (newMinDateNumber > maxDateNumber.getTime()) {\n            that.stopFilter();\n          }\n\n          that.handleDateChange({ value: that.date, date: that.date });\n        },\n        this.timeInterval,\n        this\n      );\n    }\n  }\n\n  playYear(event: any) {\n    if (\n      this.year + this.mySlider.step >\n      this.max.getFullYear() + this.mySlider.step\n    ) {\n      this.stopFilter();\n      this.resetFilter(event);\n    }\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(\n        () => {\n          if (this.year + this.mySlider.step > this.max.getFullYear()) {\n            this.stopFilter();\n          } else {\n            this.year = this.year + this.mySlider.step;\n          }\n          this.yearChange.emit(this.year);\n        },\n        this.timeInterval,\n        this\n      );\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n  }\n\n  handleSliderDateChange(event: any) {\n    this.date = new Date(event.value);\n    this.setSliderThumbLabel(this.handleSliderTooltip());\n    this.handleDateChange(event);\n  }\n\n  handleSliderYearChange(event: any) {\n    this.year = event.value;\n    this.yearChange.emit(this.year);\n  }\n\n  handleSliderValue(): number {\n    if (this.options.current === true || !this.min) {\n      const currentDate = new Date();\n      this.date = this.getRoundedDate(currentDate);\n    }\n    if (this.type === TimeFilterType.YEAR) {\n      return this.year;\n    } else {\n      return this.date === undefined ? this.min.getTime() : this.date.getTime();\n    }\n  }\n\n  handleSliderTooltip() {\n    let label: string;\n\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        label =\n          this.date === undefined\n            ? this.min.toDateString()\n            : this.date.toDateString();\n        break;\n      case TimeFilterType.TIME:\n        label =\n          this.date === undefined\n            ? this.min.toTimeString()\n            : this.date.toTimeString();\n        break;\n      // datetime\n      default:\n        label =\n          this.date === undefined\n            ? this.min.toUTCString()\n            : this.date.toUTCString();\n        break;\n    }\n\n    return label;\n  }\n\n  setupDateOutput() {\n    if (this.style === TimeFilterStyle.SLIDER) {\n      this.startDate = new Date(this.date);\n      this.startDate.setSeconds(-(this.step / 1000));\n      this.endDate = new Date(this.startDate);\n      this.endDate.setSeconds(this.step / 1000);\n    } else if (!this.isRange && !!this.date) {\n      this.endDate = new Date(this.date);\n      this.startDate = new Date(this.date);\n    } else if (this.isRange && (!!this.date || !this.date)) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    } else if (!this.date) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    }\n  }\n\n  applyTypeChange() {\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        if (this.startDate !== undefined || this.endDate !== undefined) {\n          this.startDate.setHours(0);\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setHours(23);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      case TimeFilterType.TIME:\n        if (this.style === TimeFilterStyle.CALENDAR) {\n          if (this.startDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.startDate.getHours();\n            const selectedMinute = this.startDate.getMinutes();\n            this.startDate = this.min;\n            this.startDate.setHours(selectedHour);\n            this.startDate.setMinutes(selectedMinute);\n          }\n\n          if (this.endDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.endDate.getHours();\n            const selectedMinute = this.endDate.getMinutes();\n            this.endDate = this.min;\n            this.endDate.setHours(selectedHour);\n            this.endDate.setMinutes(selectedMinute);\n          }\n        }\n\n        if (!this.isRange && this.step > 60 * 60 * 1000) {\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      // datetime\n      default:\n      // do nothing\n    }\n  }\n\n  getRangeMinDate(): Date {\n    return this.startDate === undefined ? this.min : this.startDate;\n  }\n\n  getRangeMaxDate(): Date {\n    return this.endDate === undefined ? this.max : this.endDate;\n  }\n\n  /**\n   * Round date at a certain time, 10 minutes by Default\n   * @param date - Date to Round\n   * @param atMinute - round to closest 'atMinute' minute, rounded 10 by default\n   * @return the rounded date\n   */\n  getRoundedDate(date, atMinute = 10) {\n    const coeff = 1000 * 60 * atMinute;\n    return new Date(Math.round(date.getTime() / coeff) * coeff);\n  }\n\n  /**\n   * Get the step (period) definition from the layer dimension tag\n   * @param step The step as ISO 8601 example: PT10M for 10 Minutes\n   * @return the duration in milliseconds\n   */\n  getStepDefinition(step) {\n    return moment.duration(step).asMilliseconds();\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { TileArcGISRestDataSource } from '../../datasource/shared/datasources/tilearcgisrest-datasource';\n\n@Injectable()\nexport class TimeFilterService {\n  constructor() {}\n\n  filterByDate(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    date: Date | [Date, Date]\n  ) {\n    let time;\n    let newdateform;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(date)) {\n      const dates = [];\n      if (date[0]) {\n        newdateformStart = this.reformatDateTime(date[0]);\n        dates.push(date[0]);\n      }\n      if (date[1]) {\n        newdateformEnd = this.reformatDateTime(date[1]);\n        dates.push(date[1]);\n      }\n      if (dates.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else if (date) {\n      newdateform = this.reformatDateTime(date);\n      time = newdateform;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  filterByYear(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    year: string | [string, string]\n  ) {\n    let time;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(year)) {\n      const years = [];\n      if (year[0]) {\n        newdateformStart = year[0];\n        years.push(year[0]);\n      }\n      if (year[1]) {\n        newdateformEnd = year[1];\n        years.push(year[1]);\n      }\n      if (years.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else {\n      // to reset filter.\n      time = year;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  private reformatDateTime(value) {\n    const year = value.getFullYear();\n    let month = value.getMonth() + 1;\n    let day = value.getUTCDate();\n    let hour = value.getUTCHours();\n    let minute = value.getUTCMinutes();\n\n    if (Number(month) < 10) {\n      month = '0' + month;\n    }\n\n    if (Number(day) < 10) {\n      day = '0' + day;\n    }\n\n    if (Number(hour) < 10) {\n      hour = '0' + hour;\n    }\n\n    if (Number(minute) < 10) {\n      minute = '0' + minute;\n    }\n\n    return year + '-' + month + '-' + day + 'T' + hour + ':' + minute + ':00Z';\n  }\n}\n","<mat-list-item *ngIf=\"header\">\n  <mat-icon\n    class=\"igo-chevron\"\n    matListItemIcon\n    igoCollapse\n    [target]=\"filters\"\n    [collapsed]=\"filtersCollapsed\"\n    (click)=\"toggleFiltersCollapsed()\"\n    svgIcon=\"chevron-up\"\n  >\n  </mat-icon>\n\n  <span\n    matListItemTitle\n    (click)=\"toggleLegendOnClick()\"\n    [ngStyle]=\"{ cursor: filtersCollapsed ? 'default' : 'pointer' }\"\n    >{{ layer.title }}</span\n  >\n\n  <button\n    *ngIf=\"header\"\n    mat-icon-button\n    matListItemMeta\n    [color]=\"layer.visible ? 'primary' : 'default'\"\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"\n      layer.visible\n        ? ('igo.geo.layer.hideLayer' | translate)\n        : ('igo.geo.layer.showLayer' | translate)\n    \"\n    (click)=\"layer.visible = !layer.visible\"\n  >\n    <mat-icon\n      [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n      [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\"\n    >\n    </mat-icon>\n  </button>\n</mat-list-item>\n\n<div #filters class=\"igo-datasource-filters-container\">\n  <div #legend class=\"igo-layer-legend-container\">\n    <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n    </igo-layer-legend>\n  </div>\n  <igo-time-filter-form\n    [layer]=\"layer\"\n    [options]=\"datasource.options.timeFilter\"\n    [currentValue]=\"datasource.options.params.TIME\"\n    (change)=\"handleDateChange($event)\"\n    (yearChange)=\"handleYearChange($event)\"\n  >\n  </igo-time-filter-form>\n</div>\n","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterService } from '../shared/time-filter.service';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { TimeFilterableDataSource } from '../../datasource';\n\n@Component({\n  selector: 'igo-time-filter-item',\n  templateUrl: './time-filter-item.component.html',\n  styleUrls: ['./time-filter-item.component.scss']\n})\nexport class TimeFilterItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n\n  filtersCollapsed: boolean = false;\n\n  @Input() header: boolean = true;\n\n  @Input() layer: Layer;\n\n  get datasource(): TimeFilterableDataSource {\n    return this.layer.dataSource as TimeFilterableDataSource;\n  }\n  constructor(private timeFilterService: TimeFilterService) {}\n\n  ngOnInit(): void {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  handleYearChange(year: string | [string, string]) {\n    this.timeFilterService.filterByYear(this.datasource, year);\n  }\n\n  handleDateChange(date: Date | [Date, Date]) {\n    this.timeFilterService.filterByDate(this.datasource, date);\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template\n    ngFor\n    let-layer\n    [ngForOf]=\"layers | filterableDataSource: 'time'\"\n  >\n    <igo-time-filter-item\n      [header]=\"true\"\n      igoListItem\n      [layer]=\"layer\"\n    ></igo-time-filter-item>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\n@Component({\n  selector: 'igo-time-filter-list',\n  templateUrl: './time-filter-list.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TimeFilterListComponent {\n  @Input()\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.cdRef.detectChanges();\n  }\n  private _layers: Layer[] = [];\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n}\n","import { Injectable } from '@angular/core';\n\nimport * as olproj from 'ol/proj';\nimport olWKT from 'ol/format/WKT';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WktService {\n  constructor() {}\n\n  public wktToFeature(wkt, wktProj, featureProj) {\n    return new olWKT().readFeature(wkt, {\n      dataProjection: wktProj,\n      featureProjection: featureProj\n    });\n  }\n  public extentToWkt(epsgTO, extent, extentProj) {\n    let currentExtent = olproj.transformExtent(extent, extentProj, epsgTO);\n    currentExtent = this.roundCoordinateArray(currentExtent, epsgTO, 0);\n    const wktPoly = `POLYGON((\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]}))`;\n    const wktLine = `LINESTRING(\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]})`;\n    const wktMultiPoints = `MULTIPOINT(\n        ${extent[0]} ${extent[1]},\n        ${extent[0]} ${extent[3]},\n        ${extent[2]} ${extent[3]},\n        ${extent[2]} ${extent[1]})`;\n    return {\n      wktPoly,\n      wktLine,\n      wktMultiPoints\n    };\n  }\n\n  private roundCoordinateArray(coordinateArray, projection, decimal = 0) {\n    const lproj = olproj.get(projection);\n    const units = lproj.getUnits();\n    const olUnits = ['ft', 'm', 'us-ft'];\n    if (olUnits.indexOf(units) !== -1) {\n      coordinateArray = this.roundArray(coordinateArray, decimal);\n    }\n    return coordinateArray;\n  }\n\n  private roundArray(array, decimal = 0) {\n    let x = 0;\n    while (x < array.length) {\n      array[x] = array[x].toFixed(decimal);\n      x++;\n    }\n    return array;\n  }\n\n  public snrcToWkt(snrc, epsgTO) {\n    snrc = snrc.toLowerCase();\n    let wktPoly;\n    const ew = {\n      1: { from: -56, to: -64 },\n      2: { from: -64, to: -72 },\n      3: { from: -72, to: -80 },\n      4: { from: -80, to: -88 },\n      5: { from: -88, to: -96 },\n      6: { from: -96, to: -104 },\n      7: { from: -104, to: -112 },\n      8: { from: -112, to: -120 },\n      9: { from: -120, to: -128 },\n      10: { from: -128, to: -136 }\n    };\n    const sn = {\n      1: { from: 44, to: 48 },\n      2: { from: 48, to: 52 },\n      3: { from: 52, to: 56 },\n      4: { from: 56, to: 60 },\n      5: { from: 60, to: 64 },\n      6: { from: 64, to: 68 },\n      7: { from: 68, to: 72 },\n      8: { from: 72, to: 76 },\n      9: { from: 76, to: -128 }\n    };\n    const snrc250kIndex = [\n      ['m', 'n', 'o', 'p'],\n      ['l', 'k', 'j', 'i'],\n      ['e', 'f', 'g', 'h'],\n      ['d', 'c', 'b', 'a']\n    ];\n\n    const snrc50kIndex = [\n      ['13', '14', '15', '16'],\n      ['12', '11', '10', '09'],\n      ['05', '06', '07', '08'],\n      ['04', '03', '02', '01']\n    ];\n    const checkSNRC50k = /\\d{2,3}[a-p][0,1][0-9]/gi;\n    const checkSNRC250k = /\\d{2,3}[a-p]/gi;\n    const checkSNRC1m = /\\d{2,3}/gi;\n\n    let snrc1m = false;\n    let snrc250k = false;\n    let snrc50k = false;\n\n    if (checkSNRC50k.test(snrc)) {\n      snrc50k = true;\n    } else {\n      if (checkSNRC250k.test(snrc)) {\n        snrc250k = true;\n      } else {\n        if (checkSNRC1m.test(snrc)) {\n          snrc1m = true;\n        }\n      }\n    }\n\n    if (snrc1m) {\n      snrc += 'a01';\n    } else if (snrc250k) {\n      snrc += '01';\n    }\n    if (/\\d{2,3}[a-p][0,1][0-9]/gi.test(snrc)) {\n      const regex1m = /(?=[a-p])/gi;\n      const ar1m = snrc.split(regex1m);\n      const part1m = ar1m[0];\n      const part250k = ar1m[1][0];\n      const part50k = ar1m[1].split(part250k)[1];\n      let separator = 1;\n      if (part1m.length === 3) {\n        separator = 2;\n      }\n      const partEW = part1m.substring(0, separator);\n      const partSN = part1m.substring(separator);\n      const unit1mEW = 8;\n      const unit1mSN = 4;\n      const unit250kEW = 2;\n      const unit250kSN = 1;\n      const unit50kEW = 0.5;\n      const unit50kSN = 0.25;\n      let index250kEW = 0;\n      let index250kSN = 0;\n      let index50kEW = 0;\n      let index50kSN = 0;\n      snrc250kIndex.forEach((element) => {\n        if (element.indexOf(part250k) !== -1) {\n          index250kSN = snrc250kIndex.indexOf(element);\n          index250kEW = element.indexOf(part250k);\n        }\n      });\n      snrc50kIndex.forEach((element) => {\n        if (element.indexOf(part50k) !== -1) {\n          index50kSN = snrc50kIndex.indexOf(element);\n          index50kEW = element.indexOf(part50k);\n        }\n      });\n\n      let increment250kEW = 0;\n      let increment250kSN = 0;\n      let increment50kEW = 0;\n      let increment50kSN = 0;\n      let unitPerTypeEW = unit1mEW;\n      let unitPerTypeSN = unit1mSN;\n      if (snrc250k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = 0;\n        increment50kSN = 0;\n        unitPerTypeEW = unit250kEW;\n        unitPerTypeSN = unit250kSN;\n      } else if (snrc50k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = index50kEW * unit50kEW;\n        increment50kSN = index50kSN * unit50kSN;\n        unitPerTypeEW = unit50kEW;\n        unitPerTypeSN = unit50kSN;\n      }\n\n      const coord: { ul?: any; lr?: any; ur?: any; ll?: any } = {\n        ul: [\n          ew[partEW].to + increment250kEW + increment50kEW,\n          sn[partSN].to - increment250kSN - increment50kSN\n        ]\n      };\n\n      coord.lr = [coord.ul[0] + unitPerTypeEW, coord.ul[1] - unitPerTypeSN];\n      coord.ur = [coord.ul[0], coord.ul[1] - unitPerTypeSN];\n      coord.ll = [coord.ul[0] + unitPerTypeEW, coord.ul[1]];\n\n      coord.ul = olproj.transform(\n        [coord.ul[0], coord.ul[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.lr = olproj.transform(\n        [coord.lr[0], coord.lr[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ur = olproj.transform(\n        [coord.ur[0], coord.ur[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ll = olproj.transform(\n        [coord.ll[0], coord.ll[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n\n      // Rounded coordinate to shorten url in get\n      coord.ul = this.roundCoordinateArray(coord.ul, epsgTO, 0);\n      coord.lr = this.roundCoordinateArray(coord.lr, epsgTO, 0);\n      coord.ur = this.roundCoordinateArray(coord.ur, epsgTO, 0);\n      coord.ll = this.roundCoordinateArray(coord.ll, epsgTO, 0);\n\n      wktPoly =\n        'POLYGON((' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        '))';\n      const wktLine =\n        'LINESTRING(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        ')';\n\n      const wktMultiPoints =\n        'MULTIPOINT(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' ')\n        ].join(',') +\n        ')';\n      return {\n        wktPoly,\n        wktLine,\n        wktMultiPoints\n      };\n    }\n  }\n}\n","<div class=\"ogc-filter-form-container\">\n  <mat-checkbox\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n    (click)=\"$event.stopPropagation()\"\n    (change)=\"toggleFilterState($event)\"\n    [checked]=\"currentFilter.active\"\n  >\n  </mat-checkbox>\n\n  <mat-form-field\n    [ngClass]=\"{\n      logical:\n        activeFilters.indexOf(currentFilter) !== 0 &&\n        currentFilter.active === true,\n      logicalHidden:\n        activeFilters.indexOf(currentFilter) === 0 ||\n        currentFilter.active !== true\n    }\"\n  >\n    <mat-select\n      [disabled]=\"!currentFilter.active\"\n      [value]=\"currentFilter.parentLogical\"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        currentFilter.parentLogical\n          ? ('igo.geo.operators.tooltip.' + currentFilter.parentLogical\n            | translate)\n          : ''\n      \"\n      (selectionChange)=\"changeLogical($event.value)\"\n    >\n      <mat-option\n        [value]=\"ogcFilterOperator.And\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.And' | translate\"\n      >\n        {{ 'igo.geo.operators.And' | translate }}\n      </mat-option>\n      <mat-option\n        [value]=\"ogcFilterOperator.Or\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.Or' | translate\"\n      >\n        {{ 'igo.geo.operators.Or' | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"field\"\n    *ngIf=\"\n      (currentFilterIsSpatial$ | async) === false &&\n      (fields$ | async) &&\n      (fields$ | async).length > 0 &&\n      (fields$ | async)[0].name !== ''\n    \"\n    (mouseenter)=\"inputClearable = 'selectField'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.sourceFields.selectField' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoCompleteField\"\n      [value]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ''\"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        (selectedField$ | async)\n          ? (selectedField$ | async).alias\n          : ('igo.geo.sourceFields.selectField' | translate)\n      \"\n      (input)=\"updateFieldsList($event.target.value)\"\n    />\n    <mat-autocomplete\n      #autoCompleteField=\"matAutocomplete\"\n      (optionSelected)=\"changeField($event.option.id)\"\n    >\n      <mat-option\n        *ngFor=\"let field of filteredFields$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"field.alias\"\n        [id]=\"field.name\"\n        [matTooltip]=\"field.alias\"\n      >\n        {{ field.alias }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        currentFilter.propertyName &&\n        inputClearable === 'selectField' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearSelectedField()\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <mat-form-field\n    [ngClass]=\"{\n      operator: (currentFilterIsSpatial$ | async) === false,\n      dualInput: (currentFilterIsSpatial$ | async)\n    }\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <mat-select\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        currentFilter.operator\n          ? ('igo.geo.operators.tooltip.' + currentFilter.operator | translate)\n          : ('igo.geo.filter.selectOperator' | translate)\n      \"\n      [disabled]=\"!currentFilter.active\"\n      [value]=\"currentFilter.operator\"\n      (selectionChange)=\"changeOperator($event.value)\"\n    >\n      <mat-option\n        *ngFor=\"let operator of ogcFilterOperators$ | async | keyvalue\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"operator.key\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.' + operator.key | translate\"\n      >\n        {{ 'igo.geo.operators.' + operator.key | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"spatialSelector\"\n    *ngIf=\"currentFilterIsSpatial$ | async\"\n  >\n    <mat-select\n      [disabled]=\"!currentFilter.active\"\n      [value]=\"currentFilter.igoSpatialSelector\"\n      (selectionChange)=\"changeSpatialSelector($event.value)\"\n    >\n      <mat-option\n        *ngFor=\"let igoSpatialSelector of igoSpatialSelectors\"\n        [value]=\"igoSpatialSelector.type\"\n      >\n        {{ 'igo.geo.spatialSelector.' + igoSpatialSelector.type | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"singleInput\"\n    *ngIf=\"['expression', 'pattern'].indexOf(detectProperty()) !== -1\"\n    (mouseenter)=\"inputClearable = 'selectProperty'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoCompleteValues\"\n      [value]=\"\n        detectProperty() === 'expression'\n          ? currentFilter.expression\n          : currentFilter.pattern\n      \"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        detectProperty() === 'expression'\n          ? currentFilter.expression || ''\n          : currentFilter.pattern || ''\n      \"\n      (input)=\"updateValuesList($event.target.value)\"\n    />\n    <mat-autocomplete\n      #autoCompleteValues=\"matAutocomplete\"\n      (optionSelected)=\"changeProperty($event.option.value)\"\n    >\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\"\n      >\n        {{ value }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        isClearable() &&\n        inputClearable === 'selectProperty' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty()\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <div class=\"igo-layer-button-group\">\n    <button\n      mat-icon-button\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.filter.removeFilter' | translate\"\n      color=\"warn\"\n      (click)=\"deleteFilter()\"\n    >\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n  </div>\n\n  <mat-form-field\n    class=\"snrc\"\n    *ngIf=\"\n      (currentFilterIsSpatial$ | async) &&\n      currentFilter.igoSpatialSelector === 'snrc'\n    \"\n    (mouseenter)=\"inputClearable = 'selectSNRC'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholderSnrc' | translate\"\n      [value]=\"currentFilter.igoSNRC\"\n      tooltip-position=\"above\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"currentFilter.igoSNRC ? currentFilter.igoSNRC : ''\"\n      (input)=\"changeSNRC($event.target.value)\"\n    />\n    <button\n      *ngIf=\"currentFilter.igoSNRC\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"\n        !currentFilter.active &&\n        inputClearable === 'selectSNRC' &&\n        currentFilter.active\n      \"\n      (click)=\"currentFilter.igoSNRC = ''\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <ng-container\n    *ngIf=\"\n      (currentFilterIsSpatial$ | async) &&\n      currentFilter.igoSpatialSelector === 'fixedExtent'\n    \"\n  >\n    <button\n      [disabled]=\"!currentFilter.active\"\n      *ngIf=\"currentFilter.igoSpatialSelector === 'fixedExtent'\"\n      matSuffix\n      mat-icon-button\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"changeMapExtentGeometry()\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.spatialSelector.btnSetExtent' | translate\"\n    >\n      <mat-icon svgIcon=\"arrow-expand-all\"></mat-icon>\n    </button>\n  </ng-container>\n</div>\n\n<div class=\"ogc-filter-form-container\">\n  <mat-form-field\n    class=\"dualInput\"\n    *ngIf=\"\n      !isTemporalOperator() &&\n      ['lowerBoundary', 'begin'].indexOf(detectProperty(1)) !== -1\n    \"\n    (mouseenter)=\"inputClearable = 'selectProperty1'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator1\"\n      type=\"number\"\n      [value]=\"\n        detectProperty(1) === 'lowerBoundary'\n          ? currentFilter.lowerBoundary\n          : currentFilter.begin\n      \"\n      (input)=\"updateValuesList($event.target.value, 1)\"\n    />\n    <mat-autocomplete\n      #autoDualValueOperator1=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value, 1)\"\n    >\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\"\n      >\n        {{ value }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        isClearable(1) &&\n        inputClearable === 'selectProperty1' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(1)\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <mat-form-field\n    class=\"dualInput\"\n    *ngIf=\"\n      !isTemporalOperator() &&\n      ['upperBoundary', 'end'].indexOf(detectProperty(2)) !== -1\n    \"\n    (mouseenter)=\"inputClearable = 'selectProperty2'\"\n    (mouseleave)=\"inputClearable = undefined\"\n    [floatLabel]=\"floatLabel\"\n  >\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator2\"\n      type=\"number\"\n      [value]=\"\n        detectProperty(2) === 'upperBoundary'\n          ? currentFilter.upperBoundary\n          : currentFilter.end\n      \"\n      (input)=\"updateValuesList($event.target.value, 2)\"\n    />\n    <mat-autocomplete\n      #autoDualValueOperator2=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value, 2)\"\n    >\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\"\n      >\n        {{ value }}\n      </mat-option>\n    </mat-autocomplete>\n    <button\n      *ngIf=\"\n        isClearable(2) &&\n        inputClearable === 'selectProperty2' &&\n        currentFilter.active\n      \"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(2)\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n</div>\n\n<igo-ogc-filter-time\n  *ngIf=\"isTemporalOperator()\"\n  [(datasource)]=\"datasource\"\n  [(currentFilter)]=\"currentFilter\"\n  (changeProperty)=\"changeProperty($event.value, $event.pos)\"\n>\n</igo-ogc-filter-time>\n","import { Component, Input, OnInit } from '@angular/core';\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\n\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions\n} from '../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { WktService } from '../../wkt/shared/wkt.service';\nimport { IgoMap } from '../../map/shared';\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\n\n@Component({\n  selector: 'igo-ogc-filter-form',\n  templateUrl: './ogc-filter-form.component.html',\n  styleUrls: ['./ogc-filter-form.component.scss']\n})\nexport class OgcFilterFormComponent implements OnInit {\n  ogcFilterOperator = OgcFilterOperator;\n  filteredValues$: Observable<string[]>;\n  filteredFields$: Observable<SourceFieldsOptionsParams[]>;\n  public allOgcFilterOperators;\n  public ogcFilterOperators$ = new BehaviorSubject<{ [key: string]: any }>(\n    undefined\n  );\n  public igoSpatialSelectors;\n  public value = '';\n  public inputOperator;\n  public selectedField$ = new BehaviorSubject<SourceFieldsOptionsParams>(\n    undefined\n  );\n  public fields$ = new BehaviorSubject<SourceFieldsOptionsParams[]>([]);\n  public color = 'primary';\n  public disabled;\n  public currentFilterIsSpatial$ = new BehaviorSubject<boolean>(false);\n  public defaultStepMillisecond = 6000;\n  public inputClearable: string;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() currentFilter: any;\n\n  set snrc(value: any) {\n    const checkSNRC50k = /^\\d{2}[a-l][0,1][0-9]$/gi;\n    const checkSNRC250k = /^\\d{2}[a-p]$/gi;\n    const checkSNRC1m = /^\\d{2}$/gi;\n    if (\n      checkSNRC1m.test(value) ||\n      checkSNRC250k.test(value) ||\n      checkSNRC50k.test(value)\n    ) {\n      this._snrc = value;\n      this.currentFilter.igoSNRC = value;\n    }\n  }\n\n  get snrc(): any {\n    return this._snrc;\n  }\n\n  private _snrc = '';\n\n  @Input() floatLabel: FloatLabelType;\n\n  get activeFilters() {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.active === true\n    );\n  }\n\n  get allowedOperators() {\n    return new OgcFilterWriter().computeAllowedOperators(\n      this.fields$.value,\n      this.currentFilter.propertyName,\n      this.datasource.options.ogcFilters.allowedOperatorsType\n    );\n  }\n\n  constructor(private wktService: WktService) {\n    // TODO: Filter permitted operator based on wfscapabilities\n    // Need to work on regex on XML capabilities because\n    // comaparison operator's name varies between WFS servers...\n    // Ex: IsNull vs PropertyIsNull vs IsNil ...\n    this.allOgcFilterOperators = new OgcFilterWriter().operators;\n    this.ogcFilterOperators$.next(this.allOgcFilterOperators);\n    this.igoSpatialSelectors = [\n      {\n        type: 'fixedExtent'\n      },\n      {\n        type: 'snrc'\n      }\n    ];\n    // TODO: selectFeature & drawFeature\n  }\n\n  ngOnInit() {\n    if (this.datasource.options.sourceFields) {\n      const sFields = this.datasource.options.sourceFields.filter(\n        (sf) =>\n          sf.excludeFromOgcFilters === undefined || !sf.excludeFromOgcFilters\n      );\n      sFields.map((sfs) => {\n        if (sfs.values) {\n          sfs.values.sort();\n        }\n      });\n      this.fields$.next(sFields);\n    }\n\n    this.updateFieldsList();\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.updateValuesList();\n    this.selectedField$.subscribe((f) => {\n      this.ogcFilterOperators$.next(this.allowedOperators);\n      if (\n        Object.keys(this.allowedOperators).indexOf(\n          this.currentFilter.operator\n        ) === -1\n      ) {\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n      }\n      this.updateValuesList();\n    });\n    this.currentFilterIsSpatial();\n  }\n\n  updateFieldsList(value?: string) {\n    this.filteredFields$ =\n      value && value.length > 0 ? of(this._filterFields(value)) : this.fields$;\n    if (this.fields$.value.find((f) => f.name === value)) {\n      this.changeField(value);\n    }\n  }\n\n  updateValuesList(value?: string, pos?: number) {\n    this.filteredValues$ =\n      value && value.length > 0\n        ? of(this._filterValues(value))\n        : this.selectedField$.value\n        ? of(this.selectedField$.value.values)\n        : of([]);\n    if (value && value.length >= 1) {\n      this.changeProperty(value, pos);\n    }\n  }\n\n  private _filterFields(value: string): SourceFieldsOptionsParams[] {\n    const keywordRegex = new RegExp(\n      value.normalize('NFD').replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n    return this.fields$.value.filter((val) =>\n      keywordRegex.test(\n        val.alias.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\n      )\n    );\n  }\n\n  private _filterValues(value: string): string[] {\n    const keywordRegex = new RegExp(\n      value\n        .toString()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n    return this.selectedField$.value.values.filter(\n      (val) =>\n        val &&\n        keywordRegex.test(\n          val\n            .toString()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n        )\n    );\n  }\n\n  clearSelectedField() {\n    this.currentFilter.propertyName = '';\n    this.selectedField$.next(undefined);\n    this.clearProperty();\n  }\n\n  isClearable(pos?: number) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return this.currentFilter[detectedProperty];\n    }\n  }\n  clearProperty(pos?: number) {\n    // this.autoCompleteInputValues.closePanel();\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return (this.currentFilter[detectedProperty] = '');\n    }\n  }\n\n  toggleFilterState(event) {\n    this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    ).active = event.checked;\n    this.refreshFilters();\n  }\n\n  deleteFilter() {\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    ogcFilters.interfaceOgcFilters = ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.filterid !== this.currentFilter.filterid\n    );\n    this.refreshFilters();\n  }\n\n  changeLogical(logical: string) {\n    this.currentFilter.parentLogical = logical;\n    this.refreshFilters();\n  }\n\n  changeOperator(operator: string) {\n    this.currentFilter.operator = operator;\n    this.currentFilterIsSpatial();\n\n    if (\n      this.currentFilterIsSpatial$.value &&\n      this.currentFilter.wkt_geometry.length === 0\n    ) {\n      this.changeSpatialSelector(this.currentFilter.igoSpatialSelector);\n    } else {\n      this.refreshFilters();\n    }\n  }\n\n  changeField(field: string) {\n    this.currentFilter.propertyName = field;\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.refreshFilters();\n  }\n\n  // Issue with mapserver 7.2 and Postgis layers. Fixed in 7.4\n  // Due to this issue, the checkbox is hide.\n  changeCaseSensitive(matchCase) {\n    this.currentFilter.matchCase = matchCase.checked;\n    this.refreshFilters();\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (f) => f.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if (refreshFilter) {\n        this.refreshFilters();\n      }\n    }\n  }\n\n  changeNumericProperty(value, pos: number) {\n    this.changeProperty(parseFloat(value), pos);\n  }\n\n  changeSpatialSelector(value: any) {\n    this.currentFilter.igoSpatialSelector = value;\n\n    if (value === 'fixedExtent') {\n      this.changeMapExtentGeometry(false);\n    }\n    this.currentFilterIsSpatial();\n    this.refreshFilters();\n  }\n\n  changeSNRC(value: any) {\n    this.snrc = value;\n    this.changeSNRCGeometry();\n  }\n\n  changeSNRCGeometry() {\n    const interfaceOgcFilter =\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (f) => f.filterid === this.currentFilter.filterid\n      );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.snrc && this.currentFilter.igoSpatialSelector === 'snrc') {\n      this.currentFilter.wkt_geometry = this.wktService.snrcToWkt(\n        this.snrc,\n        this.map.projection\n      ).wktPoly;\n    }\n    this.refreshFilters();\n  }\n\n  changeMapExtentGeometry(refresh: boolean = true) {\n    const interfaceOgcFilter =\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (f) => f.filterid === this.currentFilter.filterid\n      );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.currentFilter.igoSpatialSelector === 'fixedExtent') {\n      this.currentFilter.wkt_geometry = this.wktService.extentToWkt(\n        this.map.projection,\n        this.map.viewController.getExtent(),\n        this.map.projection\n      ).wktPoly;\n    }\n    if (refresh) {\n      this.refreshFilters();\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n          ? 'upperBoundary'\n          : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n          ? 'end'\n          : undefined;\n      default:\n        return;\n    }\n  }\n\n  private currentFilterIsSpatial() {\n    let isSpatial = false;\n    if (this.currentFilter) {\n      isSpatial =\n        [\n          OgcFilterOperator.Contains,\n          OgcFilterOperator.Intersects,\n          OgcFilterOperator.Within\n        ].indexOf(this.currentFilter.operator) !== -1;\n    }\n    this.currentFilterIsSpatial$.next(isSpatial);\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter.operator.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n}\n","<igo-ogc-filter-selection\n  *ngIf=\"!advancedOgcFilters\"\n  igoListItem\n  [refreshFilters]=\"refreshFunc\"\n  [datasource]=\"datasource\"\n  [map]=\"map\"\n  [currentFilter]=\"currentFilter\"\n>\n</igo-ogc-filter-selection>\n\n<ng-template\n  *ngIf=\"advancedOgcFilters && datasource.options.ogcFilters.editable\"\n  ngFor\n  let-currentFilter\n  [ngForOf]=\"datasource.options.ogcFilters.interfaceOgcFilters\"\n>\n  <igo-ogc-filter-form\n    [currentFilter]=\"currentFilter\"\n    [refreshFilters]=\"refreshFunc\"\n    [datasource]=\"datasource\"\n    [map]=\"map\"\n  >\n  </igo-ogc-filter-form>\n</ng-template>\n","import { Component, Input } from '@angular/core';\r\nimport { OgcFilterableDataSource } from '../shared/ogc-filter.interface';\r\nimport { IgoMap } from '../../map/shared';\r\nimport { MAT_SELECT_CONFIG } from '@angular/material/select';\r\nimport { MAT_AUTOCOMPLETE_DEFAULT_OPTIONS } from '@angular/material/autocomplete';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filterable-form',\r\n  templateUrl: './ogc-filterable-form.component.html',\r\n  styles: ['::ng-deep.igo-overlay-panel-width { min-width: fit-content;}'],\r\n  providers: [\r\n    {\r\n      provide: MAT_SELECT_CONFIG,\r\n      useValue: { overlayPanelClass: 'igo-overlay-panel-width' }\r\n    },\r\n    {\r\n      provide: MAT_AUTOCOMPLETE_DEFAULT_OPTIONS,\r\n      useValue: { overlayPanelClass: 'igo-overlay-panel-width' }\r\n    }\r\n  ]\r\n})\r\nexport class OgcFilterableFormComponent {\r\n  @Input() datasource: OgcFilterableDataSource;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() refreshFilters: () => void;\r\n\r\n  get refreshFunc() {\r\n    return this.refreshFilters;\r\n  }\r\n\r\n  get advancedOgcFilters(): boolean {\r\n    if (this.datasource.options.ogcFilters) {\r\n      return this.datasource.options.ogcFilters.advancedOgcFilters;\r\n    }\r\n    return;\r\n  }\r\n\r\n  get currentFilter(): any {\r\n    return this.datasource.options.ogcFilters.interfaceOgcFilters\r\n      ? this.datasource.options.ogcFilters.interfaceOgcFilters[0]\r\n      : undefined;\r\n  }\r\n\r\n  public color = 'primary';\r\n\r\n  constructor() {}\r\n}\r\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from './ogc-filter';\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterService {\n  constructor() {}\n\n  public filterByOgc(wmsDatasource: WMSDataSource, filterString: string) {\n    const appliedFilter = new OgcFilterWriter().formatProcessedOgcFilter(\n      filterString,\n      wmsDatasource.options.params.LAYERS\n    );\n    wmsDatasource.ol.updateParams({ FILTER: appliedFilter });\n  }\n\n  public setOgcWFSFiltersOptions(wfsDatasource: OgcFilterableDataSource) {\n    const options: any = wfsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.paramsWFS.fieldNameGeometry,\n        new olProjection({ code: options.paramsWFS.srsName }),\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters =\n          ogcFilterWriter.defineInterfaceFilterSequence(\n            options.ogcFilters.filters,\n            options.paramsWFS.fieldNameGeometry\n          );\n      }\n    }\n  }\n\n  public setOgcWMSFiltersOptions(wmsDatasource: OgcFilterableDataSource) {\n    const options: any = wmsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.fieldNameGeometry,\n        undefined,\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters =\n          ogcFilterWriter.defineInterfaceFilterSequence(\n            // With some wms server, this param must be set to make spatials call.\n            options.ogcFilters.filters,\n            options.fieldNameGeometry\n          );\n      }\n      this.filterByOgc(\n        wmsDatasource as WMSDataSource,\n        ogcFilterWriter.buildFilter(\n          options.ogcFilters.filters,\n          undefined,\n          undefined,\n          undefined,\n          wmsDatasource.options\n        )\n      );\n      options.filtered = true;\n    } else {\n      options.ogcFilters.filters = undefined;\n      options.ogcFilters.interfaceOgcFilters = [];\n      options.filtered = false;\n    }\n  }\n}\n","<div [ngClass]=\"{ 'separate-item': header === true }\">\n  <mat-list-item>\n    <mat-icon\n      *ngIf=\"header\"\n      class=\"igo-chevron\"\n      matListItemIcon\n      igoCollapse\n      [target]=\"ogcFilters\"\n      [collapsed]=\"filtersCollapsed\"\n      (click)=\"toggleFiltersCollapsed()\"\n      svgIcon=\"chevron-up\"\n    >\n    </mat-icon>\n    <span\n      *ngIf=\"header\"\n      matListItemTitle\n      [ngStyle]=\"{ cursor: filtersCollapsed ? 'default' : 'pointer' }\"\n      [matTooltip]=\"layer.title\"\n      matTooltipShowDelay=\"500\"\n      (click)=\"toggleLegendOnClick()\"\n    >\n      {{ layer.title }}\n    </span>\n    <div matListItemMeta>\n      <button\n        *ngIf=\"isAdvancedOgcFilters() && filtersAreEditable\"\n        [disabled]=\"addFilterDisabled()\"\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.addFilter' | translate\"\n        [color]=\"color\"\n        (click)=\"addFilterToSequence()\"\n      >\n        <mat-icon svgIcon=\"plus\"></mat-icon>\n      </button>\n      <button\n        *ngIf=\"header\"\n        mat-icon-button\n        [color]=\"layer.visible ? 'primary' : 'default'\"\n        collapsibleButton\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"\n          layer.visible\n            ? ('igo.geo.layer.hideLayer' | translate)\n            : ('igo.geo.layer.showLayer' | translate)\n        \"\n        (click)=\"layer.visible = !layer.visible\"\n      >\n        <mat-icon\n          [ngClass]=\"{ disabled: (inResolutionRange$ | async) === false }\"\n          [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\"\n        >\n        </mat-icon>\n      </button>\n    </div>\n  </mat-list-item>\n\n  <div #ogcFilters>\n    <div *ngIf=\"header\" #legend class=\"igo-layer-legend-container\">\n      <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n      </igo-layer-legend>\n    </div>\n    <igo-ogc-filterable-form\n      [datasource]=\"datasource\"\n      [map]=\"map\"\n      [refreshFilters]=\"refreshFunc\"\n    >\n    </igo-ogc-filterable-form>\n\n    <section\n      *ngIf=\"hasSelector && filtersAreEditable\"\n      class=\"mat-typography advancedOgcFilters\"\n    >\n      <mat-divider></mat-divider>\n      <mat-checkbox\n        (change)=\"changeOgcFilterType($event)\"\n        [(ngModel)]=\"datasource.options.ogcFilters.advancedOgcFilters\"\n      >\n        {{ 'igo.geo.filter.advancedOgcFilters' | translate }}\n      </mat-checkbox>\n    </section>\n  </div>\n</div>\n","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { WFSDataSourceOptionsParams } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\n\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions,\n  OgcInterfaceFilterOptions\n} from '../shared/ogc-filter.interface';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\nimport { IgoMap } from '../../map/shared';\nimport { OgcFilterWriter } from '../shared/ogc-filter';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n@Component({\n  selector: 'igo-ogc-filterable-item',\n  templateUrl: './ogc-filterable-item.component.html',\n  styleUrls: ['./ogc-filterable-item.component.scss']\n})\nexport class OgcFilterableItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  private lastRunOgcFilter;\n  private defaultLogicalParent = OgcFilterOperator.And;\n  public hasActiveSpatialFilter = false;\n  public filtersAreEditable = true;\n  public filtersCollapsed = true;\n  public hasSelector: boolean = false;\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n  private ogcFilterWriter;\n\n  @Input() layer: Layer;\n\n  @Input() map: IgoMap;\n\n  @Input() header: boolean = true;\n\n  get refreshFunc() {\n    return this.refreshFilters.bind(this);\n  }\n\n  get datasource(): OgcFilterableDataSource {\n    return this.layer.dataSource as OgcFilterableDataSource;\n  }\n\n  constructor(private ogcFilterService: OGCFilterService) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n  }\n\n  ngOnInit() {\n    if (this.layer.visible) {\n      this.filtersCollapsed = false;\n    }\n\n    const ogcFilters = this.datasource.options.ogcFilters;\n    if (\n      (ogcFilters.pushButtons && ogcFilters.pushButtons.bundles.length > 0) ||\n      (ogcFilters.checkboxes && ogcFilters.checkboxes.bundles.length > 0) ||\n      (ogcFilters.radioButtons && ogcFilters.radioButtons.bundles.length > 0) ||\n      (ogcFilters.select && ogcFilters.select.bundles.length > 0) ||\n      (ogcFilters.autocomplete && ogcFilters.autocomplete.bundles.length > 0)\n    ) {\n      if (ogcFilters.advancedOgcFilters === undefined) {\n        ogcFilters.advancedOgcFilters = false;\n      }\n      this.hasSelector = true;\n    }\n\n    switch (this.datasource.options.type) {\n      case 'wms':\n        this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);\n        break;\n      case 'wfs':\n        this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource);\n        break;\n      default:\n        break;\n    }\n\n    if (ogcFilters) {\n      if (ogcFilters.interfaceOgcFilters) {\n        this.lastRunOgcFilter = JSON.parse(\n          JSON.stringify(ogcFilters.interfaceOgcFilters)\n        );\n        if (\n          ogcFilters.interfaceOgcFilters.filter((f) => f.wkt_geometry).length >=\n          1\n        ) {\n          this.hasActiveSpatialFilter = true;\n        }\n      }\n\n      this.filtersAreEditable = ogcFilters.editable\n        ? ogcFilters.editable\n        : false;\n    }\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  addFilterToSequence() {\n    this.filtersCollapsed = false;\n    const interfaceOgcFilters: OgcInterfaceFilterOptions[] =\n      this.datasource.options.ogcFilters.interfaceOgcFilters;\n    const arr = interfaceOgcFilters || [];\n    const lastLevel = arr.length === 0 ? 0 : arr[arr.length - 1].level;\n    let firstFieldName = '';\n    const includedFields = this.datasource.options.sourceFields.filter(\n      (f) => !f.excludeFromOgcFilters\n    );\n    if (includedFields.length > 0) {\n      firstFieldName =\n        includedFields[0].name === undefined ? '' : includedFields[0].name;\n    }\n    let fieldNameGeometry;\n    const datasourceOptions = this.datasource\n      .options as WFSDataSourceOptionsParams;\n    if (datasourceOptions.fieldNameGeometry) {\n      fieldNameGeometry = datasourceOptions.fieldNameGeometry;\n    } else if (\n      (this.datasource.options as any).paramsWFS &&\n      (this.datasource.options as any).paramsWFS.fieldNameGeometry\n    ) {\n      fieldNameGeometry = (this.datasource.options as any).paramsWFS\n        .fieldNameGeometry;\n    }\n    const allowedOperators = this.ogcFilterWriter.computeAllowedOperators(\n      this.datasource.options.sourceFields,\n      firstFieldName,\n      this.datasource.options.ogcFilters.allowedOperatorsType\n    );\n    const firstOperatorName = Object.keys(allowedOperators)[0];\n\n    arr.push(\n      this.ogcFilterWriter.addInterfaceFilter(\n        {\n          propertyName: firstFieldName,\n          operator: firstOperatorName,\n          active: true,\n          igoSpatialSelector: 'fixedExtent',\n          srsName: this.map.projection\n        } as OgcInterfaceFilterOptions,\n        fieldNameGeometry,\n        lastLevel,\n        this.defaultLogicalParent\n      )\n    );\n    this.datasource.options.ogcFilters.interfaceOgcFilters = arr;\n  }\n\n  refreshFilters(force?: boolean) {\n    if (force === true) {\n      this.lastRunOgcFilter = undefined;\n    }\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    const activeFilters = ogcFilters.interfaceOgcFilters\n      ? ogcFilters.interfaceOgcFilters.filter((f) => f.active === true)\n      : [];\n    if (activeFilters.length === 0) {\n      ogcFilters.filters = undefined;\n      ogcFilters.filtered = false;\n    }\n    if (activeFilters.length > 1) {\n      activeFilters[0].parentLogical = activeFilters[1].parentLogical;\n    }\n    if (\n      activeFilters.filter(\n        (af) => ['Contains', 'Intersects', 'Within'].indexOf(af.operator) !== -1\n      ).length === 0\n    ) {\n      this.hasActiveSpatialFilter = false;\n    } else {\n      this.hasActiveSpatialFilter = true;\n    }\n\n    if (\n      !(JSON.stringify(this.lastRunOgcFilter) === JSON.stringify(activeFilters))\n    ) {\n      if (this.layer.dataSource.options.type === 'wfs') {\n        const ogcDataSource: any = this.layer.dataSource;\n        const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n        ogcLayer.filters =\n          this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n            activeFilters\n          );\n        this.layer.dataSource.ol.refresh();\n      } else if (\n        this.layer.dataSource.options.type === 'wms' &&\n        ogcFilters.enabled\n      ) {\n        let rebuildFilter = '';\n        if (activeFilters.length >= 1) {\n          const ogcDataSource: any = this.layer.dataSource;\n          const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n          ogcLayer.filters =\n            this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n              activeFilters\n            );\n          rebuildFilter = this.ogcFilterWriter.buildFilter(\n            ogcLayer.filters,\n            undefined,\n            undefined,\n            (this.layer.dataSource.options as any).fieldNameGeometry,\n            ogcDataSource.options\n          );\n        }\n        this.ogcFilterService.filterByOgc(\n          this.datasource as WMSDataSource,\n          rebuildFilter\n        );\n        this.datasource.options.ogcFilters.filtered =\n          activeFilters.length === 0 ? false : true;\n      }\n\n      this.lastRunOgcFilter = JSON.parse(JSON.stringify(activeFilters));\n    } else {\n      // identical filter. Nothing triggered\n    }\n    (this.layer.dataSource as OgcFilterableDataSource).setOgcFilters(\n      ogcFilters,\n      true\n    );\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  public isAdvancedOgcFilters(): boolean {\n    return this.datasource.options.ogcFilters.advancedOgcFilters;\n  }\n\n  public addFilterDisabled(): boolean {\n    return (\n      !this.datasource.options.sourceFields ||\n      this.datasource.options.sourceFields.length === 0\n    );\n  }\n\n  private changeOgcFiltersAdvancedOgcFilters(value: boolean) {\n    this.datasource.options.ogcFilters.advancedOgcFilters = value;\n  }\n\n  changeOgcFilterType(isAdvancedOgcFilters) {\n    this.changeOgcFiltersAdvancedOgcFilters(isAdvancedOgcFilters.checked);\n    if (isAdvancedOgcFilters.checked) {\n      this.refreshFilters(true);\n    }\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <div\n    id=\"no-layer-message\"\n    *ngIf=\"(layers | filterableDataSource: 'ogc').length === 0\"\n  >\n    {{ 'igo.geo.filter.noFilterableLayer' | translate }}\n  </div>\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'ogc'\">\n    <igo-ogc-filterable-item\n      igoListItem\n      [header]=\"true\"\n      [layer]=\"layer\"\n      [map]=\"layer.map\"\n    ></igo-ogc-filterable-item>\n  </ng-template>\n</igo-list>\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map/shared';\n\n@Component({\n  selector: 'igo-ogc-filterable-list',\n  templateUrl: './ogc-filterable-list.component.html',\n  styleUrls: ['./ogc-filterable-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterableListComponent {\n  @Input() layers: Layer[];\n\n  @Input() map: IgoMap;\n\n  constructor() {}\n}\n","<button\n  *ngIf=\"\n    header &&\n    options.ogcFilters &&\n    options.ogcFilters.enabled &&\n    (options.ogcFilters.pushButtons ||\n      options.ogcFilters.checkboxes ||\n      options.ogcFilters.radioButtons ||\n      options.ogcFilters.select ||\n      options.ogcFilters.autocomplete ||\n      options.ogcFilters.editable)\n  \"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\"\n>\n  <mat-icon\n    aria-hidden=\"false\"\n    [matBadge]=\"badge\"\n    matBadgeColor=\"warn\"\n    matBadgeSize=\"medium\"\n    svgIcon=\"filter\"\n  ></mat-icon>\n</button>\n\n<div\n  #ogcFilter\n  class=\"igo-layer-actions-container\"\n  *ngIf=\"\n    options.ogcFilters &&\n    options.ogcFilters.enabled &&\n    (options.ogcFilters.pushButtons ||\n      options.ogcFilters.checkboxes ||\n      options.ogcFilters.radioButtons ||\n      options.ogcFilters.select ||\n      options.ogcFilters.autocomplete ||\n      options.ogcFilters.editable)\n  \"\n>\n  <igo-ogc-filterable-item\n    *ngIf=\"ogcFilterCollapse && options.ogcFilters.enabled\"\n    igoListItem\n    [header]=\"false\"\n    [map]=\"layer.map\"\n    [layer]=\"layer\"\n  >\n  </igo-ogc-filterable-item>\n</div>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit\n} from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map/shared';\nimport {\n  OgcFilterableDataSourceOptions,\n  IgoOgcSelector\n} from '../shared/ogc-filter.interface';\n\n@Component({\n  selector: 'igo-ogc-filter-button',\n  templateUrl: './ogc-filter-button.component.html',\n  styleUrls: ['./ogc-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterButtonComponent implements OnInit {\n  public options: OgcFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.ogcFilters as any;\n    let cnt = 0;\n    if (filter && !filter.advancedOgcFilters) {\n      if (filter.pushButtons) {\n        const pushButtons = filter.pushButtons as IgoOgcSelector;\n        const currentPushButtonGroup = pushButtons.groups.find(\n          (gr) => gr.enabled\n        );\n        let cntPushButtons = 0;\n        if (currentPushButtonGroup) {\n          currentPushButtonGroup.computedSelectors?.map(\n            (cb) =>\n              (cntPushButtons += (cb.selectors as any)?.filter(\n                (button) => button.enabled\n              ).length)\n          );\n        }\n        cnt += cntPushButtons;\n      }\n      if (filter.checkboxes) {\n        const checkboxes = filter.checkboxes as IgoOgcSelector;\n        const currentCheckboxGroup = checkboxes.groups.find((gr) => gr.enabled);\n        let cntCheckboxes = 0;\n        if (currentCheckboxGroup) {\n          currentCheckboxGroup.computedSelectors?.map(\n            (cb) =>\n              (cntCheckboxes += (cb.selectors as any)?.filter(\n                (checkbox) => checkbox.enabled\n              ).length)\n          );\n        }\n        cnt += cntCheckboxes;\n      }\n      if (filter.radioButtons) {\n        const radioButtons = filter.radioButtons as IgoOgcSelector;\n        const currentRadioButtonsGroup = radioButtons.groups.find(\n          (gr) => gr.enabled\n        );\n        let cntRadioButtons = 0;\n        if (currentRadioButtonsGroup) {\n          currentRadioButtonsGroup.computedSelectors?.map(\n            (cb) =>\n              (cntRadioButtons += (cb.selectors as any)?.filter(\n                (radio) => radio.enabled\n              ).length)\n          );\n        }\n        cnt += cntRadioButtons;\n      }\n      if (filter.select) {\n        const select = filter.select as IgoOgcSelector;\n        const currentSelectGroup = select.groups.find((gr) => gr.enabled);\n        let cntSelect = 0;\n        if (currentSelectGroup) {\n          currentSelectGroup.computedSelectors?.map(\n            (cb) =>\n              (cntSelect += (cb.selectors as any)?.filter(\n                (multi) => multi.enabled\n              ).length)\n          );\n        }\n        cnt += cntSelect;\n      }\n      if (filter.autocomplete) {\n        const autocomplete = filter.autocomplete as IgoOgcSelector;\n        const currentAutocompleteGroup = autocomplete.groups.find(\n          (gr) => gr.enabled\n        );\n        let cntAutocomplete = 0;\n        if (currentAutocompleteGroup) {\n          currentAutocompleteGroup.computedSelectors?.map(\n            (cb) =>\n              (cntAutocomplete += (cb.selectors as any)?.filter(\n                (autocomplete) => autocomplete.enabled\n              ).length)\n          );\n        }\n        cnt += cntAutocomplete;\n      }\n    } else if (filter && filter.filters && !filter.filters.filters) {\n      return 1;\n    } else if (filter && filter.filters && filter.filters.filters) {\n      return filter.filters.filters.length;\n    }\n    if (\n      filter.filters &&\n      filter.filters.operator === 'During' &&\n      filter.filters.active &&\n      filter.interfaceOgcFilters &&\n      filter.interfaceOgcFilters[0].active\n    ) {\n      const filterActiveValue = filter.interfaceOgcFilters[0];\n      if (filter.filters.calendarModeYear) {\n        // year mode check just year\n        if (\n          filterActiveValue.begin.substring(0, 4) !==\n            this.options.minDate.substring(0, 4) ||\n          filterActiveValue.end.substring(0, 4) !==\n            this.options.maxDate.substring(0, 4)\n        ) {\n          cnt += 1;\n        }\n      } else if (\n        filterActiveValue.begin !== this.options.minDate ||\n        filterActiveValue.end !== this.options.maxDate\n      ) {\n        cnt += 1;\n      }\n    }\n    return cnt > 0 ? cnt : undefined;\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource\n        .options as OgcFilterableDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: IgoMap;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean;\n\n  public ogcFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource\n      .options as OgcFilterableDataSourceOptions;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { default as moment } from 'moment';\n\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterTimeService {\n  readonly defaultStepMillisecond = 60000;\n\n  constructor() {}\n\n  step(datasource: OgcFilterableDataSource, currentFilter): string {\n    return datasource.options.stepDate\n      ? datasource.options.stepDate\n      : currentFilter.step;\n  }\n\n  stepMillisecond(dataSource: OgcFilterableDataSource, currentFilter): number {\n    const step = moment\n      .duration(this.step(dataSource, currentFilter))\n      .asMilliseconds();\n    return step === 0 ? this.defaultStepMillisecond : step;\n  }\n\n  stepIsYearDuration(step: string) {\n    const year = moment.duration(step);\n    return (\n      year.years() !== 0 &&\n      year.months() === 0 &&\n      year.weeks() === 0 &&\n      year.days() === 0 &&\n      year.hours() === 0 &&\n      year.minutes() === 0\n    );\n  }\n\n  stepIsMonthDuration(step: string) {\n    const month = moment.duration(step);\n    return (\n      month.months() !== 0 &&\n      month.weeks() === 0 &&\n      month.days() === 0 &&\n      month.hours() === 0 &&\n      month.minutes() === 0\n    );\n  }\n\n  stepIsWeekDuration(step: string) {\n    const week = moment.duration(step);\n    return (\n      week.weeks() !== 0 &&\n      week.days() === 7 &&\n      week.hours() === 0 &&\n      week.minutes() === 0\n    );\n  }\n\n  stepIsDayDuration(step: string) {\n    const day = moment.duration(step);\n    return day.days() !== 0 && day.hours() === 0 && day.minutes() === 0;\n  }\n\n  stepIsHourDuration(step: string) {\n    const hour = moment.duration(step);\n    return hour.hours() !== 0 && hour.minutes() === 0;\n  }\n\n  stepIsMinuteDuration(step: string) {\n    const minute = moment.duration(step);\n    return minute.minutes() !== 0;\n  }\n\n  dateToNumber(date: Date): number {\n    let newDate = new Date();\n    if (date) {\n      newDate = new Date(date);\n    }\n    return newDate.getTime();\n  }\n\n  public addStep(value, stepMillisecond) {\n    return moment(value).add(stepMillisecond, 'milliseconds').toDate();\n  }\n\n  public subtractStep(value, stepMillisecond) {\n    return moment(value).subtract(stepMillisecond, 'milliseconds').toDate();\n  }\n}\n","<form [formGroup]=\"form\">\n  <div *ngFor=\"let selector of ogcFiltersSelectors\">\n    <div\n      class=\"pushButtonGroups\"\n      *ngIf=\"selector.selectorType === 'pushButton'\"\n    >\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getPushButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"pushButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentPushButtonsGroup\"\n          >\n            <mat-option\n              *ngFor=\"let selectorGroup of getPushButtonsGroups()\"\n              [value]=\"selectorGroup\"\n              >{{ selectorGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container\n        *ngFor=\"let bundle of currentPushButtonsGroup.computedSelectors\"\n      >\n        <h3>{{ bundle.title }}</h3>\n        <mat-button-toggle-group\n          formControlName=\"pushButtons\"\n          class=\"mat-typography\"\n          appearance=\"legacy\"\n          vertical=\"{{ bundleIsVertical(bundle) }}\"\n          multiple=\"true\"\n        >\n          <mat-button-toggle\n            *ngFor=\"let ogcPushButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcPushButton)\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            [ngStyle]=\"getButtonColor(ogcPushButton)\"\n            [checked]=\"ogcPushButton.enabled\"\n            (change)=\"onSelectionChange(ogcPushButton, selector.selectorType)\"\n            [value]=\"ogcPushButton\"\n            >{{ ogcPushButton.title }}\n          </mat-button-toggle>\n        </mat-button-toggle-group>\n      </ng-container>\n    </div>\n\n    <div class=\"checkboxGroups\" *ngIf=\"selector.selectorType === 'checkbox'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getCheckboxesGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"checkboxesGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentCheckboxesGroup\"\n          >\n            <mat-option\n              *ngFor=\"let selectorGroup of getCheckboxesGroups()\"\n              [value]=\"selectorGroup\"\n              >{{ selectorGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container\n        *ngFor=\"let bundle of currentCheckboxesGroup.computedSelectors\"\n      >\n        <h3>{{ bundle.title }}</h3>\n        <div class=\"checkboxes mat-typography\">\n          <mat-checkbox\n            *ngFor=\"let ogcCheckbox of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcCheckbox)\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcCheckbox.enabled\"\n            (change)=\"onSelectionChange(ogcCheckbox, selector.selectorType)\"\n            [value]=\"ogcCheckbox\"\n            >{{ ogcCheckbox.title }}\n          </mat-checkbox>\n        </div>\n        <p\n          *ngIf=\"\n            isLessResults(bundle, 'checkbox') ||\n            isMoreResults(bundle, 'checkbox')\n          \"\n        >\n          <u\n            *ngIf=\"isLessResults(bundle, 'checkbox')\"\n            class=\"lessResults mat-typography\"\n            (click)=\"displayLessResults('checkbox')\"\n            >{{ 'igo.geo.filter.displayLessResults' | translate }}\n          </u>\n          <u\n            *ngIf=\"isMoreResults(bundle, 'checkbox')\"\n            class=\"moreResults mat-typography\"\n            (click)=\"displayMoreResults('checkbox')\"\n            >{{ 'igo.geo.filter.displayMoreResults' | translate }}\n          </u>\n        </p>\n      </ng-container>\n    </div>\n\n    <div\n      class=\"radioButtonGroups\"\n      *ngIf=\"selector.selectorType === 'radioButton'\"\n    >\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getRadioButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"radioButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentRadioButtonsGroup\"\n          >\n            <mat-option\n              *ngFor=\"let selectorGroup of getRadioButtonsGroups()\"\n              [value]=\"selectorGroup\"\n              >{{ selectorGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container\n        *ngFor=\"let bundle of currentRadioButtonsGroup.computedSelectors\"\n      >\n        <h3>{{ bundle.title }}</h3>\n        <mat-radio-group formControlName=\"radioButtons\" class=\"mat-typography\">\n          <mat-radio-button\n            *ngIf=\"bundle.unfiltered\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            (change)=\"emptyRadioButtons()\"\n            >{{ 'igo.geo.filter.resetFilters' | translate }}\n          </mat-radio-button>\n          <mat-radio-button\n            *ngFor=\"let ogcRadioButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcRadioButton)\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcRadioButton.enabled\"\n            (change)=\"onSelectionChange(ogcRadioButton, selector.selectorType)\"\n            [value]=\"ogcRadioButton\"\n            >{{ ogcRadioButton.title }}\n          </mat-radio-button>\n          <p\n            *ngIf=\"\n              isLessResults(bundle, 'radio') || isMoreResults(bundle, 'radio')\n            \"\n          >\n            <u\n              *ngIf=\"isLessResults(bundle, 'radio')\"\n              class=\"lessResults mat-typography\"\n              (click)=\"displayLessResults('radio')\"\n              >{{ 'igo.geo.filter.displayLessResults' | translate }}\n            </u>\n            <u\n              *ngIf=\"isMoreResults(bundle, 'radio')\"\n              class=\"moreResults mat-typography\"\n              (click)=\"displayMoreResults('radio')\"\n              >{{ 'igo.geo.filter.displayMoreResults' | translate }}\n            </u>\n          </p>\n        </mat-radio-group>\n      </ng-container>\n    </div>\n\n    <div class=\"selectGroups\" *ngIf=\"selector.selectorType === 'select'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getSelectGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"selectGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentSelectGroup\"\n          >\n            <mat-option\n              *ngFor=\"let selectorGroup of getSelectGroups()\"\n              [value]=\"selectorGroup\"\n              >{{ selectorGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentSelectGroup.computedSelectors\">\n        <h3>{{ bundle.title }}</h3>\n        <div class=\"groupsSelector\">\n          <mat-button\n            *ngIf=\"bundle.unfiltered && !bundle.multiple\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            (click)=\"emptySelect()\"\n          >\n            <mat-icon svgIcon=\"filter-remove\"></mat-icon>\n          </mat-button>\n          <mat-form-field\n            [style.width.%]=\"bundle.width ? bundle.width : undefined\"\n          >\n            <div *ngIf=\"bundle.multiple; else notMulti\">\n              <mat-select\n                #selection\n                [multiple]=\"bundle.multiple\"\n                [placeholder]=\"bundle.title\"\n                formControlName=\"selectMulti\"\n              >\n                <div class=\"checkboxes mat-typography\">\n                  <mat-checkbox\n                    *ngIf=\"bundle.multiple\"\n                    [(ngModel)]=\"selectAllSelected\"\n                    [ngModelOptions]=\"{ standalone: true }\"\n                    (change)=\"toggleAllSelection()\"\n                    >Tous\n                  </mat-checkbox>\n                </div>\n                <mat-option\n                  *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\"\n                  tooltip-position=\"below\"\n                  matTooltipDelay=\"500\"\n                  matTooltipClass=\"material-tooltip\"\n                  (onSelectionChange)=\"\n                    selectOptionClick($event.source.value, bundle, $event)\n                  \"\n                  [value]=\"ogcSelect\"\n                  >{{ ogcSelect.title }}\n                </mat-option>\n              </mat-select>\n            </div>\n            <ng-template #notMulti>\n              <mat-select [placeholder]=\"bundle.title\" formControlName=\"select\">\n                <mat-option\n                  *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\"\n                  tooltip-position=\"below\"\n                  matTooltipDelay=\"500\"\n                  matTooltipClass=\"material-tooltip\"\n                  [value]=\"ogcSelect\"\n                  (onSelectionChange)=\"\n                    selectOptionClick($event.source.value, bundle)\n                  \"\n                  >{{ ogcSelect.title }}\n                </mat-option>\n              </mat-select>\n            </ng-template>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n\n    <div\n      class=\"autocompleteGroups\"\n      *ngIf=\"selector.selectorType === 'autocomplete'\"\n    >\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getAutocompleteGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"autocompleteGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [(value)]=\"currentAutocompleteGroup\"\n          >\n            <mat-option\n              *ngFor=\"let autocompleteGroup of getAutocompleteGroups()\"\n              [value]=\"autocompleteGroup\"\n              >{{ autocompleteGroup.title }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container\n        *ngFor=\"let bundle of currentAutocompleteGroup.computedSelectors\"\n      >\n        <h3>{{ bundle.title }}</h3>\n        <div class=\"groupsSelector\">\n          <mat-button\n            *ngIf=\"bundle.unfiltered\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n            tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            matTooltipClass=\"material-tooltip\"\n            (click)=\"emptyAutocomplete()\"\n          >\n            <mat-icon svgIcon=\"filter-remove\"></mat-icon>\n          </mat-button>\n          <mat-form-field\n            *ngIf=\"filteredOgcAutocomplete[bundle.id]\"\n            [style.width.%]=\"bundle.width ? bundle.width : undefined\"\n          >\n            <input\n              matInput\n              type=\"text\"\n              formControlName=\"autocomplete\"\n              #autocomplete\n              class=\"autocomplete\"\n              [matAutocomplete]=\"auto\"\n              [placeholder]=\"bundle.title\"\n            />\n            <mat-autocomplete\n              #auto=\"matAutocomplete\"\n              #autocomplete\n              (optionSelected)=\"autocompleteOptionClick($event.option.value)\"\n              [displayWith]=\"displayFn\"\n            >\n              <mat-option\n                *ngFor=\"\n                  let ogcAutocomplete of filteredOgcAutocomplete[bundle.id]\n                    | async\n                \"\n                [value]=\"ogcAutocomplete\"\n              >\n                {{ ogcAutocomplete.value }}\n              </mat-option>\n            </mat-autocomplete>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n  </div>\n</form>\n\n<div *ngIf=\"isTemporalOperator()\">\n  <mat-divider></mat-divider>\n  <h3 *ngIf=\"!currentFilter.title\">\n    {{ 'igo.geo.filter.reportingDate' | translate }}\n  </h3>\n  <h3 *ngIf=\"currentFilter.title\">{{ currentFilter.title }}</h3>\n  <igo-ogc-filter-time\n    [(datasource)]=\"datasource\"\n    [(currentFilter)]=\"currentFilter\"\n    (changeProperty)=\"changeProperty($event.value, $event.pos)\"\n  >\n  </igo-ogc-filter-time>\n</div>\n","import {\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnInit,\n  ViewChild\n} from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport { DOMService, DOMValue } from '@igo2/common';\n\nimport {\n  OgcFilterableDataSource,\n  IgoOgcFilterObject,\n  OgcPushButton,\n  OgcSelectorBundle,\n  SelectorGroup\n} from '../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { IgoMap } from '../../map/shared';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport {\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { debounceTime, map } from 'rxjs/operators';\nimport { OgcFilterOperator } from '../shared/ogc-filter.enum';\nimport { MatSelect } from '@angular/material/select';\nimport { MatOption } from '@angular/material/core';\nimport { BehaviorSubject, Observable } from 'rxjs';\n\n@Component({\n  selector: 'igo-ogc-filter-selection',\n  templateUrl: './ogc-filter-selection.component.html',\n  styleUrls: ['./ogc-filter-selection.component.scss'],\n  providers: [DOMService]\n})\nexport class OgcFilterSelectionComponent implements OnInit {\n  @ViewChild('selection') sel: MatSelect;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() checkboxesIndex = 5;\n  @Input() radioButtonsIndex = 5;\n  @Input() baseIndex = 5;\n\n  @Input()\n  get currentFilter(): any {\n    return this._currentFilter;\n  }\n  set currentFilter(value) {\n    this._currentFilter = value;\n    if (this._currentFilter?.sliderOptions) {\n      this._currentFilter.sliderOptions.enabled = false; // remove slider toggle (animation temporelle)\n    }\n  }\n  private _currentFilter: any;\n\n  public ogcFilterOperator = OgcFilterOperator;\n\n  public form: UntypedFormGroup;\n  private ogcFilterWriter: OgcFilterWriter;\n  public color = 'primary';\n  public selectAllSelected = false;\n  public selectEnabled$ = new BehaviorSubject(undefined);\n  public selectEnableds$ = new BehaviorSubject([]);\n  public autocompleteEnabled$ = new BehaviorSubject(undefined);\n  public filteredOgcAutocomplete = {};\n\n  public applyFiltersTimeout;\n\n  get ogcFiltersSelectors() {\n    const ogcSelector = [];\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.pushButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.checkboxes);\n    }\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.radioButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.select) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.select);\n    }\n    if (this.datasource?.options?.ogcFilters?.autocomplete) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.autocomplete);\n    }\n    ogcSelector.sort((a, b) => {\n      if (a.order < b.order) {\n        return -1;\n      }\n      if (a.order > b.order) {\n        return 1;\n      }\n      return 0;\n    });\n    return ogcSelector;\n  }\n\n  get currentPushButtonsGroup() {\n    return this.form.get('pushButtonsGroup').value;\n  }\n  set currentPushButtonsGroup(value) {\n    this.form.patchValue({ pushButtonsGroup: value });\n  }\n\n  get currentCheckboxesGroup() {\n    return this.form.get('checkboxesGroup').value;\n  }\n  set currentCheckboxesGroup(value) {\n    this.form.patchValue({ checkboxesGroup: value });\n  }\n\n  get currentRadioButtonsGroup() {\n    return this.form.get('radioButtonsGroup').value;\n  }\n  set currentRadioButtonsGroup(value) {\n    this.form.patchValue({ radioButtonsGroup: value });\n  }\n\n  get currentSelectGroup() {\n    return this.form.get('selectGroup').value;\n  }\n  set currentSelectGroup(value) {\n    this.form.patchValue({ selectGroup: value });\n    this.cdRef.detectChanges();\n  }\n\n  get currentAutocompleteGroup() {\n    return this.form.get('autocompleteGroup').value;\n  }\n  set currentAutocompleteGroup(value) {\n    this.form.patchValue({ autocompleteGroup: value });\n    this.cdRef.detectChanges();\n  }\n\n  get selectEnabled() {\n    return this.selectEnabled$.value;\n  }\n\n  set selectEnabled(value) {\n    this.selectEnabled$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\n      compSelect.selectors?.forEach((selector) => {\n        value === selector\n          ? (selector.enabled = true)\n          : (selector.enabled = false);\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  get selectEnableds() {\n    return this.selectEnableds$.value;\n  }\n\n  set selectEnableds(value) {\n    this.selectEnableds$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\n      compSelect.selectors?.forEach((selector) => {\n        value.includes(selector)\n          ? (selector.enabled = true)\n          : (selector.enabled = false);\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  get autocompleteEnabled() {\n    return this.autocompleteEnabled$.value;\n  }\n\n  set autocompleteEnabled(value) {\n    this.autocompleteEnabled$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentAutocompleteGroup.computedSelectors.forEach((compSelect) => {\n      compSelect.selectors?.forEach((selector) => {\n        value === selector.title\n          ? (selector.enabled = true)\n          : (selector.enabled = false);\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  constructor(\n    private ogcFilterService: OGCFilterService,\n    private formBuilder: UntypedFormBuilder,\n    private domService: DOMService,\n    private configService: ConfigService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n    this.buildForm();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      pushButtons: ['', [Validators.required]],\n      radioButtons: ['', [Validators.required]],\n      pushButtonsGroup: ['', [Validators.required]],\n      checkboxesGroup: ['', [Validators.required]],\n      radioButtonsGroup: ['', [Validators.required]],\n      selectGroup: ['', [Validators.required]],\n      select: ['', [Validators.required]],\n      selectMulti: ['', [Validators.required]],\n      autocompleteGroup: ['', [Validators.required]],\n      autocomplete: ['', [Validators.required]]\n    });\n  }\n\n  getPushButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      return this.datasource.options.ogcFilters.pushButtons.groups;\n    }\n  }\n\n  getCheckboxesGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      return this.datasource.options.ogcFilters.checkboxes.groups;\n    }\n  }\n\n  getRadioButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      return this.datasource.options.ogcFilters.radioButtons.groups;\n    }\n  }\n\n  getSelectGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.select) {\n      return this.datasource.options.ogcFilters.select.groups;\n    }\n  }\n\n  getAutocompleteGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.autocomplete) {\n      return this.datasource.options.ogcFilters.autocomplete.groups;\n    }\n  }\n\n  async ngOnInit() {\n    if (this.datasource.options.ogcFilters) {\n      if (this.datasource.options.ogcFilters.pushButtons) {\n        this.currentPushButtonsGroup =\n          this.datasource.options.ogcFilters.pushButtons.groups.find(\n            (group) => group.enabled\n          ) || this.datasource.options.ogcFilters.pushButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.checkboxes) {\n        this.currentCheckboxesGroup =\n          this.datasource.options.ogcFilters.checkboxes.groups.find(\n            (group) => group.enabled\n          ) || this.datasource.options.ogcFilters.checkboxes.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.radioButtons) {\n        this.currentRadioButtonsGroup =\n          this.datasource.options.ogcFilters.radioButtons.groups.find(\n            (group) => group.enabled\n          ) || this.datasource.options.ogcFilters.radioButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.select) {\n        this.currentSelectGroup =\n          this.datasource.options.ogcFilters.select.groups.find(\n            (group) => group.enabled\n          ) || this.datasource.options.ogcFilters.select.groups[0];\n        this.getSelectEnabled();\n        await this.getSelectDomValues();\n      }\n      if (this.datasource.options.ogcFilters.autocomplete) {\n        this.currentAutocompleteGroup =\n          this.datasource.options.ogcFilters.autocomplete.groups.find(\n            (group) => group.enabled\n          ) || this.datasource.options.ogcFilters.autocomplete.groups[0];\n        this.getAutocompleteEnabled();\n        await this.getAutocompleteDomValues();\n      }\n      this.applyFilters();\n    }\n\n    this.form\n      .get('pushButtonsGroup')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onPushButtonsChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('checkboxesGroup')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onCheckboxesChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('radioButtonsGroup')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onRadioButtonsChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('selectGroup')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onSelectChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('autocompleteGroup')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onAutocompleteChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('pushButtons')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n    this.form\n      .get('radioButtons')\n      .valueChanges.pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n  }\n\n  private getSelectEnabled() {\n    const enableds = [];\n    let enabled;\n    this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\n      if (compSelect.multiple) {\n        compSelect.selectors?.forEach((selector) => {\n          if (selector.enabled) {\n            enableds.push(selector);\n          }\n        });\n        this.selectEnableds = enableds;\n        this.form.controls['selectMulti'].setValue(enableds);\n      } else {\n        compSelect.selectors?.forEach((selector) => {\n          if (selector.enabled) {\n            enabled = selector;\n          }\n        });\n        this.form.controls['select'].reset(enabled);\n        this.selectEnabled$.subscribe((value) => {\n          if (this.form.controls['select'].value !== value) {\n            this.form.controls['select'].setValue(value);\n          }\n        });\n        this.selectEnabled = enabled;\n      }\n    });\n  }\n\n  private getAutocompleteEnabled() {\n    let enabled;\n    this.currentAutocompleteGroup.computedSelectors.forEach((compSelect) => {\n      compSelect.selectors?.forEach((selector) => {\n        if (selector.enabled) {\n          const dom = {\n            id: selector.filters.expression,\n            value: selector.title\n          };\n          enabled = selector.title;\n          this.form.controls['autocomplete'].setValue(dom);\n        }\n      });\n      this.autocompleteEnabled = enabled;\n    });\n  }\n\n  getToolTip(selector): string {\n    let toolTip;\n    if (selector.tooltip) {\n      if (Array.isArray(selector.tooltip)) {\n        toolTip = selector.tooltip.join('\\n');\n      } else {\n        toolTip = selector.tooltip;\n      }\n    }\n    return toolTip || '';\n  }\n\n  async getSelectDomValues() {\n    for (const bundle of this.datasource.options.ogcFilters.select.bundles) {\n      if (bundle.domSelectors) {\n        let domValues;\n        for (const domSelector of bundle.domSelectors) {\n          let filterDOM;\n          for (const domOptions of this.configService.getConfig('dom')) {\n            if (\n              domSelector.id === domOptions.id ||\n              domSelector.name === domOptions.name\n            ) {\n              filterDOM = {\n                id: domOptions.id,\n                url: domOptions.url,\n                name: domOptions.name,\n                values: domOptions.values\n              };\n            }\n          }\n          filterDOM.url\n            ? (domValues = (await this.domService.getDom(\n                filterDOM\n              )) as DOMValue[])\n            : (domValues = filterDOM.values);\n\n          if (domValues) {\n            let newBundle = bundle;\n            newBundle.selectors = [];\n            let selector;\n            for (const value of domValues) {\n              if (bundle.multiple) {\n                let enabled;\n                this.selectEnableds?.find((sel) => sel.title === value.value)\n                  ? (enabled = true)\n                  : (enabled = false);\n                selector = {\n                  title: value.value,\n                  enabled,\n                  filters: {\n                    operator: domSelector.operator,\n                    propertyName: domSelector.propertyName,\n                    expression: value.id\n                  }\n                };\n              } else {\n                selector = {\n                  title: value.value,\n                  enabled:\n                    this.selectEnabled?.title === value.value ? true : false,\n                  filters: {\n                    operator: domSelector.operator,\n                    propertyName: domSelector.propertyName,\n                    expression: value.id\n                  }\n                };\n              }\n              newBundle.selectors.push(selector);\n            }\n            this.getSelectGroups()\n              .find((group) => group.ids.includes(newBundle.id))\n              .computedSelectors.find(\n                (comp) => comp.title === newBundle.title\n              ).selectors = newBundle.selectors;\n          }\n        }\n        this.getSelectEnabled();\n      }\n    }\n  }\n\n  async getAutocompleteDomValues() {\n    for (const bundle of this.datasource.options.ogcFilters.autocomplete\n      .bundles) {\n      if (bundle.domSelectors) {\n        let domValues;\n        for (const domSelector of bundle.domSelectors) {\n          let filterDOM;\n          for (const domOptions of this.configService.getConfig('dom')) {\n            if (\n              domSelector.id === domOptions.id ||\n              domSelector.name === domOptions.name\n            ) {\n              filterDOM = {\n                id: domOptions.id,\n                url: domOptions.url,\n                name: domOptions.name,\n                values: domOptions.values\n              };\n            }\n          }\n          filterDOM.url\n            ? (domValues = (await this.domService.getDom(\n                filterDOM\n              )) as DOMValue[])\n            : (domValues = filterDOM.values);\n\n          if (domValues) {\n            let newBundle = bundle;\n            newBundle.selectors = [];\n            let selector;\n            for (const value of domValues) {\n              selector = {\n                title: value.value,\n                enabled:\n                  this.autocompleteEnabled &&\n                  this.autocompleteEnabled === value.value\n                    ? true\n                    : false,\n                filters: {\n                  operator: domSelector.operator,\n                  propertyName: domSelector.propertyName,\n                  expression: value.id\n                }\n              };\n              newBundle.selectors.push(selector);\n            }\n            this.getAutocompleteGroups()\n              .find((group) => group.ids.includes(newBundle.id))\n              .computedSelectors.find(\n                (comp) => comp.title === newBundle.title\n              ).selectors = newBundle.selectors;\n          }\n        }\n\n        this.filteredOgcAutocomplete[bundle.id] = new Observable<any[]>();\n        this.cdRef.detectChanges();\n        this.filteredOgcAutocomplete[bundle.id] = this.form.controls[\n          'autocomplete'\n        ].valueChanges.pipe(\n          map((value) => {\n            if (value.length) {\n              return domValues?.filter((option) => {\n                const filterNormalized = value\n                  ? value\n                      .toLowerCase()\n                      .normalize('NFD')\n                      .replace(/[\\u0300-\\u036f]/g, '')\n                  : '';\n                const featureNameNormalized = option.value\n                  .toLowerCase()\n                  .normalize('NFD')\n                  .replace(/[\\u0300-\\u036f]/g, '');\n                return featureNameNormalized.includes(filterNormalized);\n              });\n            }\n          })\n        );\n      }\n    }\n  }\n\n  // getButtonStyle(pb: OgcPushButton): {} {\n\n  //   let styles;\n  //   if (pb.color) {\n  //     styles = {\n  //       'background-color': pb.enabled ? `rgba(${pb.color})` : `rgba(255,255,255,0)`\n  //     };\n  //   } else {\n  //     styles = {\n  //       'background-color': pb.enabled ? 'accent': `rgba(255,255,255,0)`,\n  //       'color': pb.enabled ? `rgba(0,0,0,0.9)` : `rgba(33,33,33,0.38)`\n  //     }\n  //   }\n  //   return styles;\n  // }\n\n  getButtonColor(pushButton: OgcPushButton): {} {\n    let styles;\n    if (pushButton.color && pushButton.enabled) {\n      styles = {\n        'background-color': `rgba(${pushButton.color})`\n      };\n    }\n    return styles;\n  }\n\n  bundleIsVertical(bundle: OgcSelectorBundle): boolean {\n    return bundle.vertical ? bundle.vertical : false;\n  }\n\n  private onPushButtonsChangeGroup() {\n    this.getPushButtonsGroups().map((group) => (group.enabled = false));\n    this.getPushButtonsGroups().find(\n      (group) => group === this.currentPushButtonsGroup\n    ).enabled = true;\n  }\n\n  private onCheckboxesChangeGroup() {\n    this.getCheckboxesGroups().map((group) => (group.enabled = false));\n    this.getCheckboxesGroups().find(\n      (group) => group === this.currentCheckboxesGroup\n    ).enabled = true;\n  }\n\n  private onRadioButtonsChangeGroup() {\n    this.getRadioButtonsGroups().map((group) => (group.enabled = false));\n    this.getRadioButtonsGroups().find(\n      (group) => group === this.currentRadioButtonsGroup\n    ).enabled = true;\n  }\n\n  private onSelectChangeGroup() {\n    this.getSelectGroups().map((group) => (group.enabled = false));\n    this.getSelectGroups().find(\n      (group) => group === this.currentSelectGroup\n    ).enabled = true;\n  }\n\n  private onAutocompleteChangeGroup() {\n    this.getAutocompleteGroups().map((group) => (group.enabled = false));\n    this.getAutocompleteGroups().find(\n      (group) => group === this.currentAutocompleteGroup\n    ).enabled = true;\n  }\n\n  onSelectionChange(currentOgcSelection?, selectorType?) {\n    clearTimeout(this.applyFiltersTimeout);\n    if (selectorType === 'radioButton') {\n      this.emptyRadioButtons();\n    }\n\n    if (currentOgcSelection) {\n      currentOgcSelection.enabled = !currentOgcSelection.enabled;\n    }\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  emptyRadioButtons() {\n    this.currentRadioButtonsGroup.computedSelectors.forEach((compSelect) => {\n      compSelect.selectors.map((selector) => (selector.enabled = false));\n\n      this.applyFiltersTimeout = setTimeout(() => {\n        this.applyFilters();\n      }, 750);\n    });\n  }\n\n  emptySelect() {\n    this.selectEnabled = undefined;\n  }\n\n  emptyAutocomplete() {\n    this.autocompleteEnabled = undefined;\n    this.form.controls['autocomplete'].setValue('');\n    this.form.controls['autocomplete'].markAsUntouched();\n  }\n\n  toggleAllSelection() {\n    if (this.selectAllSelected) {\n      const enableds = [];\n      this.currentSelectGroup.computedSelectors.forEach((compSelect) => {\n        compSelect.selectors?.forEach((selector) => {\n          enableds.push(selector);\n        });\n      });\n      this.sel.options.forEach((item: MatOption) => item.select());\n      this.selectEnableds = enableds;\n    } else {\n      this.sel.options.forEach((item: MatOption) => item.deselect());\n      this.selectEnableds = [];\n    }\n  }\n\n  selectOptionClick(value, bundle, event?) {\n    if (bundle.multiple) {\n      const enableds = this.selectEnableds;\n      let newStatus = true;\n      this.sel.options.forEach((item: MatOption) => {\n        if (!item.selected) {\n          newStatus = false;\n        }\n      });\n      this.selectAllSelected = newStatus;\n      if (event.isUserInput) {\n        if (enableds.length) {\n          for (const enabled of enableds) {\n            if (enabled.title === value.title) {\n              if (enabled.enabled && value.enabled) {\n                enableds.splice(enableds.indexOf(enabled), 1);\n                this.selectEnableds = enableds;\n                break;\n              }\n            } else if (enableds.indexOf(enabled) === enableds.length - 1) {\n              enableds.push(value);\n              this.selectEnableds = enableds;\n              break;\n            }\n          }\n        } else {\n          enableds.push(value);\n          this.selectEnableds = enableds;\n        }\n      }\n    } else {\n      this.selectEnabled = value;\n    }\n  }\n\n  autocompleteOptionClick(value) {\n    this.autocompleteEnabled = value.value;\n  }\n\n  displayFn(dom): string {\n    return dom ? dom.value : undefined;\n  }\n\n  private applyFilters() {\n    let filterQueryString = '';\n    const conditions = [];\n    const currentGroups = [\n      this.currentPushButtonsGroup,\n      this.currentCheckboxesGroup,\n      this.currentRadioButtonsGroup,\n      this.currentSelectGroup,\n      this.currentAutocompleteGroup\n    ];\n    for (const currentGroup of currentGroups) {\n      if (currentGroup.computedSelectors) {\n        currentGroup.computedSelectors.map((selectorBundle) => {\n          const bundleCondition = [];\n          selectorBundle.selectors\n            ?.filter((ogcSelector) => ogcSelector.enabled === true)\n            .forEach((enabledSelector) =>\n              bundleCondition.push(enabledSelector.filters)\n            );\n          if (bundleCondition.length >= 1) {\n            if (bundleCondition.length === 1) {\n              conditions.push(bundleCondition[0]);\n            } else {\n              conditions.push({\n                logical: selectorBundle.logical,\n                filters: bundleCondition\n              });\n            }\n          }\n        });\n      }\n    }\n    if (this.isTemporalOperator() && this._currentFilter.active) {\n      conditions.push(\n        this.datasource.options.ogcFilters.interfaceOgcFilters[0]\n      );\n    }\n    if (conditions.length >= 1) {\n      filterQueryString = this.ogcFilterWriter.buildFilter(\n        conditions.length === 1\n          ? conditions[0]\n          : ({ logical: 'And', filters: conditions } as IgoOgcFilterObject)\n      );\n    }\n    if (this.datasource.options.type === 'wms') {\n      this.ogcFilterService.filterByOgc(\n        this.datasource as WMSDataSource,\n        filterQueryString\n      );\n    }\n    if (this.datasource.options.type === 'wfs') {\n      // TODO: Check how to prevent wfs to refresh when filter icon is pushed...\n      this.datasource.ol.refresh();\n    }\n    this.datasource.setOgcFilters(this.datasource.options.ogcFilters, true);\n  }\n\n  isMoreResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index =\n      type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return selectorsLength > index;\n  }\n\n  displayMoreResults(type) {\n    type === 'radio'\n      ? (this.radioButtonsIndex += 5)\n      : (this.checkboxesIndex += 5);\n    return;\n  }\n\n  isLessResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index =\n      type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return this.baseIndex !== index && selectorsLength > this.baseIndex;\n  }\n\n  displayLessResults(type) {\n    type === 'radio'\n      ? (this.radioButtonsIndex = this.baseIndex)\n      : (this.checkboxesIndex = this.baseIndex);\n    return;\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter?.operator?.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (filter) => filter.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if (refreshFilter) {\n        this.applyFilters();\n      }\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n          ? 'upperBoundary'\n          : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n          ? 'end'\n          : undefined;\n      default:\n        return;\n    }\n  }\n}\n","export enum SpatialFilterQueryType {\n  AdmRegion = 'AdmRegion',\n  Mun = 'Mun',\n  Arrond = 'Arrond',\n  CircFed = 'CircFed',\n  CircProv = 'CircProv',\n  DirReg = 'DirReg',\n  MRC = 'MRC',\n  RegTour = 'RegTour'\n}\n\nexport enum SpatialFilterType {\n  Predefined = 'Predefined',\n  Polygon = 'Polygon',\n  Point = 'Point'\n}\n\nexport enum SpatialFilterItemType {\n  Address = 'Address',\n  Thematics = 'Thematics'\n}\n","<mat-tab-group\n  [selectedIndex]=\"selectedTypeIndex.value\"\n  (selectedIndexChange)=\"selectedTypeIndex.setValue($event)\"\n  (selectedTabChange)=\"onTypeChange($event)\"\n>\n  <mat-tab [label]=\"'igo.geo.spatialFilter.predefined' | translate\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.spatialFilter.searchLabel' | translate\n      }}</mat-label>\n      <mat-select\n        (selectionChange)=\"onSelectionChange()\"\n        [(value)]=\"selectedQueryType\"\n      >\n        <mat-option *ngFor=\"let queryType of queryType\" [value]=\"queryType\">\n          {{ 'igo.geo.terrapi.' + queryType | translate }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <igo-spatial-filter-list\n      [store]=\"store\"\n      [queryType]=\"selectedQueryType\"\n      [zone]=\"zone\"\n      [layers]=\"layers\"\n      (zoneChange)=\"zoneChange.emit($event)\"\n      (zoneWithBufferChange)=\"zoneWithBufferChange.emit($event)\"\n      (bufferChange)=\"bufferChange.emit($event)\"\n      (measureUnitChange)=\"measureUnitChange.emit($event)\"\n    >\n    </igo-spatial-filter-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.geo.spatialFilter.draw' | translate\">\n    <div class=\"spatial-type-toggle\">\n      <mat-button-toggle-group\n        [value]=\"activeDrawType\"\n        (change)=\"onDrawTypeChange($event.value)\"\n      >\n        <mat-button-toggle\n          [value]=\"spatialType.Polygon\"\n          [matTooltip]=\"'igo.geo.spatialFilter.drawPolygon' | translate\"\n        >\n          <mat-icon svgIcon=\"pentagon-outline\"></mat-icon>\n        </mat-button-toggle>\n        <mat-button-toggle\n          [value]=\"spatialType.Point\"\n          [matTooltip]=\"'igo.geo.spatialFilter.drawCircle' | translate\"\n        >\n          <mat-icon svgIcon=\"record-circle-outline\"></mat-icon>\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n  </mat-tab>\n</mat-tab-group>\n","import {\n  Component,\n  Input,\n  OnInit,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport {\n  SpatialFilterQueryType,\n  SpatialFilterType\n} from '../../shared/spatial-filter.enum';\nimport { UntypedFormControl } from '@angular/forms';\nimport { EntityStore } from '@igo2/common';\nimport { Feature } from '../../../feature';\nimport { MeasureLengthUnit } from '../../../measure';\nimport { Layer } from '../../../layer';\n\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'igo-spatial-filter-type',\n  templateUrl: './spatial-filter-type.component.html',\n  styleUrls: ['./spatial-filter-type.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterTypeComponent implements OnInit {\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  public queryType: string[] = [\n    'Arrond',\n    'CircFed',\n    'CircProv',\n    'DirReg',\n    'Mun',\n    'MRC',\n    'AdmRegion',\n    'RegTour'\n  ];\n  public selectedTypeIndex = new UntypedFormControl(0);\n\n  /**\n   * Reference to the SpatialFIlterType enum\n   * @internal\n   */\n  public spatialType = SpatialFilterType;\n\n  public activeDrawType: SpatialFilterType = this.spatialType.Polygon;\n\n  @Input() selectedQueryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() layers: Layer[] = [];\n\n  public type: SpatialFilterType;\n\n  @Output() eventType = new EventEmitter<SpatialFilterType>();\n\n  @Output() eventQueryType = new EventEmitter<SpatialFilterQueryType>();\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  constructor() {}\n\n  ngOnInit() {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = this.spatialType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onTypeChange(event) {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = SpatialFilterType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onDrawTypeChange(spatialType: SpatialFilterType) {\n    this.activeDrawType = spatialType;\n    this.eventType.emit(this.activeDrawType);\n  }\n\n  onSelectionChange() {\n    this.eventQueryType.emit(this.selectedQueryType);\n    this.zoneChange.emit(undefined);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { HttpClient } from '@angular/common/http';\nimport { ConfigService, LanguageService } from '@igo2/core';\nimport { map } from 'rxjs/operators';\nimport { Observable } from 'rxjs';\nimport { Feature } from '../../feature/shared';\nimport {\n  SpatialFilterQueryType,\n  SpatialFilterItemType,\n  SpatialFilterType\n} from './spatial-filter.enum';\nimport { SpatialFilterThematic } from './spatial-filter.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SpatialFilterService {\n  public baseUrl: string = 'https://geoegl.msp.gouv.qc.ca/apis/terrapi/';\n\n  /*\n   * Type association with URL\n   */\n  public urlFilterList = {\n    AdmRegion: 'regadmin',\n    Arrond: 'arrondissements',\n    CircFed: 'circ-fed',\n    CircProv: 'circ-prov',\n    DirReg: 'dir-reg',\n    MRC: 'mrc',\n    Mun: 'municipalites',\n    RegTour: 'tourisme',\n    bornes: 'bornes-sumi',\n    hydro: 'hydro',\n    routes: 'routes'\n  };\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    private configService: ConfigService\n  ) {\n    this.baseUrl =\n      this.configService.getConfig('spatialFilter.url') || this.baseUrl;\n  }\n\n  getKeyByValue(object, value) {\n    return Object.keys(object).find((key) => object[key] === value);\n  }\n\n  /*\n   * Loading data for spatial filter list component (NO GEOMETRY)\n   */\n  loadFilterList(type: SpatialFilterQueryType): Observable<Feature[]> {\n    const urlPath = type as string;\n    if (urlPath) {\n      return this.http\n        .get<{ features: Feature[] }>(\n          this.baseUrl + this.urlFilterList[urlPath]\n        )\n        .pipe(\n          map((featureCollection) =>\n            featureCollection.features.map((f) => {\n              f.meta = {\n                id: f.properties.code\n              };\n              return f;\n            })\n          )\n        );\n    }\n  }\n\n  /*\n   * Loading item list (STRING)\n   */\n  loadThematicsList() {\n    const url = 'types';\n    const items: SpatialFilterThematic[] = [];\n    return this.http.get(this.baseUrl + url).pipe(\n      map((types: string[]) => {\n        types.forEach((type) => {\n          if (type.startsWith('lieux')) {\n            const item: SpatialFilterThematic = {\n              name: undefined,\n              source: type\n            };\n            let substr = type.substring(6, type.length);\n            let name = substr;\n            if (substr.includes('.')) {\n              const index = substr.indexOf('.');\n              name = substr.substring(index + 1, substr.length);\n              substr = substr.substring(0, index);\n            }\n            try {\n              item.name = this.languageService.translate.instant(\n                'igo.geo.terrapi.' + name\n              );\n            } catch (e) {\n              item.name =\n                name.substring(0, 1).toUpperCase() +\n                name.substring(1, name.length - 1);\n            }\n\n            try {\n              item.group = this.languageService.translate.instant(\n                'igo.geo.spatialFilter.group.' + substr\n              );\n            } catch (e) {\n              item.group =\n                substr.substring(0, 1).toUpperCase() +\n                substr.substring(1, name.length - 1);\n            }\n\n            items.push(item);\n          } else {\n            if (this.getKeyByValue(this.urlFilterList, type)) {\n              const item: SpatialFilterThematic = {\n                name: undefined,\n                source: type\n              };\n              const name = this.getKeyByValue(this.urlFilterList, type);\n              try {\n                item.name = this.languageService.translate.instant(\n                  'igo.geo.terrapi.' + name\n                );\n              } catch (e) {\n                item.name =\n                  name.substring(0, 1).toUpperCase() +\n                  name.substring(1, name.length - 1);\n              }\n              item.source = type;\n\n              items.push(item);\n            }\n          }\n        });\n        return items;\n      })\n    );\n  }\n\n  /*\n   * Loading data for spatial filter item component (Address or Thematics) depends on predefined zone or draw zone (feature)\n   */\n  loadFilterItem(\n    feature,\n    itemType: SpatialFilterItemType,\n    type?: SpatialFilterQueryType,\n    thematic?: SpatialFilterThematic,\n    buffer?: number\n  ) {\n    if (type) {\n      // Predefined type\n      const urlType = type as string;\n      const url = this.baseUrl + this.urlFilterList[urlType];\n      let urlItem = '';\n      if (itemType === SpatialFilterItemType.Address) {\n        urlItem = 'adresses';\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map((featureCollection) =>\n              featureCollection.features.map((f) => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        urlItem = thematic.source;\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map((featureCollection) =>\n              featureCollection.features.map((f) => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    } else {\n      // Draw type\n      const url = this.baseUrl + 'locate';\n      if (itemType === SpatialFilterItemType.Address) {\n        const urlItem = '?type=adresses';\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map((featureCollection) =>\n              featureCollection.features.map((f) => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        const urlItem = '?type=' + thematic.source;\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map((featureCollection) =>\n              featureCollection.features.map((f) => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    }\n  }\n\n  /*\n   * Get one territory by id (WITH GEOMETRY)\n   */\n  loadItemById(\n    feature: Feature,\n    type: SpatialFilterQueryType\n  ): Observable<Feature> {\n    const featureType = this.urlFilterList[type];\n    const featureCode = '/' + feature.properties.code;\n    if (featureType && featureCode) {\n      return this.http\n        .get<Feature>(this.baseUrl + featureType + featureCode, {\n          params: {\n            geometry: 'true'\n          }\n        })\n        .pipe(\n          map((f) => {\n            f.meta = {\n              id: f.properties.code,\n              alias: f.properties.nom,\n              title: f.properties.nom\n            };\n            return f;\n          })\n        );\n    }\n  }\n\n  /*\n   * Get buffer geometry\n   */\n  loadBufferGeometry(\n    feature: Feature,\n    filterType: SpatialFilterType,\n    buffer?: number,\n    type?: SpatialFilterQueryType\n  ): Observable<Feature> {\n    if (filterType === SpatialFilterType.Predefined) {\n      const featureType = this.urlFilterList[type];\n      const featureCode = '/' + feature.properties.code;\n      if (featureType && featureCode) {\n        return this.http\n          .get<Feature>(this.baseUrl + featureType + featureCode, {\n            params: {\n              geometry: '100',\n              bufferOutput: buffer.toString()\n            }\n          })\n          .pipe(\n            map((f) => {\n              f.meta = {\n                id: f.properties.code,\n                alias: f.properties.nom,\n                title: f.properties.nom\n              };\n              return f;\n            })\n          );\n      }\n    } else {\n      return this.http\n        .post<Feature>(this.baseUrl + 'geospatial/buffer?', {\n          buffer,\n          loc: JSON.stringify(feature)\n        })\n        .pipe(\n          map((f) => {\n            return f;\n          })\n        );\n    }\n  }\n}\n","export const MEASURE_UNIT_AUTO = 'auto';\n\nexport enum MeasureType {\n  Length = 'length',\n  Area = 'area'\n}\n\nexport enum MeasureLengthUnit {\n  Meters = 'meters',\n  Kilometers = 'kilometers',\n  Miles = 'miles',\n  Feet = 'feet'\n}\n\nexport const MeasureLengthUnitAbbreviation = {\n  [MeasureLengthUnit.Meters]: 'm',\n  [MeasureLengthUnit.Kilometers]: 'km',\n  [MeasureLengthUnit.Miles]: 'mi',\n  [MeasureLengthUnit.Feet]: 'ft'\n};\n\nexport enum MeasureAreaUnit {\n  SquareMeters = 'squareMeters',\n  SquareKilometers = 'squareKilometers',\n  SquareMiles = 'squareMiles',\n  SquareFeet = 'squareFeet',\n  Hectares = 'hectares',\n  Acres = 'acres'\n}\n\nexport const MeasureAreaUnitAbbreviation = {\n  [MeasureAreaUnit.SquareMeters]: 'm²',\n  [MeasureAreaUnit.SquareKilometers]: 'km²',\n  [MeasureAreaUnit.SquareMiles]: 'mi²',\n  [MeasureAreaUnit.SquareFeet]: 'ft²',\n  [MeasureAreaUnit.Hectares]: 'ha',\n  [MeasureAreaUnit.Acres]: 'ac'\n};\n","import { LanguageService } from '@igo2/core';\nimport * as olstyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport OlOverlay from 'ol/Overlay';\nimport { getCenter as olGetCenter } from 'ol/extent';\nimport { getLength as olGetLength, getArea as olGetArea } from 'ol/sphere';\n\nimport { Measure } from './measure.interfaces';\nimport {\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation\n} from './measure.enum';\n\n/**\n * Convert value from meters to kilometers\n * @param value Value in meters\n * @returns Value in kilometers\n */\nexport function metersToKilometers(value: number): number {\n  return value * 0.001;\n}\n\n/**\n * Convert value from meters to feet\n * @param value Value in meters\n * @returns Value in feet\n */\nexport function metersToFeet(value: number): number {\n  return value * 3.2808;\n}\n\n/**\n * Convert value from meters to miles\n * @param value Value in meters\n * @returns Value in miles\n */\nexport function metersToMiles(value: number): number {\n  return value * 0.000621;\n}\n\n/**\n * Convert value from square meters to square kilometers\n * @param value Value in square meters\n * @returns Value in square kilometers\n */\nexport function squareMetersToSquareKilometers(value: number): number {\n  return value * 0.000001;\n}\n\n/**\n * Convert value from square meters to square miles\n * @param value Value in square meters\n * @returns Value in square miles\n */\nexport function squareMetersToSquareMiles(value: number): number {\n  return value * 0.0000003861;\n}\n\n/**\n * Convert value from square meters to square feet\n * @param value Value in square meters\n * @returns Value in square feet\n */\nexport function squareMetersToSquareFeet(value: number): number {\n  return value * 10.764;\n}\n\n/**\n * Convert value from square meters to hectares\n * @param value Value in square meters\n * @returns Value in hectares\n */\nexport function squareMetersToHectares(value: number): number {\n  return value * 0.0001;\n}\n\n/**\n * Convert value from square meters to acres\n * @param value Value in square meters\n * @returns Value in acres\n */\nexport function squareMetersToAcres(value: number): number {\n  return value * 0.00024711;\n}\n\n/**\n * Convert value from meters to the specified length unit\n * @param value Value in meters\n * @param unit Length unit\n * @returns Value in unit\n */\nexport function metersToUnit(\n  value: number,\n  unit: MeasureLengthUnit\n): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureLengthUnit.Meters, (val: number) => val],\n    [MeasureLengthUnit.Kilometers, metersToKilometers],\n    [MeasureLengthUnit.Miles, metersToMiles],\n    [MeasureLengthUnit.Feet, metersToFeet]\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * Convert value from square meters to the specified area unit\n * @param value Value in meters\n * @param unit Area unit\n * @returns Value in unit\n */\nexport function squareMetersToUnit(\n  value: number,\n  unit: MeasureAreaUnit\n): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureAreaUnit.SquareMeters, (val: number) => val],\n    [MeasureAreaUnit.SquareKilometers, squareMetersToSquareKilometers],\n    [MeasureAreaUnit.SquareMiles, squareMetersToSquareMiles],\n    [MeasureAreaUnit.SquareFeet, squareMetersToSquareFeet],\n    [MeasureAreaUnit.Hectares, squareMetersToHectares],\n    [MeasureAreaUnit.Acres, squareMetersToAcres]\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * This method format a measure to a readable format\n * @param measure Measure\n * @param options Formatting options\n * @returns Formatted measure\n */\nexport function formatMeasure(\n  measure: number,\n  options?: {\n    decimal?: number;\n    unit?: MeasureAreaUnit | MeasureLengthUnit;\n    unitAbbr?: boolean;\n    locale?: string;\n  },\n  languageService?: LanguageService\n) {\n  let decimal = options.decimal;\n  if (decimal === undefined || decimal < 0) {\n    decimal = 1;\n  }\n\n  const parts = [];\n  if (options.locale !== undefined) {\n    parts.push(\n      measure.toLocaleString(options.locale, {\n        minimumFractionDigits: decimal,\n        maximumFractionDigits: decimal\n      })\n    );\n  } else {\n    parts.push(measure.toFixed(decimal).toString());\n  }\n\n  if (options.unit !== undefined && options.unitAbbr === true) {\n    if (languageService) {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit]\n          ? languageService.translate.instant(\n              'igo.geo.measure.' + MeasureLengthUnitAbbreviation[options.unit]\n            )\n          : languageService.translate.instant(\n              'igo.geo.measure.' + MeasureAreaUnitAbbreviation[options.unit]\n            )\n      );\n    } else {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit] ||\n          MeasureAreaUnitAbbreviation[options.unit]\n      );\n    }\n  }\n\n  return parts.filter((p) => p !== undefined).join(' ');\n}\n\n/**\n * Compute best length measure unit for a given measure in meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestLengthUnit(value: number): MeasureLengthUnit {\n  let unit = MeasureLengthUnit.Meters;\n  let converted = value;\n  const possibleUnits = [MeasureLengthUnit.Kilometers];\n  while (converted > 1000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = metersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Compute best length measure unit for a given measure in square meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestAreaUnit(value: number): MeasureAreaUnit {\n  let unit = MeasureAreaUnit.SquareMeters;\n  let converted = value;\n  const possibleUnits = [MeasureAreaUnit.SquareKilometers];\n  while (converted > 1000000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = squareMetersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Create a default style for a measure interaction\n * @returns OL style\n */\nexport function createMeasureInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      lineDash: [10, 10],\n      width: 2\n    }),\n    fill: new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    }),\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke: new olstyle.Stroke({\n        color: '#ffcc33'\n      }),\n      fill: new olstyle.Fill({\n        color: 'rgba(255, 255, 255, 0.2)'\n      })\n    })\n  });\n}\n\n/**\n * Create a default style for a measure layer\n * @returns OL style\n */\nexport function createMeasureLayerStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      width: 2\n    }),\n    fill: new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    })\n  });\n}\n\n/**\n * Compute the length in meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Length in meters\n */\nexport function measureOlGeometryLength(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle,\n  projection: string\n): number | undefined {\n  if (olGeometry instanceof OlPoint) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetLength(olGeometry, { projection });\n}\n\n/**\n * Compute the area in square meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Area in square meters\n */\nexport function measureOlGeometryArea(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle,\n  projection: string\n): number | undefined {\n  if (olGeometry instanceof OlPoint || olGeometry instanceof OlLineString) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetArea(olGeometry, { projection });\n}\n\n/**\n * Compute the area (square meters), length (meters) and last length (meters)\n * of an OL geometry with a given projection.\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Computed measure\n */\nexport function measureOlGeometry(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle,\n  projection: string\n): Measure {\n  const length = measureOlGeometryLength(olGeometry, projection);\n  const area = measureOlGeometryArea(olGeometry, projection);\n\n  const lengths = [];\n  const coordinates = olGeometry.getFlatCoordinates();\n  const coordinatesLength = coordinates.length;\n  for (let i = 0; i <= coordinatesLength - 4; i += 2) {\n    const olSegment = new OlLineString([\n      [coordinates[i], coordinates[i + 1]],\n      [coordinates[i + 2], coordinates[i + 3]]\n    ]);\n\n    lengths.push(measureOlGeometryLength(olSegment, projection));\n  }\n\n  return {\n    area,\n    length,\n    lengths\n  };\n}\n\n/**\n * Update an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nexport function updateOlGeometryMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlPoint[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n  } else {\n    olMidpoints = getOlGeometryMidpoints(olGeometry);\n    // TODO: handle multi geometries\n    const coordinates = olGeometry.getFlatCoordinates();\n    const midpointsLength = olMidpoints.length;\n    for (let i = 0; i < midpointsLength; i++) {\n      const j = i * 2;\n      const olSegment = new OlLineString([\n        [coordinates[j], coordinates[j + 1]],\n        [coordinates[j + 2], coordinates[j + 3]]\n      ]);\n\n      const midpointCoordinate = olSegment.getCoordinateAt(0.5);\n      const olMidpoint = olMidpoints[i];\n      if (olMidpoint !== undefined) {\n        olMidpoint.setCoordinates(midpointCoordinate);\n      } else {\n        olMidpoints[i] = new OlPoint(midpointCoordinate);\n      }\n    }\n  }\n  return olMidpoints;\n}\n\n/**\n * Clear an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n */\nexport function clearOlGeometryMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n) {\n  const olMidpoints = olGeometry.get('_midpoints') || [];\n  const midpointsLength = olMidpoints.length;\n  for (let i = 0; i < midpointsLength; i++) {\n    const olMidpoint = olMidpoints[i];\n    if (olMidpoint !== undefined) {\n      if (olMidpoint !== undefined) {\n        clearOlMidpointTooltip(olMidpoint);\n      }\n    }\n  }\n\n  olGeometry.set('_midpoints', undefined, true);\n\n  return olMidpoints;\n}\n\n/**\n * Return an array of  OL geometry midpoints, if any\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nfunction getOlGeometryMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlPoint[] {\n  let expectedNumber;\n  if (olGeometry instanceof OlCircle) {\n    expectedNumber = 0;\n  } else {\n    expectedNumber = Math.max(\n      olGeometry.getFlatCoordinates().length / 2 - 1,\n      0\n    );\n  }\n  // TODO: This works but it's quite messy. If time permits,\n  // clean this. Maybe a Tooltip class could handle that\n  let olMidpoints = olGeometry.get('_midpoints');\n\n  if (olMidpoints === undefined) {\n    if (olGeometry instanceof OlPoint) {\n      olMidpoints = new Array(1);\n    } else {\n      olMidpoints = new Array(expectedNumber);\n    }\n    olGeometry.set('_midpoints', olMidpoints, true);\n    return olMidpoints;\n  }\n\n  if (expectedNumber === 0) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber === olMidpoints.length) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber > olMidpoints.length) {\n    olMidpoints.push(...new Array(expectedNumber - olMidpoints.length));\n    return olMidpoints;\n  }\n\n  for (let i = expectedNumber; i < olMidpoints.length; i++) {\n    const olMidpoint = olMidpoints[expectedNumber];\n    if (olMidpoint !== undefined) {\n      clearOlMidpointTooltip(olMidpoint);\n    }\n  }\n  olMidpoints.splice(expectedNumber);\n\n  return olMidpoints;\n}\n\n/**\n * Remove an OL midpoint's tooltip from the map\n * @param olMidpoint OL Point\n */\nfunction clearOlMidpointTooltip(olMidpoint: OlPoint) {\n  const olTooltip = olMidpoint.get('_tooltip');\n  if (olTooltip !== undefined) {\n    const olMap = olTooltip.getMap();\n    if (olMap !== undefined) {\n      olMap.removeOverlay(olTooltip);\n    }\n  }\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsAtMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay[] {\n  const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  let typeGeom = '';\n  if (olGeometry instanceof OlLineString) {\n    typeGeom = 'line-';\n  } else if (olGeometry instanceof OlPolygon) {\n    typeGeom = 'polygone-';\n  }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipAtPoint(olMidpoint, false, typeGeom);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipsAtMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay[] {\n  const olMidpoints = getOlGeometryMidpoints(olGeometry);\n  return olMidpoints.map((olMidpoint: OlPoint) => {\n    return olMidpoint ? olMidpoint.get('_tooltip') : undefined;\n  });\n}\n\n/**\n * Update an OL geometry center and return it\n * @param olGeometry OL Geometry\n * @returns OL point\n */\nexport function updateOlGeometryCenter(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlPoint {\n  let olCenter = olGeometry.get('_center');\n  const centerCoordinate = olGetCenter(olGeometry.getExtent());\n  if (olCenter !== undefined) {\n    olCenter.setCoordinates(centerCoordinate);\n  } else {\n    olCenter = new OlPoint(centerCoordinate);\n    olGeometry.set('_center', olCenter);\n  }\n\n  return olCenter;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipAtCenter(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipAtPoint(olCenter, true);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipAtCenter(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay {\n  const olCenter = olGeometry.get('_center');\n  return olCenter ? olCenter.get('_tooltip') : undefined;\n}\n\n/**\n * Get all the tooltips of an OL geometry\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getTooltipsOfOlGeometry(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay[] {\n  const olTooltips = [].concat(getOlTooltipsAtMidpoints(olGeometry) || []);\n  const olCenterTooltip = getOlTooltipAtCenter(olGeometry);\n  if (olCenterTooltip !== undefined) {\n    olTooltips.push(olCenterTooltip);\n  }\n  return olTooltips;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipAtPoint(\n  olPoint: OlPoint,\n  center: boolean = false,\n  srcGeomType: string = ''\n): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: (center\n      ? [\n          'igo-map-tooltip',\n          'igo-map-tooltip-measure',\n          'igo-map-tooltip-measure-area'\n        ]\n      : [\n          'igo-map-tooltip',\n          'igo-map-tooltip-measure',\n          `igo-map-tooltip-measure-${srcGeomType}segments`\n        ]\n    ).join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n","<div class=\"form-list\">\n  <mat-form-field class=\"zone-list\">\n    <mat-label>{{ 'igo.geo.spatialFilter.listLabel' | translate }}</mat-label>\n    <input\n      #input\n      type=\"text\"\n      placeholder=\"{{ 'igo.geo.spatialFilter.listLabel' | translate }}\"\n      matInput\n      [formControl]=\"formControl\"\n      [matAutocomplete]=\"auto\"\n    />\n    <mat-autocomplete\n      #auto=\"matAutocomplete\"\n      (optionSelected)=\"onZoneChange($event.option.value)\"\n      [displayWith]=\"displayFn\"\n    >\n      <mat-option\n        *ngFor=\"let entities of this.store.view.all$() | async\"\n        [value]=\"entities\"\n      >\n        {{ entities.properties.nom }}\n      </mat-option>\n    </mat-autocomplete>\n  </mat-form-field>\n  <div>\n    <div class=\"buffer-div\">\n      <mat-form-field class=\"buffer\">\n        <mat-label>{{ 'igo.geo.spatialFilter.buffer' | translate }}</mat-label>\n        <input\n          type=\"number\"\n          matInput\n          placeholder=\"{{ 'igo.geo.spatialFilter.buffer' | translate }}\"\n          [formControl]=\"bufferFormControl\"\n          [value]=\"0\"\n          [readonly]=\"!zone\"\n        />\n      </mat-form-field>\n\n      <mat-form-field class=\"unit-field\">\n        <mat-select\n          [value]=\"measureUnit\"\n          (selectionChange)=\"onMeasureUnitChange($event.value)\"\n        >\n          <mat-option\n            *ngFor=\"let measureUnit of measureUnits\"\n            [value]=\"measureUnit\"\n          >\n            {{ 'igo.geo.measure.' + measureUnit | translate }}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n","import { debounceTime, distinctUntilChanged } from 'rxjs/operators';\nimport { EntityStore } from '@igo2/common';\nimport { SpatialFilterService } from './../../shared/spatial-filter.service';\nimport {\n  SpatialFilterQueryType,\n  SpatialFilterType\n} from './../../shared/spatial-filter.enum';\nimport {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { UntypedFormControl } from '@angular/forms';\nimport { Feature } from '../../../feature';\nimport { MeasureLengthUnit } from '../../../measure/shared';\nimport { MessageService } from '@igo2/core';\nimport { Layer } from '../../../layer';\n\n@Component({\n  selector: 'igo-spatial-filter-list',\n  templateUrl: './spatial-filter-list.component.html',\n  styleUrls: ['./spatial-filter-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterListComponent implements OnInit, OnDestroy {\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  @Input()\n  get queryType(): SpatialFilterQueryType {\n    return this._queryType;\n  }\n  set queryType(queryType: SpatialFilterQueryType) {\n    this.formControl.setValue('');\n    this._queryType = queryType;\n  }\n  private _queryType: SpatialFilterQueryType;\n\n  @Input()\n  get zone() {\n    return this._zone;\n  }\n  set zone(value) {\n    this._zone = value;\n    if (!value) {\n      this.zoneWithBuffer = undefined;\n      this.bufferFormControl.setValue(0);\n    }\n  }\n  private _zone;\n\n  @Input() layers: Layer[] = [];\n\n  public zoneWithBuffer;\n  public selectedZone: any;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  public formControl = new UntypedFormControl();\n\n  public bufferFormControl = new UntypedFormControl();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  formValueChanges$$: Subscription;\n  bufferValueChanges$$: Subscription;\n\n  constructor(\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService\n  ) {}\n\n  ngOnInit() {\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe(\n      (value) => {\n        if (value.length) {\n          this.store.view.filter((feature) => {\n            const filterNormalized = value\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n            const featureNameNormalized = feature.properties.nom\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n            return featureNameNormalized.includes(filterNormalized);\n          });\n        }\n      }\n    );\n\n    this.bufferValueChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(debounceTime(500), distinctUntilChanged())\n      .subscribe((value) => {\n        if (\n          this.measureUnit === MeasureLengthUnit.Meters &&\n          value > 0 &&\n          value <= 100000\n        ) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService\n            .loadBufferGeometry(\n              this.selectedZone,\n              SpatialFilterType.Predefined,\n              value,\n              this.queryType\n            )\n            .subscribe((featureGeom: Feature) => {\n              this.zoneWithBuffer = featureGeom;\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n            });\n        } else if (\n          this.measureUnit === MeasureLengthUnit.Kilometers &&\n          value > 0 &&\n          value <= 100\n        ) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService\n            .loadBufferGeometry(\n              this.selectedZone,\n              SpatialFilterType.Predefined,\n              value * 1000,\n              this.queryType\n            )\n            .subscribe((featureGeom: Feature) => {\n              this.zoneWithBuffer = featureGeom;\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n            });\n        } else if (value === 0 && this.layers.length > 0) {\n          this.bufferChange.emit(value);\n          this.zoneWithBufferChange.emit(this.selectedZone);\n        } else if (\n          value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)\n        ) {\n          this.bufferFormControl.setValue(0);\n          this.messageService.alert(\n            'igo.geo.spatialFilter.bufferAlert',\n            'igo.geo.spatialFilter.warning'\n          );\n        }\n      });\n  }\n\n  ngOnDestroy() {\n    this.formValueChanges$$.unsubscribe();\n  }\n\n  displayFn(feature?: Feature): string | undefined {\n    return feature ? feature.properties.nom : undefined;\n  }\n\n  onZoneChange(feature) {\n    if (feature && this.queryType) {\n      this.spatialFilterService\n        .loadItemById(feature, this.queryType)\n        .subscribe((featureGeom: Feature) => {\n          this.selectedZone = featureGeom;\n          this.zoneChange.emit(featureGeom);\n        });\n    }\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      this.measureUnit === MeasureLengthUnit.Meters\n        ? this.bufferFormControl.setValue(this.bufferFormControl.value * 1000)\n        : this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\n    }\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\n@Pipe({\n  name: 'keyvalue'\n})\nexport class KeyValuePipe implements PipeTransform {\n  transform(value: any, args?: any): any {\n    const keyValues = [];\n    Object.getOwnPropertyNames(value).forEach((key: string) =>\n      keyValues.push({ key, value: value[key] })\n    );\n\n    return keyValues;\n  }\n}\n","<table\n  class=\"igo-striped mat-typography\"\n  *ngIf=\"\n    ready &&\n    feature &&\n    isObject(feature.properties) &&\n    feature.properties.target !== 'iframe'\n  \"\n>\n  <tbody>\n    <tr *ngFor=\"let property of filterFeatureProperties(feature) | keyvalue\">\n      <td\n        *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\"\n      >\n        <mat-icon matListItemIcon svgIcon=\"{{ icon }}\"></mat-icon>\n      </td>\n\n      <td\n        *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\"\n      >\n        <a\n          href=\"{{ property.value }}\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          {{ 'igo.geo.targetHtmlUrl' | translate }} {{ title }}</a\n        >\n        <button\n          class=\"copyClipboard\"\n          mat-icon-button\n          (click)=\"copyTextToClipboard(property.value)\"\n        >\n          <mat-icon svgIcon=\"content-copy\"></mat-icon>\n        </button>\n      </td>\n\n      <td id=\"keyValue\" *ngIf=\"feature.properties.target === undefined\">\n        {{ property.key }}\n      </td>\n\n      <td\n        *ngIf=\"\n          feature.properties.target === undefined &&\n          !isObject(property.value) &&\n          !isUrl(property.value) &&\n          !isEmbeddedLink(property.value)\n        \"\n        [innerHTML]=\"property.value\"\n      ></td>\n\n      <td\n        *ngIf=\"\n          feature.properties.target === undefined &&\n          isEmbeddedLink(property.value)\n        \"\n      >\n        <u\n          [ngStyle]=\"{ cursor: 'pointer', color: 'blue' }\"\n          (click)=\"openSecureUrl(property.value)\"\n          >{{ getEmbeddedLinkText(property.value) }}</u\n        >\n      </td>\n\n      <td\n        *ngIf=\"\n          feature.properties.target === undefined &&\n          !isObject(property.value) &&\n          (isDoc(property.value) || isUrl(property.value)) &&\n          !isImg(property.value)\n        \"\n      >\n        <u\n          [ngStyle]=\"{ cursor: 'pointer', color: 'blue' }\"\n          (click)=\"openSecureUrl(property.value)\"\n          >{{ 'igo.geo.targetHtmlUrl' | translate }}</u\n        >\n        <button\n          class=\"copyClipboard\"\n          mat-icon-button\n          (click)=\"copyTextToClipboard(property.value)\"\n        >\n          <mat-icon svgIcon=\"content-copy\"></mat-icon>\n        </button>\n      </td>\n\n      <td\n        *ngIf=\"\n          feature.properties.target === undefined &&\n          !isObject(property.value) &&\n          isUrl(property.value) &&\n          isImg(property.value)\n        \"\n      >\n        <a\n          href=\"{{ property.value }}\"\n          target=\"_blank\"\n          (click)=\"openSecureUrl(property.value)\"\n          rel=\"noopener noreferrer\"\n        >\n          <img\n            igoImageError\n            src=\"{{ property.value | secureImage | async }}\"\n            width=\"225\"\n            height=\"auto\"\n          />\n        </a>\n      </td>\n\n      <td\n        *ngIf=\"\n          feature.properties.target === undefined && isObject(property.value)\n        \"\n        [innerHTML]=\"property.value | json\"\n      ></td>\n    </tr>\n  </tbody>\n</table>\n\n<iframe\n  *ngIf=\"isHtmlDisplay()\"\n  [srcdoc]=\"htmlSanitizer(feature.properties)\"\n  [src]=\"urlSanitizer(feature.properties.url)\"\n></iframe>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Output,\n  EventEmitter,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\n\nimport { NetworkService, ConnectionState, MessageService } from '@igo2/core';\nimport { ConfigService } from '@igo2/core';\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\nimport type { Toolbox } from '@igo2/common';\n\nimport { Feature } from '../shared';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { IgoMap } from '../../map/shared/map';\nimport { HttpClient } from '@angular/common/http';\nimport { Clipboard } from '@igo2/utils';\n@Component({\n  selector: 'igo-feature-details',\n  templateUrl: './feature-details.component.html',\n  styleUrls: ['./feature-details.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FeatureDetailsComponent implements OnInit, OnDestroy {\n  private state: ConnectionState;\n  private unsubscribe$ = new Subject<void>();\n  ready = false;\n\n  @Input()\n  get source(): SearchSource {\n    return this._source;\n  }\n  set source(value: SearchSource) {\n    this._source = value;\n    this.cdRef.detectChanges();\n  }\n\n  @Input() map: IgoMap;\n\n  @Input() toolbox: Toolbox;\n\n  @Input()\n  get feature(): Feature {\n    return this._feature;\n  }\n  set feature(value: Feature) {\n    this._feature = value;\n    this.cdRef.detectChanges();\n    this.selectFeature.emit();\n  }\n\n  private _feature: Feature;\n  private _source: SearchSource;\n\n  @Output() routeEvent = new EventEmitter<boolean>();\n  @Output() selectFeature = new EventEmitter<boolean>();\n  @Output() htmlDisplayEvent = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.feature);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.feature) || 'link';\n  }\n\n  constructor(\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef,\n    private sanitizer: DomSanitizer,\n    private networkService: NetworkService,\n    private messageService: MessageService,\n    private configService: ConfigService\n  ) {\n    this.networkService\n      .currentState()\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((state: ConnectionState) => {\n        this.state = state;\n      });\n  }\n\n  ngOnInit() {\n    this.ready = true;\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  urlSanitizer(value): SafeResourceUrl {\n    return this.sanitizer.bypassSecurityTrustResourceUrl(value);\n  }\n\n  isHtmlDisplay(): boolean {\n    if (\n      this.feature &&\n      this.isObject(this.feature.properties) &&\n      this.feature.properties.target === 'iframe'\n    ) {\n      this.htmlDisplayEvent.emit(true);\n      return true;\n    } else {\n      this.htmlDisplayEvent.emit(false);\n      return false;\n    }\n  }\n\n  htmlSanitizer(value): SafeResourceUrl {\n    if (!value.body) {\n      return;\n    }\n    const regexBase = /<base href=\"[\\w:\\/\\.]+\">/;\n    if (!regexBase.test(value.body)) {\n      const url = new URL(value.url, window.location.origin);\n      value.body = value.body.replace(\n        '<head>',\n        `<head><base href=\"${url.origin}\">`\n      );\n    }\n\n    return this.sanitizer.bypassSecurityTrustHtml(value.body);\n  }\n\n  isObject(value) {\n    return typeof value === 'object';\n  }\n\n  openSecureUrl(value) {\n    let url: string;\n    const regexDepot = new RegExp(\n      this.configService?.getConfig('depot.url') + '.*?(?=\"|$)'\n    );\n\n    if (regexDepot.test(value)) {\n      url = value.match(regexDepot)[0];\n\n      this.http\n        .get(url, {\n          responseType: 'blob'\n        })\n        .subscribe(\n          (docOrImage) => {\n            const fileUrl = URL.createObjectURL(docOrImage);\n            window.open(fileUrl, '_blank');\n            this.cdRef.detectChanges();\n          },\n          (error: Error) => {\n            this.messageService.error(\n              'igo.geo.targetHtmlUrlUnauthorized',\n              'igo.geo.targetHtmlUrlUnauthorizedTitle'\n            );\n          }\n        );\n    } else {\n      let url = value;\n      if (this.isEmbeddedLink(value)) {\n        var div = document.createElement('div');\n        div.innerHTML = value;\n        url = div.children[0].getAttribute('href');\n      }\n      window.open(url, '_blank');\n    }\n  }\n\n  isUrl(value) {\n    if (typeof value === 'string') {\n      const regex = /^https?:\\/\\//;\n      return regex.test(value);\n    }\n  }\n\n  isDoc(value) {\n    if (typeof value === 'string') {\n      if (this.isUrl(value)) {\n        const regex = /(pdf|docx?|xlsx?)$/;\n        return regex.test(value.toLowerCase());\n      } else {\n        return false;\n      }\n    }\n  }\n\n  isImg(value) {\n    if (typeof value === 'string') {\n      if (this.isUrl(value)) {\n        const regex = /(jpe?g|png|gif)$/;\n        return regex.test(value.toLowerCase());\n      } else {\n        return false;\n      }\n    }\n  }\n\n  isEmbeddedLink(value) {\n    if (typeof value === 'string') {\n      const matchRegex = /<a/g;\n      const match = value.match(matchRegex) || [];\n      const count = match.length;\n      if (count === 1) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n    return false;\n  }\n\n  getEmbeddedLinkText(value) {\n    const regex = /(?:>).*?(?=<|$)/;\n    let text = value.match(regex)[0] as string;\n    text = text.replace(/>/g, '');\n    return text;\n  }\n\n  filterFeatureProperties(feature) {\n    const allowedFieldsAndAlias = feature.meta ? feature.meta.alias : undefined;\n    const properties = {};\n    let offlineButtonState;\n\n    if (this.map) {\n      this.map.forcedOffline$\n        .pipe(takeUntil(this.unsubscribe$))\n        .subscribe((state) => {\n          offlineButtonState = state;\n        });\n    }\n\n    if (\n      feature.properties &&\n      feature.properties.Route &&\n      this.toolbox &&\n      !this.toolbox.getTool('directions')\n    ) {\n      delete feature.properties.Route;\n    }\n\n    if (allowedFieldsAndAlias) {\n      Object.keys(allowedFieldsAndAlias).forEach((field) => {\n        properties[allowedFieldsAndAlias[field]] = feature.properties[field];\n      });\n      return properties;\n    } else if (offlineButtonState !== undefined) {\n      if (!offlineButtonState) {\n        if (\n          this.state.connection &&\n          feature.meta &&\n          feature.meta.excludeAttribute\n        ) {\n          const excludeAttribute = feature.meta.excludeAttribute;\n          excludeAttribute.forEach((attribute) => {\n            delete feature.properties[attribute];\n          });\n        } else if (\n          !this.state.connection &&\n          feature.meta &&\n          feature.meta.excludeAttributeOffline\n        ) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach((attribute) => {\n            delete feature.properties[attribute];\n          });\n        }\n      } else {\n        if (feature.meta && feature.meta.excludeAttributeOffline) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach((attribute) => {\n            delete feature.properties[attribute];\n          });\n        }\n      }\n    } else {\n      if (\n        this.state.connection &&\n        feature.meta &&\n        feature.meta.excludeAttribute\n      ) {\n        const excludeAttribute = feature.meta.excludeAttribute;\n        excludeAttribute.forEach((attribute) => {\n          delete feature.properties[attribute];\n        });\n      } else if (\n        !this.state.connection &&\n        feature.meta &&\n        feature.meta.excludeAttributeOffline\n      ) {\n        const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n        excludeAttributeOffline.forEach((attribute) => {\n          delete feature.properties[attribute];\n        });\n      }\n    }\n    return feature.properties;\n  }\n\n  /**\n   * Copy the url to a clipboard\n   */\n  copyTextToClipboard(value: string): void {\n    const successful = Clipboard.copy(value);\n    if (successful) {\n      this.messageService.success('igo.geo.query.link.message');\n    }\n  }\n}\n","import OlCircle from 'ol/geom/Circle';\nimport OlPoint from 'ol/geom/Point';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\nimport OlLineString from 'ol/geom/LineString';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlPolygon from 'ol/geom/Polygon';\nimport BasicEvent from 'ol/events/Event';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport lineIntersect from '@turf/line-intersect';\nimport { lineString } from '@turf/helpers';\n\nimport {\n  GeometrySliceMultiPolygonError,\n  GeometrySliceLineStringError,\n  GeometrySliceTooManyIntersectionError\n} from './geometry.errors';\n\n/**\n * Create a default style for draw and modify interactions\n * @param color Style color (R, G, B)\n * @returns OL style\n */\nexport function createDrawInteractionStyle(\n  color?: [number, number, number]\n): olstyle.Circle {\n  color = color || [0, 153, 255];\n  return new olstyle.Circle({\n    stroke: new olstyle.Stroke({\n      color: color.concat([1]),\n      width: 2\n    }),\n    fill: new olstyle.Fill({\n      color: color.concat([0.2])\n    }),\n    radius: 8\n  });\n}\n\n/**\n * Create a default style for drawing a hole\n * @returns OL style\n */\nexport function createDrawHoleInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: [0, 153, 255, 1],\n      width: 2\n    })\n  });\n}\n\n/**\n * Slice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function sliceOlGeometry(\n  olGeometry: OlLineString | OlPolygon,\n  olSlicer: OlLineString\n): Array<OlLineString | OlPolygon> {\n  if (olGeometry instanceof OlPolygon) {\n    return sliceOlPolygon(olGeometry, olSlicer);\n  } else if (olGeometry instanceof OlLineString) {\n    return sliceOlLineString(olGeometry, olSlicer);\n  }\n  return [];\n}\n\n/**\n * Slice OL LineString into one or more lines\n * @param olLineString OL line string\n * @param olSlicer Slicing line\n * @returns New OL line strings\n */\nexport function sliceOlLineString(\n  olLineString: OlLineString,\n  olSlicer: OlLineString\n): OlLineString[] {\n  return [];\n}\n\n/**\n * Slice OL Polygon into one or more polygons\n * @param olPolygon OL polygon\n * @param olSlicer Slicing line\n * @returns New OL polygons\n */\nexport function sliceOlPolygon(\n  olPolygon: OlPolygon,\n  olSlicer: OlLineString\n): OlPolygon[] {\n  if (olPolygon.getLinearRingCount() > 1) {\n    throw new GeometrySliceMultiPolygonError();\n  }\n\n  if (olSlicer.getCoordinates().length > 2) {\n    throw new GeometrySliceLineStringError();\n  }\n\n  const olGeoJSON = new OlGeoJSON();\n  const slicer = olGeoJSON.writeGeometryObject(olSlicer) as any;\n  const outerCoordinates = olPolygon.getLinearRing(0).getCoordinates();\n\n  const parts = [[], []];\n  let totalIntersectionCount = 0;\n  for (let i = 0, ii = outerCoordinates.length - 1; i < ii; i++) {\n    const segmentCoordinates = [outerCoordinates[i], outerCoordinates[i + 1]];\n    const segment = lineString(segmentCoordinates);\n    const intersections = lineIntersect(segment, slicer).features;\n\n    const intersectionCount = intersections.length;\n    totalIntersectionCount += intersectionCount;\n    if (intersectionCount > 1 || totalIntersectionCount > 2) {\n      throw new GeometrySliceTooManyIntersectionError();\n    }\n\n    parts[0].push(segmentCoordinates[0]);\n    if (intersectionCount === 1) {\n      const intersection = intersections[0].geometry.coordinates;\n      parts[0].push(intersection);\n      parts[1].push(intersection);\n      parts.reverse();\n    }\n  }\n\n  if (totalIntersectionCount <= 1) {\n    return [];\n  }\n\n  parts[0].push(parts[0][0]);\n  parts[1].push(parts[1][0]);\n\n  return [new OlPolygon([parts[0]]), new OlPolygon([parts[1]])];\n}\n\n/**\n * Splice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function addLinearRingToOlPolygon(\n  olPolygon: OlPolygon,\n  olLinearRing: OlLinearRing\n) {\n  // TODO: make some validation and support updating an existing linear ring\n  olPolygon.appendLinearRing(olLinearRing);\n}\n\nexport function getMousePositionFromOlGeometryEvent(olEvent: BasicEvent) {\n  const olGeometry = olEvent.target as OlGeometry;\n  if (olGeometry instanceof OlPolygon) {\n    return olGeometry.getFlatCoordinates().slice(-4, -2) as [number, number];\n  }\n  const olGeometryCast = olGeometry as OlPoint | OlLineString | OlCircle;\n  return olGeometryCast.getFlatCoordinates().slice(-2) as [number, number];\n}\n","import { EventsKey } from 'ol/events';\nimport OlMap from 'ol/Map';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport type { Type } from 'ol/geom/Geometry';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlDraw from 'ol/interaction/Draw';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlModify from 'ol/interaction/Modify';\nimport OlSelect from 'ol/interaction/Select';\nimport BasicEvent from 'ol/events/Event';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport { SelectEvent as OlSelectEvent } from 'ol/interaction/Select';\nimport { unByKey } from 'ol/Observable';\nimport { doubleClick } from 'ol/events/condition';\n\nimport { Subject, Subscription, fromEvent, BehaviorSubject } from 'rxjs';\n\nimport { getMousePositionFromOlGeometryEvent } from '../geometry.utils';\n\nexport interface DrawControlOptions {\n  geometryType: Type | string;\n  drawingLayerSource?: OlVectorSource<OlGeometry>;\n  drawingLayer?: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  drawingLayerStyle?: OlStyleLike;\n  interactionStyle?: OlStyleLike;\n  maxPoints?: number;\n}\n\n/**\n * Control to draw entities\n */\nexport class DrawControl {\n  /**\n   * Draw start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw changes observable (while drawing)\n   */\n  public changes$: Subject<any> = new Subject();\n\n  /**\n   * Draw modify observable (modify drawn features)\n   */\n  public modify$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw select observable (modify drawn features)\n   */\n  public select$: Subject<any> = new Subject();\n\n  /**\n   * Draw abort observable (abort drawn features)\n   */\n  public abort$: Subject<any> = new Subject();\n\n  /**\n   * Freehand mode observable (defaults to false)\n   */\n  freehand$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Observables from predefined radius (defaults to false and undefined)\n   */\n  ispredefinedRadius$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  predefinedRadius$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n  radiusDrawEnd$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n\n  private keyDown$$: Subscription;\n\n  private olGeometryType: typeof OlGeometry | undefined | string;\n  private olInteractionStyle: OlStyleLike;\n  private olMap: OlMap;\n  private olDrawingLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  private olDrawInteraction: OlDraw;\n  private olSelectInteraction: OlSelect;\n  private olModifyInteraction: OlModify;\n  private onDrawStartKey: EventsKey;\n  private onDrawEndKey: EventsKey;\n  private onDrawAbortKey: EventsKey;\n  private onDrawKey: EventsKey;\n  public radius: number;\n\n  private mousePosition: [number, number];\n\n  /**\n   * take the value of radius\n   */\n  get radiusVal(): number {\n    return this.predefinedRadius$.getValue();\n  }\n  set radiusValData(radiusCercle: number) {\n    this.predefinedRadius$.next(radiusCercle);\n  }\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olDrawingLayerSource(): OlVectorSource<OlGeometry> {\n    return this.olDrawingLayer.getSource();\n  }\n\n  constructor(private options: DrawControlOptions) {\n    this.olDrawingLayer = options.drawingLayer\n      ? options.drawingLayer\n      : this.createOlInnerOverlayLayer();\n    this.olGeometryType = this.options.geometryType;\n    this.olInteractionStyle = this.options.interactionStyle;\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined, activateModifyAndSelect?: boolean) {\n    if (!olMap) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlInteractions();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n    this.addOlInteractions(activateModifyAndSelect);\n  }\n\n  /**\n   * Return the drawing layer source\n   */\n  getSource(): OlVectorSource<OlGeometry> {\n    return this.olDrawingLayerSource;\n  }\n\n  setOlInteractionStyle(style) {\n    this.olInteractionStyle = style;\n  }\n\n  /**\n   * Set the current geometry type\n   * @param geometryType the geometry type\n   */\n  setGeometryType(geometryType: Type) {\n    this.olGeometryType = geometryType;\n  }\n\n  /**\n   * Get the current geometry type\n   */\n  getGeometryType() {\n    return this.olGeometryType;\n  }\n\n  /**\n   * Create a drawing source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<\n    OlVectorSource<OlGeometry>\n  > {\n    return new OlVectorLayer({\n      source: this.options.drawingLayerSource\n        ? this.options.drawingLayerSource\n        : new OlVectorSource(),\n      style: this.options.drawingLayerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Clear the drawing layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer && this.olMap) {\n      this.olMap.removeLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Add the drawing layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer) {\n      this.olMap.addLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Clear the drawing layer source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (!this.options.drawingLayer && !this.options.drawingLayerSource) {\n      this.olDrawingLayerSource.clear(true);\n    }\n  }\n\n  /**\n   * Add interactions to the map an set up some listeners\n   */\n  addOlInteractions(activateModifyAndSelect?: boolean) {\n    // Create Draw interaction\n    let olDrawInteraction;\n    if (!this.freehand$.getValue()) {\n      if (!this.ispredefinedRadius$.getValue()) {\n        olDrawInteraction = new OlDraw({\n          type: this.olGeometryType as Type,\n          source: this.getSource(),\n          stopClick: true,\n          style: this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: false,\n          freehandCondition: () => false\n        });\n      } else {\n        olDrawInteraction = new OlDraw({\n          type: 'Point',\n          source: this.getSource(),\n          stopClick: true,\n          style: this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: false,\n          freehandCondition: () => false\n        });\n      }\n    } else {\n      if (this.olGeometryType === 'Point') {\n        olDrawInteraction = new OlDraw({\n          type: 'Circle',\n          source: this.getSource(),\n          style:\n            typeof this.olInteractionStyle === 'function'\n              ? undefined\n              : this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n      } else {\n        olDrawInteraction = new OlDraw({\n          type: this.olGeometryType as Type,\n          source: this.getSource(),\n          style: this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n      }\n    }\n\n    // Add Draw interaction to map and create listeners\n    this.olMap.addInteraction(olDrawInteraction);\n    this.olDrawInteraction = olDrawInteraction;\n    this.onDrawStartKey = olDrawInteraction.on(\n      'drawstart',\n      (event: OlDrawEvent) => this.onDrawStart(event)\n    );\n    this.onDrawEndKey = olDrawInteraction.on('drawend', (event: OlDrawEvent) =>\n      this.onDrawEnd(event)\n    );\n    this.onDrawAbortKey = olDrawInteraction.on(\n      'drawabort',\n      (event: OlDrawEvent) => this.abort$.next(event.feature.getGeometry())\n    );\n\n    if (activateModifyAndSelect) {\n      // Create a Modify interaction, add it to map and create a listener\n      const olModifyInteraction = new OlModify({\n        source: this.getSource()\n      });\n\n      this.olMap.addInteraction(olModifyInteraction);\n      this.olModifyInteraction = olModifyInteraction;\n\n      // Create a select interaction and add it to map\n      if (!this.olSelectInteraction) {\n        const olSelectInteraction = new OlSelect({\n          condition: doubleClick,\n          style: undefined\n        });\n        this.olMap.addInteraction(olSelectInteraction);\n        this.olSelectInteraction = olSelectInteraction;\n\n        this.olSelectInteraction.on('select', (event: OlSelectEvent) =>\n          this.onSelect(event)\n        );\n      }\n    }\n  }\n\n  /**\n   * Remove interactions\n   */\n  private removeOlInteractions() {\n    this.unsubscribeKeyDown();\n    unByKey([\n      this.onDrawStartKey,\n      this.onDrawEndKey,\n      this.onDrawKey,\n      this.onDrawAbortKey\n    ]);\n\n    if (this.olMap) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n\n    this.olDrawInteraction = undefined;\n    this.olModifyInteraction = undefined;\n  }\n\n  /**\n   * When drawing starts, clear the overlay and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.start$.next(olGeometry);\n    this.clearOlInnerOverlaySource();\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\n      this.changes$.next(olGeometryEvent.target);\n    });\n    this.subscribeKeyDown();\n  }\n\n  /**\n   * When drawing ends, update the drawing (feature) geometry observable and add\n   * @param event Draw event (drawend)\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    if (event.feature.getGeometry().getType() === 'Point') {\n      this.radiusDrawEnd$.next(this.predefinedRadius$.getValue());\n    }\n    this.unsubscribeKeyDown();\n    unByKey(this.onDrawKey);\n    const olGeometry = event.feature.getGeometry();\n    olGeometry.on('change', () => {\n      this.modify$.next(olGeometry);\n    });\n    this.end$.next(olGeometry);\n  }\n\n  /**\n   * When a feature is selected, update the selected feature observable\n   * @param event Modify event (modifyend)\n   */\n  private onSelect(event: OlSelectEvent) {\n    if (event.selected.length === 1) {\n      this.select$.next(event.selected[0]);\n    }\n  }\n\n  /**\n   * Subscribe to key downs used as drawing interaction shorcuts\n   */\n  private subscribeKeyDown() {\n    this.unsubscribeKeyDown();\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        // On Escape or 'c' keydowns, abort the current drawing\n        if (event.key === 'Escape') {\n          this.olDrawInteraction.abortDrawing();\n          return;\n        }\n\n        // On Backspace or 'u' keydowns, remove last vertex of current drawing\n        if (event.key === 'Backspace') {\n          this.olDrawInteraction.removeLastPoint();\n        }\n\n        // On Enter or 'f' keydowns, finish current drawing\n        if (event.key === 'Enter') {\n          this.olDrawInteraction.finishDrawing();\n        }\n\n        // On space bar key down, pan to the current mouse position\n        if (event.key === ' ') {\n          this.olMap.getView().animate({\n            center: this.mousePosition,\n            duration: 100\n          });\n          return;\n        }\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeKeyDown() {\n    if (this.keyDown$$) {\n      this.keyDown$$.unsubscribe();\n      this.keyDown$$ = undefined;\n    }\n  }\n}\n","import OlMap from 'ol/Map';\nimport OlFeature from 'ol/Feature';\nimport * as OlStyle from 'ol/style';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlModify from 'ol/interaction/Modify';\nimport OlTranslate from 'ol/interaction/Translate';\nimport OlDraw from 'ol/interaction/Draw';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlLineString from 'ol/geom/LineString';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlInteraction from 'ol/interaction/Interaction';\nimport OlDragBoxInteraction from 'ol/interaction/DragBox';\nimport MapBrowserEvent from 'ol/MapBrowserEvent';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport BasicEvent from 'ol/events/Event';\nimport { ModifyEvent as OlModifyEvent } from 'ol/interaction/Modify';\nimport { TranslateEvent as OlTranslateEvent } from 'ol/interaction/Translate';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport { unByKey } from 'ol/Observable';\n\nimport { Subject, Subscription, fromEvent } from 'rxjs';\n\nimport {\n  addLinearRingToOlPolygon,\n  createDrawHoleInteractionStyle,\n  getMousePositionFromOlGeometryEvent\n} from '../geometry.utils';\n\nexport interface ModifyControlOptions {\n  source?: OlVectorSource<any>;\n  layer?: OlVectorLayer<any>;\n  layerStyle?: OlStyleLike;\n  drawStyle?: OlStyleLike;\n  modify?: boolean;\n  translate?: boolean;\n}\n\n/**\n * Control to modify geometries\n */\nexport class ModifyControl {\n  /**\n   * Modify start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Modify end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Geometry changes observable\n   */\n  public changes$: Subject<OlGeometry> = new Subject();\n\n  private olMap: OlMap;\n  private olOverlayLayer: OlVectorLayer<any>;\n  public olModifyInteraction: OlModify;\n  private onModifyStartKey: any;\n  private onModifyEndKey: any;\n  private onModifyKey: any;\n  private olModifyInteractionIsActive: boolean = false;\n  private olTranslateInteraction: OlTranslate;\n  private onTranslateStartKey: any;\n  private onTranslateEndKey: any;\n  private onTranslateKey: any;\n  private olTranslateInteractionIsActive: boolean = false;\n  private olDrawInteraction: OlDraw;\n  private onDrawStartKey: any;\n  private onDrawEndKey: any;\n  private onDrawKey: any;\n  private olDrawInteractionIsActive: boolean = false;\n\n  private mousePosition: [number, number];\n\n  private keyDown$$: Subscription;\n  private drawKeyUp$$: Subscription;\n  private drawKeyDown$$: Subscription;\n\n  private removedOlInteractions: OlInteraction[] = [];\n  private olLinearRingsLayer: OlVectorLayer<any>;\n\n  // This is the geometry to test against when drawing holes\n  private olOuterGeometry: OlGeometry;\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<any> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  /**\n   * OL linear rings source\n   * @internal\n   */\n  get olLinearRingsSource(): OlVectorSource<any> {\n    return this.olLinearRingsLayer.getSource();\n  }\n\n  /**\n   * Whether a modify control should be available\n   */\n  private modify: boolean = true;\n\n  /**\n   * Whether a translate control should be available\n   */\n  private translate: boolean = true;\n\n  constructor(private options: ModifyControlOptions) {\n    if (options.modify !== undefined) {\n      this.modify = options.modify;\n    }\n    if (options.translate !== undefined) {\n      this.translate = options.translate;\n    }\n\n    if (options.layer !== undefined) {\n      this.olOverlayLayer = options.layer;\n    } else {\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\n    }\n    this.olLinearRingsLayer = this.createOlLinearRingsLayer();\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap === undefined) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlModifyInteraction();\n      this.removeOlTranslateInteraction();\n      this.removeOlDrawInteraction();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n\n    // The order in which these interactions\n    // are added is important\n    if (this.modify === true) {\n      this.addOlDrawInteraction();\n    }\n\n    if (this.translate === true) {\n      this.addOlTranslateInteraction();\n      this.activateTranslateInteraction();\n    }\n\n    if (this.modify === true) {\n      this.addOlModifyInteraction();\n      this.activateModifyInteraction();\n    }\n  }\n\n  /**\n   * Return the overlay source\n   */\n  getSource(): OlVectorSource<any> {\n    return this.olOverlaySource;\n  }\n\n  /**\n   * Add an OL geometry to the overlay and start modifying it\n   * @param olGeometry Ol Geometry\n   */\n  setOlGeometry(olGeometry: OlGeometry) {\n    const olFeature = new OlFeature({ geometry: olGeometry });\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create an overlay source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: this.options.source ? this.options.source : new OlVectorSource(),\n      style: this.options.layerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the overlay layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (this.options.layer === undefined) {\n      this.olMap.addLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (this.options.layer === undefined && this.olMap !== undefined) {\n      this.olMap.removeLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (this.options.layer === undefined && this.options.source === undefined) {\n      this.olOverlaySource.clear(true);\n    }\n  }\n\n  private createOlLinearRingsLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: new OlVectorSource(),\n      style: createDrawHoleInteractionStyle(),\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the linear rings layer\n   */\n  private addOlLinearRingsLayer() {\n    this.olMap.addLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings layer\n   */\n  private removeOlLinearRingsLayer() {\n    this.olMap.removeLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings source\n   */\n  private clearOlLinearRingsSource() {\n    this.olLinearRingsSource.clear(true);\n  }\n\n  /**\n   * Add a modify interaction to the map an set up some listeners\n   */\n  private addOlModifyInteraction() {\n    const olModifyInteraction = new OlModify({\n      source: this.olOverlaySource,\n      style: this.options.drawStyle as OlStyle.Style\n    });\n    this.olModifyInteraction = olModifyInteraction;\n  }\n\n  /**\n   * Remove the modify interaction\n   */\n  private removeOlModifyInteraction() {\n    if (this.olModifyInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateModifyInteraction();\n    this.olModifyInteraction = undefined;\n  }\n\n  private activateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === true) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = true;\n    this.onModifyStartKey = this.olModifyInteraction.on(\n      'modifystart',\n      (event: OlModifyEvent) => this.onModifyStart(event)\n    );\n    this.onModifyEndKey = this.olModifyInteraction.on(\n      'modifyend',\n      (event: OlModifyEvent) => this.onModifyEnd(event)\n    );\n    this.olMap.addInteraction(this.olModifyInteraction);\n  }\n\n  private deactivateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === false) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = false;\n\n    unByKey([this.onModifyStartKey, this.onModifyEndKey, this.onModifyKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n  }\n\n  /**\n   * When modifying starts, clear the overlay and start watching for changes\n   * @param event Modify start event\n   */\n  private onModifyStart(event: OlModifyEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onModifyKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        this.mousePosition =\n          getMousePositionFromOlGeometryEvent(olGeometryEvent);\n        this.changes$.next(\n          olGeometryEvent.target as OlLineString | OlCircle | OlPolygon\n        );\n      }\n    );\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When modifying ends, update the geometry observable and stop watching for changes\n   * @param event Modify end event\n   */\n  private onModifyEnd(event: OlModifyEvent) {\n    unByKey(this.onModifyKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Subscribe to space key down to pan the map\n   */\n  private subscribeToKeyDown() {\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key === ' ') {\n          // On space bar, pan to the current mouse position\n          this.olMap.getView().animate({\n            center: this.mousePosition,\n            duration: 0\n          });\n          return;\n        }\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeToKeyDown() {\n    if (this.keyDown$$ !== undefined) {\n      this.keyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a translate interaction to the map an set up some listeners\n   */\n  private addOlTranslateInteraction() {\n    const olTranslateInteraction = new OlTranslate({\n      layers: [this.olOverlayLayer]\n    });\n    this.olTranslateInteraction = olTranslateInteraction;\n  }\n\n  /**\n   * Remove the translate interaction\n   */\n  private removeOlTranslateInteraction() {\n    if (this.olTranslateInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateTranslateInteraction();\n    this.olTranslateInteraction = undefined;\n  }\n\n  private activateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === true) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = true;\n    this.onTranslateStartKey = this.olTranslateInteraction.on(\n      'translatestart',\n      (event: OlTranslateEvent) => this.onTranslateStart(event)\n    );\n    this.onTranslateEndKey = this.olTranslateInteraction.on(\n      'translateend',\n      (event: OlTranslateEvent) => this.onTranslateEnd(event)\n    );\n    this.olMap.addInteraction(this.olTranslateInteraction);\n  }\n\n  private deactivateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === false) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = false;\n    unByKey([\n      this.onTranslateStartKey,\n      this.onTranslateEndKey,\n      this.onTranslateKey\n    ]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olTranslateInteraction);\n    }\n  }\n\n  /**\n   * When translation starts, clear the overlay and start watching for changes\n   * @param event Translate start event\n   */\n  private onTranslateStart(event: OlTranslateEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onTranslateKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        // this.changes$.next(olGeometryEvent.target);\n      }\n    );\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Translate end event\n   */\n  private onTranslateEnd(event: OlTranslateEvent) {\n    unByKey(this.onTranslateKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n  }\n\n  /**\n   * Add a draw interaction to the map an set up some listeners\n   */\n  private addOlDrawInteraction() {\n    const olDrawInteraction = new OlDraw({\n      type: 'Polygon',\n      source: this.olLinearRingsSource,\n      stopClick: true,\n      style: createDrawHoleInteractionStyle(),\n      condition: (event: MapBrowserEvent<any>) => {\n        const olOuterGeometry = this.olOuterGeometry || this.getOlGeometry();\n        const intersects = olOuterGeometry.intersectsCoordinate(\n          event.coordinate\n        );\n        return intersects;\n      }\n    });\n\n    this.olDrawInteraction = olDrawInteraction;\n    this.subscribeToDrawKeyDown();\n  }\n\n  /**\n   * Subscribe to CTRL key down to activate the draw control\n   */\n  private subscribeToDrawKeyDown() {\n    this.drawKeyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyDown();\n\n        const olGeometry = this.getOlGeometry();\n        if (!olGeometry || !(olGeometry instanceof OlPolygon)) {\n          return;\n        }\n\n        this.subscribeToDrawKeyUp();\n\n        this.deactivateModifyInteraction();\n        this.deactivateTranslateInteraction();\n        this.activateDrawInteraction();\n      }\n    );\n  }\n\n  /**\n   * Subscribe to CTRL key up to deactivate the draw control\n   */\n  private subscribeToDrawKeyUp() {\n    this.drawKeyUp$$ = fromEvent(document, 'keyup').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyUp();\n        this.unsubscribeToKeyDown();\n        this.deactivateDrawInteraction();\n\n        this.activateModifyInteraction();\n        if (this.translate === true) {\n          this.activateTranslateInteraction();\n        }\n        this.subscribeToDrawKeyDown();\n\n        this.olOuterGeometry = undefined;\n        this.clearOlLinearRingsSource();\n        this.end$.next(this.getOlGeometry());\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to draw key down\n   */\n  private unsubscribeToDrawKeyDown() {\n    if (this.drawKeyDown$$ !== undefined) {\n      this.drawKeyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Unsubscribe to key up\n   */\n  private unsubscribeToDrawKeyUp() {\n    if (this.drawKeyUp$$ !== undefined) {\n      this.drawKeyUp$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Remove the draw interaction\n   */\n  private removeOlDrawInteraction() {\n    if (this.olDrawInteraction === undefined) {\n      return;\n    }\n\n    this.unsubscribeToKeyDown();\n    this.unsubscribeToDrawKeyUp();\n    this.unsubscribeToDrawKeyDown();\n    this.deactivateDrawInteraction();\n    this.clearOlLinearRingsSource();\n    this.olDrawInteraction = undefined;\n  }\n\n  /**\n   * Activate the draw interaction\n   */\n  private activateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === true) {\n      return;\n    }\n\n    this.clearOlLinearRingsSource();\n    this.addOlLinearRingsLayer();\n\n    this.olMap.getInteractions().forEach((olInteraction: OlInteraction) => {\n      if (olInteraction instanceof OlDragBoxInteraction) {\n        this.olMap.removeInteraction(olInteraction);\n        this.removedOlInteractions.push(olInteraction);\n      }\n    });\n\n    this.olDrawInteractionIsActive = true;\n    this.onDrawStartKey = this.olDrawInteraction.on(\n      'drawstart',\n      (event: OlDrawEvent) => this.onDrawStart(event)\n    );\n    this.onDrawEndKey = this.olDrawInteraction.on(\n      'drawend',\n      (event: OlDrawEvent) => this.onDrawEnd(event)\n    );\n    this.olMap.addInteraction(this.olDrawInteraction);\n  }\n\n  /**\n   * Deactivate the draw interaction\n   */\n  private deactivateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === false) {\n      return;\n    }\n\n    this.removeOlLinearRingsLayer();\n\n    this.removedOlInteractions.forEach((olInteraction: OlInteraction) => {\n      this.olMap.addInteraction(olInteraction);\n    });\n    this.removedOlInteractions = [];\n\n    this.olDrawInteractionIsActive = false;\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n    }\n  }\n\n  /**\n   * When draw start, add a new linerar ring to the geometry and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.olOuterGeometry = this.getOlGeometry().clone();\n\n    const linearRingCoordinates = (\n      (olGeometry as any).getLinearRing() as any\n    ).getCoordinates();\n    this.addLinearRingToOlGeometry(linearRingCoordinates);\n    this.start$.next(this.getOlGeometry());\n\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\n      const olGeometryTarget = olGeometryEvent.target as OlPolygon;\n      const _linearRingCoordinates = olGeometryTarget\n        .getLinearRing(0)\n        .getCoordinates();\n      this.updateLinearRingOfOlGeometry(_linearRingCoordinates);\n      this.changes$.next(this.getOlGeometry());\n    });\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Draw end event\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    unByKey(this.onDrawKey);\n    this.olOuterGeometry = undefined;\n\n    const linearRingCoordinates = (\n      (event.feature.getGeometry() as any).getLinearRing() as any\n    ).getCoordinates();\n    this.updateLinearRingOfOlGeometry(linearRingCoordinates);\n    this.clearOlLinearRingsSource();\n    this.end$.next(this.getOlGeometry());\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Add a linear ring to the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private addLinearRingToOlGeometry(coordinates: number[]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    const olLinearRing = new OlLinearRing(coordinates);\n    addLinearRingToOlPolygon(olGeometry, olLinearRing);\n  }\n\n  /**\n   * Update the last linear ring of the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private updateLinearRingOfOlGeometry(coordinates: number[][]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    // Remove the last linear ring (the one we are updating)\n    const olLinearRings = olGeometry.getLinearRings().slice(0, -1);\n    const newCoordinates = olLinearRings.map((olLinearRing: OlLinearRing) => {\n      return olLinearRing.getCoordinates();\n    });\n    newCoordinates.push(coordinates);\n    olGeometry.setCoordinates(newCoordinates);\n  }\n\n  /**\n   * Get the geometry being modified\n   * @returns OL Geometry\n   */\n  private getOlGeometry(): OlGeometry {\n    const olFeatures = this.olOverlaySource.getFeatures();\n    return olFeatures.length > 0 ? olFeatures[0].getGeometry() : undefined;\n  }\n}\n","export const LAYER = 'Layer';\n","<h3 mat-dialog-title>{{ 'igo.geo.measure.dialog.title' | translate }}</h3>\n<div mat-dialog-content>\n  <table *ngIf=\"data.length > 0\" class=\"mat-typography\">\n    <thead>\n      <tr>\n        <th colspan=\"2\">\n          {{ 'igo.geo.measure.dialog.length.title' | translate }}\n        </th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr>\n        <td>{{ data.length | measureFormat: measureLengthUnit.Meters }}</td>\n        <td>{{ 'igo.geo.measure.dialog.lengthInMeters' | translate }}</td>\n      </tr>\n      <tr>\n        <td>\n          {{ data.length | measureFormat: measureLengthUnit.Kilometers }}\n        </td>\n        <td>{{ 'igo.geo.measure.dialog.lengthInKilometers' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ data.length | measureFormat: measureLengthUnit.Miles }}</td>\n        <td>{{ 'igo.geo.measure.dialog.lengthInMiles' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ data.length | measureFormat: measureLengthUnit.Feet }}</td>\n        <td>{{ 'igo.geo.measure.dialog.lengthInFeet' | translate }}</td>\n      </tr>\n    </tbody>\n  </table>\n\n  <table *ngIf=\"data.area > 0\" class=\"mat-typography\">\n    <thead>\n      <tr>\n        <th colspan=\"2\">\n          {{ 'igo.geo.measure.dialog.area.title' | translate }}\n        </th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr>\n        <td>{{ data.area | measureFormat: measureAreaUnit.SquareMeters }}</td>\n        <td>{{ 'igo.geo.measure.dialog.areaInSquareMeters' | translate }}</td>\n      </tr>\n      <tr>\n        <td>\n          {{ data.area | measureFormat: measureAreaUnit.SquareKilometers }}\n        </td>\n        <td>\n          {{ 'igo.geo.measure.dialog.areaInSquareKilometers' | translate }}\n        </td>\n      </tr>\n      <tr>\n        <td>{{ data.area | measureFormat: measureAreaUnit.SquareMiles }}</td>\n        <td>{{ 'igo.geo.measure.dialog.areaInSquareMiles' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ data.area | measureFormat: measureAreaUnit.Acres }}</td>\n        <td>{{ 'igo.geo.measure.dialog.areaInAcres' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ data.area | measureFormat: measureAreaUnit.Hectares }}</td>\n        <td>{{ 'igo.geo.measure.dialog.areaInHectares' | translate }}</td>\n      </tr>\n      <tr>\n        <td>{{ 'igo.geo.measure.dialog.perimeterInMeters' | translate }}</td>\n        <td>{{ data.perimeter | measureFormat: measureLengthUnit.Meters }}</td>\n      </tr>\n    </tbody>\n  </table>\n</div>\n","import { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { MeasurerDialogData } from '../shared/measure.interfaces';\n\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\n\n@Component({\n  selector: 'igo-measurer-dialog',\n  templateUrl: 'measurer-dialog.component.html',\n  styleUrls: ['./measurer-dialog.component.scss']\n})\nexport class MeasurerDialogComponent {\n  measureAreaUnit = MeasureAreaUnit;\n\n  measureLengthUnit = MeasureLengthUnit;\n\n  constructor(\n    public dialogRef: MatDialogRef<MeasurerDialogComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: MeasurerDialogData\n  ) {}\n\n  onNoClick(): void {\n    this.dialogRef.close();\n  }\n}\n","<div>\n  <div class=\"measure-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      [value]=\"activeMeasureType\"\n      (change)=\"onMeasureTypeChange($event.value)\"\n    >\n      <mat-button-toggle [value]=\"measureType.Length\">\n        {{ 'igo.geo.measure.' + measureType.Length | translate }}\n      </mat-button-toggle>\n      <mat-button-toggle [value]=\"measureType.Area\">\n        {{ 'igo.geo.measure.' + measureType.Area | translate }}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"measure-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\"\n    >\n      {{ 'igo.geo.measure.toggleActive' | translate }}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"hasLine$ | async\"></mat-divider>\n\n    <mat-slide-toggle\n      *ngIf=\"hasLine$ | async\"\n      [checked]=\"displayLines\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayLines($event.checked)\"\n    >\n      {{ 'igo.geo.measure.toggleDisplayLines' | translate }}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n    <mat-slide-toggle\n      *ngIf=\"hasArea$ | async\"\n      [checked]=\"displayDistance\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayDistance($event.checked)\"\n    >\n      {{ 'igo.geo.measure.toggleDisplayDistance' | translate }}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      *ngIf=\"hasArea$ | async\"\n      [checked]=\"displayAreas\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayAreas($event.checked)\"\n    >\n      {{ 'igo.geo.measure.toggleDisplayAreas' | translate }}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"hasArea$ | async\"></mat-divider>\n\n    <mat-slide-toggle\n      [checked]=\"measureUnitsAuto\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleMeasureUnitsAuto($event.checked)\"\n    >\n      {{ 'igo.geo.measure.toggleAutoUnits' | translate }}\n    </mat-slide-toggle>\n  </div>\n\n  <ng-container *ngIf=\"measure$ | async as measure\">\n    <igo-measurer-item\n      *ngIf=\"\n        activeMeasureType === measureType.Length ||\n        activeMeasureType === measureType.Area\n      \"\n      [measureType]=\"measureType.Length\"\n      [measureUnit]=\"measureLengthUnit.Meters\"\n      [measure]=\"measure.length\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"\n        (activeMeasureType === measureType.Area\n          ? 'igo.geo.measure.perimeter'\n          : 'igo.geo.measure.length'\n        ) | translate\n      \"\n      (measureUnitChange)=\"onLengthUnitChange($event)\"\n    >\n    </igo-measurer-item>\n\n    <igo-measurer-item\n      *ngIf=\"activeMeasureType === measureType.Area\"\n      [measureType]=\"measureType.Area\"\n      [measureUnit]=\"measureAreaUnit.SquareMeters\"\n      [measure]=\"measure.area\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"'igo.geo.measure.area' | translate\"\n      (measureUnitChange)=\"onAreaUnitChange($event)\"\n    >\n    </igo-measurer-item>\n  </ng-container>\n\n  <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n  <div class=\"measure-store-buttons\">\n    <button\n      *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.calculate.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"accent\"\n      (click)=\"onCalculateClick()\"\n    >\n      <mat-icon svgIcon=\"calculator\"></mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.delete.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"warn\"\n      (click)=\"onDeleteClick()\"\n    >\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <!--button\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.modify.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length !== 1\"\n      (click)=\"onModifyClick()\">\n      <mat-icon svgIcon=\"edit\"></mat-icon>\n    </button-->\n  </div>\n\n  <igo-entity-table\n    #table\n    class=\"table-compact\"\n    [store]=\"store\"\n    [template]=\"tableTemplate\"\n  >\n  </igo-entity-table>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  ViewChild\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skip } from 'rxjs/operators';\n\nimport OlStyle from 'ol/style/Style';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlVectorSource from 'ol/source/Vector';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlOverlay from 'ol/Overlay';\nimport { unByKey } from 'ol/Observable';\n\nimport { LanguageService, StorageScope, StorageService } from '@igo2/core';\nimport { EntityRecord, EntityTableTemplate } from '@igo2/common';\nimport type { EntityTableComponent } from '@igo2/common';\nimport { uuid } from '@igo2/utils';\n\nimport { FeatureDataSource } from '../../datasource';\nimport {\n  FEATURE,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  tryBindStoreLayer,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy\n} from '../../feature';\nimport { DrawControl, ModifyControl } from '../../geometry/shared';\nimport { VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared';\n\nimport {\n  Measure,\n  MeasurerDialogData,\n  FeatureWithMeasure\n} from '../shared/measure.interfaces';\nimport {\n  MeasureType,\n  MeasureAreaUnit,\n  MeasureLengthUnit\n} from '../shared/measure.enum';\nimport {\n  measureOlGeometry,\n  createMeasureInteractionStyle,\n  createMeasureLayerStyle,\n  updateOlTooltipsAtMidpoints,\n  updateOlTooltipAtCenter,\n  getTooltipsOfOlGeometry,\n  squareMetersToUnit,\n  metersToUnit,\n  formatMeasure\n} from '../shared/measure.utils';\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\n\n/**\n * Tool to measure lengths and areas\n */\n@Component({\n  selector: 'igo-measurer',\n  templateUrl: './measurer.component.html',\n  styleUrls: ['./measurer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MeasurerComponent implements OnInit, OnDestroy {\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate;\n\n  private subscriptions$$: Subscription[] = [];\n\n  /**\n   * Reference to the MeasureType enum\n   * @internal\n   */\n  public measureType = MeasureType;\n\n  /**\n   * Reference to the AreaMeasureUnit enum\n   * @internal\n   */\n  public measureAreaUnit = MeasureAreaUnit;\n\n  /**\n   * Reference to the LengthMeasureUnit enum\n   * @internal\n   */\n  public measureLengthUnit = MeasureLengthUnit;\n\n  /**\n   * Whether measure units should be automatically determined\n   * @internal\n   */\n  public measureUnitsAuto: boolean = false;\n\n  /**\n   * Whether display of distances of areas\n   * @internal\n   */\n  public displayDistance: boolean = true;\n\n  /**\n   * Whether display of distances of lines\n   * @internal\n   */\n  public displayLines: boolean = true;\n\n  /**\n   * Whether display of areas\n   * @internal\n   */\n  public displayAreas: boolean = true;\n\n  /**\n   * Observable of line boolean\n   * @internal\n   */\n  public hasLine$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area boolean\n   * @internal\n   */\n  public hasArea$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area\n   * @internal\n   */\n  public measure$: BehaviorSubject<Measure> = new BehaviorSubject({});\n\n  /**\n   * Observable of selected features\n   * @internal\n   */\n  public selectedFeatures$: BehaviorSubject<FeatureWithMeasure[]> =\n    new BehaviorSubject([]);\n\n  /**\n   * OL draw source\n   * @internal\n   */\n  public showTooltips: boolean = true;\n\n  /**\n   * Whether draw control toggle is disabled or not\n   * @internal\n   */\n  public drawControlIsDisabled: boolean = true;\n\n  /**\n   * Draw line control\n   */\n  private drawLineControl: DrawControl;\n\n  /**\n   * Draw polygon control\n   */\n  private drawPolygonControl: DrawControl;\n\n  /**\n   * Modify control\n   */\n  private modifyControl: ModifyControl;\n\n  /**\n   * Active OL geometry\n   */\n  private activeOlGeometry: OlLineString | OlPolygon;\n\n  /**\n   * Active mlength unit\n   */\n  private activeLengthUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  /**\n   * Active area unit\n   */\n  private activeAreaUnit: MeasureAreaUnit = MeasureAreaUnit.SquareMeters;\n\n  /**\n   * Feature added listener key\n   */\n  private onFeatureAddedKey;\n\n  /**\n   * Feature removed listener key\n   */\n  private onFeatureRemovedKey;\n\n  /**\n   * Active draw control\n   * @internal\n   */\n  private activeDrawControl: DrawControl;\n\n  /**\n   * Subscription to draw start\n   */\n  private drawStart$$: Subscription;\n\n  /**\n   * Subscription to draw end\n   */\n  private drawEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private drawChanges$$: Subscription;\n\n  /**\n   * Subscription to modify start\n   */\n  private modifyStart$$: Subscription;\n\n  /**\n   * Subscription to modify end\n   */\n  private modifyEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private modifyChanges$$: Subscription;\n\n  /**\n   * Subscription to measures selection\n   */\n  private selectedFeatures$$: Subscription;\n\n  /**\n   * OL draw source\n   */\n  private olDrawSource = new OlVectorSource();\n\n  /**\n   * The map to measure on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The measures store\n   */\n  @Input() store: FeatureStore<FeatureWithMeasure>;\n\n  /**\n   * Measure type\n   * @internal\n   */\n  @Input()\n  set activeMeasureType(value: MeasureType) {\n    this.setActiveMeasureType(value);\n  }\n  get activeMeasureType(): MeasureType {\n    return this._activeMeasureType;\n  }\n  private _activeMeasureType: MeasureType;\n\n  /**\n   * The minimum length a segment must have to display a tooltip.\n   * It also applies to area tooltips.\n   */\n  @Input() minSegmentLength: number = 10;\n\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\n\n  /**\n   * Wheter one of the draw control is active\n   * @internal\n   */\n  get drawControlIsActive(): boolean {\n    return this.activeDrawControl !== undefined;\n  }\n\n  get projection(): string {\n    return this.map.ol.getView().getProjection().getCode();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dialog: MatDialog,\n    private storageService: StorageService\n  ) {\n    this.tableTemplate = {\n      selection: true,\n      selectMany: true,\n      selectionCheckbox: true,\n      sort: true,\n      columns: [\n        {\n          name: 'length',\n          title: this.languageService.translate.instant(\n            'igo.geo.measure.lengthHeader'\n          ),\n          valueAccessor: (localFeature: FeatureWithMeasure) => {\n            const unit = this.activeLengthUnit;\n            const measure = metersToUnit(\n              localFeature.properties.measure.length,\n              unit\n            );\n            return formatMeasure(measure, {\n              decimal: 1,\n              unit,\n              unitAbbr: false,\n              locale: 'fr'\n            });\n          }\n        },\n        {\n          name: 'area',\n          title: this.languageService.translate.instant(\n            'igo.geo.measure.areaHeader'\n          ),\n          valueAccessor: (localFeature: FeatureWithMeasure) => {\n            const unit = this.activeAreaUnit;\n            const measure = squareMetersToUnit(\n              localFeature.properties.measure.area,\n              unit\n            );\n            return measure\n              ? formatMeasure(measure, {\n                  decimal: 1,\n                  unit,\n                  unitAbbr: false,\n                  locale: 'fr'\n                })\n              : '';\n          }\n        }\n      ]\n    };\n  }\n\n  /**\n   * Add draw controls and activate one\n   * @internal\n   */\n  ngOnInit() {\n    this.initStore();\n    this.createDrawLineControl();\n    this.createDrawPolygonControl();\n    this.createModifyControl();\n    this.toggleDrawControl();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    this.checkDistanceAreaToggle();\n    this.setActiveMeasureType(MeasureType.Length);\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.setActiveMeasureType(undefined);\n    this.deactivateModifyControl();\n    this.freezeStore();\n    this.subscriptions$$.map((s) => s.unsubscribe());\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onMeasureTypeChange(measureType: MeasureType) {\n    this.activeMeasureType = measureType;\n  }\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n  onToggleDrawControl(toggle: boolean) {\n    if (toggle === true) {\n      this.toggleDrawControl();\n    } else {\n      this.deactivateDrawControl();\n    }\n  }\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n  onToggleMeasureUnitsAuto(toggle: boolean) {\n    this.measureUnitsAuto = toggle;\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the areas\n   * @internal\n   */\n  onToggleDisplayDistance(toggle: boolean) {\n    this.displayDistance = toggle;\n    this.onDisplayDistance();\n    toggle\n      ? this.storageService.set('distanceToggle', true, StorageScope.SESSION)\n      : this.storageService.set('distanceToggle', false, StorageScope.SESSION);\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the lines\n   * @internal\n   */\n  onToggleDisplayLines(toggle: boolean) {\n    this.displayLines = toggle;\n    this.onDisplayLines();\n    toggle\n      ? this.storageService.set('linesToggle', true, StorageScope.SESSION)\n      : this.storageService.set('linesToggle', false, StorageScope.SESSION);\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onToggleDisplayAreas(toggle: boolean) {\n    this.displayAreas = toggle;\n    this.onDisplayAreas();\n    toggle\n      ? this.storageService.set('areasToggle', true, StorageScope.SESSION)\n      : this.storageService.set('areasToggle', false, StorageScope.SESSION);\n  }\n\n  /**\n   * Set display parametres in current values\n   * @internal\n   */\n  checkDistanceAreaToggle() {\n    if (this.storageService.get('distanceToggle') === false) {\n      this.displayDistance = false;\n    }\n    if (this.storageService.get('linesToggle') === false) {\n      this.displayLines = false;\n    }\n    if (this.storageService.get('areasToggle') === false) {\n      this.displayAreas = false;\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of areas\n   * @internal\n   */\n  onDisplayDistance() {\n    if (this.displayDistance) {\n      Array.from(\n        document.getElementsByClassName(\n          'igo-map-tooltip-measure-polygone-segments'\n        )\n      ).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden')\n      );\n    } else {\n      Array.from(\n        document.getElementsByClassName(\n          'igo-map-tooltip-measure-polygone-segments'\n        )\n      ).map((value: Element) => value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of lines\n   * @internal\n   */\n  onDisplayLines() {\n    if (this.displayLines) {\n      Array.from(\n        document.getElementsByClassName('igo-map-tooltip-measure-line-segments')\n      ).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden')\n      );\n    } else {\n      Array.from(\n        document.getElementsByClassName('igo-map-tooltip-measure-line-segments')\n      ).map((value: Element) => value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onDisplayAreas() {\n    if (this.displayAreas) {\n      Array.from(\n        document.getElementsByClassName('igo-map-tooltip-measure-area')\n      ).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden')\n      );\n    } else {\n      Array.from(\n        document.getElementsByClassName('igo-map-tooltip-measure-area')\n      ).map((value: Element) => value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onLengthUnitChange(unit: MeasureLengthUnit) {\n    this.activeLengthUnit = unit;\n    this.table.refresh();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    if (this.activeOlGeometry !== undefined) {\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onAreaUnitChange(unit: MeasureAreaUnit) {\n    this.activeAreaUnit = unit;\n    this.table.refresh();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    if (this.activeOlGeometry !== undefined) {\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n  }\n\n  onCalculateClick() {\n    const features = this.selectedFeatures$.value;\n    const area = features.reduce(\n      (sum: number, localFeature: FeatureWithMeasure) => {\n        return sum + localFeature.properties.measure.area || 0;\n      },\n      0\n    );\n    const length = features.reduce(\n      (sum: number, localFeature: FeatureWithMeasure) => {\n        if (localFeature.geometry.type === 'Polygon') {\n          return sum;\n        }\n        return sum + localFeature.properties.measure.length || 0;\n      },\n      0\n    );\n    const perimeter = features.reduce(\n      (sum: number, localFeature: FeatureWithMeasure) => {\n        if (localFeature.geometry.type === 'LineString') {\n          return sum;\n        }\n        return sum + localFeature.properties.measure.length || 0;\n      },\n      0\n    );\n\n    this.openDialog({\n      area,\n      length,\n      perimeter\n    });\n  }\n\n  onDeleteClick() {\n    this.store.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach((selectedFeature) => {\n      this.olDrawSource.getFeatures().forEach((drawingLayerFeature) => {\n        const geometry = drawingLayerFeature.getGeometry() as any;\n        if (selectedFeature.properties.id === geometry.ol_uid) {\n          this.olDrawSource.removeFeature(drawingLayerFeature);\n        }\n      });\n    });\n  }\n\n  onModifyClick() {\n    if (this.selectedFeatures$.value.length !== 1) {\n      return;\n    }\n\n    if (this.modifyControl.active === true) {\n      this.deactivateModifyControl();\n      this.toggleDrawControl();\n    } else {\n      const localFeature = this.selectedFeatures$.value[0];\n      const olFeatures = this.store.layer.ol.getSource().getFeatures();\n      const olFeature = olFeatures.find((_olFeature: OlFeature<OlGeometry>) => {\n        return _olFeature.get('id') === localFeature.properties.id;\n      });\n\n      if (olFeature !== undefined) {\n        this.deactivateDrawControl();\n        this.activateModifyControl();\n\n        const olGeometry = olFeature.getGeometry();\n        this.clearTooltipsOfOlGeometry(olGeometry as OlLineString | OlPolygon);\n        this.modifyControl.setOlGeometry(olGeometry);\n      }\n    }\n  }\n\n  private openDialog(data: MeasurerDialogData): void {\n    this.dialog.open(MeasurerDialogComponent, { data });\n  }\n\n  /**\n   * Initialize the measure store and set up some listeners\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      title: this.languageService.translate.instant(\n        'igo.geo.measure.layerTitle'\n      ),\n      isIgoInternalLayer: true,\n      id: `igo-measures-${uuid()}`,\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: createMeasureLayerStyle(),\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: { enabled: false }\n    });\n    tryBindStoreLayer(store, layer);\n    store.layer.visible = true;\n    layer.visible$.subscribe((visible) => {\n      if (visible) {\n        Array.from(\n          document.getElementsByClassName('igo-map-tooltip-measure')\n        ).map((value: Element) =>\n          value.classList.remove('igo-map-tooltip-measure-by-display')\n        );\n      } else {\n        Array.from(\n          document.getElementsByClassName('igo-map-tooltip-measure')\n        ).map((value: Element) =>\n          value.classList.add('igo-map-tooltip-measure-by-display')\n        );\n      }\n    });\n\n    tryAddLoadingStrategy(store);\n\n    tryAddSelectionStrategy(\n      store,\n      new FeatureStoreSelectionStrategy({\n        map: this.map,\n        many: true\n      })\n    );\n\n    this.onFeatureAddedKey = store.source.ol.on(\n      'addfeature',\n      (event: OlVectorSourceEvent<OlGeometry>) => {\n        const localFeature = event.feature;\n        const olGeometry = localFeature.getGeometry() as any;\n        this.updateMeasureOfOlGeometry(olGeometry, localFeature.get('measure'));\n        this.onDisplayDistance();\n      }\n    );\n\n    this.onFeatureRemovedKey = store.source.ol.on(\n      'removefeature',\n      (event: OlVectorSourceEvent<OlGeometry>) => {\n        const olGeometry = event.feature.getGeometry() as any;\n        this.clearTooltipsOfOlGeometry(olGeometry);\n      }\n    );\n\n    this.selectedFeatures$$ = store.stateView\n      .manyBy$((record: EntityRecord<FeatureWithMeasure>) => {\n        return record.state.selected === true;\n      })\n      .pipe(\n        skip(1) // Skip initial emission\n      )\n      .subscribe((records: EntityRecord<FeatureWithMeasure>[]) => {\n        if (this.modifyControl.active === true) {\n          this.deactivateModifyControl();\n        }\n        this.selectedFeatures$.next(records.map((record) => record.entity));\n      });\n\n    this.subscriptions$$.push(\n      this.store.entities$.subscribe((objectsExists) => {\n        if (\n          objectsExists.find(\n            (objectExist) => objectExist.geometry.type === 'Polygon'\n          )\n        ) {\n          this.hasArea$.next(true);\n        } else {\n          this.hasArea$.next(false);\n        }\n\n        if (\n          objectsExists.find(\n            (objectExist) => objectExist.geometry.type === 'LineString'\n          )\n        ) {\n          this.hasLine$.next(true);\n        } else {\n          this.hasLine$.next(false);\n        }\n      })\n    );\n\n    this.subscriptions$$.push(\n      this.store.count$.subscribe((cnt) => {\n        cnt >= 1\n          ? (this.store.layer.options.showInLayerList = true)\n          : (this.store.layer.options.showInLayerList = false);\n      })\n    );\n  }\n\n  /**\n   * Freeze any store, meaning the layer is removed, strategies are deactivated\n   * and some listener removed\n   * @internal\n   */\n  private freezeStore() {\n    const store = this.store;\n    this.selectedFeatures$$.unsubscribe();\n    unByKey(this.onFeatureAddedKey);\n    unByKey(this.onFeatureRemovedKey);\n    store.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    store.deactivateStrategyOfType(FeatureStoreSelectionStrategy);\n  }\n\n  /**\n   * Create a draw line control\n   */\n  private createDrawLineControl() {\n    this.drawLineControl = new DrawControl({\n      geometryType: 'LineString',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createDrawPolygonControl() {\n    this.drawPolygonControl = new DrawControl({\n      geometryType: 'Polygon',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createModifyControl() {\n    this.modifyControl = new ModifyControl({\n      source: this.olDrawSource,\n      drawStyle: createMeasureInteractionStyle(),\n      layerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Activate the right control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    // this.deactivateModifyControl();\n    if (this.activeMeasureType === MeasureType.Length) {\n      this.activateDrawControl(this.drawLineControl);\n    } else if (this.activeMeasureType === MeasureType.Area) {\n      this.activateDrawControl(this.drawPolygonControl);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param drawControl Draw control\n   */\n  private activateDrawControl(drawControl: DrawControl) {\n    this.drawControlIsDisabled = false;\n    this.activeDrawControl = drawControl;\n    this.drawStart$$ = drawControl.start$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onDrawStart(olGeometry)\n    );\n    this.drawEnd$$ = drawControl.end$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onDrawEnd(olGeometry)\n    );\n    this.drawChanges$$ = drawControl.changes$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onDrawChanges(olGeometry)\n    );\n    this.drawChanges$$ = drawControl.abort$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => {\n        this.clearTooltipsOfOlGeometry(olGeometry);\n        this.clearMeasures();\n      }\n    );\n    drawControl.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (this.activeDrawControl === undefined) {\n      return;\n    }\n\n    this.olDrawSource.clear();\n    if (this.drawStart$$ !== undefined) {\n      this.drawStart$$.unsubscribe();\n    }\n    if (this.drawEnd$$ !== undefined) {\n      this.drawEnd$$.unsubscribe();\n    }\n    if (this.drawChanges$$ !== undefined) {\n      this.drawChanges$$.unsubscribe();\n    }\n\n    this.clearTooltipsOfOlSource(this.olDrawSource);\n    if (this.activeOlGeometry !== undefined) {\n      this.clearTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n    this.activeDrawControl.setOlMap(undefined);\n    this.activeDrawControl = undefined;\n    this.activeOlGeometry = undefined;\n  }\n\n  private setActiveMeasureType(measureType: MeasureType) {\n    this._activeMeasureType = measureType;\n    this.clearMeasures();\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawStart(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = olGeometry;\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = undefined;\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n    this.addFeatureToStore(olGeometry);\n    this.clearTooltipsOfOlGeometry(olGeometry);\n    this.olDrawSource.clear(true);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawChanges(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(\n      olGeometry,\n      Object.assign({}, measure, {\n        area: undefined // We don't want to display an area tooltip while drawing.\n      })\n    );\n    this.measure$.next(measure);\n  }\n\n  /**\n   * Activate a given control\n   * @param modifyControl Modify control\n   */\n  private activateModifyControl() {\n    const selection = this.store.getStrategyOfType(\n      FeatureStoreSelectionStrategy\n    ) as FeatureStoreSelectionStrategy;\n    selection.deactivate();\n    selection.clear();\n\n    this.modifyStart$$ = this.modifyControl.start$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onModifyStart(olGeometry)\n    );\n    this.modifyEnd$$ = this.modifyControl.end$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onModifyEnd(olGeometry)\n    );\n    this.modifyChanges$$ = this.modifyControl.changes$.subscribe(\n      (olGeometry: OlLineString | OlPolygon) => this.onModifyChanges(olGeometry)\n    );\n    this.modifyControl.setOlMap(this.map.ol);\n  }\n\n  /**\n   * Deactivate the active modify control\n   */\n  private deactivateModifyControl() {\n    if (this.modifyStart$$ !== undefined) {\n      this.modifyStart$$.unsubscribe();\n    }\n    if (this.modifyEnd$$ !== undefined) {\n      this.modifyEnd$$.unsubscribe();\n    }\n    if (this.modifyChanges$$ !== undefined) {\n      this.modifyChanges$$.unsubscribe();\n    }\n\n    if (this.activeOlGeometry !== undefined) {\n      if (this.selectedFeatures$.value.length === 1) {\n        const localFeature = this.selectedFeatures$.value[0];\n        this.addFeatureToStore(this.activeOlGeometry, localFeature);\n      }\n      this.finalizeMeasureOfOlGeometry(this.activeOlGeometry);\n    }\n\n    this.olDrawSource.clear();\n\n    this.store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n\n    this.activeOlGeometry = undefined;\n    this.modifyControl.setOlMap(undefined);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyStart(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawStart(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyChanges(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawChanges(olGeometry);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyEnd(olGeometry: OlLineString | OlPolygon) {\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n  }\n\n  private finalizeMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(olGeometry, measure);\n  }\n\n  /**\n   * Update measures observables\n   * @param olGeometry Ol linestring or polygon\n   * @param measure Measure\n   */\n  private updateMeasureOfOlGeometry(\n    olGeometry: OlLineString | OlPolygon,\n    measure: Measure\n  ) {\n    olGeometry.setProperties({ _measure: measure }, true);\n    this.updateTooltipsOfOlGeometry(olGeometry);\n  }\n\n  /**\n   * Clear the measures observables\n   */\n  private clearMeasures() {\n    this.measure$.next({});\n  }\n\n  /**\n   * Add a feature with measures to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(olGeometry, localFeature?: FeatureWithMeasure) {\n    const featureId = localFeature\n      ? localFeature.properties.id\n      : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n    this.store.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        measure: olGeometry.get('_measure')\n      },\n      meta: {\n        id: featureId\n      }\n    });\n  }\n\n  /**\n   * Update all the tooltips of an OL geometry\n   * @param olGeometry OL Geometry\n   * @param lengths Lengths of the OL geometry's segments\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = olGeometry.get('_measure');\n    const lengths = measure.lengths;\n    const area = measure.area;\n\n    const olMidpointsTooltips = updateOlTooltipsAtMidpoints(olGeometry);\n    if (lengths.length === olMidpointsTooltips.length) {\n      for (let i = 0; i < olMidpointsTooltips.length; i++) {\n        const length = lengths[i];\n        if (length !== undefined) {\n          this.updateOlTooltip(\n            olMidpointsTooltips[i],\n            metersToUnit(length, this.activeLengthUnit),\n            this.activeLengthUnit,\n            MeasureType.Length\n          );\n        }\n      }\n    }\n\n    if (area !== undefined) {\n      this.updateOlTooltip(\n        updateOlTooltipAtCenter(olGeometry),\n        squareMetersToUnit(area, this.activeAreaUnit),\n        this.activeAreaUnit,\n        MeasureType.Area\n      );\n    }\n  }\n\n  /**\n   * Show the map tooltips of a geoemtry\n   */\n  private showTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (this.shouldShowTooltip(olTooltip)) {\n          this.map.ol.addOverlay(olTooltip);\n        }\n      }\n    );\n  }\n\n  /**\n   * Clear the tooltips of an OL geometrys\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (olTooltip !== undefined && olTooltip.getMap() !== undefined) {\n          this.map.ol.removeOverlay(olTooltip);\n        }\n      }\n    );\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private updateTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      this.updateTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private showTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      this.showTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Clear the map tooltips\n   * @param olDrawSource OL vector source\n   */\n  private clearTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry !== undefined) {\n        this.clearTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n      }\n    });\n  }\n\n  /**\n   * Update an OL tooltip properties and inner HTML and add it to the map if possible\n   * @param olTooltip OL tooltip\n   * @param measure The measure valeu ti display\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateOlTooltip(\n    olTooltip: OlOverlay,\n    measure: number,\n    unit: MeasureAreaUnit | MeasureLengthUnit,\n    type: MeasureType\n  ) {\n    olTooltip.setProperties(\n      { _measure: measure, _unit: unit, _type: type },\n      true\n    );\n    olTooltip.getElement().innerHTML = this.computeTooltipInnerHTML(olTooltip);\n    if (this.shouldShowTooltip(olTooltip)) {\n      this.map.ol.addOverlay(olTooltip);\n    }\n  }\n\n  /**\n   * Compute a tooltip's content\n   * @param olTooltip OL overlay\n   * @returns Inner HTML\n   */\n  private computeTooltipInnerHTML(olTooltip: OlOverlay): string {\n    const properties = olTooltip.getProperties() as any;\n    return formatMeasure(\n      properties._measure,\n      {\n        decimal: 1,\n        unit: properties._unit,\n        unitAbbr: true,\n        locale: 'fr'\n      },\n      this.languageService\n    );\n  }\n\n  /**\n   * Whether a tooltip should be showned based on the length\n   * of the segment it is bound to.\n   * @param olTooltip OL overlay\n   * @returns True if the tooltip should be shown\n   */\n  private shouldShowTooltip(olTooltip: OlOverlay): boolean {\n    if (this.showTooltips === false) {\n      return false;\n    }\n\n    const properties = olTooltip.getProperties() as any;\n    const measure = properties._measure;\n    if (measure === undefined) {\n      return false;\n    }\n\n    if (properties._unit === MeasureType.Length) {\n      const minSegmentLength =\n        metersToUnit(this.minSegmentLength, properties._unit) || 0;\n      return measure > Math.max(minSegmentLength, 0);\n    }\n\n    return true;\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\nimport {\n  metersToUnit,\n  squareMetersToUnit,\n  formatMeasure\n} from '../shared/measure.utils';\n\n/**\n * This pipe returns a measure converted from meters (or square meters)\n * to the specified unit. It also keeps a certain number of decimals.\n */\n@Pipe({\n  name: 'measureFormat'\n})\nexport class MeasureFormatPipe implements PipeTransform {\n  /**\n   * @ignore\n   */\n  transform(\n    value: number,\n    unit: MeasureAreaUnit | MeasureLengthUnit,\n    unitAbbr: boolean = false,\n    decimal: number = 1\n  ): number {\n    let out;\n    if (Object.values(MeasureAreaUnit).indexOf(unit as MeasureAreaUnit) >= 0) {\n      out = squareMetersToUnit(value, unit as MeasureAreaUnit);\n    } else if (\n      Object.values(MeasureLengthUnit).indexOf(unit as MeasureLengthUnit) >= 0\n    ) {\n      out = metersToUnit(value, unit as MeasureLengthUnit);\n    }\n\n    return out\n      ? formatMeasure(out, {\n          decimal: 1,\n          unit,\n          unitAbbr,\n          locale: 'fr'\n        })\n      : out;\n  }\n}\n","<igo-geometry-form-field-input\n  [formControl]=\"formControl\"\n  [map]=\"map\"\n  [geometryType]=\"geometryType\"\n  [drawGuide]=\"drawGuide$ | async\"\n  [measure]=\"measure\"\n  [drawControlIsActive]=\"drawControlIsActive\"\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\n  [drawStyle]=\"drawStyle$ | async\"\n  [overlayStyle]=\"overlayStyle$ | async\"\n  [radius]=\"radius\"\n  [predefinedRadius]=\"predefinedRadius\"\n>\n</igo-geometry-form-field-input>\n\n<div class=\"header\">\n  <mat-slide-toggle\n    *ngIf=\"!isPredefined()\"\n    [checked]=\"drawControlIsActive\"\n    [labelPosition]=\"'before'\"\n    (change)=\"onDrawControlChange()\"\n  >\n    {{ 'igo.geo.spatialFilter.drawControl' | translate }}\n  </mat-slide-toggle>\n  <mat-slide-toggle\n    *ngIf=\"!isPredefined()\"\n    [checked]=\"freehandDrawIsActive\"\n    [labelPosition]=\"'before'\"\n    (change)=\"onfreehandControlChange()\"\n  >\n    {{ 'igo.geo.spatialFilter.freehandControl' | translate }}\n  </mat-slide-toggle>\n</div>\n\n<div class=\"buffer-unit\" *ngIf=\"isPolygon()\">\n  <form class=\"buffer-form\">\n    <mat-form-field class=\"buffer\">\n      <input\n        type=\"number\"\n        matInput\n        placeholder=\"{{ 'igo.geo.spatialFilter.buffer' | translate }}\"\n        [formControl]=\"bufferFormControl\"\n        [value]=\"0\"\n        [readonly]=\"this.formControl.value === null\"\n      />\n    </mat-form-field>\n  </form>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n      [value]=\"measureUnit\"\n      (selectionChange)=\"onMeasureUnitChange($event.value)\"\n    >\n      <mat-option\n        *ngFor=\"let measureUnit of measureUnits\"\n        [value]=\"measureUnit\"\n      >\n        {{ 'igo.geo.measure.' + measureUnit | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<div class=\"radius-unit\" *ngIf=\"isPoint()\">\n  <form class=\"radius-form\">\n    <mat-form-field class=\"radius\">\n      <input\n        type=\"number\"\n        matInput\n        placeholder=\"{{ 'igo.geo.spatialFilter.radius' | translate }}\"\n        [formControl]=\"radiusFormControl\"\n        [value]=\"1000\"\n        (input)=\"getRadius()\"\n        [readonly]=\"\n          this.freehandDrawIsActive && this.formControl.value === null\n        \"\n      />\n    </mat-form-field>\n  </form>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n      [value]=\"measureUnit\"\n      (selectionChange)=\"onMeasureUnitChange($event.value)\"\n    >\n      <mat-option\n        *ngFor=\"let measureUnit of measureUnits\"\n        [value]=\"measureUnit\"\n      >\n        {{ 'igo.geo.measure.' + measureUnit | translate }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<mat-label class=\"title mat-typography\"\n  >{{ 'igo.geo.spatialFilter.search' | translate }} :\n</mat-label>\n<mat-radio-group [value]=\"selectedItemType\">\n  <mat-radio-button\n    *ngFor=\"let item of itemType\"\n    [value]=\"item\"\n    (change)=\"onItemTypeChange($event)\"\n  >\n    {{ 'igo.geo.spatialFilter.' + item | translate }}\n  </mat-radio-button>\n</mat-radio-group>\n\n<div\n  class=\"thematics\"\n  *ngIf=\"\n    (selectedItemType === 'Thematics' && !tableTemplate) ||\n    (selectedItemType === 'Thematics' && tableTemplate && !listIsVisible)\n  \"\n>\n  <mat-table>\n    <!-- Name Column -->\n    <ng-container matColumnDef=\"name\">\n      <mat-header-cell *matHeaderCellDef class=\"thematics-header\">{{\n        'igo.geo.spatialFilter.Thematics' | translate\n      }}</mat-header-cell>\n    </ng-container>\n\n    <!-- Select Column -->\n    <ng-container matColumnDef=\"select\">\n      <mat-header-cell *matHeaderCellDef class=\"checks-header\">\n        <mat-checkbox\n          (change)=\"$event ? masterToggle() : null\"\n          [checked]=\"isAllSelected()\"\n          [indeterminate]=\"selectedThematics.hasValue() && !isAllSelected()\"\n        >\n        </mat-checkbox>\n      </mat-header-cell>\n    </ng-container>\n\n    <mat-header-row *matHeaderRowDef=\"displayedColumns\"></mat-header-row>\n    <mat-row *matRowDef=\"let row; columns: displayedColumns\"></mat-row>\n  </mat-table>\n\n  <mat-tree [dataSource]=\"dataSource\" [treeControl]=\"treeControl\">\n    <!-- This is the tree node template for leaf nodes -->\n    <mat-tree-node *matTreeNodeDef=\"let node\" matTreeNodeToggle>\n      <li class=\"mat-tree-node\">\n        <!-- use a disabled button to provide padding for tree leaf -->\n        <button mat-icon-button disabled></button>\n        {{ node.name }}\n        <mat-checkbox\n          class=\"tree-check\"\n          (click)=\"$event.stopPropagation()\"\n          (change)=\"$event ? onToggleChange(node) : null\"\n          [checked]=\"selectedThematics.isSelected(node)\"\n        >\n        </mat-checkbox>\n      </li>\n    </mat-tree-node>\n\n    <!-- This is the tree node template for expandable nodes -->\n    <mat-nested-tree-node *matTreeNodeDef=\"let node; when: hasChild\">\n      <div class=\"mat-tree-node\">\n        <button mat-icon-button (click)=\"onToggleClick(node)\">\n          <mat-icon\n            [svgIcon]=\"\n              treeControl.isExpanded(node) ? 'chevron-down' : 'chevron-right'\n            \"\n          ></mat-icon>\n        </button>\n        {{ node.name }}\n        <mat-checkbox\n          class=\"tree-check-2\"\n          (change)=\"$event ? childrensToggle(node) : null\"\n          [checked]=\"isAllSelected(node)\"\n          [indeterminate]=\"hasChildrenSelected(node) && !isAllSelected(node)\"\n        >\n        </mat-checkbox>\n      </div>\n      <ul\n        class=\"tree-ul\"\n        [class.example-tree-invisible]=\"!treeControl.isExpanded(node)\"\n      >\n        <ng-container matTreeNodeOutlet></ng-container>\n      </ul>\n    </mat-nested-tree-node>\n  </mat-tree>\n</div>\n\n<div class=\"buttons\">\n  <button\n    *ngIf=\"isPredefined()\"\n    mat-raised-button\n    class=\"clear-search-button\"\n    [disabled]=\"disabledClearSearch()\"\n    (click)=\"clearSearch()\"\n  >\n    {{ 'igo.geo.spatialFilter.clearSearch' | translate }}\n  </button>\n\n  <button\n    *ngIf=\"isPolygon() || isPoint()\"\n    mat-raised-button\n    class=\"clear-form-button\"\n    [disabled]=\"this.formControl.value === null\"\n    (click)=\"clearDrawZone()\"\n  >\n    {{ 'igo.geo.spatialFilter.clearForm' | translate }}\n  </button>\n\n  <button\n    mat-raised-button\n    class=\"search-button\"\n    [disabled]=\"disableSearchButton()\"\n    color=\"primary\"\n    (click)=\"toggleSearchButton()\"\n  >\n    {{ 'igo.geo.spatialFilter.goSearch' | translate }}\n  </button>\n\n  <button\n    mat-raised-button\n    class=\"remove-button\"\n    [disabled]=\"allLayers.length === 0\"\n    (click)=\"clearButton()\"\n  >\n    {{ 'igo.geo.spatialFilter.removeLayer' | translate }}\n  </button>\n\n  <button\n    mat-raised-button\n    class=\"export-button\"\n    [disabled]=\"!store.entities$.getValue().length\"\n    (click)=\"export.emit()\"\n  >\n    {{ 'igo.geo.spatialFilter.exportLayer' | translate }}\n  </button>\n</div>\n\n<button\n  class=\"chevron-down\"\n  *ngIf=\"store.all().length && tableTemplate && !listIsVisible\"\n  mat-icon-button\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.spatialFilter.showSearchResults' | translate\"\n  (click)=\"toggleVisibleList()\"\n>\n  <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n</button>\n\n<div\n  class=\"results\"\n  *ngIf=\"store.all().length && tableTemplate && listIsVisible\"\n>\n  <button\n    *ngIf=\"listIsVisible\"\n    mat-icon-button\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.spatialFilter.hideSearchResults' | translate\"\n    (click)=\"toggleVisibleList()\"\n  >\n    <mat-icon svgIcon=\"chevron-up\"></mat-icon>\n  </button>\n  <igo-entity-table\n    class=\"results-list\"\n    [template]=\"tableTemplate\"\n    [store]=\"store\"\n    (entitySelectChange)=\"entityChange.emit($event)\"\n  >\n  </igo-entity-table>\n</div>\n","import OlFeature from 'ol/Feature';\nimport {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport {\n  SpatialFilterQueryType,\n  SpatialFilterType\n} from '../../shared/spatial-filter.enum';\nimport { SelectionModel } from '@angular/cdk/collections';\nimport { IgoMap } from '../../../map/shared';\nimport { SpatialFilterItemType } from './../../shared/spatial-filter.enum';\nimport { Feature } from './../../../feature/shared/feature.interfaces';\nimport { UntypedFormControl } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport type { Type } from 'ol/geom/Geometry';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { GeoJSONGeometry } from '../../../geometry/shared/geometry.interfaces';\nimport * as olStyle from 'ol/style';\nimport * as olproj from 'ol/proj';\nimport OlPoint from 'ol/geom/Point';\nimport { MatTreeNestedDataSource } from '@angular/material/tree';\nimport { SpatialFilterService } from '../../shared/spatial-filter.service';\nimport { MeasureLengthUnit } from '../../../measure';\nimport {\n  EntityStoreFilterSelectionStrategy,\n  EntityStoreWithStrategy,\n  EntityTableColumnRenderer,\n  EntityTableTemplate\n} from '@igo2/common';\nimport { Layer, VectorLayer } from '../../../layer/shared';\nimport { NestedTreeControl } from '@angular/cdk/tree';\nimport { SpatialFilterThematic } from './../../shared/spatial-filter.interface';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { FeatureMotion, FeatureStoreSelectionStrategy } from '../../../feature';\nimport { FeatureDataSource } from '../../../datasource/shared';\n\n/**\n * Spatial-Filter-Item (search parameters)\n */\n@Component({\n  selector: 'igo-spatial-filter-item',\n  templateUrl: './spatial-filter-item.component.html',\n  styleUrls: ['./spatial-filter-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterItemComponent implements OnDestroy, OnInit {\n  @Input() map: IgoMap;\n\n  @Input()\n  get type(): SpatialFilterType {\n    return this._type;\n  }\n  set type(type: SpatialFilterType) {\n    this._type = type;\n    const index = this.geometryTypes.findIndex((geom) => geom === this.type);\n    this.geometryType = this.geometryTypes[index];\n    this.formControl.reset();\n    this.radius = undefined;\n    this.drawGuide$.next(null);\n    this.drawStyle$.next(undefined);\n\n    // Necessary to keep reference to the geometry form field input\n    if (this.type === SpatialFilterType.Predefined) {\n      const geojson: GeoJSONGeometry = {\n        type: 'Point',\n        coordinates: ''\n      };\n      this.formControl.setValue(geojson);\n    }\n\n    // Necessary to apply the right style when geometry type is Point\n    if (this.type === SpatialFilterType.Point) {\n      this.radius = 1000; // Base radius\n      this.radiusFormControl.setValue(this.radius);\n      this.PointStyle = (\n        feature: OlFeature<OlGeometry>,\n        resolution: number\n      ) => {\n        const geom = feature.getGeometry() as OlPoint;\n        const coordinates = olproj.transform(\n          geom.getCoordinates(),\n          this.map.projection,\n          'EPSG:4326'\n        );\n        return new olStyle.Style({\n          image: new olStyle.Circle({\n            radius:\n              this.radius /\n              Math.cos((Math.PI / 180) * coordinates[1]) /\n              resolution, // Latitude correction\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          })\n        });\n      };\n      this.overlayStyle = this.PointStyle;\n      this.drawStyle$.next(this.overlayStyle);\n    } else {\n      // If geometry types is Polygon\n      this.radius = undefined;\n      this.PolyStyle = () => {\n        return new olStyle.Style({\n          stroke: new olStyle.Stroke({\n            width: 2,\n            color: 'rgba(0, 153, 255)'\n          }),\n          fill: new olStyle.Fill({\n            color: 'rgba(0, 153, 255, 0.2)'\n          })\n        });\n      };\n      const color = [0, 153, 255];\n      const drawStyle = () => {\n        return new olStyle.Style({\n          image: new olStyle.Circle({\n            radius: 8,\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          }),\n          stroke: new olStyle.Stroke({\n            color: color.concat([1]),\n            width: 2\n          }),\n          fill: new olStyle.Fill({\n            color: color.concat([0.2])\n          })\n        });\n      };\n      this.overlayStyle = this.PolyStyle;\n      this.drawStyle$.next(drawStyle);\n    }\n    this.overlayStyle$.next(this.overlayStyle);\n  }\n  private _type: SpatialFilterType;\n\n  @Input() queryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() loading;\n\n  @Input()\n  get store(): EntityStoreWithStrategy<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStoreWithStrategy<Feature>) {\n    this._store = store;\n    this._store.entities$.subscribe(() => {\n      this.cdRef.detectChanges();\n    });\n  }\n  private _store: EntityStoreWithStrategy<Feature>;\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Input() layers: Layer[] = [];\n\n  @Input() allLayers: Layer[] = [];\n\n  @Input()\n  get thematicLength(): number {\n    return this._thematicLength;\n  }\n  set thematicLength(value: number) {\n    this._thematicLength = value;\n  }\n  private _thematicLength: number;\n\n  @Output() toggleSearch = new EventEmitter();\n\n  @Output() itemTypeChange = new EventEmitter<SpatialFilterItemType>();\n\n  @Output() thematicChange = new EventEmitter<SpatialFilterThematic[]>();\n\n  @Output() drawZoneEvent = new EventEmitter<Feature>();\n\n  @Output() bufferEvent = new EventEmitter<number>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  @Output() radiusEvent = new EventEmitter<number>();\n  @Output() freehandControl = new EventEmitter<boolean>();\n  @Output() predefinedRadius = new EventEmitter<boolean>();\n\n  @Output() clearButtonEvent = new EventEmitter();\n\n  @Output() clearSearchEvent = new EventEmitter();\n\n  @Output() export = new EventEmitter();\n\n  @Output() openWorkspace = new EventEmitter();\n  @Output() entityChange = new EventEmitter<any>();\n\n  public itemType: SpatialFilterItemType[] = [\n    SpatialFilterItemType.Address,\n    SpatialFilterItemType.Thematics\n  ];\n  public selectedItemType: SpatialFilterItemType =\n    SpatialFilterItemType.Address;\n  public selectedSourceAddress;\n\n  treeControl: NestedTreeControl<SpatialFilterThematic> =\n    new NestedTreeControl<SpatialFilterThematic>((node) => node.children);\n\n  // For thematics and results tables\n  public displayedColumns: string[] = ['name', 'select'];\n  public childrens: SpatialFilterThematic[] = [];\n  public groups: string[] = [];\n  public thematics: SpatialFilterThematic[] = [];\n  public dataSource = new MatTreeNestedDataSource<SpatialFilterThematic>();\n  public selectedThematics = new SelectionModel<SpatialFilterThematic>(\n    true,\n    []\n  );\n\n  // For geometry form field input\n  value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(undefined);\n  drawGuide$: BehaviorSubject<number> = new BehaviorSubject(null);\n  overlayStyle$: BehaviorSubject<\n    olStyle.Style | ((feature, resolution) => olStyle.Style)\n  > = new BehaviorSubject(undefined);\n  drawStyle$: BehaviorSubject<\n    olStyle.Style | ((feature, resolution) => olStyle.Style)\n  > = new BehaviorSubject(undefined);\n\n  private value$$: Subscription;\n  private radiusChanges$$: Subscription;\n  private bufferChanges$$: Subscription;\n\n  public formControl = new UntypedFormControl();\n  public geometryType: Type | string;\n  public geometryTypeField = false;\n  public geometryTypes: string[] = ['Point', 'Polygon'];\n  public drawGuideField = false;\n  public drawGuide: number = null;\n  public drawGuidePlaceholder = '';\n  public measure = false;\n  public drawControlIsActive = true;\n  public freehandDrawIsActive = false;\n  public drawStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public drawZone;\n  public overlayStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PointStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PolyStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n\n  public radius: number;\n  public buffer: number = 0;\n  public radiusFormControl = new UntypedFormControl();\n  public bufferFormControl = new UntypedFormControl();\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  public zoneWithBuffer;\n\n  public listIsVisible = true;\n  public tableTemplate: EntityTableTemplate;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    this.spatialFilterService\n      .loadThematicsList()\n      .subscribe((items: SpatialFilterThematic[]) => {\n        for (const item of items) {\n          this.childrens.push(item);\n          this.childrens.sort((a, b) => {\n            return a.name.localeCompare(b.name);\n          });\n        }\n        this.groups.push(\n          this.languageService.translate.instant('igo.geo.terrapi.limites')\n        );\n        const limits: SpatialFilterThematic = {\n          name: this.groups[0],\n          children: []\n        };\n        this.thematics.push(limits);\n        this.childrens.forEach((child) => {\n          if (child.group && this.groups.indexOf(child.group) === -1) {\n            this.groups.push(child.group);\n            const thematic: SpatialFilterThematic = {\n              name: child.group,\n              children: []\n            };\n            this.thematics.push(thematic);\n          }\n\n          if (!child.group) {\n            if (\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.AdmRegion'\n                ) ||\n              child.name ===\n                this.languageService.translate.instant('igo.geo.terrapi.Mun') ||\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.Arrond'\n                ) ||\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.CircFed'\n                ) ||\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.CircProv'\n                ) ||\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.DirReg'\n                ) ||\n              child.name ===\n                this.languageService.translate.instant('igo.geo.terrapi.MRC') ||\n              child.name ===\n                this.languageService.translate.instant(\n                  'igo.geo.terrapi.RegTour'\n                )\n            ) {\n              child.group = limits.name;\n            } else if (\n              child.name ===\n              this.languageService.translate.instant('igo.geo.terrapi.routes')\n            ) {\n              child.group = this.languageService.translate.instant(\n                'igo.geo.spatialFilter.group.transport'\n              );\n            } else {\n              const thematic: SpatialFilterThematic = {\n                name: child.name,\n                children: [],\n                source: child.source\n              };\n              this.thematics.push(thematic);\n            }\n          }\n          this.thematics.sort((a, b) => {\n            return a.name.localeCompare(b.name);\n          });\n        });\n        this.thematics.forEach((thematic) => {\n          for (const child of this.childrens) {\n            if (child.group === thematic.name) {\n              thematic.children.push(child);\n            }\n          }\n        });\n      });\n\n    this.dataSource.data = this.thematics;\n\n    this.drawGuide$.next(null);\n    this.value$.next(\n      this.formControl.value ? this.formControl.value : undefined\n    );\n    this.value$$ = this.formControl.valueChanges.subscribe(\n      (value: GeoJSONGeometry) => {\n        if (value) {\n          this.value$.next(value);\n          this.drawZone = this.formControl.value as Feature;\n          if (this.buffer !== 0) {\n            this.drawZoneEvent.emit(this.drawZone);\n            this.bufferFormControl.setValue(this.buffer);\n          }\n        } else {\n          this.value$.next(undefined);\n          this.drawZone = undefined;\n        }\n      }\n    );\n\n    this.value$.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.radiusChanges$$ = this.radiusFormControl.valueChanges.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.bufferChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(debounceTime(500))\n      .subscribe((value) => {\n        if (\n          this.measureUnit === MeasureLengthUnit.Meters &&\n          value > 0 &&\n          value <= 100000\n        ) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService\n            .loadBufferGeometry(this.drawZone, SpatialFilterType.Polygon, value)\n            .subscribe((featureGeom: Feature) => {\n              this.zoneWithBuffer = featureGeom;\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n            });\n        } else if (\n          this.measureUnit === MeasureLengthUnit.Kilometers &&\n          value > 0 &&\n          value <= 100\n        ) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService\n            .loadBufferGeometry(\n              this.drawZone,\n              SpatialFilterType.Polygon,\n              value * 1000\n            )\n            .subscribe((featureGeom: Feature) => {\n              this.zoneWithBuffer = featureGeom;\n              this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n            });\n        } else if (value === 0) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.drawZoneEvent.emit(this.drawZone);\n        } else if (\n          value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)\n        ) {\n          this.bufferFormControl.setValue(0);\n          this.buffer = 0;\n          this.messageService.alert(\n            'igo.geo.spatialFilter.bufferAlert',\n            'igo.geo.spatialFilter.warning'\n          );\n        }\n      });\n\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map: this.map,\n      hitTolerance: 15,\n      motion: FeatureMotion.Default,\n      many: true,\n      dragBox: true\n    });\n\n    this.store.addStrategy(selectionStrategy, true);\n    this.store.addStrategy(selectedRecordStrategy, false);\n  }\n\n  /**\n   * Unsubscribe to the value stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.value$$.unsubscribe();\n    this.radiusChanges$$.unsubscribe();\n    this.bufferChanges$$.unsubscribe();\n    this.cdRef.detach();\n    if (this.radiusChanges$$) {\n      this.radiusChanges$$.unsubscribe();\n    }\n    if (this.value$$) {\n      this.value$$.unsubscribe();\n    }\n  }\n\n  onItemTypeChange(event) {\n    this.selectedItemType = event.value;\n    this.itemTypeChange.emit(this.selectedItemType);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      if (this.isPolygon()) {\n        this.measureUnit === MeasureLengthUnit.Meters\n          ? this.bufferFormControl.setValue(this.bufferFormControl.value * 1000)\n          : this.bufferFormControl.setValue(\n              this.bufferFormControl.value / 1000\n            );\n      } else if (this.isPoint()) {\n        this.measureUnit === MeasureLengthUnit.Meters\n          ? this.radiusFormControl.setValue(this.radiusFormControl.value * 1000)\n          : this.radiusFormControl.setValue(\n              this.radiusFormControl.value / 1000\n            );\n      }\n    }\n  }\n\n  isPredefined() {\n    return this.type === SpatialFilterType.Predefined;\n  }\n\n  isPolygon() {\n    return this.type === SpatialFilterType.Polygon;\n  }\n\n  isPoint() {\n    return this.type === SpatialFilterType.Point;\n  }\n\n  hasChild(_: number, node: SpatialFilterThematic) {\n    if (node.children) {\n      return node.children.length;\n    }\n    return false;\n  }\n\n  onToggleClick(node: SpatialFilterThematic) {\n    this.treeControl.isExpanded(node)\n      ? this.treeControl.collapse(node)\n      : this.treeControl.expand(node);\n  }\n\n  isAllSelected(node?: SpatialFilterThematic) {\n    let numSelected;\n    let numNodes = 0;\n    if (!node) {\n      numSelected = this.selectedThematics.selected.length;\n      this.thematics.forEach((thematic) => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          numNodes++;\n        }\n      });\n      this.childrens.forEach((children) => {\n        if (\n          !this.thematics.find(\n            (thematic) => thematic.source === children.source\n          )\n        ) {\n          numNodes++;\n        }\n      });\n    } else {\n      numSelected = node.children.length;\n      node.children.forEach((children) => {\n        if (\n          this.selectedThematics.selected.find(\n            (thematic) => thematic === children\n          )\n        ) {\n          numNodes++;\n        }\n      });\n    }\n\n    if (numNodes >= 1) {\n      return numSelected === numNodes;\n    } else {\n      return false;\n    }\n  }\n\n  hasChildrenSelected(node: SpatialFilterThematic) {\n    let bool = false;\n    node.children.forEach((child) => {\n      if (\n        this.selectedThematics.selected.find(\n          (thematic) => thematic.source === child.source\n        )\n      ) {\n        bool = true;\n      }\n    });\n    return bool;\n  }\n\n  /**\n   * Apply header checkbox\n   */\n  masterToggle() {\n    this.isAllSelected() ? this.selectedThematics.clear() : this.selectAll();\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n\n    if (this.isAllSelected()) {\n      this.thematics.forEach((thematic) => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.expand(thematic);\n        }\n      });\n    } else {\n      this.thematics.forEach((thematic) => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.collapse(thematic);\n        }\n      });\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  selectAll(node?: SpatialFilterThematic) {\n    if (!node) {\n      this.thematics.forEach((thematic) => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          this.selectedThematics.select(thematic);\n        }\n      });\n      this.childrens.forEach((children) => {\n        if (\n          !this.selectedThematics.selected.find(\n            (thematic) => thematic.source === children.source\n          )\n        ) {\n          this.selectedThematics.select(children);\n        }\n      });\n    } else {\n      if (this.hasChild(0, node)) {\n        node.children.forEach((children) =>\n          this.selectedThematics.select(children)\n        );\n      }\n    }\n  }\n\n  childrensToggle(node: SpatialFilterThematic) {\n    this.isAllSelected(node)\n      ? node.children.forEach((child) => this.selectedThematics.deselect(child))\n      : this.selectAll(node);\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.treeControl.expand(node);\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  /**\n   * Apply changes to the thematics selected tree and emit event\n   */\n  onToggleChange(nodeSelected: SpatialFilterThematic) {\n    let selected = false;\n    if (\n      this.selectedThematics.selected.find(\n        (thematic) => thematic.source === nodeSelected.source\n      ) !== undefined\n    ) {\n      selected = true;\n    }\n\n    this.childrens.forEach((children) => {\n      if (children === nodeSelected && selected === false) {\n        this.selectedThematics.select(children);\n      }\n      if (children === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(children);\n      }\n    });\n    this.thematics.forEach((thematic) => {\n      if (thematic === nodeSelected && selected === false) {\n        this.selectedThematics.select(thematic);\n      }\n      if (thematic === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(thematic);\n      }\n    });\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  onDrawControlChange() {\n    this.drawControlIsActive = !this.drawControlIsActive;\n  }\n\n  onfreehandControlChange() {\n    this.freehandDrawIsActive = !this.freehandDrawIsActive;\n    this.freehandControl.emit(this.freehandDrawIsActive);\n    if (this.isPoint()) {\n      this.predefinedRadius.emit(!this.freehandDrawIsActive);\n      if (this.freehandDrawIsActive) {\n        this.overlayStyle$.next(undefined);\n        this.drawStyle$.next(undefined);\n      }\n    } else {\n      this.predefinedRadius.emit(false);\n    }\n  }\n\n  /**\n   * Launch search button\n   */\n  toggleSearchButton() {\n    if (!this.isPredefined()) {\n      if (this.buffer > 0) {\n        this.zoneWithBuffer.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.zoneWithBuffer.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.zoneWithBuffer);\n      } else {\n        this.drawZone.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.drawZone.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.drawZone);\n      }\n    }\n    if (this.isPoint()) {\n      this.radiusEvent.emit(this.radius);\n    } else if (this.isPolygon()) {\n      this.bufferEvent.emit(this.buffer);\n    }\n    this.toggleSearch.emit();\n    this.store.entities$.pipe(debounceTime(500)).subscribe((value) => {\n      if (value.length && this.layers.length === this.thematicLength + 1) {\n        this.openWorkspace.emit();\n        this.createTableTemplate();\n      }\n    });\n  }\n\n  /**\n   * Launch clear button (clear store and map layers)\n   */\n  clearButton() {\n    this.loading = true;\n    if (this.store) {\n      this.store.clear();\n    }\n    if (this.isPoint() || this.isPolygon()) {\n      this.drawZone = undefined;\n      this.formControl.reset();\n    }\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.clearButtonEvent.emit();\n    this.loading = false;\n    this.tableTemplate = undefined;\n  }\n\n  clearDrawZone() {\n    this.formControl.reset();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n  }\n\n  /**\n   * Launch clear search (clear field if type is predefined)\n   */\n  clearSearch() {\n    this.selectedThematics.clear();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.thematicChange.emit([]);\n    this.clearSearchEvent.emit();\n  }\n\n  /**\n   * Verify conditions of incomplete fields or busy service\n   */\n  disableSearchButton(): boolean {\n    if (this.type === SpatialFilterType.Predefined) {\n      if (this.selectedItemType === SpatialFilterItemType.Address) {\n        if (this.queryType !== undefined && this.zone !== undefined) {\n          return this.loading;\n        }\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (\n          this.queryType !== undefined &&\n          this.zone !== undefined &&\n          this.selectedThematics.selected.length > 0\n        ) {\n          return this.loading;\n        }\n      }\n    }\n    if (\n      this.type === SpatialFilterType.Polygon ||\n      this.type === SpatialFilterType.Point\n    ) {\n      if (\n        this.selectedItemType === SpatialFilterItemType.Address &&\n        this.formControl.value !== null\n      ) {\n        return this.loading;\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (\n          this.selectedThematics.selected.length > 0 &&\n          this.formControl.value !== null\n        ) {\n          return this.loading;\n        }\n      }\n    }\n    return true;\n  }\n\n  disabledClearSearch() {\n    let disable = true;\n    this.selectedItemType === SpatialFilterItemType.Address\n      ? (disable = this.queryType === undefined)\n      : (disable =\n          this.queryType === undefined &&\n          this.selectedThematics.selected.length === 0);\n\n    return disable;\n  }\n\n  /**\n   * Manage radius value at user change\n   */\n  getRadius() {\n    let formValue;\n    if (this.formControl.value !== null) {\n      this.measureUnit === MeasureLengthUnit.Meters\n        ? (formValue = this.formControl.value.radius)\n        : (formValue = this.formControl.value.radius / 1000);\n    } else {\n      formValue = undefined;\n    }\n\n    if (this.type === SpatialFilterType.Point) {\n      if (!this.freehandDrawIsActive) {\n        if (\n          this.radiusFormControl.value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters &&\n            this.radiusFormControl.value >= 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers &&\n            this.radiusFormControl.value >= 100)\n        ) {\n          this.messageService.alert(\n            'igo.geo.spatialFilter.radiusAlert',\n            'igo.geo.spatialFilter.warning'\n          );\n          this.radius = 1000;\n          this.measureUnit === MeasureLengthUnit.Meters\n            ? this.radiusFormControl.setValue(this.radius)\n            : this.radiusFormControl.setValue(this.radius / 1000);\n          this.drawGuide$.next(this.radius);\n          return;\n        }\n      } else {\n        if (formValue) {\n          if (formValue >= 100000) {\n            this.messageService.alert(\n              'igo.geo.spatialFilter.radiusAlert',\n              'igo.geo.spatialFilter.warning'\n            );\n            this.formControl.reset();\n            return;\n          }\n          if (formValue !== this.radiusFormControl.value) {\n            this.radiusFormControl.setValue(formValue);\n            return;\n          }\n        }\n      }\n      if (this.measureUnit === MeasureLengthUnit.Meters) {\n        this.radius = this.radiusFormControl.value;\n        this.drawGuide$.next(this.radius);\n      } else {\n        this.radius = this.radiusFormControl.value * 1000;\n        this.drawGuide$.next(this.radius * 1000);\n      }\n      this.overlayStyle$.next(this.PointStyle);\n      this.drawStyle$.next(this.PointStyle);\n    }\n  }\n\n  toggleVisibleList() {\n    this.listIsVisible = !this.listIsVisible;\n  }\n\n  private createTableTemplate() {\n    const typeColumn = {\n      name: 'meta.title',\n      title: this.languageService.translate.instant(\n        'igo.geo.spatialFilter.type'\n      ),\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\n    };\n    const nameColumn = {\n      name: 'properties.nom',\n      title: this.languageService.translate.instant(\n        'igo.geo.spatialFilter.searchResults'\n      ),\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\n    };\n    const columns = [typeColumn, nameColumn];\n\n    this.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n}\n","<div class=\"datetime-container\">\n  <mat-slide-toggle\n    *ngIf=\"this.currentFilter.sliderOptions?.enabled\"\n    [(ngModel)]=\"sliderMode\"\n    (change)=\"modeChange($event)\"\n  >\n    {{ 'igo.geo.filter.sliderModeTitle' | translate }}\n  </mat-slide-toggle>\n\n  <div class=\"slider-container\" *ngIf=\"sliderMode\">\n    <igo-ogc-filter-time-slider\n      [begin]=\"beginValue\"\n      [max]=\"this.restrictedToStep() ? this.maxDate : this.endValue\"\n      [currentFilter]=\"currentFilter\"\n      [datasource]=\"datasource\"\n      (changeProperty)=\"changePropertyByPass($event)\"\n    >\n    </igo-ogc-filter-time-slider>\n  </div>\n\n  <div *ngIf=\"!sliderMode\">\n    <div class=\"year-input-container\" *ngIf=\"calendarTypeYear\">\n      <!-- to emulate a year-picker, 2 input: first input to show user just year and second input hiden and bind \n        with the datepicker  -->\n      <mat-form-field class=\"year-input\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.timeFilter.startYear' | translate }}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{ onlyYearBegin }}\"\n          (change)=\"yearOnlyInputChange($event, beginDatepicker, 'begin')\"\n          [disabled]=\"filterStateDisable\"\n        />\n        <mat-datepicker-toggle\n          matSuffix\n          [for]=\"beginDatepicker\"\n          [disabled]=\"filterStateDisable\"\n        ></mat-datepicker-toggle>\n\n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #beginDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"beginValue\"\n          (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n        >\n        </mat-datepicker>\n\n        <input\n          #beginYear\n          class=\"year-input-hide\"\n          matInput\n          [matDatepicker]=\"beginDatepicker\"\n          enabled=\"false\"\n          readonly=\"true\"\n          [value]=\"\n            beginValue ? beginValue : handleDate(datasource.options.minDate)\n          \"\n          [min]=\"handleDate(datasource.options.minDate)\"\n          [max]=\"\n            endValue && !restrictedToStep()\n              ? endValue\n              : handleDate(datasource.options.maxDate)\n          \"\n        />\n      </mat-form-field>\n\n      <mat-form-field class=\"year-input\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.timeFilter.endYear' | translate }}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{ onlyYearEnd }}\"\n          (change)=\"yearOnlyInputChange($event, endDatepicker, 'end')\"\n          [disabled]=\"filterStateDisable\"\n        />\n        <mat-datepicker-toggle\n          matSuffix\n          [for]=\"endDatepicker\"\n          [disabled]=\"filterStateDisable\"\n        ></mat-datepicker-toggle>\n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #endDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"endValue\"\n          (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n        >\n        </mat-datepicker>\n\n        <input\n          #endYear\n          class=\"year-input-hide\"\n          matInput\n          [matDatepicker]=\"endDatepicker\"\n          enabled=\"false\"\n          readonly=\"true\"\n          [value]=\"endValue ? endValue : handleDate(datasource.options.maxDate)\"\n          [min]=\"\n            beginValue ? beginValue : handleDate(datasource.options.minDate)\n          \"\n          [max]=\"handleDate(datasource.options.maxDate)\"\n        />\n      </mat-form-field>\n      <div class=\"actions-container\">\n        <button\n          class=\"reset-button\"\n          mat-icon-button\n          color=\"primary\"\n          (click)=\"resetFilter()\"\n          [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n          [disabled]=\"filterStateDisable\"\n        >\n          <mat-icon svgIcon=\"{{ resetIcon }}\"></mat-icon>\n        </button>\n        <mat-slide-toggle\n          class=\"toggle-filter-state\"\n          (change)=\"toggleFilterState()\"\n          [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [checked]=\"!filterStateDisable\"\n        >\n        </mat-slide-toggle>\n      </div>\n    </div>\n\n    <div class=\"datetime-input-container\" *ngIf=\"calendarType() !== 'year'\">\n      <div class=\"datetime-input\">\n        <mat-form-field class=\"date-input\" subscriptSizing=\"dynamic\">\n          <mat-datepicker-toggle\n            matSuffix\n            [for]=\"beginDatepicker\"\n            [disabled]=\"filterStateDisable\"\n          ></mat-datepicker-toggle>\n          <input\n            #begin\n            matInput\n            [matDatepicker]=\"beginDatepicker\"\n            [placeholder]=\"'igo.geo.timeFilter.startDate' | translate\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (dateChange)=\"changeTemporalProperty(begin.value, 1)\"\n            [matDatepickerFilter]=\"filterBeginFunction\"\n            [value]=\"\n              beginValue ? beginValue : handleDate(datasource.options.minDate)\n            \"\n            [min]=\"handleDate(datasource.options.minDate)\"\n            [max]=\"\n              endValue && !restrictedToStep()\n                ? endValue\n                : handleDate(datasource.options.maxDate)\n            \"\n            [disabled]=\"filterStateDisable\"\n          />\n          <span class=\"filler\"></span>\n          <mat-datepicker\n            #beginDatepicker\n            [startView]=\"calendarView()\"\n            [startAt]=\"beginValue\"\n            (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n            (monthSelected)=\"monthSelected($event, beginDatepicker, 'begin')\"\n          >\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div *ngIf=\"calendarType() === 'datetime'\" class=\"time-input\">\n          <mat-form-field class=\"hour-input\" subscriptSizing=\"dynamic\">\n            <mat-label>{{ 'igo.geo.timeFilter.hour' | translate }}</mat-label>\n            <mat-select\n              [formControl]=\"beginHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\"\n            >\n              <mat-option *ngFor=\"let hour of beginHours\" [value]=\"hour\">{{\n                hour\n              }}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" subscriptSizing=\"dynamic\">\n            <mat-label>{{ 'igo.geo.timeFilter.minute' | translate }}</mat-label>\n            <mat-select\n              [formControl]=\"beginMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\"\n            >\n              <mat-option\n                *ngFor=\"let minute of beginMinutes\"\n                [value]=\"minute\"\n                >{{ minute }}</mat-option\n              >\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <div *ngIf=\"!restrictedToStep()\" class=\"datetime-input\">\n        <mat-form-field class=\"date-input\" subscriptSizing=\"dynamic\">\n          <mat-datepicker-toggle\n            matSuffix\n            [for]=\"endDatepicker\"\n            [disabled]=\"filterStateDisable\"\n          ></mat-datepicker-toggle>\n          <input\n            #end\n            matInput\n            [matDatepicker]=\"endDatepicker\"\n            [placeholder]=\"'igo.geo.timeFilter.endDate' | translate\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (dateChange)=\"changeTemporalProperty(end.value, 2)\"\n            [matDatepickerFilter]=\"filterEndFunction\"\n            [value]=\"\n              endValue ? endValue : handleDate(datasource.options.maxDate)\n            \"\n            [min]=\"\n              beginValue ? beginValue : handleDate(datasource.options.minDate)\n            \"\n            [max]=\"handleDate(datasource.options.maxDate)\"\n            [disabled]=\"filterStateDisable\"\n          />\n          <span class=\"filler\"></span>\n          <mat-datepicker\n            #endDatepicker\n            [startView]=\"calendarView()\"\n            [startAt]=\"endValue\"\n            (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n            (monthSelected)=\"monthSelected($event, endDatepicker, 'end')\"\n          >\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div *ngIf=\"calendarType() === 'datetime'\" class=\"time-input\">\n          <mat-form-field class=\"hour-input\" subscriptSizing=\"dynamic\">\n            <mat-label>{{ 'igo.geo.timeFilter.hour' | translate }}</mat-label>\n            <mat-select\n              [formControl]=\"endHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\"\n            >\n              <mat-option *ngFor=\"let hour of endHours\" [value]=\"hour\">{{\n                hour\n              }}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" subscriptSizing=\"dynamic\">\n            <mat-label>{{ 'igo.geo.timeFilter.minute' | translate }}</mat-label>\n            <mat-select\n              [formControl]=\"endMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\"\n            >\n              <mat-option *ngFor=\"let minute of endMinutes\" [value]=\"minute\">{{\n                minute\n              }}</mat-option>\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <div class=\"actions-container\">\n        <button\n          class=\"reset-button\"\n          mat-icon-button\n          color=\"primary\"\n          (click)=\"resetFilter()\"\n          [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\"\n          [disabled]=\"filterStateDisable\"\n        >\n          <mat-icon svgIcon=\"{{ resetIcon }}\"></mat-icon>\n        </button>\n        <mat-slide-toggle\n          class=\"toggle-filter-state\"\n          (change)=\"toggleFilterState()\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n          [checked]=\"!filterStateDisable\"\n        >\n        </mat-slide-toggle>\n      </div>\n    </div>\n  </div>\n</div>\n","import {\n  Component,\n  Input,\n  ViewChild,\n  ElementRef,\n  Output,\n  EventEmitter,\n  OnInit\n} from '@angular/core';\nimport { UntypedFormControl } from '@angular/forms';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\nimport {\n  OgcFilterableDataSourceOptions,\n  OgcFilterableDataSource,\n  OgcFilterDuringOptions\n} from '../shared/ogc-filter.interface';\n\nimport { default as moment } from 'moment';\n\n@Component({\n  selector: 'igo-ogc-filter-time',\n  templateUrl: './ogc-filter-time.component.html',\n  styleUrls: ['./ogc-filter-time.component.scss']\n})\nexport class OgcFilterTimeComponent implements OnInit {\n  @Input() datasource: OgcFilterableDataSource;\n  @Input() currentFilter: any;\n  @Output() changeProperty: EventEmitter<{\n    value: string;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n\n  beginHours: number[];\n  endHours: number[];\n  beginMinutes: number[];\n  endMinutes: number[];\n  beginHourFormControl = new UntypedFormControl();\n  beginMinuteFormControl = new UntypedFormControl();\n  endHourFormControl = new UntypedFormControl();\n  endMinuteFormControl = new UntypedFormControl();\n  _beginValue: Date;\n  _endValue: Date;\n  readonly _defaultMin: string = '1900-01-01';\n  readonly _defaultMax: string = '2052-01-06';\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderModeEnabled: boolean = true;\n  ogcFilterOperator = OgcFilterOperator;\n  public sliderMode = false;\n\n  readonly defaultStepMillisecond = 60000;\n  public options: OgcFilterableDataSourceOptions;\n\n  public onlyYearBegin: number;\n  public onlyYearEnd: number;\n  public calendarTypeYear = false;\n  public resetIcon = 'replay';\n  public filterStateDisable: boolean;\n\n  @ViewChild('endDatepickerTime') endDatepickerTime: ElementRef;\n  @ViewChild('beginDatepickerTime') beginDatepickerTime: ElementRef;\n  @ViewChild('beginTime') beginTime: HTMLInputElement;\n  @ViewChild('endTime') endTime: HTMLInputElement;\n\n  get step(): string {\n    return this.datasource.options.stepDate\n      ? this.datasource.options.stepDate\n      : this.currentFilter.step;\n  }\n\n  get stepMilliseconds(): number {\n    const step = moment.duration(this.step).asMilliseconds();\n    return step === 0 ? this.defaultStepMillisecond : step;\n  }\n\n  set beginValue(begin: Date) {\n    this._beginValue = begin;\n  }\n\n  get beginValue(): Date {\n    return this._beginValue;\n  }\n\n  set endValue(end: Date) {\n    this._endValue = end;\n  }\n\n  get endValue(): Date {\n    return this._endValue;\n  }\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? 2000\n      : this.currentFilter.sliderInterval;\n  }\n\n  get maxDate(): string {\n    return this.datasource.options.maxDate\n      ? this.datasource.options.maxDate\n      : this._defaultMax;\n  }\n\n  get displayFormat(): string {\n    return this.currentFilter.displayFormat\n      ? this.currentFilter.displayFormat\n      : this._defaultDisplayFormat;\n  }\n\n  public filterBeginFunction;\n  public filterEndFunction;\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {}\n\n  ngOnInit() {\n    if (this.currentFilter.sliderOptions) {\n      this.currentFilter.sliderOptions.enabled =\n        this.currentFilter.sliderOptions.enabled !== undefined\n          ? this.currentFilter.sliderOptions.enabled\n          : this._defaultSliderModeEnabled;\n    }\n    this.beginValue = this.parseFilter(this.handleMin());\n    this.endValue = this.parseFilter(this.handleMax());\n\n    this.onlyYearBegin = this.beginValue.getUTCFullYear();\n    this.onlyYearEnd = this.endValue.getUTCFullYear();\n    this.calendarTypeYear = this.isCalendarYearMode();\n    this.setFilterStateDisable();\n    this.updateHoursMinutesArray();\n    // update value for now value\n    this.updateValues();\n    this.dateFilter(this.filterBeginFunction, 'begin');\n    this.dateFilter(this.filterEndFunction, 'end');\n  }\n\n  parseFilter(filter): Date {\n    if (!filter) {\n      return new Date();\n    } else if (isNaN(new Date(filter).getTime())) {\n      if (filter.search('now') >= 0) {\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if (filter.match(/\\+/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.search('+') + 1, interval.index),\n            10\n          );\n          return moment().add(intervalInt, interval[0]).toDate();\n        }\n        if (filter.match(/\\-/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.search('-') + 1, interval.index),\n            10\n          );\n          return moment().subtract(intervalInt, interval[0]).toDate();\n        }\n        return new Date();\n      }\n      if (filter.search('today') >= 0) {\n        const _now = moment().endOf('day').toDate();\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if (filter.match(/\\+/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.search('+') + 1, interval.index),\n            10\n          );\n          return moment(_now).add(intervalInt, interval[0]).toDate();\n        }\n        if (filter.match(/\\-/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.search('-') + 1, interval.index),\n            10\n          );\n          return moment(_now).subtract(intervalInt, interval[0]).toDate();\n        }\n        return _now;\n      }\n      return new Date();\n    }\n    if (this.currentFilter.calendarModeYear) {\n      const date = this.getDateFromStringWithoutTime(filter);\n      return date;\n    } else {\n      return filter ? new Date(filter) : new Date();\n    }\n  }\n\n  changeTemporalProperty(value, position?, refreshFilter = true) {\n    let valueTmp = this.getDateTime(value, position);\n    if (this.isCalendarYearMode()) {\n      let dateStringFromYearNotime;\n      if (position === 1) {\n        this.beginValue = value;\n        this.onlyYearBegin = this.beginValue.getFullYear();\n        dateStringFromYearNotime = `${this.onlyYearBegin}-01-01`;\n      } else {\n        this.endValue = value;\n        this.onlyYearEnd = this.endValue.getFullYear();\n        dateStringFromYearNotime = `${this.onlyYearEnd}-01-01`;\n      }\n      // call service with string date without time\n      this.changeProperty.next({\n        value: dateStringFromYearNotime,\n        pos: position,\n        refreshFilter\n      });\n      return;\n    }\n    if (position === 2 && this.calendarType() === 'date' && !this.sliderMode) {\n      /* Above month: see yearSelected or monthSelected */\n      valueTmp = moment(valueTmp).endOf('day').toDate();\n    }\n\n    if (position === 1) {\n      this.beginValue = valueTmp;\n      if (this.restrictedToStep()) {\n        this.changeTemporalProperty(\n          this.ogcFilterTimeService.addStep(valueTmp, this.stepMilliseconds),\n          2,\n          refreshFilter\n        );\n      }\n    } else {\n      this.endValue = valueTmp;\n    }\n    this.updateHoursMinutesArray();\n    this.changeProperty.next({\n      value: valueTmp.toISOString(),\n      pos: position,\n      refreshFilter\n    });\n  }\n\n  handleDate(value): Date {\n    if (!value || value === '') {\n      return undefined;\n    }\n    if (typeof value === 'string' && this.currentFilter.calendarModeYear) {\n      return this.getDateFromStringWithoutTime(value);\n    }\n    return new Date(value);\n  }\n\n  calendarType() {\n    if (this.currentFilter.calendarModeYear) {\n      return 'year';\n    }\n    if (this.stepMilliseconds < 86400000) {\n      return 'datetime';\n    }\n    return 'date';\n  }\n\n  isCalendarYearMode(): boolean {\n    if (this.calendarType() === 'year') {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  yearOnlyInputChange(changeEvent, datePicker?: any, property?: string) {\n    const year = changeEvent.target.value;\n    const date = this.getDateFromStringWithoutTime(year);\n    this.yearSelected(date, datePicker, property);\n  }\n\n  yearSelected(\n    year,\n    datePicker?: any,\n    property?: string,\n    refreshFilter = true\n  ) {\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        // change value 01 jan to 31 dec same year\n        year = moment(year).endOf('year').toDate();\n      } else if (\n        property === 'begin' &&\n        this.restrictedToStep() &&\n        !this.calendarTypeYear\n      ) {\n        this.yearSelected(year, undefined, 'end');\n      }\n      this.changeTemporalProperty(\n        year,\n        property === 'begin' ? 1 : 2,\n        refreshFilter\n      );\n    }\n  }\n\n  monthSelected(\n    month,\n    datePicker?: any,\n    property?: string,\n    refreshFilter = true\n  ) {\n    if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        month = moment(month).endOf('month').toDate();\n      } else if (property === 'begin' && this.restrictedToStep()) {\n        this.monthSelected(month, undefined, 'end');\n      }\n      this.changeTemporalProperty(\n        month,\n        property === 'begin' ? 1 : 2,\n        refreshFilter\n      );\n    }\n  }\n\n  calendarView() {\n    const test = this.stepMilliseconds;\n    const diff = Math.abs(\n      this.parseFilter(this.currentFilter.end).getTime() -\n        this.parseFilter(this.currentFilter.begin).getTime()\n    );\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      return 'multi-year';\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      return 'year';\n    } else if (test < 86400000 && diff < 86400000) {\n      return 'clock';\n    } else {\n      return 'month';\n    }\n  }\n\n  dateFilter(type: string, date: string) {\n    const dateValue = new Date(date);\n    const diff = dateValue.getTime() - new Date(this.handleMin()).getTime();\n\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(\n        moment(this.handleMin()),\n        'years',\n        true\n      );\n      if (type === 'end') {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(\n          moment(this.handleMin()),\n          'years',\n          true\n        );\n        this.filterEndFunction =\n          monthDiffPlus1 % moment.duration(this.step).asYears() === 0;\n        return;\n      } else if (type === 'begin') {\n        this.filterBeginFunction =\n          monthDiff % moment.duration(this.step).asYears() === 0;\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(\n        moment(this.handleMin()),\n        'months',\n        true\n      );\n      if (type === 'end') {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(\n          moment(this.handleMin()),\n          'months',\n          true\n        );\n        this.filterEndFunction =\n          monthDiffPlus1 % moment.duration(this.step).asMonths() === 0;\n        return;\n      } else if (type === 'begin') {\n        this.filterBeginFunction =\n          monthDiff % moment.duration(this.step).asMonths() === 0;\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsWeekDuration(this.step)) {\n      const weekDiff = moment(dateValue).diff(\n        moment(this.handleMin()),\n        'weeks',\n        true\n      );\n      if (type === 'end') {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const weekDiffPlus1 = moment(dateValuePlus1).diff(\n          moment(this.handleMin()),\n          'weeks',\n          true\n        );\n        this.filterEndFunction =\n          weekDiffPlus1 % moment.duration(this.step).asWeeks() === 0;\n        return;\n      } else if (type === 'begin') {\n        this.filterBeginFunction =\n          weekDiff % moment.duration(this.step).asWeeks() === 0;\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsDayDuration(this.step)) {\n      const dayDiff = moment(dateValue).diff(\n        moment(this.handleMin()),\n        'days',\n        true\n      );\n      if (type === 'end') {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const dayDiffPlus1 = moment(dateValuePlus1).diff(\n          moment(this.handleMin()),\n          'days',\n          true\n        );\n        const _mod = dayDiffPlus1 % moment.duration(this.step).asDays();\n        this.filterEndFunction =\n          (_mod < 0.0000001 && _mod > -0.0000001) || _mod === 0; // 1 millisecond = 1.1574074074074076e-8\n        return;\n      } else if (type === 'begin') {\n        const _mod = (dayDiff % moment.duration(this.step).asDays()) + 1;\n        this.filterBeginFunction =\n          (_mod < 0.0000001 && _mod > -0.0000001 && _mod !== 0) || _mod === 1; // 1 millisecond = 1.1574074074074076e-8\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      if (type === 'end') {\n        const hourDiff = moment(dateValue).diff(\n          moment(this.handleMin()),\n          'hours',\n          true\n        );\n        this.filterEndFunction =\n          hourDiff % moment.duration(this.step).asHours() === 0;\n        return;\n      } else if (type === 'begin') {\n        const hourDiff = moment(dateValue).diff(\n          moment(this.handleMin()),\n          'hours',\n          true\n        );\n        this.filterBeginFunction =\n          hourDiff % moment.duration(this.step).asHours() === 0;\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\n      if (type === 'end') {\n        this.filterEndFunction = true;\n        return;\n      } else if (type === 'begin') {\n        this.filterBeginFunction = true;\n        return;\n      }\n    }\n\n    this.filterEndFunction = diff % this.stepMilliseconds === 0;\n    this.filterBeginFunction = diff % this.stepMilliseconds === 0;\n    return;\n  }\n\n  getDateTime(date, pos) {\n    const valuetmp = new Date(date);\n    let valuetmp2;\n    if (!this.sliderMode) {\n      switch (pos) {\n        case 1: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n              this.beginHourFormControl.value,\n              this.beginMinuteFormControl.value\n            );\n            break;\n          }\n        }\n        case 2: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n              this.endHourFormControl.value,\n              this.endMinuteFormControl.value\n            );\n            break;\n          }\n        }\n      }\n    }\n    return new Date(valuetmp2 ? valuetmp2 : valuetmp);\n  }\n\n  handleMinuteIncrement() {\n    if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\n      if (this.stepMilliseconds < 3600000) {\n        return this.stepMilliseconds / 1000 === 60\n          ? 1\n          : this.stepMilliseconds / 1000;\n      } else {\n        return (this.stepMilliseconds % 3600000) / 60;\n      }\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return 60;\n    }\n    return 1;\n  }\n\n  handleHourIncrement() {\n    if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return this.stepMilliseconds / 1000 / 60 / 60;\n    }\n    return 1;\n  }\n\n  fullBeginHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginHours = Array.from(\n        {\n          length:\n            (this.endHourFormControl.value - 0) / this.handleHourIncrement() + 1\n        },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    } else {\n      this.beginHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.beginHourFormControl.setValue(this.beginValue.getHours());\n  }\n\n  fullEndHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endHours = Array.from(\n        {\n          length:\n            (23 - this.beginHourFormControl.value) /\n              this.handleHourIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginHourFormControl.value + i * this.handleHourIncrement()\n      );\n    } else {\n      this.endHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.endHourFormControl.setValue(this.endValue.getHours());\n  }\n\n  fullBeginMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginMinutes = Array.from(\n        {\n          length:\n            (this.endMinuteFormControl.value - 0) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.beginMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.beginMinuteFormControl.setValue(this.beginValue.getMinutes());\n  }\n\n  fullEndMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endMinutes = Array.from(\n        {\n          length:\n            (59 - this.beginMinuteFormControl.value) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginMinuteFormControl.value + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.endMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.endMinuteFormControl.setValue(this.endValue.getMinutes());\n  }\n\n  updateHoursMinutesArray() {\n    const beginTmp = new Date(this.beginValue);\n    const endTmp = new Date(this.endValue);\n    if (beginTmp.setHours(0, 0) === endTmp.setHours(0, 0)) {\n      this.fullBeginHoursArray(true);\n      this.fullEndHoursArray(true);\n      if (this.beginValue.getHours() === this.endValue.getHours()) {\n        this.fullBeginMinutesArray(true);\n        this.fullEndMinutesArray(true);\n      }\n    } else {\n      this.fullBeginHoursArray();\n      this.fullEndHoursArray();\n      this.fullBeginMinutesArray();\n      this.fullEndMinutesArray();\n    }\n  }\n\n  private updateValues() {\n    this.changeTemporalProperty(this.beginValue, 1, false);\n    this.changeTemporalProperty(this.endValue, 2, true);\n  }\n\n  public restrictedToStep(): boolean {\n    return this.currentFilter.restrictToStep\n      ? this.currentFilter.restrictToStep\n      : false;\n  }\n\n  public handleMin() {\n    return this.currentFilter.begin\n      ? this.currentFilter.begin\n      : this.datasource.options.minDate\n      ? this.datasource.options.minDate\n      : this._defaultMin;\n  }\n\n  public handleMax() {\n    return this.currentFilter.end\n      ? this.currentFilter.end\n      : this.datasource.options.maxDate\n      ? this.datasource.options.maxDate\n      : this._defaultMax;\n  }\n\n  changePropertyByPass(event) {\n    this.changeProperty.next(event);\n  }\n\n  modeChange(event) {\n    if (!event.checked) {\n      this.updateValues();\n    }\n  }\n\n  setFilterStateDisable() {\n    if (this.currentFilter) {\n      this.filterStateDisable = !this.currentFilter.active;\n    } else {\n      this.filterStateDisable = false;\n    }\n    if (this.calendarType() === 'datetime') {\n      if (this.filterStateDisable === true) {\n        this.beginHourFormControl.disable();\n        this.beginMinuteFormControl.disable();\n        this.endHourFormControl.disable();\n        this.endMinuteFormControl.disable();\n      } else {\n        this.beginHourFormControl.enable();\n        this.beginMinuteFormControl.enable();\n        this.endHourFormControl.enable();\n        this.endMinuteFormControl.enable();\n      }\n    }\n  }\n  getDateFromStringWithoutTime(stringDate: string): Date {\n    // warning create date with no time make a date UTC with TZ and the date create maybe not the same year, month and day\n    // exemple:\n    // new Date('2022-01-01') -> Fri Dec 31 2021 19:00:00 GMT-0500 (heure normale de l’Est nord-américain)\n    // to create same date as string, add time 00 in the creation\n    // new Date('2022-01-01 00:00:00') -> Sat Jan 01 2022 00:00:00 GMT-0500 (heure normale de l’Est nord-américain)\n    let year;\n    let month = '01';\n    let day = '01';\n    if (stringDate.length === 10) {\n      const dateItems = stringDate.split('-');\n      if (dateItems.length !== 3) {\n        throw new Error(\n          'Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY'\n        );\n      } else {\n        year = dateItems[0];\n        month = dateItems[1];\n        day = dateItems[2];\n      }\n    } else if (stringDate.length === 4) {\n      year = stringDate;\n    } else {\n      return new Date(stringDate);\n    }\n    return new Date(`${year}-${month}-${day} 00:00:00`);\n  }\n\n  resetFilter() {\n    let filterOriginConfig = this.datasource.options.ogcFilters\n      .filters as OgcFilterDuringOptions;\n\n    let minDefaultDate;\n    let maxDefaultDate;\n    let minDefaultISOString;\n    let maxDefaultISOString;\n\n    if (this.calendarTypeYear) {\n      if (filterOriginConfig.end === 'today') {\n        let todayDateStringNoTime = new Date().toLocaleDateString('en-CA'); // '2022-02-13'\n        maxDefaultISOString = `${todayDateStringNoTime.substring(0, 4)}-01-01`;\n      } else {\n        maxDefaultISOString = `${filterOriginConfig.end.substring(0, 4)}-01-01`;\n      }\n      minDefaultISOString = `${filterOriginConfig.begin.substring(0, 4)}-01-01`;\n      minDefaultDate = this.getDateFromStringWithoutTime(minDefaultISOString);\n      maxDefaultDate = this.getDateFromStringWithoutTime(maxDefaultISOString);\n    } else {\n      minDefaultDate = this.parseFilter(filterOriginConfig.begin);\n      maxDefaultDate = this.parseFilter(filterOriginConfig.end);\n      minDefaultISOString = minDefaultDate.toISOString();\n      maxDefaultISOString = maxDefaultDate.toISOString();\n    }\n\n    if (\n      this.currentFilter.begin !== minDefaultISOString ||\n      this.currentFilter.end !== maxDefaultISOString\n    ) {\n      this.beginValue = minDefaultDate;\n      this.endValue = maxDefaultDate;\n      this.updateValues();\n    }\n  }\n\n  toggleFilterState() {\n    if (this.currentFilter.active === true) {\n      this.currentFilter.active = false;\n    } else {\n      this.currentFilter.active = true;\n    }\n    this.setFilterStateDisable();\n    this.updateValues();\n  }\n}\n","import {\n  Component,\n  Input,\n  ViewChild,\n  Output,\n  EventEmitter,\n  OnInit\n} from '@angular/core';\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\n\nimport { default as moment } from 'moment';\nimport { MatSlider } from '@angular/material/slider';\n\n@Component({\n  selector: 'igo-ogc-filter-time-slider',\n  templateUrl: './ogc-filter-time-slider.component.html',\n  styleUrls: ['./ogc-filter-time-slider.component.scss']\n})\nexport class OgcFilterTimeSliderComponent implements OnInit {\n  @Input() currentFilter: any;\n  @Input() begin: any;\n  @Input() max: any;\n  @Input() datasource: any;\n  @Output() changeProperty: EventEmitter<{\n    value: any;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n  @ViewChild(MatSlider) slider: MatSlider;\n\n  interval;\n  sliderValue: number = 1;\n  calculatedStep: number = 0;\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderInterval: number = 2000;\n  public playIcon = 'play-circle';\n  public resetIcon = 'replay';\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? this._defaultSliderInterval\n      : this.currentFilter.sliderInterval;\n  }\n\n  get displayFormat(): string {\n    if (this.currentFilter.sliderOptions?.displayFormat) {\n      return this.currentFilter.sliderOptions.displayFormat;\n    }\n    if (this.currentFilter.displayFormat) {\n      return this.currentFilter.displayFormat;\n    }\n    return this._defaultDisplayFormat;\n  }\n\n  get beginMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.begin);\n  }\n\n  get maxMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.max);\n  }\n\n  get stepMillisecond(): number {\n    return this.ogcFilterTimeService.stepMillisecond(\n      this.datasource,\n      this.currentFilter\n    );\n  }\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {\n    this.sliderDisplayWith = this.sliderDisplayWith.bind(this);\n  }\n\n  ngOnInit() {\n    this.calculateStep();\n    this.handleSliderInput({ value: 1 });\n  }\n\n  sliderDisplayWith(value) {\n    let dateTmp = new Date(\n      this.beginMillisecond + (value - 1) * this.stepMillisecond\n    );\n\n    if (\n      this.ogcFilterTimeService.stepIsYearDuration(\n        this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n      )\n    ) {\n      const toAdd = moment\n        .duration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        )\n        .years();\n      dateTmp = moment(this.beginMillisecond)\n        .add((value - 1) * toAdd, 'year')\n        .toDate();\n    } else if (\n      this.ogcFilterTimeService.stepIsMonthDuration(\n        this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n      )\n    ) {\n      const toAdd = moment\n        .duration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        )\n        .months();\n      dateTmp = moment(this.beginMillisecond)\n        .add((value - 1) * toAdd, 'month')\n        .toDate();\n    }\n\n    return moment(dateTmp).format(this.displayFormat);\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(\n        (that) => {\n          if (this.slider.step < this.calculatedStep) {\n            const _increment = '_increment';\n            const _emitInputEvent = '_emitInputEvent';\n            this.slider[_increment](1);\n            this.slider[_emitInputEvent]();\n          } else {\n            this.stopFilter();\n          }\n        },\n        this.sliderInterval,\n        this\n      );\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n  }\n\n  resetFilter(event: any) {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n    this.slider.step = 1;\n    const _increment = '_increment';\n    const _emitInputEvent = '_emitInputEvent';\n    this.slider[_emitInputEvent]();\n  }\n\n  handleSliderInput(matSliderChange) {\n    if (matSliderChange) {\n      if (\n        this.ogcFilterTimeService.stepIsYearDuration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        )\n      ) {\n        const toAdd = moment\n          .duration(\n            this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n          )\n          .years();\n        const dateBeginTmp = moment(this.beginMillisecond)\n          .add((matSliderChange.value - 1) * toAdd, 'year')\n          .toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'year').toDate();\n        this.changeProperty.next({\n          value: moment(dateBeginTmp).toDate().toISOString(),\n          pos: 1,\n          refreshFilter: false\n        });\n        this.changeProperty.next({\n          value: moment(dateEndTmp).toDate().toISOString(),\n          pos: 2,\n          refreshFilter: true\n        });\n      } else if (\n        this.ogcFilterTimeService.stepIsMonthDuration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        )\n      ) {\n        const toAdd = moment\n          .duration(\n            this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n          )\n          .months();\n        const dateBeginTmp = moment(this.beginMillisecond)\n          .add((matSliderChange.value - 1) * toAdd, 'month')\n          .toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'month').toDate();\n        this.changeProperty.next({\n          value: moment(dateBeginTmp).startOf('month').toDate().toISOString(),\n          pos: 1,\n          refreshFilter: false\n        });\n        this.changeProperty.next({\n          value: moment(dateEndTmp).toDate().toISOString(),\n          pos: 2,\n          refreshFilter: true\n        });\n      } else if (\n        this.ogcFilterTimeService.stepIsDayDuration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        ) ||\n        this.ogcFilterTimeService.stepIsHourDuration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        ) ||\n        this.ogcFilterTimeService.stepIsMinuteDuration(\n          this.ogcFilterTimeService.step(this.datasource, this.currentFilter)\n        )\n      ) {\n        const dateTmp = new Date(\n          this.beginMillisecond +\n            this.stepMillisecond * (matSliderChange.value - 1)\n        );\n        this.changeProperty.next({\n          value: dateTmp.toISOString(),\n          pos: 1,\n          refreshFilter: false\n        });\n        this.changeProperty.next({\n          value: new Date(\n            this.ogcFilterTimeService.addStep(\n              dateTmp.toISOString(),\n              this.stepMillisecond\n            )\n          ).toISOString(),\n          pos: 2,\n          refreshFilter: true\n        });\n      }\n    }\n  }\n\n  calculateStep() {\n    for (\n      let i = 1;\n      this.maxMillisecond -\n        (this.beginMillisecond + i * this.stepMillisecond) >=\n      -1;\n      i++\n    ) {\n      this.calculatedStep = i;\n    }\n  }\n}\n","<div class=\"slider-container\">\n  <mat-slider\n    id=\"time-slider\"\n    [step]=\"1\"\n    [min]=\"1\"\n    [max]=\"calculatedStep\"\n    [(ngModel)]=\"sliderValue\"\n    [displayWith]=\"sliderDisplayWith\"\n    thumbLabel\n    #ngSlider\n    ><input\n      matSliderThumb\n      (input)=\"\n        handleSliderInput({\n          source: ngSliderThumb,\n          parent: ngSlider,\n          value: ngSliderThumb.value\n        })\n      \"\n      #ngSliderThumb=\"matSliderThumb\"\n    />\n  </mat-slider>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n    <mat-icon [svgIcon]=\"playIcon\"></mat-icon>\n  </button>\n  <button mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\n    <mat-icon svgIcon=\"{{ resetIcon }}\"></mat-icon>\n  </button>\n</div>\n","import { DrawControlOptions } from './../shared/controls/draw';\nimport {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  Optional,\n  Self,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { NgControl, ControlValueAccessor } from '@angular/forms';\n\nimport { Subscription } from 'rxjs';\n\nimport * as OlStyle from 'ol/style';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlGeometry from 'ol/geom/Geometry';\nimport type { Type } from 'ol/geom/Geometry';\nimport OlFeature from 'ol/Feature';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlOverlay from 'ol/Overlay';\nimport * as olproj from 'ol/proj';\nimport Point from 'ol/geom/Point';\n\nimport { IgoMap } from '../../map/shared';\nimport {\n  MeasureLengthUnit,\n  updateOlGeometryMidpoints,\n  formatMeasure,\n  measureOlGeometry\n} from '../../measure';\nimport {\n  DrawControl,\n  ModifyControl,\n  ModifyControlOptions\n} from '../shared/controls';\nimport { createDrawInteractionStyle } from '../shared/geometry.utils';\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\n\ninterface HasRadius {\n  getRadius: () => number;\n  setRadius: (radius: number) => void;\n}\n\n/**\n * This input allows a user to draw a new geometry or to edit\n * an existing one on a map. A text input is also displayed in the\n * form with some instructions.\n * This is still WIP.\n */\n@Component({\n  selector: 'igo-geometry-form-field-input',\n  templateUrl: './geometry-form-field-input.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class GeometryFormFieldInputComponent\n  implements OnInit, OnDestroy, ControlValueAccessor\n{\n  private olOverlayLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  private olGeoJSON = new OlGeoJSON();\n  private ready = false;\n\n  private drawControl: DrawControl;\n  private modifyControl: ModifyControl;\n  private defaultDrawStyleRadius: number;\n  private olGeometryEnds$$: Subscription;\n  private olGeometryChanges$$: Subscription;\n  private olTooltip = this.createMeasureTooltip();\n\n  /**\n   * Active control\n   * @internal\n   */\n  public activeControl: DrawControl | ModifyControl;\n\n  /**\n   * The map to draw the geometry on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The geometry type\n   */\n  @Input()\n  set geometryType(value: Type) {\n    this._geometryType = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get geometryType(): Type {\n    return this._geometryType;\n  }\n  private _geometryType: Type;\n\n  /**\n   * The drawGuide around the mouse pointer to help drawing\n   */\n  @Input() drawGuide: number = null;\n\n  /**\n   * Whether a measure tooltip should be displayed\n   */\n  @Input() measure: boolean = false;\n\n  /**\n   * Whether draw control should be active or not\n   */\n  @Input()\n  get drawControlIsActive(): boolean {\n    return this._drawControlIsActive;\n  }\n  set drawControlIsActive(value: boolean) {\n    this._drawControlIsActive = value;\n    if (this.ready === false) {\n      return;\n    }\n    this.deactivateControl();\n    if (!this._drawControlIsActive) {\n      return;\n    } else {\n      this.toggleControl();\n    }\n  }\n  private _drawControlIsActive: boolean = true;\n\n  /**\n   * Whether freehand draw control should be active or not\n   */\n  @Input()\n  get freehandDrawIsActive(): boolean {\n    return this._freehandDrawIsActive;\n  }\n  set freehandDrawIsActive(value: boolean) {\n    this._freehandDrawIsActive = value;\n    this.deactivateControl();\n\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n\n    if (this.ready === false) {\n      return;\n    }\n\n    if (!this.drawControlIsActive) {\n      return;\n    }\n    this.toggleControl();\n  }\n  private _freehandDrawIsActive: boolean;\n\n  /**\n   * Whether freehand draw control should be active or not\n   */\n  @Input()\n  get predefinedRadius(): boolean {\n    return this._predefinedRadius;\n  }\n  set predefinedRadius(value: boolean) {\n    this._predefinedRadius = value;\n    this.drawControl.ispredefinedRadius$.next(value);\n  }\n  private _predefinedRadius: boolean;\n\n  /**\n   * Control options\n   */\n  @Input() controlOptions: { [key: string]: any } = {};\n\n  /**\n   * Style for the draw control (applies while the geometry is being drawn)\n   */\n  @Input()\n  set drawStyle(value: OlStyleLike | OlStyle.RegularShape) {\n    if (value === undefined) {\n      value = createDrawInteractionStyle();\n    }\n    this._drawStyle = value;\n\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(value);\n    if (olGuideStyle !== undefined) {\n      this.defaultDrawStyleRadius = olGuideStyle.getRadius();\n    } else {\n      this.defaultDrawStyleRadius = null;\n    }\n\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get drawStyle(): OlStyleLike | OlStyle.RegularShape {\n    return this._drawStyle;\n  }\n  private _drawStyle: OlStyleLike | OlStyle.RegularShape;\n\n  /**\n   * Style for the overlay layer (applies once the geometry is added to the map)\n   * If not specified, drawStyle applies\n   */\n  @Input()\n  set overlayStyle(value: OlStyleLike | OlStyle.RegularShape) {\n    this._overlayStyle = value;\n  }\n  get overlayStyle(): OlStyleLike | OlStyle.RegularShape {\n    return this._overlayStyle;\n  }\n  private _overlayStyle: OlStyleLike | OlStyle.RegularShape;\n\n  /**\n   * The geometry value (GeoJSON)\n   * Implemented as part of ControlValueAccessor.\n   */\n  @Input()\n  set value(value: GeoJSONGeometry) {\n    this._value = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    if (value) {\n      this.addGeoJSONToOverlay(value);\n    } else {\n      this.olOverlaySource.clear(true);\n    }\n    this.onChange(value);\n    this.toggleControl();\n    this.cdRef.detectChanges();\n  }\n  get value(): GeoJSONGeometry {\n    return this._value;\n  }\n  private _value: GeoJSONGeometry;\n\n  /**\n   * The vector source to add the geometry to\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<OlGeometry> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  @Input()\n  set radius(value: any) {\n    if (this.ready === false) {\n      return;\n    }\n    if (this.modifyControl.getSource()) {\n      this.modifyControl.getSource().refresh();\n    }\n    if (this.freehandDrawIsActive) {\n      let olModify;\n      setTimeout(() => {\n        olModify = this.modifyControl.olModifyInteraction;\n        if (olModify) {\n          if (olModify.features_) {\n            olModify.features_.clear();\n            this.addGeoJSONToOverlay(this.value);\n          }\n        }\n      }, 0);\n    }\n  }\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    @Optional() @Self() public ngControl: NgControl\n  ) {\n    if (this.ngControl !== undefined) {\n      // Setting the value accessor directly (instead of using\n      // the providers) to avoid running into a circular import.\n      this.ngControl.valueAccessor = this;\n    }\n  }\n\n  /**\n   * Create an overlay layer, add the initial geometry to it (if any)\n   * and toggle the right interaction.\n   * @internal\n   */\n  ngOnInit() {\n    if (this.drawStyle === undefined) {\n      this.drawStyle = createDrawInteractionStyle();\n    }\n\n    if (this.overlayStyle === undefined) {\n      this.overlayStyle = this.drawStyle;\n    }\n\n    this.addOlOverlayLayer();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    if (this.value) {\n      this.addGeoJSONToOverlay(this.value);\n    }\n    this.toggleControl();\n\n    this.ready = true;\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    // This is mandatory when the form control is reused after\n    // this component has been destroyed. It seems like the control\n    // keeps a reference to this component even after it's destroyed\n    // and it attempts to set it's value\n    this.ready = false;\n\n    this.deactivateControl();\n    this.olOverlaySource.clear();\n    this.map.ol.removeLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  registerOnChange(fn: Function) {\n    this.onChange = fn;\n  }\n  private onChange: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  registerOnTouched(fn: Function) {\n    this.onTouched = fn;\n  }\n  private onTouched: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  writeValue(value: GeoJSONGeometry) {\n    this.value = value;\n  }\n\n  /**\n   * Add an overlay layer to the map\n   */\n  private addOlOverlayLayer() {\n    this.olOverlayLayer = new OlVectorLayer({\n      source: new OlVectorSource(),\n      zIndex: 500,\n      style: null\n    });\n    this.map.ol.addLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Create a draw control and subscribe to it's geometry\n   */\n  private createDrawControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      geometryType: this.geometryType || 'Point',\n      drawingLayer: this.olOverlayLayer,\n      interactionStyle:\n        typeof this.drawStyle === 'function'\n          ? this.drawStyle\n          : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n              const style = this.drawStyle;\n              this.updateDrawStyleWithDrawGuide(style, resolution);\n              return style;\n            }\n    }) as DrawControlOptions;\n    this.drawControl = new DrawControl(controlOptions);\n  }\n\n  /**\n   * Create a modify control and subscribe to it's geometry\n   */\n  private createModifyControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      layer: this.olOverlayLayer,\n      drawStyle:\n        typeof this.drawStyle === 'function'\n          ? this.drawStyle\n          : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n              const style = this.drawStyle;\n              this.updateDrawStyleWithDrawGuide(style, resolution);\n              return style;\n            }\n    }) as ModifyControlOptions;\n    this.modifyControl = new ModifyControl(controlOptions);\n  }\n\n  /**\n   * Toggle the proper control (draw or modify)\n   */\n  private toggleControl() {\n    let activate;\n    if (!this.value && this.geometryType) {\n      activate = this.drawControl;\n    } else {\n      activate = this.modifyControl;\n    }\n\n    // If the control that should be activated\n    // is not the same as the current active control,\n    // deactivate the current control and activate the new one\n    // Otherwise, do nothing and keep the current control active\n    if (activate !== this.activeControl) {\n      this.deactivateControl();\n      this.activateControl(activate);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param control Control\n   */\n  private activateControl(control: DrawControl | ModifyControl) {\n    this.activeControl = control;\n    this.olGeometryEnds$$ = control.end$.subscribe((olGeometry: OlGeometry) =>\n      this.onOlGeometryEnds(olGeometry)\n    );\n    if (this.measure === true && control === this.drawControl) {\n      this.olGeometryChanges$$ = control.changes$.subscribe(\n        (olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) =>\n          this.onOlGeometryChanges(olGeometry)\n      );\n    }\n    control.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active control\n   */\n  private deactivateControl() {\n    this.removeMeasureTooltip();\n    if (this.activeControl !== undefined) {\n      this.activeControl.setOlMap(undefined);\n    }\n    if (this.olGeometryEnds$$ !== undefined) {\n      this.olGeometryEnds$$.unsubscribe();\n    }\n    if (this.olGeometryChanges$$ !== undefined) {\n      this.olGeometryChanges$$.unsubscribe();\n    }\n    this.activeControl = undefined;\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryEnds(olGeometry: OlGeometry | undefined) {\n    this.removeMeasureTooltip();\n    this.setOlGeometry(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryChanges(\n    olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle\n  ) {\n    if (olGeometry.getType() !== 'Point') {\n      this.updateMeasureTooltip(olGeometry);\n    }\n  }\n\n  /**\n   * When drawing ends, convert the output value to GeoJSON and keep it.\n   * Restore the double click interaction.\n   * @param olGeometry OL geometry\n   */\n  private setOlGeometry(olGeometry: OlGeometry | undefined) {\n    let value;\n    if (olGeometry === undefined) {\n      return;\n    }\n\n    if (olGeometry.getType() === 'Circle') {\n      // Because Circle doesn't exist as a GeoJSON object\n      olGeometry = this.circleToPoint(olGeometry);\n    }\n\n    value = this.olGeoJSON.writeGeometryObject(olGeometry, {\n      featureProjection: this.map.projection,\n      dataProjection: 'EPSG:4326'\n    });\n    if (olGeometry.get('radius')) {\n      value.radius = olGeometry.get('radius');\n      olGeometry.set('radius', value.radius);\n    }\n    this.writeValue(value);\n  }\n\n  private circleToPoint(olGeometry) {\n    const center = olGeometry.getCenter();\n    const coordinates = olproj.transform(\n      center,\n      this.map.projection,\n      'EPSG:4326'\n    );\n    const radius = Math.round(\n      olGeometry.getRadius() * Math.cos((Math.PI / 180) * coordinates[1])\n    );\n\n    // Convert it to a point object\n    olGeometry = new Point(center);\n    olGeometry.set('radius', radius, true);\n    return olGeometry;\n  }\n\n  /**\n   * Add a GeoJSON geometry to the overlay\n   * @param geometry GeoJSON geometry\n   */\n  private addGeoJSONToOverlay(geometry: GeoJSONGeometry) {\n    const olGeometry = this.olGeoJSON.readGeometry(geometry, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: this.map.projection\n    });\n    const olFeature = new OlFeature({\n      geometry: olGeometry\n    });\n    olFeature.setStyle(this.overlayStyle as OlStyle.Style);\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create the measure tooltip\n   */\n  private createMeasureTooltip() {\n    return new OlOverlay({\n      element: document.createElement('div'),\n      offset: [-30, -10],\n      className: ['igo-map-tooltip', 'igo-map-tooltip-measure'].join(' '),\n      stopEvent: false\n    });\n  }\n\n  /**\n   * Update the measure tooltip of an OL geometry\n   * @param olGeometry OL Geometry\n   */\n  private updateMeasureTooltip(\n    olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle\n  ) {\n    const measure = measureOlGeometry(olGeometry, this.map.projection);\n    const lengths = measure.lengths;\n    const lastIndex =\n      olGeometry.getType() === 'Polygon'\n        ? lengths.length - 2\n        : lengths.length - 1;\n    const lastLength = lengths[lastIndex];\n\n    const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n    const olLastMidpoint = olMidpoints[lastIndex];\n    if (olMidpoints.length === 0 || olLastMidpoint === undefined) {\n      this.removeMeasureTooltip();\n      return;\n    }\n\n    this.olTooltip.setPosition(olLastMidpoint.getFlatCoordinates());\n\n    const innerHtml = formatMeasure(lastLength, {\n      decimal: 1,\n      unit: MeasureLengthUnit.Meters,\n      unitAbbr: true,\n      locale: 'fr'\n    });\n    this.olTooltip.getElement().innerHTML = innerHtml;\n    if (this.olTooltip.getMap() === undefined) {\n      this.map.ol.addOverlay(this.olTooltip);\n    }\n  }\n\n  /**\n   * Remove the measure tooltip from the map\n   */\n  private removeMeasureTooltip() {\n    if (this.olTooltip.getMap && this.olTooltip.getMap() !== undefined) {\n      this.map.ol.removeOverlay(this.olTooltip);\n      this.olTooltip.setMap(undefined);\n    }\n  }\n\n  /**\n   * Adjust the draw style with the specified draw guide distance, if possible\n   * @param olStyle Draw style to update\n   * @param resolution Resolution (to make the screen size of symbol fit the drawGuide value)\n   */\n  private updateDrawStyleWithDrawGuide(\n    olStyle: OlStyleLike | OlStyle.RegularShape,\n    resolution: number\n  ) {\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(olStyle);\n    if (olGuideStyle === undefined) {\n      return;\n    }\n    const drawGuide = this.drawGuide;\n    let radius;\n    if (!drawGuide || drawGuide < 0) {\n      radius = this.defaultDrawStyleRadius;\n    } else {\n      radius = drawGuide > 0 ? drawGuide / resolution : drawGuide;\n    }\n    olGuideStyle.setRadius(radius);\n  }\n\n  /**\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\n   * @param olStyle The style on which to perform the check\n   */\n  private getGuideStyleFromDrawStyle(\n    olStyle: OlStyleLike | OlStyle.RegularShape\n  ): HasRadius | undefined {\n    let baseStyle: unknown;\n    if (Array.isArray(olStyle)) {\n      baseStyle = olStyle[0];\n    } else {\n      baseStyle = olStyle;\n    }\n\n    if (typeof (baseStyle as any).getImage === 'function') {\n      baseStyle = (baseStyle as any).getImage() as OlStyle.Image;\n    }\n\n    let guideStyle: HasRadius;\n    if (typeof (baseStyle as any).setRadius === 'function') {\n      guideStyle = baseStyle as HasRadius;\n    }\n\n    return guideStyle;\n  }\n}\n","<ng-template></ng-template>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatNativeDateModule, MAT_DATE_LOCALE } from '@angular/material/core';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatSliderModule } from '@angular/material/slider';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatTreeModule } from '@angular/material/tree';\n\nimport {\n  MatDatetimepickerModule,\n  MatNativeDatetimeModule\n} from '@mat-datetimepicker/core';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoCollapsibleModule,\n  IgoListModule,\n  IgoKeyValueModule,\n  IgoEntityModule,\n  IgoDOMModule\n} from '@igo2/common';\nimport { IgoGeometryModule } from './../geometry/geometry.module';\n\nimport { FilterableDataSourcePipe } from './shared/filterable-datasource.pipe';\nimport { IgoLayerModule } from '../layer/layer.module';\nimport { TimeFilterButtonComponent } from './time-filter-button/time-filter-button.component';\nimport { TimeFilterFormComponent } from './time-filter-form/time-filter-form.component';\nimport { TimeFilterItemComponent } from './time-filter-item/time-filter-item.component';\nimport { TimeFilterListBindingDirective } from './time-filter-list/time-filter-list-binding.directive';\nimport { TimeFilterListComponent } from './time-filter-list/time-filter-list.component';\nimport { TimeFilterService } from './shared/time-filter.service';\n\nimport { OgcFilterFormComponent } from './ogc-filter-form/ogc-filter-form.component';\nimport { OgcFilterableFormComponent } from './ogc-filterable-form/ogc-filterable-form.component';\nimport { OgcFilterableItemComponent } from './ogc-filterable-item/ogc-filterable-item.component';\nimport { OgcFilterableListBindingDirective } from './ogc-filterable-list/ogc-filterable-list-binding.directive';\nimport { OgcFilterableListComponent } from './ogc-filterable-list/ogc-filterable-list.component';\nimport { OgcFilterButtonComponent } from './ogc-filter-button/ogc-filter-button.component';\nimport { OGCFilterService } from './shared/ogc-filter.service';\nimport { OGCFilterTimeService } from './shared/ogc-filter-time.service';\nimport { OgcFilterSelectionComponent } from './ogc-filter-selection/ogc-filter-selection.component';\n\nimport { SpatialFilterTypeComponent } from './spatial-filter/spatial-filter-type/spatial-filter-type.component';\nimport { SpatialFilterListComponent } from './spatial-filter/spatial-filter-list/spatial-filter-list.component';\nimport { SpatialFilterItemComponent } from './spatial-filter/spatial-filter-item/spatial-filter-item.component';\nimport { SpatialFilterService } from './shared/spatial-filter.service';\nimport { OgcFilterTimeComponent } from './ogc-filter-time/ogc-filter-time.component';\nimport { OgcFilterTimeSliderComponent } from './ogc-filter-time/ogc-filter-time-slider.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatAutocompleteModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTabsModule,\n    MatRadioModule,\n    MatMenuModule,\n    MatTableModule,\n    MatTreeModule,\n    MatButtonToggleModule,\n    MatCheckboxModule,\n    MatSliderModule,\n    MatSlideToggleModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatOptionModule,\n    MatSelectModule,\n    MatListModule,\n    MatTooltipModule,\n    MatDatepickerModule,\n    MatNativeDateModule,\n    MatDatetimepickerModule,\n    MatNativeDatetimeModule,\n    IgoLanguageModule,\n    IgoLayerModule,\n    IgoCollapsibleModule,\n    IgoListModule,\n    IgoEntityModule,\n    IgoDOMModule,\n    IgoKeyValueModule,\n    IgoGeometryModule,\n    MatBadgeModule\n  ],\n  exports: [\n    FilterableDataSourcePipe,\n    TimeFilterButtonComponent,\n    TimeFilterFormComponent,\n    TimeFilterItemComponent,\n    TimeFilterListComponent,\n    TimeFilterListBindingDirective,\n    OgcFilterFormComponent,\n    OgcFilterButtonComponent,\n    OgcFilterSelectionComponent,\n    OgcFilterableFormComponent,\n    OgcFilterableItemComponent,\n    OgcFilterableListComponent,\n    OgcFilterableListBindingDirective,\n    SpatialFilterTypeComponent,\n    SpatialFilterListComponent,\n    SpatialFilterItemComponent,\n    OgcFilterTimeComponent,\n    OgcFilterTimeSliderComponent\n  ],\n  declarations: [\n    FilterableDataSourcePipe,\n    TimeFilterButtonComponent,\n    TimeFilterFormComponent,\n    TimeFilterItemComponent,\n    TimeFilterListComponent,\n    TimeFilterListBindingDirective,\n    OgcFilterFormComponent,\n    OgcFilterButtonComponent,\n    OgcFilterSelectionComponent,\n    OgcFilterableFormComponent,\n    OgcFilterableItemComponent,\n    OgcFilterableListComponent,\n    OgcFilterableListBindingDirective,\n    SpatialFilterTypeComponent,\n    SpatialFilterListComponent,\n    SpatialFilterItemComponent,\n    OgcFilterTimeComponent,\n    OgcFilterTimeSliderComponent\n  ],\n  providers: [\n    TimeFilterService,\n    OGCFilterService,\n    OGCFilterTimeService,\n    SpatialFilterService\n  ]\n})\nexport class IgoFilterModule {\n  static forRoot(): ModuleWithProviders<IgoFilterModule> {\n    return {\n      ngModule: IgoFilterModule,\n      providers: [\n        {\n          provide: MAT_DATE_LOCALE,\n          useValue: 'fr-FR'\n        }\n      ]\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoKeyValueModule,\n  IgoDrapDropModule,\n  IgoSpinnerModule,\n  IgoCustomHtmlModule\n} from '@igo2/common';\n\nimport { ExportButtonComponent } from './export-button/export-button.component';\nimport { ImportExportComponent } from './import-export/import-export.component';\nimport { DropGeoFileDirective } from './shared/drop-geo-file.directive';\n\n@NgModule({\n  imports: [\n    MatIconModule,\n    MatTooltipModule,\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatTabsModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSlideToggleModule,\n    IgoLanguageModule,\n    IgoSpinnerModule,\n    IgoKeyValueModule,\n    IgoDrapDropModule,\n    IgoCustomHtmlModule\n  ],\n  exports: [ImportExportComponent, DropGeoFileDirective, ExportButtonComponent],\n  declarations: [\n    ImportExportComponent,\n    DropGeoFileDirective,\n    ExportButtonComponent\n  ]\n})\nexport class IgoImportExportModule {\n  static forRoot(): ModuleWithProviders<IgoImportExportModule> {\n    return {\n      ngModule: IgoImportExportModule\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoConfirmDialogModule } from '@igo2/common';\nimport { MapBrowserComponent } from './map-browser/map-browser.component';\nimport { ZoomButtonComponent } from './zoom-button/zoom-button.component';\nimport { GeolocateButtonComponent } from './geolocate-button/geolocate-button.component';\nimport { HomeExtentButtonComponent } from './home-extent-button/home-extent-button.component';\nimport { RotationButtonComponent } from './rotation-button/rotation-button.component';\nimport { BaseLayersSwitcherComponent } from './baselayers-switcher/baselayers-switcher.component';\nimport { MiniBaseMapComponent } from './baselayers-switcher/mini-basemap.component';\nimport { MapOfflineDirective } from './shared/mapOffline.directive';\nimport { OfflineButtonComponent } from './offline-button/offline-button.component';\nimport { WakeLockButtonComponent } from './wake-lock-button/wake-lock-button.component';\nimport { PointerPositionDirective } from './shared/map-pointer-position.directive';\nimport { HoverFeatureDirective } from './shared/hover-feature.directive';\nimport { SwipeControlComponent } from './swipe-control/swipe-control.component';\nimport { MapCenterComponent } from './map-center/map-center.component';\nimport { MenuButtonComponent } from './menu-button/menu-button.component';\nimport { InfoSectionComponent } from './info-section/info-section.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoConfirmDialogModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule\n  ],\n  exports: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    GeolocateButtonComponent,\n    HomeExtentButtonComponent,\n    RotationButtonComponent,\n    InfoSectionComponent,\n    BaseLayersSwitcherComponent,\n    MiniBaseMapComponent,\n    MapOfflineDirective,\n    OfflineButtonComponent,\n    WakeLockButtonComponent,\n    PointerPositionDirective,\n    HoverFeatureDirective,\n    SwipeControlComponent,\n    MapCenterComponent,\n    MenuButtonComponent\n  ],\n  declarations: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    GeolocateButtonComponent,\n    HomeExtentButtonComponent,\n    RotationButtonComponent,\n    InfoSectionComponent,\n    BaseLayersSwitcherComponent,\n    MiniBaseMapComponent,\n    MapOfflineDirective,\n    OfflineButtonComponent,\n    WakeLockButtonComponent,\n    PointerPositionDirective,\n    HoverFeatureDirective,\n    SwipeControlComponent,\n    MapCenterComponent,\n    MenuButtonComponent\n  ]\n})\nexport class IgoMapModule {}\n","<mat-form-field class=\"measure-field\" floatLabel=\"always\">\n  <mat-label>{{ placeholder }}</mat-label>\n  <input\n    matInput\n    [disabled]=\"true\"\n    [readonly]=\"true\"\n    [value]=\"(measure$ | async) || 0 | measureFormat: measureUnit\"\n  />\n</mat-form-field>\n<mat-form-field class=\"unit-field\">\n  <mat-select\n    [value]=\"measureUnit\"\n    [disabled]=\"auto\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\"\n  >\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n      {{ 'igo.geo.measure.' + measureUnit | translate }}\n    </mat-option>\n  </mat-select>\n</mat-form-field>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport {\n  MeasureType,\n  MeasureAreaUnit,\n  MeasureLengthUnit\n} from '../shared/measure.enum';\nimport {\n  computeBestAreaUnit,\n  computeBestLengthUnit\n} from '../shared/measure.utils';\n\n/**\n * Measurer item\n */\n@Component({\n  selector: 'igo-measurer-item',\n  templateUrl: './measurer-item.component.html',\n  styleUrls: ['./measurer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MeasurerItemComponent implements OnDestroy {\n  /**\n   * Measure observable\n   * @internal\n   */\n  public measure$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the measure observable when the auto mode is on\n   * @internal\n   */\n  public measure$$: Subscription;\n\n  /**\n   * Measure type\n   */\n  @Input() measureType: MeasureType;\n\n  /**\n   * Measure unit\n   */\n  @Input() measureUnit: MeasureAreaUnit | MeasureLengthUnit;\n\n  /**\n   * Measure\n   */\n  @Input()\n  set measure(value: number) {\n    this.measure$.next(value);\n  }\n  get measure(): number {\n    return this.measure$.value;\n  }\n\n  /**\n   * Whther measure units should be automatically determined\n   */\n  @Input()\n  set auto(value: boolean) {\n    this.toggleAutoUnit(value);\n  }\n  get auto(): boolean {\n    return this._auto;\n  }\n  private _auto: boolean = false;\n\n  /**\n   * Placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Event emitted when the measure unit changes\n   */\n  @Output() measureUnitChange = new EventEmitter<\n    MeasureAreaUnit | MeasureLengthUnit\n  >();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    if (this.measureType === MeasureType.Area) {\n      return Object.values(MeasureAreaUnit);\n    }\n    return Object.values(MeasureLengthUnit);\n  }\n\n  constructor() {}\n\n  /**\n   * Toggle the auto unit off\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toggleAutoUnit(false);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureAreaUnit | MeasureLengthUnit) {\n    this.measureUnit = unit;\n    this.measureUnitChange.emit(unit);\n  }\n\n  private toggleAutoUnit(toggle: boolean) {\n    if (this.measure$$ !== undefined) {\n      this.measure$$.unsubscribe();\n    }\n    if (toggle === true) {\n      this.measure$$ = this.measure$.subscribe((measure: number) => {\n        this.computeBestMeasureUnit(measure);\n      });\n    }\n    this._auto = toggle;\n  }\n\n  private computeBestMeasureUnit(measure: number) {\n    let measureUnit = this.measureUnit;\n    if (this.measureType === MeasureType.Area) {\n      measureUnit = computeBestAreaUnit(measure);\n    } else if (this.measureType === MeasureType.Length) {\n      measureUnit = computeBestLengthUnit(measure);\n    }\n    if (measureUnit !== this.measureUnit) {\n      this.onMeasureUnitChange(measureUnit);\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatDividerModule } from '@angular/material/divider';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoEntityTableModule } from '@igo2/common';\n\nimport { MeasureFormatPipe } from './measure-format.pipe';\nimport { MeasurerItemComponent } from './measurer-item.component';\nimport { MeasurerComponent } from './measurer.component';\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\nimport { MatDialogModule } from '@angular/material/dialog';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatDialogModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    MatSlideToggleModule,\n    MatDividerModule,\n    IgoLanguageModule,\n    IgoEntityTableModule\n  ],\n  declarations: [\n    MeasureFormatPipe,\n    MeasurerItemComponent,\n    MeasurerComponent,\n    MeasurerDialogComponent\n  ],\n  exports: [MeasureFormatPipe, MeasurerComponent]\n})\nexport class IgoMeasurerModule {}\n","import { NgModule } from '@angular/core';\n\nimport { IgoMeasurerModule } from './measurer/measurer.module';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [IgoMeasurerModule]\n})\nexport class IgoMeasureModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule } from '@igo2/common';\n\nimport { PrintComponent } from './print/print.component';\nimport { PrintFormComponent } from './print-form/print-form.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatInputModule,\n    MatFormFieldModule,\n    MatSlideToggleModule,\n    IgoLanguageModule,\n    IgoKeyValueModule\n  ],\n  exports: [PrintComponent, PrintFormComponent],\n  declarations: [PrintComponent, PrintFormComponent]\n})\nexport class IgoPrintModule {}\n","import { ConfigService } from '@igo2/core';\n\nimport { SearchSource } from '../../search/shared/sources/source';\n\nimport { QuerySearchSource } from './query-search-source';\n\n/**\n * Map search source factory\n * @ignore\n */\nexport function querySearchSourceFactory(config: ConfigService) {\n  return new QuerySearchSource(\n    config.getConfig(`searchSources.${QuerySearchSource.id}`) || {}\n  );\n}\n\n/**\n * Function that returns a provider for the map search source\n */\nexport function provideQuerySearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: querySearchSourceFactory,\n    multi: true,\n    deps: [ConfigService]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoLanguageModule, IgoMessageModule } from '@igo2/core';\n\nimport { QueryDirective } from './shared/query.directive';\nimport { QueryService } from './shared/query.service';\nimport { provideQuerySearchSource } from './shared/query-search-source.providers';\n\n@NgModule({\n  imports: [CommonModule, IgoLanguageModule, IgoMessageModule],\n  exports: [QueryDirective],\n  declarations: [QueryDirective],\n  providers: [QueryService]\n})\nexport class IgoQueryModule {\n  static forRoot(): ModuleWithProviders<IgoQueryModule> {\n    return {\n      ngModule: IgoQueryModule,\n      providers: [provideQuerySearchSource()]\n    };\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\n\nexport abstract class DirectionsSource {\n  abstract enabled: boolean;\n  abstract getName(): string;\n  abstract route(\n    coordinates: [number, number][],\n    directionsOptions: DirectionOptions\n  ): Observable<Direction[]>;\n}\n","import { DirectionsSource } from '../directions-sources/directions-source';\n\nexport class DirectionsSourceService {\n  constructor(public sources: DirectionsSource[]) {}\n}\n\nexport function directionsSourceServiceFactory(sources: DirectionsSource[]) {\n  return new DirectionsSourceService(sources);\n}\n\nexport function provideDirectionsSourceService() {\n  return {\n    provide: DirectionsSourceService,\n    useFactory: directionsSourceServiceFactory,\n    deps: [DirectionsSource]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatOptionModule } from '@angular/material/core';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatListModule } from '@angular/material/list';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { provideDirectionsSourceService } from './shared/directions-source.service';\r\nimport { DragDropModule } from '@angular/cdk/drag-drop';\r\nimport { DirectionsInputsComponent } from './directions-inputs/directions-inputs.component';\r\nimport { DirectionsComponent } from './directions.component';\r\nimport { DirectionsButtonsComponent } from './directions-buttons/directions-buttons.component';\r\nimport { DirectionsResultsComponent } from './directions-results/directions-results.component';\r\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    DragDropModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatListModule,\r\n    MatDividerModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatOptionModule,\r\n    MatSelectModule,\r\n    MatSlideToggleModule,\r\n    MatTooltipModule,\r\n    MatAutocompleteModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [\r\n    DirectionsComponent,\r\n    DirectionsInputsComponent,\r\n    DirectionsButtonsComponent,\r\n    DirectionsResultsComponent\r\n  ],\r\n  declarations: [\r\n    DirectionsComponent,\r\n    DirectionsInputsComponent,\r\n    DirectionsButtonsComponent,\r\n    DirectionsResultsComponent\r\n  ],\r\n  providers: [provideDirectionsSourceService()]\r\n})\r\nexport class IgoDirectionsModule {\r\n  static forRoot(): ModuleWithProviders<IgoDirectionsModule> {\r\n    return {\r\n      ngModule: IgoDirectionsModule\r\n    };\r\n  }\r\n}\r\n","import { FEATURE } from '../../feature/shared/feature.enums';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { SearchSource } from './sources/source';\nimport { SearchResult } from './search.interfaces';\n\n/**\n * Function that checks whether a search source implements TextSearch\n * @param source Search source\n * @returns True if the search source implements TextSearch\n */\nexport function sourceCanSearch(source: SearchSource): boolean {\n  return (source as any).search !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch\n * @param source Search source\n * @returns True if the search source implements ReverseSearch\n */\nexport function sourceCanReverseSearch(source: SearchSource): boolean {\n  return (source as any).reverseSearch !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch AND is shown in the pointer summary\n * @param source Search source\n * @returns True if the search source implements ReverseSearch AND is shown in the pointer summary\n */\nexport function sourceCanReverseSearchAsSummary(source: SearchSource): boolean {\n  return (\n    (source as any).reverseSearch !== undefined &&\n    source.showInPointerSummary === true\n  );\n}\n\n/**\n * Return a search result out of an Feature. This is used to adapt\n * the IGO query module to the new Feature/SearchResult interfaces\n * @param feature feature\n * @param source Search source\n * @returns SearchResult\n */\nexport function featureToSearchResult(\n  feature: Feature,\n  source: SearchSource\n): SearchResult<Feature> {\n  if (feature.properties) {\n    delete feature.properties.geometry;\n    delete feature.properties.GEOMETRIE;\n    delete feature.properties.boundedBy;\n    delete feature.properties.shape;\n    delete feature.properties.SHAPE;\n    delete feature.properties.SHAPE_S;\n    delete feature.properties.SHAPE_L;\n    delete feature.properties.SHAPE_P;\n    delete feature.properties.the_geom;\n    delete feature.properties.geom;\n    delete feature.properties.geom32198;\n  }\n  feature.sourceId = source.getId();\n  return {\n    source,\n    data: feature,\n    meta: {\n      dataType: FEATURE,\n      id: feature.meta.id as string,\n      title: feature.meta.title,\n      icon: feature.meta.icon || 'map-marker'\n    }\n  };\n}\n\nexport function findDiff(str1: string, str2: string) {\n  let diff = '';\n  str2.split('').forEach((val, i) => {\n    if (val !== str1.charAt(i)) {\n      diff += val;\n    }\n  });\n  return diff;\n}\n\n/**\n * Return a score calculation based on \"from\" term with the \"to\" term,\n * where the perfect match is 100 and a total difference is 0 or under.\n * @param from string\n * @param to string\n * @param caseSensitive boolean\n * @returns number\n */\nexport function computeTermSimilarity(\n  from,\n  to,\n  caseSensitive: boolean = false\n): number {\n  if (!from || !to) {\n    return 0;\n  }\n  const termFrom = caseSensitive ? from : from.toString().toLowerCase();\n  const termTo = caseSensitive ? to : to.toString().toLowerCase();\n  const fromToDiff = findDiff(termFrom, termTo);\n  const toFromDiff = findDiff(termTo, termFrom);\n  const totalDiff = fromToDiff + toFromDiff;\n\n  let delta = 0;\n  if (totalDiff.length) {\n    delta = (totalDiff.length / termFrom.length) * 100;\n  }\n\n  return 100 - Math.floor(delta);\n}\n","import { Workspace } from '@igo2/common';\nimport { SearchSource } from './sources/source';\nimport { SearchSourceSettings } from './sources/source.interfaces';\n\n/**\n * Service where all available search sources are registered.\n */\nexport class SearchSourceService {\n  constructor(private sources: SearchSource[]) {}\n\n  /**\n   * Return available search sources\n   * @returns Search sources\n   */\n  getSources(): SearchSource[] {\n    return this.sources;\n  }\n\n  /**\n   * Return enabled search sources\n   * @returns Search sources\n   */\n  getEnabledSources(): SearchSource[] {\n    return this.getSources().filter(\n      (source: SearchSource) => source.enabled === true\n    );\n  }\n\n  /**\n   * Enable search sources of given type\n   * @param type Search type\n   * @todo It would be better to track the enabled search sources\n   *  without updating their 'enabled' property.\n   */\n  enableSourcesByType(type: string) {\n    this.getSources().forEach((source: SearchSource) => {\n      if ((source.constructor as typeof SearchSource).type === type) {\n        source.enabled = true;\n      } else {\n        source.enabled = false;\n      }\n    });\n  }\n\n  /**\n   * Set Param from the selected settings\n   * @param source search-source\n   * @param setting settings\n   */\n  setParamFromSetting(source: SearchSource, setting: SearchSourceSettings) {\n    source.setParamFromSetting(setting);\n  }\n\n  /**\n   * Set Param from the selected settings\n   * @param source search-source\n   * @param setting settings\n   */\n  setWorkspaces(source: SearchSource, workspaces: Workspace[]) {\n    source.setWorkspaces(workspaces);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { stringToLonLat } from '../../map/shared';\nimport { MapService } from '../../map/shared/map.service';\n\nimport { SearchSource } from './sources/source';\nimport {\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './sources/source.interfaces';\nimport { SearchSourceService } from './search-source.service';\nimport { Research, TextSearch, ReverseSearch } from './search.interfaces';\nimport {\n  sourceCanSearch,\n  sourceCanReverseSearch,\n  sourceCanReverseSearchAsSummary\n} from './search.utils';\nimport { StorageService } from '@igo2/core';\n\n/**\n * This service perform researches in all the search sources enabled.\n * It returns Research objects who's 'request' property needs to be\n * subscribed to in order to trigger the research. This services has\n * keeps internal state of the researches it performed\n * and the results they yielded.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class SearchService {\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mapService: MapService,\n    private storageService: StorageService\n  ) {}\n\n  /**\n   * Perform a research by text\n   * @param term Any text\n   * @returns Researches\n   */\n  search(term: string, options: TextSearchOptions = {}): Research[] {\n    if (!this.termIsValid(term)) {\n      return [];\n    }\n\n    const proj = this.mapService.getMap()?.projection || 'EPSG:3857';\n    const response = stringToLonLat(term, proj, {\n      forceNA: options.forceNA\n    });\n    if (response.lonLat) {\n      return this.reverseSearch(response.lonLat, {\n        distance: response.radius,\n        conf: response.conf\n      });\n    } else if (response.message) {\n      console.log(response.message);\n    }\n\n    options.extent = this.mapService\n      .getMap()\n      ?.viewController.getExtent('EPSG:4326');\n\n    let sources;\n\n    if (options.getEnabledOnly || options.getEnabledOnly === undefined) {\n      sources = this.searchSourceService.getEnabledSources();\n    } else {\n      sources = this.searchSourceService.getSources();\n    }\n\n    if (options.sourceId) {\n      sources = sources.filter((source) => source.getId() === options.sourceId);\n    } else if (options.searchType) {\n      sources = sources.filter(\n        (source) => source.getType() === options.searchType\n      );\n    }\n\n    sources = sources.filter(sourceCanSearch);\n    return this.searchSources(sources, term, options);\n  }\n\n  /**\n   * Perform a research by lon/lat\n   * @param lonLat Any lon/lat coordinates\n   * @returns Researches\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions,\n    asPointerSummary: boolean = false\n  ) {\n    const reverseSourceFonction = asPointerSummary\n      ? sourceCanReverseSearchAsSummary\n      : sourceCanReverseSearch;\n    const sources = this.searchSourceService\n      .getEnabledSources()\n      .filter(reverseSourceFonction);\n    const reverseSearchCoordsFormat =\n      (this.storageService.get(\n        'reverseSearchCoordsFormatEnabled'\n      ) as boolean) || false;\n\n    return this.reverseSearchSources(\n      sources,\n      lonLat,\n      options || {},\n      reverseSearchCoordsFormat\n    );\n  }\n\n  /**\n   * Create a text research out of all given search sources\n   * @param sources Search sources that implement TextSearch\n   * @param term Search term\n   * @returns Observable of Researches\n   */\n  private searchSources(\n    sources: SearchSource[],\n    term: string,\n    options: TextSearchOptions\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: (source as any as TextSearch).search(term, options),\n        reverse: false,\n        source\n      };\n    });\n  }\n\n  /**\n   * Create a reverse research out of all given search sources\n   * @param sources Search sources that implement ReverseSearch\n   * @param lonLat Any lon/lat coordinates\n   * @returns Observable of Researches\n   */\n  private reverseSearchSources(\n    sources: SearchSource[],\n    lonLat: [number, number],\n    options: ReverseSearchOptions,\n    reverseSearchCoordsFormat: boolean\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: (source as any as ReverseSearch).reverseSearch(\n          lonLat,\n          options,\n          reverseSearchCoordsFormat\n        ),\n        reverse: true,\n        source\n      };\n    });\n  }\n\n  /**\n   * Validate that a search term is valid\n   * @param term Search term\n   * @returns True if the search term is valid\n   */\n  private termIsValid(term: string): boolean {\n    return typeof term === 'string' && term !== '';\n  }\n}\n","import { SearchSource } from './sources/source';\nimport { SearchSourceService } from './search-source.service';\n\n/**\n * Search source factory\n * @ignore\n */\nexport function searchSourceServiceFactory(sources: SearchSource[]) {\n  return new SearchSourceService(sources);\n}\n\n/**\n * Function that returns a provider for the SearchSource service\n */\nexport function provideSearchSourceService() {\n  return {\n    provide: SearchSourceService,\n    useFactory: searchSourceServiceFactory,\n    deps: [SearchSource]\n  };\n}\n","import { Injectable, Inject, Injector } from '@angular/core';\nimport {\n  HttpClient,\n  HttpParams,\n  HttpParameterCodec\n} from '@angular/common/http';\n\nimport { Observable, of, BehaviorSubject } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { AuthService } from '@igo2/auth';\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { ObjectUtils, customCacheHasher } from '@igo2/utils';\n\nimport pointOnFeature from '@turf/point-on-feature';\n\nimport { FEATURE, Feature } from '../../../feature';\nimport { GoogleLinks } from './../../../utils/googleLinks';\n\nimport { SearchResult, TextSearch, ReverseSearch } from '../search.interfaces';\nimport { SearchSource } from './source';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions,\n  SearchSourceSettings\n} from './source.interfaces';\nimport {\n  IChercheData,\n  IChercheResponse,\n  IChercheReverseData,\n  IChercheReverseResponse\n} from './icherche.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class IChercheSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n\n// Fix the \"+\" is replaced with space \" \" in a query string\n// https://github.com/angular/angular/issues/11058\nexport class IgoHttpParameterCodec implements HttpParameterCodec {\n  encodeKey(key: string): string {\n    return encodeURIComponent(key);\n  }\n\n  encodeValue(value: string): string {\n    return encodeURIComponent(value);\n  }\n\n  decodeKey(key: string): string {\n    return decodeURIComponent(key);\n  }\n\n  decodeValue(value: string): string {\n    return decodeURIComponent(value);\n  }\n}\n\n/**\n * ICherche search source\n */\n@Injectable()\nexport class IChercheSearchSource extends SearchSource implements TextSearch {\n  static id = 'icherche';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  private hashtagsLieuxToKeep = [];\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    @Inject(IChercheSearchResultFormatter)\n    private formatter: IChercheSearchResultFormatter,\n    injector: Injector\n  ) {\n    super(options, storageService);\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(\n        this.languageService.translate.instant(this.options.title)\n      );\n    });\n  }\n\n  getId(): string {\n    return IChercheSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n\n    const types = this.options.params?.type\n      ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n      : [\n          'adresses',\n          'codes-postaux',\n          'routes',\n          'intersections',\n          'municipalites',\n          'mrc',\n          'regadmin',\n          'lieux'\n        ];\n\n    const showAdvancedParams = this.options.showAdvancedSettings ?? true;\n\n    return {\n      title: 'igo.geo.search.icherche.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1,\n              hashtags: ['adresse']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldAddress',\n              value: 'anciennes-adresses',\n              enabled: types.indexOf('anciennes-adresses') !== -1,\n              hashtags: ['anciennes-adresses']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldCity',\n              value: 'anciennes-municipalites',\n              enabled: types.indexOf('anciennes-municipalites') !== -1,\n              hashtags: ['anciennes-municipalites']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cn',\n              value: 'bornes-cn',\n              enabled: types.indexOf('bornes-cn') !== -1,\n              hashtags: ['borne', 'bornes', 'cn']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.sumi',\n              value: 'bornes-sumi',\n              enabled: types.indexOf('bornes-sumi') !== -1,\n              hashtags: ['borne', 'bornes', 'sumi']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cadastre',\n              value: 'cadastre',\n              enabled: types.indexOf('cadastre') !== -1,\n              hashtags: ['cadastre']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.postalCode',\n              value: 'codes-postaux',\n              enabled: types.indexOf('codes-postaux') !== -1,\n              hashtags: ['code-postal']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.entreprise',\n              value: 'entreprises',\n              enabled: types.indexOf('entreprises') !== -1,\n              available: false,\n              hashtags: ['entreprise']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cycleStop',\n              value: 'haltes_cyclables',\n              enabled: types.indexOf('haltes_cyclables') !== -1,\n              hashtags: ['haltevelo', 'haltes_cyclables']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.restArea',\n              value: 'haltes_routieres',\n              enabled: types.indexOf('haltes_routieres') !== -1,\n              hashtags: ['halteroute', 'haltes_routieres']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.hq',\n              value: 'hq',\n              enabled: types.indexOf('hq') !== -1,\n              hashtags: ['hq']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.intersection',\n              value: 'intersections',\n              enabled: types.indexOf('intersections') !== -1,\n              hashtags: ['intersection', '+']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.place',\n              value: 'lieux',\n              enabled: types.indexOf('lieux') !== -1,\n              hashtags: ['lieu']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1,\n              hashtags: ['mrc']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1,\n              hashtags: ['municipalité', 'mun']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1,\n              hashtags: ['région-administrative', 'regadmin']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.gcc',\n              value: 'bornes-gcc',\n              enabled: types.indexOf('bornes-gcc') !== -1,\n              hashtags: ['borne', 'bornes', 'repère', 'gcc', 'ccg']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.km',\n              value: 'bornes-km',\n              enabled: types.indexOf('bornes-km') !== -1,\n              hashtags: ['borne', 'bornes', 'repère', 'km']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              hashtags: ['route']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.exit',\n              value: 'sorties-autoroute',\n              enabled: types.indexOf('sorties-autoroute') !== -1,\n              hashtags: ['sortie', 'sorties', 'exit']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cultpatri',\n              value: 'culture',\n              enabled: types.indexOf('culture') !== -1,\n              hashtags: ['grille', 'culture']\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        },\n        showAdvancedParams && {\n          type: 'radiobutton',\n          title: 'ecmax',\n          name: 'ecmax',\n          values: [\n            {\n              title: '10 %',\n              value: 10,\n              enabled: ecmax === 10\n            },\n            {\n              title: '30 %',\n              value: 30,\n              enabled: ecmax === 30 || !ecmax\n            },\n            {\n              title: '50 %',\n              value: 50,\n              enabled: ecmax === 50\n            },\n            {\n              title: '75 %',\n              value: 75,\n              enabled: ecmax === 75\n            },\n            {\n              title: '100 %',\n              value: 100,\n              enabled: ecmax === 100\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'loc',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.map',\n              value: 'true',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.quebec',\n              value: 'false',\n              enabled: true\n            }\n          ]\n        }\n      ].filter(Boolean) as SearchSourceSettings[]\n    };\n  }\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(term, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n\n    return this.getSearch(term, params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getSearch(\n    term: string,\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    return this.http.get(`${this.searchUrl}/geocode`, { params }).pipe(\n      map((response: IChercheResponse) => this.extractResults(response, term)),\n      catchError((err) => {\n        err.error.toDisplay = true;\n        err.error.title = this.languageService.translate.instant(\n          this.getDefaultOptions().title\n        );\n        throw err;\n      })\n    );\n  }\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          const regex = new RegExp(`^${v.value}(\\\\.|$)`);\n          const typesMatched = types.filter((value) => regex.test(value));\n          v.available = typesMatched.length > 0;\n          if (v.value === 'lieux') {\n            this.hashtagsLieuxToKeep = [\n              ...(new Set(\n                typesMatched\n                  .map((t) => t.split('.'))\n                  .reduce((a, b) => a.concat(b))\n                  .filter((t) => t !== 'lieux')\n              ) as any)\n            ];\n          }\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    const queryParams: any = Object.assign(\n      {\n        geometry: true,\n        bbox: true,\n        icon: true,\n        type: 'adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi'\n      },\n      this.params,\n      this.computeOptionsParam(term, options || {}).params,\n      {\n        q: this.computeTerm(term),\n        page: options.page\n      }\n    );\n\n    if (queryParams.loc === 'true') {\n      const [xMin, yMin, xMax, yMax] = options.extent;\n      queryParams.loc = `${xMin},${yMin};${xMax},${yMin};${xMax},${yMax};${xMin},${yMax};${xMin},${yMin}`;\n    } else if (queryParams.loc === 'false') {\n      delete queryParams.loc;\n    }\n\n    if (/#[A-Za-z]+/.test(queryParams.q)) {\n      queryParams.type = 'lieux';\n    }\n\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(queryParams),\n      encoder: new IgoHttpParameterCodec()\n    });\n  }\n\n  private extractResults(\n    response: IChercheResponse,\n    term: string\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheData) => {\n      return this.formatter.formatResult(\n        this.dataToResult(data, term, response)\n      );\n    });\n  }\n\n  private dataToResult(\n    data: IChercheData,\n    term: string,\n    response?: IChercheResponse\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.highlight.title || data.properties.nom;\n    const subtitleHtml = data.highlight.title2\n      ? ' <small> ' + data.highlight.title2 + '</small>'\n      : '';\n    const subtitleHtml2 = data.highlight.title3\n      ? '<br><small> ' + data.highlight.title3 + '</small>'\n      : '';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml + subtitleHtml2,\n        icon: data.icon || 'map-marker',\n        score:\n          data.score || computeTermSimilarity(term.trim(), data.properties.nom),\n        nextPage:\n          response.features.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheSearchSource.propertiesBlacklist\n    );\n\n    if (!data.geometry) {\n      return Object.assign({ type: data.index }, properties);\n    }\n\n    const googleLinksProperties: {\n      GoogleMaps: string;\n      GoogleStreetView?: string;\n    } = {\n      GoogleMaps: ''\n    };\n\n    let googleMaps;\n    if (data.geometry.type === 'Point') {\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        data.geometry.coordinates[0],\n        data.geometry.coordinates[1]\n      );\n    } else {\n      const point = pointOnFeature(data.geometry);\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        point.geometry.coordinates[0],\n        point.geometry.coordinates[1]\n      );\n    }\n\n    let googleMapsNom;\n    if (data.index === 'routes') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + data.properties.municipalite\n      );\n    } else if (data.index === 'municipalites') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + 'ville'\n      );\n    } else if (data.index === 'mrc') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        'mrc+' + data.properties.nom\n      );\n    } else if (data.index === 'regadmin') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ',+QC'\n      );\n    } else {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom || data.highlight.title\n      );\n    }\n\n    googleLinksProperties.GoogleMaps =\n      '<a href=' +\n      googleMaps +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\n      '</a> <br /> <a href=' +\n      googleMapsNom +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByName') +\n      '</a>';\n\n    if (data.geometry.type === 'Point') {\n      googleLinksProperties.GoogleStreetView =\n        GoogleLinks.getGoogleStreetViewLink(\n          data.geometry.coordinates[0],\n          data.geometry.coordinates[1]\n        );\n    }\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(\n      { type: data.index },\n      properties,\n      googleLinksProperties,\n      routing\n    );\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    // Keep hashtags for \"lieux\"\n    const hashtags = term.match(/(#[A-Za-z]+)/g) || [];\n    let keep = false;\n    keep = hashtags.some((hashtag) => {\n      const hashtagKey = hashtag.substring(1);\n      return this.hashtagsLieuxToKeep.some(\n        (h) =>\n          h\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '') ===\n          hashtagKey\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n      );\n    });\n\n    if (!keep) {\n      term = term.replace(/(#[A-Za-z]+)/g, '');\n    }\n\n    return term.replace(/[^\\wÀ-ÿ !\\-\\+\\(\\)\\.\\/½¼¾,'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n}\n\n/**\n * IChercheReverse search source\n */\n@Injectable()\nexport class IChercheReverseSearchSource\n  extends SearchSource\n  implements ReverseSearch\n{\n  static id = 'icherchereverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    injector: Injector\n  ) {\n    super(options, storageService);\n\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(\n        this.languageService.translate.instant(this.options.title)\n      );\n    });\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n  }\n\n  getId(): string {\n    return IChercheReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const types =\n      this.options.params && this.options.params.type\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n        : ['adresses', 'municipalites', 'mrc', 'regadmin'];\n\n    return {\n      title: 'igo.geo.search.ichercheReverse.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              available: false\n            },\n            {\n              title: 'igo.geo.search.icherche.type.district',\n              value: 'arrondissements',\n              enabled: types.indexOf('arrondissements') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'radius',\n          name: 'bufferInput',\n          values: [\n            {\n              title: '100 m',\n              value: 100,\n              enabled: !this.options.distance || this.options.distance === 100\n            },\n            {\n              title: '500 m',\n              value: 500,\n              enabled: this.options.distance === 500\n            },\n            {\n              title: '1 km',\n              value: 1000,\n              enabled: this.options.distance === 1000\n            },\n            {\n              title: '2 km',\n              value: 2000,\n              enabled: this.options.distance === 2000\n            },\n            {\n              title: '5 km',\n              value: 5000,\n              enabled: this.options.distance === 5000\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    return this.getReverseSearch(params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getReverseSearch(\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    return this.http.get(`${this.searchUrl}/locate`, { params }).pipe(\n      map((response: IChercheReverseResponse) => {\n        return this.extractResults(response);\n      })\n    );\n  }\n\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          v.available = types.indexOf(v.value as string) > -1;\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    if (options.distance || this.options.distance) {\n      options.params = Object.assign(options.params || {}, {\n        bufferInput: options.distance || this.options.distance\n      });\n    }\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          loc: lonLat.join(','),\n          sort: 'distance',\n          geometry: true,\n          icon: true\n        },\n        options.params || {},\n        this.params\n      )\n    });\n  }\n\n  private extractResults(\n    response: IChercheReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private getSubtitle(data: IChercheReverseData) {\n    if (!this.settings.length) {\n      return '';\n    }\n    let subtitle = '';\n    switch (data.properties.type) {\n      case 'arrondissements':\n        subtitle = data.properties.municipalite + ' (Arrondissement)';\n        break;\n      default:\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        const type = typeSetting.values.find(\n          (t) => t.value === data.properties.type\n        );\n        if (type) {\n          subtitle = this.languageService.translate.instant(type.title);\n        }\n    }\n    return subtitle;\n  }\n\n  private dataToResult(data: IChercheReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.properties.nom;\n    const subtitleHtml = ' <small> ' + this.getSubtitle(data) + '</small>';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.icon || 'map-marker',\n        pointerSummaryTitle: this.getSubtitle(data) + ': ' + data.properties.nom\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheReverseData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheReverseSearchSource.propertiesBlacklist\n    );\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(properties, routing);\n  }\n\n  private computeExtent(\n    data: IChercheReverseData\n  ): [number, number, number, number] | undefined {\n    return data.bbox\n      ? [data.bbox[0], data.bbox[2], data.bbox[1], data.bbox[3]]\n      : undefined;\n  }\n}\n","import { Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  IChercheSearchSource,\n  IChercheSearchResultFormatter,\n  IChercheReverseSearchSource\n} from './icherche';\n\n/**\n * ICherche search result formatter factory\n * @ignore\n */\nexport function defaultIChercheSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new IChercheSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ICherche search result formatter\n */\nexport function provideDefaultIChercheSearchResultFormatter() {\n  return {\n    provide: IChercheSearchResultFormatter,\n    useFactory: defaultIChercheSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ICherche search source factory\n * @ignore\n */\nexport function ichercheSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: IChercheSearchResultFormatter,\n  injector: Injector\n) {\n  return new IChercheSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheSearchSource.id}`),\n    formatter,\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the ICherche search source\n */\nexport function provideIChercheSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheSearchSourceFactory,\n    multi: true,\n    deps: [\n      HttpClient,\n      LanguageService,\n      StorageService,\n      ConfigService,\n      IChercheSearchResultFormatter,\n      Injector\n    ]\n  };\n}\n\n/**\n * IChercheReverse search source factory\n * @ignore\n */\nexport function ichercheReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  injector: Injector\n) {\n  return new IChercheReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheReverseSearchSource.id}`),\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the IChercheReverse search source\n */\nexport function provideIChercheReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, Injector]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport * as olproj from 'ol/proj';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport * as olformat from 'ol/format';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { SearchResult, ReverseSearch } from '../search.interfaces';\nimport { SearchSource } from './source';\nimport { SearchSourceOptions, ReverseSearchOptions } from './source.interfaces';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { GoogleLinks } from '../../../utils/googleLinks';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport {\n  lonLatConversion,\n  roundCoordTo,\n  convertDDToDMS\n} from '../../../map/shared/map.utils';\nimport { OsmLinks } from '../../../utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class CoordinatesSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n/**\n * CoordinatesReverse search source\n */\n@Injectable()\nexport class CoordinatesReverseSearchSource\n  extends SearchSource\n  implements ReverseSearch\n{\n  static id = 'coordinatesreverse';\n  static type = FEATURE;\n\n  private projections;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    @Inject('options') options: SearchSourceOptions,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('projections') projections: Projection[]\n  ) {\n    super(options, storageService);\n    this.projections = projections;\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(\n        this.languageService.translate.instant(this.options.title)\n      );\n    });\n  }\n\n  getId(): string {\n    return CoordinatesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return CoordinatesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'igo.geo.search.coordinates.name',\n      order: 1,\n      showInSettings: false\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param options options of ReverseSearchOptions (distance, conf, zoom, params)\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions,\n    reverseSearchCoordsFormatEnabled?: boolean\n  ): Observable<SearchResult<Feature>[]> {\n    return of([\n      this.dataToResult(lonLat, options, reverseSearchCoordsFormatEnabled)\n    ]);\n  }\n\n  private dataToResult(\n    data: [number, number],\n    options: ReverseSearchOptions,\n    reverseSearchCoordsFormatEnabled: boolean\n  ): SearchResult<Feature> {\n    const dataDMS = convertDDToDMS(data);\n    const convertedCoord = lonLatConversion(data, this.projections);\n    const coords = convertedCoord.reduce(\n      (obj, item) => ((obj[item.alias] = item.igo2CoordFormat), obj),\n      {}\n    );\n\n    const roundedCoordString = !reverseSearchCoordsFormatEnabled\n      ? roundCoordTo(data, 6).join(', ')\n      : roundCoordTo(data, 6).reverse().join(', ');\n\n    const roundedCoordStringDMS = !reverseSearchCoordsFormatEnabled\n      ? dataDMS.join(', ')\n      : dataDMS.reverse().join(', ');\n\n    let geometry: FeatureGeometry = {\n      type: 'Point',\n      coordinates: [data[0], data[1]]\n    };\n\n    const properties = {};\n    let subtitleHtml = '';\n    if (options.distance) {\n      const radiusKey = this.languageService.translate.instant(\n        'igo.geo.search.coordinates.radius'\n      );\n      properties[radiusKey] = options.distance;\n      subtitleHtml = '<br><small>Rayon: ' + options.distance + ' m</small>';\n\n      // Create polygon\n      const center = olproj.transform(\n        [data[0], data[1]],\n        'EPSG:4326',\n        'EPSG:3857'\n      );\n      const circleGeometry = new OlCircle(center, options.distance);\n      const polygonGeometry = fromCircle(circleGeometry);\n      const writer = new olformat.GeoJSON();\n      geometry = JSON.parse(\n        writer.writeGeometry(\n          polygonGeometry.transform('EPSG:3857', 'EPSG:4326')\n        )\n      );\n    }\n\n    if (options.conf) {\n      const confKey = this.languageService.translate.instant(\n        'igo.geo.search.coordinates.conf'\n      );\n      properties[confKey] = options.conf;\n      subtitleHtml += subtitleHtml === '' ? '<br>' : '<small> - </small>';\n      subtitleHtml += '<small>Confiance: ' + options.conf + '%</small>';\n    }\n\n    const coordKey = !reverseSearchCoordsFormatEnabled\n      ? this.languageService.translate.instant(\n          'igo.geo.search.coordinates.coord'\n        )\n      : this.languageService.translate.instant(\n          'igo.geo.search.coordinates.reversedCoord'\n        );\n    properties[coordKey] = roundedCoordString;\n\n    const coordKeyDMS = !reverseSearchCoordsFormatEnabled\n      ? this.languageService.translate.instant(\n          'igo.geo.search.coordinates.coordDMS'\n        )\n      : this.languageService.translate.instant(\n          'igo.geo.search.coordinates.reversedCoordDMS'\n        );\n    properties[coordKeyDMS] = roundedCoordStringDMS;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent: undefined,\n        properties: Object.assign(properties, coords, {\n          GoogleMaps: GoogleLinks.getGoogleMapsCoordLink(data[0], data[1]),\n          GoogleStreetView: GoogleLinks.getGoogleStreetViewLink(\n            data[0],\n            data[1]\n          ),\n          OpenStreetMap: OsmLinks.getOpenStreetMapLink(data[0], data[1], 14),\n          Route:\n            '<span class=\"routing\"> <u>' +\n            this.languageService.translate.instant('igo.geo.seeRouting') +\n            '</u> </span>'\n        }),\n        meta: {\n          id: data[0].toString() + ',' + data[1].toString(),\n          title: roundedCoordString\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id: data[0].toString() + ',' + data[1].toString(),\n        title: roundedCoordString,\n        titleHtml: roundedCoordString + subtitleHtml,\n        icon: 'map-marker',\n        score: 100 // every coord exists\n      }\n    };\n  }\n}\n","import { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  CoordinatesReverseSearchSource,\n  CoordinatesSearchResultFormatter\n} from './coordinates';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { ProjectionService } from '../../../map/shared/projection.service';\n\n/**\n * Coordinate search result formatter factory\n * @ignore\n */\nexport function defaultCoordinatesSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new CoordinatesSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the Coordinates search result formatter\n */\nexport function provideDefaultCoordinatesSearchResultFormatter() {\n  return {\n    provide: CoordinatesSearchResultFormatter,\n    useFactory: defaultCoordinatesSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * CoordinatesReverse search source factory\n * @ignore\n */\nexport function CoordinatesReverseSearchSourceFactory(\n  config: ConfigService,\n  languageService: LanguageService,\n  storageService: StorageService,\n  _projectionService: ProjectionService\n) {\n  return new CoordinatesReverseSearchSource(\n    config.getConfig(`searchSources.${CoordinatesReverseSearchSource.id}`),\n    languageService,\n    storageService,\n    (config.getConfig('projections') as Projection[]) || []\n  );\n}\n\n/**\n * Function that returns a provider for the Coordinate search source\n */\nexport function provideCoordinatesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: CoordinatesReverseSearchSourceFactory,\n    multi: true,\n    deps: [ConfigService, LanguageService, StorageService, ProjectionService]\n  };\n}\n","import { Directive, Self, OnInit, OnDestroy, Optional } from '@angular/core';\nimport { Subscription, combineLatest } from 'rxjs';\n\nimport { RouteService } from '@igo2/core';\nimport { MapService } from '../../map/shared/map.service';\nimport { LayerListComponent } from './layer-list.component';\nimport { Layer } from '../shared/layers/layer';\nimport { map, debounceTime } from 'rxjs/operators';\n\n@Directive({\n  selector: '[igoLayerListBinding]'\n})\nexport class LayerListBindingDirective implements OnInit, OnDestroy {\n  private component: LayerListComponent;\n  private layersOrResolutionChange$$: Subscription;\n  layersVisibility$$: Subscription;\n\n  constructor(\n    @Self() component: LayerListComponent,\n    private mapService: MapService,\n    @Optional() private route: RouteService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    // this.component.layers = [];\n    this.layersOrResolutionChange$$ = combineLatest([\n      this.mapService.getMap().layers$,\n      this.mapService.getMap().viewController.resolution$\n    ])\n      .pipe(debounceTime(10))\n      .subscribe((bunch: [Layer[], number]) => {\n        const shownLayers = bunch[0].filter((layer: Layer) => {\n          return layer.showInLayerList === true;\n        });\n        this.component.layers = shownLayers;\n        this.setLayersVisibilityStatus(\n          shownLayers,\n          this.component.excludeBaseLayers\n        );\n      });\n  }\n\n  private setLayersVisibilityStatus(\n    layers: Layer[],\n    excludeBaseLayers: boolean\n  ) {\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n    this.layersVisibility$$ = combineLatest(\n      layers\n        .filter((layer) => layer.baseLayer !== excludeBaseLayers)\n        .map((layer: Layer) => layer.visible$)\n    )\n      .pipe(map((visibles: boolean[]) => visibles.every(Boolean)))\n      .subscribe(\n        (allLayersAreVisible: boolean) =>\n          (this.component.layersAreAllVisible = allLayersAreVisible)\n      );\n  }\n\n  ngOnDestroy() {\n    this.layersOrResolutionChange$$.unsubscribe();\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n  }\n}\n","<button\n  *ngIf=\"options.trackFeature\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.layer.trackFeature' | translate\"\n  [color]=\"color\"\n  (click)=\"toggleTrackFeature()\"\n>\n  <mat-icon svgIcon=\"crosshairs-gps\"></mat-icon>\n</button>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit\n} from '@angular/core';\n\nimport { VectorLayer } from '../shared/layers';\nimport { VectorLayerOptions } from '../shared/layers/vector-layer.interface';\n\n@Component({\n  selector: 'igo-track-feature-button',\n  templateUrl: './track-feature-button.component.html',\n  styleUrls: ['./track-feature-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TrackFeatureButtonComponent implements OnInit {\n  @Input() layer: VectorLayer;\n\n  @Input() trackFeature = false;\n\n  get options(): VectorLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n\n  public color: string = 'primary';\n\n  constructor() {}\n\n  ngOnInit() {\n    this.color = this.trackFeature ? 'primary' : 'basic';\n  }\n\n  toggleTrackFeature() {\n    if (this.trackFeature) {\n      this.layer.disableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'basic';\n    } else {\n      this.layer.enableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'primary';\n    }\n    this.trackFeature = !this.trackFeature;\n  }\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { customCacheHasher, ObjectUtils } from '@igo2/utils';\n\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\nimport { LAYER } from '../../../layer';\nimport { QueryableDataSourceOptions, QueryFormat } from '../../../query';\nimport { QueryHtmlTarget } from './../../../query/shared/query.enums';\n\nimport { SearchResult, TextSearch } from '../search.interfaces';\nimport { SearchSource } from './source';\nimport { TextSearchOptions } from './source.interfaces';\nimport {\n  ILayerSearchSourceOptions,\n  ILayerData,\n  ILayerItemResponse,\n  ILayerServiceResponse,\n  ILayerDataSource\n} from './ilayer.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class ILayerSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(data: ILayerData): ILayerData {\n    const allowedKey = [\n      'title',\n      'abstract',\n      'groupTitle',\n      'metadataUrl',\n      'downloadUrl',\n      'urlInfo',\n      'name'\n    ];\n\n    const property = Object.entries(data.properties)\n      .filter(([key]) => allowedKey.indexOf(key) !== -1)\n      .reduce((out: { [key: string]: any }, entries: [string, any]) => {\n        const [key, value] = entries;\n        let newKey;\n        try {\n          newKey = this.languageService.translate.instant(\n            'igo.geo.search.ilayer.properties.' + key\n          );\n        } catch (e) {\n          newKey = key;\n        }\n        out[newKey] = value ? value : '';\n        return out;\n      }, {});\n\n    const dataR = Object.assign({}, data);\n    dataR.properties = property as ILayerDataSource;\n\n    return dataR;\n  }\n}\n\n/**\n * ILayer search source\n */\n@Injectable()\nexport class ILayerSearchSource extends SearchSource implements TextSearch {\n  static id = 'ilayer';\n  static type = LAYER;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: ILayerSearchSourceOptions,\n    @Inject(ILayerSearchResultFormatter)\n    private formatter: ILayerSearchResultFormatter\n  ) {\n    super(options, storageService);\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(\n        this.languageService.translate.instant(this.options.title)\n      );\n    });\n  }\n\n  getId(): string {\n    return ILayerSearchSource.id;\n  }\n\n  getType(): string {\n    return ILayerSearchSource.type;\n  }\n\n  protected getDefaultOptions(): ILayerSearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n    return {\n      title: 'igo.geo.search.ilayer.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.ilayer.type.layer',\n              value: 'layer',\n              enabled: true,\n              hashtags: ['layer', 'layers', 'couche', 'couches']\n            },\n            {\n              title: 'igo.geo.search.ilayer.type.groupLayer',\n              value: 'group',\n              enabled: false,\n              hashtags: ['gr-layer', 'gr-layers', 'gr-couche', 'gr-couches']\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'ecmax',\n          name: 'ecmax',\n          values: [\n            {\n              title: '10 %',\n              value: 10,\n              enabled: ecmax === 10\n            },\n            {\n              title: '30 %',\n              value: 30,\n              enabled: ecmax === 30\n            },\n            {\n              title: '50 %',\n              value: 50,\n              enabled: ecmax === 50 || !ecmax\n            },\n            {\n              title: '75 %',\n              value: 75,\n              enabled: ecmax === 75\n            },\n            {\n              title: '100 %',\n              value: 100,\n              enabled: ecmax === 100\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a layer by name or keyword\n   * @param term Layer name or keyword\n   * @returns Observable of <SearchResult<LayerOptions>[]\n   */\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q') || !params.get('type')) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n    return this.getSearch(term, params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getSearch(\n    term: string,\n    params: HttpParams\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(\n        map((response: ILayerServiceResponse) =>\n          this.extractResults(response, term)\n        )\n      );\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(\n        Object.assign(\n          {\n            q: this.computeTerm(term)\n          },\n          this.params,\n          this.computeOptionsParam(term, options || {}).params,\n          {\n            page: options.page\n          }\n        )\n      )\n    });\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    return term.replace(/(#[^\\s]*)/g, '').replace(/[^\\wÀ-ÿ !\\-\\(\\),'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n\n  private extractResults(\n    response: ILayerServiceResponse,\n    term: string\n  ): SearchResult<ILayerItemResponse>[] {\n    return response.items.map((data: ILayerData) =>\n      this.dataToResult(data, term, response)\n    );\n  }\n\n  private dataToResult(\n    data: ILayerData,\n    term: string,\n    response?: ILayerServiceResponse\n  ): SearchResult<ILayerItemResponse> {\n    const layerOptions = this.computeLayerOptions(data);\n\n    const titleHtml = data.highlight.title || data.properties.title;\n    const groupTitle = data.highlight.groupTitle || data.properties.groupTitle;\n    const subtitleHtml = groupTitle\n      ? ' <small style=\"color: #6f6969\"> ' + groupTitle + '</small>'\n      : '';\n\n    return {\n      source: this,\n      meta: {\n        dataType: LAYER,\n        id: [this.getId(), data.properties.id].join('.'),\n        title: data.properties.title,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.properties.type === 'Layer' ? 'layers' : 'map',\n        score:\n          data.score ||\n          computeTermSimilarity(term.trim(), data.properties.name),\n        nextPage:\n          response.items.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      },\n      data: layerOptions\n    };\n  }\n\n  private computeLayerOptions(data: ILayerData): ILayerItemResponse {\n    const url = data.properties.url;\n    const queryParams: QueryableDataSourceOptions =\n      this.extractQueryParamsFromSourceUrl(url);\n    return ObjectUtils.removeUndefined({\n      sourceOptions: {\n        id: data.properties.id,\n        type: data.properties.format,\n        url,\n        queryFormat: queryParams.queryFormat,\n        queryHtmlTarget: queryParams.queryHtmlTarget,\n        params:\n          data.properties.format === 'wms'\n            ? { LAYERS: data.properties.name }\n            : undefined,\n        layer:\n          data.properties.format === 'wms' ? undefined : data.properties.name,\n        optionsFromCapabilities: true,\n        crossOrigin: 'anonymous'\n      },\n      title: data.properties.title,\n      maxResolution: getResolutionFromScale(\n        Number(data.properties.maxScaleDenom)\n      ),\n      minResolution: getResolutionFromScale(\n        Number(data.properties.minScaleDenom)\n      ),\n      metadata: {\n        url: data.properties.metadataUrl,\n        extern: data.properties.metadataUrl ? true : undefined,\n        abstract: data.properties.abstract || undefined\n      },\n      properties: this.formatter.formatResult(data).properties\n    });\n  }\n\n  private extractQueryParamsFromSourceUrl(url: string): {\n    queryFormat: QueryFormat;\n    queryHtmlTarget: QueryHtmlTarget;\n  } {\n    let queryFormat;\n    let queryHtmlTarget;\n    const formatOpt = (this.options as ILayerSearchSourceOptions).queryFormat;\n    if (formatOpt) {\n      for (const key of Object.keys(formatOpt)) {\n        const value = formatOpt[key];\n        if (value === '*') {\n          queryFormat = QueryFormat[key.toUpperCase()];\n          break;\n        }\n\n        const urls = (value as any as { urls: string[] }).urls;\n        if (Array.isArray(urls)) {\n          urls.forEach((urlOpt) => {\n            if (url.indexOf(urlOpt) !== -1) {\n              queryFormat = QueryFormat[key.toUpperCase()];\n            }\n          });\n          break;\n        }\n      }\n\n      if (\n        queryFormat === QueryFormat.HTML ||\n        queryFormat === QueryFormat.HTMLGML2\n      ) {\n        queryHtmlTarget = 'iframe';\n      }\n    }\n\n    return {\n      queryFormat,\n      queryHtmlTarget\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { ILayerSearchSource, ILayerSearchResultFormatter } from './ilayer';\n\n/**\n * ILayer search result formatter factory\n * @ignore\n */\nexport function ilayerSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new ILayerSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ILayer search result formatter\n */\nexport function provideILayerSearchResultFormatter() {\n  return {\n    provide: ILayerSearchResultFormatter,\n    useFactory: ilayerSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ILayer search source factory\n * @ignore\n */\nexport function ilayerSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: ILayerSearchResultFormatter\n) {\n  return new ILayerSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${ILayerSearchSource.id}`),\n    formatter\n  );\n}\n\n/**\n * Function that returns a provider for the ILayer search source\n */\nexport function provideILayerSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ilayerSearchSourceFactory,\n    multi: true,\n    deps: [\n      HttpClient,\n      LanguageService,\n      StorageService,\n      ConfigService,\n      ILayerSearchResultFormatter\n    ]\n  };\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { SearchSelectorComponent } from './search-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatTabsModule,\n    MatCheckboxModule,\n    IgoLanguageModule\n  ],\n  exports: [SearchSelectorComponent],\n  declarations: [SearchSelectorComponent]\n})\nexport class IgoSearchSelectorModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { SearchSettingsComponent } from './search-settings.component';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\n/**\n * @ignore\n */\n@NgModule({\n  declarations: [SearchSettingsComponent],\n  imports: [\n    CommonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatCheckboxModule,\n    MatDividerModule,\n    MatSlideToggleModule,\n    IgoLanguageModule\n  ],\n  exports: [SearchSettingsComponent]\n})\nexport class IgoSearchSettingsModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoSearchSelectorModule } from '../search-selector/search-selector.module';\nimport { IgoSearchSettingsModule } from '../search-settings/search-settings.module';\nimport { SearchBarComponent } from './search-bar.component';\nimport { SearchUrlParamDirective } from './search-url-param.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatDividerModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatFormFieldModule,\n    MatInputModule,\n    IgoLanguageModule,\n    IgoSearchSelectorModule,\n    IgoSearchSettingsModule\n  ],\n  exports: [SearchBarComponent],\n  declarations: [SearchBarComponent, SearchUrlParamDirective]\n})\nexport class IgoSearchBarModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\n\nimport {\n  IgoCollapsibleModule,\n  IgoListModule,\n  IgoMatBadgeIconModule,\n  IgoStopPropagationModule\n} from '@igo2/common';\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\nimport { SearchResultsComponent } from './search-results.component';\nimport { SearchResultsItemComponent } from './search-results-item.component';\nimport { SearchResultAddButtonComponent } from './search-results-add-button.component';\nimport { SaveFeatureDialogComponent } from './save-feature-dialog.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoCollapsibleModule,\n    IgoLanguageModule,\n    IgoListModule,\n    IgoMatBadgeIconModule,\n    IgoMetadataModule,\n    IgoStopPropagationModule,\n    MatAutocompleteModule,\n    MatBadgeModule,\n    MatButtonModule,\n    MatDialogModule,\n    MatFormFieldModule,\n    MatIconModule,\n    MatInputModule,\n    MatListModule,\n    MatSelectModule,\n    MatTabsModule,\n    MatTooltipModule,\n    ReactiveFormsModule\n  ],\n  exports: [SearchResultsComponent, SearchResultAddButtonComponent],\n  declarations: [\n    SearchResultsComponent,\n    SearchResultsItemComponent,\n    SearchResultAddButtonComponent,\n    SaveFeatureDialogComponent\n  ]\n})\nexport class IgoSearchResultsModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { SearchService } from './shared/search.service';\nimport { provideSearchSourceService } from './shared/search-source-service.providers';\nimport { provideDefaultIChercheSearchResultFormatter } from './shared/sources/icherche.providers';\nimport { provideDefaultCoordinatesSearchResultFormatter } from './shared/sources/coordinates.providers';\nimport { provideILayerSearchResultFormatter } from './shared/sources/ilayer.providers';\n\nimport { IgoSearchBarModule } from './search-bar/search-bar.module';\nimport { IgoSearchSelectorModule } from './search-selector/search-selector.module';\nimport { IgoSearchResultsModule } from './search-results/search-results.module';\nimport { IgoSearchSettingsModule } from './search-settings/search-settings.module';\nimport { SearchPointerSummaryDirective } from './shared/search-pointer-summary.directive';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule\n  ],\n  exports: [\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule,\n    SearchPointerSummaryDirective\n  ],\n  declarations: [SearchPointerSummaryDirective]\n})\nexport class IgoSearchModule {\n  static forRoot(): ModuleWithProviders<IgoSearchModule> {\n    return {\n      ngModule: IgoSearchModule,\n      providers: [\n        SearchService,\n        provideSearchSourceService(),\n        provideDefaultIChercheSearchResultFormatter(),\n        provideDefaultCoordinatesSearchResultFormatter(),\n        provideILayerSearchResultFormatter()\n      ]\n    };\n  }\n}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { OnUpdateInputs, WidgetComponent } from '@igo2/common';\n\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { IgoMap } from '../../../map/shared/map';\n\n@Component({\n  selector: 'igo-ogc-filter',\n  templateUrl: './ogc-filter.component.html',\n  styleUrls: ['./ogc-filter.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterComponent implements OnUpdateInputs, WidgetComponent {\n  @Input() layer: Layer;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Event emitted on complete\n   */\n  @Output() complete = new EventEmitter<void>();\n\n  /**\n   * Event emitted on cancel\n   */\n  @Output() cancel = new EventEmitter<void>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Implemented as part of OnUpdateInputs\n   */\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * On close, emit the cancel event\n   */\n  onClose() {\n    this.cancel.emit();\n  }\n}\n","<igo-ogc-filterable-item\n  igoListItem\n  [layer]=\"layer\"\n  [header]=\"false\"\n  [map]=\"map\"\n>\n</igo-ogc-filterable-item>\n","import { InjectionToken } from '@angular/core';\n\nimport { Widget, WidgetService } from '@igo2/common';\n\nimport { OgcFilterComponent } from './ogc-filter/ogc-filter.component';\n\nexport const OgcFilterWidget = new InjectionToken<Widget>('OgcFilterWidget');\n\nexport function ogcFilterWidgetFactory(widgetService: WidgetService): Widget {\n  return widgetService.create(OgcFilterComponent);\n}\n\nexport function provideOgcFilterWidget() {\n  return {\n    provide: OgcFilterWidget,\n    useFactory: ogcFilterWidgetFactory,\n    deps: [WidgetService]\n  };\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoFilterModule } from '../../../filter/filter.module';\nimport { OgcFilterComponent } from './ogc-filter.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [CommonModule, MatButtonModule, IgoLanguageModule, IgoFilterModule],\n  exports: [OgcFilterComponent],\n  declarations: [OgcFilterComponent]\n})\nexport class IgoOgcFilterModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { WorkspaceSelectorDirective } from './workspace-selector.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [CommonModule],\n  exports: [WorkspaceSelectorDirective],\n  declarations: [WorkspaceSelectorDirective]\n})\nexport class IgoWorkspaceSelectorModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { WorkspaceUpdatorDirective } from './workspace-updator.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [CommonModule],\n  exports: [WorkspaceUpdatorDirective],\n  declarations: [WorkspaceUpdatorDirective]\n})\nexport class IgoWorkspaceUpdatorModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { ConfirmationPopupComponent } from './confirmation-popup.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    MatDialogModule,\n    MatButtonToggleModule\n  ],\n  exports: [ConfirmationPopupComponent],\n  declarations: [ConfirmationPopupComponent]\n})\nexport class IgoConfirmationPopupModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { IgoWidgetModule } from '@igo2/common';\n\nimport { provideOgcFilterWidget } from './widgets/widgets';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoOgcFilterModule } from './widgets/ogc-filter/ogc-filter.module';\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\nimport { IgoWorkspaceUpdatorModule } from './workspace-updator/workspace-updator.module';\nimport { IgoConfirmationPopupModule } from './confirmation-popup/confirmation-popup.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoWidgetModule,\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceUpdatorModule,\n    IgoOgcFilterModule,\n    MatDialogModule\n  ],\n  exports: [\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceUpdatorModule,\n    IgoOgcFilterModule,\n    IgoConfirmationPopupModule\n  ],\n  declarations: [],\n  providers: [provideOgcFilterWidget()]\n})\nexport class IgoGeoWorkspaceModule {}\n","import { Injectable } from '@angular/core';\nimport { HttpBackend, HttpClient } from '@angular/common/http';\nimport { throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { StyleListOptions } from './style-list.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleListService {\n  private styleList: object = {};\n  private httpClient: HttpClient;\n\n  constructor(handler: HttpBackend) {\n    this.httpClient = new HttpClient(handler);\n  }\n\n  /**\n   * Use to get the data found in styleList file\n   */\n  public getStyleList(key: string): any {\n    return ObjectUtils.resolve(this.styleList, key);\n  }\n\n  /**\n   * This method loads \"[path]\" to get all styleList's variables\n   */\n  public load(options: StyleListOptions) {\n    const baseStyleList = options.default || {};\n    if (!options.path) {\n      this.styleList = baseStyleList;\n      return true;\n    }\n\n    return new Promise((resolve, _reject) => {\n      this.httpClient\n        .get(options.path)\n        .pipe(\n          catchError((error: any): any => {\n            console.log(`StyleList file ${options.path} could not be read`);\n            resolve(true);\n            return throwError(error.error || 'Server error');\n          })\n        )\n        .subscribe((styleListResponse: object) => {\n          this.styleList = ObjectUtils.mergeDeep(\n            baseStyleList,\n            styleListResponse\n          );\n          resolve(true);\n        });\n    });\n  }\n}\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\n\nimport { StyleListService } from './style-list.service';\nimport { StyleListOptions } from './style-list.interface';\n\nexport let STYLELIST_OPTIONS = new InjectionToken<StyleListOptions>(\n  'styleListOptions'\n);\n\nexport function provideStyleListOptions(options: StyleListOptions) {\n  return {\n    provide: STYLELIST_OPTIONS,\n    useValue: options\n  };\n}\n\nexport function styleListFactory(\n  styleListService: StyleListService,\n  options: StyleListOptions\n) {\n  return () => styleListService.load(options);\n}\n\nexport function provideStyleListLoader() {\n  return {\n    provide: APP_INITIALIZER,\n    useFactory: styleListFactory,\n    multi: true,\n    deps: [StyleListService, STYLELIST_OPTIONS]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport {\n  provideStyleListOptions,\n  provideStyleListLoader\n} from './style-list.provider';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoStyleListModule {\n  static forRoot(): ModuleWithProviders<IgoStyleListModule> {\n    return {\n      ngModule: IgoStyleListModule,\n      providers: [provideStyleListOptions({}), provideStyleListLoader()]\n    };\n  }\n}\n","export enum FontType {\n  Arial = 'Arial',\n  ArialBlack = 'Arial Black',\n  Verdana = 'Verdana',\n  Tahoma = 'Tahoma',\n  TrebuchetMS = 'Trebuchet MS',\n  Impact = 'Impact',\n  TimesNewRoman = 'Times New Roman',\n  Georgia = 'Georgia',\n  AmericanTypewriter = 'American Typewriter',\n  Courier = 'Courier',\n  LucidaConsole = 'Lucida Console',\n  BrushScriptMT = 'Brush Script MT',\n  ComicSansMS = 'Comic Sans MS'\n}\n","import { Injectable } from '@angular/core';\n\nimport * as OlStyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport { ProjectionLike, transform } from 'ol/proj';\nimport { FontType } from '../shared/font.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DrawStyleService {\n  private fillColor = 'rgba(255,255,255,0.4)';\n  private strokeColor = 'rgba(143,7,7,1)';\n  private strokeWidth: number = 1;\n  private labelsAreShown = true;\n  private icon: string;\n  private fontSize: string = '15';\n  private fontStyle: string = FontType.Arial.toString();\n  private offsetX: number = 0;\n  private offsetY: number = 0;\n\n  constructor() {}\n\n  getFillColor(): string {\n    return this.fillColor;\n  }\n\n  setFillColor(fillColor: string) {\n    this.fillColor = fillColor;\n  }\n\n  getStrokeColor(): string {\n    return this.strokeColor;\n  }\n\n  setStrokeColor(strokeColor: string) {\n    this.strokeColor = strokeColor;\n  }\n\n  getStrokeWidth(): number {\n    return this.strokeWidth;\n  }\n\n  getLabelsAreShown() {\n    return this.labelsAreShown;\n  }\n\n  toggleLabelsAreShown() {\n    this.labelsAreShown = !this.labelsAreShown;\n  }\n\n  setIcon(icon: string) {\n    this.icon = icon;\n  }\n\n  getIcon() {\n    return this.icon;\n  }\n\n  // To edit the label of drawing\n  getFontSize() {\n    return this.fontSize;\n  }\n\n  setFontSize(fontSize: string) {\n    this.fontSize = fontSize;\n  }\n\n  getFontStyle() {\n    return this.fontStyle;\n  }\n\n  setFontStyle(fontStyle: string) {\n    this.fontStyle = fontStyle;\n  }\n\n  getOffsetX(): number {\n    return this.offsetX;\n  }\n\n  setOffsetX(offsetX: number) {\n    this.offsetX = offsetX;\n  }\n\n  getOffsetY(): number {\n    return this.offsetY;\n  }\n\n  setOffsetY(offsetY: number) {\n    this.offsetY = offsetY;\n  }\n\n  createIndividualElementStyle(\n    feature,\n    resolution,\n    labelsAreShown: boolean,\n    fontSizeAndStyle: string,\n    fillColor: string,\n    strokeColor: string,\n    offsetX: number,\n    offsetY: number,\n    proj: ProjectionLike,\n    icon?: string\n  ): OlStyle.Style {\n    let style;\n    let labelsAreOffset: boolean = false;\n    const geom = feature.getGeometry();\n\n    if (geom instanceof OlPoint) {\n      labelsAreOffset = !labelsAreOffset;\n    }\n    const textToShow = labelsAreShown ? feature.get('draw') : '';\n    feature.set('_mapTitle', textToShow);\n    const textIgoStyleObject = {\n      text: textToShow,\n      stroke: {\n        color: 'white',\n        width: 0.75\n      },\n      fill: { color: 'black' },\n      font: fontSizeAndStyle,\n      overflow: true,\n      offsetX: offsetX,\n      offsetY: offsetY\n    };\n\n    let igoStyleObject;\n\n    // if feature is a circle\n    if (feature.get('rad')) {\n      const coordinates = transform(\n        feature.getGeometry().flatCoordinates,\n        proj,\n        'EPSG:4326'\n      );\n      const radius =\n        feature.get('rad') /\n        Math.cos((Math.PI / 180) * coordinates[1]) /\n        resolution;\n      igoStyleObject = {\n        text: textIgoStyleObject,\n        circle: {\n          radius,\n          stroke: {\n            color: strokeColor ? strokeColor : this.strokeColor,\n            width: this.strokeWidth\n          },\n          fill: {\n            color: fillColor\n          }\n        }\n      };\n      feature.set('_style', igoStyleObject);\n\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: textToShow,\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n\n          font: fontSizeAndStyle,\n          overflow: true,\n          offsetX: offsetX,\n          offsetY: offsetY\n        }),\n\n        image: new OlStyle.Circle({\n          radius,\n          stroke: new OlStyle.Stroke({\n            color: strokeColor ? strokeColor : this.strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: fillColor\n          })\n        })\n      });\n      return style;\n\n      // if feature is an icon\n    } else if (icon) {\n      this.offsetY = -26;\n      textIgoStyleObject.offsetY = this.offsetY;\n      const igoStyleObject = {\n        text: textIgoStyleObject,\n        stroke: {\n          color: strokeColor,\n          width: this.strokeWidth\n        },\n        fill: {\n          color: fillColor\n        },\n        icon: {\n          src: icon\n        }\n      };\n      feature.set('_style', igoStyleObject);\n\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: fontSizeAndStyle,\n          overflow: true,\n          offsetX: offsetX,\n          offsetY: offsetY\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill: new OlStyle.Fill({\n          color: fillColor\n        }),\n\n        image: new OlStyle.Icon({\n          src: icon\n        })\n      });\n      return style;\n\n      // if feature is a point, a linestring or a polygon\n    } else {\n      this.offsetY = labelsAreOffset ? -15 : 0;\n\n      textIgoStyleObject.offsetY = this.offsetY;\n      const igoStyleObject = {\n        text: textIgoStyleObject,\n        stroke: {\n          color: strokeColor,\n          width: this.strokeWidth\n        },\n        fill: {\n          color: fillColor\n        },\n        circle: {\n          radius: 5,\n          stroke: {\n            color: strokeColor,\n            width: this.strokeWidth\n          },\n          fill: {\n            color: fillColor\n          }\n        }\n      };\n      feature.set('_style', igoStyleObject);\n\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: fontSizeAndStyle,\n          overflow: true,\n\n          offsetX: offsetX,\n          offsetY: offsetY\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill: new OlStyle.Fill({\n          color: fillColor\n        }),\n\n        image: new OlStyle.Circle({\n          radius: 5,\n          stroke: new OlStyle.Stroke({\n            color: strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: fillColor\n          })\n        })\n      });\n      return style;\n    }\n  }\n}\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoStyleListModule } from './style-list/style-list.module';\r\nimport { StyleModalDrawingComponent } from './style-modal/drawing/style-modal-drawing.component';\r\nimport { StyleModalLayerComponent } from './style-modal/layer/style-modal-layer.component';\r\nimport { StyleModalLayerButtonComponent } from './style-modal/layer-button/style-modal-layer-button.component';\r\nimport { DrawStyleService } from './style-service/draw-style.service';\r\nimport { StyleService } from './style-service/style.service';\r\nimport { MatDialogModule } from '@angular/material/dialog';\r\nimport { ColorPickerFormFieldModule } from '@igo2/common';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IgoLanguageModule,\r\n    MatFormFieldModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatDialogModule,\r\n    MatInputModule,\r\n    MatSelectModule,\r\n    MatTooltipModule,\r\n    ReactiveFormsModule,\r\n    ColorPickerFormFieldModule,\r\n    IgoStyleListModule.forRoot()\r\n  ],\r\n  exports: [\r\n    IgoStyleListModule,\r\n    StyleModalDrawingComponent,\r\n    StyleModalLayerComponent,\r\n    StyleModalLayerButtonComponent\r\n  ],\r\n  declarations: [\r\n    StyleModalDrawingComponent,\r\n    StyleModalLayerComponent,\r\n    StyleModalLayerButtonComponent\r\n  ]\r\n})\r\nexport class IgoStyleModule {\r\n  static forRoot(): ModuleWithProviders<IgoStyleModule> {\r\n    return {\r\n      ngModule: IgoStyleModule,\r\n      providers: [StyleService, DrawStyleService]\r\n    };\r\n  }\r\n}\r\n","import {\n  OnInit,\n  Directive,\n  Self,\n  HostListener,\n  ElementRef,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { FeatureDetailsComponent } from './feature-details.component';\n\nimport { BehaviorSubject } from 'rxjs';\n\n@Directive({\n  // This directive allow to view the route between the user coordinates and the feature\n  selector: '[igoFeatureDetailsDirective]'\n})\nexport class FeatureDetailsDirective implements OnInit {\n  private component: FeatureDetailsComponent;\n\n  get feature() {\n    return this.component.feature;\n  }\n  feature$ = new BehaviorSubject(undefined);\n\n  @Output() routingEvent = new EventEmitter<void>();\n\n  @HostListener('selectFeature')\n  setFeature() {\n    this.feature$.next(this.feature);\n  }\n\n  constructor(\n    @Self() component: FeatureDetailsComponent,\n    private el: ElementRef\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.feature$.subscribe(() => {\n      if (this.feature.geometry) {\n        this.bindClicking();\n      }\n    });\n  }\n\n  bindClicking() {\n    setTimeout(() => {\n      const routeElement = this.el.nativeElement.querySelector('span.routing');\n      if (routeElement) {\n        routeElement.addEventListener('click', () => {\n          this.routingEvent.emit();\n        });\n      }\n    }, 1);\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\n\nimport { OverlayDirective } from './shared/overlay.directive';\n\n@NgModule({\n  imports: [],\n  exports: [OverlayDirective],\n  declarations: [OverlayDirective]\n})\nexport class IgoOverlayModule {\n  static forRoot(): ModuleWithProviders<IgoOverlayModule> {\n    return {\n      ngModule: IgoOverlayModule\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\n\nimport { MessageService } from '@igo2/core';\n\nimport { Layer } from '../../layer/shared';\nimport {\n  OgcFilterWriter,\n  OgcFilterableDataSourceOptions\n} from '../../filter/shared';\n\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DownloadService {\n  constructor(private messageService: MessageService) {}\n\n  open(layer: Layer) {\n    this.messageService.success(\n      'igo.geo.download.start',\n      'igo.geo.download.title'\n    );\n\n    const DSOptions: DataSourceOptions = layer.dataSource.options;\n    if (Object.keys(DSOptions.download).length > 0) {\n      if (\n        DSOptions.download.dynamicUrl &&\n        DSOptions.download.url === undefined\n      ) {\n        let wfsOptions;\n        let currentProj = new olProjection({ code: layer.map.projection });\n        const paramsWFS = (layer.dataSource.options as any).paramsWFS;\n        if (paramsWFS && Object.keys(paramsWFS).length > 0) {\n          currentProj = paramsWFS.srsName\n            ? new olProjection({ code: paramsWFS.srsName })\n            : currentProj;\n          wfsOptions = (layer.dataSource.options as any).paramsWFS;\n        } else {\n          wfsOptions = (layer.dataSource.options as any).params;\n        }\n\n        const currentExtent = olproj.transformExtent(\n          layer.map.viewController.getExtent(),\n          new olProjection({ code: layer.map.projection }),\n          currentProj\n        );\n        const outputFormatDownload =\n          wfsOptions.outputFormatDownload === undefined\n            ? wfsOptions.outputFormat === undefined\n              ? ''\n              : 'outputformat=' + wfsOptions.outputFormat\n            : 'outputformat=' + wfsOptions.outputFormatDownload;\n\n        const baseurl = DSOptions.download.dynamicUrl\n          .replace(/&?outputformat=[^&]*/gi, '')\n          .replace(/&?filter=[^&]*/gi, '')\n          .replace(/&?bbox=[^&]*/gi, '');\n\n        const ogcFilters = (\n          layer.dataSource.options as OgcFilterableDataSourceOptions\n        ).ogcFilters;\n\n        let filterQueryString;\n        filterQueryString = new OgcFilterWriter().handleOgcFiltersAppliedValue(\n          layer.dataSource.options,\n          ogcFilters.geometryName,\n          currentExtent as [number, number, number, number],\n          currentProj\n        );\n        if (!filterQueryString) {\n          // Prevent getting all the features for empty filter\n          filterQueryString = new OgcFilterWriter().buildFilter(\n            undefined,\n            currentExtent as [number, number, number, number],\n            currentProj,\n            ogcFilters.geometryName\n          );\n        } else {\n          filterQueryString = 'filter=' + encodeURIComponent(filterQueryString);\n        }\n        window.open(\n          `${baseurl}&${filterQueryString}&${outputFormatDownload}`,\n          '_blank'\n        );\n      } else if (DSOptions.download) {\n        window.open(DSOptions.download.url, '_blank');\n      }\n    }\n  }\n}\n","<button\n  *ngIf=\"\n    options &&\n    options.download &&\n    (options.download['dynamicUrl'] || options.download['url'])\n  \"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\n  [color]=\"color\"\n  (click)=\"openDownload(layer)\"\n>\n  <mat-icon svgIcon=\"download\"></mat-icon>\n</button>\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { DownloadDataSourceOptions } from '../shared/download.interface';\nimport { DownloadService } from '../shared/download.service';\n\n@Component({\n  selector: 'igo-download-button',\n  templateUrl: './download-button.component.html',\n  styleUrls: ['./download-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DownloadButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(private downloadService: DownloadService) {}\n\n  openDownload(layer: Layer) {\n    this.downloadService.open(layer);\n  }\n\n  get options(): DownloadDataSourceOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.dataSource.options;\n  }\n}\n","export enum GeometryType {\n  Point = 'Point',\n  LineString = 'LineString',\n  Polygon = 'Polygon',\n  Circle = 'Circle'\n}\n\nexport enum LabelType {\n  Coordinates = 'Coordinates',\n  Length = 'Length',\n  Area = 'Area',\n  Predefined = 'Predefined',\n  Custom = 'Custom'\n}\n\nexport enum CoordinatesUnit {\n  DecimalDegree = 'DD',\n  DegreesMinutesSeconds = 'DMS'\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DrawIconService {\n  protected icons: Array<string>;\n\n  constructor(protected config: ConfigService) {\n    this.getIconsList();\n  }\n\n  getIcons() {\n    return this.icons;\n  }\n\n  getPath(): any {\n    return this.config.getConfig('drawingTool.icons') || [];\n  }\n\n  getIconsList() {\n    this.icons = this.getPath();\n  }\n}\n","import * as Olstyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport OlOverlay from 'ol/Overlay';\nimport {\n  updateOlGeometryMidpoints,\n  updateOlGeometryCenter\n} from '../../measure/shared/measure.utils';\nimport { CoordinatesUnit } from './draw.enum';\nimport { convertDDToDMS, roundCoordToString } from '../../map/shared/map.utils';\n\n/**\n * Create a default style\n * @param fillColor the fill color\n * @param strokeColor the stroke color\n * @param strokeWidth the stroke width\n * @param label a label\n * @returns OL style\n */\nexport function createInteractionStyle(\n  fillColor?: string,\n  strokeColor?: string,\n  strokeWidth?: number,\n  label?: string\n): Olstyle.Style {\n  return new Olstyle.Style({\n    stroke: new Olstyle.Stroke({\n      color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n      width: strokeWidth ? strokeWidth : 1\n    }),\n    fill: new Olstyle.Fill({\n      color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n    }),\n    image: new Olstyle.Circle({\n      radius: 5,\n      stroke: new Olstyle.Stroke({\n        color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n        width: strokeWidth ? strokeWidth : 1\n      }),\n      fill: new Olstyle.Fill({\n        color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n      })\n    })\n  });\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsDrawAtMidpoints(\n  olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle\n): OlOverlay[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({ _midpoints: olMidpoints }, true);\n  } else if (olGeometry instanceof OlCircle) {\n    const olMidpointPoint = new OlPoint(olGeometry.getCenter());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({ _midpoints: olMidpoints }, true);\n  } else {\n    olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipDrawAtPoint(olMidpoint);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipDrawAtCenter(\n  olGeometry: OlLineString | OlPolygon\n): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipDrawAtPoint(olCenter);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipDrawAtPoint(olPoint: OlPoint): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: ['igo-map-tooltip', 'igo-map-tooltip-draw'].join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n\nexport function DDtoDMS(\n  value: [number, number],\n  unit: CoordinatesUnit\n): string[] | undefined {\n  const conversionMapper = new Map([\n    [\n      CoordinatesUnit.DecimalDegree,\n      (val: [number, number]) => {\n        if (typeof val[0] === 'number') {\n          return roundCoordToString(val, 5) as string[];\n        } else {\n          const numVal: [number, number] = [Number(val[0]), Number(val[1])];\n          return roundCoordToString(numVal, 5) as string[];\n        }\n      }\n    ],\n    [\n      CoordinatesUnit.DegreesMinutesSeconds,\n      (val: [number, number]) => convertDDToDMS(val, 2)\n    ]\n  ]);\n  let conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n","<h2 mat-dialog-title>\n  {{ 'igo.geo.draw.popupTitle' | translate }}\n</h2>\n\n<ng-container *ngIf=\"labelFlag !== labelType.Custom\">\n  <div mat-dialog-content class=\"geometry-type-toggle\">\n    <div class=\"button-toggle-container\">\n      <mat-button-toggle-group\n        (change)=\"onLabelTypeChange($event.value)\"\n        [value]=\"customOrPredefined\"\n      >\n        <mat-button-toggle [value]=\"labelType.Custom\">\n          {{ 'igo.geo.draw.labelType.custom' | translate }}\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"labelType.Predefined\">\n          {{ 'igo.geo.draw.labelType.predefined' | translate }}\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n    <div>\n      <p>\n        {{ 'igo.geo.draw.builtInInstructions' | translate }}\n      </p>\n      <mat-radio-group *ngIf=\"olGeometryType !== 'Polygon'\">\n        <mat-radio-button\n          *ngFor=\"let option of arrayBuiltInType\"\n          [value]=\"option.value\"\n          [disabled]=\"optionAvailable(option.value)\"\n          (change)=\"onLabelTypeChange($event.value)\"\n          [checked]=\"option.checked\"\n        >\n          {{ getProperLengthLabel(option.value) }}\n        </mat-radio-button>\n      </mat-radio-group>\n      <ng-container *ngIf=\"olGeometryType === 'Polygon'\">\n        <mat-checkbox\n          *ngFor=\"let option of arrayBuiltInType\"\n          class=\"mat-typography\"\n          [value]=\"option.value\"\n          [disabled]=\"optionAvailable(option.value)\"\n          (change)=\"onLabelTypeChange($event.source.value, $event.checked)\"\n          [checked]=\"option.checked\"\n        >\n          {{ getProperLengthLabel(option.value) }}\n        </mat-checkbox>\n      </ng-container>\n      <div *ngIf=\"labelFlag === labelType.Coordinates\" class=\"fields-container\">\n        <mat-form-field class=\"readOnly-Input\">\n          <mat-label>(Latitude, Longitude)</mat-label>\n          <input\n            #input\n            matInput\n            placeholder=\"(Latitude, Longitude)\"\n            value=\"{{ currentCoordinates }}\"\n            readonly\n          />\n        </mat-form-field>\n        <mat-form-field class=\"unit-field\">\n          <mat-select\n            [value]=\"coordinatesMeasureUnit\"\n            (selectionChange)=\"onChangeCoordinateUnit($event.value)\"\n          >\n            <mat-option *ngFor=\"let unit of allCoordinatesUnits\" [value]=\"unit\">\n              {{ unit }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <div\n        *ngIf=\"labelFlag === labelType.Length || polygonCheck === 2\"\n        class=\"fields-container\"\n      >\n        <mat-form-field class=\"readOnly-Input\">\n          <mat-label>{{ lengthLabelT }}</mat-label>\n          <input\n            #input\n            matInput\n            placeholder=\"{{ lengthLabelT }}\"\n            value=\"{{ currentLength }}\"\n            readonly\n          />\n        </mat-form-field>\n        <mat-form-field class=\"unit-field\">\n          <mat-select\n            [value]=\"lengthMeasureUnit\"\n            (selectionChange)=\"onChangeLengthUnit($event.value)\"\n          >\n            <mat-option *ngFor=\"let unit of allLengthUnits\" [value]=\"unit\">\n              {{ getLengthUnitEnum(unit) }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <div\n        *ngIf=\"labelFlag === labelType.Area || polygonCheck === 2\"\n        class=\"fields-container\"\n      >\n        <mat-form-field class=\"readOnly-Input\">\n          <mat-label>{{ 'igo.geo.draw.labelType.Area' | translate }}</mat-label>\n          <input\n            #input\n            matInput\n            placeholder=\"{{ 'igo.geo.draw.labelType.Area' | translate }}\"\n            value=\"{{ currentArea }}\"\n            readonly\n          />\n        </mat-form-field>\n        <mat-form-field class=\"unit-field\">\n          <mat-select\n            [value]=\"areaMeasureUnit\"\n            (selectionChange)=\"onChangeAreaUnit($event.value)\"\n          >\n            <mat-option *ngFor=\"let unit of allAreaUnits\" [value]=\"unit\">\n              {{ getAreaUnitEnum(unit) }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n    </div>\n  </div>\n\n  <div mat-dialog-actions>\n    <button mat-raised-button (click)=\"cancelDrawing()\">\n      {{ 'igo.geo.draw.cancel' | translate }}\n    </button>\n    <button mat-raised-button color=\"primary\" (click)=\"confirm()\">\n      {{ noLabelButton() }}\n    </button>\n  </div>\n</ng-container>\n\n<ng-container *ngIf=\"labelFlag === labelType.Custom\">\n  <div mat-dialog-content class=\"geometry-type-toggle\">\n    <div class=\"button-toggle-container\">\n      <mat-button-toggle-group\n        (change)=\"onLabelTypeChange($event.value)\"\n        [value]=\"customOrPredefined\"\n      >\n        <mat-button-toggle [value]=\"labelType.Custom\">\n          {{ 'igo.geo.draw.labelType.custom' | translate }}\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"labelType.Predefined\">\n          {{ 'igo.geo.draw.labelType.predefined' | translate }}\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n    <p>\n      {{ 'igo.geo.draw.dialogInstruction' | translate }}\n    </p>\n    <mat-form-field class=\"input\">\n      <mat-label>{{ 'igo.geo.draw.dialogTitle' | translate }}</mat-label>\n      <input\n        #input\n        matInput\n        (select)=\"(true)\"\n        (input)=\"getLabelLength($event.target.value)\"\n        placeholder=\"{{ 'igo.geo.draw.dialogTitle' | translate }}\"\n        value=\"{{ currentLabel }}\"\n        cdkFocusInitial\n      />\n    </mat-form-field>\n  </div>\n\n  <div mat-dialog-actions>\n    <button mat-raised-button (click)=\"cancelDrawing()\">\n      {{ 'igo.geo.draw.cancel' | translate }}\n    </button>\n    <button mat-raised-button color=\"primary\" (click)=\"confirm(input.value)\">\n      {{ noLabelButton() }}\n    </button>\n  </div>\n</ng-container>\n","import { Component, Inject, Input } from '@angular/core';\nimport { LanguageService } from '@igo2/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { CoordinatesUnit, GeometryType, LabelType } from '../shared/draw.enum';\nimport { transform } from 'ol/proj';\nimport { IgoMap, roundCoordTo } from '../../map/shared';\nimport OlFeature from 'ol/Feature';\nimport {\n  measureOlGeometryLength,\n  measureOlGeometryArea,\n  metersToUnit,\n  squareMetersToUnit\n} from '../../measure/shared/measure.utils';\nimport {\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation,\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation\n} from '../../measure/shared/measure.enum';\n\nimport { fromCircle } from 'ol/geom/Polygon';\nimport { getLength } from 'ol/sphere';\nimport Circle from 'ol/geom/Circle';\nimport { DDtoDMS } from '../shared/draw.utils';\n\n@Component({\n  selector: 'igo-draw-popup-component',\n  templateUrl: './draw-popup.component.html',\n  styleUrls: ['./draw-popup.component.scss']\n})\nexport class DrawPopupComponent {\n  @Input() confirmFlag: boolean = false;\n  @Input() labelFlag: LabelType | [LabelType, LabelType] = LabelType.Custom;\n  @Input() coordinatesMeasureUnit: CoordinatesUnit;\n  @Input() lengthMeasureUnit: MeasureLengthUnit;\n  @Input() areaMeasureUnit: MeasureAreaUnit;\n\n  public geometryType = GeometryType;\n  public labelType = LabelType;\n  public arrayBuiltInType: any[] = [];\n\n  public currentLabel: string;\n  public currentCoordinates: string;\n  public currentArea: string;\n  public currentLength: string;\n\n  public olGeometryType: GeometryType = undefined;\n  public lengthInMeters: string;\n  public areaInMetersSquare: string;\n  public coordinatesInDD: string;\n  public currentCoordinatesUnit: string;\n\n  private longlatDD: [number, number];\n  private labelLength: number;\n\n  public polygonCheck = 0; // Count for polygon label types checkboxes\n\n  constructor(\n    private languageService: LanguageService,\n    public dialogRef: MatDialogRef<DrawPopupComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: { olGeometry: any; map: IgoMap }\n  ) {\n    this.currentLabel = this.data.olGeometry.get('draw');\n    this.labelLength = this.currentLabel ? this.currentLabel.length : 0;\n    let olGeometry;\n\n    const projection = this.data.map.ol.getView().getProjection();\n\n    if (this.data.olGeometry instanceof OlFeature) {\n      if (this.data.olGeometry.get('rad')) {\n        const longitudeLatitude = [\n          this.data.olGeometry.get('longitude'),\n          this.data.olGeometry.get('latitude')\n        ];\n        this.olGeometryType = GeometryType.Circle;\n        olGeometry = new Circle(\n          longitudeLatitude,\n          this.data.olGeometry.get('rad')\n        );\n      } else {\n        this.olGeometryType = this.data.olGeometry.getGeometry().getType();\n        olGeometry = this.data.olGeometry.get('geometry');\n      }\n    } else {\n      this.olGeometryType = this.data.olGeometry.getType();\n      olGeometry = this.data.olGeometry;\n    }\n\n    if (\n      this.olGeometryType === GeometryType.Point ||\n      this.olGeometryType === GeometryType.Circle\n    ) {\n      if (this.data.olGeometry instanceof OlFeature) {\n        let longitude = this.data.olGeometry.get('longitude');\n        let latitude = this.data.olGeometry.get('latitude');\n        this.longlatDD = roundCoordTo([longitude, latitude], 5);\n        this.coordinatesInDD = '(' + latitude + ', ' + longitude + ')';\n      } else {\n        let point4326 = transform(\n          this.data.olGeometry.getFlatCoordinates(),\n          projection,\n          'EPSG:4326'\n        );\n        this.longlatDD = roundCoordTo([point4326[0], point4326[1]], 5);\n        this.coordinatesInDD =\n          '(' + this.longlatDD[1] + ', ' + this.longlatDD[0] + ')';\n      }\n      this.currentCoordinates = this.coordinatesInDD;\n    }\n    if (this.olGeometryType === GeometryType.LineString) {\n      this.lengthInMeters = measureOlGeometryLength(\n        olGeometry,\n        projection.getCode()\n      ).toFixed(2);\n      this.currentLength = this.lengthInMeters;\n    } else if (this.olGeometryType === GeometryType.Polygon) {\n      this.lengthInMeters = measureOlGeometryLength(\n        olGeometry,\n        projection.getCode()\n      ).toFixed(2);\n      this.currentLength = this.lengthInMeters;\n      this.areaInMetersSquare = measureOlGeometryArea(\n        olGeometry,\n        projection.getCode()\n      ).toFixed(2);\n      this.currentArea = this.areaInMetersSquare;\n    } else if (this.olGeometryType === GeometryType.Circle) {\n      let circularPolygon = fromCircle(olGeometry, 10000);\n      const radius = this.getRadius(circularPolygon);\n      this.lengthInMeters = radius.toFixed(2);\n      this.currentLength = this.lengthInMeters;\n      this.areaInMetersSquare = measureOlGeometryArea(\n        circularPolygon,\n        projection.getCode()\n      ).toFixed(2);\n      this.currentArea = this.areaInMetersSquare;\n    }\n\n    if (data.olGeometry.get('labelType') === LabelType.Coordinates) {\n      this.onLabelTypeChange(LabelType.Predefined);\n      this.onLabelTypeChange(LabelType.Coordinates, true);\n      this.coordinatesMeasureUnit = data.olGeometry.get('measureUnit');\n    } else if (data.olGeometry.get('labelType') === LabelType.Length) {\n      this.onLabelTypeChange(LabelType.Predefined);\n      this.onLabelTypeChange(LabelType.Length, true);\n      this.lengthMeasureUnit = data.olGeometry.get('measureUnit');\n    } else if (data.olGeometry.get('labelType') === LabelType.Area) {\n      this.onLabelTypeChange(LabelType.Predefined);\n      this.onLabelTypeChange(LabelType.Area, true);\n      this.areaMeasureUnit = data.olGeometry.get('measureUnit');\n    } else if (data.olGeometry.get('labelType')?.length === 2) {\n      this.onLabelTypeChange(LabelType.Predefined);\n      this.onLabelTypeChange(LabelType.Length, true);\n      this.onLabelTypeChange(LabelType.Area, true);\n      this.lengthMeasureUnit = data.olGeometry.get('measureUnit')[0];\n      this.areaMeasureUnit = data.olGeometry.get('measureUnit')[1];\n    }\n    this.buildArrayType();\n  }\n\n  /**\n   * HTML Interactions\n   */\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n\n  confirm(input?: string) {\n    this.confirmFlag = true;\n    if (this.labelFlag === LabelType.Predefined) {\n      this.dialogRef.close();\n    } else if (this.labelFlag === LabelType.Custom) {\n      this.dialogRef.close({\n        label: input\n      });\n    } else if (this.labelFlag === LabelType.Coordinates) {\n      this.dialogRef.close({\n        label: this.currentCoordinates,\n        measureUnit: this.coordinatesMeasureUnit\n      });\n    } else if (this.olGeometryType === GeometryType.Polygon) {\n      if (this.polygonCheck === 2) {\n        this.labelFlag = [LabelType.Length, LabelType.Area];\n        this.dialogRef.close({\n          label:\n            'P: ' +\n            this.currentLength +\n            ' ' +\n            MeasureLengthUnitAbbreviation[MeasureLengthUnit.Meters] +\n            '\\n' +\n            this.languageService.translate.instant('igo.geo.draw.labelType.A') +\n            this.currentArea +\n            ' ' +\n            MeasureAreaUnitAbbreviation[MeasureAreaUnit.SquareMeters],\n          measureUnit: [this.lengthMeasureUnit, this.areaMeasureUnit]\n        });\n      } else {\n        this.labelFlag === LabelType.Length\n          ? this.dialogRef.close({\n              label:\n                'P: ' +\n                this.currentLength +\n                ' ' +\n                MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\n              measureUnit: this.lengthMeasureUnit\n            })\n          : this.dialogRef.close({\n              label:\n                this.currentArea +\n                ' ' +\n                MeasureAreaUnitAbbreviation[this.areaMeasureUnit],\n              measureUnit: this.areaMeasureUnit\n            });\n      }\n    } else if (this.labelFlag === LabelType.Length) {\n      if (this.olGeometryType === GeometryType.Circle) {\n        this.dialogRef.close({\n          label:\n            'R: ' +\n            this.currentLength +\n            ' ' +\n            MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\n          measureUnit: this.lengthMeasureUnit\n        });\n      } else if (this.olGeometryType === GeometryType.LineString) {\n        this.dialogRef.close({\n          label:\n            this.currentLength +\n            ' ' +\n            MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\n          measureUnit: this.lengthMeasureUnit\n        });\n      }\n    } else if (this.labelFlag === LabelType.Area) {\n      this.dialogRef.close({\n        label:\n          this.currentArea +\n          ' ' +\n          MeasureAreaUnitAbbreviation[this.areaMeasureUnit],\n        measureUnit: this.areaMeasureUnit\n      });\n    }\n  }\n\n  onLabelTypeChange(labelType: LabelType, checked?: boolean) {\n    if (\n      labelType !== LabelType.Predefined &&\n      labelType !== LabelType.Custom &&\n      this.olGeometryType === GeometryType.Polygon\n    ) {\n      this.arrayBuiltInType.find((type) => type.value === labelType)\n        ? (this.arrayBuiltInType.find(\n            (type) => type.value === labelType\n          ).checked = checked)\n        : (this.labelFlag = undefined);\n      checked\n        ? (this.labelFlag = labelType)\n        : (this.labelFlag = this.arrayBuiltInType.find((type) => type.checked)\n            ?.value);\n    } else {\n      this.labelFlag = labelType;\n    }\n\n    if (labelType === LabelType.Predefined) {\n      if (this.olGeometryType === GeometryType.Point) {\n        this.labelFlag = LabelType.Coordinates;\n        this.currentCoordinates = this.coordinatesInDD;\n        this.coordinatesMeasureUnit = CoordinatesUnit.DecimalDegree;\n      } else if (this.olGeometryType === GeometryType.LineString) {\n        this.labelFlag = LabelType.Length;\n        this.currentLength = this.lengthInMeters;\n        this.lengthMeasureUnit = MeasureLengthUnit.Meters;\n      }\n    } else if (labelType === LabelType.Area) {\n      this.currentArea = this.areaInMetersSquare;\n      this.areaMeasureUnit = MeasureAreaUnit.SquareMeters;\n    } else if (labelType === LabelType.Length) {\n      this.currentLength = this.lengthInMeters;\n      this.lengthMeasureUnit = MeasureLengthUnit.Meters;\n    } else if (this.labelFlag === LabelType.Coordinates) {\n      this.currentCoordinates = this.coordinatesInDD;\n      this.coordinatesMeasureUnit = CoordinatesUnit.DecimalDegree;\n    }\n\n    const labeltypes = [this.labelType.Length, this.labelType.Area];\n    if (\n      this.olGeometryType === GeometryType.Polygon &&\n      labeltypes.includes(labelType)\n    ) {\n      checked ? (this.polygonCheck += 1) : (this.polygonCheck -= 1);\n    } else {\n      this.polygonCheck = 0;\n    }\n  }\n\n  onChangeLengthUnit(lengthUnit: MeasureLengthUnit) {\n    this.lengthMeasureUnit = lengthUnit;\n    this.currentLength = metersToUnit(\n      Number(this.lengthInMeters),\n      lengthUnit\n    ).toFixed(2);\n  }\n\n  onChangeAreaUnit(areaUnit: MeasureAreaUnit) {\n    this.areaMeasureUnit = areaUnit;\n    this.currentArea = squareMetersToUnit(\n      Number(this.areaInMetersSquare),\n      areaUnit\n    ).toFixed(2);\n  }\n\n  onChangeCoordinateUnit(coordinatesUnit: CoordinatesUnit) {\n    this.coordinatesMeasureUnit = coordinatesUnit;\n    let coordinates = DDtoDMS(this.longlatDD, coordinatesUnit);\n    this.currentCoordinates =\n      '(' + coordinates[1] + ', ' + coordinates[0] + ')';\n  }\n\n  buildArrayType() {\n    for (const labelType of Object.values(LabelType)) {\n      if (\n        labelType !== LabelType.Custom &&\n        labelType !== LabelType.Predefined\n      ) {\n        this.arrayBuiltInType.push({\n          value: labelType,\n          checked:\n            this.selectOptions(labelType) ||\n            this.labelFlag === labelType ||\n            (this.polygonCheck === 2 && labelType !== LabelType.Coordinates)\n        });\n      }\n    }\n  }\n\n  noLabelButton() {\n    if (\n      this.labelFlag === LabelType.Predefined ||\n      (this.labelFlag === LabelType.Custom && this.labelLength === 0)\n    ) {\n      return this.languageService.translate.instant('igo.geo.draw.noLabel');\n    }\n\n    return 'OK';\n  }\n\n  get customOrPredefined() {\n    if (this.labelFlag === LabelType.Custom) {\n      return LabelType.Custom;\n    }\n    return LabelType.Predefined;\n  }\n\n  optionAvailable(currentOption: LabelType) {\n    switch (this.olGeometryType) {\n      case GeometryType.Point:\n        if (currentOption === LabelType.Coordinates) {\n          return false;\n        }\n        return true;\n      case GeometryType.LineString:\n        if (currentOption === LabelType.Length) {\n          return false;\n        }\n        return true;\n      case GeometryType.Polygon:\n        if (currentOption === LabelType.Coordinates) {\n          return true;\n        }\n        return false;\n      default:\n        return false;\n    }\n  }\n\n  get allLengthUnits(): string[] {\n    return Object.values(MeasureLengthUnit);\n  }\n\n  getLengthUnitEnum(lengthUnit: MeasureLengthUnit) {\n    return MeasureLengthUnitAbbreviation[lengthUnit];\n  }\n\n  get allAreaUnits(): string[] {\n    return Object.values(MeasureAreaUnit);\n  }\n\n  get allCoordinatesUnits(): string[] {\n    return Object.values(CoordinatesUnit);\n  }\n\n  getAreaUnitEnum(areaUnit: MeasureAreaUnit) {\n    return MeasureAreaUnitAbbreviation[areaUnit];\n  }\n\n  private getRadius(olGeometry): number {\n    const length = getLength(olGeometry);\n    return Number(length / (2 * Math.PI));\n  }\n\n  get lengthLabelT() {\n    if (this.olGeometryType === GeometryType.Polygon) {\n      return this.languageService.translate.instant(\n        'igo.geo.measure.perimeter'\n      );\n    }\n    if (this.olGeometryType === GeometryType.Circle) {\n      return this.languageService.translate.instant(\n        'igo.geo.search.coordinates.radius'\n      );\n    }\n    return this.languageService.translate.instant(\n      'igo.geo.draw.labelType.Length'\n    );\n  }\n\n  getLabelLength(event?) {\n    this.labelLength = event.length;\n  }\n\n  selectOptions(option) {\n    if (this.olGeometryType === GeometryType.Point) {\n      return option === LabelType.Coordinates;\n    } else if (this.olGeometryType === GeometryType.LineString) {\n      return option === LabelType.Length;\n    }\n  }\n\n  getProperLengthLabel(option) {\n    if (option === LabelType.Length) {\n      if (this.olGeometryType === GeometryType.Polygon) {\n        return this.languageService.translate.instant(\n          'igo.geo.measure.perimeter'\n        );\n      }\n      if (this.olGeometryType === GeometryType.Circle) {\n        return this.languageService.translate.instant(\n          'igo.geo.search.coordinates.radius'\n        );\n      }\n      return this.languageService.translate.instant(\n        'igo.geo.draw.labelType.Length'\n      );\n    }\n    return this.languageService.translate.instant(\n      'igo.geo.draw.labelType.' + option\n    );\n  }\n}\n","import { Component } from '@angular/core';\n\n@Component({\n  selector: 'igo-draw-shorcuts',\n  templateUrl: './draw-shorcuts.component.html',\n  styleUrls: ['./draw-shorcuts.component.scss']\n})\nexport class DrawShorcutsComponent {}\n","<mat-dialog-content>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-return\"></mat-icon\n      >{{ 'igo.geo.draw.finish' | translate }}</span\n    >\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"backspace-outline\"></mat-icon\n      >{{ 'igo.geo.draw.undo' | translate }}</span\n    >\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-esc\"></mat-icon\n      >{{ 'igo.geo.draw.abort' | translate }}</span\n    >\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-space\"></mat-icon\n      >{{ 'igo.geo.draw.move' | translate }}</span\n    >\n  </div>\n</mat-dialog-content>\n<mat-dialog-actions class=\"shortcuts-close\">\n  <button mat-raised-button mat-dialog-close color=\"primary\">OK</button>\n</mat-dialog-actions>\n","<h2 mat-dialog-title>\n  {{ 'igo.geo.style.styleModal' | translate }}\n</h2>\n<div\n  class=\"edition-drawing\"\n  mat-dialog-content\n  [hidden]=\"data.features.length === 0\"\n>\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <div class=\"color-picker\">\n      <ng-container *ngIf=\"linestringOnly !== true\">\n        <span>\n          <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square\"></mat-icon>\n          {{ 'igo.geo.style.fill' | translate }}\n        </span>\n        <igo-color-picker-form-field\n          formControlName=\"fill\"\n          outputFormat=\"rgba\"\n          setAlpha=\".4\"\n          (open)=\"openPicker()\"\n          (close)=\"closePicker()\"\n          [color]=\"getFeatureFillColor()\"\n        ></igo-color-picker-form-field>\n      </ng-container>\n\n      <span>\n        <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square-outline\">\n        </mat-icon>\n        {{ 'igo.geo.style.stroke' | translate }}\n      </span>\n\n      <igo-color-picker-form-field\n        formControlName=\"stroke\"\n        outputFormat=\"rgba\"\n        setAlpha=\"1\"\n        (open)=\"openPicker()\"\n        (close)=\"closePicker()\"\n        [color]=\"getFeatureStrokeColor()\"\n      ></igo-color-picker-form-field>\n    </div>\n\n    <div class=\"igo-input-container\">\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.style.fontSize' | translate }}</mat-label>\n        <input\n          matInput\n          #testFontSize\n          type=\"number\"\n          placeholder=\"10\"\n          min=\"10\"\n          onkeydown=\"return event.keyCode !== 69\"\n          [value]=\"getFeatureFontSize()\"\n          (input)=\"styleModalData.fontSize = $event.target.value\"\n        />\n        <span matTextSuffix>px</span>\n      </mat-form-field>\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.style.fontStyle' | translate }}</mat-label>\n        <mat-select\n          #testFontStyle\n          [value]=\"getFeatureFontStyle()\"\n          (selectionChange)=\"styleModalData.fontStyle = $event.value\"\n        >\n          <mat-option\n            *ngFor=\"let fontSelect of allFontStyles\"\n            [value]=\"fontSelect\"\n          >\n            {{ fontSelect }}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.style.offsetX' | translate }}</mat-label>\n        <input\n          matInput\n          #offsetXInput\n          type=\"number\"\n          onkeydown=\"return event.keyCode !== 69\"\n          [value]=\"getFeatureOffsetX()\"\n          (input)=\"styleModalData.offsetX = $event.target.value\"\n        />\n      </mat-form-field>\n      <mat-form-field class=\"igo-form-input-box\" subscriptSizing=\"dynamic\">\n        <mat-label>{{ 'igo.geo.style.offsetY' | translate }}</mat-label>\n        <input\n          matInput\n          #offsetYInput\n          type=\"number\"\n          onkeydown=\"return event.keyCode !== 69\"\n          [value]=\"getFeatureOffsetY()\"\n          (input)=\"styleModalData.offsetY = $event.target.value\"\n        />\n      </mat-form-field>\n    </div>\n  </form>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button (click)=\"cancelDrawing()\">\n    {{ 'igo.geo.style.cancel' | translate }}\n  </button>\n  <button mat-raised-button color=\"primary\" (click)=\"confirm()\">OK</button>\n</div>\n","import { Component, Inject, Input, OnInit } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { UntypedFormGroup, UntypedFormBuilder } from '@angular/forms';\n\nimport { DrawStyleService } from '../../style-service/draw-style.service';\nimport { FontType } from '../../shared/font.enum';\nimport {\n  DrawingMatDialogData,\n  StyleModalData\n} from '../shared/style-modal.interface';\n\n@Component({\n  selector: 'igo-style-modal-drawing',\n  templateUrl: './style-modal-drawing.component.html',\n  styleUrls: ['./style-modal-drawing.component.scss']\n})\nexport class StyleModalDrawingComponent implements OnInit {\n  @Input() confirmFlag: boolean = false;\n\n  public form: UntypedFormGroup;\n\n  public styleModalData: StyleModalData;\n  public linestringOnly: boolean;\n\n  constructor(\n    public dialogRef: MatDialogRef<StyleModalDrawingComponent>,\n    private formBuilder: UntypedFormBuilder,\n    private drawStyleService: DrawStyleService,\n    @Inject(MAT_DIALOG_DATA) public data: DrawingMatDialogData\n  ) {\n    this.buildForm();\n  }\n\n  ngOnInit() {\n    this.linestringOnly = true;\n    for (const feature of this.data.features) {\n      if (feature.geometry.type !== 'LineString') {\n        this.linestringOnly = false;\n      }\n    }\n    this.buildStyleData();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [''],\n      stroke: ['']\n    });\n  }\n\n  private buildStyleData() {\n    this.styleModalData = {\n      fillColor:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.drawingStyle.fill\n          : 'rgba(255,255,255,0.4)',\n      strokeColor:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.drawingStyle.stroke\n          : 'rgba(143,7,7,1)',\n      fontSize:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.fontStyle\n              .split(' ')[0]\n              .replace('px', '')\n          : '20',\n      fontStyle:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.fontStyle.substring(\n              this.data.features[0].properties.fontStyle.indexOf(' ') + 1\n            )\n          : FontType.Arial,\n      offsetX:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.offsetX\n          : this.drawStyleService.getOffsetX(),\n      offsetY:\n        this.data.features.length > 0\n          ? this.data.features[0].properties.offsetY\n          : this.drawStyleService.getOffsetY()\n    };\n  }\n\n  get allFontStyles(): string[] {\n    return Object.values(FontType);\n  }\n\n  getFeatureFontSize(): string {\n    if (!this.styleModalData.fontSize) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.fontStyle\n            .split(' ')[0]\n            .replace('px', '')\n        : '20';\n    } else {\n      return this.styleModalData.fontSize;\n    }\n  }\n\n  getFeatureFontStyle() {\n    if (!this.styleModalData.fontStyle) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.fontStyle.substring(\n            this.data.features[0].properties.fontStyle.indexOf(' ') + 1\n          )\n        : FontType.Arial;\n    } else {\n      return this.styleModalData.fontStyle;\n    }\n  }\n\n  getFeatureFillColor() {\n    if (!this.styleModalData.fillColor) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.drawingStyle.fill\n        : 'rgba(255,255,255,0.4)';\n    } else {\n      return this.styleModalData.fillColor;\n    }\n  }\n\n  getFeatureStrokeColor() {\n    if (!this.styleModalData.strokeColor) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.drawingStyle.stroke\n        : 'rgba(143,7,7,1)';\n    } else {\n      return this.styleModalData.strokeColor;\n    }\n  }\n\n  getFeatureOffsetX() {\n    if (!this.styleModalData.offsetX) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.offsetX\n        : this.drawStyleService.getOffsetX();\n    } else {\n      return this.styleModalData.offsetX;\n    }\n  }\n\n  getFeatureOffsetY() {\n    if (!this.styleModalData.offsetY) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.offsetY\n        : this.drawStyleService.getOffsetY();\n    } else {\n      return this.styleModalData.offsetY;\n    }\n  }\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n\n  confirm() {\n    this.confirmFlag = true;\n    if (this.form.get('fill').value) {\n      this.styleModalData.fillColor = this.form.get('fill').value;\n    }\n\n    if (this.form.get('stroke').value) {\n      this.styleModalData.strokeColor = this.form.get('stroke').value;\n    }\n    this.dialogRef.close(this.styleModalData);\n  }\n\n  openPicker() {\n    this.dialogRef.disableClose = true;\n  }\n\n  closePicker() {\n    this.dialogRef.disableClose = false;\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\nexport interface DialogData {\n  label: string;\n}\n\n@Component({\n  selector: 'igo-draw-popup-component',\n  templateUrl: './draw-layer-popup.component.html',\n  styleUrls: ['./draw-layer-popup.component.scss']\n})\nexport class DrawLayerPopupComponent {\n  @Input() confirmFlag: boolean = false;\n\n  constructor(public dialogRef: MatDialogRef<DrawLayerPopupComponent>) {}\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n  confirm(labelString: string) {\n    this.confirmFlag = true;\n    this.dialogRef.close(labelString);\n  }\n}\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">\n    {{ 'igo.geo.draw.layer.layerDialogInstruction' | translate }}\n  </p>\n  <mat-form-field class=\"example-full-width\">\n    <input\n      #input\n      matInput\n      placeholder=\"{{ 'igo.geo.draw.layer.title' | translate }}\"\n    />\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button (click)=\"cancelDrawing()\">\n    {{ 'igo.geo.draw.cancel' | translate }}\n  </button>\n  <button mat-raised-button color=\"primary\" (click)=\"confirm(input.value)\">\n    OK\n  </button>\n</div>\n","<div>\n  <div class=\"geometry-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      (change)=\"onGeometryTypeChange($event.value)\"\n      [value]=\"geometryType.Point\"\n    >\n      <mat-button-toggle [value]=\"geometryType.Point\">\n        {{ 'igo.geo.draw.' + geometryType.Point | translate }}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.LineString\">\n        {{ 'igo.geo.draw.' + geometryType.LineString | translate }}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Polygon\">\n        {{ 'igo.geo.draw.' + geometryType.Polygon | translate }}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Circle\">\n        {{ 'igo.geo.draw.' + geometryType.Circle | translate }}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"draw-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\"\n    >\n      {{ 'igo.geo.draw.drawControl' | translate }}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      [checked]=\"labelsAreShown\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleLabels()\"\n    >\n      {{ 'igo.geo.draw.toggleMapTooltips' | translate }}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      *ngIf=\"!isPoint()\"\n      [checked]=\"freehandMode\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleFreehandMode($event)\"\n    >\n      {{ 'igo.geo.draw.freehandMode' | translate }}\n    </mat-slide-toggle>\n\n    <div class=\"radius-unit\" *ngIf=\"isCircle()\">\n      <form class=\"radius-form\">\n        <mat-form-field class=\"radius\">\n          <input\n            matInput\n            type=\"number\"\n            min=\"0\"\n            placeholder=\"{{ 'igo.geo.spatialFilter.radius' | translate }}\"\n            [formControl]=\"radiusFormControl\"\n            [readonly]=\"this.freehandMode\"\n          />\n        </mat-form-field>\n      </form>\n\n      <mat-form-field class=\"unit-field\">\n        <mat-select\n          [value]=\"measureUnit\"\n          (selectionChange)=\"onMeasureUnitChange($event.value)\"\n        >\n          <mat-option\n            *ngFor=\"let measureUnit of measureUnits\"\n            [value]=\"measureUnit\"\n          >\n            {{ 'igo.geo.measure.' + measureUnit | translate }}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n\n  <mat-divider></mat-divider>\n\n  <div class=\"layer-select-container\">\n    <mat-form-field class=\"layer-select\" subscriptSizing=\"dynamic\">\n      <mat-label>{{ 'igo.geo.draw.layer.title' | translate }}</mat-label>\n      <mat-select\n        #selectedLayer\n        (selectionChange)=\"onLayerChange(selectedLayer.value)\"\n        [value]=\"updateActiveLayer()\"\n      >\n        <mat-option *ngFor=\"let layer of allLayers\" [value]=\"layer\">\n          {{ layer.title }}\n        </mat-option>\n        <mat-option id=\"createNewLayer\">\n          {{ 'igo.geo.draw.layer.createNewLayer' | translate }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <button\n      *ngIf=\"activeDrawingLayer\"\n      mat-icon-button\n      [color]=\"activeDrawingLayer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"\n        activeDrawingLayer.visible\n          ? ('igo.geo.layer.hideLayer' | translate)\n          : ('igo.geo.layer.showLayer' | translate)\n      \"\n      (click)=\"activeDrawingLayer.visible = !activeDrawingLayer.visible\"\n    >\n      <mat-icon [svgIcon]=\"activeDrawingLayer.visible ? 'eye' : 'eye-off'\">\n      </mat-icon>\n    </button>\n  </div>\n  <mat-divider></mat-divider>\n  <div>\n    <button\n      *ngIf=\"activeStore.count$.getValue() > 0\"\n      class=\"deleteBtn\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.draw.delete' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      (click)=\"deleteDrawings()\"\n    >\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <div>\n      <igo-entity-table\n        #table\n        class=\"table-compact\"\n        [store]=\"activeStore\"\n        [template]=\"tableTemplate\"\n      >\n      </igo-entity-table>\n    </div>\n  </div>\n\n  <div class=\"icon-options\">\n    <mat-form-field *ngIf=\"icons.length >= 1\">\n      <mat-label>{{ 'igo.geo.draw.icon' | translate }}</mat-label>\n      <mat-select>\n        <mat-select-trigger>\n          <div *ngIf=\"icon\" class=\"box\">\n            <img src=\"{{ icon }}\" />\n          </div>\n        </mat-select-trigger>\n        <mat-option value=\"\" (click)=\"onIconChange()\">{{\n          'igo.geo.draw.noIcon' | translate\n        }}</mat-option>\n        <mat-option\n          *ngFor=\"let icon_html of icons\"\n          [value]=\"icon_html\"\n          (click)=\"onIconChange(icon_html)\"\n        >\n          <div class=\"box\">\n            <img src=\"{{ icon_html }}\" />\n          </div>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"actions-container\">\n    <button\n      mat-icon-button\n      color=\"accent\"\n      disableRipple=\"true\"\n      (click)=\"openShorcutsDialog()\"\n    >\n      <mat-icon\n        class=\"shortcuts-icon\"\n        svgIcon=\"keyboard-outline\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.draw.shortcuts' | translate\"\n      >\n      </mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"selectedFeatures$.value.length\"\n      mat-raised-button\n      color=\"primary\"\n      (click)=\"openStyleModalDialog()\"\n      [matTooltip]=\"'igo.geo.style.styleModalTooltipSelected' | translate\"\n    >\n      {{ 'igo.geo.style.styleModal' | translate }}\n      <mat-icon\n        aria-hidden=\"false\"\n        iconPositionEnd\n        class=\"style-icon\"\n        svgIcon=\"palette\"\n        [matBadge]=\"selectedFeatures$.value.length\"\n        matBadgeColor=\"warn\"\n        matBadgeSize=\"medium\"\n      >\n      </mat-icon>\n    </button>\n  </div>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  ViewChild\n} from '@angular/core';\n\nimport {\n  FEATURE,\n  FeatureStore,\n  FeatureStoreSelectionStrategy,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy,\n  FeatureMotion,\n  FeatureStoreLoadingStrategy,\n  featureToOl\n} from '../../feature';\n\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\n\nimport { LanguageService } from '@igo2/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { CoordinatesUnit, GeometryType, LabelType } from '../shared/draw.enum';\nimport { FontType } from '../../style/shared/font.enum';\nimport { IgoMap } from '../../map/shared/map';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { Draw, FeatureWithDraw } from '../shared/draw.interface';\nimport {\n  UntypedFormGroup,\n  UntypedFormBuilder,\n  UntypedFormControl\n} from '@angular/forms';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { DrawControl } from '../../geometry/shared/controls/draw';\nimport {\n  EntityRecord,\n  EntityTableButton,\n  EntityTableColumnRenderer,\n  EntityTableTemplate\n} from '@igo2/common';\n\nimport * as OlStyle from 'ol/style';\nimport * as olproj from 'ol/proj';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlCircle from 'ol/geom/Circle';\nimport OlPoint from 'ol/geom/Point';\nimport OlFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlOverlay from 'ol/Overlay';\nimport type { Type } from 'ol/geom/Geometry';\nimport { default as OlGeometry } from 'ol/geom/Geometry';\nimport { getDistance, getLength } from 'ol/sphere';\nimport { DrawStyleService } from '../../style/style-service/draw-style.service';\nimport { first, skip } from 'rxjs/operators';\nimport { DrawPopupComponent } from './draw-popup.component';\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\nimport { getTooltipsOfOlGeometry } from '../../measure/shared/measure.utils';\nimport { createInteractionStyle, DDtoDMS } from '../shared/draw.utils';\nimport { transform } from 'ol/proj';\nimport { DrawIconService } from '../shared/draw-icon.service';\nimport { StyleModalDrawingComponent } from '../../style/style-modal/drawing/style-modal-drawing.component';\nimport { StyleModalData } from '../../style/style-modal/shared/style-modal.interface';\n\nimport {\n  trigger,\n  state,\n  style,\n  animate,\n  transition\n} from '@angular/animations';\n\nimport { DrawLayerPopupComponent } from './draw-layer-popup.component';\n\nimport {\n  measureOlGeometryLength,\n  measureOlGeometryArea,\n  metersToUnit,\n  squareMetersToUnit\n} from '../../measure/shared/measure.utils';\n\nimport {\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation,\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation\n} from '../../measure/shared/measure.enum';\nimport Polygon, { fromCircle } from 'ol/geom/Polygon';\n\n@Component({\n  selector: 'igo-draw',\n  animations: [\n    trigger('openClose', [\n      state(\n        'open',\n        style({\n          opacity: 1\n        })\n      ),\n      state(\n        'closed',\n        style({\n          opacity: 0\n        })\n      ),\n      transition('open => closed', [animate('600ms ease')]),\n      transition('closed => open', [animate('800ms ease')])\n    ])\n  ],\n  templateUrl: './draw.component.html',\n  styleUrls: ['./draw.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DrawComponent implements OnInit, OnDestroy {\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate;\n\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n  @Input() map: IgoMap; // Map to draw on\n\n  @Input()\n  get stores(): FeatureStore<FeatureWithDraw>[] {\n    return this._stores;\n  }\n  set stores(value: FeatureStore<FeatureWithDraw>[]) {\n    this._stores = value;\n  }\n  private _stores: FeatureStore<FeatureWithDraw>[] = [];\n\n  @Input()\n  get drawControls(): [string, DrawControl][] {\n    return this._drawControls;\n  }\n  set drawControls(value: [string, DrawControl][]) {\n    this._drawControls = value;\n  }\n  private _drawControls = [];\n\n  @Input()\n  get activeDrawingLayer(): VectorLayer {\n    return this._activeDrawingLayer;\n  }\n  set activeDrawingLayer(value: VectorLayer) {\n    this._activeDrawingLayer = value;\n  }\n  private _activeDrawingLayer: VectorLayer;\n\n  @Output() activeLayerChange = new EventEmitter<VectorLayer>();\n  @Output() drawControlsEvent = new EventEmitter<[string, DrawControl][]>();\n  @Output() layersIDEvent = new EventEmitter<string>();\n\n  @Output() fillColor: string;\n  @Output() strokeColor: string;\n  @Output() strokeWidth: number;\n\n  @Output() fontSize: string;\n  @Output() fontStyle: string;\n\n  public activeStore: FeatureStore<FeatureWithDraw>;\n  private layerCounterID: number = 0;\n  public draw$: BehaviorSubject<Draw> = new BehaviorSubject({}); // Observable of draw\n  private activeDrawingLayerSource = new OlVectorSource();\n  private activeDrawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private drawSelect$$: Subscription;\n  public selectedFeatures$: BehaviorSubject<FeatureWithDraw[]> =\n    new BehaviorSubject([]);\n  public fillForm: string;\n  public strokeForm: string;\n  public drawControlIsDisabled: boolean = true;\n  public drawControlIsActive: boolean = false;\n  public labelsAreShown: boolean;\n  public freehandMode = false;\n  private subscriptions$$: Subscription[] = [];\n\n  public position: string = 'bottom';\n  public form: UntypedFormGroup;\n  public icons: Array<string>;\n  public icon: string;\n\n  public radiusFormControl = new UntypedFormControl(1000);\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  public radiusFormControlChange$$: Subscription = new Subscription();\n  public predefinedRadius$: BehaviorSubject<number> = new BehaviorSubject(\n    undefined\n  );\n  public radiusDrawEnd$: BehaviorSubject<number> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n  private numberOfDrawings: number;\n  public isCreatingNewLayer: boolean = false;\n  private currGeometryType = this.geometryType.Point as any;\n\n  @ViewChild('selectedLayer') select;\n\n  constructor(\n    private languageService: LanguageService,\n    private formBuilder: UntypedFormBuilder,\n    private drawStyleService: DrawStyleService,\n    private dialog: MatDialog,\n    private drawIconService: DrawIconService\n  ) {\n    this.tableTemplate = {\n      selection: true,\n      selectMany: true,\n      selectionCheckbox: true,\n      sort: true,\n      fixedHeader: true,\n      tableHeight: 'auto',\n      columns: [\n        {\n          name: 'Drawing',\n          title: this.languageService.translate.instant('igo.geo.draw.labels'),\n          valueAccessor: (feature: FeatureWithDraw) => {\n            return feature.properties.draw;\n          }\n        },\n        {\n          name: 'Edition',\n          title: '',\n          sort: false,\n          valueAccessor: (feature: FeatureWithDraw) => {\n            return [\n              {\n                editMode: false,\n                icon: 'pencil',\n                color: 'primary',\n                click: () => {\n                  this.editLabelDrawing(feature);\n                },\n                style: 'mat-icon-button'\n              }\n            ] as EntityTableButton[];\n          },\n          renderer: EntityTableColumnRenderer.ButtonGroup\n        }\n      ]\n    };\n    this.buildForm();\n    this.fillColor = this.drawStyleService.getFillColor();\n    this.strokeColor = this.drawStyleService.getStrokeColor();\n    this.strokeWidth = this.drawStyleService.getStrokeWidth();\n    this.labelsAreShown = this.drawStyleService.getLabelsAreShown();\n    this.icons = this.drawIconService.getIcons();\n    this.icon = this.drawStyleService.getIcon();\n\n    this.fontSize = this.drawStyleService.getFontSize();\n    this.fontStyle = this.drawStyleService.getFontStyle();\n  }\n\n  // Initialize the store that will contain the entities and create the Draw control\n  ngOnInit() {\n    if (!this.stores.length) {\n      this.activeStore = new FeatureStore<FeatureWithDraw>([], {\n        map: this.map\n      });\n      this.initStore();\n      this.activeDrawControl = this.createDrawControl(\n        this.fillColor,\n        this.strokeColor,\n        this.strokeWidth\n      );\n      this.activeDrawControl.setGeometryType(this.geometryType.Point as any);\n      this.toggleDrawControl();\n      this.stores.push(this.activeStore);\n      this.drawControls.push([\n        this.activeDrawingLayer.id,\n        this.activeDrawControl\n      ]);\n      this.drawControlsEvent.emit(this.drawControls);\n      this.layersIDEvent.emit(this.activeDrawingLayer.id);\n      this.onLayerChange(this.activeDrawingLayer);\n    } else {\n      this.activeStore = this.stores.find(\n        (store) => store.layer.id === this.activeDrawingLayer.id\n      );\n      this.activeDrawControl = this.drawControls.find(\n        (dc) => dc[0] === this.activeDrawingLayer.id\n      )[1];\n      this.deactivateDrawControl();\n      this.allLayers.forEach((layer) => {\n        if (layer.id !== this.activeDrawingLayer.id) {\n          layer.opacity = 0;\n        }\n        let store = this.stores.find((s) => s.layer.id === layer.id);\n\n        this.subscriptions$$.push(\n          store.stateView\n            .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n              return record.state.selected === true;\n            })\n            .pipe(first())\n            .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n              records.forEach((record) => {\n                record.state.selected = false;\n              });\n            })\n        );\n\n        this.subscriptions$$.push(\n          store.stateView\n            .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n              return record.state.selected === true;\n            })\n            .pipe(\n              skip(1) // Skip initial emission\n            )\n            .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n              this.selectedFeatures$.next(\n                records.map((record) => record.entity)\n              );\n            })\n        );\n\n        this.subscriptions$$.push(\n          store.count$.subscribe((cnt) => {\n            cnt >= 1\n              ? (this.activeStore.layer.options.showInLayerList = true)\n              : (this.activeStore.layer.options.showInLayerList = false);\n          })\n        );\n      });\n      this.onLayerChange(this.activeDrawingLayer);\n    }\n\n    this.radiusFormControlChange$$ =\n      this.radiusFormControl.valueChanges.subscribe((value) => {\n        if (this.activeDrawControl.ispredefinedRadius$.getValue()) {\n          this.changeRadius(value);\n        }\n      });\n  }\n\n  /**\n   * Remove the drawing layer and the interactions\n   * @internal\n   */\n  ngOnDestroy() {\n    this.allLayers.forEach((layer) => (layer.opacity = 1));\n    this.activeStore.state.updateAll({ selected: false });\n    this.deactivateDrawControl();\n    this.subscriptions$$.map((s) => s.unsubscribe());\n    this.radiusFormControlChange$$.unsubscribe();\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(\n    fillColor?: string,\n    strokeColor?: string,\n    strokeWidth?: number\n  ) {\n    const activeDrawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.activeDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(\n        fillColor,\n        strokeColor,\n        strokeWidth\n      )\n    });\n    return activeDrawControl;\n  }\n\n  /**\n   * Store initialization, including drawing layer creation\n   */\n\n  private initStore(newTitle?: string, isNewLayer?: boolean) {\n    this.createLayer(newTitle, isNewLayer);\n    this.subscriptions$$.push(\n      this.activeStore.stateView\n        .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n          return record.state.selected === true;\n        })\n        .pipe(\n          skip(1) // Skip initial emission\n        )\n        .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n          this.selectedFeatures$.next(records.map((record) => record.entity));\n        })\n    );\n\n    this.subscriptions$$.push(\n      this.activeStore.count$.subscribe((cnt) => {\n        cnt >= 1\n          ? (this.activeStore.layer.options.showInLayerList = true)\n          : (this.activeStore.layer.options.showInLayerList = false);\n      })\n    );\n  }\n\n  /**\n   * Open the style modal dialog box\n   */\n  openStyleModalDialog() {\n    setTimeout(() => {\n      // open the dialog box used to style features\n      const dialogRef = this.dialog.open(StyleModalDrawingComponent, {\n        disableClose: false,\n        data: {\n          features: this.selectedFeatures$.getValue(),\n          icons: this.icons,\n          icon: this.icon\n        },\n        autoFocus: false\n      });\n\n      // when dialog box is closed, get label and set it to geometry\n      dialogRef.afterClosed().subscribe((data: StyleModalData) => {\n        // checks if the user clicked ok\n        if (dialogRef.componentInstance.confirmFlag) {\n          this.onFontChange(this.labelsAreShown, data.fontSize, data.fontStyle);\n          this.onColorChange(\n            this.labelsAreShown,\n            this.icon ? true : false,\n            data.fillColor,\n            data.strokeColor\n          );\n          this.onOffsetLabelChange(\n            this.labelsAreShown,\n            data.offsetX,\n            data.offsetY\n          );\n        }\n      });\n    }, 250);\n  }\n\n  /**\n   * Open a dialog box to enter label and do something\n   * @param olGeometry geometry at draw end or selected geometry\n   * @param drawEnd event fired at drawEnd?\n   */\n  private openDrawDialog(olGeometry, isDrawEnd: boolean) {\n    setTimeout(() => {\n      // open the dialog box used to enter label\n      const dialogRef = this.dialog.open(DrawPopupComponent, {\n        disableClose: false,\n        data: { olGeometry: olGeometry, map: this.map }\n      });\n\n      // when dialog box is closed, get label and set it to geometry\n      dialogRef.afterClosed().subscribe((result) => {\n        // checks if the user clicked ok\n        if (dialogRef.componentInstance.confirmFlag) {\n          this.updateLabelOfOlGeometry(olGeometry, result.label);\n          this.updateLabelType(\n            olGeometry,\n            dialogRef.componentInstance.labelFlag\n          );\n          this.updateMeasureUnit(olGeometry, result.measureUnit);\n\n          if (!(olGeometry instanceof OlFeature)) {\n            this.updateFontSizeAndStyle(olGeometry, '15', FontType.Arial);\n            this.updateFillAndStrokeColor(\n              olGeometry,\n              'rgba(255,255,255,0.4)',\n              'rgba(143,7,7,1)'\n            );\n            this.updateOffset(\n              olGeometry,\n              0,\n              olGeometry instanceof OlPoint ? -15 : 0\n            );\n          }\n\n          isDrawEnd\n            ? this.onDrawEnd(olGeometry)\n            : this.onSelectDraw(olGeometry, result.label, [\n                dialogRef.componentInstance.labelFlag,\n                result.measureUnit\n              ]);\n          this.updateHeightTable();\n        }\n        // deletes the feature\n        else {\n          this.activeDrawingLayerSource\n            .getFeatures()\n            .forEach((drawingLayerFeature) => {\n              const geometry = drawingLayerFeature.getGeometry() as any;\n              if (olGeometry === geometry) {\n                this.activeDrawingLayerSource.removeFeature(\n                  drawingLayerFeature\n                );\n              }\n            });\n        }\n      });\n    }, 250);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlGeometry, radius?: number) {\n    this.addFeatureToStore(olGeometry, radius);\n    this.clearLabelsOfOlGeometry(olGeometry);\n    this.activeStore.layer.ol.getSource().refresh();\n  }\n\n  private onModifyDraw(olGeometry) {\n    const entities = this.activeStore.all();\n\n    entities.forEach((entity) => {\n      const entityId = entity.properties.id;\n      const olGeometryId = olGeometry.ol_uid;\n\n      if (entityId === olGeometryId) {\n        if (entity.properties.labelType === LabelType.Coordinates) {\n          let longLat = DDtoDMS(\n            [entity.properties.longitude, entity.properties.latitude],\n            entity.properties.measureUnit as CoordinatesUnit\n          );\n          this.updateLabelOfOlGeometry(\n            olGeometry,\n            '(' + longLat[1] + ', ' + longLat[0] + ')'\n          );\n        } else if (entity.properties.labelType === LabelType.Length) {\n          if (olGeometry instanceof OlCircle) {\n            let circularPolygon = fromCircle(olGeometry, 10000);\n            const radius = metersToUnit(\n              this.getRadius(circularPolygon),\n              entity.properties.measureUnit as MeasureLengthUnit\n            );\n            const unit =\n              MeasureLengthUnitAbbreviation[entity.properties.measureUnit];\n            const radiusLabel =\n              'R: ' + radius.toFixed(2).toString() + ' ' + unit;\n            this.updateLabelOfOlGeometry(olGeometry, radiusLabel);\n          } else {\n            let olGeometryLength = measureOlGeometryLength(\n              olGeometry,\n              this.map.ol.getView().getProjection().getCode()\n            );\n            let measureUnit: any;\n            const temp: MeasureLengthUnit = entity.properties\n              .measureUnit as MeasureLengthUnit;\n            measureUnit =\n              MeasureLengthUnitAbbreviation[entity.properties.measureUnit];\n            olGeometryLength = metersToUnit(olGeometryLength, temp);\n            let lengthLabel =\n              olGeometry instanceof Polygon\n                ? 'P: ' +\n                  olGeometryLength.toFixed(2).toString() +\n                  ' ' +\n                  measureUnit\n                : olGeometryLength.toFixed(2).toString() + ' ' + measureUnit;\n            this.updateLabelOfOlGeometry(olGeometry, lengthLabel);\n          }\n        } else if (entity.properties.labelType === LabelType.Area) {\n          if (olGeometry instanceof OlCircle) {\n            let circularPolygon = fromCircle(olGeometry, 10000);\n            let circleArea = measureOlGeometryArea(\n              circularPolygon,\n              this.map.ol.getView().getProjection().getCode()\n            );\n            const unit =\n              MeasureAreaUnitAbbreviation[entity.properties.measureUnit];\n            const temp: MeasureAreaUnit = entity.properties\n              .measureUnit as MeasureAreaUnit;\n            circleArea = squareMetersToUnit(circleArea, temp);\n            const areaLabel = circleArea.toFixed(2).toString() + ' ' + unit;\n            this.updateLabelOfOlGeometry(olGeometry, areaLabel);\n          } else {\n            let olGeometryArea = measureOlGeometryArea(\n              olGeometry,\n              this.map.ol.getView().getProjection().getCode()\n            );\n            let measureUnit: any;\n            const temp: MeasureAreaUnit = entity.properties\n              .measureUnit as MeasureAreaUnit;\n            measureUnit =\n              MeasureAreaUnitAbbreviation[entity.properties.measureUnit];\n            olGeometryArea = squareMetersToUnit(olGeometryArea, temp);\n            const lengthLabel =\n              olGeometryArea.toFixed(2).toString() + ' ' + measureUnit;\n            this.updateLabelOfOlGeometry(olGeometry, lengthLabel);\n          }\n        } else {\n          this.updateLabelOfOlGeometry(olGeometry, entity.properties.draw);\n        }\n\n        this.updateLabelType(olGeometry, entity.properties.labelType);\n        this.updateMeasureUnit(olGeometry, entity.properties.measureUnit);\n        this.updateFontSizeAndStyle(\n          olGeometry,\n          entity.properties.fontStyle.split(' ')[0].replace('px', ''),\n          entity.properties.fontStyle.substring(\n            entity.properties.fontStyle.indexOf(' ') + 1\n          )\n        );\n        this.updateFillAndStrokeColor(\n          olGeometry,\n          entity.properties.drawingStyle.fill,\n          entity.properties.drawingStyle.stroke\n        );\n        this.updateOffset(\n          olGeometry,\n          entity.properties.offsetX,\n          entity.properties.offsetY\n        );\n        this.replaceFeatureInStore(entity, olGeometry);\n      }\n    });\n  }\n\n  private onSelectDraw(\n    olFeature: OlFeature<OlGeometry>,\n    label: string,\n    labelTypeAndUnit?\n  ) {\n    const entities = this.activeStore.all();\n\n    const olGeometry = olFeature.getGeometry() as any;\n    olGeometry.ol_uid = olFeature.get('id');\n\n    const olGeometryCoordinates = JSON.stringify(\n      olGeometry.getCoordinates()[0]\n    );\n\n    entities.forEach((entity) => {\n      const entityCoordinates = JSON.stringify(entity.geometry.coordinates[0]);\n      if (olGeometryCoordinates === entityCoordinates) {\n        const fontSize = olFeature\n          .get('fontStyle')\n          .split(' ')[0]\n          .replace('px', '');\n        const fontStyle = olFeature\n          .get('fontStyle')\n          .substring(olFeature.get('fontStyle').indexOf(' ') + 1);\n\n        const fillColor = olFeature.get('drawingStyle').fill;\n        const strokeColor = olFeature.get('drawingStyle').stroke;\n\n        const offsetX = olFeature.get('offsetX');\n        const offsetY = olFeature.get('offsetY');\n\n        const rad: number = entity.properties.rad\n          ? entity.properties.rad\n          : undefined;\n        this.updateLabelOfOlGeometry(olGeometry, label);\n        this.updateFontSizeAndStyle(olGeometry, fontSize, fontStyle);\n        this.updateFillAndStrokeColor(olGeometry, fillColor, strokeColor);\n        this.updateOffset(olGeometry, offsetX, offsetY);\n        this.updateLabelType(olGeometry, labelTypeAndUnit[0]);\n        this.updateMeasureUnit(olGeometry, labelTypeAndUnit[1]);\n        this.replaceFeatureInStore(entity, olGeometry, rad);\n      }\n    });\n  }\n\n  /**\n   * Add a feature with draw label to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(\n    olGeometry,\n    radius?: number,\n    feature?: FeatureWithDraw\n  ) {\n    let rad: number;\n    let center4326: Array<number>;\n    let point4326: Array<number>;\n    let lon4326: number;\n    let lat4326: number;\n\n    const featureId = feature ? feature.properties.id : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n\n    if (olGeometry instanceof OlCircle || radius) {\n      if (radius) {\n        rad = radius;\n      } else {\n        geometry.type = 'Point';\n        geometry.coordinates = olGeometry.getCenter();\n        const extent4326 = transform(\n          [\n            olGeometry.getFlatCoordinates()[2],\n            olGeometry.getFlatCoordinates()[3]\n          ],\n          projection,\n          'EPSG:4326'\n        );\n        center4326 = transform(\n          [\n            olGeometry.getFlatCoordinates()[0],\n            olGeometry.getFlatCoordinates()[1]\n          ],\n          projection,\n          'EPSG:4326'\n        );\n        lon4326 = center4326[0];\n        lat4326 = center4326[1];\n        rad = getDistance(center4326, extent4326);\n        this.radiusFormControl.setValue(Math.round(rad));\n      }\n    }\n    if (this.activeDrawControl.radiusDrawEnd$.getValue()) {\n      rad = this.activeDrawControl.radiusDrawEnd$.getValue();\n    }\n\n    if (olGeometry instanceof OlPoint) {\n      point4326 = transform(\n        olGeometry.getFlatCoordinates(),\n        projection,\n        'EPSG:4326'\n      );\n      lon4326 = point4326[0];\n      lat4326 = point4326[1];\n    }\n\n    this.activeStore.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        draw: olGeometry.get('_label'),\n        longitude: lon4326 ? lon4326 : null,\n        latitude: lat4326 ? lat4326 : null,\n        rad: rad ? rad : null,\n        fontStyle: olGeometry.get('fontStyle_'),\n        drawingStyle: {\n          fill: olGeometry.get('fillColor_'),\n          stroke: olGeometry.get('strokeColor_')\n        },\n        offsetX: olGeometry.get('offsetX_'),\n        offsetY: olGeometry.get('offsetY_'),\n        labelType: olGeometry.get('labelType_'),\n        measureUnit: olGeometry.get('measureUnit_')\n      },\n      meta: {\n        id: featureId\n      }\n    });\n    this.activeStore.setLayerExtent();\n    this.activeDrawControl.predefinedRadius$.next(undefined);\n    this.activeDrawControl.radiusDrawEnd$.next(undefined);\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [''],\n      stroke: ['']\n    });\n  }\n\n  public setupLayer(isNewLayer?: boolean) {\n    setTimeout(() => {\n      const dialogRef = this.dialog.open(DrawLayerPopupComponent, {\n        disableClose: false\n      });\n      dialogRef.afterClosed().subscribe((label: string) => {\n        if (dialogRef.componentInstance.confirmFlag) {\n          this.activeStore.state.updateAll({ selected: false });\n          this.activeStore = new FeatureStore<FeatureWithDraw>([], {\n            map: this.map\n          });\n          this.activeDrawingLayerSource = new OlVectorSource();\n          this.activeDrawingLayer.opacity = 0;\n          this.deactivateDrawControl();\n          this.initStore(label, isNewLayer);\n          this.activeDrawControl = this.createDrawControl(\n            this.fillColor,\n            this.strokeColor,\n            this.strokeWidth\n          );\n          this.activeDrawControl.setGeometryType(this.currGeometryType);\n          this.toggleDrawControl();\n          this.stores.push(this.activeStore);\n          this.drawControls.push([\n            this.activeDrawingLayer.id,\n            this.activeDrawControl\n          ]);\n          this.drawControlsEvent.emit(this.drawControls);\n          this.layersIDEvent.emit(this.activeDrawingLayer.id);\n          this.isCreatingNewLayer = false;\n          if (!this.labelsAreShown) {\n            this.onToggleLabels();\n          }\n          this.activeLayerChange.emit(this.activeDrawingLayer);\n        } else {\n          this.select.value = this.activeDrawingLayer;\n          this.select.selectionChange.emit(this.activeDrawingLayer);\n        }\n      });\n    }, 250);\n  }\n\n  // HTML user interactions\n\n  /**\n   * Called when the user double-clicks the selected drawing\n   */\n  editLabelDrawing(feature) {\n    const olGeometryFeature = featureToOl(\n      feature,\n      this.map.ol.getView().getProjection().getCode()\n    );\n    this.openDrawDialog(olGeometryFeature, false);\n  }\n\n  openShorcutsDialog() {\n    this.dialog.open(DrawShorcutsComponent);\n  }\n\n  deleteDrawings() {\n    this.activeStore.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach((selectedFeature) => {\n      this.activeDrawingLayerSource\n        .getFeatures()\n        .forEach((drawingLayerFeature) => {\n          const geometry = drawingLayerFeature.getGeometry() as any;\n          if (selectedFeature.properties.id === geometry.ol_uid) {\n            this.activeDrawingLayerSource.removeFeature(drawingLayerFeature);\n          }\n        });\n    });\n    this.updateHeightTable();\n    this.activeStore.setLayerExtent();\n  }\n\n  /**\n   * Called when the user toggles the labels toggle\n   */\n  onToggleLabels() {\n    this.drawStyleService.toggleLabelsAreShown();\n    this.labelsAreShown = !this.labelsAreShown;\n    this.icon\n      ? this.elementStyle(this.labelsAreShown, true)\n      : this.elementStyle(this.labelsAreShown, false);\n    this.createDrawControl();\n  }\n\n  /**\n   * Called when the user toggles the Draw control is toggled\n   * @internal\n   */\n  onToggleDrawControl(toggleIsChecked: boolean) {\n    toggleIsChecked ? this.toggleDrawControl() : this.deactivateDrawControl();\n  }\n\n  onToggleFreehandMode(event: any) {\n    if (this.isCircle() && !event.checked) {\n      this.activeDrawControl.ispredefinedRadius$.next(true);\n      this.changeRadius(this.radiusFormControl.value);\n    } else {\n      this.activeDrawControl.setOlInteractionStyle(\n        createInteractionStyle(\n          this.fillColor,\n          this.strokeColor,\n          this.strokeWidth\n        )\n      );\n      this.activeDrawControl.ispredefinedRadius$.next(false);\n    }\n    this.freehandMode = event.checked;\n    this.activeDrawControl.freehand$.next(event.checked);\n    this.toggleDrawControl();\n  }\n\n  // User changes properties of a drawing element\n\n  /**\n   * Display the current layer with the current store and the current layerSource\n   */\n\n  public onLayerChange(currLayer?: VectorLayer) {\n    if (currLayer) {\n      this.activeStore.state.updateAll({ selected: false });\n      this.isCreatingNewLayer = false;\n      this.activeDrawingLayer.opacity = 0;\n      this.activeDrawingLayer = currLayer;\n      this.activeDrawingLayer.opacity = 1;\n      this.deactivateDrawControl();\n      if (!this.labelsAreShown) {\n        this.onToggleLabels();\n      }\n      this.activeStore = this.stores.find(\n        (store) => store.layer.id === this.activeDrawingLayer.id\n      );\n      this.activeDrawControl = this.drawControls.find(\n        (dc) => dc[0] === this.activeDrawingLayer.id\n      )[1];\n      this.activeDrawingLayerSource =\n        this.activeDrawControl.olDrawingLayerSource;\n      this.activeDrawControl.setGeometryType(this.currGeometryType);\n      this.toggleDrawControl();\n    } else {\n      this.setupLayer(true);\n    }\n    this.activeLayerChange.emit(this.activeDrawingLayer);\n  }\n\n  public createLayer(newTitle?, isNewLayer?) {\n    for (const layer of this.allLayers) {\n      let numberId = Number(layer.id.replace('igo-draw-layer', ''));\n      this.layerCounterID = Math.max(numberId, this.layerCounterID);\n    }\n    this.activeDrawingLayer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'igo-draw-layer' + ++this.layerCounterID,\n      title: isNewLayer\n        ? newTitle\n        : this.languageService.translate.instant('igo.geo.draw.drawing'),\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: (feature, resolution) => {\n        return this.drawStyleService.createIndividualElementStyle(\n          feature,\n          resolution,\n          this.labelsAreShown,\n          feature.get('fontStyle'),\n          feature.get('drawingStyle').fill,\n          feature.get('drawingStyle').stroke,\n          feature.get('offsetX'),\n          feature.get('offsetY'),\n          this.map.projection,\n          this.icon\n        );\n      },\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: {\n        enabled: false\n      }\n    });\n\n    tryBindStoreLayer(this.activeStore, this.activeDrawingLayer);\n\n    tryAddLoadingStrategy(\n      this.activeStore,\n      new FeatureStoreLoadingStrategy({\n        motion: FeatureMotion.None\n      })\n    );\n\n    tryAddSelectionStrategy(\n      this.activeStore,\n      new FeatureStoreSelectionStrategy({\n        map: this.map,\n        motion: FeatureMotion.None,\n        many: true\n      })\n    );\n    this.activeStore.layer.visible = true;\n    this.activeStore.source.ol.on(\n      'removefeature',\n      (event: OlVectorSourceEvent<OlGeometry>) => {\n        const olGeometry = event.feature.getGeometry();\n        this.clearLabelsOfOlGeometry(olGeometry);\n      }\n    );\n  }\n\n  /**\n   * Called when the user changes the color in a color picker\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param isAnIcon wheter the feature is an icon or not\n   * @param fillColor which is the filling color\n   * @param strokeColor which is the stroke color\n   */\n  onColorChange(\n    labelsAreShown: boolean,\n    isAnIcon: boolean,\n    fillColor: string,\n    strokeColor: string\n  ) {\n    if (this.selectedFeatures$.value.length > 0 && !isAnIcon) {\n      this.selectedFeatures$.value.forEach((feature) => {\n        let olFeature = featureToOl(\n          feature,\n          this.map.ol.getView().getProjection().getCode()\n        );\n        this.updateFillAndStrokeColor(olFeature, fillColor, strokeColor);\n\n        const entity = this.activeStore\n          .all()\n          .find((e) => e.meta.id === olFeature.getId());\n        entity.properties.drawingStyle.fill = olFeature.get('fillColor_');\n        entity.properties.drawingStyle.stroke = olFeature.get('strokeColor_');\n        this.activeStore.update(entity);\n      });\n    }\n\n    this.elementStyle(labelsAreShown, isAnIcon);\n    this.createDrawControl();\n  }\n\n  /**\n   * Called when the user changes the font size or/and style\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param size the size of the font\n   * @param style the style of the font\n   */\n\n  onFontChange(labelsAreShown: boolean, size: string, style: FontType) {\n    if (this.selectedFeatures$.value.length > 0) {\n      this.selectedFeatures$.value.forEach((feature) => {\n        let olFeature = featureToOl(\n          feature,\n          this.map.ol.getView().getProjection().getCode()\n        );\n        this.updateFontSizeAndStyle(olFeature, size, style);\n        const entity = this.activeStore\n          .all()\n          .find((e) => e.meta.id === olFeature.getId());\n        entity.properties.fontStyle = olFeature.get('fontStyle_');\n        this.activeStore.update(entity);\n        olFeature = this.activeStore.layer.ol\n          .getSource()\n          .getFeatures()\n          .find((f) => f.getId() === entity.meta.id);\n        olFeature.setProperties({ fontStyle: entity.properties.fontStyle });\n        olFeature.changed();\n      });\n\n      this.fontSize = size;\n      this.fontStyle = style;\n\n      this.drawStyleService.setFontSize(size);\n      this.drawStyleService.setFontStyle(style);\n\n      this.elementStyle(labelsAreShown);\n    }\n  }\n\n  /**\n   * Called when the user changes the value of the horizontal/vertical offset\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param offsetX horizontal offset of the label\n   * @param offsetY vertical offset of the label\n   */\n\n  onOffsetLabelChange(\n    labelsAreShown: boolean,\n    offsetX: number,\n    offsetY: number\n  ) {\n    if (this.selectedFeatures$.value.length > 0) {\n      this.selectedFeatures$.value.forEach((feature) => {\n        let olFeature = featureToOl(\n          feature,\n          this.map.ol.getView().getProjection().getCode()\n        );\n        this.updateOffset(olFeature, offsetX, offsetY);\n        const entity = this.activeStore\n          .all()\n          .find((e) => e.meta.id === olFeature.getId());\n        entity.properties.offsetX = olFeature.get('offsetX_');\n        entity.properties.offsetY = olFeature.get('offsetY_');\n        this.activeStore.update(entity);\n        olFeature = this.activeStore.layer.ol\n          .getSource()\n          .getFeatures()\n          .find((f) => f.getId() === entity.meta.id);\n        olFeature.setProperties({\n          offsetX: entity.properties.offsetX,\n          offsetY: entity.properties.offsetY\n        });\n        olFeature.changed();\n      });\n      this.elementStyle(labelsAreShown);\n    }\n  }\n\n  onIconChange(event?) {\n    this.icon = event;\n    this.drawStyleService.setIcon(this.icon);\n    this.elementStyle(true, this.icon);\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(geometryType: Type) {\n    this.currGeometryType = geometryType;\n    this.activeDrawControl.setGeometryType(geometryType);\n    this.freehandMode\n      ? this.onToggleFreehandMode({ checked: true })\n      : this.onToggleFreehandMode({ checked: false });\n    this.toggleDrawControl();\n  }\n\n  // Updates the properties of olFeature inputted\n\n  /**\n   * Update the label of a geometry when a label is entered in a dialog box\n   * @param OlFeature the feature\n   * @param label the label\n   */\n  private updateLabelOfOlGeometry(OlFeature, label: string) {\n    OlFeature.setProperties(\n      {\n        _label: label\n      },\n      true\n    );\n  }\n\n  private updateFontSizeAndStyle(\n    olFeature: OlFeature<OlGeometry>,\n    fontSize: string,\n    fontStyle: string\n  ) {\n    olFeature.setProperties(\n      {\n        fontStyle_: `${fontSize}px ${fontStyle}`\n      },\n      true\n    );\n  }\n\n  private updateFillAndStrokeColor(\n    olFeature: OlFeature<OlGeometry>,\n    fillColor: string,\n    strokeColor: string\n  ) {\n    olFeature.setProperties(\n      {\n        fillColor_: fillColor,\n        strokeColor_: strokeColor\n      },\n      true\n    );\n  }\n\n  private updateOffset(\n    olFeature: OlFeature<OlGeometry>,\n    offsetX: number,\n    offsetY: number\n  ) {\n    olFeature.setProperties(\n      {\n        offsetX_: offsetX,\n        offsetY_: offsetY\n      },\n      true\n    );\n  }\n\n  private updateLabelType(\n    olFeature: OlFeature<OlGeometry>,\n    typeOfLabel: LabelType | [LabelType, LabelType]\n  ) {\n    olFeature.setProperties(\n      {\n        labelType_: typeOfLabel\n      },\n      true\n    );\n  }\n\n  private updateMeasureUnit(\n    olFeature: OlFeature<OlGeometry>,\n    measureUnit: MeasureLengthUnit | MeasureAreaUnit | CoordinatesUnit | []\n  ) {\n    olFeature.setProperties(\n      {\n        measureUnit_: measureUnit\n      },\n      true\n    );\n  }\n\n  // Updates values of the selected element on the HTML view\n\n  getFeatureFontSize(): string {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.fontStyle\n          .split(' ')[0]\n          .replace('px', '')\n      : '15';\n  }\n\n  getFeatureFontStyle() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.fontStyle.substring(\n          this.selectedFeatures$.value[0].properties.fontStyle.indexOf(' ') + 1\n        )\n      : FontType.Arial;\n  }\n\n  getFeatureFillColor() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.drawingStyle.fill\n      : 'rgba(255,255,255,0.4)';\n  }\n\n  getFeatureStrokeColor() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.drawingStyle.stroke\n      : 'rgba(143,7,7,1)';\n  }\n\n  getFeatureOffsetX() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.offsetX\n      : this.drawStyleService.getOffsetX();\n  }\n\n  getFeatureOffsetY() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.offsetY\n      : '0';\n  }\n\n  get allFontStyles(): string[] {\n    return Object.values(FontType);\n  }\n\n  get allLayers() {\n    return this.map.layers.filter((layer) =>\n      String(layer.id).includes('igo-draw-layer')\n    );\n  }\n\n  updateHeightTable() {\n    // Check the amount of rows as a possible alternative\n    this.numberOfDrawings = this.activeStore.count$.getValue();\n    this.numberOfDrawings > 10\n      ? (this.tableTemplate.tableHeight = '35vh')\n      : (this.tableTemplate.tableHeight = 'auto');\n  }\n\n  updateActiveLayer() {\n    let currLayer = this.allLayers.find(\n      (layer) => layer.title === this.activeDrawingLayer.title\n    );\n    return currLayer ? currLayer : this.allLayers[0];\n  }\n\n  // Helper methods\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    this.activateDrawControl();\n  }\n\n  /**\n   * Clear the tooltips of an OL geometry\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearLabelsOfOlGeometry(olGeometry) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (olTooltip && olTooltip.getMap()) {\n          this.map.ol.removeOverlay(olTooltip);\n        }\n      }\n    );\n  }\n  /**\n   * Replace the feature in the store\n   * @param entity the entity to replace\n   * @param olGeometry the new geometry to insert in the store\n   */\n  private replaceFeatureInStore(\n    entity,\n    olGeometry: OlGeometry,\n    radius?: number\n  ) {\n    this.activeStore.delete(entity);\n    this.onDrawEnd(olGeometry, radius);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (!this.activeDrawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.activeDrawControl.setOlMap(undefined);\n    this.drawControlIsActive = false;\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl() {\n    this.drawControlIsDisabled = false;\n    this.drawControlIsActive = true;\n    this.drawEnd$$ = this.activeDrawControl.end$.subscribe(\n      (olGeometry: OlGeometry) => {\n        this.openDrawDialog(olGeometry, true);\n      }\n    );\n\n    this.activeDrawControl.modify$.subscribe((olGeometry: OlGeometry) => {\n      this.onModifyDraw(olGeometry);\n    });\n\n    if (!this.drawSelect$$) {\n      this.drawSelect$$ = this.activeDrawControl.select$.subscribe(\n        (olFeature: OlFeature<OlGeometry>) => {\n          this.openDrawDialog(olFeature, false);\n        }\n      );\n    }\n    this.activeDrawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * get the geometry of design\n   *\n   */\n\n  isPoint() {\n    return this.activeDrawControl.getGeometryType() === this.geometryType.Point;\n  }\n\n  isLineString() {\n    return (\n      this.activeDrawControl.getGeometryType() === this.geometryType.LineString\n    );\n  }\n\n  isPolygon() {\n    return (\n      this.activeDrawControl.getGeometryType() === this.geometryType.Polygon\n    );\n  }\n\n  isCircle() {\n    return (\n      this.activeDrawControl.getGeometryType() === this.geometryType.Circle\n    );\n  }\n\n  /**\n   * The fonction to predefine the radius of the user\n   *\n   */\n\n  changeRadius(radius: number) {\n    let radiusMeters: number;\n\n    if (radius) {\n      this.measureUnit === MeasureLengthUnit.Meters\n        ? (radiusMeters = radius)\n        : (radiusMeters = radius * 1000);\n    } else {\n      radiusMeters = undefined;\n    }\n\n    const pointStyle = (feature: OlFeature<OlGeometry>, resolution: number) => {\n      const geom = feature.getGeometry() as OlPoint;\n      const coordinates = olproj.transform(\n        geom.getCoordinates(),\n        this.map.projection,\n        'EPSG:4326'\n      );\n\n      const radius =\n        radiusMeters / Math.cos((Math.PI / 180) * coordinates[1]) / resolution;\n      this.activeDrawControl.predefinedRadius$.next(radiusMeters);\n      return new OlStyle.Style({\n        image: new OlStyle.Circle({\n          radius: radius,\n          stroke: new OlStyle.Stroke({\n            width: 1,\n            color: 'rgba(143,7,7,1)'\n          }),\n          fill: new OlStyle.Fill({\n            color: 'rgba(255,255,255,0.4)'\n          })\n        })\n      });\n    };\n\n    this.activeDrawControl.setOlInteractionStyle(pointStyle);\n    this.toggleDrawControl();\n  }\n\n  onMeasureUnitChange(selectedMeasureUnit: MeasureLengthUnit) {\n    if (selectedMeasureUnit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = selectedMeasureUnit;\n      this.measureUnit === MeasureLengthUnit.Meters\n        ? this.radiusFormControl.setValue(this.radiusFormControl.value * 1000)\n        : this.radiusFormControl.setValue(this.radiusFormControl.value / 1000);\n    }\n  }\n\n  /**\n   * Recreates the style of the feature stored\n   */\n  private elementStyle(labelsAreShown: boolean, isAnIcon?) {\n    if (isAnIcon) {\n      this.activeStore.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createIndividualElementStyle(\n          feature,\n          resolution,\n          labelsAreShown,\n          feature.get('fontStyle'),\n          feature.get('drawingStyle').fill,\n          feature.get('drawingStyle').stroke,\n          feature.get('offsetX'),\n          feature.get('offsetY'),\n          this.map.projection,\n          this.icon\n        );\n      });\n    } else {\n      this.activeStore.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createIndividualElementStyle(\n          feature,\n          resolution,\n          labelsAreShown,\n          feature.get('fontStyle'),\n          feature.get('drawingStyle').fill,\n          feature.get('drawingStyle').stroke,\n          feature.get('offsetX'),\n          feature.get('offsetY'),\n          this.map.projection\n        );\n      });\n    }\n  }\n\n  private getRadius(olGeometry): number {\n    const length = getLength(olGeometry);\n    return Number(length / (2 * Math.PI));\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { OgcFilterableListComponent } from './ogc-filterable-list.component';\n\n@Directive({\n  selector: '[igoOgcFilterableListBinding]'\n})\nexport class OgcFilterableListBindingDirective implements OnInit, OnDestroy {\n  private component: OgcFilterableListComponent;\n  private layers$$: Subscription;\n\n  constructor(\n    @Self() component: OgcFilterableListComponent,\n    private mapService: MapService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    this.component.layers = [];\n\n    this.layers$$ = this.mapService.getMap().layers$.subscribe((layers) => {\n      this.component.layers = layers.filter((layer) => layer.showInLayerList);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n}\n","<igo-geometry-form-field-input\n  [formControl]=\"formControl\"\n  [map]=\"map\"\n  [geometryType]=\"geometryType$ | async\"\n  [drawGuide]=\"drawGuide$ | async\"\n  [measure]=\"measure\"\n  [drawControlIsActive]=\"drawControlIsActive\"\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\n  [controlOptions]=\"controlOptions\"\n  [drawStyle]=\"drawStyle\"\n  [overlayStyle]=\"overlayStyle\"\n>\n</igo-geometry-form-field-input>\n\n<div *ngIf=\"geometryTypeField\" class=\"geometry-type-toggle\">\n  <mat-button-toggle-group\n    [disabled]=\"(value$ | async) !== undefined\"\n    [(ngModel)]=\"geometryType\"\n  >\n    <mat-button-toggle\n      value=\"Point\"\n      [disabled]=\"geometryTypes.indexOf('Point') < 0\"\n    >\n      {{ 'igo.geo.geometry.point' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle\n      value=\"LineString\"\n      [disabled]=\"geometryTypes.indexOf('LineString') < 0\"\n    >\n      {{ 'igo.geo.geometry.line' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle\n      value=\"Polygon\"\n      [disabled]=\"geometryTypes.indexOf('Polygon') < 0\"\n    >\n      {{ 'igo.geo.geometry.polygon' | translate }}\n    </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<mat-form-field *ngIf=\"drawGuideField\" class=\"draw-guide-field\">\n  <input\n    matInput\n    type=\"number\"\n    [placeholder]=\"drawGuidePlaceholder\"\n    [(ngModel)]=\"drawGuide\"\n  />\n  <mat-icon matPrefix [color]=\"'primary'\" svgIcon=\"adjust\"> </mat-icon>\n  <span matSuffix class=\"draw-guide-units\">{{\n    'igo.geo.measure.meters' | translate\n  }}</span>\n</mat-form-field>\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { UntypedFormControl } from '@angular/forms';\nimport { IgoFormFieldComponent } from '@igo2/common';\nimport type { Type } from 'ol/geom/Geometry';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { IgoMap } from '../../map/shared';\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\n\n/**\n * This input allows a user to draw a new geometry or to edit\n * an existing one on a map.\n */\n@IgoFormFieldComponent('geometry')\n@Component({\n  selector: 'igo-geometry-form-field',\n  templateUrl: './geometry-form-field.component.html',\n  styleUrls: ['./geometry-form-field.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class GeometryFormFieldComponent implements OnInit, OnDestroy {\n  readonly value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(\n    undefined\n  );\n\n  private value$$: Subscription;\n\n  set drawControlIsActive(value: boolean) {\n    this._drawControlIsActive = value;\n    this.cdRef.detectChanges();\n  }\n\n  get drawControlIsActive(): boolean {\n    return this._drawControlIsActive;\n  }\n  private _drawControlIsActive = true;\n\n  set freehandDrawIsActive(value: boolean) {\n    this._freehandDrawIsActive = value;\n    this.cdRef.detectChanges();\n  }\n\n  get freehandDrawIsActive(): boolean {\n    return this._freehandDrawIsActive;\n  }\n  private _freehandDrawIsActive = false;\n\n  /**\n   * The field's form control\n   */\n  @Input() formControl: UntypedFormControl;\n\n  /**\n   * The map to draw the geometry on\n   */\n  @Input() map: IgoMap;\n\n  @Input()\n  set geometryType(value: Type) {\n    this.geometryType$.next(value);\n  }\n  get geometryType(): Type {\n    return this.geometryType$.value;\n  }\n  readonly geometryType$: BehaviorSubject<Type> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Whether a geometry type toggle should be displayed\n   */\n  @Input() geometryTypeField: boolean = false;\n\n  /**\n   * Available geometry types\n   */\n  @Input() geometryTypes: string[] = ['Point', 'LineString', 'Polygon'];\n\n  /**\n   * Whether a draw guide field should be displayed\n   */\n  @Input() drawGuideField: boolean = false;\n\n  /**\n   * The drawGuide around the mouse pointer to help drawing\n   */\n  @Input()\n  set drawGuide(value: number) {\n    this.drawGuide$.next(value);\n  }\n  get drawGuide(): number {\n    return this.drawGuide$.value;\n  }\n  readonly drawGuide$: BehaviorSubject<number> = new BehaviorSubject(0);\n\n  /**\n   * Draw guide placeholder\n   */\n  @Input() drawGuidePlaceholder: string = '';\n\n  /**\n   * Whether a measure tooltip should be displayed\n   */\n  @Input() measure: boolean = false;\n\n  /**\n   * Control options\n   */\n  @Input() controlOptions: { [key: string]: any } = {};\n\n  /**\n   * Style for the draw control (applies while the geometry is being drawn)\n   */\n  @Input() drawStyle: OlStyleLike;\n\n  /**\n   * Style for the overlay layer (applies once the geometry is added to the map)\n   * If not specified, drawStyle applies\n   */\n  @Input() overlayStyle: OlStyleLike;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Set up a value stream\n   * @internal\n   */\n  ngOnInit() {\n    this.value$.next(\n      this.formControl.value ? this.formControl.value : undefined\n    );\n    this.value$$ = this.formControl.valueChanges.subscribe(\n      (value: GeoJSONGeometry) => {\n        this.value$.next(value ? value : undefined);\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to the value stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.value$$.unsubscribe();\n  }\n}\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n    super('Failed to read file');\n    Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n    super('Nothing to import');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n    super('File is too large');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n    super('Invalid SRS definition');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportOgreServerError extends ImportError {\n  constructor() {\n    super('Error 500 with OGRE');\n    Object.setPrototypeOf(this, ImportOgreServerError.prototype);\n  }\n}\n","import { MessageService } from '@igo2/core';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { FeatureDataSourceOptions } from '../../datasource/shared/datasources/feature-datasource.interface';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  featureToOl,\n  moveToOlFeatures,\n  computeOlFeaturesExtent\n} from '../../feature/shared/feature.utils';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { StyleByAttribute } from '../../style/shared/vector/vector-style.interface';\nimport { StyleListService } from '../../style/style-list/style-list.service';\nimport { ClusterParam } from '../../layer/shared/clusterParam';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { ClusterDataSourceOptions } from '../../datasource/shared/datasources/cluster-datasource.interface';\nimport { uuid } from '@igo2/utils';\nimport {\n  featureRandomStyle,\n  featureRandomStyleFunction\n} from '../../style/shared/feature/feature-style';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { ConfirmDialogService } from '@igo2/common';\nimport { first, of } from 'rxjs';\n\nexport function addLayerAndFeaturesToMap(\n  features: Feature[],\n  map: IgoMap,\n  contextUri: string,\n  layerTitle: string,\n  layerService: LayerService,\n  storeToIdb: boolean = false\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n\n  const id = uuid();\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n    id,\n    type: 'vector',\n    queryable: true\n  };\n  const source = new FeatureDataSource(sourceOptions);\n  source.ol.addFeatures(olFeatures);\n  let randomStyle;\n  let editable: boolean = false;\n  if (\n    olFeatures[0].getKeys().includes('_style') ||\n    olFeatures[0].getKeys().includes('_mapTitle')\n  ) {\n    randomStyle = featureRandomStyleFunction();\n  } else {\n    randomStyle = featureRandomStyle();\n    editable = true;\n  }\n  const layer = layerService.createLayer({\n    id,\n    title: layerTitle,\n    workspace: { enabled: true, searchIndexEnabled: true },\n    isIgoInternalLayer: true,\n    source,\n    igoStyle: { editable },\n    idbInfo: { firstLoad: true, storeToIdb, contextUri: contextUri || '*' },\n    style: randomStyle\n  }) as VectorLayer;\n  layer.setExtent(computeOlFeaturesExtent(olFeatures, map.viewProjection));\n  map.addLayer(layer);\n  moveToOlFeatures(map.viewController, olFeatures);\n\n  return layer;\n}\n\nexport function addLayerAndFeaturesStyledToMap(\n  features: Feature[],\n  map: IgoMap,\n  layerTitle: string,\n  styleListService: StyleListService,\n  styleService: StyleService,\n  layerId?: string,\n  imposedSourceOptions?,\n  imposedLayerOptions?,\n  zoomTo: boolean = true\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n  let style;\n  let distance: number;\n\n  if (\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\n  ) {\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\n      layerTitle.toString() + '.styleByAttribute'\n    );\n\n    style = (feature, resolution) => {\n      return styleService.createStyleByAttribute(\n        feature,\n        styleByAttribute,\n        resolution\n      );\n    };\n  } else if (\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      layerTitle.toString() + '.clusterParam'\n    );\n    distance = styleListService.getStyleList(\n      layerTitle.toString() + '.distance'\n    );\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList(layerTitle.toString() + '.clusterStyle'),\n        feature,\n        resolution\n      );\n      return styleService.createClusterStyle(\n        feature,\n        resolution,\n        clusterParam,\n        baseStyle\n      );\n    };\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\n    style = (feature, resolution) =>\n      styleService.createStyle(\n        styleListService.getStyleList(layerTitle.toString() + '.style'),\n        feature,\n        resolution\n      );\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      'default.clusterParam'\n    );\n    distance = styleListService.getStyleList('default.distance');\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList('default.clusterStyle'),\n        feature,\n        resolution\n      );\n      return styleService.createClusterStyle(\n        feature,\n        resolution,\n        clusterParam,\n        baseStyle\n      );\n    };\n  } else {\n    style = (feature, resolution) =>\n      styleService.createStyle(\n        styleListService.getStyleList('default.style'),\n        feature,\n        resolution\n      );\n  }\n\n  let source;\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions =\n      {\n        distance,\n        type: 'cluster',\n        queryable: true\n      };\n    source = new ClusterDataSource(\n      Object.assign(sourceOptions, imposedSourceOptions)\n    );\n    source.ol.source.addFeatures(olFeatures);\n  } else if (styleListService.getStyleList(layerTitle.toString())) {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions =\n      {\n        type: 'vector',\n        queryable: true\n      };\n    source = new FeatureDataSource(\n      Object.assign(sourceOptions, imposedSourceOptions)\n    );\n    source.ol.addFeatures(olFeatures);\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions =\n      {\n        distance,\n        type: 'cluster',\n        queryable: true\n      };\n    source = new ClusterDataSource(\n      Object.assign(sourceOptions, imposedSourceOptions)\n    );\n    source.ol.source.addFeatures(olFeatures);\n  } else {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions =\n      {\n        type: 'vector',\n        queryable: true\n      };\n    source = new FeatureDataSource(\n      Object.assign(sourceOptions, imposedSourceOptions)\n    );\n    source.ol.addFeatures(olFeatures);\n  }\n\n  const layer = new VectorLayer(\n    Object.assign(\n      {\n        title: layerTitle,\n        id: layerId || uuid(),\n        isIgoInternalLayer: true,\n        source,\n        style\n      },\n      imposedLayerOptions\n    )\n  );\n  map.addLayer(layer);\n  if (zoomTo) {\n    moveToOlFeatures(map.viewController, olFeatures);\n  }\n  return layer;\n}\n\nfunction padTo2Digits(num) {\n  return num.toString().padStart(2, '0');\n}\n\nexport function handleFileImportSuccess(\n  file: File,\n  features: Feature[],\n  map: IgoMap,\n  contextUri: string,\n  messageService: MessageService,\n  layerService: LayerService,\n  confirmDialogService?: ConfirmDialogService,\n  styleListService?: StyleListService,\n  styleService?: StyleService\n) {\n  if (features.length === 0) {\n    handleNothingToImportError(file, messageService);\n    return;\n  }\n\n  let layerTitle = computeLayerTitleFromFile(file);\n\n  const obs$ = confirmDialogService\n    ? confirmDialogService.open('igo.geo.import.promptStoreToIdb')\n    : of(false);\n\n  obs$.pipe(first()).subscribe((confirm) => {\n    const d = new Date();\n    const dformat =\n      [\n        d.getFullYear(),\n        padTo2Digits(d.getMonth() + 1),\n        padTo2Digits(d.getDate())\n      ].join('/') +\n      ' ' +\n      [padTo2Digits(d.getHours()), padTo2Digits(d.getMinutes())].join(':');\n\n    layerTitle = confirm ? `${layerTitle} (${dformat})` : layerTitle;\n    if (!styleListService) {\n      addLayerAndFeaturesToMap(\n        features,\n        map,\n        contextUri,\n        layerTitle,\n        layerService,\n        confirm\n      );\n    } else {\n      addLayerAndFeaturesStyledToMap(\n        features,\n        map,\n        layerTitle,\n        styleListService,\n        styleService\n      );\n    }\n\n    messageService.success(\n      'igo.geo.dropGeoFile.success.text',\n      'igo.geo.dropGeoFile.success.title',\n      undefined,\n      { value: layerTitle }\n    );\n  });\n}\n\nexport function handleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  sizeMb?: number\n) {\n  sizeMb = sizeMb ? sizeMb : 30;\n  const errMapping = {\n    'Invalid file': handleInvalidFileImportError,\n    'File is too large': handleSizeFileImportError,\n    'Failed to read file': handleUnreadbleFileImportError,\n    'Invalid SRS definition': handleSRSImportError,\n    'Error 500 with OGRE': handleOgreServerImportError\n  };\n  errMapping[error.message](file, error, messageService, sizeMb);\n}\n\nexport function handleInvalidFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.invalid.text',\n    'igo.geo.dropGeoFile.invalid.title',\n    undefined,\n    {\n      value: file.name,\n      mimeType: file.type\n    }\n  );\n}\n\nexport function handleUnreadbleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.unreadable.text',\n    'igo.geo.dropGeoFile.unreadable.title',\n    undefined,\n    { value: file.name }\n  );\n}\n\nexport function handleSizeFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  sizeMb: number\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.tooLarge.text',\n    'igo.geo.dropGeoFile.tooLarge.title',\n    undefined,\n    {\n      value: file.name,\n      size: sizeMb\n    }\n  );\n}\n\nexport function handleNothingToImportError(\n  file: File,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.empty.text',\n    'igo.geo.dropGeoFile.empty.title',\n    undefined,\n    {\n      value: file.name,\n      mimeType: file.type\n    }\n  );\n}\n\nexport function handleSRSImportError(\n  file: File,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.invalidSRS.text',\n    'igo.geo.dropGeoFile.invalidSRS.title',\n    undefined,\n    {\n      value: file.name,\n      mimeType: file.type\n    }\n  );\n}\n\nexport function handleOgreServerImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.geo.dropGeoFile.ogreServer.text',\n    'igo.geo.dropGeoFile.ogreServer.title'\n  );\n}\n\nexport function getFileExtension(file: File): string {\n  return file.name.split('.').pop().toLowerCase();\n}\n\nexport function computeLayerTitleFromFile(file: File): string {\n  return file.name.substr(0, file.name.lastIndexOf('.'));\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\nimport { uuid } from '@igo2/utils';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport * as olformat from 'ol/format';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  ImportInvalidFileError,\n  ImportUnreadableFileError,\n  ImportSizeError,\n  ImportSRSError,\n  ImportOgreServerError\n} from './import.errors';\nimport { computeLayerTitleFromFile, getFileExtension } from './import.utils';\nimport { ImportExportServiceOptions } from './import.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ImportService {\n  static formatExtensionAssociation = {\n    GeoJSON: 'geojson',\n    GML: 'gml',\n    GPX: 'gpx',\n    KML: 'kml',\n    Shapefile: 'zip'\n  };\n\n  static allowedMimeTypes = [\n    'application/gml+xml',\n    'application/vnd.google-earth.kml+xml',\n    'application/gpx+xml',\n    'application/json'\n  ];\n\n  static allowedZipMimeTypes = [\n    'application/zip',\n    'application/x-zip-compressed',\n    'application/x-zip'\n  ];\n\n  static allowedExtensions = ['geojson', 'kml', 'gpx', 'json', 'gml', 'zip'];\n\n  private ogreUrl: string;\n  private clientSideFileSizeMax: number;\n\n  constructor(\n    private http: HttpClient,\n    private config: ConfigService\n  ) {\n    const importConfig = this.config.getConfig(\n      'importExport'\n    ) as ImportExportServiceOptions;\n    this.ogreUrl = importConfig.url;\n    const configFileSizeMb = importConfig.clientSideFileSizeMaxMb;\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    if (importConfig.formats) {\n      ImportService.allowedExtensions = importConfig.formats\n        .map((format) => ImportService.formatExtensionAssociation[format])\n        .filter((e) => e);\n      if (ImportService.allowedExtensions.includes('geojson')) {\n        ImportService.allowedExtensions.push('json');\n      }\n    }\n  }\n\n  import(\n    file: File,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<Feature[]> {\n    return this.importAsync(file, projectionIn, projectionOut);\n  }\n\n  private getFileImporter(\n    file: File\n  ): (\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) => void {\n    const extension = getFileExtension(file);\n    const allowedExtensions = ImportService.allowedExtensions;\n    let zipMimeTypes = [];\n    if (allowedExtensions.includes('zip')) {\n      zipMimeTypes = ImportService.allowedZipMimeTypes;\n    }\n    const mimeType = file.type;\n    const allowedMimeTypes = [\n      ...ImportService.allowedMimeTypes,\n      ...zipMimeTypes\n    ];\n\n    if (\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\n      allowedExtensions.indexOf(extension) < 0\n    ) {\n      return undefined;\n    } else if (\n      mimeType === 'application/json' ||\n      ['json', 'geojson', 'kml', 'gpx'].indexOf(extension) >= 0\n    ) {\n      return this.importFile;\n    } else if (this.ogreUrl !== undefined) {\n      return this.importFileWithOgre;\n    }\n\n    return undefined;\n  }\n\n  private importAsync(\n    file: File,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<Feature[]> {\n    const doImport = (observer: Observer<Feature[]>) => {\n      if (file.size >= this.clientSideFileSizeMax) {\n        observer.error(new ImportSizeError());\n        return;\n      }\n      const importer = this.getFileImporter(file);\n      if (importer === undefined) {\n        observer.error(new ImportInvalidFileError());\n        return;\n      }\n\n      importer.call(this, file, observer, projectionIn, projectionOut);\n    };\n\n    return new Observable(doImport);\n  }\n\n  private importFile(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const reader = new FileReader();\n\n    reader.onload = (event: any) => {\n      try {\n        const features = this.parseFeaturesFromFile(\n          file,\n          event.target.result,\n          projectionIn,\n          projectionOut\n        );\n        observer.next(features);\n      } catch (e) {\n        observer.error(new ImportUnreadableFileError());\n      }\n\n      observer.complete();\n    };\n\n    reader.onerror = (evt) => {\n      observer.error(new ImportUnreadableFileError());\n    };\n\n    reader.readAsText(file, 'UTF-8');\n  }\n\n  private importFileWithOgre(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const url = `${this.ogreUrl}/convert`;\n    const formData = new FormData();\n    formData.append('upload', file);\n    formData.append('sourceSrs', projectionIn);\n    formData.append('targetSrs', projectionOut);\n    formData.append('formatOutput', 'GEOJSON');\n    formData.append('skipFailures', '');\n\n    this.http.post(url, formData, { headers: new HttpHeaders() }).subscribe(\n      (response: { errors?: string[] } | object | null) => {\n        if (response === null) {\n          observer.error(new ImportUnreadableFileError());\n          return;\n        }\n\n        const errors = (response as any).errors || [];\n        if (errors.length > 0) {\n          observer.error(new ImportUnreadableFileError());\n        } else {\n          const features = this.parseFeaturesFromGeoJSON(\n            file,\n            response,\n            projectionOut\n          );\n          observer.next(features);\n          observer.complete();\n        }\n      },\n      (error: any) => {\n        error.error.caught = true;\n        const errMsg = error.error.msg || '';\n        if (errMsg === 'No valid files found') {\n          observer.error(new ImportInvalidFileError());\n        } else if (\n          errMsg &&\n          errMsg.startWith('ERROR 1: Failed to process SRS definition')\n        ) {\n          observer.error(new ImportSRSError());\n        } else if (error.status === 500) {\n          observer.error(new ImportOgreServerError());\n        } else {\n          observer.error(new ImportUnreadableFileError());\n        }\n      }\n    );\n  }\n\n  private parseFeaturesFromFile(\n    file: File,\n    data: string,\n    projectionIn: string,\n    projectionOut: string\n  ): Feature[] {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n\n    const GeoJSON = new olformat.GeoJSON();\n\n    let format;\n    if (mimeType === 'application/vnd.google-earth.kml+xml') {\n      format = new olformat.KML();\n    } else if (mimeType === 'application/gml+xml') {\n      format = new olformat.GML();\n    } else if (mimeType === 'application/gpx+xml') {\n      format = new olformat.GPX();\n    } else {\n      switch (extension) {\n        case 'kml':\n          format = new olformat.KML();\n          break;\n        case 'gpx':\n          format = new olformat.GPX();\n          break;\n        case 'gml':\n          format = new olformat.GML();\n          break;\n        default:\n          format = GeoJSON;\n          break;\n      }\n    }\n\n    const olFeatures = format.readFeatures(data, {\n      dataProjection: projectionIn,\n      featureProjection: projectionOut\n    });\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(GeoJSON.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features;\n  }\n\n  private parseFeaturesFromGeoJSON(\n    file: File,\n    data: object,\n    projectionOut: string\n  ): Feature[] {\n    const olFormat = new olformat.GeoJSON();\n    const olFeatures = olFormat.readFeatures(data);\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(olFormat.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features as Feature[];\n  }\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const ExportFormat = strEnum([\n  'URL',\n  'GeoJSON',\n  'GML',\n  'GPX',\n  'KML',\n  'Shapefile',\n  'CSVcomma',\n  'CSVsemicolon'\n]);\nexport type ExportFormat = keyof typeof ExportFormat;\n\nexport const EncodingFormat = strEnum(['UTF8', 'LATIN1']);\nexport type EncodingFormat = keyof typeof EncodingFormat;\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport { downloadContent } from '@igo2/utils';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport * as olformat from 'ol/format';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { encode } from 'windows-1252';\n\nimport { ExportFormat, EncodingFormat } from './export.type';\n\nimport {\n  ExportInvalidFileError,\n  ExportNothingToExportError\n} from './export.errors';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ExportService {\n  static ogreFormats = {\n    GML: 'gml',\n    GPX: 'gpx',\n    KML: 'kml',\n    Shapefile: 'ESRI Shapefile',\n    CSVcomma: 'CSVcomma',\n    CSVsemicolon: 'CSVsemicolon'\n  };\n\n  static noOgreFallbacks = ['GML', 'GPX', 'KML'];\n\n  private ogreUrl: string;\n  private aggregateInComment: boolean = true;\n\n  constructor(private config: ConfigService) {\n    this.ogreUrl = this.config.getConfig('importExport.url');\n    const gpxAggregateInComment = this.config.getConfig(\n      'importExport.gpxAggregateInComment'\n    );\n    if (gpxAggregateInComment !== undefined) {\n      this.aggregateInComment = gpxAggregateInComment;\n    }\n  }\n\n  export(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<void> {\n    const exportOlFeatures = this.generateFeature(\n      olFeatures,\n      format,\n      '_featureStore'\n    );\n\n    return this.exportAsync(\n      exportOlFeatures,\n      format,\n      title,\n      encoding,\n      projectionIn,\n      projectionOut\n    );\n  }\n\n  public generateFeature(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    excludePrefix: string = '_'\n  ): OlFeature<OlGeometry>[] {\n    if (format === ExportFormat.GPX && this.aggregateInComment) {\n      return this.generateAggregatedFeature(olFeatures);\n    }\n\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      const keys = olFeature\n        .getKeys()\n        .filter((key: string) => !key.startsWith(excludePrefix));\n      const properties = keys.reduce(\n        (acc: object, key: string) => {\n          acc[key] = olFeature.get(key);\n          return acc;\n        },\n        { geometry: olFeature.getGeometry() }\n      );\n      return new OlFeature(properties);\n    });\n  }\n\n  private generateAggregatedFeature(\n    olFeatures: OlFeature<OlGeometry>[]\n  ): OlFeature<OlGeometry>[] {\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      const keys = olFeature\n        .getKeys()\n        .filter((key: string) => !key.startsWith('_'));\n      let comment: string = '';\n      const properties = keys.reduce(\n        (acc: object, key: string) => {\n          if (key && key !== 'geometry') {\n            key === 'id' && olFeature.get('draw')\n              ? (comment += key + ':' + olFeature.get('draw') + '   \\r\\n')\n              : (comment += key + ':' + olFeature.get(key) + '   \\r\\n');\n          }\n          acc[key] = olFeature.get(key);\n          return acc;\n        },\n        {\n          geometry: olFeature.getGeometry()\n        }\n      );\n      const newFeature = new OlFeature(properties);\n      newFeature.set('name', olFeature.getId());\n      newFeature.set('cmt', comment);\n\n      return newFeature;\n    });\n  }\n\n  private exportAsync(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<void> {\n    const doExport = (observer: Observer<void>) => {\n      const nothingToExport = this.nothingToExport(olFeatures, format);\n      if (nothingToExport) {\n        observer.error(new ExportNothingToExportError());\n        return;\n      }\n\n      const ogreFormats = Object.keys(ExportService.ogreFormats);\n      if (ogreFormats.indexOf(format) >= 0) {\n        if (!this.ogreUrl) {\n          if (ExportService.noOgreFallbacks.indexOf(format) >= 0) {\n            this.exportToFile(\n              olFeatures,\n              observer,\n              format,\n              title,\n              projectionIn,\n              projectionOut\n            );\n          } else {\n            observer.error(new ExportInvalidFileError());\n          }\n          return;\n        }\n        this.exportWithOgre(\n          olFeatures,\n          observer,\n          format,\n          title,\n          encoding,\n          projectionIn,\n          projectionOut\n        );\n      } else {\n        this.exportToFile(\n          olFeatures,\n          observer,\n          format,\n          title,\n          projectionIn,\n          projectionOut\n        );\n      }\n    };\n\n    return new Observable(doExport);\n  }\n\n  protected exportToFile(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: ExportFormat,\n    title: string,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const olFormat = new olformat[format]();\n    const featuresText = olFormat.writeFeatures(olFeatures, {\n      dataProjection: projectionOut,\n      featureProjection: projectionIn,\n      featureType: 'feature',\n      featureNS: 'http://example.com/feature'\n    });\n\n    const fileName = `${title}.${format.toLowerCase()}`;\n\n    downloadContent(featuresText, 'text/plain;charset=utf-8', fileName);\n    observer.complete();\n  }\n\n  private exportWithOgre(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: string,\n    title: string,\n    encodingType: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    let featuresText: string = new olformat.GeoJSON().writeFeatures(\n      olFeatures,\n      {\n        dataProjection: projectionOut,\n        featureProjection: projectionIn\n      }\n    );\n\n    const url = `${this.ogreUrl}/convertJson`;\n    const form = document.createElement('form');\n    form.style.display = 'none';\n    document.body.appendChild(form);\n    form.setAttribute('method', 'post');\n    form.setAttribute('target', '_blank');\n    form.setAttribute('action', url);\n\n    if (encodingType === EncodingFormat.UTF8) {\n      form.acceptCharset = 'UTF-8';\n      form.enctype = 'application/x-www-form-urlencoded; charset=utf-8;';\n    } else if (encodingType === EncodingFormat.LATIN1) {\n      const enctype = 'ISO-8859-1';\n      const featuresJson = JSON.parse(featuresText);\n      featuresJson.features.map((f) => {\n        const encodedProperties = String.fromCharCode.apply(\n          null,\n          encode(JSON.stringify(f.properties), { mode: 'replacement' })\n        );\n        f.properties = JSON.parse(encodedProperties);\n      });\n      featuresText = JSON.stringify(featuresJson);\n      const encoding = document.createElement('input');\n      encoding.setAttribute('type', 'hidden');\n      encoding.setAttribute('name', 'encoding');\n      encoding.setAttribute('value', enctype);\n      form.appendChild(encoding);\n    }\n\n    if (format === 'CSVsemicolon') {\n      const options = document.createElement('input');\n      options.setAttribute('type', 'hidden');\n      options.setAttribute('name', 'lco');\n      options.setAttribute('value', 'SEPARATOR=SEMICOLON');\n      form.appendChild(options);\n    }\n\n    const geojsonField = document.createElement('input');\n    geojsonField.setAttribute('type', 'hidden');\n    geojsonField.setAttribute('name', 'json');\n    geojsonField.setAttribute('value', featuresText);\n    form.appendChild(geojsonField);\n\n    const outputNameField = document.createElement('input');\n    let outputName =\n      format === 'Shapefile'\n        ? `${title}.zip`\n        : `${title}.${format.toLowerCase()}`;\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      outputName = `${title}.csv`;\n    }\n    outputName = outputName.replace(' ', '_');\n    outputName = outputName\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .replace(/’/g, \"'\");\n    outputNameField.setAttribute('type', 'hidden');\n    outputNameField.setAttribute('name', 'outputName');\n    outputNameField.setAttribute('value', outputName);\n    form.appendChild(outputNameField);\n\n    let ogreFormat = ExportService.ogreFormats[format];\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      ogreFormat = 'CSV';\n    }\n    const outputFormatField = document.createElement('input');\n    outputFormatField.setAttribute('type', 'hidden');\n    outputFormatField.setAttribute('name', 'format');\n    outputFormatField.setAttribute('value', ogreFormat);\n    form.appendChild(outputFormatField);\n\n    form.submit();\n    document.body.removeChild(form);\n\n    observer.complete();\n  }\n\n  private nothingToExport(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: string\n  ): boolean {\n    if (olFeatures.length === 0) {\n      return true;\n    }\n    if (format === 'GPX') {\n      const pointOrLine = olFeatures.find((olFeature) => {\n        return (\n          ['Point', 'LineString', 'MultiLineString'].indexOf(\n            olFeature.getGeometry().getType()\n          ) >= 0\n        );\n      });\n      return pointOrLine === undefined;\n    }\n    return false;\n  }\n}\n","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'igo-custom-html',\n  templateUrl: './custom-html.component.html',\n  styleUrls: ['./custom-html.component.scss']\n})\nexport class CustomHtmlComponent {\n  @Input()\n  get html(): string {\n    return this._html;\n  }\n  set html(value: string) {\n    this._html = value;\n  }\n  private _html = '';\n\n  constructor() {}\n}\n","<div class=\"custom-html\" [innerHTML]=\"html | sanitizeHtml\"></div>\n","<div class=\"import-export-toggle mat-typography\">\n  <mat-button-toggle-group\n    [value]=\"selectedMode\"\n    (change)=\"onImportExportChange($event)\"\n  >\n    <mat-button-toggle [value]=\"'import'\">\n      {{ 'igo.geo.importExportForm.importTabTitle' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle [value]=\"'export'\">\n      {{ 'igo.geo.importExportForm.exportTabTitle' | translate }}\n    </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<form\n  class=\"igo-form\"\n  [formGroup]=\"importForm\"\n  *ngIf=\"selectedMode === 'import'\"\n>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.importExportForm.importProjPlaceholder' | translate\n      }}</mat-label>\n      <mat-select [(value)]=\"inputProj\">\n        <mat-option\n          *ngFor=\"let projection of projections$ | async\"\n          [value]=\"projection\"\n          (click)=\"$event.stopPropagation()\"\n        >\n          <p matListItemTitle *ngIf=\"projection.translateKey\">\n            {{\n              'igo.geo.importExportForm.projections.' + projection.translateKey\n                | translate: projection\n            }}\n          </p>\n          <p matListItemTitle *ngIf=\"!projection.translateKey\">\n            {{ projection.alias }}\n          </p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"\n      importForm.invalid\n        ? ('igo.geo.importExportForm.projections.choose' | translate)\n        : ('igo.geo.importExportForm.importButton' | translate)\n    \"\n    class=\"igo-form-button-group\"\n  >\n    <button\n      [disabled]=\"importForm.invalid || (loading$ | async)\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"fileInput.click()\"\n    >\n      {{ 'igo.geo.importExportForm.importButton' | translate }}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n    <input\n      hidden\n      #fileInput\n      type=\"file\"\n      [style.display]=\"'none'\"\n      (click)=\"fileInput.value = null\"\n      (change)=\"importFiles($event.target.files)\"\n    />\n  </div>\n</form>\n<section class=\"mat-typography\" *ngIf=\"selectedMode === 'import'\">\n  <div *ngIf=\"importHtmlClarifications === ''\">\n    <h4>{{ 'igo.geo.importExportForm.importClarifications' | translate }}</h4>\n    <ul>\n      <li>\n        {{\n          'igo.geo.importExportForm.importSizeMax'\n            | translate: { size: fileSizeMb }\n        }}\n      </li>\n      <li>\n        {{ 'igo.geo.importExportForm.importFormatAuthorized' | translate }}\n      </li>\n      <li>{{ 'igo.geo.importExportForm.importShpZip' | translate }}</li>\n    </ul>\n  </div>\n  <igo-custom-html\n    *ngIf=\"importHtmlClarifications !== ''\"\n    class=\"mat-typography\"\n    [html]=\"importHtmlClarifications\"\n  >\n  </igo-custom-html>\n</section>\n\n<section\n  class=\"mat-typography\"\n  *ngIf=\"(exportableLayers$ | async).length === 0 && selectedMode === 'export'\"\n>\n  <h4>{{ 'igo.geo.importExportForm.exportNoLayersExportable' | translate }}</h4>\n</section>\n\n<form\n  class=\"igo-form\"\n  [formGroup]=\"form\"\n  *ngIf=\"(exportableLayers$ | async).length > 0 && selectedMode === 'export'\"\n>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.importExportForm.exportLayerPlaceholder' | translate\n      }}</mat-label>\n      <mat-select [(value)]=\"layers\" multiple>\n        <mat-select-trigger>\n          {{ layers.length ? getLayerTitleById(layers[0]) : '' }}\n          <span *ngIf=\"layers.length > 1\" class=\"export-select-trigger\">\n            (+{{ layers.length - 1 }}\n            {{\n              (layers?.length === 2\n                ? 'igo.geo.importExportForm.other'\n                : 'igo.geo.importExportForm.others'\n              ) | translate\n            }})\n          </span>\n        </mat-select-trigger>\n        <mat-option\n          *ngFor=\"let layer of exportableLayers$ | async\"\n          [ngClass]=\"{\n            'igo-export-layer-mat-option': layerHasSelectedFeatures(layer)\n          }\"\n          [value]=\"layer.id\"\n          (click)=\"$event.stopPropagation()\"\n        >\n          <p matListItemTitle>{{ layer.title }}</p>\n          <p matListItemTitle>\n            <mat-slide-toggle\n              *ngIf=\"layerHasSelectedFeatures(layer)\"\n              (click)=\"onlySelectedClick($event, layer.id)\"\n              (checked)=\"inLayersIdToExportSelectionOnly(layer)\"\n              (change)=\"onlySelected($event, layer.id)\"\n            >\n              <small>{{\n                'igo.geo.importExportForm.exportSelectedFeature' | translate\n              }}</small>\n            </mat-slide-toggle>\n          </p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.importExportForm.exportFormatPlaceholder' | translate\n      }}</mat-label>\n      <mat-select formControlName=\"format\">\n        <ng-container *ngIf=\"(formats$ | async).length !== 0\">\n          <mat-option\n            *ngFor=\"let format of formats$ | async | keyvalue\"\n            [value]=\"format.key\"\n          >\n            {{ 'igo.geo.export.format.' + format.value | translate }}\n          </mat-option>\n        </ng-container>\n        <mat-option *ngIf=\"(formats$ | async).length === 0\" disabled=\"true\">\n          {{ 'igo.geo.export.noFormat.title' | translate }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    *ngIf=\"forceNaming && form.value.format !== 'URL'\"\n  >\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"name\"\n        placeholder=\"{{\n          'igo.geo.importExportForm.exportFileNamePlaceholder' | translate\n        }}\"\n      />\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    *ngIf=\"\n      form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon'\n    \"\n  >\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.importExportForm.encodingPlaceholder' | translate\n      }}</mat-label>\n      <mat-select formControlName=\"encoding\">\n        <ng-container *ngIf=\"(encodings$ | async).length !== 0\">\n          <mat-option\n            *ngFor=\"let encoding of encodings$ | async | keyvalue\"\n            [value]=\"encoding.key\"\n          >\n            {{ 'igo.geo.export.encoding.' + encoding.value | translate }}\n          </mat-option>\n        </ng-container>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"export-combine-layers mat-typography\"\n    *ngIf=\"\n      layers.length > 1 &&\n      (form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon')\n    \"\n  >\n    <mat-slide-toggle\n      formControlName=\"combineLayers\"\n      [labelPosition]=\"'before'\"\n    >\n      {{ 'igo.geo.importExportForm.exportCombineResults' | translate }}\n    </mat-slide-toggle>\n  </div>\n\n  <div\n    class=\"export-separator mat-typography\"\n    *ngIf=\"\n      layers.length > 1 &&\n      (form.value.format === 'CSVcomma' ||\n        form.value.format === 'CSVsemicolon') &&\n      form.value.combineLayers\n    \"\n  >\n    <mat-slide-toggle formControlName=\"separator\" [labelPosition]=\"'before'\">\n      {{ 'igo.geo.importExportForm.exportSeparator' | translate }}\n    </mat-slide-toggle>\n  </div>\n\n  <div\n    class=\"export-options mat-typography\"\n    *ngIf=\"form.value.format !== 'URL'\"\n  >\n    <mat-slide-toggle\n      formControlName=\"featureInMapExtent\"\n      [labelPosition]=\"'before'\"\n    >\n      {{ 'igo.geo.importExportForm.exportFeatureInExtent' | translate }}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (loading$ | async)\"\n      (click)=\"handleExportFormSubmit(form.value)\"\n    >\n      {{\n        form.value.format !== 'URL'\n          ? ('igo.geo.importExportForm.exportButton' | translate)\n          : form.value.layers.length > 1\n          ? ('igo.geo.importExportForm.exportButtonLinks' | translate)\n          : ('igo.geo.importExportForm.exportButtonLink' | translate)\n      }}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n  </div>\n\n  <igo-custom-html\n    *ngIf=\"exportHtmlClarifications !== ''\"\n    class=\"mat-typography\"\n    [html]=\"exportHtmlClarifications\"\n  >\n  </igo-custom-html>\n</form>\n","import {\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  EventEmitter,\n  ChangeDetectorRef\n} from '@angular/core';\nimport {\n  UntypedFormGroup,\n  UntypedFormBuilder,\n  Validators\n} from '@angular/forms';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport {\n  MessageService,\n  LanguageService,\n  ConfigService,\n  StorageService\n} from '@igo2/core';\nimport { strEnum } from '@igo2/utils';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { IgoMap } from '../../map/shared/map';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\nimport olPoint from 'ol/geom/Point';\nimport { circular } from 'ol/geom/Polygon';\n\nimport {\n  handleFileExportError,\n  handleFileExportSuccess\n} from '../shared/export.utils';\nimport { ExportOptions } from '../shared/export.interface';\nimport { ExportFormat, EncodingFormat } from '../shared/export.type';\nimport { ExportService } from '../shared/export.service';\nimport { ImportService } from '../shared/import.service';\nimport {\n  handleFileImportSuccess,\n  handleFileImportError\n} from '../shared/import.utils';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { StyleListService } from '../../style/style-list/style-list.service';\nimport { skipWhile } from 'rxjs/operators';\nimport { ConfirmDialogService, EntityRecord, Workspace } from '@igo2/common';\nimport type { WorkspaceStore } from '@igo2/common';\nimport { WfsWorkspace } from '../../workspace/shared/wfs-workspace';\nimport { EditionWorkspace } from '../../workspace/shared/edition-workspace';\nimport { FeatureWorkspace } from '../../workspace/shared/feature-workspace';\nimport { MatSlideToggleChange } from '@angular/material/slide-toggle';\nimport { InputProjections, ProjectionsLimitationsOptions } from '../../map/';\nimport { DownloadService } from '../../download/shared/download.service';\nimport { computeProjectionsConstraints } from '../../map/shared';\n\nimport olVectorSource from 'ol/source/Vector';\nimport olClusterSource from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { ImportExportServiceOptions } from '../shared/import.interface';\n\n@Component({\n  selector: 'igo-import-export',\n  templateUrl: './import-export.component.html',\n  styleUrls: ['./import-export.component.scss']\n})\nexport class ImportExportComponent implements OnDestroy, OnInit {\n  public form: UntypedFormGroup;\n  public importForm: UntypedFormGroup;\n  public formats$ = new BehaviorSubject(undefined);\n  public encodings$ = new BehaviorSubject(undefined);\n  public exportableLayers$: BehaviorSubject<AnyLayer[]> = new BehaviorSubject(\n    []\n  );\n  public loading$ = new BehaviorSubject(false);\n  public forceNaming = false;\n  public controlFormat = 'format';\n\n  private layers$$: Subscription;\n  private exportableLayers$$: Subscription;\n  private formats$$: Subscription;\n  private encodings$$: Subscription;\n  private formLayer$$: Subscription;\n  private exportOptions$$: Subscription;\n\n  public importHtmlClarifications: string;\n  public exportHtmlClarifications: string;\n\n  private espgCodeRegex = new RegExp('^\\\\d{4,6}');\n  private clientSideFileSizeMax: number;\n  public fileSizeMb: number;\n\n  public projections$: BehaviorSubject<InputProjections[]> =\n    new BehaviorSubject([]);\n  private projectionsConstraints: ProjectionsLimitationsOptions;\n\n  public popupChecked: boolean = false;\n\n  private previousLayerSpecs$: BehaviorSubject<\n    {\n      id: string;\n      visible: boolean;\n      opacity: number;\n      queryable: boolean;\n    }[]\n  > = new BehaviorSubject(undefined);\n\n  @Input() selectFirstProj: boolean = false;\n\n  @Input() map: IgoMap;\n\n  @Input() contextUri: string;\n\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\n  @Input()\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\n    this._projectionsLimitations = value;\n    this.computeProjections();\n  }\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\n    return this._projectionsLimitations || {};\n  }\n\n  /**\n   * Store that holds the available workspaces.\n   */\n  @Input() store: WorkspaceStore;\n\n  @Input() selectedMode = 'import';\n\n  @Output() selectMode = new EventEmitter<string>();\n\n  @Input() exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\n    undefined\n  );\n\n  @Output() exportOptionsChange = new EventEmitter<ExportOptions>();\n\n  get layers() {\n    return this.form.get('layers').value;\n  }\n  set layers(value) {\n    this.form.patchValue({ layers: value });\n  }\n\n  get inputProj() {\n    return this.importForm.get('inputProj').value;\n  }\n  set inputProj(value) {\n    this.importForm.patchValue({ inputProj: value });\n  }\n\n  get popupAllowed(): boolean {\n    return (\n      (this.storageService.get('importExportPopupAllowed') as boolean) || false\n    );\n  }\n\n  set popupAllowed(value: boolean) {\n    this.storageService.set('importExportPopupAllowed', value);\n  }\n\n  constructor(\n    private importService: ImportService,\n    private exportService: ExportService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    private formBuilder: UntypedFormBuilder,\n    private config: ConfigService,\n    private cdRef: ChangeDetectorRef,\n    private storageService: StorageService,\n    private downloadService: DownloadService,\n    private layerService: LayerService,\n    private confirmDialogService: ConfirmDialogService\n  ) {\n    this.loadConfig();\n    this.buildForm();\n    this.computeProjections();\n    this.importHtmlClarifications = this.languageService.translate.instant(\n      'igo.geo.importExportForm.importHtmlClarifications'\n    );\n    this.exportHtmlClarifications = this.languageService.translate.instant(\n      'igo.geo.importExportForm.exportHtmlClarifications'\n    );\n  }\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      this.exportableLayers$.next(\n        layers.filter((layer: Layer) => {\n          return (\n            (layer instanceof VectorLayer && layer.exportable === true) ||\n            (layer.dataSource.options.download &&\n              layer.dataSource.options.download.url)\n          );\n        }) as AnyLayer[]\n      );\n    });\n    const configFileSizeMb = this.config.getConfig(\n      'importExport.clientSideFileSizeMaxMb'\n    );\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\n\n    this.exportOptions$$ = this.exportOptions$\n      .pipe(skipWhile((exportOptions) => !exportOptions))\n      .subscribe((exportOptions) => {\n        this.form.patchValue(exportOptions, { emitEvent: true });\n        if (exportOptions.layers) {\n          this.computeFormats(\n            exportOptions.layers.map((l) => this.map.getLayerById(l))\n          );\n        }\n      });\n    this.formLayer$$ = this.form\n      .get('format')\n      .valueChanges.subscribe((format) => {\n        const ogreFormats = Object.keys(ExportService.ogreFormats);\n        if (\n          !this.popupChecked &&\n          this.form.get('layers').value?.length > 1 &&\n          (ogreFormats.indexOf(format) >= 0 || format === ExportFormat.URL)\n        ) {\n          if (!this.handlePopup(true)) {\n            this.form.patchValue({ format: undefined }, { emitEvent: false });\n          }\n        }\n      });\n\n    this.formLayer$$ = this.form\n      .get('layers')\n      .valueChanges.subscribe((layersId) => {\n        this.handlePreviousLayerSpecs();\n        const selectedLayers =\n          layersId instanceof Array ? layersId : [layersId];\n        this.form.patchValue({ layers: selectedLayers }, { emitEvent: false });\n        const layers = selectedLayers.map((l) => this.map.getLayerById(l));\n        this.computeFormats(layers);\n\n        if (\n          Object.keys(this.formats$.value).indexOf(this.form.value.format) ===\n          -1\n        ) {\n          this.form.patchValue({ format: undefined });\n        }\n\n        this.loading$.next(true);\n        const previousSpecs: {\n          id: string;\n          visible: boolean;\n          opacity: number;\n          queryable: boolean;\n        }[] = [];\n        layers.forEach((layer) => {\n          if (\n            layer instanceof VectorLayer &&\n            layer.dataSource.ol.getFeatures().length === 0\n          ) {\n            previousSpecs.push({\n              id: layer.id,\n              visible: layer.visible,\n              opacity: layer.opacity,\n              queryable: (layer as any).queryable\n            });\n            layer.opacity = 0;\n            layer.visible = true;\n          }\n        });\n\n        this.previousLayerSpecs$.next(previousSpecs);\n        setTimeout(() => {\n          this.loading$.next(false);\n        }, 500);\n      });\n\n    this.formats$$ = this.formats$\n      .pipe(skipWhile((formats) => !formats))\n      .subscribe((formats) => {\n        if (Object.keys(formats).length === 1) {\n          this.form.patchValue({ format: formats[Object.keys(formats)[0]] });\n        }\n      });\n\n    this.encodings$$ = this.encodings$\n      .pipe(skipWhile((encodings) => !encodings))\n      .subscribe((encodings) => {\n        if (Object.keys(encodings).length === 1) {\n          this.form.patchValue({\n            encoding: encodings[Object.keys(encodings)[0]]\n          });\n        }\n      });\n\n    this.exportableLayers$$ = this.exportableLayers$\n      .pipe(skipWhile((layers) => !layers))\n      .subscribe((layers) => {\n        if (layers.length === 1) {\n          this.form.patchValue({ layers: layers[0].id });\n        }\n      });\n\n    this.form.controls[this.controlFormat].valueChanges.subscribe((format) => {\n      if (\n        format === ExportFormat.CSVcomma ||\n        format === ExportFormat.CSVsemicolon\n      ) {\n        this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      } else {\n        this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      }\n      this.cdRef.detectChanges();\n    });\n\n    if (this.selectFirstProj) {\n      if (this.projections$.value.length === 0) {\n        this.importForm.patchValue({\n          inputProj: {\n            translateKey: 'nad83',\n            alias: 'NAD83',\n            code: 'EPSG:4326',\n            zone: ''\n          }\n        });\n      } else {\n        this.importForm.patchValue({ inputProj: this.projections$.value[0] });\n      }\n    } else {\n      this.importForm.patchValue({ inputProj: undefined });\n    }\n  }\n\n  private computeProjections() {\n    this.projectionsConstraints = computeProjectionsConstraints(\n      this.projectionsLimitations\n    );\n    const projections: InputProjections[] = [];\n\n    if (this.projectionsConstraints.nad83) {\n      projections.push({\n        translateKey: 'nad83',\n        alias: 'NAD83',\n        code: 'EPSG:4269',\n        zone: ''\n      });\n    }\n    if (this.projectionsConstraints.wgs84) {\n      projections.push({\n        translateKey: 'wgs84',\n        alias: 'WGS84',\n        code: 'EPSG:4326',\n        zone: ''\n      });\n    }\n    if (this.projectionsConstraints.webMercator) {\n      projections.push({\n        translateKey: 'webMercator',\n        alias: 'Web Mercator',\n        code: 'EPSG:3857',\n        zone: ''\n      });\n    }\n\n    if (this.projectionsConstraints.mtm) {\n      // all mtm zones\n      const minZone = this.projectionsConstraints.mtmZone.minZone;\n      const maxZone = this.projectionsConstraints.mtmZone.maxZone;\n\n      for (let mtmZone = minZone; mtmZone <= maxZone; mtmZone++) {\n        const code =\n          mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n        projections.push({\n          translateKey: 'mtm',\n          alias: `MTM ${mtmZone}`,\n          code,\n          zone: `${mtmZone}`\n        });\n      }\n    }\n\n    if (this.projectionsConstraints.utm) {\n      // all utm zones\n      const minZone = this.projectionsConstraints.utmZone.minZone;\n      const maxZone = this.projectionsConstraints.utmZone.maxZone;\n\n      for (let utmZone = minZone; utmZone <= maxZone; utmZone++) {\n        const code =\n          utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n        projections.push({\n          translateKey: 'utm',\n          alias: `UTM ${utmZone}`,\n          code,\n          zone: `${utmZone}`\n        });\n      }\n    }\n\n    let configProjection = [];\n    if (this.projectionsConstraints.projFromConfig) {\n      configProjection = this.config.getConfig('projections') || [];\n    }\n\n    this.projections$.next(configProjection.concat(projections));\n  }\n\n  private getWorkspaceByLayerId(id: string): Workspace {\n    const wksFromLayerId = this.store\n      .all()\n      .find(\n        (workspace) =>\n          (workspace as WfsWorkspace | FeatureWorkspace | EditionWorkspace)\n            .layer.id === id\n      );\n    if (wksFromLayerId) {\n      return wksFromLayerId;\n    }\n    return;\n  }\n\n  public getLayerTitleById(id): string {\n    return this.map.getLayerById(id)?.title;\n  }\n\n  layerHasSelectedFeatures(layer: Layer): boolean {\n    const wksFromLayer = this.getWorkspaceByLayerId(layer.id);\n    if (wksFromLayer) {\n      const recs = wksFromLayer.entityStore.stateView.firstBy(\n        (record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        }\n      );\n      return recs ? true : false;\n    }\n  }\n\n  public onlySelected(event: MatSlideToggleChange, id: string) {\n    let layersWithSelection = this.form.value.layersWithSelection;\n    if (event.checked) {\n      layersWithSelection.push(id);\n    } else {\n      layersWithSelection = layersWithSelection.filter(\n        (layerId) => layerId !== id\n      );\n    }\n    this.form.patchValue({ layersWithSelection });\n  }\n\n  public onlySelectedClick(event, id: string) {\n    if (this.form.value.layers.find((layerId) => layerId === id)) {\n      event.stopPropagation();\n    }\n  }\n\n  public inLayersIdToExportSelectionOnly(layer: Layer): boolean {\n    return this.form.value.layersWithSelection.find(\n      (layerId) => layerId === layer.id\n    )\n      ? true\n      : false;\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.exportableLayers$$.unsubscribe();\n    this.formats$$.unsubscribe();\n    this.encodings$$.unsubscribe();\n    this.formLayer$$.unsubscribe();\n    if (this.exportOptions$$) {\n      this.exportOptions$$.unsubscribe();\n    }\n    this.exportOptionsChange.emit(this.form.value);\n    this.handlePreviousLayerSpecs();\n  }\n\n  private handlePreviousLayerSpecs() {\n    const previousSpecs = this.previousLayerSpecs$.value;\n    if (previousSpecs && previousSpecs.length) {\n      previousSpecs.forEach((specs) => {\n        const previousLayer = this.map.getLayerById(specs.id);\n        previousLayer.visible = specs.visible;\n        previousLayer.opacity = specs.opacity;\n        (previousLayer as any).queryable = specs.queryable;\n      });\n    }\n    this.previousLayerSpecs$.next(undefined);\n  }\n\n  importFiles(files: File[]) {\n    let inputProj = this.inputProj.code;\n    if (this.espgCodeRegex.test(inputProj)) {\n      inputProj = `EPSG:${inputProj}`;\n    }\n\n    this.loading$.next(true);\n    for (const file of files) {\n      this.importService.import(file, inputProj).subscribe(\n        (features: Feature[]) => this.onFileImportSuccess(file, features),\n        (error: Error) => this.onFileImportError(file, error),\n        () => {\n          this.loading$.next(false);\n        }\n      );\n    }\n  }\n\n  handlePopup(preCheck: boolean = true): boolean {\n    const p1 = window.open('', 'popup', 'width=1, height=1');\n    p1.close();\n    const p2 = window.open('', 'popup', 'width=1, height=1');\n    if (!p2 || p2.closed || typeof p2.closed === 'undefined' || p2 === null) {\n      this.onPopupBlockedError(preCheck);\n      this.popupAllowed = false;\n    } else {\n      p2.close();\n      this.popupAllowed = true;\n      this.popupChecked = true;\n    }\n    return this.popupAllowed;\n  }\n\n  handleExportFormSubmit(data: ExportOptions) {\n    this.loading$.next(true);\n\n    const ogreFormats = Object.keys(ExportService.ogreFormats);\n    if (\n      !this.popupChecked &&\n      data.layers.length > 1 &&\n      (ogreFormats.indexOf(data.format) >= 0 ||\n        data.format === ExportFormat.URL) &&\n      !this.popupAllowed\n    ) {\n      this.handlePopup();\n    }\n\n    let geomTypesCSV: { geometryType: string; features: any[] }[] = [];\n    let featuresCSV: any[] = [];\n    let filename: string = '';\n\n    for (const [layerIndex, layer] of data.layers.entries()) {\n      const lay = this.map.getLayerById(layer);\n      if (\n        !(\n          data.format === ExportFormat.CSVsemicolon ||\n          data.format === ExportFormat.CSVcomma\n        ) ||\n        !data.combineLayers ||\n        data.layers.length === 1\n      ) {\n        filename = lay.title;\n        if (data.name) {\n          filename = data.name;\n        }\n      } else {\n        filename = this.languageService.translate.instant(\n          'igo.geo.export.combinedLayers'\n        );\n      }\n      const dSOptions: DataSourceOptions = lay.dataSource.options;\n      if (\n        data.format === ExportFormat.URL &&\n        dSOptions.download &&\n        (dSOptions.download.url || dSOptions.download.dynamicUrl)\n      ) {\n        setTimeout(() => {\n          // better look an feel\n          const url = dSOptions.download.url || dSOptions.download.dynamicUrl;\n          url.match(/service=wfs/gi)\n            ? this.downloadService.open(lay)\n            : window.open(url, '_blank');\n          this.loading$.next(false);\n        }, 500);\n        return;\n      }\n      const wks = this.getWorkspaceByLayerId(layer);\n      let olFeatures;\n      if (wks && wks.entityStore && wks.entityStore.stateView.all().length) {\n        if (\n          data.layersWithSelection.indexOf(layer) !== -1 &&\n          data.featureInMapExtent\n        ) {\n          // Only export selected feature && into map extent\n          olFeatures = wks.entityStore.stateView\n            .all()\n            .filter(\n              (e: EntityRecord<object>) =>\n                e.state.inMapExtent && e.state.selected\n            )\n            .map((e) => (e.entity as Feature).ol);\n        } else if (\n          data.layersWithSelection.indexOf(layer) !== -1 &&\n          !data.featureInMapExtent\n        ) {\n          // Only export selected feature &&  (into map extent OR not)\n          olFeatures = wks.entityStore.stateView\n            .all()\n            .filter((e: EntityRecord<object>) => e.state.selected)\n            .map((e) => (e.entity as Feature).ol);\n        } else if (data.featureInMapExtent) {\n          // Only into map extent\n          olFeatures = wks.entityStore.stateView\n            .all()\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent)\n            .map((e) => (e.entity as Feature).ol);\n        } else {\n          // All features\n          olFeatures = wks.entityStore.stateView\n            .all()\n            .map((e) => (e.entity as Feature).ol);\n        }\n      } else {\n        const ol = lay.dataSource.ol as\n          | olVectorSource<OlGeometry>\n          | olClusterSource;\n        if (data.featureInMapExtent) {\n          olFeatures = ol.getFeaturesInExtent(\n            lay.map.viewController.getExtent()\n          );\n        } else {\n          olFeatures = ol.getFeatures();\n        }\n        if (lay.dataSource instanceof ClusterDataSource) {\n          olFeatures = olFeatures.flatMap((cluster: any) =>\n            cluster.get('features')\n          );\n        }\n      }\n\n      let geomTypes: { geometryType: string; features: any[] }[] = [];\n      if (\n        data.format === ExportFormat.Shapefile ||\n        data.format === ExportFormat.GPX\n      ) {\n        olFeatures.forEach((olFeature) => {\n          const featureGeomType = olFeature.getGeometry().getType();\n          const currentGeomType = geomTypes.find(\n            (geomType) => geomType.geometryType === featureGeomType\n          );\n          if (currentGeomType) {\n            currentGeomType.features.push(olFeature);\n          } else {\n            geomTypes.push({\n              geometryType: featureGeomType,\n              features: [olFeature]\n            });\n          }\n        });\n      } else {\n        geomTypes = [{ geometryType: '', features: olFeatures }];\n      }\n\n      geomTypes.forEach((geomType) => {\n        geomType.features.forEach((feature) => {\n          const radius: number = feature.get('rad');\n          if (radius) {\n            const center4326: Array<number> = [\n              feature.get('longitude'),\n              feature.get('latitude')\n            ];\n            const circle = circular(center4326, radius, 500);\n            circle.transform('EPSG:4326', feature.get('_projection'));\n            feature.setGeometry(circle);\n          }\n        });\n      });\n\n      if (data.format === ExportFormat.GPX) {\n        const gpxFeatureCnt = geomTypes.length;\n        geomTypes = geomTypes.filter((geomType) =>\n          ['LineString', 'Point'].includes(geomType.geometryType)\n        );\n        const gpxFeatureCntPointOrPoly = geomTypes.length;\n        if (gpxFeatureCnt > gpxFeatureCntPointOrPoly) {\n          this.messageService.error(\n            'igo.geo.export.gpx.error.poly.text',\n            'igo.geo.export.gpx.error.poly.title',\n            { timeOut: 20000 }\n          );\n        }\n      } else if (\n        (data.format === ExportFormat.CSVsemicolon ||\n          data.format === ExportFormat.CSVcomma) &&\n        data.combineLayers\n      ) {\n        geomTypes.forEach((geomType) => geomTypesCSV.push(geomType));\n\n        if (layerIndex !== data.layers.length - 1) {\n          continue;\n        } else {\n          let previousFeature = undefined;\n          geomTypesCSV.forEach((geomType) => {\n            geomType.features.forEach((currentFeature) => {\n              if (data.separator) {\n                if (previousFeature) {\n                  if (\n                    currentFeature.get('_featureStore').layer.options.title !==\n                    previousFeature.get('_featureStore').layer.options.title\n                  ) {\n                    const titleEmptyRows = this.createTitleEmptyRows(\n                      previousFeature,\n                      currentFeature\n                    );\n                    featuresCSV.push(titleEmptyRows[2]);\n                    featuresCSV.push(titleEmptyRows[0]);\n                    featuresCSV.push(titleEmptyRows[1]);\n                  }\n                } else {\n                  const titleEmptyRows = this.createTitleEmptyRows(\n                    currentFeature,\n                    currentFeature\n                  );\n                  featuresCSV.push(titleEmptyRows[0]);\n                }\n              }\n              featuresCSV.push(currentFeature);\n              previousFeature = currentFeature;\n            });\n          });\n        }\n      }\n\n      if (geomTypes.length === 0) {\n        this.loading$.next(false);\n        this.messageService.error(\n          'igo.geo.export.nothing.text',\n          'igo.geo.export.nothing.title',\n          { timeOut: 20000 }\n        );\n      } else {\n        if (\n          !(\n            data.format === ExportFormat.CSVsemicolon ||\n            data.format === ExportFormat.CSVcomma\n          ) ||\n          !data.combineLayers\n        ) {\n          geomTypes.map((geomType) =>\n            this.exportService\n              .export(\n                geomType.features,\n                data.format,\n                filename + geomType.geometryType,\n                data.encoding,\n                this.map.projection\n              )\n              .subscribe(\n                () => {},\n                (error: Error) => this.onFileExportError(error),\n                () => {\n                  this.onFileExportSuccess();\n\n                  geomType.features.forEach((feature) => {\n                    this.circleToPoint(feature);\n                  });\n\n                  this.loading$.next(false);\n                }\n              )\n          );\n        }\n      }\n    }\n    if (\n      (data.format === ExportFormat.CSVsemicolon ||\n        data.format === ExportFormat.CSVcomma) &&\n      data.combineLayers\n    ) {\n      this.exportService\n        .export(\n          featuresCSV,\n          data.format,\n          filename,\n          data.encoding,\n          this.map.projection\n        )\n        .subscribe(\n          () => {},\n          (error: Error) => this.onFileExportError(error),\n          () => {\n            this.onFileExportSuccess();\n\n            featuresCSV.forEach((feature) => {\n              this.circleToPoint(feature);\n            });\n\n            this.loading$.next(false);\n          }\n        );\n    }\n  }\n\n  private createTitleEmptyRows(previousFeature, currentFeature) {\n    const titleRow = currentFeature.clone();\n    const headerRow = currentFeature.clone();\n    const emptyRow = currentFeature.clone();\n    const previousFeatureKeys: Array<string> = previousFeature.getKeys();\n    let firstKeyPrevious: string = '';\n    for (const key in previousFeatureKeys) {\n      if (previousFeatureKeys[key] !== 'geometry') {\n        firstKeyPrevious = previousFeatureKeys[key];\n        break;\n      }\n    }\n\n    const currentFeatureKeys: Array<string> = currentFeature.getKeys();\n    let firstKeyCurrent: string = '';\n    for (const key in currentFeatureKeys) {\n      if (currentFeatureKeys[key] !== 'geometry') {\n        firstKeyCurrent = currentFeatureKeys[key];\n        break;\n      }\n    }\n    const allKeys: Array<string> = currentFeature.getKeys();\n    previousFeatureKeys.forEach((previousKey) => {\n      if (allKeys.includes(previousKey) && previousKey !== firstKeyPrevious) {\n        allKeys.push(previousKey);\n      }\n    });\n    allKeys.unshift(firstKeyPrevious);\n\n    let firstKeyAll: string = '';\n    for (const key in allKeys) {\n      if (allKeys[key] !== 'geometry') {\n        firstKeyAll = allKeys[key];\n        break;\n      }\n    }\n    allKeys.forEach((key) => {\n      const sameKeys: boolean =\n        previousFeatureKeys.length === currentFeatureKeys.length &&\n        previousFeatureKeys.every(\n          (value, index) => value === currentFeatureKeys[index]\n        );\n      if (key === firstKeyAll && !sameKeys) {\n        titleRow.set(\n          key,\n          currentFeature.get('_featureStore').layer.options.title +\n            ' ===============>',\n          true\n        );\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key === firstKeyAll && sameKeys) {\n        titleRow.set(\n          key,\n          currentFeature.get('_featureStore').layer.options.title,\n          true\n        );\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key === firstKeyCurrent) {\n        titleRow.set(\n          key,\n          currentFeature.get('_featureStore').layer.options.title,\n          true\n        );\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key !== 'geometry') {\n        titleRow.unset(key, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else {\n        titleRow.unset(key, true);\n        emptyRow.unset(key, true);\n      }\n\n      if (!currentFeatureKeys.includes(key)) {\n        headerRow.unset(key, true);\n      }\n    });\n    const titleEmptyRows = [titleRow, headerRow, emptyRow];\n    return titleEmptyRows;\n  }\n\n  private circleToPoint(feature) {\n    const radius: number = feature.get('rad');\n\n    if (radius) {\n      const point = new olPoint([\n        feature.get('longitude'),\n        feature.get('latitude')\n      ]);\n      point.transform('EPSG:4326', feature.get('_projection'));\n      feature.setGeometry(point);\n    }\n  }\n\n  private buildForm() {\n    this.importForm = this.formBuilder.group({\n      inputProj: ['', [Validators.required]]\n    });\n\n    if (this.forceNaming) {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        combineLayers: [true, [Validators.required]],\n        separator: [false, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]],\n        name: ['', [Validators.required]]\n      });\n    } else {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        combineLayers: [true, [Validators.required]],\n        separator: [false, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]]\n      });\n    }\n  }\n\n  private onFileImportSuccess(file: File, features: Feature[]) {\n    const importExportOptions = this.config.getConfig(\n      'importExport'\n    ) as ImportExportServiceOptions;\n    const confirmDialogService = importExportOptions?.allowToStoreLayer\n      ? this.confirmDialogService\n      : undefined;\n    const importWithStyle =\n      importExportOptions?.importWithStyle ||\n      this.config.getConfig('importWithStyle');\n    if (this.config.getConfig('importWithStyle')) {\n      console.warn(`\n      The location of this config importWithStyle is deprecated.\n      Please move this property within importExport configuration.\n      Ex: importWithStyle: true/false must be transfered to importExport: { importWithStyle: true/false }\n      Refer to environnement.ts OR config/config.json\n      This legacy conversion will be deleted in 2024.\n      `);\n    }\n    if (!importWithStyle) {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.contextUri,\n        this.messageService,\n        this.layerService,\n        confirmDialogService\n      );\n    } else {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.contextUri,\n        this.messageService,\n        this.layerService,\n        confirmDialogService,\n        this.styleListService,\n        this.styleService\n      );\n    }\n  }\n\n  private onFileImportError(file: File, error: Error) {\n    this.loading$.next(false);\n    handleFileImportError(file, error, this.messageService, this.fileSizeMb);\n  }\n\n  private onPopupBlockedError(preCheck: boolean = true) {\n    this.loading$.next(false);\n    const extraMessage = preCheck\n      ? 'igo.geo.export.popupBlocked.selectAgain'\n      : 'igo.geo.export.popupBlocked.retry';\n    this.messageService.error(\n      'igo.geo.export.popupBlocked.text',\n      'igo.geo.export.popupBlocked.title',\n      { timeOut: 20000 },\n      { extraMessage }\n    );\n  }\n\n  private onFileExportError(error: Error) {\n    this.loading$.next(false);\n    handleFileExportError(error, this.messageService);\n  }\n\n  private loadConfig() {\n    if (this.config.getConfig('importExport.forceNaming') !== undefined) {\n      this.forceNaming = this.config.getConfig('importExport.forceNaming');\n    }\n    this.computeFormats();\n    this.loadEncodings();\n  }\n\n  public encodingDefaultValue(format: ExportFormat) {\n    if (\n      format === ExportFormat.CSVcomma ||\n      format === ExportFormat.CSVsemicolon\n    ) {\n      this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      return EncodingFormat.LATIN1;\n    } else {\n      this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      return EncodingFormat.UTF8;\n    }\n  }\n\n  private loadEncodings() {\n    this.encodings$.next(EncodingFormat);\n  }\n\n  private computeFormats(layers?: AnyLayer[]) {\n    let appliedformats: string[] = Object.keys(ExportFormat);\n    const formatsType = {\n      onlyUrl: false,\n      onlyVector: false,\n      vectorAndUrl: false,\n      customList: false\n    };\n    const customList = [];\n    if (layers && layers.length) {\n      layers.forEach((layer) => {\n        if (!layer) {\n          return;\n        }\n        if (layer.dataSource.options.download?.allowedFormats) {\n          formatsType.customList = true;\n          customList.push({\n            layer: layer.title,\n            formats: this.validateListFormat(\n              layer.dataSource.options.download.allowedFormats\n            )\n          });\n        } else if (\n          !(layer instanceof VectorLayer) &&\n          layer.dataSource.options.download &&\n          layer.dataSource.options.download.url\n        ) {\n          formatsType.onlyUrl = true;\n        } else if (\n          layer.dataSource.options.download &&\n          (layer.dataSource.options.download.url ||\n            layer.dataSource.options.download.dynamicUrl)\n        ) {\n          formatsType.vectorAndUrl = true;\n        } else if (layer instanceof VectorLayer) {\n          formatsType.onlyVector = true;\n        }\n      });\n\n      if (formatsType.onlyUrl === true && formatsType.onlyVector === false) {\n        appliedformats = ['URL'];\n      } else if (\n        formatsType.onlyVector === true &&\n        formatsType.onlyUrl === false\n      ) {\n        this.computeFormats(); // reset\n        if (ExportFormat.URL in this.formats$.value) {\n          const keys = Object.keys(this.formats$.value).filter(\n            (key) => key !== 'URL'\n          );\n          appliedformats = keys;\n        }\n      } else if (\n        formatsType.vectorAndUrl === true &&\n        formatsType.onlyUrl === false &&\n        formatsType.onlyVector === false\n      ) {\n        this.computeFormats(); // reset\n        if (!(ExportFormat.URL in this.formats$.value)) {\n          const keys = Object.keys(this.formats$.value);\n          keys.push('URL');\n          appliedformats = keys;\n        }\n      }\n    }\n    const configImportExportFormats = this.config.getConfig(\n      'importExport.formats'\n    );\n    if (configImportExportFormats) {\n      const validatedListFormat = this.validateListFormat(\n        configImportExportFormats\n      );\n      appliedformats = appliedformats.filter((af) =>\n        validatedListFormat.includes(af)\n      );\n    }\n    if (formatsType.customList) {\n      let commonFormats;\n      const layersWithCustomFormats = [];\n      let previousCustomListFormats = customList[0].formats;\n      customList.map((list) => {\n        layersWithCustomFormats.push(list.layer);\n        commonFormats = list.formats.filter((value) =>\n          previousCustomListFormats.includes(value)\n        );\n        previousCustomListFormats = list.formats;\n      });\n      const finalFormats = commonFormats.filter((value) =>\n        appliedformats.includes(value)\n      );\n      if (finalFormats.length > 0) {\n        this.formats$.next(strEnum(finalFormats));\n\n        if (layers && layers.length) {\n          if (layers.length > 1) {\n            this.messageService.alert(\n              'igo.geo.export.customList.text',\n              'igo.geo.export.customList.title',\n              undefined,\n              { value: layersWithCustomFormats.join() }\n            );\n          }\n        }\n      } else {\n        this.formats$.next([]);\n        this.messageService.alert(\n          'igo.geo.export.noFormat.text',\n          'igo.geo.export.noFormat.title'\n        );\n      }\n      return;\n    } else {\n      this.formats$.next(strEnum(appliedformats));\n    }\n  }\n\n  private validateListFormat(formats: string[]): string[] {\n    return formats\n      .filter((format) => {\n        if (\n          format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GPX.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.KML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.Shapefile.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.URL.toUpperCase()\n        ) {\n          return format;\n        }\n      })\n      .map((format) => {\n        if (format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase()) {\n          format = ExportFormat.CSVcomma;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase()) {\n          format = ExportFormat.CSVsemicolon;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GML.toUpperCase()) {\n          format = ExportFormat.GML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GPX.toUpperCase()) {\n          format = ExportFormat.GPX;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase()) {\n          format = ExportFormat.GeoJSON;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.KML.toUpperCase()) {\n          format = ExportFormat.KML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.Shapefile.toUpperCase()) {\n          format = ExportFormat.Shapefile;\n          return format;\n        }\n\n        if (format.toUpperCase() === ExportFormat.URL.toUpperCase()) {\n          format = ExportFormat.URL;\n          return format;\n        }\n      });\n  }\n\n  public modeChanged(mode) {\n    this.selectMode.emit(mode);\n  }\n\n  private onFileExportSuccess() {\n    handleFileExportSuccess(this.messageService);\n  }\n\n  onImportExportChange(event) {\n    this.selectedMode = event.value;\n  }\n}\n","import {\n  getEntityProperty,\n  EntityTableColumn,\n  EntityTableColumnRenderer\n} from '@igo2/common';\nimport { MessageService } from '@igo2/core';\nimport { downloadContent } from '@igo2/utils';\n\nimport { ExportNothingToExportError } from './export.errors';\n\nexport function handleFileExportError(\n  error: Error,\n  messageService: MessageService\n) {\n  if (error instanceof ExportNothingToExportError) {\n    handleNothingToExportError(messageService);\n    return;\n  }\n  messageService.error(\n    'igo.geo.export.failed.text',\n    'igo.geo.export.failed.title'\n  );\n}\n\nexport function handleFileExportSuccess(messageService: MessageService) {\n  messageService.success(\n    'igo.geo.export.success.text',\n    'igo.geo.export.success.title'\n  );\n}\n\nexport function handleNothingToExportError(messageService: MessageService) {\n  messageService.error(\n    'igo.geo.export.nothing.text',\n    'igo.geo.export.nothing.title'\n  );\n}\n\n/**\n * Export array to CSV\n *\n * @param rows Array of arrays to export as CSV\n * @param separator Cell separator\n */\nexport function exportToCSV(\n  rows: any[][],\n  fileName: string,\n  separator: string = ';'\n) {\n  const lines = rows.map((row: any[][], index: number) => row.join(separator));\n  const csvContent = lines.join('\\n');\n  downloadContent(csvContent, 'text/csv;charset=utf-8', fileName);\n}\n\n/**\n * Return an array of values from an array of entities.\n *\n * @param entities Array of entities\n * @param scolumns Columns definition of the output data\n */\nexport function entitiesToRowData(\n  entities: object[],\n  columns: EntityTableColumn[]\n) {\n  return entities.map((entity: object) => {\n    return columns.map((column: EntityTableColumn) => {\n      let valueAccessor;\n      if (\n        column.renderer === undefined ||\n        column.renderer === EntityTableColumnRenderer.Default\n      ) {\n        valueAccessor = column.valueAccessor;\n      }\n      valueAccessor = valueAccessor ? valueAccessor : getEntityProperty;\n      return valueAccessor(entity, column.name);\n    });\n  });\n}\n","<button\n  *ngIf=\"layerIsExportable()\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\n  [color]=\"color\"\n>\n  <!-- (click)=\"openDownload(layer)\"> -->\n  <mat-icon svgIcon=\"file-export\"></mat-icon>\n</button>\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { VectorLayer } from '../../layer/shared';\nimport { DataSourceOptions } from '../../datasource';\n\n@Component({\n  selector: 'igo-export-button',\n  templateUrl: './export-button.component.html',\n  styleUrls: ['./export-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ExportButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor() {}\n\n  get options(): DataSourceOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.dataSource.options;\n  }\n\n  layerIsExportable(): boolean {\n    if (\n      (this.layer instanceof VectorLayer && this.layer.exportable === true) ||\n      (this.layer.dataSource.options.download &&\n        this.layer.dataSource.options.download.url) ||\n      (this.layer.options.workspace?.enabled &&\n        this.layer.options.workspace?.workspaceId !== this.layer.id)\n    ) {\n      return true;\n    }\n    return false;\n  }\n}\n","import { Component, Input } from '@angular/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-zoom-button',\n  templateUrl: './zoom-button.component.html',\n  styleUrls: ['./zoom-button.component.scss']\n})\nexport class ZoomButtonComponent {\n  @Input() map: IgoMap;\n\n  @Input() color: string;\n\n  get zoom(): number {\n    return this.map.viewController.getZoom();\n  }\n\n  get minZoom(): number {\n    return this.map.viewController.olView.getMinZoom() || 1;\n  }\n\n  get maxZoom(): number {\n    return this.map.viewController.olView.getMaxZoom();\n  }\n\n  constructor() {}\n}\n","<div class=\"igo-zoom-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomIn' | translate: { zoom: zoom + 1 }\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom >= maxZoom\"\n    (click)=\"map.viewController.zoomIn()\"\n  >\n    <mat-icon svgIcon=\"plus\"></mat-icon>\n  </button>\n\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomOut' | translate: { zoom: zoom - 1 }\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom <= minZoom\"\n    (click)=\"map.viewController.zoomOut()\"\n  >\n    <mat-icon svgIcon=\"minus\"></mat-icon>\n  </button>\n</div>\n","<div class=\"igo-geolocate-button-container\" *ngIf=\"map.geolocationController\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"\n      map.geolocationController.tracking\n        ? ('igo.geo.mapButtons.geolocateInactive' | translate)\n        : ('igo.geo.mapButtons.geolocate' | translate)\n    \"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    (click)=\"onGeolocationClick()\"\n  >\n    <mat-icon svgIcon=\"{{ icon$ | async }}\"></mat-icon>\n  </button>\n</div>\n","import { AfterContentInit, Component, Input, OnDestroy } from '@angular/core';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-geolocate-button',\n  templateUrl: './geolocate-button.component.html',\n  styleUrls: ['./geolocate-button.component.scss']\n})\nexport class GeolocateButtonComponent implements AfterContentInit, OnDestroy {\n  private tracking$$: Subscription;\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject(\n    'crosshairs-gps'\n  );\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  constructor(private configService: ConfigService) {}\n  ngAfterContentInit(): void {\n    this.map.ol.once('rendercomplete', () => {\n      this.tracking$$ = this.map.geolocationController.tracking$.subscribe(\n        (tracking) => {\n          if (tracking) {\n            this.icon$.next('crosshairs-gps');\n          } else {\n            this.configService.getConfig('geolocate.basic')\n              ? this.icon$.next('crosshairs-gps')\n              : this.icon$.next('crosshairs');\n          }\n        }\n      );\n    });\n  }\n\n  ngOnDestroy(): void {\n    if (this.tracking$$) {\n      this.tracking$$.unsubscribe();\n    }\n  }\n\n  onGeolocationClick() {\n    const tracking = this.map.geolocationController.tracking;\n    this.map.geolocationController.tracking = tracking ? false : true;\n  }\n}\n","import { ConfigService } from '@igo2/core';\nimport { Component, Input } from '@angular/core';\nimport { IgoMap } from '../shared/map';\nimport { MapExtent } from '../shared/map.interface';\nimport * as olproj from 'ol/proj';\n/*\nButton to center the map to the home extent\n*/\n@Component({\n  selector: 'igo-home-extent-button',\n  templateUrl: './home-extent-button.component.html',\n  styleUrls: ['./home-extent-button.component.scss']\n})\nexport class HomeExtentButtonComponent {\n  @Input() map: IgoMap;\n  @Input() color: string;\n  @Input() extentOverride?: MapExtent;\n  @Input() centerOverride?: [number, number];\n  @Input() zoomOverride?: number;\n\n  private homeExtentButtonExtent;\n  private homeExtentButtonCenter;\n  private homeExtentButtonZoom;\n\n  constructor(public configService: ConfigService) {\n    this.computeHomeExtent();\n  }\n\n  computeHomeExtent() {\n    this.homeExtentButtonExtent =\n      this.extentOverride ||\n      this.configService.getConfig('homeExtentButton.homeExtButtonExtent');\n    this.homeExtentButtonCenter =\n      this.centerOverride ||\n      this.configService.getConfig('homeExtentButton.homeExtButtonCenter');\n    this.homeExtentButtonZoom =\n      this.zoomOverride ||\n      this.configService.getConfig('homeExtentButton.homeExtButtonZoom');\n\n    // priority over extent if these 2 properties are defined;\n    if (this.centerOverride && this.zoomOverride) {\n      this.homeExtentButtonExtent = undefined;\n    }\n  }\n\n  onToggleClick() {\n    this.computeHomeExtent();\n    if (this.homeExtentButtonExtent) {\n      this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);\n    } else if (this.homeExtentButtonCenter && this.homeExtentButtonZoom) {\n      const center = olproj.fromLonLat(\n        this.homeExtentButtonCenter,\n        this.map.viewController.olView.getProjection().getCode()\n      );\n      this.map.viewController.olView.setCenter(center);\n      this.map.viewController.zoomTo(this.homeExtentButtonZoom);\n    }\n  }\n}\n","<div class=\"igo-home-extent-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.home-extent' | translate\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    (click)=\"onToggleClick()\"\n  >\n    <mat-icon svgIcon=\"home-map-marker\"></mat-icon>\n  </button>\n</div>\n","import { Component, Input } from '@angular/core';\nimport { StorageService } from '@igo2/core';\nimport { BehaviorSubject } from 'rxjs';\nimport NoSleep from 'nosleep.js';\nimport { userAgent } from '@igo2/utils';\n\n@Component({\n  selector: 'igo-wake-lock-button',\n  templateUrl: './wake-lock-button.component.html',\n  styleUrls: ['./wake-lock-button.component.scss']\n})\n\n/**\n * Prevent display sleep and enable wake lock in all Android and iOS web browsers.\n * On iOS, the Wake Lock API is not supported\n * https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API\n * On not supported browser, a fake video is used to keep the screen open.\n *\n * TODO: When the API will be supported by every browser, We should remove the NoSleep.js dependency\n * and replace it by a WakeLock API implementation.\n */\nexport class WakeLockButtonComponent {\n  @Input() color: string = 'primary';\n  @Input()\n  get enabled(): boolean {\n    return this.storageService.get('wakeLockEnabled') as boolean;\n  }\n  set enabled(value: boolean) {\n    this.storageService.set('wakeLockEnabled', value);\n  }\n\n  private noSleep: NoSleep;\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject('sleep');\n  public visible = false;\n\n  constructor(private storageService: StorageService) {\n    this.noSleep = new NoSleep();\n    const nonWakeLockApiBrowser = userAgent.satisfies({\n      ie: '>0',\n      edge: '<84',\n      chrome: '<84',\n      firefox: '>0',\n      opera: '<70',\n      safari: '>0'\n    });\n    if (nonWakeLockApiBrowser) {\n      this.disableWakeLock();\n      this.enabled = false;\n      window.addEventListener('blur', () => {\n        this.disableWakeLock();\n        this.enabled = false;\n      });\n    }\n    this.enabled ? this.enableWakeLock() : this.disableWakeLock();\n  }\n\n  /**\n   * Prevent display sleep and enable wake lock in all Android and iOS web browsers.\n   * On iOS, the Wake Lock API is not supported\n   * https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API\n   * On not supported browser, a fake video is used to keep the screen open.\n   */\n  private enableWakeLock() {\n    this.noSleep.enable();\n    this.enabled = true;\n    this.icon$.next('sleep-off');\n  }\n  /**\n   * Let display sleep\n   */\n  private disableWakeLock() {\n    this.noSleep.disable();\n    this.enabled = false;\n    this.icon$.next('sleep');\n  }\n\n  toggleWakeLock() {\n    if (this.enabled) {\n      this.disableWakeLock();\n    } else {\n      this.enableWakeLock();\n    }\n  }\n}\n","<div class=\"igo-wake-lock-button-container\">\n  <button\n    [color]=\"color\"\n    mat-icon-button\n    [matTooltip]=\"\n      enabled\n        ? ('igo.geo.mapButtons.preventScreenLock' | translate)\n        : ('igo.geo.mapButtons.letScreenLock' | translate)\n    \"\n    matTooltipPosition=\"left\"\n    (click)=\"toggleWakeLock()\"\n  >\n    <mat-icon svgIcon=\"{{ icon$ | async }}\"></mat-icon>\n  </button>\n</div>\n","<div\n  *ngIf=\"((rotated$ | async) && !showIfNoRotation) || showIfNoRotation\"\n  class=\"igo-rotation-button-container\"\n  [matTooltip]=\"\n    (rotated$ | async)\n      ? ('igo.geo.mapButtons.resetRotation'\n        | translate: { azimuth: azimuthRounded, rotation: rotationRounded })\n      : ('igo.geo.mapButtons.tipRotation' | translate)\n  \"\n  matTooltipPosition=\"left\"\n>\n  <button\n    mat-icon-button\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"(rotated$ | async) === false\"\n    (click)=\"map.viewController.resetRotation()\"\n  >\n    <mat-icon [ngStyle]=\"currentStyle$ | async\" svgIcon=\"navigation\">\n    </mat-icon>\n  </button>\n</div>\n","import { AfterContentInit, Component, Input } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { bearingToAzimuth } from '@turf/helpers';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-rotation-button',\n  templateUrl: './rotation-button.component.html',\n  styleUrls: ['./rotation-button.component.scss']\n})\nexport class RotationButtonComponent implements AfterContentInit {\n  readonly rotated$ = new BehaviorSubject<boolean>(false);\n  public azimuthRounded: number = 0;\n  public rotationRounded: number = 0;\n  readonly currentStyle$ = new BehaviorSubject<{}>({\n    transform: 'rotate(0rad)'\n  });\n\n  @Input() map: IgoMap;\n  @Input() showIfNoRotation: boolean;\n  @Input() color: string;\n\n  constructor() {}\n\n  ngAfterContentInit() {\n    this.map.viewController.rotation$.subscribe((r) => {\n      const radians = r || 0;\n      const deg = (radians * 180) / Math.PI;\n      this.rotationRounded = Math.round(deg);\n      this.azimuthRounded = Math.round(bearingToAzimuth(deg * -1));\n      this.currentStyle$.next({\n        transform: 'rotate(' + radians + 'rad)'\n      });\n      this.rotated$.next(radians !== 0);\n    });\n  }\n}\n","export enum OverlayAction {\n  None,\n  Move,\n  Zoom,\n  ZoomIfOutMapExtent\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport { OverlayAction } from './overlay.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class OverlayService {\n  public features$ = new BehaviorSubject<[Feature[], OverlayAction]>([\n    [],\n    undefined\n  ]);\n\n  constructor() {}\n\n  setFeatures(features: Feature[], action: OverlayAction = OverlayAction.None) {\n    this.features$.next([features, action]);\n  }\n\n  clear() {\n    this.features$.next([[], OverlayAction.None]);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport { OverlayService } from '../shared/overlay.service';\nimport { OverlayAction } from '../shared/overlay.enum';\n\n@Directive({\n  selector: '[igoOverlay]'\n})\nexport class OverlayDirective implements OnInit, OnDestroy {\n  private features$$: Subscription;\n  private format = new olFormatGeoJSON();\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private overlayService: OverlayService\n  ) {}\n\n  ngOnInit() {\n    this.features$$ = this.overlayService.features$.subscribe((res) =>\n      this.handleFeatures(res[0], res[1])\n    );\n  }\n\n  ngOnDestroy() {\n    this.features$$.unsubscribe();\n  }\n\n  private handleFeatures(features: Feature[], action: OverlayAction) {}\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2016-2017 Dan \"Ducky\" Little\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport default function jsGeoPdfPlugin(jsPDFAPI) {\n  const setGeoArea = function (pdfExt, geoExt) {\n    const bbox = pdfExt.join(' ');\n    // the ordering may seem odd here but PDF\n    //  flips the Y axis upside down and this accounts for that\n    //  change.\n    const minx = geoExt[0];\n    const maxx = geoExt[2];\n    const maxy = geoExt[1];\n    const miny = geoExt[3];\n    const bounds = [miny, minx, maxy, minx, maxy, maxx, miny, maxx].join(' ');\n    const bbox_obj = this.internal.newAdditionalObject();\n    const bounds_obj = this.internal.newAdditionalObject();\n    const proj_obj = this.internal.newAdditionalObject();\n\n    proj_obj.content =\n      '<< /EPSG 3857 /Type /PROJCS /WKT (PROJCS[\"WGS_1984_Web_Mercator_Auxiliary_Sphere\"' +\n      ',GEOGCS[\"GCS_WGS_1984\",DATUM[\"D_WGS_1984\",SPHEROID[\"WGS_1984\",6378137.0,298.257223563]],PRIMEM[\"Greenwich\",0.0]' +\n      ',UNIT[\"Degree\",0.017453292519943295]],PROJECTION[\"Mercator_Auxiliary_Sphere\"],PARAMETER[\"False_Easting\",0.0]' +\n      ',PARAMETER[\"False_Northing\",0.0],PARAMETER[\"Central_Meridian\",0.0],PARAMETER[\"Standard_Parallel_1\",0.0]' +\n      ',PARAMETER[\"Auxiliary_Sphere_Type\",0.0],UNIT[\"Meter\",1.0]]) >>';\n\n    bounds_obj.content =\n      '<< /Bounds [ 0 1 0 0 1 0 1 1 ] /GCS ' +\n      proj_obj.objId +\n      ' 0 R /GPTS [ ' +\n      bounds +\n      ' ] /LPTS [ 0 1 0 0 1 0 1 1 ] /Subtype /GEO /Type /Measure >>';\n\n    bbox_obj.content =\n      '<< /BBox [ ' +\n      bbox +\n      ' ] /Measure ' +\n      bounds_obj.objId +\n      ' 0 R /Name (Layer) /Type /Viewport >>';\n\n    const title_obj = this.internal.newAdditionalObject();\n    const date = new Date().toLocaleDateString('en-CA');\n    title_obj.content = '<< /Name IGO2 /Type /OCG /Date ' + date + ' >>';\n\n    return bbox_obj.objId;\n  };\n\n  jsPDFAPI.setGeoArea = function (pdfExt, geoExt) {\n    this.internal.events.subscribe('putPage', function () {\n      const bbox_id = setGeoArea.call(this, pdfExt, geoExt);\n      this.internal.write('/VP [ ' + bbox_id + ' 0 R ]');\n    });\n  };\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const PrintOutputFormat = strEnum(['Pdf', 'Image']);\n\nexport type PrintOutputFormat = keyof typeof PrintOutputFormat;\n\nexport const PrintPaperFormat = strEnum([\n  'A0',\n  'A1',\n  'A2',\n  'A3',\n  'A4',\n  'A5',\n  'Letter',\n  'Legal'\n]);\nexport type PrintPaperFormat = keyof typeof PrintPaperFormat;\n\nexport const PrintOrientation = strEnum(['landscape', 'portrait']);\nexport type PrintOrientation = keyof typeof PrintOrientation;\n\nexport const PrintResolution = strEnum(['72', '96', '150', '300']);\nexport type PrintResolution = keyof typeof PrintResolution;\n\nexport const PrintSaveImageFormat = strEnum([\n  'Bmp',\n  'Gif',\n  'Jpeg',\n  'Png',\n  'Tiff'\n]);\nexport type PrintSaveImageFormat = keyof typeof PrintSaveImageFormat;\n\nexport const PrintLegendPosition = strEnum([\n  'none',\n  'topright',\n  'topleft',\n  'bottomleft',\n  'bottomright',\n  'newpage'\n]);\nexport type PrintLegendPosition = keyof typeof PrintLegendPosition;\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { Observable, Subject, forkJoin } from 'rxjs';\nimport { map as rxMap } from 'rxjs/operators';\n\nimport { saveAs } from 'file-saver';\nimport jsPDF from 'jspdf';\nimport html2canvas from 'html2canvas';\nimport { default as JSZip } from 'jszip';\n\nimport { SubjectStatus } from '@igo2/utils';\nimport { SecureImagePipe } from '@igo2/common';\nimport {\n  MessageService,\n  ActivityService,\n  LanguageService,\n  ConfigService\n} from '@igo2/core';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { formatScale } from '../../map/shared/map.utils';\nimport { LegendMapViewOptions } from '../../layer/shared/layers/legend.interface';\nimport { getLayersLegends } from '../../layer/utils/outputLegend';\n\nimport { PrintOptions, TextPdfSizeAndMargin } from './print.interface';\nimport GeoPdfPlugin from './geopdf';\nimport {\n  PrintLegendPosition,\n  PrintPaperFormat,\n  PrintResolution\n} from './print.type';\n\ndeclare global {\n  interface Navigator {\n    msSaveBlob?: (blob: any, defaultName?: string) => boolean;\n  }\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PrintService {\n  zipFile: JSZip;\n  nbFileToProcess: number;\n  activityId: string;\n  imgSizeAdded: Array<number>;\n\n  TEXTPDFFONT = {\n    titleFont: 'Times',\n    titleFontStyle: 'bold',\n    subtitleFont: 'Times',\n    subtitleFontStyle: 'bold',\n    commentFont: 'courier',\n    commentFontStyle: 'normal',\n    commentFontSize: 12\n  };\n\n  constructor(\n    private http: HttpClient,\n    private messageService: MessageService,\n    private activityService: ActivityService,\n    private languageService: LanguageService,\n    private configService: ConfigService\n  ) {}\n\n  print(map: IgoMap, options: PrintOptions): Subject<any> {\n    const status$ = new Subject();\n    const paperFormat: string = options.paperFormat;\n    const resolution = +options.resolution; // Default is 96\n    const orientation = options.orientation;\n    const legendPostion = options.legendPosition;\n    this.activityId = this.activityService.register();\n\n    GeoPdfPlugin(jsPDF.API);\n\n    const doc = new jsPDF({\n      orientation,\n      format: paperFormat.toLowerCase(),\n      unit: 'mm' // default\n    });\n\n    const dimensions = [\n      doc.internal.pageSize.width,\n      doc.internal.pageSize.height\n    ];\n\n    const margins = [10, 10, 10, 10];\n    const width = dimensions[0] - margins[3] - margins[1];\n    const height = dimensions[1] - margins[0] - margins[2];\n    const size: [number, number] = [width, height];\n    let titleSizes: TextPdfSizeAndMargin;\n    let subtitleSizes: TextPdfSizeAndMargin;\n\n    // if paper format A1 or A0 add margin top\n    if (\n      (options.title !== '' || options.subtitle !== '') &&\n      (paperFormat === PrintPaperFormat.A1 ||\n        paperFormat === PrintPaperFormat.A0)\n    ) {\n      margins[0] += 10;\n    }\n    // PDF title\n    const fontSizeInPt = Math.round(2 * (height + 145) * 0.05) / 2; //calculate the fontSize title from the page height.\n    if (options.title !== undefined && options.title !== '') {\n      titleSizes = this.getTextPdfObjectSizeAndMarg(\n        options.title,\n        margins,\n        this.TEXTPDFFONT.titleFont,\n        fontSizeInPt,\n        this.TEXTPDFFONT.titleFontStyle,\n        doc\n      );\n\n      this.addTextInPdfDoc(\n        doc,\n        options.title,\n        this.TEXTPDFFONT.titleFont,\n        this.TEXTPDFFONT.titleFontStyle,\n        titleSizes.fontSize,\n        titleSizes.marginLeft + margins[3],\n        margins[0]\n      );\n\n      margins[0] = titleSizes.height + margins[0]; // cumulative margin top for next elem to place in pdf doc\n    }\n\n    // PDF subtitle\n    if (options.subtitle !== undefined && options.subtitle !== '') {\n      subtitleSizes = this.getTextPdfObjectSizeAndMarg(\n        options.subtitle,\n        margins,\n        this.TEXTPDFFONT.subtitleFont,\n        options.title !== '' ? titleSizes.fontSize * 0.7 : fontSizeInPt * 0.7, // 70% size of title\n        this.TEXTPDFFONT.subtitleFontStyle,\n        doc\n      );\n\n      this.addTextInPdfDoc(\n        doc,\n        options.subtitle,\n        this.TEXTPDFFONT.subtitleFont,\n        this.TEXTPDFFONT.subtitleFontStyle,\n        subtitleSizes.fontSize,\n        subtitleSizes.marginLeft + margins[3],\n        margins[0]\n      );\n\n      margins[0] += 5; // cumulative marg top for next elem to place in pdf doc. 5 is a fix it could be adjust\n    }\n\n    if (options.showProjection === true || options.showScale === true) {\n      this.addProjScale(\n        doc,\n        map,\n        resolution,\n        options.showProjection,\n        options.showScale\n      );\n    }\n    if (options.comment !== undefined && options.comment !== '') {\n      this.addComment(doc, options.comment);\n    }\n\n    this.addMap(doc, map, resolution, size, margins, legendPostion).subscribe(\n      async (status: SubjectStatus) => {\n        if (status === SubjectStatus.Done) {\n          await this.handleMeasureLayer(doc, map, margins);\n\n          const width = this.imgSizeAdded[0];\n          const height = this.imgSizeAdded[1];\n          const res = 1;\n          this.addGeoRef(doc, map, width, height, res, margins);\n\n          if (options.legendPosition !== 'none') {\n            if (\n              ['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(\n                options.legendPosition\n              ) > -1\n            ) {\n              await this.addLegendSamePage(\n                doc,\n                map,\n                margins,\n                resolution,\n                options.legendPosition\n              );\n            } else if (options.legendPosition === 'newpage') {\n              await this.addLegend(doc, map, margins, resolution);\n            }\n          } else {\n            await this.saveDoc(doc);\n          }\n        }\n\n        if (status === SubjectStatus.Done || status === SubjectStatus.Error) {\n          this.activityService.unregister(this.activityId);\n          status$.next(SubjectStatus.Done);\n        }\n      }\n    );\n\n    return status$;\n  }\n  // ref GeoMoose https://github.com/geomoose/gm3/tree/main/src/gm3/components/print\n  addGeoRef(doc, map, width, height, resolution, margins) {\n    const unit = 'mm';\n    const docHeight = doc.internal.pageSize.getHeight();\n\n    // x,y = margin left-bottom corner for img in pdf doc\n    const x = margins[3];\n    const y = docHeight - margins[0] - height;\n\n    let pdf_extents = [x, y, x + width, y + height];\n    for (let i = 0; i < pdf_extents.length; i++) {\n      pdf_extents[i] = this.pdf_units2points(pdf_extents[i], unit);\n    }\n\n    const mapExtent = map.viewController.getExtent('EPSG:3857');\n    doc.setGeoArea(pdf_extents, mapExtent);\n  }\n\n  /**\n   * Add measure overlay on the map on the document when the measure layer is present\n   * @param  doc - Pdf document where measure tooltip will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async handleMeasureLayer(\n    doc: jsPDF,\n    map: IgoMap,\n    margins: Array<number>\n  ) {\n    if (\n      map.layers.find(\n        (layer) => layer.visible && layer.id.startsWith('igo-measures-')\n      )\n    ) {\n      let canvasOverlayHTMLMeasures;\n      const mapOverlayMeasuresHTML = map.ol.getOverlayContainer();\n      await html2canvas(mapOverlayMeasuresHTML, {\n        scale: 1,\n        backgroundColor: null\n      }).then((e) => {\n        canvasOverlayHTMLMeasures = e;\n      });\n      this.addCanvas(doc, canvasOverlayHTMLMeasures, margins); // this adds measure overlays\n    }\n  }\n\n  /**\n   * Get html code for all layers legend\n   * @param  map IgoMap\n   * @param  width The width that the legend need to be\n   * @return Html code for the legend\n   */\n  getLayersLegendHtml(\n    map: IgoMap,\n    width: number,\n    resolution: number\n  ): Observable<string> {\n    return new Observable((observer) => {\n      let html = '';\n      const legends = getLayersLegends(map.layers, {\n        resolution: map.viewController.getResolution(),\n        extent: map.viewController.getExtent(),\n        projection: map.viewController.getOlProjection().getCode(),\n        // scale: map.viewController.getScale(resolution),\n        size: map.ol.getSize()\n      } as LegendMapViewOptions);\n\n      if (legends.filter((l) => l.display === true).length === 0) {\n        observer.next(html);\n        observer.complete();\n        return;\n      }\n      // Define important style to be sure that all container is convert\n      // to image not just visible part\n      html += '<style media=\"screen\" type=\"text/css\">';\n      html +=\n        '.html2canvas-container { width: ' +\n        width +\n        'mm !important; height: 2000px !important; }';\n      html += 'table.tableLegend {table-layout: auto;}';\n      html +=\n        'div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}';\n      html += '</style>';\n      // The font size will also be lowered afterwards (globally along the legend size)\n      // this allows having a good relative font size here and to keep ajusting the legend size\n      // while keeping good relative font size\n      html += '<font size=\"3\" face=\"Times\" >';\n      html += '<div class=\"styleLegend\">';\n      html += '<table class=\"tableLegend\" >';\n\n      // For each legend, define an html table cell\n      const images$ = legends\n        .filter((l) => l.display && l.isInResolutionsRange === true)\n        .map((legend) =>\n          this.getDataImage(legend.url).pipe(\n            rxMap((dataImage) => {\n              let htmlImg =\n                '<tr><td>' + legend.title.toUpperCase() + '</td></tr>';\n              htmlImg += '<tr><td><img src=\"' + dataImage + '\"></td></tr>';\n              return htmlImg;\n            })\n          )\n        );\n      forkJoin(images$).subscribe((dataImages) => {\n        html = dataImages.reduce((acc, current) => (acc += current), html);\n        html += '</table>';\n        html += '</div>';\n        observer.next(html);\n        observer.complete();\n      });\n    });\n  }\n\n  getDataImage(url: string): Observable<string> {\n    const secureIMG = new SecureImagePipe(this.http, this.configService);\n    return secureIMG.transform(url);\n  }\n\n  /**\n   * Get all the legend in a single image\n   * * @param  format - Image format. default value to \"png\"\n   * @return The image of the legend\n   */\n  async getLayersLegendImage(\n    map,\n    format: string = 'png',\n    doZipFile: boolean,\n    resolution: number\n  ) {\n    const status$ = new Subject();\n    // Get html code for the legend\n    const width = 200; // milimeters unit, originally define for document pdf\n    let html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    format = format.toLowerCase();\n\n    // If no legend show No LEGEND in an image\n    if (html.length === 0) {\n      html = '<font size=\"12\" face=\"Courier New\" >';\n      html += '<div align=\"center\"><b>NO LEGEND</b></div>';\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n    div.style.zIndex = '-1';\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n    this.removeHtmlElement(div);\n    if (canvas) {\n      let status = SubjectStatus.Done;\n      try {\n        if (!doZipFile) {\n          // Save the canvas as file\n          this.saveCanvasImageAsFile(canvas, 'legendImage', format);\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(canvas, 'legendImage' + '.' + format);\n        }\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n      status$.next(status);\n    }\n\n    return status$;\n  }\n\n  private removeHtmlElement(element: HTMLElement) {\n    element.parentNode.removeChild(element);\n  }\n\n  getTextPdfObjectSizeAndMarg(\n    text: string,\n    margins,\n    font: string,\n    fontSizeInPt: number,\n    fontStyle: string,\n    doc: jsPDF\n  ): TextPdfSizeAndMargin {\n    const pdfResolution = 96;\n    const docWidth = doc.internal.pageSize.getWidth();\n    const pageWidth = docWidth - margins[1] - margins[3];\n\n    // important to set it first, the textDimension change when font change!\n    doc.setFont(font, fontStyle);\n    doc.setFontSize(fontSizeInPt);\n\n    let textDimensions = doc.getTextDimensions(text);\n    let textMarginLeft: number;\n\n    if (textDimensions.w > pageWidth) {\n      // if the text is to long, reduce fontSize 70% and the overflow with be cut in print...\n      textMarginLeft = 0;\n      fontSizeInPt = fontSizeInPt * 0.7;\n      doc.setFontSize(fontSizeInPt);\n      textDimensions = doc.getTextDimensions(text);\n    } else {\n      textMarginLeft = (pageWidth - textDimensions.w) / 2;\n    }\n\n    return {\n      fontSize: fontSizeInPt,\n      marginLeft: textMarginLeft,\n      height: textDimensions.h\n    };\n  }\n\n  /**\n   * Add comment to the document\n   * * @param  doc - pdf document\n   * * @param  comment - Comment to add in the document\n   */\n  private addComment(doc: jsPDF, comment: string) {\n    const commentMarginLeft = 10; //margin left and bottom is fix\n    const commentMarginBottom = 10;\n    const marginTop = doc.internal.pageSize.height - commentMarginBottom;\n    this.addTextInPdfDoc(\n      doc,\n      comment,\n      this.TEXTPDFFONT.commentFont,\n      this.TEXTPDFFONT.commentFontStyle,\n      this.TEXTPDFFONT.commentFontSize,\n      commentMarginLeft,\n      marginTop,\n      true\n    );\n  }\n\n  private addTextInPdfDoc(\n    doc: jsPDF,\n    textToAdd: string,\n    textFont: string,\n    textFontStyle: string,\n    textFontSize: number,\n    textMarginLeft: number,\n    textMarginTop: number,\n    isComment: boolean = false\n  ) {\n    doc.setFont(textFont, textFontStyle);\n    doc.setFontSize(textFontSize);\n\n    if (isComment) {\n      textToAdd = doc.splitTextToSize(\n        textToAdd,\n        doc.internal.pageSize.getWidth() - textMarginLeft * 3\n      );\n    }\n    doc.text(textToAdd, textMarginLeft, textMarginTop);\n  }\n\n  /**\n   * Add projection and/or scale to the document\n   * @param  doc - pdf document\n   * @param  map - Map of the app\n   * @param  dpi - DPI resolution of the document\n   * @param  projection - Bool to indicate if projection need to be added\n   * @param  scale - Bool to indicate if scale need to be added\n   */\n  private addProjScale(\n    doc: jsPDF,\n    map: IgoMap,\n    dpi: number,\n    projection: boolean,\n    scale: boolean\n  ) {\n    const translate = this.languageService.translate;\n    const projScaleSize = 12;\n    const projScaleMarginLeft = 10;\n    const marginBottom = 15;\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\n\n    let textProjScale: string = '';\n    if (projection === true) {\n      const projText = translate.instant('igo.geo.printForm.projection');\n      textProjScale += projText + ': ' + map.projection;\n    }\n    if (scale === true) {\n      if (projection === true) {\n        textProjScale += '   ';\n      }\n      const scaleText = translate.instant('igo.geo.printForm.scale');\n      const mapScale = map.viewController.getScale(dpi);\n      textProjScale += scaleText + ': ~ 1 / ' + formatScale(mapScale);\n    }\n    doc.setFont('courier');\n    doc.setFontSize(projScaleSize);\n    doc.text(textProjScale, projScaleMarginLeft, heightPixels);\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async addLegend(\n    doc: jsPDF,\n    map: IgoMap,\n    margins: Array<number>,\n    resolution: number\n  ) {\n    // Get html code for the legend\n    const width = doc.internal.pageSize.width;\n    const html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveDoc(doc);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n    div.style.zIndex = '-1';\n\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n    this.removeHtmlElement(div);\n    if (canvas) {\n      const pourcentageReduction = 0.85;\n      const imageSize = [\n        (pourcentageReduction * (25.4 * canvas.width)) / resolution,\n        (pourcentageReduction * (25.4 * canvas.height)) / resolution\n      ];\n      let imgData;\n      doc.addPage();\n      imgData = canvas.toDataURL('image/png');\n      doc.addImage(imgData, 'PNG', 10, 10, imageSize[0], imageSize[1]);\n    }\n\n    await this.saveDoc(doc);\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async addLegendSamePage(\n    doc: jsPDF,\n    map: IgoMap,\n    margins: Array<number>,\n    resolution: number,\n    legendPosition: string\n  ) {\n    // Get html code for the legend\n    const width = doc.internal.pageSize.width;\n    const html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveDoc(doc);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n    div.style.zIndex = '-1';\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n    this.removeHtmlElement(div);\n    let marginsLegend;\n    if (canvas) {\n      const pourcentageReduction = 0.85;\n      const imageSize = [\n        (pourcentageReduction * (25.4 * canvas.width)) / resolution,\n        (pourcentageReduction * (25.4 * canvas.height)) / resolution\n      ];\n      // Move the legend to the correct position on the page\n      if (legendPosition === 'bottomright') {\n        marginsLegend = [\n          doc.internal.pageSize.height - margins[2] - imageSize[1],\n          margins[1],\n          margins[2],\n          doc.internal.pageSize.width - margins[1] - imageSize[0]\n        ];\n      } else if (legendPosition === 'topright') {\n        marginsLegend = [\n          margins[0],\n          margins[1],\n          doc.internal.pageSize.height - margins[0] - imageSize[1],\n          doc.internal.pageSize.width - margins[1] - imageSize[0]\n        ];\n      } else if (legendPosition === 'bottomleft') {\n        // When the legend is in the bottom left, raise the legend slightly upward so that attributions are visible\n        marginsLegend = [\n          doc.internal.pageSize.height - margins[2] - imageSize[1] - 15,\n          doc.internal.pageSize.width - margins[3] - imageSize[0],\n          margins[2] + 15,\n          margins[3]\n        ];\n      } else if (legendPosition === 'topleft') {\n        marginsLegend = [\n          margins[0],\n          doc.internal.pageSize.width - margins[3] - imageSize[0],\n          doc.internal.pageSize.height - margins[0] - imageSize[1],\n          margins[3]\n        ];\n      }\n      this.addCanvas(doc, canvas, marginsLegend); // this adds the legend\n      await this.saveDoc(doc);\n    }\n  }\n\n  defineNbFileToProcess(nbFileToProcess) {\n    this.nbFileToProcess = nbFileToProcess;\n  }\n\n  private timeout(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n\n  private addCanvas(\n    doc: jsPDF,\n    canvas: HTMLCanvasElement,\n    margins: Array<number>\n  ) {\n    let image;\n    if (canvas) {\n      image = canvas.toDataURL('image/png');\n    }\n\n    if (image !== undefined) {\n      if (image.length < 20) {\n        console.log('Warning: An image cannot be print in pdf file');\n        return;\n      }\n      const imageSize = this.getImageSizeToFitPdf(doc, canvas, margins);\n      doc.addImage(\n        image,\n        'PNG',\n        margins[3],\n        margins[0],\n        imageSize[0],\n        imageSize[1]\n      );\n\n      doc.rect(margins[3], margins[0], imageSize[0], imageSize[1]);\n\n      this.imgSizeAdded = imageSize; // keep img size for georef later\n    }\n  }\n\n  // TODO fix printing with image resolution\n  addMap(\n    doc: jsPDF,\n    map: IgoMap,\n    resolution: number,\n    docSize: [number, number],\n    margins: Array<number>,\n    legendPostion: PrintLegendPosition\n  ) {\n    const mapSize = map.ol.getSize() as [number, number];\n    const viewResolution = map.ol.getView().getResolution();\n    const dimensionPixels = this.setMapResolution(\n      map,\n      docSize,\n      resolution,\n      viewResolution\n    );\n    const status$ = new Subject();\n\n    let timeout;\n    map.ol.once('rendercomplete', async (event: any) => {\n      const mapCanvas = event.target\n        .getViewport()\n        .getElementsByTagName('canvas') as HTMLCollectionOf<HTMLCanvasElement>;\n      const mapResultCanvas = await this.drawMap(dimensionPixels, mapCanvas);\n\n      this.resetOriginalMapSize(map, mapSize, viewResolution);\n\n      await this.drawMapControls(map, mapResultCanvas, legendPostion);\n\n      const mapStatus$$ = map.status$.subscribe((mapStatus: SubjectStatus) => {\n        clearTimeout(timeout);\n        if (mapStatus !== SubjectStatus.Done) {\n          return;\n        }\n        mapStatus$$.unsubscribe();\n        let status = SubjectStatus.Done;\n        try {\n          if (mapResultCanvas.width !== 0) {\n            this.addCanvas(doc, mapResultCanvas, margins);\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error(\n            'igo.geo.printForm.corsErrorMessageBody',\n            'igo.geo.printForm.corsErrorMessageHeader'\n          );\n        }\n        status$.next(status);\n      });\n\n      // If no loading as started after 200ms, then probably no loading\n      // is required.\n      timeout = window.setTimeout(() => {\n        mapStatus$$.unsubscribe();\n\n        let status = SubjectStatus.Done;\n        try {\n          if (mapResultCanvas.width !== 0) {\n            this.addCanvas(doc, mapResultCanvas, margins);\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error(\n            'igo.geo.printForm.corsErrorMessageBody',\n            'igo.geo.printForm.corsErrorMessageHeader'\n          );\n        }\n        this.resetOriginalMapSize(map, mapSize, viewResolution);\n        status$.next(status);\n      }, 200);\n    });\n\n    return status$;\n  }\n\n  private setMapResolution(\n    map: IgoMap,\n    initialSize: [number, number],\n    resolution: number,\n    viewResolution: number\n  ): [number, number] {\n    const mapSize = map.ol.getSize();\n    const widthPixels = Math.round((initialSize[0] * resolution) / 25.4);\n    const heightPixels = Math.round((initialSize[1] * resolution) / 25.4);\n\n    // Set print size\n    const printSize = [widthPixels, heightPixels];\n    map.ol.setSize(printSize);\n    const scaling = Math.min(\n      widthPixels / mapSize[0],\n      heightPixels / mapSize[1]\n    );\n    map.ol.getView().setResolution(viewResolution / scaling);\n\n    return [widthPixels, heightPixels];\n  }\n\n  private resetOriginalMapSize(\n    map: IgoMap,\n    initialSize: [number, number],\n    viewResolution: number\n  ) {\n    map.ol.setSize(initialSize);\n    map.ol.getView().setResolution(viewResolution);\n    map.ol.updateSize();\n    map.ol.renderSync();\n  }\n\n  async drawMap(\n    size: Array<number>,\n    mapCanvas: HTMLCollectionOf<HTMLCanvasElement>\n  ): Promise<HTMLCanvasElement> {\n    const mapResultCanvas = document.createElement('canvas');\n    mapResultCanvas.width = size[0];\n    mapResultCanvas.height = size[1];\n\n    for (let index = 0; index < mapCanvas.length; index++) {\n      const canvas = mapCanvas[index];\n      if (canvas.width > 0) {\n        this.handleCanvas(canvas, mapResultCanvas);\n      }\n    }\n    return mapResultCanvas;\n  }\n\n  private handleCanvas(\n    canvas: HTMLCanvasElement,\n    mapResultCanvas: HTMLCanvasElement\n  ) {\n    const mapContextResult = mapResultCanvas.getContext('2d');\n    const opacity = canvas.parentElement.style.opacity || canvas.style.opacity;\n    mapContextResult.globalAlpha = opacity === '' ? 1 : Number(opacity);\n    const transform = canvas.style.transform;\n    let matrix: number[];\n    if (transform) {\n      // Get the transform parameters from the style's transform matrix\n      matrix = transform\n        .match(/^matrix\\(([^\\(]*)\\)$/)[1]\n        .split(',')\n        .map(Number);\n    } else {\n      matrix = [\n        parseFloat(canvas.style.width) / canvas.width,\n        0,\n        0,\n        parseFloat(canvas.style.height) / canvas.height,\n        0,\n        0\n      ];\n    }\n    CanvasRenderingContext2D.prototype.setTransform.apply(\n      mapContextResult,\n      matrix\n    );\n    const backgroundColor = canvas.parentElement.style.backgroundColor;\n    if (backgroundColor) {\n      mapContextResult.fillStyle = backgroundColor;\n      mapContextResult.fillRect(0, 0, canvas.width, canvas.height);\n    }\n    mapContextResult.drawImage(canvas, 0, 0);\n    mapContextResult.globalAlpha = 1;\n    // reset canvas transform to initial\n    mapContextResult.setTransform(1, 0, 0, 1, 0, 0);\n  }\n\n  async drawMapControls(\n    map: IgoMap,\n    canvas: HTMLCanvasElement,\n    position: PrintLegendPosition\n  ): Promise<void> {\n    const context = canvas.getContext('2d');\n    // Get the scale and attribution\n    // we use cloneNode to modify the nodes to print without modifying it on the page, using deep:true to get children\n    const mapOverlayHTML = map.ol\n      .getOverlayContainerStopEvent()\n      .cloneNode(true) as HTMLElement;\n    // add North Direction to mapOverly\n    await this.addNorthDirection(mapOverlayHTML, position);\n    // add map Attribution designe to print\n    await this.addAttribution(mapOverlayHTML);\n\n    // set 'OverlayContainer' size to print size\n    mapOverlayHTML.style.width = canvas.width + 'px';\n    mapOverlayHTML.style.height = canvas.height + 'px';\n    // we add zindex -1 to not show modification to the user\n    mapOverlayHTML.style.zIndex = '-1';\n    // and make sure html2canvas to render the image correctly\n    document\n      .getElementsByClassName('ol-viewport')[0]\n      .appendChild(mapOverlayHTML);\n    // Change the styles of hyperlink in the printed version\n    // Transform the Overlay into a canvas\n    // scale is necessary to make it in google chrome\n    // background as null because otherwise it is white and cover the map\n    // allowtaint is to allow rendering images in the attributions\n    // useCORS: true pour permettre de renderer les images (ne marche pas en local)\n    const canvasOverlayHTML = await html2canvas(mapOverlayHTML, {\n      scale: 1,\n      backgroundColor: null,\n      allowTaint: true,\n      useCORS: true\n    });\n\n    context.drawImage(canvasOverlayHTML, 0, 0);\n    // remove 'mapOverlayHTML' after generating canvas\n    mapOverlayHTML.remove();\n  }\n\n  private async addNorthDirection(\n    mapOverlayHTML: HTMLElement,\n    position: PrintLegendPosition\n  ): Promise<void> {\n    const northDirection = document\n      .getElementsByTagName('igo-rotation-button')[0]\n      .cloneNode(true) as HTMLElement;\n    const HTMLButton = northDirection.getElementsByTagName(\n      'button'\n    )[0] as HTMLElement;\n    if (!HTMLButton) {\n      return null;\n    }\n    // in case legend position is topright\n    // we change rotate btn to topleft\n    if (position === 'topright') {\n      northDirection.style.width = 'inherit';\n      northDirection.style.left = '10px';\n    }\n    HTMLButton.parentElement.style.background = 'transparent';\n    HTMLButton.style.color = '#000';\n    mapOverlayHTML.appendChild(northDirection);\n  }\n\n  private async addAttribution(mapOverlayHTML: HTMLElement): Promise<void> {\n    const HTMLattribution =\n      mapOverlayHTML.getElementsByClassName('ol-attribution')[0];\n    const HTMLButton = HTMLattribution.getElementsByTagName('button')[0];\n    if (!HTMLButton) {\n      return null;\n    }\n    HTMLButton.setAttribute('data-html2canvas-ignore', 'true');\n    const olCollapsed: boolean =\n      HTMLattribution.classList.contains('ol-collapsed');\n    if (olCollapsed) {\n      HTMLattribution.classList.remove('ol-collapsed');\n    }\n  }\n\n  /**\n   * Download an image of the map with addition of informations\n   * @param  map - Map of the app\n   * @param  format - Image format. default value to \"png\"\n   * @param  projection - Indicate if projection need to be add. Default to false\n   * @param  scale - Indicate if scale need to be add. Default to false\n   * @param  legend - Indicate if the legend of layers need to be download. Default to false\n   * @param  title - Title to add for the map - Default to blank\n   * @param  subtitle - Subtitle to add for the map - Default to blank\n   * @param  comment - Comment to add for the map - Default to blank\n   * @param  doZipFile - Indicate if we do a zip with the file\n   * @return Image file of the map with extension format given as parameter\n   */\n  downloadMapImage(\n    map: IgoMap,\n    printResolution: PrintResolution,\n    format = 'png',\n    projection = false,\n    scale = false,\n    title = '',\n    subtitle = '',\n    comment = '',\n    doZipFile = true,\n    legendPosition: PrintLegendPosition\n  ) {\n    const status$ = new Subject();\n    this.activityId = this.activityService.register();\n    const translate = this.languageService.translate;\n    format = format.toLowerCase();\n    const resolution = +printResolution;\n    const initialMapSize = map.ol.getSize() as [number, number];\n    const viewResolution = map.ol.getView().getResolution();\n\n    map.ol.once('rendercomplete', async (event: any) => {\n      const size = map.ol.getSize();\n      const mapCanvas = event.target\n        .getViewport()\n        .getElementsByTagName('canvas') as HTMLCollectionOf<HTMLCanvasElement>;\n      const mapResultCanvas = await this.drawMap(size, mapCanvas);\n\n      this.resetOriginalMapSize(map, initialMapSize, viewResolution);\n\n      await this.drawMapControls(map, mapResultCanvas, legendPosition);\n      // Check the legendPosition\n      if (legendPosition !== 'none') {\n        if (\n          ['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(\n            legendPosition\n          ) > -1\n        ) {\n          await this.addLegendToImage(\n            mapResultCanvas,\n            map,\n            resolution,\n            legendPosition,\n            format\n          );\n        } else if (legendPosition === 'newpage') {\n          await this.getLayersLegendImage(map, format, doZipFile, resolution);\n        }\n      }\n      // add other information to final canvas before exporting\n      const newCanvas = document.createElement('canvas');\n      const newContext = newCanvas.getContext('2d');\n      // Postion in height to set the canvas in new canvas\n      let positionHCanvas = 0;\n      // Get height/width of map canvas\n      const width = mapResultCanvas.width;\n      let height = mapResultCanvas.height;\n      // Set Font to calculate comment width\n      newContext.font = '20px Calibri';\n      const commentWidth = newContext.measureText(comment).width;\n      // Add height for title if defined\n      height = title !== '' ? height + 30 : height;\n      // Add height for title if defined\n      height = subtitle !== '' ? height + 30 : height;\n      // Add height for projection or scale (same line) if defined\n      height = projection !== false || scale !== false ? height + 30 : height;\n      const positionHProjScale = height - 10;\n      // Define number of line depending of the comment length\n      const commentNbLine = Math.ceil(commentWidth / width);\n      // Add height for multiline comment if defined\n      height = comment !== '' ? height + commentNbLine * 30 : height;\n      let positionHComment = height - commentNbLine * 20 + 5;\n      // Set the new canvas with the new calculated size\n      newCanvas.width = width;\n      newCanvas.height = height;\n\n      if (['bmp', 'gif', 'jpeg', 'png', 'tiff'].indexOf(format) > -1) {\n        // Patch Jpeg default black background to white\n        if (\n          format === 'jpeg' ||\n          title !== '' ||\n          subtitle !== '' ||\n          comment !== '' ||\n          projection !== false ||\n          scale !== false\n        ) {\n          newContext.fillStyle = '#ffffff';\n          newContext.fillRect(0, 0, width, height);\n          newContext.fillStyle = '#000000';\n        }\n      }\n      // If a title need to be added to canvas\n      if (title !== '') {\n        // Set font for title\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 30;\n        newContext.textAlign = 'center';\n        newContext.fillText(title, width / 2, 20, width * 0.9);\n      }\n\n      if (subtitle !== '') {\n        // Set font for subtitle\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 60;\n        newContext.textAlign = 'center';\n        newContext.fillText(subtitle, width / 2, 50, width * 0.9);\n      }\n\n      // Set font for next section\n      newContext.font = '20px Calibri';\n      // If projection or/end scale need to be added to canvas\n      if (projection !== false || scale !== false) {\n        let projectionScaleText = '';\n        if (projection !== false) {\n          const projText = translate.instant('igo.geo.printForm.projection');\n          projectionScaleText = projText + ': ' + map.projection + '         ';\n        }\n\n        if (scale !== false) {\n          const scaleText = translate.instant('igo.geo.printForm.scale');\n          const mapScale = map.viewController.getScale(resolution);\n          projectionScaleText += scaleText + ': ~ 1 / ' + formatScale(mapScale);\n        }\n        newContext.textAlign = 'center';\n        newContext.fillText(\n          projectionScaleText,\n          width / 2,\n          positionHProjScale,\n          width * 0.9\n        );\n      }\n\n      // If a comment need to be added to canvas\n      if (comment !== '') {\n        newContext.textAlign = 'center';\n        // If only one line, no need to multiline the comment\n        if (commentNbLine === 1) {\n          newContext.fillText(comment, width / 2, positionHComment);\n        } else {\n          // Separate the setenses to be approx. the same length\n          const nbCommentChar = comment.length;\n          const CommentLengthToCut = Math.floor(nbCommentChar / commentNbLine);\n          let commentCurrentLine = '';\n          let positionFirstCutChar = 0;\n          let positionLastBlank;\n          // Loop for the number of line calculated\n          for (let i = 0; i < commentNbLine; i++) {\n            // For all line except last\n            if (commentNbLine - 1 > i) {\n              // Get comment current line to find the right place tu cut comment\n              commentCurrentLine = comment.substr(\n                positionFirstCutChar,\n                CommentLengthToCut\n              );\n              // Cut the setence at blank\n              positionLastBlank = commentCurrentLine.lastIndexOf(' ');\n              newContext.fillText(\n                commentCurrentLine.substr(0, positionLastBlank),\n                width / 2,\n                positionHComment\n              );\n              positionFirstCutChar += positionLastBlank;\n              // Go to next line for insertion\n              positionHComment += 20;\n            } else {\n              // Don't cut last part\n              newContext.fillText(\n                comment.substr(positionFirstCutChar),\n                width / 2,\n                positionHComment\n              );\n            }\n          }\n        }\n      }\n\n      newContext.drawImage(mapResultCanvas, 0, positionHCanvas);\n\n      let status = SubjectStatus.Done;\n      let fileNameWithExt = 'map.' + format;\n      if (format.toLowerCase() === 'tiff') {\n        fileNameWithExt =\n          'map' + map.projection.replace(':', '_') + '.' + format;\n      }\n\n      try {\n        // Save the canvas as file\n        if (!doZipFile) {\n          this.saveCanvasImageAsFile(newCanvas, fileNameWithExt, format);\n        } else if (format.toLowerCase() === 'tiff') {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(newCanvas, fileNameWithExt);\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(newCanvas, fileNameWithExt);\n        }\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n      status$.next(status);\n\n      if (format.toLowerCase() === 'tiff') {\n        const tfwFileNameWithExt =\n          fileNameWithExt.substring(\n            0,\n            fileNameWithExt.toLowerCase().indexOf('.tiff')\n          ) + '.tfw';\n        const tiwContent = this.getWorldFileInformation(map);\n        const blob = new Blob([tiwContent], {\n          type: 'text/plain;charset=utf-8'\n        });\n        if (!doZipFile) {\n          // saveAs automaticly replace ':' for '_'\n          saveAs(blob, tfwFileNameWithExt);\n          this.saveFileProcessing();\n        } else {\n          // Add the canvas to zip\n          this.addFileToZip(tfwFileNameWithExt, blob);\n        }\n      }\n    });\n\n    this.setMapImageResolution(map, initialMapSize, resolution, viewResolution);\n\n    return status$;\n  }\n\n  private setMapImageResolution(\n    map: IgoMap,\n    initialMapSize: [number, number],\n    resolution: number,\n    viewResolution: number\n  ): void {\n    const scaleFactor = resolution / 96;\n    const newMapSize = [\n      Math.round(initialMapSize[0] * scaleFactor), // width\n      Math.round(initialMapSize[1] * scaleFactor) // height\n    ];\n    map.ol.setSize(newMapSize);\n    const scaling = Math.min(\n      newMapSize[0] / initialMapSize[0],\n      newMapSize[1] / initialMapSize[1]\n    );\n    const view = map.ol.getView();\n    view.setResolution(viewResolution / scaling);\n    map.ol.renderSync();\n  }\n\n  /**\n   * Create and Add Legend to the map canvas\n   * @param  canvas Canvas of the map\n   * @param  map Map of the app\n   * @param  resolution Resolution of map\n   * @param  legendPosition Legend position\n   * @param  format Image format\n   */\n  private async addLegendToImage(\n    canvas: HTMLCanvasElement,\n    map: IgoMap,\n    resolution: number,\n    legendPosition: string,\n    format: string\n  ) {\n    const fileNameWithExt = 'map.' + format;\n    const context = canvas.getContext('2d');\n\n    // Get html code for the legend\n    const html = await this.getLayersLegendHtml(\n      map,\n      canvas.width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveCanvasImageAsFile(canvas, fileNameWithExt, format);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n    div.style.zIndex = '-1';\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n    await this.timeout(1);\n    const canvasLegend = await html2canvas(div, { useCORS: true }).catch(\n      (e) => {\n        console.log(e);\n      }\n    );\n\n    if (canvasLegend) {\n      const canvasHeight = canvas.height;\n      const canvasWidth = canvas.width;\n      const legendHeight = canvasLegend.height;\n      const legendWidth = canvasLegend.width;\n      // Move the legend to the correct position on the page\n      const offset = canvasHeight * 0.01;\n      let legendX: number;\n      let legendY: number;\n\n      if (legendPosition === 'bottomright') {\n        legendX = canvasWidth - legendWidth - offset;\n        legendY = canvasHeight - legendHeight - offset;\n      } else if (legendPosition === 'topright') {\n        legendX = canvasWidth - legendWidth - offset;\n        legendY = offset;\n      } else if (legendPosition === 'bottomleft') {\n        legendX = offset;\n        legendY = canvasHeight - legendHeight - offset - 15;\n      } else if (legendPosition === 'topleft') {\n        legendX = offset;\n        legendY = offset;\n      }\n\n      context.drawImage(\n        canvasLegend,\n        legendX,\n        legendY,\n        legendWidth,\n        legendHeight\n      );\n      context.strokeRect(legendX, legendY, legendWidth, legendHeight);\n      this.removeHtmlElement(div);\n      return true;\n    }\n  }\n\n  private renderMap(map, size, extent) {\n    map.ol.updateSize();\n    map.ol.renderSync();\n  }\n\n  /**\n   * Save document\n   * @param  doc - Document to save\n   */\n  protected async saveDoc(doc: jsPDF) {\n    await doc.save('map_georef.pdf', { returnPromise: true });\n  }\n\n  /**\n   * Calculate the best Image size to fit in pdf\n   * @param doc - Pdf Document\n   * @param canvas - Canvas of image\n   * @param margins - Page margins\n   */\n  getImageSizeToFitPdf(doc, canvas, margins) {\n    // Define variable to calculate best size to fit in one page\n    const pageHeight =\n      doc.internal.pageSize.getHeight() - (margins[0] + margins[2] + 10);\n    const pageWidth =\n      doc.internal.pageSize.getWidth() - (margins[1] + margins[3]);\n    const canHeight = this.pdf_units2points(canvas.height, 'mm');\n    const canWidth = this.pdf_units2points(canvas.width, 'mm');\n\n    const heightRatio = canHeight / pageHeight;\n    const widthRatio = canWidth / pageWidth;\n    const maxRatio = heightRatio > widthRatio ? heightRatio : widthRatio;\n    const imgHeigh = maxRatio > 1 ? canHeight / maxRatio : canHeight;\n    const imgWidth = maxRatio > 1 ? canWidth / maxRatio : canWidth;\n    return [imgWidth, imgHeigh];\n  }\n\n  /**\n   * Get a world file information for tiff\n   * @param  map - Map of the app\n   */\n  private getWorldFileInformation(map) {\n    const currentResolution = map.viewController.getResolution();\n    const currentExtent = map.viewController.getExtent(); // Return [minx, miny, maxx, maxy]\n    return [\n      currentResolution,\n      0,\n      0,\n      -currentResolution,\n      currentExtent[0] + currentResolution / 0.5,\n      currentExtent[3] - currentResolution / 0.5\n    ].join('\\n');\n  }\n\n  /**\n   * Save canvas image as file\n   * @param canvas - Canvas to save\n   * @param name - Name of the file\n   * @param format - file format\n   */\n  private saveCanvasImageAsFile(canvas, nameWithExt, format) {\n    const blobFormat = 'image/' + format;\n    const that = this;\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      canvas.toBlob((blob) => {\n        // download image\n        saveAs(blob, nameWithExt);\n        that.saveFileProcessing();\n      }, blobFormat);\n    } catch (err) {\n      this.messageService.error(\n        'igo.geo.printForm.corsErrorMessageBody',\n        'igo.geo.printForm.corsErrorMessageHeader'\n      );\n    }\n  }\n\n  /**\n   * Add file to a zip\n   * @param canvas - File to add to the zip\n   * @param  name -Name of the fileoverview\n   */\n  private generateCanvaFileToZip(canvas, name) {\n    const blobFormat = 'image/' + 'jpeg';\n    const that = this;\n    if (\n      !this.hasOwnProperty('zipFile') ||\n      typeof this.zipFile === 'undefined'\n    ) {\n      this.zipFile = new JSZip();\n    }\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      if (navigator.msSaveBlob) {\n        this.addFileToZip(name, canvas.msToBlob());\n      } else {\n        canvas.toBlob((blob) => {\n          that.addFileToZip(name, blob);\n        }, blobFormat);\n      }\n    } catch (err) {\n      this.messageService.error(\n        'igo.geo.printForm.corsErrorMessageBody',\n        'igo.geo.printForm.corsErrorMessageHeader'\n      );\n    }\n  }\n\n  /**\n   * Add file to zip, if all file are zipped, download\n   * @param name - Name of the files\n   * @param blob - Contain of file\n   */\n  private addFileToZip(name, blob) {\n    // add file to zip\n    this.zipFile.file(name, blob);\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Download zip file\n      this.getZipFile();\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  private saveFileProcessing() {\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  /**\n   * Get the zipped file\n   * @return Retun a zip file\n   */\n  private getZipFile() {\n    const that = this;\n    this.zipFile.generateAsync({ type: 'blob' }).then((blob) => {\n      // 1) generate the zip file\n      saveAs(blob, 'map.zip');\n      delete that.zipFile;\n    });\n  }\n\n  private pdf_units2points(n, unit): number {\n    let k = 1;\n\n    // this code is borrowed from jsPDF\n    //  as it does not expose a public API\n    //  for converting units to points.\n    switch (unit) {\n      case 'pt':\n        k = 1;\n        break;\n      case 'mm':\n        k = 72 / 25.4;\n        break;\n      case 'cm':\n        k = 72 / 2.54;\n        break;\n      case 'in':\n        k = 72;\n        break;\n      case 'px':\n        k = 96 / 72;\n        break;\n      case 'pc':\n        k = 12;\n        break;\n      case 'em':\n        k = 12;\n        break;\n      case 'ex':\n        k = 6;\n        break;\n      default:\n        throw new Error('Invalid unit: ' + unit);\n    }\n\n    return n * k;\n  }\n}\n","import { Layer } from '../shared/layers/layer';\nimport {\n  LegendMapViewOptions,\n  OutputLayerLegend\n} from '../shared/layers/legend.interface';\n\n/**\n * Get all the layers legend\n * @return Array of legend\n */\nexport function getLayersLegends(\n  layers: Layer[],\n  view?: LegendMapViewOptions\n): OutputLayerLegend[] {\n  const legends = [];\n\n  for (const layer of layers) {\n    const legendOptions = layer.options.legendOptions;\n    if (layer.visible === false) {\n      continue;\n    }\n\n    const legendUrls = layer.dataSource.getLegend(undefined, view) || [];\n    for (const legendUrl of legendUrls) {\n      if (legendUrl.url === undefined) {\n        continue;\n      }\n\n      // Add legend info to the list\n      legends.push({\n        title: layer.title || '',\n        url: legendUrl.url,\n        display:\n          legendOptions?.display === undefined ? true : legendOptions.display,\n        isInResolutionsRange: layer.isInResolutionsRange\n      });\n    }\n  }\n\n  return legends;\n}\n","<form class=\"igo-form\" [formGroup]=\"form\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.title' | translate }}</mat-label>\n      <input\n        matInput\n        formControlName=\"title\"\n        placeholder=\"{{ 'igo.geo.printForm.title' | translate }}\"\n      />\n      <mat-error *ngIf=\"titleField.errors?.maxlength\">{{\n        'igo.geo.formValidation.maxLength'\n          | translate\n            : {\n                column: 'igo.geo.printForm.title' | translate,\n                value: 130\n              }\n      }}</mat-error>\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.subtitle' | translate }}</mat-label>\n      <input\n        matInput\n        formControlName=\"subtitle\"\n        placeholder=\"{{ 'igo.geo.printForm.subtitle' | translate }}\"\n      />\n      <mat-error *ngIf=\"subtitleField.errors?.maxlength\">{{\n        'igo.geo.formValidation.maxLength'\n          | translate\n            : {\n                column: 'igo.geo.printForm.subtitle' | translate,\n                value: 120\n              }\n      }}</mat-error>\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.comment' | translate }}</mat-label>\n      <input\n        matInput\n        formControlName=\"comment\"\n        placeholder=\"{{ 'igo.geo.printForm.comment' | translate }}\"\n      />\n      <mat-error *ngIf=\"commentField.errors?.maxlength\">{{\n        'igo.geo.formValidation.maxLength'\n          | translate\n            : {\n                column: 'igo.geo.printForm.comment' | translate,\n                value: maxLength\n              }\n      }}</mat-error>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container slide-toggle-container\">\n    <div class=\"print-slide-toggle-container\">\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showProjection\"\n        [labelPosition]=\"'before'\"\n      >\n        {{ 'igo.geo.printForm.showProjection' | translate }}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showScale\"\n        [labelPosition]=\"'before'\"\n      >\n        {{ 'igo.geo.printForm.showScale' | translate }}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"doZipFile\"\n        [labelPosition]=\"'before'\"\n        [style.display]=\"isPrintService ? 'none' : ''\"\n      >\n        {{ 'igo.geo.printForm.doZipFile' | translate }}\n      </mat-slide-toggle>\n    </div>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.geo.printForm.legendPosition' | translate\n      }}</mat-label>\n      <mat-select\n        formControlName=\"legendPosition\"\n        placeholder=\"{{ 'igo.geo.printForm.legendPosition' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let legendPosition of legendPositions | keyvalue\"\n          [value]=\"legendPosition.key\"\n        >\n          <ng-container\n            *ngIf=\"!['newpage', 'newimage'].includes(legendPosition.value)\"\n          >\n            {{\n              'igo.geo.printForm.legendPositions.' + legendPosition.value\n                | translate\n            }}\n          </ng-container>\n\n          <ng-container\n            *ngIf=\"['newpage', 'newimage'].includes(legendPosition.value)\"\n          >\n            {{\n              (outputFormat === 'Pdf'\n                ? 'igo.geo.printForm.legendPositions.newpage'\n                : 'igo.geo.printForm.legendPositions.newimage'\n              ) | translate\n            }}\n          </ng-container>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.outputFormat' | translate }}</mat-label>\n      <mat-select\n        (selectionChange)=\"toggleImageSaveProp()\"\n        formControlName=\"outputFormat\"\n        placeholder=\"{{ 'igo.geo.printForm.outputFormat' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let outputFormat of outputFormats | keyvalue\"\n          [value]=\"outputFormat.key\"\n        >\n          {{ outputFormat.value }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    [style.display]=\"isPrintService ? 'block' : 'none'\"\n  >\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.paperFormat' | translate }}</mat-label>\n      <mat-select\n        (selectionChange)=\"changeCommentLength()\"\n        formControlName=\"paperFormat\"\n        placeholder=\"{{ 'igo.geo.printForm.paperFormat' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let paperFormat of paperFormats | keyvalue\"\n          [value]=\"paperFormat.key\"\n        >\n          {{\n            'igo.geo.printForm.paperFormats.' + paperFormat.value | translate\n          }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    [style.display]=\"isPrintService ? 'none' : 'block'\"\n  >\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.imageFormat' | translate }}</mat-label>\n      <mat-select\n        formControlName=\"imageFormat\"\n        placeholder=\"{{ 'igo.geo.printForm.imageFormat' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let imageFormat of imageFormats | keyvalue\"\n          [value]=\"imageFormat.key\"\n        >\n          {{ imageFormat.value }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.resolution' | translate }}</mat-label>\n      <mat-select\n        formControlName=\"resolution\"\n        placeholder=\"{{ 'igo.geo.printForm.resolution' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let resolution of resolutions | keyvalue\"\n          [value]=\"resolution.key\"\n        >\n          {{ resolution.value + ' PPI' }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    class=\"igo-input-container\"\n    [style.display]=\"isPrintService ? 'block' : 'none'\"\n  >\n    <mat-form-field>\n      <mat-label>{{ 'igo.geo.printForm.orientation' | translate }}</mat-label>\n      <mat-select\n        (selectionChange)=\"changeCommentLength()\"\n        formControlName=\"orientation\"\n        placeholder=\"{{ 'igo.geo.printForm.orientation' | translate }}\"\n      >\n        <mat-option\n          *ngFor=\"let orientation of orientations | keyvalue\"\n          [value]=\"orientation.key\"\n        >\n          {{ 'igo.geo.printForm.' + orientation.value | translate }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-form-button-group print-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (disabled$ | async)\"\n      (click)=\"handleFormSubmit(form.value, form.valid)\"\n    >\n      {{ 'igo.geo.printForm.saveBtn' | translate }}\n    </button>\n  </div>\n</form>\n","import { Component, Input, Output, EventEmitter, OnInit } from '@angular/core';\nimport {\n  UntypedFormGroup,\n  UntypedFormBuilder,\n  UntypedFormControl,\n  Validators\n} from '@angular/forms';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { PrintOptions } from '../shared/print.interface';\n\nimport {\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintOrientation,\n  PrintResolution,\n  PrintSaveImageFormat,\n  PrintLegendPosition\n} from '../shared/print.type';\n\n@Component({\n  selector: 'igo-print-form',\n  templateUrl: './print-form.component.html',\n  styleUrls: ['./print-form.component.scss']\n})\nexport class PrintFormComponent implements OnInit {\n  public form: UntypedFormGroup;\n  public outputFormats = PrintOutputFormat;\n  public paperFormats = PrintPaperFormat;\n  public orientations = PrintOrientation;\n  public resolutions = PrintResolution;\n  public imageFormats = PrintSaveImageFormat;\n  public legendPositions = PrintLegendPosition;\n  public isPrintService = true;\n\n  @Input() disabled$: BehaviorSubject<boolean>;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this.imageFormatField.value;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this.imageFormatField.setValue(value || PrintSaveImageFormat.Jpeg, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this.outputFormatField.value;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this.outputFormatField.setValue(value || PrintOutputFormat.Pdf, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this.paperFormatField.value;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this.paperFormatField.setValue(value || PrintPaperFormat.Letter, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this.orientationField.value;\n  }\n  set orientation(value: PrintOrientation) {\n    this.orientationField.setValue(value || PrintOrientation.landscape, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this.resolutionField.value;\n  }\n  set resolution(value: PrintResolution) {\n    this.resolutionField.setValue(value || PrintResolution['96'], {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this.legendPositionField.value;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this.legendPositionField.setValue(value || PrintLegendPosition.none, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get title(): string {\n    return this.titleField.value;\n  }\n  set title(value: string) {\n    this.titleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get subtitle(): string {\n    return this.subtitleField.value;\n  }\n  set subtitle(value: string) {\n    this.subtitleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get comment(): string {\n    return this.commentField.value;\n  }\n  set comment(value: string) {\n    this.commentField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showProjection(): boolean {\n    return this.showProjectionField.value;\n  }\n  set showProjection(value: boolean) {\n    this.showProjectionField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showScale(): boolean {\n    return this.showScaleField.value;\n  }\n  set showScale(value: boolean) {\n    this.showScaleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showLegend(): boolean {\n    return this.showLegendField.value;\n  }\n  set showLegend(value: boolean) {\n    this.showLegendField.setValue(value, { onlySelf: true });\n  }\n\n  @Input()\n  get doZipFile(): boolean {\n    return this.doZipFileField.value;\n  }\n  set doZipFile(value: boolean) {\n    this.doZipFileField.setValue(value, { onlySelf: true });\n  }\n\n  get outputFormatField() {\n    return (this.form.controls as any).outputFormat as UntypedFormControl;\n  }\n\n  get paperFormatField() {\n    return (this.form.controls as any).paperFormat as UntypedFormControl;\n  }\n\n  get imageFormatField() {\n    return (this.form.controls as any).imageFormat as UntypedFormControl;\n  }\n\n  get orientationField() {\n    return (this.form.controls as any).orientation as UntypedFormControl;\n  }\n\n  get resolutionField() {\n    return (this.form.controls as any).resolution as UntypedFormControl;\n  }\n\n  get commentField() {\n    return (this.form.controls as any).comment as UntypedFormControl;\n  }\n\n  get showProjectionField() {\n    return (this.form.controls as any).showProjection as UntypedFormControl;\n  }\n\n  get showScaleField() {\n    return (this.form.controls as any).showScale as UntypedFormControl;\n  }\n\n  get showLegendField() {\n    return (this.form.controls as any).showLegend as UntypedFormControl;\n  }\n\n  get doZipFileField() {\n    return (this.form.controls as any).doZipFile as UntypedFormControl;\n  }\n\n  get titleField() {\n    return (this.form.controls as any).title as UntypedFormControl;\n  }\n\n  get subtitleField() {\n    return (this.form.controls as any).subtitle as UntypedFormControl;\n  }\n\n  get legendPositionField() {\n    return (this.form.controls as any).legendPosition as UntypedFormControl;\n  }\n\n  @Output() submit: EventEmitter<PrintOptions> = new EventEmitter();\n\n  maxLength: number = 180;\n\n  constructor(private formBuilder: UntypedFormBuilder) {\n    this.form = this.formBuilder.group({\n      title: ['', [Validators.minLength(0), Validators.maxLength(130)]],\n      subtitle: ['', [Validators.minLength(0), Validators.maxLength(120)]],\n      comment: [\n        '',\n        [Validators.minLength(0), Validators.maxLength(this.maxLength)]\n      ],\n      outputFormat: ['', [Validators.required]],\n      paperFormat: ['', [Validators.required]],\n      imageFormat: ['', [Validators.required]],\n      resolution: ['', [Validators.required]],\n      orientation: ['', [Validators.required]],\n      legendPosition: ['', [Validators.required]],\n      showProjection: false,\n      showScale: false,\n      showLegend: false,\n      doZipFile: [{ hidden: this.isPrintService }]\n    });\n  }\n\n  ngOnInit() {\n    this.doZipFileField.setValue(false);\n  }\n\n  handleFormSubmit(data: PrintOptions, isValid: boolean) {\n    data.isPrintService = this.isPrintService;\n    if (isValid) {\n      this.submit.emit(data);\n    }\n  }\n\n  toggleImageSaveProp() {\n    if (this.outputFormatField.value === 'Image') {\n      this.isPrintService = false;\n      this.commentField.clearValidators();\n      this.commentField.updateValueAndValidity();\n    } else {\n      this.isPrintService = true;\n    }\n  }\n\n  changeCommentLength() {\n    switch (this.paperFormat) {\n      case PrintPaperFormat.A0:\n        // A0, landscape, length 900 | A0, portrait, comment length:  600\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 900 : 600;\n        break;\n      case PrintPaperFormat.A1:\n        // A1, landscape, length 600 | A1, portrait, length 400;\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 600 : 400;\n        break;\n      case PrintPaperFormat.A2:\n        // A2, landscape, length 400 | A2, portrait, length 300;\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 400 : 300;\n        break;\n      case PrintPaperFormat.A3:\n        // A3, landscape, length 300 | A3, portrait, length 200;\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 300 : 200;\n        break;\n      case PrintPaperFormat.A4:\n        // A4, landscape length 200 | A4, portrait length 120;\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 200 : 100;\n        break;\n      case PrintPaperFormat.A5:\n        // A5, landscape length 120 | A5, portrait length 80;\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 120 : 80;\n        break;\n      case PrintPaperFormat.Letter:\n        // lettre, landscape, 180 | lettre, portrait, 140\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 180 : 140;\n        break;\n      default:\n        // legal, landscape, 200 | legal, portrait, 140\n        this.maxLength =\n          this.orientation === PrintOrientation.landscape ? 200 : 140;\n        break;\n    }\n\n    this.commentField.setValidators([Validators.maxLength(this.maxLength)]);\n    this.commentField.updateValueAndValidity();\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { PrintOptions } from '../shared/print.interface';\n\nimport {\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintOrientation,\n  PrintResolution,\n  PrintSaveImageFormat,\n  PrintLegendPosition\n} from '../shared/print.type';\n\nimport { PrintService } from '../shared/print.service';\n\n@Component({\n  selector: 'igo-print',\n  templateUrl: './print.component.html'\n})\nexport class PrintComponent {\n  public disabled$ = new BehaviorSubject(false);\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this._outputFormat;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this._outputFormat = value;\n  }\n  private _outputFormat: PrintOutputFormat;\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this._paperFormat;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this._paperFormat = value;\n  }\n  private _paperFormat: PrintPaperFormat;\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this._orientation;\n  }\n  set orientation(value: PrintOrientation) {\n    this._orientation = value;\n  }\n  private _orientation: PrintOrientation;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this._imageFormat;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this._imageFormat = value;\n  }\n  private _imageFormat: PrintSaveImageFormat;\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this._legendPosition;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this._legendPosition = value;\n  }\n  private _legendPosition: PrintLegendPosition;\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this._resolution;\n  }\n  set resolution(value: PrintResolution) {\n    this._resolution = value;\n  }\n  private _resolution: PrintResolution;\n\n  constructor(private printService: PrintService) {}\n\n  handleFormSubmit(data: PrintOptions) {\n    this.disabled$.next(true);\n\n    if (data.isPrintService === true) {\n      this.printService\n        .print(this.map, data)\n        .pipe(take(1))\n        .subscribe(() => {\n          this.disabled$.next(false);\n        });\n    } else {\n      let nbFileToProcess = 1;\n\n      if (data.showLegend) {\n        nbFileToProcess++;\n      }\n      if (data.imageFormat.toLowerCase() === 'tiff') {\n        nbFileToProcess++;\n      }\n\n      if (data.legendPosition === 'newpage') {\n        nbFileToProcess++;\n      }\n\n      this.printService.defineNbFileToProcess(nbFileToProcess);\n\n      this.printService\n        .downloadMapImage(\n          this.map,\n          data.resolution,\n          data.imageFormat,\n          data.showProjection,\n          data.showScale,\n          data.title,\n          data.subtitle,\n          data.comment,\n          data.doZipFile,\n          data.legendPosition\n        )\n        .pipe(take(1))\n        .subscribe(() => {\n          this.disabled$.next(false);\n        });\n    }\n  }\n}\n","<igo-print-form\n  [outputFormat]=\"outputFormat\"\n  [paperFormat]=\"paperFormat\"\n  [orientation]=\"orientation\"\n  [imageFormat]=\"imageFormat\"\n  [resolution]=\"resolution\"\n  [legendPosition]=\"legendPosition\"\n  [disabled$]=\"disabled$\"\n  (submit)=\"handleFormSubmit($event)\"\n>\n</igo-print-form>\n","export enum DirectionsFormat {\n  GeoJSON,\n  JSON\n}\nexport enum SourceDirectionsType {\n  Route = 'route',\n  Trip = 'trip'\n}\n\nexport enum ProposalType {\n  Coord = 'coord',\n  Text = 'text'\n}\n\nexport enum DirectionType {\n  Stop = 'stop',\n  Route = 'route',\n  Vertex = 'vertex'\n}\n\nexport enum DirectionRelativePositionType {\n  Start = 'start',\n  Intermediate = 'intermediate',\n  End = 'end'\n}\n","import olFeature from 'ol/Feature';\nimport * as olStyle from 'ol/style';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olGeom from 'ol/geom';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olProj from 'ol/proj';\n\nimport { uuid, NumberUtils } from '@igo2/utils';\n\nimport {\n  Direction,\n  FeatureWithDirection,\n  FeatureWithStop,\n  Stop\n} from './directions.interface';\nimport { createOverlayMarkerStyle } from '../../style/shared/overlay/overlay-marker-style.utils';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\nimport { tryAddLoadingStrategy } from '../../feature/shared/strategies.utils';\nimport { FeatureStoreLoadingStrategy } from '../../feature/shared/strategies/loading';\nimport { FEATURE, FeatureMotion } from '../../feature/shared/feature.enums';\nimport { LanguageService } from '@igo2/core';\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport {\n  DirectionRelativePositionType,\n  DirectionType\n} from './directions.enum';\nimport {\n  RoutesFeatureStore,\n  StepFeatureStore,\n  StopsFeatureStore,\n  StopsStore\n} from './store';\n\n/**\n * Function that updat the sort of the list base on the provided field.\n * @param source stop store\n * @param direction asc / desc sort order\n * @param field the field to use to sort the view\n */\nexport function updateStoreSorting(\n  stopsStore: StopsStore,\n  direction: 'asc' | 'desc' = 'asc',\n  field = 'position'\n) {\n  stopsStore.view.sort({\n    direction,\n    valueAccessor: (entity: Stop) => entity[field]\n  });\n}\n\nexport function computeRelativePosition(\n  index: number,\n  totalLength\n): DirectionRelativePositionType {\n  let relativePosition = DirectionRelativePositionType.Intermediate;\n  if (index === 0) {\n    relativePosition = DirectionRelativePositionType.Start;\n  } else if (index === totalLength - 1) {\n    relativePosition = DirectionRelativePositionType.End;\n  }\n  return relativePosition;\n}\n\nexport function computeStopsPosition(stopsStore: StopsStore) {\n  const stopsToComputePosition = [...stopsStore.all()];\n  stopsToComputePosition.sort((a, b) => a.position - b.position);\n  stopsToComputePosition.map((stop, i) => {\n    stop.position = i;\n    stop.relativePosition = computeRelativePosition(\n      stop.position,\n      stopsToComputePosition.length\n    );\n  });\n  if (stopsToComputePosition) {\n    stopsStore.updateMany(stopsToComputePosition);\n  }\n}\n\n/**\n * Function that add a stop to the stop store. Stop are always added before the last stop.\n * @param stopsStore stop store as an EntityStore\n */\nexport function addStopToStore(stopsStore: StopsStore): Stop {\n  const id = uuid();\n  const stops = stopsStore.all();\n  let positions: number[];\n  if (stopsStore.count === 0) {\n    positions = [0];\n  } else {\n    positions = stops.map((stop) => stop.position);\n  }\n  const maxPosition: number = Math.max(...positions);\n  const insertPosition: number = maxPosition;\n  const lastPosition: number = maxPosition + 1;\n\n  const stopToUpdate = stopsStore\n    .all()\n    .find((stop) => stop.position === maxPosition);\n  if (stopToUpdate) {\n    stopToUpdate.position = lastPosition;\n    stopToUpdate.relativePosition = computeRelativePosition(\n      lastPosition,\n      stopsStore.count + 1\n    );\n  }\n\n  stopsStore.insert({\n    id,\n    position: insertPosition,\n    relativePosition: computeRelativePosition(\n      insertPosition,\n      stopsStore.count + 1\n    )\n  });\n\n  updateStoreSorting(stopsStore);\n  return stopsStore.get(id);\n}\n\nexport function removeStopFromStore(stopsStore: StopsStore, stop: Stop) {\n  stopsStore.delete(stop);\n  computeStopsPosition(stopsStore);\n}\n\n/**\n * Create a style for the directions stops and routes\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function directionsStyle(\n  feature: olFeature<OlGeometry>,\n  resolution: number\n): olStyle.Style | olStyle.Style[] {\n  const vertexStyle = [\n    new olStyle.Style({\n      geometry: feature.getGeometry(),\n      image: new olStyle.Circle({\n        radius: 7,\n        stroke: new olStyle.Stroke({ color: '#FF0000', width: 3 })\n      })\n    })\n  ];\n\n  const stopStyle = createOverlayMarkerStyle({\n    text: feature.get('stopText'),\n    opacity: feature.get('stopOpacity'),\n    markerColor: feature.get('stopColor'),\n    markerOutlineColor: [255, 255, 255]\n  });\n\n  const routeStyle = [\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({\n        color: `rgba(106, 121, 130, ${feature.get('active') ? 0.75 : 0})`,\n        width: 10\n      })\n    }),\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({\n        color: `rgba(79, 169, 221, ${feature.get('active') ? 0.75 : 0})`,\n        width: 6\n      })\n    })\n  ];\n\n  if (feature.get('type') === DirectionType.Stop) {\n    return stopStyle;\n  }\n  if (feature.get('type') === 'vertex') {\n    return vertexStyle;\n  }\n  if (feature.get('type') === DirectionType.Route) {\n    return routeStyle;\n  }\n}\n\nexport function initStopsFeatureStore(\n  stopsFeatureStore: StopsFeatureStore,\n  languageService: LanguageService\n) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stopsLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-stops-layer',\n    title: languageService.translate.instant(\n      'igo.geo.directionsForm.stopLayer'\n    ),\n    zIndex: 911,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-stops-layer',\n      links: [\n        {\n          syncedDelete: true,\n          linkedIds: ['igo-direction-route-layer'],\n          properties: []\n        }\n      ]\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stopsFeatureStore, stopsLayer);\n  stopsFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stopsFeatureStore, loadingStrategy);\n}\n\nexport function initRoutesFeatureStore(\n  routesFeatureStore: RoutesFeatureStore,\n  languageService: LanguageService\n) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const routeLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-route-layer',\n    title: languageService.translate.instant(\n      'igo.geo.directionsForm.routeLayer'\n    ),\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(routesFeatureStore, routeLayer);\n  routesFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(routesFeatureStore, loadingStrategy);\n}\n\nexport function initStepFeatureStore(stepFeatureStore: StepFeatureStore) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stepLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-step-layer',\n    title: '',\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: false,\n    workspace: {\n      enabled: false\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: false,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stepFeatureStore, stepLayer);\n  stepFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stepFeatureStore, loadingStrategy);\n}\n\nexport function addStopToStopsFeatureStore(\n  stop: Stop,\n  stopsStore: StopsStore,\n  stopsFeatureStore: StopsFeatureStore,\n  projection: string,\n  languageService: LanguageService\n) {\n  let stopColor;\n  let stopText;\n\n  switch (stop.relativePosition) {\n    case DirectionRelativePositionType.Start:\n      stopColor = '#008000';\n      stopText = languageService.translate.instant(\n        'igo.geo.directionsForm.start'\n      );\n      break;\n    case DirectionRelativePositionType.End:\n      stopColor = '#f64139';\n      stopText = languageService.translate.instant(\n        'igo.geo.directionsForm.end'\n      );\n      break;\n    default:\n      stopColor = '#ffd700';\n      stopText =\n        languageService.translate.instant(\n          'igo.geo.directionsForm.intermediate'\n        ) +\n        ' #' +\n        stop.position;\n      break;\n  }\n\n  const geometry = new olGeom.Point(\n    olProj.transform(\n      stop.coordinates,\n      projection,\n      stopsFeatureStore.map.projection\n    )\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: stopsFeatureStore.map.projection,\n    dataProjection: stopsFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n  const previousStop = stopsFeatureStore.get(stop.id);\n  const previousStopRevision = previousStop ? previousStop.meta.revision : 0;\n\n  const stopFeatureStore: FeatureWithStop = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: stopsFeatureStore.map.projection,\n    properties: {\n      id: stop.id,\n      type: DirectionType.Stop,\n      stopText,\n      stopColor,\n      stopOpacity: 1,\n      stop\n    },\n    meta: {\n      id: stop.id,\n      revision: previousStopRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  stopsFeatureStore.update(stopFeatureStore);\n}\n\nexport function addDirectionToRoutesFeatureStore(\n  routesFeatureStore: RoutesFeatureStore,\n  direction: Direction,\n  projection: string,\n  active: boolean = false,\n  moveToExtent = false\n) {\n  const geom = direction.geometry.coordinates;\n  const geometry4326 = new olGeom.LineString(geom);\n  const geometry = geometry4326.transform(\n    projection,\n    routesFeatureStore.map.projection\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: routesFeatureStore.map.projection,\n    dataProjection: routesFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n  const previousRoute = routesFeatureStore.get(direction.id);\n  const previousRouteRevision = previousRoute ? previousRoute.meta.revision : 0;\n\n  const routeFeatureStore: FeatureWithDirection = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: routesFeatureStore.map.projection,\n    properties: {\n      id: direction.id,\n      type: DirectionType.Route,\n      active,\n      direction\n    },\n    meta: {\n      id: direction.id,\n      revision: previousRouteRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  routesFeatureStore.update(routeFeatureStore);\n}\n\nexport function formatDistance(distance: number): string {\n  if (distance === 0) {\n    return;\n  }\n  if (distance >= 100000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 1000, 1) + ' km';\n  }\n  if (distance >= 10000) {\n    return (\n      NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km'\n    );\n  }\n  if (distance >= 1000) {\n    return (\n      NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km'\n    );\n  }\n  return NumberUtils.roundToNDecimal(distance, 0) + ' m';\n}\n\nexport function formatDuration(duration: number): string {\n  if (duration >= 3600) {\n    const hour = Math.floor(duration / 3600);\n    const minute = Math.round((duration / 3600 - hour) * 60);\n    if (minute === 60) {\n      return hour + 1 + ' h';\n    }\n    return hour + ' h ' + minute + ' min';\n  }\n\n  if (duration >= 60) {\n    return Math.round(duration / 60) + ' min';\n  }\n  return duration + ' s';\n}\n\nexport function formatInstruction(\n  type,\n  modifier,\n  route,\n  direction,\n  stepPosition,\n  exit,\n  languageService: LanguageService,\n  lastStep = false\n) {\n  const translate = languageService.translate;\n  let directive;\n  let image = 'forward';\n  let cssClass = 'rotate-270';\n  const translatedDirection = translateBearing(direction, languageService);\n  const translatedModifier = translateModifier(modifier, languageService);\n  const prefix =\n    modifier === 'straight'\n      ? ''\n      : translate.instant('igo.geo.directions.modifier.prefix');\n\n  let aggregatedDirection = prefix + translatedModifier;\n\n  if (modifier?.search('slight') >= 0) {\n    aggregatedDirection = translatedModifier;\n  }\n\n  if (modifier === 'uturn') {\n    image = 'forward';\n    cssClass = 'rotate-90';\n  } else if (modifier === 'sharp right') {\n    image = 'subdirectory-arrow-right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'right') {\n    image = 'subdirectory-arrow-right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'slight right') {\n    image = 'forward';\n    cssClass = 'rotate-290';\n  } else if (modifier === 'straight') {\n    image = 'forward';\n  } else if (modifier === 'slight left') {\n    image = 'forward';\n    cssClass = 'rotate-250';\n  } else if (modifier === 'left') {\n    image = 'subdirectory-arrow-left';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'sharp left') {\n    image = 'subdirectory-arrow-left';\n    cssClass = 'icon-flipped';\n  }\n\n  if (type === 'turn') {\n    if (modifier === 'straight') {\n      directive = translate.instant('igo.geo.directions.turn.straight', {\n        route\n      });\n    } else if (modifier === 'uturn') {\n      directive = translate.instant('igo.geo.directions.turn.uturn', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.turn.else', {\n        route,\n        aggregatedDirection,\n        translatedModifier\n      });\n    }\n  } else if (type === 'new name') {\n    directive = translate.instant('igo.geo.directions.new name', {\n      route,\n      translatedDirection\n    });\n    image = 'compass';\n    cssClass = '';\n  } else if (type === 'depart') {\n    directive = translate.instant('igo.geo.directions.depart', {\n      route,\n      translatedDirection\n    });\n    image = 'compass';\n    cssClass = '';\n  } else if (type === 'arrive') {\n    if (lastStep) {\n      const coma = !translatedModifier ? '' : ', ';\n      aggregatedDirection = !translatedModifier ? '' : aggregatedDirection;\n      directive = translate.instant('igo.geo.directions.arrive.lastStep', {\n        coma,\n        aggregatedDirection\n      });\n    } else {\n      directive = translate.instant('igo.geo.directions.arrive.intermediate', {\n        route\n      });\n      image = 'map-marker';\n      cssClass = '';\n    }\n  } else if (type === 'merge') {\n    directive = translate.instant('igo.geo.directions.merge', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'on ramp') {\n    directive = translate.instant('igo.geo.directions.on ramp', {\n      aggregatedDirection\n    });\n  } else if (type === 'off ramp') {\n    directive = translate.instant('igo.geo.directions.off ramp', {\n      aggregatedDirection\n    });\n  } else if (type === 'fork') {\n    if (modifier.search('left') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.left', { route });\n    } else if (modifier.search('right') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.right', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.fork.else', { route });\n    }\n  } else if (type === 'end of road') {\n    directive = translate.instant('igo.geo.directions.end of road', {\n      translatedModifier,\n      route\n    });\n  } else if (type === 'use lane') {\n    directive = translate.instant('igo.geo.directions.use lane');\n  } else if (type === 'continue' && modifier !== 'uturn') {\n    directive = translate.instant('igo.geo.directions.continue.notUturn', {\n      route\n    });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'roundabout') {\n    const cntSuffix =\n      exit === 1\n        ? translate.instant('igo.geo.directions.cntSuffix.first')\n        : translate.instant('igo.geo.directions.cntSuffix.secondAndMore');\n    directive = translate.instant('igo.geo.directions.roundabout', {\n      exit,\n      cntSuffix,\n      route\n    });\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'rotary') {\n    directive = translate.instant('igo.geo.directions.rotary');\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'roundabout turn') {\n    directive = translate.instant('igo.geo.directions.roundabout turn');\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'exit roundabout') {\n    directive = translate.instant('igo.geo.directions.exit roundabout', {\n      route\n    });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'notification') {\n    directive = translate.instant('igo.geo.directions.notification');\n  } else if (modifier === 'uturn') {\n    directive = translate.instant('igo.geo.directions.uturnText', {\n      translatedDirection,\n      route\n    });\n  } else {\n    directive = translate.instant('igo.geo.directions.unknown');\n  }\n\n  image = lastStep ? 'flag-variant' : image;\n  cssClass = lastStep ? '' : cssClass;\n  image = stepPosition === 0 ? 'compass' : image;\n  cssClass = stepPosition === 0 ? '' : cssClass;\n\n  return { instruction: directive, image, cssClass };\n}\n\nexport function translateModifier(modifier, languageService: LanguageService) {\n  const translate = languageService.translate;\n  if (modifier === 'uturn') {\n    return translate.instant('igo.geo.directions.uturn');\n  } else if (modifier === 'sharp right') {\n    return translate.instant('igo.geo.directions.sharp right');\n  } else if (modifier === 'right') {\n    return translate.instant('igo.geo.directions.right');\n  } else if (modifier === 'slight right') {\n    return translate.instant('igo.geo.directions.slight right');\n  } else if (modifier === 'sharp left') {\n    return languageService.translate.instant('igo.geo.directions.sharp left');\n  } else if (modifier === 'left') {\n    return languageService.translate.instant('igo.geo.directions.left');\n  } else if (modifier === 'slight left') {\n    return languageService.translate.instant('igo.geo.directions.slight left');\n  } else if (modifier === 'straight') {\n    return languageService.translate.instant('igo.geo.directions.straight');\n  } else {\n    return modifier;\n  }\n}\n\nexport function translateBearing(\n  bearing: number,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  if (bearing >= 337 || bearing < 23) {\n    return translate.instant('igo.geo.cardinalPoints.n');\n  } else if (bearing < 67) {\n    return translate.instant('igo.geo.cardinalPoints.ne');\n  } else if (bearing < 113) {\n    return translate.instant('igo.geo.cardinalPoints.e');\n  } else if (bearing < 157) {\n    return translate.instant('igo.geo.cardinalPoints.se');\n  } else if (bearing < 203) {\n    return translate.instant('igo.geo.cardinalPoints.s');\n  } else if (bearing < 247) {\n    return translate.instant('igo.geo.cardinalPoints.sw');\n  } else if (bearing < 293) {\n    return translate.instant('igo.geo.cardinalPoints.w');\n  } else if (bearing < 337) {\n    return translate.instant('igo.geo.cardinalPoints.nw');\n  } else {\n    return;\n  }\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { Observable, Subject } from 'rxjs';\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsSource } from '../directions-sources/directions-source';\nimport { DirectionsSourceService } from './directions-source.service';\nimport { SubjectStatus } from '@igo2/utils';\nimport jsPDF from 'jspdf';\nimport 'jspdf-autotable';\nimport { IgoMap } from '../../map';\nimport { PrintLegendPosition, PrintService } from '../../print';\nimport {\n  formatDistance,\n  formatDuration,\n  formatInstruction\n} from './directions.utils';\nimport moment from 'moment';\nimport { ActivityService, ConfigService, LanguageService } from '@igo2/core';\nimport html2canvas from 'html2canvas';\nimport { DOCUMENT } from '@angular/common';\nimport { UserOptions } from 'jspdf-autotable';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DirectionsService {\n  constructor(\n    private directionsSourceService: DirectionsSourceService,\n    private configService: ConfigService,\n    private languageService: LanguageService,\n    private printService: PrintService,\n    @Inject(DOCUMENT) private document: Document,\n    private activityService: ActivityService\n  ) {}\n\n  route(\n    coordinates: [number, number][],\n    directionsOptions: DirectionOptions = {}\n  ): Observable<Direction[]>[] {\n    if (coordinates.length === 0) {\n      return;\n    }\n    return this.directionsSourceService.sources\n      .filter((source: DirectionsSource) => source.enabled)\n      .map((source: DirectionsSource) =>\n        this.routeSource(source, coordinates, directionsOptions)\n      );\n  }\n\n  routeSource(\n    source: DirectionsSource,\n    coordinates: [number, number][],\n    directionsOptions: DirectionOptions = {}\n  ): Observable<Direction[]> {\n    const request = source.route(coordinates, directionsOptions);\n    return request;\n  }\n\n  downloadDirection(\n    map: IgoMap,\n    direction: Direction\n  ): Observable<SubjectStatus> {\n    const activityId = this.activityService.register();\n    const status$ = new Subject<SubjectStatus>();\n\n    const doc: jsPDF = new jsPDF({\n      orientation: 'p',\n      format: 'Letter',\n      unit: 'mm' // default\n    });\n    const dimensions = [\n      doc.internal.pageSize.width,\n      doc.internal.pageSize.height\n    ];\n    const margins = [10, 10, 10, 10];\n    const width = dimensions[0];\n    const height = dimensions[1] - margins[0] - margins[2];\n    const size: [number, number] = [width, height];\n\n    const title = `${direction.title} (${formatDistance(\n      direction.distance\n    )}, ${formatDuration(direction.duration)})`;\n    const titlePosition = 25;\n\n    doc.text(title, doc.internal.pageSize.width / 2, titlePosition, {\n      align: 'center'\n    });\n\n    margins[0] += 20;\n    const resolution = 96; // Default is 96\n    this.printService\n      .addMap(doc, map, resolution, size, margins, PrintLegendPosition.none)\n      .subscribe(async (status: SubjectStatus) => {\n        if (status === SubjectStatus.Done) {\n          await this.addInstructions(doc, direction, title);\n          this.setPageHeaderFooter(doc);\n          await doc.save(`${title}.pdf`, { returnPromise: true });\n        }\n\n        this.activityService.unregister(activityId);\n        status$.next(status);\n      });\n\n    return status$;\n  }\n\n  private async setHTMLTableContent(\n    direction: Direction\n  ): Promise<HTMLTableElement> {\n    const data = await this.directionsInstruction(direction);\n    const table = document.createElement('table');\n    const tblBody = document.createElement('tbody');\n    for (let index = 0; index < data.length; index++) {\n      const element = data[index];\n      var row = document.createElement('tr');\n      var cellImage = document.createElement('td');\n      var cellText = document.createElement('td');\n      // icon\n      const img = document.createElement('img') as HTMLImageElement;\n      img.src = element.icon;\n      // instruction text\n      const span = document.createElement('span') as HTMLElement;\n      span.innerHTML = element.instruction;\n      cellImage.appendChild(img);\n      cellText.appendChild(span);\n      if (element.distance) {\n        const spanDistance = document.createElement('span') as HTMLElement;\n        spanDistance.style.verticalAlign = 'middle';\n        spanDistance.innerHTML =\n          '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + element.distance;\n        cellText.appendChild(spanDistance);\n      }\n      row.append(cellImage);\n      row.append(cellText);\n      tblBody.appendChild(row);\n    }\n    table.appendChild(tblBody);\n    return table;\n  }\n\n  private async directionsInstruction(\n    direction: Direction\n  ): Promise<Array<{ instruction: string; icon: string; distance: string }>> {\n    const matListItems = this.document\n      .getElementsByTagName('igo-directions-results')[0]\n      .getElementsByTagName('mat-list')[0];\n    const matListItem = matListItems.getElementsByTagName('mat-list-item');\n    // convert icon list to base64\n    let iconsArray: Array<{ name: string; icon: string }> = [];\n    for (let index = 0; index < matListItem.length; index++) {\n      const element = matListItem[index];\n      const icon = element.getElementsByTagName('mat-icon')[0] as HTMLElement;\n      const iconName = icon.getAttribute('data-mat-icon-name') as string;\n      const found = iconsArray.some((el) => el.name === iconName);\n      if (!found) {\n        const iconCanvas = await html2canvas(icon, { scale: 3 });\n        iconsArray.push({ name: iconName, icon: iconCanvas.toDataURL() });\n      }\n    }\n\n    let formattedDirection: Array<{\n      instruction: string;\n      icon: string;\n      distance: string;\n    }> = [];\n    for (let i = 0; i < direction.steps.length; i++) {\n      const step = direction.steps[i];\n      const instruction = formatInstruction(\n        step.maneuver.type,\n        step.maneuver.modifier,\n        step.name,\n        step.maneuver.bearing_after,\n        i,\n        (step.maneuver as any).exit,\n        this.languageService,\n        i === direction.steps.length - 1\n      );\n\n      const distance = formatDistance(step.distance);\n      formattedDirection.push({\n        instruction: i + 1 + '. ' + instruction.instruction,\n        icon: iconsArray.find((icon) => icon.name === instruction.image).icon,\n        distance: distance ? '(' + distance + ')' : undefined\n      });\n    }\n    return formattedDirection;\n  }\n\n  private async addInstructions(\n    doc: jsPDF,\n    direction: Direction,\n    title: string\n  ) {\n    doc.addPage();\n    const titlePosition = 25;\n    doc.text(title, doc.internal.pageSize.width / 2, titlePosition, {\n      align: 'center'\n    });\n    const HTMLtable = await this.setHTMLTableContent(direction);\n    const tablePos = titlePosition + 5;\n    (doc as any).autoTable({\n      html: HTMLtable,\n      startY: tablePos,\n      margin: { top: 20, bottom: 20 },\n      columnStyles: {\n        0: { cellWidth: 10 }\n      },\n      theme: 'plain',\n      styles: {\n        fontSize: 12\n      },\n      didDrawCell: function (data) {\n        if (data.column.index === 0 && data.cell.section === 'body') {\n          data.row.height = 10;\n          const td = data.cell.raw as HTMLElement;\n          const img = td.getElementsByTagName('img')[0];\n          doc.addImage(img.src, data.cell.x, data.cell.y, 8, 8);\n        }\n      }\n    } satisfies UserOptions);\n  }\n\n  private setPageHeaderFooter(doc: jsPDF) {\n    const pageCount = doc.getNumberOfPages();\n    const date = moment(Date.now()).format('DD/MM/YYYY hh:mm').toString();\n\n    const logo = this.configService.getConfig('directionsSources.logo')\n      ? this.configService.getConfig('directionsSources.logo')\n      : 'assets/logo.png';\n\n    for (let index = 0; index < pageCount; index++) {\n      doc.setPage(index);\n      doc.setFontSize(8);\n      const pageSize = doc.internal.pageSize;\n      const pageHeight = pageSize.height\n        ? pageSize.height\n        : pageSize.getHeight();\n      const width = pageSize.width ? pageSize.width : pageSize.getWidth();\n      doc.text(date, 10, 10, { baseline: 'top' });\n      doc.addImage(logo, 'PNG', width - 20, 5, 10, 10);\n      doc.text(date, 10, pageHeight - 10);\n      doc.text(\n        'Page ' + doc.getCurrentPageInfo().pageNumber + ' / ' + pageCount,\n        width - 20,\n        pageHeight - 10\n      );\n    }\n  }\n}\n","import { EntityStore } from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\nimport { FeatureStore } from '../../feature/shared/store';\nimport {\n  FeatureWithDirection,\n  FeatureWithStep,\n  FeatureWithStop,\n  Stop\n} from './directions.interface';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * stops.\n */\nexport class StopsStore extends EntityStore<Stop> {\n  public storeInitialized$: BehaviorSubject<boolean> = new BehaviorSubject(\n    false\n  );\n\n  public clearStops() {\n    this.storeInitialized$.next(false);\n    this.clear();\n  }\n}\n\nexport class StopsFeatureStore extends FeatureStore<FeatureWithStop> {}\nexport class RoutesFeatureStore extends FeatureStore<FeatureWithDirection> {}\nexport class StepFeatureStore extends FeatureStore<FeatureWithStep> {}\n","<div cdkDropList class=\"stops-list\" (cdkDropListDropped)=\"drop($event)\">\n  <div\n    touchleave\n    (touchenter)=\"onStopEnter(stop)\"\n    (touchleave)=\"onStopLeave()\"\n    (mouseover)=\"onStopEnter(stop)\"\n    (mouseleave)=\"onStopLeave()\"\n    (cdkDragStarted)=\"stopIsDragged = true\"\n    (cdkDragEnded)=\"stopIsDragged = false\"\n    cdkDragLockAxis=\"y\"\n    class=\"stop-box\"\n    *ngFor=\"let stop of stopsStore.view.all$() | async; let i = index\"\n    cdkDrag\n  >\n    <div [ngClass]=\"getNgClass(stop)\">\n      <mat-form-field subscriptSizing=\"dynamic\">\n        <mat-label>{{ getPlaceholder(stop) }}</mat-label>\n        <input\n          id=\"{{ stop.id }}\"\n          type=\"text\"\n          [placeholder]=\"getPlaceholder(stop)\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"stop.text\"\n          aria-label=\"Number\"\n          matInput\n          (focus)=\"onInputFocus(stop)\"\n          [(ngModel)]=\"stop.text\"\n          (keyup)=\"setStopText($event, stop)\"\n          (keydown.enter)=\"$event.preventDefault()\"\n          [matAutocomplete]=\"auto\"\n        />\n        <button\n          *ngIf=\"\n            (stop.text || stop.coordinates) &&\n            stopWithHover &&\n            stop.id === stopWithHover.id\n          \"\n          mat-icon-button\n          matSuffix\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"'igo.geo.directionsForm.clearStop' | translate\"\n          color=\"warn\"\n          aria-label=\"Clear\"\n          (click)=\"clearStop(stop)\"\n        >\n          <mat-icon svgIcon=\"close\"></mat-icon>\n        </button>\n\n        <mat-autocomplete\n          [displayWith]=\"getOptionText\"\n          #auto=\"matAutocomplete\"\n          (optionSelected)=\"chooseProposal($event, stop)\"\n        >\n          <mat-optgroup\n            *ngFor=\"let source of stop.searchProposals\"\n            [label]=\"source.source.title\"\n            [disabled]=\"source.source.enabled === false\"\n          >\n            <mat-option\n              *ngFor=\"let result of source.results\"\n              [value]=\"result\"\n              matTooltipShowDelay=\"500\"\n              [matTooltip]=\"result.meta ? result.meta.title : ''\"\n            >\n              {{ result.meta ? result.meta.title : '' }}\n            </mat-option>\n          </mat-optgroup>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n\n    <div\n      *ngIf=\"!stopIsDragged && stopWithHover && stop.id === stopWithHover.id\"\n      class=\"igo-form-button-group\"\n    >\n      <button\n        class=\"swipe-vertical\"\n        cdkDragHandle\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.moveStop' | translate\"\n        color=\"primary\"\n      >\n        <mat-icon svgIcon=\"gesture-swipe-vertical\"></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"(stopsStore.count$ | async) > 2\"\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\"\n        color=\"warn\"\n        (click)=\"removeStop(stop)\"\n      >\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n    </div>\n  </div>\n</div>\n","import {\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  Output\n} from '@angular/core';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\n\nimport * as olProj from 'ol/proj';\nimport * as olObservable from 'ol/Observable';\n\nimport { Stop } from '../shared/directions.interface';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport pointOnFeature from '@turf/point-on-feature';\nimport {\n  computeRelativePosition,\n  removeStopFromStore,\n  updateStoreSorting\n} from '../shared/directions.utils';\nimport { MatAutocomplete } from '@angular/material/autocomplete';\nimport { MatOption } from '@angular/material/core';\nimport { StopsFeatureStore, StopsStore } from '../shared/store';\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { LanguageService } from '@igo2/core';\nimport { DirectionRelativePositionType } from '../shared/directions.enum';\n\n@Component({\n  selector: 'igo-directions-inputs',\n  templateUrl: './directions-inputs.component.html',\n  styleUrls: ['./directions-inputs.component.scss']\n})\nexport class DirectionsInputsComponent implements OnDestroy {\n  private readonly invalidKeys = ['Control', 'Shift', 'Alt'];\n  private onMapClickEventKeys = [];\n  public stopWithHover: Stop;\n  public stopIsDragged: boolean = false;\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() projection: string;\n  @Input() coordRoundedDecimals: number = 6;\n\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n\n  @Output() stopInputHasFocus: EventEmitter<boolean> =\n    new EventEmitter<boolean>(false);\n  constructor(private languageService: LanguageService) {}\n\n  ngOnDestroy(): void {\n    this.unlistenMapSingleClick();\n  }\n  onStopEnter(stop: Stop) {\n    this.stopWithHover = stop;\n  }\n  onStopLeave() {\n    this.stopWithHover = undefined;\n  }\n\n  getOptionText(option) {\n    if (option instanceof Object) {\n      return option?.meta ? option.meta.title : '';\n    }\n    return option;\n  }\n\n  chooseProposal(\n    event: { source: MatAutocomplete; option: MatOption },\n    stop: Stop\n  ) {\n    const result: Feature = event.option.value;\n    if (result) {\n      let geomCoord;\n      const geom = result.geometry;\n      if (geom.type === 'Point') {\n        geomCoord = geom.coordinates;\n      } else {\n        const point = pointOnFeature(result.geometry);\n        geomCoord = [\n          point.geometry.coordinates[0],\n          point.geometry.coordinates[1]\n        ];\n      }\n      if (geomCoord) {\n        stop.coordinates = geomCoord;\n        stop.text = result.meta.title;\n        this.stopsStore.update(stop);\n      }\n    }\n  }\n\n  setStopText(event: KeyboardEvent, stop: Stop) {\n    this.unlistenMapSingleClick();\n    const term = (event.target as HTMLInputElement).value;\n    if (term.length === 0) {\n      this.clearStop(stop);\n    } else if (this.validateTerm(term)) {\n      stop.text = term;\n      this.stopsStore.update(stop);\n    }\n  }\n\n  validateTerm(term: string) {\n    if (\n      this.keyIsValid(term) &&\n      (term.length >= this.length || term.length === 0)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  private keyIsValid(key: string) {\n    return this.invalidKeys.find((value) => value === key) === undefined;\n  }\n\n  getNgClass(stop: Stop): string {\n    if (!this.stopWithHover) {\n      return 'igo-input-container';\n    } else if (stop.id === this.stopWithHover.id) {\n      return 'igo-input-container reduce';\n    } else {\n      return 'igo-input-container';\n    }\n  }\n\n  getPlaceholder(stop: Stop): string {\n    let extra = '';\n    if (stop.relativePosition) {\n      if (\n        stop.relativePosition === DirectionRelativePositionType.Intermediate\n      ) {\n        extra = ' #' + stop.position;\n      }\n      return (\n        this.languageService.translate.instant(\n          'igo.geo.directionsForm.' + stop.relativePosition\n        ) + extra\n      );\n    } else {\n      return '';\n    }\n  }\n\n  removeStop(stop: Stop) {\n    removeStopFromStore(this.stopsStore, stop);\n  }\n\n  clearStop(stop: Stop) {\n    this.stopsStore.update({\n      id: stop.id,\n      relativePosition: stop.relativePosition,\n      position: stop.position\n    });\n  }\n\n  drop(event: CdkDragDrop<string[]>) {\n    this.moveStops(event.previousIndex, event.currentIndex);\n  }\n\n  private moveStops(fromIndex, toIndex) {\n    if (fromIndex !== toIndex) {\n      const stops = [...this.stopsStore.view.all()];\n      moveItemInArray(stops, fromIndex, toIndex);\n      stops.map((stop, i) => {\n        stop.relativePosition = computeRelativePosition(i, stops.length);\n        stop.position = i;\n      });\n      this.stopsStore.updateMany(stops);\n      updateStoreSorting(this.stopsStore);\n    }\n  }\n\n  onInputFocus(stop: Stop) {\n    if (!stop.text || stop.text?.length === 0) {\n      this.unlistenMapSingleClick();\n      this.stopInputHasFocus.emit(true);\n      this.listenMapSingleClick(stop);\n    }\n  }\n\n  private listenMapSingleClick(stop: Stop) {\n    const key = this.stopsFeatureStore.layer.map.ol.once(\n      'singleclick',\n      (event) => {\n        const clickCoordinates = olProj.transform(\n          event.coordinate,\n          this.stopsFeatureStore.layer.map.projection,\n          this.projection\n        );\n        const roundedCoord = roundCoordTo(\n          clickCoordinates as [number, number],\n          this.coordRoundedDecimals\n        );\n        stop.text = roundedCoord.join(',');\n        stop.coordinates = roundedCoord;\n        this.stopsStore.update(stop);\n        setTimeout(() => {\n          this.stopInputHasFocus.emit(false);\n        }, 500);\n      }\n    );\n    this.onMapClickEventKeys.push(key);\n  }\n\n  private unlistenMapSingleClick() {\n    this.onMapClickEventKeys.map((key) => {\n      olObservable.unByKey(key);\n    });\n    this.onMapClickEventKeys = [];\n  }\n}\n","<div class=\"igo-form-button-group\">\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.directionsForm.addStop' | translate\"\n    color=\"primary\"\n    (click)=\"addStop()\"\n  >\n    <mat-icon svgIcon=\"map-marker-plus\"></mat-icon>\n  </button>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"\n      (routesFeatureStore.count$ | async) >= 1 ||\n      (stopsStore.count$ | async) >= 1\n    \"\n    [matTooltip]=\"'igo.geo.directionsForm.resetDirectionsBtn' | translate\"\n    color=\"warn\"\n    (click)=\"resetStops()\"\n  >\n    <mat-icon svgIcon=\"file-restore\"></mat-icon>\n  </button>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\n    (click)=\"zoomRoute()\"\n    [matTooltip]=\"'igo.geo.directionsForm.zoomRoute' | translate\"\n    color=\"primary\"\n  >\n    <mat-icon svgIcon=\"magnify-plus-outline\"></mat-icon>\n  </button>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\n    (click)=\"copyDirectionsToClipboard()\"\n    [matTooltip]=\"'igo.geo.directionsForm.copy' | translate\"\n    color=\"primary\"\n  >\n    <mat-icon svgIcon=\"content-copy\"></mat-icon>\n  </button>\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\n    (click)=\"copyLinkToClipboard()\"\n    [matTooltip]=\"'igo.geo.directionsForm.link' | translate\"\n    color=\"primary\"\n  >\n    <mat-icon svgIcon=\"link\"></mat-icon>\n  </button>\n\n  <button\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async) >= 1\"\n    (click)=\"printDirections()\"\n    [disabled]=\"disabled$ | async\"\n    [matTooltip]=\"'igo.geo.directionsForm.print' | translate\"\n    color=\"primary\"\n  >\n    <mat-icon svgIcon=\"printer\"></mat-icon>\n  </button>\n</div>\n","import { Component, Input, Optional } from '@angular/core';\nimport { LanguageService, MessageService, RouteService } from '@igo2/core';\nimport { Clipboard } from '@igo2/utils';\nimport { Subject, BehaviorSubject } from 'rxjs';\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { FeatureWithDirection } from '../shared/directions.interface';\n\nimport {\n  addStopToStore,\n  formatDistance,\n  formatDuration,\n  formatInstruction\n} from '../shared/directions.utils';\nimport {\n  RoutesFeatureStore,\n  StepFeatureStore,\n  StopsStore\n} from '../shared/store';\nimport { DirectionsService } from '../shared';\n\n@Component({\n  selector: 'igo-directions-buttons',\n  templateUrl: './directions-buttons.component.html',\n  styleUrls: ['./directions-buttons.component.scss']\n})\nexport class DirectionsButtonsComponent {\n  get activeRoute() {\n    return this.routesFeatureStore\n      .all()\n      .find((route) => route.properties.active);\n  }\n  @Input() contextUri: string;\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n  @Input() stopsStore: StopsStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n\n  public disabled$ = new BehaviorSubject(false);\n\n  constructor(\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    @Optional() private route: RouteService,\n    private directionsService: DirectionsService\n  ) {}\n\n  resetStops() {\n    this.stopsStore.clearStops();\n  }\n\n  // stop are always added before the last stop.\n  addStop(): void {\n    addStopToStore(this.stopsStore);\n  }\n\n  copyLinkToClipboard() {\n    const successful = Clipboard.copy(this.getUrl());\n    if (successful) {\n      this.messageService.success(\n        'igo.geo.directionsForm.dialog.copyMsgLink',\n        'igo.geo.directionsForm.dialog.copyTitle'\n      );\n    }\n  }\n\n  zoomRoute() {\n    this.zoomToActiveRoute$.next();\n  }\n\n  copyDirectionsToClipboard() {\n    const directionsBody = this.directionsToText();\n    const successful = Clipboard.copy(directionsBody);\n    if (successful) {\n      this.messageService.success(\n        'igo.geo.directionsForm.dialog.copyMsg',\n        'igo.geo.directionsForm.dialog.copyTitle'\n      );\n    }\n  }\n\n  private directionsToText() {\n    const indent = '\\t';\n    let activeRouteDirective =\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.instructions'\n      ) + ':\\n';\n    let wayPointList = '';\n    const summary =\n      this.languageService.translate.instant('igo.geo.directionsForm.summary') +\n      ': \\n' +\n      indent +\n      this.activeRoute.properties.direction.title +\n      '\\n' +\n      indent +\n      formatDistance(this.activeRoute.properties.direction.distance) +\n      '\\n' +\n      indent +\n      formatDuration(this.activeRoute.properties.direction.duration) +\n      '\\n\\n' +\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.stopsList'\n      ) +\n      ':\\n';\n\n    const url =\n      this.languageService.translate.instant('igo.geo.directionsForm.link') +\n      ':\\n' +\n      indent +\n      this.getUrl();\n\n    let wayPointsCnt = 1;\n    this.stopsStore.view.all().forEach((stop) => {\n      let coord = '';\n      let stopText = '';\n      if (stop.text !== roundCoordTo(stop.coordinates).join(',')) {\n        stopText = stop.text;\n        coord = ` ( ${roundCoordTo(stop.coordinates).join(',')} )`;\n      } else {\n        stopText = roundCoordTo(stop.coordinates).join(',');\n      }\n\n      wayPointList =\n        wayPointList +\n        indent +\n        wayPointsCnt.toLocaleString() +\n        '. ' +\n        stopText +\n        coord +\n        '\\n';\n      wayPointsCnt++;\n    });\n\n    let localCnt = 0;\n    this.activeRoute.properties.direction.steps.forEach((step) => {\n      const instruction = this.formatStep(step, localCnt).instruction;\n      const distance =\n        formatDistance(step.distance) === undefined\n          ? ''\n          : ' (' + formatDistance(step.distance) + ')';\n      activeRouteDirective =\n        activeRouteDirective +\n        indent +\n        (localCnt + 1).toLocaleString() +\n        '. ' +\n        instruction +\n        distance +\n        '\\n';\n      localCnt++;\n    });\n\n    const directionsBody =\n      summary + wayPointList + '\\n' + url + '\\n\\n' + activeRouteDirective;\n\n    return directionsBody;\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeRoute.properties.direction.steps.length - 1\n    );\n  }\n\n  private getUrl() {\n    if (!this.route) {\n      return;\n    }\n    let context = '';\n    if (this.contextUri) {\n      context = `context=${this.contextUri}&`;\n    }\n\n    const pos = this.routesFeatureStore\n      .all()\n      .map((direction: FeatureWithDirection) => direction.properties.id)\n      .indexOf(this.activeRoute.properties.id);\n    let routingOptions = '';\n    if (pos !== 0) {\n      const routingOptionsKey = this.route.options.directionsOptionsKey;\n      routingOptions = `&${routingOptionsKey}=result:${pos}`;\n    }\n    const directionsKey = this.route.options.directionsCoordKey;\n    const stopsCoordinates = this.stopsStore.view\n      .all()\n      .map((stop) => roundCoordTo(stop.coordinates, 6));\n    let directionsUrl = '';\n    if (stopsCoordinates.length >= 2) {\n      directionsUrl = `${directionsKey}=${stopsCoordinates.join(';')}`;\n      return `${location.origin}${location.pathname}?${context}tool=directions&sidenav=1&${directionsUrl}${routingOptions}`;\n    }\n    return;\n  }\n\n  printDirections() {\n    this.stepFeatureStore.clear();\n    this.disabled$.next(true);\n    this.directionsService\n      .downloadDirection(\n        this.routesFeatureStore.map,\n        this.activeRoute.properties.direction\n      )\n      .subscribe(() => {\n        this.disabled$.next(false);\n      });\n  }\n}\n","<div class=\"igo-input-container\" *ngIf=\"directions && activeDirection\">\n  <mat-form-field *ngIf=\"directions && directions.length > 1\">\n    <mat-label>{{\n      'igo.geo.directionsForm.drivingOptions' | translate\n    }}</mat-label>\n    <mat-select\n      placeholder=\"{{ 'igo.geo.directionsForm.drivingOptions' | translate }}\"\n      (selectionChange)=\"changeRoute()\"\n      [(ngModel)]=\"activeDirection\"\n    >\n      <mat-option\n        *ngFor=\"let direction of directions; let cnt = index\"\n        [value]=\"direction\"\n      >\n        Option {{ cnt + 1 }} : {{ formatDistance(direction.distance) }} ({{\n          formatDuration(direction.duration)\n        }})\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n\n  <mat-divider *ngIf=\"directions && directions.length === 0\"></mat-divider>\n\n  <mat-list (mouseleave)=\"onStepsListBlur()\">\n    <h2 mat-header class=\"igo-route-title\">{{ activeDirection.title }}</h2>\n    <span class=\"mat-caption\">\n      {{ formatDistance(activeDirection.distance) }},\n      {{ formatDuration(activeDirection.duration) }}\n    </span>\n    <mat-list-item\n      class=\"igo-steps\"\n      (mouseenter)=\"showSegment(step)\"\n      (click)=\"showSegment(step, true)\"\n      *ngFor=\"let step of activeDirection.steps; let cnt = index\"\n      igoListItem\n    >\n      <mat-icon\n        [ngClass]=\"formatStep(step, cnt).cssClass\"\n        matListItemIcon\n        svgIcon=\"{{ formatStep(step, cnt).image }}\"\n      >\n      </mat-icon>\n\n      <span class=\"igo-step-text\">\n        {{ cnt + 1 }}. {{ formatStep(step, cnt).instruction }}\n      </span>\n      <span matListItemMeta>\n        {{ formatDistance(step.distance) }}\n      </span>\n    </mat-list-item>\n\n    <mat-divider></mat-divider>\n  </mat-list>\n</div>\n","import {\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { LanguageService } from '@igo2/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport {\n  Direction,\n  FeatureWithStep,\n  IgoStep\n} from '../shared/directions.interface';\nimport {\n  formatDistance,\n  formatDuration,\n  formatInstruction\n} from '../shared/directions.utils';\nimport { RoutesFeatureStore, StepFeatureStore } from '../shared/store';\n\nimport olFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olGeom from 'ol/geom';\n\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { DirectionType } from '../shared/directions.enum';\n\n@Component({\n  selector: 'igo-directions-results',\n  templateUrl: './directions-results.component.html',\n  styleUrls: ['./directions-results.component.scss']\n})\nexport class DirectionsResultsComponent implements OnInit, OnDestroy {\n  public activeDirection: Direction;\n  public directions: Direction[];\n\n  private entities$$: Subscription;\n\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n\n  constructor(\n    private languageService: LanguageService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit(): void {\n    this.entities$$ = this.routesFeatureStore.entities$\n      .pipe(debounceTime(200))\n      .subscribe((entities) => {\n        const activeFeatureWithDirection = entities.find(\n          (entity) => entity.properties.active\n        );\n        this.directions = entities.map((entity) => entity.properties.direction);\n        if (activeFeatureWithDirection) {\n          this.activeDirection =\n            activeFeatureWithDirection.properties.direction;\n        } else {\n          this.activeDirection = undefined;\n        }\n        this.cdRef.detectChanges();\n      });\n  }\n\n  ngOnDestroy(): void {\n    this.entities$$.unsubscribe();\n  }\n\n  changeRoute() {\n    this.routesFeatureStore.entities$.value.map(\n      (entity) => (entity.properties.active = !entity.properties.active)\n    );\n    this.routesFeatureStore.layer.ol\n      .getSource()\n      .getFeatures()\n      .map((feature) => feature.set('active', !feature.get('active')));\n  }\n\n  formatDistance(distance: number): string {\n    return formatDistance(distance);\n  }\n\n  formatDuration(duration: number): string {\n    return formatDuration(duration);\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeDirection.steps.length - 1\n    );\n  }\n\n  onStepsListBlur() {\n    this.stepFeatureStore.clear();\n  }\n\n  showSegment(step: IgoStep, zoomToExtent = false) {\n    this.showRouteSegmentGeometry(step, zoomToExtent);\n  }\n\n  showRouteSegmentGeometry(step: IgoStep, zoomToExtent = false) {\n    const coordinates = step.geometry.coordinates;\n    const vertexId = 'vertex';\n    const geometry4326 = new olGeom.LineString(coordinates);\n    const geometryMapProjection = geometry4326.transform(\n      'EPSG:4326',\n      this.stepFeatureStore.layer.map.projection\n    );\n    const routeSegmentCoordinates = (\n      geometryMapProjection as any\n    ).getCoordinates();\n    const lastPoint = routeSegmentCoordinates[0];\n\n    const geometry = new olGeom.Point(lastPoint);\n    const feature = new olFeature({ geometry });\n\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.stepFeatureStore.layer.map.projection,\n      dataProjection: this.stepFeatureStore.layer.map.projection\n    }) as FeatureGeometry;\n\n    const previousVertex = this.stepFeatureStore.get(vertexId);\n    const previousVertexRevision = previousVertex\n      ? previousVertex.meta.revision\n      : 0;\n\n    const stepFeature: FeatureWithStep = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.stepFeatureStore.layer.map.projection,\n      properties: {\n        id: vertexId,\n        step,\n        type: DirectionType.Vertex\n      },\n      meta: {\n        id: vertexId,\n        revision: previousVertexRevision + 1\n      },\n      ol: feature\n    };\n    this.stepFeatureStore.update(stepFeature);\n    if (zoomToExtent) {\n      this.stepFeatureStore.layer.map.viewController.zoomToExtent(\n        feature.getGeometry().getExtent() as [number, number, number, number]\n      );\n    }\n  }\n}\n","import {\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { debounceTime, distinctUntilChanged, map } from 'rxjs/operators';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { EntityStoreWatcher } from '@igo2/common';\r\n\r\nimport * as olCondition from 'ol/events/condition';\r\nimport * as olInteraction from 'ol/interaction';\r\nimport * as olProj from 'ol/proj';\r\nimport { TranslateEvent } from 'ol/interaction/Translate';\r\nimport Collection from 'ol/Collection';\r\nimport { SelectEvent } from 'ol/interaction/Select';\r\n\r\nimport {\r\n  DirectionOptions,\r\n  FeatureWithStopProperties,\r\n  Stop\r\n} from './shared/directions.interface';\r\nimport { Subject, Subscription } from 'rxjs';\r\nimport {\r\n  addDirectionToRoutesFeatureStore,\r\n  addStopToStopsFeatureStore,\r\n  addStopToStore,\r\n  initRoutesFeatureStore,\r\n  initStepFeatureStore,\r\n  initStopsFeatureStore,\r\n  updateStoreSorting\r\n} from './shared/directions.utils';\r\nimport { Feature } from '../feature/shared/feature.interfaces';\r\nimport { DirectionsService } from './shared/directions.service';\r\nimport { DirectionType, ProposalType } from './shared/directions.enum';\r\nimport { roundCoordTo, stringToLonLat } from '../map';\r\nimport { SearchService } from '../search/shared/search.service';\r\nimport { ChangeUtils, ObjectUtils } from '@igo2/utils';\r\nimport {\r\n  RoutesFeatureStore,\r\n  StepFeatureStore,\r\n  StopsFeatureStore,\r\n  StopsStore\r\n} from './shared/store';\r\nimport { FeatureStoreLoadingStrategy } from '../feature/shared/strategies/loading';\r\nimport { Research, SearchResult } from '../search/shared/search.interfaces';\r\nimport { QueryService } from '../query/shared/query.service';\r\n\r\n@Component({\r\n  selector: 'igo-directions',\r\n  templateUrl: './directions.component.html',\r\n  styleUrls: ['./directions.component.scss']\r\n})\r\nexport class DirectionsComponent implements OnInit, OnDestroy {\r\n  private watcher: EntityStoreWatcher<Stop>;\r\n\r\n  public projection: string = 'EPSG:4326';\r\n\r\n  private zoomRoute$$: Subscription;\r\n  private storeEmpty$$: Subscription;\r\n  private storeChange$$: Subscription;\r\n  private routesQueries$$: Subscription[] = [];\r\n\r\n  private selectStopInteraction: olInteraction.Select;\r\n  private translateStop: olInteraction.Translate;\r\n  private selectedRoute: olInteraction.Select;\r\n  private focusOnStop: boolean = false;\r\n  private isTranslating: boolean = false;\r\n\r\n  public previousStops: Stop[] = [];\r\n\r\n  private searchs$$: Subscription[] = [];\r\n\r\n  @Input() contextUri: string;\r\n  @Input() stopsStore: StopsStore;\r\n  @Input() stopsFeatureStore: StopsFeatureStore;\r\n  @Input() routesFeatureStore: RoutesFeatureStore;\r\n  @Input() stepFeatureStore: StepFeatureStore;\r\n  @Input() debounce: number = 200;\r\n  @Input() length: number = 2;\r\n  @Input() coordRoundedDecimals: number = 6;\r\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\r\n\r\n  /**\r\n   * Wheter one of the direction control is active\r\n   * @internal\r\n   */\r\n  get directionControlIsActive(): boolean {\r\n    return !this.queryService.queryEnabled;\r\n  }\r\n\r\n  get interactions(): olInteraction.Interaction[] {\r\n    return [this.selectStopInteraction, this.translateStop, this.selectedRoute];\r\n  }\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    private languageService: LanguageService,\r\n    private directionsService: DirectionsService,\r\n    private searchService: SearchService,\r\n    private queryService: QueryService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.queryService.queryEnabled = false;\r\n    this.initEntityStores();\r\n    setTimeout(() => {\r\n      initStopsFeatureStore(this.stopsFeatureStore, this.languageService);\r\n      initRoutesFeatureStore(this.routesFeatureStore, this.languageService);\r\n      initStepFeatureStore(this.stepFeatureStore);\r\n      this.initOlInteraction();\r\n    }, 1);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.queryService.queryEnabled = true;\r\n    this.storeEmpty$$.unsubscribe();\r\n    this.storeChange$$.unsubscribe();\r\n    this.routesQueries$$.map((u) => u.unsubscribe());\r\n    this.zoomRoute$$.unsubscribe();\r\n    this.freezeStores();\r\n  }\r\n\r\n  private freezeStores() {\r\n    this.interactions.map((interaction) =>\r\n      this.routesFeatureStore.layer.map.ol.removeInteraction(interaction)\r\n    );\r\n    this.stopsFeatureStore.deactivateStrategyOfType(\r\n      FeatureStoreLoadingStrategy\r\n    );\r\n    this.routesFeatureStore.deactivateStrategyOfType(\r\n      FeatureStoreLoadingStrategy\r\n    );\r\n    this.stepFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\r\n  }\r\n\r\n  private initEntityStores() {\r\n    this.watcher = new EntityStoreWatcher(this.stopsStore, this.cdRef);\r\n    this.monitorEmptyEntityStore();\r\n    this.monitorEntityStoreChange();\r\n    this.monitorActiveRouteZoom();\r\n  }\r\n\r\n  private monitorActiveRouteZoom() {\r\n    this.zoomRoute$$ = this.zoomToActiveRoute$.subscribe(() => {\r\n      if (this.routesFeatureStore.count >= 1) {\r\n        const activeRoute = this.routesFeatureStore\r\n          .all()\r\n          .find((route) => route.properties.active);\r\n\r\n        if (activeRoute) {\r\n          activeRoute.ol.getGeometry();\r\n          const routeExtent = activeRoute.ol.getGeometry().getExtent();\r\n          this.routesFeatureStore.layer.map.viewController.zoomToExtent(\r\n            routeExtent as [number, number, number, number]\r\n          );\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private initOlInteraction() {\r\n    this.selectStopInteraction = new olInteraction.Select({\r\n      layers: [this.stopsFeatureStore.layer.ol],\r\n      hitTolerance: 7,\r\n      condition: (event) => {\r\n        return event.type === 'pointermove' && !event.dragging;\r\n      }\r\n    });\r\n\r\n    this.translateStop = new olInteraction.Translate({\r\n      features: this.selectStopInteraction.getFeatures()\r\n    });\r\n    this.translateStop.on('translating', (evt: TranslateEvent) => {\r\n      this.isTranslating = true;\r\n      this.executeStopTranslation(evt.features);\r\n    });\r\n    this.translateStop.on('translateend', (evt: TranslateEvent) => {\r\n      this.isTranslating = false;\r\n      this.executeStopTranslation(evt.features);\r\n    });\r\n\r\n    this.selectedRoute = new olInteraction.Select({\r\n      layers: [this.routesFeatureStore.layer.ol],\r\n      condition: olCondition.click,\r\n      hitTolerance: 7,\r\n      filter: (feature) => {\r\n        return (\r\n          feature.get('type') === DirectionType.Route &&\r\n          feature.get('active') &&\r\n          !this.isTranslating\r\n        );\r\n      }\r\n    });\r\n    this.selectedRoute.on('select', (evt: SelectEvent) => {\r\n      if (this.focusOnStop === false) {\r\n        const selectCoordinates = roundCoordTo(\r\n          olProj.transform(\r\n            (evt as any).mapBrowserEvent.coordinate,\r\n            this.routesFeatureStore.layer.map.projection,\r\n            this.projection\r\n          ) as [number, number],\r\n          this.coordRoundedDecimals\r\n        );\r\n        const addedStop = addStopToStore(this.stopsStore);\r\n        addedStop.text = selectCoordinates.join(',');\r\n        addedStop.coordinates = [selectCoordinates[0], selectCoordinates[1]];\r\n      }\r\n    });\r\n\r\n    this.interactions.map((interaction) =>\r\n      this.routesFeatureStore.layer.map.ol.addInteraction(interaction)\r\n    );\r\n  }\r\n\r\n  onStopInputHasFocusChange(stopInputHasFocus: boolean) {\r\n    stopInputHasFocus\r\n      ? this.routesFeatureStore.layer.map.ol.removeInteraction(\r\n          this.selectedRoute\r\n        )\r\n      : this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\r\n  }\r\n\r\n  private executeStopTranslation(features: Collection<any>) {\r\n    if (features.getLength() === 0) {\r\n      return;\r\n    }\r\n    const firstFeature = features.getArray()[0];\r\n    const translatedStopId = firstFeature.getId();\r\n\r\n    const translationCoordinates = olProj.transform(\r\n      firstFeature.getGeometry().getCoordinates(),\r\n      this.stopsFeatureStore.layer.map.projection,\r\n      this.projection\r\n    );\r\n    const translatedStop = this.stopsStore.get(translatedStopId);\r\n    const roundedCoord = roundCoordTo(\r\n      translationCoordinates as [number, number],\r\n      this.coordRoundedDecimals\r\n    );\r\n    translatedStop.coordinates = roundedCoord;\r\n    translatedStop.text = roundedCoord.join(',');\r\n    this.stopsStore.update(translatedStop);\r\n  }\r\n\r\n  private monitorEmptyEntityStore() {\r\n    // Watch if the store is empty to reset it\r\n    this.storeEmpty$$ = this.stopsStore.count$\r\n      .pipe(distinctUntilChanged())\r\n      .subscribe((count) => {\r\n        if (count < 2) {\r\n          addStopToStore(this.stopsStore);\r\n          if (this.stopsStore.count === 2) {\r\n            this.stopsStore.storeInitialized$.next(true);\r\n            return;\r\n          }\r\n          this.stopsStore.storeInitialized$.next(false);\r\n        }\r\n        this.routesQueries$$.map((u) => u.unsubscribe());\r\n      });\r\n  }\r\n\r\n  private monitorEntityStoreChange() {\r\n    this.storeChange$$ = this.stopsStore.entities$\r\n      .pipe(debounceTime(this.debounce))\r\n      .subscribe((stops: Stop[]) => {\r\n        this.handleStopDiff(stops);\r\n        updateStoreSorting(this.stopsStore);\r\n        this.handleStopsFeature();\r\n        this.getRoutes(this.isTranslating);\r\n      });\r\n  }\r\n\r\n  cancelSearch() {\r\n    this.searchs$$.map((s) => s.unsubscribe());\r\n  }\r\n\r\n  private handleStopDiff(stops: Stop[]) {\r\n    const simplifiedStops = stops.map((stop: Stop) => {\r\n      return ObjectUtils.removeUndefined({\r\n        ...{ id: stop.id, text: stop.text, coordinates: stop.coordinates }\r\n      });\r\n    });\r\n    const diff = ChangeUtils.findChanges(this.previousStops, simplifiedStops, [\r\n      'coordinates'\r\n    ]);\r\n    const stopIdToProcess = diff.added.concat(diff.modified);\r\n    if (stopIdToProcess) {\r\n      stopIdToProcess.map((change) => {\r\n        const changedStop = change.newValue as Stop;\r\n        if (changedStop) {\r\n          const stop: Stop = this.stopsStore.get(changedStop.id);\r\n          const term = stop.text;\r\n          if (!term || term.length === 0) {\r\n            return;\r\n          }\r\n          const response = stringToLonLat(\r\n            term,\r\n            this.stopsFeatureStore.layer.map.projection\r\n          );\r\n          let researches: Research[];\r\n          let isCoord = false;\r\n          if (response.lonLat) {\r\n            isCoord = true;\r\n          }\r\n          researches = this.searchService.search(term, {\r\n            searchType: 'Feature'\r\n          });\r\n          this.cancelSearch();\r\n          const requests$ = researches.map((res) =>\r\n            res.request.pipe(\r\n              map((results: SearchResult[]) =>\r\n                results.filter((r) =>\r\n                  isCoord\r\n                    ? r.data.geometry.type === 'Point' && r.data.geometry\r\n                    : r.data.geometry\r\n                )\r\n              )\r\n            )\r\n          );\r\n          this.searchs$$ = requests$.map((request) => {\r\n            return request\r\n              .pipe(\r\n                map((results: SearchResult[]) =>\r\n                  results.filter((r) =>\r\n                    isCoord\r\n                      ? r.data.geometry.type === 'Point' && r.data.geometry\r\n                      : r.data.geometry\r\n                  )\r\n                )\r\n              )\r\n              .subscribe((res: SearchResult[]) => {\r\n                if (res.length > 0) {\r\n                  const source = res[0].source;\r\n                  const meta = res[0].meta;\r\n                  const results = res.map((r) => r.data);\r\n                  if (!stop.searchProposals) {\r\n                    stop.searchProposals = [];\r\n                  }\r\n                  stop.searchProposals = stop.searchProposals.filter(\r\n                    (sp) =>\r\n                      sp.type ===\r\n                      (isCoord ? ProposalType.Coord : ProposalType.Text)\r\n                  );\r\n                  let storedSource = stop.searchProposals.find(\r\n                    (sp) => sp.source === source\r\n                  );\r\n                  if (storedSource) {\r\n                    storedSource.results = results;\r\n                  } else {\r\n                    stop.searchProposals.push({\r\n                      type: isCoord ? ProposalType.Coord : ProposalType.Text,\r\n                      source,\r\n                      meta,\r\n                      results\r\n                    });\r\n                  }\r\n                }\r\n                this.cdRef.detectChanges();\r\n              });\r\n          });\r\n        }\r\n      });\r\n    }\r\n    this.previousStops = simplifiedStops;\r\n  }\r\n\r\n  private handleStopsFeature() {\r\n    const stops = this.stopsStore.all();\r\n    const stopsWithCoordinates = stops.filter((stop) => stop.coordinates);\r\n    stopsWithCoordinates.map((stop) => this.addStopOverlay(stop));\r\n    this.stopsFeatureStore\r\n      .all()\r\n      .map((stopFeature: Feature<FeatureWithStopProperties>) => {\r\n        if (!this.stopsStore.get(stopFeature.properties.id)) {\r\n          this.stopsFeatureStore.delete(stopFeature);\r\n        }\r\n      });\r\n    const stopsWithoutCoordinates = stops.filter((stop) => !stop.coordinates);\r\n    stopsWithoutCoordinates.map((stop) => {\r\n      const stopFeature = this.stopsFeatureStore.get(stop.id);\r\n      if (stopFeature) {\r\n        this.stopsFeatureStore.delete(stopFeature);\r\n      }\r\n    });\r\n  }\r\n\r\n  private getRoutes(isOverview: boolean = false) {\r\n    const stopsWithCoordinates = this.stopsStore.view\r\n      .all()\r\n      .filter((stop) => stop.coordinates);\r\n    if (stopsWithCoordinates.length < 2) {\r\n      this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\r\n      return;\r\n    }\r\n\r\n    const roundedCoordinates = stopsWithCoordinates.map((stop) => {\r\n      const roundedCoord = roundCoordTo(\r\n        stop.coordinates,\r\n        this.coordRoundedDecimals\r\n      );\r\n      return roundedCoord;\r\n    });\r\n    const overviewDirectionsOptions: DirectionOptions = {\r\n      overview: true,\r\n      steps: false,\r\n      alternatives: false,\r\n      continue_straight: false\r\n    };\r\n    this.routesQueries$$.map((u) => u.unsubscribe());\r\n    const routeResponse = this.directionsService.route(\r\n      roundedCoordinates,\r\n      isOverview ? overviewDirectionsOptions : undefined\r\n    );\r\n    if (routeResponse) {\r\n      routeResponse.map((res) =>\r\n        this.routesQueries$$.push(\r\n          res.subscribe((directions) => {\r\n            this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\r\n            directions.map((direction) =>\r\n              addDirectionToRoutesFeatureStore(\r\n                this.routesFeatureStore,\r\n                direction,\r\n                this.projection,\r\n                direction === directions[0] ? true : false\r\n              )\r\n            );\r\n          })\r\n        )\r\n      );\r\n    }\r\n  }\r\n\r\n  public addStopOverlay(stop: Stop) {\r\n    addStopToStopsFeatureStore(\r\n      stop,\r\n      this.stopsStore,\r\n      this.stopsFeatureStore,\r\n      this.projection,\r\n      this.languageService\r\n    );\r\n  }\r\n\r\n  onToggleDirectionsControl(isActive: boolean) {\r\n    this.queryService.queryEnabled = !isActive;\r\n    const ol = this.routesFeatureStore.layer.map.ol;\r\n    this.interactions.map((interaction) =>\r\n      isActive\r\n        ? ol.addInteraction(interaction)\r\n        : ol.removeInteraction(interaction)\r\n    );\r\n  }\r\n}\r\n","<div class=\"directions-options\">\r\n  <mat-slide-toggle\r\n    [checked]=\"directionControlIsActive\"\r\n    [labelPosition]=\"'before'\"\r\n    (change)=\"onToggleDirectionsControl($event.checked)\"\r\n  >\r\n    {{ 'igo.geo.directionsForm.toggleActive' | translate }}\r\n  </mat-slide-toggle>\r\n</div>\r\n\r\n<igo-directions-buttons\r\n  [stepFeatureStore]=\"stepFeatureStore\"\r\n  [contextUri]=\"contextUri\"\r\n  [zoomToActiveRoute$]=\"zoomToActiveRoute$\"\r\n  [routesFeatureStore]=\"routesFeatureStore\"\r\n  [stopsStore]=\"stopsStore\"\r\n></igo-directions-buttons>\r\n\r\n<igo-directions-inputs\r\n  (stopInputHasFocus)=\"onStopInputHasFocusChange($event)\"\r\n  [coordRoundedDecimals]=\"coordRoundedDecimals\"\r\n  [projection]=\"projection\"\r\n  [stopsFeatureStore]=\"stopsFeatureStore\"\r\n  [stopsStore]=\"stopsStore\"\r\n  [debounce]=\"debounce\"\r\n  [length]=\"length\"\r\n></igo-directions-inputs>\r\n\r\n<igo-directions-results\r\n  [stepFeatureStore]=\"stepFeatureStore\"\r\n  [routesFeatureStore]=\"routesFeatureStore\"\r\n></igo-directions-results>\r\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Cacheable } from 'ts-cacheable';\n\nimport { customCacheHasher, uuid } from '@igo2/utils';\nimport { ConfigService } from '@igo2/core';\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport {\n  DirectionsFormat,\n  SourceDirectionsType\n} from '../shared/directions.enum';\n\nimport { DirectionsSource } from './directions-source';\nimport { DirectionsSourceOptions } from './directions-source.interface';\n\n@Injectable()\nexport class OsrmDirectionsSource extends DirectionsSource {\n  get enabled(): boolean {\n    return this.options.enabled !== false;\n  }\n  set enabled(value: boolean) {\n    this.options.enabled = value;\n  }\n  static _name = 'OSRM Québec';\n  private directionsUrl =\n    'https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/';\n  private options: DirectionsSourceOptions;\n\n  constructor(\n    private http: HttpClient,\n    private config: ConfigService\n  ) {\n    super();\n    this.options = this.config.getConfig('directionsSources.osrm') || {};\n    this.directionsUrl = this.options.url || this.directionsUrl;\n  }\n\n  getName(): string {\n    return OsrmDirectionsSource._name;\n  }\n\n  route(\n    coordinates: [number, number][],\n    directionsOptions: DirectionOptions = {}\n  ): Observable<Direction[]> {\n    const directionsParams = this.getRouteParams(directionsOptions);\n    return this.getRoute(coordinates, directionsParams);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getRoute(\n    coordinates: [number, number][],\n    params: HttpParams\n  ): Observable<Direction[]> {\n    return this.http\n      .get<JSON[]>(this.directionsUrl + coordinates.join(';'), {\n        params\n      })\n      .pipe(map((res) => this.extractRoutesData(res)));\n  }\n\n  private extractRoutesData(response): Direction[] {\n    const routeResponse = [];\n    response.routes.forEach((route) => {\n      routeResponse.push(this.formatRoute(route, response.waypoints));\n    });\n    return routeResponse;\n  }\n\n  private getRouteParams(directionsOptions: DirectionOptions = {}): HttpParams {\n    directionsOptions.alternatives =\n      directionsOptions.alternatives !== undefined\n        ? directionsOptions.alternatives\n        : true;\n    directionsOptions.steps =\n      directionsOptions.steps !== undefined ? directionsOptions.steps : true;\n    directionsOptions.geometries =\n      directionsOptions.geometries !== undefined\n        ? directionsOptions.geometries\n        : 'geojson';\n    directionsOptions.overview =\n      directionsOptions.overview !== undefined\n        ? directionsOptions.overview\n        : false;\n    directionsOptions.continue_straight =\n      directionsOptions.continue_straight !== undefined\n        ? directionsOptions.continue_straight\n        : false;\n\n    return new HttpParams({\n      fromObject: {\n        alternatives: directionsOptions.alternatives ? 'true' : 'false',\n        overview: directionsOptions.overview ? 'simplified' : 'full',\n        steps: directionsOptions.steps ? 'true' : 'false',\n        geometries: directionsOptions.geometries\n          ? directionsOptions.geometries\n          : 'geojson',\n        continue_straight: directionsOptions.continue_straight\n          ? 'true'\n          : 'false'\n      }\n    });\n  }\n\n  private formatRoute(roadNetworkRoute: any, waypoints: any): Direction {\n    const stepsUI = [];\n    roadNetworkRoute.legs.forEach((leg) => {\n      leg.steps.forEach((step) => {\n        stepsUI.push(step);\n      });\n    });\n    return {\n      id: uuid(),\n      title: roadNetworkRoute.legs[0].summary,\n      source: OsrmDirectionsSource._name,\n      sourceType: SourceDirectionsType.Route,\n      order: 1,\n      format: DirectionsFormat.GeoJSON,\n      icon: 'directions',\n      projection: 'EPSG:4326',\n      waypoints,\n      distance: roadNetworkRoute.distance,\n      duration: roadNetworkRoute.duration,\n      geometry: roadNetworkRoute.geometry,\n      legs: roadNetworkRoute.legs,\n      steps: stepsUI,\n      weight: roadNetworkRoute.weight,\n      weight_name: roadNetworkRoute.weight_name\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { DirectionsSource } from './directions-source';\nimport { OsrmDirectionsSource } from './osrm-directions-source';\n\nexport function osrmDirectionsSourcesFactory(\n  http: HttpClient,\n  config: ConfigService\n) {\n  return new OsrmDirectionsSource(http, config);\n}\n\nexport function provideOsrmDirectionsSource() {\n  return {\n    provide: DirectionsSource,\n    useFactory: osrmDirectionsSourcesFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService]\n  };\n}\n","import { FEATURE } from '../../feature';\nimport { LAYER } from '../../layer/shared';\n\nexport const SEARCH_TYPES = [FEATURE, LAYER];\n","import { FeatureGeometry } from './../../feature/shared/feature.interfaces';\nimport {\n  Directive,\n  Input,\n  OnDestroy,\n  Self,\n  OnInit,\n  AfterContentChecked,\n  HostListener\n} from '@angular/core';\n\nimport { Subscription, first } from 'rxjs';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { SearchService } from './search.service';\n\nimport olFeature from 'ol/Feature';\nimport { transform } from 'ol/proj';\nimport * as olgeom from 'ol/geom';\nimport OlGeoJSON from 'ol/format/GeoJSON';\n\nimport { SearchResult, Research } from './search.interfaces';\nimport { EntityStore } from '@igo2/common';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { tryBindStoreLayer } from '../../feature/shared/feature-store.utils';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureMotion, FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSourceService } from './search-source.service';\nimport { sourceCanReverseSearchAsSummary } from './search.utils';\nimport { MediaService } from '@igo2/core';\nimport { unByKey } from 'ol/Observable';\nimport { pointerPositionSummaryMarkerStyle } from '../../style/shared/feature/feature-style';\nimport { SubjectStatus } from '@igo2/utils';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoSearchPointerSummary]'\n})\nexport class SearchPointerSummaryDirective\n  implements OnInit, OnDestroy, AfterContentChecked\n{\n  public store: FeatureStore<Feature>;\n  private lonLat: [number, number];\n  private pointerSearchStore: EntityStore<SearchResult> =\n    new EntityStore<SearchResult>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n  private reverseSearch$$: Subscription[] = [];\n  private hasPointerReverseSearchSource: boolean = false;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private searchPointerSummaryFeatureId: string =\n    'searchPointerSummaryFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoSearchPointerSummaryDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoSearchPointerSummaryEnabled: boolean = false;\n\n  @HostListener('mouseleave')\n  mouseleave() {\n    clearTimeout(this.lastTimeoutRequest);\n    this.clearLayer();\n  }\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService\n  ) {}\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.listenToMapPointerMove();\n    this.subscribeToPointerStore();\n\n    this.map.status$\n      .pipe(first((status) => status === SubjectStatus.Done))\n      .subscribe(() => {\n        this.store = new FeatureStore<Feature>([], { map: this.map });\n        this.initStore();\n      });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      if (\n        this.store &&\n        !layers.find((l) => l.id === 'searchPointerSummaryId')\n      ) {\n        this.initStore();\n      }\n    });\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'searchPointerSummaryId',\n      title: 'searchPointerSummary',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: pointerPositionSummaryMarkerStyle\n    });\n    tryBindStoreLayer(store, layer);\n  }\n\n  ngAfterContentChecked(): void {\n    if (\n      !this.searchSourceService\n        .getEnabledSources()\n        .filter(sourceCanReverseSearchAsSummary).length\n    ) {\n      this.hasPointerReverseSearchSource = false;\n    } else {\n      this.hasPointerReverseSearchSource = true;\n    }\n  }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unsubscribeReverseSearch();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerSearchStore.entities$.subscribe(\n      (resultsUnderPointerPosition) => {\n        this.entitiesToPointerOverlay(resultsUnderPointerPosition);\n      }\n    );\n  }\n\n  /**\n   * Build an object based on the closest feature by type (base on type and distance properties )\n   * @param results SearchResult[]\n   * @returns OL style function\n   */\n  private computeSummaryClosestFeature(results: SearchResult[]): {} {\n    const closestResultByType = {};\n\n    results.map((result) => {\n      if (result.data.properties.type && result.data.properties.distance >= 0) {\n        if (closestResultByType.hasOwnProperty(result.data.properties.type)) {\n          const prevDistance =\n            closestResultByType[result.data.properties.type].distance;\n          if (result.data.properties.distance < prevDistance) {\n            const title = result.meta.pointerSummaryTitle || result.meta.title;\n            closestResultByType[result.data.properties.type] = {\n              distance: result.data.properties.distance,\n              title\n            };\n          }\n        } else {\n          const title = result.meta.pointerSummaryTitle || result.meta.title;\n          closestResultByType[result.data.properties.type] = {\n            distance: result.data.properties.distance,\n            title\n          };\n        }\n      }\n    });\n\n    return closestResultByType;\n  }\n\n  /**\n   * convert store entities to a pointer position overlay with label summary on.\n   * @param event OL map browser pointer event\n   */\n  private entitiesToPointerOverlay(\n    resultsUnderPointerPosition: SearchResult[]\n  ) {\n    const closestResultByType = this.computeSummaryClosestFeature(\n      resultsUnderPointerPosition\n    );\n    const summarizedClosestType = Object.keys(closestResultByType);\n    const processedSummarizedClosestType = [];\n    const summary = [];\n    resultsUnderPointerPosition.map((result) => {\n      const typeIndex = summarizedClosestType.indexOf(\n        result.data.properties.type\n      );\n      if (typeIndex !== -1) {\n        summary.push(closestResultByType[result.data.properties.type].title);\n        summarizedClosestType.splice(typeIndex, 1);\n        processedSummarizedClosestType.push(result.data.properties.type);\n      } else {\n        if (\n          processedSummarizedClosestType.indexOf(\n            result.data.properties.type\n          ) === -1\n        ) {\n          summary.push(result.meta.pointerSummaryTitle || result.meta.title);\n        }\n      }\n    });\n    if (summary.length) {\n      this.addPointerOverlay(summary.join('\\n'));\n    }\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n  /**\n   * Unsubscribe to reverse seatch store.\n   * @internal\n   */\n  unsubscribeReverseSearch() {\n    this.reverseSearch$$.map((s) => s.unsubscribe());\n    this.reverseSearch$$ = [];\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Trigger reverse search when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    if (\n      event.dragging ||\n      !this.igoSearchPointerSummaryEnabled ||\n      !this.hasPointerReverseSearchSource ||\n      this.mediaService.isTouchScreen()\n    ) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n      this.clearLayer();\n      this.unsubscribeReverseSearch();\n    }\n\n    this.lonLat = transform(\n      event.coordinate,\n      this.mapProjection,\n      'EPSG:4326'\n    ) as [number, number];\n\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.onSearchCoordinate();\n    }, this.igoSearchPointerSummaryDelay);\n  }\n\n  /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\n    return r1.source.displayOrder - r2.source.displayOrder;\n  }\n\n  private onSearchCoordinate() {\n    this.pointerSearchStore.clear();\n    const results = this.searchService.reverseSearch(\n      this.lonLat,\n      { params: { geometry: 'false', icon: 'false' } },\n      true\n    );\n\n    for (const i in results) {\n      if (results.length > 0) {\n        this.reverseSearch$$.push(\n          results[i].request.subscribe((_results: SearchResult<Feature>[]) => {\n            this.onSearch({ research: results[i], results: _results });\n          })\n        );\n      }\n    }\n  }\n\n  private onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    const newResults = this.pointerSearchStore\n      .all()\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n    this.pointerSearchStore.load(newResults.sort(this.sortByOrder));\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addPointerOverlay(text: string) {\n    this.clearLayer();\n\n    const geometry = new olgeom.Point(\n      transform(this.lonLat, 'EPSG:4326', this.mapProjection)\n    );\n    const feature = new olFeature({ geometry });\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.mapProjection,\n      dataProjection: this.mapProjection\n    }) as FeatureGeometry;\n\n    const f: Feature = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.mapProjection,\n      properties: {\n        id: this.searchPointerSummaryFeatureId,\n        pointerSummary: text\n      },\n      meta: {\n        id: this.searchPointerSummaryFeatureId\n      },\n      ol: feature\n    };\n    this.store.setLayerFeatures([f], FeatureMotion.None);\n  }\n\n  /**\n   * Clear the pointer store features\n   */\n  private clearLayer() {\n    if (this.store) {\n      this.store.clearLayer();\n    }\n  }\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport olWKT from 'ol/format/WKT';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { SearchResult, TextSearch } from '../search.interfaces';\nimport { SearchSource } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\nimport { GeoJsonGeometryTypes } from 'geojson';\nimport { customCacheHasher } from '@igo2/utils';\n\n/**\n * Cadastre search source\n */\n@Injectable()\nexport class CadastreSearchSource extends SearchSource implements TextSearch {\n  static id = 'cadastre';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return CadastreSearchSource.id;\n  }\n\n  getType(): string {\n    return CadastreSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Cadastre (Québec)',\n      searchUrl: 'https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?'\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    term = term.endsWith(',') ? term.slice(0, -1) : term;\n    term = term.startsWith(',') ? term.substr(1) : term;\n    term = term.replace(/ /g, '');\n\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('numero') || !params.get('numero').match(/^[0-9,]+$/g)) {\n      return of([]);\n    }\n    return this.getCadastre(term, params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getCadastre(\n    term: string,\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    return this.http\n      .get(this.searchUrl, { params, responseType: 'text' })\n      .pipe(map((response: string) => this.extractResults(response, term)));\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          numero: term,\n          epsg: '4326'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: string,\n    term: string\n  ): SearchResult<Feature>[] {\n    return response\n      .split('<br />')\n      .filter((lot: string) => lot.length > 0)\n      .map((lot: string) => this.dataToResult(lot, term));\n  }\n\n  private dataToResult(data: string, term: string): SearchResult<Feature> {\n    const lot = data.split(';');\n    const numero = lot[0];\n    const wkt = lot[7];\n    const geometry = this.computeGeometry(wkt);\n\n    const properties = {\n      NoLot: numero,\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n    const id = [this.getId(), 'cadastre', numero].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: numero,\n        score: computeTermSimilarity(term.trim(), numero),\n        icon: 'map-marker'\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        properties,\n        meta: {\n          id,\n          title: numero\n        }\n      }\n    };\n  }\n\n  private computeGeometry(wkt: string): FeatureGeometry {\n    const feature = new olWKT().readFeature(wkt, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: 'EPSG:4326'\n    });\n    return {\n      type: feature.getGeometry().getType() as GeoJsonGeometryTypes,\n      coordinates: (feature.getGeometry() as any).getCoordinates()\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { CadastreSearchSource } from './cadastre';\n\n/**\n * Cadastre search source factory\n * @ignore\n */\nexport function cadastreSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new CadastreSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${CadastreSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the Cadastre search source\n */\nexport function provideCadastreSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: cadastreSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { StorageService } from '@igo2/core';\nimport { SearchResult, TextSearch } from '../search.interfaces';\nimport { SearchSource } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\nimport { NominatimData } from './nominatim.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\nimport { customCacheHasher } from '@igo2/utils';\n\n/**\n * Nominatim search source\n */\n@Injectable()\nexport class NominatimSearchSource extends SearchSource implements TextSearch {\n  static id = 'nominatim';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    @Inject('options') options: SearchSourceOptions,\n    storageService: StorageService\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return NominatimSearchSource.id;\n  }\n\n  getType(): string {\n    return NominatimSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Nominatim (OSM)',\n      searchUrl: 'https://nominatim.openstreetmap.org/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'amenity',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.type.food',\n              value:\n                'bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.health',\n              value:\n                'baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.entertainment',\n              value:\n                'arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium \\\n                          ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.finance',\n              value: 'atm,bank,bureau_de_change',\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '10',\n              value: 10,\n              enabled: true\n            },\n            {\n              title: '20',\n              value: 20,\n              enabled: false\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'countrycodes',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.country.canada',\n              value: 'CA',\n              enabled: true\n            },\n            {\n              title: 'igo.geo.search.nominatim.country.all',\n              value: null,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'multiple object',\n          name: 'dedupe',\n          values: [\n            {\n              title: 'igo.geo.search.searchSources.settings.true',\n              value: 0,\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.searchSources.settings.false',\n              value: 1,\n              enabled: true\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q')) {\n      return of([]);\n    }\n    return this.getSearch(term, params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getSearch(\n    term: string,\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(\n        map((response: NominatimData[]) => this.extractResults(response, term))\n      );\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          q: this.computeTerm(term),\n          format: 'json'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: NominatimData[],\n    term: string\n  ): SearchResult<Feature>[] {\n    return response.map((data: NominatimData) => this.dataToResult(data, term));\n  }\n\n  private dataToResult(\n    data: NominatimData,\n    term: string\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const geometry = this.computeGeometry(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), 'place', data.place_id].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.display_name,\n        icon: 'map-marker',\n        score: computeTermSimilarity(term.trim(), data.display_name)\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.display_name\n        }\n      }\n    };\n  }\n\n  private computeProperties(data: NominatimData): { [key: string]: any } {\n    return {\n      display_name: data.display_name,\n      place_id: data.place_id,\n      osm_type: data.osm_type,\n      class: data.class,\n      type: data.type\n    };\n  }\n\n  private computeGeometry(data: NominatimData): FeatureGeometry {\n    return {\n      type: 'Point',\n      coordinates: [parseFloat(data.lon), parseFloat(data.lat)]\n    };\n  }\n\n  private computeExtent(data: NominatimData): [number, number, number, number] {\n    return [\n      parseFloat(data.boundingbox[2]),\n      parseFloat(data.boundingbox[0]),\n      parseFloat(data.boundingbox[3]),\n      parseFloat(data.boundingbox[1])\n    ];\n  }\n\n  private computeTerm(term: string): string {\n    return this.computeTermTags(term);\n  }\n\n  /**\n   * Add hashtag from query in Nominatim's format (+[])\n   * @param term Query with hashtag\n   */\n  private computeTermTags(term: string): string {\n    const hashtags = super.getHashtagsValid(term, 'amenity');\n    if (!hashtags) {\n      return this.computeTermSettings(term);\n    }\n\n    if (!hashtags.length) {\n      return null;\n    }\n\n    term = term.replace(/(#[^\\s]*)/g, '');\n    hashtags.forEach((tag) => {\n      term += '+[' + tag + ']';\n    });\n\n    return term;\n  }\n\n  /**\n   * Add hashtag from settings in Nominatim's format (+[])\n   * @param term Query\n   */\n  private computeTermSettings(term: string): string {\n    this.options.settings.forEach((settings) => {\n      if (settings.name === 'amenity') {\n        settings.values.forEach((conf) => {\n          if (conf.enabled && typeof conf.value === 'string') {\n            const splitted = conf.value.split(',');\n            splitted.forEach((value) => {\n              term += '+[' + value + ']';\n            });\n          }\n        });\n      }\n    });\n    return term;\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { NominatimSearchSource } from './nominatim';\n\n/**\n * Nominatim search source factory\n * @ignore\n */\nexport function nominatimSearchSourceFactory(\n  http: HttpClient,\n  config: ConfigService,\n  storageService: StorageService\n) {\n  return new NominatimSearchSource(\n    http,\n    config.getConfig(`searchSources.${NominatimSearchSource.id}`),\n    storageService\n  );\n}\n\n/**\n * Function that returns a provider for the Nominatim search source\n */\nexport function provideNominatimSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: nominatimSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService, StorageService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { ObjectUtils, customCacheHasher } from '@igo2/utils';\nimport { FEATURE, Feature } from '../../../feature';\n\nimport { SearchResult, TextSearch, ReverseSearch } from '../search.interfaces';\nimport { SearchSource } from './source';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './source.interfaces';\nimport {\n  StoredQueriesData,\n  StoredQueriesResponse,\n  StoredQueriesReverseData,\n  StoredQueriesReverseResponse,\n  StoredQueriesSearchSourceOptions,\n  StoredQueriesFields,\n  StoredQueriesReverseSearchSourceOptions\n} from './storedqueries.interfaces';\n\nimport * as olformat from 'ol/format';\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n/**\n * StoredQueries search source\n */\n@Injectable()\nexport class StoredQueriesSearchSource\n  extends SearchSource\n  implements TextSearch\n{\n  static id = 'storedqueries';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [\n    'boundedBy',\n    'id',\n    'coord_x',\n    'coord_y'\n  ];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions = options as StoredQueriesSearchSourceOptions;\n    if (this.storedQueriesOptions && !this.storedQueriesOptions.available) {\n      return;\n    }\n\n    const defaultStoredqueryId = 'rtss';\n    const defaultFieldSplitter: StoredQueriesFields[] = [\n      { name: 'rtss', defaultValue: '-99' },\n      { name: 'chainage', defaultValue: '0', splitPrefix: '\\\\+' }\n    ];\n    const defaultOutputformat = 'text/xml; subtype=gml/3.1.1';\n    const defaultSrsname = 'EPSG:4326';\n    const defaultResultTitle = 'title';\n\n    if (!this.storedQueriesOptions) {\n      console.log(\n        ' No configuration for this search source (storedqueries). You will use the default values'\n      );\n      this.storedQueriesOptions = {\n        storedquery_id: defaultStoredqueryId,\n        fields: defaultFieldSplitter,\n        outputformat: defaultOutputformat,\n        srsname: defaultSrsname,\n        resultTitle: defaultResultTitle\n      };\n      this.resultTitle = defaultResultTitle;\n      console.log('Default values', this.storedQueriesOptions);\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.fields) {\n      throw new Error(\n        'Stored Queries :You have to set \"fields\" into options. ex: fields: {\"name\": \"rtss\", \"defaultValue\": \"-99\"}'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n\n    const storedQueryId =\n      this.storedQueriesOptions.storedquery_id.toLowerCase();\n    if (\n      storedQueryId.includes('getfeaturebyid') &&\n      this.storedQueriesOptions.outputformat\n        .toLowerCase()\n        .includes('getfeaturebyid')\n    ) {\n      let err =\n        'You must set a geojson format for your stored query. This is due to an openlayers issue)';\n      err += ' (wfs 1.1.0 & gml 3.1.1 limitation)';\n      throw new Error(err);\n    }\n\n    if (!(this.storedQueriesOptions.fields instanceof Array)) {\n      this.storedQueriesOptions.fields = [this.storedQueriesOptions.fields];\n    }\n\n    this.multipleFieldsQuery =\n      this.storedQueriesOptions.fields.length > 1 ? true : false;\n\n    this.storedQueriesOptions.fields.forEach((field, index) => {\n      if (this.multipleFieldsQuery && !field.splitPrefix && index !== 0) {\n        throw new Error(\n          'Stored Queries :You must set a field spliter into your field definition (optional for the first one!)'\n        );\n      }\n      if (!field.defaultValue) {\n        throw new Error(\n          'Stored Queries :You must set a field default value into your field definition'\n        );\n      }\n    });\n\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  // URL CALL EXAMPLES:\n  //  GetFeatureById (mandatory storedquery for wfs server) (outputformat must be in geojson)\n  /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=2.0.0&request=GetFeature&storedquery_id=urn:ogc:def:query:OGC-WFS::GetFeatureById&srsname=epsg:4326&outputformat=geojson&ID=a_num_route.132\n  //  Custom StoredQuery\n  /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=rtss&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&rtss=0013801110000c&chainage=12\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const storedqueriesParams = this.termSplitter(\n      term,\n      this.storedQueriesOptions.fields\n    );\n    const params = this.computeRequestParams(\n      options || {},\n      storedqueriesParams\n    );\n    this.options.params = this.options.params ? this.options.params : {};\n    this.options.params.page = options.page ? String(options.page) : '1';\n\n    return this.getSearch(term, params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getSearch(\n    term: string,\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    return new RegExp('.*?gml.*?', 'i').test(\n      this.storedQueriesOptions.outputformat\n    )\n      ? this.http.get(this.searchUrl, { params, responseType: 'text' }).pipe(\n          map((response) => {\n            let resultArray = this.extractResults(\n              this.extractWFSData(response),\n              term\n            );\n            resultArray.sort((a, b) =>\n              a.meta.score > b.meta.score\n                ? 1\n                : a.meta.score === b.meta.score\n                ? a.meta.titleHtml < b.meta.titleHtml\n                  ? 1\n                  : -1\n                : -1\n            );\n            resultArray.reverse();\n            if (resultArray.length > Number(this.options.params.limit)) {\n              const idxEnd =\n                Number(this.options.params.limit) *\n                Number(this.options.params.page);\n              const resultTotLenght = resultArray.length;\n              resultArray = resultArray.slice(0, idxEnd);\n              if (idxEnd < resultTotLenght) {\n                resultArray[resultArray.length - 1].meta.nextPage = true;\n              } else {\n                resultArray[resultArray.length - 1].meta.nextPage = false;\n              }\n            }\n            return resultArray;\n          })\n        )\n      : this.http.get(this.searchUrl, { params }).pipe(\n          map((response) => {\n            return this.extractResults(this.extractWFSData(response), term);\n          })\n        );\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private termSplitter(term: string, fields: StoredQueriesFields[]): {} {\n    const splittedTerm = {};\n    let remainingTerm = term;\n    let cnt = 0;\n\n    // Used to build the default values\n    fields.forEach((field) => {\n      splittedTerm[field.name] = field.defaultValue;\n      const splitterRegex = new RegExp(field.splitPrefix + '(.+)', 'i');\n      if (splitterRegex.test(remainingTerm)) {\n        cnt = field.splitPrefix ? (cnt += 1) : cnt;\n        remainingTerm = remainingTerm.split(splitterRegex)[1];\n      }\n    });\n    if (cnt === 0) {\n      splittedTerm[fields[0].name] = term;\n      return splittedTerm;\n    }\n    remainingTerm = term;\n    const localFields = [...fields].reverse();\n    localFields.forEach((field) => {\n      const splitterRegex = new RegExp(field.splitPrefix || '' + '(.+)', 'i');\n      if (remainingTerm || remainingTerm !== '') {\n        const values = remainingTerm.split(splitterRegex);\n        remainingTerm = values[0];\n        if (values[1]) {\n          splittedTerm[field.name] = values[1].trim();\n        }\n      }\n    });\n    return splittedTerm;\n  }\n\n  private computeRequestParams(\n    options: TextSearchOptions,\n    queryParams\n  ): HttpParams {\n    const wfsversion = this.storedQueriesOptions.storedquery_id\n      .toLowerCase()\n      .includes('getfeaturebyid')\n      ? '2.0.0'\n      : '1.1.0';\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'wfs',\n          version: wfsversion,\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        queryParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesResponse,\n    term: string\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesData) => {\n      return this.dataToResult(data, term);\n    });\n  }\n\n  private dataToResult(\n    data: StoredQueriesData,\n    term: string\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        // extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.title,\n        titleHtml: data.properties[title],\n        icon: 'map-marker',\n        score: data.properties.title\n          ? computeTermSimilarity(term.trim(), data.properties.title)\n          : computeTermSimilarity(term.trim(), data.properties[title])\n      }\n    };\n  }\n\n  private computeProperties(data: StoredQueriesData): { [key: string]: any } {\n    const properties = Object.assign(\n      {},\n      ObjectUtils.removeKeys(\n        data.properties,\n        StoredQueriesSearchSource.propertiesBlacklist\n      ),\n      {\n        Route:\n          '<span class=\"routing\"> <u>' +\n          this.languageService.translate.instant('igo.geo.seeRouting') +\n          '</u> </span>'\n      }\n    );\n    return properties;\n  }\n}\n\n/**\n * StoredQueriesReverse search source\n */\n\n// EXAMPLE CALLS\n/* eslint-disable max-len */\n// https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=lim_adm&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&long=-71.292469&lat=46.748107\n//\n\n@Injectable()\nexport class StoredQueriesReverseSearchSource\n  extends SearchSource\n  implements ReverseSearch\n{\n  static id = 'storedqueriesreverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesReverseSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions =\n      options as StoredQueriesReverseSearchSourceOptions;\n\n    if (\n      !this.storedQueriesOptions ||\n      (this.storedQueriesOptions && !this.storedQueriesOptions.available)\n    ) {\n      return;\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.longField) {\n      throw new Error(\n        'Stored Queries :You have to set \"longField\" to map the longitude coordinate to the query params.'\n      );\n    }\n    if (!this.storedQueriesOptions.latField) {\n      throw new Error(\n        'Stored Queries :You have to set \"latField\" to map the latitude coordinate to the query params.'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries (reverse)',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n    return this.getReverseSearch(params);\n  }\n\n  @Cacheable({\n    maxCacheCount: 20,\n    cacheHasher: customCacheHasher\n  })\n  private getReverseSearch(\n    params: HttpParams\n  ): Observable<SearchResult<Feature>[]> {\n    const isGml = new RegExp('.*?gml.*?', 'i').test(\n      this.storedQueriesOptions.outputformat\n    );\n    const request$ = isGml\n      ? this.http.get(this.searchUrl, { params, responseType: 'text' })\n      : this.http.get(this.searchUrl, { params });\n    return request$.pipe(\n      map((response) => {\n        return this.extractResults(this.extractWFSData(response));\n      })\n    );\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    const longLatParams = {};\n    longLatParams[this.storedQueriesOptions.longField] = lonLat[0];\n    longLatParams[this.storedQueriesOptions.latField] = lonLat[1];\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'WFS',\n          version: '1.1.0',\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        longLatParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private dataToResult(data: StoredQueriesReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties[title],\n        icon: 'map-marker'\n      }\n    };\n  }\n\n  private computeProperties(data: StoredQueriesReverseData): {\n    [key: string]: any;\n  } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      StoredQueriesReverseSearchSource.propertiesBlacklist\n    );\n    const routing = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n    return Object.assign(\n      properties,\n      { type: data.properties.doc_type },\n      routing\n    );\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  StoredQueriesSearchSource,\n  StoredQueriesReverseSearchSource\n} from './storedqueries';\n\n/**\n * StoredQueries search source factory\n * @ignore\n */\nexport function storedqueriesSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new StoredQueriesSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${StoredQueriesSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the StoredQueries search source\n */\nexport function provideStoredQueriesSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: storedqueriesSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n\n/**\n * StoredQueriesReverse search source factory\n * @ignore\n */\n\nexport function storedqueriesReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new StoredQueriesReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${StoredQueriesReverseSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the StoredQueriesReverse search source\n */\nexport function provideStoredQueriesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: storedqueriesReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\n\nimport { Observable, of, BehaviorSubject } from 'rxjs';\n\nimport { LanguageService, StorageService } from '@igo2/core';\n\nimport { FEATURE, Feature } from '../../../feature';\n\nimport { SearchResult, TextSearch } from '../search.interfaces';\nimport { SearchSource } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { SimpleDocumentSearchResultSetUnit } from 'flexsearch';\nimport { GoogleLinks } from '../../../utils/googleLinks';\nimport pointOnFeature from '@turf/point-on-feature';\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { WorkspaceData } from './workspace.interfaces';\n\n/**\n * Workspace search source\n */\n@Injectable()\nexport class WorkspaceSearchSource extends SearchSource implements TextSearch {\n  static id = 'workspace';\n  static type = FEATURE;\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe((title) => this.title$.next(title));\n  }\n\n  getId(): string {\n    return WorkspaceSearchSource.id;\n  }\n\n  getType(): string {\n    return WorkspaceSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const limit: Number = 5;\n\n    return {\n      title: 'igo.geo.search.workspace.name',\n      searchUrl: undefined,\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'datasets',\n          name: 'datasets',\n          values: []\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            { title: '1', value: 1, enabled: limit === 1 },\n            { title: '5', value: 5, enabled: limit === 5 || !limit },\n            { title: '10', value: 10, enabled: limit === 10 },\n            { title: '25', value: 25, enabled: limit === 25 },\n            { title: '50', value: 50, enabled: limit === 50 }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const limitSetting = this.settings.find((s) => s.name === 'limit');\n    const limitValue =\n      (limitSetting.values.find((v) => v.enabled).value as number) || 5;\n    this.options.params.limit = limitValue.toLocaleString();\n    const results: WorkspaceData[] = [];\n    this.options.params.page = (options.page || 1).toLocaleString();\n    const page = options.page || 1;\n    const datasets = this.options.params.datasets.split(',');\n    this.featureStoresWithIndex\n      .filter(\n        (fswi) => fswi.searchDocument && datasets.includes(fswi.layer.title)\n      )\n      .map((fswi) => {\n        const termToUse = term;\n        fswi.searchDocument\n          .search(termToUse, { limit: page * limitValue })\n          .map((i) => {\n            const foundIn: SimpleDocumentSearchResultSetUnit = i;\n            const field = foundIn.field;\n            foundIn.result.map((index) => {\n              const feature = fswi.index.get(index);\n              const score = computeTermSimilarity(\n                termToUse.trim(),\n                feature.properties[field]\n              );\n              results.push({ index, feature, layer: fswi.layer, field, score });\n            });\n          });\n      });\n\n    results.sort((a, b) => (a.score > b.score ? -1 : 1));\n    const gettedIndex = [];\n    const sortedResultToProcess: WorkspaceData[] = [];\n    results.map((r) => {\n      if (!gettedIndex.includes(r.index)) {\n        gettedIndex.push(r.index);\n        sortedResultToProcess.push(r);\n      }\n    });\n\n    return of(\n      this.extractResults(\n        sortedResultToProcess\n          .sort((a, b) => (a.score > b.score ? -1 : 1))\n          .slice(0, page * limitValue)\n      )\n    );\n  }\n\n  private extractResults(results: WorkspaceData[]): SearchResult<Feature>[] {\n    return results.map((result) => this.dataToResult(result, results.length));\n  }\n\n  private dataToResult(\n    data: WorkspaceData,\n    resultsCnt: number\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.index].join('.');\n    const titleHtml = data.feature.properties[data.field];\n    const subtitleHtml2 = '<br><small> ' + data.layer.title + '</small>';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.feature.geometry,\n        extent: data.feature.extent,\n        properties,\n        meta: {\n          id,\n          title: data.feature.properties[data.field],\n          alias: this.getAllowedFieldsAndAlias(data.layer)\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.feature.meta.title,\n        titleHtml: titleHtml + subtitleHtml2,\n        icon: 'map-marker',\n        score: data.score,\n        nextPage:\n          resultsCnt % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      }\n    } as SearchResult<Feature>;\n  }\n\n  private getAllowedFieldsAndAlias(layer: Layer) {\n    let allowedFieldsAndAlias;\n    if (\n      layer.options?.source?.options?.sourceFields &&\n      layer.options.source.options.sourceFields.length >= 1\n    ) {\n      allowedFieldsAndAlias = {};\n      layer.options.source.options.sourceFields.forEach((sourceField) => {\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\n        allowedFieldsAndAlias[sourceField.name] = alias;\n      });\n    }\n    return allowedFieldsAndAlias;\n  }\n\n  private computeProperties(data: WorkspaceData): { [key: string]: any } {\n    if (!data.feature.geometry) {\n      return Object.assign(\n        { type: data.layer.title + '.' + data.field },\n        data.feature.properties\n      );\n    }\n    const googleLinksProperties: {\n      GoogleMaps: string;\n      GoogleStreetView?: string;\n    } = {\n      GoogleMaps: ''\n    };\n    let googleMaps;\n    if (data.feature.geometry.type === 'Point') {\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        data.feature.geometry.coordinates[0],\n        data.feature.geometry.coordinates[1]\n      );\n    } else {\n      const point = pointOnFeature(data.feature.geometry);\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        point.geometry.coordinates[0],\n        point.geometry.coordinates[1]\n      );\n    }\n    googleLinksProperties.GoogleMaps =\n      '<a href=' +\n      googleMaps +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\n      '</a>';\n    if (data.feature.geometry.type === 'Point') {\n      googleLinksProperties.GoogleStreetView =\n        GoogleLinks.getGoogleStreetViewLink(\n          data.feature.geometry.coordinates[0],\n          data.feature.geometry.coordinates[1]\n        );\n    }\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n    return Object.assign(\n      { type: data.feature.sourceId },\n      data.feature.properties,\n      googleLinksProperties,\n      routing\n    );\n  }\n}\n","import { ConfigService, LanguageService, StorageService } from '@igo2/core';\nimport { SearchSource } from './source';\nimport { WorkspaceSearchSource } from './workspace';\n\n/**\n * Workspace search source factory\n * @ignore\n */\nexport function workspaceSearchSourceFactory(\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new WorkspaceSearchSource(\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${WorkspaceSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the Workspace search source\n */\nexport function provideWorkspaceSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: workspaceSearchSourceFactory,\n    multi: true,\n    deps: [LanguageService, StorageService, ConfigService]\n  };\n}\n","<div class=\"igo-search-selector\">\n  <button\n    mat-icon-button\n    class=\"igo-search-selector-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSelectorMenu\"\n  >\n    <mat-icon svgIcon=\"menu-down\"></mat-icon>\n  </button>\n\n  <mat-menu\n    #searchSelectorMenu=\"matMenu\"\n    class=\"no-border-radius\"\n    xPosition=\"before\"\n    yPosition=\"above\"\n  >\n    <mat-radio-group\n      class=\"igo-search-selector-radio-group\"\n      [value]=\"searchType$ | async\"\n      (change)=\"onSearchTypeChange($event.value)\"\n    >\n      <mat-radio-button\n        *ngFor=\"let searchType of searchTypes\"\n        [value]=\"searchType\"\n      >\n        {{ getSearchTypeTitle(searchType) | translate }}\n      </mat-radio-button>\n    </mat-radio-group>\n  </mat-menu>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { SEARCH_TYPES } from '../shared/search.enums';\nimport { SearchSourceService } from '../shared/search-source.service';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-selector',\n  templateUrl: './search-selector.component.html',\n  styleUrls: ['./search-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchSelectorComponent implements OnInit, OnDestroy {\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  /**\n   * The search type enabled\n   */\n  @Input()\n  set searchType(value: string) {\n    this.setSearchType(value);\n  }\n  get searchType(): string {\n    return this.searchType$.value;\n  }\n\n  /**\n   * Event emitted when the enabled search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  constructor(private searchSourceService: SearchSourceService) {}\n\n  ngOnInit() {\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n  }\n\n  ngOnDestroy() {\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * Enable the selected search type\n   * @param searchType Search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Get a search type's title. The title\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Search type\n   * @internal\n   */\n  getSearchTypeTitle(searchType: string) {\n    return `igo.geo.search.${searchType.toLowerCase()}.title`;\n  }\n\n  /**\n   * Emit an event and enable the search sources of the given type.\n   * @param searchType Search type\n   */\n  private setSearchType(searchType: string | undefined) {\n    this.searchType$.next(searchType);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchSourceService.enableSourcesByType(searchType);\n    this.searchTypeChange.emit(searchType);\n  }\n}\n","<div class=\"igo-search-settings\">\n  <button\n    mat-icon-button\n    class=\"igo-search-settings-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSettingsMenu\"\n  >\n    <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n  </button>\n  <mat-menu #searchSettingsMenu=\"matMenu\" class=\"no-border-radius\">\n    <div class=\"checkAllButton\" *ngIf=\"getSearchSources().length > 4\">\n      <button mat-raised-button (click)=\"checkUncheckAllSources($event)\">\n        {{\n          !searchSourcesAllEnabled\n            ? ('igo.geo.search.searchSources.unselectAll' | translate)\n            : ('igo.geo.search.searchSources.selectAll' | translate)\n        }}\n      </button>\n    </div>\n    <ng-container *ngFor=\"let source of getSearchSources()\">\n      <span class=\"igo-search-settings-search-source\">\n        <mat-checkbox\n          class=\"igo-search-settings-checkbox\"\n          [checked]=\"source.enabled\"\n          [value]=\"source\"\n          (click)=\"$event.stopPropagation()\"\n          (change)=\"onCheckSearchSource($event, source)\"\n        >\n        </mat-checkbox>\n        <button\n          *ngIf=\"source.settings.length > 0\"\n          [matMenuTriggerFor]=\"sub_menu\"\n          mat-menu-item\n        >\n          {{ source.title }}\n        </button>\n        <button mat-menu-item *ngIf=\"source.settings.length === 0\">\n          {{ source.title }}\n        </button>\n      </span>\n      <mat-menu #sub_menu=\"matMenu\">\n        <ng-container *ngFor=\"let setting of source.settings\">\n          <button mat-menu-item [matMenuTriggerFor]=\"test_sub_menu\">\n            {{\n              'igo.geo.search.searchSources.settings.' + setting.title\n                | translate\n            }}\n          </button>\n          <mat-menu\n            #test_sub_menu=\"matMenu\"\n            [ngSwitch]=\"setting.type\"\n            yPosition=\"above\"\n          >\n            <span *ngSwitchCase=\"'radiobutton'\">\n              <mat-radio-group\n                class=\"igo-search-settings-radio-group\"\n                [value]=\"setting\"\n              >\n                <mat-radio-button\n                  *ngFor=\"let settingValue of setting.values\"\n                  class=\"mat-typography\"\n                  [value]=\"settingValue\"\n                  [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                  [checked]=\"settingValue.enabled\"\n                  (click)=\"$event.stopPropagation()\"\n                  (change)=\"\n                    settingsValueCheckedRadioButton(\n                      $event,\n                      source,\n                      setting,\n                      settingValue\n                    )\n                  \"\n                >\n                  {{ settingValue.title | translate }}\n                </mat-radio-button>\n              </mat-radio-group>\n            </span>\n            <span *ngSwitchCase=\"'checkbox'\">\n              <div class=\"checkAllButton\" *ngIf=\"setting.values.length > 3\">\n                <button\n                  mat-raised-button\n                  (click)=\"checkUncheckAll($event, source, setting)\"\n                >\n                  {{\n                    setting.allEnabled || setting.allEnabled === undefined\n                      ? ('igo.geo.search.searchSources.settings.unselectAll'\n                        | translate)\n                      : ('igo.geo.search.searchSources.settings.selectAll'\n                        | translate)\n                  }}\n                </button>\n              </div>\n              <div mat-menu-item>\n                <mat-checkbox\n                  *ngFor=\"let settingValue of getAvailableValues(setting)\"\n                  [style.display]=\"displayBlock\"\n                  [checked]=\"settingValue.enabled\"\n                  [value]=\"setting\"\n                  [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                  (click)=\"$event.stopPropagation()\"\n                  (change)=\"\n                    settingsValueCheckedCheckbox(\n                      $event,\n                      source,\n                      setting,\n                      settingValue\n                    )\n                  \"\n                >\n                  {{ settingValue.title | translate }}\n                </mat-checkbox>\n              </div>\n            </span>\n          </mat-menu>\n        </ng-container>\n      </mat-menu>\n    </ng-container>\n    <mat-divider></mat-divider>\n    <span class=\"pointer-summary-slide-toggle-container\">\n      <div mat-menu-item>\n        <mat-slide-toggle\n          class=\"search-option\"\n          (change)=\"changePointerReverseSearch($event)\"\n          tooltip-position=\"below\"\n          *ngIf=\"hasPointerReverseSearchSource && !isTouchScreen\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"\n            'igo.geo.search.pointerSearchSummary.tooltip' | translate\n          \"\n          (click)=\"$event.stopPropagation()\"\n          [checked]=\"pointerSummaryEnabled\"\n        >\n          {{ 'igo.geo.search.pointerSearchSummary.title' | translate }}\n        </mat-slide-toggle>\n      </div>\n      <div mat-menu-item>\n        <mat-slide-toggle\n          class=\"search-option\"\n          (change)=\"changeSearchResultsGeometry($event)\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"\n            'igo.geo.search.searchResultsGeometry.tooltip' | translate\n          \"\n          (click)=\"$event.stopPropagation()\"\n          [checked]=\"searchResultsGeometryEnabled\"\n        >\n          {{ 'igo.geo.search.searchResultsGeometry.title' | translate }}\n        </mat-slide-toggle>\n      </div>\n      <div mat-menu-item>\n        <mat-slide-toggle\n          class=\"search-option\"\n          (change)=\"reverseSearchCoordsFormat($event)\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"\n            reverseSearchCoordsFormatEnabled\n              ? ('igo.geo.search.reverseCoordFormat.tooltipLatLon' | translate)\n              : ('igo.geo.search.reverseCoordFormat.tooltipLonLat' | translate)\n          \"\n          (click)=\"$event.stopPropagation()\"\n          [checked]=\"reverseSearchCoordsFormatEnabled\"\n        >\n          {{ 'igo.geo.search.reverseCoordFormat.title' | translate }}\n        </mat-slide-toggle>\n      </div>\n    </span>\n  </mat-menu>\n</div>\n","import { MatCheckboxChange } from '@angular/material/checkbox';\nimport { MatRadioChange } from '@angular/material/radio';\n\nimport {\n  Component,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  HostListener,\n  Input\n} from '@angular/core';\n\nimport { SearchSourceService } from '../shared/search-source.service';\nimport { SearchSource } from '../shared/sources/source';\nimport {\n  SearchSourceSettings,\n  SettingOptions\n} from '../shared/sources/source.interfaces';\nimport {\n  sourceCanReverseSearchAsSummary,\n  sourceCanSearch,\n  sourceCanReverseSearch\n} from '../shared/search.utils';\nimport { MediaService, StorageService } from '@igo2/core';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-settings',\n  templateUrl: './search-settings.component.html',\n  styleUrls: ['./search-settings.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchSettingsComponent implements OnInit {\n  public hasPointerReverseSearchSource: boolean = false;\n  public searchSourcesAllEnabled: boolean = false;\n\n  public buffer = [];\n  public lastKeyTime = Date.now();\n\n  public displayBlock = 'block';\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n  @Input() reverseSearchCoordsFormatEnabled: boolean = false;\n\n  /**\n   * Event emitted when the enabled search source changes\n   */\n  @Output() searchSourceChange = new EventEmitter<SearchSource>();\n\n  /**\n   * Event emitted when the pointer summary is activated\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry summary is changed\n   */\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the coords format is changed\n   */\n  @Output() reverseSearchCoordsFormatStatus = new EventEmitter<boolean>();\n\n  @HostListener('document:keydown', ['$event'])\n  handleKeyboardEvent(event: KeyboardEvent) {\n    if (event.key === 'F2') {\n      this.pointerSummaryEnabled = !this.pointerSummaryEnabled;\n      this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n    }\n  }\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService,\n    private storageService: StorageService\n  ) {}\n\n  ngOnInit(): void {\n    this.hasPointerReverseSearchSource =\n      this.hasReverseSearchSourcesForPointerSummary();\n  }\n\n  /**\n   * Get all search sources\n   * @internal\n   */\n  getSearchSources(): SearchSource[] {\n    const textSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n\n    const reverseSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanReverseSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n    const sources = textSearchSources.concat(reverseSearchSources);\n    this.computeSourcesCheckAllBehavior(sources);\n    return sources;\n  }\n\n  /**\n   * Get all search sources usable for pointer summary\n   * @internal\n   */\n  hasReverseSearchSourcesForPointerSummary(): boolean {\n    if (\n      this.searchSourceService\n        .getEnabledSources()\n        .filter(sourceCanReverseSearchAsSummary).length\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Triggered when a setting is checked (checkbox style)\n   * @internal\n   */\n  settingsValueCheckedCheckbox(\n    event: MatCheckboxChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    settingValue.enabled = event.checked;\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (settings)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSettingCheckAllBehavior(setting: SearchSourceSettings) {\n    if (setting.allEnabled === undefined) {\n      if (setting.values.find((settingValue) => settingValue.enabled)) {\n        setting.allEnabled = false;\n      } else {\n        setting.allEnabled = true;\n      }\n    } else {\n      setting.allEnabled = !setting.allEnabled;\n    }\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (sources)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSourcesCheckAllBehavior(sources: SearchSource[]) {\n    const enabledSourcesCnt = sources.filter((source) => source.enabled).length;\n    const disabledSourcesCnt = sources.filter(\n      (source) => !source.enabled\n    ).length;\n    this.searchSourcesAllEnabled =\n      enabledSourcesCnt >= disabledSourcesCnt ? false : true;\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAll(event, source: SearchSource, setting: SearchSourceSettings) {\n    event.stopPropagation();\n    this.computeSettingCheckAllBehavior(setting);\n    setting.values.forEach((settingValue) => {\n      settingValue.enabled = setting.allEnabled;\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAllSources(event) {\n    event.stopPropagation();\n    this.getSearchSources().map((source) => {\n      source.enabled = this.searchSourcesAllEnabled;\n      this.searchSourceChange.emit(source);\n    });\n  }\n\n  /**\n   * Triggered when a setting is checked (radiobutton style)\n   * @internal\n   */\n  settingsValueCheckedRadioButton(\n    event: MatRadioChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    setting.values.forEach((conf) => {\n      if (conf.value !== settingValue.value) {\n        conf.enabled = !event.source.checked;\n      } else {\n        conf.enabled = event.source.checked;\n      }\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  onCheckSearchSource(event: MatCheckboxChange, source: SearchSource) {\n    source.enabled = event.checked;\n    const storage = (this.storageService.get(source.getId() + '.options') ||\n      {}) as SettingOptions;\n    storage.enabled = source.enabled;\n    this.storageService.set(source.getId() + '.options', storage);\n    this.searchSourceChange.emit(source);\n  }\n\n  getAvailableValues(setting: SearchSourceSettings) {\n    return setting.values.filter((s) => s.available !== false);\n  }\n\n  getAvailableHashtagsValues(setting: SettingOptions) {\n    if (setting.hashtags) {\n      return setting.hashtags.map((h) => '#' + h).join(', ');\n    }\n    return;\n  }\n\n  stopPropagation(event) {\n    event.stopPropagation();\n  }\n\n  changePointerReverseSearch(event) {\n    this.pointerSummaryEnabled = event.checked;\n    this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n  }\n\n  changeSearchResultsGeometry(event) {\n    this.searchResultsGeometryEnabled = event.checked;\n    this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled);\n  }\n\n  reverseSearchCoordsFormat(event) {\n    this.reverseSearchCoordsFormatEnabled = event.checked;\n    this.reverseSearchCoordsFormatStatus.emit(\n      this.reverseSearchCoordsFormatEnabled\n    );\n  }\n}\n","<div class=\"igo-search-bar-container\" [ngClass]=\"{ empty: empty$ | async }\">\n  <mat-form-field [floatLabel]=\"floatLabel\" [appearance]=\"appearance\">\n    <mat-label *ngIf=\"label\">{{ label }}</mat-label>\n    <input\n      #input\n      matInput\n      autocomplete=\"off\"\n      [ngClass]=\"{ hasSearchIcon: showSearchButton }\"\n      [disabled]=\"disabled$ | async\"\n      [placeholder]=\"\n        placeholder\n          ? placeholder\n          : (placeholder$ | async)\n          ? (placeholder$.value | translate)\n          : undefined\n      \"\n      [value]=\"term$ | async\"\n      (keyup)=\"onKeyup($event)\"\n      (touchend)=\"onKeyup($event)\"\n    />\n    <button\n      *ngIf=\"(empty$ | async) === false\"\n      mat-icon-button\n      matSuffix\n      [color]=\"color\"\n      (click)=\"onClearButtonClick()\"\n      [matTooltip]=\"'igo.geo.search.clearSearch' | translate\"\n    >\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <mat-divider *ngIf=\"withDivider\" [vertical]=\"true\"></mat-divider>\n\n  <div class=\"search-bar-buttons\">\n    <button *ngIf=\"showSearchButton\" mat-icon-button [color]=\"color\">\n      <mat-icon svgIcon=\"magnify\"></mat-icon>\n    </button>\n\n    <igo-search-selector\n      *ngIf=\"searchSelector\"\n      [searchTypes]=\"searchTypes\"\n      [searchType]=\"searchType$ | async\"\n      (searchTypeChange)=\"onSearchTypeChange($event)\"\n    >\n    </igo-search-selector>\n\n    <igo-search-settings\n      *ngIf=\"searchSettings\"\n      [pointerSummaryEnabled]=\"pointerSummaryEnabled\"\n      (pointerSummaryStatus)=\"pointerSummaryStatus.emit($event)\"\n      [searchResultsGeometryEnabled]=\"searchResultsGeometryEnabled\"\n      (searchResultsGeometryStatus)=\"searchResultsGeometryStatus.emit($event)\"\n      [reverseSearchCoordsFormatEnabled]=\"reverseSearchCoordsFormatEnabled\"\n      (reverseSearchCoordsFormatStatus)=\"\n        reverseSearchCoordsFormatStatus.emit($event)\n      \"\n      (searchSourceChange)=\"onSearchSettingsChange()\"\n    >\n    </igo-search-settings>\n  </div>\n</div>\n","import {\n  Component,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Input,\n  Output,\n  EventEmitter,\n  ViewChild,\n  ElementRef\n} from '@angular/core';\nimport {\n  FloatLabelType,\n  MatFormFieldAppearance\n} from '@angular/material/form-field';\nimport { BehaviorSubject, Subscription, timer } from 'rxjs';\nimport { debounce, distinctUntilChanged } from 'rxjs/operators';\n\nimport { ConfigService } from '@igo2/core';\nimport { EntityStore } from '@igo2/common';\n\nimport { SEARCH_TYPES } from '../shared/search.enums';\nimport { SearchResult, Research } from '../shared/search.interfaces';\nimport { SearchService } from '../shared/search.service';\nimport { SearchSourceService } from '../shared/search-source.service';\n\n/**\n * Searchbar that triggers a research in all search sources enabled.\n * If the store input is defined, the search results will be loaded\n * into that store. An event is always emitted when a research is completed.\n */\n@Component({\n  selector: 'igo-search-bar',\n  templateUrl: './search-bar.component.html',\n  styleUrls: ['./search-bar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchBarComponent implements OnInit, OnDestroy {\n  /**\n   * Invalid keys\n   */\n  static invalidKeys = [\n    'Control',\n    'Shift',\n    'Alt',\n    'ArrowDown',\n    'ArrowUp',\n    'ArrowRight',\n    'ArrowLeft'\n  ];\n\n  readonly placeholder$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.search.placeholder'\n  );\n\n  readonly empty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  /**\n   * Subscription to the ssearch bar term\n   */\n  private term$$: Subscription;\n\n  /**\n   * Search term stream\n   */\n  private stream$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Subscription to the search term stream\n   */\n  private stream$$: Subscription;\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  private researches$$: Subscription[];\n\n  /**\n   * whether to show search button or not\n   */\n\n  public showSearchButton: boolean = false;\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  @Input() withDivider: boolean;\n\n  /**\n   * Search term\n   */\n  @Input()\n  set searchType(value: string) {\n    this.setSearchType(value);\n  }\n  get searchType(): string {\n    return this.searchType$.value;\n  }\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Event emitted when the pointer summary is activated by the searchbar setting\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry setting is changed\n   */\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the coords format setting is changed\n   */\n  @Output() reverseSearchCoordsFormatStatus = new EventEmitter<boolean>();\n\n  /**\n   * Search term\n   */\n  @Input()\n  set term(value: string) {\n    this.setTerm(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n  readonly term$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Whether this component is disabled\n   */\n  @Input()\n  set disabled(value: boolean) {\n    this.disabled$.next(value);\n  }\n  get disabled(): boolean {\n    return this.disabled$.value;\n  }\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n\n  /**\n   * When reverse coordinates status change\n   */\n  @Input()\n  get reverseSearchCoordsFormatEnabled(): boolean {\n    return this._reverseSearchCoordsFormatEnabled;\n  }\n  set reverseSearchCoordsFormatEnabled(value: boolean) {\n    this._reverseSearchCoordsFormatEnabled = value;\n    this.setTerm(this.term, true);\n  }\n  private _reverseSearchCoordsFormatEnabled = false;\n\n  /**\n   * Whether a float label should be displayed\n   */\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input() appearance: MatFormFieldAppearance = 'fill';\n\n  @Input() placeholder: string;\n\n  @Input() label: string;\n\n  /**\n   * Icons color (search and clear)\n   */\n  @Input() color = 'primary';\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Debounce time between each keystroke\n   */\n  @Input() debounce = 200;\n\n  /**\n   * Minimum term length required to trigger a research\n   */\n  @Input() minLength = 2;\n\n  /**\n   * Search Selector\n   */\n  @Input() searchSelector = false;\n\n  /**\n   * Search Settings\n   */\n  @Input() searchSettings = false;\n\n  /**\n   * Force coordinates in north america\n   */\n  @Input() forceNA = false;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * Event emitted when the search term changes\n   */\n  @Output() searchTermChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when a research is completed\n   */\n  @Output() search = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() clearFeature = new EventEmitter();\n\n  /**\n   * Event emitted when the search settings changes\n   */\n  @Output() searchSettingsChange = new EventEmitter();\n\n  /**\n   * Input element\n   * @internal\n   */\n  @ViewChild('input', { static: true }) input: ElementRef;\n\n  /**\n   * Whether the search bar is empty\n   * @internal\n   */\n  get empty(): boolean {\n    return this.term.length === 0;\n  }\n\n  constructor(\n    private configService: ConfigService,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService\n  ) {}\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe((term: string) => {\n      this.empty$.next(term === undefined || term.length === 0);\n    });\n\n    this.stream$$ = this.stream$\n      .pipe(debounce(() => timer(this.debounce)))\n      .subscribe((term: string) => this.onSetTerm(term));\n\n    this.handlePlaceholder();\n\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n\n    const configValue = this.configService.getConfig(\n      'searchBar.showSearchButton'\n    );\n    this.showSearchButton = configValue !== undefined ? configValue : false;\n  }\n\n  /**\n   * Unsubscribe to the search term stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.term$$.unsubscribe();\n    this.stream$$.unsubscribe();\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * When a user types, validates the key and send it into the\n   * stream if it's valid\n   * @param event Keyboard event\n   * @internal\n   */\n  onKeyup(event: KeyboardEvent) {\n    const key = event.key;\n    if (!this.keyIsValid(key)) {\n      return;\n    }\n    const term = (event.target as HTMLInputElement).value;\n    this.setTerm(term);\n  }\n\n  /**\n   * Clear the stream and the input\n   * @internal\n   */\n  onClearButtonClick() {\n    this.clear();\n    this.clearFeature.emit();\n  }\n\n  /**\n   * Update search type\n   * @param searchType Enabled search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Update the placeholder with the enabled search type. The placeholder\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Enabled search type\n   * @internal\n   */\n  setSearchType(searchType: string) {\n    this.searchType$.next(searchType);\n  }\n\n  onSearchSettingsChange() {\n    this.doSearch(this.term);\n    this.searchSettingsChange.emit();\n    this.handlePlaceholder();\n  }\n\n  /**\n   * Send the term into the stream only if this component is not disabled\n   * @param term Search term\n   */\n  setTerm(term: string, reverseCoordEvent?: boolean) {\n    if (this.disabled) {\n      return;\n    }\n\n    term = term || '';\n\n    if (term !== this.term && !reverseCoordEvent) {\n      this.term$.next(term);\n    }\n\n    const slug = term.replace(/(#[^\\s]*)/g, '').trim();\n    if (slug.length >= this.minLength || slug.length === 0) {\n      this.stream$.next(term);\n    }\n  }\n\n  /**\n   * Clear the stream and the input\n   */\n  private clear() {\n    this.term$.next('');\n    this.stream$.next('');\n    this.input.nativeElement.focus();\n  }\n\n  /**\n   * Validate if a given key stroke is a valid input\n   */\n  private keyIsValid(key: string) {\n    return SearchBarComponent.invalidKeys.indexOf(key) === -1;\n  }\n\n  /**\n   * When the search term changes, emit an event and trigger a\n   * research in every enabled search sources.\n   * @param term Search term\n   */\n  private onSetTerm(term: string | undefined) {\n    this.searchTermChange.emit(term);\n    this.doSearch(term);\n  }\n\n  private handlePlaceholder() {\n    const searchTypes = [\n      ...new Set(\n        this.searchSourceService\n          .getEnabledSources()\n          .filter((ss) => !['map', 'coordinatesreverse'].includes(ss.getId()))\n          .map((ss) => ss.getType())\n      )\n    ];\n\n    let placeholder = `igo.geo.search.placeholder`;\n    if (searchTypes.length === 1) {\n      placeholder = `igo.geo.search.${searchTypes[0].toLowerCase()}.placeholder`;\n    } else if (searchTypes.length === 0) {\n      placeholder = `igo.geo.search.emptyType.placeholder`;\n    }\n    this.placeholder$.next(placeholder);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchTypeChange.emit(searchType);\n\n    const placeholder = `igo.geo.search.${searchType.toLowerCase()}.placeholder`;\n    this.placeholder$.next(placeholder);\n\n    this.setTerm(this.term);\n  }\n\n  /**\n   * Execute the search\n   * @param term Search term\n   */\n  private doSearch(rawTerm: string | undefined) {\n    if (this.researches$$) {\n      this.researches$$.map((research) => research.unsubscribe());\n      this.researches$$ = undefined;\n    }\n\n    let terms;\n    if (\n      this.termSplitter &&\n      rawTerm.match(new RegExp(this.termSplitter, 'g'))\n    ) {\n      terms = rawTerm\n        .split(this.termSplitter)\n        .filter((t) => t.length >= this.minLength);\n      if (this.store) {\n        this.store.clear();\n      }\n    } else {\n      terms = [rawTerm];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      const slug = term ? term.replace(/(#[^\\s]*)/g, '').trim() : '';\n      if (slug === '') {\n        if (this.store !== undefined) {\n          this.store.clear();\n        }\n        return;\n      }\n\n      researches = researches.concat(\n        this.searchService.search(term, {\n          forceNA: this.forceNA\n        })\n      );\n    });\n    this.researches$$ = researches.map((research) => {\n      return research.request.subscribe((results: SearchResult[]) => {\n        this.onResearchCompleted(research, results);\n      });\n    });\n  }\n\n  /**\n   * When a research  is completed, emit an event and update\n   * the store's items.\n   * @param research Research\n   * @param results Research results\n   */\n  private onResearchCompleted(research: Research, results: SearchResult[]) {\n    this.search.emit({ research, results });\n\n    if (this.store !== undefined) {\n      const newResults = this.store\n        .all()\n        .filter((result) => result.source !== research.source)\n        .concat(results);\n      this.store.updateMany(newResults);\n    }\n  }\n}\n","<mat-list-item\n  (mouseenter)=\"onMouseEvent($event)\"\n  (mouseleave)=\"onMouseEvent($event)\"\n>\n  <mat-icon\n    *ngIf=\"icon\"\n    matListItemIcon\n    [svgIcon]=\"showIcons ? icon : 'blank'\"\n  ></mat-icon>\n\n  <div\n    matListItemTitle\n    *ngIf=\"titleHtml; else normalTitle\"\n    [innerHtml]=\"titleHtml\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"tooltipHtml\"\n    matTooltipClass=\"search-result-tooltip\"\n  ></div>\n  <ng-template #normalTitle>\n    <span\n      matListItemTitle\n      *ngIf=\"!titleHtml\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"title\"\n      >{{ title }}</span\n    >\n  </ng-template>\n\n  <div matListItemMeta>\n    <button\n      *ngIf=\"withZoomButton\"\n      igoStopPropagation\n      mat-icon-button\n      (click)=\"onZoomHandler()\"\n    >\n      <mat-icon svgIcon=\"magnify\"></mat-icon>\n    </button>\n\n    <ng-content select=\"[igoSearchItemToolbar]\"> </ng-content>\n  </div>\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  EventEmitter,\n  Output\n} from '@angular/core';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport {\n  getEntityTitle,\n  getEntityTitleHtml,\n  getEntityIcon\n} from '@igo2/common';\n\nimport { SearchResult } from '../shared/search.interfaces';\nimport { FeatureMotion, moveToOlFeatures } from '../../feature';\nimport { IgoMap } from '../../map/shared';\n\n/**\n * Search results list item\n */\n@Component({\n  selector: 'igo-search-results-item',\n  templateUrl: './search-results-item.component.html',\n  styleUrls: ['./search-results-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultsItemComponent {\n  /**\n   * Search result item\n   */\n  @Input() result: SearchResult;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search result title\n   * @internal\n   */\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  @Output() zoomEvent = new EventEmitter<boolean>();\n\n  private format = new olFormatGeoJSON();\n\n  get title(): string {\n    return getEntityTitle(this.result);\n  }\n\n  /**\n   * Search result HTML title\n   * @internal\n   */\n  get titleHtml(): string {\n    return getEntityTitleHtml(this.result);\n  }\n\n  /**\n   * Search result tooltip\n   * @internal\n   */\n  get tooltipHtml(): string {\n    return this.titleHtml\n      .replace(/<small?[^>]+(>|$)/g, '\\n')\n      .replace(/<\\/?[^>]+(>|$)/g, '');\n  }\n\n  /**\n   * Search result icon\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.result);\n  }\n\n  onZoomHandler() {\n    const olFeature = this.format.readFeature(this.result.data, {\n      dataProjection: this.result.data.projection,\n      featureProjection: this.map.projection\n    });\n    moveToOlFeatures(\n      this.map.viewController,\n      [olFeature],\n      FeatureMotion.Default\n    );\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    const element = event.target;\n    const type = event.type;\n    switch (type) {\n      case 'mouseenter':\n        const hideBtn = element.querySelector('#hide-save-search-result-btn');\n        hideBtn\n          ? hideBtn.setAttribute('id', 'show-save-search-result-btn')\n          : null;\n        break;\n      case 'mouseleave':\n        const showBtn = element.querySelector('#show-save-search-result-btn');\n        showBtn\n          ? showBtn.setAttribute('id', 'hide-save-search-result-btn')\n          : null;\n        break;\n      default:\n        break;\n    }\n  }\n}\n","<h1 mat-dialog-title class=\"mat-typography\">\n  {{ 'igo.geo.layer.saveFeatureInLayer' | translate }}\n</h1>\n\n<div mat-dialog-content class=\"mat-typography\">\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <igo-list [navigation]=\"false\" [selection]=\"false\">\n      <igo-search-results-item\n        igoListItem\n        color=\"accent\"\n        [result]=\"feature\"\n        showIcons=\"true\"\n      >\n      </igo-search-results-item>\n    </igo-list>\n\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input\n          type=\"text\"\n          placeholder=\"{{ 'igo.geo.layer.chooseOrSet' | translate }}\"\n          matInput\n          [matAutocomplete]=\"auto\"\n          formControlName=\"layerName\"\n        />\n        <mat-autocomplete [displayWith]=\"displayFn\" #auto=\"matAutocomplete\">\n          <mat-option\n            *ngFor=\"let layer of filteredLayers$ | async\"\n            [value]=\"layer\"\n          >\n            <p matListItemTitle>{{ layer.title }}</p>\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n  </form>\n</div>\n\n<div mat-dialog-actions style=\"justify-content: center\">\n  <div class=\"igo-form-button-group create-layer-button-top-padding\">\n    <button mat-raised-button type=\"button\" (click)=\"cancel()\">\n      {{ 'igo.geo.layer.cancelBtn' | translate }}\n    </button>\n    <button\n      id=\"createLayerBtnDialog\"\n      mat-raised-button\n      type=\"button\"\n      color=\"primary\"\n      (click)=\"save()\"\n    >\n      {{ 'igo.geo.layer.saveBtn' | translate }}\n    </button>\n  </div>\n</div>\n","import { LanguageService } from '@igo2/core';\nimport { Component, OnInit, Optional, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport {\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { Layer } from '../../layer/shared';\nimport { SearchResult } from '../shared';\nimport { Observable } from 'rxjs';\nimport { map, startWith } from 'rxjs/operators';\n\n@Component({\n  selector: 'igo-save-feature-dialog',\n  templateUrl: './save-feature-dialog.component.html',\n  styleUrls: ['./save-feature-dialog.component.scss']\n})\nexport class SaveFeatureDialogComponent implements OnInit {\n  public form: UntypedFormGroup;\n  feature: SearchResult;\n  layers: Layer[] = [];\n  filteredLayers$: Observable<Layer[]>;\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    public languageService: LanguageService,\n    public dialogRef: MatDialogRef<SaveFeatureDialogComponent>,\n    @Optional()\n    @Inject(MAT_DIALOG_DATA)\n    public data: { feature: SearchResult; layers: Layer[] }\n  ) {\n    this.form = this.formBuilder.group({\n      layerName: ['', [Validators.required]]\n    });\n  }\n\n  ngOnInit() {\n    this.feature = this.data.feature;\n    this.layers = this.data.layers;\n    this.filteredLayers$ = this.form.controls['layerName'].valueChanges.pipe(\n      startWith(''),\n      map((val) => this.filter(val))\n    );\n  }\n\n  private filter(val): Layer[] {\n    if (typeof val !== 'string') {\n      return;\n    }\n    return this.layers\n      .map((l) => l)\n      .filter(\n        (layer) => layer?.title?.toLowerCase().includes(val.toLowerCase())\n      );\n  }\n\n  displayFn(layer: Layer): string {\n    return layer && layer.title ? layer.title : '';\n  }\n\n  save() {\n    const data: { layer: string | Layer; feature: SearchResult } = {\n      layer: this.form.value.layerName,\n      feature: this.feature\n    };\n    this.dialogRef.close(data);\n  }\n\n  cancel() {\n    this.dialogRef.close();\n  }\n}\n","<button\n  igoStopPropagation\n  (mouseenter)=\"onMouseEvent($event)\"\n  (mouseleave)=\"onMouseEvent($event)\"\n  *ngIf=\"layer.meta.dataType === 'Layer'\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"computeTooltip() | translate\"\n  [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n  (click)=\"onToggleClick($event)\"\n>\n  <mat-icon\n    aria-hidden=\"false\"\n    matBadge=\"icon\"\n    [igoMatBadgeIcon]=\"getBadgeIcon()\"\n    igoMatBadgeColor=\"rgba(0,0,0,0.87)\"\n    igoMatBadgeBackgroundColor=\"none\"\n    igoMatBadgeInverseColor=\"true\"\n    [matBadgeHidden]=\"\n      ((inRange$ | async) && (isVisible$ | async) === true) ||\n      ((inRange$ | async) && !added) ||\n      ((inRange$ | async) && (isPreview$ | async))\n    \"\n    [matBadgeDisabled]=\"(inRange$ | async) === false\"\n    matBadgeSize=\"small\"\n    matBadgePosition=\"after\"\n    [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\"\n  >\n  </mat-icon>\n</button>\n\n<button\n  [id]=\"!isMobile ? 'hide-save-search-result-btn' : ''\"\n  igoStopPropagation\n  *ngIf=\"layer.meta.dataType === 'Feature' && saveSearchResultInLayer\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"addFeatureToLayerTooltip$ | async | translate\"\n  (click)=\"addFeatureToLayer()\"\n>\n  <mat-icon\n    aria-hidden=\"false\"\n    matBadge=\"icon\"\n    igoMatBadgeIcon=\"eye-off\"\n    igoMatBadgeInverseColor=\"true\"\n    [matBadgeHidden]=\"inRange$ | async\"\n    matBadgeDisabled=\"true\"\n    matBadgeSize=\"small\"\n    matBadgePosition=\"after\"\n    svgIcon=\"file-plus-outline\"\n  >\n  </mat-icon>\n</button>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { SearchResult } from '../shared/search.interfaces';\nimport { IgoMap } from '../../map/shared/map';\nimport { LayerOptions } from '../../layer/shared/layers/layer.interface';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { LAYER } from '../../layer/shared/layer.enums';\nimport { Subscription, BehaviorSubject, take } from 'rxjs';\nimport { SaveFeatureDialogComponent } from './save-feature-dialog.component';\nimport { MatDialog } from '@angular/material/dialog';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { DataSourceService, FeatureDataSource } from '../../datasource';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy,\n  tryBindStoreLayer\n} from '../../feature';\nimport { EntityStore } from '@igo2/common';\nimport { getTooltipsOfOlGeometry } from '../../measure';\nimport OlOverlay from 'ol/Overlay';\nimport Stroke from 'ol/style/Stroke';\nimport Fill from 'ol/style/Fill';\nimport Style from 'ol/style/Style';\nimport Circle from 'ol/style/Circle';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport { default as OlGeometry } from 'ol/geom/Geometry';\nimport { QueryableDataSourceOptions } from '../../query/shared';\nimport { Media, MediaService } from '@igo2/core';\n\n@Component({\n  selector: 'igo-search-add-button',\n  templateUrl: './search-results-add-button.component.html',\n  styleUrls: ['./search-results-add-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultAddButtonComponent implements OnInit, OnDestroy {\n  public tooltip$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.catalog.layer.addToMap'\n  );\n\n  public addFeatureToLayerTooltip$: BehaviorSubject<string> =\n    new BehaviorSubject('igo.geo.search.addToLayer');\n\n  private resolution$$: Subscription;\n  private layers$$: Subscription;\n\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  public isVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  private layersSubcriptions = [];\n\n  private lastTimeoutRequest;\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() layer: SearchResult;\n\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added: boolean;\n\n  /**\n   * The map to add the search result layer to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * show hide save search result in layer button\n   */\n  @Input() saveSearchResultInLayer: boolean = false;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  @Input() stores: FeatureStore<Feature>[] = [];\n\n  get allLayers() {\n    return this.map.layers.filter((layer) =>\n      String(layer.id).includes('igo-search-layer')\n    );\n  }\n  private mediaService$$: Subscription;\n  public isMobile: boolean = false;\n  constructor(\n    private layerService: LayerService,\n    private dialog: MatDialog,\n    private dataSourceService: DataSourceService,\n    private mediaService: MediaService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit(): void {\n    // check the view if is mobile or not\n    this.mediaService$$ = this.mediaService.media$.subscribe((media: Media) => {\n      if (media === Media.Mobile) {\n        this.isMobile = true;\n      }\n    });\n    if (this.layer.meta.dataType === 'Layer') {\n      this.added =\n        this.map.layers.findIndex(\n          (lay) => lay.id === this.layer.data.sourceOptions.id\n        ) !== -1;\n    }\n    this.layers$$ = this.map.layers$.subscribe(() => {\n      this.isVisible();\n    });\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(\n      (value) => {\n        this.isInResolutionsRange(value);\n        this.isVisible();\n      }\n    );\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.layers$$.unsubscribe();\n    if (this.mediaService$$) {\n      this.mediaService$$.unsubscribe();\n    }\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(currEvent: Event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    const event = currEvent ? currEvent : ({} as Event);\n\n    if (event.type === 'mouseenter' && this.mouseInsideAdd) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove();\n          } else {\n            this.add(event);\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add(event);\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove();\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  private add(event: Event) {\n    if (!this.added) {\n      this.added = true;\n      this.addLayerToMap(event);\n    }\n  }\n\n  private remove() {\n    if (this.added) {\n      this.added = false;\n      this.removeLayerFromMap();\n      this.layersSubcriptions.map((s) => s.unsubscribe());\n      this.layersSubcriptions = [];\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private addLayerToMap(event?: Event) {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const layerOptions = (this.layer as SearchResult<LayerOptions>).data;\n    if (layerOptions.sourceOptions.optionsFromApi === undefined) {\n      layerOptions.sourceOptions.optionsFromApi = true;\n    }\n    this.layersSubcriptions.push(\n      this.layerService.createAsyncLayer(layerOptions).subscribe((layer) => {\n        if (event.type === 'click') {\n          this.map.layersAddedByClick$.next([layer]);\n        }\n        this.map.addLayer(layer);\n      })\n    );\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private removeLayerFromMap() {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\n    this.map.removeLayer(oLayer);\n  }\n\n  isInResolutionsRange(resolution: number) {\n    const minResolution = this.layer.data.minResolution || 0;\n    const maxResolution = this.layer.data.maxResolution || Infinity;\n    this.inRange$.next(\n      resolution >= minResolution && resolution <= maxResolution\n    );\n  }\n\n  isVisible() {\n    if (this.layer?.data?.sourceOptions?.id) {\n      const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\n      oLayer\n        ? this.isVisible$.next(oLayer.visible)\n        : this.isVisible$.next(false);\n    }\n  }\n\n  getBadgeIcon() {\n    if (this.inRange$.value) {\n      return this.isVisible$.value ? '' : 'eye-off';\n    } else {\n      return 'eye-off';\n    }\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      if (this.isPreview$.value) {\n        return 'igo.geo.catalog.layer.addToMap';\n      } else if (this.inRange$.value) {\n        return this.isVisible$.value\n          ? 'igo.geo.catalog.layer.removeFromMap'\n          : 'igo.geo.catalog.layer.removeFromMapNotVisible';\n      } else {\n        return 'igo.geo.catalog.layer.removeFromMapOutRange';\n      }\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n\n  addFeatureToLayer() {\n    if (this.layer.meta.dataType !== 'Feature') {\n      return;\n    }\n\n    const selectedFeature = this.layer;\n    const dialogRef = this.dialog.open(SaveFeatureDialogComponent, {\n      width: '700px',\n      data: {\n        feature: selectedFeature,\n        layers: this.allLayers\n      }\n    });\n\n    dialogRef\n      .afterClosed()\n      .subscribe((data: { layer: string | any; feature: SearchResult }) => {\n        if (data) {\n          if (this.stores.length > 0) {\n            this.stores.map((store) => {\n              store.state.updateAll({ selected: false });\n              if (store?.layer) {\n                store.layer.visible = false;\n              }\n              return store;\n            });\n          }\n          // check if is new layer\n          if (typeof data.layer === 'string') {\n            this.createLayer(data.layer, data.feature);\n          } else {\n            const activeStore = this.stores.find(\n              (store) => store.layer.id === data.layer.id\n            );\n            activeStore.layer.visible = true;\n            activeStore.layer.opacity = 1;\n            this.addFeature(data.feature, activeStore);\n          }\n        }\n      });\n  }\n\n  createLayer(layerTitle: string, selectedFeature: SearchResult) {\n    const activeStore: FeatureStore<Feature> = new FeatureStore<Feature>([], {\n      map: this.map\n    });\n\n    const styles = [\n      new Style({\n        image: new Circle({\n          radius: 5,\n          stroke: new Stroke({\n            width: 1,\n            color: 'rgba(143,7,7,1)'\n          }),\n          fill: new Fill({\n            color: 'rgba(143,7,7,1)'\n          })\n        })\n      }),\n      new Style({\n        stroke: new Stroke({\n          width: 1,\n          color: 'rgba(143,7,7,1)'\n        }),\n        fill: new Fill({\n          color: 'rgba(0, 0, 255, 0.1)'\n        })\n      })\n    ];\n\n    // set layer id\n    let layerCounterID: number = 0;\n    for (const layer of this.allLayers) {\n      let numberId = Number(layer.id.replace('igo-search-layer', ''));\n      layerCounterID = Math.max(numberId, layerCounterID);\n    }\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector',\n        queryable: true\n      } as QueryableDataSourceOptions)\n      .pipe(take(1))\n      .subscribe((dataSource: FeatureDataSource) => {\n        let searchLayer: VectorLayer = new VectorLayer({\n          isIgoInternalLayer: true,\n          id: 'igo-search-layer' + ++layerCounterID,\n          title: layerTitle,\n          source: dataSource,\n          igoStyle: {\n            editable: false,\n            igoStyleObject: {\n              fill: { color: 'rgba(255,255,255,0.4)' },\n              stroke: { color: 'rgba(143,7,7,1)', width: 1 },\n              circle: {\n                fill: { color: 'rgba(255,255,255,0.4)' },\n                stroke: { color: 'rgba(143,7,7,1)', width: 1 },\n                radius: 5\n              }\n            }\n          },\n          style: styles,\n          showInLayerList: true,\n          exportable: true,\n          workspace: {\n            enabled: true\n          }\n        });\n\n        tryBindStoreLayer(activeStore, searchLayer);\n        tryAddLoadingStrategy(\n          activeStore,\n          new FeatureStoreLoadingStrategy({\n            motion: FeatureMotion.None\n          })\n        );\n\n        tryAddSelectionStrategy(\n          activeStore,\n          new FeatureStoreSelectionStrategy({\n            map: this.map,\n            motion: FeatureMotion.None,\n            many: true\n          })\n        );\n\n        activeStore.layer.visible = true;\n        activeStore.source.ol.on(\n          'removefeature',\n          (event: OlVectorSourceEvent<OlGeometry>) => {\n            const olGeometry = event.feature.getGeometry();\n            this.clearLabelsOfOlGeometry(olGeometry);\n          }\n        );\n\n        this.addFeature(selectedFeature, activeStore);\n        this.stores.push(activeStore);\n      });\n  }\n\n  addFeature(feature: SearchResult, activeStore: FeatureStore<Feature>) {\n    const newFeature = {\n      type: feature.data.type,\n      geometry: {\n        coordinates: feature.data.geometry.coordinates,\n        type: feature.data.geometry.type\n      },\n      projection: feature.data.projection,\n      properties: feature.data.properties,\n      meta: {\n        id: feature.meta.id\n      }\n    };\n    delete newFeature.properties.Route;\n    activeStore.update(newFeature);\n    activeStore.setLayerExtent();\n    activeStore.layer.ol.getSource().refresh();\n  }\n\n  private clearLabelsOfOlGeometry(olGeometry) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (olTooltip && olTooltip.getMap()) {\n          this.map.ol.removeOverlay(olTooltip);\n        }\n      }\n    );\n  }\n}\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\n\n@Component({\n  selector: 'igo-collapsible',\n  templateUrl: './collapsible.component.html',\n  styleUrls: ['./collapsible.component.scss']\n})\nexport class CollapsibleComponent {\n  @Input()\n  get title() {\n    return this._title;\n  }\n  set title(value: string) {\n    this._title = value;\n  }\n  private _title = '';\n\n  @Input()\n  get collapsed() {\n    return this._collapsed;\n  }\n  set collapsed(value: boolean) {\n    this._collapsed = value;\n    this.toggle.emit(value);\n  }\n  private _collapsed = false;\n\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\n}\n","<mat-list-item>\n  <mat-icon\n    svgIcon=\"chevron-up\"\n    class=\"igo-chevron\"\n    matListItemIcon\n    igoCollapse\n    [target]=\"content\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"collapsed = $event\"\n  >\n  </mat-icon>\n  <span matListItemTitle>{{ title }}</span>\n</mat-list-item>\n\n<div #content>\n  <ng-content></ng-content>\n</div>\n","<igo-list [navigation]=\"true\" *ngIf=\"tabsMode === false\">\n  <ng-template #groupTemplate ngFor let-group [ngForOf]=\"results$ | async\">\n    <igo-collapsible\n      [class]=\"group.source.getId()\"\n      *ngIf=\"mode === searchResultMode.Grouped; else flatTemplate\"\n      [title]=\"computeGroupTitle(group)\"\n      [collapsed]=\"collapsed[group.source.title]\"\n      (toggle)=\"collapsed[group.source.title] = $event\"\n    >\n      <ng-container\n        *ngTemplateOutlet=\"\n          storeItemTemplate;\n          context: { results: group.results }\n        \"\n      ></ng-container>\n    </igo-collapsible>\n\n    <ng-template #flatTemplate>\n      <ng-container\n        *ngTemplateOutlet=\"\n          storeItemTemplate;\n          context: { results: group.results }\n        \"\n      ></ng-container>\n    </ng-template>\n\n    <ng-template #storeItemTemplate let-results=\"results\">\n      <ng-template ngFor let-result [ngForOf]=\"results\">\n        <igo-search-results-item\n          igoListItem\n          color=\"accent\"\n          [map]=\"map\"\n          [result]=\"result\"\n          [showIcons]=\"showIcons\"\n          [withZoomButton]=\"withZoomButton\"\n          [focused]=\"store.state.get(result).focused\"\n          [selected]=\"store.state.get(result).selected\"\n          (focus)=\"resultFocus.emit(result)\"\n          (unfocus)=\"resultUnfocus.emit(result)\"\n          (select)=\"onResultSelect(result)\"\n          (mouseenter)=\"resultFocus.emit(result)\"\n          (mouseleave)=\"resultUnfocus.emit(result)\"\n        >\n          <ng-container\n            igoSearchItemToolbar\n            [ngTemplateOutlet]=\"templateSearchToolbar\"\n            [ngTemplateOutletContext]=\"{ result: result }\"\n          >\n          </ng-container>\n        </igo-search-results-item>\n      </ng-template>\n      <span\n        class=\"moreResults mat-typography\"\n        *ngIf=\"isMoreResults(group)\"\n        (click)=\"displayMoreResults(group)\"\n      >\n        <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\n      </span>\n    </ng-template>\n  </ng-template>\n</igo-list>\n\n<igo-list [navigation]=\"true\" *ngIf=\"tabsMode\">\n  <ng-container\n    *ngIf=\"\n      mode === searchResultMode.Grouped;\n      then tabsTemplate;\n      else flatTemplate\n    \"\n  ></ng-container>\n\n  <ng-template #tabsTemplate>\n    <mat-tab-group class=\"custom-tabs-view\" dynamicHeight>\n      <mat-tab\n        *ngFor=\"let group of results$ | async\"\n        [label]=\"computeGroupTitle(group)\"\n      >\n        <ng-container\n          *ngTemplateOutlet=\"storeItemTemplate; context: { group: group }\"\n        ></ng-container>\n      </mat-tab>\n    </mat-tab-group>\n  </ng-template>\n\n  <ng-template #flatTemplate>\n    <ng-template ngFor let-group [ngForOf]=\"results$ | async\">\n      <ng-container\n        *ngTemplateOutlet=\"storeItemTemplate; context: { group: group }\"\n      ></ng-container>\n    </ng-template>\n  </ng-template>\n\n  <ng-template #storeItemTemplate let-group=\"group\">\n    <ng-template ngFor let-result [ngForOf]=\"group.results\">\n      <igo-search-results-item\n        igoListItem\n        color=\"accent\"\n        [map]=\"map\"\n        [result]=\"result\"\n        [showIcons]=\"showIcons\"\n        [withZoomButton]=\"withZoomButton\"\n        [focused]=\"store.state.get(result).focused\"\n        [selected]=\"store.state.get(result).selected\"\n        (focus)=\"resultFocus.emit(result)\"\n        (unfocus)=\"resultUnfocus.emit(result)\"\n        (select)=\"onResultSelect(result)\"\n        (mouseenter)=\"resultFocus.emit(result)\"\n        (mouseleave)=\"resultUnfocus.emit(result)\"\n      >\n        <ng-container\n          igoSearchItemToolbar\n          [ngTemplateOutlet]=\"templateSearchToolbar\"\n          [ngTemplateOutletContext]=\"{ result: result }\"\n        >\n        </ng-container>\n      </igo-search-results-item>\n    </ng-template>\n    <span\n      class=\"moreResults mat-typography\"\n      *ngIf=\"isMoreResults(group)\"\n      (click)=\"displayMoreResults(group)\"\n    >\n      <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\n    </span>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ContentChild,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { Observable, EMPTY, timer, BehaviorSubject, Subscription } from 'rxjs';\nimport { debounce, map } from 'rxjs/operators';\n\nimport { ConfigService } from '@igo2/core';\nimport {\n  EntityState,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreWatcher,\n  EntityStoreWithStrategy\n} from '@igo2/common';\n\nimport { IgoMap } from '../../map/shared';\n\nimport { TextSearchOptions } from '../shared/sources/source.interfaces';\nimport { SearchService } from '../shared/search.service';\nimport { SearchResult, Research } from '../shared/search.interfaces';\nimport { SearchSource } from '../shared/sources/source';\n\nexport enum SearchResultMode {\n  Grouped = 'grouped',\n  Flat = 'flat'\n}\n\n/**\n * List of search results with focus and selection capabilities.\n * This component is dumb and only emits events.\n */\n@Component({\n  selector: 'igo-search-results',\n  templateUrl: './search-results.component.html',\n  styleUrls: ['./search-results.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultsComponent implements OnInit, OnDestroy {\n  private showResultsCount: boolean = true;\n\n  /**\n   * Reference to the SearchResultMode enum\n   * @internal\n   */\n  public searchResultMode = SearchResultMode;\n\n  /**\n   * Search results store watcher\n   */\n  private watcher: EntityStoreWatcher<SearchResult>;\n\n  private settingsChange$$: Subscription;\n\n  public pageIterator: { sourceId: string }[] = [];\n\n  public collapsed: { sourceId: string }[] = [];\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStoreWithStrategy<SearchResult>;\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Search results display mode\n   */\n  @Input() mode: SearchResultMode = SearchResultMode.Grouped;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  /**\n   * To check if the view for tabsMode for search-result-tools\n   */\n  @Input() tabsMode: boolean = false;\n\n  /**\n   * Search term\n   */\n  @Input()\n  get term(): string {\n    return this._term;\n  }\n  set term(value: string) {\n    this._term = value;\n    this.pageIterator = [];\n  }\n  public _term: string;\n\n  @Input() settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Event emitted when a result is focused\n   */\n  @Output() resultFocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is unfocused\n   */\n  @Output() resultUnfocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is selected\n   */\n  @Output() resultSelect = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a research is completed after displaying more results is clicked\n   */\n  @Output() moreResults = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Events emitted when a result is focus or unfocus by mouse event\n   */\n  @Output() resultMouseenter = new EventEmitter<SearchResult>();\n  @Output() resultMouseleave = new EventEmitter<SearchResult>();\n\n  @ContentChild('igoSearchItemToolbar', /* TODO: add static flag */ {})\n  templateSearchToolbar: TemplateRef<any>;\n\n  get results$(): Observable<\n    { source: SearchSource; results: SearchResult[] }[]\n  > {\n    if (this._results$ === undefined) {\n      this._results$ = this.liftResults();\n    }\n    return this._results$;\n  }\n  private _results$: Observable<\n    { source: SearchSource; results: SearchResult[] }[]\n  >;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private searchService: SearchService,\n    private configService: ConfigService\n  ) {}\n\n  /**\n   * Bind the search results store to the watcher\n   * @internal\n   */\n  ngOnInit() {\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n    this.settingsChange$$ = this.settingsChange$.subscribe(() => {\n      this.pageIterator = [];\n    });\n\n    if (\n      this.configService.getConfig('searchSources.showResultsCount') === false\n    ) {\n      this.showResultsCount = false;\n    }\n  }\n\n  /**\n   * Unbind the search results store from the watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n    this.settingsChange$$.unsubscribe();\n  }\n\n  /**\n   * Compute a group title\n   * @param group Search results group\n   * @returns Group title\n   * @internal\n   */\n  computeGroupTitle(group: {\n    source: SearchSource;\n    results: SearchResult[];\n  }): string {\n    const parts = [group.source.title];\n    const count = group.results.length;\n    if (count > 1 && this.showResultsCount) {\n      parts.push(`(${count})`);\n    }\n    return parts.join(' ');\n  }\n\n  /**\n   * When a result is selected, update it's state in the store and emit\n   * an event. A selected result is also considered focused\n   * @param result Search result\n   * @internal\n   */\n  onResultSelect(result: SearchResult) {\n    if (this.store.state.get(result)) {\n      if (this.store.state.get(result).selected === true) {\n        return;\n      }\n    }\n    this.store.state.update(result, { focused: true, selected: true }, true);\n    this.resultSelect.emit(result);\n  }\n\n  /**\n   * Return an observable of the search results, grouped by search source\n   * @returns Observable of grouped search results\n   * @internal\n   */\n  private liftResults(): Observable<\n    { source: SearchSource; results: SearchResult[] }[]\n  > {\n    return this.store.stateView.all$().pipe(\n      debounce((results: { entity: SearchResult; state: EntityState }[]) => {\n        return results.length === 0 ? EMPTY : timer(200);\n      }),\n      map((results: { entity: SearchResult; state: EntityState }[]) => {\n        return this.groupResults(\n          results.map((r) => r.entity).sort(this.sortByOrder)\n        );\n      })\n    );\n  }\n\n  /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\n    return r1.source.displayOrder - r2.source.displayOrder;\n  }\n\n  /**\n   * Group results by search source\n   * @param results Search results from all sources\n   * @returns Search results grouped by source\n   */\n  private groupResults(\n    results: SearchResult[]\n  ): { source: SearchSource; results: SearchResult[] }[] {\n    const grouped = new Map<SearchSource, SearchResult[]>();\n    results.forEach((result: SearchResult) => {\n      const source = result.source;\n      let sourceResults = grouped.get(source);\n      if (sourceResults === undefined) {\n        sourceResults = [];\n        grouped.set(source, sourceResults);\n      }\n      sourceResults.push(result);\n    });\n\n    return Array.from(grouped.keys()).map((source: SearchSource) => {\n      if (this.pageIterator[source.getId()] === undefined) {\n        this.pageIterator[source.getId()] = 1;\n      }\n      return { source, results: grouped.get(source) };\n    });\n  }\n\n  isMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\n    const stategy = this.store.getStrategyOfType(\n      EntityStoreFilterCustomFuncStrategy\n    );\n    const active = stategy?.active || false;\n    if (!active) {\n      return (\n        group.results &&\n        group.results[group.results.length - 1].meta.nextPage === true\n      );\n    } else {\n      return (\n        group.results?.length % +group.source.params.limit === 0 &&\n        +group.source.params.page < 30\n      );\n    }\n  }\n\n  displayMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\n    const options: TextSearchOptions = {\n      sourceId: group.source.getId(),\n      page: ++this.pageIterator[group.source.getId()]\n    };\n\n    let terms;\n    if (\n      this.termSplitter &&\n      this.term.match(new RegExp(this.termSplitter, 'g'))\n    ) {\n      terms = this.term.split(this.termSplitter);\n    } else {\n      terms = [this.term];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      researches = researches.concat(this.searchService.search(term, options));\n    });\n\n    researches.map((research) => {\n      research.request.subscribe((results: SearchResult[]) => {\n        const newResults = group.results.concat(results);\n        if (!results.length) {\n          newResults[newResults.length - 1].meta.nextPage = false;\n        }\n        this.moreResults.emit({ research, results: newResults });\n      });\n    });\n    return;\n  }\n}\n","import { Workspace, WorkspaceOptions } from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared';\n\nexport interface WfsWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class WfsWorkspace extends Workspace {\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(\n    true\n  );\n\n  get layer(): VectorLayer {\n    return this.options.layer;\n  }\n\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  constructor(protected options: WfsWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (\n        mapResolution > this.layer.minResolution &&\n        mapResolution < this.layer.maxResolution\n      ) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n\n  public getLayerWksOptionTabQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\n      return this.layer.options.workspace.queryOptions.tabQuery;\n    }\n    return true;\n  }\n\n  public getLayerWksOptionMapQuery(): boolean {\n    if (\n      this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined\n    ) {\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\n    }\n    return true;\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n}\n","import type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olStyle from 'ol/style';\nimport olFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\n\nimport { Feature } from '../../../feature/shared/feature.interfaces';\nimport { FeatureCommonVectorStyleOptions } from './vector-style.interface';\n\nimport { createOverlayDefaultStyle } from '../overlay/overlay-style.utils';\nimport { createOverlayMarkerStyle } from '../overlay/overlay-marker-style.utils';\n\n/**\n * Generate a style for selected features\n * @param feature The feature to generate the style\n * @returns A olStyle\n */\nexport function getCommonVectorSelectedStyle({\n  feature,\n  markerColor = [0, 161, 222],\n  markerOpacity = 1,\n  markerOutlineColor = [0, 255, 255],\n  fillColor,\n  fillOpacity = 0.15,\n  strokeColor = [0, 255, 255],\n  strokeOpacity = 0.5,\n  strokeWidth = 4\n}: FeatureCommonVectorStyleOptions): olStyle.Style {\n  return getCommonVectorStyle({\n    feature,\n    markerColor,\n    markerOpacity,\n    markerOutlineColor,\n    fillColor,\n    fillOpacity,\n    strokeColor,\n    strokeOpacity,\n    strokeWidth\n  });\n}\n\n/**\n * Generate a basic style for features\n * @param feature The feature to generate the style\n * @returns A olStyle\n */\nexport function getCommonVectorStyle({\n  feature,\n  markerColor = [0, 161, 222],\n  markerOpacity = 0.5,\n  markerOutlineColor,\n  fillColor = [0, 161, 222],\n  fillOpacity = 0.15,\n  strokeColor = [0, 161, 222],\n  strokeOpacity = 0.5,\n  strokeWidth = 2\n}: FeatureCommonVectorStyleOptions): olStyle.Style {\n  const isOlFeature = feature instanceof olFeature;\n  let geometry;\n  let text;\n  if (isOlFeature) {\n    feature = feature as olFeature<OlGeometry>;\n    geometry = feature.getGeometry();\n  } else {\n    feature = feature as Feature;\n    geometry = feature.geometry;\n    text = feature.meta.mapTitle;\n  }\n  const geometryType = isOlFeature ? geometry.getType() : geometry.type;\n\n  if (!geometry || geometryType === 'Point') {\n    const markerColorAsArray = ColorAsArray(markerColor).slice(0);\n    const markerColorRGB = markerColorAsArray.slice(0, 3);\n\n    if (\n      markerColorAsArray.length === 4 &&\n      (typeof markerColor !== 'string' ||\n        /^#[0-9A-F]{8}$/i.test(markerColor as string))\n    ) {\n      markerOpacity = markerColorAsArray[3];\n    }\n\n    return createOverlayMarkerStyle({\n      text,\n      opacity: markerOpacity,\n      markerOutlineColor,\n      markerColor: markerColorRGB\n    });\n  } else {\n    const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n    const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n    if (\n      !(\n        fillWithOpacity.length === 4 &&\n        (typeof fillColor !== 'string' ||\n          /^#[0-9A-F]{8}$/i.test(fillColor as string))\n      )\n    ) {\n      fillWithOpacity[3] = fillOpacity;\n    }\n\n    if (\n      !(\n        strokeWithOpacity.length === 4 &&\n        (typeof strokeColor !== 'string' ||\n          /^#[0-9A-F]{8}$/i.test(strokeColor as string))\n      )\n    ) {\n      strokeWithOpacity[3] = strokeOpacity;\n    }\n\n    return createOverlayDefaultStyle({\n      text,\n      strokeWidth,\n      strokeColor: strokeWithOpacity,\n      fillColor: fillWithOpacity\n    });\n  }\n}\n","import { WfsWorkspace } from './wfs-workspace';\nimport { FeatureWorkspace } from './feature-workspace';\nimport { Observable } from 'rxjs';\nimport {\n  EntityStoreFilterCustomFuncStrategy,\n  EntityRecord,\n  EntityTableColumnRenderer,\n  EntityTableButton,\n  EntityStoreStrategyFuncOptions,\n  EntityTableTemplate,\n  Workspace\n} from '@igo2/common';\nimport { map, skipWhile, take } from 'rxjs/operators';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { StorageScope } from '@igo2/core';\nimport { EntityTableColumn } from '@igo2/common';\nimport { ObjectUtils } from '@igo2/utils';\nimport { IgoMap } from '../../map/shared/map';\nimport { generateIdFromSourceOptions } from '../../utils/id-generator';\nimport { LayerService, VectorLayer } from '../../layer';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport {\n  RelationOptions,\n  SourceFieldsOptionsParams\n} from '../../datasource/shared/datasources/datasource.interface';\n\nexport function getRowsInMapExtent(layerId, storageService): boolean {\n  return (\n    (storageService.get(`workspace.rowsInMapExtent.${layerId}`) as boolean) ||\n    true\n  );\n}\n\nexport function setRowsInMapExtent(value, layerId, storageService) {\n  storageService.set(\n    `workspace.rowsInMapExtent.${layerId}`,\n    value,\n    StorageScope.SESSION\n  );\n}\n\nexport function getSelectedOnly(layerId, storageService): boolean {\n  return (\n    (storageService.get(`workspace.selectedOnly.${layerId}`) as boolean) ||\n    false\n  );\n}\n\nexport function setSelectedOnly(value, layerId, storageService) {\n  storageService.set(\n    `workspace.selectedOnly.${layerId}`,\n    value,\n    StorageScope.SESSION\n  );\n}\n\nexport function mapExtentStrategyActiveToolTip(\n  ws: Workspace\n): Observable<string> {\n  return ws.entityStore\n    .getStrategyOfType(EntityStoreFilterCustomFuncStrategy)\n    .active$.pipe(\n      map((active: boolean) =>\n        active\n          ? 'igo.geo.workspace.inMapExtent.active.tooltip'\n          : 'igo.geo.workspace.inMapExtent.inactive.tooltip'\n      )\n    );\n}\n\nexport function noElementSelected(ws: Workspace): Observable<boolean> {\n  return ws.entityStore.stateView\n    .manyBy$((record: EntityRecord<Feature>) => {\n      return record.state.selected === true;\n    })\n    .pipe(map((entities: EntityRecord<Feature>[]) => entities.length >= 1));\n}\n\nexport function addOrRemoveLayer(\n  action: 'add' | 'remove',\n  map: IgoMap,\n  url: string,\n  type: string,\n  layerName: string,\n  layerService: LayerService\n) {\n  const so = ObjectUtils.removeUndefined({\n    sourceOptions: {\n      type: type,\n      url,\n      optionsFromCapabilities: true,\n      optionsFromApi: true,\n      params: {\n        LAYERS: type === 'wms' ? layerName : undefined,\n        LAYER: type === 'wms' ? undefined : layerName\n      }\n    }\n  });\n  if (action === 'add') {\n    layerService.createAsyncLayer(so).subscribe((layer) => {\n      map.layersAddedByClick$.next([layer]);\n      map.addLayer(layer);\n    });\n  } else if (action === 'remove') {\n    const addedLayerId = generateIdFromSourceOptions(so.sourceOptions);\n    map.removeLayer(map.layers.find((l) => l.id === addedLayerId));\n  }\n}\n\nexport function getGeoServiceAction(\n  workspace: FeatureWorkspace | WfsWorkspace,\n  layerService: LayerService\n) {\n  const geoServiceAction = [\n    {\n      name: 'geoServiceAction',\n      title: undefined,\n      tooltip: '',\n      renderer: EntityTableColumnRenderer.ButtonGroup,\n      valueAccessor: (entity: Feature, record: EntityRecord<Feature>) => {\n        let geoServiceProperties = record.state.geoService;\n        if (\n          geoServiceProperties &&\n          geoServiceProperties.haveGeoServiceProperties &&\n          geoServiceProperties.url &&\n          geoServiceProperties.layerName\n        ) {\n          if (geoServiceProperties.added) {\n            return [\n              {\n                icon: 'delete',\n                color: 'warn',\n                click: (row, record) => {\n                  addOrRemoveLayer(\n                    'remove',\n                    workspace.map,\n                    record.state.geoService.url,\n                    record.state.geoService.type,\n                    record.state.geoService.layerName,\n                    layerService\n                  );\n                  geoServiceProperties.added = false;\n                }\n              }\n            ] as EntityTableButton[];\n          } else {\n            return [\n              {\n                icon: 'plus',\n                color: 'primary',\n                click: (row, record) => {\n                  addOrRemoveLayer(\n                    'add',\n                    workspace.map,\n                    record.state.geoService.url,\n                    record.state.geoService.type,\n                    record.state.geoService.layerName,\n                    layerService\n                  );\n                  geoServiceProperties.added = true;\n                }\n              }\n            ] as EntityTableButton[];\n          }\n        } else {\n          return [];\n        }\n      }\n    }\n  ];\n  return geoServiceAction;\n}\n\nexport function createTableTemplate(\n  workspace: FeatureWorkspace | WfsWorkspace,\n  layer: VectorLayer,\n  layerService: LayerService,\n  ws$\n) {\n  const geoServiceAction = getGeoServiceAction(workspace, layerService);\n  const fields = layer.dataSource.options.sourceFields || [];\n\n  const relations = layer.dataSource.options.relations || [];\n\n  if (fields.length === 0) {\n    workspace.entityStore.entities$\n      .pipe(\n        skipWhile((val) => val.length === 0),\n        take(1)\n      )\n      .subscribe((entities) => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol\n          .getKeys()\n          .filter(\n            (col) =>\n              !col.startsWith('_') &&\n              col !== 'geometry' &&\n              col !== ol.getGeometryName() &&\n              !col.match(/boundedby/gi)\n          )\n          .map((key) => {\n            return {\n              name: `properties.${key}`,\n              title: key,\n              renderer: EntityTableColumnRenderer.UnsanitizedHTML\n            };\n          });\n        columnsFromFeatures.unshift(...geoServiceAction);\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures,\n          tableHeight: '100%'\n        } as EntityTableTemplate;\n      });\n    return;\n  }\n  const columns = fields.map((field: SourceFieldsOptionsParams) => {\n    return {\n      name: `properties.${field.name}`,\n      title: field.alias ? field.alias : field.name,\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n      tooltip: field.tooltip,\n      cellClassFunc: () => {\n        const cellClass = {};\n        if (field.type) {\n          cellClass[`class_${field.type}`] = true;\n          return cellClass;\n        }\n      }\n    } as EntityTableColumn;\n  });\n\n  const relationsColumn = relations.map((relation: RelationOptions) => {\n    return {\n      name: `properties.${relation.name}`,\n      title: relation.alias ? relation.alias : relation.name,\n      renderer: EntityTableColumnRenderer.Icon,\n      icon: relation.icon,\n      parent: relation.parent,\n      type: 'relation',\n      tooltip: relation.tooltip,\n      onClick: () => {\n        ws$.next(relation.title);\n      },\n      cellClassFunc: () => {\n        return { class_icon: true };\n      }\n    };\n  });\n\n  columns.push(...relationsColumn);\n  columns.unshift(...geoServiceAction);\n  workspace.meta.tableTemplate = {\n    selection: true,\n    sort: true,\n    columns,\n    tableHeight: '100%'\n  };\n}\n\nexport function createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n  const filterClauseFunc = (record: EntityRecord<object>) => {\n    return (\n      record.state.inMapExtent === true && record.state.inMapResolution === true\n    );\n  };\n  return new EntityStoreFilterCustomFuncStrategy({\n    filterClauseFunc\n  } as EntityStoreStrategyFuncOptions);\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { ActionStore, EntityStoreFilterSelectionStrategy } from '@igo2/common';\n\nimport {\n  FeatureStore,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureStoreInMapExtentStrategy,\n  FeatureMotion,\n  FeatureStoreInMapResolutionStrategy,\n  GeoPropertiesStrategy\n} from '../../feature';\nimport { LayerService, VectorLayer } from '../../layer/shared';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map/shared';\nimport { CapabilitiesService, FeatureDataSource } from '../../datasource';\nimport { getCommonVectorSelectedStyle } from '../../style/shared/vector/commonVectorStyle';\n\nimport { WfsWorkspace } from './wfs-workspace';\nimport { StorageService, ConfigService } from '@igo2/core';\nimport {\n  createFilterInMapExtentOrResolutionStrategy,\n  createTableTemplate\n} from './workspace.utils';\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector';\n@Injectable({\n  providedIn: 'root'\n})\nexport class WfsWorkspaceService {\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(\n    private storageService: StorageService,\n    private configService: ConfigService,\n    private layerService: LayerService,\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\n    private capabilitiesService: CapabilitiesService\n  ) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): WfsWorkspace {\n    if (\n      layer.options.workspace?.enabled === false ||\n      layer.dataSource.options.edition\n    ) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace, {\n      srcId: layer.id,\n      workspaceId: layer.id,\n      enabled: true\n    } as GeoWorkspaceOptions);\n\n    const wks = new WfsWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    createTableTemplate(wks, layer, this.layerService, this.ws$);\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const geoPropertiesStrategy = new GeoPropertiesStrategy(\n      { map },\n      this.propertyTypeDetectorService,\n      this.capabilitiesService\n    );\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle =\n      this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(\n            Object.assign(\n              {},\n              { feature },\n              confQueryOverlayStyle?.selection || {}\n            )\n          );\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(geoPropertiesStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n}\n","import { Workspace, WorkspaceOptions } from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared';\n\nexport interface FeatureWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class FeatureWorkspace extends Workspace {\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(\n    true\n  );\n\n  get layer(): VectorLayer {\n    return this.options.layer;\n  }\n\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  constructor(protected options: FeatureWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (\n        mapResolution > this.layer.minResolution &&\n        mapResolution < this.layer.maxResolution\n      ) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n\n  public getLayerWksOptionTabQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\n      return this.layer.options.workspace.queryOptions.tabQuery;\n    }\n    return true;\n  }\n\n  public getLayerWksOptionMapQuery(): boolean {\n    if (\n      this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined\n    ) {\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\n    }\n    return true;\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { ActionStore, EntityStoreFilterSelectionStrategy } from '@igo2/common';\n\nimport {\n  FeatureStore,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureStoreInMapExtentStrategy,\n  FeatureMotion,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreSearchIndexStrategy,\n  GeoPropertiesStrategy\n} from '../../feature';\nimport { LayerService, VectorLayer } from '../../layer/shared';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map/shared';\nimport { CapabilitiesService, FeatureDataSource } from '../../datasource';\nimport { getCommonVectorSelectedStyle } from '../../style/shared/vector/commonVectorStyle';\n\nimport { FeatureWorkspace } from './feature-workspace';\nimport { ConfigService, StorageService } from '@igo2/core';\n\nimport {\n  createFilterInMapExtentOrResolutionStrategy,\n  createTableTemplate\n} from './workspace.utils';\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector/propertyTypeDetector.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FeatureWorkspaceService {\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(\n    private storageService: StorageService,\n    private configService: ConfigService,\n    private layerService: LayerService,\n    private propertyTypeDetectorService: PropertyTypeDetectorService,\n    private capabilitiesService: CapabilitiesService\n  ) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): FeatureWorkspace {\n    if (\n      layer.options.workspace?.enabled === false ||\n      layer.dataSource.options.edition\n    ) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace, {\n      srcId: layer.id,\n      workspaceId: layer.id,\n      enabled: true\n    } as GeoWorkspaceOptions);\n\n    const wks = new FeatureWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    createTableTemplate(wks, layer, this.layerService, this.ws$);\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const searchStrategy = new FeatureStoreSearchIndexStrategy({\n      percentDistinctValueRatio: 2,\n      sourceFields: layer.dataSource.options.sourceFields\n    });\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const geoPropertiesStrategy = new GeoPropertiesStrategy(\n      { map },\n      this.propertyTypeDetectorService,\n      this.capabilitiesService\n    );\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle =\n      this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(\n            Object.assign(\n              {},\n              { feature },\n              confQueryOverlayStyle?.selection || {}\n            )\n          );\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    if (layer.options.workspace?.searchIndexEnabled) {\n      store.addStrategy(searchStrategy, true);\n    }\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(geoPropertiesStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n}\n","import { LanguageService } from '@igo2/core';\nimport { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nexport interface DialogData {\n  type: string;\n  cancel: boolean;\n}\n\n@Component({\n  selector: 'igo-confirmation-popup-component',\n  templateUrl: './confirmation-popup.component.html',\n  styleUrls: ['./confirmation-popup.component.scss']\n})\nexport class ConfirmationPopupComponent {\n  constructor(\n    public dialogRef: MatDialogRef<ConfirmationPopupComponent>,\n    public languageService: LanguageService,\n    @Inject(MAT_DIALOG_DATA) public data: { type: string; cancel: boolean }\n  ) {}\n\n  cancelAction() {\n    this.data.cancel = true;\n    this.dialogRef.close(this.data.cancel);\n  }\n\n  confirmedAction() {\n    this.data.cancel = false;\n    this.dialogRef.close(this.data.cancel);\n  }\n}\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">\n    {{\n      data.type === 'add'\n        ? languageService.translate.instant('igo.geo.workspace.addConfirmation')\n        : languageService.translate.instant(\n            'igo.geo.workspace.deleteConfirmation'\n          )\n    }}\n  </p>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button color=\"primary\" (click)=\"confirmedAction()\">\n    Ok\n  </button>\n  <button mat-raised-button (click)=\"cancelAction()\">\n    {{ languageService.translate.instant('igo.geo.workspace.cancel') }}\n  </button>\n</div>\n","import { MatDialog } from '@angular/material/dialog';\nimport { Workspace, WorkspaceOptions, EntityRecord } from '@igo2/common';\nimport { ConfigService } from '@igo2/core';\nimport { BehaviorSubject, Subscription, Observable } from 'rxjs';\n\nimport { ImageLayer, VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared';\nimport { ConfirmationPopupComponent } from '../confirmation-popup/confirmation-popup.component';\nimport { DrawControl } from '../../geometry';\nimport { createInteractionStyle, GeometryType } from '../../draw';\nimport { featureToOl } from '../../feature';\n\nimport type { Type } from 'ol/geom/Geometry';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlVectorSource from 'ol/source/Vector';\nimport * as OlStyle from 'ol/style';\nimport OlModify from 'ol/interaction/Modify';\nimport Collection from 'ol/Collection';\nimport OlFeature from 'ol/Feature';\nimport { FeatureDataSource, RelationOptions } from '../../datasource/shared';\n\nexport interface EditionWorkspaceOptions extends WorkspaceOptions {\n  layer: ImageLayer | VectorLayer;\n  map: IgoMap;\n}\n\nexport class EditionWorkspace extends Workspace {\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(\n    true\n  );\n\n  get layer(): ImageLayer | VectorLayer {\n    return this.options.layer;\n  }\n\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  private drawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private olDrawingLayerSource = new OlVectorSource();\n  private olDrawingLayer: VectorLayer;\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n  public modify; // Reference to the ol interaction\n\n  public modifyStyle = new OlStyle.Style({\n    stroke: new OlStyle.Stroke({\n      color: 'rgba(255,255,255,1)',\n      width: 1\n    }),\n    fill: new OlStyle.Fill({\n      color: 'rgba(0,161,222,1)'\n    }),\n    image: new OlStyle.Circle({\n      radius: 7,\n      stroke: new OlStyle.Stroke({\n        color: 'rgba(255,255,255,1)',\n        width: 1\n      }),\n      fill: new OlStyle.Fill({\n        color: 'rgba(0,161,222,1)'\n      })\n    })\n  });\n\n  private newFeaturefilterClauseFunc = (record: EntityRecord<object>) => {\n    return record.state.newFeature === true;\n  };\n\n  private editFeaturefilterClauseFunc = (record: EntityRecord<object>) => {\n    return record.state.edit === true;\n  };\n\n  public fillColor: string;\n  public strokeColor: string;\n  public strokeWidth: number;\n\n  constructor(\n    private dialog: MatDialog,\n    private configService: ConfigService,\n    private adding$: BehaviorSubject<boolean>,\n    private _deleteFeature: (workspace: EditionWorkspace, url: string) => void,\n    private getDomainValues: (relation: RelationOptions) => Observable<any>,\n    protected options: EditionWorkspaceOptions\n  ) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (\n        mapResolution > this.layer.minResolution &&\n        mapResolution < this.layer.maxResolution\n      ) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n\n    this.drawControl = this.createDrawControl();\n    this.drawControl.setGeometryType(this.geometryType.Point as any);\n\n    this.map.removeLayer(this.olDrawingLayer);\n\n    this.olDrawingLayer = new VectorLayer({\n      id: 'igo-draw-layer',\n      title: 'edition',\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      workspace: {\n        enabled: false\n      }\n    });\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n\n  deleteFeature(feature, workspace) {\n    setTimeout(() => {\n      const dialogRef = this.dialog.open(ConfirmationPopupComponent, {\n        disableClose: false,\n        data: { type: 'delete' }\n      });\n\n      dialogRef.afterClosed().subscribe((result) => {\n        if (result === false) {\n          let id, url;\n          const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\n          const deleteUrl =\n            workspace.layer.dataSource.options.edition.deleteUrl;\n          if (baseUrl.length) {\n            url = this.configService.getConfig('edition.url')\n              ? this.configService.getConfig('edition.url') +\n                baseUrl +\n                '?' +\n                deleteUrl\n              : baseUrl + '?' + deleteUrl;\n          } else {\n            url = this.configService.getConfig('edition.url')\n              ? this.configService.getConfig('edition.url') + deleteUrl\n              : deleteUrl;\n          }\n\n          for (const column of workspace.meta.tableTemplate.columns) {\n            for (const property in feature.properties) {\n              let columnName = column.name;\n              if (columnName.includes('properties.')) {\n                columnName = columnName.split('.')[1];\n              }\n              if (columnName === property && column.primary === true) {\n                id = feature.properties[property];\n              }\n            }\n          }\n          if (url) {\n            url += id;\n            this.deleteFeature(workspace, url);\n          }\n        }\n      });\n    }, 250);\n  }\n\n  editFeature(feature, workspace: EditionWorkspace) {\n    feature.edition = true;\n    let id;\n    let find = false;\n    const editionOpt = workspace.layer.dataSource.options.edition;\n    for (const column of workspace.meta.tableTemplate.columns) {\n      // Update domain list\n      if (column.type === 'list' || column.type === 'autocomplete') {\n        this.getDomainValues(column.relation).subscribe((result) => {\n          column.domainValues = result;\n        });\n      }\n      if (find === false) {\n        for (const property in feature.properties) {\n          let columnName = column.name;\n          if (columnName.includes('properties.')) {\n            columnName = columnName.split('.')[1];\n          }\n          if (columnName === property && column.primary === true) {\n            id = feature.properties[property];\n            find = true;\n            break;\n          }\n        }\n      }\n    }\n    if (id) {\n      feature.original_properties = JSON.parse(\n        JSON.stringify(feature.properties)\n      );\n      feature.original_geometry = feature.geometry;\n      feature.idkey = id;\n      workspace.entityStore.state.updateAll({ edit: false });\n      workspace.entityStore.stateView.filter(this.editFeaturefilterClauseFunc);\n      this.addFeatureToStore(feature, workspace);\n    } else {\n      // Only for edition with it's own geometry\n      if (!feature.newFeature && editionOpt.geomType) {\n        feature.newFeature = true;\n        this.adding$.next(true);\n        workspace.entityStore.state.updateAll({ newFeature: false });\n        workspace.entityStore.stateView.filter(this.newFeaturefilterClauseFunc);\n        if (editionOpt.addWithDraw) {\n          const geometryType = editionOpt.geomType;\n          this.onGeometryTypeChange(geometryType, feature, workspace);\n        } else {\n          workspace.entityStore.insert(feature);\n          workspace.entityStore.state.update(\n            feature,\n            { newFeature: true },\n            true\n          );\n        }\n      }\n    }\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(\n    fillColor?: string,\n    strokeColor?: string,\n    strokeWidth?: number\n  ) {\n    const drawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.olDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(\n        fillColor,\n        strokeColor,\n        strokeWidth\n      )\n    });\n\n    return drawControl;\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(\n    geometryType: Type,\n    feature,\n    workspace: EditionWorkspace\n  ) {\n    this.drawControl.setGeometryType(geometryType);\n    this.toggleDrawControl(feature, workspace);\n  }\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl(feature, workspace: EditionWorkspace) {\n    this.deactivateDrawControl();\n    this.activateDrawControl(feature, workspace);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  public deactivateDrawControl() {\n    if (!this.drawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.drawControl.setOlMap(undefined);\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl(feature, workspace: EditionWorkspace) {\n    this.drawEnd$$ = this.drawControl.end$.subscribe(\n      (olGeometry: OlGeometry) => {\n        this.addFeatureToStore(feature, workspace, olGeometry);\n      }\n    );\n\n    this.drawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * Add a feature to layer. The loading strategy of the layer\n   * will trigger and add the feature to the workspace store.\n   * @internal\n   */\n  private addFeatureToStore(\n    feature,\n    workspace: EditionWorkspace,\n    olGeometry?: OlGeometry\n  ) {\n    const projection = this.map.ol.getView().getProjection();\n    let geometry = feature.geometry;\n\n    // If an olGeometry is passed, it means that it is a new feature\n    if (olGeometry) {\n      workspace.entityStore.insert(feature);\n      workspace.entityStore.state.update(feature, { newFeature: true }, true);\n      geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n        featureProjection: projection,\n        dataProjection: 'EPSG:4326'\n      }) as any;\n\n      feature.geometry = geometry;\n    } else {\n      workspace.entityStore.state.update(feature, { edit: true }, true);\n    }\n\n    feature.projection = 'EPSG:4326';\n\n    const featureOl = featureToOl(feature, projection.getCode());\n\n    this.olDrawingLayer.dataSource.ol.clear();\n    this.olDrawingLayer.dataSource.ol.addFeature(featureOl);\n    this.map.addLayer(this.olDrawingLayer);\n\n    this.deactivateDrawControl();\n    this.createModifyInteraction(featureOl, feature, workspace);\n  }\n\n  /**\n   * Delete drawings layer and source from the map AND feature from the entity store.\n   * Layer refresh will automatically add the new feature into the store.\n   */\n  deleteDrawings() {\n    this.map.removeLayer(this.olDrawingLayer);\n    this.olDrawingLayerSource.clear();\n    this.map.ol.removeInteraction(this.modify);\n  }\n\n  /**\n   * Create a modify interaction to allow a geometry change one feature at the time (drag and drop)\n   */\n  createModifyInteraction(\n    olFeature: OlFeature<OlGeometry>,\n    feature,\n    workspace: EditionWorkspace\n  ) {\n    this.map.ol.removeInteraction(this.modify);\n    const olCollection = new Collection([olFeature], { unique: true });\n    this.modify = new OlModify({\n      features: olCollection\n    });\n\n    this.map.ol.addInteraction(this.modify);\n    olCollection.forEach((feature) => {\n      feature.setStyle(this.modifyStyle);\n    });\n\n    this.modify.on('modifyend', (event) => {\n      const olGeometry = event.features.getArray()[0]?.getGeometry();\n      if (olGeometry) {\n        this.addFeatureToStore(feature, workspace, olGeometry);\n      }\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport {\n  HttpClient,\n  HttpErrorResponse,\n  HttpHeaders\n} from '@angular/common/http';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport {\n  ActionStore,\n  EntityStoreFilterSelectionStrategy,\n  EntityTableColumnRenderer,\n  EntityTableTemplate,\n  EntityTableButton\n} from '@igo2/common';\nimport { ConfigService, MessageService, StorageService } from '@igo2/core';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { catchError, map, skipWhile, take } from 'rxjs/operators';\nimport {\n  RelationOptions,\n  SourceFieldsOptionsParams,\n  WMSDataSource\n} from '../../datasource';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy\n} from '../../feature';\n\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport {\n  ImageLayer,\n  LayerService,\n  LayersLinkProperties,\n  LinkedProperties,\n  VectorLayer\n} from '../../layer/shared';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { MapBase, IgoMap } from '../../map/shared';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { EditionWorkspace } from './edition-workspace';\n\nimport WKT from 'ol/format/WKT';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport olFeature from 'ol/Feature';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { BehaviorSubject, Observable, throwError } from 'rxjs';\nimport { createFilterInMapExtentOrResolutionStrategy } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EditionWorkspaceService {\n  public ws$ = new BehaviorSubject<string>(undefined);\n  public adding$ = new BehaviorSubject<boolean>(false);\n  public relationLayers$ = new BehaviorSubject<ImageLayer[] | VectorLayer[]>(\n    undefined\n  );\n  public rowsInMapExtentCheckCondition$ = new BehaviorSubject<boolean>(true);\n  public loading = false;\n  public wktFormat = new WKT();\n  public geoJsonFormat = new GeoJSON();\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    private layerService: LayerService,\n    private storageService: StorageService,\n    private configService: ConfigService,\n    private messageService: MessageService,\n    private http: HttpClient,\n    private dialog: MatDialog,\n    private styleService: StyleService,\n    public authInterceptor?: AuthInterceptor\n  ) {}\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): EditionWorkspace {\n    if (\n      layer.options.workspace?.enabled !== true ||\n      layer.dataSource.options.edition.enabled !== true\n    ) {\n      return;\n    }\n    let wksConfig;\n    if (layer.options.workspace) {\n      wksConfig = layer.options.workspace;\n    } else {\n      wksConfig = {};\n    }\n    wksConfig.srcId = layer.id;\n    wksConfig.workspaceId = layer.id;\n    wksConfig.enabled = true;\n    wksConfig.pageSize = layer.options.workspace?.pageSize;\n    wksConfig.pageSizeOptions = layer.options.workspace?.pageSizeOptions;\n\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [LinkedProperties.ZINDEX, LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n      linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if (\n      (dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled\n    ) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(\n        JSON.stringify(layer.options.linkedLayers.links)\n      );\n    }\n    clonedLinks.push(linkProperties);\n\n    (layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId\n      ? layer.options.linkedLayers.linkId\n      : wmsLinkId),\n      (layer.options.linkedLayers.links = clonedLinks);\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n    let wks;\n    this.layerService\n      .createAsyncLayer({\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: {\n          srcId: layer.id,\n          workspaceId: undefined,\n          enabled: false,\n          queryOptions: {\n            mapQueryOnOpenTab:\n              layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n            tabQuery: false\n          },\n          pageSize: layer.options.workspace?.pageSize,\n          pageSizeOptions: layer.options.workspace?.pageSizeOptions\n        },\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution:\n          layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution:\n          layer.options.workspace?.maxResolution ||\n          layer.maxResolution ||\n          Infinity,\n        style: this.styleService.createStyle({\n          fill: {\n            color: 'rgba(255, 255, 255, 0.01)'\n          },\n          stroke: {\n            color: 'rgba(255, 255, 255, 0.01)'\n          },\n          circle: {\n            fill: {\n              color: 'rgba(255, 255, 255, 0.01)'\n            },\n            stroke: {\n              color: 'rgba(255, 255, 255, 0.01)'\n            },\n            radius: 5\n          }\n        }),\n        sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          relations: dataSource.options.relations,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions)\n            .queryTitle,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters, {\n            enabled: hasOgcFilters\n          }),\n          sourceFields: dataSource.options.sourceFields || undefined,\n          edition: dataSource.options.edition\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties(\n          {\n            linkedLayers: {\n              linkId: layer.options.linkedLayers.linkId,\n              links: clonedLinks\n            }\n          },\n          false\n        );\n        workspaceLayer.dataSource.ol.refresh();\n\n        wks = new EditionWorkspace(\n          this.dialog,\n          this.configService,\n          this.adding$,\n          this.deleteFeature,\n          this.getDomainValues,\n          {\n            id: layer.id,\n            title: layer.title,\n            layer: workspaceLayer,\n            map,\n            entityStore: this.createFeatureStore(workspaceLayer, map),\n            actionStore: new ActionStore([]),\n            meta: {\n              tableTemplate: undefined\n            }\n          }\n        );\n        this.createTableTemplate(wks, workspaceLayer);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace, {\n          wksConfig\n        } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(\n    workspace: EditionWorkspace,\n    layer: VectorLayer\n  ): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    let rendererType = EntityTableColumnRenderer.UnsanitizedHTML;\n    let buttons = [];\n    let columns = [];\n    let relationsColumn = [];\n\n    buttons = [\n      {\n        name: 'edition',\n        title: undefined,\n        renderer: EntityTableColumnRenderer.ButtonGroup,\n        primary: false,\n        valueAccessor: () => {\n          return [\n            {\n              editMode: false,\n              icon: 'pencil',\n              color: 'primary',\n              disabled:\n                layer.dataSource.options.edition.modifyButton === false\n                  ? true\n                  : false,\n              click: (feature) => {\n                workspace.editFeature(feature, workspace);\n              }\n            },\n            {\n              editMode: false,\n              icon: 'delete',\n              color: 'warn',\n              disabled:\n                layer.dataSource.options.edition.deleteButton === false\n                  ? true\n                  : false,\n              click: (feature) => {\n                workspace.deleteFeature(feature, workspace);\n              }\n            },\n            {\n              editMode: true,\n              icon: 'check',\n              color: 'primary',\n              disabled: this.loading,\n              click: (feature) => {\n                this.saveFeature(feature, workspace);\n              }\n            },\n            {\n              editMode: true,\n              icon: 'alpha-x',\n              color: 'primary',\n              disabled: this.loading,\n              click: (feature) => {\n                this.cancelEdit(workspace, feature);\n              }\n            }\n          ] as EntityTableButton[];\n        }\n      }\n    ];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$\n        .pipe(\n          skipWhile((val) => val.length === 0),\n          take(1)\n        )\n        .subscribe((entities) => {\n          const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n          const columnsFromFeatures = ol\n            .getKeys()\n            .filter(\n              (col) =>\n                !col.startsWith('_') &&\n                col !== 'geometry' &&\n                col !== ol.getGeometryName() &&\n                !col.match(/boundedby/gi)\n            )\n            .map((key) => {\n              return {\n                name: `properties.${key}`,\n                title: key,\n                renderer: rendererType\n              };\n            });\n          workspace.meta.tableTemplate = {\n            selection: false,\n            sort: true,\n            columns: columnsFromFeatures\n          };\n        });\n      return;\n    }\n\n    columns = fields.map((field: SourceFieldsOptionsParams) => {\n      let column = {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: rendererType,\n        valueAccessor: undefined,\n        cellClassFunc: () => {\n          const cellClass = {};\n          if (field.type) {\n            cellClass[`class_${field.type}`] = true;\n            return cellClass;\n          }\n        },\n        primary: field.primary === true ? true : false,\n        visible: field.visible,\n        validation: field.validation,\n        linkColumnForce: field.linkColumnForce,\n        type: field.type,\n        domainValues: undefined,\n        relation: undefined,\n        multiple: field.multiple,\n        step: field.step,\n        tooltip: field.tooltip\n      };\n\n      if (field.type === 'list' || field.type === 'autocomplete') {\n        this.getDomainValues(field.relation).subscribe((result) => {\n          column.domainValues = result;\n          column.relation = field.relation;\n        });\n      }\n      return column;\n    });\n\n    relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n          if (this.adding$.getValue() === false) {\n            this.ws$.next(relation.title);\n          }\n        },\n        cellClassFunc: () => {\n          return { class_icon: true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    columns.push(...buttons);\n\n    workspace.meta.tableTemplate = {\n      selection: false,\n      sort: true,\n      columns\n    };\n  }\n\n  public saveFeature(feature, workspace: EditionWorkspace) {\n    if (!this.validateFeature(feature, workspace)) {\n      return false;\n    }\n\n    this.sanitizeParameter(feature, workspace);\n\n    const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\n    let url = this.configService.getConfig('edition.url');\n\n    if (!url) {\n      url = baseUrl;\n    } else {\n      url += baseUrl ? baseUrl : '';\n    }\n\n    if (feature.newFeature) {\n      url += workspace.layer.dataSource.options.edition.addUrl;\n\n      const addHeaders = workspace.layer.dataSource.options.edition.addHeaders;\n      const headers = new HttpHeaders(addHeaders);\n\n      this.addFeature(feature, workspace, url, headers);\n    } else {\n      if (\n        workspace.layer.dataSource.options.edition.modifyProtocol !== 'post'\n      ) {\n        url +=\n          '?' +\n          workspace.layer.dataSource.options.edition.modifyUrl +\n          feature.idkey;\n      } else {\n        url += workspace.layer.dataSource.options.edition.modifyUrl;\n      }\n\n      const protocole =\n        workspace.layer.dataSource.options.edition.modifyProtocol;\n      const modifyHeaders =\n        workspace.layer.dataSource.options.edition.modifyHeaders;\n      const headers = new HttpHeaders(modifyHeaders);\n\n      this.modifyFeature(feature, workspace, url, headers, protocole);\n    }\n  }\n\n  public addFeature(\n    feature,\n    workspace: EditionWorkspace,\n    url: string,\n    headers: { [key: string]: any }\n  ) {\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\n      const projDest =\n        workspace.layer.options.sourceOptions.edition.geomDatabaseProj;\n      feature.properties[\n        workspace.layer.dataSource.options.params.fieldNameGeometry\n      ] =\n        'SRID=' +\n        projDest.replace('EPSG:', '') +\n        ';' +\n        this.wktFormat.writeGeometry(\n          this.geoJsonFormat\n            .readFeature(feature.geometry)\n            .getGeometry()\n            .transform('EPSG:4326', projDest),\n          { dataProjection: projDest }\n        );\n    }\n\n    for (const property in feature.properties) {\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\n        if (\n          (sf.name === property && sf.validation?.readonly) ||\n          (sf.name === property && sf.validation?.send === false)\n        ) {\n          delete feature.properties[property];\n        }\n      }\n    }\n\n    this.loading = true;\n    this.http\n      .post(`${url}`, feature.properties, { headers: headers })\n      .subscribe(\n        () => {\n          this.loading = false;\n          workspace.entityStore.stateView.clear();\n          workspace.deleteDrawings();\n          workspace.entityStore.delete(feature);\n\n          this.messageService.success('igo.geo.workspace.addSuccess');\n\n          this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n          this.adding$.next(false);\n          this.rowsInMapExtentCheckCondition$.next(true);\n        },\n        (error) => {\n          this.loading = false;\n          error.error.caught = true;\n          const messages = workspace.layer.dataSource.options.edition.messages;\n          if (messages) {\n            let text;\n            messages.forEach((message) => {\n              const key = Object.keys(message)[0];\n              if (error.error.message.includes(key)) {\n                text = message[key];\n                this.messageService.error(text);\n              }\n            });\n            if (!text) {\n              this.messageService.error('igo.geo.workspace.addError');\n            }\n          } else {\n            this.messageService.error('igo.geo.workspace.addError');\n          }\n        }\n      );\n  }\n\n  public deleteFeature(workspace: EditionWorkspace, url: string) {\n    this.loading = true;\n    this.http.delete(`${url}`, {}).subscribe(\n      () => {\n        this.loading = false;\n        this.messageService.success('igo.geo.workspace.deleteSuccess');\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n        for (const relation of workspace.layer.options.sourceOptions\n          .relations) {\n          workspace.map.layers.forEach((layer) => {\n            if (layer.title === relation.title) {\n              layer.dataSource.ol.refresh();\n            }\n          });\n        }\n      },\n      (error) => {\n        this.loading = false;\n        error.error.caught = true;\n        const messages = workspace.layer.dataSource.options.edition.messages;\n        if (messages) {\n          let text;\n          messages.forEach((message) => {\n            const key = Object.keys(message)[0];\n            if (error.error.message.includes(key)) {\n              text = message[key];\n              this.messageService.error(text);\n            }\n          });\n          if (!text) {\n            this.messageService.error('igo.geo.workspace.addError');\n          }\n        } else {\n          this.messageService.error('igo.geo.workspace.addError');\n        }\n      }\n    );\n  }\n\n  public modifyFeature(\n    feature,\n    workspace: EditionWorkspace,\n    url: string,\n    headers: { [key: string]: any },\n    protocole = 'patch'\n  ) {\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\n      const projDest =\n        workspace.layer.options.sourceOptions.edition.geomDatabaseProj;\n      // Remove 3e dimension\n      feature.geometry.coordinates = removeZ(feature.geometry.coordinates);\n      feature.properties[\n        workspace.layer.dataSource.options.params.fieldNameGeometry\n      ] =\n        'SRID=' +\n        projDest.replace('EPSG:', '') +\n        ';' +\n        this.wktFormat.writeGeometry(\n          this.geoJsonFormat\n            .readFeature(feature.geometry)\n            .getGeometry()\n            .transform('EPSG:4326', projDest),\n          { dataProjection: projDest }\n        );\n    }\n\n    for (const property in feature.properties) {\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\n        if (\n          (sf.name === property && sf.validation?.readonly) ||\n          (sf.name === property && sf.validation?.send === false) ||\n          property === 'boundedBy'\n        ) {\n          delete feature.properties[property];\n        }\n      }\n    }\n\n    this.loading = true;\n    this.http[protocole](`${url}`, feature.properties, {\n      headers: headers\n    }).subscribe(\n      () => {\n        this.loading = false;\n        this.cancelEdit(workspace, feature, true);\n\n        this.messageService.success('igo.geo.workspace.modifySuccess');\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n\n        let relationLayers = [];\n        for (const relation of workspace.layer.options.sourceOptions\n          .relations) {\n          workspace.map.layers.forEach((layer) => {\n            if (layer.title === relation.title) {\n              relationLayers.push(layer);\n              layer.dataSource.ol.refresh();\n            }\n          });\n        }\n        this.relationLayers$.next(relationLayers);\n      },\n      (error) => {\n        this.loading = false;\n        error.error.caught = true;\n        const messages = workspace.layer.dataSource.options.edition.messages;\n        if (messages) {\n          let text;\n          messages.forEach((message) => {\n            const key = Object.keys(message)[0];\n            if (error.error.message.includes(key)) {\n              text = message[key];\n              this.messageService.error(text);\n            }\n          });\n          if (!text) {\n            this.messageService.error('igo.geo.workspace.addError');\n          }\n        } else {\n          this.messageService.error('igo.geo.workspace.addError');\n        }\n      }\n    );\n  }\n\n  cancelEdit(workspace: EditionWorkspace, feature, fromSave = false) {\n    feature.edition = false;\n    this.adding$.next(false);\n    workspace.deleteDrawings();\n    workspace.entityStore.stateView.clear();\n\n    if (feature.newFeature) {\n      workspace.entityStore.delete(feature);\n      workspace.deactivateDrawControl();\n\n      this.rowsInMapExtentCheckCondition$.next(true);\n    } else {\n      if (!fromSave) {\n        feature.properties = feature.original_properties;\n        feature.geometry = feature.original_geometry;\n      }\n      delete feature.original_properties;\n      delete feature.original_geometry;\n    }\n  }\n\n  getDomainValues(relation: RelationOptions): Observable<any> {\n    let url = relation.url;\n    if (!url) {\n      url = this.configService.getConfig('edition.url')\n        ? this.configService.getConfig('edition.url') + relation.table\n        : relation.table;\n    }\n\n    return this.http.get<any>(url).pipe(\n      map((result) => {\n        return result;\n      }),\n      catchError((err: HttpErrorResponse) => {\n        err.error.caught = true;\n        return throwError(err);\n      })\n    );\n  }\n\n  /*\n   * Refresh both wms and wfs layer\n   * A new wfs loader is used to ensure cache is not retrieving old data\n   * WMS params are updated to ensure layer is correctly refreshed\n   */\n  refreshMap(layer: VectorLayer, map: MapBase) {\n    const wfsOlLayer = layer.dataSource.ol;\n    const loader = (extent, resolution, proj, success, failure) => {\n      layer.customWFSLoader(\n        layer.ol.getSource(),\n        layer.options.sourceOptions,\n        this.authInterceptor,\n        extent,\n        resolution,\n        proj,\n        success,\n        failure,\n        true\n      );\n    };\n    wfsOlLayer.setLoader(loader);\n    wfsOlLayer.refresh();\n\n    for (const lay of map.layers) {\n      if (\n        lay.id !== layer.id &&\n        lay.options.linkedLayers?.linkId.includes(\n          layer.id.substr(0, layer.id.indexOf('.') - 1)\n        ) &&\n        lay.options.linkedLayers?.linkId.includes('WmsWorkspaceTableSrc')\n      ) {\n        const wmsOlLayer = lay.dataSource.ol as olSourceImageWMS;\n        let params = wmsOlLayer.getParams();\n        params._t = new Date().getTime();\n        wmsOlLayer.updateParams(params);\n      }\n    }\n  }\n\n  validateFeature(feature, workspace: EditionWorkspace) {\n    let message;\n    let key;\n    let valid = true;\n    workspace.meta.tableTemplate.columns.forEach((column) => {\n      if (column.hasOwnProperty('validation') && column.validation) {\n        key = getColumnKeyWithoutPropertiesTag(column.name);\n        Object.keys(column.validation).forEach((type) => {\n          switch (type) {\n            case 'mandatory': {\n              if (\n                column.validation[type] &&\n                (!feature.properties.hasOwnProperty(key) ||\n                  !feature.properties[key])\n              ) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.mandatory',\n                  undefined,\n                  undefined,\n                  { column: column.title }\n                );\n              }\n              break;\n            }\n            case 'minValue': {\n              if (\n                feature.properties.hasOwnProperty(key) &&\n                feature.properties[key] &&\n                feature.properties[key] < column.validation[type]\n              ) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.minValue',\n                  undefined,\n                  undefined,\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n              }\n              break;\n            }\n            case 'maxValue': {\n              if (\n                feature.properties.hasOwnProperty(key) &&\n                feature.properties[key] &&\n                feature.properties[key] > column.validation[type]\n              ) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.maxValue',\n                  undefined,\n                  undefined,\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n              }\n              break;\n            }\n            case 'minLength': {\n              if (\n                feature.properties.hasOwnProperty(key) &&\n                feature.properties[key] &&\n                feature.properties[key].length < column.validation[type]\n              ) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.minLength',\n                  undefined,\n                  undefined,\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n              }\n              break;\n            }\n            case 'maxLength': {\n              if (\n                feature.properties.hasOwnProperty(key) &&\n                feature.properties[key] &&\n                feature.properties[key].length > column.validation[type]\n              ) {\n                valid = false;\n                this.messageService.error(\n                  'igo.geo.formValidation.maxLength',\n                  undefined,\n                  undefined,\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n              }\n              break;\n            }\n          }\n        });\n      }\n    });\n    return valid;\n  }\n\n  sanitizeParameter(feature, workspace: EditionWorkspace) {\n    workspace.meta.tableTemplate.columns.forEach((column) => {\n      if (\n        column.type === 'list' &&\n        feature.properties[getColumnKeyWithoutPropertiesTag(column.name)]\n      ) {\n        feature.properties[getColumnKeyWithoutPropertiesTag(column.name)] =\n          feature.properties[\n            getColumnKeyWithoutPropertiesTag(column.name)\n          ].toString();\n      }\n    });\n  }\n}\n\nfunction getColumnKeyWithoutPropertiesTag(column: string) {\n  if (column.includes('properties.')) {\n    return column.split('.')[1];\n  }\n  return column;\n}\n\nfunction removeZ(coords: any) {\n  if (coords.length === 0) return coords;\n  if (typeof coords[0] === 'number') return coords.slice(0, 2);\n  return coords.map(removeZ);\n}\n","import { Injectable } from '@angular/core';\nimport { ActionStore, EntityStoreFilterSelectionStrategy } from '@igo2/common';\nimport { StorageService, ConfigService } from '@igo2/core';\nimport { CapabilitiesService, WMSDataSource } from '../../datasource';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  GeoPropertiesStrategy\n} from '../../feature';\n\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport {\n  ImageLayer,\n  LayerService,\n  LayersLinkProperties,\n  LinkedProperties,\n  VectorLayer\n} from '../../layer/shared';\nimport { StyleService } from '../../style/style-service/style.service';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map/shared';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { WfsWorkspace } from './wfs-workspace';\nimport { getCommonVectorSelectedStyle } from '../../style/shared/vector/commonVectorStyle';\n\nimport { PropertyTypeDetectorService } from '../../utils/propertyTypeDetector/propertyTypeDetector.service';\nimport { BehaviorSubject } from 'rxjs/internal/BehaviorSubject';\nimport {\n  createFilterInMapExtentOrResolutionStrategy,\n  createTableTemplate\n} from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WmsWorkspaceService {\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(\n    private layerService: LayerService,\n    private storageService: StorageService,\n    private capabilitiesService: CapabilitiesService,\n    private styleService: StyleService,\n    private configService: ConfigService,\n    private propertyTypeDetectorService: PropertyTypeDetectorService\n  ) {}\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): WfsWorkspace {\n    if (\n      !layer.options.workspace ||\n      map.layers.find(\n        (lay) => lay.id === layer.id + '.WfsWorkspaceTableDest'\n      ) ||\n      layer.dataSource.options.edition\n    ) {\n      return;\n    }\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [LinkedProperties.ZINDEX, LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n      linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if (\n      (dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled\n    ) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(\n        JSON.stringify(layer.options.linkedLayers.links)\n      );\n    }\n    clonedLinks.push(linkProperties);\n\n    (layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId\n      ? layer.options.linkedLayers.linkId\n      : wmsLinkId),\n      (layer.options.linkedLayers.links = clonedLinks);\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    let wks;\n    let wksLayerOption: GeoWorkspaceOptions = {\n      printable: layer.options.workspace?.printable,\n      srcId: layer.id,\n      workspaceId: undefined,\n      enabled: false,\n      queryOptions: {\n        mapQueryOnOpenTab:\n          layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n        tabQuery: layer.options.workspace?.queryOptions?.tabQuery\n      },\n      pageSize: layer.options.workspace?.pageSize,\n      pageSizeOptions: layer.options.workspace?.pageSizeOptions\n    };\n\n    this.layerService\n      .createAsyncLayer({\n        isIgoInternalLayer: true,\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: wksLayerOption,\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution:\n          layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution:\n          layer.options.workspace?.maxResolution ||\n          layer.maxResolution ||\n          Infinity,\n        style: this.styleService.createStyle({\n          fill: {\n            color: 'rgba(255, 255, 255, 0.01)'\n          },\n          stroke: {\n            color: 'rgba(255, 255, 255, 0.01)'\n          },\n          circle: {\n            fill: {\n              color: 'rgba(255, 255, 255, 0.01)'\n            },\n            stroke: {\n              color: 'rgba(255, 255, 255, 0.01)'\n            },\n            radius: 5\n          }\n        }),\n        sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          relations: dataSource.options.relations,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions)\n            .queryTitle,\n          queryFormatAsWms: layer.options.workspace?.enabled\n            ? (dataSource.options as QueryableDataSourceOptions)\n                .queryFormatAsWms\n            : true,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters, {\n            enabled: hasOgcFilters\n          }),\n          sourceFields: dataSource.options.sourceFields || undefined\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties(\n          {\n            linkedLayers: {\n              linkId: layer.options.linkedLayers.linkId,\n              links: clonedLinks\n            }\n          },\n          false\n        );\n        workspaceLayer.dataSource.ol.refresh();\n\n        if (!layer.options.workspace?.enabled) {\n          return;\n        }\n        wks = new WfsWorkspace({\n          id: layer.id,\n          title: layer.title,\n          layer: workspaceLayer,\n          map,\n          entityStore: this.createFeatureStore(workspaceLayer, map),\n          actionStore: new ActionStore([]),\n          meta: {\n            tableTemplate: undefined\n          }\n        });\n        createTableTemplate(wks, workspaceLayer, this.layerService, this.ws$);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace, {\n          enabled: true,\n          srcId: layer.id,\n          workspaceId: workspaceLayer.id,\n          queryOptions: {\n            mapQueryOnOpenTab:\n              layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n            tabQuery: layer.options.workspace?.queryOptions?.tabQuery\n          },\n          pageSize: layer.options.workspace?.pageSize,\n          pageSizeOptions: layer.options.workspace?.pageSizeOptions\n        } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const geoPropertiesStrategy = new GeoPropertiesStrategy(\n      { map },\n      this.propertyTypeDetectorService,\n      this.capabilitiesService\n    );\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle =\n      this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(\n            Object.assign(\n              {},\n              { feature },\n              confQueryOverlayStyle?.selection || {}\n            )\n          );\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(geoPropertiesStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n}\n","import {\n  Directive,\n  Input,\n  OnInit,\n  OnDestroy,\n  Output,\n  EventEmitter\n} from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport {\n  Workspace,\n  WorkspaceStore,\n  WorkspaceSelectorComponent\n} from '@igo2/common';\n\nimport { Layer, ImageLayer, VectorLayer } from '../../layer/shared';\nimport { IgoMap } from '../../map/shared';\nimport {\n  WFSDataSource,\n  WMSDataSource,\n  FeatureDataSource\n} from '../../datasource';\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared';\n\nimport { WfsWorkspaceService } from '../shared/wfs-workspace.service';\nimport { WmsWorkspaceService } from '../shared/wms-workspace.service';\nimport { EditionWorkspaceService } from '../shared/edition-workspace.service';\nimport { FeatureWorkspaceService } from '../shared/feature-workspace.service';\nimport { FeatureStoreInMapExtentStrategy } from '../../feature/shared/strategies/in-map-extent';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\n\n@Directive({\n  selector: '[igoWorkspaceSelector]'\n})\nexport class WorkspaceSelectorDirective implements OnInit, OnDestroy {\n  private layers$$: Subscription;\n  private entities$$: Subscription[] = [];\n\n  @Input() map: IgoMap;\n\n  @Output() changeWorkspace = new EventEmitter<string>();\n  @Output() disableSwitch = new EventEmitter<boolean>();\n  @Output() relationLayers = new EventEmitter<ImageLayer[] | VectorLayer[]>();\n  @Output() rowsInMapExtentCheckCondition = new EventEmitter<boolean>();\n\n  get workspaceStore(): WorkspaceStore {\n    return this.component.store;\n  }\n\n  constructor(\n    private component: WorkspaceSelectorComponent,\n    private wfsWorkspaceService: WfsWorkspaceService,\n    private wmsWorkspaceService: WmsWorkspaceService,\n    private editionWorkspaceService: EditionWorkspaceService,\n    private featureWorkspaceService: FeatureWorkspaceService\n  ) {}\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$\n      .pipe(debounceTime(50))\n      .subscribe((layers: Layer[]) => this.onLayersChange(layers));\n\n    this.featureWorkspaceService.ws$.subscribe((ws) => {\n      this.changeWorkspace.emit(ws);\n    });\n    this.wmsWorkspaceService.ws$.subscribe((ws) => {\n      this.changeWorkspace.emit(ws);\n    });\n    this.wfsWorkspaceService.ws$.subscribe((ws) => {\n      this.changeWorkspace.emit(ws);\n    });\n    this.editionWorkspaceService.ws$.subscribe((ws) => {\n      this.changeWorkspace.emit(ws);\n    });\n    this.editionWorkspaceService.adding$.subscribe((adding) => {\n      this.disableSwitch.emit(adding);\n    });\n    this.editionWorkspaceService.relationLayers$.subscribe((layers) => {\n      this.relationLayers.emit(layers);\n    });\n    this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe(\n      (condition) => {\n        this.rowsInMapExtentCheckCondition.emit(condition);\n      }\n    );\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.entities$$.map((entities) => entities.unsubscribe());\n  }\n\n  private onLayersChange(layers: Layer[]) {\n    const editableLayers = layers.filter((layer: Layer) =>\n      this.layerIsEditable(layer)\n    );\n    const editableLayersIds = editableLayers.map((layer: Layer) => layer.id);\n\n    const workspacesToAdd = editableLayers\n      .map((layer: VectorLayer) => this.getOrCreateWorkspace(layer))\n      .filter((workspace: Workspace | undefined) => workspace !== undefined);\n\n    const workspacesToRemove = this.workspaceStore\n      .all()\n      .filter((workspace: Workspace) => {\n        return editableLayersIds.indexOf(workspace.id) < 0;\n      });\n\n    if (workspacesToRemove.length > 0) {\n      workspacesToRemove.forEach((workspace: Workspace) => {\n        workspace.entityStore.deactivateStrategyOfType(\n          FeatureStoreInMapExtentStrategy\n        );\n        workspace.deactivate();\n      });\n      this.workspaceStore.state.updateMany(workspacesToRemove, {\n        active: false,\n        selected: false\n      });\n      this.workspaceStore.deleteMany(workspacesToRemove);\n    }\n\n    if (workspacesToAdd.length > 0) {\n      this.workspaceStore.insertMany(workspacesToAdd);\n    }\n  }\n\n  private getOrCreateWorkspace(\n    layer: VectorLayer | ImageLayer\n  ): Workspace | undefined {\n    const workspace = this.workspaceStore.get(layer.id);\n    if (workspace !== undefined) {\n      return;\n    }\n    if (\n      layer.dataSource instanceof WFSDataSource &&\n      layer.dataSource.options.edition?.enabled !== true\n    ) {\n      const wfsWks = this.wfsWorkspaceService.createWorkspace(\n        layer as VectorLayer,\n        this.map\n      );\n      return wfsWks;\n    } else if (\n      layer.dataSource instanceof WMSDataSource &&\n      layer.dataSource.options.edition?.enabled !== true\n    ) {\n      if (!layer.dataSource.options.paramsWFS) {\n        return;\n      }\n      const wmsWks = this.wmsWorkspaceService.createWorkspace(\n        layer as ImageLayer,\n        this.map\n      );\n      wmsWks?.inResolutionRange$.subscribe((inResolutionRange) => {\n        (layer.dataSource.options as QueryableDataSourceOptions).queryable =\n          !inResolutionRange;\n        (\n          wmsWks.layer.dataSource.options as QueryableDataSourceOptions\n        ).queryable = inResolutionRange;\n      });\n      return wmsWks;\n    } else if (\n      layer.dataSource instanceof FeatureDataSource &&\n      (layer as VectorLayer).exportable === true &&\n      layer.dataSource.options.edition?.enabled !== true\n    ) {\n      const featureWks = this.featureWorkspaceService.createWorkspace(\n        layer as VectorLayer,\n        this.map\n      );\n      return featureWks;\n    } else if (\n      layer.dataSource instanceof WMSDataSource &&\n      layer.dataSource.options.edition?.enabled === true\n    ) {\n      const editionWks = this.editionWorkspaceService.createWorkspace(\n        layer as ImageLayer,\n        this.map\n      );\n      return editionWks;\n    }\n\n    return;\n  }\n\n  private layerIsEditable(layer: Layer): boolean {\n    const dataSource = layer.dataSource;\n    if (dataSource instanceof WFSDataSource) {\n      return true;\n    }\n    if (dataSource instanceof FeatureDataSource) {\n      return true;\n    }\n    if (dataSource instanceof WMSDataSource) {\n      const dataSourceOptions = (dataSource.options ||\n        {}) as OgcFilterableDataSourceOptions;\n      return (\n        dataSourceOptions.ogcFilters?.enabled ||\n        dataSource.options.paramsWFS?.featureTypes !== undefined\n      );\n    }\n\n    return false;\n  }\n}\n","<h2 mat-dialog-title class=\"mat-typography\">\n  {{ 'igo.geo.style.styleModal' | translate }}\n</h2>\n<div mat-dialog-content>\n  <div class=\"edition-drawing mat-typography\">\n    <form class=\"igo-form\" [formGroup]=\"form\">\n      <div\n        class=\"fill-color-picker mat-typography\"\n        *ngIf=\"linestringOnly !== true\"\n      >\n        <span>\n          <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square\"></mat-icon>\n          {{ 'igo.geo.style.fill' | translate }}\n        </span>\n        <igo-color-picker-form-field\n          formControlName=\"fill\"\n          outputFormat=\"rgba\"\n          setAlpha=\".4\"\n          (open)=\"openPicker()\"\n          (close)=\"closePicker()\"\n          [color]=\"getLayerFillColor()\"\n        ></igo-color-picker-form-field>\n      </div>\n\n      <div class=\"stroke-color-picker mat-typography\">\n        <span>\n          <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square-outline\">\n          </mat-icon>\n          {{ 'igo.geo.style.stroke' | translate }}\n        </span>\n        <igo-color-picker-form-field\n          formControlName=\"stroke\"\n          outputFormat=\"rgba\"\n          setAlpha=\"1\"\n          (open)=\"openPicker()\"\n          (close)=\"closePicker()\"\n          [color]=\"getLayerStrokeColor()\"\n        ></igo-color-picker-form-field>\n      </div>\n    </form>\n  </div>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button (click)=\"cancel()\">\n    {{ 'igo.geo.style.cancel' | translate }}\n  </button>\n  <button mat-raised-button color=\"primary\" (click)=\"confirm()\">OK</button>\n</div>\n","import { Component, Inject, Input, OnInit } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { UntypedFormGroup, UntypedFormBuilder } from '@angular/forms';\n\nimport { asArray as ColorAsArray } from 'ol/color';\nimport olStyle from 'ol/style/Style';\nimport {\n  LayerMatDialogData,\n  StyleModalData\n} from '../shared/style-modal.interface';\n\n@Component({\n  selector: 'igo-style-modal-layer',\n  templateUrl: './style-modal-layer.component.html',\n  styleUrls: ['./style-modal-layer.component.scss']\n})\nexport class StyleModalLayerComponent implements OnInit {\n  @Input() confirmFlag: boolean = false;\n\n  public form: UntypedFormGroup;\n\n  public styleModalData: StyleModalData;\n  public linestringOnly: boolean;\n\n  private initialValues: StyleModalData;\n\n  private defaultValues: StyleModalData = {\n    fillColor: 'rgba(255,255,255,0.4)',\n    strokeColor: 'rgba(143,7,7,1)'\n  };\n\n  get layerOlStyle(): olStyle {\n    const style = this.data.layer.ol.getStyle();\n    return style instanceof Function ? undefined : (style as olStyle).clone();\n  }\n\n  constructor(\n    public dialogRef: MatDialogRef<StyleModalLayerComponent>,\n    private formBuilder: UntypedFormBuilder,\n    @Inject(MAT_DIALOG_DATA) public data: LayerMatDialogData\n  ) {\n    this.buildForm();\n  }\n\n  ngOnInit() {\n    this.linestringOnly = true;\n    for (const feature of this.data.layer.ol.getSource().getFeatures()) {\n      if (feature.getGeometry().getType() !== 'LineString') {\n        this.linestringOnly = false;\n      }\n    }\n    this.buildStyleData();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [''],\n      stroke: ['']\n    });\n  }\n\n  private buildStyleData() {\n    this.styleModalData = {\n      fillColor: this.getLayerFillColor(),\n      strokeColor: this.getLayerStrokeColor()\n    };\n    this.initialValues = {\n      fillColor: this.getLayerFillColor(),\n      strokeColor: this.getLayerStrokeColor()\n    };\n  }\n\n  getLayerFillColor() {\n    let fillColor = this.defaultValues.fillColor;\n    const style = this.layerOlStyle;\n    if (style?.getFill()?.getColor()) {\n      const arrayColor = style.getFill().getColor();\n      fillColor = `rgba(${arrayColor[0]},${arrayColor[1]},${arrayColor[2]},${\n        arrayColor[3] || 0.4\n      })`;\n    }\n    return fillColor;\n  }\n\n  getLayerStrokeColor() {\n    let strokeColor = this.defaultValues.strokeColor;\n    const style = this.layerOlStyle;\n    if (style?.getStroke()?.getColor()) {\n      const arrayColor = style.getStroke().getColor();\n      strokeColor = `rgba(${arrayColor[0]},${arrayColor[1]},${arrayColor[2]},${\n        arrayColor[3] || 1\n      })`;\n    }\n    return strokeColor;\n  }\n\n  setLayerFillColor(event) {\n    const cAA = ColorAsArray(event);\n    const s = this.layerOlStyle.clone();\n    (s.getImage() as any).getFill().setColor(cAA);\n    s.getFill().setColor(cAA);\n    this.data.layer.ol.setStyle(s);\n    this.styleModalData.fillColor = event;\n  }\n\n  setLayerStrokeColor(event) {\n    const cAA = ColorAsArray(event);\n    const s = this.layerOlStyle.clone();\n    (s.getImage() as any).getStroke().setColor(cAA);\n    s.getStroke().setColor(cAA);\n    this.data.layer.ol.setStyle(s);\n    this.styleModalData.strokeColor = event;\n  }\n\n  cancel() {\n    this.dialogRef.close();\n    this.setLayerFillColor(this.initialValues.fillColor);\n    this.setLayerStrokeColor(this.initialValues.strokeColor);\n  }\n\n  confirm() {\n    this.confirmFlag = true;\n    if (this.form.get('fill').value) {\n      this.styleModalData.fillColor = this.form.get('fill').value;\n    }\n\n    if (this.form.get('stroke').value) {\n      this.styleModalData.strokeColor = this.form.get('stroke').value;\n    }\n    this.dialogRef.close(this.styleModalData);\n  }\n\n  openPicker() {\n    this.dialogRef.disableClose = true;\n  }\n\n  closePicker() {\n    this.dialogRef.disableClose = false;\n  }\n}\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\n\nimport { StyleModalLayerComponent } from '../layer/style-modal-layer.component';\nimport { LayerMatDialogData } from '../shared/style-modal.interface';\n\n@Component({\n  selector: 'igo-style-modal-layer-button',\n  templateUrl: './style-modal-layer-button.component.html',\n  styleUrls: ['./style-modal-layer-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class StyleModalLayerButtonComponent {\n  @Input() layer: VectorLayer;\n  constructor(private dialog: MatDialog) {}\n\n  /**\n   * Open the style modal dialog box\n   */\n  openStyleModalDialog() {\n    setTimeout(() => {\n      // open the dialog box used to style features\n      const data: LayerMatDialogData = { layer: this.layer };\n      const dialogRef = this.dialog.open(StyleModalLayerComponent, {\n        disableClose: false,\n        data,\n        autoFocus: false\n      });\n    }, 250);\n  }\n}\n","<button\n  mat-icon-button\n  color=\"primary\"\n  (click)=\"openStyleModalDialog()\"\n  [matTooltip]=\"'igo.geo.style.styleModalTooltipLayer' | translate\"\n>\n  <mat-icon class=\"style-icon\" svgIcon=\"palette\"> </mat-icon>\n</button>\n","<div *ngIf=\"infoContent && infoContent.length\" class=\"infoSection\">\n  <pre>{{ infoContent }}</pre>\n</div>\n","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'igo-info-section',\n  templateUrl: './info-section.component.html',\n  styleUrls: ['./info-section.component.scss']\n})\nexport class InfoSectionComponent {\n  @Input() infoContent: string = '';\n\n  constructor() {}\n}\n","<app-doc-viewer\n  title=\"Simple Map\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/simple-map\">\n    <igo-map-browser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoPointerPosition\n      [pointerPositionDelay]=\"pointerCoordDelay\"\n      (pointerPositionCoord)=\"onPointerMove($event)\"\n    >\n      <igo-info-section [infoContent]=\"pointerCoord\"></igo-info-section>\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n      <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n      <igo-home-extent-button\n        [map]=\"map\"\n        color=\"primary\"\n      ></igo-home-extent-button>\n      <igo-rotation-button\n        [map]=\"map\"\n        [showIfNoRotation]=\"true\"\n        color=\"primary\"\n      ></igo-rotation-button>\n      <igo-wake-lock-button></igo-wake-lock-button>\n    </igo-map-browser>\n    <p *ngIf=\"!isTouchScreen\">{{ pointerCoord }}</p>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppSimpleMapComponent } from './simple-map.component';\n\nconst routes: Routes = [\n  {\n    path: 'simple-map',\n    component: AppSimpleMapComponent\n  }\n];\n\nexport const AppSimpleMapRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\n\nimport { LanguageService, MediaService } from '@igo2/core';\nimport { IgoMap, DataSourceService, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-simple-map',\n  templateUrl: './simple-map.component.html',\n  styleUrls: ['./simple-map.component.scss']\n})\nexport class AppSimpleMapComponent {\n  public pointerCoord;\n  public pointerCoordDelay: number = 0;\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6,\n    rotation: 0.75\n  };\n\n  get media() {\n    return this.mediaService.getMedia();\n  }\n\n  get isTouchScreen() {\n    return this.mediaService.isTouchScreen();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mediaService: MediaService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n\n  onPointerMove(event) {\n    this.pointerCoord = event;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule } from '@igo2/geo';\n\nimport { AppSimpleMapComponent } from './simple-map.component';\nimport { AppSimpleMapRoutingModule } from './simple-map-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppSimpleMapComponent],\n  imports: [\n    SharedModule,\n    AppSimpleMapRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMapModule\n  ],\n  exports: [AppSimpleMapComponent]\n})\nexport class AppSimpleMapModule {}\n","<app-doc-viewer\n  title=\"Layer\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/layer\">\n    <mat-grid-list cols=\"2\" rowHeight=\"600px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100\">\n          <igo-panel title=\"Layers\" class=\"w-100\">\n            <igo-layer-list\n              [map]=\"map\"\n              [layers]=\"map.layers\"\n              [expandLegendOfVisibleLayers]=\"false\"\n              floatLabel=\"never\"\n              [queryBadge]=\"true\"\n            >\n              <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n                <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n                <igo-download-button [layer]=\"layer\"></igo-download-button>\n                <igo-ogc-filter-button\n                  [header]=\"true\"\n                  [layer]=\"layer\"\n                ></igo-ogc-filter-button>\n                <igo-time-filter-button\n                  [header]=\"true\"\n                  [layer]=\"layer\"\n                ></igo-time-filter-button>\n                <igo-track-feature-button\n                  [layer]=\"layer\"\n                  [trackFeature]=\"true\"\n                ></igo-track-feature-button>\n              </ng-template>\n            </igo-layer-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppLayerComponent } from './layer.component';\n\nconst routes: Routes = [\n  {\n    path: 'layer',\n    component: AppLayerComponent\n  }\n];\n\nexport const AppLayerRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WMSDataSourceOptions,\n  LayerOptions,\n  WFSDataSourceOptions,\n  OgcFilterableDataSourceOptions,\n  MetadataLayerOptions\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-layer',\n  templateUrl: './layer.component.html',\n  styleUrls: ['./layer.component.scss']\n})\nexport class AppLayerComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    maxLayerZoomExtent: [-11000000, 4500000, -4500000, 10000000],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            visible: true,\n            baseLayer: true,\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const wfsDatasource: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '10043'\n        }\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasource)\n      .subscribe((dataSource) => {\n        const layer: LayerOptions = {\n          title: 'WFS ',\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    const wfsDatasourceCustomEPSG: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: 'geojson_utf8',\n        srsName: 'EPSG:32198',\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '12072'\n        }\n      },\n      formatOptions: {\n        dataProjection: 'EPSG:32198'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourceCustomEPSG)\n      .subscribe((dataSource) => {\n        const layer: LayerOptions = {\n          title: 'WFS (Custom EPSG)',\n          visible: true,\n          source: dataSource,\n          removable: false\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'parc_routier',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Réseau routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'lieu habité',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'lieuhabite',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'sh_dis_eco',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'sh_dis_eco',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'nurc:Arc_Sample_Parent',\n        visible: false,\n        legendOptions: {\n          // collapsed: false,\n          display: true,\n          // url: 'https://v.seloger.com/s/width/1144/visuels/0/m/l/4/0ml42xbt1n3itaboek3qec5dtskdgw6nlscu7j69k.jpg',\n          stylesAvailable: [\n            { name: 'rain', title: 'Pluie' },\n            { name: 'raster', title: 'Défaut' }\n          ] //\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://demo.geo-solutions.it/geoserver/ows',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'nurc:Arc_Sample', // , test:Linea_costa\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Avertissements routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'evenements',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    const datasource: WMSDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      refreshIntervalSec: 15,\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      }\n    };\n\n    interface LayerOptionsWithMetadata\n      extends LayerOptions,\n        MetadataLayerOptions {}\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe((dataSource) => {\n        const layer: LayerOptionsWithMetadata = {\n          title: 'Embâcle',\n          source: dataSource,\n          metadata: {\n            url: 'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\n            extern: true\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoFilterModule,\n  IgoMetadataModule,\n  IgoDownloadModule\n} from '@igo2/geo';\n\nimport { AppLayerComponent } from './layer.component';\nimport { AppLayerRoutingModule } from './layer-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppLayerComponent],\n  imports: [\n    SharedModule,\n    AppLayerRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoFilterModule,\n    IgoMetadataModule,\n    IgoDownloadModule\n  ],\n  exports: [AppLayerComponent]\n})\nexport class AppLayerModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppLegendComponent } from './legend.component';\n\nconst routes: Routes = [\n  {\n    path: 'legend',\n    component: AppLegendComponent\n  }\n];\n\nexport const AppLegendRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WMSDataSourceOptions,\n  LayerOptions,\n  WFSDataSourceOptions,\n  OgcFilterableDataSourceOptions,\n  MetadataLayerOptions\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-legend',\n  templateUrl: './legend.component.html',\n  styleUrls: ['./legend.component.scss']\n})\nexport class AppLegendComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            visible: true,\n            baseLayer: true,\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const wfsDatasource: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '10043'\n        }\n      }\n    };\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'legend with display:false',\n        visible: true,\n        legendOptions: {\n          display: false,\n          html: 'test html'\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'sh_dis_eco',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'legend in html',\n        visible: true,\n        legendOptions: {\n          display: true,\n          html: '<h2 style=\"background-color: blue;\">HTML légende</h2>'\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n          optionsFromCapabilities: false,\n          params: {\n            LAYERS: 'sh_sreg_eco',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'legend with url param',\n        visible: true,\n        legendOptions: {\n          url: `data:image/jpeg;base64,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`\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'sh_reg_eco',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasource)\n      .subscribe((dataSource) => {\n        const layer: LayerOptions = {\n          title: 'WFS ',\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Commission scolaire anglophone',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\n          params: {\n            LAYERS: 'WMS_MEQ_CS_ANGLO',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Réseau routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'lieu habité',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'lieuhabite',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Avertissements routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'evenements',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    const datasource: WMSDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      refreshIntervalSec: 15,\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      }\n    };\n\n    interface LayerOptionsWithMetadata\n      extends LayerOptions,\n        MetadataLayerOptions {}\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe((dataSource) => {\n        const layer: LayerOptionsWithMetadata = {\n          title: 'Embâcle',\n          visible: true,\n          source: dataSource,\n          metadata: {\n            url: 'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\n            extern: true\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Simple Map with a legend list\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/legend\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n\n    <igo-panel title=\"Legends\">\n      <igo-layer-legend-list\n        [layers]=\"map.layers\"\n        [excludeBaseLayers]=\"true\"\n        [allowShowAllLegends]=\"true\"\n        [updateLegendOnResolutionChange]=\"false\"\n        [showAllLegendsValue]=\"false\"\n      >\n      </igo-layer-legend-list>\n    </igo-panel>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoFilterModule,\n  IgoMetadataModule,\n  IgoDownloadModule\n} from '@igo2/geo';\n\nimport { AppLegendComponent } from './legend.component';\nimport { AppLegendRoutingModule } from './legend-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppLegendComponent],\n  imports: [\n    SharedModule,\n    AppLegendRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoFilterModule,\n    IgoMetadataModule,\n    IgoDownloadModule\n  ],\n  exports: [AppLegendComponent]\n})\nexport class AppLegendModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppOverlayComponent } from './overlay.component';\n\nconst routes: Routes = [\n  {\n    path: 'overlay',\n    component: AppOverlayComponent\n  }\n];\n\nexport const AppOverlayRoutingModule = RouterModule.forChild(routes);\n","import { Component, OnInit, AfterViewInit } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  FEATURE,\n  Feature,\n  FeatureMotion\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-overlay',\n  templateUrl: './overlay.component.html',\n  styleUrls: ['./overlay.component.scss']\n})\nexport class AppOverlayComponent implements OnInit, AfterViewInit {\n  public map = new IgoMap({\n    overlay: true,\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit() {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n\n  ngAfterViewInit() {\n    const feature1: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 1\n      },\n      properties: {},\n      geometry: {\n        type: 'Point',\n        coordinates: [-73, 46.6]\n      }\n    };\n\n    const feature2: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 2\n      },\n      properties: {},\n      geometry: {\n        type: 'LineString',\n        coordinates: [\n          [-72, 47.8],\n          [-73.5, 47.4],\n          [-72.4, 48.6]\n        ]\n      }\n    };\n\n    const feature3: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 3\n      },\n      properties: {},\n      geometry: {\n        type: 'Polygon',\n        coordinates: [\n          [\n            [-71, 46.8],\n            [-73, 47],\n            [-71.2, 46.6]\n          ]\n        ]\n      }\n    };\n\n    this.map.overlay.setFeatures(\n      [feature1, feature2, feature3],\n      FeatureMotion.None\n    );\n  }\n}\n","<app-doc-viewer title=\"Overlay\" subtitle=\"Geo\">\n  <app-example-viewer codeFolder=\"geo/overlay\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoMapModule, IgoOverlayModule } from '@igo2/geo';\n\nimport { AppOverlayComponent } from './overlay.component';\nimport { AppOverlayRoutingModule } from './overlay-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppOverlayComponent],\n  imports: [\n    SharedModule,\n    AppOverlayRoutingModule,\n    IgoMapModule,\n    IgoOverlayModule\n  ],\n  exports: [AppOverlayComponent]\n})\nexport class AppOverlayModule {}\n","<app-doc-viewer title=\"Geometry Form\" subtitle=\"Geo\">\n  <app-example-viewer codeFolder=\"geo/geometry\">\n    <div class=\"container\">\n      <igo-map-browser [map]=\"map\" [view]=\"view\">\n        <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n      </igo-map-browser>\n\n      <igo-form\n        *ngIf=\"form$ | async as form\"\n        [form]=\"form\"\n        [formData]=\"data$ | async\"\n        (submitForm)=\"onSubmit($event)\"\n      >\n        <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n        <div formButtons class=\"actions-container\">\n          <button\n            mat-stroked-button\n            type=\"button\"\n            color=\"primary\"\n            (click)=\"fillForm()\"\n          >\n            Fill Form\n          </button>\n          <button\n            mat-stroked-button\n            type=\"button\"\n            color=\"primary\"\n            (click)=\"clearForm()\"\n          >\n            Clear Form\n          </button>\n          <button\n            mat-flat-button\n            type=\"submit\"\n            color=\"primary\"\n            [disabled]=\"submitDisabled\"\n          >\n            Submit\n          </button>\n        </div>\n      </igo-form>\n    </div>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppGeometryComponent } from './geometry.component';\n\nconst routes: Routes = [\n  {\n    path: 'geometry',\n    component: AppGeometryComponent\n  }\n];\n\nexport const AppGeometryRoutingModule = RouterModule.forChild(routes);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport * as olstyle from 'ol/style';\n\nimport { LanguageService } from '@igo2/core';\nimport { Form, FormService } from '@igo2/common';\nimport { IgoMap, DataSourceService, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-geometry',\n  templateUrl: './geometry.component.html',\n  styleUrls: ['./geometry.component.scss']\n})\nexport class AppGeometryComponent implements OnInit, OnDestroy {\n  map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  view = {\n    center: [-73, 47.2],\n    zoom: 15\n  };\n\n  form$ = new BehaviorSubject<Form>(undefined);\n\n  data$ = new BehaviorSubject<{ [key: string]: any }>(undefined);\n\n  submitDisabled = true;\n\n  private valueChanges$$: Subscription;\n\n  constructor(\n    private languageService: LanguageService,\n    private formService: FormService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit() {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    const fieldConfigs = [\n      {\n        name: 'geometry',\n        title: 'Geometry',\n        options: {\n          validator: Validators.required\n        },\n        type: 'geometry',\n        inputs: {\n          map: this.map,\n          geometryTypeField: true,\n          geometryType: 'Polygon',\n          drawGuideField: true,\n          drawGuide: 50,\n          drawGuidePlaceholder: 'Draw Guide',\n          drawStyle: new olstyle.Style({\n            stroke: new olstyle.Stroke({\n              color: [255, 0, 0, 1],\n              width: 2\n            }),\n            fill: new olstyle.Fill({\n              color: [255, 0, 0, 0.2]\n            }),\n            image: new olstyle.Circle({\n              radius: 8,\n              stroke: new olstyle.Stroke({\n                color: [255, 0, 0, 1]\n              }),\n              fill: new olstyle.Fill({\n                color: [255, 0, 0, 0.2]\n              })\n            })\n          })\n        }\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        options: {\n          validator: Validators.required\n        }\n      }\n    ];\n\n    const fields = fieldConfigs.map((config) => this.formService.field(config));\n    const form = this.formService.form(\n      [],\n      [this.formService.group({ name: 'info' }, fields)]\n    );\n\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\n      this.submitDisabled = !form.control.valid;\n    });\n\n    this.form$.next(form);\n  }\n\n  ngOnDestroy() {\n    this.valueChanges$$.unsubscribe();\n  }\n\n  fillForm() {\n    this.data$.next({\n      name: 'Place',\n      geometry: JSON.stringify({\n        type: 'Polygon',\n        coordinates: [\n          [\n            [-106, 42],\n            [-107, 31],\n            [-81, 32],\n            [-82, 42],\n            [-106, 42]\n          ]\n        ]\n      })\n    });\n  }\n\n  clearForm() {\n    this.form$.value.control.reset();\n  }\n\n  onSubmit(data: { [key: string]: any }) {\n    alert(JSON.stringify(data));\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { IgoFormModule } from '@igo2/common';\nimport { IgoGeometryModule, IgoMapModule } from '@igo2/geo';\n\nimport { AppGeometryComponent } from './geometry.component';\nimport { AppGeometryRoutingModule } from './geometry-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppGeometryComponent],\n  imports: [\n    SharedModule,\n    AppGeometryRoutingModule,\n    IgoFormModule,\n    IgoGeometryModule,\n    IgoMapModule\n  ],\n  exports: [AppGeometryComponent]\n})\nexport class AppGeometryModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppFeatureComponent } from './feature.component';\n\nconst routes: Routes = [\n  {\n    path: 'feature',\n    component: AppFeatureComponent\n  }\n];\n\nexport const AppFeatureRoutingModule = RouterModule.forChild(routes);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  VectorLayer,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureMotion\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-feature',\n  templateUrl: './feature.component.html',\n  styleUrls: ['./feature.component.scss']\n})\nexport class AppFeatureComponent implements OnInit, OnDestroy {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  public tableTemplate = {\n    selection: true,\n    selectMany: true,\n    sort: true,\n    columns: [\n      {\n        name: 'properties.id',\n        title: 'ID'\n      },\n      {\n        name: 'properties.name',\n        title: 'Name'\n      },\n      {\n        name: 'properties.description',\n        title: 'Description'\n      }\n    ]\n  };\n\n  public store = new FeatureStore([], { map: this.map });\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit() {\n    const loadingStrategy = new FeatureStoreLoadingStrategy({});\n    this.store.addStrategy(loadingStrategy);\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      map: this.map,\n      motion: FeatureMotion.Default\n    });\n    this.store.addStrategy(selectionStrategy);\n\n    this.store.load([\n      {\n        meta: { id: 1 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-72, 47.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 1,\n          name: 'Name 1',\n          description: 'Description 1'\n        }\n      },\n      {\n        meta: { id: 4 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-71, 46.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 4,\n          name: 'Name 4',\n          description: 'Description 4'\n        }\n      },\n      {\n        meta: { id: 5 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-73, 45.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 5,\n          name: 'Name 5',\n          description: 'Description 5'\n        }\n      },\n      {\n        meta: { id: 2 },\n        type: 'Feature',\n        geometry: {\n          type: 'LineString',\n          coordinates: [\n            [-72, 47.8],\n            [-73.5, 47.4],\n            [-72.4, 48.6]\n          ]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 2,\n          name: 'Name 2',\n          description: 'Description 2'\n        }\n      },\n      {\n        meta: { id: 3 },\n        type: 'Feature',\n        geometry: {\n          type: 'Polygon',\n          coordinates: [\n            [\n              [-71, 46.8],\n              [-73, 47],\n              [-71.2, 46.6]\n            ]\n          ]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 3,\n          name: 'Name 3',\n          description: 'Description 3'\n        }\n      }\n    ]);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'MVT test',\n        visible: true,\n        sourceOptions: {\n          type: 'mvt',\n          url: 'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\n          queryable: true\n        },\n        igoStyle: {\n          mapboxStyle: {\n            url: 'assets/mapboxStyleExample-vectortile.json',\n            source: 'ahocevar'\n          }\n        }\n      } as any)\n      .subscribe((l) => this.map.addLayer(l));\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector'\n      })\n      .subscribe((dataSource) => {\n        const layer = this.layerService.createLayer({\n          title: 'Vector Layer',\n          source: dataSource,\n          animation: {\n            duration: 2000\n          },\n          igoStyle: {\n            mapboxStyle: {\n              url: 'assets/mapboxStyleExample-feature.json',\n              source: 'source_nameX'\n            }\n          }\n        }) as VectorLayer;\n        this.map.addLayer(layer);\n        this.store.bindLayer(layer);\n        loadingStrategy.activate();\n        selectionStrategy.activate();\n      });\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n}\n","<app-doc-viewer title=\"Overlay\" subtitle=\"Feature\">\n  <app-example-viewer codeFolder=\"geo/feature\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n\n    <igo-entity-table [store]=\"store\" [template]=\"tableTemplate\">\n    </igo-entity-table>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoPanelModule, IgoEntityTableModule } from '@igo2/common';\nimport { IgoMapModule, IgoFeatureModule } from '@igo2/geo';\n\nimport { AppFeatureComponent } from './feature.component';\nimport { AppFeatureRoutingModule } from './feature-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppFeatureComponent],\n  imports: [\n    SharedModule,\n    AppFeatureRoutingModule,\n    IgoPanelModule,\n    IgoEntityTableModule,\n    IgoMapModule,\n    IgoFeatureModule\n  ],\n  exports: [AppFeatureComponent]\n})\nexport class AppFeatureModule {}\n","import { Routes, RouterModule } from '@angular/router';\nimport { AppHoverComponent } from './hover.component';\n\nconst routes: Routes = [\n  {\n    path: 'hover',\n    component: AppHoverComponent\n  }\n];\n\nexport const AppHoverRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\n\nimport { LanguageService, MediaService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WFSDataSourceOptions,\n  VectorLayerOptions,\n  WFSDataSource\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-hover',\n  templateUrl: './hover.component.html',\n  styleUrls: ['./hover.component.scss']\n})\nexport class AppHoverComponent {\n  public selected;\n  public pointerCoord;\n  public pointerCoordDelay: number = 0;\n  public pointerHoverFeatureDelay: number = 0;\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 8,\n    projection: 'EPSG:3857'\n  };\n\n  get media() {\n    return this.mediaService.getMedia();\n  }\n\n  get isTouchScreen() {\n    return this.mediaService.isTouchScreen();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mediaService: MediaService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wmts',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts',\n        layer: 'carte_gouv_qc_public',\n        matrixSet: 'EPSG_3857',\n        version: '1.3.0'\n      })\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Quebec',\n            visible: true,\n            baseLayer: true,\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSDataOptions extends WFSDataSourceOptions {}\n\n    const wfsDatasourcePolygon: WFSDataOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'adn_bassin_n1_public_v',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '3.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourcePolygon)\n      .subscribe((dataSource: WFSDataSource) => {\n        const layer: VectorLayerOptions = {\n          title: 'WFS (polygon)',\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    const wfsDatasourcePoint: WFSDataOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\n      params: {\n        featureTypes: 'MSP_CASERNE_PUBLIC',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourcePoint)\n      .subscribe((dataSource: WFSDataSource) => {\n        const layer: VectorLayerOptions = {\n          title: 'WFS (point)',\n          visible: true,\n          source: dataSource,\n          igoStyle: {\n            styleByAttribute: {\n              attribute: 'en_caserne',\n              data: ['true', 'false'],\n              stroke: ['red', 'blue'],\n              fill: ['#ffffff', '#ffffff'],\n              radius: [7, 7],\n              width: [2, 2]\n            },\n            hoverStyle: {\n              label: {\n                attribute: 'Caserne: ${no_caserne} \\n Mun: ${nom_ssi}',\n                style: {\n                  textAlign: 'left',\n                  textBaseline: 'top',\n                  font: '12px Calibri,sans-serif',\n                  fill: { color: '#000' },\n                  backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\n                  backgroundStroke: {\n                    color: 'rgba(200, 200, 200, 0.75)',\n                    width: 2\n                  },\n                  stroke: { color: '#fff', width: 3 },\n                  overflow: true,\n                  offsetX: 20,\n                  offsetY: 10,\n                  padding: [2.5, 2.5, 2.5, 2.5]\n                }\n              },\n              baseStyle: {\n                circle: {\n                  stroke: {\n                    color: 'orange',\n                    width: 5\n                  },\n                  width: [5],\n                  radius: 15\n                }\n              }\n            }\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Hover\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/hover\">\n    <igo-map-browser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoHoverFeature\n      [igoHoverFeatureDelay]=\"pointerHoverFeatureDelay\"\n      [igoHoverFeatureEnabled]=\"true\"\n    >\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n      <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n      <igo-home-extent-button\n        [map]=\"map\"\n        color=\"primary\"\n      ></igo-home-extent-button>\n      <igo-rotation-button\n        [map]=\"map\"\n        [showIfNoRotation]=\"true\"\n        color=\"primary\"\n      ></igo-rotation-button>\n    </igo-map-browser>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoMapModule } from '@igo2/geo';\n\nimport { AppHoverComponent } from './hover.component';\nimport { AppHoverRoutingModule } from './hover-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppHoverComponent],\n  imports: [SharedModule, AppHoverRoutingModule, IgoMapModule],\n  exports: [AppHoverComponent]\n})\nexport class AppHoverModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppMeasureComponent } from './measure.component';\n\nconst routes: Routes = [\n  {\n    path: 'measure',\n    component: AppMeasureComponent\n  }\n];\n\nexport const AppMeasureRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  FeatureStore,\n  FeatureWithMeasure\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-measure',\n  templateUrl: './measure.component.html',\n  styleUrls: ['./measure.component.scss']\n})\nexport class AppMeasureComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6,\n    projection: 'EPSG:3857'\n  };\n\n  public store = new FeatureStore<FeatureWithMeasure>([], { map: this.map });\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Measure\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/measure\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n\n    <igo-measurer [store]=\"store\" [map]=\"map\"></igo-measurer>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoMapModule, IgoMeasureModule } from '@igo2/geo';\n\nimport { AppMeasureComponent } from './measure.component';\nimport { AppMeasureRoutingModule } from './measure-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppMeasureComponent],\n  imports: [\n    AppMeasureRoutingModule,\n    SharedModule,\n    IgoMapModule,\n    IgoMeasureModule\n  ],\n  exports: [AppMeasureComponent]\n})\nexport class AppMeasureModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppDrawComponent } from './draw.component';\n\nconst routes: Routes = [\n  {\n    path: 'draw',\n    component: AppDrawComponent\n  }\n];\n\nexport const AppDrawRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  FeatureStore,\n  FeatureWithDraw,\n  MapService\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-draw',\n  templateUrl: './draw.component.html',\n  styleUrls: ['./draw.component.scss']\n})\nexport class AppDrawComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6,\n    projection: 'EPSG:3857'\n  };\n\n  public stores: FeatureStore<FeatureWithDraw>[] = [];\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mapService: MapService\n  ) {\n    this.mapService.setMap(this.map);\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Draw\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/draw\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n\n    <igo-draw [stores]=\"stores\" [map]=\"map\"></igo-draw>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoMapModule, IgoDrawModule } from '@igo2/geo';\n\nimport { AppDrawComponent } from './draw.component';\nimport { AppDrawRoutingModule } from './draw-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppDrawComponent],\n  imports: [AppDrawRoutingModule, SharedModule, IgoMapModule, IgoDrawModule],\n  exports: [AppDrawComponent]\n})\nexport class AppDrawModule {}\n","<app-doc-viewer title=\"Query\" subtitle=\"Geo\" [dependencies]=\"[]\">\n  <app-example-viewer codeFolder=\"geo/query\">\n    <igo-map-browser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoOverlay\n      igoQuery\n      [queryFeatures]=\"true\"\n      (query)=\"handleQueryResults($event)\"\n    >\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n\n    <igo-panel title=\"Details\">\n      <ng-container *ngIf=\"features$ | async as features\">\n        <div *ngFor=\"let feature of features\">\n          <h1>\n            Query Title :\n            <span style=\"background-color: #e0e0e0\">{{\n              getTitle(feature)\n            }}</span>\n          </h1>\n          <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n        </div>\n      </ng-container>\n    </igo-panel>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppQueryComponent } from './query.component';\n\nconst routes: Routes = [\n  {\n    path: 'query',\n    component: AppQueryComponent\n  }\n];\n\nexport const AppQueryRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport olFeature from 'ol/Feature';\nimport olPoint from 'ol/geom/Point';\nimport olPolygon from 'ol/geom/Polygon';\nimport olLineString from 'ol/geom/LineString';\nimport * as olproj from 'ol/proj';\n\nimport {\n  IgoMap,\n  FeatureDataSource,\n  DataSourceService,\n  LayerService,\n  Feature,\n  QueryableDataSourceOptions,\n  QueryFormat,\n  QueryHtmlTarget,\n  SearchResult,\n  FeatureMotion\n} from '@igo2/geo';\n\nimport { getEntityTitle } from '@igo2/common';\n\n@Component({\n  selector: 'app-query',\n  templateUrl: './query.component.html',\n  styleUrls: ['./query.component.scss']\n})\nexport class AppQueryComponent {\n  public features$ = new BehaviorSubject<Feature[]>([]);\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n        queryable: true,\n        queryTitle: 'num_rts',\n        params: {\n          layers: 'bgr_v_sous_route_res_sup_act',\n          version: '1.3.0'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n        queryable: true,\n        queryFormat: QueryFormat.HTMLGML2,\n        queryHtmlTarget: QueryHtmlTarget.IFRAME,\n        params: {\n          layers: 'bgr_v_sous_route_res_sup_act',\n          version: '1.3.0'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS html with a pre call in GML',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Query url test',\n        visible: true,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\n          queryable: true,\n          queryUrls: [\n            {\n              url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=wms_mern_reg_admin&LAYERS=wms_mern_reg_admin&INFO_FORMAT=application/geojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}'\n            }\n          ],\n          queryLayerFeatures: false,\n          queryFormat: 'geojson',\n          params: {\n            layers: 'SDA_MUNIC_S_20K',\n            version: '1.3.0'\n          }\n        }\n      } as any)\n      .subscribe((l) => this.map.addLayer(l));\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector',\n        queryable: true,\n        queryTitle: 'So beautiful ${name}',\n        sourceFields: [\n          { name: 'name', alias: 'Alias name' },\n          { name: 'description', alias: 'Alias description' }\n        ]\n      } as QueryableDataSourceOptions)\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Vector Layer',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n        this.addFeatures(dataSource as FeatureDataSource);\n      });\n  }\n\n  addFeatures(dataSource: FeatureDataSource) {\n    const feature1 = new olFeature({\n      name: 'feature1',\n      geometry: new olLineString([\n        olproj.transform([-72, 47.8], 'EPSG:4326', 'EPSG:3857'),\n        olproj.transform([-73.5, 47.4], 'EPSG:4326', 'EPSG:3857'),\n        olproj.transform([-72.4, 48.6], 'EPSG:4326', 'EPSG:3857')\n      ])\n    });\n\n    const feature2 = new olFeature({\n      name: 'feature2',\n      geometry: new olPoint(\n        olproj.transform([-73, 46.6], 'EPSG:4326', 'EPSG:3857')\n      )\n    });\n\n    const feature3 = new olFeature({\n      name: 'feature3',\n      geometry: new olPolygon([\n        [\n          olproj.transform([-71, 46.8], 'EPSG:4326', 'EPSG:3857'),\n          olproj.transform([-73, 47], 'EPSG:4326', 'EPSG:3857'),\n          olproj.transform([-71.2, 46.6], 'EPSG:4326', 'EPSG:3857')\n        ]\n      ])\n    });\n\n    dataSource.ol.addFeatures([feature1, feature2, feature3]);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Vector tile with custom getfeatureinfo url',\n        visible: true,\n        sourceOptions: {\n          type: 'mvt',\n          url: 'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\n          queryable: true,\n          queryUrls: [\n            {\n              url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=wms_mern_reg_admin&LAYERS=wms_mern_reg_admin&INFO_FORMAT=application%2Fgeojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}'\n            }\n          ],\n          queryLayerFeatures: false\n          // queryFormat: 'geojson'\n        },\n        mapboxStyle: {\n          url: 'assets/mapboxStyleExample-vectortile.json',\n          source: 'ahocevar'\n        }\n      } as any)\n      .subscribe((l) => this.map.addLayer(l));\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/incendie.fcgi',\n        queryable: true,\n        queryUrls: [\n          {\n            url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=SDA_MUNIC_S_20K&LAYERS=SDA_MUNIC_S_20K&INFO_FORMAT=geojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}',\n            // minScale: 20000,\n            // maxScale: 9000000,\n            minResolution: 0,\n            maxResolution: 400\n          }\n        ],\n        queryFormat: 'geojson',\n        params: {\n          version: '1.3.0',\n          layers: 'MSP_CASERNE_PUBLIC'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS with custom getfeatureinfo url',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n      });\n  }\n\n  handleQueryResults(results) {\n    const features: Feature[] = results.features;\n    if (features.length && features[0]) {\n      this.features$.next(features);\n      this.map.queryResultsOverlay.setFeatures(features, FeatureMotion.None);\n    }\n  }\n\n  getTitle(result: SearchResult) {\n    return getEntityTitle(result);\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoOverlayModule,\n  IgoQueryModule,\n  IgoFeatureModule\n} from '@igo2/geo';\n\nimport { AppQueryComponent } from './query.component';\nimport { AppQueryRoutingModule } from './query-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppQueryComponent],\n  imports: [\n    AppQueryRoutingModule,\n    SharedModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoOverlayModule,\n    IgoQueryModule,\n    IgoFeatureModule\n  ],\n  exports: [AppQueryComponent]\n})\nexport class AppQueryModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppCatalogComponent } from './catalog.component';\n\nconst routes: Routes = [\n  {\n    path: 'catalog',\n    component: AppCatalogComponent\n  }\n];\n\nexport const AppCatalogRoutingModule = RouterModule.forChild(routes);\n","import { Component, OnInit } from '@angular/core';\n\nimport { LanguageService, ConfigService, StorageService } from '@igo2/core';\nimport {\n  IgoMap,\n  LayerService,\n  Catalog,\n  CatalogItem,\n  CatalogService,\n  MapService\n} from '@igo2/geo';\nimport { EntityRecord, EntityStore } from '@igo2/common';\n\n@Component({\n  selector: 'app-catalog',\n  templateUrl: './catalog.component.html',\n  styleUrls: ['./catalog.component.scss']\n})\nexport class AppCatalogComponent implements OnInit {\n  catalog: Catalog;\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  public catalogStore = new EntityStore<Catalog>([]);\n\n  public catalogItemStore = new EntityStore<CatalogItem>([]);\n\n  constructor(\n    private configService: ConfigService,\n    private languageService: LanguageService,\n    private layerService: LayerService,\n    private catalogService: CatalogService,\n    private storageService: StorageService,\n    private mapService: MapService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe((layer) => this.map.addLayer(layer));\n\n    this.loadCatalogs();\n\n    this.mapService.setMap(this.map);\n    this.catalogStore.stateView\n      .firstBy$(\n        (record: EntityRecord<Catalog>) => record.state.selected === true\n      )\n      .subscribe((record: EntityRecord<Catalog>) => {\n        if (record && record.entity) {\n          const catalog = record.entity;\n          this.catalog = catalog;\n        }\n      });\n  }\n\n  /**\n   * When the selected catalog changes, toggle the the CatalogBrowser tool.\n   * @internal\n   * @param event Select event\n   */\n  onCatalogSelectChange(event: { selected: boolean; catalog: Catalog }) {\n    this.loadCatalogItems(event.catalog);\n  }\n\n  /**\n   * Get all the available catalogs from the CatalogService and\n   * load them into the store.\n   */\n  private loadCatalogs() {\n    this.catalogService.loadCatalogs().subscribe((catalogs: Catalog[]) => {\n      this.catalogStore.clear();\n      this.catalogStore.load(\n        catalogs.concat(\n          (this.storageService.get('addedCatalogs') || []) as Catalog[]\n        )\n      );\n    });\n  }\n\n  /**\n   * Get the selected catalog's items from the CatalogService and\n   * load them into the store.\n   * @param catalog Selected catalog\n   */\n  private loadCatalogItems(catalog: Catalog) {\n    this.catalogService\n      .loadCatalogItems(catalog)\n      .subscribe((items: CatalogItem[]) => {\n        this.catalogItemStore.clear();\n        this.catalogItemStore.load(items);\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Catalog\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['ConfigService', 'LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/catalog\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\">\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n\n    <igo-panel title=\"Catalog Library\">\n      <igo-catalog-library\n        [store]=\"catalogStore\"\n        (catalogSelectChange)=\"onCatalogSelectChange($event)\"\n      >\n      </igo-catalog-library>\n    </igo-panel>\n\n    <igo-panel title=\"Catalog Browser\">\n      <igo-catalog-browser\n        [catalog]=\"catalog\"\n        [store]=\"catalogItemStore\"\n        [map]=\"map\"\n      >\n      </igo-catalog-browser>\n    </igo-panel>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoConfigModule, provideConfigOptions } from '@igo2/core';\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoCatalogModule } from '@igo2/geo';\n\nimport { environment } from '../../../environments/environment';\nimport { AppCatalogComponent } from './catalog.component';\nimport { AppCatalogRoutingModule } from './catalog-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppCatalogComponent],\n  imports: [\n    SharedModule,\n    AppCatalogRoutingModule,\n    IgoConfigModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoCatalogModule\n  ],\n  exports: [AppCatalogComponent],\n  providers: [\n    provideConfigOptions({\n      default: environment.igo\n    })\n  ]\n})\nexport class AppCatalogModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { ContextImportExportComponent } from './context-import-export/context-import-export.component';\nimport { IgoSpinnerModule } from '@igo2/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\n@NgModule({\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatDividerModule,\n    MatTabsModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatCheckboxModule,\n    IgoLanguageModule,\n    IgoSpinnerModule,\n    MatTooltipModule\n  ],\n  exports: [ContextImportExportComponent],\n  declarations: [ContextImportExportComponent]\n})\nexport class IgoContextImportExportModule {\n  static forRoot(): ModuleWithProviders<IgoContextImportExportModule> {\n    return {\n      ngModule: IgoContextImportExportModule\n    };\n  }\n}\n","export enum TypePermission {\n  null,\n  read,\n  write\n}\n\nexport enum Scope {\n  public,\n  protected,\n  private\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\n\nimport { BehaviorSubject, Observable, of, Subject } from 'rxjs';\nimport {\n  map,\n  tap,\n  catchError,\n  debounceTime,\n  mergeMap,\n  first,\n  skip\n} from 'rxjs/operators';\n\nimport olPoint from 'ol/geom/Point';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport Cluster from 'ol/source/Cluster';\nimport olVectorSource from 'ol/source/Vector';\n\nimport { Tool } from '@igo2/common';\nimport { uuid, ObjectUtils } from '@igo2/utils';\nimport {\n  ConfigService,\n  RouteService,\n  Message,\n  MessageService,\n  LanguageService,\n  StorageService\n} from '@igo2/core';\n\nimport { AuthService } from '@igo2/auth';\nimport type {\n  IgoMap,\n  Layer,\n  LayerOptions,\n  VectorLayerOptions,\n  VectorTileLayerOptions\n} from '@igo2/geo';\nimport { ExportService } from '@igo2/geo';\n\nimport { TypePermission } from './context.enum';\nimport {\n  ContextsList,\n  ContextServiceOptions,\n  Context,\n  DetailedContext,\n  ContextMapView,\n  ContextPermission,\n  ContextProfils,\n  ExtraFeatures\n} from './context.interface';\nimport { Geometry } from 'ol/geom';\nimport { Feature } from 'ol';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextService {\n  public context$ = new BehaviorSubject<DetailedContext>(undefined);\n  public contexts$ = new BehaviorSubject<ContextsList>({ ours: [] });\n  public defaultContextId$ = new BehaviorSubject<string>(undefined);\n  public editedContext$ = new BehaviorSubject<DetailedContext>(undefined);\n  public importedContext: Array<DetailedContext> = [];\n  public toolsChanged$ = new Subject<DetailedContext>();\n  private mapViewFromRoute: ContextMapView = {};\n  private options: ContextServiceOptions;\n  private baseUrl: string;\n\n  // Until the ContextService is completely refactored, this is needed\n  // to track the current tools\n  private tools: Tool[];\n  private toolbar: string[];\n\n  get defaultContextUri(): string {\n    return (\n      (this.storageService.get('favorite.context.uri') as string) ||\n      this._defaultContextUri ||\n      this.options.defaultContextUri\n    );\n  }\n  set defaultContextUri(uri: string) {\n    this._defaultContextUri = uri;\n  }\n  private _defaultContextUri: string;\n\n  constructor(\n    private http: HttpClient,\n    private authService: AuthService,\n    private languageService: LanguageService,\n    private config: ConfigService,\n    private messageService: MessageService,\n    private storageService: StorageService,\n    private exportService: ExportService,\n    @Optional() private route: RouteService\n  ) {\n    this.options = Object.assign(\n      {\n        basePath: 'contexts',\n        contextListFile: '_contexts.json',\n        defaultContextUri: '_default'\n      },\n      this.config.getConfig('context')\n    );\n\n    this.baseUrl = this.options.url ?? '';\n\n    this.readParamsFromRoute();\n\n    if (this.authService.hasAuthService) {\n      this.authService.logged$.subscribe((logged) => {\n        if (logged) {\n          this.contexts$.pipe(skip(1), first()).subscribe((c) => {\n            this.handleContextsChange();\n          });\n          this.loadContexts();\n        }\n      });\n    } else {\n      this.loadContexts();\n      this.handleContextsChange(false);\n    }\n  }\n\n  get(permissions?: string[], hidden?: boolean): Observable<ContextsList> {\n    let url = this.baseUrl + '/contexts';\n    if (permissions && this.authService.authenticated) {\n      url += '?permission=' + permissions.join();\n      if (hidden) {\n        url += '&hidden=true';\n      }\n    }\n    return this.http.get<ContextsList>(url);\n  }\n\n  getById(id: string): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.get<Context>(url);\n  }\n\n  getDetails(id: string): Observable<DetailedContext> {\n    const url = `${this.baseUrl}/contexts/${id}/details`;\n    return this.http.get<DetailedContext>(url).pipe(\n      catchError((res) => {\n        this.handleError(res, id);\n        throw res;\n      })\n    );\n  }\n\n  getDefault(): Observable<DetailedContext> {\n    if (this.authService.authenticated) {\n      const url = this.baseUrl + '/contexts/default';\n      return this.http.get<DetailedContext>(url).pipe(\n        tap((context) => {\n          this.defaultContextId$.next(context.id);\n        })\n      );\n    } else {\n      const uri = this.storageService.get('favorite.context.uri') as string;\n      this.defaultContextId$.next(uri);\n      return this.getContextByUri(uri);\n    }\n  }\n\n  getProfilByUser(): Observable<ContextProfils[]> {\n    if (this.baseUrl) {\n      const url = this.baseUrl + '/profils?';\n      return this.http.get<ContextProfils[]>(url);\n    }\n    return of([]);\n  }\n\n  setDefault(id: string): Observable<any> {\n    if (this.authService.authenticated) {\n      const url = this.baseUrl + '/contexts/default';\n      return this.http.post(url, { defaultContextId: id });\n    } else {\n      this.storageService.set('favorite.context.uri', id);\n      return of(undefined);\n    }\n  }\n\n  hideContext(id: string) {\n    const url = this.baseUrl + '/contexts/' + id + '/hide';\n    return this.http.post(url, {});\n  }\n\n  showContext(id: string) {\n    const url = this.baseUrl + '/contexts/' + id + '/show';\n    return this.http.post(url, {});\n  }\n\n  delete(id: string, imported = false): Observable<void> {\n    const contexts: ContextsList = { ours: [] };\n    Object.keys(this.contexts$.value).forEach(\n      (key) =>\n        (contexts[key] = this.contexts$.value[key].filter((c) => c.id !== id))\n    );\n\n    if (imported) {\n      this.importedContext = this.importedContext.filter((c) => c.id !== id);\n      return of(this.contexts$.next(contexts));\n    }\n\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.delete<void>(url).pipe(\n      tap((res) => {\n        this.contexts$.next(contexts);\n      })\n    );\n  }\n\n  create(context: DetailedContext): Observable<Context> {\n    const url = this.baseUrl + '/contexts';\n    return this.http.post<Context>(url, context).pipe(\n      map((contextCreated) => {\n        if (this.authService.authenticated) {\n          contextCreated.permission = TypePermission[TypePermission.write];\n        } else {\n          contextCreated.permission = TypePermission[TypePermission.read];\n        }\n        this.contexts$.value.ours.unshift(contextCreated);\n        this.contexts$.next(this.contexts$.value);\n        return contextCreated;\n      })\n    );\n  }\n\n  clone(id: string, properties = {}): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id + '/clone';\n    return this.http.post<Context>(url, properties).pipe(\n      map((contextCloned) => {\n        contextCloned.permission = TypePermission[TypePermission.write];\n        this.contexts$.value.ours.unshift(contextCloned);\n        this.contexts$.next(this.contexts$.value);\n        return contextCloned;\n      })\n    );\n  }\n\n  update(id: string, context: Context): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.patch<Context>(url, context);\n  }\n\n  // =================================================================\n\n  addToolAssociation(contextId: string, toolId: string): Observable<void> {\n    const url = `${this.baseUrl}/contexts/${contextId}/tools`;\n    const association = {\n      toolId\n    };\n    return this.http.post<void>(url, association);\n  }\n\n  deleteToolAssociation(contextId: string, toolId: string): Observable<any> {\n    const url = `${this.baseUrl}/contexts/${contextId}/tools/${toolId}`;\n    return this.http.delete(url);\n  }\n\n  getPermissions(id: string): Observable<ContextPermission[]> {\n    const url = this.baseUrl + '/contexts/' + id + '/permissions';\n    return this.http.get<ContextPermission[]>(url);\n  }\n\n  addPermissionAssociation(\n    contextId: string,\n    profil: string,\n    type: TypePermission\n  ): Observable<ContextPermission[]> {\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions`;\n    const association = {\n      profil,\n      typePermission: type\n    };\n\n    return this.http.post<ContextPermission[]>(url, association).pipe(\n      catchError((res) => {\n        this.handleError(res, undefined, true);\n        throw [res]; // TODO Not sure about this.\n      })\n    );\n  }\n\n  deletePermissionAssociation(\n    contextId: string,\n    permissionId: string\n  ): Observable<void> {\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions/${permissionId}`;\n    return this.http.delete<void>(url);\n  }\n\n  // ======================================================================\n\n  getLocalContexts(): Observable<ContextsList> {\n    const url = this.getPath(this.options.contextListFile);\n    return this.http.get<ContextsList>(url).pipe(\n      map((res: any) => {\n        return { ours: res };\n      })\n    );\n  }\n\n  getLocalContext(uri: string): Observable<DetailedContext> {\n    const url = this.getPath(`${uri}.json`);\n    return this.http.get<DetailedContext>(url).pipe(\n      mergeMap((res) => {\n        if (!res.base) {\n          return of(res);\n        }\n        const urlBase = this.getPath(`${res.base}.json`);\n        return this.http.get<DetailedContext>(urlBase).pipe(\n          map((resBase: DetailedContext) => {\n            const resMerge = res;\n            resMerge.map = ObjectUtils.mergeDeep(resBase.map, res.map);\n            resMerge.layers = (resBase.layers || [])\n              .concat(res.layers || [])\n              .reverse()\n              .filter(\n                (l, index, self) =>\n                  !l.id || self.findIndex((l2) => l2.id === l.id) === index\n              )\n              .reverse();\n            resMerge.toolbar = res.toolbar || resBase.toolbar;\n            resMerge.message = res.message || resBase.message;\n            resMerge.messages = res.messages || resBase.messages;\n            resMerge.tools = (res.tools || [])\n              .concat(resBase.tools || [])\n              .filter(\n                (t, index, self) =>\n                  self.findIndex((t2) => t2.name === t.name) === index\n              );\n            return resMerge;\n          }),\n          catchError((err) => {\n            this.handleError(err, uri);\n            throw err;\n          })\n        );\n      }),\n      catchError((err2) => {\n        this.handleError(err2, uri);\n        throw err2;\n      })\n    );\n  }\n\n  loadContexts(permissions?: string[], hidden?: boolean) {\n    let request;\n    if (this.baseUrl) {\n      request = this.get(permissions, hidden);\n    } else {\n      request = this.getLocalContexts();\n    }\n    request.subscribe((contexts) => {\n      contexts.ours = this.importedContext.concat(contexts.ours);\n      this.contexts$.next(contexts);\n    });\n  }\n\n  loadDefaultContext() {\n    const loadFct = (direct = false) => {\n      if (!direct && this.baseUrl && this.authService.authenticated) {\n        this.getDefault().subscribe(\n          (_context: DetailedContext) => {\n            this.defaultContextUri = _context.uri;\n            this.addContextToList(_context);\n            this.setContext(_context);\n          },\n          () => {\n            this.defaultContextId$.next(undefined);\n            this.loadContext(this.defaultContextUri);\n          }\n        );\n      } else {\n        this.loadContext(this.defaultContextUri);\n      }\n    };\n\n    if (this.route && this.route.options.contextKey) {\n      this.route.queryParams.pipe(debounceTime(100)).subscribe((params) => {\n        const contextParam = params[this.route.options.contextKey as string];\n        let direct = false;\n        if (contextParam) {\n          this.defaultContextUri = contextParam;\n          direct = true;\n        }\n        loadFct(direct);\n      });\n    } else {\n      loadFct();\n    }\n  }\n\n  loadContext(uri: string) {\n    const context = this.context$.value;\n\n    if (context && context.uri === uri) {\n      return;\n    }\n\n    this.getContextByUri(uri)\n      .pipe(first())\n      .subscribe(\n        (_context: DetailedContext) => {\n          this.addContextToList(_context);\n          this.setContext(_context);\n        },\n        (err) => {\n          if (uri !== this.options.defaultContextUri) {\n            this.loadContext(this.options.defaultContextUri);\n          }\n        }\n      );\n  }\n\n  setContext(context: DetailedContext) {\n    this.handleContextMessage(context);\n    const currentContext = this.context$.value;\n    if (currentContext && context && context.id === currentContext.id) {\n      if (context.map.view.keepCurrentView === undefined) {\n        context.map.view.keepCurrentView = true;\n      }\n      this.context$.next(context);\n      return;\n    }\n\n    if (!context.map) {\n      context.map = { view: {} };\n    }\n\n    Object.assign(context.map.view, this.mapViewFromRoute);\n\n    this.context$.next(context);\n  }\n\n  loadEditedContext(uri: string) {\n    this.getContextByUri(uri).subscribe((_context: DetailedContext) => {\n      this.setEditedContext(_context);\n    });\n  }\n\n  setEditedContext(context: DetailedContext) {\n    this.editedContext$.next(context);\n  }\n\n  getContextFromMap(igoMap: IgoMap, empty?: boolean): DetailedContext {\n    const view = igoMap.ol.getView();\n    const proj = view.getProjection().getCode();\n    const center: any = new olPoint(view.getCenter()).transform(\n      proj,\n      'EPSG:4326'\n    );\n\n    const context = {\n      uri: uuid(),\n      title: '',\n      scope: 'private',\n      map: {\n        view: {\n          center: center.getCoordinates(),\n          zoom: view.getZoom(),\n          projection: proj,\n          maxZoomOnExtent: igoMap.viewController.maxZoomOnExtent\n        }\n      },\n      layers: [],\n      tools: []\n    };\n\n    let layers = [];\n    if (empty === true) {\n      layers = igoMap.layers$\n        .getValue()\n        .filter(\n          (lay) =>\n            lay.baseLayer === true ||\n            lay.options.id === 'searchPointerSummaryId'\n        )\n        .sort((a, b) => a.zIndex - b.zIndex);\n    } else {\n      layers = igoMap.layers$\n        .getValue()\n        .filter((lay) => !lay.id.includes('WfsWorkspaceTableDest'))\n        .sort((a, b) => a.zIndex - b.zIndex);\n    }\n\n    let i = 0;\n    for (const l of layers) {\n      const layer: any = l;\n      const opts = {\n        id: layer.options.id ? String(layer.options.id) : undefined,\n        layerOptions: {\n          title: layer.options.title,\n          zIndex: ++i,\n          visible: layer.visible,\n          security: layer.security\n        } as LayerOptions,\n        sourceOptions: {\n          type: layer.dataSource.options.type,\n          params: layer.dataSource.options.params,\n          url: layer.dataSource.options.url,\n          queryable: layer.queryable\n        }\n      };\n      if (opts.sourceOptions.type) {\n        context.layers.push(opts);\n      }\n    }\n\n    context.tools = this.tools.map((tool) => {\n      return { id: String(tool.id), global: tool.global };\n    });\n\n    return context;\n  }\n\n  getContextFromLayers(\n    igoMap: IgoMap,\n    layers: Layer[],\n    name: string,\n    keepCurrentView?: boolean\n  ): DetailedContext {\n    const currentContext = this.context$.getValue();\n    const view = igoMap.ol.getView();\n    const proj = view.getProjection().getCode();\n    const center: any = new olPoint(view.getCenter()).transform(\n      proj,\n      'EPSG:4326'\n    );\n\n    const context: DetailedContext = {\n      uri: name,\n      title: name,\n      map: {\n        view: {\n          center: center.getCoordinates(),\n          zoom: view.getZoom(),\n          projection: proj,\n          keepCurrentView\n        }\n      },\n      layers: [],\n      toolbar: [],\n      tools: [],\n      extraFeatures: []\n    };\n\n    const currentLayers = igoMap.layers$.getValue();\n    context.layers = currentLayers\n      .filter((l) => l.baseLayer)\n      .map((l) => {\n        return {\n          baseLayer: true,\n          sourceOptions: l.options.sourceOptions,\n          title: l.options.title,\n          visible: l.visible\n        };\n      });\n\n    layers.forEach((layer) => {\n      // Do not seem to work properly. layerFound is always undefined.\n      const layerFound = currentContext.layers.find((contextLayer) => {\n        const source = contextLayer.source;\n        return source && layer.id === source.id && !contextLayer.baseLayer;\n      });\n      if (layerFound) {\n        let layerFoundAs = layerFound as\n          | VectorLayerOptions\n          | VectorTileLayerOptions;\n        let layerStyle = layerFoundAs.style;\n        if (layerFoundAs.igoStyle?.styleByAttribute) {\n          layerStyle = undefined;\n        } else if (layerFoundAs.igoStyle?.clusterBaseStyle) {\n          layerStyle = undefined;\n          delete layerFound.sourceOptions[`source`];\n          delete layerFound.sourceOptions[`format`];\n        }\n        const opts = {\n          baseLayer: layerFound.baseLayer,\n          title: layer.options.title,\n          zIndex: layer.zIndex,\n          igoStyle: {\n            styleByAttribute: layerFoundAs.igoStyle?.styleByAttribute,\n            clusterBaseStyle: layerFoundAs.igoStyle?.clusterBaseStyle\n          },\n          style: layerStyle,\n          clusterParam: layerFound[`clusterParam`],\n          visible: layer.visible,\n          opacity: layer.opacity,\n          sourceOptions: layerFound.sourceOptions\n        };\n        context.layers.push(opts);\n      } else {\n        if (!(layer.ol.getSource() instanceof olVectorSource)) {\n          const catalogLayer = layer.options;\n          catalogLayer.zIndex = layer.zIndex;\n          (catalogLayer.visible = layer.visible),\n            (catalogLayer.opacity = layer.opacity);\n          delete catalogLayer.source;\n          context.layers.push(catalogLayer);\n        } else {\n          const extraFeatures = this.getExtraFeatures(layer);\n          extraFeatures.name = layer.options.title;\n          extraFeatures.opacity = layer.opacity;\n          extraFeatures.visible = layer.visible;\n          context.extraFeatures.push(extraFeatures);\n        }\n      }\n    });\n\n    context.toolbar = this.toolbar;\n    context.tools = this.tools;\n\n    return context;\n  }\n\n  private getExtraFeatures(layer: Layer): ExtraFeatures {\n    const writer = new GeoJSON();\n    let olFeatures: Feature<Geometry>[];\n    if (layer.ol.getSource() instanceof Cluster) {\n      const clusterSource = layer.ol.getSource() as Cluster;\n      olFeatures = clusterSource.getFeatures();\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\n        cluster.get('features')\n      );\n    } else {\n      const source = layer.ol.getSource() as olVectorSource;\n      olFeatures = source.getFeatures();\n    }\n    const cleanedOlFeatures = this.exportService.generateFeature(\n      olFeatures,\n      'GeoJSON',\n      '_featureStore'\n    );\n    const features = writer.writeFeatures(cleanedOlFeatures, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: 'EPSG:3857'\n    });\n    return JSON.parse(features);\n  }\n\n  setTools(tools: Tool[]) {\n    this.tools = tools;\n  }\n\n  setToolbar(toolbar: string[]) {\n    this.toolbar = toolbar;\n  }\n\n  private handleContextMessage(context: DetailedContext) {\n    if (\n      this.context$.value &&\n      context.uri &&\n      this.context$.value.uri !== context.uri\n    ) {\n      this.messageService.removeAllAreNotError();\n    }\n\n    context.messages = context.messages ? context.messages : [];\n    context.messages.push(context.message);\n    context.messages.map((message) => {\n      if (message) {\n        this.messageService.message(message as Message);\n      }\n    });\n  }\n\n  private getContextByUri(uri: string): Observable<DetailedContext> {\n    if (this.baseUrl) {\n      let contextToLoad;\n      for (const key of Object.keys(this.contexts$.value)) {\n        contextToLoad = this.contexts$.value[key].find((c) => {\n          return c.uri === uri;\n        });\n        if (contextToLoad) {\n          break;\n        }\n      }\n\n      if (contextToLoad && contextToLoad.imported) {\n        return of(contextToLoad);\n      }\n\n      // TODO : use always id or uri\n      const id = contextToLoad ? contextToLoad.id : uri;\n      return this.getDetails(id);\n    }\n\n    const importedContext = this.contexts$.value.ours.find((currentContext) => {\n      return currentContext.uri === uri && currentContext.imported === true;\n    });\n\n    if (importedContext) {\n      return of(importedContext);\n    } else {\n      return this.getLocalContext(uri);\n    }\n  }\n\n  getContextLayers(igoMap: IgoMap) {\n    const layers: Layer[] = [];\n    const mapLayers = igoMap.layers$.getValue();\n    mapLayers.forEach((layer) => {\n      if (!layer.baseLayer && layer.options.id !== 'searchPointerSummaryId') {\n        layers.push(layer);\n      }\n    });\n    return layers;\n  }\n\n  private readParamsFromRoute() {\n    if (!this.route) {\n      return;\n    }\n\n    this.route.queryParams.subscribe((params) => {\n      const centerKey = this.route.options.centerKey;\n      if (centerKey && params[centerKey as string]) {\n        const centerParams = params[centerKey as string];\n        this.mapViewFromRoute.center = centerParams.split(',').map(Number);\n      }\n\n      const projectionKey = this.route.options.projectionKey;\n      if (projectionKey && params[projectionKey as string]) {\n        const projectionParam = params[projectionKey as string];\n        this.mapViewFromRoute.projection = projectionParam;\n      }\n\n      const zoomKey = this.route.options.zoomKey;\n      if (zoomKey && params[zoomKey as string]) {\n        const zoomParam = params[zoomKey as string];\n        this.mapViewFromRoute.zoom = Number(zoomParam);\n      }\n    });\n  }\n\n  private getPath(file: string) {\n    const basePath = this.options.basePath.replace(/\\/$/, '');\n\n    return `${basePath}/${file}`;\n  }\n\n  private handleError(\n    error: HttpErrorResponse,\n    uri: string,\n    permissionError?: boolean\n  ) {\n    const context = this.contexts$.value.ours.find((obj) => obj.uri === uri);\n    const titleContext = context ? context.title : uri;\n    error.error.title = this.languageService.translate.instant(\n      'igo.context.contextManager.invalid.title'\n    );\n\n    error.error.message = this.languageService.translate.instant(\n      'igo.context.contextManager.invalid.text',\n      { value: titleContext }\n    );\n\n    error.error.toDisplay = true;\n\n    if (permissionError) {\n      error.error.title = this.languageService.translate.instant(\n        'igo.context.contextManager.errors.addPermissionTitle'\n      );\n      error.error.message = this.languageService.translate.instant(\n        'igo.context.contextManager.errors.addPermission'\n      );\n    }\n    this.messageService.error(\n      'igo.context.contextManager.errors.addPermission',\n      'igo.context.contextManager.errors.addPermissionTitle'\n    );\n  }\n\n  private handleContextsChange(keepCurrentContext = true) {\n    const context = this.context$.value;\n    const editedContext = this.editedContext$.value;\n    if (!context || context.uri === this.options.defaultContextUri) {\n      keepCurrentContext = false;\n    }\n    if (!keepCurrentContext || !this.findContext(context)) {\n      this.defaultContextUri = undefined;\n      this.loadDefaultContext();\n    } else {\n      this.getContextByUri(context.uri)\n        .pipe(first())\n        .subscribe((newContext: DetailedContext) => {\n          this.toolsChanged$.next(newContext);\n        });\n\n      if (this.baseUrl && this.authService.authenticated) {\n        this.getDefault().subscribe();\n      }\n    }\n    const editedFound = this.findContext(editedContext);\n    if (!editedFound || editedFound.permission !== 'write') {\n      this.setEditedContext(undefined);\n    }\n  }\n\n  private addContextToList(context: Context) {\n    const contextFound = this.findContext(context);\n    if (!contextFound) {\n      const contextSimplifie = {\n        id: context.id,\n        uri: context.uri,\n        title: context.title,\n        scope: context.scope,\n        permission: TypePermission[TypePermission.read]\n      };\n\n      if (this.contexts$.value && this.contexts$.value.public) {\n        this.contexts$.value.public.push(contextSimplifie);\n        this.contexts$.next(this.contexts$.value);\n      }\n    }\n  }\n\n  private findContext(context: Context) {\n    if (!context) {\n      return false;\n    }\n\n    const contexts = this.contexts$.value;\n    let found;\n    for (const key of Object.keys(contexts)) {\n      const value = contexts[key];\n      found = value.find(\n        (c) =>\n          (context.id && c.id === context.id) ||\n          (context.uri && c.uri === context.uri)\n      );\n      if (found) {\n        break;\n      }\n    }\n\n    return found;\n  }\n}\n","import { Directive, OnInit, OnDestroy } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { filter } from 'rxjs/operators';\n\nimport {\n  MapViewOptions,\n  MapBrowserComponent,\n  MapControlsOptions,\n  MapScaleLineOptions\n} from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { ContextService } from './context.service';\nimport { DetailedContext, ContextMapView } from './context.interface';\nimport { MediaService } from '@igo2/core';\n\n@Directive({\n  selector: '[igoMapContext]'\n})\nexport class MapContextDirective implements OnInit, OnDestroy {\n  private component: MapBrowserComponent;\n  private context$$: Subscription;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    component: MapBrowserComponent,\n    private contextService: ContextService,\n    private mediaService: MediaService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.context$$ = this.contextService.context$\n      .pipe(filter((context) => context !== undefined))\n      .subscribe((context) => this.handleContextChange(context));\n  }\n\n  ngOnDestroy() {\n    this.context$$.unsubscribe();\n  }\n\n  private handleContextChange(context: DetailedContext) {\n    if (context.map === undefined) {\n      return;\n    }\n\n    // This creates a new ol.Map when the context changes. Doing that\n    // allows the print tool to work properly even when the map's canvas\n    // has been tainted (CORS) with the layers of another context. This could\n    // have some side effects such as unbinding all listeners on the first map.\n    // A better solution would be to create a new map (preview) before\n    // printing and avoid the tainted canvas issue. This will come later so\n    // this snippet of code is kept here in case it takes too long becomes\n    // an issue\n\n    // const target = this.component.map.ol.getTarget();\n    // this.component.map.ol.setTarget(undefined);\n    // this.component.map.init();\n    // this.component.map.ol.setTarget(target);\n\n    const viewContext: ContextMapView = context.map.view;\n    if (\n      !this.component.view ||\n      viewContext.keepCurrentView !== true ||\n      context.map.view.projection !== this.map.projection\n    ) {\n      this.component.view = viewContext as MapViewOptions;\n    }\n    if (this.component.map.geolocationController) {\n      this.component.map.geolocationController.updateGeolocationOptions(\n        viewContext\n      );\n    }\n\n    const controlsContext: MapControlsOptions = context.map.controls;\n    if (!this.component.controls && controlsContext) {\n      if (this.mediaService.isMobile()) {\n        if (typeof controlsContext.scaleLine !== 'boolean') {\n          const scaleLineOption =\n            controlsContext.scaleLine as MapScaleLineOptions;\n          if (!scaleLineOption.minWidth) {\n            scaleLineOption.minWidth = Math.min(64, scaleLineOption.minWidth);\n            controlsContext.scaleLine = scaleLineOption;\n          }\n        }\n      }\n      this.component.controls = controlsContext;\n    }\n  }\n}\n","import type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  IgoMap,\n  VectorLayer,\n  QueryableDataSourceOptions,\n  StyleService,\n  StyleListService,\n  StyleByAttribute,\n  ClusterParam,\n  ClusterDataSourceOptions,\n  ClusterDataSource,\n  featureRandomStyle,\n  featureRandomStyleFunction\n} from '@igo2/geo';\nimport { MessageService } from '@igo2/core';\nimport {\n  DetailedContext,\n  ExtraFeatures\n} from '../../context-manager/shared/context.interface';\nimport { ContextService } from '../../context-manager/shared/context.service';\nimport OlFeature from 'ol/Feature';\nimport GeoJSON from 'ol/format/GeoJSON';\n\nexport function handleFileImportSuccess(\n  file: File,\n  context: DetailedContext,\n  messageService: MessageService,\n  contextService: ContextService\n) {\n  if (Object.keys(context).length <= 0) {\n    handleNothingToImportError(file, messageService);\n    return;\n  }\n\n  const contextTitle = computeLayerTitleFromFile(file);\n\n  addContextToContextList(context, contextTitle, contextService);\n\n  messageService.success(\n    'igo.context.contextImportExport.import.success.text',\n    'igo.context.contextImportExport.import.success.title',\n    undefined,\n    {\n      value: contextTitle\n    }\n  );\n}\n\nexport function handleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  sizeMb?: number\n) {\n  sizeMb = sizeMb ? sizeMb : 30;\n  const errMapping = {\n    'Invalid file': handleInvalidFileImportError,\n    'File is too large': handleSizeFileImportError,\n    'Failed to read file': handleUnreadbleFileImportError\n  };\n  errMapping[error.message](file, error, messageService, sizeMb);\n}\n\nexport function handleInvalidFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.context.contextImportExport.import.invalid.text',\n    'igo.context.contextImportExport.import.invalid.title',\n    undefined,\n    {\n      value: file.name,\n      mimeType: file.type\n    }\n  );\n}\n\nexport function handleSizeFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  sizeMb: number\n) {\n  messageService.error(\n    'igo.context.contextImportExport.import.tooLarge.text',\n    'igo.context.contextImportExport.import.tooLarge.title',\n    undefined,\n    {\n      value: file.name,\n      size: sizeMb\n    }\n  );\n}\n\nexport function handleUnreadbleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.context.contextImportExport.import.unreadable.text',\n    'igo.context.contextImportExport.import.unreadable.title',\n    undefined,\n    {\n      value: file.name\n    }\n  );\n}\n\nexport function handleNothingToImportError(\n  file: File,\n  messageService: MessageService\n) {\n  messageService.error(\n    'igo.context.contextImportExport.import.empty.text',\n    'igo.context.contextImportExport.import.empty.title',\n    undefined,\n    { value: file.name }\n  );\n}\n\nexport function addContextToContextList(\n  context: DetailedContext,\n  contextTitle: string,\n  contextService: ContextService\n) {\n  context.title = contextTitle;\n  context.imported = true;\n  contextService.contexts$.value.ours.unshift(context);\n  contextService.contexts$.next(contextService.contexts$.value);\n  contextService.importedContext.unshift(context);\n  contextService.loadContext(context.uri);\n}\n\nexport function getFileExtension(file: File): string {\n  return file.name.split('.').pop().toLowerCase();\n}\n\nexport function computeLayerTitleFromFile(file: File): string {\n  return file.name.substr(0, file.name.lastIndexOf('.'));\n}\n\nexport function addImportedFeaturesToMap(\n  extraFeatures: ExtraFeatures,\n  map: IgoMap\n): VectorLayer {\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n    type: 'vector',\n    queryable: true\n  };\n\n  const olFeatures = collectFeaturesFromExtraFeatures(extraFeatures);\n  const source = new FeatureDataSource(sourceOptions);\n  source.ol.addFeatures(olFeatures);\n\n  let randomStyle;\n  let editable: boolean = false;\n  const featureKeys = olFeatures[0]?.getKeys() ?? [];\n  if (featureKeys.includes('_style') || featureKeys.includes('_mapTitle')) {\n    randomStyle = featureRandomStyleFunction();\n  } else {\n    randomStyle = featureRandomStyle();\n    editable = true;\n  }\n  const layer = new VectorLayer({\n    title: extraFeatures.name,\n    isIgoInternalLayer: true,\n    source,\n    igoStyle: { editable },\n    style: randomStyle,\n    visible: extraFeatures.visible,\n    opacity: extraFeatures.opacity\n  });\n  map.addLayer(layer);\n\n  return layer;\n}\n\nexport function addImportedFeaturesStyledToMap(\n  extraFeatures: ExtraFeatures,\n  map: IgoMap,\n  styleListService: StyleListService,\n  styleService: StyleService\n): VectorLayer {\n  let style;\n  let distance: number;\n\n  if (styleListService.getStyleList(extraFeatures.name + '.styleByAttribute')) {\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\n      extraFeatures.name + '.styleByAttribute'\n    );\n\n    style = (feature, resolution) => {\n      return styleService.createStyleByAttribute(\n        feature,\n        styleByAttribute,\n        resolution\n      );\n    };\n  } else if (\n    styleListService.getStyleList(extraFeatures.name + '.clusterStyle')\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      extraFeatures.name + '.clusterParam'\n    );\n    distance = styleListService.getStyleList(extraFeatures.name + '.distance');\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList(extraFeatures.name + '.clusterStyle'),\n        feature,\n        resolution\n      );\n      return styleService.createClusterStyle(\n        feature,\n        resolution,\n        clusterParam,\n        baseStyle\n      );\n    };\n  } else if (styleListService.getStyleList(extraFeatures.name + '.style')) {\n    style = (feature, resolution) =>\n      styleService.createStyle(\n        styleListService.getStyleList(extraFeatures.name + '.style'),\n        feature,\n        resolution\n      );\n  } else {\n    style = (feature, resolution) =>\n      styleService.createStyle(\n        styleListService.getStyleList('default.style'),\n        feature,\n        resolution\n      );\n  }\n  let source;\n  const olFeatures = collectFeaturesFromExtraFeatures(extraFeatures);\n  if (styleListService.getStyleList(extraFeatures.name + '.clusterStyle')) {\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions =\n      {\n        distance,\n        type: 'cluster',\n        queryable: true\n      };\n    source = new ClusterDataSource(sourceOptions);\n    source.ol.source.addFeatures(olFeatures);\n  } else {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions =\n      {\n        type: 'vector',\n        queryable: true\n      };\n    source = new FeatureDataSource(sourceOptions);\n    source.ol.addFeatures(olFeatures);\n  }\n\n  const layer = new VectorLayer({\n    title: extraFeatures.name,\n    isIgoInternalLayer: true,\n    source,\n    style,\n    opacity: extraFeatures.opacity,\n    visible: extraFeatures.visible\n  });\n  map.addLayer(layer);\n\n  return layer;\n}\n\nfunction collectFeaturesFromExtraFeatures(\n  featureCollection: ExtraFeatures\n): OlFeature<OlGeometry>[] {\n  const format = new GeoJSON();\n  const features = format.readFeatures(featureCollection, {\n    dataProjection: 'EPSG:4326',\n    featureProjection: 'EPSG:3857'\n  });\n  return features;\n}\n","import { Directive, OnInit, OnDestroy, Optional, Input } from '@angular/core';\n\nimport { Subscription, merge } from 'rxjs';\nimport { buffer, debounceTime, filter, first } from 'rxjs/operators';\n\nimport { RouteService, ConfigService } from '@igo2/core';\nimport {\n  MapBrowserComponent,\n  Layer,\n  LayerService,\n  LayerOptions,\n  StyleListService,\n  StyleService\n} from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { ContextService } from './context.service';\nimport { DetailedContext } from './context.interface';\nimport {\n  addImportedFeaturesToMap,\n  addImportedFeaturesStyledToMap\n} from '../../context-import-export/shared/context-import.utils';\n\n@Directive({\n  selector: '[igoLayerContext]'\n})\nexport class LayerContextDirective implements OnInit, OnDestroy {\n  private context$$: Subscription;\n  private queryParams: any;\n\n  private contextLayers: Layer[] = [];\n\n  @Input() removeLayersOnContextChange: boolean = true;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    private component: MapBrowserComponent,\n    private contextService: ContextService,\n    private layerService: LayerService,\n    private configService: ConfigService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    @Optional() private route: RouteService\n  ) {}\n\n  ngOnInit() {\n    this.context$$ = this.contextService.context$\n      .pipe(filter((context) => context !== undefined))\n      .subscribe((context) => this.handleContextChange(context));\n\n    if (\n      this.route &&\n      this.route.options.visibleOnLayersKey &&\n      this.route.options.visibleOffLayersKey &&\n      this.route.options.contextKey\n    ) {\n      this.route.queryParams\n        .pipe(first((params) => !ObjectUtils.isEmpty(params)))\n        .subscribe((params) => {\n          this.queryParams = params;\n        });\n    }\n  }\n\n  ngOnDestroy() {\n    this.context$$.unsubscribe();\n  }\n\n  private handleContextChange(context: DetailedContext) {\n    if (context.layers === undefined) {\n      return;\n    }\n    if (this.removeLayersOnContextChange === true) {\n      this.map.removeAllLayers();\n    } else {\n      this.map.removeLayers(this.contextLayers);\n    }\n    this.contextLayers = [];\n\n    const layersAndIndex$ = merge(\n      ...context.layers.map((layerOptions: LayerOptions, index: number) => {\n        return this.layerService.createAsyncLayer(layerOptions, context.uri);\n      })\n    );\n\n    layersAndIndex$\n      .pipe(buffer(layersAndIndex$.pipe(debounceTime(500))))\n      .subscribe((layers: Layer[]) => {\n        this.handleAddLayers(layers);\n\n        if (context.extraFeatures) {\n          context.extraFeatures.forEach((featureCollection) => {\n            const importExportOptions =\n              this.configService.getConfig('importExport');\n            const importWithStyle =\n              importExportOptions?.importWithStyle ||\n              this.configService.getConfig('importWithStyle');\n            if (this.configService.getConfig('importWithStyle')) {\n              console.warn(`\n              The location of this config importWithStyle is deprecated.\n              Please move this property within importExport configuration.\n              Ex: importWithStyle: true/false must be transfered to importExport: { importWithStyle: true/false }\n              Refer to environnement.ts OR config/config.json\n              This legacy conversion will be deleted in 2024.\n              `);\n            }\n            if (!importWithStyle) {\n              addImportedFeaturesToMap(featureCollection, this.map);\n            } else {\n              console.log('importWithStyle', importWithStyle);\n              addImportedFeaturesStyledToMap(\n                featureCollection,\n                this.map,\n                this.styleListService,\n                this.styleService\n              );\n            }\n          });\n        }\n      });\n\n    this.layerService\n      .createAsyncIdbLayers(context.uri)\n      .pipe(debounceTime(500))\n      .subscribe((layers: Layer[]) => this.handleAddLayers(layers));\n  }\n\n  private handleAddLayers(layers: Layer[]) {\n    layers = layers\n      .filter((layer: Layer) => layer !== undefined)\n      .map((layer) => {\n        layer.visible = this.computeLayerVisibilityFromUrl(layer);\n        layer.zIndex = layer.zIndex;\n\n        return layer;\n      });\n    this.contextLayers.concat(layers);\n    this.map.addLayers(layers);\n  }\n\n  private computeLayerVisibilityFromUrl(layer: Layer): boolean {\n    const params = this.queryParams;\n    const currentContext = this.contextService.context$.value.uri;\n    const currentLayerid: string = layer.id;\n\n    let visible = layer.visible;\n    if (!params || !currentLayerid) {\n      return visible;\n    }\n\n    const contextParams = params[this.route.options.contextKey as string];\n    if (contextParams === currentContext || !contextParams) {\n      let visibleOnLayersParams = '';\n      let visibleOffLayersParams = '';\n      let visiblelayers: string[] = [];\n      let invisiblelayers: string[] = [];\n\n      if (\n        this.route.options.visibleOnLayersKey &&\n        params[this.route.options.visibleOnLayersKey as string]\n      ) {\n        visibleOnLayersParams =\n          params[this.route.options.visibleOnLayersKey as string];\n      }\n      if (\n        this.route.options.visibleOffLayersKey &&\n        params[this.route.options.visibleOffLayersKey as string]\n      ) {\n        visibleOffLayersParams =\n          params[this.route.options.visibleOffLayersKey as string];\n      }\n\n      /* This order is important because to control whichever\n       the order of * param. First whe open and close everything.*/\n      if (visibleOnLayersParams === '*') {\n        visible = true;\n      }\n      if (visibleOffLayersParams === '*') {\n        visible = false;\n      }\n\n      // After, managing named layer by id (context.json OR id from datasource)\n      visiblelayers = visibleOnLayersParams.split(',');\n      invisiblelayers = visibleOffLayersParams.split(',');\n      if (\n        visiblelayers.indexOf(currentLayerid) > -1 ||\n        visiblelayers.indexOf(currentLayerid.toString()) > -1\n      ) {\n        visible = true;\n      }\n      if (\n        invisiblelayers.indexOf(currentLayerid) > -1 ||\n        invisiblelayers.indexOf(currentLayerid.toString()) > -1\n      ) {\n        visible = false;\n      }\n    }\n\n    return visible;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, EMPTY } from 'rxjs';\n\nimport { ConfigService } from '@igo2/core';\nimport { Poi } from './poi.interface';\n\n@Injectable()\nexport class PoiService {\n  private baseUrl: string;\n\n  constructor(\n    private http: HttpClient,\n    private config: ConfigService\n  ) {\n    this.baseUrl = this.config.getConfig('context.url');\n  }\n\n  get(): Observable<Poi[]> {\n    if (!this.baseUrl) {\n      return EMPTY;\n    }\n\n    const url = this.baseUrl + '/pois';\n    return this.http.get<Poi[]>(url);\n  }\n\n  delete(id: string): Observable<void> {\n    const url = this.baseUrl + '/pois/' + id;\n    return this.http.delete<void>(url);\n  }\n\n  create(context: Poi): Observable<Poi> {\n    const url = this.baseUrl + '/pois';\n    return this.http.post<Poi>(url, context);\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoConfirmDialogModule, IgoStopPropagationModule } from '@igo2/common';\nimport { IgoAuthModule } from '@igo2/auth';\n\nimport { BookmarkButtonComponent } from './bookmark-button/bookmark-button.component';\nimport { BookmarkDialogComponent } from './bookmark-button/bookmark-dialog.component';\nimport { PoiButtonComponent } from './poi-button/poi-button.component';\nimport { PoiDialogComponent } from './poi-button/poi-dialog.component';\nimport { PoiService } from './poi-button/shared/poi.service';\nimport { UserDialogComponent } from './user-button/user-dialog.component';\nimport { UserButtonComponent } from './user-button/user-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IgoAuthModule,\n    IgoConfirmDialogModule,\n    IgoLanguageModule,\n    IgoStopPropagationModule,\n    MatButtonModule,\n    MatDialogModule,\n    MatFormFieldModule,\n    MatIconModule,\n    MatInputModule,\n    MatOptionModule,\n    MatSelectModule,\n    MatTooltipModule\n  ],\n  exports: [\n    BookmarkButtonComponent,\n    PoiButtonComponent,\n    UserButtonComponent,\n    BookmarkDialogComponent\n  ],\n  declarations: [\n    BookmarkButtonComponent,\n    BookmarkDialogComponent,\n    PoiButtonComponent,\n    PoiDialogComponent,\n    UserButtonComponent,\n    UserDialogComponent\n  ],\n  providers: [PoiService]\n})\nexport class IgoContextMapButtonModule {\n  static forRoot(): ModuleWithProviders<IgoContextMapButtonModule> {\n    return {\n      ngModule: IgoContextMapButtonModule\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoAuthModule } from '@igo2/auth';\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoListModule,\n  IgoKeyValueModule,\n  IgoCollapsibleModule,\n  IgoStopPropagationModule,\n  IgoActionbarModule\n} from '@igo2/common';\n\nimport { MapContextDirective } from './shared/map-context.directive';\nimport { LayerContextDirective } from './shared/layer-context.directive';\nimport { ContextListComponent } from './context-list/context-list.component';\nimport { ContextListBindingDirective } from './context-list/context-list-binding.directive';\nimport { ContextItemComponent } from './context-item/context-item.component';\nimport { ContextFormComponent } from './context-form/context-form.component';\nimport { ContextEditComponent } from './context-edit/context-edit.component';\nimport { ContextEditBindingDirective } from './context-edit/context-edit-binding.directive';\nimport { ContextPermissionsComponent } from './context-permissions/context-permissions.component';\nimport { ContextPermissionsBindingDirective } from './context-permissions/context-permissions-binding.directive';\nimport { IgoContextMapButtonModule } from '../context-map-button/context-map-button.module';\nimport { IgoContextImportExportModule } from '../context-import-export/context-import-export.module';\n\nconst CONTEXT_DIRECTIVES = [MapContextDirective, LayerContextDirective];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    MatListModule,\n    MatCheckboxModule,\n    MatRadioModule,\n    MatDialogModule,\n    MatMenuModule,\n    MatOptionModule,\n    MatAutocompleteModule,\n    IgoAuthModule,\n    IgoListModule,\n    IgoKeyValueModule,\n    IgoCollapsibleModule,\n    IgoStopPropagationModule,\n    IgoLanguageModule,\n    IgoContextImportExportModule,\n    IgoContextMapButtonModule,\n    IgoActionbarModule\n  ],\n  exports: [\n    ContextListComponent,\n    ContextListBindingDirective,\n    ContextItemComponent,\n    ContextFormComponent,\n    ContextEditComponent,\n    ContextEditBindingDirective,\n    ContextPermissionsComponent,\n    ContextPermissionsBindingDirective,\n\n    ...CONTEXT_DIRECTIVES\n  ],\n  declarations: [\n    ContextListComponent,\n    ContextListBindingDirective,\n    ContextItemComponent,\n    ContextFormComponent,\n    ContextEditComponent,\n    ContextEditBindingDirective,\n    ContextPermissionsComponent,\n    ContextPermissionsBindingDirective,\n\n    ...CONTEXT_DIRECTIVES\n  ]\n})\nexport class IgoContextManagerModule {\n  static forRoot(): ModuleWithProviders<IgoContextManagerModule> {\n    return {\n      ngModule: IgoContextManagerModule\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatTabsModule } from '@angular/material/tabs';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { ShareMapComponent } from './share-map/share-map.component';\nimport { ShareMapUrlComponent } from './share-map/share-map-url.component';\nimport { ShareMapApiComponent } from './share-map/share-map-api.component';\nimport { IgoCustomHtmlModule } from '@igo2/common';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatTabsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    IgoCustomHtmlModule\n  ],\n  exports: [ShareMapComponent, ShareMapUrlComponent, ShareMapApiComponent],\n  declarations: [ShareMapComponent, ShareMapUrlComponent, ShareMapApiComponent]\n})\nexport class IgoShareMapModule {\n  static forRoot(): ModuleWithProviders<IgoShareMapModule> {\n    return {\n      ngModule: IgoShareMapModule\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSidenavModule } from '@angular/material/sidenav';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoPanelModule, IgoFlexibleModule } from '@igo2/common';\nimport { IgoFeatureModule } from '@igo2/geo';\n\nimport { IgoContextManagerModule } from '../context-manager/context-manager.module';\nimport { SidenavComponent } from './sidenav.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSidenavModule,\n    MatTooltipModule,\n    IgoLanguageModule,\n    IgoPanelModule,\n    IgoFlexibleModule,\n    IgoFeatureModule,\n    IgoContextManagerModule\n  ],\n  exports: [SidenavComponent],\n  declarations: [SidenavComponent]\n})\nexport class IgoSidenavModule {\n  static forRoot(): ModuleWithProviders<IgoSidenavModule> {\n    return {\n      ngModule: IgoSidenavModule\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatMenuModule } from '@angular/material/menu';\n\nimport { IgoContextImportExportModule } from './context-import-export/context-import-export.module';\nimport { IgoContextManagerModule } from './context-manager/context-manager.module';\nimport { IgoContextMapButtonModule } from './context-map-button/context-map-button.module';\nimport { IgoShareMapModule } from './share-map/share-map.module';\nimport { IgoSidenavModule } from './sidenav/sidenav.module';\n\n@NgModule({\n  imports: [MatInputModule, MatFormFieldModule, MatMenuModule],\n  declarations: [],\n  exports: [\n    IgoContextImportExportModule,\n    IgoContextManagerModule,\n    IgoContextMapButtonModule,\n    IgoShareMapModule,\n    IgoSidenavModule\n  ]\n})\nexport class IgoContextModule {\n  static forRoot(): ModuleWithProviders<IgoContextModule> {\n    return {\n      ngModule: IgoContextModule,\n      providers: []\n    };\n  }\n}\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid context');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { downloadContent } from '@igo2/utils';\n\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\nimport { ExportNothingToExportError } from './context-export.errors';\nimport { Observer, Observable } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextExportService {\n  export(res: DetailedContext): Observable<void> {\n    return this.exportAsync(res);\n  }\n\n  protected exportAsync(res: DetailedContext): Observable<void> {\n    const doExport = (observer: Observer<void>) => {\n      const nothingToExport = this.nothingToExport(res);\n      if (nothingToExport === true) {\n        observer.error(new ExportNothingToExportError());\n        return;\n      }\n      const contextJSON = JSON.stringify(res);\n      downloadContent(\n        contextJSON,\n        'text/json;charset=utf-8',\n        `${res.uri}.json`\n      );\n      observer.complete();\n    };\n    return new Observable(doExport);\n  }\n\n  protected nothingToExport(res: DetailedContext): boolean {\n    if (res.map === undefined) {\n      return true;\n    }\n    return false;\n  }\n}\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n    super('Failed to read file');\n    Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n    super('Nothing to import');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n    super('File is too large');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n    super('Invalid SRS definition');\n    Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, Observer } from 'rxjs';\nimport { ConfigService } from '@igo2/core';\n\nimport {\n  ImportInvalidFileError,\n  ImportUnreadableFileError,\n  ImportSizeError\n} from './context-import.errors';\nimport { getFileExtension } from './context-import.utils';\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextImportService {\n  static allowedMimeTypes = ['application/json'];\n\n  static allowedExtensions = 'json';\n\n  private clientSideFileSizeMax: number;\n\n  constructor(private config: ConfigService) {\n    const configFileSizeMb = this.config.getConfig(\n      'importExport.clientSideFileSizeMaxMb'\n    );\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n  }\n\n  import(file: File): Observable<DetailedContext> {\n    return this.importAsync(file);\n  }\n\n  private getFileImporter(\n    file: File\n  ): (\n    file: File,\n    observer: Observer<DetailedContext>,\n    projectionIn: string,\n    projectionOut: string\n  ) => void {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n    const allowedMimeTypes = [...ContextImportService.allowedMimeTypes];\n    const allowedExtensions = ContextImportService.allowedExtensions;\n\n    if (\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\n      allowedExtensions.indexOf(extension) < 0\n    ) {\n      return undefined;\n    } else if (\n      mimeType === 'application/json' ||\n      extension === ContextImportService.allowedExtensions\n    ) {\n      return this.importFile;\n    }\n    return undefined;\n  }\n\n  private importAsync(file: File): Observable<DetailedContext> {\n    const doImport = (observer: Observer<DetailedContext>) => {\n      if (file.size >= this.clientSideFileSizeMax) {\n        observer.error(new ImportSizeError());\n        return;\n      }\n      const importer = this.getFileImporter(file);\n      if (importer === undefined) {\n        observer.error(new ImportInvalidFileError());\n        return;\n      }\n\n      importer.call(this, file, observer);\n    };\n\n    return new Observable(doImport);\n  }\n\n  private importFile(file: File, observer: Observer<DetailedContext>) {\n    const reader = new FileReader();\n\n    reader.onload = (event: any) => {\n      try {\n        const context = this.parseContextFromFile(file, event.target.result);\n        observer.next(context);\n      } catch (e) {\n        observer.error(new ImportUnreadableFileError());\n      }\n\n      observer.complete();\n    };\n\n    reader.onerror = (evt) => {\n      observer.error(new ImportUnreadableFileError());\n    };\n\n    reader.readAsText(file, 'UTF-8');\n  }\n\n  private parseContextFromFile(file: File, data: string): DetailedContext {\n    const context: DetailedContext = JSON.parse(data);\n    return context;\n  }\n}\n","<div class=\"import-export-toggle mat-typography\">\n  <mat-button-toggle-group\n    [value]=\"activeImportExport\"\n    (change)=\"onImportExportChange($event)\"\n  >\n    <mat-button-toggle [value]=\"'import'\">\n      {{ 'igo.geo.importExportForm.importTabTitle' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle [value]=\"'export'\">\n      {{ 'igo.geo.importExportForm.exportTabTitle' | translate }}\n    </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<div *ngIf=\"activeImportExport === 'import'\">\n  <form class=\"igo-form\">\n    <div class=\"igo-form-button-group\">\n      <button\n        mat-raised-button\n        type=\"button\"\n        (click)=\"fileInput.click()\"\n        [disabled]=\"loading$ | async\"\n      >\n        {{ 'igo.geo.importExportForm.importButton' | translate }}\n      </button>\n      <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n      <input\n        #fileInput\n        type=\"file\"\n        [style.display]=\"'none'\"\n        (click)=\"fileInput.value = null\"\n        (change)=\"importFiles($event.target.files)\"\n      />\n    </div>\n  </form>\n  <section class=\"mat-typography\">\n    <h4>{{ 'igo.geo.importExportForm.importClarifications' | translate }}</h4>\n    <ul>\n      <li>\n        {{\n          'igo.geo.importExportForm.importSizeMax'\n            | translate: { size: fileSizeMb }\n        }}\n      </li>\n    </ul>\n  </section>\n</div>\n\n<form\n  class=\"igo-form\"\n  *ngIf=\"activeImportExport === 'export'\"\n  [formGroup]=\"form\"\n>\n  <div class=\"igo-input-container\">\n    <mat-form-field class=\"example-full-width\">\n      <mat-label>{{\n        'igo.context.contextImportExport.export.exportContextName' | translate\n      }}</mat-label>\n      <input formControlName=\"name\" matInput [value]=\"\" />\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.context.contextImportExport.export.exportPlaceHolder' | translate\n      }}</mat-label>\n      <mat-select formControlName=\"layers\" multiple>\n        <mat-option [value]=\"1\" (click)=\"selectAll(e)\" #e>\n          {{\n            'igo.context.contextImportExport.export.exportSelectAll' | translate\n          }}\n        </mat-option>\n        <mat-divider></mat-divider>\n        <mat-option\n          *ngFor=\"let layer of userControlledLayerList\"\n          [value]=\"layer\"\n          >{{ layer.title }}</mat-option\n        >\n      </mat-select>\n    </mat-form-field>\n  </div>\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (loading$ | async)\"\n      (click)=\"handleExportFormSubmit(form.value)\"\n    >\n      {{ 'igo.geo.importExportForm.exportButton' | translate }}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n  </div>\n</form>\n","import { Component, Input, OnInit, OnDestroy } from '@angular/core';\nimport {\n  UntypedFormGroup,\n  UntypedFormBuilder,\n  Validators\n} from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { MessageService, ConfigService } from '@igo2/core';\nimport { Layer, VectorLayer } from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { handleFileExportError } from '../shared/context-export.utils';\nimport {\n  handleFileImportSuccess,\n  handleFileImportError\n} from '../shared/context-import.utils';\nimport { handleFileExportSuccess } from '../shared/context-export.utils';\nimport { ContextService } from '../../context-manager/shared/context.service';\nimport { ContextImportService } from '../shared/context-import.service';\nimport { ContextExportService } from '../shared/context-export.service';\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\n\n@Component({\n  selector: 'igo-context-import-export',\n  templateUrl: './context-import-export.component.html',\n  styleUrls: ['./context-import-export.component.scss']\n})\nexport class ContextImportExportComponent implements OnInit, OnDestroy {\n  public form: UntypedFormGroup;\n  public layers: VectorLayer[];\n  public inputProj: string = 'EPSG:4326';\n  public loading$ = new BehaviorSubject(false);\n  public forceNaming = false;\n  public layerList: Layer[];\n  public userControlledLayerList: Layer[];\n  public res: DetailedContext;\n  private clientSideFileSizeMax: number;\n  public fileSizeMb: number;\n  public activeImportExport: string = 'import';\n\n  private layers$$: Subscription;\n\n  @Input() map: IgoMap;\n\n  constructor(\n    private contextImportService: ContextImportService,\n    private contextExportService: ContextExportService,\n    private messageService: MessageService,\n    private formBuilder: UntypedFormBuilder,\n    private config: ConfigService,\n    private contextService: ContextService\n  ) {\n    this.buildForm();\n  }\n\n  ngOnInit() {\n    const configFileSizeMb = this.config.getConfig(\n      'importExport.clientSideFileSizeMaxMb'\n    );\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\n    this.layers$$ = this.map.layers$.subscribe(() => {\n      this.layerList = this.contextService.getContextLayers(this.map);\n      this.userControlledLayerList = this.layerList.filter(\n        (layer) => layer.showInLayerList\n      );\n    });\n  }\n\n  importFiles(files: File[]) {\n    this.loading$.next(true);\n    for (const file of files) {\n      this.contextImportService\n        .import(file)\n        .pipe(take(1))\n        .subscribe(\n          (context: DetailedContext) => this.onFileImportSuccess(file, context),\n          (error: Error) => this.onFileImportError(file, error),\n          () => {\n            this.loading$.next(false);\n          }\n        );\n    }\n  }\n\n  handleExportFormSubmit(contextOptions) {\n    this.loading$.next(true);\n    this.res = this.contextService.getContextFromLayers(\n      this.map,\n      contextOptions.layers,\n      contextOptions.name,\n      false\n    );\n    this.res.imported = true;\n    this.contextExportService\n      .export(this.res)\n      .pipe(take(1))\n      .subscribe(\n        () => {},\n        (error: Error) => this.onFileExportError(error),\n        () => {\n          this.onFileExportSuccess();\n          this.loading$.next(false);\n        }\n      );\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      layers: ['', [Validators.required]],\n      name: ['', [Validators.required]]\n    });\n  }\n\n  private onFileImportSuccess(file: File, context: DetailedContext) {\n    handleFileImportSuccess(\n      file,\n      context,\n      this.messageService,\n      this.contextService\n    );\n  }\n\n  private onFileImportError(file: File, error: Error) {\n    this.loading$.next(false);\n    handleFileImportError(file, error, this.messageService, this.fileSizeMb);\n  }\n\n  private onFileExportError(error: Error) {\n    this.loading$.next(false);\n    handleFileExportError(error, this.messageService);\n  }\n\n  private onFileExportSuccess() {\n    handleFileExportSuccess(this.messageService);\n  }\n\n  selectAll(e) {\n    if (e._selected) {\n      this.form.controls.layers.setValue(this.userControlledLayerList);\n      e._selected = true;\n    }\n    if (e._selected === false) {\n      this.form.controls.layers.setValue([]);\n    }\n  }\n\n  onImportExportChange(event) {\n    this.activeImportExport = event.value;\n  }\n\n  ngOnDestroy(): void {\n    this.layers$$.unsubscribe();\n  }\n}\n","import { MessageService } from '@igo2/core';\nimport { ExportNothingToExportError } from './context-export.errors';\n\nexport function handleFileExportError(\n  error: Error,\n  messageService: MessageService\n) {\n  if (error instanceof ExportNothingToExportError) {\n    this.handleNothingToExportError(messageService);\n    return;\n  }\n  messageService.error(\n    'igo.context.contextImportExport.export.failed.text',\n    'igo.context.contextImportExport.export.failed.title'\n  );\n}\n\nexport function handleFileExportSuccess(messageService: MessageService) {\n  messageService.success(\n    'igo.context.contextImportExport.export.success.text',\n    'igo.context.contextImportExport.export.success.title'\n  );\n}\n\nexport function handleNothingToExportError(messageService: MessageService) {\n  messageService.error(\n    'igo.context.contextImportExport.export.nothing.text',\n    'igo.context.contextImportExport.export.nothing.title'\n  );\n}\n","export enum ContextListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\n","import { Component } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\n@Component({\n  selector: 'igo-bookmark-dialog',\n  templateUrl: './bookmark-dialog.component.html'\n})\nexport class BookmarkDialogComponent {\n  public title: string;\n\n  constructor(public dialogRef: MatDialogRef<BookmarkDialogComponent>) {}\n}\n","<h1 mat-dialog-title class=\"mat-typography\">\n  {{ 'igo.context.bookmarkButton.dialog.title' | translate }}\n</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <mat-form-field>\n    <input\n      matInput\n      required\n      autocomplete=\"off\"\n      maxlength=\"128\"\n      [placeholder]=\"\n        'igo.context.bookmarkButton.dialog.placeholder' | translate\n      \"\n      [(ngModel)]=\"title\"\n    />\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button\n    mat-button\n    color=\"primary\"\n    [disabled]=\"!title\"\n    (click)=\"dialogRef.close(title)\"\n  >\n    {{ 'igo.common.confirmDialog.confirmBtn' | translate }}\n  </button>\n  <button mat-button (click)=\"dialogRef.close(false)\">\n    {{ 'igo.common.confirmDialog.cancelBtn' | translate }}\n  </button>\n</div>\n","<mat-list-item\n  class=\"mat-list-item\"\n  [ngClass]=\"{ 'mat-list-item-light': hidden }\"\n>\n  <button\n    *ngIf=\"auth.authenticated\"\n    matListItemAvatar\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"\n      auth.authenticated\n        ? ('igo.context.contextManager.favorite' | translate)\n        : ''\n    \"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\"\n  >\n    <mat-icon\n      *ngIf=\"!context.iconImage\"\n      svgIcon=\"{{\n        context.icon\n          ? context.icon\n          : context.scope === 'public'\n          ? 'earth'\n          : 'star'\n      }}\"\n    ></mat-icon>\n    <img *ngIf=\"context.iconImage\" [src]=\"context.iconImage\" />\n  </button>\n  <button\n    matListItemAvatar\n    *ngIf=\"!auth.authenticated && showFavorite\"\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"'igo.context.contextManager.favorite' | translate\"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\"\n  >\n    <mat-icon svgIcon=\"star\"></mat-icon>\n  </button>\n  <span matListItemTitle>{{ context.title }}</span>\n\n  <div\n    *ngIf=\"auth.authenticated\"\n    matListItemMeta\n    igoStopPropagation\n    class=\"igo-actions-container\"\n  >\n    <button\n      *ngIf=\"\n        collapsed &&\n        selected &&\n        (context.permission === typePermission[typePermission.write] ||\n          context.imported)\n      \"\n      class=\"save-button\"\n      mat-icon-button\n      [matTooltip]=\"'igo.context.contextManager.save' | translate\"\n      matTooltipShowDelay=\"500\"\n      [color]=\"color\"\n      (click)=\"save.emit(context)\"\n    >\n      <mat-icon svgIcon=\"content-save\"></mat-icon>\n    </button>\n\n    <div #actions class=\"igo-actions-expand-container\">\n      <button\n        *ngIf=\"canShare && !context.imported\"\n        mat-icon-button\n        [matTooltip]=\"\n          'igo.context.contextManager.managePermissions' | translate\n        \"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"managePermissions.emit(context)\"\n      >\n        <mat-icon svgIcon=\"account-arrow-right\"></mat-icon>\n      </button>\n\n      <!--button\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.manageTools' | translate\"\n        [color]=\"color\"\n        (click)=\"manageTools.emit(context)\">\n        <mat-icon svgIcon=\"widgets\"></mat-icon>\n      </button-->\n\n      <button\n        *ngIf=\"!context.imported\"\n        class=\"clone-button\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.clone' | translate\"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"clone.emit(context)\"\n      >\n        <mat-icon svgIcon=\"content-copy\"></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"\n          context.permission === typePermission[typePermission.write] &&\n          !context.imported\n        \"\n        class=\"edit-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.edit' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"edit.emit(context)\"\n      >\n        <mat-icon svgIcon=\"pencil\"></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"!context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.hide' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"hide.emit(context)\"\n      >\n        <mat-icon svgIcon=\"eye\"></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.show' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"show.emit(context)\"\n      >\n        <mat-icon svgIcon=\"eye-off\"></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"\n          context.permission === typePermission[typePermission.write] ||\n          context.imported\n        \"\n        class=\"delete-button\"\n        mat-icon-button\n        color=\"warn\"\n        [matTooltip]=\"'igo.context.contextManager.delete' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"delete.emit(context)\"\n      >\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n    </div>\n\n    <button\n      class=\"actions-button\"\n      mat-icon-button\n      igoCollapse\n      [color]=\"color\"\n      [target]=\"actions\"\n      [collapsed]=\"collapsed\"\n      (click)=\"collapsed = !collapsed\"\n    >\n      <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\n    </button>\n  </div>\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { StorageService } from '@igo2/core';\nimport { AuthService } from '@igo2/auth';\nimport { TypePermission } from '../shared/context.enum';\nimport { DetailedContext } from '../shared/context.interface';\n\n@Component({\n  selector: 'igo-context-item',\n  templateUrl: './context-item.component.html',\n  styleUrls: ['./context-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ContextItemComponent {\n  public typePermission = TypePermission;\n  public color = 'primary';\n  public collapsed = true;\n\n  @Input() showFavorite: boolean = true;\n  @Input() context: DetailedContext;\n  @Input() default: boolean;\n  @Input() selected: boolean;\n\n  @Output() edit = new EventEmitter<DetailedContext>();\n  @Output() delete = new EventEmitter<DetailedContext>();\n  @Output() save = new EventEmitter<DetailedContext>();\n  @Output() clone = new EventEmitter<DetailedContext>();\n  @Output() hide = new EventEmitter<DetailedContext>();\n  @Output() show = new EventEmitter<DetailedContext>();\n  @Output() favorite = new EventEmitter<DetailedContext>();\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\n  @Output() manageTools = new EventEmitter<DetailedContext>();\n\n  get hidden(): boolean {\n    return this.context.hidden;\n  }\n\n  get canShare(): boolean {\n    return this.storageService.get('canShare') === true;\n  }\n\n  constructor(\n    public auth: AuthService,\n    private storageService: StorageService\n  ) {}\n\n  favoriteClick(context: DetailedContext) {\n    this.favorite.emit(context);\n  }\n}\n","<igo-list [navigation]=\"true\">\n  <div class=\"context-filter-container\">\n    <mat-form-field *ngIf=\"showFilter()\" floatLabel=\"always\">\n      <mat-label>{{\n        'igo.context.contextManager.filterPlaceHolder' | translate\n      }}</mat-label>\n      <input\n        matInput\n        type=\"text\"\n        [placeholder]=\"\n          'igo.context.contextManager.filterPlaceHolder' | translate\n        \"\n        [(ngModel)]=\"term\"\n      />\n      <button\n        mat-icon-button\n        matSuffix\n        class=\"clear-button\"\n        *ngIf=\"term.length\"\n        aria-label=\"Clear\"\n        color=\"warn\"\n        (click)=\"clearFilter()\"\n      >\n        <mat-icon svgIcon=\"close\"></mat-icon>\n      </button>\n    </mat-form-field>\n\n    <div class=\"actions-container\">\n      <button\n        *ngIf=\"!sortedAlpha\"\n        class=\"sort-alpha\"\n        mat-icon-button\n        [matTooltip]=\"\n          'igo.context.contextManager.sortAlphabetically' | translate\n        \"\n        matTooltipShowDelay=\"500\"\n        (click)=\"toggleSort(true)\"\n      >\n        <mat-icon\n          color=\"primary\"\n          svgIcon=\"sort-alphabetical-variant\"\n        ></mat-icon>\n      </button>\n      <button\n        *ngIf=\"sortedAlpha\"\n        class=\"sort-alpha\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.sortContextOrder' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"toggleSort(false)\"\n      >\n        <mat-icon color=\"warn\" svgIcon=\"sort-variant-remove\"></mat-icon>\n      </button>\n\n      <igo-actionbar\n        *ngIf=\"auth.authenticated && configService.getConfig('context')\"\n        class=\"add-context-button\"\n        [iconColor]=\"color\"\n        [store]=\"actionStore\"\n        [withIcon]=\"true\"\n        icon=\"plus\"\n        [withTitle]=\"actionbarMode === 'overlay'\"\n        [horizontal]=\"false\"\n        [mode]=\"actionbarMode\"\n      >\n      </igo-actionbar>\n\n      <button\n        *ngIf=\"auth.authenticated && configService.getConfig('context')\"\n        class=\"users-filter\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.filterUser' | translate\"\n        matTooltipShowDelay=\"500\"\n        [matMenuTriggerFor]=\"accountMenu\"\n      >\n        <mat-icon color=\"primary\" svgIcon=\"filter-menu\"></mat-icon>\n      </button>\n      <mat-menu #accountMenu=\"matMenu\">\n        <ng-container *ngFor=\"let user of users\">\n          <span class=\"profilsMenu\">\n            <div mat-menu-item>\n              <mat-checkbox\n                [checked]=\"getPermission(user).checked\"\n                [indeterminate]=\"getPermission(user).indeterminate\"\n                (click)=\"$event.stopPropagation()\"\n                (change)=\"userSelection(user)\"\n              >\n              </mat-checkbox>\n            </div>\n            <button\n              *ngIf=\"user.childs\"\n              [matMenuTriggerFor]=\"subAccountMenu\"\n              mat-menu-item\n            >\n              {{ user.title }}\n            </button>\n            <button mat-menu-item *ngIf=\"!user.childs\">\n              {{ user.title }}\n            </button>\n          </span>\n\n          <mat-menu #subAccountMenu=\"matMenu\">\n            <div mat-menu-item>\n              <mat-checkbox\n                *ngFor=\"let child of user.childs\"\n                [checked]=\"getPermission(child).checked\"\n                (click)=\"$event.stopPropagation()\"\n                (change)=\"userSelection(child, user)\"\n              >\n                {{ child.title }}\n              </mat-checkbox>\n            </div>\n          </mat-menu>\n        </ng-container>\n\n        <span class=\"profilsMenu\">\n          <div mat-menu-item>\n            <mat-checkbox\n              [checked]=\"showHidden\"\n              (click)=\"$event.stopPropagation()\"\n              (change)=\"showHiddenContexts.emit()\"\n            >\n            </mat-checkbox>\n          </div>\n          <button mat-menu-item>\n            {{ 'igo.context.contextManager.showHidden' | translate }}\n          </button>\n        </span>\n      </mat-menu>\n    </div>\n  </div>\n\n  <ng-template ngFor let-groupContexts [ngForOf]=\"contexts$ | async | keyvalue\">\n    <igo-collapsible\n      *ngIf=\"groupContexts.value.length && auth.authenticated\"\n      [title]=\"titleMapping[groupContexts.key] | translate\"\n      [collapsed]=\"collapsed[titleMapping[groupContexts.key]]\"\n      (toggle)=\"collapsed[titleMapping[groupContexts.key]] = $event\"\n    >\n      <ng-template ngFor let-context [ngForOf]=\"groupContexts.value\">\n        <igo-context-item\n          igoListItem\n          color=\"accent\"\n          [selected]=\"selectedContext && selectedContext.uri === context.uri\"\n          [context]=\"context\"\n          [default]=\"\n            context.id &&\n            this.defaultContextId &&\n            this.defaultContextId === context.id\n          \"\n          (edit)=\"edit.emit(context)\"\n          (delete)=\"delete.emit(context)\"\n          (clone)=\"clone.emit(context)\"\n          (save)=\"save.emit(context)\"\n          (hide)=\"hideContext(context)\"\n          (show)=\"showContext(context)\"\n          (favorite)=\"favorite.emit(context)\"\n          (manageTools)=\"manageTools.emit(context)\"\n          (managePermissions)=\"managePermissions.emit(context)\"\n          (select)=\"select.emit(context)\"\n          (unselect)=\"unselect.emit(context)\"\n        >\n        </igo-context-item>\n      </ng-template>\n    </igo-collapsible>\n\n    <ng-template\n      *ngIf=\"groupContexts.value.length && !auth.authenticated\"\n      ngFor\n      let-context\n      [ngForOf]=\"groupContexts.value\"\n    >\n      <igo-context-item\n        igoListItem\n        color=\"accent\"\n        [showFavorite]=\"\n          configService.getConfig('favoriteContext4NonAuthenticated')\n        \"\n        [selected]=\"selectedContext && selectedContext.uri === context.uri\"\n        [context]=\"context\"\n        [default]=\"\n          configService.getConfig('context')\n            ? defaultContextId === context.id\n            : defaultContextId === context.uri\n        \"\n        (favorite)=\"favorite.emit(context)\"\n        (select)=\"select.emit(context)\"\n        (unselect)=\"unselect.emit(context)\"\n      >\n      </igo-context-item>\n    </ng-template>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectorRef,\n  OnInit,\n  ChangeDetectionStrategy,\n  OnDestroy\n} from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\nimport type { IgoMap } from '@igo2/geo';\n\nimport {\n  DetailedContext,\n  ContextsList,\n  ContextUserPermission,\n  ContextProfils\n} from '../shared/context.interface';\nimport { ContextListControlsEnum } from './context-list.enum';\nimport {\n  Subscription,\n  BehaviorSubject,\n  ReplaySubject,\n  EMPTY,\n  timer\n} from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { MatDialog } from '@angular/material/dialog';\nimport { BookmarkDialogComponent } from '../../context-map-button/bookmark-button/bookmark-dialog.component';\nimport { debounce } from 'rxjs/operators';\nimport { ActionStore, ActionbarMode } from '@igo2/common';\n\n@Component({\n  selector: 'igo-context-list',\n  templateUrl: './context-list.component.html',\n  styleUrls: ['./context-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ContextListComponent implements OnInit, OnDestroy {\n  private contextsInitial: ContextsList = { ours: [] };\n  contexts$: BehaviorSubject<ContextsList> = new BehaviorSubject(\n    this.contextsInitial\n  );\n\n  change$ = new ReplaySubject<void>(1);\n\n  private change$$: Subscription;\n\n  @Input()\n  get contexts(): ContextsList {\n    return this._contexts;\n  }\n  set contexts(value: ContextsList) {\n    this._contexts = value;\n    this.cdRef.detectChanges();\n    this.next();\n  }\n  private _contexts: ContextsList = { ours: [] };\n\n  @Input()\n  get selectedContext(): DetailedContext {\n    return this._selectedContext;\n  }\n  set selectedContext(value: DetailedContext) {\n    this._selectedContext = value;\n    this.cdRef.detectChanges();\n  }\n  private _selectedContext: DetailedContext;\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get defaultContextId(): string {\n    return this.configService.getConfig('context')\n      ? this._defaultContextId\n      : (this.storageService.get('favorite.context.uri') as string) ||\n          this._defaultContextId;\n  }\n  set defaultContextId(value: string) {\n    this._defaultContextId = value;\n  }\n  private _defaultContextId: string;\n\n  public collapsed: { contextScope }[] = [];\n\n  @Output() select = new EventEmitter<DetailedContext>();\n  @Output() unselect = new EventEmitter<DetailedContext>();\n  @Output() edit = new EventEmitter<DetailedContext>();\n  @Output() delete = new EventEmitter<DetailedContext>();\n  @Output() save = new EventEmitter<DetailedContext>();\n  @Output() clone = new EventEmitter<DetailedContext>();\n  @Output() create = new EventEmitter<{ title: string; empty: boolean }>();\n  @Output() hide = new EventEmitter<DetailedContext>();\n  @Output() show = new EventEmitter<DetailedContext>();\n  @Output() showHiddenContexts = new EventEmitter<boolean>();\n  @Output() favorite = new EventEmitter<DetailedContext>();\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\n  @Output() manageTools = new EventEmitter<DetailedContext>();\n  @Output() filterPermissionsChanged = new EventEmitter<\n    ContextUserPermission[]\n  >();\n\n  public titleMapping = {\n    ours: 'igo.context.contextManager.ourContexts',\n    shared: 'igo.context.contextManager.sharedContexts',\n    public: 'igo.context.contextManager.publicContexts'\n  };\n\n  public users: ContextProfils[];\n  public permissions: ContextUserPermission[] = [];\n\n  public actionStore = new ActionStore([]);\n  public actionbarMode = ActionbarMode.Overlay;\n\n  public color = 'primary';\n\n  public showHidden = false;\n\n  /**\n   * Context filter term\n   */\n  @Input()\n  set term(value: string) {\n    this._term = value;\n    this.next();\n  }\n  get term(): string {\n    return this._term;\n  }\n  public _term: string = '';\n\n  get sortedAlpha(): boolean {\n    return this._sortedAlpha;\n  }\n  set sortedAlpha(value: boolean) {\n    this._sortedAlpha = value;\n    this.next();\n  }\n  private _sortedAlpha: boolean = undefined;\n\n  public showContextFilter = ContextListControlsEnum.always;\n\n  public thresholdToFilter = 5;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    public configService: ConfigService,\n    public auth: AuthService,\n    private dialog: MatDialog,\n    private languageService: LanguageService,\n    private storageService: StorageService\n  ) {}\n\n  ngOnInit() {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.contexts.ours.length === 0 &&\n            this.contexts.public?.length === 0 &&\n            this.contexts.shared?.length === 0\n            ? EMPTY\n            : timer(50);\n        })\n      )\n      .subscribe(() => {\n        this.contexts$.next(this.filterContextsList(this.contexts));\n      });\n\n    this.actionStore.load([\n      {\n        id: 'emptyContext',\n        title: this.languageService.translate.instant(\n          'igo.context.contextManager.emptyContext'\n        ),\n        icon: 'map-outline',\n        tooltip: this.languageService.translate.instant(\n          'igo.context.contextManager.emptyContextTooltip'\n        ),\n        handler: () => {\n          this.createContext(true);\n        }\n      },\n      {\n        id: 'contextFromMap',\n        title: this.languageService.translate.instant(\n          'igo.context.contextManager.contextMap'\n        ),\n        icon: 'map-check',\n        tooltip: this.languageService.translate.instant(\n          'igo.context.contextManager.contextMapTooltip'\n        ),\n        handler: () => {\n          this.createContext(false);\n        }\n      }\n    ]);\n  }\n\n  private next() {\n    this.change$.next();\n  }\n\n  private filterContextsList(contexts: ContextsList) {\n    if (this.term === '') {\n      if (this.sortedAlpha) {\n        contexts = this.sortContextsList(contexts);\n      }\n      return contexts;\n    } else {\n      const ours = contexts.ours.filter((context) => {\n        const filterNormalized = this.term\n          .toLowerCase()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const contextTitleNormalized = context.title\n          .toLowerCase()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        return contextTitleNormalized.includes(filterNormalized);\n      });\n\n      let updateContexts: ContextsList = {\n        ours\n      };\n\n      if (this.contexts.public) {\n        const publics = contexts.public.filter((context) => {\n          const filterNormalized = this.term\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          const contextTitleNormalized = context.title\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          return contextTitleNormalized.includes(filterNormalized);\n        });\n        updateContexts.public = publics;\n      }\n\n      if (this.contexts.shared) {\n        const shared = contexts.shared.filter((context) => {\n          const filterNormalized = this.term\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          const contextTitleNormalized = context.title\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          return contextTitleNormalized.includes(filterNormalized);\n        });\n        updateContexts.shared = shared;\n      }\n\n      if (this.sortedAlpha) {\n        updateContexts = this.sortContextsList(updateContexts);\n      }\n      return updateContexts;\n    }\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n  }\n\n  public showFilter() {\n    switch (this.showContextFilter) {\n      case ContextListControlsEnum.always:\n        return true;\n      case ContextListControlsEnum.never:\n        return false;\n      default:\n        let totalLength = this.contexts.ours.length;\n        this.contexts.public\n          ? (totalLength += this.contexts.public.length)\n          : (totalLength += 0);\n        this.contexts.shared\n          ? (totalLength += this.contexts.shared.length)\n          : (totalLength += 0);\n        if (totalLength >= this.thresholdToFilter) {\n          return true;\n        }\n        return false;\n    }\n  }\n\n  sortContextsList(contexts: ContextsList) {\n    if (contexts) {\n      const contextsList = JSON.parse(JSON.stringify(contexts));\n      contextsList.ours.sort((a, b) => {\n        if (this.normalize(a.title) < this.normalize(b.title)) {\n          return -1;\n        }\n        if (this.normalize(a.title) > this.normalize(b.title)) {\n          return 1;\n        }\n        return 0;\n      });\n\n      if (contextsList.shared) {\n        contextsList.shared.sort((a, b) => {\n          if (this.normalize(a.title) < this.normalize(b.title)) {\n            return -1;\n          }\n          if (this.normalize(a.title) > this.normalize(b.title)) {\n            return 1;\n          }\n          return 0;\n        });\n      } else if (contextsList.public) {\n        contextsList.public.sort((a, b) => {\n          if (this.normalize(a.title) < this.normalize(b.title)) {\n            return -1;\n          }\n          if (this.normalize(a.title) > this.normalize(b.title)) {\n            return 1;\n          }\n          return 0;\n        });\n      }\n      return contextsList;\n    }\n  }\n\n  normalize(str: string) {\n    return str\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .toLowerCase();\n  }\n\n  toggleSort(sortAlpha: boolean) {\n    this.sortedAlpha = sortAlpha;\n  }\n\n  clearFilter() {\n    this.term = '';\n  }\n\n  createContext(empty?: boolean) {\n    this.dialog\n      .open(BookmarkDialogComponent, { disableClose: false })\n      .afterClosed()\n      .pipe(take(1))\n      .subscribe((title: string) => {\n        if (title) {\n          this.create.emit({ title, empty });\n        }\n      });\n  }\n\n  getPermission(user?): ContextUserPermission {\n    if (user) {\n      const permission = this.permissions.find((p) => p.name === user.name);\n      return permission;\n    }\n  }\n\n  userSelection(user, parent?) {\n    const permission = this.getPermission(user);\n    if (permission) {\n      permission.checked = !permission.checked;\n      this.storageService.set(\n        'contexts.permissions.' + permission.name,\n        permission.checked\n      );\n      permission.indeterminate = false;\n    }\n\n    if (parent) {\n      let indeterminate = false;\n\n      for (const c of parent.childs) {\n        const cPermission = this.getPermission(c);\n        if (cPermission.checked !== permission.checked) {\n          indeterminate = true;\n          break;\n        }\n      }\n      const parentPermission = this.getPermission(parent);\n      if (parentPermission) {\n        parentPermission.checked = permission.checked;\n        this.storageService.set(\n          'contexts.permissions.' + parentPermission.name,\n          permission.checked\n        );\n        parentPermission.indeterminate = indeterminate;\n      }\n    }\n\n    if (user.childs) {\n      for (const c of user.childs) {\n        const childrenPermission = this.getPermission(c);\n        if (\n          childrenPermission &&\n          childrenPermission.checked !== permission.checked\n        ) {\n          childrenPermission.checked = permission.checked;\n          this.storageService.set(\n            'contexts.permissions.' + childrenPermission.name,\n            permission.checked\n          );\n        }\n      }\n    }\n\n    this.filterPermissionsChanged.emit(this.permissions);\n  }\n\n  hideContext(context: DetailedContext) {\n    context.hidden = true;\n    if (!this.showHidden) {\n      const contexts: ContextsList = { ours: [], shared: [], public: [] };\n      contexts.ours = this.contexts.ours.filter((c) => c.id !== context.id);\n      contexts.shared = this.contexts.shared.filter((c) => c.id !== context.id);\n      contexts.public = this.contexts.public.filter((c) => c.id !== context.id);\n      this.contexts = contexts;\n    }\n    this.hide.emit(context);\n  }\n\n  showContext(context: DetailedContext) {\n    context.hidden = false;\n    this.show.emit(context);\n  }\n}\n","import {\n  Directive,\n  Self,\n  OnInit,\n  OnDestroy,\n  HostListener,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { MessageService, LanguageService, StorageService } from '@igo2/core';\nimport { AuthService } from '@igo2/auth';\nimport { ConfirmDialogService } from '@igo2/common';\nimport { MapService } from '@igo2/geo';\n\nimport {\n  Context,\n  DetailedContext,\n  ContextsList,\n  ContextUserPermission\n} from '../shared/context.interface';\nimport { ContextService } from '../shared/context.service';\nimport { ContextListComponent } from './context-list.component';\n\n@Directive({\n  selector: '[igoContextListBinding]'\n})\nexport class ContextListBindingDirective implements OnInit, OnDestroy {\n  private component: ContextListComponent;\n  private contexts$$: Subscription;\n  private selectedContext$$: Subscription;\n  private defaultContextId$$: Subscription;\n  private previousMessageId;\n\n  @HostListener('select', ['$event'])\n  onSelect(context: Context) {\n    this.contextService.loadContext(context.uri);\n  }\n\n  @HostListener('edit', ['$event'])\n  onEdit(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('save', ['$event'])\n  onSave(context: Context) {\n    const map = this.mapService.getMap();\n    const contextFromMap = this.contextService.getContextFromMap(map);\n\n    const msgSuccess = () => {\n      this.messageService.success(\n        'igo.context.contextManager.dialog.saveMsg',\n        'igo.context.contextManager.dialog.saveTitle',\n        undefined,\n        {\n          value: context.title\n        }\n      );\n    };\n\n    if (context.imported) {\n      contextFromMap.title = context.title;\n      this.contextService.delete(context.id, true);\n      this.contextService.create(contextFromMap).subscribe((contextCreated) => {\n        this.contextService.loadContext(contextCreated.uri);\n        msgSuccess();\n      });\n      return;\n    }\n\n    const changes: any = {\n      layers: contextFromMap.layers,\n      map: {\n        view: contextFromMap.map.view\n      }\n    };\n\n    this.contextService.update(context.id, changes).subscribe(() => {\n      msgSuccess();\n    });\n  }\n\n  @HostListener('favorite', ['$event'])\n  onFavorite(context: Context) {\n    if (!context.id) {\n      context.id = context.uri;\n    }\n    this.contextService.setDefault(context.id).subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      this.contextService.defaultContextId$.next(context.id);\n      const messageObj = this.messageService.success(\n        'igo.context.contextManager.dialog.favoriteMsg',\n        'igo.context.contextManager.dialog.favoriteTitle',\n        undefined,\n        {\n          value: context.title\n        }\n      );\n      this.previousMessageId = messageObj.toastId;\n      this.cdRef.detectChanges();\n    });\n  }\n\n  @HostListener('manageTools', ['$event'])\n  onManageTools(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('managePermissions', ['$event'])\n  onManagePermissions(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('delete', ['$event'])\n  onDelete(context: Context) {\n    const translate = this.languageService.translate;\n    this.confirmDialogService\n      .open(\n        translate.instant('igo.context.contextManager.dialog.confirmDelete')\n      )\n      .subscribe((confirm) => {\n        if (confirm) {\n          this.contextService\n            .delete(context.id, context.imported)\n            .subscribe(() => {\n              this.messageService.info(\n                'igo.context.contextManager.dialog.deleteMsg',\n                'igo.context.contextManager.dialog.deleteTitle',\n                undefined,\n                { value: context.title }\n              );\n            });\n        }\n      });\n  }\n\n  @HostListener('clone', ['$event'])\n  onClone(context: DetailedContext) {\n    const properties = {\n      title: context.title + '-copy',\n      uri: context.uri + '-copy'\n    };\n    this.contextService.clone(context.id, properties).subscribe(() => {\n      this.messageService.success(\n        'igo.context.contextManager.dialog.cloneMsg',\n        'igo.context.contextManager.dialog.cloneTitle',\n        undefined,\n        { value: context.title }\n      );\n    });\n  }\n\n  @HostListener('create', ['$event'])\n  onCreate(opts: { title: string; empty: boolean }) {\n    const { title, empty } = opts;\n    const context = this.contextService.getContextFromMap(\n      this.component.map,\n      empty\n    );\n    context.title = title;\n    this.contextService.create(context).subscribe(() => {\n      this.messageService.success(\n        'igo.context.bookmarkButton.dialog.createMsg',\n        'igo.context.bookmarkButton.dialog.createTitle',\n        undefined,\n        { value: context.title }\n      );\n      this.contextService.loadContext(context.uri);\n    });\n  }\n\n  @HostListener('filterPermissionsChanged')\n  loadContexts() {\n    const permissions = ['none'];\n    for (const p of this.component.permissions) {\n      if (p.checked === true || p.indeterminate === true) {\n        permissions.push(p.name);\n      }\n    }\n    this.component.showHidden\n      ? this.contextService.loadContexts(permissions, true)\n      : this.contextService.loadContexts(permissions, false);\n  }\n\n  @HostListener('showHiddenContexts')\n  showHiddenContexts() {\n    this.component.showHidden = !this.component.showHidden;\n    this.storageService.set('contexts.showHidden', this.component.showHidden);\n    this.loadContexts();\n  }\n\n  @HostListener('show', ['$event'])\n  onShowContext(context: DetailedContext) {\n    this.contextService.showContext(context.id).subscribe();\n  }\n\n  @HostListener('hide', ['$event'])\n  onHideContext(context: DetailedContext) {\n    this.contextService.hideContext(context.id).subscribe();\n  }\n\n  constructor(\n    @Self() component: ContextListComponent,\n    private contextService: ContextService,\n    private mapService: MapService,\n    private languageService: LanguageService,\n    private confirmDialogService: ConfirmDialogService,\n    private messageService: MessageService,\n    private auth: AuthService,\n    private storageService: StorageService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input contexts\n    this.component.contexts = { ours: [] };\n    this.component.showHidden = this.storageService.get(\n      'contexts.showHidden'\n    ) as boolean;\n\n    this.contexts$$ = this.contextService.contexts$.subscribe((contexts) =>\n      this.handleContextsChange(contexts)\n    );\n\n    this.defaultContextId$$ = this.contextService.defaultContextId$.subscribe(\n      (id) => {\n        this.component.defaultContextId = id;\n      }\n    );\n    const storedContextUri = this.storageService.get(\n      'favorite.context.uri'\n    ) as string;\n    if (storedContextUri && !this.auth.authenticated) {\n      this.contextService.defaultContextId$.next(storedContextUri);\n    }\n\n    // See feature-list.component for an explanation about the debounce time\n    this.selectedContext$$ = this.contextService.context$\n      .pipe(debounceTime(100))\n      .subscribe((context) => (this.component.selectedContext = context));\n\n    this.auth.authenticate$.subscribe((authenticate) => {\n      if (authenticate) {\n        this.contextService.getProfilByUser().subscribe((profils) => {\n          this.component.users = profils;\n          this.component.permissions = [];\n          const profilsAcc = this.component.users.reduce((acc, cur) => {\n            acc = acc.concat(cur);\n            acc = cur.childs ? acc.concat(cur.childs) : acc;\n            return acc;\n          }, []);\n\n          for (const user of profilsAcc) {\n            const permission: ContextUserPermission = {\n              name: user.name,\n              checked: this.storageService.get(\n                'contexts.permissions.' + user.name\n              ) as boolean\n            };\n            if (permission.checked === null) {\n              permission.checked = true;\n            }\n            this.component.permissions.push(permission);\n          }\n\n          const permissions = ['none'];\n          for (const p of this.component.permissions) {\n            if (p.checked === true || p.indeterminate === true) {\n              permissions.push(p.name);\n            }\n          }\n\n          this.component.showHidden\n            ? this.contextService.loadContexts(permissions, true)\n            : this.contextService.loadContexts(permissions, false);\n        });\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.contexts$$.unsubscribe();\n    this.selectedContext$$.unsubscribe();\n    this.defaultContextId$$.unsubscribe();\n  }\n\n  private handleContextsChange(contexts: ContextsList) {\n    this.component.contexts = contexts;\n  }\n}\n","<form\n  class=\"igo-form\"\n  [formGroup]=\"form\"\n  (ngSubmit)=\"handleFormSubmit(form.value)\"\n>\n  <mat-form-field class=\"full-width\">\n    <input\n      matInput\n      required\n      maxlength=\"128\"\n      [placeholder]=\"'igo.context.contextManager.form.title' | translate\"\n      formControlName=\"title\"\n    />\n    <mat-error>\n      {{ 'igo.context.contextManager.form.titleRequired' | translate }}\n    </mat-error>\n  </mat-form-field>\n\n  <mat-form-field id=\"uriInput\" class=\"full-width\">\n    <span *ngIf=\"prefix\" class=\"prefix\">{{ prefix }}-</span>\n    <span class=\"fieldWrapper\">\n      <input\n        matInput\n        maxlength=\"64\"\n        floatLabel=\"always\"\n        [placeholder]=\"'igo.context.contextManager.form.uri' | translate\"\n        formControlName=\"uri\"\n      />\n    </span>\n  </mat-form-field>\n\n  <button\n    id=\"copyButton\"\n    type=\"button\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.context.contextManager.form.copy' | translate\"\n    color=\"primary\"\n    (click)=\"copyTextToClipboard()\"\n  >\n    <mat-icon svgIcon=\"content-copy\"></mat-icon>\n  </button>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"submit\"\n      [disabled]=\"!form.valid || disabled\"\n    >\n      {{ 'igo.context.contextManager.form.edit' | translate }}\n    </button>\n  </div>\n</form>\n","import { Component, Input, Output, EventEmitter, OnInit } from '@angular/core';\nimport { UntypedFormBuilder, UntypedFormGroup } from '@angular/forms';\n\nimport { ObjectUtils, Clipboard } from '@igo2/utils';\nimport { MessageService } from '@igo2/core';\nimport { Context } from '../shared/context.interface';\n\n@Component({\n  selector: 'igo-context-form',\n  templateUrl: './context-form.component.html',\n  styleUrls: ['./context-form.component.scss']\n})\nexport class ContextFormComponent implements OnInit {\n  public form: UntypedFormGroup;\n  public prefix: string;\n\n  @Input()\n  get btnSubmitText(): string {\n    return this._btnSubmitText;\n  }\n  set btnSubmitText(value: string) {\n    this._btnSubmitText = value;\n  }\n  private _btnSubmitText: string;\n\n  @Input()\n  get context(): Context {\n    return this._context;\n  }\n  set context(value: Context) {\n    this._context = value;\n    this.buildForm();\n  }\n  private _context: Context;\n\n  @Input()\n  get disabled(): boolean {\n    return this._disabled;\n  }\n  set disabled(value: boolean) {\n    this._disabled = value;\n  }\n  private _disabled = false;\n\n  // TODO: replace any by ContextOptions or Context\n  @Output() submitForm: EventEmitter<any> = new EventEmitter();\n  @Output() clone: EventEmitter<any> = new EventEmitter();\n  @Output() delete: EventEmitter<any> = new EventEmitter();\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    private messageService: MessageService\n  ) {}\n\n  ngOnInit(): void {\n    this.buildForm();\n  }\n\n  public handleFormSubmit(value) {\n    let inputs = Object.assign({}, value);\n    inputs = ObjectUtils.removeNull(inputs);\n    inputs.uri = inputs.uri.replace(' ', '');\n    if (inputs.uri) {\n      inputs.uri = this.prefix + '-' + inputs.uri;\n    } else {\n      inputs.uri = this.prefix;\n    }\n    this.submitForm.emit(inputs);\n  }\n\n  public copyTextToClipboard() {\n    const text = this.prefix + '-' + this.form.value.uri.replace(' ', '');\n    const successful = Clipboard.copy(text);\n    if (successful) {\n      this.messageService.success(\n        'igo.context.contextManager.dialog.copyMsg',\n        'igo.context.contextManager.dialog.copyTitle'\n      );\n    }\n  }\n\n  private buildForm(): void {\n    const context: any = this.context || {};\n\n    const uriSplit = context.uri.split('-');\n    this.prefix = uriSplit.shift();\n    const uri = uriSplit.join('-');\n\n    this.form = this.formBuilder.group({\n      title: [context.title],\n      uri: [uri || ' ']\n    });\n  }\n}\n","<igo-context-form\n  *ngIf=\"context\"\n  [btnSubmitText]=\"'igo.context.contextManager.save' | translate\"\n  [context]=\"context\"\n  (submitForm)=\"submitForm.emit($event)\"\n>\n</igo-context-form>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { Context } from '../shared/context.interface';\n\n@Component({\n  selector: 'igo-context-edit',\n  templateUrl: './context-edit.component.html'\n})\nexport class ContextEditComponent {\n  @Input()\n  get context(): Context {\n    return this._context;\n  }\n  set context(value: Context) {\n    this._context = value;\n    this.refresh();\n  }\n  private _context: Context;\n\n  @Output() submitForm: EventEmitter<Context> = new EventEmitter();\n\n  constructor(private cd: ChangeDetectorRef) {}\n\n  refresh() {\n    this.cd.detectChanges();\n  }\n}\n","import {\n  Output,\n  EventEmitter,\n  Directive,\n  Self,\n  OnInit,\n  OnDestroy,\n  HostListener\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { MessageService } from '@igo2/core';\n\nimport { Context, DetailedContext } from '../shared/context.interface';\nimport { ContextService } from '../shared/context.service';\nimport { ContextEditComponent } from './context-edit.component';\n\n@Directive({\n  selector: '[igoContextEditBinding]'\n})\nexport class ContextEditBindingDirective implements OnInit, OnDestroy {\n  private component: ContextEditComponent;\n  private editedContext$$: Subscription;\n\n  @Output() submitSuccessed: EventEmitter<Context> = new EventEmitter();\n\n  @HostListener('submitForm', ['$event'])\n  onEdit(context: Context) {\n    const id = this.component.context.id;\n    this.contextService.update(id, context).subscribe(() => {\n      this.messageService.success(\n        'igo.context.contextManager.dialog.saveMsg',\n        'igo.context.contextManager.dialog.saveTitle',\n        undefined,\n        {\n          value: context.title || this.component.context.title\n        }\n      );\n      this.contextService.setEditedContext(undefined);\n      this.submitSuccessed.emit(context);\n    });\n  }\n\n  constructor(\n    @Self() component: ContextEditComponent,\n    private contextService: ContextService,\n    private messageService: MessageService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.editedContext$$ = this.contextService.editedContext$.subscribe(\n      (context) => this.handleEditedContextChange(context)\n    );\n  }\n\n  ngOnDestroy() {\n    this.editedContext$$.unsubscribe();\n  }\n\n  private handleEditedContextChange(context: DetailedContext) {\n    this.component.context = context;\n  }\n}\n","<div *ngIf=\"context\">\n  <div *ngIf=\"!canWrite\" class=\"scopeForm\">\n    <h4>{{ 'igo.context.permission.readOnlyTitle' | translate }}</h4>\n    <p>{{ 'igo.context.permission.readOnlyMsg' | translate }}</p>\n  </div>\n\n  <div *ngIf=\"canWrite\" class=\"scopeForm\">\n    <mat-radio-group\n      [(ngModel)]=\"context.scope\"\n      (change)=\"scopeChanged.emit(context)\"\n    >\n      <mat-radio-button value=\"private\">\n        {{ 'igo.context.permission.scope.private' | translate }}\n      </mat-radio-button>\n      <mat-radio-button value=\"protected\">\n        {{ 'igo.context.permission.scope.shared' | translate }}\n      </mat-radio-button>\n      <mat-radio-button *ngIf=\"authService.isAdmin\" value=\"public\">\n        {{ 'igo.context.permission.scope.public' | translate }}\n      </mat-radio-button>\n    </mat-radio-group>\n  </div>\n\n  <form\n    *ngIf=\"context.scope !== 'private' && canWrite\"\n    [formGroup]=\"form\"\n    (ngSubmit)=\"handleFormSubmit(form.value)\"\n  >\n    <mat-form-field class=\"full-width\">\n      <input\n        matInput\n        required\n        [placeholder]=\"'igo.context.permission.user' | translate\"\n        [formControl]=\"formControl\"\n        [matAutocomplete]=\"auto\"\n      />\n      <mat-autocomplete\n        #auto=\"matAutocomplete\"\n        (optionSelected)=\"onProfilSelected($event.option.value)\"\n        [displayWith]=\"displayFn\"\n      >\n        <mat-option *ngFor=\"let profil of this.profils\" [value]=\"profil\">\n          {{ profil.title }}<br />\n          <small class=\"mat-typography\">{{ profil.name }}</small>\n        </mat-option>\n      </mat-autocomplete>\n      <mat-error>\n        {{ 'igo.context.permission.profilRequired' | translate }}\n      </mat-error>\n    </mat-form-field>\n\n    <mat-radio-group formControlName=\"typePermission\">\n      <mat-radio-button value=\"read\">\n        {{ 'igo.context.permission.read' | translate }}\n      </mat-radio-button>\n      <mat-radio-button value=\"write\">\n        {{ 'igo.context.permission.write' | translate }}\n      </mat-radio-button>\n    </mat-radio-group>\n\n    <div class=\"igo-form-button-group\">\n      <button mat-raised-button type=\"submit\" [disabled]=\"!form.valid\">\n        {{ 'igo.context.permission.addBtn' | translate }}\n      </button>\n    </div>\n  </form>\n\n  <igo-list *ngIf=\"permissions && context.scope !== 'private'\">\n    <ng-template ngFor let-groupPermissions [ngForOf]=\"permissions | keyvalue\">\n      <igo-collapsible\n        *ngIf=\"groupPermissions.value.length\"\n        [title]=\"'igo.context.permission.' + groupPermissions.key | translate\"\n      >\n        <ng-template ngFor let-permission [ngForOf]=\"groupPermissions.value\">\n          <mat-list-item>\n            <mat-icon matListItemIcon svgIcon=\"account-outline\"></mat-icon>\n            <h4 matListItemTitle>\n              {{ permission.profilTitle }}\n              <small class=\"mat-typography\">{{ permission.profil }}</small>\n            </h4>\n\n            <div igoStopPropagation class=\"igo-actions-container\">\n              <button\n                *ngIf=\"\n                  canWrite ||\n                  permission.profil === authService.decodeToken().user.sourceId\n                \"\n                mat-icon-button\n                [matTooltip]=\"'igo.context.permission.delete' | translate\"\n                matTooltipShowDelay=\"500\"\n                color=\"warn\"\n                (click)=\"removePermission.emit(permission)\"\n              >\n                <mat-icon svgIcon=\"delete\"></mat-icon>\n              </button>\n            </div>\n          </mat-list-item>\n        </ng-template>\n      </igo-collapsible>\n    </ng-template>\n  </igo-list>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  OnInit,\n  ChangeDetectorRef\n} from '@angular/core';\nimport {\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  UntypedFormControl\n} from '@angular/forms';\n\nimport {\n  Context,\n  ContextPermission,\n  ContextPermissionsList,\n  ContextProfils\n} from '../shared/context.interface';\nimport { TypePermission } from '../shared/context.enum';\n\nimport { HttpClient } from '@angular/common/http';\nimport { Subscription } from 'rxjs';\n\nimport { AuthService } from '@igo2/auth';\nimport { ConfigService } from '@igo2/core';\n\n@Component({\n  selector: 'igo-context-permissions',\n  templateUrl: './context-permissions.component.html',\n  styleUrls: ['./context-permissions.component.scss']\n})\nexport class ContextPermissionsComponent implements OnInit {\n  public form: UntypedFormGroup;\n\n  @Input()\n  get context(): Context {\n    return this._context;\n  }\n  set context(value: Context) {\n    this._context = value;\n    this.cd.detectChanges();\n  }\n  private _context: Context;\n\n  @Input()\n  get permissions(): ContextPermissionsList {\n    return this._permissions;\n  }\n  set permissions(value: ContextPermissionsList) {\n    this._permissions = value;\n    this.cd.detectChanges();\n  }\n  private _permissions: ContextPermissionsList;\n\n  get profils(): ContextProfils[] {\n    return this._profils;\n  }\n  set profils(value: ContextProfils[]) {\n    this._profils = value;\n    this.cd.detectChanges();\n  }\n  private _profils: ContextProfils[] = [];\n\n  get canWrite(): boolean {\n    return this.context.permission === TypePermission[TypePermission.write];\n  }\n\n  private baseUrlProfils;\n\n  public formControl = new UntypedFormControl();\n  formValueChanges$$: Subscription;\n\n  @Output() addPermission: EventEmitter<ContextPermission> = new EventEmitter();\n  @Output() removePermission: EventEmitter<ContextPermission> =\n    new EventEmitter();\n  @Output() scopeChanged: EventEmitter<Context> = new EventEmitter();\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    private cd: ChangeDetectorRef,\n    private http: HttpClient,\n    public authService: AuthService,\n    private config: ConfigService\n  ) {}\n\n  ngOnInit(): void {\n    this.buildForm();\n\n    this.baseUrlProfils =\n      this.config.getConfig('context.url') + '/profils-users?';\n\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe(\n      (value) => {\n        if (value.length) {\n          this.http\n            .get(this.baseUrlProfils + 'q=' + value)\n            .subscribe((profils) => {\n              this.profils = profils as ContextProfils[];\n            });\n          this.profils.filter((profil) => {\n            const filterNormalized = value\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n            const profilTitleNormalized = profil.title\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n            const profilNameNormalized = profil.name\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n            const profilNormalized =\n              profilNameNormalized + profilTitleNormalized;\n            return profilNormalized.includes(filterNormalized);\n          });\n        } else {\n          this.profils = [];\n        }\n      }\n    );\n  }\n\n  displayFn(profil?: ContextProfils): string | undefined {\n    return profil ? profil.title : undefined;\n  }\n\n  public handleFormSubmit(value) {\n    this.addPermission.emit(value);\n  }\n\n  private buildForm(): void {\n    this.form = this.formBuilder.group({\n      profil: [],\n      typePermission: ['read']\n    });\n  }\n\n  onProfilSelected(value) {\n    this.form.setValue({\n      profil: value.name,\n      typePermission: this.form.value.typePermission\n    });\n  }\n}\n","import {\n  Directive,\n  Self,\n  OnInit,\n  OnDestroy,\n  HostListener,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { MessageService, LanguageService } from '@igo2/core';\n\nimport {\n  Context,\n  ContextPermission,\n  DetailedContext\n} from '../shared/context.interface';\nimport { ContextService } from '../shared/context.service';\nimport { ContextPermissionsComponent } from './context-permissions.component';\n\n@Directive({\n  selector: '[igoContextPermissionsBinding]'\n})\nexport class ContextPermissionsBindingDirective implements OnInit, OnDestroy {\n  private component: ContextPermissionsComponent;\n  private editedContext$$: Subscription;\n\n  @HostListener('addPermission', ['$event'])\n  onAddPermission(permission: ContextPermission) {\n    if (!permission.profil) {\n      this.messageService.error(\n        'igo.context.contextManager.errors.addPermissionEmpty',\n        'igo.context.contextManager.errors.addPermissionTitle'\n      );\n      return;\n    }\n    const contextId = this.component.context.id;\n    this.contextService\n      .addPermissionAssociation(\n        contextId,\n        permission.profil,\n        permission.typePermission\n      )\n      .subscribe((profils) => {\n        for (const p of profils) {\n          this.component.permissions[permission.typePermission].push(p);\n        }\n        const profil = permission.profil;\n        this.messageService.success(\n          'igo.context.permission.dialog.addMsg',\n          'igo.context.permission.dialog.addTitle',\n          undefined,\n          { value: profil }\n        );\n        this.cd.detectChanges();\n      });\n  }\n\n  @HostListener('removePermission', ['$event'])\n  onRemovePermission(permission: ContextPermission) {\n    const contextId = this.component.context.id;\n    this.contextService\n      .deletePermissionAssociation(contextId, permission.id)\n      .subscribe(() => {\n        const index = this.component.permissions[\n          permission.typePermission\n        ].findIndex((p) => {\n          return p.id === permission.id;\n        });\n        this.component.permissions[permission.typePermission].splice(index, 1);\n\n        const profil = permission.profil;\n        this.messageService.success(\n          'igo.context.permission.dialog.deleteMsg',\n          'igo.context.permission.dialog.deleteTitle',\n          undefined,\n          { value: profil }\n        );\n        this.cd.detectChanges();\n      });\n  }\n\n  @HostListener('scopeChanged', ['$event'])\n  onScopeChanged(context: Context) {\n    const scope = context.scope;\n    this.contextService.update(context.id, { scope }).subscribe(() => {\n      this.messageService.success(\n        'igo.context.permission.dialog.scopeChangedMsg',\n        'igo.context.permission.dialog.scopeChangedTitle',\n        undefined,\n        { value: 'igo.context.permission.scope.' + scope }\n      );\n    });\n  }\n\n  constructor(\n    @Self() component: ContextPermissionsComponent,\n    private contextService: ContextService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private cd: ChangeDetectorRef\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.editedContext$$ = this.contextService.editedContext$.subscribe(\n      (context) => this.handleEditedContextChange(context)\n    );\n  }\n\n  ngOnDestroy() {\n    this.editedContext$$.unsubscribe();\n    this.contextService.editedContext$.next(undefined);\n  }\n\n  private handleEditedContextChange(context: DetailedContext) {\n    this.component.context = context;\n\n    if (context) {\n      this.contextService\n        .getPermissions(context.id)\n        .subscribe((permissionsArray) => {\n          permissionsArray = permissionsArray || [];\n          const permissions = {\n            read: permissionsArray.filter((p) => {\n              return p.typePermission.toString() === 'read';\n            }),\n            write: permissionsArray.filter((p) => {\n              return p.typePermission.toString() === 'write';\n            })\n          };\n          return (this.component.permissions = permissions);\n        });\n    }\n  }\n}\n","import { Injectable, Optional } from '@angular/core';\n\nimport { RouteService } from '@igo2/core';\nimport { Layer, WMSDataSourceOptions } from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\nimport { ContextService } from '../../context-manager/shared/context.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ShareMapService {\n  private language = '';\n\n  constructor(\n    private contextService: ContextService,\n    @Optional() private route: RouteService\n  ) {\n    this.route.queryParams.subscribe((params) => {\n      if (params['lang']) {\n        this.language = params['lang'];\n      }\n    });\n  }\n\n  getUrlWithApi(formValues) {\n    return this.language\n      ? `${location.origin + location.pathname}?context=${\n          formValues.uri\n        }&lang=${this.language}`\n      : `${location.origin + location.pathname}?context=${formValues.uri}`;\n  }\n\n  createContextShared(map: IgoMap, formValues) {\n    const context = this.contextService.getContextFromMap(map);\n    context.scope = 'public';\n    context.title = formValues.title;\n    context.uri = formValues.uri;\n    return this.contextService.create(context);\n  }\n\n  updateContextShared(map: IgoMap, formValues, id: string) {\n    const context = this.contextService.getContextFromMap(map);\n    return this.contextService.update(id, {\n      title: formValues.title,\n      map: context.map\n    } as DetailedContext);\n  }\n\n  getUrlWithoutApi(map: IgoMap, publicShareOption) {\n    if (\n      !this.route ||\n      !this.route.options.visibleOnLayersKey ||\n      !this.route.options.visibleOffLayersKey ||\n      !map.viewController.getZoom()\n    ) {\n      return;\n    }\n    const llc = publicShareOption.layerlistControls.querystring;\n\n    let visibleKey = this.route.options.visibleOnLayersKey;\n    let invisibleKey = this.route.options.visibleOffLayersKey;\n    const layers = map.layers;\n\n    const visibleLayers = layers.filter(\n      (lay) => lay.visible && !lay.isIgoInternalLayer\n    );\n    const invisibleLayers = layers.filter(\n      (lay) => !lay.visible && !lay.isIgoInternalLayer\n    );\n\n    if (visibleLayers.length === 0) {\n      visibleKey = '';\n    }\n    if (invisibleLayers.length === 0) {\n      invisibleKey = '';\n    }\n\n    let layersUrl = '';\n    let layersToLoop = [];\n    if (visibleLayers.length > invisibleLayers.length) {\n      layersUrl = `${visibleKey}=*&${invisibleKey}=`;\n      layersToLoop = invisibleLayers;\n    } else {\n      layersUrl = `${invisibleKey}=*&${visibleKey}=`;\n      layersToLoop = visibleLayers;\n    }\n\n    for (const layer of layersToLoop) {\n      if (layer.id) {\n        layersUrl += layer.id + ',';\n      }\n    }\n    const contextLayersID = [];\n    const contextLayers = this.contextService.context$.value.layers;\n    for (const contextLayer of contextLayers) {\n      if (\n        typeof contextLayer.id !== 'undefined' ||\n        typeof contextLayer.source !== 'undefined'\n      ) {\n        contextLayersID.push(contextLayer.id || contextLayer.source.id);\n      }\n    }\n\n    const addedLayersQueryParamsWms = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'wms'\n    );\n    const addedLayersQueryParamsWmts = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'wmts'\n    );\n    const addedLayersQueryParamsArcgisRest = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'arcgisrest'\n    );\n    const addedLayersQueryParamsImageArcgisRest = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'imagearcgisrest'\n    );\n    const addedLayersQueryParamsTileArcgisRest = this.makeLayersByService(\n      layers,\n      contextLayersID,\n      'tilearcgisrest'\n    );\n\n    layersUrl = layersUrl.substr(0, layersUrl.length - 1);\n\n    const zoomKey = this.route.options.zoomKey;\n    const centerKey = this.route.options.centerKey;\n    const contextKey = this.route.options.contextKey;\n\n    const zoom = `${zoomKey}=${map.viewController.getZoom()}`;\n    const arrayCenter = map.viewController.getCenter('EPSG:4326') || [];\n    const long = arrayCenter[0].toFixed(5).replace(/\\.([^0]+)0+$/, '.$1');\n    const lat = arrayCenter[1].toFixed(5).replace(/\\.([^0]+)0+$/, '.$1');\n    const center = `${centerKey}=${long},${lat}`.replace(/.00000/g, '');\n    let context = '';\n    if (this.contextService.context$.value) {\n      context = `${contextKey}=${this.contextService.context$.value.uri}`;\n    }\n\n    let url = this.language\n      ? `${location.origin}${location.pathname}?${context}&${zoom}&${center}&${layersUrl}&${llc}&${addedLayersQueryParamsWms}&${llc}&${addedLayersQueryParamsWmts}&${addedLayersQueryParamsArcgisRest}&${addedLayersQueryParamsImageArcgisRest}&${addedLayersQueryParamsTileArcgisRest}&lang=${this.language}`\n      : `${location.origin}${location.pathname}?${context}&${zoom}&${center}&${layersUrl}&${llc}&${addedLayersQueryParamsWms}&${llc}&${addedLayersQueryParamsWmts}&${addedLayersQueryParamsArcgisRest}&${addedLayersQueryParamsImageArcgisRest}&${addedLayersQueryParamsTileArcgisRest}`;\n    for (let i = 0; i < 5; i++) {\n      url = url.replace(/&&/g, '&');\n      url = url.endsWith('&') ? url.slice(0, -1) : url;\n    }\n    url = url.endsWith('&') ? url.slice(0, -1) : url;\n    url = url.replace('?&wm', '&wm');\n    url = url.replace('?&', '?');\n\n    return url;\n  }\n\n  private makeLayersByService(\n    layers: Layer[],\n    contextLayersID: any[],\n    typeService: string\n  ): string {\n    const addedLayersByService = [];\n    for (const layer of layers.filter(\n      (l) => l.dataSource.options?.type === typeService\n    )) {\n      if (contextLayersID.indexOf(layer.id) === -1) {\n        let linkUrl = encodeURIComponent((layer.dataSource.options as any).url);\n        let addedLayer = '';\n        let layerVersion: string;\n        switch (layer.dataSource.options.type.toLowerCase()) {\n          case 'wms':\n            const datasourceOptions = layer.dataSource\n              .options as WMSDataSourceOptions;\n            addedLayer = encodeURIComponent(datasourceOptions.params.LAYERS);\n            layerVersion =\n              datasourceOptions.params.VERSION === '1.3.0'\n                ? layerVersion\n                : datasourceOptions.params.VERSION;\n            break;\n          case 'wmts':\n          case 'arcgisrest':\n          case 'imagearcgisrest':\n          case 'tilearcgisrest':\n            addedLayer = encodeURIComponent(\n              (layer.dataSource.options as any).layer\n            );\n            break;\n        }\n        const addedLayerPosition = `${addedLayer}:igoz${layer.zIndex}`;\n\n        let version = '';\n        if (layerVersion) {\n          const operator =\n            (layer.dataSource.options as any).url.indexOf('?') === -1\n              ? '?'\n              : '&';\n          version = encodeURIComponent(`${operator}VERSION=${layerVersion}`);\n        }\n        linkUrl = `${linkUrl}${version}`;\n\n        if (\n          !addedLayersByService.find((definedUrl) => definedUrl.url === linkUrl)\n        ) {\n          addedLayersByService.push({\n            url: linkUrl,\n            layers: [addedLayerPosition]\n          });\n        } else {\n          addedLayersByService.forEach((service) => {\n            if (service.url === linkUrl) {\n              service.layers.push(addedLayerPosition);\n            }\n          });\n        }\n      }\n    }\n\n    let addedLayersQueryParams = '';\n    if (addedLayersByService.length >= 1) {\n      let linkUrlKey;\n      let layersKey;\n      /*\n      const linkUrlKey = (typeService === 'wms') ? this.route.options.wmsUrlKey :\n        (typeService === 'wmts') ? this.route.options.wmtsUrlKey : '' ;\n      const layersKey = (typeService === 'wms') ? this.route.options.wmsLayersKey :\n        (typeService === 'wmts') ? this.route.options.wmtsLayersKey : '' ;\n*/\n      switch (typeService.toLowerCase()) {\n        case 'wms':\n          linkUrlKey = this.route.options.wmsUrlKey;\n          layersKey = this.route.options.wmsLayersKey;\n          break;\n        case 'wmts':\n          linkUrlKey = this.route.options.wmtsUrlKey;\n          layersKey = this.route.options.wmtsLayersKey;\n          break;\n        case 'arcgisrest':\n          linkUrlKey = this.route.options.arcgisUrlKey;\n          layersKey = this.route.options.arcgisLayersKey;\n          break;\n        case 'imagearcgisrest':\n          linkUrlKey = this.route.options.iarcgisUrlKey;\n          layersKey = this.route.options.iarcgisLayersKey;\n          break;\n        case 'tilearcgisrest':\n          linkUrlKey = this.route.options.tarcgisUrlKey;\n          layersKey = this.route.options.tarcgisLayersKey;\n          break;\n        default:\n          linkUrlKey = '';\n          layersKey = '';\n      }\n\n      let linkUrlQueryParams = '';\n      let layersQueryParams = '';\n      addedLayersByService.forEach((service) => {\n        linkUrlQueryParams += `${service.url},`;\n        layersQueryParams += `(${service.layers.join(',')}),`;\n      });\n      linkUrlQueryParams = linkUrlQueryParams.endsWith(',')\n        ? linkUrlQueryParams.slice(0, -1)\n        : linkUrlQueryParams;\n      layersQueryParams = layersQueryParams.endsWith(',')\n        ? layersQueryParams.slice(0, -1)\n        : layersQueryParams;\n      addedLayersQueryParams = `${linkUrlKey}=${linkUrlQueryParams}&${layersKey}=${layersQueryParams}`;\n    }\n\n    return addedLayersQueryParams;\n  }\n}\n","<div class=\"igo-input-container linkToShare\">\n  <mat-form-field>\n    <textarea\n      #textArea\n      matInput\n      readonly\n      rows=\"3\"\n      [placeholder]=\"'igo.context.shareMap.placeholderLink' | translate\"\n      [value]=\"url\"\n    ></textarea>\n  </mat-form-field>\n\n  <div class=\"igo-form-button-group\">\n    <button mat-raised-button (click)=\"copyTextToClipboard(textArea)\">\n      <mat-icon svgIcon=\"content-copy\"></mat-icon>\n      {{ 'igo.context.shareMap.copy' | translate }}\n    </button>\n  </div>\n  <div>\n    <br />\n    <section class=\"mat-typography\">\n      <div\n        *ngIf=\"('igo.context.shareMap.htmlClarifications' | translate) === ''\"\n      >\n        <h4 *ngIf=\"('igo.context.shareMap.included' | translate) !== ''\">\n          {{ 'igo.context.shareMap.included' | translate }}\n        </h4>\n        <ul>\n          <li *ngIf=\"('igo.context.shareMap.context' | translate) !== ''\">\n            {{ 'igo.context.shareMap.context' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.center' | translate) !== ''\">\n            {{ 'igo.context.shareMap.center' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.zoom' | translate) !== ''\">\n            {{ 'igo.context.shareMap.zoom' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.addedLayers' | translate) !== ''\">\n            {{ 'igo.context.shareMap.addedLayers' | translate }}\n          </li>\n          <li\n            *ngIf=\"('igo.context.shareMap.visibleInvisible' | translate) !== ''\"\n          >\n            {{ 'igo.context.shareMap.visibleInvisible' | translate }}\n          </li>\n        </ul>\n\n        <h4 *ngIf=\"('igo.context.shareMap.excluded' | translate) !== ''\">\n          {{ 'igo.context.shareMap.excluded' | translate }}\n        </h4>\n        <ul>\n          <li *ngIf=\"('igo.context.shareMap.order' | translate) !== ''\">\n            {{ 'igo.context.shareMap.order' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.opacity' | translate) !== ''\">\n            {{ 'igo.context.shareMap.opacity' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.filterOgc' | translate) !== ''\">\n            {{ 'igo.context.shareMap.filterOgc' | translate }}\n          </li>\n          <li *ngIf=\"('igo.context.shareMap.filterTime' | translate) !== ''\">\n            {{ 'igo.context.shareMap.filterTime' | translate }}\n          </li>\n        </ul>\n      </div>\n      <igo-custom-html\n        class=\"shareCustomPadding\"\n        *ngIf=\"('igo.context.shareMap.htmlClarifications' | translate) !== ''\"\n        class=\"mat-typography\"\n        [html]=\"'igo.context.shareMap.htmlClarifications' | translate\"\n      >\n      </igo-custom-html>\n    </section>\n  </div>\n</div>\n","import {\n  AfterViewInit,\n  Component,\n  Input,\n  OnInit,\n  ChangeDetectorRef,\n  OnDestroy\n} from '@angular/core';\n\nimport { Clipboard } from '@igo2/utils';\nimport { MessageService } from '@igo2/core';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { ShareMapService } from '../shared/share-map.service';\nimport { combineLatest, Subscription } from 'rxjs';\n\n@Component({\n  selector: 'igo-share-map-url',\n  templateUrl: './share-map-url.component.html',\n  styleUrls: ['./share-map-url.component.scss']\n})\nexport class ShareMapUrlComponent implements AfterViewInit, OnInit, OnDestroy {\n  private mapState$$: Subscription;\n\n  @Input() map: IgoMap;\n\n  public url: string;\n  public publicShareOption = {\n    layerlistControls: { querystring: '' }\n  };\n\n  constructor(\n    private messageService: MessageService,\n    private shareMapService: ShareMapService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit(): void {\n    this.resetUrl();\n    this.mapState$$ = combineLatest([\n      this.map.viewController.state$,\n      this.map.status$\n    ]).subscribe((c) => {\n      this.resetUrl();\n      this.cdRef.detectChanges();\n    });\n  }\n\n  ngAfterViewInit(): void {\n    this.resetUrl();\n  }\n\n  ngOnDestroy(): void {\n    this.mapState$$.unsubscribe();\n  }\n\n  resetUrl(values: any = {}) {\n    this.url = this.shareMapService.getUrlWithoutApi(\n      this.map,\n      this.publicShareOption\n    );\n  }\n\n  copyTextToClipboard(textArea) {\n    const successful = Clipboard.copy(textArea);\n    if (successful) {\n      this.messageService.success(\n        'igo.context.shareMap.dialog.copyMsg',\n        'igo.context.shareMap.dialog.copyTitle'\n      );\n    }\n  }\n}\n","<form class=\"igo-form\" [formGroup]=\"form\" (ngSubmit)=\"createUrl(form.value)\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        required\n        [placeholder]=\"'igo.context.contextManager.form.title' | translate\"\n        formControlName=\"title\"\n      />\n      <mat-error>\n        {{ 'igo.context.contextManager.form.titleRequired' | translate }}\n      </mat-error>\n    </mat-form-field>\n  </div>\n\n  <div id=\"uriInput\" class=\"igo-input-container\">\n    <mat-form-field>\n      <span *ngIf=\"userId\" class=\"prefix\">{{ userId }}-</span>\n      <span class=\"fieldWrapper\">\n        <input\n          matInput\n          required\n          [readonly]=\"!userId\"\n          [placeholder]=\"'igo.context.contextManager.form.uri' | translate\"\n          formControlName=\"uri\"\n        />\n      </span>\n      <mat-error>\n        {{ 'igo.context.contextManager.form.uriRequired' | translate }}\n      </mat-error>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      *ngIf=\"!url\"\n      mat-raised-button\n      type=\"submit\"\n      [disabled]=\"!form.valid\"\n    >\n      {{ 'igo.context.shareMap.button' | translate }}\n    </button>\n    <button\n      *ngIf=\"url\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"updateContextShared(form.value)\"\n    >\n      {{ 'igo.context.shareMap.refreshBtn' | translate }}\n    </button>\n  </div>\n</form>\n\n<div *ngIf=\"url\" class=\"igo-input-container linkToShare\">\n  <mat-form-field>\n    <textarea\n      #textArea\n      matInput\n      readonly\n      rows=\"3\"\n      class=\"textAreaWithButton\"\n      [placeholder]=\"'igo.context.shareMap.placeholderLink' | translate\"\n      [value]=\"url\"\n    ></textarea>\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.context.shareMap.copy' | translate\"\n      color=\"primary\"\n      (click)=\"copyTextToClipboard(textArea)\"\n    >\n      <mat-icon svgIcon=\"content-copy\"></mat-icon>\n    </button>\n  </mat-form-field>\n  <div></div>\n</div>\n","import { Component, Input, OnInit } from '@angular/core';\nimport { UntypedFormBuilder, UntypedFormGroup } from '@angular/forms';\n\nimport { uuid, Clipboard } from '@igo2/utils';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { AuthService } from '@igo2/auth';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { ShareMapService } from '../shared/share-map.service';\n\n@Component({\n  selector: 'igo-share-map-api',\n  templateUrl: './share-map-api.component.html',\n  styleUrls: ['./share-map-api.component.scss']\n})\nexport class ShareMapApiComponent implements OnInit {\n  public form: UntypedFormGroup;\n\n  @Input() map: IgoMap;\n\n  public url: string;\n  public userId: string;\n  public idContextShared: string;\n\n  constructor(\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private auth: AuthService,\n    private shareMapService: ShareMapService,\n    private formBuilder: UntypedFormBuilder\n  ) {}\n\n  ngOnInit(): void {\n    this.auth.authenticate$.subscribe((auth) => {\n      const decodeToken = this.auth.decodeToken();\n      this.userId = decodeToken.user ? decodeToken.user.id : undefined;\n      this.buildForm();\n    });\n  }\n\n  createUrl(values: any = {}) {\n    const inputs = Object.assign({}, values);\n    inputs.uri = this.userId ? `${this.userId}-${values.uri}` : values.uri;\n    this.url = this.shareMapService.getUrlWithApi(inputs);\n    this.shareMapService.createContextShared(this.map, inputs).subscribe(\n      (rep) => {\n        this.idContextShared = rep.id;\n        this.messageService.success(\n          'igo.context.contextManager.dialog.saveMsg',\n          'igo.context.contextManager.dialog.saveTitle',\n          undefined,\n          { value: inputs.title }\n        );\n      },\n      (err) => {\n        err.error.title = this.languageService.translate.instant(\n          'igo.context.shareMap.errorTitle'\n        );\n        this.messageService.showError(err);\n      }\n    );\n  }\n\n  updateContextShared(values: any = {}) {\n    const inputs = Object.assign({}, values);\n    inputs.uri = this.userId ? `${this.userId}-${values.uri}` : values.uri;\n    this.shareMapService\n      .updateContextShared(this.map, inputs, this.idContextShared)\n      .subscribe(\n        (rep) => {\n          this.messageService.success(\n            'igo.context.contextManager.dialog.saveMsg',\n            'igo.context.contextManager.dialog.saveTitle',\n            undefined,\n            { value: inputs.title }\n          );\n        },\n        (err) => {\n          err.error.title = this.languageService.translate.instant(\n            'igo.context.shareMap.errorTitle'\n          );\n          this.messageService.showError(err);\n        }\n      );\n  }\n\n  copyTextToClipboard(textArea) {\n    const successful = Clipboard.copy(textArea);\n    if (successful) {\n      this.messageService.success(\n        'igo.context.shareMap.dialog.copyMsg',\n        'igo.context.shareMap.dialog.copyTitle'\n      );\n    }\n  }\n\n  buildForm(): void {\n    this.url = undefined;\n    const id = uuid();\n    let title = 'Partage ';\n    title += this.userId ? `(${this.userId}-${id})` : `(${id})`;\n    this.form = this.formBuilder.group({\n      title: [title],\n      uri: [id]\n    });\n  }\n}\n","<mat-tab-group *ngIf=\"hasApi\">\n  <mat-tab [label]=\"'igo.context.shareMap.shareWithApi' | translate\">\n    <igo-share-map-api [map]=\"map\"></igo-share-map-api>\n  </mat-tab>\n  <mat-tab [label]=\"'igo.context.shareMap.shareWithUrl' | translate\">\n    <igo-share-map-url [map]=\"map\"></igo-share-map-url>\n  </mat-tab>\n</mat-tab-group>\n\n<igo-share-map-url *ngIf=\"!hasApi\" [map]=\"map\"></igo-share-map-url>\n","import { Component, Input } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport type { IgoMap } from '@igo2/geo';\n\n@Component({\n  selector: 'igo-share-map',\n  templateUrl: './share-map.component.html',\n  styleUrls: ['./share-map.component.scss']\n})\nexport class ShareMapComponent {\n  @Input() map: IgoMap;\n\n  public hasApi = false;\n\n  constructor(private config: ConfigService) {\n    this.hasApi = this.config.getConfig('context.url') ? true : false;\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { IgoSearchModule } from '@igo2/geo';\n\nimport { SearchBarBindingDirective } from './search-bar-binding.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [IgoSearchModule],\n  declarations: [SearchBarBindingDirective],\n  exports: [SearchBarBindingDirective]\n})\nexport class IgoAppSearchBarModule {}\n","import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoFlexibleModule,\n  IgoCustomHtmlModule,\n  IgoPanelModule\n} from '@igo2/common';\nimport {\n  IgoFeatureModule,\n  IgoSearchModule,\n  IgoFeatureDetailsModule\n} from '@igo2/geo';\n\nimport { SearchResultsToolComponent } from './search-results-tool.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatBadgeModule,\n    MatTooltipModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    IgoFeatureModule,\n    IgoSearchModule,\n    IgoFlexibleModule,\n    IgoPanelModule,\n    IgoFeatureDetailsModule,\n    IgoCustomHtmlModule\n  ],\n  declarations: [SearchResultsToolComponent],\n  exports: [SearchResultsToolComponent],\n  schemas: [CUSTOM_ELEMENTS_SCHEMA]\n})\nexport class IgoAppSearchResultsToolModule {}\n","import { NgModule } from '@angular/core';\n\nimport { IgoAppSearchBarModule } from './search-bar/search-bar.module';\nimport { IgoAppSearchResultsToolModule } from './search-results-tool/search-results-tool.module';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [IgoAppSearchBarModule, IgoAppSearchResultsToolModule]\n})\nexport class IgoAppSearchModule {}\n","<p></p>\n<igo-interactive-tour\n  mat-raised-button\n  tourToStart=\"global\"\n  menuIsOpen=\"true\"\n  styleButton=\"raised\"\n  [discoverTitleInLocale$]=\"discoverTitleInLocale$\"\n>\n</igo-interactive-tour>\n\n<button\n  *ngIf=\"\n    auth.authenticated && trainingGuideURLs && trainingGuideURLs.length === 1\n  \"\n  class=\"training-guide-button\"\n  mat-raised-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [disabled]=\"loading\"\n  [matTooltip]=\"'igo.integration.aboutTool.trainingGuideTooltip' | translate\"\n  (click)=\"openGuide()\"\n>\n  <span>{{ 'igo.integration.aboutTool.trainingGuide' | translate }}</span>\n  <mat-icon svgIcon=\"file-document\"></mat-icon>\n</button>\n\n<button\n  *ngIf=\"\n    auth.authenticated && trainingGuideURLs && trainingGuideURLs.length > 1\n  \"\n  class=\"training-guide-button\"\n  mat-raised-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [disabled]=\"loading\"\n  [matTooltip]=\"'igo.integration.aboutTool.trainingGuideTooltip' | translate\"\n  [matMenuTriggerFor]=\"menu\"\n>\n  <span>{{ 'igo.integration.aboutTool.trainingGuide' | translate }}</span>\n  <mat-icon svgIcon=\"file-document\"></mat-icon>\n</button>\n\n<mat-menu #menu=\"matMenu\">\n  <button\n    *ngFor=\"let guide of trainingGuideURLs\"\n    mat-menu-item\n    (click)=\"openGuide(guide)\"\n  >\n    {{ formatFileName(guide) }}\n  </button>\n</mat-menu>\n\n<igo-custom-html\n  *ngIf=\"headerHtml !== ''\"\n  class=\"mat-typography\"\n  [html]=\"headerHtml | translate\"\n>\n</igo-custom-html>\n\n<igo-custom-html\n  class=\"mat-typography\"\n  [html]=\"html | translate: { version: version }\"\n>\n</igo-custom-html>\n","import { ChangeDetectorRef, Component, Input, OnInit } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\nimport { ConfigService, LanguageService, Version } from '@igo2/core';\nimport { of } from 'rxjs';\nimport type { Observable } from 'rxjs';\nimport { AuthService } from '@igo2/auth';\nimport { HttpClient } from '@angular/common/http';\n\n@ToolComponent({\n  name: 'about',\n  title: 'igo.integration.tools.about',\n  icon: 'help-circle'\n})\n@Component({\n  selector: 'igo-about-tool',\n  templateUrl: './about-tool.component.html',\n  styleUrls: ['./about-tool.component.scss']\n})\nexport class AboutToolComponent implements OnInit {\n  @Input()\n  get headerHtml() {\n    return this._headerHtml;\n  }\n  set headerHtml(value: string) {\n    this._headerHtml = Array.isArray(value) ? value.join('\\n') : value;\n  }\n\n  @Input()\n  get html() {\n    return this._html;\n  }\n  set html(value: string) {\n    this._html = Array.isArray(value) ? value.join('\\n') : value;\n  }\n  private _discoverTitleInLocale: string = 'IGO';\n  public discoverTitleInLocale$: Observable<string> = of(\n    this._discoverTitleInLocale\n  );\n\n  @Input()\n  get discoverTitleInLocale() {\n    return this._discoverTitleInLocale;\n  }\n  set discoverTitleInLocale(value: string) {\n    this._discoverTitleInLocale = value;\n    this.discoverTitleInLocale$ = of(value);\n  }\n\n  @Input() trainingGuideURLs;\n\n  public version: Version;\n  private _html: string = 'igo.integration.aboutTool.html';\n  private _headerHtml: string;\n\n  private baseUrlProfil;\n  private baseUrlGuide;\n\n  public loading = false;\n\n  constructor(\n    public configService: ConfigService,\n    public auth: AuthService,\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef,\n    private languageService: LanguageService\n  ) {\n    this.headerHtml = this.languageService.translate.instant(\n      'igo.integration.aboutTool.headerHtml'\n    );\n    this.version = configService.getConfig('version');\n    this.baseUrlProfil = configService.getConfig('storage.url');\n    this.baseUrlGuide =\n      configService.getConfig('depot.url') +\n      configService.getConfig('depot.guideUrl');\n  }\n\n  ngOnInit() {\n    if (\n      this.auth.authenticated &&\n      this.configService.getConfig('context.url')\n    ) {\n      this.http.get(this.baseUrlProfil).subscribe((profil) => {\n        const recast = profil as any;\n        this.trainingGuideURLs = recast.guides;\n        this.cdRef.detectChanges();\n      });\n    } else if (\n      this.auth.authenticated &&\n      !this.configService.getConfig('context.url') &&\n      this.configService.getConfig('depot.trainingGuides')\n    ) {\n      this.trainingGuideURLs = this.configService.getConfig(\n        'depot.trainingGuides'\n      );\n    }\n  }\n\n  openGuide(guide?) {\n    this.loading = true;\n    const url = guide\n      ? this.baseUrlGuide + guide + '?'\n      : this.baseUrlGuide + this.trainingGuideURLs[0] + '?';\n    this.http\n      .get(url, {\n        responseType: 'blob'\n      })\n      .subscribe(() => {\n        this.loading = false;\n        window.open(url, '_blank');\n        this.cdRef.detectChanges();\n      });\n  }\n\n  formatFileName(name: string) {\n    name = name.split('_').join(' ');\n    const index = name.indexOf('.');\n    name = name.slice(0, index);\n    return name;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\nimport { ExportOptions } from '@igo2/geo';\n\nexport enum ImportExportType {\n  layer = 'layer',\n  context = 'context'\n}\n\nexport enum ImportExportMode {\n  import = 'import',\n  export = 'export'\n}\n\n/**\n * Service that holds the state of the importExport module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ImportExportState {\n  readonly importExportType$: BehaviorSubject<ImportExportType> =\n    new BehaviorSubject(ImportExportType.layer);\n  readonly selectedMode$: BehaviorSubject<ImportExportMode> =\n    new BehaviorSubject(ImportExportMode.import);\n  readonly exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\n    undefined\n  );\n\n  setImportExportType(type: ImportExportType) {\n    this.importExportType$.next(type);\n  }\n\n  setMode(mode: ImportExportMode) {\n    this.selectedMode$.next(mode);\n  }\n\n  setsExportOptions(exportOptions: ExportOptions) {\n    this.exportOptions$.next(exportOptions);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { Toolbox, ToolService } from '@igo2/common';\n\nimport { ExportOptions } from '@igo2/geo';\nimport { BehaviorSubject } from 'rxjs';\nimport {\n  ImportExportMode,\n  ImportExportState\n} from '../import-export/import-export.state';\n\n/**\n * Service that holds the state of the search module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ToolState {\n  get toolbox(): Toolbox {\n    return this.toolService.toolbox;\n  }\n\n  public openSidenav$: BehaviorSubject<boolean> = new BehaviorSubject(\n    undefined\n  );\n\n  constructor(\n    private toolService: ToolService,\n    private importExportState: ImportExportState\n  ) {}\n\n  toolToActivateFromOptions(toolToActivate: {\n    tool: string;\n    options: { [key: string]: any };\n  }) {\n    if (!toolToActivate) {\n      return;\n    }\n    if (toolToActivate.tool === 'importExport') {\n      let exportOptions: ExportOptions =\n        this.importExportState.exportOptions$.value;\n      if (!exportOptions) {\n        exportOptions = {\n          layers: toolToActivate.options.layers,\n          featureInMapExtent: toolToActivate.options.featureInMapExtent\n        };\n      } else {\n        exportOptions.layers = toolToActivate.options.layers;\n        exportOptions.featureInMapExtent =\n          toolToActivate.options.featureInMapExtent;\n      }\n      this.importExportState.setsExportOptions(exportOptions);\n      this.importExportState.setMode(ImportExportMode.export);\n    }\n\n    if (this.toolbox.getTool(toolToActivate.tool)) {\n      this.toolbox.activateTool(toolToActivate.tool);\n      this.openSidenav$.next(true);\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport { Tool, ToolService } from '@igo2/common';\nimport { ContextService, DetailedContext } from '@igo2/context';\n\nimport { ToolState } from '../tool/tool.state';\n\n/**\n * Service that holds the state of the context module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextState {\n  /**\n   * Observable of the active context\n   */\n  context$: BehaviorSubject<DetailedContext> = new BehaviorSubject(undefined);\n\n  constructor(\n    private contextService: ContextService,\n    private toolService: ToolService,\n    private toolState: ToolState,\n    private languageService: LanguageService\n  ) {\n    this.contextService.context$.subscribe((context: DetailedContext) => {\n      this.onContextChange(context);\n    });\n    this.contextService.toolsChanged$.subscribe((context: DetailedContext) => {\n      this.updateTools(context);\n    });\n  }\n\n  /**\n   * Set the active context\n   * @param context Detailed context\n   */\n  private setContext(context: DetailedContext) {\n    this.updateTools(context);\n    this.context$.next(context);\n  }\n\n  /**\n   * Update the tool state with the context's tools\n   * @param context Detailed context\n   */\n  private updateTools(context: DetailedContext) {\n    const toolbox = this.toolState.toolbox;\n\n    const tools = [];\n    const contextTools = context.tools || [];\n    contextTools.forEach((contextTool: Tool) => {\n      const baseTool = this.toolService.getTool(contextTool.name);\n      if (baseTool === undefined) {\n        return;\n      }\n\n      const options = Object.assign(\n        {},\n        baseTool.options || {},\n        contextTool.options || {}\n      );\n      const tool = Object.assign({}, baseTool, contextTool, { options });\n      tools.push(tool);\n    });\n\n    tools.forEach((tool) => {\n      if (tool.parent) {\n        const parentIndex = tools.findIndex((el) => el.name === tool.parent);\n        if (parentIndex !== -1) {\n          tools[parentIndex].children = [];\n          tools[parentIndex].children.push(tool.name);\n        }\n      }\n    });\n\n    toolbox.setTools(tools);\n    toolbox.setToolbar(context.toolbar || []);\n\n    // TODO: This is a patch so the context service can work without\n    // injecting the ToolState or without being completely refactored\n    this.contextService.setTools([].concat(tools));\n    this.contextService.setToolbar(context.toolbar || []);\n  }\n\n  /**\n   * Set a new context and update the tool state\n   * @param context Detailed context\n   */\n  private onContextChange(context: DetailedContext) {\n    if (context === undefined) {\n      return;\n    }\n    this.setContext(context);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { StorageService } from '@igo2/core';\n\n/**\n * Service that holds the state of storage service\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageState {\n  get storageService(): StorageService {\n    return this.igoStorageService;\n  }\n\n  constructor(private igoStorageService: StorageService) {}\n}\n","import {\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  Widget,\n  Action\n} from '@igo2/common';\nimport { LanguageService, MediaService, StorageService } from '@igo2/core';\nimport {\n  FeatureMotion,\n  FeatureStoreSelectionStrategy,\n  FeatureWorkspace,\n  WfsWorkspace,\n  EditionWorkspace,\n  mapExtentStrategyActiveToolTip,\n  noElementSelected,\n  ExportOptions,\n  OgcFilterableDataSource\n} from '@igo2/geo';\nimport { BehaviorSubject, map } from 'rxjs';\n\nimport * as jsPDF from 'jspdf';\nimport 'jspdf-autotable';\nimport { ToolState } from '../../tool';\nimport { DatePipe } from '@angular/common';\n\nexport function handleZoomAuto(\n  workspace: FeatureWorkspace | WfsWorkspace | EditionWorkspace,\n  storageService\n) {\n  const zoomStrategy = workspace.entityStore.getStrategyOfType(\n    FeatureStoreSelectionStrategy\n  ) as FeatureStoreSelectionStrategy;\n  zoomStrategy.setMotion(\n    (storageService.get('zoomAuto') as boolean)\n      ? FeatureMotion.Default\n      : FeatureMotion.None\n  );\n}\n\nexport function getWorkspaceActions(\n  workspace: FeatureWorkspace | WfsWorkspace | EditionWorkspace,\n  rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n  selectOnlyCheckCondition$: BehaviorSubject<boolean>,\n  ogcFilterWidget: Widget,\n  zoomAuto$: BehaviorSubject<boolean>,\n  maximize$: BehaviorSubject<boolean>,\n  storageService: StorageService,\n  languageService: LanguageService,\n  mediaService: MediaService,\n  toolState: ToolState,\n  datePipe: DatePipe\n): Action[] {\n  const actions = [\n    {\n      id: 'zoomAuto',\n      checkbox: true,\n      title: 'igo.integration.workspace.zoomAuto.title',\n      tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\n      checkCondition: zoomAuto$,\n      handler: () => {\n        handleZoomAuto(workspace, storageService);\n        storageService.set(\n          'zoomAuto',\n          !storageService.get('zoomAuto') as boolean\n        );\n      }\n    },\n    {\n      id: 'filterInMapExtent',\n      checkbox: true,\n      title: 'igo.integration.workspace.inMapExtent.title',\n      tooltip: mapExtentStrategyActiveToolTip(workspace),\n      checkCondition: rowsInMapExtentCheckCondition$,\n      handler: () =>\n        rowsInMapExtentCheckCondition$.next(\n          !rowsInMapExtentCheckCondition$.value\n        )\n    },\n    {\n      id: 'selectedOnly',\n      checkbox: true,\n      title: 'igo.integration.workspace.selected.title',\n      tooltip: 'igo.integration.workspace.selected.tooltip',\n      checkCondition: selectOnlyCheckCondition$,\n      handler: () =>\n        selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\n    },\n    {\n      id: 'clearselection',\n      icon: 'select-off',\n      title: 'igo.integration.workspace.clearSelection.title',\n      tooltip: 'igo.integration.workspace.clearSelection.tooltip',\n      handler: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) => {\n        ws.entityStore.state.updateMany(ws.entityStore.view.all(), {\n          selected: false\n        });\n      },\n      args: [workspace],\n      availability: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) =>\n        noElementSelected(ws)\n    },\n    {\n      id: 'featureDownload',\n      icon: 'file-export',\n      title: 'igo.integration.workspace.download.title',\n      tooltip: 'igo.integration.workspace.download.tooltip',\n      handler: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) => {\n        const filterStrategy = ws.entityStore.getStrategyOfType(\n          EntityStoreFilterCustomFuncStrategy\n        );\n        const filterSelectionStrategy = ws.entityStore.getStrategyOfType(\n          EntityStoreFilterSelectionStrategy\n        );\n        const layersWithSelection = filterSelectionStrategy.active\n          ? [ws.layer.id]\n          : [];\n        toolState.toolToActivateFromOptions({\n          tool: 'importExport',\n          options: {\n            layers: [ws.layer.id],\n            featureInMapExtent: filterStrategy.active,\n            layersWithSelection\n          } as ExportOptions\n        });\n      },\n      args: [workspace]\n    },\n    {\n      id: 'ogcFilter',\n      icon: 'filter',\n      title: 'igo.integration.workspace.ogcFilter.title',\n      tooltip: 'igo.integration.workspace.ogcFilter.tooltip',\n      handler: (\n        widget: Widget,\n        ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace\n      ) => {\n        ws.activateWidget(widget, {\n          map: ws.map,\n          layer: ws.layer\n        });\n      },\n      args: [ogcFilterWidget, workspace]\n    },\n    {\n      id: 'maximize',\n      title: languageService.translate.instant(\n        'igo.integration.workspace.maximize'\n      ),\n      tooltip: languageService.translate.instant(\n        'igo.integration.workspace.maximizeTooltip'\n      ),\n      icon: 'resize',\n      display: () => {\n        return maximize$.pipe(map((v) => !v && !mediaService.isMobile()));\n      },\n      handler: () => {\n        if (!mediaService.isMobile()) {\n          maximize$.next(true);\n        }\n      }\n    },\n    {\n      id: 'standardExtent',\n      title: languageService.translate.instant(\n        'igo.integration.workspace.standardExtent'\n      ),\n      tooltip: languageService.translate.instant(\n        'igo.integration.workspace.standardExtentTooltip'\n      ),\n      icon: 'resize',\n      display: () => {\n        return maximize$.pipe(map((v) => v && !mediaService.isMobile()));\n      },\n      handler: () => {\n        maximize$.next(false);\n      }\n    },\n    {\n      id: 'print',\n      icon: 'printer',\n      title: 'igo.integration.workspace.print.title',\n      tooltip: 'igo.integration.workspace.print.tooltip',\n      handler: (ws: FeatureWorkspace | WfsWorkspace | EditionWorkspace) => {\n        const title = `${ws.layer.title} (${datePipe.transform(\n          Date.now(),\n          'YYYY-MM-dd-H_mm'\n        )})`;\n        const doc: any = new jsPDF.default('landscape');\n        const totalPagesExp = '{total_pages_count_string}';\n        doc.text(title, 14, 20);\n        doc.autoTable({\n          startY: 25,\n          tableWidth: 'wrap',\n          html: '#currentWorkspaceTable',\n          horizontalPageBreak: true,\n          styles: { cellPadding: 0.5, minCellWidth: 20, fontSize: 6 },\n          didDrawPage: (data) => {\n            let str = 'Page ' + doc.internal.getNumberOfPages();\n            if (typeof doc.putTotalPages === 'function') {\n              str = str + ' / ' + totalPagesExp;\n            }\n            doc.setFontSize(6);\n            const pageSize = doc.internal.pageSize;\n            const pageHeight = pageSize.height\n              ? pageSize.height\n              : pageSize.getHeight();\n            doc.text(str, data.settings.margin.left, pageHeight - 10);\n          }\n        });\n        if (typeof doc.putTotalPages === 'function') {\n          doc.putTotalPages(totalPagesExp);\n        }\n        doc.save(`${title}.pdf`);\n      },\n      args: [workspace]\n    }\n  ];\n  let returnActions = (workspace.layer.dataSource as OgcFilterableDataSource)\n    .options.ogcFilters?.enabled\n    ? actions\n    : actions.filter((action) => action.id !== 'ogcFilter');\n  returnActions =\n    workspace.layer.options.workspace.printable !== false\n      ? actions\n      : actions.filter((action) => action.id !== 'print');\n  return returnActions;\n}\n","import { Injectable, OnDestroy } from '@angular/core';\n\nimport { Action } from '@igo2/common';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { FeatureWorkspace } from '@igo2/geo';\nimport {\n  StorageService,\n  StorageServiceEvent,\n  StorageServiceEventEnum,\n  LanguageService,\n  MediaService\n} from '@igo2/core';\nimport { StorageState } from '../../storage/storage.state';\nimport { skipWhile } from 'rxjs/operators';\nimport { ToolState } from '../../tool/tool.state';\nimport { getWorkspaceActions, handleZoomAuto } from './workspace.utils';\nimport { DatePipe } from '@angular/common';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FeatureActionsService implements OnDestroy {\n  public maximize$: BehaviorSubject<boolean>;\n\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private toolState: ToolState,\n    private mediaService: MediaService,\n    private datePipe: DatePipe\n  ) {\n    this.maximize$ = new BehaviorSubject(\n      this.storageService.get('workspaceMaximize') as boolean\n    );\n  }\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: FeatureWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n    );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: FeatureWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(\n        skipWhile(\n          (storageChange: StorageServiceEvent) =>\n            storageChange?.key !== 'zoomAuto' ||\n            storageChange?.event === StorageServiceEventEnum.CLEARED\n        )\n      )\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    return getWorkspaceActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$,\n      undefined,\n      this.zoomAuto$,\n      this.maximize$,\n      this.storageService,\n      this.languageService,\n      this.mediaService,\n      this.toolState,\n      this.datePipe\n    );\n  }\n}\n","import { Inject, Injectable, OnDestroy } from '@angular/core';\n\nimport { Action, Widget } from '@igo2/common';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { WfsWorkspace, OgcFilterWidget } from '@igo2/geo';\nimport {\n  StorageService,\n  StorageServiceEvent,\n  StorageServiceEventEnum,\n  LanguageService,\n  MediaService\n} from '@igo2/core';\nimport { StorageState } from '../../storage/storage.state';\nimport { skipWhile } from 'rxjs/operators';\nimport { ToolState } from '../../tool/tool.state';\nimport { getWorkspaceActions, handleZoomAuto } from './workspace.utils';\nimport { DatePipe } from '@angular/common';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WfsActionsService implements OnDestroy {\n  public maximize$: BehaviorSubject<boolean>;\n\n  selectOnlyCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(\n    false\n  );\n  // rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    @Inject(OgcFilterWidget) private ogcFilterWidget: Widget,\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private mediaService: MediaService,\n    private toolState: ToolState,\n    private datePipe: DatePipe\n  ) {\n    this.maximize$ = new BehaviorSubject(\n      this.storageService.get('workspaceMaximize') as boolean\n    );\n  }\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: WfsWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n    );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: WfsWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(\n        skipWhile(\n          (storageChange: StorageServiceEvent) =>\n            storageChange?.key !== 'zoomAuto' ||\n            storageChange?.event === StorageServiceEventEnum.CLEARED\n        )\n      )\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    return getWorkspaceActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$,\n      this.ogcFilterWidget,\n      this.zoomAuto$,\n      this.maximize$,\n      this.storageService,\n      this.languageService,\n      this.mediaService,\n      this.toolState,\n      this.datePipe\n    );\n  }\n}\n","import { Inject, Injectable, OnDestroy } from '@angular/core';\n\nimport { Action, Widget } from '@igo2/common';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { EditionWorkspace, OgcFilterWidget } from '@igo2/geo';\nimport {\n  StorageService,\n  StorageServiceEvent,\n  StorageServiceEventEnum,\n  LanguageService,\n  MediaService\n} from '@igo2/core';\nimport { StorageState } from '../../storage/storage.state';\nimport { skipWhile } from 'rxjs/operators';\nimport { ToolState } from '../../tool/tool.state';\nimport { getWorkspaceActions, handleZoomAuto } from './workspace.utils';\nimport { DatePipe } from '@angular/common';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EditionActionsService implements OnDestroy {\n  public maximize$: BehaviorSubject<boolean>;\n\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    @Inject(OgcFilterWidget) private ogcFilterWidget: Widget,\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private mediaService: MediaService,\n    private toolState: ToolState,\n    private datePipe: DatePipe\n  ) {\n    this.maximize$ = new BehaviorSubject(\n      this.storageService.get('workspaceMaximize') as boolean\n    );\n  }\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: EditionWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n    );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: EditionWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n  ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(\n        skipWhile(\n          (storageChange: StorageServiceEvent) =>\n            storageChange?.key !== 'zoomAuto' ||\n            storageChange?.event === StorageServiceEventEnum.CLEARED\n        )\n      )\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    return getWorkspaceActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$,\n      this.ogcFilterWidget,\n      this.zoomAuto$,\n      this.maximize$,\n      this.storageService,\n      this.languageService,\n      this.mediaService,\n      this.toolState,\n      this.datePipe\n    );\n  }\n}\n","import { Injectable, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject, Subscription, Observable, of } from 'rxjs';\n\nimport {\n  EntityRecord,\n  Workspace,\n  WorkspaceStore,\n  Widget,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  EntityState\n} from '@igo2/common';\nimport { WfsWorkspace, FeatureWorkspace, EditionWorkspace } from '@igo2/geo';\nimport { FeatureActionsService } from './shared/feature-actions.service';\nimport { WfsActionsService } from './shared/wfs-actions.service';\nimport { StorageService } from '@igo2/core';\nimport { EditionActionsService } from './shared/edition-actions.service';\n\n/**\n * Service that holds the state of the workspace module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class WorkspaceState implements OnDestroy {\n  public workspacePanelExpanded: boolean = false;\n\n  readonly workspaceEnabled$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(false);\n  readonly rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(true);\n  readonly selectOnlyCheckCondition$: BehaviorSubject<boolean> =\n    new BehaviorSubject<boolean>(false);\n\n  readonly workspaceMaximize$: BehaviorSubject<boolean>;\n  private actionMaximize$$: Subscription[] = [];\n\n  private rowsInMapExtentCheckCondition$$: Subscription;\n  private selectOnlyCheckCondition$$: Subscription;\n\n  /** Subscription to the active workspace */\n  private activeWorkspace$$: Subscription;\n\n  /** Subscription to the active workspace widget */\n  private activeWorkspaceWidget$$: Subscription;\n\n  /** Active widget observable. Only one may be active for all available workspaces */\n  readonly activeWorkspaceWidget$: BehaviorSubject<Widget> =\n    new BehaviorSubject<Widget>(undefined);\n\n  /**\n   * Observable of the active workspace\n   */\n  public workspace$ = new BehaviorSubject<Workspace>(undefined);\n\n  /**\n   * Store that holds all the available workspaces\n   */\n  get store(): WorkspaceStore {\n    return this._store;\n  }\n  private _store: WorkspaceStore;\n\n  get workspaceSelection() {\n    if (this.workspace$.value) {\n      return this.workspace$.value?.entityStore.stateView.manyBy(\n        (r) => r.state.selected === true\n      );\n    } else {\n      return [];\n    }\n  }\n\n  get workspaceSelection$(): Observable<EntityRecord<object, EntityState>[]> {\n    if (this.workspace$.value) {\n      return this.workspace$.value?.entityStore?.stateView.manyBy$(\n        (r) => r.state.selected === true\n      );\n    } else {\n      return of([]);\n    }\n  }\n\n  constructor(\n    private featureActionsService: FeatureActionsService,\n    private wfsActionsService: WfsActionsService,\n    private editionActionsService: EditionActionsService,\n    private storageService: StorageService\n  ) {\n    this.workspaceMaximize$ = new BehaviorSubject(\n      this.storageService.get('workspaceMaximize') as boolean\n    );\n    this.initWorkspaces();\n  }\n\n  /**\n   * Initialize the workspace store. Each time a workspace is activated,\n   * subscribe to it's active widget. Tracking the active widget is useful\n   * to make sure only one widget is active at a time.\n   */\n  private initWorkspaces() {\n    this._store = new WorkspaceStore([]);\n    this._store.stateView\n      .firstBy$(\n        (record: EntityRecord<Workspace>) => record.state.active === true\n      )\n      .subscribe((record: EntityRecord<Workspace>) => {\n        const workspace = record ? record.entity : undefined;\n        this.workspace$.next(workspace);\n      });\n\n    this._store.stateView\n      .all$()\n      .subscribe((workspaces: EntityRecord<Workspace>[]) => {\n        workspaces.map((wks: EntityRecord<Workspace>) => {\n          if (wks.entity.actionStore.empty) {\n            if (wks.entity instanceof WfsWorkspace) {\n              this.wfsActionsService.loadActions(\n                wks.entity,\n                this.rowsInMapExtentCheckCondition$,\n                this.selectOnlyCheckCondition$\n              );\n            } else if (wks.entity instanceof FeatureWorkspace) {\n              this.featureActionsService.loadActions(\n                wks.entity,\n                this.rowsInMapExtentCheckCondition$,\n                this.selectOnlyCheckCondition$\n              );\n            } else if (wks.entity instanceof EditionWorkspace) {\n              this.editionActionsService.loadActions(\n                wks.entity,\n                this.rowsInMapExtentCheckCondition$,\n                this.selectOnlyCheckCondition$\n              );\n            }\n          }\n        });\n      });\n\n    this.actionMaximize$$.push(\n      this.featureActionsService.maximize$.subscribe((maximized) => {\n        this.setWorkspaceIsMaximized(maximized);\n      })\n    );\n\n    this.actionMaximize$$.push(\n      this.wfsActionsService.maximize$.subscribe((maximized) => {\n        this.setWorkspaceIsMaximized(maximized);\n      })\n    );\n\n    this.actionMaximize$$.push(\n      this.editionActionsService.maximize$.subscribe((maximized) => {\n        this.setWorkspaceIsMaximized(maximized);\n      })\n    );\n\n    this.activeWorkspace$$ = this.workspace$.subscribe(\n      (workspace: Workspace) => {\n        if (this.activeWorkspaceWidget$$ !== undefined) {\n          this.activeWorkspaceWidget$$.unsubscribe();\n          this.activeWorkspaceWidget$$ = undefined;\n        }\n\n        if (workspace !== undefined) {\n          this.activeWorkspaceWidget$$ = workspace.widget$.subscribe(\n            (widget: Widget) => this.activeWorkspaceWidget$.next(widget)\n          );\n        }\n      }\n    );\n\n    this.rowsInMapExtentCheckCondition$$ =\n      this.rowsInMapExtentCheckCondition$.subscribe((rowsInMapExtent) => {\n        this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\n          if (!wks.entity.actionStore.empty) {\n            const filterStrategy = wks.entity.entityStore.getStrategyOfType(\n              EntityStoreFilterCustomFuncStrategy\n            );\n            if (filterStrategy) {\n              if (rowsInMapExtent) {\n                filterStrategy.activate();\n              } else {\n                filterStrategy.deactivate();\n              }\n            }\n          }\n        });\n      });\n\n    this.selectOnlyCheckCondition$$ = this.selectOnlyCheckCondition$.subscribe(\n      (selectOnly) => {\n        this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\n          if (!wks.entity.actionStore.empty) {\n            const filterStrategy = wks.entity.entityStore.getStrategyOfType(\n              EntityStoreFilterSelectionStrategy\n            );\n            if (filterStrategy) {\n              if (selectOnly) {\n                filterStrategy.activate();\n              } else {\n                filterStrategy.deactivate();\n              }\n            }\n          }\n        });\n      }\n    );\n  }\n\n  private setWorkspaceIsMaximized(maximized: boolean) {\n    this.storageService.set('workspaceMaximize', maximized);\n    this.workspaceMaximize$.next(maximized);\n  }\n\n  public setActiveWorkspaceById(id: string) {\n    const wksFromId = this.store.all().find((workspace) => workspace.id === id);\n    if (wksFromId) {\n      this.store.activateWorkspace(wksFromId);\n    }\n  }\n\n  public setActiveWorkspaceByTitle(title: string) {\n    const wksFromTitle = this.store\n      .all()\n      .find((workspace) => workspace.title === title);\n    if (wksFromTitle) {\n      this.store.activateWorkspace(wksFromTitle);\n    }\n  }\n\n  /**\n   * Teardown all the workspaces\n   * @internal\n   */\n  ngOnDestroy() {\n    this.teardownWorkspaces();\n    this.actionMaximize$$.map((a) => a.unsubscribe());\n    if (this.rowsInMapExtentCheckCondition$$) {\n      this.selectOnlyCheckCondition$$.unsubscribe();\n    }\n    if (this.selectOnlyCheckCondition$$) {\n      this.selectOnlyCheckCondition$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Teardown the workspace store and any subscribers\n   */\n  private teardownWorkspaces() {\n    this.store.clear();\n    if (this.activeWorkspaceWidget$$ !== undefined) {\n      this.activeWorkspaceWidget$$.unsubscribe();\n    }\n    if (this.activeWorkspace$$ !== undefined) {\n      this.activeWorkspace$$.unsubscribe();\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { StorageService, ConfigService } from '@igo2/core';\n\nimport { IgoMap, MapService, ProjectionService } from '@igo2/geo';\n// import { BehaviorSubject } from 'rxjs';\n\n/**\n * Service that holds the state of the map module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapState {\n  // public mapCenter$ = new BehaviorSubject<boolean>(false);\n  get showAllLegendsValue(): boolean {\n    return this._legendToolShowAll;\n  }\n\n  set showAllLegendsValue(value) {\n    this._legendToolShowAll = value;\n  }\n  private _legendToolShowAll: boolean;\n\n  /**\n   * Active map\n   */\n  get map(): IgoMap {\n    return this._map;\n  }\n  private _map: IgoMap;\n\n  constructor(\n    private mapService: MapService,\n    private projectionService: ProjectionService, // Don't remove this or it'll never be injected,\n    private storageService: StorageService,\n    private configService: ConfigService\n  ) {\n    this._map = new IgoMap(\n      {\n        controls: {\n          scaleLine: true,\n          attribution: {\n            collapsed: true\n          }\n        }\n      },\n      this.storageService,\n      this.configService\n    );\n\n    this.mapService.setMap(this.map);\n  }\n}\n","<div\n  *ngIf=\"userControlledLayerList.length; else noLayersBlock\"\n  class=\"igo-swipe-select-container\"\n>\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <mat-form-field>\n      <mat-label>{{\n        'igo.integration.advanced-map-tool.advanced-swipe.swipe-select'\n          | translate\n      }}</mat-label>\n      <mat-select formControlName=\"layers\" multiple>\n        <mat-option [value]=\"1\" (click)=\"selectAll(e)\" #e>\n          {{\n            'igo.integration.advanced-map-tool.advanced-swipe.selectAll'\n              | translate\n          }}\n        </mat-option>\n        <mat-divider></mat-divider>\n        <mat-option\n          *ngFor=\"let layer of userControlledLayerList\"\n          [value]=\"layer\"\n          (click)=\"applyNewLayers(e)\"\n          >{{ layer.title }}</mat-option\n        >\n      </mat-select>\n    </mat-form-field>\n  </form>\n\n  <mat-slide-toggle\n    class=\"swipe-toggle mat-typography\"\n    [checked]=\"swipe\"\n    [labelPosition]=\"'before'\"\n    (change)=\"startSwipe($event.checked)\"\n  >\n    {{ 'igo.integration.advanced-map-tool.advanced-swipe.swipe' | translate }}\n  </mat-slide-toggle>\n</div>\n\n<ng-template #noLayersBlock>\n  <mat-list>\n    <p class=\"map-empty mat-typography\">\n      {{ 'igo.integration.advanced-map-tool.advanced-swipe.empty' | translate }}\n    </p>\n    <p class=\"map-empty mat-typography\">\n      {{\n        'igo.integration.advanced-map-tool.advanced-swipe.customize' | translate\n      }}\n    </p>\n    <mat-list-item>\n      <mat-icon matListItemIcon svgIcon=\"magnify\"></mat-icon>\n      <span\n        matListItemTitle\n        class=\"search-tool mat-typography\"\n        (click)=\"searchEmit()\"\n      >\n        {{\n          'igo.integration.advanced-map-tool.advanced-swipe.search-tool'\n            | translate\n        }}\n      </span>\n    </mat-list-item>\n    <mat-list-item>\n      <mat-icon matListItemIcon svgIcon=\"layers-plus\"></mat-icon>\n      <span\n        matListItemTitle\n        class=\"catalog-tool mat-typography\"\n        (click)=\"catalogEmit()\"\n      >\n        {{\n          'igo.integration.advanced-map-tool.advanced-swipe.catalog-tool'\n            | translate\n        }}\n      </span>\n    </mat-list-item>\n    <mat-list-item>\n      <mat-icon matListItemIcon svgIcon=\"star\"></mat-icon>\n      <span\n        matListItemTitle\n        class=\"context-tool mat-typography\"\n        (click)=\"contextEmit()\"\n      >\n        {{\n          'igo.integration.advanced-map-tool.advanced-swipe.context-tool'\n            | translate\n        }}\n      </span>\n    </mat-list-item>\n  </mat-list>\n</ng-template>\n","import { Component, OnDestroy, OnInit } from '@angular/core';\nimport {\n  UntypedFormGroup,\n  UntypedFormBuilder,\n  Validators\n} from '@angular/forms';\nimport { ContextService, DetailedContext } from '@igo2/context';\nimport { IgoMap, Layer, VectorLayer } from '@igo2/geo';\nimport { MapState } from '../../map.state';\nimport { ToolState } from '../../../tool/tool.state';\n\n@Component({\n  selector: 'igo-advanced-swipe',\n  templateUrl: './advanced-swipe.component.html',\n  styleUrls: ['./advanced-swipe.component.scss']\n})\nexport class AdvancedSwipeComponent implements OnInit, OnDestroy {\n  public swipe: boolean = false;\n  public layerList: Layer[];\n  public userControlledLayerList: Layer[];\n  public form: UntypedFormGroup;\n  public layers: VectorLayer[];\n  public res: DetailedContext;\n  public listForSwipe: Layer[];\n\n  /**\n   * Get an active map state\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    public mapState: MapState,\n    private contextService: ContextService,\n    private formBuilder: UntypedFormBuilder,\n    private toolState: ToolState\n  ) {\n    this.buildForm();\n  }\n\n  /**\n   * Get the list of layers for swipe\n   * @internal\n   */\n  ngOnInit() {\n    this.map.layers$.subscribe(\n      (ll) =>\n        (this.userControlledLayerList = ll.filter(\n          (layer) =>\n            !layer.baseLayer && layer.showInLayerList && layer.displayed\n        ))\n    );\n  }\n\n  /**\n   * Desactivate the swipe\n   * @internal\n   */\n  ngOnDestroy() {\n    this.swipe = false;\n    this.map.swipeEnabled$.next(this.swipe);\n  }\n\n  /**\n   * Build a form for choise of the layers\n   */\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      layers: ['', [Validators.required]]\n    });\n  }\n\n  /**\n   * Activate the swipe, send a list of layers for a swipe-tool\n   */\n  startSwipe(toggle: boolean) {\n    this.swipe = toggle;\n    this.map.swipeEnabled$.next(toggle);\n    this.listForSwipe = [];\n    for (const layer of this.form.value.layers) {\n      this.listForSwipe.push(layer);\n    }\n    this.map.selectedFeatures$.next(this.listForSwipe);\n  }\n\n  /**\n   * Restart a swipe for a new layers-list\n   */\n  applyNewLayers(e) {\n    this.startSwipe(false); // l'approche KISS\n    this.startSwipe(true);\n    if (e._selected) {\n      e._selected = false;\n    }\n    const allLayers = this.userControlledLayerList.length;\n    const selectedLayers = this.form.controls.layers.value.length;\n    if (selectedLayers === allLayers) {\n      e._selected = true;\n    }\n  }\n\n  /**\n   * Select all list of layers and restart a tool\n   */\n  selectAll(e) {\n    if (e._selected) {\n      this.form.controls.layers.setValue(this.userControlledLayerList);\n      e._selected = true;\n    } else {\n      this.form.controls.layers.setValue([]);\n    }\n    this.startSwipe(false);\n    this.startSwipe(true);\n  }\n\n  /**\n   * Open search tool\n   */\n  searchEmit() {\n    this.toolState.toolbox.activateTool('searchResults');\n  }\n\n  /**\n   * Open catalog\n   */\n  catalogEmit() {\n    this.toolState.toolbox.activateTool('catalog');\n  }\n\n  /**\n   * Open context manager\n   */\n  contextEmit() {\n    this.toolState.toolbox.activateTool('contextManager');\n  }\n}\n","<div class=\"advanced-coordinates__coordinates-container\">\n  <div class=\"advanced-coordinates__coordinates-container__inner\">\n    <mat-form-field *ngIf=\"units; else elseBlock\" class=\"coordinates\">\n      <mat-label>{{\n        'igo.integration.advanced-map-tool.advanced-coordinates.lon' | translate\n      }}</mat-label>\n      <textarea\n        #textArea\n        matInput\n        readonly\n        rows=\"1\"\n        [placeholder]=\"\n          'igo.integration.advanced-map-tool.advanced-coordinates.lon'\n            | translate\n        \"\n        [value]=\"coordinates[0]\"\n      ></textarea>\n    </mat-form-field>\n    <ng-template #elseBlock>\n      <mat-form-field class=\"coordinates\">\n        <textarea\n          #textArea\n          matInput\n          readonly\n          rows=\"1\"\n          [placeholder]=\"\n            'igo.integration.advanced-map-tool.advanced-coordinates.est'\n              | translate\n          \"\n          [value]=\"coordinates[0]\"\n        ></textarea>\n      </mat-form-field>\n    </ng-template>\n\n    <mat-form-field *ngIf=\"units; else elseBlock2\" class=\"coordinates2\">\n      <mat-label>{{\n        'igo.integration.advanced-map-tool.advanced-coordinates.lat' | translate\n      }}</mat-label>\n      <textarea\n        #textArea\n        matInput\n        readonly\n        rows=\"1\"\n        [placeholder]=\"\n          'igo.integration.advanced-map-tool.advanced-coordinates.lat'\n            | translate\n        \"\n        [value]=\"coordinates[1]\"\n      ></textarea>\n    </mat-form-field>\n    <ng-template #elseBlock2>\n      <mat-form-field class=\"coordinates2\">\n        <textarea\n          #textArea\n          matInput\n          readonly\n          rows=\"1\"\n          [placeholder]=\"\n            'igo.integration.advanced-map-tool.advanced-coordinates.nord'\n              | translate\n          \"\n          [value]=\"coordinates[1]\"\n        ></textarea>\n      </mat-form-field>\n    </ng-template>\n  </div>\n\n  <button\n    mat-icon-button\n    [attr.aria-label]=\"\n      'igo.integration.advanced-map-tool.advanced-coordinates.copy' | translate\n    \"\n    class=\"igo-form-button-group advanced-coordinates__copy-coordinates\"\n    (click)=\"copyTextToClipboard()\"\n  >\n    <mat-icon svgIcon=\"content-copy\"></mat-icon>\n  </button>\n</div>\n<form class=\"igo-form advanced-coordinates__form\" [formGroup]=\"form\">\n  <mat-form-field class=\"igo-input-container\">\n    <mat-label>{{\n      'igo.integration.advanced-map-tool.advanced-coordinates.coordSystem'\n        | translate\n    }}</mat-label>\n    <mat-select [(value)]=\"inputProj\">\n      <mat-option\n        matTooltipShowDelay=\"500\"\n        *ngFor=\"let projection of projections$ | async\"\n        [value]=\"projection\"\n        (click)=\"$event.stopPropagation()\"\n      >\n        {{ projection.translatedValue || projection.alias }}\n      </mat-option>\n    </mat-select>\n  </mat-form-field>\n  <mat-slide-toggle\n    class=\"center-toggle mat-typography\"\n    [checked]=\"center\"\n    [labelPosition]=\"'before'\"\n    (change)=\"displayCenter($event.checked)\"\n  >\n    {{\n      'igo.integration.advanced-map-tool.advanced-coordinates.center'\n        | translate\n    }}\n  </mat-slide-toggle>\n</form>\n\n<p class=\"igo-zoom mat-typography\">\n  {{\n    'igo.integration.advanced-map-tool.advanced-coordinates.zoom' | translate\n  }}\n  {{ map.viewController.getZoom() }}\n</p>\n<p class=\"igo-zoom mat-typography\">\n  {{\n    'igo.integration.advanced-map-tool.advanced-coordinates.scale' | translate\n  }}\n  {{ formattedScale$ | async }}\n</p>\n<p class=\"igo-zoom mat-typography\">\n  {{\n    'igo.integration.advanced-map-tool.advanced-coordinates.resolution'\n      | translate\n  }}\n  {{ map.viewController.getResolution() | number: '1.0-0' }}\n</p>\n","import {\n  ChangeDetectorRef,\n  Component,\n  OnDestroy,\n  OnInit,\n  Input\n} from '@angular/core';\nimport {\n  formatScale,\n  IgoMap,\n  InputProjections,\n  ProjectionsLimitationsOptions\n} from '@igo2/geo';\nimport { MapState } from '../../map.state';\nimport { Clipboard } from '@igo2/utils';\nimport {\n  MessageService,\n  LanguageService,\n  StorageService,\n  StorageScope,\n  ConfigService\n} from '@igo2/core';\nimport { BehaviorSubject, combineLatest, Subscription } from 'rxjs';\nimport {\n  UntypedFormBuilder,\n  UntypedFormGroup,\n  Validators\n} from '@angular/forms';\nimport { debounceTime } from 'rxjs/operators';\nimport { zoneMtm, zoneUtm, computeProjectionsConstraints } from '@igo2/geo';\nimport * as olproj from 'ol/proj';\n/**\n * Tool to display the coordinates and a cursor of the center of the map\n */\n@Component({\n  selector: 'igo-advanced-coordinates',\n  templateUrl: './advanced-coordinates.component.html',\n  styleUrls: ['./advanced-coordinates.component.scss']\n})\nexport class AdvancedCoordinatesComponent implements OnInit, OnDestroy {\n  public formattedScale$: BehaviorSubject<string> = new BehaviorSubject('');\n  public projections$: BehaviorSubject<InputProjections[]> =\n    new BehaviorSubject([]);\n  public form: UntypedFormGroup;\n  public coordinates: string[];\n  private currentCenterDefaultProj: [number, number];\n  public center: boolean;\n  private inMtmZone: boolean = true;\n  private inLambert2 = { 32198: true, 3798: true };\n  private mapState$$: Subscription;\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\n  private projectionsConstraints: ProjectionsLimitationsOptions;\n  private defaultProj: InputProjections;\n  private currentZones = { utm: undefined, mtm: undefined };\n  public units: boolean = true;\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get inputProj(): InputProjections {\n    return this.form.get('inputProj').value;\n  }\n  set inputProj(value: InputProjections) {\n    this.form.patchValue({ inputProj: value });\n  }\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\n    return this._projectionsLimitations || {};\n  }\n\n  @Input()\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\n    this._projectionsLimitations = value;\n  }\n\n  constructor(\n    public mapState: MapState,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private cdRef: ChangeDetectorRef,\n    private storageService: StorageService,\n    private config: ConfigService,\n    private formBuilder: UntypedFormBuilder\n  ) {\n    this.defaultProj = {\n      translatedValue: this.languageService.translate.instant(\n        'igo.geo.importExportForm.projections.wgs84',\n        { code: 'EPSG:4326' }\n      ),\n      translateKey: 'wgs84',\n      alias: 'WGS84',\n      code: 'EPSG:4326',\n      zone: ''\n    };\n    this.center = this.storageService.get('centerToggle') as boolean;\n    this.computeProjections();\n    this.buildForm();\n  }\n\n  /**\n   * Listen a state of the map, a state of a form, update the coordinates\n   */\n  ngOnInit(): void {\n    this.mapState$$ = combineLatest([\n      this.map.viewController.state$.pipe(debounceTime(50)),\n      this.form.valueChanges\n    ]).subscribe(() => {\n      this.setScaleValue(this.map);\n      this.currentCenterDefaultProj = this.map.viewController.getCenter(\n        this.defaultProj.code\n      );\n      const currentMtmZone = zoneMtm(this.currentCenterDefaultProj[0]);\n      const currentUtmZone = zoneUtm(this.currentCenterDefaultProj[0]);\n      if (!this.inMtmZone && currentMtmZone !== this.currentZones.mtm) {\n        this.back2quebec();\n      }\n      let zoneChange = false;\n      if (currentMtmZone !== this.currentZones.mtm) {\n        this.currentZones.mtm = currentMtmZone;\n        zoneChange = true;\n      }\n      if (currentUtmZone !== this.currentZones.utm) {\n        this.currentZones.utm = currentUtmZone;\n        zoneChange = true;\n      }\n      if (zoneChange) {\n        this.updateProjectionsZoneChange();\n      }\n      this.checkLambert(this.currentCenterDefaultProj);\n      this.coordinates = this.getCoordinates();\n      this.cdRef.detectChanges();\n      this.storageService.set(\n        'currentProjection',\n        this.inputProj,\n        StorageScope.SESSION\n      );\n    });\n\n    const tempInputProj = this.storageService.get(\n      'currentProjection'\n    ) as InputProjections;\n    this.inputProj = this.projections$.value[0];\n    if (tempInputProj !== null) {\n      const pos = this.positionInList(tempInputProj);\n      this.inputProj = this.projections$.value[pos];\n      this.updateZoneMtmUtm();\n    }\n    this.map.mapCenter$.next(this.center);\n    this.coordinates = this.getCoordinates();\n    this.currentCenterDefaultProj = this.map.viewController.getCenter(\n      this.defaultProj.code\n    );\n  }\n\n  ngOnDestroy(): void {\n    this.map.mapCenter$.next(false);\n    this.mapState$$.unsubscribe();\n  }\n\n  setScaleValue(map: IgoMap) {\n    this.formattedScale$.next(\n      ': ~ 1 / ' + formatScale(map.viewController.getScale())\n    );\n  }\n  /**\n   * Coordinates of the center of the map on the appropriate systeme of coordinates\n   * @returns Array of two numbers\n   */\n  getCoordinates(): string[] {\n    this.currentZones.mtm = zoneMtm(this.currentCenterDefaultProj[0]);\n    this.currentZones.utm = zoneUtm(this.currentCenterDefaultProj[0]);\n    let coord;\n    const code = this.inputProj.code;\n    let decimal = 2;\n    if (code.includes('EPSG:4326') || code.includes('EPSG:4269')) {\n      decimal = 5;\n    }\n    this.units = code === 'EPSG:4326' || code === 'EPSG:4269';\n    coord = this.map.viewController\n      .getCenter(code)\n      .map((c) => c.toFixed(decimal));\n    return coord;\n  }\n\n  /**\n   * Copy the coordinates to a clipboard\n   */\n  copyTextToClipboard(): void {\n    const successful = Clipboard.copy(this.coordinates.toString());\n    if (successful) {\n      this.messageService.success(\n        'igo.integration.advanced-map-tool.advanced-coordinates.copyMsg',\n        'igo.integration.advanced-map-tool.advanced-coordinates.copyTitle'\n      );\n    }\n  }\n\n  /**\n   * Display a cursor on the center of the map\n   */\n  displayCenter(toggle: boolean): void {\n    this.center = toggle;\n    this.map.mapCenter$.next(toggle);\n    this.storageService.set('centerToggle', toggle, StorageScope.SESSION);\n  }\n\n  /**\n   * Builder of the form\n   */\n  private buildForm(): void {\n    this.form = this.formBuilder.group({\n      inputProj: ['', [Validators.required]]\n    });\n  }\n\n  /**\n   * Update list of projections after changing of the state of the map\n   */\n  private updateProjectionsZoneChange(): void {\n    let modifiedProj = this.projections$.value;\n    const translate = this.languageService.translate;\n    modifiedProj.map((p) => {\n      if (p.translateKey === 'mtm') {\n        const zone = zoneMtm(this.currentCenterDefaultProj[0]);\n        if (zone) {\n          const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\n          p.alias = `MTM ${zone}`;\n          p.code = code;\n          p.zone = `${zone}`;\n          p.translatedValue = translate.instant(\n            'igo.geo.importExportForm.projections.mtm',\n            p\n          );\n        } else {\n          p.alias = '';\n          this.inMtmZone = false;\n          if (this.inputProj.translateKey === 'mtm') {\n            this.inputProj = this.projections$.value[0];\n          }\n        }\n      }\n      if (p.translateKey === 'utm') {\n        const zone = zoneUtm(this.currentCenterDefaultProj[0]);\n        const code = `EPSG:326${zone}`;\n        p.alias = `UTM ${zone}`;\n        p.code = code;\n        p.zone = `${zone}`;\n        p.translatedValue = translate.instant(\n          'igo.geo.importExportForm.projections.utm',\n          p\n        );\n      }\n    });\n    modifiedProj = modifiedProj.filter((p) => p.alias !== '');\n    this.projections$.next(modifiedProj);\n  }\n\n  /**\n   * Create a list of currents projections\n   */\n  private computeProjections(): void {\n    this.projectionsConstraints = computeProjectionsConstraints(\n      this.projectionsLimitations\n    );\n    const projections: InputProjections[] = [];\n\n    if (!this.currentCenterDefaultProj) {\n      this.currentCenterDefaultProj = this.map.viewController.getCenter(\n        this.defaultProj.code\n      );\n    }\n\n    const translate = this.languageService.translate;\n    if (this.projectionsConstraints.wgs84) {\n      projections.push({\n        translatedValue: translate.instant(\n          'igo.geo.importExportForm.projections.wgs84',\n          { code: 'EPSG:4326' }\n        ),\n        translateKey: 'wgs84',\n        alias: 'WGS84',\n        code: 'EPSG:4326',\n        zone: ''\n      });\n    }\n\n    if (this.projectionsConstraints.nad83) {\n      projections.push({\n        translatedValue: translate.instant(\n          'igo.geo.importExportForm.projections.nad83',\n          { code: 'EPSG:4269' }\n        ),\n        translateKey: 'nad83',\n        alias: 'NAD83',\n        code: 'EPSG:4269',\n        zone: ''\n      });\n    }\n\n    if (this.projectionsConstraints.webMercator) {\n      projections.push({\n        translatedValue: translate.instant(\n          'igo.geo.importExportForm.projections.webMercator',\n          { code: 'EPSG:3857' }\n        ),\n        translateKey: 'webMercator',\n        alias: 'Web Mercator',\n        code: 'EPSG:3857',\n        zone: ''\n      });\n    }\n    if (this.projectionsConstraints.mtm) {\n      // Quebec\n      const zone = zoneMtm(this.currentCenterDefaultProj[0]);\n      if (zone) {\n        this.inMtmZone = true;\n        const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\n        projections.splice(3, 0, {\n          translatedValue: this.languageService.translate.instant(\n            'igo.geo.importExportForm.projections.mtm',\n            { code, zone }\n          ),\n          translateKey: 'mtm',\n          alias: `MTM ${zone}`,\n          code,\n          zone: `${zone}`\n        });\n      } else {\n        this.inMtmZone = false;\n      }\n    }\n    if (this.projectionsConstraints.utm) {\n      const order = this.inMtmZone ? 4 : 3;\n      const zone = zoneUtm(this.currentCenterDefaultProj[0]);\n      const code = zone < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\n      projections.splice(order, 0, {\n        translatedValue: this.languageService.translate.instant(\n          'igo.geo.importExportForm.projections.utm',\n          { code, zone }\n        ),\n        translateKey: 'utm',\n        alias: `UTM ${zone}`,\n        code,\n        zone: `${zone}`\n      });\n    }\n    let configProjection = [];\n    if (this.projectionsConstraints.projFromConfig) {\n      configProjection = this.config.getConfig('projections') || [];\n    }\n    this.projections$.next(projections.concat(configProjection));\n  }\n\n  /**\n   * Push the MTM in the array of systeme of coordinates\n   * @param projections Array of the InputProjections\n   */\n  private pushMtm(projections: Array<InputProjections>): void {\n    if (this.projectionsConstraints.mtm) {\n      const zone = zoneMtm(this.currentCenterDefaultProj[0]);\n      const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\n      projections.splice(3, 0, {\n        translatedValue: this.languageService.translate.instant(\n          'igo.geo.importExportForm.projections.mtm',\n          { code, zone }\n        ),\n        translateKey: 'mtm',\n        alias: `MTM ${zone}`,\n        code,\n        zone: `${zone}`\n      });\n    }\n  }\n\n  /**\n   * Updates the list of systems of coordinates for territory of Quebec\n   * push MTM and UTM in the Array\n   */\n  private back2quebec(): void {\n    const projections = this.projections$.value;\n    this.pushMtm(projections);\n    this.inMtmZone = true;\n  }\n\n  /**\n   * Update the numbers of the zones when application is restarted\n   */\n  private updateZoneMtmUtm() {\n    if (this.inputProj.translateKey === 'mtm') {\n      const zone = zoneMtm(this.currentCenterDefaultProj[0]);\n      this.inputProj.alias = `MTM ${zone}`;\n      const code = zone < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + zone}`;\n      this.inputProj.code = code;\n      this.inputProj.zone = `${zone}`;\n      this.inputProj.translatedValue = this.languageService.translate.instant(\n        'igo.geo.importExportForm.projections.mtm',\n        { code, zone }\n      );\n    }\n    if (this.inputProj.translateKey === 'utm') {\n      const zone = zoneUtm(this.currentCenterDefaultProj[0]);\n      this.inputProj.alias = `UTM ${zone}`;\n      const code = zone < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\n      this.inputProj.code = code;\n      this.inputProj.zone = `${zone}`;\n      this.inputProj.translatedValue = this.languageService.translate.instant(\n        'igo.geo.importExportForm.projections.utm',\n        { code, zone }\n      );\n    }\n  }\n\n  /**\n   * Compute the position of a current projection in a list. 0 if the projection is not in the list\n   * @param translateKey string, translate key of a projection\n   * @returns numeric, position of an element in the array\n   */\n  positionInList(tempInputProj: InputProjections): number {\n    const tk = tempInputProj.translateKey;\n    const alias = tempInputProj.alias;\n    let position; // = undefined;\n    let iter = 0;\n    this.projections$.value.map((projection) => {\n      if (tk) {\n        if (tk === projection.translateKey) {\n          position = iter;\n        }\n      } else if (alias === projection.alias) {\n        position = iter;\n      }\n      iter++;\n    });\n    position = position ? position : 0;\n    return position;\n  }\n\n  /**\n   * Change the list of projections depending on the projections of Lambert\n   * @param coordinates An array of numbers, longitude and latitude\n   */\n  checkLambert(coordinates: [number, number]) {\n    const lambertProjections = this.config.getConfig('projections');\n    lambertProjections.forEach((projection) => {\n      let modifiedProj = this.projections$.value;\n      const extent = projection.extent;\n      const code = projection.code.match(/\\d+/);\n      const currentExtentWGS = olproj.transformExtent(\n        extent,\n        projection.code,\n        this.defaultProj.code\n      );\n      if (\n        coordinates[0] < currentExtentWGS[0] ||\n        coordinates[0] > currentExtentWGS[2] ||\n        coordinates[1] < currentExtentWGS[1] ||\n        coordinates[1] > currentExtentWGS[3]\n      ) {\n        this.inLambert2[code] = false;\n        if (this.inputProj.alias === projection.alias) {\n          this.inputProj = this.projections$.value[0];\n        }\n        modifiedProj = modifiedProj.filter((p) => p.alias !== projection.alias);\n        this.projections$.next(modifiedProj);\n      } else {\n        if (!this.inLambert2[code]) {\n          this.projections$.next(modifiedProj.concat(projection));\n          this.inLambert2[code] = true;\n        }\n      }\n    });\n  }\n}\n","import { Component } from '@angular/core';\nimport { ToolComponent } from '@igo2/common';\nimport { MapState } from '../map.state';\n\n@ToolComponent({\n  name: 'advancedMap',\n  title: 'igo.integration.tools.advancedMap',\n  icon: 'toolbox'\n})\n/**\n * Tool to handle the advanced map tools\n */\n@Component({\n  selector: 'igo-advanced-map-tool',\n  templateUrl: './advanced-map-tool.component.html',\n  styleUrls: ['./advanced-map-tool.component.scss']\n})\nexport class AdvancedMapToolComponent {\n  get tracking$() {\n    return this.mapState.map.geolocationController.tracking$;\n  }\n  get followPosition$() {\n    return this.mapState.map.geolocationController.followPosition$;\n  }\n\n  constructor(public mapState: MapState) {}\n\n  toggleTracking(value) {\n    this.mapState.map.geolocationController.tracking = value;\n  }\n\n  toggleFollow(value) {\n    this.mapState.map.geolocationController.followPosition = value;\n  }\n}\n","<h4 class=\"nameOfTool\">\n  {{\n    'igo.integration.advanced-map-tool.advanced-swipe.swipe-tool' | translate\n  }}\n</h4>\n<igo-advanced-swipe></igo-advanced-swipe>\n<mat-divider class=\"advanced-tool-line\"></mat-divider>\n<h4 class=\"nameOfTool\">\n  {{\n    'igo.integration.advanced-map-tool.advanced-coordinates.coordinates'\n      | translate\n  }}\n</h4>\n<igo-advanced-coordinates></igo-advanced-coordinates>\n<mat-divider class=\"advanced-tool-line\"></mat-divider>\n\n<h4 class=\"nameOfTool\">\n  {{ 'igo.integration.advanced-map-tool.geolocation.title' | translate }}\n</h4>\n\n<div class=\"igo-input-container\">\n  <div class=\"geolocation-slide-toggle-container mat-typography\">\n    <mat-slide-toggle\n      class=\"geolocation-option mat-typography\"\n      [checked]=\"tracking$ | async\"\n      [labelPosition]=\"'before'\"\n      (change)=\"toggleTracking($event.checked)\"\n    >\n      {{ 'igo.integration.advanced-map-tool.geolocation.tracking' | translate }}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      class=\"geolocation-option mat-typography\"\n      [disabled]=\"(tracking$ | async) !== true\"\n      [labelPosition]=\"'before'\"\n      [checked]=\"followPosition$ | async\"\n      (change)=\"toggleFollow($event.checked)\"\n    >\n      {{ 'igo.integration.advanced-map-tool.geolocation.follow' | translate }}\n    </mat-slide-toggle>\n  </div>\n</div>\n","import { Injectable } from '@angular/core';\n\nimport {\n  FeatureStore,\n  Feature,\n  IgoMap,\n  featureFromOl,\n  measureOlGeometryLength,\n  Layer,\n  QueryableDataSourceOptions,\n  FEATURE,\n  roundCoordTo,\n  QueryableDataSource,\n  MapGeolocationState\n} from '@igo2/geo';\nimport { BehaviorSubject, combineLatest, interval, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\nimport { MapState } from '../map/map.state';\n\nimport GeoJSON from 'ol/format/GeoJSON';\nimport { uuid } from '@igo2/utils';\n\nimport olLayerVector from 'ol/layer/Vector';\nimport olVectorSource from 'ol/source/Vector';\nimport Geometry from 'ol/geom/Geometry';\nimport olLineString from 'ol/geom/LineString';\nimport * as olProj from 'ol/proj';\nimport { StorageService } from '@igo2/core';\n/**\n * Service that holds the state of the direction module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapProximityState {\n  private defaultProximityRadiusValue: number = 30;\n\n  public enabled$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(\n    false\n  );\n  public proximityRadiusValue$: BehaviorSubject<number>;\n  public proximitylocationType$: BehaviorSubject<string> =\n    new BehaviorSubject<string>('geolocation');\n  public proximityFeatureStore: FeatureStore<Feature>;\n  private subs$$: Subscription[] = [];\n  public currentPositionCoordinate$: BehaviorSubject<[number, number]> =\n    new BehaviorSubject(undefined);\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    private mapState: MapState,\n    private storageService: StorageService\n  ) {\n    this.proximityFeatureStore = new FeatureStore<Feature>([], {\n      map: this.mapState.map\n    });\n\n    this.proximityRadiusValue$ = new BehaviorSubject<number>(\n      (this.storageService.get('mapProximityRadius') as number) ||\n        this.defaultProximityRadiusValue\n    );\n\n    this.mapState.map.ol.once('rendercomplete', () => {\n      this.subscribeProximityMonitor();\n    });\n  }\n\n  subscribeProximityMonitor() {\n    this.subs$$.push(\n      combineLatest([\n        this.enabled$,\n        this.proximitylocationType$,\n        this.proximityRadiusValue$,\n        interval(5000),\n        this.map.geolocationController.position$\n      ])\n        .pipe(debounceTime(750))\n        .subscribe(\n          (bunch: [boolean, string, number, number, MapGeolocationState]) => {\n            this.proximityFeatureStore.clear();\n            const enabled = bunch[0];\n            const layers = this.map.layers;\n            const currentPos = this.map.geolocationController.position$.value;\n            const locationType = bunch[1];\n            const proximityRadiusValue = bunch[2];\n            this.storageService.set(\n              'mapProximityRadius',\n              proximityRadiusValue || this.defaultProximityRadiusValue\n            );\n\n            if (!enabled) {\n              return;\n            }\n\n            let coord: number[];\n            if (locationType === 'geolocation') {\n              if (!currentPos || !currentPos.position) {\n                return;\n              }\n\n              coord = olProj.transform(\n                currentPos.position,\n                currentPos.projection,\n                this.map.projection\n              );\n              this.map.mapCenter$.next(false);\n            } else {\n              coord = this.map.viewController.getCenter();\n              this.map.mapCenter$.next(true);\n            }\n\n            const coordLonLat = olProj.transform(\n              coord,\n              this.map.projection,\n              'EPSG:4269'\n            );\n            const roundedCoordLonLat = roundCoordTo(\n              coordLonLat as [number, number],\n              6\n            );\n            this.currentPositionCoordinate$.next(roundedCoordLonLat);\n\n            const layersToMonitor = layers.filter(\n              (layer) =>\n                layer.ol instanceof olLayerVector &&\n                (layer.dataSource as QueryableDataSource).options.queryable &&\n                layer.visible &&\n                layer.isInResolutionsRange\n            );\n\n            layersToMonitor.map((layerToMonitor) => {\n              const layerSource =\n                layerToMonitor.ol.getSource() as olVectorSource<Geometry>;\n\n              // Mostly for polygon features.\n              const olFeaturesAtCoordinate =\n                layerSource.getFeaturesAtCoordinate(coord);\n              if (olFeaturesAtCoordinate && olFeaturesAtCoordinate.length) {\n                olFeaturesAtCoordinate.map((olFeatureAtCoordinate) => {\n                  const featureAtThisPosition = featureFromOl(\n                    olFeatureAtCoordinate,\n                    this.map.projection\n                  );\n                  let title = this.getQueryTitle(\n                    featureAtThisPosition,\n                    layerToMonitor\n                  );\n                  // todo handle imported layers without querytitle? prompt title or detect first column?\n                  this.addFeatureToStore(\n                    layerToMonitor,\n                    coord,\n                    featureAtThisPosition,\n                    title,\n                    0\n                  );\n                });\n              } else {\n                // compute proximity for remaining sources\n                const closestOlFeature =\n                  layerSource.getClosestFeatureToCoordinate(coord);\n                if (closestOlFeature) {\n                  const closestOlGeom = closestOlFeature.getGeometry();\n                  const closestFeature = featureFromOl(\n                    closestOlFeature,\n                    this.map.projection\n                  );\n                  const geometryClosestPoint =\n                    closestOlGeom.getClosestPoint(coord);\n                  const linebetween = new olLineString([\n                    coord,\n                    geometryClosestPoint\n                  ]);\n                  const lineLength = measureOlGeometryLength(\n                    linebetween,\n                    'EPSG:3857'\n                  );\n                  if (lineLength <= proximityRadiusValue) {\n                    let title = this.getQueryTitle(\n                      closestFeature,\n                      layerToMonitor\n                    );\n                    // todo handle imported layers without querytitle? prompt title or detect first column?\n                    this.addFeatureToStore(\n                      layerToMonitor,\n                      coord,\n                      closestFeature,\n                      title,\n                      lineLength\n                    );\n                  }\n                }\n              }\n            });\n          }\n        )\n    );\n  }\n\n  /**\n   * Add a feature with proximity properties to the store\n   * @internal\n   */\n  private addFeatureToStore(\n    layer: Layer,\n    coordFromCalculatedDistance,\n    feature: Feature,\n    title,\n    distance\n  ) {\n    const featureId = uuid();\n    const projection = this.map.ol.getView().getProjection();\n    const olGeometry = feature.ol.getGeometry() as Geometry;\n    const geometry = new GeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n    this.proximityFeatureStore.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        ...feature.properties,\n        ...{\n          id: featureId,\n          element: title,\n          distance,\n          coordFromCalculatedDistance,\n          layerSrcId: layer.id,\n          layerSrcTitle: layer.title\n        }\n      },\n      meta: {\n        id: featureId\n      }\n    });\n  }\n\n  getQueryTitle(feature: Feature, layer: Layer): string {\n    let title;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\n      }\n    }\n    return title;\n  }\n\n  getLabelMatch(feature: Feature, labelMatch): string {\n    let label = labelMatch;\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach((v) => {\n      label = label.replace(v[0], feature.properties[v[1]]);\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.properties[labelMatch] || labelMatch;\n    }\n    return label;\n  }\n}\n","<igo-entity-table\n  #table\n  class=\"table-compact\"\n  [store]=\"mapProximityState.proximityFeatureStore\"\n  [template]=\"tableTemplate\"\n></igo-entity-table>\n<br />\n<mat-form-field\n  *ngIf=\"mapProximityState.currentPositionCoordinate$ | async as coord\"\n  class=\"coordinates\"\n>\n  <textarea\n    #textArea\n    matInput\n    readonly\n    rows=\"1\"\n    [placeholder]=\"'igo.integration.map-proximity-tool.lon' | translate\"\n    [value]=\"coord[0]\"\n  ></textarea>\n</mat-form-field>\n<mat-form-field\n  *ngIf=\"mapProximityState.currentPositionCoordinate$ | async as coord2\"\n  class=\"coordinates2\"\n>\n  <textarea\n    #textArea\n    matInput\n    readonly\n    rows=\"1\"\n    [placeholder]=\"'igo.integration.map-proximity-tool.lat' | translate\"\n    [value]=\"coord2[1]\"\n  ></textarea>\n</mat-form-field>\n\n<button\n  *ngIf=\"\n    (mapProximityState.currentPositionCoordinate$ | async) &&\n    (mapProximityState.currentPositionCoordinate$ | async).length\n  \"\n  mat-icon-button\n  (click)=\"copyTextToClipboard()\"\n>\n  <mat-icon svgIcon=\"content-copy\"></mat-icon>\n</button>\n<div class=\"title-container\">\n  <mat-label class=\"title mat-typography\">{{\n    'igo.integration.map-proximity-tool.method' | translate\n  }}</mat-label>\n</div>\n<div class=\"igo-input-container mat-typography\">\n  <mat-radio-group (change)=\"onLocationTypeChange($event)\">\n    <mat-radio-button\n      [checked]=\"\n        (mapProximityState.proximitylocationType$ | async) === 'geolocation'\n      \"\n      value=\"geolocation\"\n      >{{\n        'igo.integration.map-proximity-tool.geolocation' | translate\n      }}</mat-radio-button\n    >\n    <mat-radio-button\n      [checked]=\"\n        (mapProximityState.proximitylocationType$ | async) === 'mapCenter'\n      \"\n      value=\"mapCenter\"\n      >{{\n        'igo.integration.map-proximity-tool.mapCenter' | translate\n      }}</mat-radio-button\n    >\n  </mat-radio-group>\n</div>\n\n<div class=\"radius-unit\">\n  <mat-form-field class=\"radius-field\" floatLabel=\"always\">\n    <mat-label>{{\n      'igo.integration.map-proximity-tool.radiusM' | translate\n    }}</mat-label>\n    <input\n      type=\"number\"\n      pattern=\"[0-9]*\"\n      [(ngModel)]=\"maxDistance\"\n      matInput\n      placeholder=\"{{\n        'igo.integration.map-proximity-tool.radiusM' | translate\n      }}\"\n    />\n  </mat-form-field>\n</div>\n","import { Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\nimport { MatRadioChange } from '@angular/material/radio';\nimport {\n  EntityTableComponent,\n  EntityTableTemplate,\n  ToolComponent\n} from '@igo2/common';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { Feature, IgoMap } from '@igo2/geo';\nimport { NumberUtils, Clipboard } from '@igo2/utils';\nimport { Subscription } from 'rxjs';\nimport { MapProximityState } from '../map-proximity.state';\nimport { MapState } from '../map.state';\n@ToolComponent({\n  name: 'map-proximity',\n  title: 'igo.integration.tools.closestFeature',\n  icon: 'radius'\n})\n/**\n * Tool to handle the advanced map tools\n */\n@Component({\n  selector: 'igo-map-proximity-tool',\n  templateUrl: './map-proximity-tool.component.html',\n  styleUrls: ['./map-proximity-tool.component.scss']\n})\nexport class MapProximityToolComponent implements OnInit, OnDestroy {\n  private subs$$: Subscription[] = [];\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\n\n  get maxDistance() {\n    return this.mapProximityState.proximityRadiusValue$.value;\n  }\n  set maxDistance(value: number) {\n    this.mapProximityState.proximityRadiusValue$.next(value);\n  }\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n  public userDefinedMapCenter: boolean;\n  public userDefinedFollowPosition: boolean;\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate;\n\n  constructor(\n    public mapState: MapState,\n    public mapProximityState: MapProximityState,\n    private languageService: LanguageService,\n    private messageService: MessageService\n  ) {\n    this.tableTemplate = {\n      selection: true,\n      selectMany: false,\n      selectionCheckbox: false,\n      sort: true,\n      columns: [\n        {\n          name: 'element',\n          title: this.languageService.translate.instant(\n            'igo.integration.map-proximity-tool.feature'\n          ),\n          valueAccessor: (localFeature: Feature) => {\n            return localFeature.properties.element;\n          }\n        },\n        {\n          name: 'distance',\n          title: this.languageService.translate.instant(\n            'igo.integration.map-proximity-tool.distance'\n          ),\n          valueAccessor: (localFeature: Feature) => {\n            return `${NumberUtils.roundToNDecimal(\n              localFeature.properties.distance,\n              1\n            )}m`;\n          }\n        }\n      ]\n    };\n  }\n\n  ngOnInit(): void {\n    this.mapProximityState.enabled$.next(true);\n    this.userDefinedFollowPosition =\n      this.map.geolocationController.followPosition === true;\n    this.userDefinedMapCenter = this.map.mapCenter$.value === true;\n\n    this.subs$$.push(\n      this.mapProximityState.proximitylocationType$.subscribe((v) => {\n        this.map.mapCenter$.next(v !== 'geolocation');\n        if (v === 'geolocation') {\n          this.map.geolocationController.followPosition = true;\n        } else {\n          this.map.geolocationController.followPosition = false;\n        }\n      })\n    );\n  }\n\n  ngOnDestroy(): void {\n    this.mapProximityState.enabled$.next(false);\n    this.map.mapCenter$.next(this.userDefinedMapCenter);\n    this.subs$$.map((s) => s.unsubscribe());\n    this.map.geolocationController.followPosition =\n      this.userDefinedFollowPosition;\n  }\n\n  onLocationTypeChange(e: MatRadioChange) {\n    this.mapProximityState.proximitylocationType$.next(e.value);\n  }\n\n  /**\n   * Copy the coordinates to a clipboard\n   */\n  copyTextToClipboard(): void {\n    const successful = Clipboard.copy(\n      this.mapProximityState.currentPositionCoordinate$?.value.toString()\n    );\n    if (successful) {\n      this.messageService.success(\n        'igo.integration.map-proximity-tool.copyMsg',\n        'igo.integration.map-proximity-tool.copyTitle'\n      );\n    }\n  }\n}\n","<button\n  *ngIf=\"hasWorkspace$ | async\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.integration.workspace.toggleWorkspace' | translate\"\n  [color]=\"color\"\n  (click)=\"activateWorkspace()\"\n>\n  <mat-icon svgIcon=\"table\"></mat-icon>\n</button>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport type { Layer } from '@igo2/geo';\nimport { WorkspaceState } from '../workspace.state';\nimport { BehaviorSubject, combineLatest, Subscription } from 'rxjs';\n\n@Component({\n  selector: 'igo-workspace-button',\n  templateUrl: './workspace-button.component.html',\n  styleUrls: ['./workspace-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WorkspaceButtonComponent implements OnInit, OnDestroy {\n  public hasWorkspace$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private hasWorkspace$$: Subscription;\n\n  private _layer: Layer;\n  private layer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\n  @Input()\n  set layer(value: Layer) {\n    this._layer = value;\n    this.layer$.next(this._layer);\n  }\n\n  get layer(): Layer {\n    return this._layer;\n  }\n\n  @Input() color: string = 'primary';\n\n  constructor(private workspaceState: WorkspaceState) {}\n\n  ngOnInit(): void {\n    this.hasWorkspace$$ = combineLatest([\n      this.workspaceState.workspaceEnabled$,\n      this.layer$\n    ]).subscribe((bunch) =>\n      this.hasWorkspace$.next(bunch[0] && bunch[1]?.options.workspace?.enabled)\n    );\n  }\n\n  ngOnDestroy(): void {\n    this.hasWorkspace$$.unsubscribe();\n  }\n\n  activateWorkspace() {\n    if (\n      this.workspaceState.workspace$.value &&\n      (this.workspaceState.workspace$.value as any).layer.id ===\n        this.layer.id &&\n      this.workspaceState.workspacePanelExpanded\n    ) {\n      this.workspaceState.workspacePanelExpanded = false;\n    } else {\n      this.workspaceState.workspacePanelExpanded = true;\n      this.workspaceState.setActiveWorkspaceById(this.layer.id);\n    }\n  }\n}\n","<igo-layer-list\n  class=\"mapDetailsList\"\n  *ngIf=\"(layers$ | async).length; else empty\"\n  [map]=\"map\"\n  igoLayerListBinding\n  [excludeBaseLayers]=\"excludeBaseLayers\"\n  [layerFilterAndSortOptions]=\"layerFilterAndSortOptions\"\n  [expandLegendOfVisibleLayers]=\"expandLegendOfVisibleLayers\"\n  [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n  [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  floatLabel=\"never\"\n  [queryBadge]=\"queryBadge\"\n>\n  <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n    <!-- <igo-download-button [layer]=\"layer\"></igo-download-button> -->\n    <igo-workspace-button [layer]=\"layer\"></igo-workspace-button>\n    <igo-export-button\n      [layer]=\"layer\"\n      (click)=\"activateExport(layer)\"\n    ></igo-export-button>\n    <igo-ogc-filter-button\n      [header]=\"ogcButton\"\n      [layer]=\"layer\"\n    ></igo-ogc-filter-button>\n    <igo-time-filter-button\n      [header]=\"timeButton\"\n      [layer]=\"layer\"\n    ></igo-time-filter-button>\n    <igo-track-feature-button\n      [trackFeature]=\"true\"\n      [layer]=\"layer\"\n    ></igo-track-feature-button>\n    <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n  </ng-template>\n</igo-layer-list>\n\n<ng-template #empty>\n  <mat-list *ngIf=\"delayedShowEmptyMapContent\">\n    <p class=\"map-empty mat-typography\">\n      {{ 'igo.integration.mapTool.empty' | translate }}\n    </p>\n    <p\n      *ngIf=\"\n        layerAdditionAllowed &&\n        (searchToolInToolbar || catalogToolInToolbar || contextToolInToolbar)\n      \"\n      class=\"map-empty mat-typography\"\n    >\n      {{ 'igo.integration.mapTool.customize' | translate }}\n    </p>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && searchToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z\"\n          ></path></svg\n      ></mat-icon>\n      <span\n        matListItemTitle\n        class=\"search-tool mat-typography\"\n        (click)=\"searchEmit()\"\n      >\n        {{ 'igo.integration.mapTool.search-tool' | translate }}\n      </span>\n    </mat-list-item>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && catalogToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z\"\n          ></path></svg\n      ></mat-icon>\n      <span\n        matListItemTitle\n        class=\"catalog-tool mat-typography\"\n        (click)=\"catalogEmit()\"\n      >\n        {{ 'igo.integration.mapTool.catalog-tool' | translate }}\n      </span>\n    </mat-list-item>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && contextToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z\"\n          ></path></svg\n      ></mat-icon>\n      <span\n        matListItemTitle\n        class=\"context-tool mat-typography\"\n        (click)=\"contextEmit()\"\n      >\n        {{ 'igo.integration.mapTool.context-tool' | translate }}\n      </span>\n    </mat-list-item>\n  </mat-list>\n</ng-template>\n","import { Component, Input, OnInit, ChangeDetectorRef } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { ToolComponent } from '@igo2/common';\nimport {\n  LayerListControlsEnum,\n  Layer,\n  IgoMap,\n  LayerListControlsOptions,\n  SearchSourceService,\n  sourceCanSearch,\n  ExportOptions\n} from '@igo2/geo';\n\nimport { ToolState } from './../../tool/tool.state';\nimport { MapState } from './../map.state';\nimport {\n  ImportExportMode,\n  ImportExportState\n} from '../../import-export/import-export.state';\n\n@ToolComponent({\n  name: 'mapDetails',\n  title: 'igo.integration.tools.map',\n  icon: 'map'\n})\n@Component({\n  selector: 'igo-map-details-tool',\n  templateUrl: './map-details-tool.component.html',\n  styleUrls: ['./map-details-tool.component.scss']\n})\nexport class MapDetailsToolComponent implements OnInit {\n  public delayedShowEmptyMapContent: boolean = false;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input() layerListControls: LayerListControlsOptions = {};\n\n  @Input() queryBadge: boolean = false;\n\n  @Input() layerAdditionAllowed: boolean = true;\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get layers$(): Observable<Layer[]> {\n    return this.map.layers$.pipe(\n      map((layers) =>\n        layers.filter(\n          (layer) =>\n            layer.showInLayerList !== false &&\n            (!this.excludeBaseLayers || !layer.baseLayer)\n        )\n      )\n    );\n  }\n\n  get excludeBaseLayers(): boolean {\n    return this.layerListControls.excludeBaseLayers || false;\n  }\n\n  get layerFilterAndSortOptions(): any {\n    const filterSortOptions = Object.assign(\n      {\n        showToolbar: LayerListControlsEnum.default\n      },\n      this.layerListControls\n    );\n\n    switch (this.layerListControls.showToolbar) {\n      case LayerListControlsEnum.always:\n        filterSortOptions.showToolbar = LayerListControlsEnum.always;\n        break;\n      case LayerListControlsEnum.never:\n        filterSortOptions.showToolbar = LayerListControlsEnum.never;\n        break;\n      default:\n        break;\n    }\n    return filterSortOptions;\n  }\n\n  get searchToolInToolbar(): boolean {\n    return (\n      this.toolState.toolbox.getToolbar().indexOf('searchResults') !== -1 &&\n      this.searchSourceService\n        .getSources()\n        .filter(sourceCanSearch)\n        .filter((s) => s.available && s.getType() === 'Layer').length > 0\n    );\n  }\n\n  get catalogToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('catalog') !== -1;\n  }\n\n  get contextToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('contextManager') !== -1;\n  }\n\n  constructor(\n    private mapState: MapState,\n    private toolState: ToolState,\n    private searchSourceService: SearchSourceService,\n    private cdRef: ChangeDetectorRef,\n    private importExportState: ImportExportState\n  ) {}\n\n  ngOnInit(): void {\n    // prevent message to be shown too quickly. Waiting for layers\n    setTimeout(() => {\n      this.delayedShowEmptyMapContent = true;\n      this.cdRef.detectChanges();\n    }, 250);\n  }\n\n  searchEmit() {\n    this.toolState.toolbox.activateTool('searchResults');\n  }\n\n  catalogEmit() {\n    this.toolState.toolbox.activateTool('catalog');\n  }\n\n  contextEmit() {\n    this.toolState.toolbox.activateTool('contextManager');\n  }\n\n  activateExport(layer: Layer) {\n    let id = layer.id;\n    if (layer.options.workspace?.workspaceId) {\n      id =\n        layer.options.workspace.workspaceId !== layer.id\n          ? layer.options.workspace.workspaceId\n          : layer.id;\n    }\n    this.importExportState.setsExportOptions({ layers: [id] } as ExportOptions);\n    this.importExportState.setMode(ImportExportMode.export);\n    this.toolState.toolbox.activateTool('importExport');\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription, combineLatest } from 'rxjs';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { Layer } from '../shared/layers/layer';\nimport { debounceTime } from 'rxjs/operators';\nimport { LayerLegendListComponent } from './layer-legend-list.component';\n\n@Directive({\n  selector: '[igoLayerLegendListBinding]'\n})\nexport class LayerLegendListBindingDirective implements OnInit, OnDestroy {\n  private component: LayerLegendListComponent;\n  private layersOrResolutionChange$$: Subscription;\n  layersVisibility$$: Subscription;\n\n  constructor(\n    @Self() component: LayerLegendListComponent,\n    private mapService: MapService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    this.component.layers = [];\n    this.layersOrResolutionChange$$ = combineLatest([\n      this.mapService.getMap().layers$,\n      this.mapService.getMap().viewController.resolution$\n    ])\n      .pipe(debounceTime(10))\n      .subscribe((bunch: [Layer[], number]) => {\n        const shownLayers = bunch[0].filter((layer: Layer) => {\n          return layer.showInLayerList === true;\n        });\n        this.component.layers = shownLayers;\n\n        this.layersVisibility$$ = combineLatest(\n          shownLayers.map((layer: Layer) => layer.visible$)\n        ).subscribe((r) => {\n          this.component.change$.next();\n        });\n      });\n  }\n\n  ngOnDestroy() {\n    this.layersOrResolutionChange$$.unsubscribe();\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n  }\n}\n","<igo-layer-legend-list\n  *ngIf=\"showAllLegend()\"\n  igoLayerLegendListBinding\n  [excludeBaseLayers]=\"excludeBaseLayers\"\n  [allowShowAllLegends]=\"allowShowAllLegends\"\n  [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n  [showAllLegendsValue]=\"showAllLegendsValue$ | async\"\n  (allLegendsShown)=\"onShowAllLegends($event)\"\n>\n</igo-layer-legend-list>\n<ng-template\n  *ngIf=\"(layers$ | async).length !== 0; else emptyLayers\"\n></ng-template>\n\n<p\n  class=\"map-empty mat-typography\"\n  *ngIf=\"\n    !allowShowAllLegends &&\n    (layers$ | async).length !== 0 &&\n    (visibleOrInRangeLayers$ | async).length === 0\n  \"\n>\n  {{\n    (visibleLayers$ | async).length\n      ? ('igo.integration.mapTool.noLayersInRange' | translate)\n      : ('igo.integration.mapTool.noLayersVisible' | translate)\n  }}\n</p>\n\n<ng-template #emptyLayers>\n  <mat-list *ngIf=\"delayedShowEmptyMapContent\">\n    <p class=\"map-empty mat-typography\">\n      {{ 'igo.integration.mapTool.empty' | translate }}\n    </p>\n    <p\n      *ngIf=\"\n        layerAdditionAllowed &&\n        (searchToolInToolbar || catalogToolInToolbar || contextToolInToolbar)\n      \"\n      class=\"map-empty mat-typography\"\n    >\n      {{ 'igo.integration.mapTool.customize' | translate }}\n    </p>\n\n    <mat-list-item *ngIf=\"layerAdditionAllowed && searchToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z\"\n          ></path></svg\n      ></mat-icon>\n      <span\n        matListItemTitle\n        class=\"search-tool mat-typography\"\n        (click)=\"searchEmit()\"\n      >\n        {{ 'igo.integration.mapTool.search-tool' | translate }}\n      </span>\n    </mat-list-item>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && catalogToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z\"\n          ></path></svg\n      ></mat-icon>\n      <span\n        matListItemTitle\n        class=\"catalog-tool mat-typography\"\n        (click)=\"catalogEmit()\"\n      >\n        {{ 'igo.integration.mapTool.catalog-tool' | translate }}\n      </span>\n    </mat-list-item>\n    <mat-list-item *ngIf=\"layerAdditionAllowed && contextToolInToolbar\">\n      <mat-icon matListItemIcon>\n        <svg\n          viewBox=\"0 0 24 24\"\n          fit=\"\"\n          height=\"100%\"\n          width=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          focusable=\"false\"\n        >\n          <path\n            d=\"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z\"\n          ></path></svg\n      ></mat-icon>\n      <span\n        matListItemTitle\n        class=\"context-tool mat-typography\"\n        (click)=\"contextEmit()\"\n      >\n        {{ 'igo.integration.mapTool.context-tool' | translate }}\n      </span>\n    </mat-list-item>\n  </mat-list>\n</ng-template>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectorRef\n} from '@angular/core';\nimport {\n  Observable,\n  Subscription,\n  BehaviorSubject,\n  ReplaySubject,\n  combineLatest\n} from 'rxjs';\nimport { map, debounceTime } from 'rxjs/operators';\n\nimport { ToolComponent } from '@igo2/common';\nimport {\n  Layer,\n  IgoMap,\n  LayerListControlsOptions,\n  SearchSourceService,\n  sourceCanSearch\n} from '@igo2/geo';\n\nimport { ToolState } from './../../tool/tool.state';\nimport { MapState } from './../map.state';\n\n@ToolComponent({\n  name: 'mapLegend',\n  title: 'igo.integration.tools.legend',\n  icon: 'format-list-bulleted-type'\n})\n@Component({\n  selector: 'igo-map-legend-tool',\n  templateUrl: './map-legend-tool.component.html',\n  styleUrls: ['./map-legend-tool.component.scss']\n})\nexport class MapLegendToolComponent implements OnInit, OnDestroy {\n  public delayedShowEmptyMapContent: boolean = false;\n\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  showAllLegendsValue$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  change$ = new ReplaySubject<void>(1);\n\n  private resolution$$: Subscription;\n  private visibleOrInRangeLayers$$: Subscription;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() layerAdditionAllowed: boolean = true;\n\n  @Input() allowShowAllLegends: boolean = false;\n\n  @Input() showAllLegendsValue: boolean = false;\n\n  @Input() layerListControls: LayerListControlsOptions = {};\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get visibleOrInRangeLayers$(): Observable<Layer[]> {\n    return this.layers$.pipe(\n      map((layers) =>\n        layers.filter(\n          (layer) => layer.visible$.value && layer.isInResolutionsRange$.value\n        )\n      )\n    );\n  }\n\n  get visibleLayers$(): Observable<Layer[]> {\n    return this.layers$.pipe(\n      map((layers) => layers.filter((layer) => layer.visible$.value))\n    );\n  }\n\n  get excludeBaseLayers(): boolean {\n    return this.layerListControls.excludeBaseLayers || false;\n  }\n\n  get searchToolInToolbar(): boolean {\n    return (\n      this.toolState.toolbox.getToolbar().indexOf('searchResults') !== -1 &&\n      this.searchSourceService\n        .getSources()\n        .filter(sourceCanSearch)\n        .filter((s) => s.available && s.getType() === 'Layer').length > 0\n    );\n  }\n\n  get catalogToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('catalog') !== -1;\n  }\n\n  get contextToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('contextManager') !== -1;\n  }\n  constructor(\n    private mapState: MapState,\n    private toolState: ToolState,\n    private searchSourceService: SearchSourceService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit(): void {\n    this.resolution$$ = combineLatest([\n      this.map.layers$,\n      this.map.viewController.resolution$\n    ])\n      .pipe(debounceTime(10))\n      .subscribe((bunch: [Layer[], number]) => {\n        this.layers$.next(\n          bunch[0].filter(\n            (layer) =>\n              layer.showInLayerList !== false &&\n              (!this.excludeBaseLayers || !layer.baseLayer)\n          )\n        );\n      });\n\n    if (this.allowShowAllLegends) {\n      this.mapState.showAllLegendsValue =\n        this.mapState.showAllLegendsValue !== undefined\n          ? this.mapState.showAllLegendsValue\n          : this.showAllLegendsValue || false;\n      this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue);\n    } else {\n      this.showAllLegendsValue$.next(false);\n    }\n\n    // prevent message to be shown too quickly. Waiting for layers\n    setTimeout(() => {\n      this.delayedShowEmptyMapContent = true;\n      this.cdRef.detectChanges();\n    }, 250);\n  }\n\n  onShowAllLegends(event) {\n    this.mapState.showAllLegendsValue = event;\n    this.showAllLegendsValue$.next(event);\n  }\n\n  showAllLegend() {\n    if (this.layers$.getValue().length === 0) {\n      return false;\n    } else if (\n      this.layers$.getValue().length !== 0 &&\n      this.allowShowAllLegends === false\n    ) {\n      let visibleOrInRangeLayers;\n      this.visibleOrInRangeLayers$$ = this.visibleOrInRangeLayers$.subscribe(\n        (value) => {\n          value.length === 0\n            ? (visibleOrInRangeLayers = false)\n            : (visibleOrInRangeLayers = true);\n        }\n      );\n\n      if (visibleOrInRangeLayers === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n    if (this.visibleOrInRangeLayers$$) {\n      this.visibleOrInRangeLayers$$.unsubscribe();\n    }\n  }\n\n  searchEmit() {\n    this.toolState.toolbox.activateTool('searchResults');\n  }\n\n  catalogEmit() {\n    this.toolState.toolbox.activateTool('catalog');\n  }\n\n  contextEmit() {\n    this.toolState.toolbox.activateTool('contextManager');\n  }\n}\n","<mat-tab-group>\n  <mat-tab [label]=\"'igo.integration.tools.map' | translate\">\n    <igo-layer-list\n      [map]=\"map\"\n      igoLayerListBinding\n      [excludeBaseLayers]=\"excludeBaseLayers\"\n      [layerFilterAndSortOptions]=\"layerFilterAndSortOptions\"\n      [expandLegendOfVisibleLayers]=\"expandLegendOfVisibleLayers\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [floatLabel]=\"false\"\n      [queryBadge]=\"queryBadge\"\n    >\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n        <!-- <igo-download-button [layer]=\"layer\"></igo-download-button> -->\n        <igo-workspace-button [layer]=\"layer\"></igo-workspace-button>\n        <igo-export-button\n          [layer]=\"layer\"\n          (click)=\"activateExport(layer)\"\n        ></igo-export-button>\n        <igo-ogc-filter-button\n          [header]=\"ogcButton\"\n          [layer]=\"layer\"\n        ></igo-ogc-filter-button>\n        <igo-time-filter-button\n          [header]=\"timeButton\"\n          [layer]=\"layer\"\n        ></igo-time-filter-button>\n        <igo-track-feature-button\n          [trackFeature]=\"true\"\n          [layer]=\"layer\"\n        ></igo-track-feature-button>\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n      </ng-template>\n    </igo-layer-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.integration.tools.contexts' | translate\">\n    <igo-context-list igoContextListBinding></igo-context-list>\n  </mat-tab>\n</mat-tab-group>\n","import { Component, ChangeDetectionStrategy, Input } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\nimport {\n  LayerListControlsEnum,\n  LayerListControlsOptions,\n  IgoMap,\n  ExportOptions,\n  Layer\n} from '@igo2/geo';\nimport { MapState } from './../map.state';\nimport {\n  ImportExportMode,\n  ImportExportState\n} from '../../import-export/import-export.state';\nimport { ToolState } from '../../tool/tool.state';\n\n/**\n * Tool to browse a map's layers or to choose a different map\n */\n@ToolComponent({\n  name: 'map',\n  title: 'igo.integration.tools.map',\n  icon: 'map'\n})\n@Component({\n  selector: 'igo-map-tool',\n  templateUrl: './map-tool.component.html',\n  styleUrls: ['./map-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MapToolComponent {\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input() layerListControls: LayerListControlsOptions = {};\n\n  @Input() queryBadge: boolean = false;\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get excludeBaseLayers(): boolean {\n    return this.layerListControls.excludeBaseLayers || false;\n  }\n\n  get layerFilterAndSortOptions(): any {\n    const filterSortOptions = Object.assign(\n      {\n        showToolbar: LayerListControlsEnum.default\n      },\n      this.layerListControls\n    );\n\n    switch (this.layerListControls.showToolbar) {\n      case LayerListControlsEnum.always:\n        filterSortOptions.showToolbar = LayerListControlsEnum.always;\n        break;\n      case LayerListControlsEnum.never:\n        filterSortOptions.showToolbar = LayerListControlsEnum.never;\n        break;\n      default:\n        break;\n    }\n    return filterSortOptions;\n  }\n\n  constructor(\n    private mapState: MapState,\n    private toolState: ToolState,\n    private importExportState: ImportExportState\n  ) {}\n\n  activateExport(layer: Layer) {\n    let id = layer.id;\n    if (layer.options.workspace?.workspaceId) {\n      id =\n        layer.options.workspace.workspaceId !== layer.id\n          ? layer.options.workspace.workspaceId\n          : layer.id;\n    }\n    this.importExportState.setsExportOptions({ layers: [id] } as ExportOptions);\n    this.importExportState.setMode(ImportExportMode.export);\n    this.toolState.toolbox.activateTool('importExport');\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { LayerListControlsOptions } from '@igo2/geo';\n\n/**\n * Service that holds the state of layer list tool values\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerListToolState {\n  readonly keyword$: BehaviorSubject<string> = new BehaviorSubject('');\n  readonly sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(\n    undefined\n  );\n  readonly onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(\n    undefined\n  );\n  readonly selectedTab$: BehaviorSubject<number> = new BehaviorSubject(\n    undefined\n  );\n\n  setKeyword(keyword: string) {\n    this.keyword$.next(keyword);\n  }\n\n  setSortAlpha(sort: boolean) {\n    this.sortAlpha$.next(sort);\n  }\n\n  setOnlyVisible(onlyVisible: boolean) {\n    this.onlyVisible$.next(onlyVisible);\n  }\n\n  setSelectedTab(tab: number) {\n    this.selectedTab$.next(tab);\n  }\n\n  getLayerListControls(): LayerListControlsOptions {\n    return {\n      keyword: this.keyword$.value,\n      onlyVisible: this.onlyVisible$.value,\n      sortAlpha: this.sortAlpha$.value\n    };\n  }\n}\n","<mat-tab-group\n  #tabGroup\n  [selectedIndex]=\"layerListToolState.selectedTab$ | async\"\n  (selectedTabChange)=\"tabChanged($event)\"\n>\n  <mat-tab [label]=\"'igo.integration.tools.layers' | translate\">\n    <igo-layer-list\n      *ngIf=\"(layers$ | async).length !== 0; else emptyLayers\"\n      igoLayerListBinding\n      [excludeBaseLayers]=\"excludeBaseLayers\"\n      [layerFilterAndSortOptions]=\"layerFilterAndSortOptions\"\n      [expandLegendOfVisibleLayers]=\"expandLegendOfVisibleLayers\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [floatLabel]=\"false\"\n      [queryBadge]=\"queryBadge\"\n      [map]=\"map\"\n      (appliedFilterAndSort)=\"onLayerListChange($event)\"\n    >\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n        <igo-style-modal-layer-button\n          *ngIf=\"isStyleEditButton(layer)\"\n          [layer]=\"layer\"\n        ></igo-style-modal-layer-button>\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n        <igo-track-feature-button\n          [trackFeature]=\"true\"\n          [layer]=\"layer\"\n        ></igo-track-feature-button>\n        <igo-time-filter-button\n          *ngIf=\"isTimeFilterButton(layer)\"\n          [header]=\"timeButton\"\n          [layer]=\"layer\"\n          (click)=\"activateTimeFilter()\"\n        ></igo-time-filter-button>\n        <igo-ogc-filter-button\n          *ngIf=\"isOGCFilterButton(layer)\"\n          [header]=\"ogcButton\"\n          [layer]=\"layer\"\n          (click)=\"activateOgcFilter()\"\n        ></igo-ogc-filter-button>\n        <igo-export-button\n          *ngIf=\"isExportButton(layer)\"\n          [layer]=\"layer\"\n          (click)=\"activateExport(layer)\"\n        ></igo-export-button>\n        <igo-workspace-button [layer]=\"layer\"></igo-workspace-button>\n      </ng-template>\n    </igo-layer-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.integration.tools.legend' | translate\">\n    <igo-layer-legend-list\n      *ngIf=\"showAllLegend()\"\n      igoLayerLegendListBinding\n      [allowShowAllLegends]=\"allowShowAllLegends\"\n      [showAllLegendsValue]=\"showAllLegendsValue$ | async\"\n      (allLegendsShown)=\"onShowAllLegends($event)\"\n      [excludeBaseLayers]=\"excludeBaseLayers\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n    >\n    </igo-layer-legend-list>\n    <ng-template\n      *ngIf=\"(layers$ | async).length !== 0; else emptyLayers\"\n    ></ng-template>\n\n    <p\n      class=\"map-empty mat-typography\"\n      *ngIf=\"\n        !allowShowAllLegends &&\n        (layers$ | async).length !== 0 &&\n        (visibleOrInRangeLayers$ | async).length === 0\n      \"\n    >\n      {{\n        (visibleLayers$ | async).length\n          ? ('igo.integration.mapTool.noLayersInRange' | translate)\n          : ('igo.integration.mapTool.noLayersVisible' | translate)\n      }}\n    </p>\n  </mat-tab>\n\n  <ng-template #emptyLayers>\n    <mat-list *ngIf=\"delayedShowEmptyMapContent\">\n      <p class=\"map-empty mat-typography\">\n        {{ 'igo.integration.mapTool.empty' | translate }}\n      </p>\n      <p\n        *ngIf=\"\n          layerAdditionAllowed &&\n          (searchToolInToolbar || catalogToolInToolbar || contextToolInToolbar)\n        \"\n        class=\"map-empty mat-typography\"\n      >\n        {{ 'igo.integration.mapTool.customize' | translate }}\n      </p>\n\n      <mat-list-item *ngIf=\"layerAdditionAllowed && searchToolInToolbar\">\n        <mat-icon matListItemIcon>\n          <svg\n            viewBox=\"0 0 24 24\"\n            fit=\"\"\n            height=\"100%\"\n            width=\"100%\"\n            preserveAspectRatio=\"xMidYMid meet\"\n            focusable=\"false\"\n          >\n            <path\n              d=\"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z\"\n            ></path></svg\n        ></mat-icon>\n        <span\n          matListItemTitle\n          class=\"search-tool mat-typography\"\n          (click)=\"searchEmit()\"\n        >\n          {{ 'igo.integration.mapTool.search-tool' | translate }}\n        </span>\n      </mat-list-item>\n      <mat-list-item *ngIf=\"layerAdditionAllowed && catalogToolInToolbar\">\n        <mat-icon matListItemIcon>\n          <svg\n            viewBox=\"0 0 24 24\"\n            fit=\"\"\n            height=\"100%\"\n            width=\"100%\"\n            preserveAspectRatio=\"xMidYMid meet\"\n            focusable=\"false\"\n          >\n            <path\n              d=\"M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z\"\n            ></path></svg\n        ></mat-icon>\n        <span\n          matListItemTitle\n          class=\"catalog-tool mat-typography\"\n          (click)=\"catalogEmit()\"\n        >\n          {{ 'igo.integration.mapTool.catalog-tool' | translate }}\n        </span>\n      </mat-list-item>\n      <mat-list-item *ngIf=\"layerAdditionAllowed && contextToolInToolbar\">\n        <mat-icon matListItemIcon>\n          <svg\n            viewBox=\"0 0 24 24\"\n            fit=\"\"\n            height=\"100%\"\n            width=\"100%\"\n            preserveAspectRatio=\"xMidYMid meet\"\n            focusable=\"false\"\n          >\n            <path\n              d=\"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z\"\n            ></path></svg\n        ></mat-icon>\n        <span\n          matListItemTitle\n          class=\"context-tool mat-typography\"\n          (click)=\"contextEmit()\"\n        >\n          {{ 'igo.integration.mapTool.context-tool' | translate }}\n        </span>\n      </mat-list-item>\n    </mat-list>\n  </ng-template>\n</mat-tab-group>\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  Input,\n  OnInit,\n  ViewChild,\n  OnDestroy\n} from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\nimport {\n  LayerListControlsEnum,\n  LayerListControlsOptions,\n  IgoMap,\n  SearchSourceService,\n  sourceCanSearch,\n  Layer,\n  ExportOptions,\n  VectorLayer\n} from '@igo2/geo';\n\nimport { LayerListToolState } from '../layer-list-tool.state';\nimport { MatTabChangeEvent } from '@angular/material/tabs';\nimport { ToolState } from '../../tool/tool.state';\nimport { MapState } from '../map.state';\nimport { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\nimport { map, debounceTime } from 'rxjs/operators';\nimport {\n  ImportExportMode,\n  ImportExportState\n} from '../../import-export/import-export.state';\n/**\n * Tool to browse a map's layers or to choose a different map\n */\n@ToolComponent({\n  name: 'mapTools',\n  title: 'igo.integration.tools.map',\n  icon: 'map'\n})\n@Component({\n  selector: 'igo-map-tools',\n  templateUrl: './map-tools.component.html',\n  styleUrls: ['./map-tools.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MapToolsComponent implements OnInit, OnDestroy {\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  showAllLegendsValue$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  private resolution$$: Subscription;\n  private visibleOrInRangeLayers$$: Subscription;\n  public delayedShowEmptyMapContent: boolean = false;\n\n  @Input() allowShowAllLegends: boolean = false;\n\n  @Input() showAllLegendsValue: boolean = false;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() selectedTabAtOpening: string;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input() layerAdditionAllowed: boolean = true;\n\n  @Input()\n  get layerListControls(): LayerListControlsOptions {\n    return this._layerListControls;\n  }\n  set layerListControls(value: LayerListControlsOptions) {\n    const stateOptions = this.layerListToolState.getLayerListControls();\n    const stateKeyword = stateOptions.keyword;\n    const stateOnlyVisible = stateOptions.onlyVisible;\n    const stateSortAlpha = stateOptions.sortAlpha;\n\n    value.keyword = stateKeyword !== '' ? stateKeyword : value.keyword;\n    value.onlyVisible =\n      stateOnlyVisible !== undefined ? stateOnlyVisible : value.onlyVisible;\n    value.sortAlpha =\n      stateSortAlpha !== undefined ? stateSortAlpha : value.sortAlpha;\n\n    value.onlyVisible =\n      value.onlyVisible === undefined ? false : value.onlyVisible;\n    value.sortAlpha = value.sortAlpha === undefined ? false : value.sortAlpha;\n\n    this._layerListControls = value;\n  }\n  private _layerListControls = {};\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  @Input() queryBadge: boolean = false;\n\n  get visibleOrInRangeLayers$(): Observable<Layer[]> {\n    return this.layers$.pipe(\n      map((layers) =>\n        layers.filter(\n          (layer) => layer.visible$.value && layer.isInResolutionsRange$.value\n        )\n      )\n    );\n  }\n\n  get visibleLayers$(): Observable<Layer[]> {\n    return this.layers$.pipe(\n      map((layers) => layers.filter((layer) => layer.visible$.value))\n    );\n  }\n\n  get excludeBaseLayers(): boolean {\n    return this.layerListControls.excludeBaseLayers || false;\n  }\n\n  get layerFilterAndSortOptions(): LayerListControlsOptions {\n    const filterSortOptions = Object.assign(\n      {\n        showToolbar: LayerListControlsEnum.default\n      },\n      this.layerListControls\n    );\n\n    switch (this.layerListControls.showToolbar) {\n      case LayerListControlsEnum.always:\n        filterSortOptions.showToolbar = LayerListControlsEnum.always;\n        break;\n      case LayerListControlsEnum.never:\n        filterSortOptions.showToolbar = LayerListControlsEnum.never;\n        break;\n      default:\n        break;\n    }\n    return filterSortOptions;\n  }\n\n  @ViewChild('tabGroup', { static: true }) tabGroup;\n\n  get searchToolInToolbar(): boolean {\n    return (\n      this.toolState.toolbox.getToolbar().indexOf('searchResults') !== -1 &&\n      this.searchSourceService\n        .getSources()\n        .filter(sourceCanSearch)\n        .filter((s) => s.available && s.getType() === 'Layer').length > 0\n    );\n  }\n\n  get catalogToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('catalog') !== -1;\n  }\n\n  get contextToolInToolbar(): boolean {\n    return this.toolState.toolbox.getToolbar().indexOf('contextManager') !== -1;\n  }\n\n  constructor(\n    public layerListToolState: LayerListToolState,\n    private toolState: ToolState,\n    public mapState: MapState,\n    private searchSourceService: SearchSourceService,\n    private importExportState: ImportExportState\n  ) {}\n\n  ngOnInit(): void {\n    this.selectedTab();\n    this.resolution$$ = combineLatest([\n      this.map.layers$,\n      this.map.viewController.resolution$\n    ])\n      .pipe(debounceTime(10))\n      .subscribe((bunch: [Layer[], number]) => {\n        this.layers$.next(\n          bunch[0].filter(\n            (layer) =>\n              layer.showInLayerList !== false &&\n              (!this.excludeBaseLayers || !layer.baseLayer)\n          )\n        );\n      });\n\n    if (this.allowShowAllLegends) {\n      this.mapState.showAllLegendsValue =\n        this.mapState.showAllLegendsValue !== undefined\n          ? this.mapState.showAllLegendsValue\n          : this.showAllLegendsValue || false;\n      this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue);\n    } else {\n      this.showAllLegendsValue$.next(false);\n    }\n\n    // prevent message to be shown too quickly. Waiting for layers\n    setTimeout(() => (this.delayedShowEmptyMapContent = true), 250);\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n    if (this.visibleOrInRangeLayers$$) {\n      this.visibleOrInRangeLayers$$.unsubscribe();\n    }\n  }\n\n  onShowAllLegends(event) {\n    this.mapState.showAllLegendsValue = event;\n    this.showAllLegendsValue$.next(event);\n  }\n\n  private selectedTab() {\n    const userSelectedTab = this.layerListToolState.selectedTab$.value;\n    if (userSelectedTab !== undefined) {\n      this.layerListToolState.setSelectedTab(userSelectedTab);\n    } else {\n      if (this.selectedTabAtOpening === 'legend') {\n        this.layerListToolState.setSelectedTab(1);\n      } else {\n        this.layerListToolState.setSelectedTab(0);\n      }\n    }\n  }\n\n  public tabChanged(tab: MatTabChangeEvent) {\n    this.layerListToolState.setSelectedTab(tab.index);\n    this.layers$.next(\n      this.map.layers.filter(\n        (layer) =>\n          layer.showInLayerList !== false &&\n          (!this.excludeBaseLayers || !layer.baseLayer)\n      )\n    );\n  }\n\n  onLayerListChange(appliedFilters: LayerListControlsOptions) {\n    this.layerListToolState.setKeyword(appliedFilters.keyword);\n    this.layerListToolState.setSortAlpha(appliedFilters.sortAlpha);\n    this.layerListToolState.setOnlyVisible(appliedFilters.onlyVisible);\n  }\n\n  showAllLegend() {\n    if (this.layers$.getValue().length === 0) {\n      return false;\n    } else if (\n      this.layers$.getValue().length !== 0 &&\n      this.allowShowAllLegends === false\n    ) {\n      let visibleOrInRangeLayers;\n      this.visibleOrInRangeLayers$$ = this.visibleOrInRangeLayers$.subscribe(\n        (value) => {\n          value.length === 0\n            ? (visibleOrInRangeLayers = false)\n            : (visibleOrInRangeLayers = true);\n        }\n      );\n\n      if (visibleOrInRangeLayers === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  activateExport(layer: Layer) {\n    let id = layer.id;\n    if (layer.options.workspace?.workspaceId) {\n      id =\n        layer.options.workspace.workspaceId !== layer.id\n          ? layer.options.workspace.workspaceId\n          : layer.id;\n    }\n    this.importExportState.setsExportOptions({ layers: [id] } as ExportOptions);\n    this.importExportState.setMode(ImportExportMode.export);\n    this.toolState.toolbox.activateTool('importExport');\n  }\n\n  activateTimeFilter() {\n    this.toolState.toolbox.activateTool('activeTimeFilter');\n  }\n\n  activateOgcFilter() {\n    this.toolState.toolbox.activateTool('activeOgcFilter');\n  }\n\n  searchEmit() {\n    this.toolState.toolbox.activateTool('searchResults');\n  }\n\n  catalogEmit() {\n    this.toolState.toolbox.activateTool('catalog');\n  }\n\n  contextEmit() {\n    this.toolState.toolbox.activateTool('contextManager');\n  }\n\n  isTimeFilterButton(layer): boolean {\n    const options = layer.dataSource.options;\n    return this.timeButton && options.timeFilterable && options.timeFilter;\n  }\n\n  isOGCFilterButton(layer): boolean {\n    const options = layer.dataSource.options;\n    return (\n      this.ogcButton &&\n      options.ogcFilters &&\n      options.ogcFilters.enabled &&\n      (options.ogcFilters.pushButtons ||\n        options.ogcFilters.checkboxes ||\n        options.ogcFilters.radioButtons ||\n        options.ogcFilters.select ||\n        options.ogcFilters.autocomplete ||\n        options.ogcFilters.editable)\n    );\n  }\n\n  isExportButton(layer: Layer): boolean {\n    if (\n      (layer instanceof VectorLayer && layer.exportable === true) ||\n      (layer.dataSource.options.download &&\n        layer.dataSource.options.download.url) ||\n      (layer.options.workspace?.enabled &&\n        layer.options.workspace?.workspaceId !== layer.id)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  isStyleEditButton(layer: Layer): boolean {\n    if (layer instanceof VectorLayer) {\n      if ((layer as VectorLayer).options?.igoStyle?.editable) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport {\n  EntityRecord,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreStrategyFuncOptions,\n  EntityStoreWithStrategy\n} from '@igo2/common';\nimport { ConfigService, StorageService } from '@igo2/core';\nimport {\n  SearchResult,\n  SearchSourceService,\n  SearchSource,\n  CommonVectorStyleOptions,\n  FeatureWorkspace,\n  FeatureStore,\n  Feature\n} from '@igo2/geo';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { WorkspaceState } from '../workspace/workspace.state';\nimport { MapState } from '../map';\n\n/**\n * Service that holds the state of the search module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class SearchState {\n  public searchLayerStores: FeatureStore<Feature>[] = [];\n  public searchOverlayStyle: CommonVectorStyleOptions = {};\n  public searchOverlayStyleSelection: CommonVectorStyleOptions = {};\n  public searchOverlayStyleFocus: CommonVectorStyleOptions = {};\n\n  public focusedOrResolution$$: Subscription;\n  public selectedOrResolution$$: Subscription;\n\n  readonly searchTermSplitter$: BehaviorSubject<string> = new BehaviorSubject(\n    '|'\n  );\n\n  readonly searchTerm$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  readonly searchDisabled$: BehaviorSubject<boolean> = new BehaviorSubject(\n    false\n  );\n\n  readonly searchResultsGeometryEnabled$: BehaviorSubject<boolean> =\n    new BehaviorSubject(false);\n\n  readonly searchSettingsChange$: BehaviorSubject<boolean> =\n    new BehaviorSubject(undefined);\n\n  readonly selectedResult$: BehaviorSubject<SearchResult> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Store that holds the search results\n   */\n  readonly store = new EntityStoreWithStrategy<SearchResult>([]);\n\n  /**\n   * Search types currently enabled in the search source service\n   */\n  get searchTypes(): string[] {\n    return this.searchSourceService\n      .getEnabledSources()\n      .map((source: SearchSource) => (source.constructor as any).type);\n  }\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private storageService: StorageService,\n    private workspaceState: WorkspaceState,\n    private configService: ConfigService,\n    private mapState: MapState\n  ) {\n    const searchOverlayStyle = this.configService.getConfig(\n      'searchOverlayStyle'\n    ) as {\n      base?: CommonVectorStyleOptions;\n      selection?: CommonVectorStyleOptions;\n      focus?: CommonVectorStyleOptions;\n    };\n    if (searchOverlayStyle) {\n      this.searchOverlayStyle = searchOverlayStyle.base;\n      this.searchOverlayStyleSelection = searchOverlayStyle.selection;\n      this.searchOverlayStyleFocus = searchOverlayStyle.focus;\n    }\n\n    const searchResultsGeometryEnabled = this.storageService.get(\n      'searchResultsGeometryEnabled'\n    ) as boolean;\n    if (searchResultsGeometryEnabled) {\n      this.searchResultsGeometryEnabled$.next(searchResultsGeometryEnabled);\n    }\n    this.store.addStrategy(this.createCustomFilterTermStrategy(), false);\n\n    const wksSource = this.searchSourceService\n      .getSources()\n      .find((source) => source.getId() === 'workspace');\n    this.workspaceState.store.entities$.subscribe((e) => {\n      const searchableWks = e.filter(\n        (fw) =>\n          fw instanceof FeatureWorkspace &&\n          fw.layer.options.workspace.searchIndexEnabled\n      );\n      this.searchSourceService.setWorkspaces(wksSource, searchableWks);\n    });\n    this.monitorLayerDeletion();\n  }\n\n  private monitorLayerDeletion() {\n    this.mapState.map.layers$.subscribe((layers) => {\n      this.searchLayerStores.forEach((store) => {\n        let layer = layers.find((l) => l.id === store.layer.id);\n        if (!layer) {\n          const index = this.searchLayerStores.indexOf(store);\n          this.searchLayerStores.splice(index, 1);\n        }\n      });\n    });\n  }\n\n  private createCustomFilterTermStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<SearchResult>) => {\n      return record.entity.meta.score === 100;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({\n      filterClauseFunc\n    } as EntityStoreStrategyFuncOptions);\n  }\n\n  /**\n   * Activate custom strategy\n   *\n   */\n  activateCustomFilterTermStrategy() {\n    const strategy = this.store.getStrategyOfType(\n      EntityStoreFilterCustomFuncStrategy\n    );\n    if (strategy !== undefined) {\n      strategy.activate();\n    }\n  }\n\n  /**\n   * Deactivate custom strategy\n   *\n   */\n  deactivateCustomFilterTermStrategy() {\n    const strategy = this.store.getStrategyOfType(\n      EntityStoreFilterCustomFuncStrategy\n    );\n    if (strategy !== undefined) {\n      strategy.deactivate();\n    }\n  }\n\n  enableSearch() {\n    this.searchDisabled$.next(false);\n  }\n\n  disableSearch() {\n    this.searchDisabled$.next(true);\n  }\n\n  setSearchTerm(searchTerm: string) {\n    this.searchTerm$.next(searchTerm);\n  }\n\n  setSearchType(searchType: string) {\n    this.searchSourceService.enableSourcesByType(searchType);\n    this.searchType$.next(searchType);\n  }\n\n  setSearchSettingsChange() {\n    this.searchSettingsChange$.next(true);\n  }\n\n  setSelectedResult(result: SearchResult) {\n    this.selectedResult$.next(result);\n  }\n\n  setSearchResultsGeometryStatus(value) {\n    this.storageService.set('searchResultsGeometryEnabled', value);\n    this.searchResultsGeometryEnabled$.next(value);\n  }\n}\n","import { Component, Input } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\n\nimport { ToolState } from '../../tool/tool.state';\nimport { MapState } from '../../map/map.state';\nimport { IgoMap } from '@igo2/geo';\n\n@ToolComponent({\n  name: 'contextManager',\n  title: 'igo.integration.tools.contexts',\n  icon: 'star'\n})\n@Component({\n  selector: 'igo-context-manager-tool',\n  templateUrl: './context-manager-tool.component.html'\n})\nexport class ContextManagerToolComponent {\n  @Input() toolToOpenOnContextChange: string = 'mapTools';\n\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    private toolState: ToolState,\n    private mapState: MapState\n  ) {}\n\n  editContext() {\n    this.toolState.toolbox.activateTool('contextEditor');\n  }\n\n  managePermissions() {\n    this.toolState.toolbox.activateTool('contextPermissionManager');\n  }\n}\n","<igo-context-list\n  igoContextListBinding\n  [map]=\"map\"\n  (edit)=\"editContext()\"\n  (managePermissions)=\"managePermissions()\"\n>\n</igo-context-list>\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\nimport { ToolState } from '../../tool/tool.state';\n\n@ToolComponent({\n  name: 'contextEditor',\n  title: 'igo.integration.tools.contexts',\n  icon: 'star',\n  parent: 'contextManager'\n})\n@Component({\n  selector: 'igo-context-editor-tool',\n  templateUrl: './context-editor-tool.component.html'\n})\nexport class ContextEditorToolComponent {\n  constructor(private toolState: ToolState) {}\n\n  submitSuccessed() {\n    this.toolState.toolbox.activatePreviousTool();\n  }\n}\n","<igo-context-edit\n  igoContextEditBinding\n  (submitSuccessed)=\"submitSuccessed()\"\n></igo-context-edit>\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\n\n@ToolComponent({\n  name: 'contextPermissionManager',\n  title: 'igo.integration.tools.contexts',\n  icon: 'star',\n  parent: 'contextManager'\n})\n@Component({\n  selector: 'igo-context-permission-manager-tool',\n  templateUrl: './context-permission-manager-tool.component.html'\n})\nexport class ContextPermissionManagerToolComponent {}\n","<igo-context-permissions igoContextPermissionsBinding></igo-context-permissions>\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\nimport { IgoMap, LayerListControlsOptions } from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\nimport { LayerListToolState } from '../../map/layer-list-tool.state';\n\n@ToolComponent({\n  name: 'shareMap',\n  title: 'igo.integration.tools.shareMap',\n  icon: 'share-variant'\n})\n@Component({\n  selector: 'igo-context-share-tool',\n  templateUrl: './context-share-tool.component.html'\n})\nexport class ContextShareToolComponent {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get layerListControls(): LayerListControlsOptions {\n    return this.layerListToolState.getLayerListControls();\n  }\n\n  constructor(\n    private mapState: MapState,\n    private layerListToolState: LayerListToolState\n  ) {}\n}\n","<igo-share-map [map]=\"map\"></igo-share-map>\n","import { Injectable } from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { EntityStore } from '@igo2/common';\nimport { Catalog, CatalogItem } from '@igo2/geo';\n\n/**\n * Service that holds the state of the catalog module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class CatalogState {\n  /**\n   * Store that contains all the catalogs\n   */\n  get catalogStore(): EntityStore<Catalog> {\n    return this._catalogStore;\n  }\n  private _catalogStore: EntityStore<Catalog>;\n\n  /**\n   * Catalog -> Catalog items store mapping\n   */\n  private catalogItemsStores = new Map<string, EntityStore<CatalogItem>>();\n\n  constructor(authService: AuthService) {\n    this._catalogStore = new EntityStore([]);\n\n    authService.authenticate$.subscribe(() => {\n      this.clearCatalogItemsStores();\n    });\n  }\n\n  /**\n   * Get a catalog's items store\n   * @param catalog Catalog\n   * @returns Store that contains the catalog items\n   */\n  getCatalogItemsStore(catalog: Catalog): EntityStore<CatalogItem> {\n    return this.catalogItemsStores.get(catalog.id as string);\n  }\n\n  /**\n   * Bind a catalog items store to a catalog\n   * @param catalog Catalog\n   * @param store Catalog items store\n   */\n  setCatalogItemsStore(catalog: Catalog, store: EntityStore<CatalogItem>) {\n    this.catalogItemsStores.set(catalog.id as string, store);\n  }\n\n  /**\n   * Clear all catalog items stores\n   */\n  clearCatalogItemsStores() {\n    this.catalogItemsStores.clear();\n  }\n}\n","<igo-catalog-browser\n  *ngIf=\"store$ | async as store\"\n  [catalog]=\"catalog\"\n  [store]=\"store\"\n  [map]=\"map\"\n  [toggleCollapsedGroup]=\"toggleCollapsedGroup\"\n>\n</igo-catalog-browser>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { EntityRecord, EntityStore, ToolComponent } from '@igo2/common';\nimport { AuthService } from '@igo2/auth';\n\nimport {\n  IgoMap,\n  Catalog,\n  CatalogItem,\n  CatalogItemState,\n  CatalogService\n} from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\nimport { CatalogState } from '../catalog.state';\n\n/**\n * Tool to browse a catalog's groups and layers and display them to a map.\n */\n@ToolComponent({\n  name: 'catalogBrowser',\n  title: 'igo.integration.tools.catalog',\n  icon: 'photo-browser',\n  parent: 'catalog'\n})\n@Component({\n  selector: 'igo-catalog-browser-tool',\n  templateUrl: './catalog-browser-tool.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserToolComponent implements OnInit, OnDestroy {\n  catalog: Catalog;\n\n  /**\n   * Store that contains the catalog items\n   * @internal\n   */\n  store$ = new BehaviorSubject<EntityStore<CatalogItem, CatalogItemState>>(\n    undefined\n  );\n\n  /**\n   * Subscription to the selected catalog\n   */\n  private catalog$$: Subscription;\n\n  /**\n   * Subscription for authentication\n   */\n  private authenticate$$: Subscription;\n\n  /**\n   * Whether a group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsedGroup: boolean = true;\n\n  /**\n   * Map to add layers to\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    private catalogService: CatalogService,\n    private catalogState: CatalogState,\n    private mapState: MapState,\n    private authService: AuthService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    const catalogStore = this.catalogState.catalogStore;\n    this.catalog$$ = catalogStore.stateView\n      .firstBy$(\n        (record: EntityRecord<Catalog>) => record.state.selected === true\n      )\n      .subscribe((record: EntityRecord<Catalog>) => {\n        if (record && record.entity) {\n          const catalog = record.entity;\n          this.catalog = catalog;\n        }\n      });\n\n    this.authenticate$$ = this.authService.authenticate$.subscribe(() => {\n      this.loadCatalogItems(this.catalog);\n    });\n  }\n\n  /**\n   * @internal\n   */\n  ngOnDestroy() {\n    this.catalog$$.unsubscribe();\n    this.authenticate$$.unsubscribe();\n  }\n\n  /**\n   * Get the selected catalog's items from the CatalogService and\n   * load them into the store.\n   * @param catalog Selected catalog\n   */\n  private loadCatalogItems(catalog: Catalog) {\n    let store = this.catalogState.getCatalogItemsStore(catalog);\n    if (store !== undefined) {\n      this.store$.next(store);\n      return;\n    }\n\n    store = new EntityStore<CatalogItem>([]);\n    this.catalogState.setCatalogItemsStore(catalog, store);\n    this.catalogService\n      .loadCatalogItems(catalog)\n      .pipe(take(1))\n      .subscribe((items: CatalogItem[]) => {\n        store.load(items);\n        this.store$.next(store);\n      });\n  }\n}\n","import {\n  Component,\n  OnInit,\n  ChangeDetectionStrategy,\n  Input\n} from '@angular/core';\nimport { take } from 'rxjs/operators';\n\nimport { ToolComponent } from '@igo2/common';\n\nimport { EntityStore } from '@igo2/common';\nimport { Catalog, CatalogService } from '@igo2/geo';\nimport { StorageService } from '@igo2/core';\n\nimport { ToolState } from '../../tool/tool.state';\nimport { CatalogState } from '../catalog.state';\n\n/**\n * Tool to browse the list of available catalogs.\n */\n@ToolComponent({\n  name: 'catalog',\n  title: 'igo.integration.tools.catalog',\n  icon: 'layers-plus'\n})\n@Component({\n  selector: 'igo-catalog-library-tool',\n  templateUrl: './catalog-library-tool.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogLibraryToolComponent implements OnInit {\n  /**\n   * Store that contains the catalogs\n   * @internal\n   */\n  get store(): EntityStore<Catalog> {\n    return this.catalogState.catalogStore;\n  }\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() addCatalogAllowed: boolean = false;\n\n  /**\n   * List of predefined catalogs\n   */\n  @Input() predefinedCatalogs: Catalog[] = [];\n\n  constructor(\n    private catalogService: CatalogService,\n    private catalogState: CatalogState,\n    private toolState: ToolState,\n    private storageService: StorageService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    if (this.store.count === 0) {\n      this.loadCatalogs();\n    }\n  }\n\n  /**\n   * When the selected catalog changes, toggle the the CatalogBrowser tool.\n   * @internal\n   * @param event Select event\n   */\n  onCatalogSelectChange(event: { selected: boolean; catalog: Catalog }) {\n    if (event.selected === false) {\n      return;\n    }\n    this.toolState.toolbox.activateTool('catalogBrowser');\n  }\n\n  /**\n   * Get all the available catalogs from the CatalogService and\n   * load them into the store.\n   */\n  private loadCatalogs() {\n    this.catalogService\n      .loadCatalogs()\n      .pipe(take(1))\n      .subscribe((catalogs: Catalog[]) => {\n        this.store.clear();\n        this.store.load(\n          catalogs.concat(\n            (this.storageService.get('addedCatalogs') || []) as Catalog[]\n          )\n        );\n      });\n  }\n}\n","<igo-catalog-library\n  [predefinedCatalogs]=\"predefinedCatalogs\"\n  [addCatalogAllowed]=\"addCatalogAllowed\"\n  [store]=\"store\"\n  (catalogSelectChange)=\"onCatalogSelectChange($event)\"\n>\n</igo-catalog-library>\n","import { Injectable } from '@angular/core';\n\nimport {\n  AnyLayerOptions,\n  StopsStore,\n  StopsFeatureStore,\n  RoutesFeatureStore,\n  StepFeatureStore\n} from '@igo2/geo';\nimport { Subject } from 'rxjs';\nimport { MapState } from '../map/map.state';\n\n/**\n * Service that holds the state of the direction module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DirectionState {\n  public zoomToActiveRoute$: Subject<void> = new Subject();\n\n  /**\n   * Store that holds the stop\n   */\n  public stopsStore: StopsStore = new StopsStore([]);\n\n  /**\n   * Store that holds the driving stops as feature\n   */\n  public stopsFeatureStore: StopsFeatureStore;\n\n  /**\n   * Store that holds the driving route as feature\n   */\n  public routesFeatureStore: RoutesFeatureStore;\n\n  public stepFeatureStore: StepFeatureStore;\n\n  public debounceTime: number = 200;\n\n  constructor(private mapState: MapState) {\n    this.stopsFeatureStore = new StopsFeatureStore([], {\n      map: this.mapState.map\n    });\n\n    this.routesFeatureStore = new RoutesFeatureStore([], {\n      map: this.mapState.map\n    });\n\n    this.stepFeatureStore = new StepFeatureStore([], {\n      map: this.mapState.map\n    });\n\n    this.mapState.map.ol.once('rendercomplete', () => {\n      this.stopsFeatureStore.empty$.subscribe((empty) => {\n        if (this.stopsFeatureStore.layer?.options) {\n          (\n            this.stopsFeatureStore.layer.options as AnyLayerOptions\n          ).showInLayerList = !empty;\n        }\n      });\n      this.routesFeatureStore.empty$.subscribe((empty) => {\n        if (this.routesFeatureStore.layer?.options) {\n          (\n            this.routesFeatureStore.layer.options as AnyLayerOptions\n          ).showInLayerList = !empty;\n        }\n      });\n    });\n\n    this.mapState.map.layers$.subscribe(() => {\n      if (!this.mapState.map.getLayerById('igo-direction-stops-layer')) {\n        this.stopsStore.deleteMany(this.stopsStore.all());\n        this.stopsFeatureStore.deleteMany(this.stopsFeatureStore.all()); // not necessary\n      }\n      if (!this.mapState.map.getLayerById('igo-direction-route-layer')) {\n        this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n      }\n    });\n  }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { AuthService } from '@igo2/auth';\n\nimport { ToolComponent } from '@igo2/common';\nimport {\n  LanguageService,\n  MessageService,\n  StorageScope,\n  StorageService\n} from '@igo2/core';\nimport {\n  IgoMap,\n  RoutesFeatureStore,\n  StopsFeatureStore,\n  StopsStore,\n  StepFeatureStore\n} from '@igo2/geo';\nimport { Subject } from 'rxjs';\nimport { ContextState } from '../../context/context.state';\n\nimport { MapState } from '../../map/map.state';\nimport { DirectionState } from '../directions.state';\n\n@ToolComponent({\n  name: 'directions',\n  title: 'igo.integration.tools.directions',\n  icon: 'directions'\n})\n@Component({\n  selector: 'igo-directions-tool',\n  templateUrl: './directions-tool.component.html'\n})\nexport class DirectionsToolComponent implements OnInit {\n  public currentContextUri: string;\n  /**\n   * stops\n   * @internal\n   */\n  get stopsStore(): StopsStore {\n    return this.directionState.stopsStore;\n  }\n\n  get debounceTime(): number {\n    return this.directionState.debounceTime;\n  }\n\n  /**\n   * stops\n   * @internal\n   */\n  get stopsFeatureStore(): StopsFeatureStore {\n    return this.directionState.stopsFeatureStore;\n  }\n\n  /**\n   * routes\n   * @internal\n   */\n  get routesFeatureStore(): RoutesFeatureStore {\n    return this.directionState.routesFeatureStore;\n  }\n\n  /**\n   * step store\n   * @internal\n   */\n  get stepFeatureStore(): StepFeatureStore {\n    return this.directionState.stepFeatureStore;\n  }\n\n  /**\n   * step store\n   * @internal\n   */\n  get zoomToActiveRoute$(): Subject<void> {\n    return this.directionState.zoomToActiveRoute$;\n  }\n\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    private directionState: DirectionState,\n    private mapState: MapState,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private storageService: StorageService,\n    public contextState: ContextState,\n    private authService: AuthService\n  ) {}\n\n  ngOnInit(): void {\n    const warningShown = this.storageService.get(\n      'direction.warning.shown'\n    ) as boolean;\n    if (!warningShown) {\n      this.messageService.info(\n        'igo.integration.directions.warning.message',\n        'igo.integration.directions.warning.title',\n        { timeOut: 20000 }\n      );\n      this.storageService.set(\n        'direction.warning.shown',\n        true,\n        StorageScope.SESSION\n      );\n    }\n    this.contextState.context$.subscribe((c) => {\n      if (!this.authService.authenticated) {\n        this.currentContextUri = c.uri;\n      }\n    });\n  }\n}\n","<igo-directions\n  [contextUri]=\"currentContextUri\"\n  [debounceTime]=\"debounceTime\"\n  [stopsStore]=\"stopsStore\"\n  [stopsFeatureStore]=\"stopsFeatureStore\"\n  [stepFeatureStore]=\"stepFeatureStore\"\n  [routesFeatureStore]=\"routesFeatureStore\"\n  [zoomToActiveRoute$]=\"zoomToActiveRoute$\"\n>\n</igo-directions>\n","import { Injectable } from '@angular/core';\n\nimport {\n  DrawControl,\n  FeatureStore,\n  FeatureWithDraw,\n  VectorLayer\n} from '@igo2/geo';\nimport { MapState } from '../map/map.state';\n\n/**\n * Service that holds the state of the measure module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DrawState {\n  public stores: FeatureStore<FeatureWithDraw>[] = [];\n  public layersID: string[] = [];\n  public drawControls: [string, DrawControl][] = [];\n  public activeDrawingLayer: VectorLayer;\n\n  constructor(private mapState: MapState) {\n    this.mapState.map.layers$.subscribe(() => {\n      this.layersID.forEach((layerId) => {\n        if (!this.mapState.map.getLayerById(layerId)) {\n          let deletedStore = this.stores.find(\n            (store) => store.layer.id === layerId\n          );\n          deletedStore.deleteMany(deletedStore.all());\n          this.stores.splice(this.stores.indexOf(deletedStore, 0), 1);\n          this.layersID.splice(this.layersID.indexOf(layerId, 0), 1);\n          let drawControlIndex = this.drawControls.findIndex(\n            (dc) => dc[0] === layerId\n          );\n          this.drawControls.splice(drawControlIndex, 1);\n        }\n      });\n    });\n    for (let store of this.stores) {\n      store = new FeatureStore<FeatureWithDraw>([], { map: this.mapState.map });\n    }\n  }\n}\n","import { Component, ChangeDetectionStrategy } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\nimport {\n  FeatureStore,\n  IgoMap,\n  DrawControl,\n  FeatureWithDraw,\n  VectorLayer\n} from '@igo2/geo';\nimport { MapState } from '../../map/map.state';\nimport { DrawState } from '../draw.state';\n\n/**\n * Tool to measure lengths and areas\n */\n@ToolComponent({\n  name: 'draw',\n  title: 'igo.integration.tools.draw',\n  icon: 'draw'\n})\n@Component({\n  selector: 'igo-drawing-tool',\n  templateUrl: './drawing-tool.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DrawingToolComponent {\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get stores(): FeatureStore<FeatureWithDraw>[] {\n    return this.drawState.stores;\n  }\n\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get layersID(): string[] {\n    return this.drawState.layersID;\n  }\n\n  get drawControls(): [string, DrawControl][] {\n    return this.drawState.drawControls;\n  }\n  set drawControls(dc: [string, DrawControl][]) {\n    this.drawState.drawControls = dc;\n  }\n\n  get activeDrawingLayer(): VectorLayer {\n    return this.drawState.activeDrawingLayer;\n  }\n  set activeDrawingLayer(value: VectorLayer) {\n    this.drawState.activeDrawingLayer = value;\n  }\n\n  public addLayersID(layerID: string) {\n    this.layersID.push(layerID);\n  }\n\n  public addDrawControls(dc: [string, DrawControl][]) {\n    this.drawControls = dc;\n  }\n\n  constructor(\n    private drawState: DrawState,\n    private mapState: MapState\n  ) {}\n}\n","<igo-draw\n  [stores]=\"stores\"\n  [map]=\"map\"\n  (layersIDEvent)=\"addLayersID($event)\"\n  [activeDrawingLayer]=\"activeDrawingLayer\"\n  [drawControls]=\"drawControls\"\n  (drawControlsEvent)=\"addDrawControls($event)\"\n  (activeLayerChange)=\"activeDrawingLayer = $event\"\n>\n</igo-draw>\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\n\n@ToolComponent({\n  name: 'ogcFilter',\n  title: 'igo.integration.tools.ogcFilter',\n  icon: 'filter'\n})\n@Component({\n  selector: 'igo-ogc-filter-tool',\n  templateUrl: './ogc-filter-tool.component.html'\n})\nexport class OgcFilterToolComponent {\n  constructor() {}\n}\n","<igo-ogc-filterable-list igoOgcFilterableListBinding></igo-ogc-filterable-list>\n","import {\n  trigger,\n  state,\n  style,\n  transition,\n  animate,\n  AnimationTriggerMetadata\n} from '@angular/animations';\n\nexport function toolSlideInOut(\n  speed = '300ms',\n  type = 'ease-in-out'\n): AnimationTriggerMetadata {\n  return trigger('toolSlideInOut', [\n    state(\n      'enter',\n      style({\n        transform: 'translateX(100%)'\n      })\n    ),\n    transition('void => enter', animate(speed + ' ' + type))\n  ]);\n}\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\nimport { MapState } from '../../map/map.state';\nimport { Layer, IgoMap } from '@igo2/geo';\n\nimport { toolSlideInOut } from './active-ogc-filter-tool.animation';\n\n@ToolComponent({\n  name: 'activeOgcFilter',\n  title: 'igo.integration.tools.ogcFilter',\n  icon: 'filter',\n  parent: 'mapTools'\n})\n@Component({\n  selector: 'igo-active-ogc-filter-tool',\n  templateUrl: './active-ogc-filter-tool.component.html',\n  animations: [toolSlideInOut()]\n})\nexport class ActiveOgcFilterToolComponent {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get layer(): Layer {\n    for (const lay of this.map.layers) {\n      if (lay.options.active === true) {\n        return lay;\n      }\n    }\n    return;\n  }\n\n  public animate = 'enter';\n\n  constructor(public mapState: MapState) {}\n}\n","<igo-ogc-filterable-item\n  [map]=\"map\"\n  [layer]=\"layer\"\n  [header]=\"false\"\n  [@toolSlideInOut]=\"animate\"\n>\n</igo-ogc-filterable-item>\n","<igo-panel>\n  <igo-spatial-filter-type\n    [store]=\"spatialListStore\"\n    [selectedQueryType]=\"queryType\"\n    [zone]=\"zone\"\n    [layers]=\"activeLayers\"\n    (eventType)=\"getOutputType($event)\"\n    (eventQueryType)=\"getOutputQueryType($event)\"\n    (zoneChange)=\"onZoneChange($event)\"\n    (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n    (bufferChange)=\"buffer = $event\"\n    (measureUnitChange)=\"measureUnit = $event\"\n  >\n  </igo-spatial-filter-type>\n\n  <igo-spatial-filter-item\n    [type]=\"type\"\n    [queryType]=\"queryType\"\n    [map]=\"map\"\n    [zone]=\"zone\"\n    [loading]=\"loading\"\n    [store]=\"store\"\n    [layers]=\"activeLayers\"\n    [allLayers]=\"layers\"\n    [thematicLength]=\"thematicLength\"\n    (radiusEvent)=\"buffer = $event\"\n    (bufferEvent)=\"buffer = $event\"\n    (measureUnitChange)=\"measureUnit = $event\"\n    (freehandControl)=\"freehandDrawIsActive = $event\"\n    (drawZoneEvent)=\"zone = $event\"\n    (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n    (itemTypeChange)=\"itemType = $event\"\n    (thematicChange)=\"thematics = $event\"\n    (toggleSearch)=\"getOutputToggleSearch()\"\n    (clearButtonEvent)=\"clearMap()\"\n    (clearSearchEvent)=\"getOutputClearSearch()\"\n    (export)=\"activateExportTool()\"\n    (openWorkspace)=\"activateWorkspace()\"\n    (entityChange)=\"activateWorkspace($event)\"\n  >\n  </igo-spatial-filter-item>\n</igo-panel>\n\n<igo-panel>\n  <ng-container *ngIf=\"selectedFeature$ | async as feature\">\n    <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n  </ng-container>\n</igo-panel>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatIconRegistry } from '@angular/material/icon';\nimport { Observable, forkJoin, Subject } from 'rxjs';\nimport { tap, take, takeUntil } from 'rxjs/operators';\n\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  Feature,\n  moveToOlFeatures,\n  FeatureMotion,\n  ClusterDataSource,\n  featureToOl,\n  DataSource,\n  QueryableDataSourceOptions,\n  SpatialFilterService,\n  SpatialFilterType,\n  SpatialFilterItemType,\n  SpatialFilterQueryType,\n  SpatialFilterThematic,\n  Layer,\n  VectorLayer,\n  createOverlayMarkerStyle,\n  ExportOptions,\n  MeasureLengthUnit\n} from '@igo2/geo';\nimport {\n  EntityStore,\n  EntityStoreWithStrategy,\n  ToolComponent\n} from '@igo2/common';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\nimport olSourceVector from 'ol/source/Vector';\nimport olSourceCluster from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { BehaviorSubject } from 'rxjs';\nimport { MapState } from '../../map/map.state';\nimport {\n  ImportExportMode,\n  ImportExportState\n} from './../../import-export/import-export.state';\nimport * as olstyle from 'ol/style';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { ToolState } from '../../tool/tool.state';\nimport { WorkspaceState } from '../../workspace/workspace.state';\nimport { EventsKey } from 'ol/events';\n\n/**\n * Tool to apply spatial filter\n */\n@ToolComponent({\n  name: 'spatialFilter',\n  title: 'igo.integration.tools.spatialFilter',\n  icon: 'selection-marker'\n})\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'igo-spatial-filter-tool',\n  templateUrl: './spatial-filter-tool.component.html',\n  styleUrls: ['./spatial-filter-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterToolComponent implements OnInit, OnDestroy {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  @Input() type: SpatialFilterType;\n  @Input() itemType: SpatialFilterItemType = SpatialFilterItemType.Address;\n  @Input() freehandDrawIsActive: boolean;\n\n  public layers: Layer[] = [];\n  public activeLayers: Layer[] = [];\n\n  public queryType: SpatialFilterQueryType;\n  public thematics: SpatialFilterThematic[];\n  public zone: Feature;\n  public zoneWithBuffer: Feature;\n  public buffer = 0;\n\n  public iterator = 1;\n\n  public selectedFeature$: BehaviorSubject<Feature> = new BehaviorSubject(\n    undefined\n  );\n\n  private format = new olFormatGeoJSON();\n\n  public store: EntityStoreWithStrategy<Feature> =\n    new EntityStoreWithStrategy<Feature>([]); // Store to print results at the end\n\n  public spatialListStore: EntityStore<Feature> = new EntityStore<Feature>([]);\n\n  public loading = false;\n\n  public thematicLength = 0;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  private unsubscribe$ = new Subject<void>();\n\n  private moveendKey: EventsKey;\n\n  public defaultStyle: olstyle.Style | ((feature, resolution) => olstyle.Style);\n\n  constructor(\n    private matIconRegistry: MatIconRegistry,\n    private spatialFilterService: SpatialFilterService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mapState: MapState,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private importExportState: ImportExportState,\n    private toolState: ToolState,\n    private workspaceState: WorkspaceState,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit() {\n    for (const layer of this.map.layers) {\n      if (\n        layer.title &&\n        layer.title.includes(\n          this.languageService.translate.instant(\n            'igo.geo.spatialFilter.spatialFilter'\n          )\n        )\n      ) {\n        this.layers.push(layer);\n      }\n    }\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  getOutputType(event: SpatialFilterType) {\n    this.type = event;\n    this.queryType = undefined;\n  }\n\n  getOutputQueryType(event: SpatialFilterQueryType) {\n    this.queryType = event;\n    if (this.queryType) {\n      this.loadFilterList();\n    }\n  }\n\n  activateExportTool() {\n    const ids = [];\n    const re = new RegExp('^Zone \\\\d+');\n    for (const layer of this.layers) {\n      if (!layer.title.match(re)) {\n        ids.push(layer.id);\n      }\n    }\n    this.importExportState.setMode(ImportExportMode.export);\n    this.importExportState.setsExportOptions({ layers: ids } as ExportOptions);\n    this.toolState.toolbox.activateTool('importExport');\n  }\n\n  activateWorkspace(record?) {\n    let layerToOpenWks;\n    this.workspaceState.store.entities$\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(() => {\n        if (\n          !record &&\n          this.activeLayers.length &&\n          this.workspaceState.store.all().length > 1\n        ) {\n          if (this.itemType === SpatialFilterItemType.Thematics) {\n            for (const thematic of this.thematics) {\n              if (!thematic.zeroResults) {\n                layerToOpenWks = this.activeLayers.find((layer) =>\n                  layer.title.includes(\n                    thematic.name + ' ' + this.iterator.toString()\n                  )\n                );\n                break;\n              }\n            }\n          } else {\n            const title = 'Adresses ' + this.iterator.toString();\n            this.activeLayers.forEach((layer) => {\n              if (layer.title.includes(title)) {\n                layerToOpenWks = layer;\n              }\n            });\n          }\n\n          if (layerToOpenWks) {\n            this.workspaceState.workspacePanelExpanded = true;\n            this.workspaceState.setActiveWorkspaceById(layerToOpenWks.id);\n          }\n        } else if (\n          record &&\n          this.activeLayers.length &&\n          this.workspaceState.store.all().length > 1\n        ) {\n          this.selectWorkspaceEntity(record);\n          this.moveendKey = this.map.ol.on('moveend', () => {\n            this.selectWorkspaceEntity(record);\n          });\n        }\n      });\n  }\n\n  private selectWorkspaceEntity(record) {\n    this.workspaceState.store.all().forEach((workspace) => {\n      workspace.entityStore.state.updateAll({ selected: false });\n      if (workspace.title.includes(record.added[0].meta.title)) {\n        this.workspaceState.setActiveWorkspaceById(workspace.id);\n        workspace.entityStore.state.updateMany(record.added, {\n          selected: true\n        });\n      }\n    });\n  }\n\n  private loadFilterList() {\n    this.spatialFilterService\n      .loadFilterList(this.queryType)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((features: Feature[]) => {\n        features.sort((a, b) => {\n          if (a.properties.nom < b.properties.nom) {\n            return -1;\n          }\n          if (a.properties.nom > b.properties.nom) {\n            return 1;\n          }\n          return 0;\n        });\n        this.spatialListStore.clear();\n        this.spatialListStore.load(features);\n      });\n  }\n\n  getOutputToggleSearch() {\n    this.loadThematics();\n  }\n\n  getOutputClearSearch() {\n    this.zone = undefined;\n    this.queryType = undefined;\n  }\n\n  clearMap() {\n    this.map.removeLayers(this.layers);\n    this.layers = [];\n    this.activeLayers = [];\n    this.thematicLength = 0;\n    this.iterator = 1;\n    if (this.type === SpatialFilterType.Predefined) {\n      this.zone = undefined;\n      this.queryType = undefined;\n    }\n  }\n\n  private loadThematics() {\n    this.loading = true;\n    let zeroResults = true;\n    let thematics;\n    if (this.buffer === 0 || this.type === SpatialFilterType.Point) {\n      this.tryAddFeaturesToMap([this.zone]);\n    }\n    if (this.itemType !== SpatialFilterItemType.Thematics) {\n      const theme: SpatialFilterThematic = {\n        name: ''\n      };\n      thematics = [theme];\n    } else {\n      thematics = this.thematics;\n    }\n    if (\n      this.measureUnit === MeasureLengthUnit.Kilometers &&\n      this.type !== SpatialFilterType.Point\n    ) {\n      this.buffer = this.buffer * 1000;\n    }\n    if (this.type === SpatialFilterType.Polygon) {\n      this.buffer = 0; // to avoid buffer enter a second time in terrAPI\n    }\n\n    const observables$: Observable<Feature[]>[] = [];\n    thematics.forEach((thematic) => {\n      observables$.push(\n        this.spatialFilterService\n          .loadFilterItem(\n            this.zone,\n            this.itemType,\n            this.queryType,\n            thematic,\n            this.buffer\n          )\n          .pipe(\n            tap((features: Feature[]) => {\n              this.store.insertMany(features);\n              const featuresPoint: Feature[] = [];\n              const featuresLinePoly: Feature[] = [];\n              let idPoint;\n              let idLinePoly;\n              features.forEach((feature) => {\n                if (feature.geometry.type === 'Point') {\n                  feature.properties.longitude =\n                    feature.geometry.coordinates[0];\n                  feature.properties.latitude = feature.geometry.coordinates[1];\n                  featuresPoint.push(feature);\n                  idPoint = feature.meta.id;\n                } else {\n                  featuresLinePoly.push(feature);\n                  idLinePoly = feature.meta.id;\n                }\n              });\n\n              this.tryAddPointToMap(featuresPoint, idPoint);\n              this.tryAddLayerToMap(featuresLinePoly, idLinePoly);\n              if (features.length) {\n                zeroResults = false;\n                this.thematicLength += 1;\n                thematic.zeroResults = false;\n                this.cdRef.detectChanges();\n              } else {\n                thematic.zeroResults = true;\n              }\n\n              if (features.length >= 10000) {\n                this.messageService.alert(\n                  'igo.geo.spatialFilter.maxSizeAlert',\n                  'igo.geo.spatialFilter.warning',\n                  { timeOut: 10000 }\n                );\n              }\n            })\n          )\n      );\n    });\n\n    forkJoin(observables$)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(() => {\n        this.loading = false;\n        if (zeroResults) {\n          this.messageService.alert(\n            'igo.geo.spatialFilter.zeroResults',\n            'igo.geo.spatialFilter.warning',\n            { timeOut: 10000 }\n          );\n        }\n      });\n  }\n\n  onZoneChange(feature: Feature, buffer?: boolean) {\n    this.zone = feature;\n    if (feature) {\n      buffer\n        ? this.tryAddFeaturesToMap([feature], true)\n        : this.tryAddFeaturesToMap([feature]);\n      this.zoomToFeatureExtent(feature);\n    }\n  }\n\n  /**\n   * Try to add zone feature to the map overlay\n   */\n  public tryAddFeaturesToMap(features: Feature[], buffer?: boolean) {\n    let i = 1;\n    for (const feature of features) {\n      if (this.type === SpatialFilterType.Predefined) {\n        for (const layer of this.layers) {\n          if (\n            layer.options._internal &&\n            layer.options._internal.code === feature.properties.code &&\n            !buffer\n          ) {\n            if (!layer.title?.startsWith('Zone')) {\n              const index = this.layers.indexOf(layer);\n              this.layers.splice(index, 1);\n            }\n            return;\n          }\n          if (layer.title?.startsWith('Zone')) {\n            this.activeLayers = [];\n            const index = this.layers.indexOf(layer);\n            this.layers.splice(index, 1);\n            this.map.removeLayer(layer);\n          }\n        }\n      } else {\n        if (buffer) {\n          for (const layer of this.activeLayers) {\n            if (\n              this.activeLayers.length === 1 &&\n              layer.title?.startsWith('Zone')\n            ) {\n              const index = this.layers.indexOf(layer);\n              this.layers.splice(index, 1);\n              this.map.removeLayer(layer);\n            }\n          }\n        }\n        this.activeLayers = [];\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith('Zone')) {\n          i++;\n        }\n      }\n      this.defaultStyle = (_feature, resolution) => {\n        const coordinates = (features[0] as any).coordinates;\n        return new olstyle.Style({\n          image: new olstyle.Circle({\n            radius: coordinates\n              ? this.buffer /\n                Math.cos((Math.PI / 180) * coordinates[1]) /\n                resolution\n              : undefined,\n            fill: new olstyle.Fill({\n              color: 'rgba(200, 200, 20, 0.2)'\n            }),\n            stroke: new olstyle.Stroke({\n              width: 1,\n              color: 'orange'\n            })\n          }),\n          stroke: new olstyle.Stroke({\n            width: 1,\n            color: 'orange'\n          }),\n          fill: new olstyle.Fill({\n            color: 'rgba(200, 200, 20, 0.2)'\n          })\n        });\n      };\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: DataSource) => {\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: ('Zone ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string,\n            workspace: { enabled: true },\n            _internal: {\n              code:\n                this.type === SpatialFilterType.Predefined\n                  ? feature.properties.code\n                  : undefined\n            },\n            source: dataSource,\n            visible: true\n          }) as VectorLayer;\n          const featuresOl = features.map((f) => {\n            return featureToOl(f, this.map.projection);\n          });\n          if (this.type !== SpatialFilterType.Predefined) {\n            const type =\n              this.type === SpatialFilterType.Point ? 'Cercle' : 'Polygone';\n            featuresOl[0].set('nom', 'Zone', true);\n            featuresOl[0].set('type', type, true);\n          }\n          const ol = dataSource.ol as\n            | olSourceVector<OlGeometry>\n            | olSourceCluster;\n          ol.addFeatures(featuresOl);\n          olLayer.ol.setStyle(this.defaultStyle);\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.activeLayers.push(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  /**\n   * Try to add point features to the map\n   * Necessary to create clusters\n   */\n  private tryAddPointToMap(features: Feature[], id) {\n    let i = 1;\n    if (features.length) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'cluster',\n          id,\n          queryable: true,\n          distance: 120,\n          meta: {\n            title: 'Cluster'\n          }\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: ClusterDataSource) => {\n          const icon = features[0].meta.icon;\n          let style: olstyle.Style;\n          if (!icon) {\n            style = createOverlayMarkerStyle();\n          } else {\n            style = this.createSvgIcon(icon) || createOverlayMarkerStyle();\n          }\n\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string,\n            source: dataSource,\n            visible: true,\n            style\n          });\n\n          const featuresOl = features.map((feature) => {\n            return featureToOl(feature, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceCluster;\n          ol.getSource().addFeatures(featuresOl);\n          if (this.layers.find((layer) => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.layers.find((layer) => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.iterator = i;\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.pushLayer(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  private createSvgIcon(icon): olstyle.Style {\n    let style: olstyle.Style;\n    this.matIconRegistry.getNamedSvgIcon(icon).subscribe((svgObj) => {\n      const xmlSerializer = new XMLSerializer();\n      svgObj.setAttribute('width', '30');\n      svgObj.setAttribute('height', '30');\n      svgObj.setAttribute('fill', 'rgba(0, 128, 255)');\n      svgObj.setAttribute('stroke', 'white');\n      const svg = xmlSerializer.serializeToString(svgObj);\n      style = new olstyle.Style({\n        image: new olstyle.Icon({\n          src: 'data:image/svg+xml;utf8,' + svg\n        })\n      });\n    });\n    return style;\n  }\n  /**\n   * Try to add line or polygon features to the map\n   */\n  private tryAddLayerToMap(features: Feature[], id) {\n    let i = 1;\n    if (features.length) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          id,\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: DataSource) => {\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string,\n            source: dataSource,\n            visible: true\n          });\n          const featuresOl = features.map((feature) => {\n            return featureToOl(feature, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceVector<OlGeometry>;\n          ol.addFeatures(featuresOl);\n          if (this.layers.find((layer) => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.layers.find((layer) => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.pushLayer(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  zoomToFeatureExtent(feature) {\n    if (feature) {\n      const olFeature = this.format.readFeature(feature, {\n        dataProjection: feature.projection,\n        featureProjection: this.map.projection\n      });\n      moveToOlFeatures(\n        this.map.viewController,\n        [olFeature],\n        FeatureMotion.Zoom\n      );\n    }\n  }\n\n  pushLayer(layer) {\n    for (const lay of this.activeLayers) {\n      if (lay.id === layer.id) {\n        return;\n      }\n    }\n\n    this.activeLayers.push(layer);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { TimeFilterListComponent } from './time-filter-list.component';\n\n@Directive({\n  selector: '[igoTimeFilterListBinding]'\n})\nexport class TimeFilterListBindingDirective implements OnInit, OnDestroy {\n  private component: TimeFilterListComponent;\n  private layers$$: Subscription;\n\n  constructor(\n    @Self() component: TimeFilterListComponent,\n    private mapService: MapService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    this.component.layers = [];\n\n    this.layers$$ = this.mapService.getMap().layers$.subscribe((layers) => {\n      this.component.layers = layers;\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n}\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\n\n@ToolComponent({\n  name: 'timeFilter',\n  title: 'igo.integration.tools.timeFilter',\n  icon: 'history'\n})\n@Component({\n  selector: 'igo-time-filter-tool',\n  templateUrl: './time-filter-tool.component.html'\n})\nexport class TimeFilterToolComponent {\n  constructor() {}\n}\n","<igo-time-filter-list igoTimeFilterListBinding></igo-time-filter-list>\n","import {\n  trigger,\n  state,\n  style,\n  transition,\n  animate,\n  AnimationTriggerMetadata\n} from '@angular/animations';\n\nexport function toolSlideInOut(\n  speed = '300ms',\n  type = 'ease-in-out'\n): AnimationTriggerMetadata {\n  return trigger('toolSlideInOut', [\n    state(\n      'enter',\n      style({\n        transform: 'translateX(100%)'\n      })\n    ),\n    transition('void => enter', animate(speed + ' ' + type))\n  ]);\n}\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\nimport { MapState } from '../../map/map.state';\nimport { IgoMap, Layer } from '@igo2/geo';\nimport { toolSlideInOut } from './active-time-filter-tool.animation';\n\n@ToolComponent({\n  name: 'activeTimeFilter',\n  title: 'igo.integration.tools.timeFilter',\n  icon: 'history',\n  parent: 'mapTools'\n})\n@Component({\n  selector: 'igo-active-time-filter-tool',\n  templateUrl: './active-time-filter-tool.component.html',\n  animations: [toolSlideInOut()]\n})\nexport class ActiveTimeFilterToolComponent {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get layer(): Layer {\n    for (const lay of this.map.layers) {\n      if (lay.options.active === true) {\n        return lay;\n      }\n    }\n    return;\n  }\n\n  public animate = 'enter';\n\n  constructor(public mapState: MapState) {}\n}\n","<igo-time-filter-item\n  [map]=\"map\"\n  [layer]=\"layer\"\n  [header]=\"false\"\n  [@toolSlideInOut]=\"animate\"\n>\n</igo-time-filter-item>\n","<mat-tab-group *ngIf=\"importExportShowBothType\">\n  <mat-tab\n    [label]=\"'igo.integration.importExportTool.importExportData' | translate\"\n  >\n    <igo-import-export\n      [contextUri]=\"(contextState.context$ | async).uri\"\n      [map]=\"map\"\n      [selectFirstProj]=\"selectFirstProj\"\n      [projectionsLimitations]=\"projectionsLimitations\"\n      [store]=\"workspaceStore\"\n      [selectedMode]=\"importExportState.selectedMode$ | async\"\n      (selectMode)=\"modeChanged($event)\"\n      [exportOptions$]=\"importExportState.exportOptions$\"\n      (exportOptionsChange)=\"exportOptionsChange($event)\"\n    >\n    </igo-import-export>\n  </mat-tab>\n  <mat-tab\n    [label]=\"'igo.integration.importExportTool.importExportContext' | translate\"\n  >\n    <igo-context-import-export [map]=\"map\"></igo-context-import-export>\n  </mat-tab>\n</mat-tab-group>\n\n<igo-import-export\n  *ngIf=\"!importExportShowBothType && importExportType === 'layer'\"\n  [contextUri]=\"(contextState.context$ | async).uri\"\n  [map]=\"map\"\n  [store]=\"workspaceStore\"\n  [selectedMode]=\"importExportState.selectedMode$ | async\"\n  (selectMode)=\"modeChanged($event)\"\n  [exportOptions$]=\"importExportState.exportOptions$\"\n  (exportOptionsChange)=\"exportOptionsChange($event)\"\n>\n</igo-import-export>\n\n<igo-context-import-export\n  *ngIf=\"!importExportShowBothType && importExportType === 'context'\"\n  [map]=\"map\"\n>\n</igo-context-import-export>\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  OnInit,\n  Input\n} from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\nimport type { WorkspaceStore } from '@igo2/common';\nimport {\n  IgoMap,\n  ExportOptions,\n  ProjectionsLimitationsOptions\n} from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\nimport {\n  ImportExportMode,\n  ImportExportState,\n  ImportExportType\n} from '../import-export.state';\nimport { WorkspaceState } from '../../workspace/workspace.state';\nimport { ContextState } from '../../context/context.state';\n\n@ToolComponent({\n  name: 'importExport',\n  title: 'igo.integration.tools.importExport',\n  icon: 'file-move'\n})\n@Component({\n  selector: 'igo-import-export-tool',\n  templateUrl: './import-export-tool.component.html',\n  styleUrls: ['./import-export-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ImportExportToolComponent implements OnInit {\n  @Input() projectionsLimitations: ProjectionsLimitationsOptions;\n\n  @Input() selectFirstProj: boolean = false;\n\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get workspaceStore(): WorkspaceStore {\n    return this.workspaceState.store;\n  }\n\n  @Input() importExportType: ImportExportType = ImportExportType.layer;\n  @Input() importExportShowBothType: boolean = true;\n\n  constructor(\n    private mapState: MapState,\n    public importExportState: ImportExportState,\n    private workspaceState: WorkspaceState,\n    public contextState: ContextState\n  ) {}\n\n  ngOnInit(): void {\n    this.selectType();\n    this.selectMode();\n  }\n\n  private selectType() {\n    if (this.importExportType) {\n      this.importExportState.importExportType$.next(this.importExportType);\n    }\n    const userSelectedType = this.importExportState.importExportType$.value;\n    if (userSelectedType !== undefined) {\n      this.importExportState.setImportExportType(userSelectedType);\n    } else {\n      this.importExportState.setImportExportType(ImportExportType.layer);\n    }\n  }\n\n  private selectMode() {\n    const userSelectedMode = this.importExportState.selectedMode$.value;\n    if (userSelectedMode !== undefined) {\n      this.importExportState.setMode(userSelectedMode);\n    } else {\n      this.importExportState.setMode(ImportExportMode.import);\n    }\n  }\n\n  public modeChanged(mode: ImportExportMode) {\n    this.importExportState.setMode(mode);\n  }\n\n  public exportOptionsChange(exportOptions: ExportOptions) {\n    this.importExportState.setsExportOptions(exportOptions);\n  }\n\n  importExportTypeChange(event) {\n    this.importExportType = event.value;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { FeatureStore, FeatureWithMeasure } from '@igo2/geo';\nimport { MapState } from '../map/map.state';\n\n/**\n * Service that holds the state of the measure module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MeasureState {\n  /**\n   * Store that holds the measures\n   */\n  public store: FeatureStore<FeatureWithMeasure>;\n\n  constructor(private mapState: MapState) {\n    this.store = new FeatureStore<FeatureWithMeasure>([], {\n      map: this.mapState.map\n    });\n\n    this.mapState.map.layers$.subscribe((layers) => {\n      if (\n        layers.filter((l) => l.id?.startsWith('igo-measures-')).length === 0\n      ) {\n        this.store.deleteMany(this.store.all());\n        this.mapState.map.ol\n          .getOverlays()\n          .getArray()\n          .filter((overlay) =>\n            (overlay as any).options.className.includes('igo-map-tooltip')\n          )\n          .map((overlay) => this.mapState.map.ol.removeOverlay(overlay));\n      }\n    });\n  }\n}\n","import { Component, ChangeDetectionStrategy } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\nimport { FeatureStore, FeatureWithMeasure, IgoMap } from '@igo2/geo';\nimport { MapState } from '../../map/map.state';\nimport { MeasureState } from '../measure.state';\n\n/**\n * Tool to measure lengths and areas\n */\n@ToolComponent({\n  name: 'measurer',\n  title: 'igo.integration.tools.measurer',\n  icon: 'ruler'\n})\n@Component({\n  selector: 'igo-measurer-tool',\n  templateUrl: './measurer-tool.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MeasurerToolComponent {\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get store(): FeatureStore<FeatureWithMeasure> {\n    return this.measureState.store;\n  }\n\n  /**\n   * Map to measure on\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(\n    private measureState: MeasureState,\n    private mapState: MapState\n  ) {}\n}\n","<igo-measurer [store]=\"store\" [map]=\"map\"></igo-measurer>\n","import { Component } from '@angular/core';\n\nimport { ToolComponent } from '@igo2/common';\nimport { IgoMap } from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\n\n@ToolComponent({\n  name: 'print',\n  title: 'igo.integration.tools.print',\n  icon: 'printer'\n})\n@Component({\n  selector: 'igo-print-tool',\n  templateUrl: './print-tool.component.html'\n})\nexport class PrintToolComponent {\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  constructor(private mapState: MapState) {}\n}\n","<igo-print [map]=\"map\"></igo-print>\n","<div\n  *ngIf=\"(!store || store.stateView.empty) && (debouncedEmpty$ | async)\"\n  style=\"margin: 10px\"\n>\n  <section class=\"mat-typography\">\n    <h4>\n      <strong>{{\n        'igo.integration.searchResultsTool.noResults' | translate\n      }}</strong>\n    </h4>\n    <p>\n      <strong>{{\n        'igo.integration.searchResultsTool.doSearch' | translate\n      }}</strong>\n    </p>\n    <div\n      [innerHTML]=\"\n        'igo.integration.searchResultsTool.examples' | translate | sanitizeHtml\n      \"\n    ></div>\n  </section>\n</div>\n\n<igo-flexible\n  *ngIf=\"(debouncedEmpty$ | async) === false\"\n  #topPanel\n  initial=\"100%\"\n  initialMobile=\"100%\"\n  collapsed=\"calc(100% - 58px)\"\n  collapsedMobile=\"calc(100% - 58px)\"\n  expanded=\"60%\"\n  expandedMobile=\"60%\"\n  [state]=\"(feature$ | async) ? topPanelState : 'initial'\"\n>\n  <div class=\"igo-content\">\n    <igo-search-results\n      [store]=\"store\"\n      [showIcons]=\"showIcons\"\n      [term]=\"term\"\n      [termSplitter]=\"termSplitter\"\n      [settingsChange$]=\"settingsChange$\"\n      placeholder=\"false\"\n      (resultFocus)=\"onResultFocus($event)\"\n      (resultSelect)=\"onResultSelect($event)\"\n      (resultUnfocus)=\"onResultUnfocus($event)\"\n      (resultMouseenter)=\"onResultFocus($event)\"\n      (resultMouseleave)=\"onResultUnfocus($event)\"\n      (moreResults)=\"onSearch($event)\"\n      [map]=\"map\"\n    >\n      <ng-template #igoSearchItemToolbar let-result=\"result\">\n        <igo-search-add-button\n          [map]=\"map\"\n          [store]=\"store\"\n          [stores]=\"stores\"\n          [layer]=\"result\"\n          [saveSearchResultInLayer]=\"saveSearchResultInLayer\"\n        >\n        </igo-search-add-button>\n      </ng-template>\n    </igo-search-results>\n  </div>\n\n  <div igoFlexibleFill class=\"igo-content\">\n    <igo-panel\n      [title]=\"featureTitle\"\n      *ngIf=\"feature$ | async\"\n      (click)=\"toggleTopPanel($event)\"\n      [cursorPointer]=\"true\"\n    >\n      <button\n        mat-icon-button\n        panelLeftButton\n        class=\"igo-icon-button\"\n        (click)=\"toggleTopPanel()\"\n      >\n        <mat-icon\n          [svgIcon]=\"\n            (topPanelState$ | async) === 'collapsed' ? 'arrow-up' : 'arrow-down'\n          \"\n        ></mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"feature.geometry\"\n        mat-icon-button\n        panelRightButton\n        class=\"igo-icon-button\"\n        [matTooltip]=\"\n          ((isSelectedResultOutOfView$ | async)\n            ? 'igo.integration.searchResultsTool.zoomOnFeatureTooltipOutOfView'\n            : 'igo.integration.searchResultsTool.zoomOnFeatureTooltip'\n          ) | translate\n        \"\n        matTooltipShowDelay=\"500\"\n        (click)=\"zoomToFeatureExtent()\"\n      >\n        <mat-icon\n          aria-hidden=\"false\"\n          [matBadge]=\"(isSelectedResultOutOfView$ | async) ? '!' : ''\"\n          matBadgeColor=\"accent\"\n          matBadgeSize=\"small\"\n          [matBadgeHidden]=\"(isSelectedResultOutOfView$ | async) === false\"\n          svgIcon=\"magnify-plus-outline\"\n        ></mat-icon>\n      </button>\n\n      <igo-feature-details\n        igoFeatureDetailsDirective\n        [feature]=\"feature$ | async\"\n        [map]=\"map\"\n        [toolbox]=\"toolState.toolbox\"\n        (routingEvent)=\"getRoute()\"\n      >\n      </igo-feature-details>\n    </igo-panel>\n  </div>\n</igo-flexible>\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  Input,\n  OnInit,\n  ElementRef,\n  OnDestroy\n} from '@angular/core';\nimport { Observable, BehaviorSubject, Subscription, combineLatest } from 'rxjs';\nimport { debounceTime, map } from 'rxjs/operators';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\nimport olFeature from 'ol/Feature';\nimport olPoint from 'ol/geom/Point';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport pointOnFeature from '@turf/point-on-feature';\nimport * as olProj from 'ol/proj';\nimport { ConfigService } from '@igo2/core';\n\nimport {\n  EntityStore,\n  ToolComponent,\n  FlexibleState,\n  getEntityTitle,\n  FlexibleComponent,\n  EntityState\n} from '@igo2/common';\n\nimport {\n  FEATURE,\n  Feature,\n  FeatureMotion,\n  SearchResult,\n  IgoMap,\n  moveToOlFeatures,\n  Research,\n  featuresAreTooDeepInView,\n  featureToOl,\n  featureFromOl,\n  getCommonVectorStyle,\n  getCommonVectorSelectedStyle,\n  computeOlFeaturesExtent,\n  featuresAreOutOfView,\n  roundCoordTo,\n  FeatureStore\n} from '@igo2/geo';\n\nimport { MapState } from '../../map/map.state';\n\nimport { SearchState } from '../search.state';\nimport { ToolState } from '../../tool/tool.state';\nimport { DirectionState } from '../../directions/directions.state';\n\n/**\n * Tool to browse the search results\n */\n@ToolComponent({\n  name: 'searchResults',\n  title: 'igo.integration.tools.searchResults',\n  icon: 'magnify'\n})\n@Component({\n  selector: 'igo-search-results-tool',\n  templateUrl: './search-results-tool.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultsToolComponent implements OnInit, OnDestroy {\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean = true;\n\n  /**\n   * Determine the top panel default state\n   */\n  @Input() topPanelStateDefault: string = 'expanded';\n\n  private hasFeatureEmphasisOnSelection: boolean = false;\n  public saveSearchResultInLayer: boolean = false;\n\n  private showResultsGeometries$$: Subscription;\n  private getRoute$$: Subscription;\n  private shownResultsGeometries: Feature[] = [];\n  private shownResultsEmphasisGeometries: Feature[] = [];\n  private focusedResult$: BehaviorSubject<SearchResult> = new BehaviorSubject(\n    undefined\n  );\n  public isSelectedResultOutOfView$ = new BehaviorSubject(false);\n  private isSelectedResultOutOfView$$: Subscription;\n  private abstractFocusedResult: Feature;\n  private abstractSelectedResult: Feature;\n\n  public debouncedEmpty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private debouncedEmpty$$: Subscription;\n\n  /**\n   * Store holding the search results\n   * @internal\n   */\n  get store(): EntityStore<SearchResult> {\n    return this.searchState.store;\n  }\n\n  /**\n   * Map to display the results on\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.mapState.map;\n  }\n\n  get featureTitle(): string {\n    return this.feature ? getEntityTitle(this.feature) : undefined;\n  }\n\n  get feature$(): Observable<Feature> {\n    return this.store.stateView\n      .firstBy$((e) => e.state.focused)\n      .pipe(\n        map(\n          (element) =>\n            (this.feature = element\n              ? (element.entity.data as Feature)\n              : undefined)\n        )\n      );\n  }\n\n  public feature: Feature;\n\n  public term = '';\n  private searchTerm$$: Subscription;\n\n  public settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  public topPanelState$ = new BehaviorSubject<FlexibleState>('initial');\n  private topPanelState$$: Subscription;\n\n  @Input()\n  set topPanelState(value: FlexibleState) {\n    this.topPanelState$.next(value);\n  }\n  get topPanelState(): FlexibleState {\n    return this.topPanelState$.value;\n  }\n\n  get termSplitter(): string {\n    return this.searchState.searchTermSplitter$.value;\n  }\n\n  private format = new olFormatGeoJSON();\n\n  get stores(): FeatureStore<Feature>[] {\n    return this.searchState.searchLayerStores;\n  }\n\n  constructor(\n    private mapState: MapState,\n    private searchState: SearchState,\n    private elRef: ElementRef,\n    public toolState: ToolState,\n    private directionState: DirectionState,\n    configService: ConfigService\n  ) {\n    this.hasFeatureEmphasisOnSelection = configService.getConfig(\n      'hasFeatureEmphasisOnSelection'\n    );\n    this.saveSearchResultInLayer = configService.getConfig(\n      'saveSearchResultInLayer'\n    );\n  }\n\n  ngOnInit() {\n    this.searchTerm$$ = this.searchState.searchTerm$.subscribe(\n      (searchTerm: string) => {\n        if (\n          searchTerm !== undefined &&\n          searchTerm !== null &&\n          searchTerm !== ''\n        ) {\n          this.term = searchTerm;\n          this.debouncedEmpty$.next(false);\n        } else if (searchTerm === '') {\n          this.debouncedEmpty$.next(true);\n        }\n      }\n    );\n\n    for (const res of this.store.stateView.all$().value) {\n      if (this.store.state.get(res.entity).selected === true) {\n        this.topPanelState = 'expanded';\n      }\n    }\n\n    this.searchState.searchSettingsChange$.subscribe(() => {\n      this.settingsChange$.next(true);\n    });\n\n    this.topPanelState$$ = this.topPanelState$.subscribe(() => {\n      const igoList = this.computeElementRef()[0];\n      const selected = this.computeElementRef()[1];\n      if (selected) {\n        setTimeout(() => {\n          // To be sure the flexible component has been displayed yet\n          if (!this.isScrolledIntoView(igoList, selected)) {\n            this.adjustTopPanel(igoList, selected);\n          }\n        }, FlexibleComponent.transitionTime + 50);\n      }\n    });\n\n    if (this.hasFeatureEmphasisOnSelection) {\n      if (!this.searchState.focusedOrResolution$$) {\n        this.searchState.focusedOrResolution$$ = combineLatest([\n          this.focusedResult$,\n          this.map.viewController.resolution$\n        ]).subscribe((bunch: [SearchResult<Feature>, number]) =>\n          this.buildResultEmphasis(bunch[0], 'focused')\n        );\n      }\n\n      if (!this.searchState.selectedOrResolution$$) {\n        this.searchState.selectedOrResolution$$ = combineLatest([\n          this.searchState.selectedResult$,\n          this.map.viewController.resolution$\n        ]).subscribe((bunch: [SearchResult<Feature>, number]) =>\n          this.buildResultEmphasis(bunch[0], 'selected')\n        );\n      }\n    }\n    this.monitorResultOutOfView();\n\n    this.showResultsGeometries$$ = combineLatest([\n      this.searchState.searchResultsGeometryEnabled$,\n      this.store.stateView.all$(),\n      this.focusedResult$,\n      this.searchState.selectedResult$,\n      this.searchState.searchTerm$,\n      this.map.viewController.resolution$\n    ]).subscribe(\n      (\n        bunch: [\n          boolean,\n          { entity: SearchResult; state: EntityState }[],\n          SearchResult,\n          SearchResult,\n          string,\n          number\n        ]\n      ) => {\n        const searchResultsGeometryEnabled = bunch[0];\n        const searchResults = bunch[1];\n\n        if (this.hasFeatureEmphasisOnSelection) {\n          this.clearFeatureEmphasis('shown');\n        }\n        this.shownResultsGeometries.map((result) =>\n          this.map.queryResultsOverlay.removeFeature(result)\n        );\n        const featureToHandleGeom = searchResults.filter(\n          (result) =>\n            result.entity.meta.dataType === FEATURE &&\n            result.entity.data.geometry &&\n            !result.state.selected &&\n            !result.state.focused\n        );\n\n        featureToHandleGeom.map((result) => {\n          if (searchResultsGeometryEnabled) {\n            result.entity.data.meta.style = getCommonVectorStyle(\n              Object.assign(\n                {},\n                {\n                  feature: result.entity.data as Feature | olFeature<OlGeometry>\n                },\n                this.searchState.searchOverlayStyle,\n                result.entity.style?.base ? result.entity.style.base : {}\n              )\n            );\n            this.shownResultsGeometries.push(result.entity.data as Feature);\n            this.map.queryResultsOverlay.addFeature(\n              result.entity.data as Feature,\n              FeatureMotion.None\n            );\n            if (this.hasFeatureEmphasisOnSelection) {\n              this.buildResultEmphasis(\n                result.entity as SearchResult<Feature>,\n                'shown'\n              );\n            }\n          }\n        });\n      }\n    );\n\n    this.debouncedEmpty$$ = this.store.stateView.empty$\n      .pipe(debounceTime(1500))\n      .subscribe((empty) => this.debouncedEmpty$.next(empty));\n  }\n\n  private monitorResultOutOfView() {\n    this.isSelectedResultOutOfView$$ = combineLatest([\n      this.map.viewController.state$,\n      this.searchState.selectedResult$\n    ])\n      .pipe(debounceTime(100))\n      .subscribe((bunch) => {\n        const selectedResult = bunch[1] as SearchResult<Feature>;\n        if (!selectedResult) {\n          this.isSelectedResultOutOfView$.next(false);\n          return;\n        }\n        if (selectedResult.data.geometry) {\n          const selectedOlFeature = featureToOl(\n            selectedResult.data,\n            this.map.projection\n          );\n          const selectedOlFeatureExtent = computeOlFeaturesExtent(\n            [selectedOlFeature],\n            this.map.viewController.getOlProjection()\n          );\n          this.isSelectedResultOutOfView$.next(\n            featuresAreOutOfView(this.map.getExtent(), selectedOlFeatureExtent)\n          );\n        }\n      });\n  }\n\n  private buildResultEmphasis(\n    result: SearchResult<Feature>,\n    trigger: 'selected' | 'focused' | 'shown' | undefined\n  ) {\n    if (trigger !== 'shown') {\n      this.clearFeatureEmphasis(trigger);\n    }\n    if (!result || !result.data.geometry) {\n      return;\n    }\n    const myOlFeature = featureToOl(result.data, this.map.projection);\n    const olGeometry = myOlFeature.getGeometry();\n    if (\n      featuresAreTooDeepInView(\n        this.map.viewController,\n        olGeometry.getExtent() as [number, number, number, number],\n        0.0025\n      )\n    ) {\n      const extent = olGeometry.getExtent();\n      const x = extent[0] + (extent[2] - extent[0]) / 2;\n      const y = extent[1] + (extent[3] - extent[1]) / 2;\n      const feature1 = new olFeature({\n        name: `${trigger}AbstractResult'`,\n        geometry: new olPoint([x, y])\n      });\n      const abstractResult = featureFromOl(feature1, this.map.projection);\n\n      let computedStyle;\n      let zIndexOffset = 0;\n\n      switch (trigger) {\n        case 'focused':\n          computedStyle = getCommonVectorSelectedStyle(\n            Object.assign(\n              {},\n              { feature: abstractResult },\n              this.searchState.searchOverlayStyleFocus,\n              result.style?.focus ? result.style.focus : {}\n            )\n          );\n          zIndexOffset = 2;\n          break;\n        case 'shown':\n          computedStyle = getCommonVectorStyle(\n            Object.assign(\n              {},\n              { feature: abstractResult },\n              this.searchState.searchOverlayStyle,\n              result.style?.base ? result.style.base : {}\n            )\n          );\n          break;\n        case 'selected':\n          computedStyle = getCommonVectorSelectedStyle(\n            Object.assign(\n              {},\n              { feature: abstractResult },\n              this.searchState.searchOverlayStyleSelection,\n              result.style?.selection ? result.style.selection : {}\n            )\n          );\n          zIndexOffset = 1;\n          break;\n      }\n      abstractResult.meta.style = computedStyle;\n      abstractResult.meta.style.setZIndex(2000 + zIndexOffset);\n      this.map.searchResultsOverlay.addFeature(\n        abstractResult,\n        FeatureMotion.None\n      );\n      if (trigger === 'focused') {\n        this.abstractFocusedResult = abstractResult;\n      }\n      if (trigger === 'selected') {\n        this.abstractSelectedResult = abstractResult;\n      }\n      if (trigger === 'shown') {\n        this.shownResultsEmphasisGeometries.push(abstractResult);\n      }\n    } else {\n      this.clearFeatureEmphasis(trigger);\n    }\n  }\n\n  private clearFeatureEmphasis(trigger: 'selected' | 'focused' | 'shown') {\n    if (trigger === 'focused' && this.abstractFocusedResult) {\n      this.map.searchResultsOverlay.removeFeature(this.abstractFocusedResult);\n      this.abstractFocusedResult = undefined;\n    }\n    if (trigger === 'selected' && this.abstractSelectedResult) {\n      this.map.searchResultsOverlay.removeFeature(this.abstractSelectedResult);\n      this.abstractSelectedResult = undefined;\n    }\n    if (trigger === 'shown') {\n      this.shownResultsEmphasisGeometries.map((shownResult) =>\n        this.map.searchResultsOverlay.removeFeature(shownResult)\n      );\n      this.shownResultsEmphasisGeometries = [];\n    }\n  }\n\n  ngOnDestroy() {\n    this.topPanelState$$.unsubscribe();\n    this.searchTerm$$.unsubscribe();\n    if (this.isSelectedResultOutOfView$$) {\n      this.isSelectedResultOutOfView$$.unsubscribe();\n    }\n    if (this.showResultsGeometries$$) {\n      this.showResultsGeometries$$.unsubscribe();\n    }\n    if (this.getRoute$$) {\n      this.getRoute$$.unsubscribe();\n    }\n    if (this.debouncedEmpty$$) {\n      this.debouncedEmpty$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Try to add a feature to the map when it's being focused\n   * @internal\n   * @param result A search result that could be a feature\n   */\n  onResultFocus(result: SearchResult) {\n    this.focusedResult$.next(result);\n    if (result.meta.dataType === FEATURE && result.data.geometry) {\n      result.data.meta.style = getCommonVectorSelectedStyle(\n        Object.assign(\n          {},\n          { feature: result.data as Feature | olFeature<OlGeometry> },\n          this.searchState.searchOverlayStyleFocus,\n          result.style?.focus ? result.style.focus : {}\n        )\n      );\n\n      const feature =\n        this.map.searchResultsOverlay.dataSource.ol.getFeatureById(\n          result.meta.id\n        );\n      if (feature) {\n        feature.setStyle(result.data.meta.style);\n        return;\n      }\n      this.map.searchResultsOverlay.addFeature(\n        result.data as Feature,\n        FeatureMotion.None\n      );\n    }\n  }\n\n  onResultUnfocus(result: SearchResult) {\n    this.focusedResult$.next(undefined);\n    if (result.meta.dataType !== FEATURE) {\n      return;\n    }\n\n    if (this.store.state.get(result).selected === true) {\n      const feature =\n        this.map.searchResultsOverlay.dataSource.ol.getFeatureById(\n          result.meta.id\n        );\n      if (feature) {\n        const style = getCommonVectorSelectedStyle(\n          Object.assign(\n            {},\n            { feature: result.data as Feature | olFeature<OlGeometry> },\n            this.searchState.searchOverlayStyleFocus,\n            result.style?.focus ? result.style.focus : {}\n          )\n        );\n        feature.setStyle(style);\n      }\n      return;\n    }\n    this.map.searchResultsOverlay.removeFeature(result.data as Feature);\n  }\n\n  /**\n   * Try to add a feature to the map when it's being selected\n   * @internal\n   * @param result A search result that could be a feature or some layer options\n   */\n  onResultSelect(result: SearchResult) {\n    this.map.searchResultsOverlay.dataSource.ol.clear();\n    this.tryAddFeatureToMap(result);\n    this.searchState.setSelectedResult(result);\n\n    if (this.topPanelState === 'initial') {\n      if (this.topPanelStateDefault !== 'collapsed') {\n        this.topPanelState = 'expanded';\n      } else {\n        this.topPanelState = 'collapsed';\n      }\n    }\n\n    if (this.topPanelState === 'expanded') {\n      const igoList = this.computeElementRef()[0];\n      const selected = this.computeElementRef()[1];\n      if (!this.isScrolledIntoView(igoList, selected)) {\n        this.adjustTopPanel(igoList, selected);\n      }\n    }\n  }\n\n  onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    const newResults = this.store.entities$.value\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n\n    this.store.load(newResults);\n\n    for (const res of this.store.all()) {\n      if (\n        this.store.state.get(res).focused === true &&\n        this.store.state.get(res).selected !== true\n      ) {\n        this.store.state.update(res, { focused: false }, true);\n      }\n    }\n\n    setTimeout(() => {\n      const igoList = this.elRef.nativeElement.querySelector('igo-list');\n      let moreResults;\n      event.research.request.subscribe((source) => {\n        if (!source[0] || !source[0].source) {\n          moreResults = null;\n        } else if (source[0].source.getId() === 'icherche') {\n          moreResults = igoList.querySelector('.icherche .moreResults');\n        } else if (source[0].source.getId() === 'ilayer') {\n          moreResults = igoList.querySelector('.ilayer .moreResults');\n        } else if (source[0].source.getId() === 'nominatim') {\n          moreResults = igoList.querySelector('.nominatim .moreResults');\n        } else {\n          moreResults = igoList.querySelector(\n            '.' + source[0].source.getId() + ' .moreResults'\n          );\n        }\n\n        if (\n          moreResults !== null &&\n          !this.isScrolledIntoView(igoList, moreResults)\n        ) {\n          igoList.scrollTop =\n            moreResults.offsetTop +\n            moreResults.offsetHeight -\n            igoList.clientHeight;\n        }\n      });\n    }, 250);\n  }\n\n  computeElementRef() {\n    const items = document.getElementsByTagName('igo-search-results-item');\n    const igoList =\n      this.elRef.nativeElement.getElementsByTagName('igo-list')[0];\n    let selectedItem;\n    // eslint-disable-next-line\n    for (let i = 0; i < items.length; i++) {\n      if (items[i].className.includes('igo-list-item-selected')) {\n        selectedItem = items[i];\n      }\n    }\n    return [igoList, selectedItem];\n  }\n\n  adjustTopPanel(elemSource, elem) {\n    if (!this.isScrolledIntoView(elemSource, elem)) {\n      elemSource.scrollTop =\n        elem.offsetTop +\n        elem.children[0].offsetHeight -\n        elemSource.clientHeight;\n    }\n  }\n\n  toggleTopPanel(event?: MouseEvent) {\n    if (event && (event.target as any)?.className !== 'igo-panel-title') {\n      return;\n    } else {\n      if (this.topPanelState === 'expanded') {\n        this.topPanelState = 'collapsed';\n      } else {\n        this.topPanelState = 'expanded';\n      }\n    }\n  }\n\n  zoomToFeatureExtent() {\n    if (this.feature.geometry) {\n      const localOlFeature = this.format.readFeature(this.feature, {\n        dataProjection: this.feature.projection,\n        featureProjection: this.map.projectionCode\n      });\n      moveToOlFeatures(\n        this.map.viewController,\n        [localOlFeature],\n        FeatureMotion.Zoom\n      );\n    }\n  }\n\n  /**\n   * Try to add a feature to the map overlay\n   * @param result A search result that could be a feature\n   */\n  private tryAddFeatureToMap(result: SearchResult) {\n    if (result.meta.dataType !== FEATURE) {\n      return undefined;\n    }\n    const feature = (result as SearchResult<Feature>).data;\n\n    // Somethimes features have no geometry. It happens with some GetFeatureInfo\n    if (!feature.geometry) {\n      return;\n    }\n\n    feature.meta.style = getCommonVectorSelectedStyle(\n      Object.assign(\n        {},\n        { feature },\n        this.searchState.searchOverlayStyleSelection,\n        result.style?.selection ? result.style.selection : {}\n      )\n    );\n\n    this.map.searchResultsOverlay.addFeature(feature);\n  }\n\n  isScrolledIntoView(elemSource, elem) {\n    const padding = 6;\n    const docViewTop = elemSource.scrollTop;\n    const docViewBottom = docViewTop + elemSource.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.clientHeight + padding;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  getRoute() {\n    this.toolState.toolbox.activateTool('directions');\n    this.directionState.stopsStore.clearStops();\n    setTimeout(() => {\n      let routingCoordLoaded = false;\n      if (this.getRoute$$) {\n        this.getRoute$$.unsubscribe();\n      }\n      this.getRoute$$ =\n        this.directionState.stopsStore.storeInitialized$.subscribe(\n          (init: boolean) => {\n            if (\n              this.directionState.stopsStore.storeInitialized$.value &&\n              !routingCoordLoaded\n            ) {\n              routingCoordLoaded = true;\n              const stop = this.directionState.stopsStore\n                .all()\n                .find((e) => e.position === 1);\n              let coord;\n              if (this.feature.geometry) {\n                if (this.feature.geometry.type === 'Point') {\n                  coord = [\n                    this.feature.geometry.coordinates[0],\n                    this.feature.geometry.coordinates[1]\n                  ];\n                } else {\n                  const point = pointOnFeature(this.feature.geometry);\n                  coord = [\n                    point.geometry.coordinates[0],\n                    point.geometry.coordinates[1]\n                  ];\n                }\n              }\n              stop.text = this.featureTitle;\n              stop.coordinates = coord;\n              this.directionState.stopsStore.update(stop);\n              if (this.map.geolocationController.position$.value) {\n                const currentPos =\n                  this.map.geolocationController.position$.value;\n                const stop = this.directionState.stopsStore\n                  .all()\n                  .find((e) => e.position === 0);\n                const currentCoord = olProj.transform(\n                  currentPos.position,\n                  currentPos.projection,\n                  'EPSG:4326'\n                );\n                const coord: [number, number] = roundCoordTo(\n                  [currentCoord[0], currentCoord[1]],\n                  6\n                );\n                stop.text = coord.join(',');\n                stop.coordinates = coord;\n                this.directionState.stopsStore.update(stop);\n              }\n            }\n          }\n        );\n    }, 250);\n  }\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Input,\n  Output,\n  ViewContainerRef\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { TemplatePortal } from '@angular/cdk/portal';\nimport { fromEvent, Subscription } from 'rxjs';\nimport { filter, take } from 'rxjs/operators';\nimport { Overlay, OverlayRef } from '@angular/cdk/overlay';\n\n@Directive({\n  selector: '[igoContextMenu]'\n})\nexport class ContextMenuDirective {\n  private overlayRef: OverlayRef | null;\n  private sub: Subscription;\n\n  @Input('igoContextMenu') menuContext: TemplateRef<any>;\n  @Output() menuPosition = new EventEmitter<{ x: number; y: number }>();\n\n  constructor(\n    public overlay: Overlay,\n    public viewContainerRef: ViewContainerRef,\n    private elementRef: ElementRef\n  ) {}\n\n  @HostListener('longpress', ['$event'])\n  @HostListener('contextmenu', ['$event'])\n  public onContextMenu(e: MouseEvent | TouchEvent): void {\n    let x;\n    let y;\n    if (e instanceof TouchEvent) {\n      x = e.touches[0].pageX;\n      y = e.touches[0].pageY;\n    } else if (e instanceof MouseEvent) {\n      x = e.x;\n      y = e.y;\n    }\n    if (!x || !y) {\n      return;\n    }\n\n    this.close();\n    e.preventDefault();\n    this.menuPosition.emit({ x, y });\n    this.overlayRef = null;\n    const positionStrategy = this.overlay\n      .position()\n      .flexibleConnectedTo({ x, y })\n      .withPositions([\n        {\n          originX: 'end',\n          originY: 'bottom',\n          overlayX: 'start',\n          overlayY: 'top'\n        }\n      ]);\n    this.overlayRef = this.overlay.create({\n      positionStrategy,\n      scrollStrategy: this.overlay.scrollStrategies.close()\n    });\n    this.overlayRef.attach(\n      new TemplatePortal(this.menuContext, this.viewContainerRef, {\n        $implicit: undefined\n      })\n    );\n\n    this.sub = fromEvent<MouseEvent>(document, 'click')\n      .pipe(\n        filter((event) => {\n          const clickTarget = event.target as HTMLElement;\n          this.close();\n          return (\n            !!this.overlayRef &&\n            !this.overlayRef.overlayElement.contains(clickTarget)\n          );\n        }),\n        take(1)\n      )\n      .subscribe(() => this.close());\n\n    this.sub = fromEvent<MouseEvent>(document, 'contextmenu')\n      .pipe(\n        filter((event) => {\n          const clickTarget = event.target as HTMLElement;\n          if (\n            clickTarget &&\n            !this.elementRef.nativeElement.contains(clickTarget) &&\n            !this.overlayRef.overlayElement.contains(clickTarget)\n          ) {\n            return true;\n          } else {\n            event.preventDefault();\n          }\n        }),\n        take(1)\n      )\n      .subscribe(() => this.close());\n  }\n\n  close() {\n    if (this.overlayRef) {\n      this.overlayRef.dispose();\n      this.overlayRef = null;\n    }\n    if (this.sub) {\n      this.sub.unsubscribe();\n    }\n  }\n}\n","<app-doc-viewer\n  title=\"Search\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['ConfigService', 'LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/search\" configFolder=\"environments\">\n    <span *ngIf=\"!isTouchScreen\" title=\"Details\">\n      F2 activate/deactivate the pointer location.\n    </span>\n    <igo-map-browser\n      #mapBrowser\n      [map]=\"map\"\n      [view]=\"view\"\n      igoOverlay\n      [igoContextMenu]=\"actionbarMenu\"\n      igoLongPress\n      igoSearchPointerSummary\n      [igoSearchPointerSummaryDelay]=\"500\"\n      [igoSearchPointerSummaryEnabled]=\"igoSearchPointerSummaryEnabled\"\n      (menuPosition)=\"onContextMenuOpen($event)\"\n    >\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n\n    <igo-panel title=\"Search\">\n      <igo-search-bar\n        [term]=\"term\"\n        (pointerSummaryStatus)=\"onPointerSummaryStatusChange($event)\"\n        [searchSettings]=\"true\"\n        [store]=\"searchStore\"\n        [termSplitter]=\"termSplitter\"\n        (searchTermChange)=\"onSearchTermChange($event)\"\n        (search)=\"onSearch($event)\"\n        (clearFeature)=\"removeFeatureFromMap()\"\n        (searchSettingsChange)=\"onSearchSettingsChange()\"\n        [reverseSearchCoordsFormatEnabled]=\"igoReverseSearchCoordsFormatEnabled\"\n        (reverseSearchCoordsFormatStatus)=\"\n          onReverseCoordsFormatStatusChange($event)\n        \"\n      >\n      </igo-search-bar>\n\n      <igo-search-results\n        [store]=\"searchStore\"\n        [term]=\"term\"\n        [termSplitter]=\"termSplitter\"\n        placeholder=\"false\"\n        [settingsChange$]=\"settingsChange$\"\n        (resultFocus)=\"onResultFocus($event)\"\n        (resultSelect)=\"onResultFocus($event)\"\n        (moreResults)=\"onSearch($event)\"\n      >\n        <ng-template #igoSearchItemToolbar let-result=\"result\">\n          <igo-search-add-button [map]=\"map\" [layer]=\"result\">\n          </igo-search-add-button>\n        </ng-template>\n      </igo-search-results>\n    </igo-panel>\n\n    <igo-panel *ngIf=\"selectedFeature\" title=\"Details\">\n      <igo-feature-details [feature]=\"selectedFeature\"></igo-feature-details>\n    </igo-panel>\n\n    <ng-template #actionbarMenu>\n      <igo-actionbar\n        [store]=\"store\"\n        [withIcon]=\"false\"\n        [horizontal]=\"true\"\n        [mode]=\"'context'\"\n      >\n      </igo-actionbar>\n    </ng-template>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppSearchComponent } from './search.component';\n\nconst routes: Routes = [\n  {\n    path: 'search',\n    component: AppSearchComponent\n  }\n];\n\nexport const AppSearchRoutingModule = RouterModule.forChild(routes);\n","import { BehaviorSubject } from 'rxjs';\nimport {\n  Component,\n  ElementRef,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport * as proj from 'ol/proj';\n\nimport { LanguageService, MediaService, StorageService } from '@igo2/core';\nimport { EntityStore, ActionStore } from '@igo2/common';\nimport {\n  FEATURE,\n  Feature,\n  FeatureMotion,\n  GoogleLinks,\n  IgoMap,\n  LayerService,\n  MapService,\n  Layer,\n  ProjectionService,\n  Research,\n  SearchResult\n} from '@igo2/geo';\n\nimport { SearchState } from '@igo2/integration';\n\n@Component({\n  selector: 'app-search',\n  templateUrl: './search.component.html',\n  styleUrls: ['./search.component.scss']\n})\nexport class AppSearchComponent implements OnInit, OnDestroy {\n  public store = new ActionStore([]);\n\n  public igoSearchPointerSummaryEnabled: boolean = false;\n\n  public termSplitter: string = '|';\n\n  public map = new IgoMap({\n    overlay: true,\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  public osmLayer: Layer;\n\n  @ViewChild('mapBrowser', { read: ElementRef, static: true })\n  mapBrowser: ElementRef;\n\n  public lonlat;\n  public mapProjection: string;\n  public term: string;\n\n  public settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  get searchStore(): EntityStore<SearchResult> {\n    return this.searchState.store;\n  }\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  public selectedFeature: Feature;\n  public igoReverseSearchCoordsFormatEnabled: boolean;\n\n  constructor(\n    private languageService: LanguageService,\n    private projectionService: ProjectionService,\n    private mapService: MapService,\n    private layerService: LayerService,\n    private searchState: SearchState,\n    private mediaService: MediaService,\n    private storageService: StorageService\n  ) {\n    this.mapService.setMap(this.map);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe((layer) => {\n        this.osmLayer = layer;\n        this.map.addLayer(layer);\n      });\n\n    this.igoReverseSearchCoordsFormatEnabled =\n      (this.storageService.get(\n        'reverseSearchCoordsFormatEnabled'\n      ) as boolean) || false;\n  }\n\n  onPointerSummaryStatusChange(value) {\n    this.igoSearchPointerSummaryEnabled = value;\n  }\n\n  onSearchTermChange(term?: string) {\n    this.term = term;\n    this.searchState.setSearchTerm(term);\n    const termWithoutHashtag = term.replace(/(#[^\\s]*)/g, '').trim();\n    if (termWithoutHashtag.length < 2) {\n      this.searchStore.clear();\n      this.selectedFeature = undefined;\n    }\n  }\n\n  onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    this.searchStore.state.updateAll({ focused: false, selected: false });\n    const newResults = this.searchStore.entities$.value\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n    this.searchStore.updateMany(newResults);\n  }\n\n  onReverseCoordsFormatStatusChange(value) {\n    this.storageService.set('reverseSearchCoordsFormatEnabled', value);\n    this.igoReverseSearchCoordsFormatEnabled = value;\n  }\n\n  onSearchSettingsChange() {\n    this.settingsChange$.next(true);\n  }\n\n  /**\n   * Try to add a feature to the map when it's being focused\n   * @internal\n   * @param result A search result that could be a feature\n   */\n  onResultFocus(result: SearchResult) {\n    this.tryAddFeatureToMap(result);\n    this.selectedFeature = (result as SearchResult<Feature>).data;\n  }\n\n  /**\n   * Try to add a feature to the map overlay\n   * @param layer A search result that could be a feature\n   */\n  private tryAddFeatureToMap(layer: SearchResult) {\n    if (layer.meta.dataType !== FEATURE) {\n      return undefined;\n    }\n\n    // Somethimes features have no geometry. It happens with some GetFeatureInfo\n    if (layer.data.geometry === undefined) {\n      return;\n    }\n\n    this.map.searchResultsOverlay.setFeatures(\n      [layer.data] as Feature[],\n      FeatureMotion.Default\n    );\n  }\n\n  ngOnInit() {\n    this.store.load([\n      {\n        id: 'coordinates',\n        title: 'coordinates',\n        handler: () => this.searchCoordinate(this.lonlat)\n      },\n      {\n        id: 'googleMaps',\n        title: 'googleMap',\n        handler: () => this.openGoogleMaps(this.lonlat)\n      },\n      {\n        id: 'googleStreetView',\n        title: 'googleStreetView',\n        handler: () => this.openGoogleStreetView(this.lonlat)\n      }\n    ]);\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  /*\n   * Remove a feature to the map overlay\n   */\n  removeFeatureFromMap() {\n    this.map.searchResultsOverlay.clear();\n  }\n\n  onContextMenuOpen(event: { x: number; y: number }) {\n    const position = this.mapPosition(event);\n    const coord = this.mapService.getMap().ol.getCoordinateFromPixel(position);\n    this.mapProjection = this.mapService.getMap().projection;\n    this.lonlat = proj.transform(coord, this.mapProjection, 'EPSG:4326');\n  }\n\n  mapPosition(event: { x: number; y: number }) {\n    const contextmenuPoint = event;\n    contextmenuPoint.y =\n      contextmenuPoint.y -\n      this.mapBrowser.nativeElement.getBoundingClientRect().top +\n      window.scrollY;\n    contextmenuPoint.x =\n      contextmenuPoint.x -\n      this.mapBrowser.nativeElement.getBoundingClientRect().left +\n      window.scrollX;\n    const position = [contextmenuPoint.x, contextmenuPoint.y];\n    return position;\n  }\n\n  searchCoordinate(lonlat) {\n    this.searchStore.clear();\n    this.term = !this.igoReverseSearchCoordsFormatEnabled\n      ? lonlat.map((c) => c.toFixed(6)).join(', ')\n      : lonlat\n          .reverse()\n          .map((c) => c.toFixed(6))\n          .join(', ');\n  }\n\n  openGoogleMaps(lonlat) {\n    window.open(GoogleLinks.getGoogleMapsCoordLink(lonlat[0], lonlat[1]));\n  }\n\n  openGoogleStreetView(lonlat) {\n    window.open(GoogleLinks.getGoogleStreetViewLink(lonlat[0], lonlat[1]));\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { IgoMessageModule } from '@igo2/core';\n\nimport {\n  IgoPanelModule,\n  IgoActionbarModule,\n  IgoContextMenuModule\n} from '@igo2/common';\n\nimport {\n  IgoFeatureModule,\n  IgoMapModule,\n  IgoSearchModule,\n  provideIChercheSearchSource,\n  provideWorkspaceSearchSource,\n  provideILayerSearchSource,\n  provideNominatimSearchSource,\n  provideIChercheReverseSearchSource,\n  provideCoordinatesReverseSearchSource,\n  provideCadastreSearchSource,\n  provideStoredQueriesSearchSource,\n  provideStoredQueriesReverseSearchSource\n} from '@igo2/geo';\n\nimport { IgoAppSearchModule } from '@igo2/integration';\n\nimport { AppSearchComponent } from './search.component';\nimport { AppSearchRoutingModule } from './search-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppSearchComponent],\n  imports: [\n    SharedModule,\n    AppSearchRoutingModule,\n    IgoMessageModule.forRoot(),\n    IgoPanelModule,\n    IgoMapModule,\n    IgoSearchModule.forRoot(),\n    IgoAppSearchModule,\n    IgoActionbarModule,\n    IgoContextMenuModule,\n    IgoFeatureModule\n  ],\n  exports: [AppSearchComponent],\n  providers: [\n    provideCoordinatesReverseSearchSource(),\n    provideCadastreSearchSource(),\n    provideIChercheSearchSource(),\n    provideWorkspaceSearchSource(),\n    provideILayerSearchSource(),\n    provideNominatimSearchSource(),\n    provideIChercheReverseSearchSource(),\n    provideStoredQueriesSearchSource(),\n    provideStoredQueriesReverseSearchSource()\n  ]\n})\nexport class AppSearchModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppPrintComponent } from './print.component';\n\nconst routes: Routes = [\n  {\n    path: 'print',\n    component: AppPrintComponent\n  }\n];\n\nexport const AppPrintRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { IgoMap, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-print',\n  templateUrl: './print.component.html',\n  styleUrls: ['./print.component.scss']\n})\nexport class AppPrintComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: false\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 9\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private layerService: LayerService\n  ) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'Quebec Base Map',\n        sourceOptions: {\n          type: 'wmts',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts',\n          layer: 'carte_gouv_qc_ro',\n          matrixSet: 'EPSG_3857',\n          version: '1.3.0',\n          crossOrigin: 'anonymous',\n          attributions:\n            \"© <a href='http://www.droitauteur.gouv.qc.ca/copyright.php' target='_blank'><img src='https://geoegl.msp.gouv.qc.ca/gouvouvert/public/images/quebec/gouv_qc_logo.png' width='64' height='14'>Gouvernement du Québec</a> / <a href='https://www.igouverte.org/' target='_blank'>IGO2</a>\"\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'School board',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          params: {\n            LAYERS: 'MELS_CS_ANGLO_S',\n            VERSION: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n    //\n    this.layerService\n      .createAsyncLayer({\n        title: 'Embacle',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          params: {\n            LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n            VERSION: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n\n    // this.layerService\n    //   .createAsyncLayer({\n    //     title: 'Geomet',\n    //     sourceOptions: {\n    //       type: 'wms',\n    //       url: 'http://geo.weather.gc.ca/geomet/?lang=fr',\n    //       params: {\n    //         LAYERS: 'RADAR_1KM_RDBR',\n    //         VERSION: '1.3.0'\n    //       },\n    //       crossOrigin: 'anonymous'\n    //     }\n    //   })\n    //   .subscribe(l => this.map.addLayer(l));\n\n    /*\n        //CORS error if activate (for test)\n        this.layerService\n          .createAsyncLayer({\n            title: 'Geomet',\n            sourceOptions: {\n              type: 'wms',\n              url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wms',\n              params: {\n                layers: 'swtq',\n                version: '1.3.0',\n              }\n            }\n          })\n          .subscribe(l => this.map.addLayer(l));\n    */\n  }\n}\n","<app-doc-viewer\n  title=\"Print\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/print\">\n    <mat-grid-list cols=\"2\" rowHeight=\"800px\" gutterSize=\"16px\">\n      <mat-grid-tile\n        ><igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n          <igo-geolocate-button\n            [map]=\"map\"\n            color=\"primary\"\n          ></igo-geolocate-button>\n          <igo-home-extent-button\n            [map]=\"map\"\n            color=\"primary\"\n          ></igo-home-extent-button>\n          <igo-rotation-button\n            [map]=\"map\"\n            [showIfNoRotation]=\"false\"\n            color=\"primary\"\n          ></igo-rotation-button> </igo-map-browser\n      ></mat-grid-tile>\n      <mat-grid-tile> <igo-print [map]=\"map\"></igo-print></mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport { IgoMapModule, IgoPrintModule } from '@igo2/geo';\n\nimport { AppPrintComponent } from './print.component';\nimport { AppPrintRoutingModule } from './print-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppPrintComponent],\n  imports: [\n    SharedModule,\n    AppPrintRoutingModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoPrintModule\n  ],\n  exports: [AppPrintComponent]\n})\nexport class AppPrintModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppImportExportComponent } from './import-export.component';\n\nconst routes: Routes = [\n  {\n    path: 'import-export',\n    component: AppImportExportComponent\n  }\n];\n\nexport const AppImportExportRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { IgoMap, LayerService } from '@igo2/geo';\nimport { WorkspaceStore } from '@igo2/common';\n\n@Component({\n  selector: 'app-import-export',\n  templateUrl: './import-export.component.html',\n  styleUrls: ['./import-export.component.scss']\n})\nexport class AppImportExportComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 9\n  };\n\n  public store = new WorkspaceStore([]);\n\n  constructor(\n    private languageService: LanguageService,\n    private layerService: LayerService\n  ) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n  }\n}\n","<app-doc-viewer\n  title=\"Import / Export\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/import-export\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100\">\n          <igo-import-export\n            class=\"w-100\"\n            [store]=\"store\"\n            [map]=\"map\"\n          ></igo-import-export>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport {\n  IgoMapModule,\n  IgoImportExportModule,\n  provideStyleListOptions,\n  IgoStyleModule\n} from '@igo2/geo';\n\nimport { AppImportExportComponent } from './import-export.component';\nimport { AppImportExportRoutingModule } from './import-export-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppImportExportComponent],\n  imports: [\n    AppImportExportRoutingModule,\n    SharedModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoStyleModule,\n    IgoImportExportModule\n  ],\n  exports: [AppImportExportComponent],\n  providers: [\n    provideStyleListOptions({\n      path: './assets/import-style.json'\n    })\n  ]\n})\nexport class AppImportExport {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppDirectionsComponent } from './directions.component';\n\nconst routes: Routes = [\n  {\n    path: 'directions',\n    component: AppDirectionsComponent\n  }\n];\n\nexport const AppDirectionsRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  LayerService,\n  MapService,\n  ProjectionService,\n  StopsStore,\n  StopsFeatureStore,\n  RoutesFeatureStore,\n  StepFeatureStore\n} from '@igo2/geo';\nimport { Subject } from 'rxjs';\n\n@Component({\n  selector: 'app-directions',\n  templateUrl: './directions.component.html',\n  styleUrls: ['./directions.component.scss']\n})\nexport class AppDirectionsComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 9,\n    geolocate: false\n  };\n\n  public stopsStore: StopsStore = new StopsStore([]);\n  public stopsFeatureStore: StopsFeatureStore = new StopsFeatureStore([], {\n    map: this.map\n  });\n  public stepFeatureStore: StepFeatureStore = new StepFeatureStore([], {\n    map: this.map\n  });\n  public routesFeatureStore: RoutesFeatureStore = new RoutesFeatureStore([], {\n    map: this.map\n  });\n  public zoomToActiveRoute$: Subject<void> = new Subject();\n\n  constructor(\n    private projectionService: ProjectionService,\n    private languageService: LanguageService,\n    private layerService: LayerService,\n    private mapService: MapService\n  ) {\n    this.mapService.setMap(this.map);\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe((l) => this.map.addLayer(l));\n  }\n}\n","<app-doc-viewer\n  title=\"Directions\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/directions\">\n    <mat-grid-list cols=\"2\" rowHeight=\"600px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n          <igo-geolocate-button\n            [map]=\"map\"\n            color=\"primary\"\n          ></igo-geolocate-button>\n          <igo-home-extent-button\n            [map]=\"map\"\n            color=\"primary\"\n          ></igo-home-extent-button>\n          <igo-rotation-button\n            [map]=\"map\"\n            [showIfNoRotation]=\"false\"\n            color=\"primary\"\n          ></igo-rotation-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100 overflow-y-auto\">\n          <igo-directions\n            class=\"w-100\"\n            [stopsStore]=\"stopsStore\"\n            [stopsFeatureStore]=\"stopsFeatureStore\"\n            [stepFeatureStore]=\"stepFeatureStore\"\n            [routesFeatureStore]=\"routesFeatureStore\"\n            [zoomToActiveRoute$]=\"zoomToActiveRoute$\"\n          >\n          </igo-directions>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport {\n  IgoMapModule,\n  IgoDirectionsModule,\n  provideOsrmDirectionsSource\n} from '@igo2/geo';\n\nimport { AppDirectionsComponent } from './directions.component';\nimport { AppDirectionsRoutingModule } from './directions-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppDirectionsComponent],\n  imports: [\n    AppDirectionsRoutingModule,\n    SharedModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoDirectionsModule\n  ],\n  exports: [AppDirectionsComponent],\n  providers: [provideOsrmDirectionsSource()]\n})\nexport class AppDirectionsModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppTimeFilterComponent } from './time-filter.component';\n\nconst routes: Routes = [\n  {\n    path: 'time-filter',\n    component: AppTimeFilterComponent\n  }\n];\n\nexport const AppTimeFilterRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  TimeFilterableDataSourceOptions,\n  TimeFilterType,\n  TimeFilterStyle\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-time-filter',\n  templateUrl: './time-filter.component.html',\n  styleUrls: ['./time-filter.component.scss']\n})\nexport class AppTimeFilterComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    // const datasource: TimeFilterableDataSourceOptions = {\n    //   type: 'wms',\n    //   url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\n    //   params: {\n    //     layers: 'vg_observation_v_inondation_embacle_wmst',\n    //     version: '1.3.0'\n    //   },\n    //   timeFilterable: true,\n    //   timeFilter: {\n    //     min: '2017-01-01',\n    //     max: '2018-01-01',\n    //     range: true,\n    //     type: TimeFilterType.DATETIME,\n    //     style: TimeFilterStyle.SLIDER,\n    //     step: 86400000,\n    //     timeInterval: 2000\n    //   }\n    // };\n\n    const datasourceYear: TimeFilterableDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      },\n      timeFilterable: true,\n      timeFilter: {\n        min: '2013',\n        max: '2019',\n        range: false,\n        type: TimeFilterType.YEAR,\n        style: TimeFilterStyle.SLIDER,\n        step: 1,\n        timeInterval: 2000\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceYear)\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle YEAR',\n            visible: true,\n            source: dataSource\n          })\n        );\n      });\n  }\n}\n","<app-doc-viewer\n  title=\"Time filter\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/time-filter\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100\">\n          <igo-panel title=\"Layers\" class=\"w-100\">\n            <igo-time-filter-list [layers]=\"map.layers\"></igo-time-filter-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoFilterModule } from '@igo2/geo';\n\nimport { AppTimeFilterComponent } from './time-filter.component';\nimport { AppTimeFilterRoutingModule } from './time-filter-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppTimeFilterComponent],\n  imports: [\n    AppTimeFilterRoutingModule,\n    SharedModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoFilterModule\n  ],\n  exports: [AppTimeFilterComponent]\n})\nexport class AppTimeFilterModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppOgcFilterComponent } from './ogc-filter.component';\n\nconst routes: Routes = [\n  {\n    path: 'ogc-filter',\n    component: AppOgcFilterComponent\n  }\n];\n\nexport const AppOgcFilterRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WMSDataSourceOptions,\n  WFSDataSourceOptions,\n  WFSDataSourceOptionsParams,\n  OgcFilterableDataSourceOptions,\n  AnyBaseOgcFilterOptions,\n  OgcFilterOperatorType,\n  OgcFilterDuringOptions\n} from '@igo2/geo';\n\nimport { Fill, Stroke, Circle, Style } from 'ol/style';\n\n@Component({\n  selector: 'app-ogc-filter',\n  templateUrl: './ogc-filter.component.html',\n  styleUrls: ['./ogc-filter.component.scss']\n})\nexport class AppOgcFilterComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const datasource: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'code_municipalite', alias: '# de la municipalitée' },\n        { name: 'date_observation', excludeFromOgcFilters: true },\n        { name: 'urgence', values: ['immédiate', 'inconnue'] }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          logical: 'Or',\n          filters: [\n            {\n              operator: 'PropertyIsEqualTo',\n              propertyName: 'code_municipalite',\n              expression: '10043'\n            },\n            {\n              operator: 'Intersects',\n              geometryName: 'the_geom',\n              wkt_geometry: `MULTIPOLYGON(((\n              -8379441.158019895 5844447.897707146,\n              -8379441.158019895 5936172.331649357,\n              -8134842.66750733 5936172.331649357,\n              -8134842.66750733 5844447.897707146,\n              -8379441.158019895 5844447.897707146\n            ), (\n              -8015003 5942074,\n              -8015003 5780349,\n              -7792364 5780349,\n              -7792364 5942074,\n              -8015003 5942074\n            )))`\n            }\n          ] as AnyBaseOgcFilterOptions[]\n        }\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (PropertyIsEqualTo OR Intersects)',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'orange',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilter: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2016-01-21T00:00:00-05:00',\n          end: '2016-01-26T00:00:00-05:00'\n        } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2016-02-10T00:00:00-05:00',\n      stepDate: 'P2D'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilter)\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, Step: P2D)',\n            id: '1',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'red',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTime: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2016-01-01T04:00:00-05:00',\n          end: '2016-01-12T16:00:00-05:00'\n        } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2016-02-14T20:00:00-05:00',\n      stepDate: 'PT4H'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTime)\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, Step: PT4H)',\n            id: '2',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'blue',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeMonth: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2016-01-01T00:00:00-05:00',\n          end: '2016-03-31T00:00:00-05:00',\n          displayFormat: 'MMMM'\n        } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2018-12-31T00:00:00-05:00',\n      stepDate: 'P1M'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeMonth)\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, Step: P1M)',\n            id: '3',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'yellow',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeYear: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2014-01-01T00:00:00-05:00',\n          end: '2019-12-31T00:00:00-05:00',\n          sliderOptions: {\n            interval: 2000,\n            displayFormat: 'YY'\n          },\n          displayFormat: 'YYYY'\n        } as OgcFilterDuringOptions\n      },\n      minDate: '2014-01-01T00:00:00-05:00',\n      maxDate: '2019-12-31T00:00:00-05:00',\n      stepDate: 'P1Y'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeYear)\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, Step: P1Y)',\n            id: '4',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'green',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeInterval: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: 'today - 2 days', // \"now\" can also be used. Instead of midnight, the current time will be used\n          end: 'today' // \"now\" can also be used. Instead of midnight, the current time will be used\n        } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2025-12-31T00:00:00-05:00',\n      stepDate: 'P1D'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeInterval)\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, Interval from Now, Step: P1D)',\n            id: '5',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'black',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeRestrictedToStep: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation',\n          begin: '2019-01-01 00:00:00',\n          restrictToStep: true\n        } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2025-12-31T00:00:00-05:00',\n      stepDate: 'P1M'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeRestrictedToStep)\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, RestrictToStep, Step: P1M)',\n            id: '6',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'black'\n                }),\n                stroke: new Stroke({\n                  color: 'red',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const wmsOgcFilterOptions: WMSoptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      optionsFromCapabilities: true,\n      params: {\n        LAYERS: 'vg_observation_v_inondation23avril2017_wmst',\n        VERSION: '1.3.0'\n      },\n      sourceFields: [\n        {\n          name: 'date_observation',\n          alias: \"Date de l'observation\",\n          allowedOperatorsType: 'Time' as OgcFilterOperatorType\n        }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'During',\n          propertyName: 'date_observation'\n        } as OgcFilterDuringOptions,\n        allowedOperatorsType: OgcFilterOperatorType.Time\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wmsOgcFilterOptions)\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Inondation (During, optionsFromCapabilities)',\n            source: dataSource\n          })\n        );\n      });\n\n    interface WMSoptions\n      extends WMSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const filterableWMSwithPushButtons: WMSoptions = {\n      type: 'wms',\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      params: {\n        LAYERS: 'radars_photos',\n        VERSION: '1.3.0'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        pushButtons: {\n          selectorType: 'pushButton',\n          order: 2,\n          groups: [\n            { title: 'Nom du group1 - push', name: '1 - push', ids: ['id1'] }\n          ],\n          bundles: [\n            {\n              id: 'id1',\n              title: 'Régions',\n              logical: 'Or',\n              vertical: true,\n              selectors: [\n                {\n                  title: 'Montréal & Laval',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    logical: 'Or',\n                    filters: [\n                      {\n                        operator: 'PropertyIsEqualTo',\n                        propertyName: 'region',\n                        expression: 'Montréal'\n                      },\n                      {\n                        operator: 'PropertyIsEqualTo',\n                        propertyName: 'region',\n                        expression: 'Laval'\n                      }\n                    ]\n                  }\n                },\n                {\n                  title: 'Outside Montréal & Laval',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    logical: 'And',\n                    filters: [\n                      {\n                        operator: 'PropertyIsNotEqualTo',\n                        propertyName: 'region',\n                        expression: 'Montréal'\n                      },\n                      {\n                        operator: 'PropertyIsNotEqualTo',\n                        propertyName: 'region',\n                        expression: 'Laval'\n                      }\n                    ]\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        checkboxes: {\n          selectorType: 'checkbox',\n          order: 1,\n          groups: [\n            {\n              title: 'Nom du group1 - checkbox',\n              name: '1 - checkbox',\n              ids: ['id1']\n            }\n          ],\n          bundles: [\n            {\n              id: 'id1',\n              title: 'Type de radar photo',\n              logical: 'Or',\n              selectors: [\n                {\n                  title: 'Radar photo fixe',\n                  enabled: true,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo fixe'\n                  }\n                },\n                {\n                  title: 'Radar photo mobile',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo mobile'\n                  }\n                },\n                {\n                  title: 'Radar photo fixe + feu rouge',\n                  enabled: false,\n                  color: '0,200,0',\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo fixe et surveillance au feu rouge'\n                  }\n                },\n                {\n                  title: 'Radar feu rouge',\n                  enabled: false,\n                  color: '255,0,0',\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Appareil de surveillance au feu rouge'\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        allowedOperatorsType: OgcFilterOperatorType.Basic\n      },\n      paramsWFS: {\n        featureTypes: 'radars_photos',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '1.1.0',\n        outputFormat: 'geojson',\n        outputFormatDownload: 'shp'\n      } as WFSDataSourceOptionsParams\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(filterableWMSwithPushButtons)\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title:\n              'Filterable WMS layers with predefined filters (push buttons)',\n            source: dataSource\n          })\n        );\n      });\n\n    // const datasourceWmsWith2Layers: WMSoptions = {\n    //   type: 'wms',\n    //   url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n    //   urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n    //   params: {\n    //     layers: 'stations_meteoroutieres,histo_stations_meteoroutieres',\n    //     version: '1.3.0'\n    //   },\n    //   ogcFilters: {\n    //     enabled: true,\n    //     editable: true\n    //   },\n    //   paramsWFS: {\n    //     featureTypes: 'histo_stations_meteoroutieres',\n    //     fieldNameGeometry: 'geometry',\n    //     maxFeatures: 10000,\n    //     version: '1.1.0',\n    //     outputFormat: 'geojson',\n    //     outputFormatDownload: 'shp'\n    //   } as WFSDataSourceOptionsParams\n    // };\n    //\n    // this.dataSourceService\n    //   .createAsyncDataSource(datasourceWmsWith2Layers)\n    //   .subscribe(dataSource => {\n    //     this.map.addLayer(\n    //       this.layerService.createLayer({\n    //         title: 'Layer build from 2 WMS layers',\n    //         source: dataSource\n    //       })\n    //     );\n    //   });\n\n    // const datasourceWms: WMSoptions = {\n    //   type: 'wms',\n    //   url: '/geoserver/wms',\n    //   urlWfs: '/geoserver/wfs',\n    //   params: {\n    //     LAYERS: 'water_areas',\n    //     VERSION: '1.3.0'\n    //   },\n    //   ogcFilters: {\n    //     enabled: true,\n    //     editable: true,\n    //     filters: {\n    //       operator: 'PropertyIsEqualTo',\n    //       propertyName: 'waterway',\n    //       expression: 'riverbank'\n    //     }\n    //   },\n    //   sourceFields: [\n    //     { name: 'waterway', alias: 'Chemin d eau' },\n    //     { name: 'osm_id' },\n    //     { name: 'landuse', values: ['yes', 'no'] }\n    //   ],\n    //   paramsWFS: {\n    //     featureTypes: 'water_areas',\n    //     fieldNameGeometry: 'the_geom',\n    //     maxFeatures: 10000,\n    //     version: '1.1.0',\n    //     outputFormat: 'application/json',\n    //     outputFormatDownload: 'application/vnd.google-earth.kml+xml'\n    //   } as WFSDataSourceOptionsParams\n    // };\n    //\n    // this.dataSourceService\n    //   .createAsyncDataSource(datasourceWms)\n    //   .subscribe(dataSource => {\n    //     this.map.addLayer(\n    //       this.layerService.createLayer({\n    //         title: 'Geoserver water_areas',\n    //         source: dataSource\n    //       })\n    //     );\n    //   });\n  }\n}\n","<app-doc-viewer\n  title=\"Ogc filter\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/ogc-filter\">\n    <mat-grid-list cols=\"2\" rowHeight=\"600px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser [map]=\"map\" [view]=\"view\">\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex align-start h-100 w-100 overflow-y-auto\">\n          <igo-panel title=\"Layers\">\n            <igo-ogc-filterable-list [map]=\"map\" [layers]=\"map.layers\">\n            </igo-ogc-filterable-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { NgModule } from '@angular/core';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoFilterModule } from '@igo2/geo';\n\nimport { AppOgcFilterComponent } from './ogc-filter.component';\nimport { AppOgcFilterRoutingModule } from './ogc-filter-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppOgcFilterComponent],\n  imports: [\n    AppOgcFilterRoutingModule,\n    SharedModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoFilterModule\n  ],\n  exports: [AppOgcFilterComponent]\n})\nexport class AppOgcFilterModule {}\n","<app-doc-viewer\n  title=\"Spatial Filter\"\n  subtitle=\"Geo\"\n  [dependencies]=\"['LanguageService']\"\n>\n  <app-example-viewer codeFolder=\"geo/spatial-filter\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser\n          [map]=\"map\"\n          [view]=\"view\"\n          igoOverlay\n          igoQuery\n          [queryFeatures]=\"true\"\n        >\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex flex-col align-start h-100 w-100 overflow-y-auto\">\n          <igo-panel class=\"w-100\">\n            <igo-spatial-filter-type\n              [store]=\"spatialListStore\"\n              [selectedQueryType]=\"queryType\"\n              [zone]=\"zone\"\n              [layers]=\"activeLayers\"\n              (eventType)=\"getOutputType($event)\"\n              (eventQueryType)=\"getOutputQueryType($event)\"\n              (zoneChange)=\"onZoneChange($event)\"\n              (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n              (bufferChange)=\"buffer = $event\"\n              (measureUnitChange)=\"measureUnit = $event\"\n            >\n            </igo-spatial-filter-type>\n\n            <igo-spatial-filter-item\n              [type]=\"type\"\n              [queryType]=\"queryType\"\n              [map]=\"map\"\n              [zone]=\"zone\"\n              [loading]=\"loading\"\n              [store]=\"store\"\n              [layers]=\"activeLayers\"\n              [allLayers]=\"layers\"\n              [thematicLength]=\"thematicLength\"\n              (radiusEvent)=\"buffer = $event\"\n              (bufferEvent)=\"buffer = $event\"\n              (measureUnitChange)=\"measureUnit = $event\"\n              (freehandControl)=\"freehandDrawIsActive = $event\"\n              (drawZoneEvent)=\"zone = $event\"\n              (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n              (itemTypeChange)=\"itemType = $event\"\n              (thematicChange)=\"thematics = $event\"\n              (toggleSearch)=\"getOutputToggleSearch()\"\n              (clearButtonEvent)=\"clearMap()\"\n              (clearSearchEvent)=\"getOutputClearSearch()\"\n            >\n            </igo-spatial-filter-item>\n          </igo-panel>\n\n          <igo-panel class=\"w-100\">\n            <ng-container *ngIf=\"selectedFeature$ | async as feature\">\n              <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n            </ng-container>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppSpatialFilterComponent } from './spatial-filter.component';\n\nconst routes: Routes = [\n  {\n    path: 'spatial-filter',\n    component: AppSpatialFilterComponent\n  }\n];\n\nexport const AppSpatialFilterRoutingModule = RouterModule.forChild(routes);\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MatIconRegistry } from '@angular/material/icon';\nimport { Observable, forkJoin, Subject } from 'rxjs';\nimport { tap, take, takeUntil } from 'rxjs/operators';\n\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  Feature,\n  moveToOlFeatures,\n  FeatureMotion,\n  ClusterDataSource,\n  featureToOl,\n  DataSource,\n  QueryableDataSourceOptions,\n  SpatialFilterService,\n  SpatialFilterType,\n  SpatialFilterItemType,\n  SpatialFilterQueryType,\n  SpatialFilterThematic,\n  Layer,\n  VectorLayer,\n  createOverlayMarkerStyle,\n  MeasureLengthUnit\n} from '@igo2/geo';\nimport { EntityStore, EntityStoreWithStrategy } from '@igo2/common';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\nimport olSourceVector from 'ol/source/Vector';\nimport olSourceCluster from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { BehaviorSubject } from 'rxjs';\nimport * as olstyle from 'ol/style';\nimport { MessageService, LanguageService } from '@igo2/core';\n\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'app-spatial-filter',\n  templateUrl: './spatial-filter.component.html',\n  styleUrls: ['./spatial-filter.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSpatialFilterComponent implements OnInit, OnDestroy {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  @Input() type: SpatialFilterType;\n  @Input() itemType: SpatialFilterItemType = SpatialFilterItemType.Address;\n  @Input() freehandDrawIsActive: boolean;\n\n  public layers: Layer[] = [];\n  public activeLayers: Layer[] = [];\n\n  public queryType: SpatialFilterQueryType;\n  public thematics: SpatialFilterThematic[];\n  public zone: Feature;\n  public zoneWithBuffer: Feature;\n  public buffer = 0;\n\n  public iterator = 1;\n\n  public selectedFeature$: BehaviorSubject<Feature> = new BehaviorSubject(\n    undefined\n  );\n\n  private format = new olFormatGeoJSON();\n\n  public store = new EntityStoreWithStrategy<Feature>([]); // Store to print results at the end\n\n  public spatialListStore: EntityStore<Feature> = new EntityStore<Feature>([]);\n\n  public loading = false;\n\n  public thematicLength = 0;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  private unsubscribe$ = new Subject<void>();\n\n  public defaultStyle: olstyle.Style | ((feature, resolution) => olstyle.Style);\n\n  constructor(\n    private matIconRegistry: MatIconRegistry,\n    private spatialFilterService: SpatialFilterService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n\n  ngOnInit() {\n    for (const layer of this.map.layers) {\n      if (\n        layer.title &&\n        layer.title.includes(\n          this.languageService.translate.instant(\n            'igo.geo.spatialFilter.spatialFilter'\n          )\n        )\n      ) {\n        this.layers.push(layer);\n      }\n    }\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  getOutputType(event: SpatialFilterType) {\n    this.type = event;\n    this.queryType = undefined;\n  }\n\n  getOutputQueryType(event: SpatialFilterQueryType) {\n    this.queryType = event;\n    if (this.queryType) {\n      this.loadFilterList();\n    }\n  }\n\n  private loadFilterList() {\n    this.spatialFilterService\n      .loadFilterList(this.queryType)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((features: Feature[]) => {\n        features.sort((a, b) => {\n          if (a.properties.nom < b.properties.nom) {\n            return -1;\n          }\n          if (a.properties.nom > b.properties.nom) {\n            return 1;\n          }\n          return 0;\n        });\n        this.spatialListStore.clear();\n        this.spatialListStore.load(features);\n      });\n  }\n\n  getOutputToggleSearch() {\n    this.loadThematics();\n  }\n\n  getOutputClearSearch() {\n    this.zone = undefined;\n    this.queryType = undefined;\n  }\n\n  clearMap() {\n    this.map.removeLayers(this.layers);\n    this.layers = [];\n    this.activeLayers = [];\n    this.thematicLength = 0;\n    this.iterator = 1;\n    if (this.type === SpatialFilterType.Predefined) {\n      this.zone = undefined;\n      this.queryType = undefined;\n    }\n  }\n\n  private loadThematics() {\n    this.loading = true;\n    let zeroResults = true;\n    let thematics;\n    if (this.buffer === 0 || this.type === SpatialFilterType.Point) {\n      this.tryAddFeaturesToMap([this.zone]);\n    }\n    if (this.itemType !== SpatialFilterItemType.Thematics) {\n      const theme: SpatialFilterThematic = {\n        name: ''\n      };\n      thematics = [theme];\n    } else {\n      thematics = this.thematics;\n    }\n    if (\n      this.measureUnit === MeasureLengthUnit.Kilometers &&\n      this.type !== SpatialFilterType.Point\n    ) {\n      this.buffer = this.buffer * 1000;\n    }\n    if (this.type === SpatialFilterType.Polygon) {\n      this.buffer = 0; // to avoid buffer enter a second time in terrAPI\n    }\n\n    const observables$: Observable<Feature[]>[] = [];\n    thematics.forEach((thematic) => {\n      observables$.push(\n        this.spatialFilterService\n          .loadFilterItem(\n            this.zone,\n            this.itemType,\n            this.queryType,\n            thematic,\n            this.buffer\n          )\n          .pipe(\n            tap((features: Feature[]) => {\n              this.store.insertMany(features);\n              const featuresPoint: Feature[] = [];\n              const featuresLinePoly: Feature[] = [];\n              let idPoint;\n              let idLinePoly;\n              features.forEach((feature) => {\n                if (feature.geometry.type === 'Point') {\n                  feature.properties.longitude =\n                    feature.geometry.coordinates[0];\n                  feature.properties.latitude = feature.geometry.coordinates[1];\n                  featuresPoint.push(feature);\n                  idPoint = feature.meta.id;\n                } else {\n                  featuresLinePoly.push(feature);\n                  idLinePoly = feature.meta.id;\n                }\n              });\n\n              this.tryAddPointToMap(featuresPoint, idPoint);\n              this.tryAddLayerToMap(featuresLinePoly, idLinePoly);\n              if (features.length) {\n                zeroResults = false;\n                this.thematicLength += 1;\n                thematic.zeroResults = false;\n                this.cdRef.detectChanges();\n              } else {\n                thematic.zeroResults = true;\n              }\n\n              if (features.length >= 10000) {\n                this.messageService.alert(\n                  'igo.geo.spatialFilter.maxSizeAlert',\n                  'igo.geo.spatialFilter.warning',\n                  { timeOut: 10000 }\n                );\n              }\n            })\n          )\n      );\n    });\n\n    forkJoin(observables$)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe(() => {\n        this.loading = false;\n        if (zeroResults) {\n          this.messageService.alert(\n            'igo.geo.spatialFilter.zeroResults',\n            'igo.geo.spatialFilter.warning',\n            { timeOut: 10000 }\n          );\n        }\n      });\n  }\n\n  onZoneChange(feature: Feature, buffer?: boolean) {\n    this.zone = feature;\n    if (feature) {\n      buffer\n        ? this.tryAddFeaturesToMap([feature], true)\n        : this.tryAddFeaturesToMap([feature]);\n      this.zoomToFeatureExtent(feature);\n    }\n  }\n\n  /**\n   * Try to add zone feature to the map overlay\n   */\n  public tryAddFeaturesToMap(features: Feature[], buffer?: boolean) {\n    let i = 1;\n    for (const feature of features) {\n      if (this.type === SpatialFilterType.Predefined) {\n        for (const layer of this.layers) {\n          if (\n            layer.options._internal &&\n            layer.options._internal.code === feature.properties.code &&\n            !buffer\n          ) {\n            if (!layer.title?.startsWith('Zone')) {\n              const index = this.layers.indexOf(layer);\n              this.layers.splice(index, 1);\n            }\n            return;\n          }\n          if (layer.title?.startsWith('Zone')) {\n            this.activeLayers = [];\n            const index = this.layers.indexOf(layer);\n            this.layers.splice(index, 1);\n            this.map.removeLayer(layer);\n          }\n        }\n      } else {\n        if (buffer) {\n          for (const layer of this.activeLayers) {\n            if (\n              this.activeLayers.length === 1 &&\n              layer.title?.startsWith('Zone')\n            ) {\n              const index = this.layers.indexOf(layer);\n              this.layers.splice(index, 1);\n              this.map.removeLayer(layer);\n            }\n          }\n        }\n        this.activeLayers = [];\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith('Zone')) {\n          i++;\n        }\n      }\n      this.defaultStyle = (_feature, resolution) => {\n        const coordinates = (features[0] as any).coordinates;\n        return new olstyle.Style({\n          image: new olstyle.Circle({\n            radius: coordinates\n              ? this.buffer /\n                Math.cos((Math.PI / 180) * coordinates[1]) /\n                resolution\n              : undefined,\n            fill: new olstyle.Fill({\n              color: 'rgba(200, 200, 20, 0.2)'\n            }),\n            stroke: new olstyle.Stroke({\n              width: 1,\n              color: 'orange'\n            })\n          }),\n          stroke: new olstyle.Stroke({\n            width: 1,\n            color: 'orange'\n          }),\n          fill: new olstyle.Fill({\n            color: 'rgba(200, 200, 20, 0.2)'\n          })\n        });\n      };\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: DataSource) => {\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: ('Zone ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string,\n            workspace: { enabled: true },\n            _internal: {\n              code:\n                this.type === SpatialFilterType.Predefined\n                  ? feature.properties.code\n                  : undefined\n            },\n            source: dataSource,\n            visible: true\n          }) as VectorLayer;\n          const featuresOl = features.map((f) => {\n            return featureToOl(f, this.map.projection);\n          });\n          if (this.type !== SpatialFilterType.Predefined) {\n            const type =\n              this.type === SpatialFilterType.Point ? 'Cercle' : 'Polygone';\n            featuresOl[0].set('nom', 'Zone', true);\n            featuresOl[0].set('type', type, true);\n          }\n          const ol = dataSource.ol as\n            | olSourceVector<OlGeometry>\n            | olSourceCluster;\n          ol.addFeatures(featuresOl);\n          olLayer.ol.setStyle(this.defaultStyle);\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.activeLayers.push(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  /**\n   * Try to add point features to the map\n   * Necessary to create clusters\n   */\n  private tryAddPointToMap(features: Feature[], id) {\n    let i = 1;\n    if (features.length) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'cluster',\n          id,\n          queryable: true,\n          distance: 120,\n          meta: {\n            title: 'Cluster'\n          }\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: ClusterDataSource) => {\n          const icon = features[0].meta.icon;\n          let style: olstyle.Style;\n          if (!icon) {\n            style = createOverlayMarkerStyle();\n          } else {\n            style = this.createSvgIcon(icon) || createOverlayMarkerStyle();\n          }\n\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string,\n            source: dataSource,\n            visible: true,\n            style\n          });\n\n          const featuresOl = features.map((feature) => {\n            return featureToOl(feature, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceCluster;\n          ol.getSource().addFeatures(featuresOl);\n          if (this.layers.find((layer) => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.layers.find((layer) => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.iterator = i;\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.pushLayer(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  private createSvgIcon(icon): olstyle.Style {\n    let style: olstyle.Style;\n    this.matIconRegistry.getNamedSvgIcon(icon).subscribe((svgObj) => {\n      const xmlSerializer = new XMLSerializer();\n      svgObj.setAttribute('width', '30');\n      svgObj.setAttribute('height', '30');\n      svgObj.setAttribute('fill', 'rgba(0, 128, 255)');\n      svgObj.setAttribute('stroke', 'white');\n      const svg = xmlSerializer.serializeToString(svgObj);\n      style = new olstyle.Style({\n        image: new olstyle.Icon({\n          src: 'data:image/svg+xml;utf8,' + svg\n        })\n      });\n    });\n    return style;\n  }\n  /**\n   * Try to add line or polygon features to the map\n   */\n  private tryAddLayerToMap(features: Feature[], id) {\n    let i = 1;\n    if (features.length) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          id,\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: DataSource) => {\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string,\n            source: dataSource,\n            visible: true\n          });\n          const featuresOl = features.map((feature) => {\n            return featureToOl(feature, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceVector<OlGeometry>;\n          ol.addFeatures(featuresOl);\n          if (this.layers.find((layer) => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.layers.find((layer) => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title +\n              ' ' +\n              i +\n              ' - ' +\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.spatialFilter'\n              )) as string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.pushLayer(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  zoomToFeatureExtent(feature) {\n    if (feature) {\n      const olFeature = this.format.readFeature(feature, {\n        dataProjection: feature.projection,\n        featureProjection: this.map.projection\n      });\n      moveToOlFeatures(\n        this.map.viewController,\n        [olFeature],\n        FeatureMotion.Zoom\n      );\n    }\n  }\n\n  pushLayer(layer) {\n    for (const lay of this.activeLayers) {\n      if (lay.id === layer.id) {\n        return;\n      }\n    }\n\n    this.activeLayers.push(layer);\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { IgoPanelModule, IgoFormModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoFilterModule,\n  IgoQueryModule,\n  IgoFeatureModule,\n  IgoFeatureDetailsModule\n} from '@igo2/geo';\nimport { IgoMessageModule } from '@igo2/core';\n\nimport { AppSpatialFilterComponent } from './spatial-filter.component';\nimport { AppSpatialFilterRoutingModule } from './spatial-filter-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppSpatialFilterComponent],\n  imports: [\n    AppSpatialFilterRoutingModule,\n    SharedModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoMessageModule,\n    IgoQueryModule,\n    IgoFeatureModule,\n    IgoFeatureDetailsModule,\n    IgoFilterModule,\n    IgoFormModule\n  ],\n  exports: [AppSpatialFilterComponent]\n})\nexport class AppSpatialFilterModule {}\n","<app-doc-viewer title=\"Workspace\" subtitle=\"Geo\">\n  <app-example-viewer codeFolder=\"geo/workspace\">\n    <igo-map-browser [map]=\"map\" [view]=\"view\" class=\"m-b-16\">\n      <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    </igo-map-browser>\n\n    <igo-workspace-selector\n      igoWorkspaceSelector\n      [store]=\"workspaceStore\"\n      [map]=\"map\"\n    >\n    </igo-workspace-selector>\n\n    <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\n      <igo-entity-table-paginator\n        *ngIf=\"workspace.inResolutionRange$ | async\"\n        [store]=\"workspace.entityStore\"\n        [paginatorOptions]=\"paginatorOptions\"\n        [entitySortChange$]=\"entitySortChange$\"\n        (paginatorChange)=\"paginatorChange($event)\"\n      >\n      </igo-entity-table-paginator>\n    </ng-container>\n\n    <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\n      <igo-actionbar\n        *ngIf=\"workspace.actionStore\"\n        [store]=\"workspace.actionStore\"\n        [horizontal]=\"true\"\n        [withToggleButton]=\"true\"\n        [withTitle]=\"true\"\n        [mode]=\"actionbarMode\"\n      >\n      </igo-actionbar>\n\n      <igo-entity-table\n        *ngIf=\"\n          workspace.entityStore &&\n          workspace.meta &&\n          workspace.meta.tableTemplate &&\n          (workspace.inResolutionRange$ | async)\n        \"\n        class=\"table-compact table-centered\"\n        [paginator]=\"workspacePaginator\"\n        [scrollBehavior]=\"scrollBehavior\"\n        [store]=\"workspace.entityStore\"\n        [template]=\"workspace.meta.tableTemplate\"\n      >\n      </igo-entity-table>\n      <mat-card-content\n        *ngIf=\"(workspace.inResolutionRange$ | async) === false\"\n      >\n        No data available at this scale. Please zoom in.\n      </mat-card-content>\n\n      <igo-workspace-widget-outlet\n        [workspace]=\"workspace\"\n      ></igo-workspace-widget-outlet>\n    </ng-container>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppWorkspaceComponent } from './workspace.component';\n\nconst routes: Routes = [\n  {\n    path: 'workspace',\n    component: AppWorkspaceComponent\n  }\n];\n\nexport const AppWorkspaceRoutingModule = RouterModule.forChild(routes);\n","import { Component, OnInit } from '@angular/core';\n\nimport { Observable, BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  ActionbarMode,\n  EntityRecord,\n  EntityTableScrollBehavior,\n  Workspace,\n  WorkspaceStore,\n  EntityTablePaginatorOptions\n} from '@igo2/common';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WFSDataSourceOptions\n} from '@igo2/geo';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { WorkspaceState } from '@igo2/integration';\n\n@Component({\n  selector: 'app-workspace',\n  templateUrl: './workspace.component.html',\n  styleUrls: ['./workspace.component.scss']\n})\nexport class AppWorkspaceComponent implements OnInit {\n  public workspacePaginator: MatPaginator;\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public paginatorOptions: EntityTablePaginatorOptions = {\n    pageSize: 5, // Number of items to display on a page.\n    pageSizeOptions: [1, 5, 10, 15, 30, 50, 100], // The set of provided page size options to display to the user.\n    showFirstLastButtons: true // Whether to show the first/last buttons UI to the user.\n  };\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-72, 47.2],\n    zoom: 5\n  };\n\n  get workspaceStore(): WorkspaceStore {\n    return this.workspaceState.store;\n  }\n\n  public selectedWorkspace$: Observable<Workspace>;\n\n  public actionbarMode = ActionbarMode.Overlay;\n\n  public scrollBehavior = EntityTableScrollBehavior.Instant;\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    public workspaceState: WorkspaceState\n  ) {}\n\n  ngOnInit() {\n    this.selectedWorkspace$ = this.workspaceStore.stateView\n      .firstBy$(\n        (record: EntityRecord<Workspace>) => record.state.selected === true\n      )\n      .pipe(\n        map((record: EntityRecord<Workspace>) => {\n          const entity = record === undefined ? undefined : record.entity;\n          if (entity) {\n            // In fact, the download action is not fully functionnal into the igo2-lib demo\n            // The reason why it's has been remove is that this button trigger a tool (importExport)\n            // and this tool is not available in the igo2-lib demo.\n            // This is why it's has been removed frome the actions's list.\n            // Refer to the igo2 demo at https://infra-geo-ouverte.github.io/igo2/\n            entity.actionStore.view.filter((action) => {\n              return action.id !== 'wfsDownload';\n            });\n          }\n          return entity;\n        })\n      );\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe((dataSource) => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    const wfsDataSourceOptions: WFSDataSourceOptions = {\n      type: 'wfs',\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      params: {\n        featureTypes: 'etablissement_mtq',\n        fieldNameGeometry: 'geometry',\n        version: '2.0.0',\n        outputFormat: 'geojson'\n      },\n      sourceFields: [\n        { name: 'idetablis', alias: 'ID' },\n        { name: 'nometablis', alias: 'Name' },\n        { name: 'typetablis', alias: 'Type' }\n      ]\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDataSourceOptions)\n      .subscribe((dataSource) => {\n        const layer = {\n          title: 'Simple WFS ',\n          maxResolution: 3000,\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.workspacePaginator = event;\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport {\n  IgoActionModule,\n  IgoEntityModule,\n  IgoWorkspaceModule,\n  IgoPanelModule\n} from '@igo2/common';\nimport { IgoMapModule, IgoGeoWorkspaceModule } from '@igo2/geo';\n\nimport { AppWorkspaceComponent } from './workspace.component';\nimport { AppWorkspaceRoutingModule } from './workspace-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppWorkspaceComponent],\n  imports: [\n    SharedModule,\n    AppWorkspaceRoutingModule,\n    IgoActionModule,\n    IgoEntityModule,\n    IgoWorkspaceModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoGeoWorkspaceModule\n  ],\n  exports: [AppWorkspaceComponent]\n})\nexport class AppWorkspaceModule {}\n","<app-doc-viewer\n  title=\"Context\"\n  subtitle=\"Context\"\n  [dependencies]=\"['LanguageService', 'mapService']\"\n>\n  <app-example-viewer codeFolder=\"context/context\" configFolder=\"contexts\">\n    <mat-grid-list cols=\"2\" rowHeight=\"500px\" gutterSize=\"16px\">\n      <mat-grid-tile>\n        <igo-map-browser\n          igoMapContext\n          igoLayerContext\n          [map]=\"map\"\n          [view]=\"view\"\n        >\n          <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n          <igo-geolocate-button\n            [map]=\"map\"\n            color=\"primary\"\n          ></igo-geolocate-button>\n          <igo-home-extent-button\n            [map]=\"map\"\n            color=\"primary\"\n          ></igo-home-extent-button>\n          <igo-rotation-button\n            [map]=\"map\"\n            [showIfNoRotation]=\"true\"\n            color=\"primary\"\n          ></igo-rotation-button>\n        </igo-map-browser>\n      </mat-grid-tile>\n      <mat-grid-tile>\n        <div class=\"flex flex-col align-start h-100 w-100\">\n          <igo-panel title=\"Contexts list\" class=\"h-100 w-100\">\n            <igo-context-list\n              igoContextListBinding\n              [map]=\"map\"\n            ></igo-context-list>\n          </igo-panel>\n\n          <igo-panel title=\"Layers\" class=\"h-100 w-100\">\n            <igo-layer-list igoLayerListBinding [map]=\"map\">\n              <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n                <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n              </ng-template>\n            </igo-layer-list>\n          </igo-panel>\n        </div>\n      </mat-grid-tile>\n    </mat-grid-list>\n  </app-example-viewer>\n\n  <app-example-viewer\n    title=\"Import/Export context\"\n    codeFolder=\"context/context\"\n    configFolder=\"contexts\"\n  >\n    <igo-context-import-export [map]=\"map\"></igo-context-import-export>\n  </app-example-viewer>\n</app-doc-viewer>\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppContextComponent } from './context.component';\n\nconst routes: Routes = [\n  {\n    path: 'context',\n    component: AppContextComponent\n  }\n];\n\nexport const AppContextRoutingModule = RouterModule.forChild(routes);\n","import { Component } from '@angular/core';\nimport { ContextService } from '@igo2/context';\n\nimport { LanguageService } from '@igo2/core';\nimport { IgoMap, MapService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-context',\n  templateUrl: './context.component.html',\n  styleUrls: ['./context.component.scss']\n})\nexport class AppContextComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private mapService: MapService,\n    private contextService: ContextService\n  ) {\n    this.mapService.setMap(this.map);\n    this.contextService.loadDefaultContext();\n    this.contextService.loadContexts();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { HttpClientJsonpModule } from '@angular/common/http';\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoMetadataModule,\n  IgoOverlayModule,\n  IgoQueryModule,\n  IgoFeatureModule\n} from '@igo2/geo';\nimport { IgoContextModule } from '@igo2/context';\n\nimport { AppContextComponent } from './context.component';\nimport { AppContextRoutingModule } from './context-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [AppContextComponent],\n  imports: [\n    HttpClientJsonpModule,\n    AppContextRoutingModule,\n    SharedModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoMetadataModule,\n    IgoOverlayModule,\n    IgoQueryModule,\n    IgoFeatureModule,\n    IgoContextModule\n  ],\n  exports: [AppContextComponent]\n})\nexport class AppContextModule {}\n","import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\n\nconst routes: Routes = [\n  { path: '', redirectTo: '/home', pathMatch: 'full' },\n  { path: '**', redirectTo: '/home' }\n];\n\n@NgModule({\n  imports: [RouterModule.forRoot(routes, { useHash: true })],\n  exports: [RouterModule]\n})\nexport class AppRoutingModule {}\n","import { MediaMatcher } from '@angular/cdk/layout';\r\nimport {\r\n  OnInit,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  Inject,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { userAgent, DomUtils } from '@igo2/utils';\r\nimport { version } from '@igo2/core';\r\nimport { NavigationEnd, Router } from '@angular/router';\r\nimport { delay, first } from 'rxjs';\r\nimport { DOCUMENT } from '@angular/common';\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  templateUrl: './app.component.html',\r\n  styleUrls: ['./app.component.scss']\r\n})\r\nexport class AppComponent implements OnInit, OnDestroy {\r\n  mobileQuery: MediaQueryList;\r\n\r\n  public title = 'IGO';\r\n  public version = version;\r\n  private _mobileQueryListener: () => void;\r\n\r\n  constructor(\r\n    @Inject(DOCUMENT) private document: Document,\r\n    private changeDetectorRef: ChangeDetectorRef,\r\n    private media: MediaMatcher,\r\n    private router: Router\r\n  ) {\r\n    this.mobileQuery = this.media.matchMedia('(max-width: 600px)');\r\n    this._mobileQueryListener = () => this.changeDetectorRef.detectChanges();\r\n    this.mobileQuery.addEventListener('change', this._mobileQueryListener);\r\n\r\n    this.detectOldBrowser();\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.handleSplashScreen();\r\n  }\r\n\r\n  private handleSplashScreen(): void {\r\n    this.router.events\r\n      .pipe(\r\n        first((events) => events instanceof NavigationEnd),\r\n        delay(300)\r\n      )\r\n      .subscribe(() => {\r\n        this._removeSplashScreen();\r\n      });\r\n  }\r\n\r\n  private _removeSplashScreen(): void {\r\n    const intro = this.document.getElementById('splash-screen');\r\n    if (!intro) {\r\n      return;\r\n    }\r\n    intro.classList.add('is-destroying');\r\n\r\n    const destroyingAnimationTime = 300;\r\n    const stylesheet = this.document.getElementById('splash-screen-stylesheet');\r\n\r\n    setTimeout(() => {\r\n      DomUtils.remove(intro);\r\n      DomUtils.remove(stylesheet);\r\n    }, destroyingAnimationTime);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.mobileQuery.removeEventListener('change', this._mobileQueryListener);\r\n  }\r\n\r\n  private detectOldBrowser() {\r\n    const oldBrowser = userAgent.satisfies({\r\n      ie: '<=11',\r\n      chrome: '<64',\r\n      firefox: '<60'\r\n    });\r\n\r\n    if (oldBrowser) {\r\n      console.log('Very old browser ! ', userAgent.getBrowser());\r\n    }\r\n  }\r\n}\r\n","<div class=\"example-container\" [class.example-is-mobile]=\"mobileQuery.matches\">\n  <mat-toolbar color=\"primary\" class=\"example-toolbar mat-elevation-z6\">\n    <button mat-icon-button (click)=\"snav.toggle()\">\n      <mat-icon svgIcon=\"menu\"></mat-icon>\n    </button>\n    <h1>{{ title }}</h1>\n    <h5 class=\"mat-subtitle-1 m-b-0\">{{ version.lib }}</h5>\n  </mat-toolbar>\n\n  <mat-sidenav-container\n    class=\"example-sidenav-container\"\n    [style.marginTop.px]=\"mobileQuery.matches ? 56 : 0\"\n  >\n    <mat-sidenav\n      #snav\n      opened=\"true\"\n      [mode]=\"mobileQuery.matches ? 'over' : 'side'\"\n      [fixedInViewport]=\"mobileQuery.matches\"\n      fixedTopGap=\"56\"\n    >\n      <mat-nav-list>\n        <a mat-list-item routerLink=\".\">Home</a>\n\n        <hr />\n\n        <a mat-list-item routerLink=\"activity\">Activity</a>\n        <a mat-list-item routerLink=\"config\">Config</a>\n        <a mat-list-item routerLink=\"language\">Language</a>\n        <a mat-list-item routerLink=\"media\">Media</a>\n        <a mat-list-item routerLink=\"message\">Message</a>\n        <a mat-list-item routerLink=\"request\">Request</a>\n\n        <hr />\n\n        <a mat-list-item routerLink=\"auth-form\">Authentification</a>\n\n        <hr />\n\n        <a mat-list-item routerLink=\"action\">Action</a>\n        <a mat-list-item routerLink=\"dynamic-component\">Dynamic Component</a>\n        <a mat-list-item routerLink=\"entity-table\">Entity Table</a>\n        <a mat-list-item routerLink=\"entity-selector\">Entity Selector</a>\n        <a mat-list-item routerLink=\"form\">Form</a>\n        <a mat-list-item routerLink=\"table\">Table</a>\n        <a mat-list-item routerLink=\"tool\">Tool</a>\n        <a mat-list-item routerLink=\"widget\">Widget</a>\n\n        <hr />\n\n        <a mat-list-item routerLink=\"simple-map\">Simple map</a>\n        <a mat-list-item routerLink=\"layer\">Layer</a>\n        <a mat-list-item routerLink=\"legend\">Legend</a>\n        <a mat-list-item routerLink=\"overlay\">Overlay</a>\n        <a mat-list-item routerLink=\"geometry\">Geometry</a>\n        <a mat-list-item routerLink=\"feature\">Feature</a>\n        <a mat-list-item routerLink=\"hover\">Hover</a>\n        <a mat-list-item routerLink=\"measure\">Measure</a>\n        <a mat-list-item routerLink=\"draw\">Draw</a>\n        <a mat-list-item routerLink=\"query\">Query</a>\n        <a mat-list-item routerLink=\"catalog\">Catalog</a>\n        <a mat-list-item routerLink=\"search\">Search</a>\n        <a mat-list-item routerLink=\"print\">Print</a>\n        <a mat-list-item routerLink=\"import-export\">Import/Export</a>\n        <a mat-list-item routerLink=\"directions\">Directions</a>\n        <a mat-list-item routerLink=\"time-filter\">Time filter</a>\n        <a mat-list-item routerLink=\"ogc-filter\">OGC filter</a>\n        <a mat-list-item routerLink=\"spatial-filter\">Spatial filter</a>\n        <a mat-list-item routerLink=\"workspace\">Workspace</a>\n\n        <hr />\n\n        <a mat-list-item routerLink=\"context\">Context</a>\n      </mat-nav-list>\n    </mat-sidenav>\n\n    <mat-sidenav-content>\n      <router-outlet></router-outlet>\n    </mat-sidenav-content>\n  </mat-sidenav-container>\n</div>\n","import { BrowserModule, DomSanitizer } from '@angular/platform-browser';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\nimport {\n  APP_INITIALIZER,\n  ApplicationRef,\n  Injector,\n  NgModule\n} from '@angular/core';\nimport { HammerModule } from '@angular/platform-browser';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconRegistry, MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSidenavModule } from '@angular/material/sidenav';\nimport { MatToolbarModule } from '@angular/material/toolbar';\nimport { AppHomeModule } from './core/home/home.module';\nimport { AppActivityModule } from './core/activity/activity.module';\nimport { AppConfigModule } from './core/config/config.module';\nimport { AppLanguageModule } from './core/language/language.module';\nimport { AppMediaModule } from './core/media/media.module';\nimport { AppMessageModule } from './core/message/message.module';\nimport { AppRequestModule } from './core/request/request.module';\n\nimport { AppActionModule } from './common/action/action.module';\nimport { AppDynamicComponentModule } from './common/dynamic-component/dynamic-component.module';\nimport { AppEntityTableModule } from './common/entity-table/entity-table.module';\nimport { AppEntitySelectorModule } from './common/entity-selector/entity-selector.module';\nimport { AppFormModule } from './common/form/form.module';\nimport { AppTableModule } from './common/table/table.module';\nimport { AppToolModule } from './common/tool/tool.module';\nimport { AppWidgetModule } from './common/widget/widget.module';\n\nimport { AppAuthFormModule } from './auth/auth-form/auth-form.module';\n\nimport { AppSimpleMapModule } from './geo/simple-map/simple-map.module';\nimport { AppLayerModule } from './geo/layer/layer.module';\nimport { AppLegendModule } from './geo/legend/legend.module';\nimport { AppOverlayModule } from './geo/overlay/overlay.module';\nimport { AppGeometryModule } from './geo/geometry/geometry.module';\nimport { AppFeatureModule } from './geo/feature/feature.module';\nimport { AppHoverModule } from './geo/hover/hover.module';\nimport { AppMeasureModule } from './geo/measure/measure.module';\nimport { AppDrawModule } from './geo/draw/draw.module';\nimport { AppQueryModule } from './geo/query/query.module';\nimport { AppCatalogModule } from './geo/catalog/catalog.module';\nimport { AppSearchModule } from './geo/search/search.module';\nimport { AppPrintModule } from './geo/print/print.module';\nimport { AppImportExport } from './geo/import-export/import-export.module';\nimport { AppDirectionsModule } from './geo/directions/directions.module';\nimport { AppTimeFilterModule } from './geo/time-filter/time-filter.module';\nimport { AppOgcFilterModule } from './geo/ogc-filter/ogc-filter.module';\nimport { AppSpatialFilterModule } from './geo/spatial-filter/spatial-filter.module';\nimport { AppWorkspaceModule } from './geo/workspace/workspace.module';\n\nimport { AppContextModule } from './context/context/context.module';\n\nimport { AppRoutingModule } from './app-routing.module';\nimport { AppComponent } from './app.component';\nimport { IgoCoreModule, LanguageService } from '@igo2/core';\nimport {\n  MatTooltipDefaultOptions,\n  MAT_TOOLTIP_DEFAULT_OPTIONS\n} from '@angular/material/tooltip';\nimport { concatMap, first } from 'rxjs';\nimport { DatePipe } from '@angular/common';\nimport { MAT_FORM_FIELD_DEFAULT_OPTIONS } from '@angular/material/form-field';\n\nexport const defaultTooltipOptions: MatTooltipDefaultOptions = {\n  showDelay: 500,\n  hideDelay: 0,\n  touchendHideDelay: 0,\n  disableTooltipInteractivity: true\n};\n\n@NgModule({\n  declarations: [AppComponent],\n  imports: [\n    IgoCoreModule,\n    BrowserModule,\n    BrowserAnimationsModule,\n    MatSidenavModule,\n    MatToolbarModule,\n    MatButtonModule,\n    MatIconModule,\n    MatListModule,\n\n    AppHomeModule,\n    AppActivityModule,\n    AppConfigModule,\n    AppLanguageModule,\n    AppMediaModule,\n    AppMessageModule,\n    AppRequestModule,\n\n    AppActionModule,\n    AppDynamicComponentModule,\n    AppEntityTableModule,\n    AppEntitySelectorModule,\n    AppFormModule,\n    AppTableModule,\n    AppToolModule,\n    AppWidgetModule,\n\n    AppAuthFormModule,\n\n    AppSimpleMapModule,\n    AppLayerModule,\n    AppLegendModule,\n    AppOverlayModule,\n    AppGeometryModule,\n    AppFeatureModule,\n    AppHoverModule,\n    AppMeasureModule,\n    AppDrawModule,\n    AppQueryModule,\n    AppCatalogModule,\n    AppSearchModule,\n    AppPrintModule,\n    AppImportExport,\n    AppDirectionsModule,\n    AppTimeFilterModule,\n    AppOgcFilterModule,\n    AppSpatialFilterModule,\n    AppWorkspaceModule,\n\n    AppContextModule,\n    AppRoutingModule,\n\n    HammerModule\n  ],\n  providers: [\n    {\n      provide: MAT_FORM_FIELD_DEFAULT_OPTIONS,\n      useValue: { appearance: 'outline' }\n    },\n    {\n      provide: APP_INITIALIZER,\n      useFactory: appInitializerFactory,\n      deps: [Injector, ApplicationRef],\n      multi: true\n    },\n    { provide: MAT_TOOLTIP_DEFAULT_OPTIONS, useValue: defaultTooltipOptions },\n    DatePipe\n  ],\n  bootstrap: [AppComponent]\n})\nexport class AppModule {\n  constructor(matIconRegistry: MatIconRegistry, domSanitizer: DomSanitizer) {\n    matIconRegistry.addSvgIconSet(\n      domSanitizer.bypassSecurityTrustResourceUrl(\n        './assets/igo2/core/icons/mdi.svg'\n      )\n    );\n  }\n}\n\nexport function appInitializerFactory(\n  injector: Injector,\n  applicationRef: ApplicationRef\n) {\n  return () =>\n    new Promise<any>((resolve: any) => {\n      applicationRef.isStable\n        .pipe(\n          first((isStable) => isStable === true),\n          concatMap(() => {\n            const languageService = injector.get(LanguageService);\n            const lang = languageService.getLanguage();\n            return languageService.translate.getTranslation(lang);\n          })\n        )\n        .subscribe((translations) => {\n          const languageService = injector.get(LanguageService);\n          const lang = languageService.getLanguage();\n          languageService.translate.setTranslation(lang, translations);\n          resolve();\n        });\n    });\n}\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nimport 'hammerjs';\n\nif (environment.production) {\n  enableProdMode();\n}\n\nplatformBrowserDynamic()\n  .bootstrapModule(AppModule)\n  .catch((err) => console.log(err));\n","var map = {\n\t\"./af\": 35528,\n\t\"./af.js\": 35528,\n\t\"./ar\": 1036,\n\t\"./ar-dz\": 17579,\n\t\"./ar-dz.js\": 17579,\n\t\"./ar-kw\": 69588,\n\t\"./ar-kw.js\": 69588,\n\t\"./ar-ly\": 11650,\n\t\"./ar-ly.js\": 11650,\n\t\"./ar-ma\": 93258,\n\t\"./ar-ma.js\": 93258,\n\t\"./ar-sa\": 54085,\n\t\"./ar-sa.js\": 54085,\n\t\"./ar-tn\": 90287,\n\t\"./ar-tn.js\": 90287,\n\t\"./ar.js\": 1036,\n\t\"./az\": 89757,\n\t\"./az.js\": 89757,\n\t\"./be\": 59620,\n\t\"./be.js\": 59620,\n\t\"./bg\": 31139,\n\t\"./bg.js\": 31139,\n\t\"./bm\": 4042,\n\t\"./bm.js\": 4042,\n\t\"./bn\": 19641,\n\t\"./bn-bd\": 19126,\n\t\"./bn-bd.js\": 19126,\n\t\"./bn.js\": 19641,\n\t\"./bo\": 494,\n\t\"./bo.js\": 494,\n\t\"./br\": 20934,\n\t\"./br.js\": 20934,\n\t\"./bs\": 26274,\n\t\"./bs.js\": 26274,\n\t\"./ca\": 45831,\n\t\"./ca.js\": 45831,\n\t\"./cs\": 92354,\n\t\"./cs.js\": 92354,\n\t\"./cv\": 79692,\n\t\"./cv.js\": 79692,\n\t\"./cy\": 58774,\n\t\"./cy.js\": 58774,\n\t\"./da\": 38955,\n\t\"./da.js\": 38955,\n\t\"./de\": 21557,\n\t\"./de-at\": 24954,\n\t\"./de-at.js\": 24954,\n\t\"./de-ch\": 81881,\n\t\"./de-ch.js\": 81881,\n\t\"./de.js\": 21557,\n\t\"./dv\": 16475,\n\t\"./dv.js\": 16475,\n\t\"./el\": 38877,\n\t\"./el.js\": 38877,\n\t\"./en-au\": 70454,\n\t\"./en-au.js\": 70454,\n\t\"./en-ca\": 67356,\n\t\"./en-ca.js\": 67356,\n\t\"./en-gb\": 10456,\n\t\"./en-gb.js\": 10456,\n\t\"./en-ie\": 28789,\n\t\"./en-ie.js\": 28789,\n\t\"./en-il\": 85471,\n\t\"./en-il.js\": 85471,\n\t\"./en-in\": 39664,\n\t\"./en-in.js\": 39664,\n\t\"./en-nz\": 97672,\n\t\"./en-nz.js\": 97672,\n\t\"./en-sg\": 80805,\n\t\"./en-sg.js\": 80805,\n\t\"./eo\": 87390,\n\t\"./eo.js\": 87390,\n\t\"./es\": 1564,\n\t\"./es-do\": 51473,\n\t\"./es-do.js\": 51473,\n\t\"./es-mx\": 92089,\n\t\"./es-mx.js\": 92089,\n\t\"./es-us\": 84156,\n\t\"./es-us.js\": 84156,\n\t\"./es.js\": 1564,\n\t\"./et\": 6513,\n\t\"./et.js\": 6513,\n\t\"./eu\": 7856,\n\t\"./eu.js\": 7856,\n\t\"./fa\": 2378,\n\t\"./fa.js\": 2378,\n\t\"./fi\": 22687,\n\t\"./fi.js\": 22687,\n\t\"./fil\": 80032,\n\t\"./fil.js\": 80032,\n\t\"./fo\": 46845,\n\t\"./fo.js\": 46845,\n\t\"./fr\": 8875,\n\t\"./fr-ca\": 56425,\n\t\"./fr-ca.js\": 56425,\n\t\"./fr-ch\": 41746,\n\t\"./fr-ch.js\": 41746,\n\t\"./fr.js\": 8875,\n\t\"./fy\": 67037,\n\t\"./fy.js\": 67037,\n\t\"./ga\": 11217,\n\t\"./ga.js\": 11217,\n\t\"./gd\": 37010,\n\t\"./gd.js\": 37010,\n\t\"./gl\": 51931,\n\t\"./gl.js\": 51931,\n\t\"./gom-deva\": 64488,\n\t\"./gom-deva.js\": 64488,\n\t\"./gom-latn\": 8032,\n\t\"./gom-latn.js\": 8032,\n\t\"./gu\": 34984,\n\t\"./gu.js\": 34984,\n\t\"./he\": 69090,\n\t\"./he.js\": 69090,\n\t\"./hi\": 42085,\n\t\"./hi.js\": 42085,\n\t\"./hr\": 38787,\n\t\"./hr.js\": 38787,\n\t\"./hu\": 2901,\n\t\"./hu.js\": 2901,\n\t\"./hy-am\": 59819,\n\t\"./hy-am.js\": 59819,\n\t\"./id\": 44074,\n\t\"./id.js\": 44074,\n\t\"./is\": 70715,\n\t\"./is.js\": 70715,\n\t\"./it\": 31746,\n\t\"./it-ch\": 77040,\n\t\"./it-ch.js\": 77040,\n\t\"./it.js\": 31746,\n\t\"./ja\": 3180,\n\t\"./ja.js\": 3180,\n\t\"./jv\": 34346,\n\t\"./jv.js\": 34346,\n\t\"./ka\": 65538,\n\t\"./ka.js\": 65538,\n\t\"./kk\": 79772,\n\t\"./kk.js\": 79772,\n\t\"./km\": 87905,\n\t\"./km.js\": 87905,\n\t\"./kn\": 79125,\n\t\"./kn.js\": 79125,\n\t\"./ko\": 69140,\n\t\"./ko.js\": 69140,\n\t\"./ku\": 2354,\n\t\"./ku.js\": 2354,\n\t\"./ky\": 63768,\n\t\"./ky.js\": 63768,\n\t\"./lb\": 14016,\n\t\"./lb.js\": 14016,\n\t\"./lo\": 83169,\n\t\"./lo.js\": 83169,\n\t\"./lt\": 62353,\n\t\"./lt.js\": 62353,\n\t\"./lv\": 83243,\n\t\"./lv.js\": 83243,\n\t\"./me\": 52338,\n\t\"./me.js\": 52338,\n\t\"./mi\": 35555,\n\t\"./mi.js\": 35555,\n\t\"./mk\": 85794,\n\t\"./mk.js\": 85794,\n\t\"./ml\": 53151,\n\t\"./ml.js\": 53151,\n\t\"./mn\": 46458,\n\t\"./mn.js\": 46458,\n\t\"./mr\": 69165,\n\t\"./mr.js\": 69165,\n\t\"./ms\": 8680,\n\t\"./ms-my\": 87477,\n\t\"./ms-my.js\": 87477,\n\t\"./ms.js\": 8680,\n\t\"./mt\": 79684,\n\t\"./mt.js\": 79684,\n\t\"./my\": 40285,\n\t\"./my.js\": 40285,\n\t\"./nb\": 45922,\n\t\"./nb.js\": 45922,\n\t\"./ne\": 29040,\n\t\"./ne.js\": 29040,\n\t\"./nl\": 5066,\n\t\"./nl-be\": 74460,\n\t\"./nl-be.js\": 74460,\n\t\"./nl.js\": 5066,\n\t\"./nn\": 53693,\n\t\"./nn.js\": 53693,\n\t\"./oc-lnc\": 88676,\n\t\"./oc-lnc.js\": 88676,\n\t\"./pa-in\": 92341,\n\t\"./pa-in.js\": 92341,\n\t\"./pl\": 57416,\n\t\"./pl.js\": 57416,\n\t\"./pt\": 84344,\n\t\"./pt-br\": 30113,\n\t\"./pt-br.js\": 30113,\n\t\"./pt.js\": 84344,\n\t\"./ro\": 72643,\n\t\"./ro.js\": 72643,\n\t\"./ru\": 61305,\n\t\"./ru.js\": 61305,\n\t\"./sd\": 96095,\n\t\"./sd.js\": 96095,\n\t\"./se\": 74486,\n\t\"./se.js\": 74486,\n\t\"./si\": 58742,\n\t\"./si.js\": 58742,\n\t\"./sk\": 96722,\n\t\"./sk.js\": 96722,\n\t\"./sl\": 3345,\n\t\"./sl.js\": 3345,\n\t\"./sq\": 52416,\n\t\"./sq.js\": 52416,\n\t\"./sr\": 39450,\n\t\"./sr-cyrl\": 50501,\n\t\"./sr-cyrl.js\": 50501,\n\t\"./sr.js\": 39450,\n\t\"./ss\": 32222,\n\t\"./ss.js\": 32222,\n\t\"./sv\": 9454,\n\t\"./sv.js\": 9454,\n\t\"./sw\": 19638,\n\t\"./sw.js\": 19638,\n\t\"./ta\": 96494,\n\t\"./ta.js\": 96494,\n\t\"./te\": 94435,\n\t\"./te.js\": 94435,\n\t\"./tet\": 25003,\n\t\"./tet.js\": 25003,\n\t\"./tg\": 13706,\n\t\"./tg.js\": 13706,\n\t\"./th\": 16025,\n\t\"./th.js\": 16025,\n\t\"./tk\": 59780,\n\t\"./tk.js\": 59780,\n\t\"./tl-ph\": 22068,\n\t\"./tl-ph.js\": 22068,\n\t\"./tlh\": 39167,\n\t\"./tlh.js\": 39167,\n\t\"./tr\": 32494,\n\t\"./tr.js\": 32494,\n\t\"./tzl\": 58707,\n\t\"./tzl.js\": 58707,\n\t\"./tzm\": 91296,\n\t\"./tzm-latn\": 34532,\n\t\"./tzm-latn.js\": 34532,\n\t\"./tzm.js\": 91296,\n\t\"./ug-cn\": 12086,\n\t\"./ug-cn.js\": 12086,\n\t\"./uk\": 85069,\n\t\"./uk.js\": 85069,\n\t\"./ur\": 29304,\n\t\"./ur.js\": 29304,\n\t\"./uz\": 95115,\n\t\"./uz-latn\": 97609,\n\t\"./uz-latn.js\": 97609,\n\t\"./uz.js\": 95115,\n\t\"./vi\": 34802,\n\t\"./vi.js\": 34802,\n\t\"./x-pseudo\": 65605,\n\t\"./x-pseudo.js\": 65605,\n\t\"./yo\": 88456,\n\t\"./yo.js\": 88456,\n\t\"./zh-cn\": 23272,\n\t\"./zh-cn.js\": 23272,\n\t\"./zh-hk\": 9402,\n\t\"./zh-hk.js\": 9402,\n\t\"./zh-mo\": 48101,\n\t\"./zh-mo.js\": 48101,\n\t\"./zh-tw\": 40262,\n\t\"./zh-tw.js\": 40262\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 46700;"],"x_google_ignoreList":[813]}