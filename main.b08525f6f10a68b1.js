(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[179],{73750:(ao,ga,k)=>{"use strict";var Tt=k(50318),e=k(89184),gi=k(57481),I=k(87317),O=k(65590),X=k(26131),so=k(7216),fl=k(19946),J=k(40089),me=k(17643),de=k(77797),Ne=k(81803),Fe=k(86170),Se=k(4089),we=k(20265),N=k(24582),q=k(2496),D=k(95106),Qe=k(32090),h=k(78069),v=k(48047),C=k(36362),F=k(11961),pt=k(61534),Ve=k(82796),W=k(28784),ml=k(32313),Ze=k(53158),U=k(50635),De=k(71989),An=k(80155),Hp=k(44874),x=k(76317),fi=k(25474),dt=k(26562),un=k(91640),rt=k(90833),In=k(23280),Vp=k(93962),$e=k(50253),lo=k(98977),Wp=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"getByte",value:function(t,o){return t.charCodeAt(o)}},{key:"getByte64",value:function(t,o){return this.ALPHA.indexOf(t.charAt(o))}},{key:"decode",value:function(t){var r,s,o=0,l=t.length,c=[];if(t=String(t),0===l)return t;for(t.charAt(l-1)===this.PADCHAR&&(o=1,t.charAt(l-2)===this.PADCHAR&&(o=2),l-=4),r=0;r<l;r+=4)s=this.getByte64(t,r)<<18|this.getByte64(t,r+1)<<12|this.getByte64(t,r+2)<<6|this.getByte64(t,r+3),c.push(String.fromCharCode(s>>16,s>>8&255,255&s));switch(o){case 1:s=this.getByte64(t,r)<<18|this.getByte64(t,r+1)<<12|this.getByte64(t,r+2)<<6,c.push(String.fromCharCode(s>>16,s>>8&255));break;case 2:s=this.getByte64(t,r)<<18|this.getByte64(t,r+1)<<12,c.push(String.fromCharCode(s>>16))}return c.join("")}},{key:"encode",value:function(t){var o,r,s=[],l=(t=String(t)).length-t.length%3;if(0===t.length)return t;for(o=0;o<l;o+=3)r=this.getByte(t,o)<<16|this.getByte(t,o+1)<<8|this.getByte(t,o+2),s.push(this.ALPHA.charAt(r>>18)),s.push(this.ALPHA.charAt(r>>12&63)),s.push(this.ALPHA.charAt(r>>6&63)),s.push(this.ALPHA.charAt(63&r));switch(t.length-l){case 1:r=this.getByte(t,o)<<16,s.push(this.ALPHA.charAt(r>>18)+this.ALPHA.charAt(r>>12&63)+this.PADCHAR+this.PADCHAR);break;case 2:r=this.getByte(t,o)<<16|this.getByte(t,o+1)<<8,s.push(this.ALPHA.charAt(r>>18)+this.ALPHA.charAt(r>>12&63)+this.ALPHA.charAt(r>>6&63)+this.PADCHAR)}return s.join("")}}]),a}();return i.PADCHAR="=",i.ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i}(),qn=Vp.getParser(window.navigator.userAgent),Gn=function(){function i(){(0,h.Z)(this,i)}return(0,v.Z)(i,null,[{key:"copy",value:function(n){var t=!1;if("string"==typeof n){var o=i.createTextArea(n);i.selectText(o),t=i.copyTextToClipboard(),i.destroyTextArea(o)}else i.selectText(n),t=i.copyTextToClipboard();return t}},{key:"createTextArea",value:function(n){var t=document.createElement("textArea");return t.value=n,document.body.appendChild(t),t}},{key:"destroyTextArea",value:function(n){document.body.removeChild(n)}},{key:"selectText",value:function(n){if("iOS"===qn.getOSName()){var t=n.contentEditable,o=n.readOnly,r=document.createRange(),s=window.getSelection();n.contenteditable=!0,n.readonly=!1,r.selectNodeContents(n),s.removeAllRanges(),s.addRange(r),n.setSelectionRange(0,999999),n.contentEditable=t,n.readOnly=o}else n.select()}},{key:"copyTextToClipboard",value:function(){return("iOS"!==qn.getOSName()||!qn.compareVersion("<10"))&&document.execCommand("copy")}}]),i}(),Kp=function(){function i(){(0,h.Z)(this,i)}return(0,v.Z)(i,null,[{key:"diff",value:function(n,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;if(!n&&!t)return"";if(!n)return'<span class="inserted">'+t+"</span>";if(!t)return'<span class="deleted">'+n+"</span>";n=n.toString(),t=t.toString();var r=i.getChanges(n,t,"",o),s=t.slice(r.mtc.length+r.ins.length+r.sbs.length),l=n.slice(r.mtc.length+r.del.length+r.sbs.length);return r.del.length>0&&(r.del='<span class="deleted">'+r.del+"</span>"),r.ins.length>0&&(r.ins='<span class="inserted">'+r.ins+"</span>"),r.mtc+r.del+r.ins+r.sbs+(""!==l||""!==s?i.diff(l,s,o):"")}},{key:"getMatchingSubstring",value:function(n,t,o){for(var r=0,s=!1,l=n.length,c={fis:l,mtc:o,sbs:""};r<l;)t[r]===n[r]?s?c.sbs+=n[r]:(s=!0,c.fis=r,c.sbs=n[r]):s&&(r=l),++r;return c}},{key:"getChanges",value:function(n,t,o,r){for(var s=n.length>=n.length,c=(0,Qe.Z)(s?[n,t]:[t,n],2),u=c[0],p=c[1],d=0;p[d]===u[d]&&d<p.length;)++d;u=u.split("").slice(d),p=p.slice(d);var g=u.length,f={fis:p.length,fil:g,sbs:"",mtc:o+t.slice(0,d)},m={sbs:""};if(""!==p)for(var y=0;y<g&&m.sbs.length<r;y++)(m=i.getMatchingSubstring(p,i.rotateArray(u,y),f.mtc)).fil=y<g-m.fis?m.fis+y:m.fis-g+y,m.sbs.length>f.sbs.length&&(f=m);var _=s?[u.slice(0,f.fil).join(""),p.slice(0,f.fis)]:[p.slice(0,f.fis),u.slice(0,f.fil).join("")],b=(0,Qe.Z)(_,2);return f.del=b[0],f.ins=b[1],-1===f.del.indexOf(" ")||-1===f.ins.indexOf(" ")||""===f.del||""===f.ins||""===f.sbs?f:i.getChanges(f.del,f.ins,f.mtc,r)}},{key:"rotateArray",value:function(n,t){var o=n.length,r=new Array(n.length);if(t%o==0)return n.slice();for(var s=0;s<o;s++)r[s]=n[(s+(o+t%o))%o];return r}}]),i}(),Ao=function(){return(i=Ao||(Ao={})).ADDED="added",i.DELETED="deleted",i.MODIFIED="modified",Ao;var i}(),Xp=function(){function i(){(0,h.Z)(this,i)}return(0,v.Z)(i,null,[{key:"findChanges",value:function(n,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r={added:[],deleted:[],modified:[]};if(!n||!t)return r;var u,s=(0,Fe.Z)(n),l=(0,Fe.Z)(t),c=(0,D.Z)(s);try{var p=function(){var f=u.value,m=l.findIndex(function(T){return T.id===f.id});if(-1===m)return r.deleted.push({change:{type:Ao.DELETED},value:f}),"continue";var y=l.splice(m,1)[0],_=JSON.parse(JSON.stringify(f)),b=JSON.parse(JSON.stringify(y)),w=i.compareObject(_,b,void 0,o);w.length&&r.modified.push({change:{type:Ao.MODIFIED,keysChanged:w},value:_,oldValue:f,newValue:y})};for(c.s();!(u=c.n()).done;)p()}catch(g){c.e(g)}finally{c.f()}return r.added=l.map(function(g){return{change:{type:Ao.ADDED},value:g}}),r}},{key:"compareObject",value:function(n,t,o){var r=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],l=JSON.parse(JSON.stringify(n)),c=JSON.parse(JSON.stringify(t)),u=new Set([].concat((0,Fe.Z)(Object.keys(n)),(0,Fe.Z)(Object.keys(t)))),p=[];return u.forEach(function(d){var g=o?"".concat(o,".").concat(d):d;-1===s.indexOf(g)&&(Array.isArray(n[d])&&(n[d]=n[d].join(",<br>")),Array.isArray(t[d])&&(t[d]=t[d].join(",<br>")),"object"==typeof n[d]&&"object"==typeof t[d]&&null!==n[d]&&null!==t[d]?p=p.concat(r.compareObject(n[d],t[d],g)):n[d]!==t[d]&&(p.push({key:g,oldValue:l[d],newValue:c[d]}),n[d]=Kp.diff(n[d],t[d])))}),p}}]),i}();var se=function(){function i(){(0,h.Z)(this,i)}return(0,v.Z)(i,null,[{key:"resolve",value:function(n,t){for(var o=t.replace(/\[/g,".").replace(/\]/g,"").split("."),r=n;o.length;){if("object"!=typeof r)return;r=r[o.shift()]}return r}},{key:"isObject",value:function(n){return n&&"object"==typeof n&&!Array.isArray(n)&&null!==n&&!(n instanceof Date)}},{key:"mergeDeep",value:function(n,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object.assign({},n);return i.isObject(n)&&i.isObject(t)&&Object.keys(t).filter(function(s){return!o||void 0!==t[s]}).forEach(function(s){i.isObject(t[s])&&s in n?r[s]=i.mergeDeep(n[s],t[s],o):Object.assign(r,(0,de.Z)({},s,t[s]))}),r}},{key:"copyDeep",value:function(n){var t=Array.isArray(n)?[]:{};for(var o in n)if(n.hasOwnProperty(o)){var r=n[o];t[o]=r&&"object"==typeof r?this.copyDeep(r):r}return t}},{key:"removeDuplicateCaseInsensitive",value:function(n){var t={},o={},r=[];for(var s in n)if(n.hasOwnProperty(s)){var l=s.toUpperCase();t.hasOwnProperty(l)?t[l].push((0,de.Z)({},s,n[s])):t[l]=[(0,de.Z)({},s,n[s])],r.push({key:s,count:s.replace(/[^A-Z]/g,"").length})}var c=function(f){if(t.hasOwnProperty(f)&&t.hasOwnProperty(f)){var m=t[f];if(1===m.length){var y=m[0];o[f]=y[Object.keys(y)[0]]}else if(m.length>1){var _=r.filter(function(b){return b.key.toLowerCase()===f.toLowerCase()}).reduce(function(b,w){return b.y<w.y?b:w});o[_.key.toUpperCase()]=n[_.key]}}};for(var u in t)c(u);for(var p in n)n.hasOwnProperty(p)&&delete n[p];for(var d in o)o.hasOwnProperty(d)&&(n[d]=o[d])}},{key:"removeUndefined",value:function(n){var t={};return i.isObject(n)?(Object.keys(n).filter(function(o){return void 0!==n[o]}).forEach(function(o){t[o]=i.isObject(n[o])||Array.isArray(n[o])?i.removeUndefined(n[o]):n[o]}),t):Array.isArray(n)?n.map(function(o){return i.removeUndefined(o)}):n}},{key:"removeNull",value:function(n){var t={};return i.isObject(n)?(Object.keys(n).filter(function(o){return null!==n[o]}).forEach(function(o){t[o]=i.isObject(n[o])||Array.isArray(n[o])?i.removeNull(n[o]):n[o]}),t):Array.isArray(n)?n.map(function(o){return i.removeNull(o)}):n}},{key:"naturalCompare",value:function(n,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"asc",r=arguments.length>3?arguments[3]:void 0;if("desc"===o&&(t=[n,n=t][0]),null===n||""===n||void 0===n||null===t||""===t||void 0===t){var s=n===t?0:void 0===n?3:void 0===t?-3:null===n?2:null===t?-2:""===n?1:-1;return"desc"===o?!1!==r?s:-1*s:!0===r?-1*s:s}var l=[],c=[];for(t=""+t,(n=""+n).replace(/(\d+)|(\D+)/g,function(g,f,m){l.push([f||1/0,m||""])}),t.replace(/(\d+)|(\D+)/g,function(g,f,m){c.push([f||1/0,m||""])});l.length&&c.length;){var u=l.shift(),p=c.shift(),d=u[0]-p[0]||u[1].localeCompare(p[1]);if(d)return d}return l.length-c.length}},{key:"objectsAreEquivalent",value:function(n,t){if(n===t)return!0;var o=Object.getOwnPropertyNames(n),r=Object.getOwnPropertyNames(t);if(o.length!==r.length)return!1;var l,s=(0,D.Z)(o);try{for(s.s();!(l=s.n()).done;){var c=l.value;if(n[c]!==t[c])return!1}}catch(u){s.e(u)}finally{s.f()}return!0}},{key:"removeKeys",value:function(n,t){return Object.keys(n).filter(function(r){return t.indexOf(r)<0}).reduce(function(r,s){return r[s]=n[s],r},{})}}]),i}(),co=function(){function i(){(0,h.Z)(this,i)}return(0,v.Z)(i,null,[{key:"roundToNDecimal",value:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,o=Math.pow(10,t);return Math.round(n*o)/o}}]),i}();function _n(i){return i.reduce(function(a,n){return a[n]=n,a},Object.create(null))}function Qn(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function Ye(){return"".concat(Qn()).concat(Qn(),"-").concat(Qn(),"-").concat(Qn(),"-").concat(Qn(),"-").concat(Qn()).concat(Qn()).concat(Qn()).toLowerCase()}var Le=function(){return(i=Le||(Le={}))[i.Error=0]="Error",i[i.Done=1]="Done",i[i.Working=2]="Working",i[i.Waiting=3]="Waiting",Le;var i}(),ar=function(){function i(){(0,h.Z)(this,i),this.status$=new $e.x}return(0,v.Z)(i,[{key:"status",get:function(){return this._status},set:function(n){this._status=n,this.status$.next(n)}},{key:"subscribe",value:function(n,t){var o=this;this.watch(),this.status$$=this.status$.pipe((0,lo.x)()).subscribe(function(r){o.handleStatusChange(r),n.call(t,o)})}},{key:"unsubscribe",value:function(){this.unwatch(),void 0!==this.status$$&&(this.status$$.unsubscribe(),this.status$$=void 0),this.status=Le.Waiting}},{key:"handleStatusChange",value:function(n){}}]),i}(),E=k(32097),vl=k(34101),fa=k(24044),Yn=k(39910),mi=function(){var i=function(){function a(){(0,h.Z)(this,a),this.counter$=new x.X(0),this.ids=[]}return(0,v.Z)(a,[{key:"register",value:function(){var t=Ye();return this.ids.push(t),this.counter$.next(this.ids.length),t}},{key:"unregister",value:function(t){var o=this.ids.indexOf(t);-1!==o&&(this.ids.splice(o,1),this.counter$.next(this.ids.length))}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),td=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.activityService=n}return(0,v.Z)(a,[{key:"intercept",value:function(t,o){var r=this,s=t.headers.get("activityInterceptor");if(s){var l=t.clone({headers:t.headers.delete("activityInterceptor")});if("false"===s)return o.handle(l)}var c=this.activityService.register();return o.handle(t).pipe((0,ml.x)(function(){r.activityService.unregister(c)}))}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(mi))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i}(),ma=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[{provide:W.TP,useClass:td,multi:!0}]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i}(),yl={lib:"1.13.3",releaseDate:1668635669237},j=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.injector=n,this.config={}}return(0,v.Z)(a,[{key:"getConfig",value:function(t){return se.resolve(this.config,t)}},{key:"load",value:function(t){var o=this,r=t.default||{};if(!t.path)return this.config=r,!0;var s=this.injector.get(W.eN);return new Promise(function(l,c){s.get(t.path).pipe((0,Ze.K)(function(u){return console.log("Configuration file ".concat(t.path," could not be read")),l(!0),(0,fi._)(u.error||"Server error")})).subscribe(function(u){o.config=se.mergeDeep(se.mergeDeep({version:yl},r),u),l(!0)})})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(e.zs3))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),_l=new e.OlP("configOptions");function ha(i){return{provide:_l,useValue:i}}function nd(i,a){return function(){return i.load(a)}}var sr=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[ha({}),{provide:e.ip1,useFactory:nd,multi:!0,deps:[j,_l]}]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i}(),id=function(){function i(a,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".json",o=arguments.length>3?arguments[3]:void 0;(0,h.Z)(this,i),this.http=a,this.prefix=n,this.suffix=t,this.config=o}return(0,v.Z)(i,[{key:"getTranslation",value:function(n){var t=this,o=this.http.get("locale/libs_locale/".concat(n,".json"));if(this.config&&!this.prefix){var r=this.config.getConfig("language.prefix");this.prefix=!r||Array.isArray(r)?r:[r]}if(!this.prefix||0===this.prefix.length)return o;var s=this.prefix.map(function(c){return t.http.get("".concat(c).concat(n).concat(t.suffix))});return(0,dt.a)([o].concat((0,Fe.Z)(s))).pipe((0,U.U)(function(c){return c.reduce(function(u,p){return se.mergeDeep(u,p)},{})}))}}]),i}();function bl(i,a){return new id(i,void 0,void 0,a)}function rd(i){return{provide:E.Zw,useFactory:i||bl,deps:[W.eN,j]}}var ad=function(){function i(){(0,h.Z)(this,i)}return(0,v.Z)(i,[{key:"handle",value:function(n){if(!n.translateService.langs.length)throw new Error("Translations are not yet loaded.          Check that the LanguageService is injected.");if("igo."===n.key.substr(0,4))throw new Error('The Key "'.concat(n.key,'" is missing in locale file.'));return n.key}}]),i}(),he=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[rd()]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[E.aw.forRoot({missingTranslationHandler:{provide:E.gC,useClass:ad}}),E.aw]}),i}(),Ln=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,vl.Rh.forRoot({positionClass:"toast-bottom-right",timeOut:1e4,extendedTimeOut:1e4,messageClass:"toast-message mat-typography",closeButton:!0,progressBar:!0,enableHtml:!0,tapToDismiss:!0,maxOpened:4,preventDuplicates:!0,resetTimeoutOnDuplicate:!0,countDuplicates:!1,includeTitleDuplicates:!0})]}),i}(),bn=function(){return(i=bn||(bn={})).ERROR="error",i.ALERT="warning",i.WARNING="warning",i.INFO="info",i.SUCCESS="success",i.SHOW="show",bn;var i}(),$=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.translate=n,this.language=this.translate.getBrowserLang(),this.language$=new x.X(void 0);var t=this.getLanguage();this.translate.setDefaultLang(t),this.language$.next(t)}return(0,v.Z)(a,[{key:"getLanguage",value:function(){return this.language.match(/en|fr/)?this.language:"en"}},{key:"setLanguage",value:function(t){this.language=t.match(/en|fr/)?t:"en",this.language$.next(this.language),this.translate.use(this.language),this.translate.reloadLang(this.language)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(E.sK))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),Ae=function(){var i=function(){function a(n,t,o){var r=this;(0,h.Z)(this,a),this.injector=n,this.configService=t,this.languageService=o,this.messages$=new x.X([]),this.activeMessageTranslations=[],this.options=this.configService.getConfig("message")||{},this.languageService.language$.pipe((0,De.b)(500)).subscribe(function(s){0===r.toastr.toasts.length&&(r.activeMessageTranslations=[]),r.toastr.toasts.map(function(l){var c=r.activeMessageTranslations.find(function(d){return d.id===l.toastId});if(c){var u=Object.assign({},c.textInterpolateParams),p=Object.assign({},c.titleInterpolateParams);c.textInterpolateParams&&Object.keys(c.textInterpolateParams).map(function(d){u[d]=r.languageService.translate.instant(c.textInterpolateParams[d])}),c.titleInterpolateParams&&Object.keys(c.titleInterpolateParams).map(function(d){p[d]=r.languageService.translate.instant(c.titleInterpolateParams[d])}),(0,un.D)([r.languageService.translate.get(c.textKey,u),r.languageService.translate.get(c.titleKey,p)]).pipe((0,An.P)()).subscribe(function(d){l.toastRef.componentInstance.message=d[0],l.toastRef.componentInstance.title=d[1]})}})})}return(0,v.Z)(a,[{key:"toastr",get:function(){return this.injector.get(vl._W)}},{key:"showError",value:function(t){return t.error.caught=!0,this.error(t.error.message,t.error.title)}},{key:"message",value:function(t){var o=t.type;this.toastr.toastrConfig.iconClasses[o]="toast-".concat(o),this.messages$.next(this.messages$.value.concat([t])),t.options=t.options||{};var r=new Date;if(t.options.from=t.options.from?t.options.from:new Date("1 jan 1900"),t.options.to=t.options.to?t.options.to:new Date("1 jan 3000"),"string"==typeof t.options.from&&(t.options.from=new Date(Date.parse(t.options.from.replace(/-/g," ")))),"string"==typeof t.options.to&&(t.options.to=new Date(Date.parse(t.options.to.replace(/-/g," ")))),r>t.options.from&&r<t.options.to&&(!1===t.showIcon&&(this.toastr.toastrConfig.iconClasses[o]="toast-".concat(o," toast-no-icon")),(t=this.handleTemplate(t)).text)){var s;switch(t.type){case bn.SUCCESS:s=this.success(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams);break;case bn.ERROR:s=this.error(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams);break;case bn.INFO:s=this.info(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams);break;case bn.SHOW:s=this.show(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams);break;case bn.ALERT:case bn.WARNING:s=this.alert(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams);break;default:s=this.info(t.text,t.title,t.options,t.textInterpolateParams,t.titleInterpolateParams)}t.options.id=s.toastId}}},{key:"success",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"igo.core.message.success",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;return this.handleNgxToastr("success",t,o,r,s,l)}},{key:"error",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"igo.core.message.error",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;return this.handleNgxToastr("error",t,o,r,s,l)}},{key:"info",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"igo.core.message.info",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;return this.handleNgxToastr("info",t,o,r,s,l)}},{key:"alert",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"igo.core.message.alert",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;return this.handleNgxToastr("alert",t,o,r,s,l)}},{key:"show",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"igo.core.message.info",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;return this.handleNgxToastr("show",t,o,r,s,l)}},{key:"handleNgxToastr",value:function(t,o,r){var s=this,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0,p=Object.assign({},c),d=Object.assign({},u);c&&Object.keys(c).map(function(y){p[y]=s.languageService.translate.instant(c[y])}),u&&Object.keys(u).map(function(y){d[y]=s.languageService.translate.instant(u[y])});var m,g=this.languageService.translate.instant(o,p),f=this.languageService.translate.instant(r,d);switch(t){case"success":m=this.toastr.success(g,f,l);break;case"error":m=this.toastr.error(g,f,l);break;case"show":case"info":m=this.toastr.info(g,f,l);break;case"alert":m=this.toastr.warning(g,f,l)}return this.activeMessageTranslations.push({id:m.toastId,titleKey:r,textKey:o,textInterpolateParams:c,titleInterpolateParams:u}),m}},{key:"remove",value:function(t){this.toastr.remove(t)}},{key:"removeAllAreNotError",value:function(){var o,t=(0,D.Z)(this.messages$.value);try{for(t.s();!(o=t.n()).done;){var r=o.value;r.type!==bn.ERROR&&this.remove(r.options.id)}}catch(s){t.e(s)}finally{t.f()}}},{key:"handleTemplate",value:function(t){if(!this.options.template||t.html)return t;var o=this.options.template;return o=(o=o.replace("${text}",t.text)).replace("${title}",t.title),t.html=void 0,t.text=o,t.title=void 0,t}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(e.zs3),e.LFG(j),e.LFG($))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),sd=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.injector=n}return(0,v.Z)(a,[{key:"intercept",value:function(t,o){var r=this,s=t.headers.get("interceptError"),l=t.clone({headers:t.headers.delete("interceptError")});if("false"===s)return o.handle(l);var c={httpError:void 0};return o.handle(l).pipe((0,Ze.K)(function(u){return r.handleError(u,c)}),(0,ml.x)(function(){r.handleCaughtError(c),r.handleUncaughtError(c)}))}},{key:"handleError",value:function(t,o){if(t instanceof W.UA){var r="object"===t.error?t.error:{};r.message=t.error.message||t.statusText,r.caught=!1,t=new W.UA({error:r,headers:t.headers,status:t.status,statusText:t.statusText,url:t.url})}return o.httpError=t,(0,fi._)(t)}},{key:"handleCaughtError",value:function(t){var o=t.httpError;o&&o.error.toDisplay&&(o.error.caught=!0,this.injector.get(Ae).error(o.error.message,o.error.title))}},{key:"handleUncaughtError",value:function(t){var o=t.httpError;if(o&&!o.error.caught){var r=this.injector.get(Ae);o.error.caught=!0,r.error("igo.core.errors.uncaught.message","igo.core.errors.uncaught.title")}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(e.zs3))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),va=function(){var i=function(){function a(n){if((0,h.Z)(this,a),n)throw new Error("IgoErrorModule is already loaded. Import it in the AppModule only")}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[{provide:W.TP,useClass:sd,multi:!0}]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(i,12))},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i}(),ld={name:"igo2DB",version:1,objectStoresMeta:[{store:"geoData",storeConfig:{keyPath:"url",autoIncrement:!1},storeSchema:[{name:"regionID",keypath:"regionID",options:{unique:!1}}]}]},cd=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),n.addSvgIconSet(t.bypassSecurityTrustResourceUrl("./assets/igo2/core/icons/mdi.svg"))}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(O.jv),e.LFG(Tt.H7))},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,W.JF,ma.forRoot(),sr.forRoot(),va.forRoot(),he.forRoot(),Ln.forRoot(),fa.Cz.forRoot(ld),ma,sr,va,he,Ln]}),i}(),Cl=new e.OlP("routeServiceOptions"),Io=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.router=n,this.route=t,this.options=Object.assign({},{centerKey:"center",zoomKey:"zoom",projectionKey:"projection",contextKey:"context",searchKey:"search",visibleOnLayersKey:"visiblelayers",visibleOffLayersKey:"invisiblelayers",directionsCoordKey:"routing",directionsOptionsKey:"routingOptions",toolKey:"tool",wmsUrlKey:"wmsUrl",wmsLayersKey:"wmsLayers",wmtsUrlKey:"wmtsUrl",wmtsLayersKey:"wmtsLayers",arcgisUrlKey:"arcgisUrl",arcgisLayersKey:"arcgisLayers",iarcgisUrlKey:"iarcgisUrl",iarcgisLayersKey:"iarcgisLayers",tarcgisUrlKey:"tarcgisUrl",tarcgisLayersKey:"tarcgisLayers",vectorKey:"vector"},o)}return(0,v.Z)(a,[{key:"queryParams",get:function(){var t=decodeURIComponent(location.search);if(t.includes("\xa2er=")){var o=(t=t.replace("\xa2er","&center")).slice(1).split("&").map(function(r){return r.split("=")}).reduce(function(r,s){var l=s.map(decodeURIComponent),c=(0,Qe.Z)(l,2);return r[c[0]]=c[1],r},{});this.router.navigate([],{queryParams:o})}return this.route.queryParams}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(me.F0),e.LFG(me.gz),e.LFG(Cl,8))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),Xt=function(){return(i=Xt||(Xt={})).Mobile="mobile",i.Tablet="tablet",i.Desktop="desktop",Xt;var i}(),Cn=function(){return(i=Cn||(Cn={})).Portrait="portrait",i.Landscape="landscape",Cn;var i}(),xt=function(){var i=function(){function a(n){var t=this;(0,h.Z)(this,a),this.media$=new x.X(void 0),this.orientation$=new x.X(void 0),n.observe([Yn.u3.HandsetLandscape]).subscribe(function(o){o.matches&&(t.media$.next(Xt.Mobile),t.orientation$.next(Cn.Landscape))}),n.observe([Yn.u3.HandsetPortrait]).subscribe(function(o){o.matches&&(t.media$.next(Xt.Mobile),t.orientation$.next(Cn.Portrait))}),n.observe([Yn.u3.TabletLandscape]).subscribe(function(o){o.matches&&(t.media$.next(Xt.Tablet),t.orientation$.next(Cn.Landscape))}),n.observe([Yn.u3.TabletPortrait]).subscribe(function(o){o.matches&&(t.media$.next(Xt.Tablet),t.orientation$.next(Cn.Portrait))}),n.observe([Yn.u3.WebLandscape]).subscribe(function(o){o.matches&&(t.media$.next(Xt.Desktop),t.orientation$.next(Cn.Landscape))}),n.observe([Yn.u3.WebPortrait]).subscribe(function(o){o.matches&&(t.media$.next(Xt.Desktop),t.orientation$.next(Cn.Portrait))})}return(0,v.Z)(a,[{key:"getMedia",value:function(){return this.media$.value}},{key:"getOrientation",value:function(){return this.orientation$.value}},{key:"isTouchScreen",value:function(){return"ontouchstart"in document.documentElement}},{key:"isMobile",value:function(){return"mobile"===this.getMedia()}},{key:"isDesktop",value:function(){return"desktop"===this.getMedia()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(Yn.Yg))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),qe=function(){return(i=qe||(qe={})).SESSION="Session",i.LOCAL="Local",qe;var i}(),Sn=function(){return(i=Sn||(Sn={})).ADDED="Added",i.MODIFIED="Modified",i.REMOVED="Removed",i.CLEARED="Cleared",Sn;var i}(),Te=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.config=n,this.storageChange$=new x.X(void 0),this.options=this.config.getConfig("storage")||{key:"igo"}}return(0,v.Z)(a,[{key:"get",value:function(t,o){var r;if((!o||o===qe.SESSION)&&(r=sessionStorage.getItem("".concat(this.options.key,".").concat(t))),(o===qe.LOCAL||!r&&!o)&&(r=localStorage.getItem("".concat(this.options.key,".").concat(t))),r)try{r=JSON.parse(r)}catch(s){}return r}},{key:"set",value:function(t,o){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:qe.LOCAL,s=this.get(t,r);r===qe.SESSION?sessionStorage.setItem("".concat(this.options.key,".").concat(t),JSON.stringify(o)):localStorage.setItem("".concat(this.options.key,".").concat(t),JSON.stringify(o));var l=this.get(t,r);l!==s&&this.storageChange$.next({key:t,scope:r,event:void 0!==s?Sn.MODIFIED:Sn.ADDED,previousValue:s,currentValue:l})}},{key:"remove",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qe.LOCAL,r=this.get(t,o);o===qe.SESSION?sessionStorage.removeItem("".concat(this.options.key,".").concat(t)):localStorage.removeItem("".concat(this.options.key,".").concat(t)),this.storageChange$.next({key:t,scope:o,event:Sn.REMOVED,previousValue:r})}},{key:"clear",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qe.LOCAL;t===qe.SESSION?sessionStorage.clear():localStorage.clear(),this.storageChange$.next({scope:t,event:Sn.CLEARED})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(j))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function ya(i,a,n){return i>>a&(1<<n)-1}var pd=function(){var i=function(){function a(){(0,h.Z)(this,a),this.base64Index=new Map,this.indexBase64=new Map,this.generateBase64Index()}return(0,v.Z)(a,[{key:"generateBase64Index",value:function(){for(var t=0;t<26;t++)this.base64Index.set(String.fromCharCode("A".charCodeAt(0)+t),t),this.indexBase64.set(t,String.fromCharCode("A".charCodeAt(0)+t));for(var o=0;o<26;o++)this.base64Index.set(String.fromCharCode("a".charCodeAt(0)+o),o+26),this.indexBase64.set(o+26,String.fromCharCode("a".charCodeAt(0)+o));for(var r=0;r<10;r++)this.base64Index.set(String.fromCharCode("0".charCodeAt(0)+r),r+52),this.indexBase64.set(r+52,String.fromCharCode("0".charCodeAt(0)+r));this.base64Index.set("+",62),this.base64Index.set("/",63),this.indexBase64.set(62,"+"),this.indexBase64.set(63,"/")}},{key:"compressBlob",value:function(t){var o=this;if(t)return new rt.y(function(s){var l=new FileReader;l.readAsDataURL(t),l.onload=function(){var c=l.result.valueOf(),u=c.substr(c.indexOf(",")+1),p=o.compressStringBase64(u);s.next({length:u.length,type:t.type,object:p})}})}},{key:"decompressBlob",value:function(t){for(var s=this.decompressStringBase64(t.object,t.length),l=atob(s),c=new Array(l.length),u=0;u<l.length;u++)c[u]=l.charCodeAt(u);var p=new Uint8Array(c);return new Blob([p],{type:t.type})}},{key:"compressStringBase64",value:function(t){var u,o="",r=16,s=0,l=0,c=(0,D.Z)(t);try{for(c.s();!(u=c.n()).done;){var d=this.base64Index.get(u.value);r>6?s+=d<<(r-=6):(s+=d>>(l=6-r),o+=String.fromCharCode(s),s=d<<16-l,r=16-l)}}catch(g){c.e(g)}finally{c.f()}return t.length%8!=0&&(o+=String.fromCharCode(s)),String.fromCharCode(9731)+o}},{key:"decompressStringBase64",value:function(t,o){if(t){if(9731!==t.charCodeAt(0))return t;for(var r=0,s=0,l=16,c="",u=1,p=t.charCodeAt(u),d=0;d<o;d++)l>6?(r=ya(p,l-=6,6),c+=this.indexBase64.get(r)):(s=6-l,r=ya(p,0,l)<<s,r+=ya(p=t.charCodeAt(++u),16-s,s),c+=this.indexBase64.get(r),l=16-s);return c}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),hi=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.messageService=n,this.injector=t,this.stateChangeEventEmitter=new e.vpe,this.state={connection:window.navigator.onLine},this.checkNetworkState()}return(0,v.Z)(a,[{key:"checkNetworkState",value:function(){var t=this;this.onlineSubscription=(0,In.R)(window,"online").subscribe(function(){t.previousMessageId&&t.messageService.remove(t.previousMessageId);var o=t.injector.get($).translate,r=o.instant("igo.core.network.online.message"),s=o.instant("igo.core.network.online.title"),l=t.messageService.info(r,s);t.previousMessageId=l.toastId,t.state.connection=!0,t.emitEvent()}),this.offlineSubscription=(0,In.R)(window,"offline").subscribe(function(){t.previousMessageId&&t.messageService.remove(t.previousMessageId);var o=t.injector.get($).translate,r=o.instant("igo.core.network.offline.message"),s=o.instant("igo.core.network.offline.title"),l=t.messageService.info(r,s);t.previousMessageId=l.toastId,t.state.connection=!1,t.emitEvent()})}},{key:"emitEvent",value:function(){this.stateChangeEventEmitter.emit(this.state)}},{key:"ngOnDestroy",value:function(){try{this.offlineSubscription.unsubscribe(),this.onlineSubscription.unsubscribe()}catch(t){}}},{key:"currentState",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return t?this.stateChangeEventEmitter.pipe((0,De.b)(300),(0,Hp.O)(this.state)):this.stateChangeEventEmitter.pipe((0,De.b)(300))}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(Ae),e.LFG(e.zs3))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),_a=k(74225),vi=k(26067),ba=k(14437),ge=k(10745),Ca=k(36646),uo=k(87260),Sl=k(32673),po=k(60116),We=k(59295),B=k(44770),ke=k(91434),ie=k(1130),Pe=k(97217),S=k(90587),H=k(56908),dd=k(84128),_t=k(43188),go=k(64316),lr=k(26439),le=k(24683),jn=k(5818),Sa=k(96047),ne=k(34929),$t=k(14700),wa=k(54244),bt=k(70178),z=k(79944),gd=k(24476),fd=k(72754),wl=k(74742),md=k(33865),Ta=k(89502),_e=k(31631),at=function(){return(i=at||(at={})).Default="Default",i.HTML="HTML",i.UnsanitizedHTML="UnsanitizedHTML",i.Editable="Editable",i.Icon="Icon",i.ButtonGroup="ButtonGroup",at;var i}(),Lo=function(){return(i=Lo||(Lo={})).Auto="auto",i.Instant="instant",i.Smooth="smooth",Lo;var i}(),yi=function(){return(i=yi||(yi={})).None="None",i.All="All",i.Some="Some",yi;var i}();function fo(i,a){return(0,_a.t)(i,a).safeObject}function cr(i){var a=i.meta||{};return a.id?a.id:fo(i,a.idProperty||"id")}function en(i){var a=i.meta||{};return a.title?a.title:fo(i,a.titleProperty||"title")}function ur(i){var a=i.meta||{};return a.icon?a.icon:fo(i,a.iconProperty||"icon")}var vd=function(){function i(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,h.Z)(this,i),this.index=new Map,this.change$=new vi.t(1),this.store=a.store?a.store:void 0,this.getKey=a.getKey?a.getKey:this.store?this.store.getKey:cr,this.next()}return(0,v.Z)(i,[{key:"clear",value:function(){this.index.size>0&&(this.index.clear(),this.next())}},{key:"get",value:function(n){return this.index.get(this.getKey(n))||{}}},{key:"set",value:function(n,t){this.setMany([n],t)}},{key:"setMany",value:function(n,t){var o=this;n.forEach(function(r){o.index.set(o.getKey(r),Object.assign({},t))}),this.next()}},{key:"setAll",value:function(n){var t=this;Array.from(this.index.keys()).forEach(function(o){t.index.set(o,Object.assign({},n))}),this.next()}},{key:"update",value:function(n,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.updateMany([n],t,o)}},{key:"updateMany",value:function(n,t){var o=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!0===r)return this.updateManyExclusive(n,t);n.forEach(function(s){var l=Object.assign({},o.get(s),t);o.index.set(o.getKey(s),l)}),this.next()}},{key:"reverse",value:function(n,t){this.reverseMany([n],t)}},{key:"reverseMany",value:function(n,t){var o=this;n.forEach(function(r){var s=o.get(r),l=t.reduce(function(p,d){return p[d]=s[d]||!1,p},{}),c=o.reverseChanges(l),u=Object.assign({},s,c);o.index.set(o.getKey(r),u)}),this.next()}},{key:"updateAll",value:function(n){var t=this,o=this.getAllKeys();Array.from(o).forEach(function(r){var s=Object.assign({},t.index.get(r),n);t.index.set(r,s)}),this.next()}},{key:"updateManyExclusive",value:function(n,t){var o=this,r=this.reverseChanges(t),s=n.map(function(c){return o.getKey(c)});new Set(s.concat(Array.from(this.getAllKeys()))).forEach(function(c){var u=o.index.get(c)||{};s.indexOf(c)>=0?o.index.set(c,Object.assign({},u,t)):!0===Object.keys(r).some(function(d){return void 0!==u[d]&&u[d]!==r[d]})&&o.index.set(c,Object.assign({},u,r))}),this.next()}},{key:"reverseChanges",value:function(n){return Object.entries(n).reduce(function(t,o){var r=(0,Qe.Z)(o,2),l=r[1];return"boolean"==typeof l&&(t[r[0]]=!l),t},{})}},{key:"getAllKeys",value:function(){var n=this.store?Array.from(this.store.index.keys()):[];return new Set(Array.from(this.index.keys()).concat(n))}},{key:"next",value:function(){this.change$.next()}}]),i}(),xl=function(){function i(a){(0,h.Z)(this,i),this.source$=a,this.values$=new x.X([]),this.lifted=!1,this.joins=[],this.filter$=new x.X(void 0),this.filters$=new x.X([]),this.filterIndex=new Map,this.sort$=new x.X(void 0),this.getKey$=new x.X(void 0),this.count$=new x.X(0),this.empty$=new x.X(!0)}return(0,v.Z)(i,[{key:"getKey",get:function(){return this.getKey$.value}},{key:"count",get:function(){return this.count$.value}},{key:"empty",get:function(){return this.empty$.value}},{key:"index",get:function(){return this._index}},{key:"get",value:function(n){if(void 0===this._index)throw new Error("This view has no index, therefore, this method is unavailable.");return this.index.get(n)}},{key:"all",value:function(){return this.values$.value}},{key:"all$",value:function(){return this.values$}},{key:"firstBy",value:function(n){return this.values$.value.find(n)}},{key:"firstBy$",value:function(n){return this.values$.pipe((0,U.U)(function(t){return t.find(n)}))}},{key:"manyBy",value:function(n){return this.values$.value.filter(n)}},{key:"manyBy$",value:function(n){return this.values$.pipe((0,U.U)(function(t){return t.filter(n)}))}},{key:"clear",value:function(){this.filter(void 0),this.sort(void 0)}},{key:"destroy",value:function(){void 0!==this.values$$&&this.values$$.unsubscribe(),this.clear()}},{key:"createIndex",value:function(n){return this._index=new Map,this.getKey$.next(n),this}},{key:"join",value:function(n){if(!0===this.lifted)throw new Error("This view has already been lifted, therefore, no join is allowed.");return this.joins.push(n),this}},{key:"filter",value:function(n){return this.filter$.next(n),this}},{key:"addFilter",value:function(n){var t=Ye();return this.filterIndex.set(t,n),this.filters$.next(Array.from(this.filterIndex.values())),t}},{key:"removeFilter",value:function(n){this.filterIndex.delete(n),this.filters$.next(Array.from(this.filterIndex.values()))}},{key:"sort",value:function(n){return this.sort$.next(n),this}},{key:"lift",value:function(){var n=this;this.lifted=!0;var t=this.joins.length>0?this.liftJoinedSource():this.liftSource();this.values$$=(0,dt.a)([t,this.filters$,this.filter$,this.sort$,this.getKey$]).pipe((0,uo.T)(1),(0,De.b)(5)).subscribe(function(r){var s=(0,Qe.Z)(r,5),d=s[4],g=n.processValues(s[0],s[1],s[2],s[3]);n.setValues(g,void 0!==d)})}},{key:"liftSource",value:function(){return this.source$}},{key:"liftJoinedSource",value:function(){var n=this,t=[this.source$,(0,dt.a)(this.joins.map(function(o){return o.source}))];return(0,dt.a)(t).pipe((0,U.U)(function(o){var r=(0,Qe.Z)(o,2),l=r[1];return r[0].reduce(function(c,u){var p=n.computeJoinedValue(u,l);return void 0!==p&&c.push(p),c},[])}))}},{key:"computeJoinedValue",value:function(n,t){for(var o=n,r=0;void 0!==o&&r<this.joins.length;)o=this.joins[r].reduce(o,t[r]),r+=1;return o}},{key:"processValues",value:function(n,t,o,r){return n=n.slice(0),n=this.filterValues(n,t.concat([o])),this.sortValues(n,r)}},{key:"filterValues",value:function(n,t){return 0===t.length?n:n.filter(function(o){return t.filter(function(r){return void 0!==r}).every(function(r){return r(o)})})}},{key:"sortValues",value:function(n,t){return void 0===t?n:n.sort(function(o,r){return se.naturalCompare(t.valueAccessor(o),t.valueAccessor(r),t.direction,t.nullsFirst)})}},{key:"setValues",value:function(n,t){!0===t&&(this._index=this.generateIndex(n)),this.values$.next(n);var o=n.length,r=0===o;this.count$.next(o),this.empty$.next(r)}},{key:"generateIndex",value:function(n){var t=this,o=n.map(function(r){return[t.getKey(r),r]});return new Map(o)}}]),i}(),mt=function(){function i(a){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,h.Z)(this,i),this.entities$=new x.X([]),this.count$=new x.X(0),this.empty$=new x.X(!0),this._pristine=!0,this.strategies=[],this.getKey=n.getKey?n.getKey:cr,this.getProperty=n.getProperty?n.getProperty:fo,this.state=this.createStateManager(),this.view=this.createDataView(),this.stateView=this.createStateView(),this.view.lift(),this.stateView.lift(),a.length>0?this.load(a):this._index=this.generateIndex(a)}return(0,v.Z)(i,[{key:"count",get:function(){return this.count$.value}},{key:"empty",get:function(){return this.empty$.value}},{key:"index",get:function(){return this._index}},{key:"pristine",get:function(){return this._pristine}},{key:"get",value:function(n){return this.index.get(n)}},{key:"all",value:function(){return this.entities$.value}},{key:"load",value:function(n){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._index=this.generateIndex(n),this._pristine=t,this.next()}},{key:"softClear",value:function(){this.index&&this.index.size>0?(this.index.clear(),this._pristine=!0,this.next()):this.index&&this.updateCount()}},{key:"clear",value:function(){this.stateView.clear(),this.view.clear(),this.state.clear(),this.softClear()}},{key:"destroy",value:function(){this.stateView.destroy(),this.view.destroy(),this.clear()}},{key:"insert",value:function(n){this.insertMany([n])}},{key:"insertMany",value:function(n){var t=this;n.forEach(function(o){return t.index.set(t.getKey(o),o)}),this._pristine=!1,this.next()}},{key:"update",value:function(n){this.updateMany([n])}},{key:"updateMany",value:function(n){var t=this;n.forEach(function(o){return t.index.set(t.getKey(o),o)}),this._pristine=!1,this.next()}},{key:"delete",value:function(n){this.deleteMany([n])}},{key:"deleteMany",value:function(n){var t=this;n.forEach(function(o){return t.index.delete(t.getKey(o))}),this._pristine=!1,this.next()}},{key:"addStrategy",value:function(n){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=this.strategies.find(function(r){return n.constructor===r.constructor});if(void 0!==o)throw new Error("A strategy of this type already exists on that EntityStore.");return this.strategies.push(n),n.bindStore(this),!0===t&&n.activate(),this}},{key:"removeStrategy",value:function(n){var t=this.strategies.indexOf(n);return t>=0&&(this.strategies.splice(t,1),n.unbindStore(this)),this}},{key:"getStrategyOfType",value:function(n){return this.strategies.find(function(t){return t instanceof n})}},{key:"activateStrategyOfType",value:function(n){var t=this.getStrategyOfType(n);void 0!==t&&t.activate()}},{key:"deactivateStrategyOfType",value:function(n){var t=this.getStrategyOfType(n);void 0!==t&&t.deactivate()}},{key:"generateIndex",value:function(n){var t=this,o=n.map(function(r){return[t.getKey(r),r]});return new Map(o)}},{key:"next",value:function(){this.entities$.next(Array.from(this.index.values())),this.updateCount()}},{key:"updateCount",value:function(){var n=this.index.size,t=0===n;this.count$.next(n),this.empty$.next(t)}},{key:"createStateManager",value:function(){return new vd({store:this})}},{key:"createDataView",value:function(){return new xl(this.entities$)}},{key:"createStateView",value:function(){var n=this;return new xl(this.view.all$()).join({source:this.state.change$,reduce:function(o){var r=n.getKey(o),s=n.state.get(o),l=n.stateView.get(r);if(void 0!==l&&l.entity===o&&n.statesAreTheSame(l.state,s))return l;var c=l?l.revision+1:1;return{entity:o,state:s,revision:c,ref:"".concat(r,"-").concat(c)}}}).createIndex(function(t){return n.getKey(t.entity)})}},{key:"statesAreTheSame",value:function(n,t){if(n===t)return!0;var o=0===Object.keys(n).length,r=0===Object.keys(t).length;return o&&r}}]),i}(),_i=function(){function i(a,n){(0,h.Z)(this,i),this.innerStateIndex=new Map,this.setChangeDetector(n),this.setStore(a)}return(0,v.Z)(i,[{key:"destroy",value:function(){this.setChangeDetector(void 0),this.setStore(void 0)}},{key:"setStore",value:function(n){if(void 0===n)return this.teardownObservers(),this.innerStateIndex.clear(),void(this.store=void 0);this.setStore(void 0),this.store=n,this.setupObservers(),this.detectChanges()}},{key:"setChangeDetector",value:function(n){this.cdRef=n}},{key:"setupObservers",value:function(){var n=this;this.teardownObservers(),this.entities$$=this.store.entities$.subscribe(function(t){return n.onEntitiesChange(t)}),this.state$$=this.store.state.change$.pipe((0,uo.T)(1)).subscribe(function(){return n.onStateChange()})}},{key:"teardownObservers",value:function(){void 0!==this.entities$$&&this.entities$$.unsubscribe(),void 0!==this.state$$&&this.state$$.unsubscribe(),this.entities$$=void 0,this.state$$=void 0}},{key:"onEntitiesChange",value:function(n){this.detectChanges()}},{key:"onStateChange",value:function(){var n=!1,t=this.store.state.index,o=this.innerStateIndex;t.size!==o.size&&(n=this.detectChanges());for(var s=0,l=Array.from(t.keys());s<l.length;s++){var c=l[s],u=t.get(c),p=o.get(c);!1===n&&(void 0===p?n=this.detectChanges():se.objectsAreEquivalent(u,p)||(n=this.detectChanges())),this.innerStateIndex.set(c,Object.assign({},u))}}},{key:"detectChanges",value:function(){return void 0!==this.cdRef&&this.cdRef.detectChanges(),!0}}]),i}(),mo=function(){function i(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,h.Z)(this,i),this.options=a,this.stores=[],this.active$=new x.X(!1),this.options=a}return(0,v.Z)(i,[{key:"active",get:function(){return this.active$.value}},{key:"activate",value:function(){!0===this.active&&this.doDeactivate(),this.active$.next(!0),this.doActivate()}},{key:"deactivate",value:function(){this.active$.next(!1),this.doDeactivate()}},{key:"bindStore",value:function(n){this.stores.indexOf(n)<0&&this.stores.push(n)}},{key:"unbindStore",value:function(n){var t=this.stores.indexOf(n);t>=0&&this.stores.splice(t,1)}},{key:"doActivate",value:function(){}},{key:"doDeactivate",value:function(){}}]),i}(),Qt=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t){var o;return(0,h.Z)(this,n),(o=a.call(this,t)).options=t,o.filters=new Map,o}return(0,v.Z)(n,[{key:"bindStore",value:function(o){(0,Se.Z)((0,we.Z)(n.prototype),"bindStore",this).call(this,o),!0===this.active&&this.filterStore(o)}},{key:"unbindStore",value:function(o){(0,Se.Z)((0,we.Z)(n.prototype),"unbindStore",this).call(this,o),!0===this.active&&this.unfilterStore(o)}},{key:"doActivate",value:function(){this.filterAll()}},{key:"doDeactivate",value:function(){this.unfilterAll()}},{key:"filterAll",value:function(){var o=this;this.stores.forEach(function(r){return o.filterStore(r)})}},{key:"unfilterAll",value:function(){var o=this;this.stores.forEach(function(r){return o.unfilterStore(r)})}},{key:"filterStore",value:function(o){this.filters.set(o,o.stateView.addFilter(this.options.filterClauseFunc))}},{key:"unfilterStore",value:function(o){var r=this.filters.get(o);void 0!==r&&(o.stateView.removeFilter(r),this.filters.delete(o))}}]),n}(mo),On=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){var t;return(0,h.Z)(this,n),(t=a.apply(this,arguments)).filters=new Map,t}return(0,v.Z)(n,[{key:"bindStore",value:function(o){(0,Se.Z)((0,we.Z)(n.prototype),"bindStore",this).call(this,o),!0===this.active&&this.filterStore(o)}},{key:"unbindStore",value:function(o){(0,Se.Z)((0,we.Z)(n.prototype),"unbindStore",this).call(this,o),!0===this.active&&this.unfilterStore(o)}},{key:"doActivate",value:function(){this.filterAll()}},{key:"doDeactivate",value:function(){this.unfilterAll()}},{key:"filterAll",value:function(){var o=this;this.stores.forEach(function(r){return o.filterStore(r)})}},{key:"unfilterAll",value:function(){var o=this;this.stores.forEach(function(r){return o.unfilterStore(r)})}},{key:"filterStore",value:function(o){this.filters.has(o)||this.filters.set(o,o.stateView.addFilter(function(l){return!0===l.state.selected}))}},{key:"unfilterStore",value:function(o){var r=this.filters.get(o);void 0!==r&&(o.stateView.removeFilter(r),this.filters.delete(o))}}]),n}(mo);function yd(i,a){if(1&i&&(e.TgZ(0,"mat-option",4),e._uU(1),e.qZA()),2&i){var n=e.oxw();e.Q6J("value",n.emptyValue),e.xp6(1),e.Oqu(n.emptyText)}}function _d(i,a){if(1&i&&(e.TgZ(0,"mat-option",4),e._uU(1),e.ALo(2,"async"),e.qZA()),2&i){var n=e.oxw();e.Q6J("value",n.multiSelectValue),e.xp6(1),e.Oqu(e.lcZ(2,2,n.multiText$))}}function bd(i,a){if(1&i&&(e.TgZ(0,"mat-option",4),e._uU(1),e.qZA()),2&i){var n=a.$implicit,t=e.oxw();e.Q6J("value",n.entity),e.xp6(1),e.hij(" ",t.titleAccessor(n.entity)," ")}}var kl=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.cdRef=n,this.selected$=new x.X(void 0),this.multiText$=new x.X(void 0),this.multiSelectValue={id:"IGO_MULTI_SELECT"},this.emptyValue={id:"IGO_EMPTY_SELECT"},this.titleAccessor=en,this.emptyText=void 0,this.multi=!1,this.multiAllText="All",this.multiNoneText="None",this.disabled=!1,this.selectedChange=new e.vpe}return(0,v.Z)(a,[{key:"ngOnInit",value:function(){var t=this;this.watcher=new _i(this.store,this.cdRef),this.selected$$=this.store.stateView.manyBy$(function(o){return!0===o.state.selected}).subscribe(function(o){var r=o.map(function(s){return s.entity});t.onSelectFromStore(r)})}},{key:"ngOnDestroy",value:function(){this.watcher.destroy(),this.selected$$.unsubscribe()}},{key:"onSelectionChange",value:function(t){var o=this,r=t.value instanceof Array?t.value:[t.value],s=r.find(function(u){return u===o.multiSelectValue}),l=r.filter(function(u){return u!==o.multiSelectValue});void 0!==s&&(l.length===this.store.count?l=[]:l.length<this.store.count&&(l=this.store.all())),0===(l=l.filter(function(u){return u!==o.emptyValue})).length?this.store.state.updateAll({selected:!1}):this.store.state.updateMany(l,{selected:!0},!0),this.selectedChange.emit({selected:!0,value:this.multi?l:t.value})}},{key:"onSelectFromStore",value:function(t){this.selected$.next(!0===this.multi?t:t.length>0?t[0]:void 0),this.updateMultiToggleWithEntities(t)}},{key:"updateMultiToggleWithEntities",value:function(t){t.length===this.store.count&&this.multiText$.value!==this.multiNoneText?this.multiText$.next(this.multiNoneText):t.length<this.store.count&&this.multiText$.value!==this.multiAllText&&this.multiText$.next(this.multiAllText)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-entity-selector"]],inputs:{store:"store",titleAccessor:"titleAccessor",emptyText:"emptyText",multi:"multi",multiAllText:"multiAllText",multiNoneText:"multiNoneText",placeholder:"placeholder",disabled:"disabled"},outputs:{selectedChange:"selectedChange"},decls:7,vars:11,consts:[[1,"igo-entity-selector"],[3,"disabled","value","multiple","placeholder","selectionChange"],[3,"value",4,"ngIf"],["ngFor","",3,"ngForOf"],[3,"value"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-form-field",0)(1,"mat-select",1),e.NdJ("selectionChange",function(r){return t.onSelectionChange(r)}),e.ALo(2,"async"),e.YNc(3,yd,2,2,"mat-option",2),e.YNc(4,_d,3,4,"mat-option",2),e.YNc(5,bd,2,2,"ng-template",3),e.ALo(6,"async"),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("disabled",t.disabled)("value",e.lcZ(2,7,t.selected$))("multiple",t.multi)("placeholder",t.placeholder),e.xp6(2),e.Q6J("ngIf",void 0!==t.emptyText&&!1===t.multi),e.xp6(1),e.Q6J("ngIf",!0===t.multi),e.xp6(1),e.Q6J("ngForOf",e.lcZ(6,9,t.store.stateView.all$())))},dependencies:[C.sg,C.O5,B.KE,ke.gD,ie.ey,C.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"],changeDetection:0}),i}(),Oo=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,[{key:"onClick",value:function(t){t.stopPropagation()}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275dir=e.lG2({type:i,selectors:[["","igoStopPropagation",""]],hostBindings:function(n,t){1&n&&e.NdJ("click",function(r){return t.onClick(r)})}}),i}(),Ml=function(){var i=function(){function a(n,t){var o=this;(0,h.Z)(this,a),this.languageService=n,this.mediaService=t,this.disabled=!1,this.hidePageSize=!1,this.pageIndex=0,this.pageSize=50,this.pageSizeOptions=[5,10,20,50,100,200],this.showFirstLastButtons=!0,this.paginationLabelTranslation$$=[],this.entitySortChange$=new x.X(!1),this.length=0,this.paginatorChange=new e.vpe,this.rangeLabel=function(r,s,l){var c=new x.X("");if(o.paginationLabelTranslation$$.push(o.languageService.translate.get("igo.common.paginator.of").subscribe(function(d){c.next(d)})),0===l||0===s)return"0 ".concat(c.value," ").concat(l);var u=r*s,p=u<(l=Math.max(l,0))?Math.min(u+s,l):u+s;return"".concat(u+1," - ").concat(p," ").concat(c.value," ").concat(l)}}return(0,v.Z)(a,[{key:"ngOnChanges",value:function(){var t=this;this.unsubscribeAll(),this.count$$=this.store.stateView.count$.subscribe(function(o){t.length=o,t.emitPaginator()}),this.entitySortChange$$=this.entitySortChange$.subscribe(function(){t.paginator&&t.paginator.firstPage()}),this.initPaginatorOptions(),this.translateLabels()}},{key:"initPaginatorOptions",value:function(){var t,o,r,s,l,c;this.disabled=(null===(t=this.paginatorOptions)||void 0===t?void 0:t.disabled)||this.disabled,this.pageIndex=(null===(o=this.paginatorOptions)||void 0===o?void 0:o.pageIndex)||this.pageIndex,this.pageSize=(null===(r=this.paginatorOptions)||void 0===r?void 0:r.pageSize)||this.pageSize,this.pageSizeOptions=(null===(s=this.paginatorOptions)||void 0===s?void 0:s.pageSizeOptions)||this.pageSizeOptions,this.mediaService.isMobile()?(this.showFirstLastButtons=!1,this.hidePageSize=!0):(this.showFirstLastButtons=(null===(l=this.paginatorOptions)||void 0===l?void 0:l.showFirstLastButtons)||this.showFirstLastButtons,this.hidePageSize=(null===(c=this.paginatorOptions)||void 0===c?void 0:c.hidePageSize)||this.hidePageSize)}},{key:"translateLabels",value:function(){var t=this;this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.firstPageLabel").subscribe(function(o){t.paginator._intl.firstPageLabel=o})),this.paginator._intl.getRangeLabel=this.rangeLabel,this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.itemsPerPageLabel").subscribe(function(o){t.paginator._intl.itemsPerPageLabel=o})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.lastPageLabel").subscribe(function(o){t.paginator._intl.lastPageLabel=o})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.nextPageLabel").subscribe(function(o){t.paginator._intl.nextPageLabel=o})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.previousPageLabel").subscribe(function(o){t.paginator._intl.previousPageLabel=o}))}},{key:"unsubscribeAll",value:function(){this.paginationLabelTranslation$$.map(function(t){return t.unsubscribe()}),this.count$$&&this.count$$.unsubscribe(),this.entitySortChange$$&&this.entitySortChange$$.unsubscribe()}},{key:"ngOnDestroy",value:function(){this.unsubscribeAll()}},{key:"emitPaginator",value:function(){this.paginatorChange.emit(this.paginator)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(xt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-entity-table-paginator"]],viewQuery:function(n,t){var o;1&n&&e.Gf(lr.NW,7),2&n&&e.iGM(o=e.CRH())&&(t.paginator=o.first)},inputs:{entitySortChange$:"entitySortChange$",store:"store",paginatorOptions:"paginatorOptions"},outputs:{page:"page",paginatorChange:"paginatorChange"},features:[e.TTD],decls:1,vars:7,consts:[[3,"disabled","hidePageSize","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons","page"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-paginator",0),e.NdJ("page",function(){return t.emitPaginator()}),e.qZA()),2&n&&e.Q6J("disabled",t.disabled)("hidePageSize",t.hidePageSize)("length",t.length)("pageIndex",t.pageIndex)("pageSize",t.pageSize)("pageSizeOptions",t.pageSizeOptions)("showFirstLastButtons",t.showFirstLastButtons)},dependencies:[lr.NW],styles:["[_nghost-%COMP%]{margin-top:-10px;padding-right:15px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]{margin-top:0;padding-right:5px}}"],changeDetection:0}),i}(),xa=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.el=n,this.errorImageUrl="./assets/igo2/common/images/na.png",this.hideError=!1}return(0,v.Z)(a,[{key:"onError",value:function(t){this.hideError?this.el.nativeElement.style.display="none":t.target.src=this.errorImageUrl}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.SBq))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoImageError",""]],hostBindings:function(n,t){1&n&&e.NdJ("error",function(r){return t.onError(r)})},inputs:{errorImageUrl:"errorImageUrl",hideError:"hideError"}}),i}(),Cd=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.renderer=n,this.el=t,this.selection=!1,this.selectOnClick=!0,this.highlightSelection=!0,this._selected=!1,this.scrollBehavior=Lo.Auto,this.select=new e.vpe}return(0,v.Z)(a,[{key:"selected",get:function(){return this._selected},set:function(t){!1!==this.selection&&t!==this._selected&&(this.toggleSelected(t),this.scroll())}},{key:"onClick",value:function(){!1===this.selection||!1===this.selectOnClick||(this.toggleSelected(!0),this.select.emit(this))}},{key:"toggleSelected",value:function(t){this._selected=t,!0===t?(this.addCls(a.selectedCls),!0===this.highlightSelection&&this.addCls(a.highlightedCls)):(this.removeCls(a.selectedCls),this.removeCls(a.highlightedCls))}},{key:"scroll",value:function(){!0===this._selected&&(0,Sa.Z)(this.el.nativeElement,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})}},{key:"addCls",value:function(t){this.renderer.addClass(this.el.nativeElement,t)}},{key:"removeCls",value:function(t){this.renderer.removeClass(this.el.nativeElement,t)}}]),a}();return i.selectedCls="igo-entity-table-row-selected",i.highlightedCls="igo-entity-table-row-highlighted",i.\u0275fac=function(n){return new(n||i)(e.Y36(e.Qsj),e.Y36(e.SBq))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoEntityTableRow",""]],hostBindings:function(n,t){1&n&&e.NdJ("click",function(){return t.onClick()})},inputs:{selection:"selection",selectOnClick:"selectOnClick",highlightSelection:"highlightSelection",selected:"selected",scrollBehavior:"scrollBehavior"},outputs:{select:"select"}}),i}(),pr=function(){var i=function(){function a(n){(0,h.Z)(this,a),this._sanitizer=n}return(0,v.Z)(a,[{key:"transform",value:function(t){return this._sanitizer.bypassSecurityTrustHtml(t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Tt.H7,16))},i.\u0275pipe=e.Yjl({name:"sanitizeHtml",type:i,pure:!0}),i}(),dr=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.http=n,this.configService=t}return(0,v.Z)(a,[{key:"transform",value:function(t){var o,r=new W.WM({"Content-Type":"text/plain",activityInterceptor:"false",interceptError:"false"}),s=new RegExp((null===(o=this.configService)||void 0===o?void 0:o.getConfig("depot.url"))+'.*?(?="|$)');return s.test(t)&&(t=t.match(s)[0]),this.http.get(t,{headers:r,responseType:"blob"}).pipe((0,Ze.K)(function(l){throw l.error.caught=!0,l.error.toDisplay=!1,l}),(0,Sl.w)(function(l){return new rt.y(function(c){var u=new FileReader;u.readAsDataURL(l),u.onloadend=function(){c.next(u.result),c.complete()}})}))}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(W.eN,16),e.Y36(j,16))},i.\u0275pipe=e.Yjl({name:"secureImage",type:i,pure:!0}),(0,ne.gn)([(0,$t.q)({maxCacheCount:20})],i.prototype,"transform",null),i}();function Sd(i,a){if(1&i){var n=e.EpF();e.ynx(0),e.TgZ(1,"mat-checkbox",11),e.NdJ("change",function(s){e.CHM(n);var l=e.oxw(3);return e.KtG(l.onToggleRows(s.checked))}),e.qZA(),e.BQk()}if(2&i){var t=a.ngIf,o=e.oxw(3);e.xp6(1),e.Q6J("checked",t===o.entityTableSelectionState.All)("indeterminate",t===o.entityTableSelectionState.Some)}}function wd(i,a){if(1&i&&(e.ynx(0),e.YNc(1,Sd,2,2,"ng-container",10),e.ALo(2,"async"),e.BQk()),2&i){var n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,n.selectionState$))}}function Td(i,a){if(1&i&&(e.TgZ(0,"th",9),e.YNc(1,wd,3,3,"ng-container",10),e.qZA()),2&i){var n=e.oxw();e.xp6(1),e.Q6J("ngIf",n.selectMany)}}function xd(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"td",12)(1,"mat-checkbox",13),e.NdJ("mousedown",function(s){return s.shiftKey?s.preventDefault():null})("click",function(s){var c=e.CHM(n).$implicit,u=e.oxw();return e.KtG(s.shiftKey?u.onShiftToggleRow(!u.rowIsSelected(c),c,s):s.stopPropagation())})("change",function(s){var c=e.CHM(n).$implicit,u=e.oxw();return e.KtG(u.onToggleRow(s.checked,c))}),e.qZA()()}if(2&i){var t=a.$implicit,o=e.oxw();e.xp6(1),e.Q6J("checked",o.rowIsSelected(t))}}function kd(i,a){if(1&i&&(e.TgZ(0,"th",16),e._uU(1),e.qZA()),2&i){var n=e.oxw(2).$implicit;e.Q6J("matTooltip",n.tooltip?n.tooltip:void 0),e.xp6(1),e.hij(" ",n.title," ")}}function Md(i,a){1&i&&(e.ynx(0),e.YNc(1,kd,2,2,"th",15),e.BQk())}function Fd(i,a){if(1&i&&(e.TgZ(0,"th",18),e._uU(1),e.qZA()),2&i){var n=e.oxw(2).$implicit;e.Q6J("matTooltip",n.tooltip?n.tooltip:void 0),e.xp6(1),e.hij(" ",n.title," ")}}function Zd(i,a){1&i&&(e.ynx(0),e.YNc(1,Fd,2,2,"th",17),e.BQk())}function Ad(i,a){if(1&i&&(e.TgZ(0,"td",22),e._uU(1),e.qZA()),2&i){var n=e.oxw().$implicit,t=e.oxw(3).$implicit,o=e.oxw();e.Q6J("ngClass",o.getCellClass(n,t)),e.xp6(1),e.hij(" ",o.getValue(n,t)," ")}}function Id(i,a){if(1&i&&(e._UZ(0,"img",26),e.ALo(1,"async"),e.ALo(2,"secureImage")),2&i){var n=e.oxw(2).$implicit,t=e.oxw(3).$implicit,o=e.oxw();e.s9C("src",e.lcZ(1,1,e.lcZ(2,3,o.getValue(n,t))),e.LSH)}}function Ld(i,a){1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.common.entity-table.targetHtmlUrl")," "))}function Od(i,a){if(1&i&&(e.TgZ(0,"td",22)(1,"a",23),e.NdJ("click",function(l){return l.stopPropagation()}),e.YNc(2,Id,3,5,"img",24),e.YNc(3,Ld,3,3,"ng-template",null,25,e.W1O),e.qZA()()),2&i){var n=e.MAs(4),t=e.oxw().$implicit,o=e.oxw(3).$implicit,r=e.oxw();e.Q6J("ngClass",r.getCellClass(t,o)),e.xp6(1),e.s9C("href",r.getValue(t,o),e.LSH),e.xp6(1),e.Q6J("ngIf",r.isImg(r.getValue(t,o)))("ngIfElse",n)}}function Dd(i,a){if(1&i&&(e.ynx(0),e.YNc(1,Ad,2,2,"td",20),e.YNc(2,Od,5,4,"ng-template",null,21,e.W1O),e.BQk()),2&i){var n=a.$implicit,t=e.MAs(3),o=e.oxw(3).$implicit,r=e.oxw();e.xp6(1),e.Q6J("ngIf",!r.isUrl(r.getValue(n,o)))("ngIfElse",t)}}function Pd(i,a){1&i&&(e.ynx(0),e.YNc(1,Dd,4,2,"ng-container",19),e.BQk())}function Ed(i,a){if(1&i&&e._UZ(0,"td",29),2&i){var n=e.oxw().$implicit,t=e.oxw(3).$implicit,o=e.oxw();e.Q6J("ngClass",o.getCellClass(n,t))("innerHTML",o.getValue(n,t),e.oJD)}}function $d(i,a){if(1&i&&(e._UZ(0,"img",26),e.ALo(1,"async"),e.ALo(2,"secureImage")),2&i){var n=e.oxw(2).$implicit,t=e.oxw(3).$implicit,o=e.oxw();e.s9C("src",e.lcZ(1,1,e.lcZ(2,3,o.getValue(n,t))),e.LSH)}}function Rd(i,a){1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.targetHtmlUrl")," "))}function Jd(i,a){if(1&i&&(e.TgZ(0,"td",22)(1,"a",23),e.NdJ("click",function(l){return l.stopPropagation()}),e.YNc(2,$d,3,5,"img",24),e.YNc(3,Rd,3,3,"ng-template",null,25,e.W1O),e.qZA()()),2&i){var n=e.MAs(4),t=e.oxw().$implicit,o=e.oxw(3).$implicit,r=e.oxw();e.Q6J("ngClass",r.getCellClass(t,o)),e.xp6(1),e.s9C("href",r.getValue(t,o),e.LSH),e.xp6(1),e.Q6J("ngIf",r.isImg(r.getValue(t,o)))("ngIfElse",n)}}function Bd(i,a){if(1&i&&(e.ynx(0),e.YNc(1,Ed,1,2,"td",27),e.YNc(2,Jd,5,4,"ng-template",null,28,e.W1O),e.BQk()),2&i){var n=a.$implicit,t=e.MAs(3),o=e.oxw(3).$implicit,r=e.oxw();e.xp6(1),e.Q6J("ngIf",!r.isUrl(r.getValue(n,o)))("ngIfElse",t)}}function Ud(i,a){1&i&&(e.ynx(0),e.YNc(1,Bd,4,2,"ng-container",19),e.BQk())}function Nd(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",43),e._UZ(1,"mat-datepicker-toggle",44),e.TgZ(2,"input",45),e.NdJ("dateChange",function(c){e.CHM(n);var u=e.oxw(2).$implicit,p=e.oxw(3).$implicit,d=e.oxw();return e.KtG(d.onDateChange(p.name,u,c))}),e.qZA(),e._UZ(3,"mat-datepicker",null,46),e.qZA()}if(2&i){var t=e.MAs(4),o=e.oxw(2).$implicit,r=e.oxw(3).$implicit,s=e.oxw();e.xp6(1),e.Q6J("for",t),e.xp6(1),e.s9C("value",s.getValue(o,r)),e.Q6J("matDatepicker",t)("formControlName",r.name)}}function qd(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"input",47),e.NdJ("focus",function(r){e.CHM(n);var s=e.oxw(5).$implicit;return e.KtG(s.onFocus(r))})("keypress",function(r){e.CHM(n);var s=e.oxw(5).$implicit;return e.KtG(s.onChange(r))})("blur",function(r){e.CHM(n);var s=e.oxw(5).$implicit;return e.KtG(s.onBlur(r))}),e.qZA()}if(2&i){var t=e.oxw(5).$implicit;e.Q6J("formControlName",t.name)}}function Gd(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"input",48),e.NdJ("input",function(l){e.CHM(n);var c=e.oxw(2).$implicit,u=e.oxw(3).$implicit,p=e.oxw();return e.KtG(p.onValueChange(u.name,c,l))}),e.qZA()}if(2&i){var t=e.oxw(2).$implicit,o=e.oxw(3).$implicit,r=e.oxw();e.s9C("step",o.step),e.s9C("value",r.getValue(t,o)),e.s9C("readonly",r.getValidationAttributeValue(o,"readonly")),e.s9C("required",r.getValidationAttributeValue(o,"mandatory")),e.s9C("min",r.getValidationAttributeValue(o,"minValue")),e.s9C("max",r.getValidationAttributeValue(o,"maxValue")),e.Q6J("formControlName",o.name)}}function Qd(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"input",49),e.NdJ("input",function(l){e.CHM(n);var c=e.oxw(2).$implicit,u=e.oxw(3).$implicit,p=e.oxw();return e.KtG(p.onValueChange(u.name,c,l))}),e.qZA()}if(2&i){var t=e.oxw(2).$implicit,o=e.oxw(3).$implicit,r=e.oxw();e.s9C("value",r.getValue(t,o)),e.s9C("readonly",r.getValidationAttributeValue(o,"readonly")),e.s9C("required",r.getValidationAttributeValue(o,"mandatory")),e.Q6J("formControlName",o.name)}}function Yd(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-checkbox",50),e.NdJ("change",function(l){e.CHM(n);var c=e.oxw(2).$implicit,u=e.oxw(3).$implicit,p=e.oxw();return e.KtG(p.onBooleanValueChange(u.name,c,l))}),e.qZA()}if(2&i){var t=e.oxw(2).$implicit,o=e.oxw(3).$implicit,r=e.oxw();e.Q6J("formControlName",o.name)("checked",r.getValue(t,o))}}function jd(i,a){if(1&i&&(e.TgZ(0,"mat-option",53),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n.id)("disabled",n.disabled),e.xp6(1),e.hij(" ",n.value," ")}}function Hd(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-select",51),e.NdJ("selectionChange",function(l){e.CHM(n);var c=e.oxw(2).$implicit,u=e.oxw(3).$implicit,p=e.oxw();return e.KtG(p.onSelectValueChange(u.name,c,l))}),e.YNc(1,jd,2,3,"mat-option",52),e.qZA()}if(2&i){var t=e.oxw(2).$implicit,o=e.oxw(3).$implicit,r=e.oxw();e.s9C("required",r.getValidationAttributeValue(o,"mandatory")),e.Q6J("formControlName",o.name)("multiple",o.multiple)("value",r.getValue(t,o)),e.xp6(1),e.Q6J("ngForOf",o.domainValues)}}function Vd(i,a){if(1&i&&e._UZ(0,"input",54),2&i){e.oxw();var n=e.MAs(9),t=e.oxw().$implicit,o=e.oxw(3).$implicit,r=e.oxw();e.s9C("required",r.getValidationAttributeValue(o,"mandatory")),e.s9C("value",r.getValue(t,o)),e.s9C("readonly",r.getValidationAttributeValue(o,"readonly")),e.Q6J("formControlName",o.name)("matAutocomplete",n)}}function zd(i,a){if(1&i&&(e.TgZ(0,"mat-option",55),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n.id),e.xp6(1),e.hij(" ",n.value," ")}}function Wd(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"td",32),e.YNc(1,Nd,5,4,"div",33),e.YNc(2,qd,1,1,"input",34),e.YNc(3,Gd,1,7,"input",35),e.YNc(4,Qd,1,4,"input",36),e.YNc(5,Yd,1,2,"mat-checkbox",37),e.YNc(6,Hd,2,5,"mat-select",38),e.YNc(7,Vd,1,5,"input",39),e.TgZ(8,"mat-autocomplete",40,41),e.NdJ("optionSelected",function(l){e.CHM(n);var c=e.oxw().$implicit,u=e.oxw(3).$implicit,p=e.oxw();return e.KtG(p.onAutocompleteValueChange(u,c,l))}),e.YNc(10,zd,2,2,"mat-option",42),e.ALo(11,"async"),e.qZA()()}if(2&i){var t=e.oxw().$implicit,o=e.oxw(3).$implicit,r=e.oxw();e.Q6J("formGroup",r.formGroup)("ngClass",r.getCellClass(t,o)),e.xp6(1),e.Q6J("ngIf","date"===o.type),e.xp6(1),e.Q6J("ngIf","time"===o.type),e.xp6(1),e.Q6J("ngIf","number"===o.type),e.xp6(1),e.Q6J("ngIf",!o.type||"string"===o.type),e.xp6(1),e.Q6J("ngIf","boolean"===o.type),e.xp6(1),e.Q6J("ngIf","list"===o.type),e.xp6(1),e.Q6J("ngIf","autocomplete"===o.type),e.xp6(3),e.Q6J("ngForOf",e.lcZ(11,10,r.filteredOptions[o.name]))}}function Kd(i,a){if(1&i&&(e._UZ(0,"td",29),e.ALo(1,"sanitizeHtml")),2&i){var n=e.oxw(2).$implicit,t=e.oxw(3).$implicit,o=e.oxw();e.Q6J("ngClass",o.getCellClass(n,t))("innerHTML",e.lcZ(1,2,o.getValue(n,t)),e.oJD)}}function Xd(i,a){if(1&i&&(e._UZ(0,"img",26),e.ALo(1,"async"),e.ALo(2,"secureImage")),2&i){var n=e.oxw(3).$implicit,t=e.oxw(3).$implicit,o=e.oxw();e.s9C("src",e.lcZ(1,1,e.lcZ(2,3,o.getValue(n,t))),e.LSH)}}function eg(i,a){1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.targetHtmlUrl")," "))}function tg(i,a){if(1&i&&(e.TgZ(0,"td",22)(1,"a",23),e.NdJ("click",function(l){return l.stopPropagation()}),e.YNc(2,Xd,3,5,"img",24),e.YNc(3,eg,3,3,"ng-template",null,25,e.W1O),e.qZA()()),2&i){var n=e.MAs(4),t=e.oxw(2).$implicit,o=e.oxw(3).$implicit,r=e.oxw();e.Q6J("ngClass",r.getCellClass(t,o)),e.xp6(1),e.s9C("href",r.getValue(t,o),e.LSH),e.xp6(1),e.Q6J("ngIf",r.isImg(r.getValue(t,o)))("ngIfElse",n)}}function ng(i,a){if(1&i&&(e.YNc(0,Kd,2,4,"td",27),e.YNc(1,tg,5,4,"ng-template",null,56,e.W1O)),2&i){var n=e.MAs(2),t=e.oxw().$implicit,o=e.oxw(3).$implicit,r=e.oxw();e.Q6J("ngIf",!r.isUrl(r.getValue(t,o)))("ngIfElse",n)}}function og(i,a){if(1&i&&(e.ynx(0),e.YNc(1,Wd,12,12,"td",30),e.YNc(2,ng,3,2,"ng-template",null,31,e.W1O),e.BQk()),2&i){var n=a.$implicit,t=e.MAs(3),o=e.oxw(4);e.xp6(1),e.Q6J("ngIf",o.isEdition(n))("ngIfElse",t)}}function ig(i,a){1&i&&(e.ynx(0),e.YNc(1,og,4,2,"ng-container",19),e.BQk())}function rg(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-icon",60),e.NdJ("click",function(l){e.CHM(n);var c=e.oxw(4).$implicit;return e.KtG(c.onClick(l))}),e.qZA()}if(2&i){var t=e.oxw().$implicit,o=e.oxw(3).$implicit,r=e.oxw();e.s9C("svgIcon",r.getValue(t,o)||o.icon)}}function ag(i,a){if(1&i&&e._UZ(0,"mat-icon",61),2&i){var n=e.oxw().$implicit,t=e.oxw(3).$implicit,o=e.oxw();e.s9C("svgIcon",o.getValue(n,t)||t.icon)}}function sg(i,a){if(1&i&&(e.TgZ(0,"td",22),e.YNc(1,rg,1,1,"mat-icon",58),e.YNc(2,ag,1,1,"mat-icon",59),e.qZA()),2&i){var n=a.$implicit,t=e.oxw(3).$implicit,o=e.oxw();e.Q6J("ngClass",o.getCellClass(n,t)),e.xp6(1),e.Q6J("ngIf",t.onClick),e.xp6(1),e.Q6J("ngIf",!t.onClick)}}function lg(i,a){1&i&&(e.ynx(0),e.YNc(1,sg,3,3,"td",57),e.BQk())}function cg(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",65),e.NdJ("mousedown",function(){e.CHM(n);var r=e.oxw(2).$implicit,s=e.oxw().$implicit,l=e.oxw(4);return e.KtG(l.onButtonClick(r.click,s))}),e._UZ(1,"mat-icon",61),e.qZA()}if(2&i){var t=e.oxw(2).$implicit;e.Q6J("color",t.color)("disabled",t.disabled),e.xp6(1),e.s9C("svgIcon",t.icon)}}function ug(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",66),e.NdJ("mousedown",function(){e.CHM(n);var r=e.oxw(2).$implicit,s=e.oxw().$implicit,l=e.oxw(4);return e.KtG(l.onButtonClick(r.click,s))}),e._UZ(1,"mat-icon",61),e.qZA()}if(2&i){var t=e.oxw(2).$implicit;e.Q6J("color",t.color)("disabled",t.disabled),e.xp6(1),e.s9C("svgIcon",t.icon)}}function pg(i,a){if(1&i&&(e.ynx(0),e.YNc(1,cg,2,3,"button",63),e.YNc(2,ug,2,3,"button",64),e.BQk()),2&i){var n=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf","mat-icon-button"===n.style),e.xp6(1),e.Q6J("ngIf","mat-icon-button"!==n.style)}}function dg(i,a){if(1&i&&(e.TgZ(0,"span"),e.YNc(1,pg,3,2,"ng-container",10),e.qZA()),2&i){var n=a.$implicit,t=e.oxw().$implicit,o=e.oxw(4);e.xp6(1),e.Q6J("ngIf",o.isEdition(t)===n.editMode||void 0===n.editMode)}}function gg(i,a){if(1&i&&(e.ynx(0),e.TgZ(1,"td",22),e.YNc(2,dg,2,1,"span",62),e.qZA(),e.BQk()),2&i){var n=a.$implicit,t=e.oxw(3).$implicit,o=e.oxw();e.xp6(1),e.Q6J("ngClass",o.getCellClass(n,t)),e.xp6(1),e.Q6J("ngForOf",o.getValue(n,t))}}function fg(i,a){1&i&&(e.ynx(0),e.YNc(1,gg,3,2,"ng-container",19),e.BQk())}function mg(i,a){if(1&i&&(e.ynx(0),e.YNc(1,Pd,2,0,"ng-container",10),e.YNc(2,Ud,2,0,"ng-container",10),e.YNc(3,ig,2,0,"ng-container",10),e.YNc(4,lg,2,0,"ng-container",10),e.YNc(5,fg,2,0,"ng-container",10),e.BQk()),2&i){var n=a.ngIf,t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",n===t.entityTableColumnRenderer.Default),e.xp6(1),e.Q6J("ngIf",n===t.entityTableColumnRenderer.HTML),e.xp6(1),e.Q6J("ngIf",n===t.entityTableColumnRenderer.UnsanitizedHTML),e.xp6(1),e.Q6J("ngIf",n===t.entityTableColumnRenderer.Icon),e.xp6(1),e.Q6J("ngIf",n===t.entityTableColumnRenderer.ButtonGroup)}}function hg(i,a){if(1&i&&(e.ynx(0,14),e.YNc(1,Md,2,0,"ng-container",10),e.YNc(2,Zd,2,0,"ng-container",10),e.YNc(3,mg,6,5,"ng-container",10),e.BQk()),2&i){var n=a.$implicit,t=e.oxw();e.Q6J("matColumnDef",n.name),e.xp6(1),e.Q6J("ngIf",t.columnIsSortable(n)),e.xp6(1),e.Q6J("ngIf",!t.columnIsSortable(n)),e.xp6(1),e.Q6J("ngIf",t.getColumnRenderer(n))}}function vg(i,a){if(1&i&&e._UZ(0,"tr",67),2&i){var n=e.oxw();e.Q6J("ngClass",n.getHeaderClass())}}function yg(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"tr",68),e.NdJ("select",function(){var l=e.CHM(n).$implicit,c=e.oxw();return e.KtG(c.onRowSelect(l))})("click",function(){var l=e.CHM(n).$implicit,c=e.oxw();return e.KtG(c.onRowClick(l))}),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw();e.Q6J("scrollBehavior",o.scrollBehavior)("ngClass",o.getRowClass(t))("selection",o.selection)("selected",o.rowIsSelected(t))}}function _g(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-entity-table-paginator",69),e.NdJ("paginatorChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.paginatorChange(r))}),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("store",t.store)("paginatorOptions",t.paginatorOptions)("entitySortChange$",t.entitySortChange$)}}var bg=function(a){return{height:a}},ho=function(){var i=function(){function a(n,t,o,r,s,l,c,u,p){(0,h.Z)(this,a),this.cdRef=n,this.formBuilder=t,this._focusMonitor=o,this._elementRef=r,this.ngControl=s,this._parentForm=l,this._controlName=c,this._defaultErrorStateMatcher=u,this.dateAdapter=p,this.entitySortChange$=new x.X(!1),this.formGroup=new S.nJ({}),this.filteredOptions={},this.entityTableColumnRenderer=at,this.entityTableSelectionState=yi,this.selectionState$=new x.X(void 0),this.scrollBehavior=Lo.Auto,this.sortNullsFirst=!1,this.withPaginator=!1,this.entityClick=new e.vpe,this.entitySelectChange=new e.vpe,this.entitySortChange=new e.vpe(void 0),this.dataSource=new Pe.by,this.dateAdapter.setLocale("fr-CA")}return(0,v.Z)(a,[{key:"paginator",get:function(){return this._paginator},set:function(t){this._paginator=t,this.dataSource.paginator=t}},{key:"headers",get:function(){var t=this.template.columns.filter(function(o){return!1!==o.visible}).map(function(o){return o.name});return!0===this.selectionCheckbox&&(t=["selectionCheckbox"].concat(t)),t}},{key:"selection",get:function(){return this.template.selection||!1}},{key:"selectionCheckbox",get:function(){return this.template.selectionCheckbox||!1}},{key:"selectMany",get:function(){return this.template.selectMany||!1}},{key:"fixedHeader",get:function(){return void 0===this.template.fixedHeader||this.template.fixedHeader}},{key:"tableHeight",get:function(){return this.template.tableHeight?this.template.tableHeight:"auto"}},{key:"ngOnInit",value:function(){this.handleDatasource(),this.dataSource.paginator=this.paginator}},{key:"ngOnChanges",value:function(t){var o=t.store;o&&o.currentValue!==o.previousValue&&this.handleDatasource()}},{key:"onValueChange",value:function(t,o,r){var s=this.getColumnKeyWithoutPropertiesTag(t);o.entity.properties[s]=r.target.value}},{key:"onBooleanValueChange",value:function(t,o,r){var s=this.getColumnKeyWithoutPropertiesTag(t);o.entity.properties[s]=r.checked}},{key:"onSelectValueChange",value:function(t,o,r){var s=this.getColumnKeyWithoutPropertiesTag(t);o.entity.properties[s]=r.value}},{key:"onAutocompleteValueChange",value:function(t,o,r){this.formGroup.controls[t.name].setValue(r.option.viewValue);var s=this.getColumnKeyWithoutPropertiesTag(t.name);o.entity.properties[s]=r.option.value}},{key:"onDateChange",value:function(t,o,r){var l=H(r.value).format("YYYY-MM-DD"),c=this.getColumnKeyWithoutPropertiesTag(t);o.entity.properties[c]=l}},{key:"enableEdit",value:function(t){var o=this,r=t.entity.properties||t.entity;this.template.columns.forEach(function(s){var l;s.title=(null===(l=s.validation)||void 0===l?void 0:l.mandatory)&&!s.title.includes("*")?s.title+" *":s.title;var c=o.getColumnKeyWithoutPropertiesTag(s.name);if("boolean"===s.type)r[c]&&null!==r[c]?"string"==typeof r[c]&&(r[c]=JSON.parse(r[c].toLowerCase())):r[c]=!1,o.formGroup.setControl(s.name,o.formBuilder.control(r[c]));else if("list"===s.type)s.multiple?o.formGroup.setControl(s.name,o.formBuilder.control([r[c]])):(o.formGroup.setControl(s.name,o.formBuilder.control(r[c])),o.formGroup.controls[s.name].setValue("string"==typeof r[c]?parseInt(r[c]):r[c]));else if("autocomplete"===s.type){o.formGroup.setControl(s.name,o.formBuilder.control(r[c])),o.filteredOptions[s.name]=new rt.y,o.filteredOptions[s.name]=o.formGroup.controls[s.name].valueChanges.pipe((0,U.U)(function(f){var m;if(null!=f&&f.length)return null===(m=s.domainValues)||void 0===m?void 0:m.filter(function(y){var _=f?f.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"";return y.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(_)})}));var u=r[c];if(s.domainValues.forEach(function(f){"string"==typeof u&&/^\d+$/.test(u)&&(u=parseInt(u)),(f.value===u||f.id===u)&&(u=f.value)}),o.formGroup.controls[s.name].setValue(u),o.isEdition(t)&&s.linkColumnForce){var p=t.entity;o.formGroup.controls[s.name].setValue(null==p?void 0:p.properties[o.getColumnKeyWithoutPropertiesTag(s.linkColumnForce)])}}else if("date"===s.type){if(s.visible)if(r[c]){var d=H(r[c]);r[c]=d.utc().format("YYYY-MM-DD"),o.formGroup.setControl(s.name,o.formBuilder.control(r[c]))}else{var g=o.getColumnKeyWithoutPropertiesTag(s.name);t.entity.properties[g]=null,o.formGroup.setControl(s.name,o.formBuilder.control(null))}}else o.formGroup.setControl(s.name,o.formBuilder.control(r[c]));o.formGroup.controls[s.name]&&o.getValidationAttributeValue(s,"readonly")&&o.formGroup.controls[s.name].disable()})}},{key:"handleDatasource",value:function(){var t=this;this.unsubscribeStore(),this.selection$$=this.store.stateView.manyBy$(function(o){return!0===o.state.selected}).subscribe(function(o){var r=o[0],s=t.store.stateView.all().indexOf(r),l=t.paginator?t.paginator.pageSize*(t.paginator.pageIndex+1):0;if(t.paginator&&(s<(t.paginator?l-t.paginator.pageSize:0)||s>=l)){var u=Math.floor(s/t.paginator.pageSize);t.dataSource.paginator.pageIndex=u}t.selectionState$.next(t.computeSelectionState(o))}),this.dataSource$$=this.store.stateView.all$().subscribe(function(o){o[0]&&t.enableEdit(o[0]),t.dataSource.data=o})}},{key:"ngOnDestroy",value:function(){this.unsubscribeStore()}},{key:"unsubscribeStore",value:function(){this.selection$$&&this.selection$$.unsubscribe(),this.dataSource$$&&this.dataSource$$.unsubscribe()}},{key:"getTrackByFunction",value:function(){return function(t,o){return o.ref}}},{key:"refresh",value:function(){this.cdRef.detectChanges()}},{key:"paginatorChange",value:function(t){this.paginator=t}},{key:"onSort",value:function(t){var o=this,r=t.direction,s=this.template.columns.find(function(l){return l.name===t.active});"asc"===r||"desc"===r?(this.store.stateView.sort({valueAccessor:function(c){return o.getValue(c,s)},direction:r,nullsFirst:this.sortNullsFirst}),this.entitySortChange.emit({column:s,direction:r}),this.entitySortChange$.next(!0)):this.store.stateView.sort(void 0)}},{key:"onRowClick",value:function(t){this.lastRecordCheckedKey=this.store.stateView.getKey(t),this.entityClick.emit(t.entity)}},{key:"onRowSelect",value:function(t){if(!1!==this.selection){var o=t.entity;this.store.state.update(o,{selected:!0},!0),this.entitySelectChange.emit({added:[o]})}}},{key:"onToggleRows",value:function(t){if(!1!==this.selection&&(this.store.state.updateAll({selected:t}),!0===t)){var o=this.store.stateView.all().map(function(r){return r.entity});this.entitySelectChange.emit({added:[o]})}}},{key:"onToggleRow",value:function(t,o){if(!1!==this.selection){var r=o.entity;this.store.state.update(r,{selected:t},!0===t&&!this.selectMany),!0===t&&this.entitySelectChange.emit({added:[r]}),this.lastRecordCheckedKey=this.store.stateView.getKey(o)}}},{key:"onShiftToggleRow",value:function(t,o,r){if(!1!==this.selection){if(!1===this.selectMany||void 0===this.lastRecordCheckedKey)return void this.onToggleRow(t,o);var s=window.document.createRange();s.selectNode(r.target),window.getSelection().removeAllRanges(),window.getSelection().addRange(s),r.stopImmediatePropagation();var l=this.store.stateView.all(),c=l.indexOf(o),u=this.store.stateView.get(this.lastRecordCheckedKey),d=[c,l.indexOf(u)],f=l.slice(Math.min.apply(Math,d),Math.max.apply(Math,d)+1).map(function(m){return m.entity});this.store.state.updateMany(f,{selected:t}),!0===t&&this.entitySelectChange.emit({added:f}),this.lastRecordCheckedKey=this.store.stateView.getKey(o)}}},{key:"computeSelectionState",value:function(t){var r=t.length;return 0===r?yi.None:r===this.store.stateView.count?yi.All:yi.Some}},{key:"columnIsSortable",value:function(t){var o=t.sort;return void 0===o&&(o=void 0!==this.template.sort&&this.template.sort),o}},{key:"rowIsSelected",value:function(t){var o=t.state;return!!o.selected&&o.selected}},{key:"isImg",value:function(t){return!!this.isUrl(t)&&-1!==["jpg","png","gif"].indexOf(t.split(".").pop().toLowerCase())}},{key:"isUrl",value:function(t){return"string"==typeof t&&("https://"===t.slice(0,8)||"http://"===t.slice(0,7))}},{key:"getValue",value:function(t,o){var l,r=this,s=t.entity;if(void 0!==o.valueAccessor)return o.valueAccessor(s,t);if(void 0!==this.template.valueAccessor)return this.template.valueAccessor(s,o.name,t);if(l=this.store.getProperty(s,o.name),"boolean"===o.type)null==l||""===l?l=!1:"boolean"!=typeof l&&void 0!==l&&(l="number"==typeof l?Boolean(l):JSON.parse(l.toLowerCase())),this.isEdition(t)||(l=l?"&#10003;":"");else if("list"===o.type&&l&&o.domainValues){var c=t.entity;if(o.multiple){var u;u="string"==typeof l?l.match(/[\w.-]+/g).map(Number):l;var p=[];o.domainValues.forEach(function(f){u.includes(f.id)&&p.push(t.edition?f.id:f.value)}),l=this.isEdition(t)?u:p}else!this.isEdition(t)&&o.linkColumnForce?l=null==c?void 0:c.properties[this.getColumnKeyWithoutPropertiesTag(o.linkColumnForce)]:o.domainValues.forEach(function(f){"string"==typeof l&&/^\d+$/.test(l)&&(l=parseInt(l)),(f.value===l||f.id===l)&&(l=r.isEdition(t)?f.id:f.value)})}else if("autocomplete"===o.type&&l&&o.domainValues){var d=t.entity;!this.isEdition(t)&&o.linkColumnForce?l=null==d?void 0:d.properties[this.getColumnKeyWithoutPropertiesTag(o.linkColumnForce)]:o.domainValues.forEach(function(f){"string"==typeof l&&/^\d+$/.test(l)&&(l=parseInt(l)),(f.value===l||f.id===l)&&(l=f.value)})}else if("date"===o.type)if(this.isEdition(t)){if(l){var g=H(l);l=g.format(),this.formGroup.controls[o.name].setValue(l)}}else!this.isEdition(t)&&null===l&&(l="");return void 0===l&&(l=""),l}},{key:"getValidationAttributeValue",value:function(t,o){return void 0!==t.validation&&void 0!==t.validation[o]&&t.validation[o]}},{key:"isEdition",value:function(t){return!!t.entity.edition}},{key:"getColumnRenderer",value:function(t){return void 0!==t.renderer?t.renderer:at.Default}},{key:"getTableClass",value:function(){return{"igo-entity-table-with-selection":this.selection}}},{key:"getHeaderClass",value:function(){var t=this.template.headerClassFunc;return t instanceof Function?t():{}}},{key:"getRowClass",value:function(t){var r=this.template.rowClassFunc;return r instanceof Function?r(t.entity,t):{}}},{key:"getCellClass",value:function(t,o){var r=t.entity,s={},l=this.template.cellClassFunc;l instanceof Function&&Object.assign(s,l(r,o,t));var c=o.cellClassFunc;return c instanceof Function&&Object.assign(s,c(r,t)),s}},{key:"onButtonClick",value:function(t,o){this.enableEdit(o),"function"==typeof t&&t(o.entity,o)}},{key:"getColumnKeyWithoutPropertiesTag",value:function(t){return t.includes("properties.")?t.split(".")[1]:t}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.sBO),e.Y36(S.QS),e.Y36(dd.tE),e.Y36(e.SBq),e.Y36(S.a5,10),e.Y36(S.F,8),e.Y36(S.u,8),e.Y36(ie.rD),e.Y36(ie._A))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-entity-table"]],inputs:{store:"store",paginator:"paginator",template:"template",scrollBehavior:"scrollBehavior",sortNullsFirst:"sortNullsFirst",withPaginator:"withPaginator",paginatorOptions:"paginatorOptions"},outputs:{entityClick:"entityClick",entitySelectChange:"entitySelectChange",entitySortChange:"entitySortChange"},features:[e._Bn([{provide:B.Eo,useExisting:i}]),e.TTD],decls:9,vars:11,consts:[[1,"table-container",3,"ngStyle"],["mat-table","","matSort","",3,"ngClass","dataSource","trackBy","matSortChange"],["matColumnDef","selectionCheckbox",1,"mat-cell-checkbox"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",3,"ngClass",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","igoEntityTableRow","",3,"scrollBehavior","ngClass","selection","selected","select","click",4,"matRowDef","matRowDefColumns"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange",4,"ngIf"],["mat-header-cell",""],[4,"ngIf"],[3,"checked","indeterminate","change"],["mat-cell",""],[3,"checked","mousedown","click","change"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",3,"matTooltip",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header","",3,"matTooltip"],["mat-header-cell","",3,"matTooltip",4,"matHeaderCellDef"],["mat-header-cell","",3,"matTooltip"],[4,"matCellDef"],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"ngIf","ngIfElse"],["isAnUrlDefault",""],["mat-cell","",1,"mat-cell-text",3,"ngClass"],["target","_blank","rel","noopener noreferrer",3,"href","click"],["igoImageError","","width","50","heigth","auto",3,"src",4,"ngIf","ngIfElse"],["notImg",""],["igoImageError","","width","50","heigth","auto",3,"src"],["mat-cell","","class","mat-cell-text",3,"ngClass","innerHTML",4,"ngIf","ngIfElse"],["isAnUrlHTML",""],["mat-cell","",1,"mat-cell-text",3,"ngClass","innerHTML"],["mat-cell","","class","mat-cell-text edition",3,"formGroup","ngClass",4,"ngIf","ngIfElse"],["isUnsanitizedHTML",""],["mat-cell","",1,"mat-cell-text","edition",3,"formGroup","ngClass"],["class","date-picker",4,"ngIf"],["matInput","","type","time","step","900",3,"formControlName","focus","keypress","blur",4,"ngIf"],["matInput","","type","number","class","class_number_edition",3,"formControlName","step","value","readonly","required","min","max","input",4,"ngIf"],["matInput","","type","text",3,"formControlName","value","readonly","required","input",4,"ngIf"],[3,"formControlName","checked","change",4,"ngIf"],[3,"required","formControlName","multiple","value","selectionChange",4,"ngIf"],["matInput","","type","text",3,"formControlName","matAutocomplete","required","value","readonly",4,"ngIf"],["panelWidth","430px",3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"date-picker"],["matSuffix","",3,"for"],["matInput","",3,"matDatepicker","formControlName","value","dateChange"],["picker",""],["matInput","","type","time","step","900",3,"formControlName","focus","keypress","blur"],["matInput","","type","number",1,"class_number_edition",3,"formControlName","step","value","readonly","required","min","max","input"],["matInput","","type","text",3,"formControlName","value","readonly","required","input"],[3,"formControlName","checked","change"],[3,"required","formControlName","multiple","value","selectionChange"],[3,"value","disabled",4,"ngFor","ngForOf"],[3,"value","disabled"],["matInput","","type","text",3,"formControlName","matAutocomplete","required","value","readonly"],[3,"value"],["isAnUrlUnsanitizedHTML",""],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"matCellDef"],[3,"svgIcon","click",4,"ngIf"],[3,"svgIcon",4,"ngIf"],[3,"svgIcon","click"],[3,"svgIcon"],[4,"ngFor","ngForOf"],["igoStopPropagation","","mat-icon-button","",3,"color","disabled","mousedown",4,"ngIf"],["igoStopPropagation","","mat-mini-fab","",3,"color","disabled","mousedown",4,"ngIf"],["igoStopPropagation","","mat-icon-button","",3,"color","disabled","mousedown"],["igoStopPropagation","","mat-mini-fab","",3,"color","disabled","mousedown"],["mat-header-row","",3,"ngClass"],["mat-row","","igoEntityTableRow","",3,"scrollBehavior","ngClass","selection","selected","select","click"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"table",1),e.NdJ("matSortChange",function(r){return t.onSort(r)}),e.ynx(2,2),e.YNc(3,Td,2,1,"th",3),e.YNc(4,xd,2,1,"td",4),e.BQk(),e.YNc(5,hg,4,4,"ng-container",5),e.YNc(6,vg,1,1,"tr",6),e.YNc(7,yg,1,4,"tr",7),e.qZA(),e.YNc(8,_g,1,3,"igo-entity-table-paginator",8),e.qZA()),2&n&&(e.Q6J("ngStyle",e.VKq(9,bg,t.tableHeight)),e.xp6(1),e.Q6J("ngClass",t.getTableClass())("dataSource",t.dataSource)("trackBy",t.getTrackByFunction()),e.xp6(4),e.Q6J("ngForOf",t.template.columns),e.xp6(1),e.Q6J("matHeaderRowDef",t.headers)("matHeaderRowDefSticky",t.fixedHeader),e.xp6(1),e.Q6J("matRowDefColumns",t.headers),e.xp6(1),e.Q6J("ngIf",t.withPaginator))},dependencies:[C.mk,C.sg,C.O5,C.PC,Pe.BZ,Pe.fO,Pe.as,Pe.w1,Pe.Dz,Pe.nj,Pe.ge,Pe.ev,Pe.XQ,Pe.Gk,_t.XC,_t.ZL,ie.ey,go.YE,go.nU,O.Hw,I.lW,pt.oG,B.R9,ke.gD,Oo,Ml,xa,S.Fj,S.wV,S.JJ,S.JL,S.Q7,S.qQ,S.Fd,S.sg,S.u,le.Nt,jn.Mq,jn.hl,jn.nW,J.gM,Cd,C.Ov,pr,dr,E.X$],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}.table-compact[_nghost-%COMP%]   tr.mat-header-row[_ngcontent-%COMP%], .table-compact[_nghost-%COMP%]     .mat-checkbox .mat-checkbox-ripple{height:36px}.table-compact[_nghost-%COMP%]   tr.mat-row[_ngcontent-%COMP%], .table-compact[_nghost-%COMP%]     .mat-checkbox .mat-checkbox-ripple{height:28px}.table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto;flex:1 1 auto}.mat-cell-text[_ngcontent-%COMP%]{overflow:hidden;word-wrap:break-word}th.mat-header-cell[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%], td.mat-footer-cell[_ngcontent-%COMP%]{padding:0 3px}entity-table[_ngcontent-%COMP%]   table.igo-entity-table-with-selection[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{-o-box-shadow:2px 0px 2px 0px #dddddd;box-shadow:2px 0 2px #ddd;cursor:pointer}table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:7px}.class_hidden[_ngcontent-%COMP%]{visibility:hidden}.class_display_none[_ngcontent-%COMP%]{display:none}.class_boolean[_ngcontent-%COMP%], .class_icon[_ngcontent-%COMP%], .class_number[_ngcontent-%COMP%]{text-align:center;padding-right:35px!important}.class_sting[_ngcontent-%COMP%], .class_text[_ngcontent-%COMP%], .class_number_edition[_ngcontent-%COMP%]{text-align:left}td.edition[_ngcontent-%COMP%]{background:rgba(166,166,166,.2)}input[_ngcontent-%COMP%]{border-bottom:1px solid darkgrey}"],changeDetection:0}),i}(),Dn=function(){return(i=Dn||(Dn={})).Dock="dock",i.Overlay="overlay",i.Context="context",Dn;var i}();function Cg(i,a){if(1&i&&(e._UZ(0,"mat-icon",7),e.ALo(1,"async")),2&i){var n=e.oxw(3);e.s9C("svgIcon",e.lcZ(1,1,n.icon$))}}function Sg(i,a){if(1&i&&(e.TgZ(0,"button",5),e.ALo(1,"async"),e.YNc(2,Cg,2,3,"mat-icon",6),e.qZA()),2&i){var n=e.oxw(2);e.Q6J("color",n.color)("disabled",e.lcZ(1,3,n.disabled$)),e.xp6(2),e.Q6J("ngIf",n.withIcon)}}function wg(i,a){if(1&i&&(e.TgZ(0,"h4",8),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){var n=e.oxw(2);e.xp6(1),e.Oqu(e.lcZ(2,1,n.title))}}function Tg(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-list-item",2),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.onClick())}),e.ALo(1,"translate"),e.ALo(2,"async"),e.ALo(3,"async"),e.YNc(4,Sg,3,5,"button",3),e.YNc(5,wg,3,3,"h4",4),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("matTooltip",t.withTooltip?e.lcZ(1,4,e.lcZ(2,6,t.tooltip$)||t.title):"")("ngClass",e.lcZ(3,8,t.ngClass$)),e.xp6(4),e.Q6J("ngIf",t.withIcon),e.xp6(1),e.Q6J("ngIf",t.withTitle)}}function xg(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-checkbox",11),e.NdJ("change",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.action.handler())}),e.ALo(1,"async"),e._uU(2),e.ALo(3,"translate"),e.qZA()}if(2&i){var t=e.oxw(2);e.Q6J("checked",e.lcZ(1,2,t.checkCondition$)),e.xp6(2),e.hij(" ",e.lcZ(3,4,t.title)," ")}}function kg(i,a){if(1&i&&(e.TgZ(0,"mat-list-item",9),e.ALo(1,"translate"),e.ALo(2,"async"),e.ALo(3,"async"),e.YNc(4,xg,4,6,"mat-checkbox",10),e.qZA()),2&i){var n=e.oxw();e.Q6J("matTooltip",n.withTooltip?e.lcZ(1,3,e.lcZ(2,5,n.tooltip$)||n.title):"")("ngClass",e.lcZ(3,7,n.ngClass$)),e.xp6(4),e.Q6J("ngIf",n.withTitle)}}var Mg=function(){var i=function(){function a(){(0,h.Z)(this,a),this.disabled$=new x.X(!1),this.checkCondition$=new x.X(void 0),this.icon$=new x.X(void 0),this.tooltip$=new x.X(void 0),this.noDisplay$=new x.X(!1),this.ngClass$=new x.X({}),this.color="default",this.withTitle=!0,this.withIcon=!0,this.withTooltip=!0,this.trigger=new e.vpe}return(0,v.Z)(a,[{key:"disabled",get:function(){return this.disabled$.value},set:function(t){this.disabled$.next(t)}},{key:"noDisplay",get:function(){return this.noDisplay$.value},set:function(t){this.noDisplay$.next(t)}},{key:"title",get:function(){return this.action.title}},{key:"ngOnInit",value:function(){var r,s,l,t=this,o=this.action.args||[];void 0!==this.action.ngClass&&(this.ngClass$$=(r=this.action).ngClass.apply(r,(0,Fe.Z)(o)).subscribe(function(c){return t.updateNgClass(c)})),(0,ba.b)(this.action.icon)?this.icon$$=this.action.icon.subscribe(function(c){return t.updateIcon(c)}):this.updateIcon(this.action.icon),(0,ba.b)(this.action.checkCondition)?this.checkCondition$$=this.action.checkCondition.subscribe(function(c){return t.updateCheckCondition(c)}):this.updateCheckCondition(this.action.checkCondition),(0,ba.b)(this.action.tooltip)?this.tooltip$$=this.action.tooltip.subscribe(function(c){return t.updateTooltip(c)}):this.updateTooltip(this.action.tooltip),void 0!==this.action.availability&&(this.availability$$=(s=this.action).availability.apply(s,(0,Fe.Z)(o)).subscribe(function(c){return t.disabled=!c})),this.disabled$$=this.disabled$.subscribe(function(c){return t.updateNgClass({"igo-actionbar-item-disabled":c})}),void 0!==this.action.display&&(this.display$$=(l=this.action).display.apply(l,(0,Fe.Z)(o)).subscribe(function(c){return t.noDisplay=!c})),this.noDisplay$$=this.noDisplay$.subscribe(function(c){return t.updateNgClass({"igo-actionbar-item-no-display":c})})}},{key:"ngOnDestroy",value:function(){void 0!==this.ngClass$$&&(this.ngClass$$.unsubscribe(),this.ngClass$$=void 0),void 0!==this.availability$$&&(this.availability$$.unsubscribe(),this.availability$$=void 0),void 0!==this.display$$&&(this.display$$.unsubscribe(),this.display$$=void 0),void 0!==this.checkCondition$$&&(this.checkCondition$$.unsubscribe(),this.checkCondition$$=void 0),void 0!==this.icon$$&&(this.icon$$.unsubscribe(),this.icon$$=void 0),void 0!==this.tooltip$$&&(this.tooltip$$.unsubscribe(),this.tooltip$$=void 0),this.disabled$$.unsubscribe(),this.noDisplay$$.unsubscribe()}},{key:"onClick",value:function(){!0!==this.disabled&&this.trigger.emit(this.action)}},{key:"updateNgClass",value:function(t){this.ngClass$.next(Object.assign({},this.ngClass$.value,t))}},{key:"updateTooltip",value:function(t){this.tooltip$.next(t)}},{key:"updateCheckCondition",value:function(t){this.checkCondition$.next(t)}},{key:"updateIcon",value:function(t){this.icon$.next(t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-actionbar-item"]],inputs:{action:"action",color:"color",withTitle:"withTitle",withIcon:"withIcon",withTooltip:"withTooltip",disabled:"disabled",noDisplay:"noDisplay"},outputs:{trigger:"trigger"},decls:2,vars:2,consts:[["matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",3,"matTooltip","ngClass","click",4,"ngIf"],["class","item-checkbox","matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",3,"matTooltip","ngClass",4,"ngIf"],["matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",3,"matTooltip","ngClass","click"],["mat-list-avatar","","mat-icon-button","",3,"color","disabled",4,"ngIf"],["matLine","",4,"ngIf"],["mat-list-avatar","","mat-icon-button","",3,"color","disabled"],[3,"svgIcon",4,"ngIf"],[3,"svgIcon"],["matLine",""],["matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",1,"item-checkbox",3,"matTooltip","ngClass"],[3,"checked","change",4,"ngIf"],[3,"checked","change"]],template:function(n,t){1&n&&(e.YNc(0,Tg,6,10,"mat-list-item",0),e.YNc(1,kg,5,9,"mat-list-item",1)),2&n&&(e.Q6J("ngIf",!t.action.checkbox),e.xp6(1),e.Q6J("ngIf",t.action.checkbox))},dependencies:[C.mk,C.O5,I.lW,O.Hw,J.gM,X.Tg,X.eA,ie.X2,pt.oG,C.Ov,E.X$],styles:["mat-list-item.igo-actionbar-item-disabled[_ngcontent-%COMP%]{color:#00000042;cursor:default!important}mat-list-item.igo-actionbar-item-no-display[_ngcontent-%COMP%]{display:none}mat-checkbox[_ngcontent-%COMP%]{padding:12px}.item-checkbox[_ngcontent-%COMP%]{height:56px}.item-checkbox[_ngcontent-%COMP%]     .mat-checkbox-label{margin-left:20px}"],changeDetection:0}),i}();function Fg(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",5)(1,"button",6),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(2);return e.KtG(o.scrollUp())}),e.ALo(2,"translate"),e._UZ(3,"mat-icon",7),e.qZA()()}2&i&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,1,"igo.common.actionbar.scrollUp")))}function Zg(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-actionbar-item",8),e.NdJ("trigger",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.onTriggerAction(r.toggleCollapseAction))}),e.qZA()}if(2&i){var t=e.oxw(2);e.Q6J("withTitle",!1)("withIcon",!0)("color",t.color)("disabled",t.store.view.empty)("action",t.toggleCollapseAction)}}function Ag(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-actionbar-item",11),e.NdJ("trigger",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.onTriggerAction(l))}),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw(3);e.Q6J("withTitle",o.withTitle)("withIcon",o.withIcon)("withTooltip",o.withTooltip)("color",o.color)("disabled",o.store.state.get(t).disabled)("action",t)}}function Ig(i,a){if(1&i&&(e.YNc(0,Ag,1,6,"ng-template",9,10,e.W1O),e.ALo(2,"async")),2&i){var n=e.oxw(2);e.Q6J("ngForOf",e.lcZ(2,1,n.store.view.all$()))}}function Lg(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",12)(1,"button",6),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(2);return e.KtG(o.scrollDown())}),e.ALo(2,"translate"),e._UZ(3,"mat-icon",13),e.qZA()()}2&i&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,1,"igo.common.actionbar.scrollDown")))}function Og(i,a){if(1&i&&(e.TgZ(0,"mat-list"),e.YNc(1,Fg,4,3,"div",2),e.YNc(2,Zg,1,5,"igo-actionbar-item",3),e.YNc(3,Ig,3,3,null,0),e.YNc(4,Lg,4,3,"div",4),e.qZA()),2&i){var n=e.oxw();e.xp6(1),e.Q6J("ngIf",n.heightCondition&&n.positionConditionTop&&n.isDesktop),e.xp6(1),e.Q6J("ngIf",n.withToggleButton),e.xp6(1),e.Q6J("ngIf",!n.collapsed),e.xp6(1),e.Q6J("ngIf",n.heightCondition&&n.positionConditionLow&&n.isDesktop)}}function Dg(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-actionbar-item",18),e.NdJ("trigger",function(){var l=e.CHM(n).$implicit,c=e.oxw(2);return e.KtG(c.onTriggerAction(l))}),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw(2);e.Q6J("withTitle",o.withTitle)("withIcon",o.withIcon)("color",o.color)("action",t)}}function Pg(i,a){if(1&i&&(e.TgZ(0,"div")(1,"button",14),e.ALo(2,"translate"),e._UZ(3,"mat-icon",15),e.qZA(),e.TgZ(4,"mat-menu",16,17)(6,"mat-list"),e.YNc(7,Dg,1,4,"ng-template",9),e.ALo(8,"async"),e.qZA()()()),2&i){var n=e.MAs(5),t=e.oxw();e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,10,"igo.common.actionbar.icon"))("matMenuTriggerFor",n)("disabled",t.store.view.empty)("color",t.iconColor),e.xp6(2),e.Q6J("svgIcon",t.icon),e.xp6(1),e.Tol(t.overlayClass),e.Q6J("xPosition",t.xPosition)("yPosition",t.yPosition),e.xp6(3),e.Q6J("ngForOf",e.lcZ(8,12,t.store.view.all$()))}}function Eg(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-actionbar-item",18),e.NdJ("trigger",function(){var l=e.CHM(n).$implicit,c=e.oxw(2);return e.KtG(c.onTriggerAction(l))}),e.qZA(),e._UZ(1,"br")}if(2&i){var t=a.$implicit,o=e.oxw(2);e.Q6J("withTitle",o.withTitle)("withIcon",o.withIcon)("color",o.color)("action",t)}}function $g(i,a){if(1&i&&(e.TgZ(0,"mat-card",19)(1,"mat-list"),e.YNc(2,Eg,2,4,"ng-template",9),e.ALo(3,"async"),e.qZA()()),2&i){var n=e.oxw();e.xp6(2),e.Q6J("ngForOf",e.lcZ(3,1,n.store.view.all$()))}}var bi=function(){var i=function(){function a(n,t,o,r){var s=this;(0,h.Z)(this,a),this.overlay=n,this.elRef=t,this.cdRef=o,this.mediaService=r,this.actionbarMode=Dn,this.collapsed=!1,this.toggleCollapseAction={id:"actionbar_toggle",icon:"dots-vertical",handler:function(){s.collapsed=!s.collapsed}},this.heightCondition$=new x.X(!1),this.positionConditionTop$=new x.X(!0),this.positionConditionLow$=new x.X(!0),this.mode=Dn.Dock,this.withToggleButton=!1,this.horizontal=!1,this.color="default",this.iconColor="default",this.withTitle=!0,this.withTooltip=!0,this.scrollActive=!0,this.withIcon=!0,this.icon="dots-horizontal",this.xPosition="before",this.yPosition="above",this._overlayClass=""}return(0,v.Z)(a,[{key:"overlayClass",get:function(){return[this._overlayClass,"igo-actionbar-overlay"].join(" ")},set:function(t){this._overlayClass=t}},{key:"withTitleClass",get:function(){return this.withTitle}},{key:"withIconClass",get:function(){return this.withIcon}},{key:"horizontalClass",get:function(){return this.horizontal}},{key:"heightCondition",get:function(){var t=this.elRef.nativeElement;return!1===this.scrollActive&&t.clientHeight<t.scrollHeight}},{key:"positionConditionTop",get:function(){return 0!==this.elRef.nativeElement.scrollTop}},{key:"positionConditionLow",get:function(){var t=this.elRef.nativeElement;return!(t.scrollTop>=t.scrollHeight-t.clientHeight)}},{key:"isDesktop",get:function(){return this.mediaService.getMedia()===Xt.Desktop}},{key:"ngOnChanges",value:function(t){var o=t.store;o&&o.currentValue!==o.previousValue&&(void 0!==this.watcher&&this.watcher.destroy(),this.watcher=new _i(this.store,this.cdRef))}},{key:"ngOnDestroy",value:function(){this.watcher.destroy()}},{key:"onTriggerAction",value:function(t){t.handler.apply(t,(0,Fe.Z)(t.args||[]))}},{key:"scrollDown",value:function(){this.elRef.nativeElement.scrollBy(0,52)}},{key:"scrollUp",value:function(){this.elRef.nativeElement.scrollBy(0,-52)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(wa.aV),e.Y36(e.SBq),e.Y36(e.sBO),e.Y36(xt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-actionbar"]],hostVars:6,hostBindings:function(n,t){2&n&&e.ekj("with-title",t.withTitleClass)("with-icon",t.withIconClass)("horizontal",t.horizontalClass)},inputs:{store:"store",mode:"mode",withToggleButton:"withToggleButton",horizontal:"horizontal",color:"color",iconColor:"iconColor",withTitle:"withTitle",withTooltip:"withTooltip",scrollActive:"scrollActive",withIcon:"withIcon",icon:"icon",xPosition:"xPosition",yPosition:"yPosition",overlayClass:"overlayClass"},features:[e.TTD],decls:3,vars:3,consts:[[4,"ngIf"],["class","context-menu-card mat-elevation-z4",4,"ngIf"],["id","topChevron",4,"ngIf"],["color","accent",3,"withTitle","withIcon","color","disabled","action","trigger",4,"ngIf"],["id","lowChevron",4,"ngIf"],["id","topChevron"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click"],["svgIcon","chevron-up"],["color","accent",3,"withTitle","withIcon","color","disabled","action","trigger"],["ngFor","",3,"ngForOf"],["buttonContent",""],["color","accent",3,"withTitle","withIcon","withTooltip","color","disabled","action","trigger"],["id","lowChevron"],["svgIcon","chevron-down"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"buttonOverlay",3,"matTooltip","matMenuTriggerFor","disabled","color"],[3,"svgIcon"],["overlapTrigger","true",1,"igo-compact-menu","igo-no-min-width-menu",3,"xPosition","yPosition"],["actionbarMenu","matMenu"],["color","accent",3,"withTitle","withIcon","color","action","trigger"],[1,"context-menu-card","mat-elevation-z4"]],template:function(n,t){1&n&&(e.YNc(0,Og,5,4,"mat-list",0),e.YNc(1,Pg,9,14,"div",0),e.YNc(2,$g,4,3,"mat-card",1)),2&n&&(e.Q6J("ngIf",t.mode===t.actionbarMode.Dock),e.xp6(1),e.Q6J("ngIf",t.mode===t.actionbarMode.Overlay),e.xp6(1),e.Q6J("ngIf",t.mode===t.actionbarMode.Context))},dependencies:[C.sg,C.O5,I.lW,O.Hw,J.gM,Ve.VK,Ve.p6,X.i$,F.a8,Mg,C.Ov,E.X$],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto;position:relative}button[_ngcontent-%COMP%]{margin:4px}.buttonOverlay[_ngcontent-%COMP%]{margin:0}mat-list[_ngcontent-%COMP%]{padding-top:0}.horizontal[_nghost-%COMP%]{max-width:100%;overflow:visible;overflow:initial}.horizontal[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{width:auto;white-space:nowrap}.horizontal[_nghost-%COMP%]   igo-actionbar-item[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]     .mat-list .mat-list-item .mat-list-text>*{white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;max-height:36px;line-height:18px;-webkit-box-orient:vertical;-webkit-line-clamp:2}[_nghost-%COMP%]     .mat-list-base .mat-list-item.mat-list-item-with-avatar{height:46px}[_nghost-%COMP%]     .mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content{display:-webkit-flex;height:46px;padding:3px}[_nghost-%COMP%]     .mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content>mat-icon{padding:8px}igo-actionbar-item[_ngcontent-%COMP%]     mat-list-item [mat-list-avatar]{height:auto;width:40px}igo-actionbar-item[_ngcontent-%COMP%]     mat-list-item:hover{cursor:pointer}.context-menu-card[_ngcontent-%COMP%]{padding:8px 3px;margin:10px}#topChevron[_ngcontent-%COMP%]{position:-webkit-sticky;position:sticky;top:0;background-color:#fff;z-index:3}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){#topChevron[_ngcontent-%COMP%]{position:fixed;top:auto;top:initial}}@supports (-ms-accelerator: true){#topChevron[_ngcontent-%COMP%]{position:fixed;top:auto;top:initial}}#lowChevron[_ngcontent-%COMP%]{position:fixed;position:-webkit-sticky;position:sticky;bottom:0;background-color:#fff;z-index:3}"],changeDetection:0}),i}(),gr=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,he,I.ot,O.Ps,J.AV,Ve.Tx,X.ie,F.QW,pt.p9]}),i}(),ka=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,gr,gr]}),i}(),Ma=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.el=n,this.matIconRegistry=t,this.hidden=!1,this.disabled=!1,this.inverseColor=!1,this.inheritColor=!1}return(0,v.Z)(a,[{key:"igoMatBadgeIcon",set:function(t){var o=this;this.matIconRegistry.getNamedSvgIcon(t).subscribe(function(r){o.svg=r,o.updateSvg()})}},{key:"matBadgeHidden",set:function(t){this.hidden=t,this.updateHidden()}},{key:"matBadgeDisabled",set:function(t){this.disabled=t,this.updateDisabled()}},{key:"igoMatBadgeInverseColor",set:function(t){this.inverseColor=t,this.updateColor()}},{key:"igoMatBadgeInheritColor",set:function(t){this.inheritColor=t,this.updateColor()}},{key:"badge",get:function(){return this.el.nativeElement.querySelector(".mat-badge-content")}},{key:"ngOnInit",value:function(){this.badge.style.alignItems="center",this.badge.style.justifyContent="center",this.updateHidden(),this.updateColor(),this.updateSvg()}},{key:"updateSvg",value:function(){!this.badge||(this.badge.innerHTML="",this.svg&&this.badge.appendChild(this.svg))}},{key:"updateColor",value:function(){!this.badge||(this.inheritColor?this.inverseColor?(this.badge.style.color="currentColor",this.badge.style.background="none"):(this.badge.style.color="",this.badge.style.background="currentColor"):this.inverseColor?(this.badge.style.color=window.getComputedStyle(this.badge,null).getPropertyValue("background-color"),this.badge.style.background="none"):(this.badge.style.color="",this.badge.style.background=""),this.originalColor=this.badge.style.color,this.updateDisabled())}},{key:"updateHidden",value:function(){!this.badge||(this.badge.style.display=this.hidden?"none":"flex")}},{key:"updateDisabled",value:function(){!this.badge||!this.inverseColor||(this.disabled?(this.originalColor=this.badge.style.color,this.badge.style.color="#b9b9b9"):this.badge.style.color=this.originalColor)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.SBq),e.Y36(O.jv))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoMatBadgeIcon",""]],inputs:{igoMatBadgeIcon:"igoMatBadgeIcon",matBadgeHidden:"matBadgeHidden",matBadgeDisabled:"matBadgeDisabled",igoMatBadgeInverseColor:"igoMatBadgeInverseColor",igoMatBadgeInheritColor:"igoMatBadgeInheritColor"}}),i}(),fr=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[bt.g,O.Ps,bt.g]}),i}(),Jg=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.el=n,this.clickout=new e.vpe}return(0,v.Z)(a,[{key:"handleMouseClick",value:function(t,o){!o||this.el.nativeElement.contains(o)||this.clickout.emit(t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.SBq))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoClickout",""]],hostBindings:function(n,t){1&n&&e.NdJ("click",function(r){return t.handleMouseClick(r,r.target)},!1,e.evT)},outputs:{clickout:"clickout"}}),i}(),Bg=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i}(),Do=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.renderer=n,this.el=t,this._collapsed=!1,this.toggle=new e.vpe}return(0,v.Z)(a,[{key:"target",get:function(){return this._target},set:function(t){this._target=t}},{key:"collapsed",get:function(){return this._collapsed},set:function(t){t?this.collapseTarget():this.expandTarget(),this._collapsed=t,this.toggle.emit(t)}},{key:"click",value:function(){this.collapsed=!this.collapsed}},{key:"collapseTarget",value:function(){this.renderer.addClass(this.target,"igo-collapsed"),this.renderer.addClass(this.el.nativeElement,"collapsed")}},{key:"expandTarget",value:function(){this.renderer.removeClass(this.target,"igo-collapsed"),this.renderer.removeClass(this.el.nativeElement,"collapsed")}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.Qsj),e.Y36(e.SBq))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoCollapse",""]],hostBindings:function(n,t){1&n&&e.NdJ("click",function(){return t.click()})},inputs:{target:"target",collapsed:"collapsed"},outputs:{toggle:"toggle"}}),i}(),Ug=["*"],Fa=function(){var i=function(){function a(){(0,h.Z)(this,a),this._title="",this._collapsed=!1,this.toggle=new e.vpe}return(0,v.Z)(a,[{key:"title",get:function(){return this._title},set:function(t){this._title=t}},{key:"collapsed",get:function(){return this._collapsed},set:function(t){this._collapsed=t,this.toggle.emit(t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-collapsible"]],inputs:{title:"title",collapsed:"collapsed"},outputs:{toggle:"toggle"},ngContentSelectors:Ug,decls:7,vars:3,consts:[["svgIcon","chevron-up","mat-list-avatar","","igoCollapse","",1,"igo-chevron",3,"target","collapsed","toggle"],["matLine",""],["content",""]],template:function(n,t){if(1&n&&(e.F$t(),e.TgZ(0,"mat-list-item")(1,"mat-icon",0),e.NdJ("toggle",function(s){return t.collapsed=s}),e.qZA(),e.TgZ(2,"h4",1),e._uU(3),e.qZA()(),e.TgZ(4,"div",null,2),e.Hsn(6),e.qZA()),2&n){var o=e.MAs(5);e.xp6(1),e.Q6J("target",o)("collapsed",t.collapsed),e.xp6(2),e.Oqu(t.title)}},dependencies:[O.Hw,X.Tg,X.eA,ie.X2,Do],styles:["[_nghost-%COMP%]     .mat-list .mat-list-item.mat-list-avatar{height:auto;width:auto;padding:0}mat-list-item[_ngcontent-%COMP%]{overflow:hidden}"]}),i}(),Po=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[O.Ps,X.ie]}),i}(),Ng=function(){var i=(0,v.Z)(function a(n){(0,h.Z)(this,a),this.dialogRef=n});return i.\u0275fac=function(n){return new(n||i)(e.Y36(z.so))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-confirm-dialog"]],decls:12,vars:10,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],["mat-dialog-actions",""],["mat-button","","color","primary",3,"click"],["mat-button","",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"h2",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"div",1),e._uU(4),e.qZA(),e.TgZ(5,"div",2)(6,"button",3),e.NdJ("click",function(){return t.dialogRef.close(!0)}),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"button",4),e.NdJ("click",function(){return t.dialogRef.close(!1)}),e._uU(10),e.ALo(11,"translate"),e.qZA()()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,4,"igo.common.confirmDialog.title")),e.xp6(3),e.Oqu(t.confirmMessage),e.xp6(3),e.Oqu(e.lcZ(8,6,"igo.common.confirmDialog.confirmBtn")),e.xp6(3),e.Oqu(e.lcZ(11,8,"igo.common.confirmDialog.cancelBtn")))},dependencies:[I.lW,z.uh,z.xY,z.H8,E.X$],styles:["h2[_ngcontent-%COMP%]{margin:5px 0 10px}div[mat-dialog-content][_ngcontent-%COMP%]{max-width:200px}div[mat-dialog-actions][_ngcontent-%COMP%]{margin:10px 0 0}"]}),i}(),Za=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.dialog=n}return(0,v.Z)(a,[{key:"open",value:function(t){var o=this.dialog.open(Ng,{disableClose:!1});return o.componentInstance.confirmMessage=t,o.afterClosed()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(z.uw))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i}(),Fl=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[Za],imports:[I.ot,z.Is,he]}),i}(),Zl=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.overlay=n,this.viewContainerRef=t,this.elementRef=o,this.menuPosition=new e.vpe}return(0,v.Z)(a,[{key:"onContextMenu",value:function(t){var r,s,o=this;if(t instanceof TouchEvent?(r=t.touches[0].pageX,s=t.touches[0].pageY):t instanceof MouseEvent&&(r=t.x,s=t.y),r&&s){this.close(),t.preventDefault(),this.menuPosition.emit({x:r,y:s}),this.overlayRef=null;var l=this.overlay.position().flexibleConnectedTo({x:r,y:s}).withPositions([{originX:"end",originY:"bottom",overlayX:"start",overlayY:"top"}]);this.overlayRef=this.overlay.create({positionStrategy:l,scrollStrategy:this.overlay.scrollStrategies.close()}),this.overlayRef.attach(new gd.UE(this.menuContext,this.viewContainerRef,{$implicit:void 0})),this.sub=(0,In.R)(document,"click").pipe((0,po.h)(function(c){var u=c.target;return o.close(),!!o.overlayRef&&!o.overlayRef.overlayElement.contains(u)}),(0,We.q)(1)).subscribe(function(){return o.close()}),this.sub=(0,In.R)(document,"contextmenu").pipe((0,po.h)(function(c){var u=c.target;if(u&&!o.elementRef.nativeElement.contains(u)&&!o.overlayRef.overlayElement.contains(u))return!0;c.preventDefault()}),(0,We.q)(1)).subscribe(function(){return o.close()})}}},{key:"close",value:function(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=null),this.sub&&this.sub.unsubscribe()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(wa.aV),e.Y36(e.s_b),e.Y36(e.SBq))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoContextMenu",""]],hostBindings:function(n,t){1&n&&e.NdJ("longpress",function(r){return t.onContextMenu(r)})("contextmenu",function(r){return t.onContextMenu(r)})},inputs:{menuContext:["igoContextMenu","menuContext"]},outputs:{menuPosition:"menuPosition"}}),i}(),qg=function(){var i=function(){function a(){(0,h.Z)(this,a),this.touchDuration=400,this.onlyIOS=!0,this.longpress=new e.vpe}return(0,v.Z)(a,[{key:"touchstart",value:function(t){var o=this;this.touchTimeout=setTimeout(function(){o.onlyIOS?"iOS"===qn.getOSName()&&o.longpress.emit(t):o.longpress.emit(t)},this.touchDuration)}},{key:"touchend",value:function(){this.touchEnd()}},{key:"touchEnd",value:function(){clearTimeout(this.touchTimeout)}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275dir=e.lG2({type:i,selectors:[["","igoLongPress",""]],hostBindings:function(n,t){1&n&&e.NdJ("touchstart",function(r){return t.touchstart(r)})("touchmove",function(){return t.touchend()})("touchcancel",function(){return t.touchend()})("touchend",function(){return t.touchend()})},inputs:{touchDuration:"touchDuration",onlyIOS:"onlyIOS"},outputs:{longpress:"longpress"}}),i}(),Al=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i}(),Aa=function(){var i=function(){function a(){(0,h.Z)(this,a),this._html=""}return(0,v.Z)(a,[{key:"html",get:function(){return this._html},set:function(t){this._html=t}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-custom-html"]],inputs:{html:"html"},decls:2,vars:3,consts:[[1,"custom-html",3,"innerHTML"]],template:function(n,t){1&n&&(e._UZ(0,"div",0),e.ALo(1,"sanitizeHtml")),2&n&&e.Q6J("innerHTML",e.lcZ(1,1,t.html),e.oJD)},dependencies:[pr],styles:[".custom-html[_ngcontent-%COMP%]{padding:20px}"]}),i}(),Eo=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,O.Ps,J.AV,le.c,I.ot,he]}),i}(),mr=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.http=n}return(0,v.Z)(a,[{key:"getDom",value:function(t){return(0,ne.mG)(this,void 0,void 0,(0,Ne.Z)().mark(function o(){var r,s;return(0,Ne.Z)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return r=t.url,c.next=3,this.http.get(r).pipe((0,U.U)(function(u){return s=u,u}),(0,Ze.K)(function(u){return(0,fi._)(u)})).toPromise();case 3:return c.abrupt("return",s);case 4:case"end":return c.stop()}},o,this)}))}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),Gg=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[mr]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[mr]}),i}(),Yg=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i}(),Il=function(){function i(a){(0,h.Z)(this,i),this.componentFactory=a,this.subscriptions=[],this.inputs={},this.inputs$$={},this.subscribers={}}return(0,v.Z)(i,[{key:"setTarget",value:function(n){this.target=n,this.componentRef=n.createComponent(this.componentFactory),this.updateInputs(this.inputs),this.updateSubscribers(this.subscribers)}},{key:"destroy",value:function(){void 0!==this.target&&this.target.clear(),void 0!==this.componentRef&&(this.componentRef.destroy(),this.componentRef=void 0),this.unobserveAllInputs(),this.unsubscribeAll()}},{key:"updateInputs",value:function(n){var t=this;if(this.inputs=n,void 0!==this.componentRef){var o=this.componentRef.instance;this.componentFactory.inputs.forEach(function(s){var l=s.propName;t.unobserveInput(l);var c=n[l];n.hasOwnProperty(l)&&(c instanceof rt.y?t.observeInput(l,c):t.setInputValue(o,l,c))}),"function"==typeof o.onUpdateInputs&&o.onUpdateInputs()}}},{key:"setInputValue",value:function(n,t,o){if(o!==n[t]){var s=Object.getPrototypeOf(n),l=Object.getOwnPropertyDescriptor(s,t);void 0!==l&&void 0!==l.set?l.set.call(n,o):n[t]=o}}},{key:"updateSubscribers",value:function(n){var t=this;if(this.subscribers=n,void 0!==this.componentRef){var o=this.componentRef.instance;this.componentFactory.outputs.forEach(function(s){var l=s.propName;if(n.hasOwnProperty(l)){var c=o[l],u=n[l];Array.isArray(u)?u.forEach(function(p){t.subscriptions.push(c.subscribe(p))}):t.subscriptions.push(c.subscribe(u))}})}}},{key:"observeInput",value:function(n,t){var o=this;this.inputs$$[n]=t.subscribe(function(r){var s=o.componentRef.instance;o.setInputValue(s,n,r),"function"==typeof s.onUpdateInputs&&s.onUpdateInputs()})}},{key:"unobserveInput",value:function(n){void 0!==this.inputs$$[n]&&(this.inputs$$[n].unsubscribe(),this.inputs$$[n]=void 0)}},{key:"unobserveAllInputs",value:function(){Object.values(this.inputs$$).forEach(function(n){void 0!==n&&n.unsubscribe()}),this.inputs$$={}}},{key:"unsubscribeAll",value:function(){this.subscriptions.forEach(function(n){return n.unsubscribe()}),this.subscriptions=[]}}]),i}(),Ia=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.resolver=n}return(0,v.Z)(a,[{key:"create",value:function(t){var o=this.resolver.resolveComponentFactory(t);return new Il(o)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(e._Vd))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),jg=["target"];function Hg(i,a){}var hr=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.dynamicComponentService=n,this.cdRef=t,this.inputs={},this.subscribers={}}return(0,v.Z)(a,[{key:"ngOnChanges",value:function(t){var o=t.component,r=t.inputs,s=t.subscribers,l=se.objectsAreEquivalent;if(o&&o.currentValue){if(o.currentValue!==o.previousValue)this.createComponent(o.currentValue);else{var c=r&&l(r.currentValue||{},r.previousValue||{}),u=s&&l(s.currentValue||{},s.previousValue||{});!1===c&&this.updateInputs(),!1===u&&this.updateSubscribers()}this.cdRef.detectChanges()}}},{key:"ngOnDestroy",value:function(){this.dynamicComponent&&this.dynamicComponent.destroy()}},{key:"createComponent",value:function(t){void 0!==this.dynamicComponent&&this.dynamicComponent.destroy(),this.dynamicComponent=t instanceof Il?t:this.dynamicComponentService.create(t),this.renderComponent()}},{key:"renderComponent",value:function(){this.updateInputs(),this.updateSubscribers(),this.dynamicComponent.setTarget(this.target)}},{key:"updateInputs",value:function(){this.dynamicComponent.updateInputs(this.inputs)}},{key:"updateSubscribers",value:function(){this.dynamicComponent.updateSubscribers(this.subscribers)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Ia),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-dynamic-outlet"]],viewQuery:function(n,t){var o;1&n&&e.Gf(jg,7,e.s_b),2&n&&e.iGM(o=e.CRH())&&(t.target=o.first)},inputs:{component:"component",inputs:"inputs",subscribers:"subscribers"},features:[e.TTD],decls:2,vars:0,consts:[["target",""]],template:function(n,t){1&n&&e.YNc(0,Hg,0,0,"ng-template",null,0,e.W1O)},styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}"],changeDetection:0}),i}(),La=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez]}),i}(),Oa=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[Ia],imports:[C.ez,La,La]}),i}(),Da=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i}();var Xg=["buttons"],ef=["*",[["","formButtons",""]]],tf=function(a){return{"igo-form-body-with-buttons":a}},nf=["*","[formButtons]"],Pa=function(){var i=function(){function a(){(0,h.Z)(this,a),this.autocomplete="off",this.submitForm=new e.vpe}return(0,v.Z)(a,[{key:"hasButtons",get:function(){return 0!==this.buttons.nativeElement.children.length}},{key:"ngOnChanges",value:function(t){var o=t.formData;o&&o.currentValue!==o.previousValue&&(void 0===o.currentValue?this.clear():this.setData(o.currentValue))}},{key:"onSubmit",value:function(){this.submitForm.emit(this.getData())}},{key:"getData",value:function(){var t=this,o={};return function Ll(i){return i.groups.reduce(function(a,n){return a.concat(n.fields)},[].concat(i.fields))}(this.form).forEach(function(r){t.updateDataWithFormField(o,r)}),o}},{key:"setData",value:function(t){this.form.fields.forEach(function(o){o.control.setValue((0,_a.t)(t,o.name).safeObject)}),this.form.groups.forEach(function(o){o.fields.forEach(function(r){r.control.setValue((0,_a.t)(t,r.name).safeObject)})})}},{key:"updateDataWithFormField",value:function(t,o){var r=o.control;r.disabled||(t[o.name]=r.value)}},{key:"clear",value:function(){this.form.control.reset()}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-form"]],viewQuery:function(n,t){var o;1&n&&e.Gf(Xg,7),2&n&&e.iGM(o=e.CRH())&&(t.buttons=o.first)},inputs:{form:"form",formData:"formData",autocomplete:"autocomplete"},outputs:{submitForm:"submitForm"},features:[e.TTD],ngContentSelectors:nf,decls:7,vars:5,consts:[[3,"autocomplete","formGroup","ngSubmit"],[1,"igo-form-body",3,"ngClass"],[1,"igo-form-content"],[1,"igo-form-buttons"],["buttons",""]],template:function(n,t){1&n&&(e.F$t(ef),e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return t.onSubmit()}),e.TgZ(1,"div",1)(2,"div",2),e.Hsn(3),e.qZA(),e.TgZ(4,"div",3,4),e.Hsn(6,1),e.qZA()()()),2&n&&(e.Q6J("autocomplete",t.autocomplete)("formGroup",t.form.control),e.xp6(1),e.Q6J("ngClass",e.VKq(3,tf,t.hasButtons)))},dependencies:[C.mk,S._Y,S.JL,S.sg],styles:["[_nghost-%COMP%]{display:block}form[_ngcontent-%COMP%]{width:100%;height:100%}.igo-form-body[_ngcontent-%COMP%], .igo-form-content[_ngcontent-%COMP%]{height:100%}.igo-form-body-with-buttons[_ngcontent-%COMP%]   .igo-form-content[_ngcontent-%COMP%]{height:calc(100% - 56px)}.igo-form-content[_ngcontent-%COMP%]{display:flex}"],changeDetection:0}),i}(),rf=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,S.u5,S.UX,S.u5,S.UX]}),i}(),Ea=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.formBuilder=n}return(0,v.Z)(a,[{key:"form",value:function(t,o){var r=this.formBuilder.group({});return t.forEach(function(s){r.addControl(s.name,s.control)}),o.forEach(function(s){r.addControl(s.name,s.control)}),{fields:t,groups:o,control:r}}},{key:"group",value:function(t,o){var r=t.options||{},s=this.formBuilder.group({});if(o.forEach(function(c){s.addControl(c.name,c.control)}),r.validator){var l=this.getValidators(r.validator);s.setValidators(l)}return Object.assign({},t,{fields:o,control:s})}},{key:"field",value:function(t){var o=t.options||{},s=this.formBuilder.control({value:"",disabled:o.disabled});if(o.validator){var l=this.getValidators(o.validator);s.setValidators(l)}return Object.assign({type:"text"},t,{control:s})}},{key:"extendFieldConfig",value:function(t,o){var r=Object.assign({},t.options||{},o.options||{}),s=Object.assign({},t.inputs||{},o.inputs||{}),l=Object.assign({},t.subscribers||{},o.subscribers||{});return Object.assign({},t,{options:r,inputs:s,subscribers:l})}},{key:"getValidators",value:function(t){var o=this;return Array.isArray(t)?t.map(function(r){return o.getValidator(r)}):this.getValidator(t)}},{key:"getValidator",value:function(t){if("string"!=typeof t)return t;var r=t.match(/^([a-zA-Z]{3,15})\((.{0,20})\)$/);return r?S.kI[r[1]](r[2]):S.kI[t]}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(S.QS))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),$a=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,[{key:"getFieldByType",value:function(t){return a.fields[t]}}],[{key:"register",value:function(t,o){a.fields[t]=o}}]),a}();return i.fields={},i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function af(i,a){if(1&i&&(e.ynx(0),e._UZ(1,"igo-dynamic-outlet",1),e.BQk()),2&i){var n=e.oxw();e.xp6(1),e.Q6J("component",n.getFieldComponent())("inputs",n.getFieldInputs())("subscribers",n.getFieldSubscribers())}}var sf=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.formFieldService=n,this.fieldInputs=void 0,this.fieldSubscribers=void 0}return(0,v.Z)(a,[{key:"fieldOptions",get:function(){return this.field.options||{}}},{key:"getFieldComponent",value:function(){return this.formFieldService.getFieldByType(this.field.type||"text")}},{key:"getFieldInputs",value:function(){if(void 0!==this.fieldInputs)return this.fieldInputs;var t=this.fieldOptions.errors||{};return this.fieldInputs=Object.assign({placeholder:this.field.title,disableSwitch:this.fieldOptions.disableSwitch||!1},Object.assign({},this.field.inputs||{}),{formControl:this.field.control,errors:Object.assign({},{required:"igo.common.form.errors.required"},t)}),this.fieldInputs}},{key:"getFieldSubscribers",value:function(){return void 0!==this.fieldSubscribers||(this.fieldSubscribers=Object.assign({},this.field.subscribers||{})),this.fieldSubscribers}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36($a))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-form-field"]],inputs:{field:"field"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"component","inputs","subscribers"]],template:function(n,t){1&n&&e.YNc(0,af,2,3,"ng-container",0),2&n&&e.Q6J("ngIf",void 0!==t.field)},dependencies:[C.O5,hr],styles:["mat-form-field{width:100%}  .igo-form-disable-switch{margin-right:8px}"],changeDetection:0}),i}(),Ra=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,S.u5,S.UX,O.Ps,B.lN,le.c,ke.LD,he,La]}),i}();function mf(i,a){if(1&i&&(e.TgZ(0,"div",5),e._UZ(1,"igo-form-field",6),e.qZA()),2&i){var n=a.$implicit,t=e.oxw(2);e.Q6J("ngClass",t.getFieldNgClass(n)),e.xp6(1),e.Q6J("field",n)}}function hf(i,a){if(1&i&&(e.TgZ(0,"div",3),e.YNc(1,mf,2,2,"div",4),e.qZA()),2&i){var n=e.oxw();e.xp6(1),e.Q6J("ngForOf",n.group.fields)}}function vf(i,a){if(1&i&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){var n=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,1,n.getErrorMessage()))}}var yf=["*"],Ol=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,[{key:"formControl",get:function(){return this.group.control}},{key:"getFieldColSpan",value:function(t){var o=2,r=t.options||{};return r.cols&&r.cols>0&&(o=Math.min(r.cols,2)),o}},{key:"getFieldNgClass",value:function(t){var o=this.getFieldColSpan(t);return(0,de.Z)({},"igo-form-field-colspan-".concat(o),!0)}},{key:"getErrorMessage",value:function(){return function _r(i,a){var o=Object.keys(i.errors||{}).map(function(r){return a[r]}).filter(function(r){return void 0!==r});return o.length>0?o[0]:""}(this.formControl,(this.group.options||{}).errors||{})}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-form-group"]],inputs:{group:"group",errors:"errors"},ngContentSelectors:yf,decls:4,vars:2,consts:[["class","igo-form-group-fields",4,"ngIf"],[1,"igo-form-group-extra-content"],[4,"ngIf"],[1,"igo-form-group-fields"],["class","igo-form-field-wrapper",3,"ngClass",4,"ngFor","ngForOf"],[1,"igo-form-field-wrapper",3,"ngClass"],[3,"field"]],template:function(n,t){1&n&&(e.F$t(),e.YNc(0,hf,2,1,"div",0),e.TgZ(1,"div",1),e.Hsn(2),e.qZA(),e.YNc(3,vf,3,3,"mat-error",2)),2&n&&(e.Q6J("ngIf",t.group&&t.group.fields.length>0),e.xp6(3),e.Q6J("ngIf",t.formControl.errors))},dependencies:[C.mk,C.sg,C.O5,B.TO,sf,E.X$],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block;overflow:auto;padding:10px 5px}.igo-form-field-wrapper[_ngcontent-%COMP%]{display:inline-block;padding:0 5px}.igo-form-field-colspan-2[_ngcontent-%COMP%]{width:100%}.igo-form-field-colspan-1[_ngcontent-%COMP%]{width:50%}"],changeDetection:0}),i}(),Dl=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,B.lN,he,Ra]}),i}(),Ci=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[Ea,$a],imports:[C.ez,Dl,Ra,rf,Dl,Ra]}),i}(),Ja=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,S.u5,ke.LD]}),i}(),Cr=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i}(),Ba=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[lr.TU]}),i}(),Ua=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i}(),$o=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,Pe.p0,_t.Bb,go.JX,O.Ps,I.ot,pt.p9,lr.TU,ke.LD,Cr,Eo,Ba,Ua,he,S.u5,S.UX,le.c,jn.FA,J.AV]}),i}(),Pl=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,Ja,$o,Ba]}),i}(),El=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.http=n,this.configService=t,this.jsonURL=this.getPathToConfigFile()}return(0,v.Z)(a,[{key:"loadConfigTour",value:function(){var t=this;this.getJSON().subscribe(function(o){t.allToursOptions=o},function(o){throw new Error("Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.")})}},{key:"getPathToConfigFile",value:function(){return this.configService.getConfig("interactiveTour.pathToConfigFile")||"./config/interactiveTour.json"}},{key:"getJSON",value:function(){return this.http.get(this.jsonURL).pipe((0,Ze.K)(function(t){throw t.error.caught=!0,t}))}},{key:"getTourOptionData",value:function(t){if(void 0!==this.allToursOptions){var o=t;return o=o.replace(/\s/g,""),this.allToursOptions[o]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG(j))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i}(),Na=function(){var i=function(){function a(n,t,o,r,s){(0,h.Z)(this,a),this.configService=n,this.mediaService=t,this.languageService=o,this.interactiveTourLoader=r,this.shepherdService=s,this.nextIndex=1,this.isAppHaveTour()&&this.interactiveTourLoader.loadConfigTour()}return(0,v.Z)(a,[{key:"isAppHaveTour",value:function(){var t=this.configService.getConfig("interactiveTour.activateInteractiveTour");return void 0===t||t}},{key:"isToolHaveTourConfig",value:function(t){return void 0!==this.interactiveTourLoader.getTourOptionData(t)}},{key:"disabledTourButton",value:function(t){var o=this.interactiveTourLoader.getTourOptionData(t);if(null!=o&&o.conditions){var s,r=(0,D.Z)(null==o?void 0:o.conditions);try{for(r.s();!(s=r.n()).done;)if(null===document.querySelector(s.value))return!0}catch(c){r.e(c)}finally{r.f()}}return!1}},{key:"isMobile",value:function(){return this.mediaService.isMobile()}},{key:"isTourDisplayInMobile",value:function(){return void 0===this.configService.getConfig("interactiveTour.tourInMobile")||this.configService.getConfig("interactiveTour.tourInMobile")}},{key:"getButtons",value:function(t){return"noBackButton"===t?[{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]:"first"===t?[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.exitButton"),type:"cancel"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]:"last"===t?[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.backButton"),type:"back"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.exitButton"),type:"cancel"}]:[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.backButton"),type:"back"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]}},{key:"getAction",value:function(t){return{click:"click"}[t.toLowerCase()]}},{key:"addProgress",value:function(){var t=this,o=0,s=setInterval(function(){if(t.getCurrentStep()){if(t.getCurrentStep().options.attachTo.element&&!document.querySelector(t.getCurrentStep().options.attachTo.element))return t.cancel(),void clearInterval(s);var l=t.getCurrentStep().getElement();l&&l.querySelectorAll(".shepherd-content, .shepherd-text").forEach(function(g){g.classList.add("mat-typography")});var u=l?l.querySelector(".shepherd-header"):void 0;if(o++,(u||o>21)&&clearInterval(s),u){var p=t.steps,d=document.createElement("span");d.className="shepherd-progress",d.innerText="".concat(p.indexOf(t.getCurrentStep())+1,"/").concat(p.length),u.insertBefore(d,l.querySelector(".shepherd-cancel-icon"))}}},100)}},{key:"checkNext",value:function(t,o,r){if(o.getCurrentStep()){if(o.getCurrentStep().options.attachTo.element&&document.querySelector(o.getCurrentStep().options.attachTo.element))return void o.complete();if(t.index===o.steps.length-1)return void o.complete();o.steps.splice(t.index,1);var s=o.steps[t.index];s.options.attachTo.element&&!document.querySelector(s.options.attachTo.element)?r.checkNext(t,o,r):(o._setupModal(),o.show(s.id))}}},{key:"executeAction",value:function(t,o){if(o&&(!o.condition||!("!"===o.condition.charAt(0)&&document.querySelector(o.condition.slice(1))||"!"!==o.condition.charAt(0)&&!document.querySelector(o.condition)))){var r=document.querySelector(o.element||t.element),s=this.getAction(o.action);r&&s&&r[s]()}}},{key:"executeActionPromise",value:function(t,o){var r=this;return new Promise(function(s){if(r.executeAction(t,o),o&&o.waitFor)var l=0,c=o.maxWait?o.maxWait/100:20,u=setInterval(function(){(++l>c||document.querySelector(o.waitFor))&&(clearInterval(u),s())},100);else s()})}},{key:"getShepherdSteps",value:function(t){var c,o=this,r=[],s=0,l=(0,D.Z)(t.steps);try{var u=function(){var d=c.value;r.push({attachTo:{element:d.element,on:d.position||t.position},popperOptions:{modifiers:[{name:"offset",options:{offset:[0,15]}}]},beforeShowPromise:function(){return Promise.all([o.executeActionPromise(o.previousStep,o.previousStep?o.previousStep.beforeChange:void 0),o.executeActionPromise(d,d.beforeShow)])},buttons:o.getButtons(0===s?"first":s+1===t.steps.length?"last":t.steps[s].noBackButton?"noBackButton":void 0),classes:d.class,highlightClass:d.highlightClass,scrollTo:d.scrollToElement||t.scrollToElement||!0,canClickTarget:d.disableInteraction?!d.disableInteraction:void 0,title:o.languageService.translate.instant(d.title||t.title),text:[o.languageService.translate.instant(d.text)],when:{show:function(){o.executeAction(d,d.onShow)},hide:function(){o.previousStep=d,o.executeAction(d,d.onHide)}}}),s++};for(l.s();!(c=l.n()).done;)u()}catch(p){l.e(p)}finally{l.f()}return r}},{key:"startTour",value:function(t){var o=this,r=this.interactiveTourLoader.getTourOptionData(t);this.shepherdService.defaultStepOptions={classes:r.class,highlightClass:r.highlightClass,canClickTarget:!r.disableInteraction||!r.disableInteraction,cancelIcon:{enabled:!0}};var s=this.getShepherdSteps(r);this.shepherdService.modal=!0,this.shepherdService.confirmCancel=!1,this.shepherdService.addSteps(s),this.shepherdService.tourObject.on("show",this.addProgress),this.shepherdService.tourObject.on("cancel",function(l){o.checkNext(l,o.shepherdService.tourObject,o)}),this.shepherdService.start()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(j),e.LFG(xt),e.LFG($),e.LFG(El),e.LFG(fd.a))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),$l=function(){function i(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,h.Z)(this,i),this.options=a,this.activeTool$=new x.X(void 0),this.toolbar$=new x.X([]),this.activeToolHistory=[],this.store=new mt([],{getKey:function(t){return t.name}}),this.setToolbar(a.toolbar),this.initStore()}return(0,v.Z)(i,[{key:"tools$",get:function(){return this.store.entities$}},{key:"destroy",value:function(){this.activeTool$$.unsubscribe(),this.store.destroy()}},{key:"getTool",value:function(n){return this.store.get(n)}},{key:"getTools",value:function(){return this.store.all()}},{key:"setTools",value:function(n){this.store.load(n)}},{key:"getToolbar",value:function(){return this.toolbar$.getValue()}},{key:"setToolbar",value:function(n){this.toolbar$.next(n||[])}},{key:"activateTool",value:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=this.getTool(n);void 0!==o&&this.store.state.update(o,{active:!0,options:t},!0)}},{key:"activatePreviousTool",value:function(){if(this.activeToolHistory.length<=1)this.deactivateTool();else{var n=this.activeToolHistory.splice(-2,2),t=(0,Qe.Z)(n,2);this.activateTool(t[0])}}},{key:"deactivateTool",value:function(){this.clearActiveToolHistory(),this.store.state.updateAll({active:!1})}},{key:"initStore",value:function(){var n=this;this.store=new mt([],{getKey:function(o){return o.name}}),this.activeTool$$=this.store.stateView.firstBy$(function(t){return!0===t.state.active}).subscribe(function(t){if(void 0!==t){var o=t.entity,r=Object.assign({},o.options||{},t.state.options||{});n.setActiveTool(Object.assign({},o,{options:r}))}else n.setActiveTool(void 0)})}},{key:"setActiveTool",value:function(n){this.activeTool$.next(n),void 0===n?this.clearActiveToolHistory():this.activeToolHistory=this.activeToolHistory.filter(function(t){return t!==n.name}).concat([n.name])}},{key:"clearActiveToolHistory",value:function(){this.activeToolHistory=[]}}]),i}(),Ro=function(){var i=function(){function a(){(0,h.Z)(this,a),this.toolbox=new $l,this.toolbox.setTools(this.getTools())}return(0,v.Z)(a,[{key:"getTool",value:function(t){return a.tools[t]}},{key:"getTools",value:function(){return Object.values(a.tools)}}],[{key:"register",value:function(t){a.tools[t.name]=t}}]),a}();return i.tools={},i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function _f(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.startInteractiveTour())}),e.TgZ(1,"span",2),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.ALo(5,"async"),e.qZA(),e._UZ(6,"mat-icon",3),e.ALo(7,"translate"),e.ALo(8,"translate"),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("ngClass",t.getClass())("disabled",t.disabledTourButton),e.xp6(2),e.AsE("",e.lcZ(3,5,"igo.common.interactiveTour.buttonTitle")," ",e.lcZ(4,7,e.lcZ(5,9,t.discoverTitleInLocale$)),""),e.xp6(4),e.Q6J("matTooltip",t.disabledTourButton?e.lcZ(7,11,"igo.common.interactiveTour.disaledTooltipTourToolButton"):e.lcZ(8,13,"igo.common.interactiveTour.tooltipTourToolButton"))}}var Rl=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.interactiveTourService=n,this.toolService=t,this.tourToStart="",this.discoverTitleInLocale$=(0,ge.of)("IGO")}return(0,v.Z)(a,[{key:"getClass",value:function(){return{"tour-button-tool-icon":"icon"===this.styleButton,"tour-button-tool":"raised"===this.styleButton}}},{key:"toolbox",get:function(){return this.toolService.toolbox}},{key:"getTourToStart",value:function(){return this.tourToStart?this.tourToStart:this.activeToolName}},{key:"activeToolName",get:function(){if(this.toolbox)return this.isActiveTool?this.toolbox.activeTool$.getValue().name:"global"}},{key:"isActiveTool",get:function(){if(this.toolbox)return void 0!==this.toolbox.activeTool$.getValue()}},{key:"isToolHaveTour",get:function(){return!("about"===this.activeToolName&&!this.tourToStart)&&this.interactiveTourService.isToolHaveTourConfig(this.getTourToStart())}},{key:"showTourButton",get:function(){var o;return!1!==this.isToolHaveTour&&!(this.interactiveTourService.isMobile()&&(o=this.isTourDisplayInMobile,!1===o))}},{key:"isTourDisplayInMobile",get:function(){return this.interactiveTourService.isTourDisplayInMobile()}},{key:"disabledTourButton",get:function(){return this.interactiveTourService.disabledTourButton(this.activeToolName)}},{key:"startInteractiveTour",value:function(){var t=this.getTourToStart();t&&this.interactiveTourService.startTour(t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Na),e.Y36(Ro))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-interactive-tour"]],inputs:{tourToStart:"tourToStart",styleButton:"styleButton",discoverTitleInLocale$:"discoverTitleInLocale$"},decls:1,vars:1,consts:[["mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","disabled","click",4,"ngIf"],["mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","disabled","click"],[1,"interactive-tour-button-title"],["svgIcon","presentation-play",3,"matTooltip"]],template:function(n,t){1&n&&e.YNc(0,_f,9,15,"button",0),2&n&&e.Q6J("ngIf",t.showTourButton)},dependencies:[C.mk,C.O5,O.Hw,I.lW,J.gM,C.Ov,E.X$],styles:[".shepherd-has-title .shepherd-content .shepherd-header{padding:.5em .75em}.shepherd-title{margin:0!important;font-weight:revert!important}.shepherd-progress{margin-right:15px;color:#737373}.shepherd-text{font-size:14px!important}.shepherd-element{border:1px solid;border-color:#474747;box-shadow:4px 5px #65656599}\n"],encapsulation:2}),i}(),Jl=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[Na,El],imports:[C.ez,O.Ps,I.ot,J.AV,he]}),i}(),vo=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,[{key:"transform",value:function(t,o){var r=[];return Object.getOwnPropertyNames(t).forEach(function(s){return r.push({key:s,value:t[s]})}),r}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275pipe=e.Yjl({name:"keyvalue",type:i,pure:!0}),i}(),Jo=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i}(),Yt=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.renderer=n,this.el=t,this._color="primary",this._focused=!1,this._selected=!1,this._disabled=!1,this.beforeSelect=new e.vpe,this.beforeFocus=new e.vpe,this.beforeUnselect=new e.vpe,this.beforeUnfocus=new e.vpe,this.beforeDisable=new e.vpe,this.beforeEnable=new e.vpe,this.focus=new e.vpe,this.unfocus=new e.vpe,this.select=new e.vpe,this.unselect=new e.vpe,this.disable=new e.vpe,this.enable=new e.vpe}return(0,v.Z)(a,[{key:"color",get:function(){return this._color},set:function(t){this._color=t}},{key:"focused",get:function(){return this._focused},set:function(t){t!==this._focused&&(this.disabled||(t?this.beforeFocus.emit(this):this.beforeUnfocus.emit(this),this._focused=t,!0!==this.selected&&this.toggleFocusedClass(),t?this.focus.emit(this):this.unfocus.emit(this)))}},{key:"selected",get:function(){return this._selected},set:function(t){t!==this._selected&&(this.disabled||(t?this.beforeSelect.emit(this):this.beforeUnselect.emit(this),this._selected=t,this._focused=t,this.toggleSelectedClass(),t?this.select.emit(this):this.unselect.emit(this)))}},{key:"disabled",get:function(){return this._disabled},set:function(t){t!==this._disabled&&(!0===t&&(this.selected=!1),t?this.beforeDisable.emit(this):this.beforeEnable.emit(this),this._disabled=t,this.toggleDisabledClass(),t?this.disable.emit(this):this.enable.emit(this))}},{key:"onClick",value:function(){this.selected=!0}},{key:"getOffsetTop",value:function(){return this.el.nativeElement.offsetTop-5}},{key:"toggleFocusedClass",value:function(){this.focused?this.addCls(a.focusedCls):this.removeCls(a.focusedCls)}},{key:"toggleSelectedClass",value:function(){this.selected?(this.addCls(a.selectedCls),this.removeCls(a.focusedCls)):this.removeCls(a.selectedCls)}},{key:"toggleDisabledClass",value:function(){this.disabled?this.addCls(a.disabledCls):this.removeCls(a.disabledCls)}},{key:"addCls",value:function(t){this.renderer.addClass(this.el.nativeElement,t)}},{key:"removeCls",value:function(t){this.renderer.removeClass(this.el.nativeElement,t)}}]),a}();return i.focusedCls="igo-list-item-focused",i.selectedCls="igo-list-item-selected",i.disabledCls="igo-list-item-disabled",i.\u0275fac=function(n){return new(n||i)(e.Y36(e.Qsj),e.Y36(e.SBq))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoListItem",""]],hostBindings:function(n,t){1&n&&e.NdJ("click",function(){return t.onClick()})},inputs:{color:"color",focused:"focused",selected:"selected",disabled:"disabled"},outputs:{beforeSelect:"beforeSelect",beforeFocus:"beforeFocus",beforeUnselect:"beforeUnselect",beforeUnfocus:"beforeUnfocus",beforeDisable:"beforeDisable",beforeEnable:"beforeEnable",focus:"focus",unfocus:"unfocus",select:"select",unselect:"unselect",disable:"disable",enable:"enable"}}),i}(),If=function(a){return{selectable:a}},Lf=["*"],Pn=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.el=n,this._navigation=!0,this._selection=!0,this.subscriptions=[]}return(0,v.Z)(a,[{key:"navigation",get:function(){return this._navigation},set:function(t){this._navigation=t}},{key:"selection",get:function(){return this._selection},set:function(t){this._selection=t}},{key:"selectedItem",get:function(){return this._selectedItem},set:function(t){this.focusedItem=t,this._selectedItem=t}},{key:"focusedItem",get:function(){return this._focusedItem},set:function(t){this._focusedItem=t}},{key:"handleKeyboardEvent",value:function(t){this.navigationEnabled&&("ArrowUp"===t.key||"ArrowDown"===t.key?(t.preventDefault(),this.navigate(t.key)):"Enter"===t.key&&this.select(this.focusedItem))}},{key:"ngOnInit",value:function(){this.enableNavigation()}},{key:"ngAfterViewInit",value:function(){var t=this;this.listItems.length&&this.init(),this.listItems$$=this.listItems.changes.subscribe(function(o){return t.init()})}},{key:"ngOnDestroy",value:function(){this.listItems$$.unsubscribe()}},{key:"focus",value:function(t){!this.selection||(this.unfocus(),void 0!==t&&(t.focused=!0))}},{key:"unfocus",value:function(){void 0!==this.focusedItem&&(this.focusedItem.focused=!1),this.focusedItem=void 0}},{key:"focusNext",value:function(){var o,t=this.listItems.toArray(),r=this.el.nativeElement,s=!0,l=this.getFocusedIndex();for(void 0===l&&(l=-1);s&&l<t.length-1;)s=(o=t[l+=1]).disabled;void 0!==o&&this.focus(o),t[l+1]?void 0!==o&&!this.isScrolledIntoView(o.el.nativeElement)&&(r.scrollTop=o.el.nativeElement.offsetTop+o.el.nativeElement.children[0].offsetHeight-r.clientHeight):r.scrollTop=r.scrollHeight-r.clientHeight}},{key:"focusPrevious",value:function(){for(var o,t=this.listItems.toArray(),r=this.el.nativeElement,s=!0,l=this.getFocusedIndex();s&&l>0;)s=(o=t[l-=1]).disabled;void 0!==o&&this.focus(o),t[l-1]?void 0===o||this.isScrolledIntoView(o.el.nativeElement)||(r.scrollTop=o.el.nativeElement.offsetTop-3):r.scrollTop=0}},{key:"select",value:function(t){!this.selection||(this.unselect(),void 0!==t&&(t.selected=!0))}},{key:"unselect",value:function(){this.unfocus(),void 0!==this.selectedItem&&(this.selectedItem.selected=!1),this.selectedItem=void 0}},{key:"enableNavigation",value:function(){this.navigation&&(this.navigationEnabled=!0)}},{key:"disableNavigation",value:function(){this.navigationEnabled=!1}},{key:"scrollToItem",value:function(t){this.el.nativeElement.scrollTop=t.getOffsetTop()}},{key:"isScrolledIntoView",value:function(t){var o=this.el.nativeElement.scrollTop+this.el.nativeElement.offsetTop,s=t.offsetTop;return s+t.children[0].offsetHeight<=o+this.el.nativeElement.clientHeight&&s>=o}},{key:"init",value:function(){this.subscribe(),this.selectedItem=this.findSelectedItem(),this.focusedItem=this.findFocusedItem(),this.enableNavigation()}},{key:"subscribe",value:function(){var t=this;this.unsubscribe(),this.listItems.toArray().forEach(function(o){t.subscriptions.push(o.beforeSelect.subscribe(function(r){return t.handleItemBeforeSelect(r)})),t.subscriptions.push(o.select.subscribe(function(r){return t.handleItemSelect(r)})),t.subscriptions.push(o.beforeFocus.subscribe(function(r){return t.handleItemBeforeFocus(r)})),t.subscriptions.push(o.focus.subscribe(function(r){return t.handleItemFocus(r)}))},this)}},{key:"unsubscribe",value:function(){this.subscriptions.forEach(function(t){return t.unsubscribe()}),this.subscriptions=[]}},{key:"handleItemBeforeFocus",value:function(t){t!==this.focusedItem&&this.unfocus()}},{key:"handleItemFocus",value:function(t){this.focusedItem=t}},{key:"handleItemBeforeSelect",value:function(t){t!==this.focusedItem&&this.unselect()}},{key:"handleItemSelect",value:function(t){this.selectedItem=t}},{key:"findSelectedItem",value:function(){return this.listItems.toArray().find(function(t){return t.selected})}},{key:"findFocusedItem",value:function(){return this.listItems.toArray().find(function(t){return t.focused})}},{key:"getFocusedIndex",value:function(){var t=this;return this.listItems.toArray().findIndex(function(o){return o===t.focusedItem})}},{key:"navigate",value:function(t){switch(t){case"ArrowUp":this.focusPrevious();break;case"ArrowDown":this.focusNext()}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.SBq))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-list"]],contentQueries:function(n,t,o){var r;1&n&&e.Suo(o,Yt,5),2&n&&e.iGM(r=e.CRH())&&(t.listItems=r)},hostBindings:function(n,t){1&n&&e.NdJ("keydown",function(r){return t.handleKeyboardEvent(r)},!1,e.evT)("enter",function(r){return t.handleKeyboardEvent(r)},!1,e.evT)},inputs:{navigation:"navigation",selection:"selection"},ngContentSelectors:Lf,decls:2,vars:3,consts:[["igoClickout","",3,"ngClass","clickout","click"]],template:function(n,t){1&n&&(e.F$t(),e.TgZ(0,"mat-list",0),e.NdJ("clickout",function(){return t.disableNavigation()})("click",function(){return t.enableNavigation()}),e.Hsn(1),e.qZA()),2&n&&e.Q6J("ngClass",e.VKq(1,If,t.selection))},dependencies:[C.mk,X.i$,Jg],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto;position:relative}mat-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]{position:static}[_nghost-%COMP%]     .mat-list .mat-list-item .mat-list-text>*{white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;max-height:36px;line-height:18px;-webkit-box-orient:vertical;-webkit-line-clamp:2}[_nghost-%COMP%]     .mat-list .mat-list-item.mat-list-item-with-avatar .mat-list-item-content{display:-webkit-flex;height:46px;padding:3px}[_nghost-%COMP%]     .mat-list .mat-list-item.mat-list-item-with-avatar{height:46px}[_nghost-%COMP%]     .mat-list   igo-collapsible>.mat-list-item>.mat-list-item-content>.mat-list-text>.mat-line{font-weight:700;opacity:.9}[_nghost-%COMP%]     .mat-list .mat-list-item.mat-list-item-with-avatar .mat-list-item-content>mat-icon{padding:8px}[_nghost-%COMP%]     [igolistitem] mat-list-item [mat-list-avatar]{height:auto;width:40px}[_nghost-%COMP%]   mat-list.selectable[_ngcontent-%COMP%]     [igolistitem]:not(.igo-list-item-disabled) mat-list-item:hover{cursor:pointer}[_nghost-%COMP%]     [igolistitem]:focus{outline:none}"]}),i}(),yo=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,O.Ps,X.ie,Bg]}),i}();function Of(i,a){if(1&i&&(e.TgZ(0,"div",2)(1,"h3"),e.Hsn(2,1),e.TgZ(3,"div",3),e._uU(4),e.Hsn(5,2),e.qZA(),e.Hsn(6,3),e.qZA()()),2&i){var n=e.oxw();e.xp6(4),e.hij(" ",n.title," ")}}var Df=["*",[["","panelLeftButton",""]],[["","panelHeader",""]],[["","panelRightButton",""]]],Pf=["*","[panelLeftButton]","[panelHeader]","[panelRightButton]"],Ut=function(){var i=function(){function a(){(0,h.Z)(this,a),this._withHeader=!0}return(0,v.Z)(a,[{key:"title",get:function(){return this._title},set:function(t){this._title=t}},{key:"withHeader",get:function(){return this._withHeader},set:function(t){this._withHeader=t}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-panel"]],hostVars:2,hostBindings:function(n,t){2&n&&e.ekj("igo-panel-with-header",t.withHeader)},inputs:{title:"title",withHeader:"withHeader"},ngContentSelectors:Pf,decls:3,vars:1,consts:[["class","igo-panel-header mat-typography","title","",4,"ngIf"],["title","",1,"igo-panel-content"],["title","",1,"igo-panel-header","mat-typography"],[1,"igo-panel-title"]],template:function(n,t){1&n&&(e.F$t(Df),e.YNc(0,Of,7,1,"div",0),e.TgZ(1,"div",1),e.Hsn(2),e.qZA()),2&n&&e.Q6J("ngIf",t.withHeader)},dependencies:[C.O5],styles:["[_nghost-%COMP%]{display:block}.igo-panel-header[_ngcontent-%COMP%]{height:46px;padding:3px;text-align:center}.igo-panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;height:40px}.igo-panel-header[_ngcontent-%COMP%]     [panelleftbutton]{float:left;margin-right:-40px}.igo-panel-header[_ngcontent-%COMP%]     [panelrightbutton]{float:right}.igo-panel-content[_ngcontent-%COMP%]{overflow:auto}.igo-panel-with-header[_nghost-%COMP%]   .igo-panel-content[_ngcontent-%COMP%]{height:calc(100% - 46px)}[_nghost-%COMP%]:not(.igo-panel-with-header)   .igo-panel-content[_ngcontent-%COMP%]{height:100%}.igo-panel-title[_ngcontent-%COMP%]{display:block;width:calc(100% - 80px);margin-left:40px;height:100%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;line-height:40px;float:left;font-weight:700;font-size:1.17em}"],changeDetection:0}),i}(),Pt=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez]}),i}(),Ef=function(a){return{"igo-spinner-container":!0,"igo-spinner-shown":a}},Sr=function(){var i=function(){function a(){(0,h.Z)(this,a),this.shown$=new x.X(!1)}return(0,v.Z)(a,[{key:"shown",get:function(){return this.shown$.value},set:function(t){this.shown$.next(t)}},{key:"show",value:function(){this.shown=!0}},{key:"hide",value:function(){this.shown=!1}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-spinner"]],inputs:{shown:"shown"},decls:4,vars:5,consts:[[3,"ngClass"],[1,"igo-spinner-background"],["diameter","40","mode","indeterminate"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.ALo(1,"async"),e._UZ(2,"div",1)(3,"mat-progress-spinner",2),e.qZA()),2&n&&e.Q6J("ngClass",e.VKq(3,Ef,e.lcZ(1,1,t.shown$)))},dependencies:[C.mk,wl.Ou,C.Ov],styles:[".igo-spinner-container[_ngcontent-%COMP%]{display:none;pointer-events:none}.igo-spinner-container.igo-spinner-shown[_ngcontent-%COMP%]{display:block}mat-progress-spinner[_ngcontent-%COMP%]{height:40px;width:40px;border-radius:50%}.igo-spinner-background[_ngcontent-%COMP%]{height:36px;width:36px;border-radius:50%;border:4px solid #ffffff;position:absolute;top:2px;left:2px}"]}),i}(),$f=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.spinner=n,this.activityService=t}return(0,v.Z)(a,[{key:"ngOnInit",value:function(){var t=this;this.counter$$=this.activityService.counter$.pipe((0,De.b)(50)).subscribe(function(o){o>0?t.spinner.show():t.spinner.hide()})}},{key:"ngOnDestroy",value:function(){this.counter$$.unsubscribe()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Sr,2),e.Y36(mi))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoSpinnerActivity",""]]}),i}(),wr=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,wl.Cq]}),i}(),Bl=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o,r){var s;return(0,h.Z)(this,n),(s=a.call(this))._database=t,s._model=o,s._sort=r,s._filterChange=new x.X(""),s}return(0,v.Z)(n,[{key:"filter",get:function(){return this._filterChange.value},set:function(o){this._filterChange.next(o)}},{key:"connect",value:function(){var o=this;return this._database?Ca.T.apply(void 0,[this._database.dataChange,this._filterChange,this._sort.sortChange]).pipe((0,U.U)(function(){return o.getFilteredData(o._database.data)}),(0,U.U)(function(s){return o.getSortedData(s)})):(0,Ca.T)([])}},{key:"disconnect",value:function(){}},{key:"getFilteredData",value:function(o){var r=this;return this.filter?o.slice().filter(function(s){return-1!==r._model.columns.filter(function(c){return c.filterable}).map(function(c){return se.resolve(s,c.name)}).join(" ").toLowerCase().indexOf(r.filter.toLowerCase())}):o}},{key:"getSortedData",value:function(o){var r=this;return this._sort.active&&""!==this._sort.direction?o.sort(function(s,l){var c=se.resolve(s,r._sort.active),u=se.resolve(l,r._sort.active);return se.naturalCompare(u,c,r._sort.direction)}):o}}]),n}(Ta.o2),Si=function(){return(i=Si||(Si={}))[i.primary=0]="primary",i[i.accent=1]="accent",i[i.warn=2]="warn",Si;var i}(),Rf=["filter"];function Jf(i,a){1&i&&(e.TgZ(0,"div",12)(1,"mat-form-field",13),e._UZ(2,"input",14,15),e.ALo(4,"translate"),e.qZA()()),2&i&&(e.xp6(2),e.Q6J("placeholder",e.lcZ(4,1,"igo.common.table.filter")))}function Bf(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"th",16)(1,"mat-checkbox",17),e.NdJ("change",function(r){e.CHM(n);var s=e.oxw();return e.KtG(r?s.masterToggle():null)}),e.qZA()()}if(2&i){var t=e.oxw();e.xp6(1),e.Q6J("checked",t.selection.hasValue()&&t.isAllSelected())("indeterminate",t.selection.hasValue()&&!t.isAllSelected())}}function Uf(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"td",18)(1,"mat-checkbox",19),e.NdJ("click",function(s){return s.stopPropagation()})("change",function(s){var c=e.CHM(n).$implicit,u=e.oxw();return e.KtG(s?u.selection.toggle(c):null)}),e.qZA()()}if(2&i){var t=a.$implicit,o=e.oxw();e.xp6(1),e.Q6J("checked",o.selection.isSelected(t))}}function Nf(i,a){if(1&i&&(e.TgZ(0,"th",25),e._uU(1),e.qZA()),2&i){var n=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",n.title," ")}}function qf(i,a){1&i&&(e.ynx(0),e.YNc(1,Nf,2,1,"th",24),e.BQk())}function Gf(i,a){if(1&i&&(e.TgZ(0,"th",16),e._uU(1),e.qZA()),2&i){var n=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",n.title," ")}}function Qf(i,a){1&i&&(e.ynx(0),e.YNc(1,Gf,2,1,"th",6),e.BQk())}var qa=function(){return{}};function Yf(i,a){if(1&i&&(e.TgZ(0,"td",27),e._uU(1),e.qZA()),2&i){var n=a.$implicit,t=e.oxw(2).$implicit,o=e.oxw();e.Q6J("ngClass",o.model.cellClassFunc?o.model.cellClassFunc(n,t):e.DdM(2,qa)),e.xp6(1),e.hij(" ",o.getValue(n,t.name)," ")}}function jf(i,a){1&i&&(e.ynx(0),e.YNc(1,Yf,2,3,"td",26),e.BQk())}function Hf(i,a){if(1&i&&e._UZ(0,"td",29),2&i){var n=a.$implicit,t=e.oxw(2).$implicit,o=e.oxw();e.Q6J("ngClass",o.model.cellClassFunc?o.model.cellClassFunc(n,t):e.DdM(2,qa))("innerHTML",o.getValue(n,t.name),e.oJD)}}function Vf(i,a){1&i&&e.YNc(0,Hf,1,3,"td",28)}function zf(i,a){if(1&i&&(e.ynx(0,20),e.YNc(1,qf,2,0,"ng-container",21),e.YNc(2,Qf,2,0,"ng-container",21),e.YNc(3,jf,2,0,"ng-container",22),e.YNc(4,Vf,1,0,"ng-template",null,23,e.W1O),e.BQk()),2&i){var n=a.$implicit,t=e.MAs(5);e.Q6J("matColumnDef",n.name),e.xp6(1),e.Q6J("ngIf",n.sortable),e.xp6(1),e.Q6J("ngIf",!n.sortable),e.xp6(1),e.Q6J("ngIf",!n.html)("ngIfElse",t)}}function Wf(i,a){1&i&&e._UZ(0,"th",16)}function Kf(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",31),e.NdJ("click",function(s){var c=e.CHM(n).$implicit,u=e.oxw().$implicit,p=e.oxw();return e.KtG(p.handleClickAction(s,c,u))}),e._UZ(1,"mat-icon",32),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw(2);e.Q6J("color",o.getActionColor(t.color)),e.xp6(1),e.s9C("svgIcon",t.icon)}}function Xf(i,a){if(1&i&&(e.TgZ(0,"td",18),e.YNc(1,Kf,2,2,"button",30),e.qZA()),2&i){var n=e.oxw();e.xp6(1),e.Q6J("ngForOf",n.model.actions)}}function em(i,a){1&i&&e._UZ(0,"tr",33)}function tm(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"tr",34),e.NdJ("click",function(){var l=e.CHM(n).$implicit,c=e.oxw();return e.KtG(c.selection.toggle(l))}),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw();e.Q6J("ngClass",o.model.rowClassFunc?o.model.rowClassFunc(t):e.DdM(1,qa))}}var nm=function(){var i=function(){function a(){(0,h.Z)(this,a),this._hasFIlterInput=!0,this.selection=new Ta.Ov(!0,[]),this.select=new e.vpe}return(0,v.Z)(a,[{key:"database",get:function(){return this._database},set:function(t){this._database=t}},{key:"model",get:function(){return this._model},set:function(t){this._model=t}},{key:"hasFilterInput",get:function(){return this._hasFIlterInput},set:function(t){this._hasFIlterInput=t}},{key:"ngOnInit",value:function(){var t=this;this.dataSource=new Bl(this.database,this.model,this.sort),this.model&&(this.displayedColumns=this.model.columns.filter(function(o){return!1!==o.displayed}).map(function(o){return o.name}),this.model.selectionCheckbox&&this.displayedColumns.unshift("selectionCheckbox"),this.model.actions&&this.model.actions.length&&this.displayedColumns.push("action")),this.selection.changed.subscribe(function(o){return t.select.emit(o)})}},{key:"ngAfterViewInit",value:function(){var t=this;this.filter&&(0,In.R)(this.filter.nativeElement,"keyup").pipe((0,De.b)(150),(0,lo.x)()).subscribe(function(){!t.dataSource||(t.dataSource.filter=t.filter.nativeElement.value)})}},{key:"ngOnChanges",value:function(t){t.database&&(this.dataSource=new Bl(this.database,this.model,this.sort),this.selection.clear())}},{key:"getActionColor",value:function(t){return Si[t]}},{key:"getValue",value:function(t,o){return se.resolve(t,o)}},{key:"isAllSelected",value:function(){return this.selection.selected.length===this.database.data.length}},{key:"masterToggle",value:function(){var t=this;this.isAllSelected()?this.selection.clear():this.database.data.forEach(function(o){return t.selection.select(o)})}},{key:"handleClickAction",value:function(t,o,r){t.stopPropagation(),o.click(r)}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-table"]],viewQuery:function(n,t){var o;1&n&&(e.Gf(Rf,5),e.Gf(go.YE,7)),2&n&&(e.iGM(o=e.CRH())&&(t.filter=o.first),e.iGM(o=e.CRH())&&(t.sort=o.first))},inputs:{database:"database",model:"model",hasFilterInput:"hasFilterInput"},outputs:{select:"select"},features:[e.TTD],decls:14,vars:5,consts:[[1,"table-box"],["class","table-header",4,"ngIf"],[1,"table-container"],["mat-table","","matSort","",3,"dataSource"],["table",""],["matColumnDef","selectionCheckbox"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"ngClass","click",4,"matRowDef","matRowDefColumns"],[1,"table-header"],["floatPlaceholder","never"],["matInput","",3,"placeholder"],["filter",""],["mat-header-cell",""],[3,"checked","indeterminate","change"],["mat-cell",""],[3,"checked","click","change"],[3,"matColumnDef"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["cellHTML",""],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"matCellDef"],["mat-cell","",1,"mat-cell-text",3,"ngClass"],["mat-cell","","class","mat-cell-text",3,"ngClass","innerHTML",4,"matCellDef"],["mat-cell","",1,"mat-cell-text",3,"ngClass","innerHTML"],["mat-mini-fab","",3,"color","click",4,"ngFor","ngForOf"],["mat-mini-fab","",3,"color","click"],[3,"svgIcon"],["mat-header-row",""],["mat-row","",3,"ngClass","click"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.YNc(1,Jf,5,3,"div",1),e.TgZ(2,"div",2)(3,"table",3,4),e.ynx(5,5),e.YNc(6,Bf,2,2,"th",6),e.YNc(7,Uf,2,1,"td",7),e.BQk(),e.YNc(8,zf,6,5,"ng-container",8),e.ynx(9,9),e.YNc(10,Wf,1,0,"th",6),e.YNc(11,Xf,2,1,"td",7),e.BQk(),e.YNc(12,em,1,0,"tr",10),e.YNc(13,tm,1,2,"tr",11),e.qZA()()()),2&n&&(e.xp6(1),e.Q6J("ngIf",t.hasFilterInput),e.xp6(2),e.Q6J("dataSource",t.dataSource),e.xp6(5),e.Q6J("ngForOf",t.model.columns),e.xp6(4),e.Q6J("matHeaderRowDef",t.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns))},dependencies:[C.mk,C.sg,C.O5,O.Hw,I.lW,Pe.BZ,Pe.fO,Pe.as,Pe.w1,Pe.Dz,Pe.nj,Pe.ge,Pe.ev,Pe.XQ,Pe.Gk,B.KE,le.Nt,go.YE,go.nU,pt.oG,E.X$],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}.table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto;flex:1 1 auto}.table-box[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.table-header[_ngcontent-%COMP%]{min-height:64px;max-width:500px;display:flex;flex:0 1 auto;align-items:baseline;padding:8px 24px 0;font-size:20px;justify-content:space-between}tr[mat-header-row][_ngcontent-%COMP%], tr[mat-row][_ngcontent-%COMP%]{height:60px}.mat-cell-text[_ngcontent-%COMP%]{overflow:hidden;word-wrap:break-word}td[mat-cell][_ngcontent-%COMP%]{padding-right:15px}th.mat-header-cell[_ngcontent-%COMP%]{padding-right:5px}button[_ngcontent-%COMP%]{margin-right:10px}"]}),i}(),om=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,S.u5,md.HT,O.Ps,I.ot,Pe.p0,B.lN,le.c,go.JX,pt.p9,he]}),i}(),Hn=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n)}(mt),Bo=function(){return(i=Bo||(Bo={})).White="white",i.Grey="grey",i.Primary="primary",Bo;var i}();function im(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"300ms",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ease-in-out";return(0,_e.X$)("toolSlideInOut",[(0,_e.SB)("enter",(0,_e.oB)({transform:"translate3d(0, 0, 0)"})),(0,_e.eR)("void => enter",(0,_e.jt)(i+" "+a))])}function rm(i,a){if(1&i&&(e._UZ(0,"igo-actionbar",2),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async")),2&i){var n=e.oxw();e.Q6J("store",n.actionStore)("withIcon",!0)("withTitle",e.lcZ(1,6,n.toolbarWithTitle$))("withTooltip",!1===e.lcZ(2,8,n.toolbarWithTitle$))("scrollActive",e.lcZ(3,10,n.toolbarWithTitle$))("horizontal",!1)}}var am=function(a,n){return{"igo-tool-container-with-toolbar":a,"igo-tool-container-with-animation":n}};function sm(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",3),e.NdJ("@toolSlideInOut.start",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.onAnimationStart())})("@toolSlideInOut.done",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.onAnimationComplete())}),e.ALo(1,"async"),e._UZ(2,"igo-dynamic-outlet",4),e.qZA()}if(2&i){var t=a.ngIf,o=e.oxw();e.Q6J("ngClass",e.WLB(6,am,!o.actionStore.empty,o.animate))("@toolSlideInOut",e.lcZ(1,4,o.animation$)),e.xp6(2),e.Q6J("component",t.component)("inputs",o.getToolInputs(t))}}var lm=function(){var i=function(){function a(){(0,h.Z)(this,a),this.activeTool$=new x.X(void 0),this.actionStore=new Hn([]),this.animation$=new x.X("none"),this.toolbar$=new x.X([]),this.toolbarWithTitle$=this.activeTool$.pipe((0,U.U)(function(n){return void 0===n})),this.animating$=new x.X(!1),this.animate=!1,this.color=Bo.White}return(0,v.Z)(a,[{key:"classColorGrey",get:function(){return this.color===Bo.Grey}},{key:"classColorPrimary",get:function(){return this.color===Bo.Primary}},{key:"ngOnInit",value:function(){var t=this;this.toolbar$$=this.toolbox.toolbar$.subscribe(function(o){return t.onToolbarChange(o)}),this.activeTool$$=this.toolbox.activeTool$.subscribe(function(o){return t.onActiveToolChange(o)})}},{key:"ngOnDestroy",value:function(){this.toolbar$$.unsubscribe(),this.activeTool$$.unsubscribe(),this.actionStore.destroy()}},{key:"onAnimationStart",value:function(){this.animating$.next(!0)}},{key:"onAnimationComplete",value:function(){this.animating$.next(!1)}},{key:"getToolInputs",value:function(t){return t.options||{}}},{key:"onToolbarChange",value:function(t){this.setToolbar(t)}},{key:"onActiveToolChange",value:function(t){var o=this;this.animate?this.onAnimate(function(){return o.setActiveTool(t)}):this.setActiveTool(t)}},{key:"setActiveTool",value:function(t){if(void 0===t)this.actionStore.state.updateAll({active:!1});else{var o=this.actionStore.get(t.name);void 0!==o&&this.actionStore.state.update(o,{active:!0},!0)}this.activeTool$.next(t),this.animate&&this.animation$.next("enter")}},{key:"setToolbar",value:function(t){var o=this,r=t.reduce(function(s,l){var c=o.toolbox.getTool(l);return void 0===c||s.push({id:c.name,title:c.title,icon:c.icon,tooltip:c.tooltip,args:[c,o.toolbox],handler:function(p,d){d.activateTool(p.name)},ngClass:function(p,d){return o.toolbox.activeTool$.pipe((0,U.U)(function(g){var f=!1;void 0!==g&&p.name===g.name&&(f=!0);var m=!1;return void 0!==g&&p.name===g.parent&&(m=!0),{"tool-activated":f,"children-tool-activated":m}}))}}),s},[]);this.actionStore.load(r),this.toolbar$.next(t)}},{key:"onAnimate",value:function(t){var o=this;this.unAnimate(),this.animating$$=this.animating$.subscribe(function(r){r||(t.call(o),o.unAnimate())})}},{key:"unAnimate",value:function(){this.animating$$&&this.animating$$.unsubscribe()}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-toolbox"]],hostVars:4,hostBindings:function(n,t){2&n&&e.ekj("color-grey",t.classColorGrey)("color-primary",t.classColorPrimary)},inputs:{toolbox:"toolbox",animate:"animate",color:"color"},decls:4,vars:6,consts:[[3,"store","withIcon","withTitle","withTooltip","scrollActive","horizontal",4,"ngIf"],["class","igo-tool-container",3,"ngClass",4,"ngIf"],[3,"store","withIcon","withTitle","withTooltip","scrollActive","horizontal"],[1,"igo-tool-container",3,"ngClass"],[3,"component","inputs"]],template:function(n,t){1&n&&(e.YNc(0,rm,4,12,"igo-actionbar",0),e.ALo(1,"async"),e.YNc(2,sm,3,9,"div",1),e.ALo(3,"async")),2&n&&(e.Q6J("ngIf",e.lcZ(1,2,t.toolbar$).length>0),e.xp6(2),e.Q6J("ngIf",e.lcZ(3,4,t.activeTool$)))},dependencies:[C.mk,C.O5,bi,hr,C.Ov],styles:["[_nghost-%COMP%]{display:block;position:relative;overflow:hidden;width:100%;height:100%}.igo-tool-container[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0}.igo-tool-container-with-animation[_ngcontent-%COMP%]{transform:translate3d(100%,0,0)}.igo-tool-container-with-toolbar[_ngcontent-%COMP%]{left:50px}igo-actionbar[_ngcontent-%COMP%]{height:100%}igo-actionbar.with-title[_ngcontent-%COMP%]{width:100%;overflow:auto}igo-actionbar[_ngcontent-%COMP%]:not(.with-title){width:48px;overflow:hidden;-o-box-shadow:2px 0px 2px 0px #dddddd;box-shadow:2px 0 2px #ddd}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){igo-actionbar[_ngcontent-%COMP%]:not(.with-title){overflow:auto}}igo-dynamic-outlet[_ngcontent-%COMP%]{overflow:auto}"],data:{animation:[im()]},changeDetection:0}),i}(),cm=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,ka,Oa]}),i}(),um=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[Ro]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,cm]}),i}();function pm(i,a){if(1&i&&e._UZ(0,"igo-dynamic-outlet",1),2&i){var n=e.oxw();e.Q6J("component",n.widget)("inputs",n.inputs)("subscribers",n.getEffectiveSubscribers())}}var Ul=function(){var i=function(){function a(){var n=this;(0,h.Z)(this,a),this.baseSubscribers={cancel:function(o){return n.onCancel(o)},complete:function(o){return n.onComplete(o)}},this.subscribers={},this.complete=new e.vpe,this.cancel=new e.vpe}return(0,v.Z)(a,[{key:"ngOnDestroy",value:function(){this.destroyWidget()}},{key:"getEffectiveSubscribers",value:function(){var t=this,o=Object.assign({},this.subscribers);return Object.keys(this.baseSubscribers).forEach(function(r){var s=o[r],l=t.baseSubscribers[r];o[r]=void 0!==s?function(c){s(c),l(c)}:l}),o}},{key:"onCancel",value:function(t){this.cancel.emit(t),this.destroyWidget()}},{key:"onComplete",value:function(t){this.complete.emit(t),this.destroyWidget()}},{key:"destroyWidget",value:function(){void 0!==this.widget&&this.widget.destroy(),this.widget=void 0}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-widget-outlet"]],inputs:{widget:"widget",inputs:"inputs",subscribers:"subscribers"},outputs:{complete:"complete",cancel:"cancel"},decls:1,vars:1,consts:[[3,"component","inputs","subscribers",4,"ngIf"],[3,"component","inputs","subscribers"]],template:function(n,t){1&n&&e.YNc(0,pm,1,3,"igo-dynamic-outlet",0),2&n&&e.Q6J("ngIf",t.widget)},dependencies:[C.O5,hr],styles:["igo-dynamic-outlet[_ngcontent-%COMP%]{height:100%}"],changeDetection:0}),i}(),Ga=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,Oa]}),i}(),Qa=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.dynamicComponentService=n}return(0,v.Z)(a,[{key:"create",value:function(t){return this.dynamicComponentService.create(t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(Ia))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),Nl=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[Qa],imports:[C.ez,Ga,Ga]}),i}(),ql=function(){var i=function(){function a(){(0,h.Z)(this,a),this.selectedChange=new e.vpe}return(0,v.Z)(a,[{key:"getWorkspaceTitle",value:function(t){return en(t)}},{key:"onSelectedChange",value:function(t){var o=t.value;this.store.activateWorkspace(o),this.selectedChange.emit({selected:!0,value:o})}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-workspace-selector"]],inputs:{store:"store",disabled:"disabled"},outputs:{selectedChange:"selectedChange"},decls:1,vars:4,consts:[[3,"store","multi","titleAccessor","disabled","selectedChange"]],template:function(n,t){1&n&&(e.TgZ(0,"igo-entity-selector",0),e.NdJ("selectedChange",function(r){return t.onSelectedChange(r)}),e.qZA()),2&n&&e.Q6J("store",t.store)("multi",!1)("titleAccessor",t.getWorkspaceTitle)("disabled",t.disabled)},dependencies:[kl],styles:["igo-entity-selector[_ngcontent-%COMP%]     mat-form-field .mat-form-field-infix{padding:0}igo-entity-selector[_ngcontent-%COMP%]     mat-form-field .mat-form-field-wrapper{padding-bottom:1.75em}"],changeDetection:0}),i}(),dm=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,Ja]}),i}();function gm(i,a){if(1&i){var n=e.EpF();e.ynx(0),e.TgZ(1,"igo-widget-outlet",1),e.NdJ("cancel",function(){var l=e.CHM(n).ngIf,c=e.oxw();return e.KtG(c.onWidgetCancel(l))})("complete",function(){var l=e.CHM(n).ngIf,c=e.oxw();return e.KtG(c.onWidgetComplete(l))}),e.ALo(2,"async"),e.ALo(3,"async"),e.qZA(),e.BQk()}if(2&i){var t=a.ngIf,o=e.oxw();e.xp6(1),e.Q6J("widget",t)("inputs",e.lcZ(2,3,o.widgetInputs$))("subscribers",e.lcZ(3,5,o.widgetSubscribers$))}}var fm=function(){var i=function(){function a(){(0,h.Z)(this,a),this.deactivateWidget=new e.vpe}return(0,v.Z)(a,[{key:"widget$",get:function(){return this.workspace.widget$}},{key:"widgetInputs$",get:function(){return this.workspace.widgetInputs$}},{key:"widgetSubscribers$",get:function(){return this.workspace.widgetSubscribers$}},{key:"onWidgetCancel",value:function(t){this.workspace.deactivateWidget(),this.deactivateWidget.emit(t)}},{key:"onWidgetComplete",value:function(t){this.workspace.deactivateWidget(),this.deactivateWidget.emit(t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-workspace-widget-outlet"]],inputs:{workspace:"workspace"},outputs:{deactivateWidget:"deactivateWidget"},decls:2,vars:3,consts:[[4,"ngIf"],[3,"widget","inputs","subscribers","cancel","complete"]],template:function(n,t){1&n&&(e.YNc(0,gm,4,7,"ng-container",0),e.ALo(1,"async")),2&n&&e.Q6J("ngIf",e.lcZ(1,1,t.widget$))},dependencies:[C.O5,Ul,C.Ov],styles:["igo-widget-outlet[_ngcontent-%COMP%]{height:100%}"],changeDetection:0}),i}(),mm=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,Ga]}),i}(),hm=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,dm,mm]}),i}(),vm=function(){function i(a){(0,h.Z)(this,i),this.dataChange=new x.X([]),a&&this.dataChange.next(a)}return(0,v.Z)(i,[{key:"data",get:function(){return this.dataChange.value}},{key:"set",value:function(n){this.dataChange.next(n)}},{key:"add",value:function(n){var t=this.data.slice();t.push(n),this.set(t)}},{key:"remove",value:function(n){var t=this.data.slice(),o=t.indexOf(n);t.splice(o,1),this.set(t)}}]),i}();function je(i){return function(a){Ro.register(Object.assign({},i,{component:a}))}}var Gl=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){var t;return(0,h.Z)(this,n),(t=a.apply(this,arguments)).activeWorkspace$=new x.X(void 0),t}return(0,v.Z)(n,[{key:"activateWorkspace",value:function(o){var r=this.activeWorkspace$.value;void 0!==r&&r.deactivate(),this.deactivateWorkspace(),void 0!==o&&(this.state.update(o,{active:!0,selected:!0},!0),this.activeWorkspace$.next(o),o.activate())}},{key:"deactivateWorkspace",value:function(){var o=this.activeWorkspace$.value;void 0!==o&&(o.deactivate(),this.activeWorkspace$.next(void 0))}}]),n}(mt),Ya=function(){function i(a){(0,h.Z)(this,i),this.options=a,this.widget$=new x.X(void 0),this.widgetInputs$=new x.X({}),this.widgetSubscribers$=new x.X({}),this.change=new $e.x,this.active$=new x.X(!1)}return(0,v.Z)(i,[{key:"id",get:function(){return this.options.id}},{key:"title",get:function(){return this.options.title}},{key:"meta",get:function(){return this.options.meta||{}}},{key:"entityStore",get:function(){return this.options.entityStore}},{key:"actionStore",get:function(){return this.options.actionStore}},{key:"widget",get:function(){return this.widget$.value}},{key:"hasWidget",get:function(){return void 0!==this.widget}},{key:"active",get:function(){return this.active$.value}},{key:"activate",value:function(){var n=this;!0===this.active&&this.deactivate(),this.active$.next(!0),void 0!==this.entityStore&&(this.entities$$=this.entityStore.stateView.all$().subscribe(function(){return n.onStateChange()})),this.change.next()}},{key:"deactivate",value:function(){this.active$.next(!1),this.deactivateWidget(),void 0!==this.entities$$&&this.entities$$.unsubscribe(),void 0!==this.change$&&this.change$.unsubscribe()}},{key:"activateWidget",value:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.widget$.next(n),this.widgetInputs$.next(t),this.widgetSubscribers$.next(o),this.change.next()}},{key:"deactivateWidget",value:function(){this.widget$.next(void 0),this.change.next()}},{key:"onStateChange",value:function(){this.change.next()}}]),i}();const _m=me.Bz.forChild([{path:"home",component:(()=>{class i{constructor(n){this.interactiveTourService=n}startTour(){this.interactiveTourService.startTour("global")}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(Na))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-home"]],decls:56,vars:0,consts:[[2,"text-align","center"],["id","igo-title"],["width","180","src","assets/igo2/core/logo.png",1,"igo-logo"],["tourToStart","global","menuIsOpen","true","styleButton","raised"],["target","_blank","rel","noopener","href","https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation"],["target","_blank","rel","noopener","href","https://angular.io/docs"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"h1",1),e._uU(2," Welcome to IGO "),e.qZA(),e._UZ(3,"img",2),e.qZA(),e.TgZ(4,"p"),e._UZ(5,"igo-interactive-tour",3),e.qZA(),e.TgZ(6,"p"),e._uU(7," IGO2 library contains many components and services that may benefit any web application. "),e._UZ(8,"br"),e._uU(9," IGO2 library is open source project using Angular, Angular Material and OpenLayers.\n"),e.qZA(),e.TgZ(10,"h3"),e._uU(11,"IGO2 library is divided into several elements: "),e.qZA(),e.TgZ(12,"ul")(13,"li")(14,"b"),e._uU(15,"@igo2/utils"),e.qZA(),e._uU(16," : Basic utilies without dependency (ex: base64, clipboard, uuid)"),e.qZA(),e.TgZ(17,"li")(18,"b"),e._uU(19,"@igo2/core"),e.qZA(),e._uU(20," : Element affecting the core of the application (ex: config, language, message, media, request)"),e.qZA(),e.TgZ(21,"li")(22,"b"),e._uU(23,"@igo2/common"),e.qZA(),e._uU(24," : Library containing reusable components (ex: clickout, drag-drop, list, panel, spinner, table)"),e.qZA(),e.TgZ(25,"li")(26,"b"),e._uU(27,"@igo2/auth"),e.qZA(),e._uU(28," : Library grouping the authentication and security module"),e.qZA(),e.TgZ(29,"li")(30,"b"),e._uU(31,"@igo2/geo"),e.qZA(),e._uU(32," : Library containing the geomatic components. Depends on Openlayers."),e.qZA(),e.TgZ(33,"li")(34,"b"),e._uU(35,"@igo2/context"),e.qZA(),e._uU(36," : Library of components uniting @igo2/geo and @igo2/auth"),e.qZA(),e.TgZ(37,"li")(38,"b"),e._uU(39,"@igo2/integration"),e.qZA(),e._uU(40," : Library integrate basic components"),e.qZA()(),e.TgZ(41,"h2"),e._uU(42,"Here are some links to help you start: "),e.qZA(),e.TgZ(43,"ul")(44,"li")(45,"h2")(46,"a",4),e._uU(47,"Installation"),e.qZA()()(),e.TgZ(48,"li")(49,"h2")(50,"a",5),e._uU(51,"Angular Documentation"),e.qZA()()()(),e._uU(52," *** Modules in "),e.TgZ(53,"code"),e._uU(54,"@igo2/core"),e.qZA(),e._uU(55," must be imported only once\n"))},dependencies:[Rl]}),i})()}]);let bm=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[_m,Jl,J.AV,O.Ps,I.ot]}),i})();const Sm=me.Bz.forChild([{path:"activity",component:(()=>{class i{constructor(n){this.activityService=n,this.idsActivity=[]}register(){this.idsActivity.push(this.activityService.register())}unregister(){this.activityService.unregister(this.idsActivity.pop())}get counter(){return this.activityService.counter$.value}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(mi))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-activity"]],decls:31,vars:1,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/activity"],["mat-raised-button","",3,"click"],["igoSpinnerActivity",""]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Core"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Activity"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"p"),e._uU(7,"Register activities in service. Use to display a loading icon"),e.qZA(),e.TgZ(8,"li"),e._uU(9,"Import "),e.TgZ(10,"code"),e._uU(11,"IgoActivityModule"),e.qZA(),e._uU(12," only if you want register http calls"),e.qZA(),e.TgZ(13,"li"),e._uU(14,"Import "),e.TgZ(15,"code"),e._uU(16,"IgoActivityModule"),e.qZA(),e._uU(17," only once"),e.qZA(),e._UZ(18,"br"),e._uU(19," See the "),e.TgZ(20,"a",0),e._uU(21," code of this example"),e.qZA(),e._UZ(22,"hr"),e.qZA(),e.TgZ(23,"mat-card-actions")(24,"button",1),e.NdJ("click",function(){return t.register()}),e._uU(25,"Register"),e.qZA(),e.TgZ(26,"button",1),e.NdJ("click",function(){return t.unregister()}),e._uU(27,"Unregister"),e.qZA()(),e.TgZ(28,"p"),e._uU(29),e.qZA(),e._UZ(30,"igo-spinner",2),e.qZA()),2&n&&(e.xp6(29),e.hij("Counter: ",t.counter,""))},dependencies:[F.a8,F.dn,F.n5,F.$j,F.hq,I.lW,$f,Sr]}),i})()}]);let wm=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Sm,F.QW,I.ot,ma.forRoot(),wr]}),i})();const ja={production:!0,igo:{projections:[{code:"EPSG:32198",alias:"Quebec Lambert",def:"+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs",extent:[-886251.0296,180252.9126,897177.3418,2106143.8139]}],auth:{intern:{enabled:!0},allowAnonymous:!0},interactiveTour:{tourInMobile:!0},importExport:{url:"https://geoegl.msp.gouv.qc.ca/apis/ogre"},language:{prefix:"./locale/"},catalog:{sources:[{id:"Gououvert",title:"Gouvouvert",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi"},{id:"DefiningInfoFormat",title:"Defining info_format",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryFormat:{html:"*","application/json":["stations_meteoroutieres","histo_stations_meteoroutieres"]},queryHtmlTarget:"iframe",count:30},{id:"catalogwithregex",title:"Filtered catalog by regex",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",regFilters:["zpegt"]},{id:"catalogwithtooltipcontrol",title:"Controling tooltip format",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",tooltipType:"abstract"}]},searchSources:{storedqueriesreverse:{enabled:!1},nominatim:{enabled:!1},icherche:{searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",order:2,enabled:!0,params:{limit:"8"}},coordinatesreverse:{showInPointerSummary:!0},icherchereverse:{showInPointerSummary:!0,searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",order:3,enabled:!0},ilayer:{searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",order:4,enabled:!0,params:{limit:"5"}}}}},xm=me.Bz.forChild([{path:"config",component:(()=>{class i{constructor(n){this.configService=n,this.configLanguage=this.configService.getConfig("language")}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(j))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-config"]],decls:26,vars:3,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/config"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Core"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"config"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"p"),e._uU(7,"Load config in your angular application"),e.qZA(),e.TgZ(8,"li"),e._uU(9,"Import "),e.TgZ(10,"code"),e._uU(11,"IgoConfigModule"),e.qZA(),e._uU(12," only once"),e.qZA(),e._UZ(13,"br"),e._uU(14," See the "),e.TgZ(15,"a",0),e._uU(16," code of this example"),e.qZA(),e._UZ(17,"br"),e._uU(18," See the "),e.TgZ(19,"a",1),e._uU(20," environment config"),e.qZA(),e._UZ(21,"hr"),e.qZA(),e.TgZ(22,"p"),e._uU(23),e.ALo(24,"json"),e.qZA(),e._UZ(25,"p"),e.qZA()),2&n&&(e.xp6(23),e.hij("Config language: ",e.lcZ(24,1,t.configLanguage),""))},dependencies:[F.a8,F.dn,F.n5,F.$j,C.Ts]}),i})()}]);let km=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[ha({default:ja.igo})],imports:[xm,C.ez,F.QW,I.ot,sr.forRoot()]}),i})();const Fm=me.Bz.forChild([{path:"language",component:(()=>{class i{constructor(n){this.languageService=n,this.app={title:"IGO"}}changeLanguage(n){this.languageService.setLanguage(n),console.log(this.languageService)}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-language"]],decls:35,vars:4,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/language"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/locale"],["mat-raised-button","",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Core"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"language"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"p"),e._uU(7,"Translate your angular application"),e.qZA(),e.TgZ(8,"li"),e._uU(9,"Import "),e.TgZ(10,"code"),e._uU(11,"IgoLanguageModule"),e.qZA(),e._uU(12," only once"),e.qZA(),e._UZ(13,"br"),e._uU(14," See the "),e.TgZ(15,"a",0),e._uU(16,"code of this example"),e.qZA(),e._UZ(17,"br"),e._uU(18," See language section of the "),e.TgZ(19,"a",1),e._uU(20," environment config"),e.qZA(),e._UZ(21,"br"),e._uU(22," See "),e.TgZ(23,"a",2),e._uU(24,"locale files"),e.qZA(),e._UZ(25,"hr"),e.qZA(),e.TgZ(26,"mat-card-actions")(27,"button",3),e.NdJ("click",function(){return t.changeLanguage("en")}),e._uU(28,"English"),e.qZA(),e.TgZ(29,"button",3),e.NdJ("click",function(){return t.changeLanguage("fr")}),e._uU(30,"Fran\xe7ais"),e.qZA()(),e.TgZ(31,"p"),e._uU(32),e.ALo(33,"translate"),e.qZA(),e._UZ(34,"p"),e.qZA()),2&n&&(e.xp6(32),e.Oqu(e.xi3(33,1,"welcome",t.app)))},dependencies:[F.a8,F.dn,F.n5,F.$j,F.hq,I.lW,E.X$]}),i})()}]);let Zm=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Fm,F.QW,I.ot,he.forRoot()]}),i})();const Im=me.Bz.forChild([{path:"media",component:(()=>{class i{constructor(n){this.mediaService=n}get media(){return this.mediaService.getMedia()}get orientation(){return this.mediaService.getOrientation()}get isTouchScreen(){return this.mediaService.isTouchScreen()}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(xt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-media"]],decls:19,vars:3,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/media"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Core"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Media"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"p"),e._uU(7,"Detect type of media (mobile, tablet, desktop)"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"p"),e._uU(14),e.qZA(),e.TgZ(15,"p"),e._uU(16),e.qZA(),e.TgZ(17,"p"),e._uU(18),e.qZA()()),2&n&&(e.xp6(14),e.hij("Current media: ",t.media,""),e.xp6(2),e.hij("Current orientation: ",t.orientation,""),e.xp6(2),e.hij("Device mode: ",t.isTouchScreen?"Touch device":"Not a touch device ",""))},dependencies:[F.a8,F.dn,F.n5,F.$j]}),i})()}]);let Lm=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Im,F.QW]}),i})();const Dm=me.Bz.forChild([{path:"message",component:(()=>{class i{constructor(n){this.messageService=n}success(){this.messageService.success("Congratulations","Success")}info(){this.messageService.info("Welcome to IGO","Info")}alert(){this.messageService.alert("Warning","Alert")}error(){this.messageService.error("There is a bug","Error")}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(Ae))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-message"]],decls:29,vars:0,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/message"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Core"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Message"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"p"),e._uU(7,"Show message to user."),e.qZA(),e.TgZ(8,"li"),e._uU(9,"Import "),e.TgZ(10,"code"),e._uU(11,"IgoMessageModule"),e.qZA(),e._uU(12," only once"),e.qZA(),e.TgZ(13,"li"),e._uU(14,"Dependencies: BrowserAnimationsModule "),e.qZA(),e._UZ(15,"br"),e._uU(16," See the "),e.TgZ(17,"a",0),e._uU(18,"code of this example"),e.qZA(),e._UZ(19,"hr"),e.qZA(),e.TgZ(20,"mat-card-actions")(21,"button",1),e.NdJ("click",function(){return t.success()}),e._uU(22,"Success message"),e.qZA(),e.TgZ(23,"button",2),e.NdJ("click",function(){return t.info()}),e._uU(24,"Info message"),e.qZA(),e.TgZ(25,"button",3),e.NdJ("click",function(){return t.alert()}),e._uU(26,"Alert message"),e.qZA(),e.TgZ(27,"button",4),e.NdJ("click",function(){return t.error()}),e._uU(28,"Error message"),e.qZA()()())},dependencies:[F.a8,F.dn,F.n5,F.$j,F.hq,I.lW]}),i})()}]);let Pm=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Dm,F.QW,I.ot,Ln.forRoot()]}),i})();const $m=me.Bz.forChild([{path:"request",component:(()=>{class i{constructor(n,t){this.http=n,this.languageService=t}callHttp(){this.http.get("https://geoegl.msp.gouv.qc.ca/apis/icherche/info").subscribe(t=>{console.log(t)})}callHttpError(){this.http.get("404").subscribe(t=>{console.log(t)})}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(W.eN),e.Y36($))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-request"]],decls:30,vars:0,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/request"],["mat-raised-button","",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Core"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Request"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"p"),e._uU(7,"Register http calls in console"),e.qZA(),e.TgZ(8,"li"),e._uU(9,"Import "),e.TgZ(10,"code"),e._uU(11,"IgoLoggingModule"),e.qZA(),e._uU(12," only if you want register http calls in console"),e.qZA(),e.TgZ(13,"li"),e._uU(14,"Import "),e.TgZ(15,"code"),e._uU(16,"IgoErrorModule"),e.qZA(),e._uU(17," only if you want register errors from http call in console"),e.qZA(),e.TgZ(18,"li"),e._uU(19,"Import modules only once"),e.qZA(),e._UZ(20,"br"),e._uU(21," See the "),e.TgZ(22,"a",0),e._uU(23,"code of this example"),e.qZA(),e._UZ(24,"hr"),e.qZA(),e.TgZ(25,"mat-card-actions")(26,"button",1),e.NdJ("click",function(){return t.callHttp()}),e._uU(27,"Log"),e.qZA(),e.TgZ(28,"button",1),e.NdJ("click",function(){return t.callHttpError()}),e._uU(29,"Error"),e.qZA()()())},dependencies:[F.a8,F.dn,F.n5,F.$j,F.hq,I.lW]}),i})()}]);let Rm=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[$m,F.QW,I.ot,W.JF,he.forRoot(),va.forRoot()]}),i})();function Jm(i,a){if(1&i&&e._UZ(0,"igo-actionbar",4),2&i){const n=e.oxw();e.Q6J("store",n.store)("withIcon",!0)("horizontal",!0)("mode","context")}}const Um=me.Bz.forChild([{path:"action",component:(()=>{class i{constructor(n,t,o){this.overlay=n,this.mediaService=t,this.languageService=o,this.store=new Hn([]),this.added$=new x.X(!1)}get actionbarMode(){return this.mediaService.media$.value===Xt.Desktop&&this.mediaService.orientation$.value===Cn.Landscape?Dn.Dock:Dn.Overlay}ngOnInit(){this.store.load([{id:"add",title:"Add",icon:"plus",tooltip:"Add Tooltip",handler:()=>{alert("Add!"),this.added$.next(!0)}},{id:"edit",title:"Edit",icon:"pencil",tooltip:"Edit Tooltip",args:["1"],handler:n=>{alert(`Edit item ${n}!`)},availability:()=>this.added$},{id:"delete",title:"Delete",tooltip:"Delete Tooltip",icon:"delete",handler:()=>{alert("Delete!"),this.added$.next(!1)},availability:()=>this.added$}])}ngOnDestroy(){this.store.destroy()}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(wa.aV),e.Y36(xt),e.Y36($))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-action"]],decls:19,vars:6,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/action"],[3,"store","withIcon","withTitle","horizontal","mode"],[3,"igoContextMenu"],["actionbarMenu",""],[3,"store","withIcon","horizontal","mode"]],template:function(n,t){if(1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Common"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Action"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e._UZ(9,"igo-actionbar",1),e.qZA(),e._UZ(10,"p"),e.TgZ(11,"mat-card",2)(12,"mat-card-subtitle"),e._uU(13,"Common"),e.qZA(),e.TgZ(14,"mat-card-title"),e._uU(15,"Action context-menu"),e.qZA(),e._UZ(16,"div"),e.qZA(),e.YNc(17,Jm,1,4,"ng-template",null,3,e.W1O)),2&n){const o=e.MAs(18);e.xp6(9),e.Q6J("store",t.store)("withIcon",!0)("withTitle","overlay"===t.actionbarMode)("horizontal",!0)("mode",t.actionbarMode),e.xp6(2),e.Q6J("igoContextMenu",o)}},dependencies:[F.a8,F.dn,F.n5,F.$j,bi,Zl],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let Nm=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Um,I.ot,F.QW,ka,Al]}),i})(),Ha=(()=>{class i{constructor(n){this.cdRef=n}onUpdateInputs(){this.cdRef.detectChanges()}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-salutation-component"]],inputs:{name:"name"},decls:2,vars:1,template:function(n,t){1&n&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&n&&(e.xp6(1),e.hij("Hello, my name is ",t.name,"."))},encapsulation:2,changeDetection:0}),i})(),qm=(()=>{class i{constructor(n){this.cdRef=n}onUpdateInputs(){this.cdRef.detectChanges()}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-explanation-component"]],decls:2,vars:0,template:function(n,t){1&n&&(e.TgZ(0,"p"),e._uU(1,"I am a dynamic component, rendered into an IgoDynamicOutlet."),e.qZA())},encapsulation:2,changeDetection:0}),i})();const Qm=me.Bz.forChild([{path:"dynamic-component",component:(()=>{class i{constructor(){this.component=Ha,this.inputs={name:"Bob"}}toggleComponent(){this.component=this.component===Ha?qm:Ha}}return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-dynamic-component"]],decls:12,vars:2,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/dynamic-component"],[3,"component","inputs"],["mat-flat-button","","color","primary",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Common"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Dynamic Component"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e._UZ(9,"igo-dynamic-outlet",1),e.TgZ(10,"button",2),e.NdJ("click",function(){return t.toggleComponent()}),e._uU(11,"Toggle Component"),e.qZA()()),2&n&&(e.xp6(9),e.Q6J("component",t.component)("inputs",t.inputs))},dependencies:[I.lW,F.a8,F.dn,F.n5,F.$j,hr],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let Ym=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Qm,I.ot,F.QW,Oa]}),i})();const Hm=me.Bz.forChild([{path:"entity-table",component:(()=>{class i{constructor(n){this.languageService=n,this.store=new mt([]),this.entitySortChange$=new x.X(!1),this.paginatorOptions={pageSize:10},this.template={selection:!0,selectionCheckbox:!0,selectMany:!0,sort:!0,valueAccessor:(t,o)=>fo(t,o),columns:[{name:"selected",title:"Selected",valueAccessor:t=>this.store.state.get(t).selected?"radiobox-marked":"radiobox-blank",renderer:at.Icon},{name:"id",title:"ID"},{name:"name",title:"Name"},{name:"description",title:"Description",renderer:at.HTML},{name:"url",title:"Hyperlink"},{name:"image",title:"Image"},{name:"action",title:"",valueAccessor:t=>[{icon:"home",color:"warn",click:o=>{console.log(o)}}],renderer:at.ButtonGroup}]}}ngOnInit(){const t=[2,1,3,4,5,6,7,8,9,10,11,12,13].map(o=>3===o?{id:o,name:`Name ${o}`,description:`<b>Description ${o}</b>`,url:"https://igouverte.org",image:"https://www.igouverte.org/assets/img/NONEXISTINGIMAGE.png"}:{id:o,name:`Name ${o}`,description:`<b>Description ${o}</b>`,url:"https://igouverte.org",image:"https://www.igouverte.org/assets/img/Igo_logoavec.png"});this.store.load(t)}entitySortChange(){this.entitySortChange$.next(!0)}paginatorChange(n){this.paginator=n}ngOnDestroy(){this.store.destroy()}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-entity-table"]],decls:10,vars:4,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/entity-table"],[3,"store","withPaginator","paginatorOptions","template","entitySortChange"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Common"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Entity Table"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.TgZ(9,"igo-entity-table",1),e.NdJ("entitySortChange",function(){return t.entitySortChange()}),e.qZA()()),2&n&&(e.xp6(9),e.Q6J("store",t.store)("withPaginator",!0)("paginatorOptions",t.paginatorOptions)("template",t.template))},dependencies:[F.a8,F.dn,F.n5,F.$j,ho],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let Vm=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Hm,F.QW,$o,Ba]}),i})();function zm(i,a){if(1&i&&(e.TgZ(0,"div")(1,"p"),e._uU(2),e.qZA(),e.TgZ(3,"p"),e._uU(4),e.qZA(),e.TgZ(5,"p"),e._uU(6,"Description: "),e._UZ(7,"span",3),e.qZA()()),2&i){const n=a.ngIf;e.xp6(2),e.hij("ID: ",n.id,""),e.xp6(2),e.hij("Name: ",n.name,""),e.xp6(3),e.Q6J("innerHtml",n.description,e.oJD)}}const Km=me.Bz.forChild([{path:"entity-selector",component:(()=>{class i{constructor(n){this.languageService=n,this.store=new mt([]),this.selected$=new x.X(void 0)}ngOnInit(){this.store.load([{id:"2",name:"Name 2",description:"<b>Description 2</b>"},{id:"1",name:"Name 1",description:"<b>Description 1</b>"},{id:"3",name:"Name 3",description:"<b>Description 3</b>"}])}ngOnDestroy(){this.store.destroy()}getTitle(n){return n.name}onSelectedChange(n){this.selected$.next(n.entity)}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-entity-selector"]],decls:12,vars:7,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/entity-selector"],[3,"store","titleAccessor","emptyText","placeholder","selectedChange"],[4,"ngIf"],[3,"innerHtml"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Common"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Entity Selector"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.TgZ(9,"igo-entity-selector",1),e.NdJ("selectedChange",function(r){return t.onSelectedChange(r)}),e.qZA(),e.YNc(10,zm,8,3,"div",2),e.ALo(11,"async"),e.qZA()),2&n&&(e.xp6(9),e.Q6J("store",t.store)("titleAccessor",t.getTitle)("emptyText","")("placeholder","Select an entity"),e.xp6(1),e.Q6J("ngIf",e.lcZ(11,5,t.selected$)))},dependencies:[C.O5,F.a8,F.dn,F.n5,F.$j,kl,C.Ov],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let Xm=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,Km,F.QW,Ja]}),i})();function eh(i,a){if(1&i){const n=e.EpF();e.TgZ(0,"igo-form",2),e.NdJ("submitForm",function(o){e.CHM(n);const r=e.oxw();return e.KtG(r.onSubmit(o))}),e.ALo(1,"async"),e._UZ(2,"igo-form-group",3),e.TgZ(3,"div",4)(4,"button",5),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.fillForm())}),e._uU(5," Fill Form "),e.qZA(),e.TgZ(6,"button",5),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.clearForm())}),e._uU(7," Clear Form "),e.qZA(),e.TgZ(8,"button",6),e._uU(9," Submit "),e.qZA()()()}if(2&i){const n=a.ngIf,t=e.oxw();e.Q6J("form",n)("formData",e.lcZ(1,4,t.data$)),e.xp6(2),e.Q6J("group",n.groups[0]),e.xp6(6),e.Q6J("disabled",t.submitDisabled)}}const nh=me.Bz.forChild([{path:"form",component:(()=>{class i{constructor(n,t){this.formService=n,this.languageService=t,this.form$=new x.X(void 0),this.data$=new x.X(void 0),this.submitDisabled=!0}ngOnInit(){const t=[{name:"id",title:"ID",options:{cols:1,validator:S.kI.required}},{name:"name",title:"Name",options:{cols:1,validator:S.kI.required}},{name:"status",title:"Status",type:"select",options:{cols:2},inputs:{choices:[{value:1,title:"Single"},{value:2,title:"Married"}]}}].map(r=>this.formService.field(r)),o=this.formService.form([],[this.formService.group({name:"info"},t)]);this.valueChanges$$=o.control.valueChanges.subscribe(()=>{this.submitDisabled=!o.control.valid}),this.form$.next(o)}ngOnDestroy(){this.valueChanges$$.unsubscribe()}fillForm(){this.data$.next({id:1,name:"Bob",status:2})}clearForm(){this.form$.value.control.reset()}onSubmit(n){alert(JSON.stringify(n))}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(Ea),e.Y36($))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-form"]],decls:11,vars:3,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/form"],[3,"form","formData","submitForm",4,"ngIf"],[3,"form","formData","submitForm"],[3,"group"],["formButtons",""],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Common"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Form"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.YNc(9,eh,10,6,"igo-form",1),e.ALo(10,"async"),e.qZA()),2&n&&(e.xp6(9),e.Q6J("ngIf",e.lcZ(10,1,t.form$)))},dependencies:[C.O5,I.lW,F.a8,F.dn,F.n5,F.$j,Pa,Ol,C.Ov],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let oh=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,nh,I.ot,F.QW,Ci]}),i})();const rh=me.Bz.forChild([{path:"table",component:(()=>{class i{constructor(n){this.languageService=n,this.model={columns:[{name:"id",title:"ID",sortable:!1,filterable:!0},{name:"name",title:"Name",sortable:!0,filterable:!0},{name:"description",title:"Description",sortable:!0,filterable:!0}],actions:[{icon:"file-document",color:Si.primary,click:t=>this.showName(t.name)}],selectionCheckbox:!0}}ngOnInit(){this.database=new vm([{id:"2",name:"Name 2",description:"Hello 2"},{id:"1",name:"Name 1",description:"Bonjour 1"},{id:"3",name:"Name 3",description:"Hola 3"}])}showName(n){alert(n)}handleSelect(n){console.log(n)}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-table"]],decls:10,vars:3,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/table"],[3,"database","model","hasFilterInput","select"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Common"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Table"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.TgZ(9,"igo-table",1),e.NdJ("select",function(r){return t.handleSelect(r)}),e.qZA()()),2&n&&(e.xp6(9),e.Q6J("database",t.database)("model",t.model)("hasFilterInput",!0))},dependencies:[F.a8,F.dn,F.n5,F.$j,nm],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let ah=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[rh,F.QW,om]}),i})();function sh(i,a){if(1&i){const n=e.EpF();e.TgZ(0,"button",6),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.toolbox.activatePreviousTool())}),e._UZ(1,"mat-icon",7),e.qZA()}}function lh(i,a){if(1&i){const n=e.EpF();e.TgZ(0,"button",8),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.toolbox.deactivateTool())}),e._UZ(1,"mat-icon",9),e.qZA()}}let Uo=class{constructor(a){this.cdRef=a}onUpdateInputs(){this.cdRef.detectChanges()}};Uo.\u0275fac=function(a){return new(a||Uo)(e.Y36(e.sBO))},Uo.\u0275cmp=e.Xpm({type:Uo,selectors:[["app-salutation-tool"]],inputs:{name:"name"},decls:2,vars:1,template:function(a,n){1&a&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&a&&(e.xp6(1),e.hij("Hello, my name is ",n.name,"."))},encapsulation:2,changeDetection:0}),Uo=(0,ne.gn)([je({name:"demo-salutation",title:"Salutation",icon:"account",options:{name:"Jack"}}),(0,ne.w6)("design:paramtypes",[e.sBO])],Uo);let No=class{};No.\u0275fac=function(a){return new(a||No)},No.\u0275cmp=e.Xpm({type:No,selectors:[["app-about-tool"]],decls:2,vars:0,template:function(a,n){1&a&&(e.TgZ(0,"p"),e._uU(1,"I'm a tool inside a toolbox."),e.qZA())},encapsulation:2,changeDetection:0}),No=(0,ne.gn)([je({name:"demo-about",title:"About",icon:"information"})],No);const uh=me.Bz.forChild([{path:"tool",component:(()=>{class i{constructor(n,t){this.toolService=n,this.languageService=t,this.toolbox=new $l}get activeTool$(){return this.toolbox.activeTool$}get panelTitle(){return this.activeTool$.value?this.activeTool$.value.title:"Toolbox"}ngOnInit(){this.toolbox.setToolbar(["demo-salutation","demo-about"]),this.toolbox.setTools(this.toolService.getTools())}ngOnDestroy(){this.toolbox.destroy()}activateSalutationTool(){this.toolbox.activateTool("demo-salutation",{name:"Bob"})}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(Ro),e.Y36($))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-tool"]],decls:17,vars:9,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/tool"],[3,"title"],["mat-icon-button","","panelLeftButton","",3,"click",4,"ngIf"],["mat-icon-button","","panelRightButton","",3,"click",4,"ngIf"],[3,"toolbox","animate"],["mat-flat-button","","type","button","color","primary",3,"click"],["mat-icon-button","","panelLeftButton","",3,"click"],["svgIcon","arrow-back"],["mat-icon-button","","panelRightButton","",3,"click"],["svgIcon","menu"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Common"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Tool"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.TgZ(9,"igo-panel",1),e.YNc(10,sh,2,0,"button",2),e.ALo(11,"async"),e.YNc(12,lh,2,0,"button",3),e.ALo(13,"async"),e._UZ(14,"igo-toolbox",4),e.qZA(),e.TgZ(15,"button",5),e.NdJ("click",function(){return t.activateSalutationTool()}),e._uU(16," Activate Salutation Tool "),e.qZA()()),2&n&&(e.xp6(9),e.Q6J("title",t.panelTitle),e.xp6(1),e.Q6J("ngIf",e.lcZ(11,5,t.activeTool$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(13,7,t.activeTool$)),e.xp6(2),e.Q6J("toolbox",t.toolbox)("animate",!0))},dependencies:[C.O5,I.lW,O.Hw,F.a8,F.dn,F.n5,F.$j,Ut,lm,C.Ov],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let ph=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,uh,I.ot,O.Ps,F.QW,he,Pt,um.forRoot()]}),i})(),dh=(()=>{class i{constructor(n){this.cdRef=n,this.complete=new e.vpe,this.cancel=new e.vpe}onUpdateInputs(){this.cdRef.detectChanges()}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-salutation-widget"]],inputs:{name:"name"},outputs:{complete:"complete",cancel:"cancel"},decls:6,vars:1,consts:[["mat-flat-button","",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"p"),e._uU(1),e.qZA(),e.TgZ(2,"button",0),e.NdJ("click",function(){return t.complete.emit(t.name)}),e._uU(3,"Nice to meet you"),e.qZA(),e.TgZ(4,"button",0),e.NdJ("click",function(){return t.cancel.emit(t.name)}),e._uU(5,"Dismiss"),e.qZA()),2&n&&(e.xp6(1),e.hij("Hello, my name is ",t.name,"."))},dependencies:[I.lW],encapsulation:2,changeDetection:0}),i})();const fh=me.Bz.forChild([{path:"widget",component:(()=>{class i{constructor(n){this.widgetService=n,this.widget=this.widgetService.create(dh),this.inputs={name:"Bob"}}onWidgetComplete(n){alert(`${n} emitted event 'complete' then got automatically destroyed.`)}onWidgetCancel(){alert("Widget emitted event 'cancel' then got automatically destroyed.")}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(Qa))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-widget"]],decls:10,vars:2,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/widget"],[3,"widget","inputs","complete","cancel"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Common"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Widget"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.TgZ(9,"igo-widget-outlet",1),e.NdJ("complete",function(r){return t.onWidgetComplete(r)})("cancel",function(){return t.onWidgetCancel()}),e.qZA()()),2&n&&(e.xp6(9),e.Q6J("widget",t.widget)("inputs",t.inputs))},dependencies:[F.a8,F.dn,F.n5,F.$j,Ul],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let mh=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[fh,I.ot,F.QW,Nl]}),i})();var kt=k(35488),qo=k(19337),En=k(68951),pn=k(59346),hh=k(54959),tn=k(26466),Tr=k(37141),Go=k(43105),Ql=k(7771),vh=k(70349),wn=k(19958),Va=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.injector=n}return(0,v.Z)(a,[{key:"set",value:function(t){localStorage.setItem(this.tokenKey,t)}},{key:"remove",value:function(){localStorage.removeItem(this.tokenKey)}},{key:"get",value:function(){return localStorage.getItem(this.tokenKey)}},{key:"decode",value:function(){var t=this.get();if(t)return hh(t)}},{key:"isExpired",value:function(){var t=this.decode(),o=(new Date).getTime()/1e3;return!(t&&o<t.exp)}},{key:"tokenKey",get:function(){var t=this.injector.get(j);return this.options=t.getConfig("auth")||{},this.options.tokenKey}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(e.zs3))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),tt=function(){var i=function(){function a(n,t,o,r,s,l){var c=this;(0,h.Z)(this,a),this.http=n,this.tokenService=t,this.config=o,this.languageService=r,this.messageService=s,this.router=l,this.authenticate$=new x.X(void 0),this.logged$=new x.X(void 0),this.anonymous=!1,this.authenticate$.next(this.authenticated),this.authenticate$.subscribe(function(u){c.logged$.next(u),$t.h.next()})}return(0,v.Z)(a,[{key:"hasAuthService",get:function(){return void 0!==this.config.getConfig("auth.url")}},{key:"login",value:function(t,o){var r=new W.WM({"Content-Type":"application/json"}),s={username:t,password:this.encodePassword(o)};return this.loginCall(s,r)}},{key:"loginWithToken",value:function(t,o,r){var s=new W.WM({"Content-Type":"application/json"});return this.loginCall({token:t,typeConnection:o,infosUser:r},s)}},{key:"loginAnonymous",value:function(){return this.anonymous=!0,this.logged$.next(!0),(0,ge.of)(!0)}},{key:"refresh",value:function(){var t=this,o=this.config.getConfig("auth.url");return this.http.post("".concat(o,"/refresh"),{}).pipe((0,qo.b)(function(r){t.tokenService.set(r.token)}),(0,Ze.K)(function(r){throw r.error.caught=!0,r}))}},{key:"logout",value:function(){return this.anonymous=!1,this.tokenService.remove(),this.authenticate$.next(!1),(0,ge.of)(!0)}},{key:"isAuthenticated",value:function(){return!this.tokenService.isExpired()}},{key:"getToken",value:function(){return this.tokenService.get()}},{key:"decodeToken",value:function(){return!!this.isAuthenticated()&&this.tokenService.decode()}},{key:"goToRedirectUrl",value:function(){if(this.router){var t=this.redirectUrl||this.router.url,o=this.config.getConfig("auth")||{};t===o.loginRoute?this.router.navigateByUrl(o.homeRoute||"/"):t&&this.router.navigateByUrl(t)}}},{key:"getUserInfo",value:function(){var t=this.config.getConfig("auth.url")+"/info";return this.http.get(t)}},{key:"getProfils",value:function(){var t=this.config.getConfig("auth.url");return this.http.get("".concat(t,"/profils"))}},{key:"updateUser",value:function(t){var o=this.config.getConfig("auth.url");return this.http.patch(o,t)}},{key:"encodePassword",value:function(t){return Wp.encode(t)}},{key:"logged",get:function(){return this.authenticated||this.isAnonymous}},{key:"isAnonymous",get:function(){return this.anonymous}},{key:"authenticated",get:function(){return this.isAuthenticated()}},{key:"isAdmin",get:function(){var t=this.decodeToken();return!!(t&&t.user&&t.user.isAdmin)}},{key:"loginCall",value:function(t,o){var r=this,s=this.config.getConfig("auth.url");return this.http.post("".concat(s,"/login"),t,{headers:o}).pipe((0,qo.b)(function(l){r.tokenService.set(l.token);var c=r.decodeToken();c&&c.user&&(c.user.locale&&r.languageService.setLanguage(c.user.locale),c.user.isExpired&&r.languageService.translate.get("igo.auth.error.Password expired").subscribe(function(u){return r.messageService.alert(u)})),r.authenticate$.next(!0)}),(0,Ze.K)(function(l){throw l.error.caught=!0,l}))}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG(Va),e.LFG(j),e.LFG($),e.LFG(Ae),e.LFG(me.F0,8))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),yh=function(){var i=function(){function a(n,t,o,r){(0,h.Z)(this,a),this.authService=n,this.config=t,this.languageService=o,this.appRef=r,this.login=new e.vpe,this.options=this.config.getConfig("auth.google")||{},this.options.apiKey&&this.options.clientId?(this.loadSDKGoogle(),this.loadPlatform()):console.warn('Google authentification needs "apiKey" and "clientId" options')}return(0,v.Z)(a,[{key:"handleSignInClick",value:function(){window.gapi.auth2.getAuthInstance().signIn()}},{key:"handleSignOutClick",value:function(){window.gapi.auth2.getAuthInstance().signOut()}},{key:"handleClientLoad",value:function(){var t=this;window.gapi.load("client:auth2",function(){return t.initClient()})}},{key:"initClient",value:function(){var t=this;window.gapi.client.init({apiKey:this.options.apiKey,clientId:this.options.clientId,discoveryDocs:["https://people.googleapis.com/$discovery/rest?version=v1"],scope:"profile"}).then(function(){t.handleSignOutClick(),t.updateTextButton(),window.gapi.auth2.getAuthInstance().isSignedIn.listen(function(o){t.updateSigninStatus(o)})})}},{key:"updateSigninStatus",value:function(t){this.updateTextButton(),t&&this.loginGoogle(window.gapi.client.getToken().access_token)}},{key:"updateTextButton",value:function(){var t=document.querySelector('span[id^="not_signed_"]');t&&"en"!==this.languageService.getLanguage()&&("Sign in with Google"===t.innerHTML?t.innerHTML=this.languageService.translate.instant("igo.auth.google.login"):"Signed in with Google"===t.innerHTML&&(t.innerHTML=this.languageService.translate.instant("igo.auth.google.logged")))}},{key:"loginGoogle",value:function(t){var o=this;this.authService.loginWithToken(t,"google").subscribe(function(){o.appRef.tick(),o.login.emit(!0)})}},{key:"loadSDKGoogle",value:function(){var t=this,o=document.getElementsByTagName("script")[0],r=document.createElement("script");r.id="google-jssdk",r.src="https://apis.google.com/js/api.js",r.onload=function(){t.handleClientLoad()},o.parentNode.insertBefore(r,o)}},{key:"loadPlatform",value:function(){var t=document.getElementsByTagName("script")[0],o=document.createElement("script");o.id="google-platform",o.src="https://apis.google.com/js/platform.js",t.parentNode.insertBefore(o,t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(tt),e.Y36(j),e.Y36($),e.Y36(e.z2F))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-auth-google"]],outputs:{login:"login"},decls:1,vars:0,consts:[["data-height","40","data-width","265","data-longtitle","true",1,"g-signin2","google-login-button"]],template:function(n,t){1&n&&e._UZ(0,"div",0)},styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block}.google-login-button[_ngcontent-%COMP%]     .abcRioButton{color:#000000de}"],changeDetection:0}),i}();function _h(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.loginAnonymous())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("disabled",t.loading),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.auth.accessAnonymous")," ")}}function bh(i,a){if(1&i&&(e.TgZ(0,"div"),e._UZ(1,"br"),e.TgZ(2,"font",8),e._uU(3),e.qZA()()),2&i){var n=e.oxw();e.xp6(3),e.Oqu(n.error)}}var Ch=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.auth=n,this.languageService=t,this._allowAnonymous=!0,this.error="",this.loading=!1,this.login=new e.vpe,this.form=o.group({username:["",S.kI.required],password:["",S.kI.required]})}return(0,v.Z)(a,[{key:"allowAnonymous",get:function(){return this._allowAnonymous},set:function(t){this._allowAnonymous=t}},{key:"loginUser",value:function(t){var o=this;return this.loading=!0,this.auth.login(t.username,t.password).subscribe(function(){o.login.emit(!0),o.loading=!1},function(r){try{o.languageService.translate.get("igo.auth.error."+r.error.message).subscribe(function(s){return o.error=s})}catch(s){o.error=r.error.message}o.loading=!1}),!1}},{key:"loginAnonymous",value:function(){var t=this;this.auth.loginAnonymous().subscribe(function(){t.login.emit(!0)})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(tt),e.Y36($),e.Y36(S.QS))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-auth-intern"]],inputs:{allowAnonymous:"allowAnonymous"},outputs:{login:"login"},decls:14,vars:12,consts:[["role","form",3,"formGroup","ngSubmit"],[1,"full-width"],["matInput","","required","","formControlName","username",3,"placeholder"],["matInput","","required","","type","password","formControlName","password",3,"placeholder"],["mat-raised-button","","type","submit"],["mat-raised-button","","class","anonymous","type","button",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["mat-raised-button","","type","button",1,"anonymous",3,"disabled","click"],["size","3","color","red"]],template:function(n,t){1&n&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return t.loginUser(t.form.value)}),e.TgZ(1,"div")(2,"mat-form-field",1),e._UZ(3,"input",2),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"div")(6,"mat-form-field",1),e._UZ(7,"input",3),e.ALo(8,"translate"),e.qZA()(),e.TgZ(9,"button",4),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.YNc(12,_h,3,4,"button",5),e.YNc(13,bh,4,1,"div",6),e.qZA()),2&n&&(e.Q6J("formGroup",t.form),e.xp6(3),e.s9C("placeholder",e.lcZ(4,6,"igo.auth.user")),e.xp6(4),e.s9C("placeholder",e.lcZ(8,8,"igo.auth.password")),e.xp6(3),e.Oqu(e.lcZ(11,10,"igo.auth.login")),e.xp6(2),e.Q6J("ngIf",t.allowAnonymous),e.xp6(1),e.Q6J("ngIf",t.error))},dependencies:[C.O5,S._Y,S.Fj,S.JJ,S.JL,S.Q7,S.sg,S.u,B.KE,le.Nt,I.lW,E.X$],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.anonymous[_ngcontent-%COMP%]{margin-left:10px}"]}),i}(),Sh=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.authService=n,this.config=t,this.appRef=o,this.login=new e.vpe,this.options=this.config.getConfig("auth.facebook")||{},this.options.appId?this.loadSDKFacebook():console.warn('Facebook authentification needs "appId" option')}return(0,v.Z)(a,[{key:"subscribeEvents",value:function(){var t=this;window.FB.Event.subscribe("auth.statusChange",function(o){t.statusChangeCallback(o)})}},{key:"statusChangeCallback",value:function(t){"connected"===t.status&&this.loginFacebook(t.authResponse.accessToken)}},{key:"loginFacebook",value:function(t){var o=this;this.authService.loginWithToken(t,"facebook").subscribe(function(){o.appRef.tick(),o.login.emit(!0)})}},{key:"loadSDKFacebook",value:function(){var t=this;if(!document.getElementById("facebook-jssdk")){var r=document.getElementsByTagName("script")[0],s=document.createElement("script");s.id="facebook-jssdk",s.src="".concat("https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9","&appId=").concat(this.options.appId),s.onload=function(){t.subscribeEvents()},r.parentNode.insertBefore(s,r)}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(tt),e.Y36(j),e.Y36(e.z2F))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-auth-facebook"]],outputs:{login:"login"},decls:1,vars:0,consts:[["scope","public_profile,email","data-max-rows","1","data-size","large","data-button-type","login_with","data-show-faces","false","data-auto-logout-link","false","data-use-continue-as","false",1,"fb-login-button"]],template:function(n,t){1&n&&e._UZ(0,"div",0)},styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-3px}"],changeDetection:0}),i}(),wh=function(){var i=function(){function a(n,t,o,r,s){var l=this;(0,h.Z)(this,a),this.authService=n,this.config=t,this.appRef=o,this.msalService=r,this.msalGuardConfig=s,this._destroying$=new $e.x,this.login=new e.vpe,this.options=this.config.getConfig("auth.microsoft")||{},this.msalService.instance=new Tr.L({auth:this.options,cache:{cacheLocation:"sessionStorage"}}),this.broadcastService=new tn.J$(this.msalService.instance,this.msalService),this.options.clientId?this.broadcastService.inProgress$.pipe((0,po.h)(function(c){return c===Go.$H.None}),(0,En.R)(this._destroying$)).subscribe(function(){l.checkAccount()}):console.warn('Microsoft authentification needs "clientId" option')}return(0,v.Z)(a,[{key:"loginMicrosoft",value:function(){var t=this;this.msalService.loginPopup(Object.assign({},this.getConf().authRequest)).subscribe(function(o){t.msalService.instance.setActiveAccount(o.account),t.checkAccount()})}},{key:"checkAccount",value:function(){var t=this;this.msalService.instance.acquireTokenSilent(this.getConf().authRequest).then(function(o){t.authService.loginWithToken(o.accessToken,"microsoft",{tokenId:o.idToken}).subscribe(function(){t.appRef.tick(),t.login.emit(!0)})}).catch(function(o){return(0,ne.mG)(t,void 0,void 0,(0,Ne.Z)().mark(function r(){return(0,Ne.Z)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(o instanceof Ql.Yo)){l.next=2;break}return l.abrupt("return",this.msalService.acquireTokenPopup(this.getConf().authRequest));case 2:console.log(o);case 3:case"end":return l.stop()}},r,this)}))}).catch(function(o){console.log("Silent token fails")})}},{key:"getConf",value:function(){return this.msalGuardConfig.filter(function(t){return"add"===t.type})[0]}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(tt),e.Y36(j),e.Y36(e.z2F),e.Y36(tn.W2),e.Y36(tn.S9))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-auth-microsoft"]],outputs:{login:"login"},decls:4,vars:3,consts:[["mat-raised-button","",1,"microsoft-login-button",3,"click"],["svgIcon","microsoft"]],template:function(n,t){1&n&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return t.loginMicrosoft()}),e._UZ(1,"mat-icon",1),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&n&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"igo.auth.microsoft.login"),"\n"))},dependencies:[O.Hw,I.lW,E.X$],styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-15px}[_nghost-%COMP%] > button[_ngcontent-%COMP%]{font-size:15px;height:40px;width:265px}mat-icon[_ngcontent-%COMP%]{margin-right:10px}"],changeDetection:0}),i}(),za=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.instance=n,this.location=t,this.name="@azure/msal-angular",this.version="2.0.0-beta.2";var o=this.location.path(!0).split("#").pop();o&&(this.redirectHash="#".concat(o)),this.instance.initializeWrapperLibrary(Go.lA.Angular,this.version)}return(0,v.Z)(a,[{key:"initialize",value:function(){return(0,pn.D)(this.instance.initialize())}},{key:"acquireTokenPopup",value:function(t){return(0,pn.D)(this.instance.acquireTokenPopup(t))}},{key:"acquireTokenRedirect",value:function(t){return(0,pn.D)(this.instance.acquireTokenRedirect(t))}},{key:"acquireTokenSilent",value:function(t){return(0,pn.D)(this.instance.acquireTokenSilent(t))}},{key:"handleRedirectObservable",value:function(t){return(0,pn.D)(this.instance.handleRedirectPromise(t||this.redirectHash))}},{key:"loginPopup",value:function(t){return(0,pn.D)(this.instance.loginPopup(t))}},{key:"loginRedirect",value:function(t){return(0,pn.D)(this.instance.loginRedirect(t))}},{key:"logout",value:function(t){return(0,pn.D)(this.instance.logout(t))}},{key:"logoutRedirect",value:function(t){return(0,pn.D)(this.instance.logoutRedirect(t))}},{key:"logoutPopup",value:function(t){return(0,pn.D)(this.instance.logoutPopup(t))}},{key:"ssoSilent",value:function(t){return(0,pn.D)(this.instance.ssoSilent(t))}},{key:"getLogger",value:function(){return this.logger||(this.logger=this.instance.getLogger().clone(this.name,this.version)),this.logger}},{key:"setLogger",value:function(t){this.logger=t.clone(this.name,this.version),this.instance.setLogger(t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(tn.sK),e.LFG(C.Ye))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i}(),Th=function(){var i=(0,v.Z)(function a(n,t){var o=this;(0,h.Z)(this,a),this.msalInstance=n,this.authService=t,this._msalSubject=new $e.x,this.msalSubject$=this._msalSubject.asObservable(),this._inProgress=new x.X(Go.$H.Startup),this.inProgress$=this._inProgress.asObservable(),this.msalInstance.addEventCallback(function(r){o._msalSubject.next(r);var s=vh.w.getInteractionStatusFromEvent(r);null!==s&&(o.authService.getLogger().verbose("BroadcastService - ".concat(r.eventType," results in setting inProgress to ").concat(s)),o._inProgress.next(s))})});return i.\u0275fac=function(n){return new(n||i)(e.LFG(tn.sK),e.LFG(za))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i}(),xh=function(){var i=function(){function a(n,t,o,r,s){var l=this;(0,h.Z)(this,a),this.authService=n,this.config=t,this.appRef=o,this.msalService=r,this.msalGuardConfig=s,this._destroying$=new $e.x,this.login=new e.vpe,this.options=this.config.getConfig("auth.microsoftb2c")||{},this.msalService.instance=new Tr.L({auth:this.options.browserAuthOptions,cache:{cacheLocation:"sessionStorage"}}),this.broadcastService=new Th(this.msalService.instance,this.msalService),this.options.browserAuthOptions.clientId?this.broadcastService.inProgress$.pipe((0,po.h)(function(c){return c===Go.$H.None}),(0,En.R)(this._destroying$)).subscribe(function(){l.checkAccount()}):console.warn('Microsoft authentification needs "clientId" option')}return(0,v.Z)(a,[{key:"loginMicrosoftb2c",value:function(){var t=this;this.msalService.loginPopup(Object.assign({},this.getConf().authRequest)).subscribe(function(o){t.msalService.instance.setActiveAccount(o.account),t.checkAccount()})}},{key:"checkAccount",value:function(){var t=this;this.msalService.instance.acquireTokenSilent(this.getConf().authRequest).then(function(o){t.authService.loginWithToken(o.idToken,"microsoftb2c").subscribe(function(){t.appRef.tick(),t.login.emit(!0)})}).catch(function(o){return(0,ne.mG)(t,void 0,void 0,(0,Ne.Z)().mark(function r(){return(0,Ne.Z)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(o instanceof Ql.Yo)){l.next=2;break}return l.abrupt("return",this.msalService.acquireTokenPopup(this.getConf().authRequest));case 2:case"end":return l.stop()}},r,this)}))}).catch(function(o){console.log("Silent token fails")})}},{key:"getConf",value:function(){return this.msalGuardConfig.filter(function(t){return"b2c"===t.type})[0]}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(tt),e.Y36(j),e.Y36(e.z2F),e.Y36(za),e.Y36(tn.S9))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-auth-microsoftb2c"]],outputs:{login:"login"},decls:4,vars:3,consts:[["mat-raised-button","",1,"microsoft-login-button",3,"click"],["svgIcon","microsoft"]],template:function(n,t){1&n&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return t.loginMicrosoftb2c()}),e._UZ(1,"mat-icon",1),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&n&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"igo.auth.microsoftb2c.login"),"\n"))},dependencies:[O.Hw,I.lW,E.X$],styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-15px}[_nghost-%COMP%] > button[_ngcontent-%COMP%]{font-size:15px;height:40px;width:265px}mat-icon[_ngcontent-%COMP%]{margin-right:10px}"],changeDetection:0}),i}();function kh(i,a){1&i&&e._UZ(0,"div",3)}function Mh(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-auth-google",7),e.NdJ("login",function(){e.CHM(n);var o=e.oxw(3);return e.KtG(o.onLogin())}),e.qZA()}}function Fh(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-auth-microsoft",7),e.NdJ("login",function(){e.CHM(n);var o=e.oxw(3);return e.KtG(o.onLogin())}),e.qZA()}}function Zh(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-auth-microsoftb2c",7),e.NdJ("login",function(){e.CHM(n);var o=e.oxw(3);return e.KtG(o.onLogin())}),e.qZA()}}function Ah(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-auth-facebook",7),e.NdJ("login",function(){e.CHM(n);var o=e.oxw(3);return e.KtG(o.onLogin())}),e.qZA()}}function Ih(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-auth-intern",8),e.NdJ("login",function(){e.CHM(n);var r=e.oxw(3);return e.KtG(r.onLogin())}),e.qZA()}if(2&i){var t=e.oxw(3);e.Q6J("allowAnonymous",t.options.allowAnonymous)}}function Lh(i,a){if(1&i&&(e.TgZ(0,"div",4)(1,"h1"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Mh,1,0,"igo-auth-google",5),e.YNc(5,Fh,1,0,"igo-auth-microsoft",5),e.YNc(6,Zh,1,0,"igo-auth-microsoftb2c",5),e.YNc(7,Ah,1,0,"igo-auth-facebook",5),e.YNc(8,Ih,1,1,"igo-auth-intern",6),e.qZA()),2&i){var n=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,6,"igo.auth.connection")),e.xp6(2),e.Q6J("ngIf",n.options.google&&!1!==n.options.google.enabled),e.xp6(1),e.Q6J("ngIf",n.options.microsoft&&!1!==n.options.microsoft.enabled),e.xp6(1),e.Q6J("ngIf",n.options.microsoftb2c&&!1!==n.options.microsoftb2c.enabled),e.xp6(1),e.Q6J("ngIf",n.options.facebook&&!1!==n.options.facebook.enabled),e.xp6(1),e.Q6J("ngIf",!n.options.intern||!1!==n.options.intern.enabled)}}function Oh(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",4)(1,"p"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"button",9),e.NdJ("click",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.logout())}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}if(2&i){var t=e.oxw(2);e.xp6(2),e.Oqu(e.xi3(3,2,"igo.auth.welcome",t.user)),e.xp6(3),e.Oqu(e.lcZ(6,5,"igo.auth.signOut"))}}function Dh(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(3);return e.KtG(o.home())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&i&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"igo.auth.home")))}function Ph(i,a){if(1&i&&(e.TgZ(0,"div",4)(1,"p"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Dh,3,3,"button",10),e.qZA()),2&i){var n=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,2,"igo.auth.deconnection")),e.xp6(2),e.Q6J("ngIf",n.options.homeRoute)}}function Eh(i,a){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,kh,1,0,"div",1),e.YNc(2,Lh,9,8,"div",2),e.YNc(3,Oh,7,7,"div",2),e.YNc(4,Ph,5,4,"div",2),e.qZA()),2&i){var n=e.oxw();e.xp6(1),e.Q6J("ngIf",!n.auth.logged&&n.backgroundDisable),e.xp6(1),e.Q6J("ngIf",!n.auth.logged&&n.showLoginDiv),e.xp6(1),e.Q6J("ngIf",n.auth.logged&&n.showAlreadyConnectedDiv),e.xp6(1),e.Q6J("ngIf",n.showLogoutDiv)}}var Wa=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.auth=n,this.config=t,this.router=o,this._backgroundDisable=!0,this._hasAlreadyConnectedDiv=!0,this._hasLogoutDiv=!0,this._showAlreadyConnectedDiv=!1,this._showLogoutDiv=!1,this.login=new e.vpe,this.visible=!0,this.options=this.config.getConfig("auth")||{},this.visible=0!==Object.getOwnPropertyNames(this.options).length}return(0,v.Z)(a,[{key:"backgroundDisable",get:function(){return!this.isLogoutRoute&&!this.isLogoutRoute&&this._backgroundDisable},set:function(t){this._backgroundDisable="true"===t.toString()}},{key:"hasAlreadyConnectedDiv",get:function(){return this._hasAlreadyConnectedDiv},set:function(t){this._hasAlreadyConnectedDiv="true"===t.toString()}},{key:"hasLogoutDiv",get:function(){return this._hasLogoutDiv},set:function(t){this._hasLogoutDiv="true"===t.toString()}},{key:"showAlreadyConnectedDiv",get:function(){return this.isLogoutRoute?this.hasAlreadyConnectedDiv:this._showAlreadyConnectedDiv},set:function(t){this._showAlreadyConnectedDiv="true"===t.toString()}},{key:"showLogoutDiv",get:function(){return this.isLogoutRoute?this.hasLogoutDiv:this._showLogoutDiv},set:function(t){this._showLogoutDiv="true"===t.toString()}},{key:"showLoginDiv",get:function(){if(!this.isLogoutRoute)return!0}},{key:"ngOnInit",value:function(){this.analyzeRoute(),this.getName()}},{key:"onLogin",value:function(){this.auth.goToRedirectUrl(),this.getName(),this.login.emit(!0)}},{key:"logout",value:function(){var t=this;this.auth.logout().subscribe(function(){t.user=void 0,t.router&&(t.options.logoutRoute?t.router.navigate([t.options.logoutRoute]):t.options.homeRoute&&t.router.navigate([t.options.homeRoute]))})}},{key:"home",value:function(){this.router&&this.options.homeRoute&&this.router.navigate([this.options.homeRoute])}},{key:"getName",value:function(){var t=this.auth.decodeToken();t&&(this.user={name:t.user.firstName||t.user.sourceId})}},{key:"analyzeRoute",value:function(){var t=this;!this.router||this.router.events.pipe((0,po.h)(function(o){return o instanceof me.OD})).subscribe(function(o){if(o.url){var r=o.url,l=t.options.loginRoute;t.isLogoutRoute=r===t.options.logoutRoute,t.isLoginRoute=r===l,t.isLogoutRoute&&t.auth.logout()}})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(tt),e.Y36(j),e.Y36(me.F0,8))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-auth-form"]],inputs:{backgroundDisable:"backgroundDisable",hasAlreadyConnectedDiv:"hasAlreadyConnectedDiv",hasLogoutDiv:"hasLogoutDiv",showAlreadyConnectedDiv:"showAlreadyConnectedDiv",showLogoutDiv:"showLogoutDiv"},outputs:{login:"login"},decls:1,vars:1,consts:[[4,"ngIf"],["class","backgroundDisable",4,"ngIf"],["class","login center-block",4,"ngIf"],[1,"backgroundDisable"],[1,"login","center-block"],[3,"login",4,"ngIf"],[3,"allowAnonymous","login",4,"ngIf"],[3,"login"],[3,"allowAnonymous","login"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button",3,"click",4,"ngIf"]],template:function(n,t){1&n&&e.YNc(0,Eh,5,4,"div",0),2&n&&e.Q6J("ngIf",t.visible)},dependencies:[C.O5,I.lW,yh,Ch,Sh,wh,xh,E.X$],styles:["[_nghost-%COMP%]{z-index:999}div.login[_ngcontent-%COMP%]{z-index:200;width:90%;min-width:360px;max-width:600px;padding:25px 50px;border:1px solid;background-color:#fff;border-color:#888}.center-block[_ngcontent-%COMP%]{position:fixed;top:20%;left:50%;transform:translate(-50%)}.backgroundDisable[_ngcontent-%COMP%]{position:fixed;top:0;left:0;background:#000;opacity:.8;z-index:100;height:100%;width:100%}"]}),i}(),xr=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.config=n,this.tokenService=t,this.http=o,this.refreshInProgress=!1}return(0,v.Z)(a,[{key:"trustHosts",get:function(){var t=this.config.getConfig("auth.trustHosts")||[];return t.push(window.location.hostname),t}},{key:"hostsWithCredentials",get:function(){return this.config.getConfig("auth.hostsWithCredentials")||[]}},{key:"hostsWithAuthByKey",get:function(){return this.config.getConfig("auth.hostsByKey")||[]}},{key:"intercept",value:function(t,o){var r=this.handleHostsWithCredentials(t.url),s=t.clone(),l=this.handleHostsAuthByKey(t.url);if(l&&(s=s.clone({params:s.params.set(l.key,l.value)})),r)return s=t.clone({withCredentials:r}),o.handle(s);this.refreshToken();var c=this.tokenService.get(),u=document.createElement("a");if(u.href=s.url,""===u.host&&(u.href=u.href),!c||-1===this.trustHosts.indexOf(u.hostname))return o.handle(s);var p="Bearer ".concat(c),d=s.clone({headers:s.headers.set("Authorization",p)}),g=this.tokenService.decode();if("true"===d.params.get("_i")&&g&&g.user&&g.user.sourceId){var f=wn.V.hashStr(g.user.sourceId);d=d.clone({params:d.params.set("_i",f)})}else"true"===d.params.get("_i")&&(d=d.clone({params:d.params.delete("_i")}));return o.handle(d)}},{key:"interceptXhr",value:function(t,o){var r=this.handleHostsWithCredentials(o);if(r)return t.withCredentials=r,!0;this.refreshToken();var s=document.createElement("a");s.href=o;var l=this.tokenService.get();return!(!l||-1===this.trustHosts.indexOf(s.hostname)||(t.setRequestHeader("Authorization","Bearer "+l),0))}},{key:"alterUrlWithKeyAuth",value:function(t){var o=this.handleHostsAuthByKey(t);if(o){var s=t.split(/[?&]/),l=s.shift(),c=s.filter(function(u){return 0!==u.length});return c.push("".concat(o.key,"=").concat(o.value)),c.length&&(l+="?"+c.join("&")),l}}},{key:"handleHostsWithCredentials",value:function(t){var s,o=!1,r=(0,D.Z)(this.hostsWithCredentials);try{for(r.s();!(s=r.n()).done;){var l=s.value;if(new RegExp(l.domainRegFilters).test(t)){o=void 0!==l.withCredentials?l.withCredentials:void 0;break}}}catch(u){r.e(u)}finally{r.f()}return o}},{key:"handleHostsAuthByKey",value:function(t){var o,s,r=(0,D.Z)(this.hostsWithAuthByKey);try{for(r.s();!(s=r.n()).done;){var l=s.value;if(new RegExp(l.domainRegFilters).test(t)){var u="".concat(l.keyProperty,"=").concat(l.keyValue);if(!new RegExp(u,"gm").test(t)){o={key:l.keyProperty,value:l.keyValue};break}}}}catch(d){r.e(d)}finally{r.f()}return o}},{key:"refreshToken",value:function(){var t=this,o=this.tokenService.decode(),r=(new Date).getTime()/1e3;if(!this.refreshInProgress&&o&&r<o.exp&&r>o.exp-1800){this.refreshInProgress=!0;var s=this.config.getConfig("auth.url");return this.http.post("".concat(s,"/refresh"),{}).subscribe(function(l){t.tokenService.set(l.token),t.refreshInProgress=!1},function(l){return l.error.caught=!0,l})}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(j),e.LFG(Va),e.LFG(W.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function $h(i){var a=i.getConfig("auth.microsoft")||{};return a.redirectUri=a.redirectUri||window.location.href,a.authority=a.authority||"https://login.microsoftonline.com/organizations",new Tr.L({auth:a,cache:{cacheLocation:"sessionStorage"}})}function Rh(i){var a=i.getConfig("auth.microsoftb2c.browserAuthOptions")||{};return a.redirectUri=a.redirectUri||window.location.href,a.authority=a.authority||"https://login.microsoftonline.com/organizations",new Tr.L({auth:a,cache:{cacheLocation:"sessionStorage"}})}function Jh(i){return i.getConfig("auth.microsoft"),{interactionType:Go.s_.Popup,authRequest:{scopes:["user.read"],loginHint:"todo"},type:"add"}}function Bh(i){var a=i.getConfig("auth.microsoftb2c.browserAuthOptions")||{};return{interactionType:Go.s_.Popup,authRequest:{scopes:[a.clientId]},type:"b2c"}}function Yl(i){return"b2c"===i?[{provide:tn.sK,useFactory:Rh,deps:[j]},{provide:tn.S9,useFactory:Bh,deps:[j],multi:!0},za]:[{provide:tn.sK,useFactory:$h,deps:[j]},{provide:tn.S9,useFactory:Jh,deps:[j],multi:!0},tn.W2]}var Uh=function(){var i=function(a){(0,N.Z)(t,a);var n=(0,q.Z)(t);function t(o,r,s,l){var c,u;return(0,h.Z)(this,t),(u=n.call(this,o)).http=r,u.authService=s,u.tokenService=l,u.authService.authenticate$.subscribe(function(p){p&&u.options.url&&u.http.get(u.options.url).subscribe(function(d){if(d&&d.preference)for(var g=0,f=Object.keys(d.preference);g<f.length;g++){var m=f[g],y=d.preference[m];(0,Se.Z)((c=(0,kt.Z)(u),(0,we.Z)(t.prototype)),"set",c).call(c,m,y)}})}),u}return(0,v.Z)(t,[{key:"set",value:function(r,s){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:qe.LOCAL;if(l===qe.LOCAL&&this.authService.authenticated&&this.options.url){var c={};c[r]=s,this.http.patch(this.options.url,{preference:c}).subscribe()}(0,Se.Z)((0,we.Z)(t.prototype),"set",this).call(this,r,s,l)}},{key:"remove",value:function(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qe.LOCAL;if(s===qe.LOCAL&&this.authService.authenticated&&this.options.url){var l={};l[r]=void 0,this.http.patch(this.options.url,{preference:l}).subscribe()}(0,Se.Z)((0,we.Z)(t.prototype),"remove",this).call(this,r,s)}},{key:"clear",value:function(){var l,r=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qe.LOCAL;s===qe.LOCAL&&this.authService.authenticated&&this.options.url&&this.http.patch(this.options.url,{preference:{}},{params:{mergePreference:"false"}}).subscribe(),s===qe.LOCAL&&(l=this.tokenService.get()),(0,Se.Z)((0,we.Z)(t.prototype),"clear",this).call(this,s),l&&this.tokenService.set(l),s===qe.LOCAL&&this.authService.authenticated&&this.options.url&&this.http.get(this.options.url).subscribe(function(c){if(c&&c.preference)for(var u=0,p=Object.keys(c.preference);u<p.length;u++){var d=p[u],g=c.preference[d];(0,Se.Z)((0,we.Z)(t.prototype),"set",r).call(r,d,g)}})}}]),t}(Te);return i.\u0275fac=function(n){return new(n||i)(e.LFG(j),e.LFG(W.eN),e.LFG(tt),e.LFG(Va))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),Ka=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[{provide:W.TP,useClass:xr,multi:!0},{provide:Te,useClass:Uh}].concat((0,Fe.Z)(Yl("add")),(0,Fe.Z)(Yl("b2c")))}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,S.UX,B.lN,le.c,O.Ps,I.ot,he,tn.up]}),i}();const Gh=me.Bz.forChild([{path:"auth-form",component:(()=>{class i{constructor(n){this.languageService=n,this.idsActivity=[]}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-auth-form"]],decls:17,vars:0,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/auth/auth-form"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Auth"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Authentification"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: ConfigService, LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"br"),e._uU(13," See auth section of the "),e.TgZ(14,"a",1),e._uU(15," environment config"),e.qZA()()(),e._UZ(16,"igo-auth-form"))},dependencies:[F.a8,F.dn,F.n5,F.$j,Wa],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]}),i})()}]);let Qh=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Gh,F.QW,Ka.forRoot()]}),i})();var Ho,Xn,jl=k(8633),wi=k(62902),Hl=k(28653),Nt=k(64055),kr=k(2762),_o=k(20591),Ti=k(85524),Vn=k(63853),Vl=k(49525),xi=k(45508),Yh=k(72409),jh=k(81885),Mr=k(46289),zl=k(92597),re=k(57647),Wl=k(89818),Hh=k(21975),Xa=k(99408),Kl=k(69320),ki=k(92204),es=k(39987),Ke=k(55407),Vh=k(62914),ee=k(864),Lt=k(44483),te=k(95567),bo=k(57920),K=k(12854),Ue=k(17840),Qo=k(32053),Tn=k(73950),He=k(83733),dn=k(39703),Ee=k(92845),zn=k(95091),st=k(87187),Yo=k(12912),Wn=k(56224),Mi=k(1716),jo=k(49798),Xl=k(75767),nn=k(33535),Fr=k(71288),Co=k(36130),zh=k(83605),Zr=k(46709),ts=k(59437),Fi=k(57868),ns=k(35571),ec=k(41649),tc=k(24717),Wh=k(73552),Kh=k(97255),Xh=k(86052),Ct=k(65387),os=k(85025),nc=k(79432),ev=k(39015),tv=k(48332),nv=k(74121),ov=k(29580),oc=k(81091),iv=k(60725),ic=k(24609),rv=k(41370),av=k(8913),sv=k(12279),lv=k(61741),cv=k(50217),uv=k(87769),nt=k(6788),rc=k(27274),ac=k(22196),sc=k(87547),pv=k(2451),dv=k(72816),Ar=k(59333),gv=k(7074),fv=k(29186),lc=k(50384),Zi=k(56234),cc=k(65017),mv=k(89545),uc=k(17265),hv=k(77141),vv=k(7675),Mt=k(19975),ht=k(6623),So=k(61859),is=k(7038),pc=k(18580),rs=k(3942),Ir=k(58258),as=k(52567),dc=k(7887),ot=(k(8322),k(31959)),Ft=k(68390),Ot=k(12379),Kn=k(34972),Ai=k(23563),yv=k(53892),_v=k(38205),bv=k(61811),ss=k(65226),Cv=k(76944),Ii=k(9266),Sv=k(41308),Li=k(54941),ls=k(67981),wv=k(74051),Tv=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,[{key:"open",value:function(t){t.extern&&window.open(t.url,"_blank")}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function xv(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.openMetadata(r.options.metadata))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",2),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.metadata.show"))("color",t.color)}}function kv(i,a){if(1&i&&(e.TgZ(0,"mat-dialog-content",3)(1,"h3"),e._uU(2),e.qZA()()),2&i){var n=e.oxw();e.xp6(2),e.Oqu(n.data.abstract)}}function Mv(i,a){if(1&i&&(e.TgZ(0,"mat-dialog-content",3),e._UZ(1,"h3",4),e.qZA()),2&i){var n=e.oxw();e.xp6(1),e.Q6J("innerHTML",n.data.abstract,e.oJD)}}var Vo=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.metadataService=n,this.dialog=t,this._color="primary"}return(0,v.Z)(a,[{key:"layer",get:function(){return this._layer},set:function(t){this._layer=t}},{key:"color",get:function(){return this._color},set:function(t){this._color=t}},{key:"openMetadata",value:function(t){t.extern?!t.url&&t.abstract?this.dialog.open(gc,{data:{layerTitle:this.layer.title,abstract:t.abstract,type:t.type}}):t.url&&this.metadataService.open(t):!t.extern&&t.abstract&&this.dialog.open(gc,{data:{layerTitle:this.layer.title,abstract:t.abstract,type:t.type}})}},{key:"options",get:function(){if(this.layer)return this.layer.options}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Tv),e.Y36(z.uw))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-metadata-button"]],inputs:{layer:"layer",color:"color"},decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","information-outline"]],template:function(n,t){1&n&&e.YNc(0,xv,3,4,"button",0),2&n&&e.Q6J("ngIf",t.options&&t.options.metadata&&t.options.metadata.url||t.options&&t.options.metadata&&t.options.metadata.abstract)},dependencies:[C.O5,O.Hw,I.lW,J.gM,E.X$],changeDetection:0}),i}(),gc=function(){var i=(0,v.Z)(function a(n){(0,h.Z)(this,a),this.data=n});return i.\u0275fac=function(n){return new(n||i)(e.Y36(z.WI))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-metadata-abstract"]],decls:6,vars:3,consts:[["mat-dialog-title",""],["mat-button","","mat-dialog-close","",1,"close-button"],["class","mat-typography",4,"ngIf"],[1,"mat-typography"],[3,"innerHTML"]],template:function(n,t){1&n&&(e.TgZ(0,"h2",0),e._uU(1),e.qZA(),e.TgZ(2,"button",1),e._uU(3,"X"),e.qZA(),e.YNc(4,kv,3,1,"mat-dialog-content",2),e.YNc(5,Mv,2,1,"mat-dialog-content",2)),2&n&&(e.xp6(1),e.Oqu(t.data.layerTitle),e.xp6(3),e.Q6J("ngIf","arcgisrest"!==t.data.type),e.xp6(1),e.Q6J("ngIf","arcgisrest"===t.data.type))},dependencies:[C.O5,I.lW,z.ZT,z.uh,z.xY],styles:[".close-button{top:5px;right:5px;padding:7px;line-height:10px;position:absolute!important;min-width:auto}mat-dialog-container{position:relative}\n"],encapsulation:2}),i}(),wo=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,O.Ps,I.ot,J.AV,he,z.Is]}),i}(),be="Feature",ce=function(){return(i=ce||(ce={}))[i.None=0]="None",i[i.Move=1]="Move",i[i.Zoom=2]="Zoom",i[i.Default=3]="Default",ce;var i}(),Fv=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o,r){var s;return(0,h.Z)(this,n),(s=a.call(this)).loaded=0,s.loading=0,s.source=t.options.source.ol,s.id=Ye(),s.messageService=o,s.languageService=r,s}return(0,v.Z)(n,[{key:"watch",value:function(){var o=this;this.source.on("imageloadstart",function(r){return o.handleLoadStart(r)}),this.source.on("imageloadend",function(r){return o.handleLoadEnd(r)}),this.source.on("imageloaderror",function(r){return o.handleLoadEnd(r)}),this.source.on("imageloaderror",function(r){return o.handleLoadError(r)})}},{key:"unwatch",value:function(){var o=this;this.source.un("imageloadstart",function(r){return o.handleLoadStart(r)}),this.source.un("imageloadend",function(r){return o.handleLoadEnd(r)}),this.source.un("imageloaderror",function(r){return o.handleLoadEnd(r)}),this.source.un("imageloaderror",function(r){return o.handleLoadError(r)})}},{key:"handleLoadStart",value:function(o){o.image.__watchers__||(o.image.__watchers__=[]),o.image.__watchers__.push(this.id),this.loading+=1,this.status=Le.Working}},{key:"handleLoadEnd",value:function(o){if(o.image.__watchers__){var r=o.image.__watchers__.indexOf(this.id);if(!(r<0)){o.image.__watchers__.splice(r,1),this.loaded+=1;var s=this.loading;this.loaded>=s&&s===this.loading&&(this.status=Le.Done,this.loaded=this.loading=0)}}}},{key:"handleLoadError",value:function(o){if(o.image.__watchers__){var r=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),s=this.languageService.translate.instant("igo.geo.dataSource.unavailable",{value:o.target.params_.LAYERS});this.messageService.error(s,r),this.loaded=-1,this.loading=0,this.status=Le.Error}}}]),n}(ar);function fc(i){var a,n;return"mvt"===(null===(a=i.sourceOptions)||void 0===a?void 0:a.type)&&((null===(n=i.styleByAttribute)||void 0===n?void 0:n.hoverStyle)||i.hoverStyle)&&(i.sourceOptions.featureClass=i.sourceOptions.featureClass||"feature"),i}var mc=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t){var o;return(0,h.Z)(this,n),(o=a.call(this)).loaded=0,o.loading=0,o.source=t.options.source.ol,o.id=Ye(),o}return(0,v.Z)(n,[{key:"watch",value:function(){var o=this;this.source.on("tileloadstart",function(r){return o.handleLoadStart(r)}),this.source.on("tileloadend",function(r){return o.handleLoadEnd(r)}),this.source.on("tileloaderror",function(r){return o.handleLoadEnd(r)})}},{key:"unwatch",value:function(){var o=this;this.source.un("tileloadstart",function(r){return o.handleLoadStart(r)}),this.source.un("tileloadend",function(r){return o.handleLoadEnd(r)}),this.source.un("tileloaderror",function(r){return o.handleLoadEnd(r)})}},{key:"handleLoadStart",value:function(o){o.tile.__watchers__||(o.tile.__watchers__=[]),o.tile.__watchers__.push(this.id),this.loading+=1,this.status=Le.Working}},{key:"handleLoadEnd",value:function(o){if(o.tile.__watchers__){var r=o.tile.__watchers__.indexOf(this.id);if(!(r<0)){o.tile.__watchers__.splice(r,1),this.loaded+=1;var s=this.loading;this.loaded>=s&&s===this.loading&&(this.status=Le.Done,this.loaded=this.loading=0)}}}}]),n}(ar);function Oi(i){return({wms:Av,wmts:Iv,xyz:Lv,feature:Ov,wfs:Dv,arcgisrest:cs,imagearcgisrest:cs,tilearcgisrest:cs,osm:function(o){return"OSM"},tiledebug:function(o){return"tiledebug"}}[i.type]||us)(i)}function Av(i){var a=i.params.LAYERS,n=eo(i.url);return wn.V.hashStr("wms"+n+a)}function Iv(i){var a=i.layer,n=eo(i.url);return wn.V.hashStr("wmts"+n+a)}function Lv(i){var a=eo(i.url);return wn.V.hashStr("xyz"+a)}function Ov(i){if(!i.url)return us();var a=eo(i.url);return wn.V.hashStr("feature"+a)}function Dv(i){if(!i.url||!i.params)return us();var a=eo(i.url);return wn.V.hashStr("wfs"+a+i.params.featureTypes)}function cs(i){var a=i.layer,n=eo(i.url);return wn.V.hashStr((i.type||"arcgis")+n+a)}function us(i){return Ye()}function eo(i){var n=("/"===i.charAt(0)?window.location.origin+i:i).split(/[?&]/),t=n.shift(),o=n.filter(function(r){return 0!==r.length&&"_"!==r.charAt(0)});return o.length&&(t+="?"+o.join("&")),t}var on=function(){function i(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;(0,h.Z)(this,i),this.options=a,this.dataService=n,this.options=a,this.id=this.options.id||this.generateId(),this.ol=this.createOlSource()}return(0,v.Z)(i,[{key:"generateId",value:function(){return Oi(this.options)}},{key:"getLegend",value:function(n,t){return this.legend?this.legend:[]}},{key:"setLegend",value:function(n){return this.legend=n.url?[{url:n.url}]:n.html?[{html:n.html}]:[],this.legend}}]),i}(),Re=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n,[{key:"createOlSource",value:function(){var o={format:this.getSourceFormatFromOptions(this.options)};return new nn.Z(Object.assign(o,this.options))}},{key:"getSourceFormatFromOptions",value:function(o){if(o.format)return o.format;var r,s=o.formatType;if(s){if(void 0===(r=Fr[s]))throw new Error("Invalid vector source format ${formatType}.")}else r=Ee.Z;var l=o.formatOptions;return l?new r(l):new r}},{key:"onUnwatch",value:function(){}},{key:"queryTitle",get:function(){return this.options.queryTitle?this.options.queryTitle:"title"}}]),n}(on),gn=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n,[{key:"createOlSource",value:function(){return this.options.format=this.getSourceFormatFromOptions(this.options),this.options.source=(0,Se.Z)((0,we.Z)(n.prototype),"createOlSource",this).call(this),new Xl.Z(this.options)}},{key:"generateId",value:function(){return Ye()}},{key:"onUnwatch",value:function(){}}]),n}(Re),Pv=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t){var o;return(0,h.Z)(this,n),(o=a.call(this)).loaded=0,o.loading=0,o.layer=t,o.id=Ye(),o}return(0,v.Z)(n,[{key:"watch",value:function(){var o=this,r=this.layer.options.source.ol;this.layer.dataSource instanceof gn&&(r=this.layer.options.source.options.source),r.getUrl()&&(r.on("featuresloadstart",function(s){return o.handleLoadStart(s)}),r.on("featuresloadend",function(s){return o.handleLoadEnd(s)}),r.on("featuresloaderror",function(s){return o.handleLoadEnd(s)}))}},{key:"unwatch",value:function(){var o=this,r=this.layer.options.source.ol;this.layer.dataSource instanceof gn&&(r=this.layer.options.source.options.source),r.getUrl()&&(r.un("featuresloadstart",function(s){return o.handleLoadStart(s)}),r.un("featuresloadend",function(s){return o.handleLoadEnd(s)}),r.un("featuresloaderror",function(s){return o.handleLoadEnd(s)}))}},{key:"handleLoadStart",value:function(o){this.loading+=1,this.status=Le.Working}},{key:"handleLoadEnd",value:function(o){this.loaded+=1;var r=this.loading;this.loaded>=r&&r===this.loading&&(this.status=Le.Done,this.loaded=this.loading=0)}}]),n}(ar);function hc(i,a){var t,o,r,s,l,c,u,p,d,g,f,m,y,_,b,w,T,M,A,R,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},L="(\\s*;\\s*[\\d]{4,6})",Z="4326",V=new RegExp(L,"g"),P="([-+])?([\\d]{1,3})([,.](\\d+))?",Y="".concat(P,"[\\s,]+").concat(P),pe=new RegExp("^".concat(Y,"$"),"g"),ue="([0-9]{1,2})[:|\xb0]?\\s*([0-9]{1,2})?[:|'|\u2032|\u2019]?\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\s*[\"|\u2033|\u201d]?\\s*",oe="".concat(ue,"([N|S|E|W|O]),?\\s*").concat(ue,"([N|S|E|W|O])"),Q=new RegExp("^".concat(oe,"$"),"gi"),ae="(UTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",xe=new RegExp("^".concat(ae),"gi"),Me="(MTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",Ce=new RegExp("^".concat(Me),"gi"),Wt="([-+])?(\\d{1,3})[,.](\\d+)",wt="".concat(Wt,"\\s*[,]?\\s*").concat(Wt),Kt=new RegExp("^".concat(wt),"g"),Fn="([-+])?(\\d{1,3})[\\s,.]{1}(\\d{1,2})[\\s,.]{1}(\\d{1,2})[.,]?(\\d{1,5})?",fe="".concat(Fn,"\\s*[,.]?\\s*").concat(Fn),ui=new RegExp("^".concat(fe),"g"),rr="LAT\\s*[\\s:]*\\s*([-+])?(\\d{1,2})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*LONG\\s*[\\s:]*\\s*([-+])?(\\d{1,3})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*UNC\\s*[\\s:]?\\s*(\\d+)\\s*CONF\\s*[\\s:]?\\s*(\\d{1,3})",Nn=new RegExp("^".concat(rr,"?"),"gi"),Up="([-+]?\\d+)[,.]?(\\d+)?",Np="".concat(Up,"[\\s,]+").concat(Up),UZ=new RegExp("^".concat(Np,"$"),"g"),pa=!1;if(i=i.toLocaleUpperCase().trim(),V.test(i)){var NZ=i.split(";").map(function(jp){return jp.trim()}),qp=(0,Qe.Z)(NZ,2);o=qp[0],R=qp[1]}else o=i;if(pe.test(o)){var qZ=o.match(Y),pi=(0,Qe.Z)(qZ,9);r=pi[1],M=pi[2],p=pi[4],d=pi[5],A=pi[6],_=pi[8],M=parseFloat((r||"")+M+"."+p),A=parseFloat((d||"")+A+"."+_)}else if(Q.test(o)){var GZ=o.match(oe),ro=(0,Qe.Z)(GZ,9);s=ro[1],l=ro[2],c=ro[3],g=ro[5],f=ro[6],m=ro[7],y=ro[8],("S"===(u=ro[4])||"N"===u)&&(s=[g,g=s][0],l=[f,f=l][0],c=[m,m=c][0],u=[y,y=u][0]),M=to(parseFloat(s),parseFloat(l),parseFloat(c),u),A=to(parseFloat(g),parseFloat(f),parseFloat(m),y)}else if(xe.test(o)){pa=!0;var QZ=o.match(ae),dl=(0,Qe.Z)(QZ,5);b=dl[2],M=dl[3],A=dl[4];var YZ=Number(b)<10?"EPSG:3260".concat(b):"EPSG:326".concat(b),jZ=re.vs([parseFloat(M),parseFloat(A)],YZ,"EPSG:4326"),Gp=(0,Qe.Z)(jZ,2);M=Gp[0],A=Gp[1]}else if(Ce.test(o)){pa=!0;var HZ=o.match(Me),gl=(0,Qe.Z)(HZ,5);b=gl[2],M=gl[3],A=gl[4];var VZ=Number(b)<10?"EPSG:3218".concat(b):"EPSG:321".concat(80+Number(b)),zZ=re.vs([parseFloat(M),parseFloat(A)],VZ,"EPSG:4326"),Qp=(0,Qe.Z)(zZ,2);M=Qp[0],A=Qp[1]}else if(ui.test(o)){var WZ=o.match(fe),Zn=(0,Qe.Z)(WZ,11);r=Zn[1],s=Zn[2],l=Zn[3],c=Zn[4],p=Zn[5],d=Zn[6],g=Zn[7],f=Zn[8],m=Zn[9],_=Zn[10],M=to(parseFloat((r||"")+s),parseFloat(l),parseFloat(c),u),A=to(parseFloat((d||"")+g),parseFloat(f),parseFloat(m),y)}else if(Kt.test(o)){var KZ=o.match(wt),di=(0,Qe.Z)(KZ,7);r=di[1],s=di[2],p=di[3],d=di[4],g=di[5],_=di[6],M=to(parseFloat((r||"")+s),parseFloat(l),parseFloat(c),u),A=to(parseFloat((d||"")+g),parseFloat(f),parseFloat(m),y)}else if(Nn.test(o)){var XZ=o.match(rr),cn=(0,Qe.Z)(XZ,15);d=cn[1],g=cn[2],f=cn[3],m=cn[4],y=cn[6],r=cn[7],s=cn[8],c=cn[10],w=cn[13],T=cn[14],(u=cn[12])||(u="W"),M=(l=cn[9])&&l.length>2?parseFloat((r||"")+s+"."+l):to(parseFloat(s),parseFloat(l),parseFloat(c),u),A=f&&f.length>2?parseFloat((d||"")+g+"."+f):to(parseFloat(g),parseFloat(f),parseFloat(m),y)}else{if(!UZ.test(o))return{lonLat:void 0,message:"",radius:void 0,conf:void 0};pa=!0;var eA=o.match(Np),da=(0,Qe.Z)(eA,5);M=da[1],A=da[3],_=da[4],(p=da[2])&&(M=parseFloat(M+"."+p)),_&&(A=parseFloat(A+"."+_))}if(n.forceNA&&!pa&&(M>0&&A>0&&(M>A?M=-M:A=-A),M>A&&(M=[A,A=M][0])),t=[Number(M),Number(A)],void 0!==R&&R!==Z||t[0]>180||t[0]<-180||t[1]>90||t[1]<-90){var Yp=R?"EPSG:"+R:a,tA="EPSG:"+Z;try{t=re.vs(t,Yp,tA)}catch(jp){return{lonLat:void 0,message:"Projection "+Yp+" not supported",radius:void 0,conf:void 0}}}return Math.abs(t[0])<=180&&Math.abs(t[1])<=90?{lonLat:t,message:"",radius:w?parseInt(w,10):void 0,conf:T?parseInt(T,10):void 0}:{lonLat:void 0,message:"Coordinate out of Longitude/Latitude bounds",radius:void 0,conf:void 0}}function to(i,a,n,t){a=a||0,n=n||0;var o=i<0,r=Math.abs(i)+a/60+n/3600;return(o||"S"===t||"W"===t)&&(r=-r),r}function ps(i){return(i=Math.round(i))<1e4?i+"":(i=Math.round(i/1e3))<1e3?i+"K":(i=Math.round(i/1e3))+"M"}function Zt(i){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:96,n=39.3701;return i/(n*a)}function Rv(i){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"m",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:96,t=39.3701;return i*re.Wm[a]*t*n}function Lr(i){var a=i.originalEvent;return!a.altKey&&(Xh.tK?a.metaKey:a.ctrlKey)&&!a.shiftKey}function Rt(i){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return[co.roundToNDecimal(i[0],a),co.roundToNDecimal(i[1],a)]}var Or=function(){function i(a,n,t){(0,h.Z)(this,i),this.options=a,this.messageService=n,this.authInterceptor=t,this.legendCollapsed=!0,this.firstLoadComponent=!0,this.olLoadingProblem=!1,this.hasBeenVisible$=new x.X(void 0),this.isInResolutionsRange$=new x.X(!1),this.visible$=new x.X(void 0),this.displayed$=(0,dt.a)([this.isInResolutionsRange$,this.visible$]).pipe((0,U.U)(function(o){return o[0]&&o[1]})),this.dataSource=a.source,this.ol=this.createOlLayer(),void 0!==a.zIndex&&(this.zIndex=a.zIndex),a.baseLayer&&void 0===a.visible&&(a.visible=!1),this.maxResolution=a.maxResolution||Zt(Number(a.maxScaleDenom)),this.minResolution=a.minResolution||Zt(Number(a.minScaleDenom)),this.visible=void 0===a.visible||a.visible,this.opacity=void 0===a.opacity?1:a.opacity,a.legendOptions&&(a.legendOptions.url||a.legendOptions.html)&&(this.legend=this.dataSource.setLegend(a.legendOptions)),this.legendCollapsed=!a.legendOptions||!a.legendOptions.collapsed||a.legendOptions.collapsed,this.ol.set("_layer",this,!0)}return(0,v.Z)(i,[{key:"isIgoInternalLayer",get:function(){return this.options.isIgoInternalLayer||!1}},{key:"id",get:function(){return this.options.id||this.dataSource.id}},{key:"alias",get:function(){return this.options.alias}},{key:"title",get:function(){return this.options.title},set:function(n){this.options.title=n}},{key:"zIndex",get:function(){return this.ol.getZIndex()},set:function(n){this.ol.setZIndex(n)}},{key:"baseLayer",get:function(){return this.options.baseLayer},set:function(n){this.options.baseLayer=n}},{key:"opacity",get:function(){return this.ol.get("opacity")},set:function(n){this.ol.setOpacity(n)}},{key:"isInResolutionsRange",get:function(){return this.isInResolutionsRange$.value},set:function(n){this.isInResolutionsRange$.next(n)}},{key:"maxResolution",get:function(){return this.ol.getMaxResolution()},set:function(n){this.ol.setMaxResolution(n||1/0),this.updateInResolutionsRange()}},{key:"minResolution",get:function(){return this.ol.getMinResolution()},set:function(n){this.ol.setMinResolution(n||0),this.updateInResolutionsRange()}},{key:"visible",get:function(){return this.visible$.value},set:function(n){var o,r,t=this;this.ol.setVisible(n),this.visible$.next(n),!this.hasBeenVisible$.value&&n&&this.hasBeenVisible$.next(n),(null===(o=this.options)||void 0===o?void 0:o.messages)&&n&&(null===(r=this.options)||void 0===r||r.messages.filter(function(s){var l;return null===(l=s.options)||void 0===l?void 0:l.showOnEachLayerVisibility}).map(function(s){return t.showMessage(s)}))}},{key:"displayed",get:function(){return this.visible&&this.isInResolutionsRange}},{key:"showInLayerList",get:function(){return!1!==this.options.showInLayerList}},{key:"setMap",value:function(n){var t=this;this.map=n,this.unobserveResolution(),void 0!==n&&(this.observeResolution(),this.hasBeenVisible$$=this.hasBeenVisible$.subscribe(function(){t.options.messages&&t.visible&&t.options.messages.map(function(o){t.showMessage(o)})}))}},{key:"showMessage",value:function(n){!this.messageService||(n.title=n.title,n.text=n.text,this.messageService.message(n))}},{key:"observeResolution",value:function(){var n=this;this.resolution$$=this.map.viewController.resolution$.subscribe(function(){return n.updateInResolutionsRange()})}},{key:"unobserveResolution",value:function(){void 0!==this.resolution$$&&(this.resolution$$.unsubscribe(),this.resolution$$=void 0)}},{key:"updateInResolutionsRange",value:function(){if(void 0!==this.map){var n=this.map.viewController.getResolution();this.isInResolutionsRange=n>=this.minResolution&&n<=(void 0===this.maxResolution?1/0:this.maxResolution)}else this.isInResolutionsRange=!1}}]),i}(),it=function(){return(i=it||(it={})).BasicNumericOperator="basicnumericoperator",i.Basic="basic",i.BasicAndSpatial="basicandspatial",i.Spatial="spatial",i.All="all",i.Time="time",it;var i}(),G=function(){return(i=G||(G={})).BBOX="BBox",i.PropertyIsBetween="PropertyIsBetween",i.Contains="Contains",i.During="During",i.PropertyIsEqualTo="PropertyIsEqualTo",i.PropertyIsGreaterThan="PropertyIsGreaterThan",i.PropertyIsGreaterThanOrEqualTo="PropertyIsGreaterThanOrEqualTo",i.Intersects="Intersects",i.PropertyIsNull="PropertyIsNull",i.PropertyIsLessThan="PropertyIsLessThan",i.PropertyIsLessThanOrEqualTo="PropertyIsLessThanOrEqualTo",i.PropertyIsLike="PropertyIsLike",i.PropertyIsNotEqualTo="PropertyIsNotEqualTo",i.Within="Within",i.And="And",i.Or="Or",i.Not="Not",G;var i}(),jt=function(){function i(){var a;(0,h.Z)(this,i),this.filterSequence=[],this.operators=((0,de.Z)(a={},G.PropertyIsEqualTo,{spatial:!1,fieldRestrict:[]}),(0,de.Z)(a,G.PropertyIsNotEqualTo,{spatial:!1,fieldRestrict:[]}),(0,de.Z)(a,G.PropertyIsLike,{spatial:!1,fieldRestrict:["string"]}),(0,de.Z)(a,G.PropertyIsGreaterThan,{spatial:!1,fieldRestrict:["number"]}),(0,de.Z)(a,G.PropertyIsGreaterThanOrEqualTo,{spatial:!1,fieldRestrict:["number"]}),(0,de.Z)(a,G.PropertyIsLessThan,{spatial:!1,fieldRestrict:["number"]}),(0,de.Z)(a,G.PropertyIsLessThanOrEqualTo,{spatial:!1,fieldRestrict:["number"]}),(0,de.Z)(a,G.PropertyIsBetween,{spatial:!1,fieldRestrict:["number"]}),(0,de.Z)(a,G.During,{spatial:!1,fieldRestrict:[]}),(0,de.Z)(a,G.PropertyIsNull,{spatial:!1,fieldRestrict:[]}),(0,de.Z)(a,G.Intersects,{spatial:!0,fieldRestrict:[]}),(0,de.Z)(a,G.Within,{spatial:!0,fieldRestrict:[]}),(0,de.Z)(a,G.Contains,{spatial:!0,fieldRestrict:[]}),a)}return(0,v.Z)(i,[{key:"defineOgcFiltersDefaultOptions",value:function(n,t,o){var r=!0;return o&&"wms"===o&&(r=!1),(n=n||{}).enabled=void 0===n.enabled?r:n.enabled,n.editable=void 0===n.editable?r:n.editable,n.geometryName=t,n.advancedOgcFilters=!0,n.enabled&&(n.pushButtons||n.checkboxes||n.radioButtons||n.select||n.autocomplete)&&(n.advancedOgcFilters=!1),n}},{key:"buildFilter",value:function(n,t,o,r,s){var l,c;if(c=!/intersects|contains|within/gi.test(JSON.stringify(n)),n&&(r=void 0!==n.geometryName?n.geometryName:r),t&&n&&(l=Ct.VW(r,t,o.getCode())),!n)return"bbox="+t.join(",")+","+o.getCode();n=this.checkIgoFiltersProperties(n,r,o);var p={srsName:"",featureNS:"",featurePrefix:"",featureTypes:["featureTypes"],filter:t&&c?Ct.xD(l,this.bundleFilter(n,s)):this.bundleFilter(n,s),outputFormat:"",geometryName:r},d=(new Co.Z).writeGetFeature(p);return"filter="+(new XMLSerializer).serializeToString(d).split(/typenames *=|typename *=\"featureTypes\" *>/gi)[1].split(/<\/Query><\/GetFeature>/gi)[0]}},{key:"bundleFilter",value:function(n,t){var o=this;if(n instanceof Array){var r=[];return n.forEach(function(s){r.push(o.bundleFilter(s,t))}),r}return n.hasOwnProperty("logical")?this.createFilter({operator:n.logical,logicalArray:this.bundleFilter(n.filters,t)},t):n.hasOwnProperty("operator")?this.createFilter(n,t):void 0}},{key:"createFilter",value:function(n,t){var A,o=n.operator,r=n.logicalArray,s=n.propertyName,l=n.pattern,c=!n.matchCase||n.matchCase,u=n.wildCard?n.wildCard:"*",p=n.singleChar?n.singleChar:".",d=n.escapeChar?n.escapeChar:"!",g=n.lowerBoundary,f=n.upperBoundary,m=n.geometryName,y=n.extent,_=n.wkt_geometry,b=n.srsName?n.srsName:"EPSG:3857",w=this.parseFilterOptionDate(n.begin,t?t.minDate:void 0),T=this.parseFilterOptionDate(n.end,t?t.maxDate:void 0),M=n.expression;switch(_&&(A=(new Fi.Z).readGeometry(_,{dataProjection:b,featureProjection:b||"EPSG:3857"})),o.toLowerCase()){case G.BBOX.toLowerCase():return Ct.VW(m,y,b);case G.PropertyIsBetween.toLowerCase():return Ct.vX(s,g||-1e40,f||1e40);case G.Contains.toLowerCase():return Ct.r3(m,A,b);case G.During.toLowerCase():return Ct.Q9(s,w,T);case G.PropertyIsEqualTo.toLowerCase():return Ct.EW(s,M,c);case G.PropertyIsGreaterThan.toLowerCase():return Ct.tS(s,M);case G.PropertyIsGreaterThanOrEqualTo.toLowerCase():return Ct.wZ(s,M);case G.Intersects.toLowerCase():return Ct.kK(m,A,b);case G.PropertyIsNull.toLowerCase():return Ct.Ft(s);case G.PropertyIsLessThan.toLowerCase():return Ct.Qj(s,M);case G.PropertyIsLessThanOrEqualTo.toLowerCase():return Ct.MK(s,M);case G.PropertyIsLike.toLowerCase():return Ct.vL(s,l?l.replace(/[()_]/gi,p):u,u,p,d,c);case G.PropertyIsNotEqualTo.toLowerCase():return Ct.eI(s,M,c);case G.Within.toLowerCase():return Ct.uh(m,A,b);case G.And.toLowerCase():return Ct.xD.apply(null,r);case G.Or.toLowerCase():return Ct.or.apply(null,r);case G.Not.toLowerCase():return Ct.ff.apply(null,r);default:return}}},{key:"defineInterfaceFilterSequence",value:function(n,t){var o=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;return n instanceof Array?n.forEach(function(l){o.filterSequence.concat(o.defineInterfaceFilterSequence(l,t,r,s))}):n.hasOwnProperty("logical")?this.filterSequence.concat(this.defineInterfaceFilterSequence(n.filters,t,n.logical,s+=1)):n.hasOwnProperty("operator")&&this.filterSequence.push(this.addInterfaceFilter(n,t,s,r)),this.filterSequence}},{key:"computeAllowedOperators",value:function(n,t,o){var r,s,l,c,u,d,g,f,p={};if(n&&t){var m=n.find(function(y){return y.name===t});d=m&&m.allowedOperatorsType?m.allowedOperatorsType:o}switch(n&&n.map(function(y){if(y.allowedOperatorsType){var _=y.allowedOperatorsType.toLowerCase();(_===it.All.toLowerCase()||_===it.Spatial.toLowerCase()||_===it.BasicAndSpatial.toLowerCase())&&(g=!0,_===it.All.toLowerCase()&&(f=!0))}}),(d=d||it.BasicAndSpatial).toLowerCase()){case it.All:p=this.operators;break;case it.Spatial:(0,de.Z)(r={},G.Intersects,{spatial:!0,fieldRestrict:[]}),(0,de.Z)(r,G.Within,{spatial:!0,fieldRestrict:[]}),p=r;break;case it.BasicAndSpatial:(0,de.Z)(s={},G.PropertyIsEqualTo,{spatial:!1,fieldRestrict:[]}),(0,de.Z)(s,G.PropertyIsNotEqualTo,{spatial:!1,fieldRestrict:[]}),(0,de.Z)(s,G.Intersects,{spatial:!0,fieldRestrict:[]}),(0,de.Z)(s,G.Within,{spatial:!0,fieldRestrict:[]}),p=s;break;case it.Basic:(0,de.Z)(l={},G.PropertyIsEqualTo,{spatial:!1,fieldRestrict:[]}),(0,de.Z)(l,G.PropertyIsNotEqualTo,{spatial:!1,fieldRestrict:[]}),p=l;break;case it.Time:p=(0,de.Z)({},G.During,{spatial:!1,fieldRestrict:[]});break;case it.BasicNumericOperator:(0,de.Z)(c={},G.PropertyIsEqualTo,{spatial:!1,fieldRestrict:[]}),(0,de.Z)(c,G.PropertyIsNotEqualTo,{spatial:!1,fieldRestrict:[]}),(0,de.Z)(c,G.PropertyIsGreaterThan,{spatial:!1,fieldRestrict:["number"]}),(0,de.Z)(c,G.PropertyIsGreaterThanOrEqualTo,{spatial:!1,fieldRestrict:["number"]}),(0,de.Z)(c,G.PropertyIsLessThan,{spatial:!1,fieldRestrict:["number"]}),(0,de.Z)(c,G.PropertyIsLessThanOrEqualTo,{spatial:!1,fieldRestrict:["number"]}),p=c;break;default:(0,de.Z)(u={},G.PropertyIsEqualTo,{spatial:!1,fieldRestrict:[]}),(0,de.Z)(u,G.PropertyIsNotEqualTo,{spatial:!1,fieldRestrict:[]}),(0,de.Z)(u,G.Intersects,{spatial:!0,fieldRestrict:[]}),(0,de.Z)(u,G.Within,{spatial:!0,fieldRestrict:[]}),p=u}return g&&(p.Intersects={spatial:!0,fieldRestrict:[]},p.Within={spatial:!0,fieldRestrict:[]},f&&(p.Contains={spatial:!0,fieldRestrict:[]})),p}},{key:"addInterfaceFilter",value:function(n,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Or";n||(n={operator:"PropertyIsEqualTo"});var s={propertyName:"",operator:"",active:"",filterid:Ye(),step:"",begin:"",end:"",sliderOptions:{},lowerBoundary:"",upperBoundary:"",expression:"",pattern:"",wildCard:"*",singleChar:".",escapeChar:"!",matchCase:!0,igoSpatialSelector:"",igoSNRC:"",geometryName:"",geometry:"",wkt_geometry:"",extent:"",srsName:"",parentLogical:"",level:0};return Object.assign(s,{parentLogical:r,level:o,geometryName:t},n)}},{key:"checkIgoFiltersProperties",value:function(n,t,o){var r=this,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=[];return n instanceof Array?(n.forEach(function(c){l.push(r.checkIgoFiltersProperties(c,t,o,s))}),l):n.hasOwnProperty("logical")?Object.assign({},{logical:n.logical,filters:this.checkIgoFiltersProperties(n.filters,t,o,s)}):n.hasOwnProperty("operator")?this.addFilterProperties(n,t,o,s):void 0}},{key:"addFilterProperties",value:function(n,t,o){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=n.hasOwnProperty("filterid")?n.filterid:Ye(),l=n.hasOwnProperty("active")?n.active:r,c=n.hasOwnProperty("srsName")?n.srsName:o?o.getCode():"EPSG:3857";return Object.assign({},{filterid:s,active:l,igoSpatialSelector:"fixedExtent",srsName:c},n,{geometryName:t})}},{key:"rebuiltIgoOgcFilterObjectFromSequence",value:function(n){if(n instanceof Array&&n.length>=1){var o,s,t=n[0].parentLogical,r=[];return n.forEach(function(l){var c=Object.assign({},l),u=n.indexOf(l);o=u>=0&&u<n.length-1?n[u+1]:c,delete c.active,delete c.filterid,delete c.parentLogical,r.push(c),1===n.length?s=c:t!==o.parentLogical&&(1===r.length?console.log("You must set at least two operator in a logical ("+t+")"):(s=Object.assign({},{logical:t,filters:r}),r=[s],t=o.parentLogical))}),s}}},{key:"computeIgoSelector",value:function(n){if(n.groups.every(function(o){return void 0!==o.computedSelectors}))return n;var t;if(n.groups&&n.bundles){if(!n.bundles.every(function(o){return void 0!==o.id}))throw new Error("You must set an id for each of your bundles");(t=se.copyDeep(n)).groups.forEach(function(o){o.title=o.title?o.title:o.name,o.enabled=!!o.enabled&&o.enabled,o.computedSelectors=se.copyDeep(t.bundles.filter(function(r){return o.ids.includes(r.id)}))})}else!n.groups&&n.bundles?(t=se.copyDeep(n)).groups=[{title:"group1",name:"group1",computedSelectors:se.copyDeep(t.bundles)}]:t={bundles:n,groups:[{title:"group1",name:"group1",computedSelectors:se.copyDeep(n)}],selectorType:t.selectorType};return t.groups.find(function(o){return o.enabled})||(t.groups[0].enabled=!0),t}},{key:"handleOgcFiltersAppliedValue",value:function(n,t,o,r){var s=n.ogcFilters;if(s){var l=[],c="",u="";if(s.enabled&&(s.pushButtons||s.checkboxes||s.radioButtons||s.select||s.autocomplete)){if(s.pushButtons){var f,d=this.formatGroupAndFilter(s,s.pushButtons),g=(0,D.Z)(d);try{for(g.s();!(f=g.n()).done;)l.push(f.value)}catch(Ce){g.e(Ce)}finally{g.f()}}if(s.checkboxes){var b,y=this.formatGroupAndFilter(s,s.checkboxes),_=(0,D.Z)(y);try{for(_.s();!(b=_.n()).done;)l.push(b.value)}catch(Ce){_.e(Ce)}finally{_.f()}}if(s.radioButtons){var L,T=this.verifyMultipleEnableds(s.radioButtons),M=this.formatGroupAndFilter(s,T),A=(0,D.Z)(M);try{for(A.s();!(L=A.n()).done;)l.push(L.value)}catch(Ce){A.e(Ce)}finally{A.f()}}if(s.select){var Y,R=this.verifyMultipleEnableds(s.select),V=this.formatGroupAndFilter(s,R),P=(0,D.Z)(V);try{for(P.s();!(Y=P.n()).done;)l.push(Y.value)}catch(Ce){P.e(Ce)}finally{P.f()}}if(s.autocomplete){var Q,ue=this.formatGroupAndFilter(s,s.autocomplete),oe=(0,D.Z)(ue);try{for(oe.s();!(Q=oe.n()).done;)l.push(Q.value)}catch(Ce){oe.e(Ce)}finally{oe.f()}}l.length>=1&&(c=this.buildFilter(1===l.length?l[0]:{logical:"And",filters:l},o,r,s.geometryName))}s.enabled&&s.filters&&(s.geometryName=s.geometryName||t,u=this.buildFilter(s.filters,o,r,s.geometryName,n));var Me=s.advancedOgcFilters?u:c;return"wms"===n.type&&(Me=this.formatProcessedOgcFilter(Me,n.params.LAYERS)),"wfs"===n.type&&(Me=this.formatProcessedOgcFilter(Me,n.params.featureTypes)),Me}}},{key:"verifyMultipleEnableds",value:function(n){return n.bundles.forEach(function(t){if(!t.multiple&&t.selectors){var o=t.selectors.reduce(function(r,s,l){return!0===s.enabled?r.concat(l):r},[]);o.length>1&&(o.splice(0,1),o.forEach(function(r){t.selectors[r].enabled=!1}))}}),n}},{key:"formatGroupAndFilter",value:function(n,t){var o=(t=this.computeIgoSelector(t)).groups.find(function(s){return s.enabled}).computedSelectors,r=[];return o.map(function(s){var l=[],c=s.selectors;!c||(c.filter(function(u){return!0===u.enabled}).forEach(function(u){return l.push(u.filters)}),1===l.length?r.push(l[0]):l.length>1&&r.push({logical:s.logical,filters:l}))}),"pushButton"===t.selectorType?n.pushButtons=t:"checkbox"===t.selectorType?n.checkboxes=t:"radioButton"===t.selectorType?n.radioButtons=t:"select"===t.selectorType?n.select=t:"autocomplete"===t.selectorType&&(n.autocomplete=t),r}},{key:"formatProcessedOgcFilter",value:function(n,t){if(n){var o="";return 0===n.length&&-1===t.indexOf(",")?o=n:t.split(",").forEach(function(s){o="".concat(o,"(").concat(n.replace("filter=",""),")")}),(o=o.replace(/\(\)/g,"")).length>0?o.replace("filter=",""):void 0}}},{key:"parseFilterOptionDate",value:function(n,t){return n?"today"===n?void 0:H(n).isValid()?n:void 0:t}}]),i}(),vc="EPSG:3857",zo=5e3,yc="2.0.0",ds="geometry",_c=new RegExp(/(.*)?gml(.*)?/gi);function bc(i,a,n,t,o){var l,r=i.paramsWFS,s=gs(i,void 0,i.paramsWFS.srsName);t&&t.enabled&&(l=t.filters);var c=new jt,u=c.buildFilter(l,a,n,t.geometryName,i),p=c.handleOgcFiltersAppliedValue(i,t.geometryName,a,n),d="filter";p||(d="bbox",p=a.join(",")+","+n.getCode()),r.xmlFilter=t.advancedOgcFilters?u:"".concat(d,"=").concat(p);var g=s.find(function(m){return"getfeature"===m.name}).value;return g=/(filter|bbox)=.*/gi.test(r.xmlFilter)?"".concat(g,"&").concat(r.xmlFilter):g,i.download=Object.assign({},i.download,{dynamicUrl:g}),o&&(g+="$&_t".concat((new Date).getTime())),g.replace(/&&/g,"&")}function gs(i,a,n,t){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s="2.0.0",l=i.urlWfs,c=i.paramsWFS,u=a||zo,p=c.version===s?"startIndex=".concat(o):"",d=n||vc,g=c.outputFormat?"outputFormat=".concat(c.outputFormat):"",f="version=".concat(c.version?c.version:yc),m=c.version===s?"typenames":"typename",y="".concat(m,"=").concat(c.featureTypes),_=c.version===s?"count":"maxFeatures",b=a?"".concat(_,"=").concat(u):c.maxFeatures?"".concat(_,"=").concat(c.maxFeatures):"".concat(_,"=").concat(u);r&&(g="",f="version=1.1.0",b=b.replace("count","maxFeatures"));var w=n?"srsname=".concat(d):c.srsName?"srsname="+c.srsName:"srsname=".concat(d),T="",M="";t&&(T="propertyName=".concat(t),M="valueReference=".concat(t));var A=i.sourceFields;if(!T&&A&&A.length>0){var L=[];i.sourceFields.forEach(function(Y){L.push(Y.name)}),T="propertyName=".concat(L.join(","),",").concat(c.fieldNameGeometry)}var Z=-1===l.indexOf("?")?"?":"&",R="".concat(l).concat(Z,"service=WFS&request=GetCapabilities&").concat(f),V="".concat(l).concat(Z,"service=WFS&request=GetFeature&").concat(f,"&").concat(y,"&");V+="".concat(g,"&").concat(w,"&").concat(b,"&").concat(T,"&").concat(p);var P="".concat(l,"?service=WFS&request=GetPropertyValue&version=").concat(s,"&").concat(y,"&");return P+="&".concat(b,"&").concat(M),[{name:"outputformat",value:g},{name:"version",value:f},{name:"typename",value:y},{name:"count",value:b},{name:"srsname",value:w},{name:"propertyname",value:T},{name:"valuereference",value:M},{name:"getcapabilities",value:R.replace(/&&/g,"&")},{name:"getfeature",value:V.replace(/&&/g,"&")},{name:"getpropertyvalue",value:P.replace(/&&/g,"&")}]}function Cc(i,a){a&&"wfs"===a&&(i.paramsWFS=i.params);var t,n=i.paramsWFS;return i.urlWfs=i.urlWfs||i.url,n.version=n.version||yc,n.fieldNameGeometry=n.fieldNameGeometry||ds,n.maxFeatures=n.maxFeatures||zo,n.outputFormat&&(t=n.outputFormat),(_c.test(t)||!t)&&(n.version="1.1.0"),Object.assign({},i)}function fs(i){var n,a=i,t=a.paramsWFS.outputFormat?a.paramsWFS.outputFormat:void 0;return t?Fr[t]?new(n=Fr[t])(a.formatOptions):t.toLowerCase().match("gml2")?new(n=Co.Z)(Object.assign(Object.assign({},a.formatOptions),{gmlFormat:os.Z})):t.toLowerCase().match("gml32")?new(n=Co.Z)(Object.assign(Object.assign({},a.formatOptions),{gmlFormat:ev.Z})):t.toLowerCase().match("gml3")?new(n=Co.Z)(Object.assign(Object.assign({},a.formatOptions),{gmlFormat:nc.Z})):t.toLowerCase().match("topojson")?new(n=zh.Z)(a.formatOptions):t.toLowerCase().match("geojson")?new(n=Ee.Z)(a.formatOptions):t.toLowerCase().match("esrijson")?new(n=Zr.Z)(a.formatOptions):t.toLowerCase().match("json")?new(n=Ee.Z)(a.formatOptions):t.toLowerCase().match("gpx")?new(n=ts.Z)(a.formatOptions):t.toLowerCase().match("WKT")?new(n=Fi.Z)(a.formatOptions):t.toLowerCase().match("osmxml")?new(n=tv.Z)(a.formatOptions):t.toLowerCase().match("kml")?new(n=ns.ZP)(a.formatOptions):new n:new(n=Co.Z)(a.formatOptions)}var Je=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o,r,s,l){var c;return(0,h.Z)(this,n),(c=a.call(this,t,o,r)).messageService=o,c.authInterceptor=r,c.geoNetworkService=s,c.geoDBService=l,c.watcher=new Pv((0,kt.Z)(c)),c.status$=c.watcher.status$,c}return(0,v.Z)(n,[{key:"browsable",get:function(){return!1!==this.options.browsable}},{key:"exportable",get:function(){return!1!==this.options.exportable}},{key:"createOlLayer",value:function(){var o=this,r=Object.assign({},this.options,{source:this.options.source.ol});this.options.animation&&this.dataSource.ol.on("addfeature",function(d){this.flash(d.feature)}.bind(this)),this.options.trackFeature&&this.enableTrackFeature(this.options.trackFeature);var s=new zn.Z(r),l=s.getSource(),c=l.getUrl();if(c){var u,p=r.sourceOptions;(u="wfs"===(null==p?void 0:p.type)&&(p.params||p.paramsWFS)?function(g,f,m,y,_){o.customWFSLoader(l,p,o.authInterceptor,g,f,m,y,_)}:function(g,f,m,y,_){o.customLoader(l,c,o.authInterceptor,g,f,m,y,_)})&&l.setLoader(u)}return s}},{key:"flash",value:function(o){var r=(new Date).getTime(),s=this.ol.on("postrender",function l(c){var u=(0,Mi.u3)(c),p=c.frameState,d=o.getGeometry().clone(),g=p.time-r,f=g/this.options.animation.duration,m=(0,Yo.Vv)(1-f),y=(0,Wn._2)(this.options.animation.color||"red");y[3]=m;var _=this.ol.getStyleFunction().call(this,o).find(function(T){return T.getImage()});_||(_=this.ol.getStyleFunction().call(this,o)[0]);var b=_.clone();switch(o.getGeometry().getType()){case"Point":if(null!==b.getImage()&&"function"==typeof b.getImage().getRadius){var w=(0,Yo.Vv)(f)*(3*b.getImage().getRadius());b.getImage().setRadius(w),b.getImage().setOpacity(m)}break;case"LineString":b.getImage()&&(b.getImage().getStroke().setColor(y),b.getImage().getStroke().setWidth((0,Yo.Vv)(f)*(3*b.getImage().getStroke().getWidth()))),b.getStroke()&&(b.getStroke().setColor(y),b.getStroke().setWidth((0,Yo.Vv)(f)*(3*b.getStroke().getWidth())));break;case"Polygon":b.getImage()&&b.getImage().getFill().setColor(y),b.getFill()&&b.getFill().setColor(y)}if(b.setText(""),u.setStyle(b),u.drawGeometry(d),g>this.options.animation.duration)return(0,st.B)(s),void this.map.ol.render();this.map.ol.render()}.bind(this))}},{key:"setMap",value:function(o){void 0===o?this.watcher.unsubscribe():this.watcher.subscribe(function(){}),(0,Se.Z)((0,we.Z)(n.prototype),"setMap",this).call(this,o)}},{key:"setExtent",value:function(o){this.options.extent=o}},{key:"onUnwatch",value:function(){this.dataSource.onUnwatch(),this.stopAnimation()}},{key:"stopAnimation",value:function(){this.dataSource.ol.un("addfeature",function(o){this.visible&&this.flash(o.feature)}.bind(this))}},{key:"enableTrackFeature",value:function(o){this.trackFeatureListenerId=this.dataSource.ol.on("addfeature",this.trackFeature.bind(this,o))}},{key:"centerMapOnFeature",value:function(o){var r=this.dataSource.ol.getFeatureById(o);r&&this.map.ol.getView().setCenter(r.getGeometry().getCoordinates())}},{key:"trackFeature",value:function(o,r){r.feature.getId()===o&&this.visible&&this.centerMapOnFeature(o)}},{key:"disableTrackFeature",value:function(o){(0,st.B)(this.trackFeatureListenerId)}},{key:"customWFSLoader",value:function(o,r,s,l,c,u,p,d,g){var f=r.paramsWFS,m=f.srsName?new jo.Z({code:f.srsName}):u,y=re.$A(l,u,m);f.srsName=f.srsName||u.getCode();var _=bc(r,y,m,r.ogcFilters,g),b=0;if("2.0.0"===f.version&&f.maxFeatures>zo)for(var w=1e3;b<f.maxFeatures;){var T=_.replace("count="+f.maxFeatures,"count="+w);T=T.replace("startIndex=0","0"),(T+="&startIndex="+b).replace(/&&/g,"&"),this.getFeatures(o,s,y,m,u,T,w,p,d),b+=w}else this.getFeatures(o,s,y,m,u,_,f.maxFeatures,p,d)}},{key:"getFeatures",value:function(o,r,s,l,c,u,p,d,g){var f=this,m=this.dataSource.mostRecentIdCallOGCFilter,y=new XMLHttpRequest,_=r.alterUrlWithKeyAuth(u),b=u;_&&(b=_),y.open("GET",b),r&&r.interceptXhr(y,b);var w=function(){o.removeLoadedExtent(s),g()};y.onerror=w,y.onload=function(){if(200===y.status&&y.responseText.length>0){var T=o.getFormat().readFeatures(y.responseText,{dataProjection:l,featureProjection:c});m===f.dataSource.mostRecentIdCallOGCFilter?(o.addFeatures(T),d(T)):d([])}else w()},y.send()}},{key:"customLoader",value:function(o,r,s,l,c,u,p,d){var g=this,f=new XMLHttpRequest,m=r;if("function"!=typeof r){var y=s.alterUrlWithKeyAuth(r);y&&(m=y)}else m=r(l,c,u);if(this.geoNetworkService&&"function"!=typeof r){var b=o.getFormat().getType(),T=function(){o.removeLoadedExtent(l),d()},M={responseType:b};this.geoNetworkService.geoDBService.get(r).pipe((0,Vn.b)(function(Z){return Z?(0,ge.of)(Z):g.geoNetworkService.get(m,M).pipe((0,An.P)(),(0,Ze.K)(function(R){throw T(),R}))})).subscribe(function(Z){if(Z){var P,R=o.getFormat(),V=R.getType();if("json"===V||"text"===V?P=Z:"xml"===V?(P=Z)||(P=(new DOMParser).parseFromString(Z,"application/xml")):"arraybuffer"===V&&(P=Z),P){var Y=R.readFeatures(P,{extent:l,featureProjection:u});o.addFeatures(Y,R.readProjection(P)),p(Y)}else T()}})}else{f.open("GET",m);var A=o.getFormat();"arraybuffer"===A.getType()&&(f.responseType="arraybuffer"),s&&s.interceptXhr(f,m);var L=function(){o.removeLoadedExtent(l),d()};f.onerror=L,f.onload=function(){if(!f.status||f.status>=200&&f.status<300){var R,Z=A.getType();if("json"===Z||"text"===Z?R=f.responseText:"xml"===Z?(R=f.responseXML)||(R=(new DOMParser).parseFromString(f.responseText,"application/xml")):"arraybuffer"===Z&&(R=f.response),R){var V=A.readFeatures(R,{extent:l,featureProjection:u});o.addFeatures(V,A.readProjection(R)),p(V)}else L()}else L()},f.send()}}}]),n}(Or),Nv=(0,v.Z)(function i(){(0,h.Z)(this,i)}),Sc=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n,[{key:"createOlSource",value:function(){return this.options.url||(this.options.url="https://tile.openstreetmap.org/{z}/{x}/{y}.png"),new nv.Z(this.options)}},{key:"onUnwatch",value:function(){}}]),n}(on),ms=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n,[{key:"createOlSource",value:function(){return new ov.Z(this.options)}},{key:"onUnwatch",value:function(){}}]),n}(on),Wo=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o,r){var s;(0,h.Z)(this,n),(s=a.call(this,Cc(t,"wfs"))).options=t,s.wfsService=o,s.authInterceptor=r,s.mostRecentIdCallOGCFilter=0;var l=s.options.ogcFilters,c=s.options.paramsWFS.fieldNameGeometry||ds,u=new jt;return s.options.ogcFilters=u.defineOgcFiltersDefaultOptions(l,c),s.options.ogcFilters.enabled&&s.options.ogcFilters.editable&&(t.sourceFields||[]).filter(function(p){return!p.values}).length>0&&s.wfsService.getSourceFieldsFromWFS(s.options),null!=l&&l.pushButtons&&(l.pushButtons.selectorType="pushButton"),null!=l&&l.checkboxes&&(l.checkboxes.selectorType="checkbox"),null!=l&&l.radioButtons&&(l.radioButtons.selectorType="radioButton"),null!=l&&l.select&&(l.select.selectorType="select"),null!=l&&l.autocomplete&&(l.autocomplete.selectorType="autocomplete"),s.setOgcFilters(s.options.ogcFilters,!0),s}return(0,v.Z)(n,[{key:"ogcFilters",get:function(){return this.options.ogcFilters},set:function(o){this.options.ogcFilters=o}},{key:"createOlSource",value:function(){var o=this;return new nn.Z({format:fs(this.options),url:function(l,c,u){var p=o.options.paramsWFS,d=p.srsName?new jo.Z({code:p.srsName}):u,g=o.options.ogcFilters,f=re.$A(l,u,d);return p.srsName=p.srsName||u.getCode(),bc(o.options,f,d,g)},strategy:oc.VW})}},{key:"setOgcFilters",value:function(o){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.ogcFilters=o,this.mostRecentIdCallOGCFilter+=1,r&&this.ol.notify("ogcFilters",this.ogcFilters)}},{key:"onUnwatch",value:function(){}}]),n}(on),qv=function(){var i=function(a){(0,N.Z)(t,a);var n=(0,q.Z)(t);function t(o){var r;return(0,h.Z)(this,t),(r=n.call(this)).http=o,r}return(0,v.Z)(t,[{key:"getData",value:function(){return console.log("This is defining a data service."),"This is defining a data service."}},{key:"getSourceFieldsFromWFS",value:function(r){r.sourceFields&&0!==r.sourceFields.length?this.defineFieldAndValuefromWFS(r).subscribe(function(s){r.sourceFields.forEach(function(l){void 0===l.alias&&(l.alias=l.name),(void 0===l.values||0===l.values.length)&&(l.values=s.find(function(c){return c.name===l.name}).values)})}):(r.sourceFields=[],this.defineFieldAndValuefromWFS(r).subscribe(function(s){r.sourceFields=s}))}},{key:"wfsGetFeature",value:function(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zo,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vc,c=arguments.length>3?arguments[3]:void 0,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],d=gs(r,s,l,c,u,p),g=d.find(function(m){return"getfeature"===m.name}).value,f=r.paramsWFS.outputFormat;return p||_c.test(f)||!f?this.http.get(g,{responseType:"text"}):this.http.get(g)}},{key:"defineFieldAndValuefromWFS",value:function(r){var s=this;return new rt.y(function(l){var c,p,d,g,f,m,u=[];f=fs(r);var y=JSON.parse(JSON.stringify(r));delete y.paramsWFS.outputFormat,delete y.formatOptions,m=fs(y);var _=null===(c=r.sourceFields)||void 0===c?void 0:c.filter(function(b){return!b.values}).map(function(b){return b.name});s.wfsGetFeature(r,1,void 0,void 0,0,!0).pipe((0,Vn.b)(function(b){return String(b).toLowerCase().includes("exception")?(0,ge.of)(!1):(0,ge.of)(!0)}),(0,Vn.b)(function(b){return s.wfsGetFeature(r,1).pipe((0,Vn.b)(function(w){var T=f.readFeatures(w);p=T[0].getKeys(),(r.sourceFields||0===r.sourceFields.length)&&(_=p),d=p.filter(function(Z){return _.includes(Z)&&Z!==T[0].getGeometryName()&&!Z.match(/boundedby/gi)}),g=d.join(",");var M=[],A=0;if(!b&&"2.0.0"===r.paramsWFS.version&&r.paramsWFS.maxFeatures>zo){for(;A<r.paramsWFS.maxFeatures;)M.push(s.wfsGetFeature(r,1e3,r.paramsWFS.srsName,g,A)),A+=1e3;m=f}else M.push(s.wfsGetFeature(r,r.paramsWFS.maxFeatures||zo,r.paramsWFS.srsName,g,0,!0));return(0,dt.a)(M)}))})).subscribe(function(b){var w=[];b.map(function(T){var M=m.readFeatures(T);w=w.concat(M)}),s.built_properties_value(w).forEach(function(T){u.push(T)}),l.next(u),l.complete()})})}},{key:"built_properties_value",value:function(r){if(0===r.length)return[];var s=Object.assign({},r[0].getProperties());delete s[r[0].getGeometryName()],delete s.boundedBy;var l=[];for(var c in s)if(s.hasOwnProperty(c)){var u="object"==typeof r[0].get(c)?void 0:typeof r[0].get(c);l.push({name:c,alias:c,type:u,values:[s[c]]})}return r.every(function(p){var d=p.getProperties(),g=function(y){d.hasOwnProperty(y)&&y in s&&l.filter(function(_){return _.name===y}).forEach(function(_){-1===_.values.indexOf(d[y])&&_.values.push(d[y])})};for(var f in d)g(f);return!0}),l}}]),t}(Nv);return i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),Xe=function(){return(i=Xe||(Xe={})).GML2="gml2",i.GML3="gml3",i.JSON="json",i.GEOJSON="geojson",i.GEOJSON2="geojson2",i.ESRIJSON="esrijson",i.TEXT="text",i.HTML="html",i.HTMLGML2="htmlgml2",Xe;var i}(),rn=function(){return(i=rn||(rn={})).GML2="application/vnd.ogc.gml",i.GML3="application/vnd.ogc.gml/3.1.1",i.JSON="application/json",i.GEOJSON="application/geojson",i.GEOJSON2="geojson",i.ESRIJSON="application/json",i.TEXT="text/plain",i.HTML="text/html",i.HTMLGML2="text/html",rn;var i}(),fn=function(){return(i=fn||(fn={})).IFRAME="iframe",i.BLANK="_blank",fn;var i}(),Ht=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o){var r;(0,h.Z)(this,n),(r=a.call(this,t)).options=t,r.wfsService=o,r.timeFilter$=new x.X(void 0);var s=t.params,l=s.DPI||96;s.DPI=l,s.MAP_RESOLUTION=l,s.FORMAT_OPTIONS="dpi:"+l,t.refreshIntervalSec&&t.refreshIntervalSec>0&&setInterval(function(){r.refresh()},1e3*t.refreshIntervalSec);var c=ds;if(t.paramsWFS){var u=Cc(t,"wms");se.mergeDeep(t.paramsWFS,u.paramsWFS),c=t.paramsWFS.fieldNameGeometry||c,t.download=Object.assign({},t.download,{dynamicUrl:r.buildDynamicDownloadUrlFromParamsWFS(t)})}t.sourceFields&&0!==t.sourceFields.length?t.sourceFields.forEach(function(y){y.alias=y.alias?y.alias:y.name}):t.sourceFields=[];var p=t.ogcFilters,d=new jt;p?(p.advancedOgcFilters=!(p.pushButtons||p.checkboxes||p.radioButtons||p.select||p.autocomplete),p.advancedOgcFilters&&p.filters&&p.filters.calendarModeYear&&(p.advancedOgcFilters=!1),p.pushButtons&&(p.pushButtons.selectorType="pushButton"),p.checkboxes&&(p.checkboxes.selectorType="checkbox"),p.radioButtons&&(p.radioButtons.selectorType="radioButton"),p.select&&(p.select.selectorType="select"),p.autocomplete&&(p.autocomplete.selectorType="autocomplete")):t.ogcFilters=d.defineOgcFiltersDefaultOptions(p,c,"wms"),s.LAYERS.split(",").length>1&&p&&p.enabled&&(console.log("*******************************"),console.log("BE CAREFULL, YOUR WMS LAYERS ("+s.LAYERS+") MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! "),console.log("*******************************")),t.paramsWFS&&p&&p.enabled&&p.editable&&(t.sourceFields||[]).filter(function(y){return!y.values}).length>0&&r.wfsService.getSourceFieldsFromWFS(t);var f=d.handleOgcFiltersAppliedValue(t,c);return s.FILTER=f,r.ol.updateParams({FILTER:s.FILTER}),r.setOgcFilters(p,!0),(null==t?void 0:t.timeFilterable)&&(null==t?void 0:t.timeFilter)&&r.setTimeFilter(t.timeFilter,!0),r}return(0,v.Z)(n,[{key:"params",get:function(){return this.options.params}},{key:"queryTitle",get:function(){return this.options.queryTitle?this.options.queryTitle:"title"}},{key:"mapLabel",get:function(){return this.options.mapLabel}},{key:"queryHtmlTarget",get:function(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:fn.BLANK}},{key:"ogcFilters",get:function(){return this.options.ogcFilters},set:function(o){this.options.ogcFilters=o}},{key:"timeFilter",get:function(){return this.options.timeFilter},set:function(o){this.options.timeFilter=o}},{key:"refresh",value:function(){this.ol.updateParams({igoRefresh:Math.random()})}},{key:"buildDynamicDownloadUrlFromParamsWFS",value:function(o){return gs(o).find(function(l){return"getfeature"===l.name}).value}},{key:"createOlSource",value:function(){return new iv.Z(Object.assign({ratio:1},this.options))}},{key:"setOgcFilters",value:function(o){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.ogcFilters=o,r&&this.ol.notify("ogcFilters",this.ogcFilters)}},{key:"setTimeFilter",value:function(o){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.timeFilter=o,r&&(this.timeFilter$.next(this.timeFilter),this.ol.notify("timeFilter",this.ogcFilters))}},{key:"getLegend",value:function(o,r){var s=(0,Se.Z)((0,we.Z)(n.prototype),"getLegend",this).call(this);if(s.length>0&&void 0===o&&(null==r||!r.scale))return s;var c,l=!1;(null==r?void 0:r.size)&&(null==r?void 0:r.extent)&&(null==r?void 0:r.projection)&&this.options.contentDependentLegend&&(c="1.3.0"===this.params.VERSION||void 0===this.params.VERSION?"CRS":"SRS",l=!0);var u=this.params,p=[];void 0!==u.LAYERS&&(p=u.LAYERS.split(","));var d=this.options.url.replace(/\?$/,""),g=["REQUEST=GetLegendGraphic","SERVICE=WMS","FORMAT=image/png","SLD_VERSION=1.1.0","VERSION=".concat(u.VERSION||"1.3.0")];return void 0!==o&&g.push("STYLE=".concat(o)),void 0!==(null==r?void 0:r.scale)&&g.push("SCALE=".concat(r.scale)),l&&(g.push("WIDTH=".concat(r.size[0])),g.push("HEIGHT=".concat(r.size[1])),g.push("BBOX=".concat(r.extent.join(","))),g.push("".concat(c,"=").concat(r.projection))),p.map(function(f){var m=d.match(/\?/)?"&":"?";return{url:"".concat(d).concat(m).concat(g.join("&"),"&LAYER=").concat(f),title:p.length>1?f:void 0,currentStyle:void 0===o?void 0:o}})}},{key:"onUnwatch",value:function(){}}]),n}(on);function Gv(i){for(var n=re.U2(i||"EPSG:3857").getExtent(),t=(0,Ke.dz)(n)/256,o=new Array(20),r=new Array(20),s=0;s<20;++s)o[s]=t/Math.pow(2,s),r[s]=s;return new rv.Z({origin:(0,Ke.rL)(n),resolutions:o,matrixIds:r})}var hs=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t){return(0,h.Z)(this,n),a.call(this,t)}return(0,v.Z)(n,[{key:"createOlSource",value:function(){var o=Object.assign({tileGrid:Gv(this.options.projection)},this.options);return new ic.Z(o)}},{key:"onUnwatch",value:function(){}}]),n}(on),Dr=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n,[{key:"params",get:function(){return this.options.params}},{key:"queryTitle",get:function(){return this.options.queryTitle?this.options.queryTitle:"title"}},{key:"mapLabel",get:function(){return this.options.mapLabel}},{key:"queryHtmlTarget",get:function(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:fn.BLANK}},{key:"createOlSource",value:function(){var r=Object.assign({crossOrigin:this.options.crossOrigin?this.options.crossOrigin:"anonymous"},this.options);return new av.Z(r)}},{key:"getLegend",value:function(){var o=(0,Se.Z)((0,we.Z)(n.prototype),"getLegend",this).call(this);if(o.length>0)return o;var r="<table>";if(null!==this.options.config.layers[0].legend)return this.options.config.layers[0].legend.items.forEach(function(b){!0===b.visible&&(r+='<tr><td><p><font size="5" color="'+b.value+'"> &#9679</font></p></td><td>'+b.name+"</td></tr>")}),[{html:r+="</table>"}];for(var s=this.options.config.layers[0].options,c=0,u=["polygon-fill:","marker-fill:","shield-fill:","building-fill:","line-color:"];c<u.length;c++){var p=u[c];if(s.cartocss.includes(p)){var d=s.cartocss.split(p).pop(),g=d.substr(0,d.indexOf(";"));if(g.includes("ramp")){for(var f=g.split(", (")[1].split(","),m=g.split(", (")[2].split(","),y=0;y<f.length;y++)f[y]=f[y].replace(/("|\))/g,""),m[y]=m[y].replace(/("|\))/g,""),"="===m[y].replace(/\s+/g,"")&&(m[y]="Autres"),r+='<tr><td><p><font size="5" color="'+f[y]+'"> &#9679</font></p></td><td>'+m[y]+"</td></tr>";break}r+='<tr><td><p><font size="5" color="'+g+'"> &#9679</font></p></td><td>'+(s.layer_name?s.layer_name:"")+"</td></tr>";break}}return[{html:r+="</table>"}]}},{key:"onUnwatch",value:function(){}}]),n}(on),vs=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n,[{key:"createOlSource",value:function(){var o=new Zr.Z;return new nn.Z({attributions:this.options.params.attributions,overlaps:!1,format:o,url:function(r,s,l){var c=this.options.url+"/"+this.options.layer+"/query/",u=encodeURIComponent('{"xmin":'+r[0]+',"ymin":'+r[1]+',"xmax":'+r[2]+',"ymax":'+r[3]+',"spatialReference":{"wkid":102100}}'),p=["f=json","geometry=".concat(u),"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"];if(this.options.params.time){var d="time=".concat(this.options.params.time);p.push(d)}return this.options.params.customParams&&this.options.params.customParams.forEach(function(g){p.push(g)}),"".concat(c,"?").concat(p.join("&"))}.bind(this),strategy:oc.VW})}},{key:"getLegend",value:function(){var o=this.options.legendInfo,r=(0,Se.Z)((0,we.Z)(n.prototype),"getLegend",this).call(this);if(void 0===o||r.length>0)return r;if(o){var c,s="<table>";if(o.legend){var d,p=(0,D.Z)(o.legend);try{for(p.s();!(d=p.n()).done;){var g=d.value;s+="<tr><td align='left'><img src=\""+this.htmlImgSrc(g.contentType,g.imageData)+'" alt =\'\' /></td><td class="mat-typography">'+(c=g.label?g.label.replace("<Null>","Null"):"")+"</td></tr>"}}catch(_){p.e(_)}finally{p.f()}}else if("uniqueValue"===o.type){var m,f=(0,D.Z)(o.uniqueValueInfos);try{for(f.s();!(m=f.n()).done;){var y=m.value;c=y.label.replace("<Null>","Null"),"esriPMS"===y.symbol.type?s+="<tr><td align='left'><img src=\""+this.htmlImgSrc(y.symbol.contentType,y.symbol.imageData)+'" alt =\'\' /></td><td class="mat-typography">'+c+"</td></tr>":"esriPMS"!==y.symbol.type&&(s+="<tr><td align='left'>"+this.createSVG(y.symbol)+'</td><td class="mat-typography">'+c+"</td></tr>")}}catch(_){f.e(_)}finally{f.f()}}else"simple"===o.type&&(c=o.label?o.label.replace("<Null>","Null"):"","esriPMS"===o.symbol.type?s+="<tr><td align='left'><img src=\""+this.htmlImgSrc(o.symbol.contentType,o.symbol.imageData)+'" alt =\'\' /></td><td class="mat-typography">'+c+"</td></tr>":"esriPMS"!==o.symbol.type&&(s+="<tr><td align='left'>"+this.createSVG(o.symbol)+'</td><td class="mat-typography">'+c+"</td></tr>"));return[{html:s+="</table>"}]}}},{key:"htmlImgSrc",value:function(o,r){return"data:".concat(o,";base64,").concat(r)}},{key:"createSVG",value:function(o){var r="",s=o.color?o.color:[0,0,0,0];if("esriSLS"===o.type){var c="stroke:rgba("+s[0]+","+s[1]+","+s[2]+","+s[3]+")",u="stroke-width:"+(o.width?o.width:0);"esriSLSSolid"===o.style?r='<svg height="30" width="30"><line x1="0" y1="15" x2="30" y2="15" style="'+c+";"+u+'"/></svg>':"esriSLSDash"===o.style&&(r='<svg height="30" width="30"><line x1="0" y1="15" x2="30" y2="15" style="'+c+";"+u+'" stroke-dasharray="5,5"/></svg>')}else if("esriSMSCircle"===o.style||"esriSFSSolid"===o.style){var d=o.outline.color,m="stroke:rgba("+d[0]+","+d[1]+","+d[2]+","+d[3]+")",y="stroke-width:"+o.outline.width,_="fill:rgba("+s[0]+","+s[1]+","+s[2]+","+s[3]+")";r="esriSMSCircle"===o.style?'<svg height="30" width="30"><circle cx="15" cy="15" r="'+o.size/2+'" style="'+m+";"+y+";"+_+'"/></svg>':'<svg height="30" width="30"><rect x="5" y="5" width="20" height="20" style ="'+m+";"+y+";"+_+'"/></svg>'}return r}},{key:"onUnwatch",value:function(){}}]),n}(on),ys=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n,[{key:"params",get:function(){return this.options.params}},{key:"queryTitle",get:function(){return this.options.queryTitle?this.options.queryTitle:"title"}},{key:"mapLabel",get:function(){return this.options.mapLabel}},{key:"queryHtmlTarget",get:function(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:fn.BLANK}},{key:"createOlSource",value:function(){var o=void 0===this.options.layer?this.options.params:Object.assign({LAYERS:"show:".concat(this.options.layer)},this.options.params);return"object"==typeof o.renderingRule&&(o.renderingRule=JSON.stringify(o.renderingRule)),new sv.Z({ratio:1,params:o,url:this.options.url})}},{key:"getLegend",value:function(){var o=this.options.legendInfo,r=(0,Se.Z)((0,we.Z)(n.prototype),"getLegend",this).call(this);if(void 0===o||void 0===this.options.layer||r.length>0)return r;if(o){var c,s="<table>",l=(0,D.Z)(o.legend);try{for(l.s();!(c=l.n()).done;){var u=c.value;s+="<tr><td align='left'><img src=\""+"".concat(this.options.url,"/").concat(o.layerId,"/images/").concat(u.url)+'" alt =\'\' /></td><td class="mat-typography">'+u.label.replace("<Null>","Null")+"</td></tr>"}}catch(g){l.e(g)}finally{l.f()}return[{html:s+="</table>"}]}}},{key:"onUnwatch",value:function(){}}]),n}(on),Di=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n,[{key:"params",get:function(){return this.options.params}},{key:"queryTitle",get:function(){return this.options.queryTitle?this.options.queryTitle:"title"}},{key:"mapLabel",get:function(){return this.options.mapLabel}},{key:"queryHtmlTarget",get:function(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:fn.BLANK}},{key:"createOlSource",value:function(){return new lv.Z(this.options)}},{key:"getLegend",value:function(){var o=this.options.legendInfo,r=(0,Se.Z)((0,we.Z)(n.prototype),"getLegend",this).call(this);if(void 0===o||void 0===this.options.layer||r.length>0)return r;if(o){var c,s="<table>",l=(0,D.Z)(o.legend);try{for(l.s();!(c=l.n()).done;){var u=c.value;s+="<tr><td align='left'><img src=\""+"".concat(this.options.url,"/").concat(o.layerId,"/images/").concat(u.url)+'" alt =\'\' /></td><td class="mat-typography">'+u.label.replace("<Null>","Null")+"</td></tr>"}}catch(g){l.e(g)}finally{l.f()}return[{html:s+="</table>"}]}}},{key:"onUnwatch",value:function(){}}]),n}(on),wc=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n,[{key:"createOlSource",value:function(){var o=JSON.parse(JSON.stringify(this.options));return this.options.tileGrid&&(delete o.tileGrid,o.tileGrid=new uv.Z(this.options.tileGrid)),new cv.Z(o)}},{key:"onUnwatch",value:function(){}}]),n}(on),Tc=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n,[{key:"createOlSource",value:function(){return this.createWebSocket(),this.options.format=this.getSourceFormatFromOptions(this.options),(0,Se.Z)((0,we.Z)(n.prototype),"createOlSource",this).call(this)}},{key:"createWebSocket",value:function(){this.ws=new WebSocket(this.options.url),this.ws.onmessage=this.onMessage.bind(this),this.options.onclose&&(this.ws.onclose=this.onClose.bind(this)),this.options.onerror&&(this.ws.onerror=this.onError.bind(this)),this.options.onopen&&(this.ws.onopen=this.onOpen.bind(this))}},{key:"onMessage",value:function(o){var r=this.options.format.readFeature(o.data);switch(this.options.onmessage){case"update":var s=this.ol.getFeatureById(r.getId());s&&this.ol.removeFeature(s),this.ol.addFeature(r);break;case"delete":this.ol.clear(!0),this.ol.addFeature(r);break;default:this.ol.addFeature(r)}}},{key:"onClose",value:function(o){}},{key:"onError",value:function(o){}},{key:"onOpen",value:function(o){}},{key:"onUnwatch",value:function(){this.ws.close()}}]),n}(Re),_s=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n,[{key:"createOlSource",value:function(){var o;return o="feature"===this.options.featureClass?new ac.Z({featureClass:nt.Z}):new ac.Z,this.options.format=o,new rc.Z(this.options)}},{key:"generateId",value:function(){return this.options.url?wn.V.hashStr("mvt"+this.options.url):Ye()}},{key:"onUnwatch",value:function(){}}]),n}(on),Qv=function(){function i(){(0,h.Z)(this,i),this._converters={},this._converters.esriPMS=i._convertEsriPMS,this._converters.esriSFS=i._convertEsriSFS,this._converters.esriSLS=i._convertEsriSLS,this._converters.esriSMS=i._convertEsriSMS,this._converters.esriTS=i._convertEsriTS,this._renderers={},this._renderers.uniqueValue=this._renderUniqueValue,this._renderers.simple=this._renderSimple,this._renderers.classBreaks=this._renderClassBreaks}return(0,v.Z)(i,[{key:"_convertLabelingInfo",value:function(n,t){for(var o=[],r=0,s=n.length;r<s;++r){var l=n[r].labelExpression,c=l.substr(l.indexOf("[")+1,l.indexOf("]")-1),u=n[r].symbol,p=n[r].maxScale,d=n[r].minScale,g=null;0!==p&&(g=i._getResolutionForScale(p,t));var f=null;0!==d&&(f=i._getResolutionForScale(d,t));var m=this._converters[u.type].call(this,u);o.push(function(y,_){var b=!0;if(null!==this.minResolution&&null!==this.maxResolution?b=_<this.maxResolution&&_>=this.minResolution:null!==this.minResolution?b=_>=this.minResolution:null!==this.maxResolution&&(b=_<this.maxResolution),b){var w=y.get(this.field);return this.style.getText().setText(w),[this.style]}}.bind({minResolution:g,maxResolution:f,field:c,style:m}))}return o}},{key:"_renderSimple",value:function(n){var t=this._converters[n.symbol.type].call(this,n.symbol);return function(){return[t]}}},{key:"_renderClassBreaks",value:function(n){for(var t=n.defaultSymbol,o=this._converters[t.type].call(this,t),r=n.field,s=[],l=0,c=n.classBreakInfos.length;l<c;++l){var p,u=n.classBreakInfos[l];p=null==u.classMinValue?0===l?n.minValue:n.classBreakInfos[l-1].classMaxValue:u.classMinValue;var d=u.classMaxValue,g=u.symbol,f=this._converters[g.type].call(this,g);s.push({min:p,max:d,style:f})}return function(m){for(var y=m.get(r),_=0,b=s.length;_<b;++_)if(0===_?y>=s[_].min&&y<=s[_].max:y>s[_].min&&y<=s[_].max)return[s[_].style];return[o]}}},{key:"_renderUniqueValue",value:function(n){var t=n.defaultSymbol,o=[];t&&(o=[this._converters[t.type].call(this,t)]);var r=n.field1,s=n.uniqueValueInfos,l=this;return function(){for(var c={},u=0,p=s.length;u<p;++u){var d=s[u],g=d.symbol;c[d.value]=[l._converters[g.type].call(l,g)]}return function(f){return c[f.get(r)]||o}}()}},{key:"generateStyle",value:function(n,t){var o=n.drawingInfo,r=[],s=this._renderers[o.renderer.type].call(this,o.renderer);if(void 0!==s&&r.push(s),n.labelingInfo){var l=this._convertLabelingInfo(n.labelingInfo,t);r=r.concat(l)}return 1===r.length?r[0]:function(c,u){for(var p=[],d=0,g=r.length;d<g;++d){var f=r[d].call(null,c,u);f&&(p=p.concat(f))}return p}}}],[{key:"_convertPointToPixel",value:function(n){return n/.75}},{key:"_transformColor",value:function(n){return[n[0],n[1],n[2],n[3]/255]}},{key:"_getResolutionForScale",value:function(n,t){var r=re.Wm[t];return parseFloat(n)/(39.3701*r*96)}},{key:"_convertEsriTS",value:function(n){var t=i._transformAngle(n.angle),o=void 0!==n.text?n.text:void 0;return new ee.ZP({text:new Lt.Z({fill:new te.Z({color:i._transformColor(n.color)}),font:n.font.style+" "+n.font.weight+" "+n.font.size+" px "+n.font.family,textBaseline:n.verticalAlignment,textAlign:n.horizontalAlignment,offsetX:i._convertPointToPixel(n.xoffset),offsetY:i._convertPointToPixel(n.yoffset),rotation:t,text:o})})}},{key:"_convertEsriPMS",value:function(n){var t="data:"+n.contentType+";base64, "+n.imageData,o=i._transformAngle(n.angle);return new ee.ZP({image:new bo.Z({src:t,rotation:o})})}},{key:"_convertEsriSFS",value:function(n){var t=new te.Z({color:i._transformColor(n.color)}),o=n.outline?i._convertOutline(n.outline):void 0;return new ee.ZP({fill:t,stroke:o})}},{key:"_convertOutline",value:function(n){var t,o=i._transformColor(n.color);return"esriSLSDash"===n.style?t=[5]:"esriSLSDashDot"===n.style?t=[5,5,1,2]:"esriSLSDashDotDot"===n.style?t=[5,5,1,2,1,2]:"esriSLSDot"===n.style?t=[1,2]:"esriSLSNull"===n.style&&(o[3]=0),new K.Z({color:o,lineDash:t,width:i._convertPointToPixel(n.width)})}},{key:"_convertEsriSLS",value:function(n){return new ee.ZP({stroke:i._convertOutline(n)})}},{key:"_transformAngle",value:function(n){if(0!==n&&void 0!==n){var o=-n*Math.PI/180+Math.PI/2;return o<0?2*Math.PI+o:o}}},{key:"_convertEsriSMS",value:function(n){var t=new te.Z({color:i._transformColor(n.color)}),o=n.outline?i._convertOutline(n.outline):void 0,r=i._convertPointToPixel(n.size)/2,s=i._transformAngle(n.angle);return"esriSMSCircle"===n.style?new ee.ZP({image:new Ue.Z({radius:r,fill:t,stroke:o})}):"esriSMSCross"===n.style?new ee.ZP({image:new Qo.Z({fill:t,stroke:o,points:4,radius:r,radius2:0,angle:0,rotation:s})}):"esriSMSDiamond"===n.style?new ee.ZP({image:new Qo.Z({fill:t,stroke:o,points:4,radius:r,rotation:s})}):"esriSMSSquare"===n.style?new ee.ZP({image:new Qo.Z({fill:t,stroke:o,points:4,radius:r,angle:Math.PI/4,rotation:s})}):"esriSMSX"===n.style?new ee.ZP({image:new Qo.Z({fill:t,stroke:o,points:4,radius:r,radius2:0,angle:Math.PI/4,rotation:s})}):"esriSMSTriangle"===n.style?new ee.ZP({image:new Qo.Z({fill:t,stroke:o,points:3,radius:r,angle:0,rotation:s})}):void 0}}]),i}(),lt=function(){return(i=lt||(lt={})).DATE="date",i.TIME="time",i.DATETIME="datetime",i.YEAR="year",lt;var i}(),Jt=function(){return(i=Jt||(Jt={})).CALENDAR="calendar",i.SLIDER="slider",Jt;var i}(),Vt=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,[{key:"getMap",value:function(){return this.map}},{key:"setMap",value:function(t){this.map=t}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),Ko=function(){return(i=Ko||(Ko={})).wms="wms",i.wmts="wmts",i.arcgisrest="esriJSON",i.imagearcgisrest="esriJSON",i.tilearcgisrest="esriJSON",Ko;var i}(),Pr=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.http=n,this.mapService=t,this.parsers={wms:new Wh.Z,wmts:new Kh.Z,esriJSON:new Zr.Z}}return(0,v.Z)(a,[{key:"getWMSOptions",value:function(t){var o=this;return this.getCapabilities("wms",t.url,t.params.VERSION).pipe((0,U.U)(function(l){return l?o.parseWMSOptions(t,l):void 0}))}},{key:"getWMTSOptions",value:function(t){var o=this;return this.getCapabilities("wmts",t.url,t.version).pipe((0,U.U)(function(c){return c?o.parseWMTSOptions(t,c):void 0}))}},{key:"getCartoOptions",value:function(t){var o=this;return this.http.jsonp("https://"+t.account+".carto.com/api/v2/viz/"+t.mapId+"/viz.json","callback").pipe((0,U.U)(function(s){return o.parseCartoOptions(t,s)}))}},{key:"getArcgisOptions",value:function(t){var o=this,r=t.url+"/"+t.layer+"?f=json",s=this.getCapabilities("arcgisrest",t.url),l=this.http.get(r);return(0,un.D)([l,s]).pipe((0,U.U)(function(c){return o.parseArcgisOptions(t,c[0],c[1])}))}},{key:"getImageArcgisOptions",value:function(t){var o=this,r=t.url+"/"+t.layer+"?f=json",s=t.url+"/legend?f=json",l=this.getCapabilities("imagearcgisrest",t.url),c=this.http.get(r),u=this.http.get(s).pipe((0,U.U)(function(p){return p}),(0,Ze.K)(function(p){return console.log("No legend associated with this Image Service"),(0,ge.of)(p)}));return(0,un.D)([c,u,l]).pipe((0,U.U)(function(p){return o.parseTileOrImageArcgisOptions(t,p[0],p[1],p[2])}))}},{key:"getTileArcgisOptions",value:function(t){var o=this,r=t.url+"/"+t.layer+"?f=json",s=t.url+"/legend?f=json",l=this.getCapabilities("tilearcgisrest",t.url),c=this.http.get(r),u=this.http.get(s).pipe((0,U.U)(function(p){return p}),(0,Ze.K)(function(p){return console.log("No legend associated with this Tile Service"),(0,ge.of)(p)}));return(0,un.D)([c,u,l]).pipe((0,U.U)(function(p){return o.parseTileOrImageArcgisOptions(t,p[0],p[1],p[2])}))}},{key:"getCapabilities",value:function(t,o,r){var s=this,l=new W.LE({fromObject:{request:"GetCapabilities",service:t.toUpperCase(),version:r||"1.3.0",_i:"true"}});return("esriJSON"===Ko[t]?this.http.get(o+"?f=json"):this.http.get(o,{params:l,responseType:"text"})).pipe((0,U.U)(function(u){if("esriJSON"===Ko[t])return u;if(String(u).toLowerCase().includes("serviceexception")&&String(u).toLowerCase().includes("access denied"))throw{error:{message:"Service error getCapabilities: Access is denied"}};return s.parsers[t].read(u)}),(0,Ze.K)(function(u){throw void 0!==u.error&&(u.error.caught=!0),u}))}},{key:"parseWMSOptions",value:function(t,o){var s=this.findDataSourceInCapabilities(o.Capability.Layer,t.params.LAYERS);if(!s)throw{error:{message:"Layer not found"}};var l=s.DataURL?s.DataURL[0]:void 0,c=s.Abstract?s.Abstract:void 0,u=s.KeywordList?s.KeywordList:void 0,p=s.queryable,d=this.getTimeFilter(s),g=d&&Object.keys(d).length>0,f=s.Style?this.getStyle(s.Style):void 0,m=!0;s.EX_GeographicBoundingBox?s.EX_GeographicBoundingBox.forEach(function(Z,R){R<2&&(Z>180||Z<-180)&&(m=!1),R>=2&&(Z>90||Z<-90)&&(m=!1)}):m=!1;for(var _,y=m?re.$A(s.EX_GeographicBoundingBox,"EPSG:4326",this.mapService.getMap().projection):void 0,w=function(){var R=M[T];if(-1!==o.Capability.Request.GetFeatureInfo.Format.indexOf(R)){var V=Object.keys(rn).find(function(P){return rn[P]===R});return _=Xe[V],"break"}},T=0,M=[rn.GEOJSON,rn.GEOJSON2,rn.GML3,rn.GML2,rn.JSON,rn.HTML];T<M.length&&"break"!==w();T++);_||(p=!1);var L=se.removeUndefined({_layerOptionsFromSource:{title:s.Title,maxResolution:Zt(s.MaxScaleDenominator),minResolution:Zt(s.MinScaleDenominator),extent:y,metadata:{url:l?l.OnlineResource:void 0,extern:!!l||void 0,abstract:c,keywordList:u},legendOptions:f},queryable:p,queryFormat:_,timeFilter:g?d:void 0,timeFilterable:!!g||void 0,minDate:g?d.min:void 0,maxDate:g?d.max:void 0,stepDate:g?d.step:void 0});return se.mergeDeep(L,t)}},{key:"parseWMTSOptions",value:function(t,o){var r=o.Contents.Layer.find(function(u){return u.Identifier===t.layer}),s=(0,ic.B)(o,t),l=Object.assign(s,t),c=se.removeUndefined({_layerOptionsFromSource:{title:r.Title}});return se.mergeDeep(c,l)}},{key:"parseCartoOptions",value:function(t,o){var r=[],s=o.layers[1].options.layer_definition;s.layers.forEach(function(c){r.push({type:c.type.toLowerCase(),options:c.options,legend:c.legend})});var l=se.removeUndefined({config:{version:s.version,layers:r}});return se.mergeDeep(l,t)}},{key:"parseArcgisOptions",value:function(t,o,r){var s,c,u,l=o.name;c=null!==(s=o.drawingInfo)&&void 0!==s&&s.renderer?o.drawingInfo.renderer:void 0,o.drawingInfo&&(u=(new Qv).generateStyle(o,"esriMeters"===o.units?"m":"degrees"));var f,m,g=new Mr.Z({target:o.copyrightText});if(o.timeInfo){var y=o.timeInfo.timeExtent;f=y[0]+","+y[1];var _=new Date;_.setTime(y[0]);var b=new Date;b.setTime(y[1]),m={min:_.toUTCString(),max:b.toUTCString(),range:!0,type:lt.DATETIME,style:Jt.CALENDAR}}var w=Object.assign({},{style:u,LAYERS:t.layer?"show:"+t.layer:void 0,time:f}),T=se.removeUndefined({params:w,_layerOptionsFromSource:{title:l,minResolution:Zt(o.maxScale),maxResolution:Zt(o.minScale),metadata:{extern:!1,abstract:o.description||r.serviceDescription}},legendInfo:c,timeFilter:m,sourceFields:o.fields,queryTitle:o.displayField});return T.attributions=g,se.mergeDeep(T,t)}},{key:"parseTileOrImageArcgisOptions",value:function(t,o,r,s){var p,d,l=o.name,c=r.layers?r.layers.find(function(b){return b.layerName===l}):void 0,u=new Mr.Z({target:o.copyrightText});if(o.timeInfo){var g=o.timeInfo.timeExtent;p=g[0]+","+g[1];var f=new Date;f.setTime(g[0]);var m=new Date;m.setTime(g[1]),d={min:f.toUTCString(),max:m.toUTCString(),range:!0,type:lt.DATETIME,style:Jt.CALENDAR}}var y=Object.assign({},{LAYERS:t.layer?"show:"+t.layer:void 0,time:p}),_=se.removeUndefined({params:y,_layerOptionsFromSource:{title:l,minResolution:Zt(o.maxScale),maxResolution:Zt(o.minScale),metadata:{extern:!1,abstract:o.description||s.serviceDescription}},legendInfo:c,timeFilter:d,sourceFields:o.fields,queryTitle:o.displayField});return _.attributions=u,se.mergeDeep(_,t)}},{key:"findDataSourceInCapabilities",value:function(t,o){var s,r=this;return Array.isArray(t)?(t.find(function(l){return void 0!==(s=r.findDataSourceInCapabilities(l,o))},this),s):t.Layer?this.findDataSourceInCapabilities(t.Layer,o):t.Name&&t.Name===o?t:void 0}},{key:"getTimeFilter",value:function(t){var o;if(t.Dimension){var r={};if((o=t.Dimension[0]).values){var s=o.values.split("/");r.min=void 0!==s[0]?s[0]:void 0,r.max=void 0!==s[1]?s[1]:void 0,r.step=void 0!==s[2]?s[2]:void 0}return o.default&&(r.value=o.default),r}}},{key:"getStyle",value:function(t){return{stylesAvailable:t.map(function(s){return{name:s.Name,title:s.Title}}).filter(function(s,l,c){return c.findIndex(function(u){return u.name===s.name})===l})}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG(Vt))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),(0,ne.gn)([(0,$t.q)({maxCacheCount:20})],i.prototype,"getArcgisOptions",null),(0,ne.gn)([(0,$t.q)({maxCacheCount:20})],i.prototype,"getImageArcgisOptions",null),(0,ne.gn)([(0,$t.q)({maxCacheCount:20})],i.prototype,"getTileArcgisOptions",null),(0,ne.gn)([(0,$t.q)({maxCacheCount:20})],i.prototype,"getCapabilities",null),i}(),xc=(0,v.Z)(function i(){(0,h.Z)(this,i)}),Pi=function(){var i=function(){function a(n){var t=this;(0,h.Z)(this,a),this.config=n,(this.config.getConfig("projections")||[]).forEach(function(m){m.alias=m.alias?m.alias:m.code,t.registerProjection(m)});for(var r=1;r<61;r++){var s=r<10?"EPSG:3260".concat(r):"EPSG:326".concat(r),l="+proj=utm +zone=".concat(r," +datum=WGS84 +units=m +no_defs");this.registerProjection({code:s,def:l,extent:void 0})}for(var u=1;u<11;u++){var d,p=u<10?"EPSG:3218".concat(u):"EPSG:321".concat(80+u);d=Number(u)<=2?-50-3*Number(u):Number(u)>=12?-81-3*(Number(u)-12):-49.5-3*Number(u);var g="+proj=tmerc +lat_0=0 +lon_0=".concat(d,' +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"');this.registerProjection({code:p,def:g,extent:void 0})}}return(0,v.Z)(a,[{key:"registerProjection",value:function(t){es.Z.defs(t.code,t.def),Wl.z(es.Z),t.extent&&re.U2(t.code).setExtent(t.extent)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(j))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),Et=function(){var i=function(){function a(n,t,o,r,s,l,c){(0,h.Z)(this,a),this.capabilitiesService=n,this.optionsService=t,this.wfsDataSourceService=o,this.languageService=r,this.messageService=s,this.projectionService=l,this.authInterceptor=c,this.datasources$=new x.X([])}return(0,v.Z)(a,[{key:"createAsyncDataSource",value:function(t,o){if(!t.type)throw console.error(t),new Error("Datasource needs a type");var r;switch(t.type.toLowerCase()){case"osm":r=this.createOSMDataSource(t);break;case"vector":r=this.createFeatureDataSource(t);break;case"wfs":r=this.createWFSDataSource(t);break;case"wms":var s=t;se.removeDuplicateCaseInsensitive(s.params),r=this.createWMSDataSource(s,o);break;case"wmts":r=this.createWMTSDataSource(t);break;case"xyz":r=this.createXYZDataSource(t);break;case"tiledebug":r=this.createTileDebugDataSource(t);break;case"carto":r=this.createCartoDataSource(t);break;case"arcgisrest":r=this.createArcGISRestDataSource(t,o);break;case"imagearcgisrest":r=this.createArcGISRestImageDataSource(t,o);break;case"websocket":r=this.createWebSocketDataSource(t);break;case"mvt":r=this.createMVTDataSource(t);break;case"tilearcgisrest":r=this.createTileArcGISRestDataSource(t,o);break;case"cluster":r=this.createClusterDataSource(t);break;default:throw console.error(t),new Error("Invalid datasource type")}return this.datasources$.next(this.datasources$.value.concat([r])),r}},{key:"createOSMDataSource",value:function(t){return new rt.y(function(o){return o.next(new Sc(t))})}},{key:"createFeatureDataSource",value:function(t){return new rt.y(function(o){return o.next(new Re(t))})}},{key:"createWebSocketDataSource",value:function(t){return new rt.y(function(o){return o.next(new Tc(t))})}},{key:"createWFSDataSource",value:function(t){var o=this;return new rt.y(function(r){return r.next(new Wo(t,o.wfsDataSourceService,o.authInterceptor))})}},{key:"createWMSDataSource",value:function(t,o){var r=this,s=[];return t.optionsFromCapabilities&&s.push(this.capabilitiesService.getWMSOptions(t).pipe((0,Ze.K)(function(l){var c=r.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),u=r.languageService.translate.instant("igo.geo.dataSource.unavailable",{value:t.params.LAYERS});throw r.messageService.error(u,c),l}))),this.optionsService&&!0===t.optionsFromApi&&s.push(this.optionsService.getWMSOptions(t,o).pipe((0,Ze.K)(function(l){return l.error.toDisplay=!0,l.error.title=r.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),l.error.message=r.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,ge.of)({})}))),s.push((0,ge.of)(t)),(0,un.D)(s).pipe((0,U.U)(function(l){var c=l.reduce(function(u,p){return se.mergeDeep(u,p)});return new Ht(c,r.wfsDataSourceService)}),(0,Ze.K)(function(){return(0,ge.of)(void 0)}))}},{key:"createWMTSDataSource",value:function(t){var o=this;return t.optionsFromCapabilities?this.capabilitiesService.getWMTSOptions(t).pipe((0,U.U)(function(r){return r?new hs(r):void 0}),(0,Ze.K)(function(){var r=o.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),s=o.languageService.translate.instant("igo.geo.dataSource.unavailable",{value:t.layer});return o.messageService.error(s,r),(0,ge.of)(void 0)})):new rt.y(function(r){return r.next(new hs(t))})}},{key:"createXYZDataSource",value:function(t){return new rt.y(function(o){return o.next(new ms(t))})}},{key:"createTileDebugDataSource",value:function(t){return new rt.y(function(o){return o.next(new wc(t))})}},{key:"createCartoDataSource",value:function(t){return t.mapId?this.capabilitiesService.getCartoOptions(t).pipe((0,U.U)(function(o){return new Dr(o)})):new rt.y(function(o){return o.next(new Dr(t))})}},{key:"createArcGISRestDataSource",value:function(t,o){var r=this,s=[];return s.push(this.capabilitiesService.getArcgisOptions(t).pipe((0,Ze.K)(function(l){var c=r.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),u=r.languageService.translate.instant("igo.geo.dataSource.unavailable",{value:t.layer});throw r.messageService.error(u,c),l}))),this.optionsService&&!0===t.optionsFromApi&&s.push(this.optionsService.getArcgisRestOptions(t,o).pipe((0,Ze.K)(function(l){return l.error.toDisplay=!0,l.error.title=r.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),l.error.message=r.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,ge.of)({})}))),s.push((0,ge.of)(t)),(0,un.D)(s).pipe((0,U.U)(function(l){var c=l.reduce(function(u,p){return se.mergeDeep(u,p)});return new vs(c)}),(0,Ze.K)(function(){return(0,ge.of)(void 0)}))}},{key:"createArcGISRestImageDataSource",value:function(t,o){var r=this,s=[];return s.push(this.capabilitiesService.getImageArcgisOptions(t).pipe((0,Ze.K)(function(l){var c=r.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),u=r.languageService.translate.instant("igo.geo.dataSource.unavailable",{value:t.params.LAYERS});throw r.messageService.error(u,c),l}))),this.optionsService&&!0===t.optionsFromApi&&s.push(this.optionsService.getArcgisRestOptions(t,o).pipe((0,Ze.K)(function(l){return l.error.toDisplay=!0,l.error.title=r.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),l.error.message=r.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,ge.of)({})}))),s.push((0,ge.of)(t)),(0,un.D)(s).pipe((0,U.U)(function(l){var c=l.reduce(function(u,p){return se.mergeDeep(u,p)});return new ys(c)}),(0,Ze.K)(function(){return(0,ge.of)(void 0)}))}},{key:"createTileArcGISRestDataSource",value:function(t,o){var r=this,s=[];return s.push(this.capabilitiesService.getImageArcgisOptions(t).pipe((0,Ze.K)(function(l){var c=r.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),u=r.languageService.translate.instant("igo.geo.dataSource.unavailable",{value:t.params.LAYERS});throw r.messageService.error(u,c),l}))),this.optionsService&&!0===t.optionsFromApi&&s.push(this.optionsService.getArcgisRestOptions(t,o).pipe((0,Ze.K)(function(l){return l.error.toDisplay=!0,l.error.title=r.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),l.error.message=r.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,ge.of)({})}))),s.push((0,ge.of)(t)),(0,un.D)(s).pipe((0,U.U)(function(l){var c=l.reduce(function(u,p){return se.mergeDeep(u,p)});return new Di(c)}),(0,Ze.K)(function(){return(0,ge.of)(void 0)}))}},{key:"createMVTDataSource",value:function(t){return new rt.y(function(o){return o.next(new _s(t))})}},{key:"createClusterDataSource",value:function(t){return new rt.y(function(o){return o.next(new gn(t))})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(Pr),e.LFG(xc,8),e.LFG(qv),e.LFG($),e.LFG(Ae),e.LFG(Pi),e.LFG(xr))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function At(i,a,n){n=n||cr;var o=(new Ee.Z).readFeature(i,{dataProjection:i.projection,featureProjection:a});o.setId(n(i));var r=en(i);void 0!==r&&o.set("_title",r,!0),void 0!==i.extent&&o.set("_extent",i.extent,!0),void 0!==i.projection&&o.set("_projection",i.projection,!0);var s=fo(i,"meta.mapTitle");void 0!==s&&o.set("_mapTitle",s,!0),o.set("_entityRevision",function Tl(i){return(i.meta||{}).revision||0}(i),!0);var l=ur(i);return void 0!==l&&o.set("_icon",l,!0),i.meta&&i.meta.style&&o.set("_style",i.meta.style,!0),i.sourceId&&o.set("_sourceId",i.sourceId,!0),o}function To(i,a,n){var o,r,s,l,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"EPSG:4326",c=new Ee.Z,u=i.getKeys().filter(function(_){return!_.startsWith("_")&&"geometry"!==_}),p=u.reduce(function(_,b){return _[b]=i.get(b),_},{}),d=c.writeGeometryObject(i.getGeometry(),{dataProjection:t,featureProjection:a});if(n){o=n.get("title");var g=n.get("sourceOptions");g&&(r=g.excludeAttribute,s=g.excludeAttributeOffline,l=g.idColumn||("arcgisrest"===g.type||"tilearcgisrest"===g.type?"OBJECTID":void 0))}else o=i.get("_title");var f=i.get("_mapTitle"),m=i.getId()?i.getId():i.get(l)?i.get(l):Ye();return i.get("_newFeature"),{type:be,projection:t,extent:i.get("_extent"),meta:{id:m,title:o||f||m,mapTitle:f,revision:i.getRevision(),style:i.get("_style"),excludeAttribute:r,excludeAttributeOffline:s},properties:p,geometry:d,ol:i}}function Er(i,a){var n=Ke.lJ();return a.forEach(function(t){var o=function Vv(i,a){var n=Ke.lJ(),t=a.get("_extent"),o=a.get("_projection");if(void 0!==t&&void 0!==o)n=re.$A(t,o,i.projection);else{var r=a.getGeometry();null!==r&&(n=r.getExtent())}return n}(i,t);Ke.l7(n,o)}),n}function kc(i,a){var n=Ke.ap(i),t=(0,Qe.Z)(n,2),o=t[0],r=t[1];return[a[3]?i[0]-o*a[3]:i[0],a[2]?i[1]-r*a[2]:i[1],a[1]?i[2]+o*a[1]:i[2],a[0]?i[3]+r*a[0]:i[3]]}function Mc(i,a){var r=kc(i.viewController.getExtent(),[-1,-1,-1,-1].map(function(s){return.05*s}));return!Ke.r4(r,a)}function Fc(i,a,n){n=n||.004;var t=i.viewController.getExtent(),o=Ke.bg(t),r=Ke.bg(a);return!(0===r&&i.viewController.getZoom()>13)&&r/o<n}function mn(i,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ce.Default,t=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,r=Er(i,a),s=r;void 0!==t&&(s=kc(s,t)),n===ce.Zoom?i.viewController.zoomToExtent(s):n===ce.Move?i.viewController.moveToExtent(s):n===ce.Default&&(Mc(i,r)||Fc(i,r,o))&&i.viewController.zoomToExtent(s)}function xo(i,a){void 0===i.layer?(a=a||new Je({source:new Re}),i.bindLayer(a),void 0===i.layer.map&&i.map.addLayer(i.layer)):void 0===i.layer.map&&i.map.addLayer(i.layer)}function zv(i,a){var n=new Map;a.forEach(function(s){n.set(s.getId(),s)});var t=[];i.forEach(function(s){var l=n.get(s.getId());void 0===l||l.get("_entityRevision")!==s.get("_entityRevision")?t.push(s):n.delete(l.getId())});var o=Array.from(n.keys());return{add:a.filter(function(s){return o.indexOf(s.getId())>=0}),remove:t}}var Dt=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o){var r;return(0,h.Z)(this,n),(r=a.call(this,t,o)).map=o.map,r}return(0,v.Z)(n,[{key:"source",get:function(){return this.layer?this.layer.dataSource:void 0}},{key:"bindLayer",value:function(o){return this.layer=o,this}},{key:"setLayerFeatures",value:function(o){var r=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ce.Default,l=arguments.length>2?arguments[2]:void 0,c=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0;u=u||cr,this.checkLayer();var p=o.map(function(d){return At(d,r.map.projection,u)});this.setLayerOlFeatures(p,s,l,c)}},{key:"setStoreOlFeatures",value:function(o){var r=this;this.checkLayer();var s=o.map(function(l){return l.set("_featureStore",r,!0),To(l,r.layer.map.projection)});this.load(s)}},{key:"clearLayer",value:function(){this.checkLayer(),this.source.ol.clear()}},{key:"checkLayer",value:function(){if(void 0===this.layer)throw new Error("This FeatureStore is not bound to a layer.")}},{key:"setLayerOlFeatures",value:function(o){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ce.Default,s=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0,c=this.layer.ol.getSource(),u=zv(c.getFeatures(),o);u.remove.length>0&&this.removeOlFeaturesFromLayer(u.remove),u.add.length>0&&this.addOlFeaturesToLayer(u.add),u.add.length>0?mn(this.map,u.add,r,s,l):u.remove.length>0&&mn(this.map,o,r,s,l)}},{key:"setLayerExtent",value:function(){var o=this,r=this.entities$.getValue(),s=Ke.lJ(),l=[];r.forEach(function(u){l.push(At(u,o.map.projection))});var c=Er(this.map,l);Ke.l7(s,c),this.layer.setExtent(s)}},{key:"addOlFeaturesToLayer",value:function(o){var r=this;o.forEach(function(s){s.set("_featureStore",r,!0)}),this.source.ol.addFeatures(o)}},{key:"removeOlFeaturesFromLayer",value:function(o){var r=this;o.forEach(function(s){r.source.ol.removeFeature(s)})}}]),n}(mt),Xo=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t){var o;return(0,h.Z)(this,n),(o=a.call(this,t)).options=t,o.stores$$=new Map,o.states$$=[],o}return(0,v.Z)(n,[{key:"bindStore",value:function(o){var r=this;(0,Se.Z)((0,we.Z)(n.prototype),"bindStore",this).call(this,o),!0===this.active&&this.watchStore(o),this.empty$$=o.empty$.pipe((0,Nt.n)(function(s){return!s})).subscribe(function(){return r.updateEntitiesInExtent(o)})}},{key:"unbindStore",value:function(o){(0,Se.Z)((0,we.Z)(n.prototype),"unbindStore",this).call(this,o),!0===this.active&&this.unwatchStore(o)}},{key:"doActivate",value:function(){var o=this;this.stores.forEach(function(r){return o.watchStore(r)})}},{key:"doDeactivate",value:function(){this.unwatchAll()}},{key:"watchStore",value:function(o){var r=this;this.stores$$.has(o)||(this.updateEntitiesInExtent(o),this.states$$.push(o.layer.map.viewController.state$.subscribe(function(){r.updateEntitiesInExtent(o)})))}},{key:"updateEntitiesInExtent",value:function(o){var r,s;if(null!==(s=null===(r=null==o?void 0:o.layer)||void 0===r?void 0:r.map)&&void 0!==s&&s.viewController){o.state.updateAll({inMapExtent:!1});var d,l=o.layer.map.viewController.getExtent(),c=[],u=[],p=(0,D.Z)(o.entities$.value);try{for(p.s();!(d=p.n()).done;){var g=d.value;g.ol?Ke.kK(g.ol.getGeometry().getExtent(),l)&&c.push(g):u.push(g)}}catch(f){p.e(f)}finally{p.f()}c.length>0&&o.state.updateMany(c,{inMapExtent:!0},!1),u.length>0&&o.state.updateMany(u,{inMapExtent:!0},!1)}}},{key:"unwatchStore",value:function(o){void 0!==this.stores$$.get(o)&&this.stores$$.delete(o)}},{key:"unwatchAll",value:function(){this.stores$$.clear(),this.states$$.map(function(o){return o.unsubscribe()}),this.empty$$&&this.empty$$.unsubscribe()}}]),n}(mo),$r=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t){var o;return(0,h.Z)(this,n),(o=a.call(this,t)).options=t,o.stores$$=new Map,o.resolution$$=[],o}return(0,v.Z)(n,[{key:"bindStore",value:function(o){var r=this;(0,Se.Z)((0,we.Z)(n.prototype),"bindStore",this).call(this,o),!0===this.active&&this.watchStore(o),this.empty$$=o.empty$.subscribe(function(){return r.updateEntitiesInResolution(o,o.layer.map.viewController.getResolution())})}},{key:"unbindStore",value:function(o){(0,Se.Z)((0,we.Z)(n.prototype),"unbindStore",this).call(this,o),!0===this.active&&this.unwatchStore(o)}},{key:"doActivate",value:function(){var o=this;this.stores.forEach(function(r){return o.watchStore(r)})}},{key:"doDeactivate",value:function(){this.unwatchAll()}},{key:"watchStore",value:function(o){var r=this;this.stores$$.has(o)||(this.updateEntitiesInResolution(o,o.layer.map.viewController.getResolution()),this.resolution$$.push(o.layer.map.viewController.resolution$.subscribe(function(s){r.updateEntitiesInResolution(o,s)})))}},{key:"updateEntitiesInResolution",value:function(o,r){o.state.updateAll(r>o.layer.minResolution&&r<o.layer.maxResolution?{inMapResolution:!0}:{inMapResolution:!1})}},{key:"unwatchStore",value:function(o){void 0!==this.stores$$.get(o)&&this.stores$$.delete(o)}},{key:"unwatchAll",value:function(){this.stores$$.clear(),this.resolution$$.map(function(o){return o.unsubscribe()}),this.empty$$&&this.empty$$.unsubscribe()}}]),n}(mo),an=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t){var o;return(0,h.Z)(this,n),(o=a.call(this,t)).options=t,o.stores$$=new Map,o.setMotion(t.motion),o}return(0,v.Z)(n,[{key:"bindStore",value:function(o){(0,Se.Z)((0,we.Z)(n.prototype),"bindStore",this).call(this,o),!0===this.active&&this.watchStore(o)}},{key:"unbindStore",value:function(o){(0,Se.Z)((0,we.Z)(n.prototype),"unbindStore",this).call(this,o),!0===this.active&&this.unwatchStore(o)}},{key:"setMotion",value:function(o){this.motion=o}},{key:"doActivate",value:function(){var o=this;this.stores.forEach(function(r){return o.watchStore(r)})}},{key:"doDeactivate",value:function(){this.unwatchAll()}},{key:"watchStore",value:function(o){var r=this;if(!this.stores$$.has(o)){var s=o.view.all$().subscribe(function(l){return r.onFeaturesChange(l,o)});this.stores$$.set(o,s)}}},{key:"unwatchStore",value:function(o){var r=this.stores$$.get(o);void 0!==r&&(r.unsubscribe(),this.stores$$.delete(o))}},{key:"unwatchAll",value:function(){Array.from(this.stores$$.entries()).forEach(function(o){o[1].unsubscribe()}),this.stores$$.clear()}},{key:"onFeaturesChange",value:function(o,r){0===o.length?r.clearLayer():r.setLayerFeatures(o,this.selectMotion(r),this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)}},{key:"selectMotion",value:function(o){return void 0!==this.motion?this.motion:!0===o.pristine||o.count>o.view.count?ce.Default:ce.None}}]),n}(mo),Rr=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t){var o;return(0,h.Z)(this,n),(o=a.call(this,t)).options=t,o.stores$$=new Map,o}return(0,v.Z)(n,[{key:"bindStore",value:function(o){(0,Se.Z)((0,we.Z)(n.prototype),"bindStore",this).call(this,o),!0===this.active&&this.watchStore(o)}},{key:"unbindStore",value:function(o){(0,Se.Z)((0,we.Z)(n.prototype),"unbindStore",this).call(this,o),!0===this.active&&this.unwatchStore(o)}},{key:"doActivate",value:function(){var o=this;this.stores.forEach(function(r){return o.watchStore(r)})}},{key:"doDeactivate",value:function(){this.unwatchAll()}},{key:"watchStore",value:function(o){var r=this;this.stores$$.has(o)||(this.onSourceChanges(o),o.layer.ol.getSource().on("change",function(l){r.onSourceChanges(o)}))}},{key:"unwatchStore",value:function(o){void 0!==this.stores$$.get(o)&&this.stores$$.delete(o)}},{key:"unwatchAll",value:function(){Array.from(this.stores$$.entries()).forEach(function(o){}),this.stores$$.clear()}},{key:"onSourceChanges",value:function(o){var r=o.layer.ol.getSource().getFeatures();o.layer.dataSource instanceof gn&&(r=r.flatMap(function(s){return s.get("features")})),0===r.length?o.clear():o.setStoreOlFeatures(r)}}]),n}(mo),Jr=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t){return(0,h.Z)(this,n),a.call(this,t)}return(0,v.Z)(n)}(sc.Z),Bt=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t){var o;return(0,h.Z)(this,n),(o=a.call(this,t)).options=t,o.setMotion(t.motion),o._overlayStore=o.createOverlayStore(),o}return(0,v.Z)(n,[{key:"map",get:function(){return this.options.map}},{key:"overlayStore",get:function(){return this._overlayStore}},{key:"bindStore",value:function(o){(0,Se.Z)((0,we.Z)(n.prototype),"bindStore",this).call(this,o),!0===this.active&&this.activate()}},{key:"unbindStore",value:function(o){(0,Se.Z)((0,we.Z)(n.prototype),"unbindStore",this).call(this,o),!0===this.active&&this.activate()}},{key:"setMotion",value:function(o){this.motion=o}},{key:"unselectAll",value:function(){this.stores.forEach(function(o){o.state.updateAll({selected:!1})})}},{key:"clear",value:function(){this.overlayStore.source.ol.clear(),this.overlayStore.clear()}},{key:"deactivateSelection",value:function(){this.unlistenToMapClick(),this.removeDragBoxInteraction(),this.unwatchAll()}},{key:"doActivate",value:function(){this.addOverlayLayer(),this.listenToMapClick(),!0===this.options.dragBox&&this.addDragBoxInteraction(),this.watchAll()}},{key:"doDeactivate",value:function(){this.deactivateSelection(),this.removeOverlayLayer()}},{key:"watchAll",value:function(){var o=this;this.unwatchAll();var r=this.stores.map(function(s){return s.stateView.manyBy$(function(l){return!0===l.state.selected}).pipe((0,U.U)(function(l){return l.map(function(c){return c.entity})}))});this.stores$$=(0,dt.a)(r).pipe((0,De.b)(5),(0,uo.T)(1),(0,U.U)(function(s){return s.reduce(function(l,c){return l.concat(c)})})).subscribe(function(s){return o.onSelectFromStore(s)})}},{key:"unwatchAll",value:function(){void 0!==this.stores$$&&this.stores$$.unsubscribe()}},{key:"listenToMapClick",value:function(){var o=this;this.mapClickListener=this.map.ol.on("singleclick",function(r){o.onMapClick(r)})}},{key:"unlistenToMapClick",value:function(){(0,st.B)(this.mapClickListener)}},{key:"onMapClick",value:function(o){var r=this,s=!Lr(o),l=!s,c=o.map.getFeaturesAtPixel(o.pixel,{hitTolerance:this.options.hitTolerance||0,layerFilter:function(p){return void 0!==r.stores.find(function(g){var f;return(null===(f=g.layer)||void 0===f?void 0:f.ol)===p})}});this.onSelectFromMap(c,s,l)}},{key:"addDragBoxInteraction",value:function(){var r,c,o=this,s=this.map.ol.getInteractions().getArray(),l=(0,D.Z)(s);try{for(l.s();!(c=l.n()).done;){var u=c.value;if(u instanceof Jr){r=u;break}}}catch(p){l.e(p)}finally{l.f()}void 0===r&&(r=new Jr({condition:Lr}),this.map.ol.addInteraction(r),this.olDragSelectInteraction=r),this.olDragSelectInteractionEndKey=r.on("boxend",function(p){return o.onDragBoxEnd(p)})}},{key:"removeDragBoxInteraction",value:function(){void 0!==this.olDragSelectInteractionEndKey&&(0,st.B)(this.olDragSelectInteractionEndKey),void 0!==this.olDragSelectInteraction&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=void 0}},{key:"onDragBoxEnd",value:function(o){var r=!Lr(o.mapBrowserEvent),l=o.target.getGeometry().getExtent(),c=this.stores.reduce(function(u,p){var d=p.layer.ol.getSource();return u.push.apply(u,(0,Fe.Z)(d.getFeaturesInExtent(l))),u},[]);this.onSelectFromMap(c,r,!1)}},{key:"onSelectFromStore",value:function(o){var u,r=this.motion,l=this.overlayStore.layer.ol.getSource().getFeatures().map(function(p){return p.getId()}),c=o.map(this.overlayStore.getKey);u=0!==o.length&&(l.length!==c.length||!l.every(function(p){return c.indexOf(p)>=0})),this.overlayStore.setLayerFeatures(o,u?r:ce.None,this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)}},{key:"onSelectFromMap",value:function(o,r,s){var l=this,c=this.groupFeaturesByStore(o);this.stores.forEach(function(u){var p=c.get(u);void 0===p&&!0===r?l.unselectAllFeaturesFromStore(u):void 0===p&&!1===r||l.selectFeaturesFromStore(u,p,r,s)})}},{key:"selectFeaturesFromStore",value:function(o,r,s,l){!0===l?o.state.reverseMany(r,["selected"]):o.state.updateMany(r,{selected:!0},s)}},{key:"unselectAllFeaturesFromStore",value:function(o){o.state.updateAll({selected:!1})}},{key:"groupFeaturesByStore",value:function(o){var r=new Map;return null==o||o.forEach(function(s){var l=s.get("_featureStore");if(void 0!==l){var c=r.get(l);void 0===c&&r.set(l,c=[]);var u=l.get(s.getId());void 0!==u&&c.push(u)}}),r}},{key:"createOverlayStore",value:function(){var o=this.options.layer?this.options.layer:this.createOverlayLayer();return new Dt([],{map:this.map}).bindLayer(o)}},{key:"createOverlayLayer",value:function(){return new Je({zIndex:300,source:new Re,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1})}},{key:"addOverlayLayer",value:function(){void 0===this.overlayStore.layer.map&&this.map.addLayer(this.overlayStore.layer)}},{key:"removeOverlayLayer",value:function(){this.overlayStore.source.ol.clear(),this.map.removeLayer(this.overlayStore.layer)}}]),n}(mo);function Ei(i,a){void 0===i.getStrategyOfType(an)?(a=a||new an({}),i.addStrategy(a),a.activate()):i.activateStrategyOfType(an)}function Zc(i,a){void 0===i.getStrategyOfType(Bt)?(a=a||new Bt({map:i.map}),i.addStrategy(a),a.activate()):i.activateStrategyOfType(Bt)}function no(){var d,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=i.text,n=i.opacity,t=void 0===n?1:n,o=i.markerColor,r=void 0===o?[0,161,222]:o,s=i.markerOutlineColor,l=void 0===s?[255,255,255]:s,g=/msie\s|trident\/|edge\//i.test(window.navigator.userAgent),f=(0,Wn._2)(r).slice(0),m=(0,Wn._2)(l).slice(0);if(4===f.length&&("string"!=typeof r||/^#[0-9A-F]{8}$/i.test(r))&&(t=f[3]),r,d='data:image/svg+xml;utf8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" height="36" width="36" viewBox="0 0 36 36"><path fill='+'"rgba('.concat(f[0],",").concat(f[1],",").concat(f[2],",").concat(t,')"')+" stroke="+'"rgb('.concat(m[0],",").concat(m[1],",").concat(m[2],')"')+' stroke-width="2" d="M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z"></path></svg>',g)switch(r){case"blue":default:"blue";break;case"red":"red";break;case"yellow":"yellow";break;case"green":"green"}return new ee.ZP({image:new bo.Z({src:d,opacity:t,imgSize:[36,36],anchor:[.5,.92]}),text:new Lt.Z({text:a,font:"12px Calibri,sans-serif",fill:new te.Z({color:"#000"}),stroke:new K.Z({color:"#fff",width:3}),overflow:!0})})}var xn=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,[{key:"createStyle",value:function(t,o,r){var s,l,c,u;if(!t)return no();if("function"==typeof t||t instanceof ee.ZP)return t;var p=this.parseStyle("style",t);if(p.getText()){var d=0,g=1/0;if(t.text){var f=null!==(s=t.text)&&void 0!==s&&s.minScaleDenom?Zt(Number(t.text.minScaleDenom)):void 0,m=null!==(l=t.text)&&void 0!==l&&l.maxScaleDenom?Zt(Number(t.text.maxScaleDenom)):void 0,y=null!==(c=t.text)&&void 0!==c&&c.minResolution?t.text.minResolution:0,_=null!==(u=t.text)&&void 0!==u&&u.maxResolution?t.text.maxResolution:1/0;d=f||y,g=m||_}o&&r>=d&&r<=g?o&&t.text.attribute&&p.getText().setText(this.getLabel(o,t.text.attribute)):p.setText()}return p}},{key:"parseStyle",value:function(t,o){var r=this,s={},l=this.getOlCls(t);return l&&o instanceof Object?(Object.keys(o).forEach(function(c){var u=r.getOlKey(c);s[u]=r.parseStyle(c,o[c])}),new l(s)):o}},{key:"getOlKey",value:function(t){var o;switch(t.toLowerCase()){case"circle":case"regularshape":case"icon":o="image"}return o||t}},{key:"getOlCls",value:function(t){var o=Vh[t.charAt(0).toUpperCase()+t.slice(1)];return"regularshape"===t&&(o=Qo.Z),"backgroundFill"===t&&(o=te.Z),"backgroundStroke"===t&&(o=K.Z),o}},{key:"createStyleByAttribute",value:function(t,o,r){var s,l,c,u,p,d,g=o.type?o.type:this.guessTypeFeature(t),f=o.attribute,m=o.data,y=o.stroke,_=o.width,b=o.fill,w=o.anchor,T=o.radius,M=o.icon,A=o.scale,L=m?m.length:0,Z=o.label?o.label.attribute:void 0,R=null!==(s=o.label)&&void 0!==s&&s.minScaleDenom?Zt(Number(o.label.minScaleDenom)):void 0,V=null!==(l=o.label)&&void 0!==l&&l.maxScaleDenom?Zt(Number(o.label.maxScaleDenom)):void 0,P=null!==(c=o.label)&&void 0!==c&&c.minResolution?o.label.minResolution:0,Y=null!==(u=o.label)&&void 0!==u&&u.maxResolution?o.label.maxResolution:1/0,pe=R||P,ue=V||Y,oe=null!==(p=o.label)&&void 0!==p&&p.style?this.parseStyle("text",o.label.style):void 0;!oe&&Z&&(oe=new Lt.Z);var Q=o.baseStyle;if(oe&&oe.setText(r>=pe&&r<=ue?this.getLabel(t,Z):""),"circle"===g){for(var ae=0;ae<L;ae++){var xe=void 0!==t.get(f)&&null!==t.get(f)?t.get(f):"";if(xe===m[ae]||xe.toString().match(new RegExp(m[ae],"gmi")))return d=M?[new ee.ZP({image:new bo.Z({color:b?b[ae]:void 0,src:M[ae],scale:A?A[ae]:1,anchor:w?w[ae]:[.5,.5]}),text:oe instanceof Lt.Z?oe:void 0})]:[new ee.ZP({image:new Ue.Z({radius:T?T[ae]:4,stroke:new K.Z({color:y?y[ae]:"black",width:_?_[ae]:1}),fill:new te.Z({color:b?b[ae]:"black"})}),text:oe instanceof Lt.Z?oe:void 0})]}if(!t.getStyle())return Q?(d=this.createStyle(Q,t,r),oe&&d.setText(oe),d):d=[new ee.ZP({image:new Ue.Z({radius:4,stroke:new K.Z({color:"black"}),fill:new te.Z({color:"#bbbbf2"})})})]}else if("regular"===g){for(var Me=0;Me<L;Me++){var Ce=void 0!==t.get(f)&&null!==t.get(f)?t.get(f):"";if(Ce===m[Me]||Ce.toString().match(new RegExp(m[Me],"gmi")))return[new ee.ZP({stroke:new K.Z({color:y?y[Me]:"black",width:_?_[Me]:1}),fill:new te.Z({color:b?b[Me]:"rgba(255,255,255,0.4)"}),text:oe instanceof Lt.Z?oe:void 0})]}if(t instanceof nt.Z&&!t.getStyle())return Q?(d=this.createStyle(Q,t,r),oe&&d.setText(oe),d):d=[new ee.ZP({stroke:new K.Z({color:"black"}),fill:new te.Z({color:"#bbbbf2"})})]}}},{key:"createClusterStyle",value:function(t,o){var l,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0,c=t.get("features").length;if(1!==c){if(r.clusterRanges){var p,u=(0,D.Z)(r.clusterRanges);try{for(u.s();!(p=u.n()).done;){var d=p.value;if((!d.minRadius||d.minRadius<=c)&&(!d.maxRadius||d.maxRadius>=c)){if(l=this.createStyle(d.style),d.showRange){var g=new Lt.Z({text:c.toString(),fill:new te.Z({color:"#fff"})});l.setText(g)}if(d.dynamicRadius){var f=void 0,m=l.getRadius();(f=5*Math.log(c))<m&&(f=m),l.image_.setRadius(f)}break}}}catch(b){u.e(b)}finally{u.f()}}if(!l){var y;if(r.radiusCalc)y=r.radiusCalc(c);else{var _=6;(y=5*Math.log(c))<_&&(y=_)}l=[new ee.ZP({image:new Ue.Z({radius:y,stroke:new K.Z({color:"black"}),fill:new te.Z({color:"rgba(24, 134, 45, 0.5)"})}),text:new Lt.Z({text:c.toString(),fill:new te.Z({color:"#fff"})})})]}}else l=this.createStyle(s,t,o);return l}},{key:"getLabel",value:function(t,o){var r=o;if(r){var s=Array.from(o.matchAll(/\$\{([^\{\}]+)\}/g));return s.forEach(function(l){r=r.replace(l[0],t.get(l[1]))}),0===s.length&&r===o&&(r=t.get(o)||o),r}}},{key:"guessTypeFeature",value:function(t){switch(t.getGeometry().getType()){case"Point":case"MultiPoint":case"Circle":return"circle";default:return"regular"}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function Kv(){var n,i=Ac(),a=no();return function(t,o){if("bufferFeature"===t.getId())return n=function Xv(){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,161,222,.15],t=arguments.length>3?arguments[3]:void 0,o=new K.Z({width:arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,color:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,161,222,1]}),r=new te.Z({color:n});return new ee.ZP({stroke:o,fill:r,image:new Ue.Z({radius:5,stroke:o,fill:r}),text:new Lt.Z({font:"12px Calibri,sans-serif",text:t,fill:new te.Z({color:"#000"}),stroke:new K.Z({color:"#fff",width:3}),overflow:!0})})}(t.get("bufferStroke"),2,t.get("bufferFill"),t.get("bufferText")),n;var r=t.get("_style");if(r)return(new xn).createStyle(r,t,o);var l=t.getGeometry().getType();return(n="Point"===l?a:i).getText().setText(t.get("_mapTitle")),n}}function Ac(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=i.text,n=i.strokeWidth,t=void 0===n?2:n,o=i.fillColor,r=void 0===o?[0,161,222,.3]:o,s=i.strokeColor,l=void 0===s?[0,161,222,.9]:s,c=(0,Wn._2)(r).slice(0),u=(0,Wn._2)(l).slice(0),p=new K.Z({width:t,color:u}),d=new te.Z({color:c});return new ee.ZP({stroke:p,fill:d,image:new Ue.Z({radius:5,stroke:p,fill:d}),text:new Lt.Z({text:a,font:"12px Calibri,sans-serif",fill:new te.Z({color:"#000"}),stroke:new K.Z({color:"#fff",width:3}),overflow:!0})})}var Br=function(){function i(a){(0,h.Z)(this,i),this.layer=function Wv(){var i=new Re;return new Je({title:"Overlay",zIndex:300,source:i,style:Kv()})}(),this.setMap(a)}return(0,v.Z)(i,[{key:"dataSource",get:function(){return this.layer.dataSource}},{key:"setMap",value:function(n){void 0===n?void 0!==this.map&&this.map.ol.removeLayer(this.layer.ol):n.ol.addLayer(this.layer.ol),this.map=n}},{key:"setFeatures",value:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ce.Default,o=arguments.length>2?arguments[2]:void 0;if(o){var s,r=(0,D.Z)(this.dataSource.ol.getFeatures());try{for(r.s();!(s=r.n()).done;){var l=s.value;l.get("_sourceId")===o&&this.removeOlFeature(l)}}catch(c){r.e(c)}finally{r.f()}}else this.clear();this.addFeatures(n,t)}},{key:"addFeature",value:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ce.Default;this.addFeatures([n],t)}},{key:"addFeatures",value:function(n){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ce.Default,r=[];n.forEach(function(s){var l=At(s,t.map.projection);null!==l.getGeometry()&&r.push(l)}),this.addOlFeatures(r,o)}},{key:"addOlFeature",value:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ce.Default;this.addOlFeatures([n],t)}},{key:"addOlFeatures",value:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ce.Default;this.dataSource.ol.addFeatures(n),mn(this.map,n,t)}},{key:"removeFeature",value:function(n){this.removeFeatures([n])}},{key:"removeFeatures",value:function(n){var t=this;n.forEach(function(o){o.meta&&t.dataSource.ol.getFeatureById(o.meta.id)&&t.removeOlFeature(t.dataSource.ol.getFeatureById(o.meta.id))})}},{key:"removeOlFeature",value:function(n){this.dataSource.ol.removeFeature(n)}},{key:"clear",value:function(){this.dataSource.ol.clear()}}]),i}(),ze=function(){return(i=ze||(ze={})).OPACITY="opacity",i.VISIBLE="visible",i.OGCFILTERS="ogcFilters",i.MINRESOLUTION="minResolution",i.MAXRESOLUTION="maxResolution",i.ZINDEX="zIndex",i.TIMEFILTER="timeFilter",ze;var i}(),sn=function(){return(i=sn||(sn={})).TITLE="title",i.ABSTRACT="abstract",i.CUSTOM="custom",sn;var i}(),ey=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o,r,s){var l;return(0,h.Z)(this,n),(l=a.call(this,t,o,s)).messageService=o,l.languageService=r,l.authInterceptor=s,l.watcher=new Fv((0,kt.Z)(l),l.messageService,l.languageService),l.status$=l.watcher.status$,l.status$.subscribe(function(c){0===c&&(l.olLoadingProblem=!0)}),l}return(0,v.Z)(n,[{key:"createOlLayer",value:function(){var o=this,r=Object.assign({},this.options,{source:this.options.source.ol}),s=new pv.Z(r);return this.authInterceptor&&s.getSource().setImageLoadFunction(function(l,c){o.customLoader(l,c,o.authInterceptor,o.messageService,o.languageService)}),s}},{key:"setMap",value:function(o){void 0===o?this.watcher.unsubscribe():this.watcher.subscribe(function(){}),(0,Se.Z)((0,we.Z)(n.prototype),"setMap",this).call(this,o)}},{key:"customLoader",value:function(o,r,s,l,c){var u=new XMLHttpRequest,p=s.alterUrlWithKeyAuth(r),d=r;if(p&&(d=p),u.open("GET",d),!s.interceptXhr(u,d))return u.abort(),void(o.getImage().src=d);u.responseType="arraybuffer",u.onload=function(){var f=new Uint8Array(this.response);(new TextDecoder).decode(f).includes("ServiceExceptionReport")&&l.error(c.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),c.translate.instant("igo.geo.dataSource.unavailableTitle"));var y=new Blob([f],{type:"image/png"}),b=window.URL.createObjectURL(y);o.getImage().src=b},u.send()}}]),n}(Or),ty=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o,r){var s;return(0,h.Z)(this,n),(s=a.call(this,t,o)).messageService=o,s.authInterceptor=r,s.watcher=new mc((0,kt.Z)(s)),s.status$=s.watcher.status$,s}return(0,v.Z)(n,[{key:"createOlLayer",value:function(){var o=this,r=Object.assign({},this.options,{source:this.options.source.ol}),s=new dv.Z(r);return s.getSource().setTileLoadFunction(function(c,u){o.customLoader(c,u,o.authInterceptor)}),s}},{key:"customLoader",value:function(o,r,s){var l=s.alterUrlWithKeyAuth(r),c=r;l&&(c=l),o.getImage().src=c}},{key:"setMap",value:function(o){void 0===o?this.watcher.unsubscribe():this.watcher.subscribe(function(){}),(0,Se.Z)((0,we.Z)(n.prototype),"setMap",this).call(this,o)}}]),n}(Or),Ic=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o,r){var s;return(0,h.Z)(this,n),(s=a.call(this,t,o,r)).messageService=o,s.authInterceptor=r,s.watcher=new mc((0,kt.Z)(s)),s.status$=s.watcher.status$,s}return(0,v.Z)(n,[{key:"createOlLayer",value:function(){var o=this,r=Object.assign({},this.options,{source:this.options.source.ol}),s=new Ar.Z(r);return s.getSource().setTileLoadFunction(function(c,u){var p=o.customLoader(u,c.getFormat(),o.authInterceptor,c.onLoad.bind(c));p&&c.setLoader(p)}),s}},{key:"customLoader",value:function(o,r,s,l,c){var u=this;return function(p,d,g){var f=new XMLHttpRequest,m=o;if("function"!=typeof o){var y=s.alterUrlWithKeyAuth(o);y&&(m=y)}else m=o(p,d,g);f.open("GET",m),s&&s.interceptXhr(f,m),"arraybuffer"===r.getType()&&(f.responseType="arraybuffer"),f.onload=function(_){if(!f.status||f.status>=200&&f.status<300){var w,b=r.getType();"json"===b||"text"===b?w=f.responseText:"xml"===b?(w=f.responseXML)||(w=(new DOMParser).parseFromString(f.responseText,"application/xml")):"arraybuffer"===b&&(w=f.response),w?l.call(u,r.readFeatures(w,{extent:p,featureProjection:g}),r.readProjection(w)):c.call(u)}else c.call(u)},f.onerror=function(){c.call(u)},f.send()}}},{key:"setMap",value:function(o){void 0===o?this.watcher.unsubscribe():this.watcher.subscribe(function(){}),(0,Se.Z)((0,we.Z)(n.prototype),"setMap",this).call(this,o)}}]),n}(Or),ny=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){var t;return(0,h.Z)(this,n),(t=a.call(this)).propertyChange$=new x.X(void 0),t.loaded=0,t.loading=0,t.layers=[],t.subscriptions=[],t}return(0,v.Z)(n,[{key:"watch",value:function(){}},{key:"unwatch",value:function(){var o=this;this.layers.forEach(function(r){return o.unwatchLayer(r)},this)}},{key:"setPropertyChange",value:function(o,r){![ze.TIMEFILTER,ze.OGCFILTERS,ze.VISIBLE,ze.OPACITY,ze.MINRESOLUTION,ze.MAXRESOLUTION].includes(o.key)||this.propertyChange$.next({event:o,layer:r})}},{key:"watchLayer",value:function(o){var r=this;if(void 0!==o.status$){o.ol.on("propertychange",function(l){return r.setPropertyChange(l,o)}),o.dataSource.ol.on("propertychange",function(l){return r.setPropertyChange(l,o)}),this.layers.push(o);var s=o.status$.pipe((0,lo.x)()).subscribe(function(l){l===Le.Error&&(r.loading=0,r.loaded=-1),l===Le.Working?r.loading+=1:l===Le.Done&&(r.loaded+=1),r.loaded>=r.loading?(r.loading=r.loaded=0,r.status=Le.Done):r.loading>0&&(r.status=Le.Working)});this.subscriptions.push(s)}}},{key:"unwatchLayer",value:function(o){var r=this;o.ol.un("propertychange",function(c){return r.setPropertyChange(c,o)}),o.dataSource.ol.un("propertychange",function(c){return r.setPropertyChange(c,o)}),o.status$.next(Le.Done);var s=this.layers.indexOf(o);s>=0&&(-1!==[Le.Working,Le.Waiting].indexOf(o.watcher.status)&&(this.loaded+=1),this.subscriptions[s].unsubscribe(),this.subscriptions.splice(s,1),this.layers.splice(s,1),o.watcher.unwatch())}}]),n}(ar),ei=function(){return(i=ei||(ei={}))[i.Move=0]="Move",i[i.Zoom=1]="Zoom",ei;var i}(),Lc=function(){function i(){(0,h.Z)(this,i),this.observerKeys=[]}return(0,v.Z)(i,[{key:"getOlMap",value:function(){return this.olMap}},{key:"setOlMap",value:function(n){if(void 0!==n&&void 0!==this.getOlMap())throw new Error("This controller is already bound to a map.");if(void 0===n)return this.teardownObservers(),void(this.olMap=n);this.olMap=n}},{key:"teardownObservers",value:function(){this.observerKeys.forEach(function(n){return(0,st.B)(n)}),this.observerKeys=[]}}]),i}(),oy=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t){var o;return(0,h.Z)(this,n),(o=a.call(this)).options=t,o.rotation$=new x.X(0),o.resolution$=new x.X(void 0),o.state$=new x.X(void 0),o.padding=[0,0,0,0],o.maxZoomOnExtent=19,o.extent$=new $e.x,o.states=[],o.stateIndex=0,o}return(0,v.Z)(n,[{key:"stateHistory",get:function(){return!!this.options&&!0===this.options.stateHistory}},{key:"olView",get:function(){return this.olMap.getView()}},{key:"setPadding",value:function(o){(o.top||0===o.top)&&(this.padding[0]=o.top),(o.right||0===o.right)&&(this.padding[1]=o.right),(o.bottom||0===o.bottom)&&(this.padding[2]=o.bottom),(o.left||0===o.left)&&(this.padding[3]=o.left)}},{key:"setOlMap",value:function(o){(0,Se.Z)((0,we.Z)(n.prototype),"setOlMap",this).call(this,o),this.setupObservers()}},{key:"setupObservers",value:function(){var o=this;!0===this.stateHistory&&this.observerKeys.push(this.olMap.on("moveend",function(r){return o.onMoveEnd(r)})),this.extent$$=this.extent$.pipe((0,De.b)(25)).subscribe(function(r){o.setExtent(r.extent,r.action)})}},{key:"monitorRotation",value:function(){var o=this;this.observerKeys.push(this.olMap.getView().on("change:rotation",function(r){o.rotation$.next(r.target.getRotation())}))}},{key:"teardownObservers",value:function(){(0,Se.Z)((0,we.Z)(n.prototype),"teardownObservers",this).call(this),void 0!==this.extent$$&&(this.extent$$.unsubscribe(),this.extent$$=void 0)}},{key:"getOlProjection",value:function(){return this.olView.getProjection()}},{key:"getCenter",value:function(o){var r=this.olView.getCenter();return o&&r&&(r=re.vs(r,this.getOlProjection(),o)),r}},{key:"getExtent",value:function(o){var r=this.olView.calculateExtent(this.olMap.getSize());return o&&r&&(r=re.$A(r,this.getOlProjection(),o)),r}},{key:"getScale",value:function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:96;return Rv(this.getResolution(),this.getOlProjection().getUnits(),o)}},{key:"getResolution",value:function(){return this.olView.getResolution()}},{key:"getZoom",value:function(){return Math.round(this.olView.getZoom())}},{key:"zoomIn",value:function(){this.zoomTo(this.olView.getZoom()+1)}},{key:"zoomOut",value:function(){this.zoomTo(this.olView.getZoom()-1)}},{key:"zoomTo",value:function(o){this.olView.cancelAnimations(),this.olView.animate({zoom:o,duration:250,easing:Yo.Vv})}},{key:"moveToExtent",value:function(o){this.extent$.next({extent:o,action:ei.Move})}},{key:"zoomToExtent",value:function(o){this.extent$.next({extent:o,action:ei.Zoom})}},{key:"getRotation",value:function(){return this.olView.getRotation()}},{key:"resetRotation",value:function(){this.olView.animate({rotation:0})}},{key:"hasPreviousState",value:function(){return this.states.length>1&&this.stateIndex>0}},{key:"hasNextState",value:function(){return this.states.length>1&&this.stateIndex<this.states.length-1}},{key:"previousState",value:function(){this.hasPreviousState()&&this.setStateIndex(this.stateIndex-1)}},{key:"nextState",value:function(){this.hasNextState()&&this.setStateIndex(this.stateIndex+1)}},{key:"clearStateHistory",value:function(){this.states=[],this.stateIndex=0}},{key:"setInitialState",value:function(){this.states.length>0&&this.setStateIndex(0)}},{key:"setExtent",value:function(o,r){var s=this,l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],c=this.olView;c.cancelAnimations();var u=l?500:0,p=c.getZoom(),d=c.getCenter(),g=[o[0]+(o[2]-o[0])/2,o[1]+(o[3]-o[1])/2],f=Math.sqrt(Math.pow(d[0]-g[0],2)+Math.pow(d[1]-g[1],2)),m=c.calculateExtent(),y=Math.sqrt(Math.pow(m[2]-m[0],2)+Math.pow(m[3]-m[1],2)),_=Math.sqrt(Math.pow(o[2]-o[0],2)+Math.pow(o[3]-o[1],2)),b=(_+y)/2,w=f/b,T=r===ei.Move||p>this.maxZoomOnExtent?p:this.maxZoomOnExtent;c.fit(o,{size:this.olMap.getSize(),maxZoom:T,padding:this.padding,duration:w>4?0:u,callback:function(A){A||c.fit(o,{size:s.olMap.getSize(),maxZoom:T,padding:s.padding,duration:w>4?0:u})}})}},{key:"setStateIndex",value:function(o){this.stateIndex=o,this.setState(this.states[o])}},{key:"setState",value:function(o){this.olView.animate({resolution:o.resolution,center:o.center,duration:0})}},{key:"onMoveEnd",value:function(o){var r=this.getResolution();this.resolution$.value!==r&&this.resolution$.next(r);var s={resolution:r,center:this.getCenter(),zoom:this.getZoom()};if(!0===this.stateHistory){var l=this.stateIndex;(function $v(i,a){if(void 0===i||void 0===a)return!1;var n=1e-4;return i.zoom===a.zoom&&Math.trunc(i.center[0]/n)===Math.trunc(a.center[0]/n)&&Math.trunc(i.center[1]/n)===Math.trunc(a.center[1]/n)})(s,0===this.states.length?void 0:this.states[l])||(this.states=this.states.slice(0,l+1).concat([s]),this.stateIndex=this.states.length-1)}this.state$.next(s)}}]),n}(Lc),$n=function(){return(i=$n||($n={})).Position="position",i.Accuracy="accuracy",i.Buffer="buffer",$n;var i}(),iy=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o,r,s){var l;return(0,h.Z)(this,n),(l=a.call(this)).map=t,l.options=o,l.storageService=r,l.configService=s,l.subscriptions$$=[],l.positionFeatureStyle=new ee.ZP({image:new Ue.Z({radius:6,fill:new te.Z({color:"#3399CC"}),stroke:new K.Z({color:"#fff",width:2})})}),l.accuracyFeatureStyle=new ee.ZP({stroke:new K.Z({color:"rgba(120, 120, 120, 0.4)",width:1}),fill:new te.Z({color:"rgba(120, 120, 120, 0.4)"})}),l.emissionIntervalSeconds$=new x.X(5),l.position$=new x.X(void 0),l.tracking$=new x.X(void 0),l.followPosition$=new x.X(void 0),l._buffer=l.options&&l.options.buffer?l.options.buffer:void 0,l._accuracyThreshold=l.options&&l.options.accuracyThreshold?l.options.accuracyThreshold:5e3,l._followPosition=!(!l.options||!l.options.followPosition)&&l.options.followPosition,l.geolocationOverlay=new Br(l.map),l}return(0,v.Z)(n,[{key:"buffer",get:function(){return this._buffer},set:function(o){this._buffer=o,this.handleFeatureCreation(this.position$.value)}},{key:"accuracyThreshold",get:function(){return this._accuracyThreshold},set:function(o){this._accuracyThreshold=o,this.handleFeatureCreation(this.position$.value)}},{key:"tracking",get:function(){return this.geolocation.getTracking()},set:function(o){this.geolocation.setTracking(o||!1),this.tracking$.next(o),this.storageService&&void 0!==o&&this.storageService.set("geolocation.tracking",o),o||this.position$.next(void 0)}},{key:"followPosition",get:function(){return this._followPosition},set:function(o){var r;this._followPosition=o,this.followPosition$.next(o),!1===(null===(r=this.configService)||void 0===r?void 0:r.getConfig("geolocate.followPosition"))&&(this._followPosition=!1,this.followPosition$.next(!1)),this.handleFeatureCreation(this.position$.value),this.storageService&&void 0!==o&&this.storageService.set("geolocation.followPosition",o)}},{key:"setOlMap",value:function(o){(0,Se.Z)((0,we.Z)(n.prototype),"setOlMap",this).call(this,o),this.setupObservers()}},{key:"deleteGeolocationFeatures",value:function(){this.deleteFeatureByType($n.Position),this.deleteFeatureByType($n.Accuracy),this.deleteFeatureByType($n.Buffer)}},{key:"setupObservers",value:function(){var o=this;this.tracking$.subscribe(function(s){s?o.onPositionChange(!0,!0):o.deleteGeolocationFeatures()}),this.geolocation=new gv.Z({trackingOptions:{enableHighAccuracy:!0,maximumAge:1e4,timeout:6e5},projection:this.options.projection});var r=!1;this.subscriptions$$.push(this.emissionIntervalSeconds$.pipe((0,Sl.w)(function(s){return(0,Hl.F)(1e3*s)})).subscribe(function(){r===o.tracking?o.onPositionChange(!0):(r=o.tracking,o.onPositionChange(!0,!0))}))}},{key:"updateGeolocationOptions",value:function(o){if(o){var r=o.geolocate,s=o.alwaysTracking;if(this.storageService){var l=this.storageService.get("geolocation.tracking");null!=l&&(r=l);var c=this.storageService.get("geolocation.followPosition");null!=c&&(s=c)}this.tracking=r,this.followPosition=s,this.buffer=o.buffer}}},{key:"teardownObservers",value:function(){this.subscriptions$$.length&&this.subscriptions$$.map(function(o){return o.unsubscribe()}),(0,Se.Z)((0,we.Z)(n.prototype),"teardownObservers",this).call(this)}},{key:"onPositionChange",value:function(){var s,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.tracking){var l=this.geolocation.getProperties();if(l.accuracy>this.accuracyThreshold)return console.warn("Poor geolocation accuracy. No position are stored/shown"),void this.position$.next(void 0);var c={position:l.position,projection:this.geolocation.getProjection().getCode(),accuracy:l.accuracy,altitude:l.altitude,altitudeAccuracy:l.altitudeAccuracy,heading:l.heading,speed:l.speed,enableHighAccuracy:!(null===(s=l.trackingOptions)||void 0===s||!s.enableHighAccuracy),timestamp:new Date};this.handleFeatureCreation(c,r),o&&this.position$.next(c)}}},{key:"deleteFeatureByType",value:function(o){var r=this.geolocationOverlay.dataSource.ol.getFeatureById(o);r&&this.geolocationOverlay.dataSource.ol.removeFeature(r)}},{key:"handleFeatureCreation",value:function(o){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(o&&o.position){this.deleteGeolocationFeatures();var s=new He.Z(o.position),l=(0,Tn.Bb)(new Zi.Z(o.position,o.accuracy||0)),c=new nt.Z({geometry:s}),u=new nt.Z({geometry:l});if(s){var p=this.followPosition?ce.Move:ce.None;if(r&&(p=ce.Zoom),c.setId($n.Position),c.setStyle(this.positionFeatureStyle),this.geolocationOverlay.addOlFeature(c,p),l&&(u.setId($n.Accuracy),u.setStyle(this.accuracyFeatureStyle),this.geolocationOverlay.addOlFeature(u,p)),this.buffer){var d=new nt.Z(new Zi.Z(o.position,this.buffer.bufferRadius)),g=new ee.ZP({stroke:new K.Z({width:2,color:this.buffer.bufferStroke}),fill:new te.Z({color:this.buffer.bufferFill}),text:new Lt.Z({textAlign:"left",offsetX:10,offsetY:-10,font:"12px Calibri,sans-serif",text:this.buffer.showBufferRadius?"".concat(this.buffer.bufferRadius,"m"):"",fill:new te.Z({color:"#000"}),stroke:new K.Z({color:"#fff",width:3})})});d.setId($n.Buffer),d.setStyle(g),this.geolocationOverlay.addOlFeature(d,p)}}}}}]),n}(Lc);function Ur(i){return i.options.linkedLayers}function Oc(i,a){return i.layers.find(function(n){var t;return(null===(t=n.options.linkedLayers)||void 0===t?void 0:t.linkId)===a})}function Nr(i,a,n){for(var t=a,o=t,r=!0;r;)r=!!(o=sy(i,t=o,n));return r||function ry(i,a){var n=!1,t=Ur(i);return null!=t&&t.links&&(n=!!t.links.find(function(r){return r.properties.includes(a)})),n}(t,n)||(t=void 0),r?o:t}function sy(i,a,n){var t;if(null!==(t=null==a?void 0:a.options.linkedLayers)&&void 0!==t&&t.linkId){var o=a.options.linkedLayers.linkId,r=i.layers.filter(function(s){var l=s.options.linkedLayers;if(l&&l.links)return l.links.find(function(u){return u.linkedIds.includes(o)&&u.properties.includes(n)})});return r.length>1&&console.warn("Your layer ".concat(a.title||a.id," must only have 1 parent (").concat(r.map(function(s){return s.title||s.id}),")\n            , The first parent (").concat(r[0].title||r[0].id,") will be use to sync properties")),r[0]}}function Dc(i,a,n){var t,o=[];return!(null===(t=null==a?void 0:a.options.linkedLayers)||void 0===t)&&t.links&&a.options.linkedLayers.links.filter(function(r){return r.properties.includes(n)}).map(function(r){o=o.concat(r.linkedIds)}),o.map(function(r){return Oc(i,r)})}function bs(i,a,n,t){return Dc(i,a,t).map(function(r){n.push(r),Dc(i,r,t)&&bs(i,r,n,t)}),n}function cy(i,a){var n;if(null!==(n=a.options.linkedLayers)&&void 0!==n&&n.linkId){var t=a.options.linkedLayers.linkId,o=i.layers.filter(function(r){var s=r.options.linkedLayers;if(s&&s.links)return s.links.find(function(c){return c.linkedIds.includes(t)&&c.syncedDelete})});return o.length>1&&console.warn("Your layer ".concat(a.title||a.id," must only have 1 parent (").concat(o.map(function(r){return r.title||r.id}),")\n          , The first parent (").concat(o[0].title||o[0].id,") will be use to sync properties")),o[0]}}function Pc(i,a){var n,t=[];return!(null===(n=null==a?void 0:a.options.linkedLayers)||void 0===n)&&n.links&&a.options.linkedLayers.links.filter(function(o){return o.syncedDelete}).map(function(o){t=t.concat(o.linkedIds)}),t.map(function(o){return Oc(i,o)})}function Ec(i,a,n){return Pc(i,a).map(function(o){n.push(o),Pc(i,o)&&Ec(i,o,n)}),n}function uy(i,a){var n={},t=Object.keys(ze);t.map(function(o){n[ze[o]]=[]}),a.filter(function(o){return Ur(o)}).map(function(o){t.map(function(r){var s=ze[r],l=Nr(i,o,s),u=n[s].map(function(p){return p.id});l&&!u.includes(l.id)&&n[s].push(l)})}),Object.keys(n).map(function(o){n[o].map(function(s){return s.ol.notify(o,void 0)})})}var ct=function(){function i(a,n,t){(0,h.Z)(this,i),this.storageService=n,this.configService=t,this.offlineButtonToggle$=new x.X(!1),this.layers$=new x.X([]),this.swipeEnabled$=new x.X(!1),this.mapCenter$=new x.X(!1),this.selectedFeatures$=new x.X(null),this.defaultOptions={controls:{attribution:!1}},this.options=Object.assign({},this.defaultOptions,a),this.layerWatcher=new ny,this.status$=this.layerWatcher.status$,this.propertyChange$=this.layerWatcher.propertyChange$,Wl.z(es.Z),this.init()}return(0,v.Z)(i,[{key:"layers",get:function(){return this.layers$.value}},{key:"projection",get:function(){return this.viewController.getOlProjection().getCode()}},{key:"init",value:function(){var n=this,t=[];this.options.controls&&(this.options.controls.attribution&&t.push(new Mr.Z(!0===this.options.controls.attribution?{}:this.options.controls.attribution)),this.options.controls.scaleLine&&t.push(new zl.Z(!0===this.options.controls.scaleLine?{}:this.options.controls.scaleLine)));var s={};!1===this.options.interactions&&(s={altShiftDragRotate:!1,doubleClickZoom:!1,keyboard:!1,mouseWheelZoom:!1,shiftDragZoom:!1,dragPan:!1,pinchRotate:!1,pinchZoom:!1}),this.ol=new Yh.Z({interactions:Hh.c(s),controls:t}),this.setView(this.options.view||{}),this.viewController=new oy({stateHistory:!0}),this.viewController.setOlMap(this.ol),this.overlay=new Br(this),this.queryResultsOverlay=new Br(this),this.searchResultsOverlay=new Br(this),this.ol.once("rendercomplete",function(){n.geolocationController=new iy(n,{projection:n.viewController.getOlProjection()},n.storageService,n.configService),n.geolocationController.setOlMap(n.ol),n.geolocationController&&n.geolocationController.updateGeolocationOptions(n.mapViewOptions),n.layers$.subscribe(function(l){var u,c=(0,D.Z)(l);try{for(c.s();!(u=c.n()).done;){var p=u.value;p.options.linkedLayers&&p.ol.once("postrender",function(){uy(n,n.layers)})}}catch(d){c.e(d)}finally{c.f()}}),n.viewController.monitorRotation()}),this.propertyChange$.pipe((0,Nt.n)(function(l){return!l})).subscribe(function(l){return function py(i,a,n){if(a){var l,t=new jt,o=!0,r=!0,s=a.key;if("ogcFilters"===s?(o=!1,r=!0,l=n.dataSource.options.ogcFilters):"timeFilter"===s?(o=!1,r=!0,l=n.dataSource.options.timeFilter):(o=!0,r=!1,l=n.ol.get(s)),Ur(n)){var u=Nr(i,n,s);u||(u=n);var p=[u];bs(i,u,p,s);var d=!1,g=n.options.source.options.type,f=n.dataSource.options;p.map(function(m){if(n&&m&&(0,ki.sq)(n.ol)!==(0,ki.sq)(null==m?void 0:m.ol)){var y=m.options.source.options.type;if(o)m.ol.set(s,l,!0),"visible"===s&&m.visible$.next(l),("minResolution"===s||"maxResolution"===s)&&(d=!0);else if(r){var _;if("ogcFilters"===s)m.dataSource.setOgcFilters(l,!1),"wfs"===y&&m.ol.getSource().refresh(),"wms"===y&&("wfs"===g?_=t.handleOgcFiltersAppliedValue(f,n.dataSource.options.fieldNameGeometry,void 0,i.viewController.getOlProjection()):"wms"===g&&(_=n.dataSource.ol.getParams().FILTER),m.dataSource.ol.updateParams({FILTER:_}));else if(m.dataSource instanceof Ht&&"timeFilter"===s){m.dataSource.setTimeFilter(l,!1);var b=n.ol.getSource().getParams().TIME;m.dataSource.ol.updateParams({TIME:b})}}}}),d&&i.viewController.resolution$.next(i.viewController.resolution$.value)}}}(n,l.event,l.layer)})}},{key:"setTarget",value:function(n){this.ol.setTarget(n),void 0!==n?this.layerWatcher.subscribe(function(){},null):this.layerWatcher.unsubscribe()}},{key:"updateView",value:function(n){var t=this.ol.getView(),o=Object.assign({zoom:t.getZoom()},t.getProperties());this.setView(Object.assign(o,n)),n.maxZoomOnExtent&&(this.viewController.maxZoomOnExtent=n.maxZoomOnExtent),this.mapViewOptions=n}},{key:"setView",value:function(n){void 0!==this.viewController&&this.viewController.clearStateHistory(),n=Object.assign({constrainResolution:!0},n);var t=new jh.ZP(n);if(this.ol.setView(t),n&&(n.maxLayerZoomExtent&&(this.viewController.maxLayerZoomExtent=n.maxLayerZoomExtent),n.center)){var o=t.getProjection().getCode(),r=re.mi(n.center,o);t.setCenter(r)}}},{key:"updateControls",value:function(n){var t=this;if(void 0!==n){var o=[];n.attribution&&o.push(new Mr.Z(!0===n.attribution?{}:n.attribution)),n.scaleLine&&o.push(new zl.Z(!0===n.scaleLine?{}:n.scaleLine)),Object.assign([],this.ol.getControls().getArray()).forEach(function(c){t.ol.removeControl(c)}),o.forEach(function(c){t.ol.addControl(c)})}}},{key:"getCenter",value:function(n){return this.viewController.getCenter(n)}},{key:"getExtent",value:function(n){return this.viewController.getExtent(n)}},{key:"getZoom",value:function(){return this.viewController.getZoom()}},{key:"changeBaseLayer",value:function(n){if(n){var o,t=(0,D.Z)(this.getBaseLayers());try{for(t.s();!(o=t.n()).done;)o.value.visible=!1}catch(s){t.e(s)}finally{t.f()}n.visible=!0,this.viewController.olView.setMinZoom(n.dataSource.options.minZoom||(this.options.view||{}).minZoom),this.viewController.olView.setMaxZoom(n.dataSource.options.maxZoom||(this.options.view||{}).maxZoom)}}},{key:"getBaseLayers",value:function(){return this.layers.filter(function(n){return!0===n.baseLayer})}},{key:"getLayerById",value:function(n){return this.layers.find(function(t){return t.id&&t.id===n})}},{key:"getLayerByAlias",value:function(n){return this.layers.find(function(t){return t.alias&&t.alias===n})}},{key:"getLayerByOlUId",value:function(n){return this.layers.find(function(t){return(0,ki.sq)(t.ol)&&(0,ki.sq)(t.ol)===n})}},{key:"getLayerByOlLayer",value:function(n){var t=(0,ki.sq)(n);return this.getLayerByOlUId(t)}},{key:"addLayer",value:function(n){this.addLayers([n])}},{key:"addLayers",value:function(n){var t=this,r=0,s=0,l=n.map(function(c){if(c){var u=c.zIndex?0:c.baseLayer?s++:r++;return t.doAddLayer(c,u)}}).filter(function(c){return void 0!==c});this.setLayers([].concat(this.layers,l))}},{key:"removeLayer",value:function(n){this.removeLayers([n])}},{key:"removeLayers",value:function(n){var t=this,o=this.layers$.value.slice(0),r=[];n.forEach(function(s){var l=o.indexOf(s);l>=0&&(r.push(s),o.splice(l,1),t.handleLinkedLayersDeletion(s,r),r.map(function(c){var u=o.indexOf(c);u>=0&&o.splice(u,1)}))}),r.forEach(function(s){return t.doRemoveLayer(s)}),this.setLayers(o)}},{key:"handleLinkedLayersDeletion",value:function(n,t){var o=function ly(i,a){for(var n=a,t=n,o=!0;o;)o=!!(t=cy(i,n=t));return o||function ay(i){var a=!1,n=Ur(i);return null!=n&&n.links&&(a=!!n.links.find(function(o){return o.syncedDelete})),a}(n)||(n=void 0),o?t:n}(this,n);o||(o=n);var l,r=Ec(this,o,[o]),s=(0,D.Z)(r);try{for(s.s();!(l=s.n()).done;)t.push(l.value)}catch(u){s.e(u)}finally{s.f()}}},{key:"removeAllLayers",value:function(){var n=this;this.layers.forEach(function(t){return n.doRemoveLayer(t)}),this.layers$.next([])}},{key:"raiseLayer",value:function(n){var t=this.getLayerIndex(n);t>1&&this.moveLayer(n,t,t-1)}},{key:"raiseLayers",value:function(n){var o,t=(0,D.Z)(n);try{for(t.s();!(o=t.n()).done;)this.raiseLayer(o.value)}catch(s){t.e(s)}finally{t.f()}}},{key:"lowerLayer",value:function(n){var t=this.getLayerIndex(n);t<this.layers.length-1&&this.moveLayer(n,t,t+1)}},{key:"lowerLayers",value:function(n){var r,t=n.reverse(),o=(0,D.Z)(t);try{for(o.s();!(r=o.n()).done;)this.lowerLayer(r.value)}catch(l){o.e(l)}finally{o.f()}}},{key:"moveLayer",value:function(n,t,o){var r=this.layers[o],l=n.zIndex;r.baseLayer||n.baseLayer||(n.zIndex=r.zIndex,r.zIndex=l,this.layers[o]=n,this.layers[t]=r,this.layers$.next(this.layers.slice(0)))}},{key:"doAddLayer",value:function(n,t){n.baseLayer&&n.visible&&this.changeBaseLayer(n);var o=this.getLayerById(n.id);if(void 0===o){if(!n.baseLayer&&n.zIndex&&(n.zIndex+=10),void 0===n.zIndex||0===n.zIndex){var r=Math.max.apply(Math,[n.baseLayer?0:10].concat((0,Fe.Z)(this.layers.filter(function(s){return s.baseLayer===n.baseLayer&&s.zIndex<200}).map(function(s){return s.zIndex}))));n.zIndex=r+1+t}return n.baseLayer&&n.zIndex>9&&(n.zIndex=10),n.setMap(this),this.layerWatcher.watchLayer(n),this.ol.addLayer(n.ol),n}o.visible=!0}},{key:"doRemoveLayer",value:function(n){this.layerWatcher.unwatchLayer(n),this.ol.removeLayer(n.ol),n.setMap(void 0)}},{key:"setLayers",value:function(n){this.layers$.next(this.sortLayersByZIndex(n).slice(0))}},{key:"sortLayersByZIndex",value:function(n){return n.sort(function(t,o){return o.zIndex-t.zIndex})}},{key:"getLayerIndex",value:function(n){return this.layers.findIndex(function(t){return t===n})}},{key:"onOfflineToggle",value:function(n){this.offlineButtonToggle$.next(n)}}]),i}(),dy=["*"],Be=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.activityService=n,this.id="igo-map-target-".concat((new Date).getTime())}return(0,v.Z)(a,[{key:"view",get:function(){return this._view},set:function(t){this._view=t,void 0!==this.map&&this.map.updateView(t)}},{key:"controls",get:function(){return this._controls},set:function(t){this._controls=t,void 0!==this.map&&this.map.updateControls(t)}},{key:"ngOnInit",value:function(){var t=this;this.status$$=this.map.status$.subscribe(function(o){return t.handleStatusChange(o)})}},{key:"ngAfterViewInit",value:function(){this.map.setTarget(this.id)}},{key:"ngOnDestroy",value:function(){this.map.setTarget(void 0),this.activityService.unregister(this.activityId),this.status$$.unsubscribe()}},{key:"handleStatusChange",value:function(t){t===Le.Working&&void 0===this.activityId?this.activityId=this.activityService.register():t===Le.Done&&void 0!==this.activityId&&(this.activityService.unregister(this.activityId),this.activityId=void 0)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(mi))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-map-browser"]],inputs:{map:"map",view:"view"},ngContentSelectors:dy,decls:2,vars:1,consts:[[1,"igo-map-browser-target",3,"id"]],template:function(n,t){1&n&&(e.F$t(),e._UZ(0,"div",0),e.Hsn(1)),2&n&&e.Q6J("id",t.id)},styles:["[_nghost-%COMP%]{position:relative;display:block}[_nghost-%COMP%], .igo-map-browser-target[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]     igo-zoom-button{position:absolute;bottom:50px;right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-zoom-button{display:none}}[_nghost-%COMP%]     igo-offline-button{position:absolute;bottom:15px;right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-offline-button{bottom:5px}}[_nghost-%COMP%]     igo-geolocate-button{position:absolute;bottom:5px;right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-geolocate-button{bottom:5px}}[_nghost-%COMP%]     igo-rotation-button{position:absolute;top:50px;right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-rotation-button{bottom:50px}}[_nghost-%COMP%]     igo-wake-lock-button{position:absolute;top:95px;right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-wake-lock-button{bottom:50px}}[_nghost-%COMP%]     igo-home-extent-button{position:absolute;bottom:135px;right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-home-extent-button{bottom:5px;right:95px}}[_nghost-%COMP%]     igo-user-button{position:absolute;bottom:5px;right:55px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]     igo-user-button{right:90px}}[_nghost-%COMP%]     igo-baselayers-switcher{position:absolute;bottom:5px;left:5px}[_nghost-%COMP%]     .ol-attribution{flex-flow:row;left:50px;bottom:5px;text-align:left;padding:0;margin-right:90px;background-color:#fff0;width:calc(100% - 100px)}[_nghost-%COMP%]     .ol-attribution.ol-logo-only{height:inherit}[_nghost-%COMP%]     .ol-attribution.ol-collapsed{background:none}[_nghost-%COMP%]     .ol-attribution.ol-collapsed button{transform:none}[_nghost-%COMP%]     .ol-attribution button{transform:rotate(180deg);background-color:#fff;cursor:pointer;outline:none}[_nghost-%COMP%]     .ol-scale-line-inner{color:#000;border-color:#000;text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px;box-shadow:0 1px 0 1px #fff9}[_nghost-%COMP%]     .ol-scale-line{background-color:#fff0;bottom:4px;transform:translate(-50%);left:50%}[_nghost-%COMP%]     .ol-scale-bar{background-color:#fff0;bottom:4px;transform:translate(-50%);left:50%}[_nghost-%COMP%]     .ol-scale-text{text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px}[_nghost-%COMP%]     .ol-scale-step-text{text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px}[_nghost-%COMP%]     canvas{display:block}"]}),i}(),gy=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.component=n,this.mediaService=t,this.pointerPositionDelay=1e3,this.pointerPositionCoord=new e.vpe}return(0,v.Z)(a,[{key:"map",get:function(){return this.component.map}},{key:"mapProjection",get:function(){return this.component.map.projection}},{key:"ngOnInit",value:function(){this.listenToMapPointerMove(),this.listenToMapClick()}},{key:"ngOnDestroy",value:function(){this.unlistenToMapPointerMove(),this.unlistenToMapClick()}},{key:"listenToMapPointerMove",value:function(){var t=this;this.pointerMoveListener=this.map.ol.on("pointermove",function(o){return t.onPointerEvent(o,t.pointerPositionDelay)})}},{key:"listenToMapClick",value:function(){var t=this;this.mapClickListener=this.map.ol.on("singleclick",function(o){return t.onPointerEvent(o,0)})}},{key:"unlistenToMapPointerMove",value:function(){(0,st.B)(this.pointerMoveListener),this.pointerMoveListener=void 0}},{key:"unlistenToMapClick",value:function(){this.mapClickListener=void 0}},{key:"onPointerEvent",value:function(t,o){var r=this;if(!t.dragging&&!this.mediaService.isTouchScreen()){void 0!==this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest);var s=(0,re.vs)(t.coordinate,this.mapProjection,"EPSG:4326");this.lastTimeoutRequest=setTimeout(function(){r.pointerPositionCoord.emit(s)},o)}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Be,2),e.Y36(xt))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoPointerPosition",""]],inputs:{pointerPositionDelay:"pointerPositionDelay"},outputs:{pointerPositionCoord:"pointerPositionCoord"}}),i}(),fy=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.component=n,this.mediaService=t,this.styleService=o,this.pointerHoverFeatureStore=new mt([]),this.selectionMVT={},this.hoverFeatureId="hoverFeatureId",this.igoHoverFeatureDelay=1e3,this.igoHoverFeatureEnabled=!1}return(0,v.Z)(a,[{key:"mouseout",value:function(){clearTimeout(this.lastTimeoutRequest),this.clearLayer()}},{key:"map",get:function(){return this.component.map}},{key:"mapProjection",get:function(){return this.component.map.projection}},{key:"ngOnInit",value:function(){var t=this;this.listenToMapPointerMove(),this.subscribeToPointerStore(),this.listenToMapClick(),this.map.status$.pipe((0,We.q)(1)).subscribe(function(){t.store=new Dt([],{map:t.map}),t.initStore()}),this.layers$$=this.map.layers$.subscribe(function(o){t.store&&!o.find(function(r){return"hoverFeatureId"===r.id})&&t.initStore()})}},{key:"initStore",value:function(){var t=this;xo(this.store,new Je({isIgoInternalLayer:!0,id:"hoverFeatureId",title:"hoverFeature",zIndex:900,source:new Re,showInLayerList:!1,exportable:!1,browsable:!1,style:my})),this.selectionLayer=new Ar.Z({map:this.map.ol,zIndex:901,renderMode:"vector",declutter:!0,source:new rc.Z({}),style:function(l,c){if(t.mvtStyleOptions&&l.getId()in t.selectionMVT)return t.createHoverStyle(l,t.mvtStyleOptions,c)}})}},{key:"createHoverStyle",value:function(t,o,r){var s,l=Object.assign({},o),c=o.label?o.label.attribute:void 0,u=!(null===(s=o.label)||void 0===s||!s.style);if(t.get("_isLabel")){for(var p=l.data?l.data.length:0,d=[],g=[],f=[],m=[],y=0;y<p;y++)d.push(0),g.push("rgba(255, 255, 255, 0)"),f.push(0),m.push("rgba(255, 255, 255, 0)");l.radius=d,l.stroke=g,l.width=f,l.fill=m}else l.label=void 0,u=!1,c=void 0;return!u&&c&&(l.label.style={textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:{color:"#000"},backgroundFill:{color:"rgba(255, 255, 255, 0.5)"},backgroundStroke:{color:"rgba(200, 200, 200, 0.75)",width:2},stroke:{color:"#fff",width:3},overflow:!0,offsetX:10,offsetY:20,padding:[2.5,2.5,2.5,2.5]}),this.styleService.createStyleByAttribute(t,l,r)}},{key:"ngOnDestroy",value:function(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unlistenToMapSingleClick(),this.layers$$.unsubscribe()}},{key:"subscribeToPointerStore",value:function(){var t=this;this.store$$=this.pointerHoverFeatureStore.entities$.subscribe(function(o){t.addFeatureOverlay(o)})}},{key:"listenToMapPointerMove",value:function(){var t=this;this.pointerMoveListener=this.map.ol.on("pointermove",function(o){return t.onMapEvent(o)})}},{key:"listenToMapClick",value:function(){var t=this;this.singleClickMapListener=this.map.ol.on("singleclick",function(o){return t.onMapSingleClickEvent(o)})}},{key:"unsubscribeToPointerStore",value:function(){this.store$$.unsubscribe()}},{key:"unlistenToMapPointerMove",value:function(){(0,st.B)(this.pointerMoveListener),this.pointerMoveListener=void 0}},{key:"unlistenToMapSingleClick",value:function(){(0,st.B)(this.singleClickMapListener),this.singleClickMapListener=void 0}},{key:"onMapSingleClickEvent",value:function(t){this.clearLayer()}},{key:"onMapEvent",value:function(t){var o=this;if(t.dragging||!this.igoHoverFeatureEnabled||this.mediaService.isTouchScreen())this.clearLayer();else{void 0!==this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest);var s,r=-1/0,l=this.map.ol.getPixelFromCoordinate(t.coordinate);this.lastTimeoutRequest=setTimeout(function(){if(o.map.ol.forEachFeatureAtPixel(l,function(c,u){if(u){var p=o.map.getLayerByOlUId(u.ol_uid);!o.canProcessHover(p)||p.zIndex<=r||(r=p.zIndex,s=u)}},{hitTolerance:10,layerFilter:function(u){return u instanceof zn.Z||u instanceof Ar.Z}}),!s)return o.clearLayer(),void o.pointerHoverFeatureStore.clear();o.map.ol.forEachFeatureAtPixel(l,function(c,u){var p,d,g,f;if(void 0===c.get("hoverSummary")&&c.getProperties()!==(null===(p=o.pointerHoverFeatureStore.all()[0])||void 0===p?void 0:p.getProperties())){var m;if(o.clearLayer(),u instanceof zn.Z){if(m=o.map.getLayerByOlUId(u.ol_uid),!o.canProcessHover(m))return;var y=o.handleRenderFeature(c);o.setLayerStyleFromOptions(m,y);var _=[y];y.set("_isLabel",!1);var b=new nt.Z;b.setProperties(y.getProperties());var w="Point"===y.getGeometry().getType()?y.getGeometry():new He.Z(t.coordinate);return b.setGeometry(w),b.setId(y.getId()),b.set("_isLabel",!0),o.setLayerStyleFromOptions(m,b),_.push(b),o.pointerHoverFeatureStore.load(_),!0}if(u instanceof Ar.Z){if(m=o.map.getLayerByOlUId(u.ol_uid),!o.canProcessHover(m))return;null!==(g=null===(d=null==m?void 0:m.options)||void 0===d?void 0:d.styleByAttribute)&&void 0!==g&&g.hoverStyle?o.mvtStyleOptions=m.options.styleByAttribute.hoverStyle:!(null===(f=null==m?void 0:m.options)||void 0===f)&&f.hoverStyle&&(o.mvtStyleOptions=m.options.hoverStyle),o.selectionLayer.setSource(u.getSource()),u.getFeatures(t.pixel).then(function(T){if(!T.length)return o.selectionMVT={},o.selectionLayer.changed(),void o.clearLayer();var M=T[0];if(M){var A=o.handleRenderFeature(M);A.set("_isLabel",!1);var L=new nt.Z;L.setProperties(A.getProperties());var Z="Point"===A.getGeometry().getType()?A.getGeometry():new He.Z(t.coordinate);L.setGeometry(Z),L.setId(A.getId()),L.set("_isLabel",!0),o.setLayerStyleFromOptions(m,L),o.pointerHoverFeatureStore.load([L]),o.selectionMVT[M.getId()]=A,o.selectionLayer.changed()}else o.clearLayer()})}}},{hitTolerance:10,layerFilter:function(u){return u===s}})},this.igoHoverFeatureDelay)}}},{key:"canProcessHover",value:function(t){return!(!t||!t.visible||!t.options||!t.options.styleByAttribute&&!t.options.hoverStyle||t.options.styleByAttribute&&!t.options.styleByAttribute.hoverStyle&&!t.options.hoverStyle)}},{key:"handleRenderFeature",value:function(t){var o;return t instanceof cc.ZP?(o=new nt.Z({geometry:this.getGeometry(t)})).setId(t.getId()):t instanceof nt.Z&&(o=t),o.setProperties(t.getProperties()),o}},{key:"addFeatureOverlay",value:function(t){if(t.length>0){var o=t[0];this.clearLayer();var r=new nt.Z({geometry:o.getGeometry(),meta:{id:this.hoverFeatureId},hoverSummary:this.getHoverSummary(o.getProperties())});this.store.setLayerOlFeatures([r],ce.None)}}},{key:"setLayerStyleFromOptions",value:function(t,o){var r,s,l,c=this.store.layer.map.viewController.getResolution();null!==(s=null===(r=null==t?void 0:t.options)||void 0===r?void 0:r.styleByAttribute)&&void 0!==s&&s.hoverStyle?this.store.layer.ol.setStyle(this.createHoverStyle(o,t.options.styleByAttribute.hoverStyle,c)):null!==(l=null==t?void 0:t.options)&&void 0!==l&&l.hoverStyle&&this.store.layer.ol.setStyle(this.createHoverStyle(o,t.options.hoverStyle,c))}},{key:"getHoverSummary",value:function(t){for(var o="",r=0,s=Object.entries(t);r<s.length;r++){var l=(0,Qe.Z)(s[r],2),c=l[0],u=l[1];!c.startsWith("_")&&"geometry"!==c&&(o+="".concat(c,": ").concat(u)+"\n")}return o.length>=2?o.slice(0,-2):o}},{key:"getGeometry",value:function(t){var o;if(t.getOrientedFlatCoordinates){var r=t.getOrientedFlatCoordinates(),s=[];switch(r.forEach(function(l,c){c%2==0&&s.push([parseFloat(r[c]),parseFloat(r[c+1])])}),t.getType()){case"Point":o=new He.Z(s);break;case"Polygon":o=new Tn.ZP([s]);break;case"LineString":o=new dn.Z([s])}}else o=t.getGeometry();return o}},{key:"clearLayer",value:function(){this.selectionMVT={},this.selectionLayer&&this.selectionLayer.changed(),this.store&&this.store.clearLayer()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Be,2),e.Y36(xt),e.Y36(xn))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoHoverFeature",""]],hostBindings:function(n,t){1&n&&e.NdJ("mouseout",function(){return t.mouseout()})},inputs:{igoHoverFeatureDelay:"igoHoverFeatureDelay",igoHoverFeatureEnabled:"igoHoverFeatureEnabled"}}),i}();function my(i,a){var t=[new ee.ZP({text:new Lt.Z({text:i.get("hoverSummary"),textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:new te.Z({color:"#000"}),backgroundFill:new te.Z({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new K.Z({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new K.Z({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:20,padding:[2.5,2.5,2.5,2.5]})})];return"Point"===i.getGeometry().getType()?t.push(new ee.ZP({image:new Ue.Z({radius:10,stroke:new K.Z({color:"blue",width:3})})})):(t.push(new ee.ZP({stroke:new K.Z({color:"white",width:5})})),t.push(new ee.ZP({stroke:new K.Z({color:"blue",width:3})}))),t}var Rc=function(a){return{zoom:a}},vt=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,[{key:"zoom",get:function(){return this.map.viewController.getZoom()}},{key:"minZoom",get:function(){return this.map.viewController.olView.getMinZoom()||1}},{key:"maxZoom",get:function(){return this.map.viewController.olView.getMaxZoom()}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-zoom-button"]],inputs:{map:"map",color:"color"},decls:7,vars:16,consts:[[1,"igo-zoom-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","disabled","click"],["svgIcon","plus"],["svgIcon","minus"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return t.map.viewController.zoomIn()}),e.ALo(2,"translate"),e._UZ(3,"mat-icon",2),e.qZA(),e.TgZ(4,"button",1),e.NdJ("click",function(){return t.map.viewController.zoomOut()}),e.ALo(5,"translate"),e._UZ(6,"mat-icon",3),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("matTooltip",e.xi3(2,6,"igo.geo.mapButtons.zoomIn",e.VKq(12,Rc,t.zoom+1)))("color",t.color)("disabled",t.zoom>=t.maxZoom),e.xp6(3),e.Q6J("matTooltip",e.xi3(5,9,"igo.geo.mapButtons.zoomOut",e.VKq(14,Rc,t.zoom-1)))("color",t.color)("disabled",t.zoom<=t.minZoom))},dependencies:[O.Hw,I.lW,J.gM,E.X$],styles:[".igo-zoom-button-container[_ngcontent-%COMP%]{width:40px}.igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#fff}.igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#efefef}.igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-bottom:2px}button[_ngcontent-%COMP%], [_nghost-%COMP%]     button .mat-button-ripple-round{border-radius:0}"]}),i}();function hy(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",1)(1,"button",2),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.onGeolocationClick())}),e.ALo(2,"translate"),e.ALo(3,"translate"),e._UZ(4,"mat-icon",3),e.ALo(5,"async"),e.qZA()()}if(2&i){var t=e.oxw();e.xp6(1),e.Q6J("matTooltip",t.map.geolocationController.tracking?e.lcZ(2,3,"igo.geo.mapButtons.geolocateInactive"):e.lcZ(3,5,"igo.geo.mapButtons.geolocate"))("color",t.color),e.xp6(3),e.s9C("svgIcon",e.lcZ(5,7,t.icon$))}}var Ri=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.configService=n,this.icon$=new x.X("crosshairs-gps")}return(0,v.Z)(a,[{key:"map",get:function(){return this._map},set:function(t){this._map=t}},{key:"color",get:function(){return this._color},set:function(t){this._color=t}},{key:"ngAfterContentInit",value:function(){var t=this;this.map.ol.once("rendercomplete",function(){t.tracking$$=t.map.geolocationController.tracking$.subscribe(function(o){o||t.configService.getConfig("geolocate.basic")?t.icon$.next("crosshairs-gps"):t.icon$.next("crosshairs")})})}},{key:"ngOnDestroy",value:function(){this.tracking$$&&this.tracking$$.unsubscribe()}},{key:"onGeolocationClick",value:function(){this.map.geolocationController.tracking=!this.map.geolocationController.tracking}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(j))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-geolocate-button"]],inputs:{map:"map",color:"color"},decls:1,vars:1,consts:[["class","igo-geolocate-button-container",4,"ngIf"],[1,"igo-geolocate-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","click"],[3,"svgIcon"]],template:function(n,t){1&n&&e.YNc(0,hy,6,9,"div",0),2&n&&e.Q6J("ngIf",t.map.geolocationController)},dependencies:[C.O5,O.Hw,I.lW,J.gM,C.Ov,E.X$],styles:[".igo-geolocate-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}.igo-geolocate-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}button[_ngcontent-%COMP%], [_nghost-%COMP%]     button .mat-button-ripple-round{border-radius:0}"]}),i}(),Ji=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.configService=n,this.computeHomeExtent()}return(0,v.Z)(a,[{key:"computeHomeExtent",value:function(){this.homeExtentButtonExtent=this.extentOverride||this.configService.getConfig("homeExtentButton.homeExtButtonExtent"),this.homeExtentButtonCenter=this.centerOverride||this.configService.getConfig("homeExtentButton.homeExtButtonCenter"),this.homeExtentButtonZoom=this.zoomOverride||this.configService.getConfig("homeExtentButton.homeExtButtonZoom"),this.centerOverride&&this.zoomOverride&&(this.homeExtentButtonExtent=void 0)}},{key:"onToggleClick",value:function(){if(this.computeHomeExtent(),this.homeExtentButtonExtent)this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);else if(this.homeExtentButtonCenter&&this.homeExtentButtonZoom){var t=re.mi(this.homeExtentButtonCenter,this.map.viewController.olView.getProjection().getCode());this.map.viewController.olView.setCenter(t),this.map.viewController.zoomTo(this.homeExtentButtonZoom)}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(j))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-home-extent-button"]],inputs:{map:"map",color:"color",extentOverride:"extentOverride",centerOverride:"centerOverride",zoomOverride:"zoomOverride"},decls:4,vars:4,consts:[[1,"igo-home-extent-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","click"],["svgIcon","home-map-marker"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return t.onToggleClick()}),e.ALo(2,"translate"),e._UZ(3,"mat-icon",2),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,2,"igo.geo.mapButtons.home-extent"))("color",t.color))},dependencies:[O.Hw,I.lW,J.gM,E.X$],styles:['@charset "UTF-8";.igo-home-extent-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}\\a0[_ngcontent-%COMP%]   .igo-home-extent-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}button[_ngcontent-%COMP%], [_nghost-%COMP%]     button .mat-button-ripple-round{border-radius:0}']}),i}();function yy(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",1)(1,"div")(2,"button",2),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.toggleWakeLock())}),e.ALo(3,"translate"),e.ALo(4,"translate"),e._UZ(5,"mat-icon",3),e.ALo(6,"async"),e.qZA()()()}if(2&i){var t=e.oxw();e.xp6(2),e.Q6J("color",t.color)("matTooltip",t.enabled?e.lcZ(3,3,"igo.geo.mapButtons.preventSreenLock"):e.lcZ(4,5,"igo.geo.mapButtons.letScreenLock")),e.xp6(3),e.s9C("svgIcon",e.lcZ(6,7,t.icon$))}}var _y=function(){var i=function(){function a(n,t){var o=this;(0,h.Z)(this,a),this.config=n,this.storageService=t,this.color="primary",this.icon$=new x.X("sleep"),this.visible=!1,this.visible=!!this.config.getConfig("wakeLockApiButton"),this.noSleep=new mv,qn.satisfies({ie:">0",edge:"<84",chrome:"<84",firefox:">0",opera:"<70",safari:">0"})&&(this.disableWakeLock(),this.enabled=!1,window.onblur=function(){o.disableWakeLock(),o.enabled=!1}),this.enabled?this.enableWakeLock():this.disableWakeLock()}return(0,v.Z)(a,[{key:"enabled",get:function(){return this.storageService.get("wakeLockEnabled")},set:function(t){this.storageService.set("wakeLockEnabled",t)}},{key:"enableWakeLock",value:function(){this.noSleep.enable(),this.enabled=!0,this.icon$.next("sleep-off")}},{key:"disableWakeLock",value:function(){this.noSleep.disable(),this.enabled=!1,this.icon$.next("sleep")}},{key:"toggleWakeLock",value:function(){this.enabled?this.disableWakeLock():this.enableWakeLock()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(j),e.Y36(Te))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-wake-lock-button"]],inputs:{color:"color",map:"map",enabled:"enabled"},decls:1,vars:1,consts:[["class","igo-wake-lock-button-container",4,"ngIf"],[1,"igo-wake-lock-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"color","matTooltip","click"],[3,"svgIcon"]],template:function(n,t){1&n&&e.YNc(0,yy,7,9,"div",0),2&n&&e.Q6J("ngIf",t.visible)},dependencies:[C.O5,O.Hw,I.lW,J.gM,C.Ov,E.X$],styles:[".igo-wake-lock-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}.igo-wake-lock-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}button[_ngcontent-%COMP%], [_nghost-%COMP%]     button .mat-button-ripple-round{border-radius:0}"]}),i}();function Cy(i,a){1&i&&(e.TgZ(0,"div",6)(1,"button",7),e.ALo(2,"translate"),e._UZ(3,"mat-icon",8),e.qZA()()),2&i&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,1,"igo.geo.mapButtons.baselayerSwitcher")))}function Sy(i,a){if(1&i&&(e._UZ(0,"igo-mini-basemap",9),e.ALo(1,"translate")),2&i){var n=a.$implicit,t=a.index,o=e.oxw(2);e.Q6J("map",o.map)("baseLayer",n)("title",o.baseLayers.length>2&&!o.expand?e.lcZ(1,5,"igo.geo.baselayersSwitcher.title"):n.title)("display",o.expand||0===t&&!o.useStaticIcon)("disabled",!o.expand&&o.baseLayers.length>1)}}var wy=function(a){return{"container-expand":a}};function Ty(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",1),e.NdJ("@baseLayerSwitcherState.start",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.showButton=!1)})("@baseLayerSwitcherState.done",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.showButton=!0)})("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.collapseOrExpand())}),e.YNc(1,Cy,4,3,"div",2),e.YNc(2,Sy,2,7,"igo-mini-basemap",3),e.TgZ(3,"div",4),e._UZ(4,"mat-icon",5),e.qZA()()}if(2&i){var t=e.oxw();e.Q6J("ngClass",e.VKq(4,wy,t.expand))("@baseLayerSwitcherState",t.expand?"expand":t.useStaticIcon?"collapseIcon":"collapseMap"),e.xp6(1),e.Q6J("ngIf",t.useStaticIcon&&!t.expand&&t.showButton),e.xp6(1),e.Q6J("ngForOf",t.baseLayers)}}var xy=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.mediaService=n,this._baseLayers=[],this.expand=!1,this.showButton=!0,this.mediaService.media$.value===Xt.Mobile&&void 0===this.useStaticIcon&&(this.useStaticIcon=!0)}return(0,v.Z)(a,[{key:"ngAfterViewInit",value:function(){var t=this;this.layers$$=this.map.layers$.subscribe(function(o){t._baseLayers=o.filter(function(r){return r.baseLayer})})}},{key:"ngOnDestroy",value:function(){this.layers$$.unsubscribe()}},{key:"collapseOrExpand",value:function(){this.expand=!!(this.baseLayers.length>1||this.useStaticIcon)&&!this.expand}},{key:"baseLayers",get:function(){var t=this.map.viewController.getResolution(),o=this.map.viewController.getZoom(),r=this._baseLayers.filter(function(l){return(!l.options.maxResolution||t<=l.options.maxResolution)&&(!l.options.minResolution||t>=l.options.minResolution)&&(!l.options.source.options.maxZoom||o<=l.options.source.options.maxZoom)&&(!l.options.source.options.minZoom||o>=l.options.source.options.minZoom)}),s=r.filter(function(l){return!l.visible});return s.length+1===r.length?s:r}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(xt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-baselayers-switcher"]],inputs:{map:"map",useStaticIcon:"useStaticIcon"},decls:1,vars:1,consts:[["class","igo-baselayers-switcher-container",3,"ngClass","click",4,"ngIf"],[1,"igo-baselayers-switcher-container",3,"ngClass","click"],["class","igo-baselayers-switcher-button-container",4,"ngIf"],["class","mat-typography",3,"map","baseLayer","title","display","disabled",4,"ngFor","ngForOf"],[1,"more-baselayers"],["color","primary","svgIcon","menu-down",1,"material-icons","mat-icon","mat-list-avatar"],[1,"igo-baselayers-switcher-button-container"],["mat-icon-button","","matTooltipPosition","right","color","primary",3,"matTooltip"],["svgIcon","image-multiple"],[1,"mat-typography",3,"map","baseLayer","title","display","disabled"]],template:function(n,t){1&n&&e.YNc(0,Ty,5,6,"div",0),2&n&&e.Q6J("ngIf",t.baseLayers.length>0)},styles:[".igo-baselayers-switcher-container[_ngcontent-%COMP%]{height:auto;position:relative}.container-expand[_ngcontent-%COMP%]{overflow:hidden;border-width:0}.more-baselayers[_ngcontent-%COMP%]{width:80px;height:20px;background-color:#fff;text-align:center;cursor:pointer}.more-baselayers[_ngcontent-%COMP%]:hover{background-color:#efefef}.igo-baselayers-switcher-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}.igo-baselayers-switcher-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}button[_ngcontent-%COMP%], [_nghost-%COMP%]     button .mat-button-ripple-round{border-radius:0}"],data:{animation:[(0,_e.X$)("baseLayerSwitcherState",[(0,_e.SB)("collapseIcon",(0,_e.oB)({height:"40px",width:"40px",overflow:"hidden"})),(0,_e.SB)("collapseMap",(0,_e.oB)({height:"85px",overflow:"hidden"})),(0,_e.SB)("expand",(0,_e.oB)({overflow:"hidden"})),(0,_e.eR)("collapse => expand",(0,_e.jt)("200ms")),(0,_e.eR)("expand => collapse",(0,_e.jt)("200ms"))])]}}),i}(),ky=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.ngxIndexedDBService=n,this.compression=t,this.dbName="geoData",this.collisionsMap=new Map,this._newTiles=0}return(0,v.Z)(a,[{key:"update",value:function(t,o,r,s,l){var c=this;if(r){var g,u=!1,p=new $e.x,d=(0,ge.of)(r);return r instanceof Blob&&(d=this.compression.compressBlob(r),u=!0),d.pipe((0,An.P)(),(0,Vn.b)(function(f){return g={url:t,regionID:o,object:f,compressed:u,insertSource:s,insertEvent:l},c.ngxIndexedDBService.getByID(c.dbName,t)}),(0,Vn.b)(function(f){if(f){var m=f.regionID;if(m!==o){var y=c.collisionsMap.get(m);void 0!==y?(y.push(f.url),c.collisionsMap.set(m,y)):c.collisionsMap.set(m,[f.url])}return c.customUpdate(g)}return c._newTiles++,c.ngxIndexedDBService.add(c.dbName,g)})).subscribe(function(f){p.next(f),p.complete()}),p}}},{key:"customUpdate",value:function(t){var o=this,r=new $e.x;return this.ngxIndexedDBService.deleteByKey(this.dbName,t.url).pipe((0,Vn.b)(function(l){return l?o.ngxIndexedDBService.add(o.dbName,t):(0,ge.of)(void 0)})).subscribe(function(l){l&&r.next(l),r.complete()}),r}},{key:"get",value:function(t){var o=this;return this.ngxIndexedDBService.getByID(this.dbName,t).pipe((0,U.U)(function(r){if(r){var s=r.object;return r.compressed?o.compression.decompressBlob(s):s}}))}},{key:"getByID",value:function(t){return this.ngxIndexedDBService.getByID(this.dbName,t)}},{key:"deleteByKey",value:function(t){return this.ngxIndexedDBService.deleteByKey(this.dbName,t)}},{key:"getRegionTileCountByID",value:function(t){var o=new $e.x;return this.getRegionByID(t).subscribe(function(s){o.next(s.length),o.complete()}),o}},{key:"getRegionByID",value:function(t){if(t){var o=IDBKeyRange.only(t);return this.ngxIndexedDBService.getAllByIndex(this.dbName,"regionID",o)}}},{key:"deleteByRegionID",value:function(t){var o=this;if(t){var r=IDBKeyRange.only(t),s=this.ngxIndexedDBService.getAllByIndex(this.dbName,"regionID",r);return s.subscribe(function(l){l.forEach(function(c){o.ngxIndexedDBService.deleteByKey(o.dbName,c.url)})}),s}}},{key:"openCursor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:IDBKeyRange.lowerBound(0),o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fa.TA.readonly,r=this.ngxIndexedDBService.openCursorByIndex(this.dbName,"regionID",t,o);return r}},{key:"resetCounters",value:function(){this.resetCollisionsMap(),this._newTiles=0}},{key:"resetCollisionsMap",value:function(){this.collisionsMap=new Map}},{key:"revertCollisions",value:function(){var r,t=this,o=(0,D.Z)(this.collisionsMap);try{var s=function(){var g,c=(0,Qe.Z)(r.value,2),u=c[0],d=(0,D.Z)(c[1]);try{for(d.s();!(g=d.n()).done;)t.ngxIndexedDBService.getByKey(t.dbName,g.value).pipe((0,We.q)(1)).subscribe(function(m){m.regionID=u,t.customUpdate(m)})}catch(m){d.e(m)}finally{d.f()}};for(o.s();!(r=o.n()).done;)s()}catch(l){o.e(l)}finally{o.f()}}},{key:"newTiles",get:function(){return this._newTiles}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(fa.ys),e.LFG(pd))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),My=function(){var i=function(){function a(n,t,o){var r=this;(0,h.Z)(this,a),this.http=n,this.geoDBService=t,this.networkService=o,this.networkOnline=!0,this.networkService.currentState().subscribe(function(s){r.networkOnline=s.connection})}return(0,v.Z)(a,[{key:"get",value:function(t,o){return window.navigator.onLine&&this.networkOnline?this.getOnline(t,o):this.getOffline(t)}},{key:"getOnline",value:function(t,o){var r;switch(o.responseType){case"arraybuffer":r=this.http.get(t,{responseType:"arraybuffer",withCredentials:o.withCredentials});break;case"blob":default:r=this.http.get(t,{responseType:"blob",withCredentials:o.withCredentials});break;case"text":r=this.http.get(t,{responseType:"text",withCredentials:o.withCredentials});break;case"json":r=this.http.get(t,{responseType:"json",withCredentials:o.withCredentials})}return r}},{key:"getOffline",value:function(t){return this.geoDBService.get(t)}},{key:"isOnline",value:function(){return this.networkOnline&&window.navigator.onLine}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG(ky),e.LFG(hi))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),Ge=function(){var i=function(){function a(n,t,o,r,s,l,c){(0,h.Z)(this,a),this.http=n,this.styleService=t,this.dataSourceService=o,this.geoNetwork=r,this.messageService=s,this.languageService=l,this.authInterceptor=c}return(0,v.Z)(a,[{key:"createLayer",value:function(t){if(t.source){var o;switch(t.source.options&&t.source.options._layerOptionsFromSource&&(t=se.mergeDeep(t.source.options._layerOptionsFromSource,t||{})),t.source.constructor){case Sc:case hs:case ms:case wc:case Dr:case Di:o=this.createTileLayer(t);break;case Re:case Wo:case vs:case Tc:case gn:o=this.createVectorLayer(t);break;case ys:case Ht:o=this.createImageLayer(t);break;case _s:var r=fc(t);o=this.createVectorTileLayer(r)}return o}}},{key:"createAsyncLayer",value:function(t,o){var r=this,s=fc(t);return s.source?new rt.y(function(l){return l.next(r.createLayer(s))}):this.dataSourceService.createAsyncDataSource(s.sourceOptions,o).pipe((0,U.U)(function(l){if(void 0!==l)return r.createLayer(Object.assign(s,{source:l}))}))}},{key:"createImageLayer",value:function(t){return new ey(t,this.messageService,this.languageService,this.authInterceptor)}},{key:"createTileLayer",value:function(t){return new ty(t,this.messageService,this.authInterceptor)}},{key:"createVectorLayer",value:function(t){var r,s,o=this;if(void 0!==t.style&&(r=function(f,m){return o.styleService.createStyle(t.style,f,m)}),t.source instanceof vs)r=t.source.options.params.style;else if(t.styleByAttribute){var c=this.styleService;t.style=function(g,f){return c.createStyleByAttribute(g,t.styleByAttribute,f)},s=new Je(t,this.messageService,this.authInterceptor,this.geoNetwork)}if(t.source instanceof gn){var u=this.styleService,p=t.clusterBaseStyle;t.style=function(g,f){return u.createClusterStyle(g,f,t.clusterParam,p)},s=new Je(t,this.messageService,this.authInterceptor,this.geoNetwork)}var d=Object.assign({},t,{style:r});return s||(s=new Je(d,this.messageService,this.authInterceptor,this.geoNetwork)),this.applyMapboxStyle(s,d),s}},{key:"createVectorTileLayer",value:function(t){var r,s,o=this;if(void 0!==t.style&&(r=function(p,d){return o.styleService.createStyle(t.style,p,d)}),t.styleByAttribute){var l=this.styleService;t.style=function(u,p){return l.createStyleByAttribute(u,t.styleByAttribute,p)},s=new Ic(t,this.messageService,this.authInterceptor)}var c=Object.assign({},t,{style:r});return s||(s=new Ic(c,this.messageService,this.authInterceptor)),this.applyMapboxStyle(s,c),s}},{key:"applyMapboxStyle",value:function(t,o){var r=this;o.mapboxStyle&&this.getStuff(o.mapboxStyle.url).subscribe(function(s){if(s.sprite){var l=r.getAbsoluteUrl(o.mapboxStyle.url,s.sprite);r.getStuff(l+".json").subscribe(function(c){(0,uc.uX)(t.ol,s,o.mapboxStyle.source,void 0,c,l+".png")})}else(0,uc.uX)(t.ol,s,o.mapboxStyle.source)})}},{key:"getStuff",value:function(t){return this.http.get(t).pipe((0,U.U)(function(o){return o}),(0,Ze.K)(function(o){return console.log("No style was found"),(0,ge.of)(o)}))}},{key:"getAbsoluteUrl",value:function(t,o){return new RegExp("^http|//","i").test(o)?o:"/"===t.substr(t.length-1)?t+o:t+"/"+o}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG(xn),e.LFG(Et),e.LFG(My),e.LFG(Ae),e.LFG($),e.LFG(xr,8))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function Fy(i,a){if(1&i&&(e.TgZ(0,"div",5),e._uU(1),e.qZA()),2&i){var n=e.oxw(2);e.xp6(1),e.hij(" ",n.title," ")}}function Zy(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",2),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.changeBaseLayer(r.baseLayer))}),e._UZ(1,"igo-map-browser",3),e.YNc(2,Fy,2,1,"div",4),e.qZA()}if(2&i){var t=e.oxw();e.xp6(1),e.Q6J("map",t.basemap),e.xp6(1),e.Q6J("ngIf",t.title)}}var Bc=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.layerService=n,this.appRef=t,this.basemap=new ct({controls:{},interactions:!1})}return(0,v.Z)(a,[{key:"baseLayer",get:function(){return this._baseLayer},set:function(t){this._baseLayer=t,this.handleBaseLayerChanged(t)}},{key:"ngAfterViewInit",value:function(){var t=this;this.handleMainMapViewChange(this.map.ol.getView()),this.map.viewController.olView.on("change",function(o){t.handleMainMapViewChange(o.target)}),this.map.ol.on("pointerdrag",function(o){t.handleMainMapViewChange(o.target.getView())})}},{key:"ngOnDestroy",value:function(){var t=this;this.map.viewController.olView.un("change",function(o){t.handleMainMapViewChange(o.target)}),this.map.ol.un("pointerdrag",function(o){t.handleMainMapViewChange(o.target.getView())})}},{key:"changeBaseLayer",value:function(t){this.disabled||(this.map.changeBaseLayer(t),this.appRef.tick())}},{key:"handleMainMapViewChange",value:function(t){var o=t.getProperties();this.basemap.viewController.olView.setResolution(o.resolution),this.basemap.viewController.olView.setRotation(o.rotation),this.basemap.viewController.olView.setCenter(this.map.viewController.getCenter())}},{key:"handleBaseLayerChanged",value:function(t){this.basemap.removeAllLayers();var o=Object.assign(Object.create(t.options),t.options,{visible:!0,baseLayer:!1}),r=this.layerService.createLayer(o);this.basemap.addLayer(r),this.handleLinkedBaseLayer(r)}},{key:"handleLinkedBaseLayer",value:function(t){var o=this,r=t.options.linkedLayers;if(r){var l=r.links;l&&r.linkId===t.options.linkedLayers.linkId&&l.map(function(u){u.linkedIds.map(function(p){var d=o.map.layers.find(function(f){var m;return(null===(m=f.options.linkedLayers)||void 0===m?void 0:m.linkId)===p});if(d){var g=Object.assign(Object.create(d.options),d.options,{zIndex:9e3,visible:!0,baseLayer:!1});o.basemap.addLayer(o.layerService.createLayer(g))}})})}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Ge),e.Y36(e.z2F))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-mini-basemap"]],inputs:{map:"map",disabled:"disabled",display:"display",title:"title",baseLayer:"baseLayer"},decls:2,vars:1,consts:[[1,"igo-mini-basemap-container"],[3,"click",4,"ngIf"],[3,"click"],[3,"map"],["class","igo-mini-basemap-title",4,"ngIf"],[1,"igo-mini-basemap-title"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.YNc(1,Zy,3,2,"div",1),e.qZA()),2&n&&(e.xp6(1),e.Q6J("ngIf",t.display))},styles:[".igo-mini-basemap-container[_ngcontent-%COMP%]{width:80px;height:80px;background-color:#ffffff03;border:2px solid white;box-shadow:0 1px 4px #0000004d;cursor:pointer;margin-top:5px}.igo-mini-basemap-container[_ngcontent-%COMP%]:hover   .igo-mini-basemap-title[_ngcontent-%COMP%]{color:#000;text-shadow:0 0 5px white}.igo-mini-basemap-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}.igo-mini-basemap-title[_ngcontent-%COMP%]{position:relative;top:-76px;height:76px;width:76px;text-align:center;vertical-align:bottom;color:#fff;text-shadow:0 0 5px black;white-space:normal;display:flex;align-items:flex-end;justify-content:center}"]}),i}(),Ay=function(a,n){return{azimuth:a,rotation:n}};function Iy(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",1),e.ALo(1,"async"),e.ALo(2,"translate"),e.ALo(3,"translate"),e.TgZ(4,"button",2),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.map.viewController.resetRotation())}),e.ALo(5,"async"),e._UZ(6,"mat-icon",3),e.ALo(7,"async"),e.qZA()()}if(2&i){var t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,4,t.rotated$)?e.xi3(2,6,"igo.geo.mapButtons.resetRotation",e.WLB(15,Ay,t.azimuthRounded,t.rotationRounded)):e.lcZ(3,9,"igo.geo.mapButtons.tipRotation")),e.xp6(4),e.Q6J("color",t.color)("disabled",!1===e.lcZ(5,11,t.rotated$)),e.xp6(2),e.Q6J("ngStyle",e.lcZ(7,13,t.currentStyle$))}}var Bi=function(){var i=function(){function a(){(0,h.Z)(this,a),this.rotated$=new x.X(!1),this.azimuthRounded=0,this.rotationRounded=0,this.currentStyle$=new x.X({transform:"rotate(0rad)"})}return(0,v.Z)(a,[{key:"ngAfterContentInit",value:function(){var t=this;this.map.viewController.rotation$.subscribe(function(o){var r=o||0,s=180*r/Math.PI;t.rotationRounded=Math.round(s),t.azimuthRounded=Math.round((0,hv.Fh)(-1*s)),t.currentStyle$.next({transform:"rotate("+r+"rad)"}),t.rotated$.next(0!==r)})}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-rotation-button"]],inputs:{map:"map",showIfNoRotation:"showIfNoRotation",color:"color"},decls:2,vars:3,consts:[["class","igo-rotation-button-container","matTooltipPosition","left",3,"matTooltip",4,"ngIf"],["matTooltipPosition","left",1,"igo-rotation-button-container",3,"matTooltip"],["mat-icon-button","","matTooltipPosition","left",3,"color","disabled","click"],["svgIcon","navigation",3,"ngStyle"]],template:function(n,t){1&n&&(e.YNc(0,Iy,8,18,"div",0),e.ALo(1,"async")),2&n&&e.Q6J("ngIf",e.lcZ(1,1,t.rotated$)&&!t.showIfNoRotation||t.showIfNoRotation)},dependencies:[C.O5,C.PC,O.Hw,I.lW,J.gM,C.Ov,E.X$],styles:[".igo-rotation-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}.igo-rotation-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}button[_ngcontent-%COMP%], [_nghost-%COMP%]     button .mat-button-ripple-round{border-radius:0}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){button[_ngcontent-%COMP%]:disabled, [_nghost-%COMP%]     button .mat-button-ripple-round:disabled{display:none}}"]}),i}();function Ly(i,a){if(1&i&&(e.TgZ(0,"div",1)(1,"pre"),e._uU(2),e.qZA()()),2&i){var n=e.oxw();e.xp6(2),e.Oqu(n.infoContent)}}var Oy=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a),this.infoContent=""});return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-info-section"]],inputs:{infoContent:"infoContent"},decls:1,vars:1,consts:[["class","infoSection",4,"ngIf"],[1,"infoSection"]],template:function(n,t){1&n&&e.YNc(0,Ly,3,1,"div",0),2&n&&e.Q6J("ngIf",t.infoContent&&t.infoContent.length)},dependencies:[C.O5],styles:[".infoSection[_ngcontent-%COMP%]{border-radius:10px;background-color:#6e6e6e66;padding:2.5px;position:absolute;text-align:center;top:5px;left:50%;text-shadow:0 0 5px white,0 0 10px white,0 0 15px white}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.infoSection[_ngcontent-%COMP%]{top:50px;left:10%}}"]}),i}(),yt=function(){return(i=yt||(yt={})).Layer="layer",i.Group="group",yt;var i}(),Oe=function(){return(i=Oe||(Oe={}))[i.wms=0]="wms",i[i.wmts=1]="wmts",i[i.baselayers=2]="baselayers",i[i.arcgisrest=3]="arcgisrest",i[i.tilearcgisrest=4]="tilearcgisrest",i[i.imagearcgisrest=5]="imagearcgisrest",i[i.composite=6]="composite",Oe;var i}(),ni=(0,v.Z)(function i(a,n){(0,h.Z)(this,i),Object.assign(this,a),this.catalogService=n}),Dy=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o){var r;return(0,h.Z)(this,n),(r=a.call(this,t,o)).type=Oe[Oe[Oe.wms]],r}return(0,v.Z)(n,[{key:"collectCatalogItems",value:function(){return this.catalogService.loadCatalogWMSLayerItems(this)}}]),n}(ni),Py=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o){var r;return(0,h.Z)(this,n),(r=a.call(this,t,o)).type=Oe[Oe[Oe.wmts]],r}return(0,v.Z)(n,[{key:"collectCatalogItems",value:function(){return this.catalogService.loadCatalogWMTSLayerItems(this)}}]),n}(ni),Ey=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o){var r;return(0,h.Z)(this,n),(r=a.call(this,t,o)).type=Oe[Oe[Oe.baselayers]],r}return(0,v.Z)(n,[{key:"collectCatalogItems",value:function(){return this.catalogService.loadCatalogBaseLayerItems(this)}}]),n}(ni),$y=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o){var r;return(0,h.Z)(this,n),(r=a.call(this,t,o)).type=Oe[Oe[Oe.arcgisrest]],r}return(0,v.Z)(n,[{key:"collectCatalogItems",value:function(){return this.catalogService.loadCatalogArcGISRestItems(this)}}]),n}(ni),Uc=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o,r){var s;return(0,h.Z)(this,n),(s=a.call(this,t,o)).type=Oe[Oe[r]],s}return(0,v.Z)(n,[{key:"collectCatalogItems",value:function(){return this.catalogService.loadCatalogArcGISRestItems(this)}}]),n}(ni),Ry=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o){var r;return(0,h.Z)(this,n),(r=a.call(this,t,o)).type=Oe[Oe[Oe.composite]],r.url=null,r}return(0,v.Z)(n,[{key:"collectCatalogItems",value:function(){return this.catalogService.loadCatalogCompositeLayerItems(this)}}]),n}(ni),Nc=function(){function i(){(0,h.Z)(this,i)}return(0,v.Z)(i,null,[{key:"createInstanceCatalog",value:function(n,t){return n.hasOwnProperty("composite")?new Ry(n,t):n.type===Oe[Oe.baselayers]?new Ey(n,t):n.type===Oe[Oe.arcgisrest]?new $y(n,t):n.type===Oe[Oe.tilearcgisrest]?new Uc(n,t,Oe.tilearcgisrest):n.type===Oe[Oe.imagearcgisrest]?new Uc(n,t,Oe.imagearcgisrest):n.type===Oe[Oe.wmts]?new Py(n,t):new Dy(n,t)}}]),i}(),Cs=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.http=n,this.messageService=t,this.languageService=o,this.queryEnabled=!0,this.defaultFeatureCount=20,this.featureCount=20,this.previousMessageIds=[]}return(0,v.Z)(a,[{key:"query",value:function(t,o){var r=this;return this.previousMessageIds.length&&this.previousMessageIds.forEach(function(s){r.messageService.remove(s)}),t.filter(function(s){return s.visible&&s.isInResolutionsRange}).map(function(s){return r.queryLayer(s,o)})}},{key:"queryLayer",value:function(t,o){var r=this,s=this.getQueryUrl(t.dataSource,o,!1,t.map.viewController.getExtent());if(!s)return(0,ge.of)([]);if(t.dataSource.options.queryFormat===Xe.HTMLGML2){var l=this.getQueryUrl(t.dataSource,o,!0);return this.http.get(l,{responseType:"text"}).pipe((0,Vl.z)(function(u){var p=r.mergeGML(u,s,t),d=p[0],g=p[1];return r.http.get(s,{responseType:"text"}).pipe((0,U.U)(function(f){return r.extractData(f,t,o,s,d,g)}))}))}return this.http.get(s,{responseType:"text"}).pipe((0,U.U)(function(u){return r.extractData(u,t,o,s)}))}},{key:"mergeGML",value:function(t,o,r){var s,l,u=(new os.Z).readFeatures(t);0===u.length&&(u=(new ec.Z).readFeatures(t));var g,y,L,Z,V,P,d=new fv.Z([]),f=[],m=new lc.Z([]),_=u.length,T=this.getQueryParams(o.toLowerCase()).bbox.split(","),M=Ke.lJ();if(Ke.l7(M,T),null!==(l=null===(s=r.options)||void 0===s?void 0:s.source)&&void 0!==l&&l.options){var R=r.options.source.options;R.queryTitle&&(Z=R.queryTitle)}switch(u.map(function(pe){if(Z){var ue=pe.getProperties()[Z];ue&&(L=L?"".concat(L,",").concat(ue):ue)}var oe=pe.getGeometry().getCoordinates(),Q=pe.getGeometry().getType();switch(!y&&(y=Q),Q){case"Point":1===_?g=new He.Z(oe,"XY"):f.push(oe);break;case"LineString":d.appendLineString(new dn.Z(oe,"XY"));break;case"Polygon":m.appendPolygon(new Tn.ZP(oe,"XY"));break;case"MultiPolygon":m=new lc.Z(oe,"XY");break;default:return}}),V=0===f.length&&g?{type:g.getType(),coordinates:g.getCoordinates()}:{type:"Polygon",coordinates:[this.convexHull(f)]},y){case"LineString":P={type:d.getType(),coordinates:d.getCoordinates()};case"Point":P=V;case"Polygon":P={type:m.getType(),coordinates:m.getCoordinates()};case"MultiPolygon":P={type:m.getType(),coordinates:m.getCoordinates()}}var Y={};return Z&&(Y[Z]=L),[P,Y]}},{key:"cross",value:function(t,o,r){return(t[0]-r[0])*(o[1]-r[1])-(t[1]-r[1])*(o[0]-r[0])}},{key:"convexHull",value:function(t){t.sort(function(p,d){return p[0]===d[0]?p[1]-d[1]:p[0]-d[0]});var s,o=[],r=(0,D.Z)(t);try{for(r.s();!(s=r.n()).done;){for(var l=s.value;o.length>=2&&this.cross(o[o.length-2],o[o.length-1],l)<=0;)o.pop();o.push(l)}}catch(p){r.e(p)}finally{r.f()}for(var c=[],u=t.length-1;u>=0;u--){for(;c.length>=2&&this.cross(c[c.length-2],c[c.length-1],t[u])<=0;)c.pop();c.push(t[u])}return c.pop(),o.pop(),o.concat(c)}},{key:"extractData",value:function(t,o,r,s,l,c){var p,d,g,u=this,f=o.dataSource,m=this.getAllowedFieldsAndAlias(o),y=[];switch(f.options.queryFormat){case Xe.GML3:y=this.extractGML3Data(t,o.zIndex,m);break;case Xe.JSON:case Xe.GEOJSON:case Xe.GEOJSON2:y=this.extractGeoJSONData(t,o.zIndex,m);break;case Xe.ESRIJSON:y=this.extractEsriJSONData(t,o.zIndex,m);break;case Xe.TEXT:y=this.extractTextData(t);break;case Xe.HTML:y=this.extractHtmlData(t,f.queryHtmlTarget,s);break;case Xe.HTMLGML2:y=this.extractHtmlData(t,f.queryHtmlTarget,s,l,c);break;default:y=this.extractGML2Data(t,o,m)}if(y.length>0&&null===y[0].geometry){var w,_=this.createGeometryFromUrlClick(s),b=(0,D.Z)(y);try{for(b.s();!(w=b.n()).done;)w.value.geometry=_}catch(L){b.e(L)}finally{b.f()}}var M=o.dataSource;return(null!==(p=M.params)&&void 0!==p&&p.FEATURE_COUNT?new RegExp("FEATURE_COUNT="+this.featureCount):new RegExp("FEATURE_COUNT="+this.defaultFeatureCount)).test(s)&&((null===(d=M.params)||void 0===d?void 0:d.FEATURE_COUNT)&&y.length===this.featureCount||!(null!==(g=M.params)&&void 0!==g&&g.FEATURE_COUNT)&&y.length===this.defaultFeatureCount)&&this.languageService.translate.get("igo.geo.query.featureCountMax",{value:o.title}).subscribe(function(L){var Z=u.messageService.info(L);u.previousMessageIds.push(Z.toastId)}),y.map(function(L,Z){var R,P,V=L.properties[f.mapLabel];if("wms"===(null===(R=o.options.sourceOptions)||void 0===R?void 0:R.type)){var Y=o.options.sourceOptions;P=Y?Y.excludeAttribute:void 0}var pe=u.getQueryTitle(L,o);!pe&&y.length>1?pe="".concat(o.title," (").concat(Z+1,")"):pe||(pe=o.title);var ue=Object.assign({},L.meta||{},{id:Ye(),title:pe,mapTitle:V,sourceTitle:o.title,order:1e3-o.zIndex,excludeAttribute:P});return Object.assign(L,{meta:ue,projection:"carto"===f.options.type?"EPSG:4326":r.projection})})}},{key:"createGeometryFromUrlClick",value:function(t){var o=this.getQueryParams(t.toLowerCase()),r=o.bbox,s=parseInt(o.width,10),l=parseInt(o.height,10),c=parseInt(o.i||o.x,10),u=parseInt(o.j||o.y,10),p=r.split(","),d=.05*(Math.abs(parseFloat(p[0]))-Math.abs(parseFloat(p[2])));Math.abs(parseFloat(p[0]))<180&&(d=.045);var g=parseFloat(p[0])+Math.abs(parseFloat(p[0])-parseFloat(p[2]))*c/s-d,f=parseFloat(p[1])+Math.abs(parseFloat(p[1])-parseFloat(p[3]))*u/l-d,m=g+2*d,y=f+2*d,_="POLYGON(("+g+" "+f+", "+g+" "+y+", "+m+" "+y+", "+m+" "+f+", "+g+" "+f+"))",T=(new Fi.Z).readFeature(_).getGeometry();return{type:T.getType(),coordinates:T.getCoordinates()}}},{key:"extractGML2Data",value:function(t,o,r){var s=this,c=(new os.Z).readFeatures(t);if(0===c.length){var u=new ec.Z;try{c=u.readFeatures(t)}catch(p){console.warn("query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.")}}return c.map(function(p){return s.featureToResult(p,o,r)})}},{key:"extractGML3Data",value:function(t,o,r){var s=this,l=new nc.Z,c=[];try{c=l.readFeatures(t)}catch(u){console.warn("query.service: GML3 is not well supported")}return c.map(function(u){return s.featureToResult(u,o,r)})}},{key:"extractGeoJSONData",value:function(t,o,r){var s=[];try{s=JSON.parse(t.replace(/(\r|\n)/g," ")).features}catch(l){console.warn("query.service: Unable to parse geojson","\n",t)}return s.map(function(l){return l.meta={id:Ye(),order:1e3-o,alias:r}}),s}},{key:"extractEsriJSONData",value:function(t,o,r){var s=this;if(t)try{if(JSON.parse(t).error)return[]}catch(u){}return(new Zr.Z).readFeatures(t).map(function(u){return s.featureToResult(u,o,r)})}},{key:"extractTextData",value:function(t){return[]}},{key:"extractHtmlData",value:function(t,o,r,s,l){var c=this.getQueryParams(r.toLowerCase()),u=c.crs||c.srs||"EPSG:3857",p=this.createGeometryFromUrlClick(r);o!==fn.BLANK&&o!==fn.IFRAME&&(o=fn.IFRAME);var d=t.toLowerCase().indexOf("<body>"),g=t.toLowerCase().lastIndexOf("</body>")+7;return""===vv(t.slice(d,g).replace(/(\r|\n|\s)/g,""))||""===t?[]:[{type:be,projection:u,properties:Object.assign({target:o,body:t,url:r},l),geometry:s||p}]}},{key:"getQueryParams",value:function(t){var o=t.split("?");if(o[1]){var r=o[1].split("&"),s={};return r.forEach(function(l){l=l.split("="),s[l[0]]=decodeURIComponent(l[1]||"")}),s}}},{key:"featureToResult",value:function(t,o,r){var c,s=t.getGeometry(),l=Object.assign({},t.getProperties());return delete l.geometry,delete l.GEOMETRIE,delete l.boundedBy,delete l.shape,delete l.SHAPE,delete l.SHAPE_S,delete l.SHAPE_L,delete l.SHAPE_P,delete l.the_geom,delete l.geom,s&&(c={type:s.getType(),coordinates:s.getCoordinates()}),{type:be,projection:void 0,properties:l,geometry:c,meta:{id:Ye(),order:1e3-o,alias:r}}}},{key:"getQueryUrl",value:function(t,o){var l,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3?arguments[3]:void 0;if(t.options.queryUrl)return this.getCustomQueryUrl(t,o,s);switch(t.constructor){case Ht:var c=t,u={INFO_FORMAT:c.params.INFO_FORMAT||this.getMimeInfoFormat(t.options.queryFormat),QUERY_LAYERS:c.params.LAYERS,FEATURE_COUNT:c.params.FEATURE_COUNT||this.defaultFeatureCount};c.params.FEATURE_COUNT&&(this.featureCount=c.params.FEATURE_COUNT),r&&(u.INFO_FORMAT=this.getMimeInfoFormat(Xe.GML2)),l=c.ol.getFeatureInfoUrl(o.coordinates,o.resolution,o.projection,u);break;case Dr:var p=t,d="https://"+p.options.account+".carto.com/api/v2/sql?",g="format=GeoJSON",f="&q="+p.options.config.layers[0].options.sql,m=" WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(",y=p.options.queryPrecision?p.options.queryPrecision:"1000",_=o.coordinates[0]+","+o.coordinates[1]+"),3857),"+y+"))";l="".concat(d).concat(g).concat(f).concat(m).concat(_);break;case ys:case Di:var b=t,w=Math.abs(s[0]-s[2]),T=Math.abs(s[1]-s[3]),M=w>T?w:T,A=.005*M,L=b.options.queryPrecision?b.options.queryPrecision:A,Z=Ke.f3(Ke.hI([o.coordinates]),L),R=b.options.url+"/"+b.options.layer+"/query/",V=encodeURIComponent('{"xmin":'+Z[0]+',"ymin":'+Z[1]+',"xmax":'+Z[2]+',"ymax":'+Z[3]+',"spatialReference":{"wkid":102100}}'),P=["f=json","geometry=".concat(V),"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"];l="".concat(R,"?").concat(P.join("&"))}return l}},{key:"getMimeInfoFormat",value:function(t){var o="application/vnd.ogc.gml",r=Object.keys(Xe).find(function(s){return Xe[s]===t});return r&&(o=rn[r]),o}},{key:"getAllowedFieldsAndAlias",value:function(t){var o,r,s,l;return(null===(s=null===(r=null===(o=t.options)||void 0===o?void 0:o.source)||void 0===r?void 0:r.options)||void 0===s?void 0:s.sourceFields)&&t.options.source.options.sourceFields.length>=1&&(l={},t.options.source.options.sourceFields.forEach(function(c){l[c.name]=c.alias?c.alias:c.name})),l}},{key:"getQueryTitle",value:function(t,o){var r,s,l;if(null!==(s=null===(r=o.options)||void 0===r?void 0:r.source)&&void 0!==s&&s.options){var c=o.options.source.options;c.queryTitle&&(l=this.getLabelMatch(t,c.queryTitle))}return l}},{key:"getLabelMatch",value:function(t,o){var r=o,s=Array.from(o.matchAll(/\$\{([^\{\}]+)\}/g));return s.forEach(function(l){r=r.replace(l[0],t.properties[l[1]])}),0===s.length&&r===o&&(r=t.properties[o]||o),r}},{key:"getCustomQueryUrl",value:function(t,o,r){return t.options.queryUrl.replace(/\{xmin\}/g,r[0].toString()).replace(/\{ymin\}/g,r[1].toString()).replace(/\{xmax\}/g,r[2].toString()).replace(/\{ymax\}/g,r[3].toString()).replace(/\{x\}/g,o.coordinates[0].toString()).replace(/\{y\}/g,o.coordinates[1].toString()).replace(/\{resolution\}/g,o.resolution.toString()).replace(/\{srid\}/g,o.projection.replace("EPSG:",""))}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG(Ae),e.LFG($))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function Ui(i){return!0===i.dataSource.options.queryable}function By(i){var a=i.get("_layer");return void 0!==a&&Ui(a)&&function Jy(i){var a=i.dataSource;return void 0===a.options.queryLayerFeatures||!0===a.options.queryLayerFeatures}(a)}var qc=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.component=n,this.queryService=t,this.queries$$=[],this.queryFeatures=!1,this.queryFeaturesHitTolerance=0,this.waitForAllQueries=!0,this.query=new e.vpe}return(0,v.Z)(a,[{key:"map",get:function(){return this.component.map}},{key:"ngAfterViewInit",value:function(){this.listenToMapClick(),this.addDragBoxInteraction()}},{key:"ngOnDestroy",value:function(){this.cancelOngoingQueries(),this.unlistenToMapClick(),this.removeDragBoxInteraction()}},{key:"listenToMapClick",value:function(){var t=this;this.mapClickListener=this.map.ol.on("singleclick",function(o){return t.onMapEvent(o)})}},{key:"unlistenToMapClick",value:function(){(0,st.B)(this.mapClickListener),this.mapClickListener=void 0}},{key:"onMapEvent",value:function(t){var o=this;if(this.cancelOngoingQueries(),this.queryService.queryEnabled){var r=[];this.queryFeatures&&r.push(this.doQueryFeatures(t));var s=this.map.ol.getView().getResolution(),l=this.map.layers.filter(Ui);r.push.apply(r,(0,Fe.Z)(this.queryService.query(l,{coordinates:t.coordinate,projection:this.map.projection,resolution:s}))),0!==r.length&&(this.waitForAllQueries?this.queries$$.push(kr.$.apply(void 0,r).subscribe(function(c){var u,p=(u=[]).concat.apply(u,(0,Fe.Z)(c));o.query.emit({features:p,event:t})})):this.queries$$=r.map(function(c){return c.subscribe(function(u){o.query.emit({features:u,event:t})})}))}}},{key:"doQueryFeatures",value:function(t){var o=this,r=[];if("singleclick"===t.type)this.map.ol.forEachFeatureAtPixel(t.pixel,function(c,u){var p=o.map.getLayerById(u.values_._layer.id);if(!p.dataSource.options.queryFormatAsWms&&c)if(c.get("features")){var g,d=(0,D.Z)(c.get("features"));try{for(d.s();!(g=d.n()).done;){var f=g.value,m=To(f,o.map.projection);m.meta={title:f.values_.nom,id:u.values_._layer.id+"."+f.id_,icon:f.values_._icon,sourceTitle:u.values_.title,alias:o.queryService.getAllowedFieldsAndAlias(p)},r.push(m)}}catch(b){d.e(b)}finally{d.f()}}else if(c instanceof cc.ZP){var y=function Hv(i,a,n){var o,r,s,l,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"EPSG:4326";n?(r=n.get("title"),n.get("sourceOptions")&&(s=n.get("sourceOptions").excludeAttribute,l=n.get("sourceOptions").excludeAttributeOffline)):r=i.get("_title");var c=new Ee.Z,u=i.getProperties(),p=i.getType();if("Polygon"===p){var d=i.getEnds();o=new Tn.ZP(i.getFlatCoordinates(),"XY",d)}else"Point"===p?o=new He.Z(i.getFlatCoordinates(),"XY"):"LineString"===p&&(o=new dn.Z(i.getFlatCoordinates(),"XY"));var g=c.writeGeometryObject(o,{dataProjection:t,featureProjection:a}),f=i.getId()?i.getId():Ye(),m=i.get("_mapTitle"),y=re.$A(i.getExtent(),a,t);return{type:be,projection:t,extent:y,meta:{id:f,title:r||m||f,mapTitle:m,excludeAttribute:s,excludeAttributeOffline:l},properties:u,geometry:g,ol:i}}(c,o.map.projection,u);y.meta={id:u.values_._layer.id+"."+y.meta.id,sourceTitle:u.values_.title,alias:o.queryService.getAllowedFieldsAndAlias(p),title:o.queryService.getQueryTitle(y,p)||y.meta.title},r.push(y)}else{var _=To(c,o.map.projection,u);_.meta={id:u.values_._layer.id+"."+_.meta.id,sourceTitle:u.values_.title,alias:o.queryService.getAllowedFieldsAndAlias(p),title:o.queryService.getQueryTitle(_,p)||_.meta.title},r.push(_)}},{hitTolerance:this.queryFeaturesHitTolerance||0,layerFilter:this.queryFeaturesCondition?this.queryFeaturesCondition:By});else if("boxend"===t.type){var l=t.target.getGeometry().getExtent();this.map.layers.filter(Ui).filter(function(c){return c instanceof Je&&c.visible}).map(function(c){c.dataSource.ol.forEachFeatureIntersectingExtent(l,function(p){var d=To(p,o.map.projection,c.ol);d.meta={id:c.id+"."+p.getId(),icon:p.values_._icon,sourceTitle:c.title,alias:o.queryService.getAllowedFieldsAndAlias(c),title:o.queryService.getQueryTitle(d,c)||d.meta.title},r.push(d)})})}return(0,ge.of)(r)}},{key:"cancelOngoingQueries",value:function(){this.queries$$.forEach(function(t){return t.unsubscribe()}),this.queries$$=[]}},{key:"addDragBoxInteraction",value:function(){var o,l,t=this,r=this.map.ol.getInteractions().getArray(),s=(0,D.Z)(r);try{for(s.s();!(l=s.n()).done;){var c=l.value;if(c instanceof Jr){o=c;break}}}catch(u){s.e(u)}finally{s.f()}void 0===o&&(o=new Jr({condition:Lr}),this.map.ol.addInteraction(o),this.olDragSelectInteraction=o),this.olDragSelectInteractionEndKey=o.on("boxend",function(u){return t.onMapEvent(u)})}},{key:"removeDragBoxInteraction",value:function(){void 0!==this.olDragSelectInteractionEndKey&&(0,st.B)(this.olDragSelectInteractionEndKey),void 0!==this.olDragSelectInteraction&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=void 0}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Be,2),e.Y36(Cs))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoQuery",""]],inputs:{queryFeatures:"queryFeatures",queryFeaturesHitTolerance:"queryFeaturesHitTolerance",queryFeaturesCondition:"queryFeaturesCondition",waitForAllQueries:"waitForAllQueries"},outputs:{query:"query"}}),i}(),St=function(){var i=function(){function a(n,t){var o=this;if((0,h.Z)(this,a),this.storageService=t,this.options=n,this.storageService){var r=this.storageService.get(this.getId()+".options");r&&(this.options=se.mergeDeep(this.options,r))}this.options=se.mergeDeep(this.getDefaultOptions(),this.options),this.settings.forEach(function(s){o.setParamFromSetting(s,!1)})}return(0,v.Z)(a,[{key:"getId",value:function(){throw new Error('You have to implement the method "getId".')}},{key:"getType",value:function(){throw new Error('You have to implement the method "getType".')}},{key:"getDefaultOptions",value:function(){throw new Error('You have to implement the method "getDefaultOptions".')}},{key:"title",get:function(){return this.options.title}},{key:"available",get:function(){return!1!==this.options.available}},{key:"enabled",get:function(){return this.available&&!1!==this.options.enabled},set:function(t){this.options.enabled=t}},{key:"showInPointerSummary",get:function(){return this.options.showInPointerSummary||!1}},{key:"showInSettings",get:function(){var t=this.options.showInSettings;return void 0===t||t}},{key:"searchUrl",get:function(){return this.options.searchUrl}},{key:"params",get:function(){return void 0===this.options.params?{}:this.options.params}},{key:"settings",get:function(){return void 0===this.options.settings?[]:this.options.settings}},{key:"setParamFromSetting",value:function(t){var o=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(t.type){case"radiobutton":t.values.forEach(function(l){l.enabled&&(o.options.params=Object.assign(o.options.params||{},(0,de.Z)({},t.name,l.value)))});break;case"checkbox":var s="";t.values.filter(function(l){return!1!==l.available}).forEach(function(l){l.enabled&&(s+=l.value+",")}),s=s.slice(0,-1),this.options.params=Object.assign(this.options.params||{},(0,de.Z)({},t.name,s))}r&&this.storageService&&this.storageService.set(this.getId()+".options",{params:this.options.params})}},{key:"displayOrder",get:function(){return void 0===this.options.order?99:this.options.order}},{key:"getHashtagsValid",value:function(t,o){var r=t.match(/(#[A-Za-z+]+)/g);if(r){var s=this.getSettingsValues(o),l=[];return r.forEach(function(c){s.values.forEach(function(u){var p=c.substring(1);if("string"==typeof u.value){var d=u.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(","),g=d.indexOf(p.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""));-1!==g&&l.push(d[g])}u.hashtags&&-1!==u.hashtags.indexOf(p.toLowerCase())&&l.push(u.value)})}),l.filter(function(c,u){return l.indexOf(c)===u})}}},{key:"getSettingsValues",value:function(t){return this.getDefaultOptions().settings.find(function(o){return o.name===t})}}]),a}();return i.id="",i.type="",i}(),Gc=function(){var i=function(a){(0,N.Z)(t,a);var n=(0,q.Z)(t);function t(o){return(0,h.Z)(this,t),n.call(this,o)}return(0,v.Z)(t,[{key:"getId",value:function(){return t.id}},{key:"getType",value:function(){return t.type}},{key:"getDefaultOptions",value:function(){return{title:"Carte"}}}]),t}(St);return i.id="map",i.type=be,i.\u0275fac=function(n){return new(n||i)(e.LFG("options"))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i}(),ln=function(){function i(){(0,h.Z)(this,i)}return(0,v.Z)(i,null,[{key:"getGoogleMapsCoordLink",value:function(n,t){return"https://www.google.com/maps?q="+t+","+n}},{key:"getGoogleStreetViewLink",value:function(n,t){return"https://www.google.com/maps?q=&layer=c&cbll="+t+","+n}},{key:"getGoogleMapsNameLink",value:function(n){return"https://www.google.com/maps?q="+encodeURI(n)}}]),i}();function oo(i){var n=i.markerColor,o=i.markerOpacity,s=i.markerOutlineColor,u=i.fillOpacity,d=i.strokeColor,f=i.strokeOpacity,y=i.strokeWidth;return function Ss(i){var w,T,a=i.feature,n=i.markerColor,t=void 0===n?[0,161,222]:n,o=i.markerOpacity,r=void 0===o?.5:o,s=i.markerOutlineColor,l=i.fillColor,c=void 0===l?[0,161,222]:l,u=i.fillOpacity,p=void 0===u?.15:u,d=i.strokeColor,g=void 0===d?[0,161,222]:d,f=i.strokeOpacity,m=void 0===f?.5:f,y=i.strokeWidth,_=void 0===y?2:y,b=a instanceof nt.Z;b?w=a.getGeometry():(w=a.geometry,T=a.meta.mapTitle);var M=b?w.getType():w.type;if(w&&"Point"!==M){var Z=(0,Wn._2)(c).slice(0),R=(0,Wn._2)(g).slice(0);return 4===Z.length&&("string"!=typeof c||/^#[0-9A-F]{8}$/i.test(c))||(Z[3]=p),4===R.length&&("string"!=typeof g||/^#[0-9A-F]{8}$/i.test(g))||(R[3]=m),Ac({text:T,strokeWidth:_,strokeColor:R,fillColor:Z})}var A=(0,Wn._2)(t).slice(0),L=A.slice(0,3);return 4===A.length&&("string"!=typeof t||/^#[0-9A-F]{8}$/i.test(t))&&(r=A[3]),no({text:T,opacity:r,markerOutlineColor:s,markerColor:L})}({feature:i.feature,markerColor:void 0===n?[0,161,222]:n,markerOpacity:void 0===o?1:o,markerOutlineColor:void 0===s?[0,255,255]:s,fillColor:i.fillColor,fillOpacity:void 0===u?.15:u,strokeColor:void 0===d?[0,255,255]:d,strokeOpacity:void 0===f?.5:f,strokeWidth:void 0===y?4:y})}var Uy=function(){function i(){(0,h.Z)(this,i)}return(0,v.Z)(i,null,[{key:"getOpenStreetMapLink",value:function(n,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:17;return"https://www.openstreetmap.org/?mlat=".concat(t,"&mlon=").concat(n,"#map=").concat(o,"/").concat(t,"/").concat(n)}},{key:"getOpenStreetCamLink",value:function(n,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:17;return"https://openstreetcam.org/map/@".concat(t,",").concat(n,",").concat(o,"z")}}]),i}(),ws=function(){var i=function(){function a(n,t,o,r,s){(0,h.Z)(this,a),this.http=n,this.config=t,this.languageService=o,this.messageService=r,this.capabilitiesService=s}return(0,v.Z)(a,[{key:"loadCatalogs",value:function(){var t=this.config.getConfig("context")||{},o=this.config.getConfig("catalog")||{},r=o.url||t.url,s=o.sources||[],l=[];if(r){if(o.baseLayers){var p=[{id:"catalog.baselayers",title:this.languageService.translate.instant("igo.geo.catalog.baseLayers"),url:"".concat(r,"/baselayers"),type:"baselayers"}];l.push((0,ge.of)(p))}var d=this.http.get("".concat(r,"/catalogs")).pipe((0,U.U)(function(g){return g.map(function(f){return Object.assign(f,f.options)})}),(0,Ze.K)(function(g){return _o.E}));l.push(d)}return s.length>0&&l.push((0,ge.of)(s).pipe((0,U.U)(function(g){return g.map(function(f){return f.id||(f.id=Ye()),f})}))),kr.$.apply(void 0,l).pipe((0,U.U)(function(g){return[].concat.apply([],g)}))}},{key:"loadCatalogItems",value:function(t){return Nc.createInstanceCatalog(t,this).collectCatalogItems()}},{key:"loadCatalogBaseLayerItems",value:function(t){return this.getCatalogBaseLayersOptions(t).pipe((0,U.U)(function(o){var r=o.map(function(s){return{id:Oi(s.sourceOptions),title:s.title,type:yt.Layer,externalProvider:t.externalProvider,options:s}});return[{id:"catalog.group.baselayers",type:yt.Group,externalProvider:t.externalProvider,title:t.title,items:r}]}))}},{key:"getCatalogBaseLayersOptions",value:function(t){return this.http.get(t.url)}},{key:"loadCatalogWMSLayerItems",value:function(t){var o=this;return this.getCatalogCapabilities(t).pipe((0,U.U)(function(r){var s=[];if(!r)return s;r.Service&&r.Service.Abstract&&r.Service.Abstract.length&&(t.abstract=r.Service.Abstract);var l=[];o.flattenWmsCapabilities(r.Capability.Layer,0,l,t.groupSeparator);var c=Object.assign({},r.Capability.Layer);return c.Layer=l.filter(function(u){return 0!==u.Layer.length}),o.includeRecursiveItems(t,c,s),s}))}},{key:"flattenWmsCapabilities",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:" / ";if(!r.includes(t.Title)){var l=Object.assign({},t);l.Layer=[],r.push(l)}var u,c=(0,D.Z)(t.Layer);try{for(c.s();!(u=c.n()).done;){var p=u.value,d=Object.assign({},p);o>0&&(d.Title=t.Title+s+p.Title),p.Layer?this.flattenWmsCapabilities(d,o+1,r,s):r.find(function(g){return g.Title===t.Title}).Layer.push(p)}}catch(g){c.e(g)}finally{c.f()}}},{key:"loadCatalogWMTSLayerItems",value:function(t){var o=this;return this.getCatalogCapabilities(t).pipe((0,U.U)(function(r){return o.getWMTSItems(t,r)}))}},{key:"loadCatalogArcGISRestItems",value:function(t){var o=this;return this.getCatalogCapabilities(t).pipe((0,U.U)(function(r){return o.getArcGISRESTItems(t,r)}))}},{key:"loadCatalogCompositeLayerItems",value:function(t){var o=this,r=t.composite,s=[];r.map(function(y){y.sortDirection=t.sortDirection,s.push(Nc.createInstanceCatalog(y,o))});var l=[];s.map(function(y){return l.push(y.collectCatalogItems())});var c=[];function u(y){return y.reduce(function(_,b){return _.concat(b.type===yt.Group?u(b.items):b)},[])}if(Object.keys(r).find(function(y){return r[y].groupImpose})){var p=function(_,b){var w=s[b],T=Object.assign({},w.groupImpose);T.address=w.id,T.type=yt.Group,T.externalProvider=w.externalProvider,void 0===T.sortDirection&&(T.sortDirection=w.sortDirection),T.items=[];var M=u(_);return M.map(function(A){return A.address="".concat(T.address,".").concat(T.id)}),T.items=M,T};c=l.map(function(y,_){return y.pipe((0,U.U)(function(b){return r[_].groupImpose?p(b,_):b}))})}else c=l;var d=kr.$.apply(void 0,(0,Fe.Z)(c)).pipe((0,U.U)(function(y){var _;return(_=[]).concat.apply(_,(0,Fe.Z)(y))})),f=function y(_,b){return _.reduce(function(w,T,M,A){var L=b(T),Z=Object.assign({},T);if(T.type===yt.Layer){var R=[];if(A.filter(function(ue,oe){var Q=!1;return ue.title===L&&ue.type===yt.Layer&&(oe!==M&&ue.address!==T.address&&(Q=!0),R.push(oe)),Q}).length>0){var Y=R.findIndex(function(ue){return ue===M})+1;Z.title="".concat(T.title," (").concat(Y,")"),Y=[].findIndex(function(ue){return ue===M})+1,Z.newMetadataUrl="".concat(T.newMetadataUrl," (").concat(Y,")")}w.find(function(ue){return ue.title===Z.title&&ue.type===yt.Layer})||(w[w.length]=Z)}else T.type===yt.Group&&(Z.items=y(T.items,function(ue){return ue.title}),w[w.length]=Z);return w},[])};return d.pipe((0,U.U)(function(y){return b=function(_){return _.id},y.reduce(function(w,T){var M=b(T),A=w.find(function(R){return R.id===M});if(A){var L,Z=w.indexOf(A);-1===w[Z].address.split("|").indexOf(T.address)&&(w[Z].address="".concat(w[Z].address,"|").concat(T.address)),(L=w[Z].items).push.apply(L,(0,Fe.Z)(T.items))}else w[w.length]=T;return w},[]);var b}),(0,U.U)(function(y){var _;return(_=[]).concat.apply(_,(0,Fe.Z)(y))}),(0,U.U)(function(y){return f(y,function(_){return _.title})}))}},{key:"getCatalogCapabilities",value:function(t){var o=this;return this.capabilitiesService.getCapabilities(Oe[t.type],t.url,t.version).pipe((0,Ze.K)(function(s){var l=o.languageService.translate.instant("igo.geo.catalog.unavailableTitle"),c=t.title?o.languageService.translate.instant("igo.geo.catalog.unavailable",{value:t.title}):o.languageService.translate.instant("igo.geo.catalog.someUnavailable");return o.messageService.error(c,l),console.error(s),(0,ge.of)(void 0)}))}},{key:"computeForcedProperties",value:function(t,o){if(o&&0!==o.length){var r={layerName:t,title:void 0,metadataUrl:void 0,metadataAbstract:void 0,metadataAbstractAll:void 0,metadataUrlAll:void 0},s=o.find(function(l){return"*"===l.layerName});return s&&(s.metadataAbstractAll&&(r.metadataAbstractAll=s.metadataAbstractAll),s.metadataUrlAll&&(r.metadataUrlAll=s.metadataUrlAll)),o.map(function(l){t===l.layerName&&(l.title&&(r.title=l.title),l.metadataUrl&&(r.metadataUrl=l.metadataUrl),l.metadataAbstract&&(r.metadataAbstract=l.metadataAbstract))}),r}}},{key:"prepareCatalogItemLayer",value:function(t,o,r,s){var f,l=this.retrieveLayerInfoFormat(t.Name,r),c=s.showLegend&&t.Style?this.capabilitiesService.getStyle(t.Style):void 0,u=Object.assign({},s.queryParams,{LAYERS:t.Name,VERSION:s.version}),p={type:"wms",url:s.url,crossOrigin:s.setCrossOriginAnonymous?"anonymous":void 0,queryFormat:l,queryHtmlTarget:l===Xe.HTML||l===Xe.HTMLGML2?"iframe":void 0,optionsFromCapabilities:!0},d=Object.assign({},p,s.sourceOptions,{params:u}),g=this.computeForcedProperties(t.Name,s.forcedProperties),m=!0;t.Abstract?f=t.Abstract:!t.Abstract&&s.abstract&&(f=s.abstract);var _=(null==g?void 0:g.metadataUrl)||(null==g?void 0:g.metadataUrlAll)||((null==t?void 0:t.DataURL)&&(null==t?void 0:t.DataURL.length)>0?null==t?void 0:t.DataURL[0].OnlineResource:void 0),b=(null==g?void 0:g.metadataAbstract)||(null==g?void 0:g.metadataAbstractAll)||f;!(null!=g&&g.metadataUrl)&&!(null!=g&&g.metadataUrlAll)&&((null==g?void 0:g.metadataAbstract)||(null==g?void 0:g.metadataAbstractAll))&&(m=!1),(null==g?void 0:g.metadataAbstract)&&(null==g?void 0:g.metadataUrlAll)&&(m=!1);var w={id:Oi(d),type:yt.Layer,title:null!=g&&g.title?g.title:t.Title,address:o,externalProvider:s.externalProvider||!1,options:{maxResolution:Zt(t.MaxScaleDenominator),minResolution:Zt(t.MinScaleDenominator),metadata:{url:_,extern:m,abstract:b,type:p.type},legendOptions:c,tooltip:{type:s.tooltipType},sourceOptions:d}};return se.removeUndefined(w)}},{key:"prepareCatalogItemGroup",value:function(t,o,r,s,l){var c=this;return{id:r,type:yt.Group,title:t.Title,address:l.id,externalProvider:l.externalProvider||!1,sortDirection:l.sortDirection,items:t.Layer.reduce(function(p,d){if(void 0!==d.Layer){var g=r+".group.".concat(d.Name||d.Layer[0].Name),f=c.prepareCatalogItemGroup(d,o,g,s,l);p.push(f)}else{if(!1===c.testLayerRegexes(d.Name,o))return p;var m=c.prepareCatalogItemLayer(d,r,s,l);p.push(m)}return p},[])}}},{key:"includeRecursiveItems",value:function(t,o,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=(t.regFilters||[]).map(function(y){return new RegExp(y)});if(o.Layer){var u,c=(0,D.Z)(o.Layer);try{for(c.s();!(u=c.n()).done;){var p=u.value;if(void 0===p.Layer){var d=this.findCatalogInfoFormat(t);if(0!==s){var g="catalog.group.".concat(o.Name||p.Name),f=this.prepareCatalogItemGroup(o,l,g,d,t);0!==f.items.length&&r.push(f);break}if(!1!==this.testLayerRegexes(p.Name,l)){var m=this.prepareCatalogItemLayer(p,t.id,d,t);r.push(m)}}else this.includeRecursiveItems(t,p,r,s+1)}}catch(y){c.e(y)}finally{c.f()}}}},{key:"getWMTSItems",value:function(t,o){var r=this;if(!o)return[];var s=o.Contents.Layer,l=(t.regFilters||[]).map(function(c){return new RegExp(c)});return o.ServiceIdentification&&o.ServiceIdentification.Abstract&&o.ServiceIdentification.Abstract.length&&(t.abstract=o.ServiceIdentification.Abstract),s.map(function(c){var u=r.computeForcedProperties(c.Title,t.forcedProperties),p=!0,d=(null==u?void 0:u.metadataUrl)||(null==u?void 0:u.metadataUrlAll),g=(null==u?void 0:u.metadataAbstract)||(null==u?void 0:u.metadataAbstractAll)||t.abstract;if(!(null!=u&&u.metadataUrl)&&!(null!=u&&u.metadataUrlAll)&&((null==u?void 0:u.metadataAbstract)||(null==u?void 0:u.metadataAbstractAll))&&(p=!1),(null==u?void 0:u.metadataAbstract)&&(null==u?void 0:u.metadataUrlAll)&&(p=!1),!1!==r.testLayerRegexes(c.Identifier,l)){var f=Object.assign({},t.queryParams,{version:"1.0.0"}),m={type:"wmts",url:t.url,crossOrigin:t.setCrossOriginAnonymous?"anonymous":void 0,layer:c.Identifier,matrixSet:t.matrixSet,optionsFromCapabilities:!0,requestEncoding:t.requestEncoding||"KVP",style:"default"},y=Object.assign({},m,t.sourceOptions,{params:f});return se.removeUndefined({id:Oi(y),type:yt.Layer,title:null!=u&&u.title?u.title:c.Title,address:t.id,externalProvider:t.externalProvider,options:{sourceOptions:y,metadata:{url:d,extern:p,abstract:g,type:m.type}}})}}).filter(function(c){return void 0!==c})}},{key:"getArcGISRESTItems",value:function(t,o){var r=this;if(!o)return[];var s=o.layers?o.layers.filter(function(p){return!p.type||"Feature Layer"===p.type}):[];o.layers||this.messageService.error(this.languageService.translate.instant("igo.geo.catalog.someUnavailable"),this.languageService.translate.instant("igo.geo.catalog.unavailableTitle"));var l=(t.regFilters||[]).map(function(p){return new RegExp(p)});return o.serviceDescription&&o.serviceDescription.length&&o.serviceDescription.replace(/(<([^>]+)>)/gi,""),s.map(function(p){var g,d=r.computeForcedProperties(p.name,t.forcedProperties),f=!0;p.Abstract?g=p.Abstract:!p.Abstract&&t.abstract&&(g=t.abstract);var m=(null==d?void 0:d.metadataUrl)||(null==d?void 0:d.metadataUrlAll),y=(null==d?void 0:d.metadataAbstract)||(null==d?void 0:d.metadataAbstractAll)||g;if(!(null!=d&&d.metadataUrl)&&!(null!=d&&d.metadataUrlAll)&&((null==d?void 0:d.metadataAbstract)||(null==d?void 0:d.metadataAbstractAll))&&(f=!1),(null==d?void 0:d.metadataAbstract)&&(null==d?void 0:d.metadataUrlAll)&&(f=!1),!1!==r.testLayerRegexes(p.id,l)){var _={type:Oe[t.type],url:t.url,crossOrigin:t.setCrossOriginAnonymous?"anonymous":void 0,layer:p.id,queryable:!0,queryFormat:"esrijson",matrixSet:t.matrixSet,optionsFromCapabilities:!0,style:"default"},b=Object.assign({},_,t.sourceOptions);return se.removeUndefined({id:Oi(b),type:yt.Layer,title:null!=d&&d.title?d.title:p.name,externalProvider:t.externalProvider,address:t.id,options:{sourceOptions:b,minResolution:Zt(p.maxScale),maxResolution:Zt(p.minScale),metadata:{url:m,extern:f,abstract:y,type:_.type}}})}}).filter(function(p){return void 0!==p})}},{key:"testLayerRegexes",value:function(t,o){return 0===o.length||void 0!==o.find(function(r){return r.test(t)})}},{key:"retrieveLayerInfoFormat",value:function(t,o){var l,r=o.find(function(c){return c.layer===t}),s=o.find(function(c){return"*"===c.layer});return r?l=r.queryFormat:s&&(l=s.queryFormat),l}},{key:"findCatalogInfoFormat",value:function(t){var o=[];return t.queryFormat&&Object.keys(t.queryFormat).forEach(function(r){t.queryFormat[r]instanceof Array?t.queryFormat[r].forEach(function(s){o.find(function(l){return l.layer===s})||o.push({layer:s,queryFormat:r})}):o.find(function(s){return s.layer===t.queryFormat[r]})||o.push({layer:t.queryFormat[r],queryFormat:r})}),o}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG(j),e.LFG($),e.LFG(Ae),e.LFG(Pr))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function Ny(i,a){if(1&i){var n=e.EpF();e.ynx(0),e.TgZ(1,"igo-catalog-browser-group",3),e.NdJ("addedChange",function(s){e.CHM(n);var l=e.oxw(2);return e.KtG(l.onGroupAddedChange(s))})("layerAddedChange",function(s){e.CHM(n);var l=e.oxw(2);return e.KtG(l.onLayerAddedChange(s))}),e.ALo(2,"async"),e.qZA(),e.BQk()}if(2&i){var t=e.oxw().$implicit,o=e.oxw();e.xp6(1),e.Q6J("catalog",o.catalog)("group",t)("state",o.store.state)("resolution",e.lcZ(2,7,o.resolution$))("catalogAllowLegend",o.catalogAllowLegend)("collapsed",1!==o.store.count)("toggleCollapsed",o.toggleCollapsedGroup)}}function qy(i,a){if(1&i){var n=e.EpF();e.ynx(0),e.TgZ(1,"igo-catalog-browser-layer",4),e.NdJ("addedChange",function(s){e.CHM(n);var l=e.oxw(2);return e.KtG(l.onLayerAddedChange(s))}),e.ALo(2,"async"),e.qZA(),e.BQk()}if(2&i){var t=e.oxw().$implicit,o=e.oxw();e.xp6(1),e.Q6J("layer",t)("resolution",e.lcZ(2,4,o.resolution$))("catalogAllowLegend",o.catalogAllowLegend)("added",o.store.state.get(t).added)}}function Gy(i,a){if(1&i&&(e.YNc(0,Ny,3,9,"ng-container",2),e.YNc(1,qy,3,6,"ng-container",2)),2&i){var n=a.$implicit,t=e.oxw();e.Q6J("ngIf",t.isGroup(n)),e.xp6(1),e.Q6J("ngIf",t.isLayer(n))}}var Ts=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.layerService=n,this.cdRef=t,this.catalogAllowLegend=!1,this.toggleCollapsedGroup=!0}return(0,v.Z)(a,[{key:"resolution$",get:function(){return this.map.viewController.resolution$}},{key:"ngOnInit",value:function(){var t=this.map.layers.map(function(r){return{id:r.options.source.id,title:r.title,type:yt.Layer}});this.store.state.updateMany(t,{added:!0},!0),this.catalog&&void 0!==this.catalog.sortDirection&&this.store.view.sort({direction:this.catalog.sortDirection,valueAccessor:function(s){return s.title}}),this.catalogAllowLegend=!!this.catalog&&this.catalog.showLegend||this.catalogAllowLegend,this.watcher=new _i(this.store,this.cdRef)}},{key:"ngOnDestroy",value:function(){this.watcher.destroy()}},{key:"isGroup",value:function(t){return t.type===yt.Group}},{key:"isLayer",value:function(t){return t.type===yt.Layer}},{key:"onLayerAddedChange",value:function(t){var o=t.layer;this.store.state.update(o,{added:t.added},!1),t.added?this.addLayerToMap(o):this.removeLayerFromMap(o)}},{key:"onGroupAddedChange",value:function(t){var o=t.group;this.store.state.update(o,{added:t.added},!1),t.added?this.addGroupToMap(o):this.removeGroupFromMap(o)}},{key:"addLayerToMap",value:function(t){this.addLayersToMap([t])}},{key:"removeLayerFromMap",value:function(t){this.removeLayersFromMap([t])}},{key:"addLayersToMap",value:function(t){var o=this,r=t.map(function(s){return s.options.sourceOptions.optionsFromApi||(s.options.sourceOptions.optionsFromApi=!0),o.layerService.createAsyncLayer(s.options)});kr.$.apply(void 0,(0,Fe.Z)(r)).subscribe(function(s){o.store.state.updateMany(t,{added:!0}),o.map.addLayers(s)})}},{key:"removeLayersFromMap",value:function(t){var o=this;t.forEach(function(r){if(o.store.state.update(r,{added:!1}),!0===r.options.baseLayer){var s=o.map.getLayerById(r.options.id);void 0!==s&&o.map.removeLayer(s)}else{var l=o.map.getLayerById(r.id);void 0!==l&&o.map.removeLayer(l)}})}},{key:"sortCatalogItemsByTitle",value:function(t,o){var r=t.sort(function(s,l){var c=s.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),u=l.title.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return c<u?-1:c>u?1:0});switch(o){case"asc":return r;case"desc":return r.reverse();default:return t}}},{key:"addGroupToMap",value:function(t){var o=this,r=t.items.filter(function(s){var l=o.store.state.get(s).added||!1;return o.isLayer(s)&&!1===l});void 0!==t.sortDirection&&(r=this.sortCatalogItemsByTitle(r,t.sortDirection)),this.addLayersToMap(r.reverse())}},{key:"removeGroupFromMap",value:function(t){var o=this,r=t.items.filter(function(s){var l=o.store.state.get(s).added||!1;return o.isLayer(s)&&!0===l});this.removeLayersFromMap(r)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Ge),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-catalog-browser"]],inputs:{catalogAllowLegend:"catalogAllowLegend",catalog:"catalog",store:"store",map:"map",toggleCollapsedGroup:"toggleCollapsedGroup"},decls:3,vars:5,consts:[[3,"navigation","selection"],["ngFor","",3,"ngForOf"],[4,"ngIf"],[3,"catalog","group","state","resolution","catalogAllowLegend","collapsed","toggleCollapsed","addedChange","layerAddedChange"],["igoListItem","",3,"layer","resolution","catalogAllowLegend","added","addedChange"]],template:function(n,t){1&n&&(e.TgZ(0,"igo-list",0),e.YNc(1,Gy,2,2,"ng-template",1),e.ALo(2,"async"),e.qZA()),2&n&&(e.Q6J("navigation",!1)("selection",!1),e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,3,t.store.view.all$())))},encapsulation:2,changeDetection:0}),i}(),Qy=["renderedLegend"];function Yy(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-list-item")(1,"mat-icon",7),e.NdJ("toggle",function(l){e.CHM(n);var c=e.oxw(2).$implicit,u=e.oxw(3);return e.KtG(u.toggleLegendItem(l,c))}),e.qZA(),e.TgZ(2,"h4",8),e._uU(3),e.ALo(4,"async"),e.qZA()()}if(2&i){e.oxw();var t=e.MAs(3),o=e.oxw().$implicit,r=e.oxw(3);e.xp6(1),e.Q6J("target",t)("collapsed",o.collapsed),e.xp6(2),e.hij("",e.lcZ(4,3,r.computeItemTitle(o))," ")}}function jy(i,a){if(1&i&&(e.TgZ(0,"mat-option",11),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n.name),e.xp6(1),e.Oqu(n.title)}}function Hy(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div")(1,"mat-form-field")(2,"mat-select",9),e.NdJ("ngModelChange",function(r){e.CHM(n);var s=e.oxw(5);return e.KtG(s.currentStyle=r)})("selectionChange",function(){e.CHM(n);var r=e.oxw(5);return e.KtG(r.onChangeStyle())}),e.ALo(3,"translate"),e.YNc(4,jy,2,2,"mat-option",10),e.qZA()()()}if(2&i){var t=e.oxw(5);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("ngModel",t.currentStyle),e.xp6(2),e.Q6J("ngForOf",t.styles)}}function Vy(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"img",14,15),e.NdJ("load",function(){e.CHM(n);var r=e.oxw(4).$implicit,s=e.oxw(3);return e.KtG(s.onLoadImage(r.title))}),e.ALo(2,"translate"),e.qZA()}if(2&i){var t=e.oxw(4).$implicit;e.s9C("id",t.title),e.s9C("alt",e.lcZ(2,3,"igo.geo.layer.legend.loadingLegendText")),e.Q6J("src",t.imgGraphValue,e.LSH)}}function zy(i,a){1&i&&(e.TgZ(0,"small"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLegendScale")," "))}function Wy(i,a){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,Vy,3,5,"img",13),e.YNc(2,zy,3,3,"small",0),e.qZA()),2&i){var n=e.oxw(3).$implicit,t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",n.imgGraphValue),e.xp6(1),e.Q6J("ngIf",t.imagesHeight[n.title]<16)}}function Ky(i,a){if(1&i&&(e._UZ(0,"div",16),e.ALo(1,"sanitizeHtml")),2&i){var n=e.oxw(3).$implicit;e.Q6J("ngStyle",n.style)("innerHTML",e.lcZ(1,2,n.html),e.oJD)}}function Xy(i,a){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,Wy,3,2,"div",0),e.YNc(2,Ky,2,4,"div",12),e.qZA()),2&i){var n=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngIf",n.url),e.xp6(1),e.Q6J("ngIf",n.html)}}var e_=function(a){return{"with-title":a}};function t_(i,a){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,Yy,5,5,"mat-list-item",0),e.TgZ(2,"div",5,6),e.YNc(4,Hy,5,5,"div",0),e.YNc(5,Xy,3,2,"div",0),e.qZA()()),2&i){var n=e.oxw().$implicit,t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",n.title),e.xp6(1),e.Q6J("ngClass",e.VKq(4,e_,n.title)),e.xp6(2),e.Q6J("ngIf",void 0!==t.currentStyle),e.xp6(1),e.Q6J("ngIf",!n.collapsed)}}function n_(i,a){if(1&i&&(e.ynx(0,null,4),e.YNc(2,t_,6,6,"div",1),e.BQk()),2&i){e.oxw(2);var n=e.MAs(3),t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.getLegend)("ngIfElse",n)}}function o_(i,a){if(1&i&&(e.ynx(0),e.YNc(1,n_,3,2,"ng-container",3),e.BQk()),2&i){var n=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",n.slice().reverse())}}function i_(i,a){1&i&&(e.TgZ(0,"small"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLegendText")," "))}function r_(i,a){if(1&i&&(e.ynx(0),e.YNc(1,o_,2,1,"ng-container",1),e.YNc(2,i_,3,3,"ng-template",null,2,e.W1O),e.BQk()),2&i){var n=a.ngIf,t=e.MAs(3);e.xp6(1),e.Q6J("ngIf",n.length)("ngIfElse",t)}}var Ni=function(){var i=function(){function a(n,t,o,r,s){(0,h.Z)(this,a),this.capabilitiesService=n,this.languageService=t,this.configService=o,this.http=r,this.cdRef=s,this.updateLegendOnResolutionChange=!1,this.legendItems$=new x.X([]),this.scale=void 0,this.view=void 0,this.imagesHeight={},this.getLegend=!0}return(0,v.Z)(a,[{key:"ngOnInit",value:function(){var t=this,o=this.layer.legend;this.styles=this.listStyles();var r=this.layer.options.source.options;if(r&&r.params&&r.params.STYLES?this.currentStyle=this.styles.find(function(p){return p.name===r.params.STYLES}).name:o?this.styles&&this.styles.length>1&&(this.currentStyle=o[0].currentStyle):this.styles&&this.styles.length>1&&(this.currentStyle=this.styles[0].name),o=void 0!==this.layer.options.legendOptions&&!1===this.layer.options.legendOptions.display?[]:this.layer.dataSource.getLegend(this.currentStyle,this.view),this.updateLegendOnResolutionChange||r.contentDependentLegend)this.state$$=this.layer.map.viewController.state$.subscribe(function(){return t.onViewControllerStateChange()});else if(o&&0!==o.length){this.legendItems$.next(o);var c,l=(0,D.Z)(o);try{for(l.s();!(c=l.n()).done;)this.getLegendGraphic(c.value)}catch(p){l.e(p)}finally{l.f()}}}},{key:"ngOnDestroy",value:function(){void 0!==this.state$$&&this.state$$.unsubscribe()}},{key:"getLegendGraphic",value:function(t){var o=this;t.url&&new dr(this.http,this.configService).transform(t.url).pipe((0,Ze.K)(function(s){if(s.error)return s.error.caught=!0,o.getLegend=!1,o.cdRef.detectChanges(),s})).subscribe(function(s){var l=o.legendItems$.value.findIndex(function(u){return u.title===t.title});o.legendItems$.value[l].imgGraphValue=s,o.cdRef.detectChanges()})}},{key:"toggleLegendItem",value:function(t,o){o.collapsed=t}},{key:"transfertToggleLegendItem",value:function(t){for(var o=t,r=this.layer.legend,s=0;s<r.length;s++)o[s].collapsed=r[s].collapsed;return o}},{key:"computeItemTitle",value:function(t){var o=this.layer.dataSource.options;if("wms"!==o.type)return(0,ge.of)(t.title);var r=o.params.LAYERS.split(","),s=JSON.parse(JSON.stringify(o));return s.params.LAYERS=r.find(function(l){return l===t.title}),this.capabilitiesService.getWMSOptions(s).pipe((0,U.U)(function(l){return l._layerOptionsFromSource.title}))}},{key:"onViewControllerStateChange",value:function(){this.view={resolution:this.layer.map.viewController.getResolution(),extent:this.layer.map.viewController.getExtent(),projection:this.layer.map.viewController.getOlProjection().getCode(),scale:this.layer.map.viewController.getScale(),size:this.layer.map.ol.getSize()},this.updateLegend()}},{key:"updateLegend",value:function(){var t=this.layer.dataSource.getLegend(this.currentStyle,this.view);if(this.layer.legend&&this.layer.legend.length>1&&(t=this.transfertToggleLegendItem(t)),this.layer.legend=t,0!==t.length||0!==this.legendItems$.value.length){this.legendItems$.next(t);var r,o=(0,D.Z)(this.legendItems$.value);try{for(o.s();!(r=o.n()).done;)this.getLegendGraphic(r.value)}catch(l){o.e(l)}finally{o.f()}}}},{key:"listStyles",value:function(){var t=this.layer.options;if(t&&t.legendOptions){var s=[{name:"",title:this.languageService.translate.instant("igo.geo.layer.legend.default")}];return t.legendOptions.stylesAvailable&&(s=s.concat(t.legendOptions.stylesAvailable.filter(function(l){return"default"!==l.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")&&"defaut"!==l.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")}))),s.filter(function(l){return!l.title}).map(function(l){return l.title=l.name}),s.map(function(l){return l.title=l.title.charAt(0).toUpperCase()+l.title.slice(1).replace(/_/g," ")}),s}}},{key:"onChangeStyle",value:function(){var t=this;this.updateLegend();var o="";this.layer.dataSource instanceof Ht&&(this.layer.dataSource.ol.getParams().LAYERS.split(",").map(function(r){return o+=t.currentStyle+","}),o=o.slice(0,-1),this.layer.dataSource.ol.updateParams({STYLES:o}))}},{key:"onLoadImage",value:function(t){var o;o=1===this.renderedLegends.length?this.renderedLegends.first.nativeElement:this.renderedLegends.find(function(r){return r.nativeElement.id===t}).nativeElement,this.imagesHeight[t]=o.height}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Pr),e.Y36($),e.Y36(j),e.Y36(W.eN),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-layer-legend"]],viewQuery:function(n,t){var o;1&n&&e.Gf(Qy,5),2&n&&e.iGM(o=e.CRH())&&(t.renderedLegends=o)},inputs:{updateLegendOnResolutionChange:"updateLegendOnResolutionChange",layer:"layer"},decls:2,vars:3,consts:[[4,"ngIf"],[4,"ngIf","ngIfElse"],["noItems",""],[4,"ngFor","ngForOf"],["renderedLegends",""],[1,"igo-layer-legend",3,"ngClass"],["legend",""],["id","legend-toggle","mat-list-avatar","","igoCollapse","","svgIcon","chevron-up",1,"igo-chevron",3,"target","collapsed","toggle"],["matLine",""],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"ngStyle","innerHTML",4,"ngIf"],["igoImageError","","hideError","true",3,"id","src","alt","load",4,"ngIf"],["igoImageError","","hideError","true",3,"id","src","alt","load"],["renderedLegend",""],[3,"ngStyle","innerHTML"]],template:function(n,t){1&n&&(e.YNc(0,r_,4,2,"ng-container",0),e.ALo(1,"async")),2&n&&e.Q6J("ngIf",e.lcZ(1,1,t.legendItems$))},dependencies:[B.KE,S.JJ,C.mk,C.sg,C.O5,C.PC,S.On,O.Hw,ke.gD,ie.ey,J.gM,X.Tg,X.eA,ie.X2,Do,xa,C.Ov,E.X$,pr],styles:['.igo-layer-legend.with-title[_ngcontent-%COMP%]{padding-left:18px}img[_ngcontent-%COMP%]:after{content:" ";position:relative;height:17px;float:left;width:17px;top:-3px;right:19px;background-color:#fff;border:3px solid #f3f3f3;border-radius:50%;-webkit-animation:2s linear infinite spin;animation:2s linear infinite spin}@-moz-document url-prefix(){img:after{margin-left:19px}}@-webkit-keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}'],changeDetection:0}),i}();function a_(i,a){1&i&&e._UZ(0,"mat-icon",9)}function s_(i,a){1&i&&(e.TgZ(0,"mat-icon",12),e.NdJ("click",function(t){return t.stopPropagation()}),e.ALo(1,"translate"),e.qZA()),2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.catalog.externalProvider.layer"))}function l_(i,a){if(1&i&&(e.TgZ(0,"button",10),e.YNc(1,s_,2,3,"mat-icon",11),e.qZA()),2&i){var n=e.oxw();e.xp6(1),e.Q6J("ngIf",n.layer.externalProvider)}}function c_(i,a){if(1&i&&(e._UZ(0,"igo-layer-legend",3),e.ALo(1,"async")),2&i){var n=e.oxw();e.Q6J("layer",e.lcZ(1,1,n.igoLayer$))}}var Qc=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.layerService=n,this.inRange$=new x.X(!0),this.isPreview$=new x.X(!1),this.layerLegendShown$=new x.X(!1),this.igoLayer$=new x.X(void 0),this.mouseInsideAdd=!1,this.catalogAllowLegend=!1,this.added=!1,this.addedChange=new e.vpe,this.addedLayerIsPreview=new e.vpe}return(0,v.Z)(a,[{key:"title",get:function(){return en(this.layer)}},{key:"icon",get:function(){return ur(this.layer)||"layers"}},{key:"ngOnInit",value:function(){var t=this;this.isInResolutionsRange(),this.isPreview$$=this.isPreview$.subscribe(function(o){return t.addedLayerIsPreview.emit(o)})}},{key:"ngOnDestroy",value:function(){this.isPreview$$.unsubscribe()}},{key:"computeTitleTooltip",value:function(){var t=this.layer.options;if(!t.tooltip)return en(this.layer);var o=t.tooltip,r=t.metadata;switch(t.tooltip.type){case sn.TITLE:return this.layer.title;case sn.ABSTRACT:return r&&r.abstract?r.abstract:this.layer.title;case sn.CUSTOM:return o&&o.text?o.text:this.layer.title;default:return this.layer.title}}},{key:"onMouseEvent",value:function(t){this.onToggleClick(t)}},{key:"askForLegend",value:function(t){var o=this;this.layerLegendShown$.next(!this.layerLegendShown$.value),this.layerService.createAsyncLayer(this.layer.options).pipe((0,An.P)()).subscribe(function(r){return o.igoLayer$.next(r)})}},{key:"onToggleClick",value:function(t){var o=this;if(void 0!==this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest),"mouseenter"!==t.type||!this.mouseInsideAdd)switch(t.type){case"click":this.isPreview$.value||(this.added?this.remove():this.add()),this.isPreview$.next(!1);break;case"mouseenter":!this.isPreview$.value&&!this.added&&(this.lastTimeoutRequest=setTimeout(function(){o.add(),o.isPreview$.next(!0)},500)),this.mouseInsideAdd=!0;break;case"mouseleave":this.isPreview$.value&&(this.remove(),this.isPreview$.next(!1)),this.mouseInsideAdd=!1}}},{key:"add",value:function(){this.added||(this.added=!0,this.addedChange.emit({added:!0,layer:this.layer}))}},{key:"remove",value:function(){this.added&&(this.added=!1,this.addedChange.emit({added:!1,layer:this.layer}))}},{key:"haveGroup",value:function(){return!(!this.layer.address||1===this.layer.address.split(".").length)}},{key:"isInResolutionsRange",value:function(){return this.inRange$.next(this.resolution>=(this.layer.options.minResolution||0)&&this.resolution<=(this.layer.options.maxResolution||1/0)),this.inRange$.value}},{key:"computeTooltip",value:function(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Ge))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-catalog-browser-layer"]],inputs:{resolution:"resolution",catalogAllowLegend:"catalogAllowLegend",layer:"layer",added:"added"},outputs:{addedChange:"addedChange",addedLayerIsPreview:"addedLayerIsPreview"},decls:16,vars:21,consts:[["mat-list-avatar","","svgIcon","blank",4,"ngIf"],["mat-line","","matTooltipShowDelay","500",3,"ngClass","matTooltip","click"],["disabled","true","mat-icon-button","",4,"ngIf"],[3,"layer"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click"],["matBadge","icon","igoMatBadgeIcon","eye-off","igoMatBadgeInverseColor","true","matBadgeDisabled","true","matBadgeSize","small","matBadgePosition","after",3,"matBadgeHidden","svgIcon"],[1,"igo-cataloglayer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],["mat-list-avatar","","svgIcon","blank"],["disabled","true","mat-icon-button",""],["class","igo-cataloglayer-external-icon","tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",3,"matTooltip","click",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",1,"igo-cataloglayer-external-icon",3,"matTooltip","click"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-list-item"),e.YNc(1,a_,1,0,"mat-icon",0),e.TgZ(2,"h4",1),e.NdJ("click",function(r){return t.askForLegend(r)}),e._uU(3),e.qZA(),e.YNc(4,l_,2,1,"button",2),e._UZ(5,"igo-metadata-button",3),e.TgZ(6,"button",4),e.NdJ("mouseenter",function(r){return t.onMouseEvent(r)})("mouseleave",function(r){return t.onMouseEvent(r)})("click",function(r){return t.onToggleClick(r)}),e.ALo(7,"translate"),e.ALo(8,"async"),e._UZ(9,"mat-icon",5),e.ALo(10,"async"),e.qZA()(),e.TgZ(11,"div",6,7),e.YNc(13,c_,2,3,"igo-layer-legend",8),e.ALo(14,"async"),e.ALo(15,"async"),e.qZA()),2&n&&(e.xp6(1),e.Q6J("ngIf",t.haveGroup()),e.xp6(1),e.Q6J("ngClass",t.catalogAllowLegend?"igo-cataloglayer-title":"")("matTooltip",t.computeTitleTooltip()),e.xp6(1),e.Oqu(t.title),e.xp6(1),e.Q6J("ngIf",t.layer.externalProvider),e.xp6(1),e.Q6J("layer",t.layer),e.xp6(1),e.Q6J("matTooltip",e.lcZ(7,11,t.computeTooltip()))("color",e.lcZ(8,13,t.isPreview$)?"":t.added?"warn":""),e.xp6(3),e.Q6J("matBadgeHidden",t.isInResolutionsRange())("svgIcon",e.lcZ(10,15,t.isPreview$)?"plus":t.added?"delete":"plus"),e.xp6(4),e.Q6J("ngIf",e.lcZ(14,17,t.layerLegendShown$)&&e.lcZ(15,19,t.igoLayer$)&&t.catalogAllowLegend))},dependencies:[C.mk,C.O5,bt.k,I.lW,O.Hw,X.Tg,X.eA,ie.X2,J.gM,Ma,Vo,Ni,C.Ov,E.X$],styles:[".igo-cataloglayer-title[_ngcontent-%COMP%]{cursor:pointer}.igo-cataloglayer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px);margin-left:40px}.igo-cataloglayer-external-icon[_ngcontent-%COMP%]{cursor:help}"],changeDetection:0}),i}();function u_(i,a){1&i&&(e.TgZ(0,"mat-icon",9),e.NdJ("click",function(t){return t.stopPropagation()}),e.ALo(1,"translate"),e.qZA()),2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.catalog.externalProvider.group"))}function p_(i,a){if(1&i&&(e.TgZ(0,"button",7),e.YNc(1,u_,2,3,"mat-icon",8),e.qZA()),2&i){var n=e.oxw();e.xp6(1),e.Q6J("ngIf",n.group.externalProvider)}}function d_(i,a){if(1&i){var n=e.EpF();e.ynx(0),e.TgZ(1,"button",10),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.onToggleClick())}),e.ALo(2,"translate"),e.ALo(3,"async"),e._UZ(4,"mat-icon",11),e.qZA(),e.BQk()}if(2&i){var t=e.oxw();e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,2,"igo.geo.catalog.group.removeFromMap"))("disabled",e.lcZ(3,4,t.disabled$))}}function g_(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.onToggleClick())}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",13),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.catalog.group.addToMap"))("disabled",e.lcZ(2,4,t.disabled$))}}function f_(i,a){1&i&&e.GkF(0)}function m_(i,a){if(1&i){var n=e.EpF();e.ynx(0),e.TgZ(1,"igo-catalog-browser-layer",15),e.NdJ("addedLayerIsPreview",function(s){e.CHM(n);var l=e.oxw(2);return e.KtG(l.onLayerPreview(s))})("addedChange",function(s){e.CHM(n);var l=e.oxw(2);return e.KtG(l.onLayerAddedChange(s))}),e.qZA(),e.BQk()}if(2&i){var t=e.oxw().$implicit,o=e.oxw();e.xp6(1),e.Q6J("layer",t)("resolution",o.resolution)("catalogAllowLegend",o.catalogAllowLegend)("added",o.state.get(t).added)}}function h_(i,a){if(1&i&&(e.YNc(0,f_,1,0,"ng-container",14),e.YNc(1,m_,2,4,"ng-container",14)),2&i){var n=a.$implicit,t=e.oxw();e.Q6J("ngIf",t.isGroup(n)),e.xp6(1),e.Q6J("ngIf",t.isLayer(n))}}var v_=function(){var i=function(){function a(){(0,h.Z)(this,a),this.store=new mt([]),this.added$=new x.X(!1),this.preview$=new x.X(!1),this.disabled$=new x.X(!1),this.collapsed=!0,this.catalogAllowLegend=!1,this.toggleCollapsed=!0,this.addedChange=new e.vpe,this.layerAddedChange=new e.vpe}return(0,v.Z)(a,[{key:"title",get:function(){return this.group.title}},{key:"ngOnInit",value:function(){this.store.load(this.group.items),this.evaluateAdded(),this.evaluateDisabled(this.collapsed),void 0!==this.group.sortDirection&&this.store.view.sort({direction:this.group.sortDirection,valueAccessor:function(o){return o.title}})}},{key:"ngOnDestroy",value:function(){this.store.destroy()}},{key:"isGroup",value:function(t){return t.type===yt.Group}},{key:"isLayer",value:function(t){return t.type===yt.Layer}},{key:"onToggleClick",value:function(){this.added$.value?this.remove():this.add()}},{key:"onToggleCollapsed",value:function(t){this.evaluateDisabled(t)}},{key:"onLayerAddedChange",value:function(t){this.layerAddedChange.emit(t),this.tryToggleGroup(t)}},{key:"add",value:function(){this.added$.next(!0),this.addedChange.emit({added:!0,group:this.group})}},{key:"remove",value:function(){this.added$.next(!1),this.addedChange.emit({added:!1,group:this.group})}},{key:"onLayerPreview",value:function(t){this.preview$.next(t)}},{key:"tryToggleGroup",value:function(t){var o=this,r=t.added,s=t.layer;this.store.view.all().filter(function(c){return c.id!==s.id}).map(function(c){return o.state.get(c).added||!1}).every(function(c){return c===r})?r?this.add():this.remove():!0===this.added$.value&&this.added$.next(!1)}},{key:"evaluateAdded",value:function(){var t=this,o=this.store.all().every(function(r){return!0===(t.state.get(r).added||!1)});this.added$.next(o)}},{key:"evaluateDisabled",value:function(t){var o=!1;!1===this.toggleCollapsed&&(o=t),this.disabled$.next(o)}},{key:"onTitleClick",value:function(){this.collapsed=!this.collapsed}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-catalog-browser-group"]],inputs:{catalog:"catalog",group:"group",collapsed:"collapsed",resolution:"resolution",catalogAllowLegend:"catalogAllowLegend",toggleCollapsed:"toggleCollapsed",state:"state"},outputs:{addedChange:"addedChange",layerAddedChange:"layerAddedChange"},decls:14,vars:14,consts:[["mat-list-avatar","","svgIcon","chevron-up","igoCollapse","",1,"igo-chevron",3,"target","collapsed","toggle"],["id","catalog-group-title","mat-line","","matTooltipShowDelay","500",1,"igo-catalog-group-title",3,"matTooltip","click"],["disabled","true","mat-icon-button","",4,"ngIf"],[4,"ngIf","ngIfElse"],["notadded",""],["items",""],["ngFor","",3,"ngForOf"],["disabled","true","mat-icon-button",""],["class","igo-cataloggroup-external-icon","tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",3,"matTooltip","click",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",1,"igo-cataloggroup-external-icon",3,"matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","disabled","click"],["svgIcon","delete"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","click"],["svgIcon","plus"],[4,"ngIf"],["igoListItem","",3,"layer","resolution","catalogAllowLegend","added","addedLayerIsPreview","addedChange"]],template:function(n,t){if(1&n&&(e.TgZ(0,"mat-list-item")(1,"mat-icon",0),e.NdJ("toggle",function(l){return t.onToggleCollapsed(l)}),e.qZA(),e.TgZ(2,"h4",1),e.NdJ("click",function(){return t.onTitleClick()}),e._uU(3),e.qZA(),e.YNc(4,p_,2,1,"button",2),e.YNc(5,d_,5,6,"ng-container",3),e.ALo(6,"async"),e.ALo(7,"async"),e.YNc(8,g_,4,6,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(10,"div",null,5),e.YNc(12,h_,2,2,"ng-template",6),e.ALo(13,"async"),e.qZA()),2&n){var o=e.MAs(9),r=e.MAs(11);e.xp6(1),e.Q6J("target",r)("collapsed",t.collapsed),e.xp6(1),e.Q6J("matTooltip",t.title),e.xp6(1),e.Oqu(t.title),e.xp6(1),e.Q6J("ngIf",t.group.externalProvider),e.xp6(1),e.Q6J("ngIf",e.lcZ(6,8,t.added$)&&!1===e.lcZ(7,10,t.preview$))("ngIfElse",o),e.xp6(7),e.Q6J("ngForOf",e.lcZ(13,12,t.store.view.all$()))}},dependencies:[C.sg,C.O5,I.lW,O.Hw,X.Tg,X.eA,ie.X2,J.gM,Yt,Do,Qc,C.Ov,E.X$],styles:[".igo-catalog-group-title[_ngcontent-%COMP%]{cursor:pointer;opacity:.9}#catalog-group-title[_ngcontent-%COMP%]{font-weight:700}.igo-cataloggroup-external-icon[_ngcontent-%COMP%]{cursor:help}"],changeDetection:0}),i}(),y_=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a),this.sortAlpha=!1,this.onlyVisible=!1,this.onlyInRange=!1,this.keywordInitialized=!1,this.sortedAlphaInitialized=!1,this.onlyVisibleInitialized=!1,this.onlyInRangeInitialized=!1});return i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function __(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-checkbox",9),e.NdJ("change",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.check())}),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("checked",t.layerCheck)}}var Yc=function(a){return{disabled:a}};function b_(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.toggleVisibility())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",11),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("color",t.layer.visible?"primary":"default")("matTooltip",e.lcZ(1,5,t.eyeTooltip)),e.xp6(2),e.Q6J("matBadgeHidden",e.lcZ(3,7,t.queryBadgeHidden$))("ngClass",e.VKq(13,Yc,!1===e.lcZ(4,9,t.inResolutionRange$)))("svgIcon",e.lcZ(5,11,t.layer.visible$)?"eye":"eye-off")}}function C_(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.toggleVisibility())}),e.ALo(1,"translate"),e.ALo(2,"translate"),e._UZ(3,"mat-icon",11),e.ALo(4,"async"),e.ALo(5,"async"),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.lcZ(1,5,"igo.geo.layer.hideLayer"):e.lcZ(2,7,"igo.geo.layer.showLayer")),e.xp6(3),e.Q6J("matBadgeHidden",e.lcZ(4,9,t.queryBadgeHidden$))("ngClass",e.VKq(13,Yc,!1===e.lcZ(5,11,t.inResolutionRange$)))("svgIcon",t.layer.visible?"eye":"eye-off")}}function S_(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){e.CHM(n);var o=e.oxw();return e.KtG(o.toggleLayerTool())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",14),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.layer.moreOptions"))}function w_(i,a){if(1&i&&e._UZ(0,"igo-layer-legend",15),2&i){var n=e.oxw();e.Q6J("layer",n.layer)("updateLegendOnResolutionChange",n.updateLegendOnResolutionChange)}}var jc=function(){var i=function(){function a(n,t,o,r){(0,h.Z)(this,a),this.networkService=n,this.renderer=t,this.elRef=o,this.cdRef=r,this.focusedCls="igo-layer-item-focused",this.layerTool$=new x.X(!1),this.showLegend$=new x.X(!0),this.inResolutionRange$=new x.X(!0),this.queryBadgeHidden$=new x.X(!0),this._selectAll=!1,this.layers$=new x.X(void 0),this.toggleLegendOnVisibilityChange=!1,this.expandLegendIfVisible=!1,this.updateLegendOnResolutionChange=!1,this.orderable=!0,this.lowerDisabled=!1,this.raiseDisabled=!1,this.queryBadge=!1,this.action=new e.vpe(void 0),this.checkbox=new e.vpe}return(0,v.Z)(a,[{key:"activeLayer",get:function(){return this._activeLayer},set:function(t){t&&this.layer&&t.id===this.layer.id&&!this.selectionMode?(this.layerTool$.next(!0),this.renderer.addClass(this.elRef.nativeElement,this.focusedCls)):this.renderer.removeClass(this.elRef.nativeElement,this.focusedCls)}},{key:"selectAll",get:function(){return this._selectAll},set:function(t){this._selectAll=t,!0===t&&(this.layerCheck=!0)}},{key:"layer",get:function(){return this._layer},set:function(t){this._layer=t,this.layers$.next(t)}},{key:"opacity",get:function(){return 100*this.layer.opacity},set:function(t){this.layer.opacity=t/100}},{key:"eyeTooltip",get:function(){return!1===this.inResolutionRange$.getValue()?"igo.geo.layer.notInResolution":this.layer.visible?"igo.geo.layer.hideLayer":"igo.geo.layer.showLayer"}},{key:"ngOnInit",value:function(){var t=this;this.layer.visible&&this.expandLegendIfVisible&&!0===this.layer.firstLoadComponent&&(this.layer.firstLoadComponent=!1,this.layer.legendCollapsed=!1),this.toggleLegend(this.layer.legendCollapsed),this.updateQueryBadge(),this.resolution$$=this.layer.map.viewController.resolution$.subscribe(function(){t.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.network$$=this.networkService.currentState().subscribe(function(r){t.state=r,t.onResolutionChange()}),this.layers$$=this.layers$.subscribe(function(){t.layer&&t.layer.options.active&&(t.layerTool$.next(!0),t.renderer.addClass(t.elRef.nativeElement,t.focusedCls))}),this.changeDetection&&this.changeDetection.subscribe(function(){return t.cdRef.detectChanges()})}},{key:"ngOnDestroy",value:function(){this.resolution$$.unsubscribe(),this.network$$.unsubscribe(),this.layers$$.unsubscribe()}},{key:"toggleLegend",value:function(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}},{key:"toggleLegendOnClick",value:function(){this.toggleLegend(this.showLegend$.value)}},{key:"toggleVisibility",value:function(){this.layer.visible=!this.layer.visible,this.toggleLegendOnVisibilityChange&&this.toggleLegend(!this.layer.visible),this.updateQueryBadge()}},{key:"computeTooltip",value:function(){var t=this.layer.options;if(!t.tooltip)return this.layer.title;var o=t.tooltip,r=t.metadata;switch(t.tooltip.type){case sn.TITLE:return this.layer.title;case sn.ABSTRACT:return r&&r.abstract?r.abstract:this.layer.title;case sn.CUSTOM:return o&&o.text?o.text:this.layer.title;default:return this.layer.title}}},{key:"onResolutionChange",value:function(){var t=this.layer.isInResolutionsRange;!1===t&&!0===this.updateLegendOnResolutionChange&&this.toggleLegend(!0),this.inResolutionRange$.next(t)}},{key:"updateQueryBadge",value:function(){var t=!1===this.queryBadge||!1===this.layer.visible||!Ui(this.layer);this.queryBadgeHidden$.next(t)}},{key:"toggleLayerTool",value:function(){this.layerTool$.next(!this.layerTool$.getValue()),!0===this.layerTool$.getValue()?this.renderer.addClass(this.elRef.nativeElement,this.focusedCls):this.renderer.removeClass(this.elRef.nativeElement,this.focusedCls),this.action.emit(this.layer)}},{key:"check",value:function(){this.layerCheck=!this.layerCheck,this.checkbox.emit({layer:this.layer,check:this.layerCheck})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(hi),e.Y36(e.Qsj),e.Y36(e.SBq),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-layer-item"]],inputs:{activeLayer:"activeLayer",selectAll:"selectAll",layerCheck:"layerCheck",layer:"layer",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendIfVisible:"expandLegendIfVisible",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",orderable:"orderable",lowerDisabled:"lowerDisabled",raiseDisabled:"raiseDisabled",queryBadge:"queryBadge",selectionMode:"selectionMode",changeDetection:"changeDetection"},outputs:{action:"action",checkbox:"checkbox"},decls:11,vars:9,consts:[[1,"igo-layer-list-item"],["class","layerCheck","mat-list-icon","",3,"checked","change",4,"ngIf"],["matLine","","matTooltipShowDelay","500",1,"igo-layer-title",3,"matTooltip","click"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","selection-eye","mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","actions-button","tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",3,"matTooltip","click",4,"ngIf"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer","updateLegendOnResolutionChange",4,"ngIf"],["mat-list-icon","",1,"layerCheck",3,"checked","change"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],["matBadge","?","matBadgeColor","accent","matBadgeSize","small","matBadgePosition","after",3,"matBadgeHidden","ngClass","svgIcon"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",1,"selection-eye",3,"color","matTooltip","click"],["tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",1,"actions-button",3,"matTooltip","click"],["svgIcon","dots-horizontal"],[3,"layer","updateLegendOnResolutionChange"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-list-item",0),e.YNc(1,__,1,1,"mat-checkbox",1),e.TgZ(2,"h4",2),e.NdJ("click",function(){return t.toggleLegendOnClick()}),e._uU(3),e.qZA(),e.YNc(4,b_,6,15,"button",3),e.YNc(5,C_,6,15,"button",4),e.YNc(6,S_,3,3,"button",5),e.qZA(),e.TgZ(7,"div",6,7),e.YNc(9,w_,1,2,"igo-layer-legend",8),e.ALo(10,"async"),e.qZA()),2&n&&(e.xp6(1),e.Q6J("ngIf",t.selectionMode),e.xp6(1),e.Q6J("matTooltip",t.tooltipText),e.xp6(1),e.Oqu(t.layer.title),e.xp6(1),e.Q6J("ngIf",!t.selectionMode),e.xp6(1),e.Q6J("ngIf",t.selectionMode),e.xp6(1),e.Q6J("ngIf",!t.selectionMode),e.xp6(3),e.Q6J("ngIf",e.lcZ(10,7,t.showLegend$)))},styles:["[_nghost-%COMP%]{overflow:hidden}mat-list-item[_ngcontent-%COMP%]     .mat-list-item-content .layerCheck{align-self:baseline;width:16px;padding-right:0}.igo-layer-list-item[_ngcontent-%COMP%]{height:46px;clear:both}.igo-layer-title[_ngcontent-%COMP%]{cursor:pointer}.igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px)}mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}mat-icon[matBadge][_ngcontent-%COMP%]     .mat-badge-content{font-size:12px}.selection-eye[_ngcontent-%COMP%]{padding-right:45px}"],changeDetection:0}),i}(),gt=function(){return(i=gt||(gt={})).always="always",i.never="never",i.default="default",gt;var i}(),io=function(){return(i=io||(io={})).ALL_VISIBLE="ALL_VISIBLE",i.ALL_HIDDEN="ALL_HIDDEN",i.MIXED="MIXED",i.NULL="NULL",io;var i}(),oi=function(){return(i=oi||(oi={})).Raise="raise",i.Lower="lower",oi;var i}(),T_=["igoLayerItemToolbar"];function x_(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-layer-list-tool",6),e.NdJ("appliedFilterAndSort",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.onAppliedFilterAndSortChange(r))})("selection",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.toggleSelectionMode(r))}),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("layersAreAllVisible",t.layersAreAllVisible)("term",t.layerFilterAndSortOptions.keyword)("onlyVisible",t.layerFilterAndSortOptions.onlyVisible)("sortAlpha",t.layerFilterAndSortOptions.sortAlpha)}}function k_(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-list-item",7)(1,"mat-checkbox",8),e.NdJ("change",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.selectAll())}),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.qZA()()}if(2&i){var t=e.oxw();e.xp6(1),e.Q6J("color",!t.selectAllCheck&&t.layersChecked.length>0?"accent":"primary")("checked",t.selectAllCheck)("indeterminate",!t.selectAllCheck&&t.layersChecked.length>0),e.xp6(1),e.hij(" ",t.selectAllCheck?e.lcZ(3,4,"igo.geo.layer.deselectAll"):e.lcZ(4,6,"igo.geo.layer.selectAll")," ")}}function M_(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-layer-item",10),e.NdJ("action",function(s){e.CHM(n);var l=e.oxw(2);return e.KtG(l.toggleLayerTool(s))})("checkbox",function(s){e.CHM(n);var l=e.oxw(2);return e.KtG(l.layersCheck(s))}),e.qZA()}if(2&i){var t=e.oxw().$implicit,o=e.oxw();e.Q6J("layer",t)("activeLayer",o.activeLayer)("orderable",o.orderable&&!t.baseLayer)("lowerDisabled",o.getLowerLayer().id===t.id)("raiseDisabled",o.getUpperLayer().id===t.id)("queryBadge",o.queryBadge)("expandLegendIfVisible",o.expandLegendOfVisibleLayers)("updateLegendOnResolutionChange",o.updateLegendOnResolutionChange)("toggleLegendOnVisibilityChange",o.toggleLegendOnVisibilityChange)("selectionMode",o.selection)("selectAll",o.selectAllCheck)("layerCheck",t.options.check)("changeDetection",o.layerItemChangeDetection$)}}function F_(i,a){if(1&i&&e.YNc(0,M_,1,13,"igo-layer-item",9),2&i){var n=a.$implicit,t=e.oxw();e.Q6J("ngIf",!(t.excludeBaseLayers&&n.baseLayer))}}function Z_(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",26),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(2);return e.KtG(o.removeLayers())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",27),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.layer.removeLayer"))}function A_(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",28),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(2);return e.KtG(o.zoomLayerExtents(o.activeLayer))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",29),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.layer.zoomLayer"))}var I_=function(a){return{layer:a}};function L_(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-panel",11)(1,"div",12),e.YNc(2,Z_,3,3,"button",13),e.TgZ(3,"button",14),e.NdJ("click",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.moveActiveLayer(s.activeLayer,s.layerListDisplacement.Lower,!0))}),e.ALo(4,"translate"),e.ALo(5,"translate"),e._UZ(6,"mat-icon",15),e.qZA(),e.TgZ(7,"button",16),e.NdJ("click",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.moveActiveLayer(s.activeLayer,s.layerListDisplacement.Raise,!0))}),e.ALo(8,"translate"),e.ALo(9,"translate"),e._UZ(10,"mat-icon",17),e.qZA(),e.TgZ(11,"button",18),e.ALo(12,"translate"),e._UZ(13,"mat-icon",19),e.qZA(),e.TgZ(14,"mat-menu",20,21)(16,"div",22)(17,"mat-slider",23),e.NdJ("input",function(s){e.CHM(n);var l=e.oxw();return e.KtG(l.changeOpacity(s))})("click",function(s){return s.stopPropagation()}),e.ALo(18,"translate"),e.qZA()()(),e.YNc(19,A_,3,3,"button",24),e.GkF(20,25),e.Hsn(21),e.qZA()()}if(2&i){var t=e.MAs(15),o=e.oxw();e.Q6J("title",o.activeLayer.title),e.xp6(2),e.Q6J("ngIf",o.isLayerRemovable(o.activeLayer)),e.xp6(1),e.Q6J("matTooltip",o.sortAlpha||o.onlyVisible||o.keyword?e.lcZ(4,20,"igo.geo.layer.filterLowerLayer"):e.lcZ(5,22,"igo.geo.layer.lowerLayer"))("disabled",o.lowerDisabled),e.xp6(3),e.Q6J("matBadge",o.sortAlpha||o.onlyVisible||o.keyword?"!":"")("matBadgeHidden",o.lowerDisabled),e.xp6(1),e.Q6J("matTooltip",o.sortAlpha||o.onlyVisible||o.keyword?e.lcZ(8,24,"igo.geo.layer.filterRaiseLayer"):e.lcZ(9,26,"igo.geo.layer.raiseLayer"))("disabled",o.raiseDisabled),e.xp6(3),e.Q6J("matBadge",o.sortAlpha||o.onlyVisible||o.keyword?"!":"")("matBadgeHidden",o.raiseDisabled),e.xp6(1),e.Q6J("matMenuTriggerFor",t)("matTooltip",e.lcZ(12,28,"igo.geo.layer.opacity")),e.xp6(2),e.Q6J("matBadge",o.badgeOpacity),e.xp6(4),e.Q6J("min",0)("max",100)("value",o.opacity)("matTooltip",e.lcZ(18,30,"igo.geo.layer.opacity")),e.xp6(2),e.Q6J("ngIf",o.activeLayerExtentIsValid(o.activeLayer)),e.xp6(1),e.Q6J("ngTemplateOutlet",o.templateLayerToolbar)("ngTemplateOutletContext",e.VKq(32,I_,o.activeLayer))}}function O_(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-slider",38),e.NdJ("ngModelChange",function(r){e.CHM(n);var s=e.oxw(2);return e.KtG(s.checkOpacity=r)})("click",function(r){return r.stopPropagation()}),e.ALo(1,"translate"),e.qZA()}if(2&i){var t=e.oxw(2);e.Q6J("min",0)("max",100)("ngModel",t.checkOpacity)("matTooltip",e.lcZ(1,4,"igo.geo.layer.opacity"))}}function D_(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",28),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(2);return e.KtG(o.zoomLayersExtents(o.layersChecked))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",39),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.layer.zoomLayers"))}function P_(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-panel",11),e.ALo(1,"translate"),e.TgZ(2,"div",30)(3,"button",31),e.NdJ("click",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.removeLayers(s.layersChecked))}),e.ALo(4,"translate"),e.ALo(5,"translate"),e._UZ(6,"mat-icon",32),e.qZA(),e.TgZ(7,"button",33),e.NdJ("click",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.toggleVisibility(s.layersChecked))}),e.ALo(8,"translate"),e.ALo(9,"translate"),e._UZ(10,"mat-icon",34),e.qZA(),e.TgZ(11,"button",14),e.NdJ("click",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.lowerLayers(s.layersChecked))}),e.ALo(12,"translate"),e.ALo(13,"translate"),e._UZ(14,"mat-icon",15),e.qZA(),e.TgZ(15,"button",16),e.NdJ("click",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.raiseLayers(s.layersChecked))}),e.ALo(16,"translate"),e.ALo(17,"translate"),e._UZ(18,"mat-icon",17),e.qZA(),e.TgZ(19,"button",35),e.ALo(20,"translate"),e._UZ(21,"mat-icon",36),e.qZA(),e.TgZ(22,"mat-menu",20,21)(24,"div",22),e.YNc(25,O_,2,6,"mat-slider",37),e.qZA()(),e.YNc(26,D_,3,3,"button",24),e.qZA()()}if(2&i){var t=e.MAs(23),o=e.oxw();e.Q6J("title",e.lcZ(1,21,"igo.geo.layer.tools")),e.xp6(3),e.Q6J("disabled",0===o.layersChecked.length)("matTooltip",o.isAllLayersRemovable(o.layersChecked)?e.lcZ(4,23,"igo.geo.layer.removeSelectedLayers"):e.lcZ(5,25,"igo.geo.layer.removeSelectedLayersRestriction")),e.xp6(3),e.Q6J("matBadge","!")("matBadgeHidden",o.isAllLayersRemovable(o.layersChecked)),e.xp6(1),e.Q6J("disabled",0===o.layersChecked.length)("matTooltip","ALL_HIDDEN"===o.statusSelectedLayersCheck?e.lcZ(8,27,"igo.geo.layer.showSelectedLayers"):e.lcZ(9,29,"igo.geo.layer.hideSelectedLayers")),e.xp6(3),e.Q6J("svgIcon","ALL_HIDDEN"===o.statusSelectedLayersCheck?"eye-off":"eye"),e.xp6(1),e.Q6J("matTooltip",o.sortAlpha||o.onlyVisible||o.keyword?e.lcZ(12,31,"igo.geo.layer.filterLowerLayer"):e.lcZ(13,33,"igo.geo.layer.lowerLayer"))("disabled",o.lowerDisabledSelection),e.xp6(3),e.Q6J("matBadge",o.sortAlpha||o.onlyVisible||o.keyword?"!":"")("matBadgeHidden",o.lowerDisabledSelection),e.xp6(1),e.Q6J("matTooltip",o.sortAlpha||o.onlyVisible||o.keyword?e.lcZ(16,35,"igo.geo.layer.filterRaiseLayer"):e.lcZ(17,37,"igo.geo.layer.raiseLayer"))("disabled",o.raiseDisabledSelection),e.xp6(3),e.Q6J("matBadge",o.sortAlpha||o.onlyVisible||o.keyword?"!":"")("matBadgeHidden",o.raiseDisabledSelection),e.xp6(1),e.Q6J("disabled",0===o.layersChecked.length)("matMenuTriggerFor",t)("matTooltip",e.lcZ(20,39,"igo.geo.layer.opacity")),e.xp6(6),e.Q6J("ngIf",o.layersChecked.length),e.xp6(1),e.Q6J("ngIf",0!==o.layersChecked.length&&o.activeLayersExtentAreValid(o.layersChecked))}}var E_=[[["","igoLayerItemToolbar",""]]],$_=function(a,n,t){return{"igo-list-tools-multi":a,"igo-list-tools-single":n,"igo-list-no-tools":t}},R_=["[igoLayerItemToolbar]"],ko=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.elRef=n,this.orderable=!0,this.thresholdToFilterAndSort=5,this.layers$=new x.X([]),this.change$=new vi.t(1),this.showToolbar$=new x.X(!1),this.hideSelectedLayers=!0,this.activeLayer$=new x.X(void 0),this.layersChecked=[],this.layerItemChangeDetection$=new x.X(void 0),this.layersAreAllVisible=!0,this.ogcButton=!0,this.timeButton=!0,this.floatLabel="auto",this.layerFilterAndSortOptions={},this.excludeBaseLayers=!1,this.toggleLegendOnVisibilityChange=!1,this.expandLegendOfVisibleLayers=!1,this.updateLegendOnResolutionChange=!1,this.queryBadge=!1,this.appliedFilterAndSort=new e.vpe,this._keyword=void 0,this._onlyVisible=!1,this._sortedAlpha=!1,this.toggleOpacity=!1,this.selectAllCheck$=new x.X(void 0)}return(0,v.Z)(a,[{key:"map",get:function(){return this._map},set:function(t){this._map=t}},{key:"layers",get:function(){return this._layers},set:function(t){this._layers=this.removeProblemLayerInList(t),this.next()}},{key:"activeLayer",get:function(){return this._activeLayer},set:function(t){this._activeLayer=t,this.activeLayer$.next(t)}},{key:"keyword",get:function(){return this._keyword},set:function(t){this._keyword=t,this.next()}},{key:"onlyVisible",get:function(){return this._onlyVisible},set:function(t){this._onlyVisible=t,this.next()}},{key:"sortAlpha",get:function(){return this._sortedAlpha},set:function(t){this._sortedAlpha=t,this.next()}},{key:"opacity",get:function(){return Math.round(100*this.activeLayer$.getValue().opacity)},set:function(t){this.activeLayer$.getValue().opacity=t/100}},{key:"badgeOpacity",get:function(){if(100!==this.opacity)return this.opacity}},{key:"raiseDisabled",get:function(){return!(this.orderable&&!this.activeLayer.baseLayer&&this.getUpperLayer().id!==this.activeLayer.id&&!this.isUpperBaselayer(this.activeLayer))}},{key:"lowerDisabled",get:function(){return!(this.orderable&&!this.activeLayer.baseLayer&&this.getLowerLayer().id!==this.activeLayer.id&&!this.isLowerBaselayer(this.activeLayer))}},{key:"raiseDisabledSelection",get:function(){return 0===this.layersChecked.length||!this.orderable||!this.raisableLayers(this.layersChecked)||!0===this.selectAllCheck}},{key:"lowerDisabledSelection",get:function(){return 0===this.layersChecked.length||!this.orderable||!this.lowerableLayers(this.layersChecked)||!0===this.selectAllCheck}},{key:"checkOpacity",get:function(){return 100*this.layersCheckedOpacity()},set:function(t){var r,o=(0,D.Z)(this.layersChecked);try{for(o.s();!(r=o.n()).done;)r.value.opacity=t/100}catch(l){o.e(l)}finally{o.f()}}},{key:"layerListDisplacement",get:function(){return oi}},{key:"ngOnInit",value:function(){var t=this;this.change$$=this.change$.pipe((0,xi.D)(function(){return 0===t.layers.length?_o.E:(0,Ti.H)(50)})).subscribe(function(){t.showToolbar$.next(t.computeShowToolbar()),t.layers$.next(t.computeLayers(t.layers.slice(0))),t.appliedFilterAndSort.emit({keyword:t.keyword,sortAlpha:t.sortAlpha,onlyVisible:t.onlyVisible})}),this.selectAllCheck$$=this.selectAllCheck$.subscribe(function(o){t.selectAllCheck=o}),this.layers$$=this.layers$.subscribe(function(){if(t.layers){var s,o=0,r=(0,D.Z)(t.layers);try{var l=function(){var u=s.value;u.status$.subscribe(function(p){0===p&&t.map.removeLayer(u)}),u.options.active&&(t.activeLayer=u,t.layerTool=!0),u.options.check&&(o+=1)};for(r.s();!(s=r.n()).done;)l()}catch(c){r.e(c)}finally{r.f()}t.selectAllCheck=t.excludeBaseLayers?o===t.layers.filter(function(c){return!0!==c.baseLayer&&c.showInLayerList}).length:o===t.layers.filter(function(c){return c.showInLayerList}).length}})}},{key:"ngOnDestroy",value:function(){this.change$$.unsubscribe(),this.selectAllCheck$$.unsubscribe(),this.layers$$.unsubscribe()}},{key:"activeLayerExtentIsValid",value:function(t){var o=!1;if(!1===t.options.showButtonZoomToExtent)return!1;var r=t.options.extent,s=this.map.viewController.maxLayerZoomExtent;return r&&(o=!s||Ke.r4(s,r)),o}},{key:"activeLayersExtentAreValid",value:function(t){var c,o=!1,r=Ke.lJ(),s=this.map.viewController.maxLayerZoomExtent,l=(0,D.Z)(t);try{for(l.s();!(c=l.n()).done;){var p=c.value.options.extent;p&&!p.includes(1/0)&&Ke.l7(r,p)}}catch(d){l.e(d)}finally{l.f()}return Ke.xb(r)||(o=!s||Ke.r4(s,r)),o}},{key:"zoomLayerExtents",value:function(t){this.map.viewController.zoomToExtent(t.options.extent)}},{key:"zoomLayersExtents",value:function(t){var s,o=Ke.lJ(),r=(0,D.Z)(t);try{for(r.s();!(s=r.n()).done;){var c=s.value.options.extent;c&&Ke.l7(o,c)}}catch(u){r.e(u)}finally{r.f()}this.map.viewController.zoomToExtent(o)}},{key:"changeOpacity",value:function(t){this.opacity=t.value}},{key:"clearKeyword",value:function(){this.keyword=void 0}},{key:"getLowerLayer",value:function(){return this.layers.filter(function(t){return!t.baseLayer}).reduce(function(t,o){return t.zIndex<o.zIndex?t:o},{zIndex:void 0,id:void 0})}},{key:"isLowerBaselayer",value:function(t){var o=this.layers.findIndex(function(r){return t.id===r.id});return!(!this.layers||!this.layers[o+1]||!0!==this.layers[o+1].baseLayer)}},{key:"getUpperLayer",value:function(){return this.layers.filter(function(t){return!t.baseLayer}).reduce(function(t,o){return t.zIndex>o.zIndex?t:o},{zIndex:void 0,id:void 0})}},{key:"isUpperBaselayer",value:function(t){var o=this.layers.findIndex(function(r){return t.id===r.id});return!(!this.layers||!this.layers[o-1]||!0!==this.layers[o-1].baseLayer)}},{key:"moveActiveLayer",value:function(t,o){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=[];Nr(this.map,t,ze.ZINDEX);var l=Nr(this.map,t,ze.ZINDEX);l||(l=t);var c=[l];bs(this.map,l,c,ze.ZINDEX),this.layers.map(function(u){-1!==c.indexOf(u)&&s.push(u)}),o===oi.Raise?this.raiseLayers(s,r):o===oi.Lower&&this.lowerLayers(s,r)}},{key:"raisableLayers",value:function(t){var c,o=this,r=!1,s=0,l=(0,D.Z)(t);try{var u=function(){var d=c.value,g=o.layers.findIndex(function(y){return d.id===y.id}),f=o.layers[g];f.baseLayer&&(s+=1);var m=o.layers[g-1];m&&!0!==m.baseLayer&&!t.find(function(y){return m.id===y.id})&&!0!==f.baseLayer&&(r=!0)};for(l.s();!(c=l.n()).done;)u()}catch(p){l.e(p)}finally{l.f()}return(1===this.layersChecked.length&&this.layersChecked[0].baseLayer||s===this.layersChecked.length)&&(r=!1),r}},{key:"raisableLayer",value:function(t){return!(t<1)&&(!this.layers[t-1].options.check||this.raisableLayer(t-1))}},{key:"raiseLayers",value:function(t){var c,o=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=[],l=(0,D.Z)(t);try{var u=function(){var d=c.value,g=o.layers.findIndex(function(f){return f.id===d.id});o.raisableLayer(g)&&s.push(d)};for(l.s();!(c=l.n()).done;)u()}catch(p){l.e(p)}finally{l.f()}this.map.raiseLayers(s),r&&setTimeout(function(){var g,p=o.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked"),d=o.elRef.nativeElement.getElementsByClassName("igo-layer-item-focused");p.length&&(g=p[0]),d.length&&(g=d[0]),g&&(0,Sa.Z)(g,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})},100)}},{key:"lowerableLayers",value:function(t){var c,o=this,r=!1,s=0,l=(0,D.Z)(t);try{var u=function(){var d=c.value,g=o.layers.findIndex(function(y){return d.id===y.id});o.layers[g].baseLayer&&(s+=1);var m=o.layers[g+1];m&&!0!==m.baseLayer&&!t.find(function(y){return m.id===y.id})&&(r=!0)};for(l.s();!(c=l.n()).done;)u()}catch(p){l.e(p)}finally{l.f()}return(1===this.layersChecked.length&&this.layersChecked[0].baseLayer||s===this.layersChecked.length)&&(r=!1),r}},{key:"lowerableLayer",value:function(t){return!(t>this.layers.filter(function(o){return!0!==o.baseLayer}).length-2)&&(!this.layers[t+1].options.check||this.lowerableLayer(t+1))}},{key:"lowerLayers",value:function(t){var c,o=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=[],l=(0,D.Z)(t);try{var u=function(){var d=c.value,g=o.layers.findIndex(function(f){return f.id===d.id});o.lowerableLayer(g)&&s.push(d)};for(l.s();!(c=l.n()).done;)u()}catch(p){l.e(p)}finally{l.f()}this.map.lowerLayers(s),r&&setTimeout(function(){var g,p=o.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked"),d=o.elRef.nativeElement.getElementsByClassName("igo-layer-item-focused");p.length&&(g=p[p.length-1]),d.length&&(g=d[0]),g&&(0,Sa.Z)(g,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})},100)}},{key:"next",value:function(){this.change$.next()}},{key:"computeLayers",value:function(t){var o=this.filterLayers(t);return this.sortAlpha?this.sortLayersByTitle(o):this.sortLayersByZindex(o)}},{key:"onKeywordChange",value:function(t){this.keyword=t}},{key:"onAppliedFilterAndSortChange",value:function(t){this.keyword=t.keyword,this.onlyVisible=t.onlyVisible,this.sortAlpha=t.sortAlpha}},{key:"filterLayers",value:function(t){var o=this;if(this.layerFilterAndSortOptions.showToolbar===gt.never||!this.keyword&&!this.onlyVisible)return t;var r=t.map(function(s){return s.id});return t.forEach(function(s){var c=s.dataSource.options||{},d=(((s.options||{}).metadata||{}).keywordList||[]).map(function(T){return T.normalize("NFD").replace(/[\u0300-\u036f]/g,"")});if(o.keyword&&s.title){var g=o.keyword.normalize("NFD").replace(/[\u0300-\u036f]/g,""),f=s.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),m=c.type||"",y=new RegExp(g,"gi"),_=void 0!==d.find(function(T){return y.test(T)});if(!y.test(f)&&o.keyword.toLowerCase()!==m.toLowerCase()&&!_){var b=r.indexOf(s.id);b>-1&&r.splice(b,1)}}if(o.onlyVisible&&!1===s.visible){var w=r.indexOf(s.id);w>-1&&r.splice(w,1)}}),t.filter(function(s){return-1!==r.indexOf(s.id)})}},{key:"sortLayersByZindex",value:function(t){return t.sort(function(o,r){return r.zIndex-o.zIndex})}},{key:"sortLayersByTitle",value:function(t){var o=this;return t.sort(function(r,s){return o.normalize(r.title)<o.normalize(s.title)?-1:o.normalize(r.title)>o.normalize(s.title)?1:0})}},{key:"normalize",value:function(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}},{key:"computeShowToolbar",value:function(){switch(this.layerFilterAndSortOptions.showToolbar){case gt.always:return!0;case gt.never:return!1;default:return!!(this.layers.length>=this.thresholdToFilterAndSort||this.keyword||this.onlyVisible)}}},{key:"toggleLayerTool",value:function(t){this.toggleOpacity=!1,this.layerTool=!this.layerTool||t!==this.activeLayer;var r,o=(0,D.Z)(this.layers);try{for(o.s();!(r=o.n()).done;)r.value.options.active=!1}catch(l){o.e(l)}finally{o.f()}t.options.active=!0,this.activeLayer=t}},{key:"removeLayers",value:function(t){if(t&&t.length>0){this.layersChecked=[];var r,o=(0,D.Z)(t);try{for(o.s();!(r=o.n()).done;){var s=r.value;!1!==s.options.removable?s.map.removeLayer(s):this.layersChecked.push(s)}}catch(l){o.e(l)}finally{o.f()}}else!t&&!1!==this.activeLayer.options.removable&&(this.activeLayer.map.removeLayer(this.activeLayer),this.layerTool=!1)}},{key:"toggleVisibility",value:function(t){if(t&&t.length>0){var r,o=(0,D.Z)(t);try{for(o.s();!(r=o.n()).done;)r.value.visible=this.hideSelectedLayers}catch(l){o.e(l)}finally{o.f()}}this.layerItemChangeDetection$.next(!0)}},{key:"isLayerRemovable",value:function(t){return!1!==t.options.removable}},{key:"isAllLayersRemovable",value:function(t){var o=this;return t.every(function(r){return o.isLayerRemovable(r)})}},{key:"statusSelectedLayersCheck",get:function(){var t=io.NULL,o=!1,r=!1;if(0===this.layersChecked.length)t=io.NULL;else{t=io.MIXED,this.hideSelectedLayers=!1;var l,s=(0,D.Z)(this.layersChecked);try{for(s.s();!(l=s.n()).done;){var c=l.value;!0===c.visible&&(o=!0),!1===c.visible&&(r=!0)}}catch(u){s.e(u)}finally{s.f()}!0===o&&!1===r&&(t=io.ALL_VISIBLE),!1===o&&!0===r&&(t=io.ALL_HIDDEN,this.hideSelectedLayers=!0)}return t}},{key:"layersCheck",value:function(t){var o=this;if(t.layer.options.check=t.check,!0===t.check){var l,r=this.layers.findIndex(function(d){return t.layer.id===d.id}),s=(0,D.Z)(this.layersChecked);try{var c=function(){var g=l.value,f=o.layers.findIndex(function(m){return g.id===m.id});if(r<f)return o.layersChecked.splice(o.layersChecked.findIndex(function(m){return g.id===m.id}),0,t.layer),o.excludeBaseLayers?o.selectAllCheck=o.layersChecked.length===o.layers.filter(function(m){return!0!==m.baseLayer&&m.showInLayerList}).length:o.excludeBaseLayers||(o.selectAllCheck=o.layersChecked.length===o.layers.filter(function(m){return m.showInLayerList}).length),{v:void 0}};for(s.s();!(l=s.n()).done;){var u=c();if("object"==typeof u)return u.v}}catch(d){s.e(d)}finally{s.f()}this.layersChecked.push(t.layer)}else{var p=this.layersChecked.findIndex(function(d){return t.layer.id===d.id});this.layersChecked.splice(p,1)}this.excludeBaseLayers?this.selectAllCheck=this.layersChecked.length===this.layers.filter(function(d){return!0!==d.baseLayer&&d.showInLayerList}).length:this.excludeBaseLayers||(this.selectAllCheck=this.layersChecked.length===this.layers.filter(function(d){return d.showInLayerList}).length)}},{key:"toggleSelectionMode",value:function(t){if(this.selection=t,this.activeLayer=void 0,!0===t){this.layerTool=!1;var r,o=(0,D.Z)(this.layers);try{for(o.s();!(r=o.n()).done;){var s=r.value;s.options.check&&this.layersChecked.push(s)}}catch(l){o.e(l)}finally{o.f()}}}},{key:"layersCheckedOpacity",value:function(){if(this.layersChecked.length>1)return 1;var r,t=[],o=(0,D.Z)(this.layersChecked);try{for(o.s();!(r=o.n()).done;)t.push(r.value.opacity)}catch(l){o.e(l)}finally{o.f()}return t}},{key:"selectAll",value:function(){if(this.selectAllCheck){var l,s=(0,D.Z)(this.layers);try{for(s.s();!(l=s.n()).done;)l.value.options.check=!1}catch(u){s.e(u)}finally{s.f()}this.layersChecked=[],this.selectAllCheck$.next(!1)}else{var o,t=(0,D.Z)(this.layers);try{for(t.s();!(o=t.n()).done;){var r=o.value;(this.excludeBaseLayers&&!0!==r.baseLayer&&r.showInLayerList||!this.excludeBaseLayers&&r.showInLayerList)&&(r.options.check=!0,this.layersChecked.push(r))}}catch(u){t.e(u)}finally{t.f()}this.selectAllCheck$.next(!0)}}},{key:"isScrolledIntoView",value:function(t,o){var r=t.scrollTop,l=o.offsetTop;return l+o.clientHeight<=r+t.clientHeight&&l>=r}},{key:"removeProblemLayerInList",value:function(t){var r,o=(0,D.Z)(t);try{for(o.s();!(r=o.n()).done;){var s=r.value;!0===s.olLoadingProblem&&this.map.removeLayer(s)}}catch(l){o.e(l)}finally{o.f()}return t}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.SBq))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-layer-list"]],contentQueries:function(n,t,o){var r;1&n&&e.Suo(o,T_,5),2&n&&e.iGM(r=e.CRH())&&(t.templateLayerToolbar=r.first)},inputs:{layersAreAllVisible:"layersAreAllVisible",ogcButton:"ogcButton",timeButton:"timeButton",map:"map",layers:"layers",floatLabel:"floatLabel",layerFilterAndSortOptions:"layerFilterAndSortOptions",excludeBaseLayers:"excludeBaseLayers",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",queryBadge:"queryBadge"},outputs:{appliedFilterAndSort:"appliedFilterAndSort"},ngContentSelectors:R_,decls:11,vars:16,consts:[["floatLabel","auto",3,"layersAreAllVisible","term","onlyVisible","sortAlpha","appliedFilterAndSort","selection",4,"ngIf"],["class","select-all",4,"ngIf"],[3,"ngClass","navigation","selection"],["igoList",""],["ngFor","",3,"ngForOf"],["class","igo-layer-actions-container",3,"title",4,"ngIf"],["floatLabel","auto",3,"layersAreAllVisible","term","onlyVisible","sortAlpha","appliedFilterAndSort","selection"],[1,"select-all"],[1,"select-all-checkbox","mat-subheading-2",3,"color","checked","indeterminate","change"],["igoListItem","",3,"layer","activeLayer","orderable","lowerDisabled","raiseDisabled","queryBadge","expandLegendIfVisible","updateLegendOnResolutionChange","toggleLegendOnVisibilityChange","selectionMode","selectAll","layerCheck","changeDetection","action","checkbox",4,"ngIf"],["igoListItem","",3,"layer","activeLayer","orderable","lowerDisabled","raiseDisabled","queryBadge","expandLegendIfVisible","updateLegendOnResolutionChange","toggleLegendOnVisibilityChange","selectionMode","selectAll","layerCheck","changeDetection","action","checkbox"],[1,"igo-layer-actions-container",3,"title"],[1,"igo-layer-button-group"],["class","delete-button","mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"down-button",3,"matTooltip","disabled","click"],["matBadgeColor","warn","matBadgeSize","medium","svgIcon","arrow-down",3,"matBadge","matBadgeHidden"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"up-button",3,"matTooltip","disabled","click"],["matBadgeColor","warn","matBadgeSize","medium","svgIcon","arrow-up",3,"matBadge","matBadgeHidden"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"opacity-button",3,"matMenuTriggerFor","matTooltip"],["matBadgeColor","primary","matBadgeSize","medium","svgIcon","opacity",3,"matBadge"],[1,"mat-menu-opacity-slider"],["opacityMenu","matMenu"],["id","opacity-menu"],["id","opacity-slider","color","primary","thumbLabel","","tickInterval","5","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","value","matTooltip","input","click"],["class","zoomLayer-button","color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["igoLayerItemToolbar","",3,"ngTemplateOutlet","ngTemplateOutletContext"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"delete-button",3,"matTooltip","click"],["svgIcon","delete"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"zoomLayer-button",3,"matTooltip","click"],["matBadgeColor","primary","matBadgeSize","medium","svgIcon","magnify-scan"],[1,"actions-buttons-multi"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"delete-button",3,"disabled","matTooltip","click"],["matBadgeColor","warn","matBadgeSize","medium","svgIcon","delete",3,"matBadge","matBadgeHidden"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"eye-button",3,"disabled","matTooltip","click"],[3,"svgIcon"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"opacity-button",3,"disabled","matMenuTriggerFor","matTooltip"],["svgIcon","opacity"],["id","opacity-slider","color","primary","thumbLabel","","tickInterval","5","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","ngModel","matTooltip","ngModelChange","click",4,"ngIf"],["id","opacity-slider","color","primary","thumbLabel","","tickInterval","5","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","ngModel","matTooltip","ngModelChange","click"],["svgIcon","magnify-scan"]],template:function(n,t){1&n&&(e.F$t(E_),e.TgZ(0,"mat-list"),e.YNc(1,x_,1,4,"igo-layer-list-tool",0),e.ALo(2,"async"),e.qZA(),e.YNc(3,k_,5,8,"mat-list-item",1),e._UZ(4,"mat-divider"),e.TgZ(5,"igo-list",2,3),e.YNc(7,F_,1,1,"ng-template",4),e.ALo(8,"async"),e.qZA(),e.YNc(9,L_,22,34,"igo-panel",5),e.YNc(10,P_,27,41,"igo-panel",5)),2&n&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,8,t.showToolbar$)),e.xp6(2),e.Q6J("ngIf",t.selection),e.xp6(2),e.Q6J("ngClass",e.kEZ(12,$_,t.selection,t.layerTool&&!t.selection,!t.layerTool&&!t.selection))("navigation",!1)("selection",!1),e.xp6(2),e.Q6J("ngForOf",e.lcZ(8,10,t.layers$)),e.xp6(2),e.Q6J("ngIf",!t.selection&&t.layerTool&&t.activeLayer),e.xp6(1),e.Q6J("ngIf",t.selection&&t.layers.length>0))},styles:["[_nghost-%COMP%]   .igo-list-no-tools[_ngcontent-%COMP%]{height:calc(100% - 57px);padding-top:8px}[_nghost-%COMP%]   .igo-list-tools-single[_ngcontent-%COMP%]{height:calc(100% - 153px);padding-top:8px}[_nghost-%COMP%]   .igo-list-tools-multi[_ngcontent-%COMP%]{height:calc(100% - 191px);padding-top:8px}mat-form-field.inputFilter[_ngcontent-%COMP%]{width:calc(100% - 100px);max-width:200px}.igo-layer-actions-container[_ngcontent-%COMP%]{width:calc(100% - 5px);padding-left:4px}.igo-layer-actions-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{text-align:center}mat-list-item[_ngcontent-%COMP%]     .mat-list-item-content{margin-bottom:10px}mat-checkbox[_ngcontent-%COMP%]     .mat-checkbox-inner-container{margin-left:8px;margin-right:16px}#opacity-slider[_ngcontent-%COMP%]{float:left;min-width:0;min-width:initial;width:110px;left:10px;top:10px}.igo-layer-button-group[_ngcontent-%COMP%], .actions-buttons-multi[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row-reverse;overflow-x:auto;overflow-y:hidden}.igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar, .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar{height:4px}.igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-track, .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}.igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888}.igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover, .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}.igo-layer-button-group[_ngcontent-%COMP%]{padding-top:5px}[_nghost-%COMP%]   igo-panel[_ngcontent-%COMP%]{height:auto;height:initial}#opacity-menu[_ngcontent-%COMP%]{max-width:none;max-width:initial;width:132px;height:50px}#opacity-menu[_ngcontent-%COMP%]   .mat-menu-content[_ngcontent-%COMP%]:not(:empty){padding-top:20px}.select-all[_ngcontent-%COMP%]     .mat-list-item-content{margin:0}"],changeDetection:0}),i}();function J_(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(n);var o=e.oxw();return e.KtG(o.clearTerm())}),e._UZ(1,"mat-icon",10),e.qZA()}}var B_=function(){var i=function(){function a(){(0,h.Z)(this,a),this.onlyVisible$=new x.X(!1),this.sortAlpha$=new x.X(!1),this.term$=new x.X(void 0),this.layersAreAllVisible=!0,this.floatLabel="auto",this.selectionMode=!1,this.appliedFilterAndSort=new e.vpe,this.selection=new e.vpe}return(0,v.Z)(a,[{key:"onlyVisible",get:function(){return this.onlyVisible$.value},set:function(t){this.onlyVisible$.next(t)}},{key:"sortAlpha",get:function(){return this.sortAlpha$.value},set:function(t){this.sortAlpha$.next(t)}},{key:"term",get:function(){return this.term$.value},set:function(t){this.term$.next(t)}},{key:"ngOnInit",value:function(){var t=this;this.term$$=this.term$.subscribe(function(o){t.appliedFilterAndSort.emit({keyword:o,onlyVisible:t.onlyVisible,sortAlpha:t.sortAlpha})}),this.onlyVisible$$=this.onlyVisible$.subscribe(function(o){t.appliedFilterAndSort.emit({keyword:t.term,onlyVisible:o,sortAlpha:t.sortAlpha})}),this.sortAlpha$$=this.sortAlpha$.subscribe(function(o){t.appliedFilterAndSort.emit({keyword:t.term,onlyVisible:t.onlyVisible,sortAlpha:o})})}},{key:"ngOnDestroy",value:function(){this.onlyVisible$$.unsubscribe(),this.sortAlpha$$.unsubscribe(),this.term$$.unsubscribe()}},{key:"clearTerm",value:function(){this.term=void 0}},{key:"toggleSortAlpha",value:function(){this.sortAlpha=!this.sortAlpha}},{key:"toggleOnlyVisible",value:function(){this.onlyVisible=!this.onlyVisible}},{key:"toggleSelectionMode",value:function(){this.selectionMode=!this.selectionMode,this.selection.emit(this.selectionMode)}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-layer-list-tool"]],inputs:{layersAreAllVisible:"layersAreAllVisible",floatLabel:"floatLabel",onlyVisible:"onlyVisible",sortAlpha:"sortAlpha",term:"term"},outputs:{appliedFilterAndSort:"appliedFilterAndSort",selection:"selection"},decls:21,vars:30,consts:[[1,"inputFilter",3,"floatLabel"],["matInput","","matTooltipShowDelay","500","type","text",3,"placeholder","matTooltip","ngModel","ngModelChange"],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear","color","warn",3,"click",4,"ngIf"],["matTooltipShowDelay","500",3,"matTooltip"],["mat-icon-button","",1,"sort-alpha",3,"color","click"],[3,"svgIcon"],["mat-icon-button","",1,"only-visible",3,"disabled","color","click"],["matBadge","icon","igoMatBadgeIcon","eye","igoMatBadgeInverseColor","true","igoMatBadgeInheritColor","true",3,"svgIcon"],["mat-icon-button","","color","primary",1,"selection-mode",3,"click"],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear","color","warn",3,"click"],["svgIcon","close"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-list-item")(1,"mat-form-field",0)(2,"input",1),e.NdJ("ngModelChange",function(r){return t.term=r}),e.ALo(3,"translate"),e.ALo(4,"translate"),e.qZA(),e.YNc(5,J_,2,0,"button",2),e.qZA(),e.TgZ(6,"div",3),e.ALo(7,"translate"),e.ALo(8,"translate"),e.TgZ(9,"button",4),e.NdJ("click",function(){return t.toggleSortAlpha()}),e._UZ(10,"mat-icon",5),e.qZA()(),e.TgZ(11,"div",3),e.ALo(12,"translate"),e.ALo(13,"translate"),e.TgZ(14,"button",6),e.NdJ("click",function(){return t.toggleOnlyVisible()}),e._UZ(15,"mat-icon",7),e.qZA()(),e.TgZ(16,"div",3),e.ALo(17,"translate"),e.ALo(18,"translate"),e.TgZ(19,"button",8),e.NdJ("click",function(){return t.toggleSelectionMode()}),e._UZ(20,"mat-icon",5),e.qZA()()()),2&n&&(e.xp6(1),e.Q6J("floatLabel",t.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(3,14,"igo.geo.layer.filterPlaceholder"))("matTooltip",e.lcZ(4,16,"igo.geo.layer.subsetLayersListKeyword"))("ngModel",t.term),e.xp6(3),e.Q6J("ngIf",t.term),e.xp6(1),e.Q6J("matTooltip",t.sortAlpha?e.lcZ(7,18,"igo.geo.layer.sortMapOrder"):e.lcZ(8,20,"igo.geo.layer.sortAlphabetically")),e.xp6(3),e.Q6J("color",t.sortAlpha?"warn":"primary"),e.xp6(1),e.Q6J("svgIcon",t.sortAlpha?"sort-ascending":"sort-alphabetical-ascending"),e.xp6(1),e.Q6J("matTooltip",t.onlyVisible?e.lcZ(12,22,"igo.geo.layer.resetLayersList"):e.lcZ(13,24,"igo.geo.layer.subsetLayersListOnlyVisible")),e.xp6(3),e.Q6J("disabled",t.layersAreAllVisible&&!t.onlyVisible)("color",t.onlyVisible?"warn":"primary"),e.xp6(1),e.Q6J("svgIcon",t.onlyVisible?"filter-remove":"filter"),e.xp6(1),e.Q6J("matTooltip",t.selectionMode?e.lcZ(17,26,"igo.geo.layer.deactivateSelectionMode"):e.lcZ(18,28,"igo.geo.layer.activateSelectionMode")),e.xp6(4),e.Q6J("svgIcon",t.selectionMode?"checkbox-multiple-marked-outline":"checkbox-multiple-blank-outline"))},dependencies:[B.KE,B.R9,le.Nt,S.Fj,S.JJ,C.O5,S.On,O.Hw,I.lW,J.gM,X.Tg,bt.k,Ma,E.X$],styles:["mat-form-field.inputFilter[_ngcontent-%COMP%]{width:calc(100% - 100px);max-width:200px}.selection-mode[_ngcontent-%COMP%]{margin-left:5px}"],changeDetection:0}),i}(),qr=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.mapService=t,this.route=o,this.component=n}return(0,v.Z)(a,[{key:"ngOnInit",value:function(){var t=this;this.layersOrResolutionChange$$=(0,dt.a)([this.mapService.getMap().layers$,this.mapService.getMap().viewController.resolution$]).pipe((0,De.b)(10)).subscribe(function(o){var r=o[0].filter(function(s){return!0===s.showInLayerList});t.component.layers=r,t.setLayersVisibilityStatus(r,t.component.excludeBaseLayers)})}},{key:"setLayersVisibilityStatus",value:function(t,o){var r=this;void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0),this.layersVisibility$$=(0,dt.a)(t.filter(function(s){return s.baseLayer!==o}).map(function(s){return s.visible$})).pipe((0,U.U)(function(s){return s.every(Boolean)})).subscribe(function(s){return r.component.layersAreAllVisible=s})}},{key:"ngOnDestroy",value:function(){this.layersOrResolutionChange$$.unsubscribe(),void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(ko,2),e.Y36(Vt),e.Y36(Io,8))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoLayerListBinding",""]]}),i}();function U_(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-slide-toggle",6),e.NdJ("change",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.toggleShowAllLegends(r.checked))}),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"translate"),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,4,"igo.geo.layer.legend.showAll"))("checked",t.showAllLegendsValue)("labelPosition","before"),e.xp6(2),e.hij(" ",e.lcZ(3,6,"igo.geo.layer.legend.showAll")," ")}}function N_(i,a){1&i&&e._UZ(0,"mat-divider")}function q_(i,a){if(1&i&&e._UZ(0,"igo-layer-legend-item",8),2&i){var n=e.oxw().$implicit,t=e.oxw();e.Q6J("layer",n)("updateLegendOnResolutionChange",t.updateLegendOnResolutionChange)}}function G_(i,a){if(1&i&&e.YNc(0,q_,1,2,"igo-layer-legend-item",7),2&i){var n=a.$implicit,t=e.oxw();e.Q6J("ngIf",!(t.excludeBaseLayers&&n.baseLayer))}}function Q_(i,a){1&i&&(e.TgZ(0,"p",9),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLayersVisibleWithShowAllButton")," "))}function Y_(i,a){1&i&&(e.TgZ(0,"p",9),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom")," "))}function j_(i,a){1&i&&(e.TgZ(0,"p",9),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLayersVisible")," "))}function H_(i,a){1&i&&(e.TgZ(0,"p",9),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.layer.legend.noLayersVisibleButZoom")," "))}var qi=function(){var i=function(){function a(){(0,h.Z)(this,a),this.orderable=!0,this.hasVisibleOrInRangeLayers$=new x.X(!0),this.hasVisibleAndNotInRangeLayers$=new x.X(!0),this.layersInUi$=new x.X([]),this.layers$=new x.X([]),this.showAllLegend=!1,this.change$=new vi.t(1),this.excludeBaseLayers=!1,this.updateLegendOnResolutionChange=!1,this.allowShowAllLegends=!1,this.showAllLegendsValue=!1,this.allLegendsShown=new e.vpe(!1)}return(0,v.Z)(a,[{key:"layers",get:function(){return this._layers},set:function(t){this._layers=t,this.next()}},{key:"ngOnInit",value:function(){var t=this;this.change$$=this.change$.pipe((0,xi.D)(function(){return 0===t.layers.length?_o.E:(0,Ti.H)(50)})).subscribe(function(){var o=t.computeShownLayers(t.layers.slice(0));t.layers$.next(o),t.hasVisibleOrInRangeLayers$.next(t.layers.slice(0).filter(function(r){return!0!==r.baseLayer}).filter(function(r){return r.visible$.value&&r.isInResolutionsRange$.value}).length>0),t.hasVisibleAndNotInRangeLayers$.next(t.layers.slice(0).filter(function(r){return!0!==r.baseLayer}).filter(function(r){return r.visible$.value&&!r.isInResolutionsRange$.value}).length>0),t.layersInUi$.next(t.layers.slice(0).filter(function(r){return!(!1===r.showInLayerList||t.excludeBaseLayers&&r.baseLayer)}))})}},{key:"ngOnDestroy",value:function(){this.change$$.unsubscribe()}},{key:"next",value:function(){this.change$.next()}},{key:"computeShownLayers",value:function(t){var o=t.filter(function(r){return r.visible&&r.isInResolutionsRange});return this.showAllLegendsValue&&(o=t),this.sortLayersByZindex(o)}},{key:"sortLayersByZindex",value:function(t){return t.sort(function(o,r){return r.zIndex-o.zIndex})}},{key:"toggleShowAllLegends",value:function(t){this.showAllLegendsValue=t,this.next(),this.allLegendsShown.emit(t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-layer-legend-list"]],inputs:{layers:"layers",excludeBaseLayers:"excludeBaseLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue"},outputs:{allLegendsShown:"allLegendsShown"},decls:24,vars:39,consts:[[1,"layer-legend-list-container"],["tooltip-position","above","matTooltipShowDelay","500","class","mat-typography",3,"matTooltip","checked","labelPosition","change",4,"ngIf"],[4,"ngIf"],[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["class","layers-empty mat-typography",4,"ngIf"],["tooltip-position","above","matTooltipShowDelay","500",1,"mat-typography",3,"matTooltip","checked","labelPosition","change"],["igoListItem","",3,"layer","updateLegendOnResolutionChange",4,"ngIf"],["igoListItem","",3,"layer","updateLegendOnResolutionChange"],[1,"layers-empty","mat-typography"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.YNc(1,U_,4,8,"mat-slide-toggle",1),e.ALo(2,"async"),e.YNc(3,N_,1,0,"mat-divider",2),e.ALo(4,"async"),e.TgZ(5,"igo-list",3),e.YNc(6,G_,1,1,"ng-template",4),e.ALo(7,"async"),e.qZA(),e.YNc(8,Q_,3,3,"p",5),e.ALo(9,"async"),e.ALo(10,"async"),e.ALo(11,"async"),e.YNc(12,Y_,3,3,"p",5),e.ALo(13,"async"),e.ALo(14,"async"),e.ALo(15,"async"),e.YNc(16,j_,3,3,"p",5),e.ALo(17,"async"),e.ALo(18,"async"),e.ALo(19,"async"),e.YNc(20,H_,3,3,"p",5),e.ALo(21,"async"),e.ALo(22,"async"),e.ALo(23,"async"),e.qZA()),2&n&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,9,t.layersInUi$).length&&t.allowShowAllLegends),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,11,t.layersInUi$).length&&t.allowShowAllLegends),e.xp6(2),e.Q6J("navigation",!1)("selection",!1),e.xp6(1),e.Q6J("ngForOf",e.lcZ(7,13,t.layers$)),e.xp6(2),e.Q6J("ngIf",!t.showAllLegendsValue&&e.lcZ(9,15,t.layersInUi$).length&&!1===e.lcZ(10,17,t.hasVisibleOrInRangeLayers$)&&!1===e.lcZ(11,19,t.hasVisibleAndNotInRangeLayers$)&&t.allowShowAllLegends),e.xp6(4),e.Q6J("ngIf",!t.showAllLegendsValue&&e.lcZ(13,21,t.layersInUi$).length&&!1===e.lcZ(14,23,t.hasVisibleOrInRangeLayers$)&&e.lcZ(15,25,t.hasVisibleAndNotInRangeLayers$)&&t.allowShowAllLegends),e.xp6(4),e.Q6J("ngIf",e.lcZ(17,27,t.layersInUi$).length&&!1===e.lcZ(18,29,t.hasVisibleOrInRangeLayers$)&&!1===e.lcZ(19,31,t.hasVisibleAndNotInRangeLayers$)&&!t.allowShowAllLegends),e.xp6(4),e.Q6J("ngIf",e.lcZ(21,33,t.layersInUi$).length&&!1===e.lcZ(22,35,t.hasVisibleOrInRangeLayers$)&&e.lcZ(23,37,t.hasVisibleAndNotInRangeLayers$)&&!t.allowShowAllLegends))},styles:["mat-slide-toggle[_ngcontent-%COMP%]{width:100%;margin:10px}mat-slide-toggle[_ngcontent-%COMP%]     .mat-slide-toggle-content{width:calc(100% - 60px)}igo-list[_ngcontent-%COMP%]{display:contents}.layers-empty[_ngcontent-%COMP%]{text-align:justify;margin:10px}.layer-legend-list-container[_ngcontent-%COMP%]{max-height:100%;overflow:auto}"],changeDetection:0}),i}();function V_(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.toggleTrackFeature())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",2),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.layer.trackFeature"))("color",t.color)}}var Gr=function(){var i=function(){function a(){(0,h.Z)(this,a),this.trackFeature=!1,this.color="primary"}return(0,v.Z)(a,[{key:"options",get:function(){if(this.layer)return this.layer.options}},{key:"ngOnInit",value:function(){this.color=this.trackFeature?"primary":"basic"}},{key:"toggleTrackFeature",value:function(){this.trackFeature?(this.layer.disableTrackFeature(this.layer.options.trackFeature),this.color="basic"):(this.layer.enableTrackFeature(this.layer.options.trackFeature),this.color="primary"),this.trackFeature=!this.trackFeature}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-track-feature-button"]],inputs:{layer:"layer",trackFeature:"trackFeature"},decls:1,vars:1,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","crosshairs-gps"]],template:function(n,t){1&n&&e.YNc(0,V_,3,4,"button",0),2&n&&e.Q6J("ngIf",t.options.trackFeature)},dependencies:[C.O5,O.Hw,I.lW,J.gM,E.X$],changeDetection:0}),i}(),Vc=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.networkService=n,this.inResolutionRange$=new x.X(!0),this.updateLegendOnResolutionChange=!1}return(0,v.Z)(a,[{key:"ngOnInit",value:function(){var t=this;this.resolution$$=this.layer.map.viewController.resolution$.subscribe(function(){t.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.network$$=this.networkService.currentState().subscribe(function(r){t.state=r,t.onResolutionChange()})}},{key:"ngOnDestroy",value:function(){this.resolution$$.unsubscribe(),this.network$$.unsubscribe()}},{key:"computeTooltip",value:function(){var t=this.layer.options;if(!t.tooltip)return this.layer.title;var o=t.tooltip,r=t.metadata;switch(t.tooltip.type){case sn.TITLE:return this.layer.title;case sn.ABSTRACT:return r&&r.abstract?r.abstract:this.layer.title;case sn.CUSTOM:return o&&o.text?o.text:this.layer.title;default:return this.layer.title}}},{key:"onResolutionChange",value:function(){this.inResolutionRange$.next(this.layer.isInResolutionsRange)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(hi))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-layer-legend-item"]],inputs:{layer:"layer",updateLegendOnResolutionChange:"updateLegendOnResolutionChange"},decls:6,vars:4,consts:[[1,"igo-layer-list-item"],["matLine","","matTooltipShowDelay","500",1,"igo-layer-title",3,"matTooltip"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer","updateLegendOnResolutionChange"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-list-item",0)(1,"h4",1),e._uU(2),e.qZA()(),e.TgZ(3,"div",2,3),e._UZ(5,"igo-layer-legend",4),e.qZA()),2&n&&(e.xp6(1),e.Q6J("matTooltip",t.tooltipText),e.xp6(1),e.Oqu(t.layer.title),e.xp6(3),e.Q6J("layer",t.layer)("updateLegendOnResolutionChange",t.updateLegendOnResolutionChange))},styles:["[_nghost-%COMP%]{overflow:hidden}.igo-layer-list-item[_ngcontent-%COMP%]{height:46px;clear:both}.igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px)}"],changeDetection:0}),i}(),Gi=function(){return(i=Gi||(Gi={})).Point="Point",i.LineString="LineString",i.Polygon="Polygon",i.Circle="Circle",Gi;var i}(),kn=function(){return(i=kn||(kn={})).Arial="Arial",i.ArialBlack="Arial Black",i.Verdana="Verdana",i.Tahoma="Tahoma",i.TrebuchetMS="Trebuchet MS",i.Impact="Impact",i.TimesNewRoman="Times New Roman",i.Georgia="Georgia",i.AmericanTypewriter="American Typewriter",i.Courier="Courier",i.LucidaConsole="Lucida Console",i.BrushScriptMT="Brush Script MT",i.ComicSansMS="Comic Sans MS",kn;var i}(),z_=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.config=n,this.getIconsList()}return(0,v.Z)(a,[{key:"getIcons",value:function(){return this.icons}},{key:"getPath",value:function(){return this.config.getConfig("drawingTool.icons")||[]}},{key:"getIconsList",value:function(){this.icons=this.getPath()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(j))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),zt=function(){return(i=zt||(zt={})).Length="length",i.Area="area",zt;var i}(),ye=function(){return(i=ye||(ye={})).Meters="meters",i.Kilometers="kilometers",i.Miles="miles",i.Feet="feet",ye;var i}(),xs=((0,de.Z)(Ho={},ye.Meters,"m"),(0,de.Z)(Ho,ye.Kilometers,"km"),(0,de.Z)(Ho,ye.Miles,"mi"),(0,de.Z)(Ho,ye.Feet,"ft"),Ho),ut=function(){return(i=ut||(ut={})).SquareMeters="squareMeters",i.SquareKilometers="squareKilometers",i.SquareMiles="squareMiles",i.SquareFeet="squareFeet",i.Hectares="hectares",i.Acres="acres",ut;var i}(),zc=((0,de.Z)(Xn={},ut.SquareMeters,"m\xb2"),(0,de.Z)(Xn,ut.SquareKilometers,"km\xb2"),(0,de.Z)(Xn,ut.SquareMiles,"mi\xb2"),(0,de.Z)(Xn,ut.SquareFeet,"ft\xb2"),(0,de.Z)(Xn,ut.Hectares,"ha"),(0,de.Z)(Xn,ut.Acres,"ac"),Xn);function W_(i){return.001*i}function K_(i){return 3.2808*i}function X_(i){return 621e-6*i}function e0(i){return 1e-6*i}function t0(i){return 3.861e-7*i}function n0(i){return 10.764*i}function o0(i){return 1e-4*i}function r0(i){return 24711e-8*i}function Qi(i,a){var t=new Map([[ye.Meters,function(o){return o}],[ye.Kilometers,W_],[ye.Miles,X_],[ye.Feet,K_]]).get(a);return t?t(i):void 0}function Qr(i,a){var t=new Map([[ut.SquareMeters,function(o){return o}],[ut.SquareKilometers,e0],[ut.SquareMiles,t0],[ut.SquareFeet,n0],[ut.Hectares,o0],[ut.Acres,r0]]).get(a);return t?t(i):void 0}function Yi(i,a,n){var t=a.decimal;(void 0===t||t<0)&&(t=1);var o=[];return o.push(void 0!==a.locale?i.toLocaleString(a.locale,{minimumFractionDigits:t,maximumFractionDigits:t}):i.toFixed(t).toString()),void 0!==a.unit&&!0===a.unitAbbr&&o.push(n?n.translate.instant(xs[a.unit]?"igo.geo.measure."+xs[a.unit]:"igo.geo.measure."+zc[a.unit]):xs[a.unit]||zc[a.unit]),o.filter(function(r){return void 0!==r}).join(" ")}function ks(){return new ee.ZP({stroke:new K.Z({color:"#ffcc33",lineDash:[10,10],width:2}),fill:new te.Z({color:"rgba(255, 255, 255, 0.2)"}),image:new Ue.Z({radius:5,stroke:new K.Z({color:"#ffcc33"}),fill:new te.Z({color:"rgba(255, 255, 255, 0.2)"})})})}function Ms(i,a){if(!(i instanceof He.Z)&&0!==i.getFlatCoordinates().length)return(0,rs.xA)(i,{projection:a})}function Fs(i,a){for(var n=Ms(i,a),t=function c0(i,a){if(!(i instanceof He.Z||i instanceof dn.Z)&&0!==i.getFlatCoordinates().length)return(0,rs.bg)(i,{projection:a})}(i,a),o=[],r=i.getFlatCoordinates(),s=r.length,l=0;l<=s-4;l+=2){var c=new dn.Z([[r[l],r[l+1]],[r[l+2],r[l+3]]]);o.push(Ms(c,a))}return{area:t,length:n,lengths:o}}function Zs(i){var a;if(i instanceof He.Z){var n=new He.Z(i.getFlatCoordinates());(a=new Array(1))[0]=n}else{a=Wc(i);for(var t=i.getFlatCoordinates(),o=a.length,r=0;r<o;r++){var s=2*r,c=new dn.Z([[t[s],t[s+1]],[t[s+2],t[s+3]]]).getCoordinateAt(.5),u=a[r];void 0!==u?u.setCoordinates(c):a[r]=new He.Z(c)}}return a}function Wc(i){var a;a=i instanceof Zi.Z?0:Math.max(i.getFlatCoordinates().length/2-1,0);var t,n=i.get("_midpoints");if(void 0===n)return n=new Array(i instanceof He.Z?1:a),i.set("_midpoints",n,!0),n;if(0===a||a===n.length)return n;if(a>n.length)return(t=n).push.apply(t,(0,Fe.Z)(new Array(a-n.length))),n;for(var o=a;o<n.length;o++){var r=n[a];void 0!==r&&Kc(r)}return n.splice(a),n}function Kc(i){var a=i.get("_tooltip");if(void 0!==a){var n=a.getMap();void 0!==n&&n.removeOverlay(a)}}function As(i){var a=[].concat(function p0(i){return Wc(i).map(function(n){return n?n.get("_tooltip"):void 0})}(i)||[]),n=function g0(i){var a=i.get("_center");return a?a.get("_tooltip"):void 0}(i);return void 0!==n&&a.push(n),a}function eu(i){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",t=new pc.Z({element:document.createElement("div"),offset:[-30,-10],className:(a?["igo-map-tooltip","igo-map-tooltip-measure","igo-map-tooltip-measure-area"]:["igo-map-tooltip","igo-map-tooltip-measure","igo-map-tooltip-measure-".concat(n,"segments")]).join(" "),stopEvent:!1});return t.setPosition(i.getFlatCoordinates()),i.set("_tooltip",t),t}function tu(i,a,n,t){return new ee.ZP({stroke:new K.Z({color:a||"rgba(143,7,7,1)",width:n||1}),fill:new te.Z({color:i||"rgba(255,255,255,0.4)"}),image:new Ue.Z({radius:5,stroke:new K.Z({color:a||"rgba(143,7,7,1)",width:n||1}),fill:new te.Z({color:i||"rgba(255,255,255,0.4)"})})})}var ou=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.mapService=n,this.fillColor="rgba(255,255,255,0.4)",this.strokeColor="rgba(143,7,7,1)",this.strokeWidth=1,this.labelsAreShown=!0,this.fontSize="20",this.fontStyle=kn.Arial.toString(),this.offsetX=0,this.offsetY=0}return(0,v.Z)(a,[{key:"getFillColor",value:function(){return this.fillColor}},{key:"setFillColor",value:function(t){this.fillColor=t}},{key:"getStrokeColor",value:function(){return this.strokeColor}},{key:"setStrokeColor",value:function(t){this.strokeColor=t}},{key:"getStrokeWidth",value:function(){return this.strokeWidth}},{key:"getLabelsAreShown",value:function(){return this.labelsAreShown}},{key:"toggleLabelsAreShown",value:function(){this.labelsAreShown=!this.labelsAreShown}},{key:"setIcon",value:function(t){this.icon=t}},{key:"getIcon",value:function(){return this.icon}},{key:"getFontSize",value:function(){return this.fontSize}},{key:"setFontSize",value:function(t){this.fontSize=t}},{key:"getFontStyle",value:function(){return this.fontStyle}},{key:"setFontStyle",value:function(t){this.fontStyle=t}},{key:"getOffsetX",value:function(){return this.offsetX}},{key:"setOffsetX",value:function(t){this.offsetX=t}},{key:"getOffsetY",value:function(){return this.offsetY}},{key:"setOffsetY",value:function(t){this.offsetY=t}},{key:"createIndividualElementStyle",value:function(t,o,r,s,l,c,u,p,d){var f=!1,m=this.mapService.getMap().projection;if(t.getGeometry()instanceof He.Z&&(f=!f),t.get("rad")){var _=(0,re.vs)(t.getGeometry().flatCoordinates,m,"EPSG:4326");return new ee.ZP({text:new Lt.Z({text:r?t.get("draw"):"",stroke:new K.Z({color:"white",width:.75}),fill:new te.Z({color:"black"}),font:s,overflow:!0,offsetX:u,offsetY:p}),image:new Ue.Z({radius:t.get("rad")/Math.cos(Math.PI/180*_[1])/o,stroke:new K.Z({color:c||this.strokeColor,width:this.strokeWidth}),fill:new te.Z({color:l})})})}return d?(this.offsetY=-26,new ee.ZP({text:new Lt.Z({text:r?t.get("draw"):"",stroke:new K.Z({color:"white",width:.75}),fill:new te.Z({color:"black"}),font:s,overflow:!0,offsetX:u,offsetY:p}),stroke:new K.Z({color:c,width:this.strokeWidth}),fill:new te.Z({color:l}),image:new bo.Z({src:d})})):(this.offsetY=f?-15:0,new ee.ZP({text:new Lt.Z({text:r?t.get("draw"):"",stroke:new K.Z({color:"white",width:.75}),fill:new te.Z({color:"black"}),font:s,overflow:!0,offsetX:u,offsetY:p}),stroke:new K.Z({color:c,width:this.strokeWidth}),fill:new te.Z({color:l}),image:new Ue.Z({radius:5,stroke:new K.Z({color:c,width:this.strokeWidth}),fill:new te.Z({color:l})})}))}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(Vt))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function f0(i,a){if(1&i&&(e.TgZ(0,"td"),e._UZ(1,"mat-icon",7),e.qZA()),2&i){var n=e.oxw(3);e.xp6(1),e.s9C("svgIcon",n.icon)}}function m0(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"td")(1,"a",8),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"button",9),e.NdJ("click",function(){e.CHM(n);var s=e.oxw().$implicit,l=e.oxw(2);return e.KtG(l.copyTextToClipboard(s.value))}),e._UZ(5,"mat-icon",10),e.qZA()()}if(2&i){var t=e.oxw().$implicit,o=e.oxw(2);e.xp6(1),e.s9C("href",t.value,e.LSH),e.xp6(1),e.AsE(" ",e.lcZ(3,3,"igo.geo.targetHtmlUrl")," ",o.title,"")}}function h0(i,a){if(1&i&&(e.TgZ(0,"td",11),e._uU(1),e.qZA()),2&i){var n=e.oxw().$implicit;e.xp6(1),e.hij(" ",n.key," ")}}function v0(i,a){if(1&i&&e._UZ(0,"td",12),2&i){var n=e.oxw().$implicit;e.Q6J("innerHTML",n.value,e.oJD)}}var iu=function(){return{cursor:"pointer",color:"blue"}};function y0(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"td")(1,"u",13),e.NdJ("click",function(){e.CHM(n);var s=e.oxw().$implicit,l=e.oxw(2);return e.KtG(l.openSecureUrl(s.value))}),e._uU(2),e.qZA()()}if(2&i){var t=e.oxw().$implicit,o=e.oxw(2);e.xp6(1),e.Q6J("ngStyle",e.DdM(2,iu)),e.xp6(1),e.Oqu(o.getEmbeddedLinkText(t.value))}}function _0(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"td")(1,"u",13),e.NdJ("click",function(){e.CHM(n);var o=e.oxw().$implicit,r=e.oxw(2);return e.KtG(r.openSecureUrl(o.value))}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"button",9),e.NdJ("click",function(){e.CHM(n);var o=e.oxw().$implicit,r=e.oxw(2);return e.KtG(r.copyTextToClipboard(o.value))}),e._UZ(5,"mat-icon",10),e.qZA()()}2&i&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(4,iu)),e.xp6(1),e.Oqu(e.lcZ(3,2,"igo.geo.targetHtmlUrl")))}function b0(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"td")(1,"a",14),e.NdJ("click",function(){e.CHM(n);var r=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.openSecureUrl(r.value))}),e._UZ(2,"img",15),e.ALo(3,"async"),e.ALo(4,"secureImage"),e.qZA()()}if(2&i){var t=e.oxw().$implicit;e.xp6(1),e.s9C("href",t.value,e.LSH),e.xp6(1),e.s9C("src",e.lcZ(3,2,e.lcZ(4,4,t.value)),e.LSH)}}function C0(i,a){if(1&i&&(e._UZ(0,"td",12),e.ALo(1,"json")),2&i){var n=e.oxw().$implicit;e.Q6J("innerHTML",e.lcZ(1,1,n.value),e.oJD)}}function S0(i,a){if(1&i&&(e.TgZ(0,"tr"),e.YNc(1,f0,2,1,"td",4),e.YNc(2,m0,6,5,"td",4),e.YNc(3,h0,2,1,"td",5),e.YNc(4,v0,1,1,"td",6),e.YNc(5,y0,3,3,"td",4),e.YNc(6,_0,6,5,"td",4),e.YNc(7,b0,5,6,"td",4),e.YNc(8,C0,2,3,"td",6),e.qZA()),2&i){var n=a.$implicit,t=e.oxw(2);e.xp6(1),e.Q6J("ngIf","_blank"===t.feature.properties.target&&"url"===n.key),e.xp6(1),e.Q6J("ngIf","_blank"===t.feature.properties.target&&"url"===n.key),e.xp6(1),e.Q6J("ngIf",void 0===t.feature.properties.target),e.xp6(1),e.Q6J("ngIf",void 0===t.feature.properties.target&&!t.isObject(n.value)&&!t.isUrl(n.value)&&!t.isEmbeddedLink(n.value)),e.xp6(1),e.Q6J("ngIf",void 0===t.feature.properties.target&&t.isEmbeddedLink(n.value)),e.xp6(1),e.Q6J("ngIf",void 0===t.feature.properties.target&&!t.isObject(n.value)&&(t.isDoc(n.value)||t.isUrl(n.value))&&!t.isImg(n.value)),e.xp6(1),e.Q6J("ngIf",void 0===t.feature.properties.target&&!t.isObject(n.value)&&t.isUrl(n.value)&&t.isImg(n.value)),e.xp6(1),e.Q6J("ngIf",void 0===t.feature.properties.target&&t.isObject(n.value))}}function w0(i,a){if(1&i&&(e.TgZ(0,"table",2)(1,"tbody"),e.YNc(2,S0,9,8,"tr",3),e.ALo(3,"keyvalue"),e.qZA()()),2&i){var n=e.oxw();e.xp6(2),e.Q6J("ngForOf",e.lcZ(3,1,n.filterFeatureProperties(n.feature)))}}function T0(i,a){if(1&i&&e._UZ(0,"iframe",16),2&i){var n=e.oxw();e.Q6J("srcdoc",n.htmlSanitizer(n.feature.properties),e.oJD)("src",n.urlSanitizer(n.feature.properties.url),e.uOi)}}var Mo=function(){var i=function(){function a(n,t,o,r,s,l){var c=this;(0,h.Z)(this,a),this.http=n,this.cdRef=t,this.sanitizer=o,this.networkService=r,this.messageService=s,this.configService=l,this.unsubscribe$=new $e.x,this.ready=!1,this.routeEvent=new e.vpe,this.selectFeature=new e.vpe,this.htmlDisplayEvent=new e.vpe,this.networkService.currentState().pipe((0,En.R)(this.unsubscribe$)).subscribe(function(u){c.state=u})}return(0,v.Z)(a,[{key:"source",get:function(){return this._source},set:function(t){this._source=t,this.cdRef.detectChanges()}},{key:"feature",get:function(){return this._feature},set:function(t){this._feature=t,this.cdRef.detectChanges(),this.selectFeature.emit()}},{key:"title",get:function(){return en(this.feature)}},{key:"icon",get:function(){return ur(this.feature)||"link"}},{key:"ngOnInit",value:function(){this.ready=!0}},{key:"ngOnDestroy",value:function(){this.unsubscribe$.next(),this.unsubscribe$.complete()}},{key:"urlSanitizer",value:function(t){return this.sanitizer.bypassSecurityTrustResourceUrl(t)}},{key:"isHtmlDisplay",value:function(){return this.feature&&this.isObject(this.feature.properties)&&"iframe"===this.feature.properties.target?(this.htmlDisplayEvent.emit(!0),!0):(this.htmlDisplayEvent.emit(!1),!1)}},{key:"htmlSanitizer",value:function(t){if(t.body&&"Internet Explorer"!==qn.getBrowserName()){if(!/<base href="[\w:\/\.]+">/.test(t.body)){var r=new URL(t.url,window.location.origin);t.body=t.body.replace("<head>",'<head><base href="'.concat(r.origin,'">'))}return this.sanitizer.bypassSecurityTrustHtml(t.body)}}},{key:"isObject",value:function(t){return"object"==typeof t}},{key:"openSecureUrl",value:function(t){var r,s,o=this,l=new RegExp((null===(r=this.configService)||void 0===r?void 0:r.getConfig("depot.url"))+'.*?(?="|$)');if(l.test(t))s=t.match(l)[0],this.http.get(s,{responseType:"blob"}).subscribe(function(p){var d=URL.createObjectURL(p);window.open(d,"_blank"),o.cdRef.detectChanges()},function(p){o.messageService.error("igo.geo.targetHtmlUrlUnauthorized","igo.geo.targetHtmlUrlUnauthorizedTitle")});else{var c=t;if(this.isEmbeddedLink(t)){var u=document.createElement("div");u.innerHTML=t,c=u.children[0].getAttribute("href")}window.open(c,"_blank")}}},{key:"isUrl",value:function(t){if("string"==typeof t)return/^https?:\/\//.test(t)}},{key:"isDoc",value:function(t){if("string"==typeof t)return!!this.isUrl(t)&&/(pdf|docx?|xlsx?)$/.test(t.toLowerCase())}},{key:"isImg",value:function(t){if("string"==typeof t)return!!this.isUrl(t)&&/(jpe?g|png|gif)$/.test(t.toLowerCase())}},{key:"isEmbeddedLink",value:function(t){return"string"==typeof t&&1===(t.match(/<a/g)||[]).length}},{key:"getEmbeddedLinkText",value:function(t){var r=t.match(/(?:>).*?(?=<|$)/)[0];return r.replace(/>/g,"")}},{key:"filterFeatureProperties",value:function(t){var s,o=t.meta?t.meta.alias:void 0,r={};return this.map&&this.map.offlineButtonToggle$.pipe((0,En.R)(this.unsubscribe$)).subscribe(function(g){s=g}),t.properties&&t.properties.Route&&this.toolbox&&!this.toolbox.getTool("directions")&&delete t.properties.Route,o?(Object.keys(o).forEach(function(g){r[o[g]]=t.properties[g]}),r):(void 0!==s&&s?t.meta&&t.meta.excludeAttributeOffline&&t.meta.excludeAttributeOffline.forEach(function(g){delete t.properties[g]}):this.state.connection&&t.meta&&t.meta.excludeAttribute?t.meta.excludeAttribute.forEach(function(g){delete t.properties[g]}):!this.state.connection&&t.meta&&t.meta.excludeAttributeOffline&&t.meta.excludeAttributeOffline.forEach(function(g){delete t.properties[g]}),t.properties)}},{key:"copyTextToClipboard",value:function(t){Gn.copy(t)&&this.messageService.success("igo.geo.query.link.message")}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(W.eN),e.Y36(e.sBO),e.Y36(Tt.H7),e.Y36(hi),e.Y36(Ae),e.Y36(j))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-feature-details"]],inputs:{source:"source",map:"map",toolbox:"toolbox",feature:"feature"},outputs:{routeEvent:"routeEvent",selectFeature:"selectFeature",htmlDisplayEvent:"htmlDisplayEvent"},decls:2,vars:2,consts:[["class","igo-striped mat-typography",4,"ngIf"],[3,"srcdoc","src",4,"ngIf"],[1,"igo-striped","mat-typography"],[4,"ngFor","ngForOf"],[4,"ngIf"],["id","keyValue",4,"ngIf"],[3,"innerHTML",4,"ngIf"],["mat-list-avatar","",3,"svgIcon"],["target","_blank","rel","noopener noreferrer",3,"href"],["mat-icon-button","",1,"copyClipboard",3,"click"],["svgIcon","content-copy"],["id","keyValue"],[3,"innerHTML"],[3,"ngStyle","click"],["target","_blank","rel","noopener noreferrer",3,"href","click"],["igoImageError","","width","225","height","auto",3,"src"],[3,"srcdoc","src"]],template:function(n,t){1&n&&(e.YNc(0,w0,4,3,"table",0),e.YNc(1,T0,1,2,"iframe",1)),2&n&&(e.Q6J("ngIf",t.ready&&t.feature&&t.isObject(t.feature.properties)&&"iframe"!==t.feature.properties.target),e.xp6(1),e.Q6J("ngIf",t.isHtmlDisplay()))},dependencies:[C.sg,C.O5,C.PC,O.Hw,xa,C.Ov,C.Ts,E.X$,vo,dr],styles:["table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px}#keyValue[_ngcontent-%COMP%]{width:30%}table[_ngcontent-%COMP%]     .routing{cursor:pointer}iframe[_ngcontent-%COMP%]{height:calc(100% - 4px);width:100%;border:0}.copyClipboard[_ngcontent-%COMP%]{border:none;background:transparent;cursor:pointer}"],changeDetection:0}),i}();function ru(i){return new Ue.Z({stroke:new K.Z({color:(i=i||[0,153,255]).concat([1]),width:2}),fill:new te.Z({color:i.concat([.2])}),radius:8})}function au(){return new ee.ZP({stroke:new K.Z({color:[0,153,255,1],width:2})})}function Is(i){var a=i.target;return a instanceof Tn.ZP?a.getFlatCoordinates().slice(-4,-2):a.getFlatCoordinates().slice(-2)}Error;var ji=function(){function i(a){(0,h.Z)(this,i),this.options=a,this.start$=new $e.x,this.end$=new $e.x,this.changes$=new $e.x,this.modify$=new $e.x,this.select$=new $e.x,this.abort$=new $e.x,this.freehand$=new x.X(!1),this.olDrawingLayer=a.drawingLayer?a.drawingLayer:this.createOlInnerOverlayLayer(),this.olGeometryType=this.options.geometryType}return(0,v.Z)(i,[{key:"active",get:function(){return void 0!==this.olMap}},{key:"olDrawingLayerSource",get:function(){return this.olDrawingLayer.getSource()}},{key:"setOlMap",value:function(n,t){if(!n)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlInteractions(),void(this.olMap=n);this.olMap=n,this.addOlInnerOverlayLayer(),this.addOlInteractions(t)}},{key:"getSource",value:function(){return this.olDrawingLayerSource}},{key:"setGeometryType",value:function(n){this.olGeometryType=n}},{key:"createOlInnerOverlayLayer",value:function(){return new zn.Z({source:this.options.drawingLayerSource?this.options.drawingLayerSource:new nn.Z,style:this.options.drawingLayerStyle,zIndex:500})}},{key:"removeOlInnerOverlayLayer",value:function(){!this.options.drawingLayer&&this.olMap&&this.olMap.removeLayer(this.olDrawingLayer)}},{key:"addOlInnerOverlayLayer",value:function(){this.options.drawingLayer||this.olMap.addLayer(this.olDrawingLayer)}},{key:"clearOlInnerOverlaySource",value:function(){!this.options.drawingLayer&&!this.options.drawingLayerSource&&this.olDrawingLayerSource.clear(!0)}},{key:"addOlInteractions",value:function(n){var o,t=this;if(o=this.freehand$.getValue()?new Ir.ZP("Point"===this.olGeometryType?{type:"Circle",source:this.getSource(),maxPoints:this.options.maxPoints,freehand:!0}:{type:this.olGeometryType,source:this.getSource(),maxPoints:this.options.maxPoints,freehand:!0}):new Ir.ZP({type:this.olGeometryType,source:this.getSource(),stopClick:!0,style:this.options.interactionStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:function(){return!1}}),this.olMap.addInteraction(o),this.olDrawInteraction=o,this.onDrawStartKey=o.on("drawstart",function(l){return t.onDrawStart(l)}),this.onDrawEndKey=o.on("drawend",function(l){return t.onDrawEnd(l)}),this.onDrawAbortKey=o.on("drawabort",function(l){return t.abort$.next(l.feature.getGeometry())}),n){var r=new as.Z({source:this.getSource()});if(this.olMap.addInteraction(r),this.olModifyInteraction=r,!this.olSelectInteraction){var s=new Xa.Z({condition:dc.OK,style:void 0});this.olMap.addInteraction(s),this.olSelectInteraction=s,this.olSelectInteraction.on("select",function(l){return t.onSelect(l)})}}}},{key:"removeOlInteractions",value:function(){this.unsubscribeKeyDown(),(0,st.B)([this.onDrawStartKey,this.onDrawEndKey,this.onDrawKey,this.onDrawAbortKey]),this.olMap&&(this.olMap.removeInteraction(this.olDrawInteraction),this.olMap.removeInteraction(this.olModifyInteraction)),this.olDrawInteraction=void 0,this.olModifyInteraction=void 0}},{key:"onDrawStart",value:function(n){var t=this,o=n.feature.getGeometry();this.start$.next(o),this.clearOlInnerOverlaySource(),this.onDrawKey=o.on("change",function(r){t.mousePosition=Is(r),t.changes$.next(r.target)}),this.subscribeKeyDown()}},{key:"onDrawEnd",value:function(n){var t=this;this.unsubscribeKeyDown(),(0,st.B)(this.onDrawKey);var o=n.feature.getGeometry();o.on("change",function(){t.modify$.next(o)}),this.end$.next(o)}},{key:"onSelect",value:function(n){1===n.selected.length&&this.select$.next(n.selected[0])}},{key:"subscribeKeyDown",value:function(){var n=this;this.unsubscribeKeyDown(),this.keyDown$$=(0,In.R)(document,"keydown").subscribe(function(t){"Escape"!==t.key?("Backspace"===t.key&&n.olDrawInteraction.removeLastPoint(),"Enter"===t.key&&n.olDrawInteraction.finishDrawing()," "!==t.key||n.olMap.getView().animate({center:n.mousePosition,duration:100})):n.olDrawInteraction.abortDrawing()})}},{key:"unsubscribeKeyDown",value:function(){this.keyDown$$&&(this.keyDown$$.unsubscribe(),this.keyDown$$=void 0)}}]),i}(),D0=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.dialogRef=n,this.data=t,this.confirmFlag=!1}return(0,v.Z)(a,[{key:"cancelDrawing",value:function(){this.dialogRef.close()}},{key:"confirm",value:function(t){this.confirmFlag=!0,this.dialogRef.close(t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(z.so),e.Y36(z.WI))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-draw-popup-component"]],inputs:{confirmFlag:"confirmFlag"},decls:14,vars:10,consts:[["mat-dialog-content",""],[1,"mat-typography"],[1,"example-full-width"],["matInput","",3,"placeholder","value"],["input",""],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(n,t){if(1&n){var o=e.EpF();e.TgZ(0,"div",0)(1,"p",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-form-field",2),e._UZ(5,"input",3,4),e.ALo(7,"translate"),e.qZA()(),e.TgZ(8,"div",5)(9,"button",6),e.NdJ("click",function(){return t.cancelDrawing()}),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"button",7),e.NdJ("click",function(){e.CHM(o);var s=e.MAs(6);return e.KtG(t.confirm(s.value))}),e._uU(13,"OK "),e.qZA()()}2&n&&(e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.geo.draw.dialogInstruction")),e.xp6(3),e.s9C("placeholder",e.lcZ(7,6,"igo.geo.draw.dialogTitle")),e.s9C("value",t.data.currentLabel),e.xp6(5),e.hij("",e.lcZ(11,8,"igo.geo.draw.cancel")," "))},dependencies:[I.lW,B.KE,le.Nt,z.xY,z.H8,E.X$]}),i}(),P0=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-draw-shorcuts"]],decls:24,vars:12,consts:[[1,"shortcut","mat-typography"],["svgIcon","keyboard-return",1,"shortcut-icon"],["svgIcon","backspace-outline",1,"shortcut-icon"],["svgIcon","keyboard-esc",1,"shortcut-icon"],["svgIcon","keyboard-space",1,"shortcut-icon"],[1,"shortcuts-close"],["mat-raised-button","","mat-dialog-close","","color","primary"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-dialog-content")(1,"div")(2,"span",0),e._UZ(3,"mat-icon",1),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"div")(7,"span",0),e._UZ(8,"mat-icon",2),e._uU(9),e.ALo(10,"translate"),e.qZA()(),e.TgZ(11,"div")(12,"span",0),e._UZ(13,"mat-icon",3),e._uU(14),e.ALo(15,"translate"),e.qZA()(),e.TgZ(16,"div")(17,"span",0),e._UZ(18,"mat-icon",4),e._uU(19),e.ALo(20,"translate"),e.qZA()()(),e.TgZ(21,"mat-dialog-actions",5)(22,"button",6),e._uU(23,"OK"),e.qZA()()),2&n&&(e.xp6(4),e.Oqu(e.lcZ(5,4,"igo.geo.draw.finish")),e.xp6(5),e.Oqu(e.lcZ(10,6,"igo.geo.draw.undo")),e.xp6(5),e.Oqu(e.lcZ(15,8,"igo.geo.draw.abort")),e.xp6(5),e.Oqu(e.lcZ(20,10,"igo.geo.draw.move")))},dependencies:[I.lW,O.Hw,z.ZT,z.xY,z.H8,E.X$],styles:[".shortcut[_ngcontent-%COMP%]{display:flex;align-items:center}.shortcut-icon[_ngcontent-%COMP%]{margin-right:10px}.shortcuts-close[_ngcontent-%COMP%]{display:flex;justify-content:center}"]}),i}(),E0=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.dialogRef=n,this.confirmFlag=!1}return(0,v.Z)(a,[{key:"cancelDrawing",value:function(){this.dialogRef.close()}},{key:"confirm",value:function(t){this.confirmFlag=!0,this.dialogRef.close(t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(z.so))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-draw-popup-component"]],inputs:{confirmFlag:"confirmFlag"},decls:14,vars:9,consts:[["mat-dialog-content",""],[1,"mat-typography"],[1,"example-full-width"],["matInput","",3,"placeholder"],["input",""],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(n,t){if(1&n){var o=e.EpF();e.TgZ(0,"div",0)(1,"p",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-form-field",2),e._UZ(5,"input",3,4),e.ALo(7,"translate"),e.qZA()(),e.TgZ(8,"div",5)(9,"button",6),e.NdJ("click",function(){return t.cancelDrawing()}),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"button",7),e.NdJ("click",function(){e.CHM(o);var s=e.MAs(6);return e.KtG(t.confirm(s.value))}),e._uU(13," OK "),e.qZA()()}2&n&&(e.xp6(2),e.hij(" ",e.lcZ(3,3,"igo.geo.draw.layer.layerDialogInstruction")," "),e.xp6(3),e.s9C("placeholder",e.lcZ(7,5,"igo.geo.draw.layer.title")),e.xp6(5),e.hij(" ",e.lcZ(11,7,"igo.geo.draw.cancel")," "))},dependencies:[I.lW,B.KE,le.Nt,z.xY,z.H8,E.X$]}),i}(),$0=["selectedLayer"];function R0(i,a){if(1&i&&(e.TgZ(0,"mat-option",2),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.hij(" ",n.title," ")}}function J0(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.activeDrawingLayer.visible=!r.activeDrawingLayer.visible)}),e.ALo(1,"translate"),e.ALo(2,"translate"),e._UZ(3,"mat-icon",21),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("color",t.activeDrawingLayer.visible?"primary":"default")("matTooltip",t.activeDrawingLayer.visible?e.lcZ(1,3,"igo.geo.layer.hideLayer"):e.lcZ(2,5,"igo.geo.layer.showLayer")),e.xp6(3),e.Q6J("svgIcon",t.activeDrawingLayer.visible?"eye":"eye-off")}}function B0(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.deleteDrawings())}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",23),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.draw.delete"))("disabled",0===e.lcZ(2,4,t.selectedFeatures$).length)}}function U0(i,a){if(1&i&&(e.TgZ(0,"div",27),e._UZ(1,"img",28),e.qZA()),2&i){var n=e.oxw(2);e.xp6(1),e.s9C("src",n.icon,e.LSH)}}function N0(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-option",29),e.NdJ("click",function(){var s=e.CHM(n).$implicit,l=e.oxw(2);return e.KtG(l.onIconChange(s))}),e.TgZ(1,"div",27),e._UZ(2,"img",28),e.qZA()()}if(2&i){var t=a.$implicit;e.Q6J("value",t),e.xp6(2),e.s9C("src",t,e.LSH)}}function q0(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select")(5,"mat-select-trigger"),e.YNc(6,U0,2,1,"div",24),e.qZA(),e.TgZ(7,"mat-option",25),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.onIconChange())}),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.YNc(10,N0,3,2,"mat-option",26),e.qZA()()}if(2&i){var t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.geo.draw.icon")),e.xp6(4),e.Q6J("ngIf",t.icon),e.xp6(2),e.Oqu(e.lcZ(9,6,"igo.geo.draw.noIcon")),e.xp6(2),e.Q6J("ngForOf",t.icons)}}function G0(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.openStyleModalDialog())}),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"translate"),e._UZ(4,"mat-icon",31),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,3,"igo.geo.layer.style.styleModalTooltip")),e.xp6(2),e.hij(" ",e.lcZ(3,5,"igo.geo.layer.style.styleModal")," "),e.xp6(2),e.Q6J("matBadge",t.selectedFeatures$.value.length)}}var su=function(){var i=function(){function a(n,t,o,r,s){(0,h.Z)(this,a),this.languageService=n,this.formBuilder=t,this.drawStyleService=o,this.dialog=r,this.drawIconService=s,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,fixedHeader:!0,tableHeight:"auto",columns:[{name:"Drawing",title:this.languageService.translate.instant("igo.geo.draw.labels"),tooltip:this.languageService.translate.instant("igo.geo.draw.changeLabel"),valueAccessor:function(c){return c.properties.draw}}]},this.geometryType=Gi,this._stores=[],this._drawControls=[],this.activeLayerChange=new e.vpe,this.drawControlsEvent=new e.vpe,this.layersIDEvent=new e.vpe,this.layerCounterID=0,this.draw$=new x.X({}),this.activeDrawingLayerSource=new nn.Z,this.selectedFeatures$=new x.X([]),this.drawControlIsDisabled=!0,this.drawControlIsActive=!1,this.subscriptions$$=[],this.position="bottom",this.isCreatingNewLayer=!1,this.currGeometryType=this.geometryType.Point,this.buildForm(),this.fillColor=this.drawStyleService.getFillColor(),this.strokeColor=this.drawStyleService.getStrokeColor(),this.strokeWidth=this.drawStyleService.getStrokeWidth(),this.labelsAreShown=this.drawStyleService.getLabelsAreShown(),this.icons=this.drawIconService.getIcons(),this.icon=this.drawStyleService.getIcon(),this.fontSize=this.drawStyleService.getFontSize(),this.fontStyle=this.drawStyleService.getFontStyle()}return(0,v.Z)(a,[{key:"stores",get:function(){return this._stores},set:function(t){this._stores=t}},{key:"drawControls",get:function(){return this._drawControls},set:function(t){this._drawControls=t}},{key:"activeDrawingLayer",get:function(){return this._activeDrawingLayer},set:function(t){this._activeDrawingLayer=t}},{key:"ngOnInit",value:function(){var t=this;this.stores.length?(this.activeStore=this.stores.find(function(o){return o.layer.id===t.activeDrawingLayer.id}),this.activeDrawControl=this.drawControls.find(function(o){return o[0]===t.activeDrawingLayer.id})[1],this.deactivateDrawControl(),this.allLayers.forEach(function(o){o.id!==t.activeDrawingLayer.id&&(o.opacity=0);var r=t.stores.find(function(s){return s.layer.id===o.id});t.subscriptions$$.push(r.stateView.manyBy$(function(s){return!0===s.state.selected}).pipe((0,An.P)()).subscribe(function(s){s.forEach(function(l){l.state.selected=!1})})),t.subscriptions$$.push(r.stateView.manyBy$(function(s){return!0===s.state.selected}).pipe((0,uo.T)(1)).subscribe(function(s){t.selectedFeatures$.next(s.map(function(l){return l.entity}))})),t.subscriptions$$.push(r.count$.subscribe(function(s){t.activeStore.layer.options.showInLayerList=s>=1}))}),this.onLayerChange(this.activeDrawingLayer)):(this.activeStore=new Dt([],{map:this.map}),this.initStore(),this.activeDrawControl=this.createDrawControl(this.fillColor,this.strokeColor,this.strokeWidth),this.activeDrawControl.setGeometryType(this.geometryType.Point),this.toggleDrawControl(),this.stores.push(this.activeStore),this.drawControls.push([this.activeDrawingLayer.id,this.activeDrawControl]),this.drawControlsEvent.emit(this.drawControls),this.layersIDEvent.emit(this.activeDrawingLayer.id),this.onLayerChange(this.activeDrawingLayer))}},{key:"ngOnDestroy",value:function(){this.allLayers.forEach(function(t){return t.opacity=1}),this.activeStore.state.updateAll({selected:!1}),this.deactivateDrawControl(),this.subscriptions$$.map(function(t){return t.unsubscribe()})}},{key:"createDrawControl",value:function(t,o,r){return new ji({geometryType:void 0,drawingLayerSource:this.activeDrawingLayerSource,drawingLayerStyle:new ee.ZP({}),interactionStyle:tu(t,o,r)})}},{key:"initStore",value:function(t,o){var r=this;this.createLayer(t,o),this.subscriptions$$.push(this.activeStore.stateView.manyBy$(function(s){return!0===s.state.selected}).pipe((0,uo.T)(1)).subscribe(function(s){r.selectedFeatures$.next(s.map(function(l){return l.entity}))})),this.subscriptions$$.push(this.activeStore.count$.subscribe(function(s){r.activeStore.layer.options.showInLayerList=s>=1}))}},{key:"openStyleModalDialog",value:function(){var t=this;setTimeout(function(){var o=t.dialog.open(j0,{disableClose:!1,data:{features:t.selectedFeatures$.getValue(),icons:t.icons,icon:t.icon},autoFocus:!1});o.afterClosed().subscribe(function(r){o.componentInstance.confirmFlag&&(t.onFontChange(t.labelsAreShown,r.fontSize,r.fontStyle),t.onColorChange(t.labelsAreShown,!!t.icon,r.fillColor,r.strokeColor),t.onOffsetLabelChange(t.labelsAreShown,r.offsetX,r.offsetY))})},250)}},{key:"openDrawDialog",value:function(t,o){var r=this;setTimeout(function(){var s=r.dialog.open(D0,{disableClose:!1,data:{currentLabel:t.get("draw")}});s.afterClosed().subscribe(function(l){s.componentInstance.confirmFlag?(r.updateLabelOfOlGeometry(t,l),t.values_.fontStyle||r.updateFontSizeAndStyle(t,"20",kn.Arial),t.values_.drawingStyle||r.updateFillAndStrokeColor(t,"rgba(255,255,255,0.4)","rgba(143,7,7,1)"),t.values_.offsetX||t.values_.offsetY||r.updateOffset(t,0,t instanceof He.Z?-15:0),o?r.onDrawEnd(t):r.onSelectDraw(t,l),r.updateHeightTable()):r.activeDrawingLayerSource.getFeatures().forEach(function(c){var u=c.getGeometry();t===u&&r.activeDrawingLayerSource.removeFeature(c)})})},250)}},{key:"onDrawEnd",value:function(t,o){this.addFeatureToStore(t,o),this.clearLabelsOfOlGeometry(t),this.activeStore.layer.ol.getSource().refresh()}},{key:"onModifyDraw",value:function(t){var o=this;this.activeStore.all().forEach(function(s){s.properties.id===t.ol_uid&&(o.updateLabelOfOlGeometry(t,s.properties.draw),o.updateFontSizeAndStyle(t,s.properties.fontStyle.split(" ")[0].replace("px",""),s.properties.fontStyle.substring(s.properties.fontStyle.indexOf(" ")+1)),o.updateFillAndStrokeColor(t,s.properties.drawingStyle.fill,s.properties.drawingStyle.stroke),o.updateOffset(t,s.properties.offsetX,s.properties.offsetY),o.replaceFeatureInStore(s,t))})}},{key:"onSelectDraw",value:function(t,o){var r=this,s=this.activeStore.all(),l=t.getGeometry();l.ol_uid=t.get("id");var c=JSON.stringify(l.getCoordinates()[0]);s.forEach(function(u){var p=JSON.stringify(u.geometry.coordinates[0]);if(c===p){var d=t.get("fontStyle").split(" ")[0].replace("px",""),g=t.get("fontStyle").substring(t.get("fontStyle").indexOf(" ")+1),f=t.get("drawingStyle").fill,m=t.get("drawingStyle").stroke,y=t.get("offsetX"),_=t.get("offsetY"),b=u.properties.rad?u.properties.rad:void 0;r.updateLabelOfOlGeometry(l,o),r.updateFontSizeAndStyle(l,d,g),r.updateFillAndStrokeColor(l,f,m),r.updateOffset(l,y,_),r.replaceFeatureInStore(u,l,b)}})}},{key:"addFeatureToStore",value:function(t,o,r){var s,l,c,u,p,d=r?r.properties.id:t.ol_uid,g=this.map.ol.getView().getProjection(),f=(new Ee.Z).writeGeometryObject(t,{featureProjection:g,dataProjection:g});if(t instanceof Zi.Z||o)if(o)s=o;else{f.type="Point",f.coordinates=t.getCenter();var m=(0,re.vs)([t.getFlatCoordinates()[2],t.getFlatCoordinates()[3]],g,"EPSG:4326");u=(l=(0,re.vs)([t.getFlatCoordinates()[0],t.getFlatCoordinates()[1]],g,"EPSG:4326"))[0],p=l[1],s=(0,rs.Sp)(l,m)}t instanceof He.Z&&(u=(c=(0,re.vs)(t.getFlatCoordinates(),g,"EPSG:4326"))[0],p=c[1]),this.activeStore.update({type:be,geometry:f,projection:g.getCode(),properties:{id:d,draw:t.get("_label"),longitude:u||null,latitude:p||null,rad:s||null,fontStyle:t.get("fontStyle_"),drawingStyle:{fill:t.get("fillColor_"),stroke:t.get("strokeColor_")},offsetX:t.get("offsetX_"),offsetY:t.get("offsetY_")},meta:{id:d}})}},{key:"buildForm",value:function(){this.form=this.formBuilder.group({fill:[""],stroke:[""]})}},{key:"setupLayer",value:function(t){var o=this;setTimeout(function(){var r=o.dialog.open(E0,{disableClose:!1});r.afterClosed().subscribe(function(s){r.componentInstance.confirmFlag?(o.activeStore.state.updateAll({selected:!1}),o.activeStore=new Dt([],{map:o.map}),o.activeDrawingLayerSource=new nn.Z,o.activeDrawingLayer.opacity=0,o.deactivateDrawControl(),o.initStore(s,t),o.activeDrawControl=o.createDrawControl(o.fillColor,o.strokeColor,o.strokeWidth),o.activeDrawControl.setGeometryType(o.currGeometryType),o.toggleDrawControl(),o.stores.push(o.activeStore),o.drawControls.push([o.activeDrawingLayer.id,o.activeDrawControl]),o.drawControlsEvent.emit(o.drawControls),o.layersIDEvent.emit(o.activeDrawingLayer.id),o.isCreatingNewLayer=!1,o.labelsAreShown||o.onToggleLabels(),o.activeLayerChange.emit(o.activeDrawingLayer)):(o.select.value=o.activeDrawingLayer,o.select.selectionChange.emit(o.activeDrawingLayer))})},250)}},{key:"editLabelDrawing",value:function(){if(this.selectedFeatures$.value.length){var t=At(this.selectedFeatures$.value[0],this.map.ol.getView().getProjection().getCode());this.openDrawDialog(t,!1)}}},{key:"openShorcutsDialog",value:function(){this.dialog.open(P0)}},{key:"deleteDrawings",value:function(){var t=this;this.activeStore.deleteMany(this.selectedFeatures$.value),this.selectedFeatures$.value.forEach(function(o){t.activeDrawingLayerSource.getFeatures().forEach(function(r){var s=r.getGeometry();o.properties.id===s.ol_uid&&t.activeDrawingLayerSource.removeFeature(r)})}),this.updateHeightTable()}},{key:"onToggleLabels",value:function(){this.drawStyleService.toggleLabelsAreShown(),this.labelsAreShown=!this.labelsAreShown,this.elementStyle(this.labelsAreShown,!!this.icon),this.createDrawControl()}},{key:"onToggleDrawControl",value:function(t){t?this.toggleDrawControl():this.deactivateDrawControl()}},{key:"onLayerChange",value:function(t){var o=this;t?(this.activeStore.state.updateAll({selected:!1}),this.isCreatingNewLayer=!1,this.activeDrawingLayer.opacity=0,this.activeDrawingLayer=t,this.activeDrawingLayer.opacity=1,this.deactivateDrawControl(),this.labelsAreShown||this.onToggleLabels(),this.activeStore=this.stores.find(function(r){return r.layer.id===o.activeDrawingLayer.id}),this.activeDrawControl=this.drawControls.find(function(r){return r[0]===o.activeDrawingLayer.id})[1],this.activeDrawingLayerSource=this.activeDrawControl.olDrawingLayerSource,this.activeDrawControl.setGeometryType(this.currGeometryType),this.toggleDrawControl()):this.setupLayer(!0),this.activeLayerChange.emit(this.activeDrawingLayer)}},{key:"createLayer",value:function(t,o){var l,r=this,s=(0,D.Z)(this.allLayers);try{for(s.s();!(l=s.n()).done;){var u=Number(l.value.id.replace("igo-draw-layer",""));this.layerCounterID=Math.max(u,this.layerCounterID)}}catch(p){s.e(p)}finally{s.f()}this.activeDrawingLayer=new Je({isIgoInternalLayer:!0,id:"igo-draw-layer"+ ++this.layerCounterID,title:o?t:this.languageService.translate.instant("igo.geo.draw.drawing"),zIndex:200,source:new Re,style:function(d,g){return r.drawStyleService.createIndividualElementStyle(d,g,r.labelsAreShown,d.get("fontStyle"),d.get("drawingStyle").fill,d.get("drawingStyle").stroke,d.get("offsetX"),d.get("offsetY"),r.icon)},showInLayerList:!0,exportable:!0,browsable:!1,workspace:{enabled:!1}}),xo(this.activeStore,this.activeDrawingLayer),Ei(this.activeStore,new an({motion:ce.None})),Zc(this.activeStore,new Bt({map:this.map,motion:ce.None,many:!0})),this.activeStore.layer.visible=!0,this.activeStore.source.ol.on("removefeature",function(p){var d=p.feature.getGeometry();r.clearLabelsOfOlGeometry(d)})}},{key:"onColorChange",value:function(t,o,r,s){var l=this;this.selectedFeatures$.value.length>0&&!o&&this.selectedFeatures$.value.forEach(function(c){var u=At(c,l.map.ol.getView().getProjection().getCode());l.updateFillAndStrokeColor(u,r,s);var p=l.activeStore.all().find(function(d){return d.meta.id===u.getId()});p.properties.drawingStyle.fill=u.get("fillColor_"),p.properties.drawingStyle.stroke=u.get("strokeColor_"),l.activeStore.update(p)}),this.elementStyle(t,o),this.createDrawControl()}},{key:"onFontChange",value:function(t,o,r){var s=this;this.selectedFeatures$.value.length>0&&(this.selectedFeatures$.value.forEach(function(l){var c=At(l,s.map.ol.getView().getProjection().getCode());s.updateFontSizeAndStyle(c,o,r);var u=s.activeStore.all().find(function(p){return p.meta.id===c.getId()});u.properties.fontStyle=c.get("fontStyle_"),s.activeStore.update(u),(c=s.activeStore.layer.ol.getSource().getFeatures().find(function(p){return p.getId()===u.meta.id})).setProperties({fontStyle:u.properties.fontStyle}),c.changed()}),this.fontSize=o,this.fontStyle=r,this.drawStyleService.setFontSize(o),this.drawStyleService.setFontStyle(r),this.elementStyle(t))}},{key:"onOffsetLabelChange",value:function(t,o,r){var s=this;this.selectedFeatures$.value.length>0&&(this.selectedFeatures$.value.forEach(function(l){var c=At(l,s.map.ol.getView().getProjection().getCode());s.updateOffset(c,o,r);var u=s.activeStore.all().find(function(p){return p.meta.id===c.getId()});u.properties.offsetX=c.get("offsetX_"),u.properties.offsetY=c.get("offsetY_"),s.activeStore.update(u),(c=s.activeStore.layer.ol.getSource().getFeatures().find(function(p){return p.getId()===u.meta.id})).setProperties({offsetX:u.properties.offsetX,offsetY:u.properties.offsetY}),c.changed()}),this.elementStyle(t))}},{key:"onIconChange",value:function(t){this.icon=t,this.drawStyleService.setIcon(this.icon),this.elementStyle(!0,this.icon)}},{key:"onGeometryTypeChange",value:function(t){this.currGeometryType=t,this.activeDrawControl.setGeometryType(t),this.toggleDrawControl()}},{key:"updateLabelOfOlGeometry",value:function(t,o){t.setProperties({_label:o},!0)}},{key:"updateFontSizeAndStyle",value:function(t,o,r){t.setProperties({fontStyle_:"".concat(o,"px ").concat(r)},!0)}},{key:"updateFillAndStrokeColor",value:function(t,o,r){t.setProperties({fillColor_:o,strokeColor_:r},!0)}},{key:"updateOffset",value:function(t,o,r){t.setProperties({offsetX_:o,offsetY_:r},!0)}},{key:"getFeatureFontSize",value:function(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.fontStyle.split(" ")[0].replace("px",""):"20"}},{key:"getFeatureFontStyle",value:function(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.fontStyle.substring(this.selectedFeatures$.value[0].properties.fontStyle.indexOf(" ")+1):kn.Arial}},{key:"getFeatureFillColor",value:function(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)"}},{key:"getFeatureStrokeColor",value:function(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)"}},{key:"getFeatureOffsetX",value:function(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.offsetX:this.drawStyleService.getOffsetX()}},{key:"getFeatureOffsetY",value:function(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.offsetY:"0"}},{key:"allFontStyles",get:function(){return Object.values(kn)}},{key:"allLayers",get:function(){return this.map.layers.filter(function(t){return t.id.includes("igo-draw-layer")})}},{key:"updateHeightTable",value:function(){this.numberOfDrawings=this.activeStore.count$.getValue(),this.tableTemplate.tableHeight=this.numberOfDrawings>10?"35vh":"auto"}},{key:"updateActiveLayer",value:function(){var t=this;return this.allLayers.find(function(r){return r.title===t.activeDrawingLayer.title})||this.allLayers[0]}},{key:"toggleDrawControl",value:function(){this.deactivateDrawControl(),this.activateDrawControl()}},{key:"clearLabelsOfOlGeometry",value:function(t){var o=this;As(t).forEach(function(r){r&&r.getMap()&&o.map.ol.removeOverlay(r)})}},{key:"replaceFeatureInStore",value:function(t,o,r){this.activeStore.delete(t),this.onDrawEnd(o,r)}},{key:"deactivateDrawControl",value:function(){!this.activeDrawControl||(this.drawEnd$$&&this.drawEnd$$.unsubscribe(),this.activeDrawControl.setOlMap(void 0),this.drawControlIsActive=!1)}},{key:"activateDrawControl",value:function(){var t=this;this.drawControlIsDisabled=!1,this.drawControlIsActive=!0,this.drawEnd$$=this.activeDrawControl.end$.subscribe(function(o){t.openDrawDialog(o,!0)}),this.activeDrawControl.modify$.subscribe(function(o){t.onModifyDraw(o)}),this.drawSelect$$||(this.drawSelect$$=this.activeDrawControl.select$.subscribe(function(o){t.openDrawDialog(o,!1)})),this.activeDrawControl.setOlMap(this.map.ol,!0)}},{key:"elementStyle",value:function(t,o){var r=this;this.activeStore.layer.ol.setStyle(o?function(s,l){return r.drawStyleService.createIndividualElementStyle(s,l,t,s.get("fontStyle"),s.get("drawingStyle").fill,s.get("drawingStyle").stroke,s.get("offsetX"),s.get("offsetY"),r.icon)}:function(s,l){return r.drawStyleService.createIndividualElementStyle(s,l,t,s.get("fontStyle"),s.get("drawingStyle").fill,s.get("drawingStyle").stroke,s.get("offsetX"),s.get("offsetY"))})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(S.QS),e.Y36(ou),e.Y36(z.uw),e.Y36(z_))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-draw"]],viewQuery:function(n,t){var o;1&n&&e.Gf($0,5),2&n&&e.iGM(o=e.CRH())&&(t.select=o.first)},inputs:{map:"map",stores:"stores",drawControls:"drawControls",activeDrawingLayer:"activeDrawingLayer"},outputs:{activeLayerChange:"activeLayerChange",drawControlsEvent:"drawControlsEvent",layersIDEvent:"layersIDEvent",fillColor:"fillColor",strokeColor:"strokeColor",strokeWidth:"strokeWidth",fontSize:"fontSize",fontStyle:"fontStyle"},decls:47,vars:45,consts:[[1,"geometry-type-toggle","mat-typography"],[3,"value","change"],[3,"value"],[1,"draw-options","mat-typography"],[3,"disabled","checked","labelPosition","change"],[3,"checked","labelPosition","change"],["appearance","outline",1,"layer-select"],[3,"value","selectionChange"],["selectedLayer",""],[3,"value",4,"ngFor","ngForOf"],["id","createNewLayer"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","deleteBtn","mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","click",4,"ngIf"],[1,"table-compact",3,"store","template","dblclick"],["table",""],[1,"icon-options"],[4,"ngIf"],["mat-icon-button","","color","accent","disableRipple","true",3,"click"],["svgIcon","keyboard-outline","tooltip-position","below","matTooltipShowDelay","500",1,"shortcuts-icon",3,"matTooltip"],["mat-raised-button","","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],[3,"svgIcon"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"deleteBtn",3,"matTooltip","disabled","click"],["svgIcon","delete"],["class","box",4,"ngIf"],["value","",3,"click"],[3,"value","click",4,"ngFor","ngForOf"],[1,"box"],[3,"src"],[3,"value","click"],["mat-raised-button","","color","primary",3,"matTooltip","click"],["svgIcon","palette","matBadgeColor","warn","matBadgeSize","medium",1,"style-icon",3,"matBadge"]],template:function(n,t){if(1&n){var o=e.EpF();e.TgZ(0,"div")(1,"div",0)(2,"mat-button-toggle-group",1),e.NdJ("change",function(s){return t.onGeometryTypeChange(s.value)}),e.TgZ(3,"mat-button-toggle",2),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"mat-button-toggle",2),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"mat-button-toggle",2),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"mat-button-toggle",2),e._uU(13),e.ALo(14,"translate"),e.qZA()()(),e.TgZ(15,"div",3)(16,"mat-slide-toggle",4),e.NdJ("change",function(s){return t.onToggleDrawControl(s.checked)}),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"mat-slide-toggle",5),e.NdJ("change",function(){return t.onToggleLabels()}),e._uU(20),e.ALo(21,"translate"),e.qZA()(),e._UZ(22,"mat-divider"),e.TgZ(23,"div")(24,"mat-form-field",6)(25,"mat-label"),e._uU(26),e.ALo(27,"translate"),e.qZA(),e.TgZ(28,"mat-select",7,8),e.NdJ("selectionChange",function(){e.CHM(o);var s=e.MAs(29);return e.KtG(t.onLayerChange(s.value))}),e.YNc(30,R0,2,2,"mat-option",9),e.TgZ(31,"mat-option",10),e._uU(32),e.ALo(33,"translate"),e.qZA()()(),e.YNc(34,J0,4,7,"button",11),e.qZA(),e._UZ(35,"mat-divider"),e.TgZ(36,"div"),e.YNc(37,B0,4,6,"button",12),e.TgZ(38,"div")(39,"igo-entity-table",13,14),e.NdJ("dblclick",function(){return t.editLabelDrawing()}),e.qZA()()(),e.TgZ(41,"div",15),e.YNc(42,q0,11,8,"mat-form-field",16),e.qZA(),e.TgZ(43,"button",17),e.NdJ("click",function(){return t.openShorcutsDialog()}),e._UZ(44,"mat-icon",18),e.ALo(45,"translate"),e.qZA(),e.YNc(46,G0,5,7,"button",19),e.qZA()}2&n&&(e.xp6(2),e.Q6J("value",t.geometryType.Point),e.xp6(1),e.Q6J("value",t.geometryType.Point),e.xp6(1),e.hij(" ",e.lcZ(5,27,"igo.geo.draw."+t.geometryType.Point)," "),e.xp6(2),e.Q6J("value",t.geometryType.LineString),e.xp6(1),e.hij(" ",e.lcZ(8,29,"igo.geo.draw."+t.geometryType.LineString)," "),e.xp6(2),e.Q6J("value",t.geometryType.Polygon),e.xp6(1),e.hij(" ",e.lcZ(11,31,"igo.geo.draw."+t.geometryType.Polygon)," "),e.xp6(2),e.Q6J("value",t.geometryType.Circle),e.xp6(1),e.hij(" ",e.lcZ(14,33,"igo.geo.draw."+t.geometryType.Circle)," "),e.xp6(3),e.Q6J("disabled",t.drawControlIsDisabled)("checked",t.drawControlIsActive)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(18,35,"igo.geo.spatialFilter.drawControl")," "),e.xp6(2),e.Q6J("checked",t.labelsAreShown)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(21,37,"igo.geo.draw.toggleMapTooltips")," "),e.xp6(6),e.Oqu(e.lcZ(27,39,"igo.geo.draw.layer.title")),e.xp6(2),e.Q6J("value",t.updateActiveLayer()),e.xp6(2),e.Q6J("ngForOf",t.allLayers),e.xp6(2),e.hij(" ",e.lcZ(33,41,"igo.geo.draw.layer.createNewLayer")," "),e.xp6(2),e.Q6J("ngIf",t.activeDrawingLayer),e.xp6(3),e.Q6J("ngIf",t.activeStore.count$.getValue()>0),e.xp6(2),e.Q6J("store",t.activeStore)("template",t.tableTemplate),e.xp6(3),e.Q6J("ngIf",t.icons.length>=1),e.xp6(2),e.Q6J("matTooltip",e.lcZ(45,43,"igo.geo.draw.shortcuts")),e.xp6(2),e.Q6J("ngIf",t.selectedFeatures$.value.length))},dependencies:[C.sg,C.O5,I.lW,ot.A9,ot.Yi,Mt.d,B.KE,B.hX,O.Hw,bt.k,J.gM,ke.gD,ke.$L,ie.ey,ht.Rr,ho,C.Ov,E.X$],styles:[".geometry-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.geometry-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}.geometry-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:25%}.draw-options[_ngcontent-%COMP%]{overflow-x:hidden}.draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;margin:10px}.draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mat-slide-toggle-content{width:calc(100% - 60px)}.icon-options[_ngcontent-%COMP%]{margin:5px 5px 0}.edition-drawing[_ngcontent-%COMP%]{padding:10px 0}img[_ngcontent-%COMP%]{width:100%;height:100%}.deleteBtn[_ngcontent-%COMP%]{margin-left:12px}.storeTable[_ngcontent-%COMP%]{height:auto!important}.layer-select[_ngcontent-%COMP%]{width:85%;padding:10px 10px 0%}.input-button-container[_ngcontent-%COMP%]{padding:10px}.input-button-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:25%}.input-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{left:8px;bottom:10px}"],data:{animation:[(0,_e.X$)("openClose",[(0,_e.SB)("open",(0,_e.oB)({opacity:1})),(0,_e.SB)("closed",(0,_e.oB)({opacity:0})),(0,_e.eR)("open => closed",[(0,_e.jt)("600ms ease")]),(0,_e.eR)("closed => open",[(0,_e.jt)("800ms ease")])])]},changeDetection:0}),i}();function Q0(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",24)(1,"span"),e._UZ(2,"mat-icon",25),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"mat-form-field",26),e.ALo(6,"translate"),e.TgZ(7,"mat-label"),e._uU(8),e.qZA(),e.TgZ(9,"input",27,28),e.NdJ("colorPickerChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.styleModalData.fillColor=r)}),e.ALo(11,"translate"),e.qZA()()()}if(2&i){var t=e.oxw();e.xp6(3),e.hij(" ",e.lcZ(4,14,"igo.geo.draw.fill")," "),e.xp6(2),e.Q6J("matTooltip",e.lcZ(6,16,"igo.geo.draw.colorPicker")),e.xp6(3),e.Oqu(t.getFeatureFillColor()),e.xp6(1),e.Udp("background",t.getFeatureFillColor()),e.Q6J("readonly",!0)("colorPicker",t.getFeatureFillColor())("cpWidth","200px")("cpOutputFormat","rgba")("cpPosition","bottom")("cpPositionOffset","-75%")("cpCancelButton",!0)("cpCancelButtonText",e.lcZ(11,18,"igo.geo.draw.cancel"))("cpOKButton",!0)}}function Y0(i,a){if(1&i&&(e.TgZ(0,"mat-option",29),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.hij(" ",n," ")}}var j0=function(){var i=function(){function a(n,t,o,r){(0,h.Z)(this,a),this.dialogRef=n,this.formBuilder=t,this.drawStyleService=o,this.data=r,this.confirmFlag=!1,this.buildForm()}return(0,v.Z)(a,[{key:"ngOnInit",value:function(){this.linestringOnly=!0;var o,t=(0,D.Z)(this.data.features);try{for(t.s();!(o=t.n()).done;)"LineString"!==o.value.geometry.type&&(this.linestringOnly=!1)}catch(s){t.e(s)}finally{t.f()}this.buildStyleData()}},{key:"buildForm",value:function(){this.form=this.formBuilder.group({fill:[""],stroke:[""]})}},{key:"buildStyleData",value:function(){this.styleModalData={fillColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)",strokeColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)",fontSize:this.data.features.length>0?this.data.features[0].properties.fontStyle.split(" ")[0].replace("px",""):"20",fontStyle:this.data.features.length>0?this.data.features[0].properties.fontStyle.substring(this.data.features[0].properties.fontStyle.indexOf(" ")+1):kn.Arial,offsetX:this.data.features.length>0?this.data.features[0].properties.offsetX:this.drawStyleService.getOffsetX(),offsetY:this.data.features.length>0?this.data.features[0].properties.offsetY:this.drawStyleService.getOffsetY()}}},{key:"allFontStyles",get:function(){return Object.values(kn)}},{key:"getFeatureFontSize",value:function(){return this.styleModalData.fontSize?this.styleModalData.fontSize:this.data.features.length>0?this.data.features[0].properties.fontStyle.split(" ")[0].replace("px",""):"20"}},{key:"getFeatureFontStyle",value:function(){return this.styleModalData.fontStyle?this.styleModalData.fontStyle:this.data.features.length>0?this.data.features[0].properties.fontStyle.substring(this.data.features[0].properties.fontStyle.indexOf(" ")+1):kn.Arial}},{key:"getFeatureFillColor",value:function(){return this.styleModalData.fillColor?this.styleModalData.fillColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)"}},{key:"getFeatureStrokeColor",value:function(){return this.styleModalData.strokeColor?this.styleModalData.strokeColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)"}},{key:"getFeatureOffsetX",value:function(){return this.styleModalData.offsetX?this.styleModalData.offsetX:this.data.features.length>0?this.data.features[0].properties.offsetX:this.drawStyleService.getOffsetX()}},{key:"getFeatureOffsetY",value:function(){return this.styleModalData.offsetY?this.styleModalData.offsetY:this.data.features.length>0?this.data.features[0].properties.offsetY:this.drawStyleService.getOffsetY()}},{key:"cancelDrawing",value:function(){this.dialogRef.close()}},{key:"confirm",value:function(){this.confirmFlag=!0,this.dialogRef.close(this.styleModalData)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(z.so),e.Y36(S.QS),e.Y36(ou),e.Y36(z.WI))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-style-modal-component"]],inputs:{confirmFlag:"confirmFlag"},decls:54,vars:46,consts:[["mat-dialog-content",""],["mat-dialog-title","",1,"mat-typography"],[1,"edition-drawing","mat-typography",3,"hidden"],[1,"igo-form",3,"formGroup"],["class","fill-color-picker mat-typography",4,"ngIf"],[1,"stroke-color-picker","mat-typography"],["svgIcon","square-outline",1,"stroke-palette-icon"],["appearance","outline","floatLabel","always","tooltip-position","below","matTooltipShowDelay","500",1,"stroke-field",3,"matTooltip"],["formControlName","stroke","matInput","","type","text",3,"readonly","colorPicker","cpWidth","cpPosition","cpPositionOffset","cpOutputFormat","cpCancelButton","cpCancelButtonText","cpOKButton","colorPickerChange"],["strokeColorInput",""],[1,"igo-input-container"],["appearance","outline",1,"igo-form-input-box"],["matInput","","type","number","placeholder","10","min","10","onkeydown","return event.keyCode !== 69",3,"value","input"],["testFontSize",""],["matSuffix",""],[3,"value","selectionChange"],["testFontStyle",""],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","onkeydown","return event.keyCode !== 69",3,"value","input"],["offsetXInput",""],["offsetYInput",""],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"fill-color-picker","mat-typography"],["svgIcon","square",1,"stroke-palette-icon"],["appearance","outline","floatLabel","always","tooltip-position","below","matTooltipShowDelay","500",1,"fill-field",3,"matTooltip"],["formControlName","fill","matInput","","type","text",3,"readonly","colorPicker","cpWidth","cpOutputFormat","cpPosition","cpPositionOffset","cpCancelButton","cpCancelButtonText","cpOKButton","colorPickerChange"],["fillColorInput",""],[3,"value"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"h2",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",2)(5,"form",3),e.YNc(6,Q0,12,20,"div",4),e.TgZ(7,"div",5)(8,"span"),e._UZ(9,"mat-icon",6),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"mat-form-field",7),e.ALo(13,"translate"),e.TgZ(14,"mat-label"),e._uU(15),e.qZA(),e.TgZ(16,"input",8,9),e.NdJ("colorPickerChange",function(r){return t.styleModalData.strokeColor=r}),e.ALo(18,"translate"),e.qZA()()(),e.TgZ(19,"div",10)(20,"mat-form-field",11)(21,"mat-label"),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"input",12,13),e.NdJ("input",function(r){return t.styleModalData.fontSize=r.target.value}),e.qZA(),e.TgZ(26,"span",14),e._uU(27,"px"),e.qZA()(),e.TgZ(28,"mat-form-field",11)(29,"mat-label"),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.TgZ(32,"mat-select",15,16),e.NdJ("selectionChange",function(r){return t.styleModalData.fontStyle=r.value}),e.YNc(34,Y0,2,2,"mat-option",17),e.qZA()()(),e.TgZ(35,"div",10)(36,"mat-form-field",11)(37,"mat-label"),e._uU(38),e.ALo(39,"translate"),e.qZA(),e.TgZ(40,"input",18,19),e.NdJ("input",function(r){return t.styleModalData.offsetX=r.target.value}),e.qZA()(),e.TgZ(42,"mat-form-field",11)(43,"mat-label"),e._uU(44),e.ALo(45,"translate"),e.qZA(),e.TgZ(46,"input",18,20),e.NdJ("input",function(r){return t.styleModalData.offsetY=r.target.value}),e.qZA()()()()()(),e.TgZ(48,"div",21)(49,"button",22),e.NdJ("click",function(){return t.cancelDrawing()}),e._uU(50),e.ALo(51,"translate"),e.qZA(),e.TgZ(52,"button",23),e.NdJ("click",function(){return t.confirm()}),e._uU(53,"OK "),e.qZA()()),2&n&&(e.xp6(2),e.Oqu(e.lcZ(3,28,"igo.geo.layer.style.styleModal")),e.xp6(2),e.Q6J("hidden",0===t.data.features.length),e.xp6(1),e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("ngIf",!0!==t.linestringOnly),e.xp6(4),e.hij(" ",e.lcZ(11,30,"igo.geo.draw.stroke")," "),e.xp6(2),e.Q6J("matTooltip",e.lcZ(13,32,"igo.geo.draw.colorPicker")),e.xp6(3),e.Oqu(t.getFeatureStrokeColor()),e.xp6(1),e.Udp("background",t.getFeatureStrokeColor()),e.Q6J("readonly",!0)("colorPicker",t.getFeatureStrokeColor())("cpWidth","200px")("cpPosition","bottom")("cpPositionOffset","-75%")("cpOutputFormat","rgba")("cpCancelButton",!0)("cpCancelButtonText",e.lcZ(18,34,"igo.geo.draw.cancel"))("cpOKButton",!0),e.xp6(6),e.Oqu(e.lcZ(23,36,"igo.geo.draw.fontSize")),e.xp6(2),e.Q6J("value",t.getFeatureFontSize()),e.xp6(6),e.Oqu(e.lcZ(31,38,"igo.geo.draw.fontStyle")),e.xp6(2),e.Q6J("value",t.getFeatureFontStyle()),e.xp6(2),e.Q6J("ngForOf",t.allFontStyles),e.xp6(4),e.Oqu(e.lcZ(39,40,"igo.geo.draw.offsetX")),e.xp6(2),e.Q6J("value",t.getFeatureOffsetX()),e.xp6(4),e.Oqu(e.lcZ(45,42,"igo.geo.draw.offsetY")),e.xp6(2),e.Q6J("value",t.getFeatureOffsetY()),e.xp6(4),e.hij("",e.lcZ(51,44,"igo.geo.draw.cancel")," "))},dependencies:[B.KE,B.hX,B.R9,le.Nt,S._Y,S.Fj,S.JJ,S.JL,S.sg,S.u,C.sg,C.O5,O.Hw,I.lW,ke.gD,ie.ey,J.gM,is.Kk,E.X$],styles:["h2[_ngcontent-%COMP%]{font-weight:700;font-size:large}.igo-form[_ngcontent-%COMP%]{padding:10px}.fill-field[_ngcontent-%COMP%], .stroke-field[_ngcontent-%COMP%]{width:130px}.fill-color-picker[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:relative;top:7px}.fill-color-picker[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{left:8px}.stroke-color-picker[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:relative;top:7px}.stroke-color-picker[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{left:35px}.box[_ngcontent-%COMP%]{width:25px;height:25px}.edition-drawing[_ngcontent-%COMP%]{padding:10px 0}.igo-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%] + .mat-form-field[_ngcontent-%COMP%]{margin-left:8px}.igo-form-input-box[_ngcontent-%COMP%]{width:150px}button[_ngcontent-%COMP%]{margin-right:5px}"]}),i}(),Fo=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[Ge,xn,y_]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[le.c,S.UX,B.lN,C.ez,S.u5,Mt.t,Ve.Tx,O.Ps,I.ot,ht.rP,ke.LD,J.AV,X.ie,So.KP,bt.g,pt.p9,is.e4,he,yo,Po,Ua,Pt,fr,Eo]}),i}();e.B6R(jc,[C.mk,C.O5,O.Hw,I.lW,J.gM,X.Tg,ie.X2,X.Nh,bt.k,pt.oG,Ni],[C.Ov,E.X$]),e.B6R(Vc,[J.gM,X.Tg,ie.X2,Ni],[]),e.B6R(ko,[S.JJ,C.mk,C.sg,C.O5,C.tP,S.On,Mt.d,Ve.VK,Ve.p6,O.Hw,I.lW,J.gM,X.i$,X.Tg,So.pH,bt.k,pt.oG,Yt,Pn,Ut,jc,B_],[C.Ov,E.X$]),e.B6R(qi,[C.sg,C.O5,Mt.d,ht.Rr,J.gM,Yt,Pn,Vc],[C.Ov,E.X$]);var lu=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,bt.g,I.ot,O.Ps,X.ie,J.AV,fr,he,yo,Po,wo,Fo]}),i}();function H0(i,a){if(1&i&&(e.TgZ(0,"mat-option",17),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("matTooltip",n.title)("value",n),e.xp6(1),e.hij(" ",n.title," ")}}function V0(i,a){if(1&i&&(e.TgZ(0,"mat-option",17),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("matTooltip",n.url)("value",n),e.xp6(1),e.hij(" ",n.url," ")}}function z0(i,a){if(1&i&&(e.TgZ(0,"mat-option",18),e.NdJ("click",function(o){return o.stopPropagation()}),e.TgZ(1,"p",19),e._uU(2),e.qZA()()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(2),e.Oqu(n)}}e.B6R(Ts,[C.sg,C.O5,Yt,Pn,v_,Qc],[C.Ov]);var W0=function(a,n){return{value:a,email:n}};function K0(i,a){if(1&i&&(e.TgZ(0,"span")(1,"p",20),e._uU(2),e.qZA()()),2&i){var n=e.oxw();e.xp6(2),e.Oqu(n.languageService.translate.instant("igo.geo.catalog.externalProvider.unavailableWithEmail",e.WLB(1,W0,n.addedCatalog.url,n.emailAddress)))}}var X0=function(a){return{value:a}};function eb(i,a){if(1&i&&(e.TgZ(0,"span")(1,"p",20),e._uU(2),e.qZA()()),2&i){var n=e.oxw();e.xp6(2),e.Oqu(n.languageService.translate.instant("igo.geo.catalog.unavailable",e.VKq(1,X0,n.addedCatalog.url)))}}var tb=function(){var i=function(){function a(n,t,o,r,s){(0,h.Z)(this,a),this.formBuilder=n,this.languageService=t,this.configService=o,this.dialogRef=r,this.data=s,this.defaultAddedCatalogType="wms",this.predefinedCatalogsList$=new x.X([]),this.predefinedCatalogs=[],this.error=!1,this.store=s.store,this.predefinedCatalogs=s.predefinedCatalogs,this.error=s.error,this.addedCatalog=s.addedCatalog,this.form=this.formBuilder.group({id:["",[]],title:["",[]],url:["",[S.kI.required]],type:[this.defaultAddedCatalogType,[S.kI.required]]})}return(0,v.Z)(a,[{key:"ngOnInit",value:function(){var t=this;this.store.state.clear(),this.typeCapabilities=Object.keys(Ko),this.addedCatalogType$$=this.form.get("type").valueChanges.subscribe(function(o){"wmts"===o?t.form.get("title").setValidators(S.kI.required):t.form.get("title").setValidators([]),t.form.get("title").updateValueAndValidity()}),this.computePredefinedCatalogList(),this.storeViewAll$$=this.store.view.all$().subscribe(function(){return t.computePredefinedCatalogList()}),this.emailAddress=this.configService.getConfig("emailAddress")}},{key:"ngOnDestroy",value:function(){this.addedCatalogType$$.unsubscribe(),this.storeViewAll$$.unsubscribe()}},{key:"changeUrlOrTitle",value:function(t){this.form.patchValue(t),this.error=!1,this.computePredefinedCatalogList()}},{key:"computePredefinedCatalogList",value:function(){var t=this;this.predefinedCatalogsList$.next(this.predefinedCatalogs.filter(function(o){return!t.store.get(o.id)}))}},{key:"addCatalog",value:function(t){this.error=!1,this.dialogRef.close(t)}},{key:"cancel",value:function(){this.error=!1,this.dialogRef.close()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(S.QS),e.Y36($),e.Y36(j),e.Y36(z.so),e.Y36(z.WI,8))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-add-catalog-dialog"]],decls:34,vars:25,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],["type","text","formControlName","title","matInput","",3,"placeholder","matAutocomplete"],[3,"optionSelected"],["auto2","matAutocomplete"],["matTooltipShowDelay","500",3,"matTooltip","value",4,"ngFor","ngForOf"],["type","text","formControlName","url","placeholder","URL","matInput","",3,"matAutocomplete"],["auto","matAutocomplete"],["formControlName","type","placeholder","Type"],[3,"value","click",4,"ngFor","ngForOf"],[4,"ngIf"],["mat-dialog-actions","",2,"justify-content","center"],[1,"igo-form-button-group","add-catalog-button-top-padding"],["mat-raised-button","","type","button",3,"click"],["id","addCatalogBtnDialog","mat-raised-button","","type","button","color","primary",3,"disabled","click"],["matTooltipShowDelay","500",3,"matTooltip","value"],[3,"value","click"],["mat-line",""],[1,"error"]],template:function(n,t){if(1&n&&(e.TgZ(0,"h1",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"div",1)(4,"form",2)(5,"div",3)(6,"mat-form-field"),e._UZ(7,"input",4),e.ALo(8,"translate"),e.TgZ(9,"mat-autocomplete",5,6),e.NdJ("optionSelected",function(l){return t.changeUrlOrTitle(l.option.value)}),e.YNc(11,H0,2,3,"mat-option",7),e.ALo(12,"async"),e.qZA()()(),e.TgZ(13,"div",3)(14,"mat-form-field"),e._UZ(15,"input",8),e.TgZ(16,"mat-autocomplete",5,9),e.NdJ("optionSelected",function(l){return t.changeUrlOrTitle(l.option.value)}),e.YNc(18,V0,2,3,"mat-option",7),e.ALo(19,"async"),e.qZA()()(),e.TgZ(20,"div",3)(21,"mat-form-field")(22,"mat-select",10),e.YNc(23,z0,3,2,"mat-option",11),e.qZA()()()(),e.YNc(24,K0,3,4,"span",12),e.YNc(25,eb,3,3,"span",12),e.qZA(),e.TgZ(26,"div",13)(27,"div",14)(28,"button",15),e.NdJ("click",function(){return t.cancel()}),e._uU(29),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"button",16),e.NdJ("click",function(){return t.addCatalog(t.form.value)}),e._uU(32),e.ALo(33,"translate"),e.qZA()()()),2&n){var o=e.MAs(10),r=e.MAs(17);e.xp6(1),e.Oqu(e.lcZ(2,13,"igo.geo.catalog.library.addTitle")),e.xp6(3),e.Q6J("formGroup",t.form),e.xp6(3),e.s9C("placeholder",e.lcZ(8,15,"igo.geo.printForm.title")),e.Q6J("matAutocomplete",o),e.xp6(4),e.Q6J("ngForOf",e.lcZ(12,17,t.predefinedCatalogsList$)),e.xp6(4),e.Q6J("matAutocomplete",r),e.xp6(3),e.Q6J("ngForOf",e.lcZ(19,19,t.predefinedCatalogsList$)),e.xp6(5),e.Q6J("ngForOf",t.typeCapabilities),e.xp6(1),e.Q6J("ngIf",t.error&&t.addedCatalog&&t.emailAddress),e.xp6(1),e.Q6J("ngIf",t.error&&t.addedCatalog&&!t.emailAddress),e.xp6(4),e.hij(" ",e.lcZ(30,21,"igo.geo.catalog.library.cancel")," "),e.xp6(2),e.Q6J("disabled",!t.form.valid),e.xp6(1),e.hij(" ",e.lcZ(33,23,"igo.geo.catalog.library.add")," ")}},dependencies:[C.sg,C.O5,ie.X2,J.gM,I.lW,B.KE,S._Y,S.Fj,S.JJ,S.JL,S.sg,S.u,le.Nt,ke.gD,ie.ey,_t.XC,_t.ZL,z.uh,z.xY,z.H8,C.Ov,E.X$],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}.add-catalog-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}.igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center}button[_ngcontent-%COMP%]{cursor:pointer}button#addCatalogBtnDialog[disabled=true][_ngcontent-%COMP%]{cursor:default;background-color:#0000001f;color:#00000042}.error[_ngcontent-%COMP%]{color:red}"]}),i}();function nb(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-catalog-library-item",3),e.NdJ("catalogRemove",function(){var l=e.CHM(n).$implicit,c=e.oxw();return e.KtG(c.onCatalogRemove(l))})("select",function(){var l=e.CHM(n).$implicit,c=e.oxw();return e.KtG(c.onCatalogSelect(l))}),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw();e.Q6J("map",o.map)("catalog",t)}}function ob(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",4)(1,"button",5),e.NdJ("click",function(){e.CHM(n);var o=e.oxw();return e.KtG(o.addCatalogDialog())}),e.ALo(2,"translate"),e._uU(3),e.ALo(4,"translate"),e._UZ(5,"mat-icon",6),e.qZA()()}2&i&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,2,"igo.geo.catalog.library.addBtn")),e.xp6(2),e.hij(" ",e.lcZ(4,4,"igo.geo.catalog.library.addBtn")," "))}var Ls=function(){var i=function(){function a(n,t,o,r,s){(0,h.Z)(this,a),this.capabilitiesService=n,this.messageService=t,this.languageService=o,this.storageService=r,this.dialog=s,this.addCatalogAllowed=!1,this.predefinedCatalogs=[],this.catalogSelectChange=new e.vpe,this.submitDisabled=!0}return(0,v.Z)(a,[{key:"addedCatalogs",get:function(){return this.storageService.get("addedCatalogs")||[]},set:function(t){this.storageService.set("addedCatalogs",t)}},{key:"ngOnInit",value:function(){this.store.state.clear(),this.predefinedCatalogs=this.predefinedCatalogs.map(function(t){return t.id=wn.V.hashStr((t.type||"wms")+eo(t.url)),t.title=""!==t.title&&t.title?t.title:t.url,t})}},{key:"getCatalogs",value:function(){return this.store.view.all$()}},{key:"onCatalogSelect",value:function(t){this.store.state.update(t,{selected:!0,focused:!0},!0),this.catalogSelectChange.emit({selected:!0,catalog:t})}},{key:"unsubscribeAddingCatalog",value:function(){this.addingCatalog$$&&this.addingCatalog$$.unsubscribe()}},{key:"addCatalog",value:function(t){var o=this;if(t){var r=wn.V.hashStr(t.type+eo(t.url)),s=this.predefinedCatalogs.find(function(u){return u.id===t.id});if(s&&(t.version=s.version,t.externalProvider=s.externalProvider,r=s.id),this.store.get(r)){var l=this.languageService.translate.instant("igo.geo.catalog.library.inlist.title"),c=this.languageService.translate.instant("igo.geo.catalog.library.inlist.message");return void this.messageService.alert(c,l)}this.unsubscribeAddingCatalog(),this.addingCatalog$$=this.capabilitiesService.getCapabilities(t.type,t.url,t.version).pipe((0,Ze.K)(function(u){var p=o.languageService.translate.instant("igo.geo.catalog.unavailableTitle");if(u.error)return o.addCatalogDialog(!0,t),u.error.caught=!0,u;var d=o.languageService.translate.instant("igo.geo.catalog.unavailable",{value:t.url});throw o.messageService.error(d,p),u})).subscribe(function(u){var p,d;switch(t.type){case"wms":p=t.title||u.Service.Title,d=t.version||u.version;break;case"arcgisrest":case"imagearcgisrest":case"tilearcgisrest":p=t.title||u.mapName;break;case"wmts":p=t.title||u.ServiceIdentification.ServiceType;break;default:p=t.title}var g=se.removeUndefined(Object.assign({},s,se.removeUndefined({id:r,title:p,url:t.url,type:t.type||"wms",externalProvider:t.externalProvider||!1,removable:!0,version:d})));o.store.insert(g);var f=o.addedCatalogs.slice(0);f.push(g),o.addedCatalogs=f,o.unsubscribeAddingCatalog()})}}},{key:"ngOnDestroy",value:function(){this.unsubscribeAddingCatalog()}},{key:"onCatalogRemove",value:function(t){this.store.delete(t),this.addedCatalogs=this.addedCatalogs.slice(0).filter(function(o){return o.id!==t.id})}},{key:"addCatalogDialog",value:function(t,o){var r=this;this.dialog.open(tb,{width:"700px",data:{predefinedCatalogs:this.predefinedCatalogs,store:this.store,error:t,addedCatalog:o}}).afterClosed().subscribe(function(l){r.addCatalog(l)})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Pr),e.Y36(Ae),e.Y36($),e.Y36(Te),e.Y36(z.uw))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-catalog-library"]],inputs:{store:"store",map:"map",addCatalogAllowed:"addCatalogAllowed",predefinedCatalogs:"predefinedCatalogs"},outputs:{catalogSelectChange:"catalogSelectChange"},decls:4,vars:5,consts:[[3,"navigation"],["ngFor","",3,"ngForOf"],["class","btnAddCatalog",4,"ngIf"],["igoListItem","","color","accent",3,"map","catalog","catalogRemove","select"],[1,"btnAddCatalog"],["mat-raised-button","","matTooltipPosition","above","color","primary",3,"matTooltip","click"],["svgIcon","earth-plus"]],template:function(n,t){1&n&&(e.TgZ(0,"igo-list",0),e.YNc(1,nb,1,2,"ng-template",1),e.ALo(2,"async"),e.qZA(),e.YNc(3,ob,6,6,"div",2)),2&n&&(e.Q6J("navigation",!1),e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,3,t.getCatalogs())),e.xp6(2),e.Q6J("ngIf",t.addCatalogAllowed))},styles:["igo-list[_ngcontent-%COMP%]{height:auto}.btnAddCatalog[_ngcontent-%COMP%]{justify-content:center;display:flex;margin:30px 0}"],changeDetection:0}),i}();function ib(i,a){1&i&&(e.TgZ(0,"mat-icon",4),e.NdJ("click",function(t){return t.stopPropagation()}),e.ALo(1,"translate"),e.qZA()),2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.catalog.externalProvider.catalog"))}function rb(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(o){e.CHM(n);var r=e.oxw();return e.KtG(r.removeCatalogFromLibrary(o))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",6),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.catalog.library.remove"))}function ab(i,a){1&i&&(e.TgZ(0,"button",7),e._UZ(1,"mat-icon",8),e.qZA())}var sb=function(){var i=function(){function a(){(0,h.Z)(this,a),this.catalogRemove=new e.vpe}return(0,v.Z)(a,[{key:"title",get:function(){return en(this.catalog)}},{key:"removeCatalogFromLibrary",value:function(t){t.stopPropagation(),this.catalogRemove.emit()}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-catalog-library-item"]],inputs:{catalog:"catalog",map:"map"},outputs:{catalogRemove:"catalogRemove"},decls:6,vars:4,consts:[["mat-line",""],["class","igo-external-provider","tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["class","igo-blank","disabled","true","mat-icon-button","",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",1,"igo-external-provider",3,"matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","delete"],["disabled","true","mat-icon-button","",1,"igo-blank"],["svgIcon","blank"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-list-item")(1,"h4",0),e._uU(2),e.qZA(),e.YNc(3,ib,2,3,"mat-icon",1),e.YNc(4,rb,3,3,"button",2),e.YNc(5,ab,2,0,"button",3),e.qZA()),2&n&&(e.xp6(2),e.hij(" ",t.title," "),e.xp6(1),e.Q6J("ngIf",t.catalog.externalProvider),e.xp6(1),e.Q6J("ngIf",t.catalog.removable),e.xp6(1),e.Q6J("ngIf",!t.catalog.removable))},dependencies:[C.O5,O.Hw,X.Tg,ie.X2,J.gM,I.lW,E.X$],styles:[".igo-blank[_ngcontent-%COMP%]{cursor:pointer}.igo-external-provider[_ngcontent-%COMP%]{cursor:help}"],changeDetection:0}),i}(),cu=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,O.Ps,bt.g,X.ie,J.AV,yo,he,I.ot,B.lN,S.UX,le.c,ke.LD,_t.Bb,z.Is]}),i}();e.B6R(Ls,[C.sg,C.O5,O.Hw,J.gM,Yt,Pn,I.lW,sb],[C.Ov,E.X$]);var uu=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,bt.g,O.Ps,X.ie,J.AV,fr,yo,Po,lu,cu]}),i}(),pu=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,[{key:"transform",value:function(t,o){var s,r=this;return"time"===o&&(s=t.filter(function(l){var c=l.dataSource;return r.isTimeFilterable(c)&&void 0!==c.options.timeFilter&&Object.keys(c.options.timeFilter).length})),"ogc"===o&&(s=t.filter(function(l){return r.isOgcFilterable(l.dataSource)})),s}},{key:"isTimeFilterable",value:function(t){return"wms"===t.options.type&&t.options.timeFilterable}},{key:"isOgcFilterable",value:function(t){var o=!1;return t.options.ogcFilters&&t.options.ogcFilters.enabled&&t.options.ogcFilters.editable&&(o=!0),t.options.ogcFilters&&t.options.ogcFilters.enabled&&(t.options.ogcFilters.pushButtons||t.options.ogcFilters.checkboxes||t.options.ogcFilters.radioButtons||t.options.ogcFilters.select||t.options.ogcFilters.autocomplete)&&(o=!0),o}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275pipe=e.Yjl({name:"filterableDataSource",type:i,pure:!0}),i}(),du=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,[{key:"filterByDate",value:function(t,o){var r,l,c;if(Array.isArray(o)){var u=[];o[0]&&(l=this.reformatDateTime(o[0]),u.push(o[0])),o[1]&&(c=this.reformatDateTime(o[1]),u.push(o[1])),2===u.length&&l!==c&&(r=t instanceof Di?l+","+c:l+"/"+c),l===c&&(r=l)}else o&&(r=this.reformatDateTime(o));t.ol.updateParams({TIME:r}),t instanceof Ht&&t.setTimeFilter(t.timeFilter,!0)}},{key:"filterByYear",value:function(t,o){var r,s,l;if(Array.isArray(o)){var c=[];o[0]&&(s=o[0],c.push(o[0])),o[1]&&(l=o[1],c.push(o[1])),2===c.length&&s!==l&&(r=t instanceof Di?s+","+l:s+"/"+l),s===l&&(r=s)}else r=o;t.ol.updateParams({TIME:r}),t instanceof Ht&&t.setTimeFilter(t.timeFilter,!0)}},{key:"reformatDateTime",value:function(t){var o=t.getFullYear(),r=t.getMonth()+1,s=t.getUTCDate(),l=t.getUTCHours(),c=t.getUTCMinutes();return Number(r)<10&&(r="0"+r),Number(s)<10&&(s="0"+s),Number(l)<10&&(l="0"+l),Number(c)<10&&(c="0"+c),o+"-"+r+"-"+s+"T"+l+":"+c+":00Z"}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i}(),Os=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,[{key:"filterByOgc",value:function(t,o){var r=(new jt).formatProcessedOgcFilter(o,t.options.params.LAYERS);t.ol.updateParams({FILTER:r})}},{key:"setOgcWFSFiltersOptions",value:function(t){var o=t.options,r=new jt;o.ogcFilters.enabled&&o.ogcFilters.filters&&(o.ogcFilters.filters=r.checkIgoFiltersProperties(o.ogcFilters.filters,o.paramsWFS.fieldNameGeometry,new jo.Z({code:o.paramsWFS.srsName}),!0),o.ogcFilters.interfaceOgcFilters||(o.ogcFilters.interfaceOgcFilters=r.defineInterfaceFilterSequence(o.ogcFilters.filters,o.paramsWFS.fieldNameGeometry)))}},{key:"setOgcWMSFiltersOptions",value:function(t){var o=t.options,r=new jt;o.ogcFilters.enabled&&o.ogcFilters.filters?(o.ogcFilters.filters=r.checkIgoFiltersProperties(o.ogcFilters.filters,o.fieldNameGeometry,void 0,!0),o.ogcFilters.interfaceOgcFilters||(o.ogcFilters.interfaceOgcFilters=r.defineInterfaceFilterSequence(o.ogcFilters.filters,o.fieldNameGeometry)),this.filterByOgc(t,r.buildFilter(o.ogcFilters.filters,void 0,void 0,void 0,t.options)),o.filtered=!0):(o.ogcFilters.filters=void 0,o.ogcFilters.interfaceOgcFilters=[],o.filtered=!1)}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i}(),Ie=function(){return(i=Ie||(Ie={})).Predefined="Predefined",i.Polygon="Polygon",i.Point="Point",Ie;var i}(),It=function(){return(i=It||(It={})).Address="Address",i.Thematics="Thematics",It;var i}(),Hi=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.http=n,this.languageService=t,this.configService=o,this.baseUrl="https://geoegl.msp.gouv.qc.ca/apis/terrapi/",this.urlFilterList={AdmRegion:"regadmin",Arrond:"arrondissements",CircFed:"circ-fed",CircProv:"circ-prov",DirReg:"dir-reg",MRC:"mrc",Mun:"municipalites",RegTour:"tourisme",bornes:"bornes-sumi",hydro:"hydro",routes:"routes"},this.baseUrl=this.configService.getConfig("spatialFilter.url")||this.baseUrl}return(0,v.Z)(a,[{key:"getKeyByValue",value:function(t,o){return Object.keys(t).find(function(r){return t[r]===o})}},{key:"loadFilterList",value:function(t){if(t)return this.http.get(this.baseUrl+this.urlFilterList[t]).pipe((0,U.U)(function(r){return r.features.map(function(s){return s.meta={id:s.properties.code},s})}))}},{key:"loadThematicsList",value:function(){var t=this,r=[];return this.http.get(this.baseUrl+"types").pipe((0,U.U)(function(s){return s.forEach(function(l){if(l.startsWith("lieux")){var c={name:void 0,source:l},u=l.substring(6,l.length),p=u;if(u.includes(".")){var d=u.indexOf(".");p=u.substring(d+1,u.length),u=u.substring(0,d)}try{c.name=t.languageService.translate.instant("igo.geo.terrapi."+p)}catch(m){c.name=p.substring(0,1).toUpperCase()+p.substring(1,p.length-1)}try{c.group=t.languageService.translate.instant("igo.geo.spatialFilter.group."+u)}catch(m){c.group=u.substring(0,1).toUpperCase()+u.substring(1,p.length-1)}r.push(c)}else if(t.getKeyByValue(t.urlFilterList,l)){var g={name:void 0,source:l},f=t.getKeyByValue(t.urlFilterList,l);try{g.name=t.languageService.translate.instant("igo.geo.terrapi."+f)}catch(m){g.name=f.substring(0,1).toUpperCase()+f.substring(1,f.length-1)}g.source=l,r.push(g)}}),r}))}},{key:"loadFilterItem",value:function(t,o,r,s,l){var c=this;if(r){var p=this.baseUrl+this.urlFilterList[r];return o===It.Address?this.http.get(p+"/"+t.properties.code+"/adresses",{params:{geometry:"true",icon:"true",bufferInput:l.toString(),simplified:"100"}}).pipe((0,U.U)(function(y){return y.features.map(function(_){return _.meta={id:_.properties.code,title:c.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:_.icon},_})})):this.http.get(p+"/"+t.properties.code+"/"+s.source,{params:{geometry:"true",icon:"true",bufferInput:l.toString(),simplified:"100"}}).pipe((0,U.U)(function(y){return y.features.map(function(_){return _.meta={id:_.properties.code,title:s.name,icon:_.icon},_})}))}var g=this.baseUrl+"locate";return o===It.Address?this.http.post(g+"?type=adresses",{geometry:"true",icon:"true",loc:JSON.stringify(t),bufferInput:l.toString(),simplified:"100"}).pipe((0,U.U)(function(y){return y.features.map(function(_){return _.meta={id:_.properties.code,title:c.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:_.icon},_})})):this.http.post(g+"?type="+s.source,{geometry:"true",icon:"true",loc:JSON.stringify(t),bufferInput:l.toString(),simplified:"100"}).pipe((0,U.U)(function(y){return y.features.map(function(_){return _.meta={id:_.properties.code,title:s.name,icon:_.icon},_})}))}},{key:"loadItemById",value:function(t,o){var r=this.urlFilterList[o],s="/"+t.properties.code;if(r&&s)return this.http.get(this.baseUrl+r+s,{params:{geometry:"true"}}).pipe((0,U.U)(function(l){return l.meta={id:l.properties.code,alias:l.properties.nom,title:l.properties.nom},l}))}},{key:"loadBufferGeometry",value:function(t,o,r,s){if(o!==Ie.Predefined)return this.http.post(this.baseUrl+"geospatial/buffer?",{buffer:r,loc:JSON.stringify(t)}).pipe((0,U.U)(function(u){return u}));var l=this.urlFilterList[s],c="/"+t.properties.code;return l&&c?this.http.get(this.baseUrl+l+c,{params:{geometry:"100",bufferOutput:r.toString()}}).pipe((0,U.U)(function(u){return u.meta={id:u.properties.code,alias:u.properties.nom,title:u.properties.nom},u})):void 0}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG($),e.LFG(j))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),gu=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.messageService=n,this.languageService=t}return(0,v.Z)(a,[{key:"open",value:function(t){var o=this.languageService.translate,r=o.instant("igo.geo.download.title");this.messageService.success(o.instant("igo.geo.download.start"),r);var s=t.dataSource.options;if(Object.keys(s.download).length>0)if(s.download.dynamicUrl&&void 0===s.download.url){var l,c=new jo.Z({code:t.map.projection}),u=t.dataSource.options.paramsWFS;u&&Object.keys(u).length>0?(c=u.srsName?new jo.Z({code:u.srsName}):c,l=t.dataSource.options.paramsWFS):l=t.dataSource.options.params;var m,p=re.$A(t.map.viewController.getExtent(),new jo.Z({code:t.map.projection}),c),d=void 0===l.outputFormatDownload?void 0===l.outputFormat?"":"outputformat="+l.outputFormat:"outputformat="+l.outputFormatDownload,g=s.download.dynamicUrl.replace(/&?outputformat=[^&]*/gi,"").replace(/&?filter=[^&]*/gi,"").replace(/&?bbox=[^&]*/gi,""),f=t.dataSource.options.ogcFilters;m=(m=(new jt).handleOgcFiltersAppliedValue(t.dataSource.options,f.geometryName,p,c))?"filter="+encodeURIComponent(m):(new jt).buildFilter(void 0,p,c,f.geometryName),window.open("".concat(g,"&").concat(m,"&").concat(d),"_blank")}else s.download&&window.open(s.download.url,"_blank")}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(Ae),e.LFG($))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function cb(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.openDownload(r.layer))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",2),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.download.action"))("color",t.color)}}var ub=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.downloadService=n,this._color="primary"}return(0,v.Z)(a,[{key:"layer",get:function(){return this._layer},set:function(t){this._layer=t}},{key:"color",get:function(){return this._color},set:function(t){this._color=t}},{key:"openDownload",value:function(t){this.downloadService.open(t)}},{key:"options",get:function(){if(this.layer)return this.layer.dataSource.options}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(gu))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-download-button"]],inputs:{layer:"layer",color:"color"},decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","download"]],template:function(n,t){1&n&&e.YNc(0,cb,3,4,"button",0),2&n&&e.Q6J("ngIf",t.options&&t.options.download&&(t.options.download.dynamicUrl||t.options.download.url))},dependencies:[C.O5,O.Hw,I.lW,J.gM,E.X$],changeDetection:0}),i}(),Yr=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,O.Ps,I.ot,J.AV,he]}),i}(),fu=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[S.u5,S.UX,C.ez,I.ot,ot.vV,Mt.t,B.lN,O.Ps,bt.g,J.AV,B.lN,le.c,X.ie,ke.LD,ht.rP,z.Is,he,$o,is.e4,Tt.b2,gi.PW]}),i}(),Ds=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,O.Ps,he,Jo,Ua]}),i}(),db=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,Ci,Ci]}),i}(),Rn=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,Ds,db]}),i}(),hu=function(){function i(a){(0,h.Z)(this,i),this.options=a,this.start$=new $e.x,this.end$=new $e.x,this.changes$=new $e.x,this.olModifyInteractionIsActive=!1,this.olTranslateInteractionIsActive=!1,this.olDrawInteractionIsActive=!1,this.removedOlInteractions=[],this.modify=!0,this.translate=!0,void 0!==a.modify&&(this.modify=a.modify),void 0!==a.translate&&(this.translate=a.translate),this.olOverlayLayer=void 0!==a.layer?a.layer:this.createOlInnerOverlayLayer(),this.olLinearRingsLayer=this.createOlLinearRingsLayer()}return(0,v.Z)(i,[{key:"active",get:function(){return void 0!==this.olMap}},{key:"olOverlaySource",get:function(){return this.olOverlayLayer.getSource()}},{key:"olLinearRingsSource",get:function(){return this.olLinearRingsLayer.getSource()}},{key:"setOlMap",value:function(n){if(void 0===n)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlModifyInteraction(),this.removeOlTranslateInteraction(),this.removeOlDrawInteraction(),void(this.olMap=n);this.olMap=n,this.addOlInnerOverlayLayer(),!0===this.modify&&this.addOlDrawInteraction(),!0===this.translate&&(this.addOlTranslateInteraction(),this.activateTranslateInteraction()),!0===this.modify&&(this.addOlModifyInteraction(),this.activateModifyInteraction())}},{key:"getSource",value:function(){return this.olOverlaySource}},{key:"setOlGeometry",value:function(n){var t=new nt.Z({geometry:n});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(t)}},{key:"createOlInnerOverlayLayer",value:function(){return new zn.Z({source:this.options.source?this.options.source:new nn.Z,style:this.options.layerStyle,zIndex:500})}},{key:"addOlInnerOverlayLayer",value:function(){void 0===this.options.layer&&this.olMap.addLayer(this.olOverlayLayer)}},{key:"removeOlInnerOverlayLayer",value:function(){void 0===this.options.layer&&void 0!==this.olMap&&this.olMap.removeLayer(this.olOverlayLayer)}},{key:"clearOlInnerOverlaySource",value:function(){void 0===this.options.layer&&void 0===this.options.source&&this.olOverlaySource.clear(!0)}},{key:"createOlLinearRingsLayer",value:function(){return new zn.Z({source:new nn.Z,style:au(),zIndex:500})}},{key:"addOlLinearRingsLayer",value:function(){this.olMap.addLayer(this.olLinearRingsLayer)}},{key:"removeOlLinearRingsLayer",value:function(){this.olMap.removeLayer(this.olLinearRingsLayer)}},{key:"clearOlLinearRingsSource",value:function(){this.olLinearRingsSource.clear(!0)}},{key:"addOlModifyInteraction",value:function(){var n=new as.Z({source:this.olOverlaySource,style:this.options.drawStyle});this.olModifyInteraction=n}},{key:"removeOlModifyInteraction",value:function(){void 0!==this.olModifyInteraction&&(this.deactivateModifyInteraction(),this.olModifyInteraction=void 0)}},{key:"activateModifyInteraction",value:function(){var n=this;!0!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!0,this.onModifyStartKey=this.olModifyInteraction.on("modifystart",function(t){return n.onModifyStart(t)}),this.onModifyEndKey=this.olModifyInteraction.on("modifyend",function(t){return n.onModifyEnd(t)}),this.olMap.addInteraction(this.olModifyInteraction))}},{key:"deactivateModifyInteraction",value:function(){!1!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!1,(0,st.B)([this.onModifyStartKey,this.onModifyEndKey,this.onModifyKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olModifyInteraction))}},{key:"onModifyStart",value:function(n){var t=this,o=n.features.item(0).getGeometry();this.start$.next(o),this.onModifyKey=o.on("change",function(r){t.mousePosition=Is(r),t.changes$.next(r.target)}),this.subscribeToKeyDown()}},{key:"onModifyEnd",value:function(n){(0,st.B)(this.onModifyKey),this.end$.next(n.features.item(0).getGeometry()),this.unsubscribeToKeyDown()}},{key:"subscribeToKeyDown",value:function(){var n=this;this.keyDown$$=(0,In.R)(document,"keydown").subscribe(function(t){" "!==t.key||n.olMap.getView().animate({center:n.mousePosition,duration:0})})}},{key:"unsubscribeToKeyDown",value:function(){void 0!==this.keyDown$$&&this.keyDown$$.unsubscribe()}},{key:"addOlTranslateInteraction",value:function(){var n=new Kl.Z({layers:[this.olOverlayLayer]});this.olTranslateInteraction=n}},{key:"removeOlTranslateInteraction",value:function(){void 0!==this.olTranslateInteraction&&(this.deactivateTranslateInteraction(),this.olTranslateInteraction=void 0)}},{key:"activateTranslateInteraction",value:function(){var n=this;!0!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!0,this.onTranslateStartKey=this.olTranslateInteraction.on("translatestart",function(t){return n.onTranslateStart(t)}),this.onTranslateEndKey=this.olTranslateInteraction.on("translateend",function(t){return n.onTranslateEnd(t)}),this.olMap.addInteraction(this.olTranslateInteraction))}},{key:"deactivateTranslateInteraction",value:function(){!1!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!1,(0,st.B)([this.onTranslateStartKey,this.onTranslateEndKey,this.onTranslateKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olTranslateInteraction))}},{key:"onTranslateStart",value:function(n){var t=n.features.item(0).getGeometry();this.start$.next(t),this.onTranslateKey=t.on("change",function(o){})}},{key:"onTranslateEnd",value:function(n){(0,st.B)(this.onTranslateKey),this.end$.next(n.features.item(0).getGeometry())}},{key:"addOlDrawInteraction",value:function(){var n=this,t=new Ir.ZP({type:"Polygon",source:this.olLinearRingsSource,stopClick:!0,style:au(),condition:function(r){return(n.olOuterGeometry||n.getOlGeometry()).intersectsCoordinate(r.coordinate)}});this.olDrawInteraction=t,this.subscribeToDrawKeyDown()}},{key:"subscribeToDrawKeyDown",value:function(){var n=this;this.drawKeyDown$$=(0,In.R)(document,"keydown").subscribe(function(t){if("Control"===t.key){n.unsubscribeToDrawKeyDown();var o=n.getOlGeometry();!o||!(o instanceof Tn.ZP)||(n.subscribeToDrawKeyUp(),n.deactivateModifyInteraction(),n.deactivateTranslateInteraction(),n.activateDrawInteraction())}})}},{key:"subscribeToDrawKeyUp",value:function(){var n=this;this.drawKeyUp$$=(0,In.R)(document,"keyup").subscribe(function(t){"Control"===t.key&&(n.unsubscribeToDrawKeyUp(),n.unsubscribeToKeyDown(),n.deactivateDrawInteraction(),n.activateModifyInteraction(),!0===n.translate&&n.activateTranslateInteraction(),n.subscribeToDrawKeyDown(),n.olOuterGeometry=void 0,n.clearOlLinearRingsSource(),n.end$.next(n.getOlGeometry()))})}},{key:"unsubscribeToDrawKeyDown",value:function(){void 0!==this.drawKeyDown$$&&this.drawKeyDown$$.unsubscribe()}},{key:"unsubscribeToDrawKeyUp",value:function(){void 0!==this.drawKeyUp$$&&this.drawKeyUp$$.unsubscribe()}},{key:"removeOlDrawInteraction",value:function(){void 0!==this.olDrawInteraction&&(this.unsubscribeToKeyDown(),this.unsubscribeToDrawKeyUp(),this.unsubscribeToDrawKeyDown(),this.deactivateDrawInteraction(),this.clearOlLinearRingsSource(),this.olDrawInteraction=void 0)}},{key:"activateDrawInteraction",value:function(){var n=this;!0!==this.olDrawInteractionIsActive&&(this.clearOlLinearRingsSource(),this.addOlLinearRingsLayer(),this.olMap.getInteractions().forEach(function(t){t instanceof sc.Z&&(n.olMap.removeInteraction(t),n.removedOlInteractions.push(t))}),this.olDrawInteractionIsActive=!0,this.onDrawStartKey=this.olDrawInteraction.on("drawstart",function(t){return n.onDrawStart(t)}),this.onDrawEndKey=this.olDrawInteraction.on("drawend",function(t){return n.onDrawEnd(t)}),this.olMap.addInteraction(this.olDrawInteraction))}},{key:"deactivateDrawInteraction",value:function(){var n=this;!1!==this.olDrawInteractionIsActive&&(this.removeOlLinearRingsLayer(),this.removedOlInteractions.forEach(function(t){n.olMap.addInteraction(t)}),this.removedOlInteractions=[],this.olDrawInteractionIsActive=!1,(0,st.B)([this.onDrawStartKey,this.onDrawEndKey,this.onDrawKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olDrawInteraction))}},{key:"onDrawStart",value:function(n){var t=this,o=n.feature.getGeometry();this.olOuterGeometry=this.getOlGeometry().clone();var r=o.getLinearRing().getCoordinates();this.addLinearRingToOlGeometry(r),this.start$.next(this.getOlGeometry()),this.onDrawKey=o.on("change",function(s){t.mousePosition=Is(s);var c=s.target.getLinearRing(0).getCoordinates();t.updateLinearRingOfOlGeometry(c),t.changes$.next(t.getOlGeometry())}),this.subscribeToKeyDown()}},{key:"onDrawEnd",value:function(n){(0,st.B)(this.onDrawKey),this.olOuterGeometry=void 0;var t=n.feature.getGeometry().getLinearRing().getCoordinates();this.updateLinearRingOfOlGeometry(t),this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()),this.unsubscribeToKeyDown()}},{key:"addLinearRingToOlGeometry",value:function(n){!function O0(i,a){i.appendLinearRing(a)}(this.getOlGeometry(),new yv.Z(n))}},{key:"updateLinearRingOfOlGeometry",value:function(n){var t=this.getOlGeometry(),r=t.getLinearRings().slice(0,-1).map(function(s){return s.getCoordinates()});r.push(n),t.setCoordinates(r)}},{key:"getOlGeometry",value:function(){var n=this.olOverlaySource.getFeatures();return n.length>0?n[0].getGeometry():void 0}}]),i}(),Vi="Layer";function gb(i,a){if(1&i&&(e.TgZ(0,"table",2)(1,"thead")(2,"tr")(3,"th",3),e._uU(4),e.ALo(5,"translate"),e.qZA()()(),e.TgZ(6,"tbody")(7,"tr")(8,"td"),e._uU(9),e.ALo(10,"measureFormat"),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.ALo(13,"translate"),e.qZA()(),e.TgZ(14,"tr")(15,"td"),e._uU(16),e.ALo(17,"measureFormat"),e.qZA(),e.TgZ(18,"td"),e._uU(19),e.ALo(20,"translate"),e.qZA()(),e.TgZ(21,"tr")(22,"td"),e._uU(23),e.ALo(24,"measureFormat"),e.qZA(),e.TgZ(25,"td"),e._uU(26),e.ALo(27,"translate"),e.qZA()(),e.TgZ(28,"tr")(29,"td"),e._uU(30),e.ALo(31,"measureFormat"),e.qZA(),e.TgZ(32,"td"),e._uU(33),e.ALo(34,"translate"),e.qZA()()()()),2&i){var n=e.oxw();e.xp6(4),e.Oqu(e.lcZ(5,9,"igo.geo.measure.dialog.length.title")),e.xp6(5),e.Oqu(e.xi3(10,11,n.data.length,n.measureLengthUnit.Meters)),e.xp6(3),e.Oqu(e.lcZ(13,14,"igo.geo.measure.dialog.lengthInMeters")),e.xp6(4),e.Oqu(e.xi3(17,16,n.data.length,n.measureLengthUnit.Kilometers)),e.xp6(3),e.Oqu(e.lcZ(20,19,"igo.geo.measure.dialog.lengthInKilometers")),e.xp6(4),e.Oqu(e.xi3(24,21,n.data.length,n.measureLengthUnit.Miles)),e.xp6(3),e.Oqu(e.lcZ(27,24,"igo.geo.measure.dialog.lengthInMiles")),e.xp6(4),e.Oqu(e.xi3(31,26,n.data.length,n.measureLengthUnit.Feet)),e.xp6(3),e.Oqu(e.lcZ(34,29,"igo.geo.measure.dialog.lengthInFeet"))}}function fb(i,a){if(1&i&&(e.TgZ(0,"table",2)(1,"thead")(2,"tr")(3,"th",3),e._uU(4),e.ALo(5,"translate"),e.qZA()()(),e.TgZ(6,"tbody")(7,"tr")(8,"td"),e._uU(9),e.ALo(10,"measureFormat"),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.ALo(13,"translate"),e.qZA()(),e.TgZ(14,"tr")(15,"td"),e._uU(16),e.ALo(17,"measureFormat"),e.qZA(),e.TgZ(18,"td"),e._uU(19),e.ALo(20,"translate"),e.qZA()(),e.TgZ(21,"tr")(22,"td"),e._uU(23),e.ALo(24,"measureFormat"),e.qZA(),e.TgZ(25,"td"),e._uU(26),e.ALo(27,"translate"),e.qZA()(),e.TgZ(28,"tr")(29,"td"),e._uU(30),e.ALo(31,"measureFormat"),e.qZA(),e.TgZ(32,"td"),e._uU(33),e.ALo(34,"translate"),e.qZA()(),e.TgZ(35,"tr")(36,"td"),e._uU(37),e.ALo(38,"measureFormat"),e.qZA(),e.TgZ(39,"td"),e._uU(40),e.ALo(41,"translate"),e.qZA()(),e.TgZ(42,"tr")(43,"td"),e._uU(44),e.ALo(45,"translate"),e.qZA(),e.TgZ(46,"td"),e._uU(47),e.ALo(48,"measureFormat"),e.qZA()()()()),2&i){var n=e.oxw();e.xp6(4),e.Oqu(e.lcZ(5,13,"igo.geo.measure.dialog.area.title")),e.xp6(5),e.Oqu(e.xi3(10,15,n.data.area,n.measureAreaUnit.SquareMeters)),e.xp6(3),e.Oqu(e.lcZ(13,18,"igo.geo.measure.dialog.areaInSquareMeters")),e.xp6(4),e.Oqu(e.xi3(17,20,n.data.area,n.measureAreaUnit.SquareKilometers)),e.xp6(3),e.Oqu(e.lcZ(20,23,"igo.geo.measure.dialog.areaInSquareKilometers")),e.xp6(4),e.Oqu(e.xi3(24,25,n.data.area,n.measureAreaUnit.SquareMiles)),e.xp6(3),e.Oqu(e.lcZ(27,28,"igo.geo.measure.dialog.areaInSquareMiles")),e.xp6(4),e.Oqu(e.xi3(31,30,n.data.area,n.measureAreaUnit.Acres)),e.xp6(3),e.Oqu(e.lcZ(34,33,"igo.geo.measure.dialog.areaInAcres")),e.xp6(4),e.Oqu(e.xi3(38,35,n.data.area,n.measureAreaUnit.Hectares)),e.xp6(3),e.Oqu(e.lcZ(41,38,"igo.geo.measure.dialog.areaInHectares")),e.xp6(4),e.Oqu(e.lcZ(45,40,"igo.geo.measure.dialog.perimeterInMeters")),e.xp6(3),e.Oqu(e.xi3(48,42,n.data.perimeter,n.measureLengthUnit.Meters))}}var vu=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.dialogRef=n,this.data=t,this.measureAreaUnit=ut,this.measureLengthUnit=ye}return(0,v.Z)(a,[{key:"onNoClick",value:function(){this.dialogRef.close()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(z.so),e.Y36(z.WI))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-measurer-dialog"]],decls:5,vars:5,consts:[["mat-dialog-title",""],["class","mat-typography",4,"ngIf"],[1,"mat-typography"],["colspan","2"]],template:function(n,t){1&n&&(e.TgZ(0,"h3",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.YNc(3,gb,35,31,"table",1),e.YNc(4,fb,49,45,"table",1)),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,3,"igo.geo.measure.dialog.title")),e.xp6(2),e.Q6J("ngIf",t.data.length>0),e.xp6(1),e.Q6J("ngIf",t.data.area>0))},styles:["[_nghost-%COMP%]{font-family:Roboto,Helvetica Neue,sans-serif}h3[_ngcontent-%COMP%]{text-align:center;margin:0}table[_ngcontent-%COMP%]{width:100%;padding:10px}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{padding-left:10px}"]}),i}(),mb=["table"];function hb(i,a){1&i&&e._UZ(0,"mat-divider")}function vb(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-slide-toggle",7),e.NdJ("change",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.onToggleDisplayLines(r.checked))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("checked",t.displayLines)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.measure.toggleDisplayLines")," ")}}function yb(i,a){1&i&&e._UZ(0,"mat-divider")}function _b(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-slide-toggle",7),e.NdJ("change",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.onToggleDisplayDistance(r.checked))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("checked",t.displayDistance)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.measure.toggleDisplayDistance")," ")}}function bb(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-slide-toggle",7),e.NdJ("change",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.onToggleDisplayAreas(r.checked))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("checked",t.displayAreas)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.measure.toggleDisplayAreas")," ")}}function Cb(i,a){1&i&&e._UZ(0,"mat-divider")}function Sb(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-measurer-item",14),e.NdJ("measureUnitChange",function(s){e.CHM(n);var l=e.oxw(2);return e.KtG(l.onLengthUnitChange(s))}),e.ALo(1,"translate"),e.qZA()}if(2&i){var t=e.oxw().ngIf,o=e.oxw();e.Q6J("measureType",o.measureType.Length)("measureUnit",o.measureLengthUnit.Meters)("measure",t.length)("auto",o.measureUnitsAuto)("placeholder",e.lcZ(1,5,o.activeMeasureType===o.measureType.Area?"igo.geo.measure.perimeter":"igo.geo.measure.length"))}}function wb(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-measurer-item",14),e.NdJ("measureUnitChange",function(s){e.CHM(n);var l=e.oxw(2);return e.KtG(l.onAreaUnitChange(s))}),e.ALo(1,"translate"),e.qZA()}if(2&i){var t=e.oxw().ngIf,o=e.oxw();e.Q6J("measureType",o.measureType.Area)("measureUnit",o.measureAreaUnit.SquareMeters)("measure",t.area)("auto",o.measureUnitsAuto)("placeholder",e.lcZ(1,5,"igo.geo.measure.area"))}}function Tb(i,a){if(1&i&&(e.ynx(0),e.YNc(1,Sb,2,7,"igo-measurer-item",13),e.YNc(2,wb,2,7,"igo-measurer-item",13),e.BQk()),2&i){var n=e.oxw();e.xp6(1),e.Q6J("ngIf",n.activeMeasureType===n.measureType.Length||n.activeMeasureType===n.measureType.Area),e.xp6(1),e.Q6J("ngIf",n.activeMeasureType===n.measureType.Area)}}function xb(i,a){1&i&&e._UZ(0,"mat-divider")}function kb(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.onCalculateClick())}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",16),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.measure.actionbar.calculate.tooltip"))("disabled",0===e.lcZ(2,4,t.selectedFeatures$).length)}}function Mb(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.onDeleteClick())}),e.ALo(1,"translate"),e.ALo(2,"async"),e._UZ(3,"mat-icon",18),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.measure.actionbar.delete.tooltip"))("disabled",0===e.lcZ(2,4,t.selectedFeatures$).length)}}var Ps=function(){var i=function(){function a(n,t,o){var r=this;(0,h.Z)(this,a),this.languageService=n,this.dialog=t,this.storageService=o,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,columns:[{name:"length",title:this.languageService.translate.instant("igo.geo.measure.lengthHeader"),valueAccessor:function(l){var c=r.activeLengthUnit;return Yi(Qi(l.properties.measure.length,c),{decimal:1,unit:c,unitAbbr:!1,locale:"fr"})}},{name:"area",title:this.languageService.translate.instant("igo.geo.measure.areaHeader"),valueAccessor:function(l){var c=r.activeAreaUnit,u=Qr(l.properties.measure.area,c);return u?Yi(u,{decimal:1,unit:c,unitAbbr:!1,locale:"fr"}):""}}]},this.subscriptions$$=[],this.measureType=zt,this.measureAreaUnit=ut,this.measureLengthUnit=ye,this.measureUnitsAuto=!1,this.displayDistance=!0,this.displayLines=!0,this.displayAreas=!0,this.hasLine$=new x.X(!1),this.hasArea$=new x.X(!1),this.measure$=new x.X({}),this.selectedFeatures$=new x.X([]),this.showTooltips=!0,this.drawControlIsDisabled=!0,this.activeLengthUnit=ye.Meters,this.activeAreaUnit=ut.SquareMeters,this.olDrawSource=new nn.Z,this.minSegmentLength=10}return(0,v.Z)(a,[{key:"activeMeasureType",get:function(){return this._activeMeasureType},set:function(t){this.setActiveMeasureType(t)}},{key:"drawControlIsActive",get:function(){return void 0!==this.activeDrawControl}},{key:"projection",get:function(){return this.map.ol.getView().getProjection().getCode()}},{key:"ngOnInit",value:function(){this.initStore(),this.createDrawLineControl(),this.createDrawPolygonControl(),this.createModifyControl(),this.toggleDrawControl(),this.updateTooltipsOfOlSource(this.store.source.ol),this.checkDistanceAreaToggle(),this.setActiveMeasureType(zt.Length)}},{key:"ngOnDestroy",value:function(){this.setActiveMeasureType(void 0),this.deactivateModifyControl(),this.freezeStore(),this.subscriptions$$.map(function(t){return t.unsubscribe()})}},{key:"onMeasureTypeChange",value:function(t){this.activeMeasureType=t}},{key:"onToggleDrawControl",value:function(t){!0===t?this.toggleDrawControl():this.deactivateDrawControl()}},{key:"onToggleMeasureUnitsAuto",value:function(t){this.measureUnitsAuto=t}},{key:"onToggleDisplayDistance",value:function(t){this.displayDistance=t,this.onDisplayDistance(),this.storageService.set("distanceToggle",!!t,qe.SESSION)}},{key:"onToggleDisplayLines",value:function(t){this.displayLines=t,this.onDisplayLines(),this.storageService.set("linesToggle",!!t,qe.SESSION)}},{key:"onToggleDisplayAreas",value:function(t){this.displayAreas=t,this.onDisplayAreas(),this.storageService.set("areasToggle",!!t,qe.SESSION)}},{key:"checkDistanceAreaToggle",value:function(){!1===this.storageService.get("distanceToggle")&&(this.displayDistance=!1),!1===this.storageService.get("linesToggle")&&(this.displayLines=!1),!1===this.storageService.get("areasToggle")&&(this.displayAreas=!1)}},{key:"onDisplayDistance",value:function(){this.displayDistance?Array.from(document.getElementsByClassName("igo-map-tooltip-measure-polygone-segments")).map(function(t){return t.classList.remove("igo-map-tooltip-hidden")}):Array.from(document.getElementsByClassName("igo-map-tooltip-measure-polygone-segments")).map(function(t){return t.classList.add("igo-map-tooltip-hidden")})}},{key:"onDisplayLines",value:function(){this.displayLines?Array.from(document.getElementsByClassName("igo-map-tooltip-measure-line-segments")).map(function(t){return t.classList.remove("igo-map-tooltip-hidden")}):Array.from(document.getElementsByClassName("igo-map-tooltip-measure-line-segments")).map(function(t){return t.classList.add("igo-map-tooltip-hidden")})}},{key:"onDisplayAreas",value:function(){this.displayAreas?Array.from(document.getElementsByClassName("igo-map-tooltip-measure-area")).map(function(t){return t.classList.remove("igo-map-tooltip-hidden")}):Array.from(document.getElementsByClassName("igo-map-tooltip-measure-area")).map(function(t){return t.classList.add("igo-map-tooltip-hidden")})}},{key:"onLengthUnitChange",value:function(t){this.activeLengthUnit=t,this.table.refresh(),this.updateTooltipsOfOlSource(this.store.source.ol),void 0!==this.activeOlGeometry&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)}},{key:"onAreaUnitChange",value:function(t){this.activeAreaUnit=t,this.table.refresh(),this.updateTooltipsOfOlSource(this.store.source.ol),void 0!==this.activeOlGeometry&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)}},{key:"onCalculateClick",value:function(){var t=this.selectedFeatures$.value,o=t.reduce(function(l,c){return l+c.properties.measure.area||0},0),r=t.reduce(function(l,c){return"Polygon"===c.geometry.type?l:l+c.properties.measure.length||0},0),s=t.reduce(function(l,c){return"LineString"===c.geometry.type?l:l+c.properties.measure.length||0},0);this.openDialog({area:o,length:r,perimeter:s})}},{key:"onDeleteClick",value:function(){var t=this;this.store.deleteMany(this.selectedFeatures$.value),this.selectedFeatures$.value.forEach(function(o){t.olDrawSource.getFeatures().forEach(function(r){var s=r.getGeometry();o.properties.id===s.ol_uid&&t.olDrawSource.removeFeature(r)})})}},{key:"onModifyClick",value:function(){if(1===this.selectedFeatures$.value.length)if(!0===this.modifyControl.active)this.deactivateModifyControl(),this.toggleDrawControl();else{var t=this.selectedFeatures$.value[0],r=this.store.layer.ol.getSource().getFeatures().find(function(l){return l.get("id")===t.properties.id});if(void 0!==r){this.deactivateDrawControl(),this.activateModifyControl();var s=r.getGeometry();this.clearTooltipsOfOlGeometry(s),this.modifyControl.setOlGeometry(s)}}}},{key:"openDialog",value:function(t){this.dialog.open(vu,{data:t})}},{key:"initStore",value:function(){var t=this,o=this.store,r=new Je({title:this.languageService.translate.instant("igo.geo.measure.layerTitle"),isIgoInternalLayer:!0,id:"igo-measures-".concat(Ye()),zIndex:200,source:new Re,style:new ee.ZP({stroke:new K.Z({color:"#ffcc33",width:2}),fill:new te.Z({color:"rgba(255, 255, 255, 0.2)"})}),showInLayerList:!0,exportable:!0,browsable:!1,workspace:{enabled:!1}});xo(o,r),o.layer.visible=!0,r.visible$.subscribe(function(s){s?Array.from(document.getElementsByClassName("igo-map-tooltip-measure")).map(function(l){return l.classList.remove("igo-map-tooltip-measure-by-display")}):Array.from(document.getElementsByClassName("igo-map-tooltip-measure")).map(function(l){return l.classList.add("igo-map-tooltip-measure-by-display")})}),Ei(o),Zc(o,new Bt({map:this.map,many:!0})),this.onFeatureAddedKey=o.source.ol.on("addfeature",function(s){var l=s.feature,c=l.getGeometry();t.updateMeasureOfOlGeometry(c,l.get("measure")),t.onDisplayDistance()}),this.onFeatureRemovedKey=o.source.ol.on("removefeature",function(s){var l=s.feature.getGeometry();t.clearTooltipsOfOlGeometry(l)}),this.selectedFeatures$$=o.stateView.manyBy$(function(s){return!0===s.state.selected}).pipe((0,uo.T)(1)).subscribe(function(s){!0===t.modifyControl.active&&t.deactivateModifyControl(),t.selectedFeatures$.next(s.map(function(l){return l.entity}))}),this.subscriptions$$.push(this.store.entities$.subscribe(function(s){s.find(function(l){return"Polygon"===l.geometry.type})?t.hasArea$.next(!0):t.hasArea$.next(!1),s.find(function(l){return"LineString"===l.geometry.type})?t.hasLine$.next(!0):t.hasLine$.next(!1)})),this.subscriptions$$.push(this.store.count$.subscribe(function(s){t.store.layer.options.showInLayerList=s>=1}))}},{key:"freezeStore",value:function(){var t=this.store;this.selectedFeatures$$.unsubscribe(),(0,st.B)(this.onFeatureAddedKey),(0,st.B)(this.onFeatureRemovedKey),t.deactivateStrategyOfType(an),t.deactivateStrategyOfType(Bt)}},{key:"createDrawLineControl",value:function(){this.drawLineControl=new ji({geometryType:"LineString",drawingLayerSource:this.olDrawSource,interactionStyle:ks(),drawingLayerStyle:new ee.ZP({})})}},{key:"createDrawPolygonControl",value:function(){this.drawPolygonControl=new ji({geometryType:"Polygon",drawingLayerSource:this.olDrawSource,interactionStyle:ks(),drawingLayerStyle:new ee.ZP({})})}},{key:"createModifyControl",value:function(){this.modifyControl=new hu({source:this.olDrawSource,drawStyle:ks(),layerStyle:new ee.ZP({})})}},{key:"toggleDrawControl",value:function(){this.deactivateDrawControl(),this.activeMeasureType===zt.Length?this.activateDrawControl(this.drawLineControl):this.activeMeasureType===zt.Area&&this.activateDrawControl(this.drawPolygonControl)}},{key:"activateDrawControl",value:function(t){var o=this;this.drawControlIsDisabled=!1,this.activeDrawControl=t,this.drawStart$$=t.start$.subscribe(function(r){return o.onDrawStart(r)}),this.drawEnd$$=t.end$.subscribe(function(r){return o.onDrawEnd(r)}),this.drawChanges$$=t.changes$.subscribe(function(r){return o.onDrawChanges(r)}),this.drawChanges$$=t.abort$.subscribe(function(r){o.clearTooltipsOfOlGeometry(r),o.clearMeasures()}),t.setOlMap(this.map.ol,!1)}},{key:"deactivateDrawControl",value:function(){void 0!==this.activeDrawControl&&(this.olDrawSource.clear(),void 0!==this.drawStart$$&&this.drawStart$$.unsubscribe(),void 0!==this.drawEnd$$&&this.drawEnd$$.unsubscribe(),void 0!==this.drawChanges$$&&this.drawChanges$$.unsubscribe(),this.clearTooltipsOfOlSource(this.olDrawSource),void 0!==this.activeOlGeometry&&this.clearTooltipsOfOlGeometry(this.activeOlGeometry),this.activeDrawControl.setOlMap(void 0),this.activeDrawControl=void 0,this.activeOlGeometry=void 0)}},{key:"setActiveMeasureType",value:function(t){this._activeMeasureType=t,this.clearMeasures(),this.toggleDrawControl()}},{key:"onDrawStart",value:function(t){this.activeOlGeometry=t}},{key:"onDrawEnd",value:function(t){this.activeOlGeometry=void 0,this.finalizeMeasureOfOlGeometry(t),this.addFeatureToStore(t),this.clearTooltipsOfOlGeometry(t),this.olDrawSource.clear(!0)}},{key:"onDrawChanges",value:function(t){var o=Fs(t,this.projection);this.updateMeasureOfOlGeometry(t,Object.assign({},o,{area:void 0})),this.measure$.next(o)}},{key:"activateModifyControl",value:function(){var t=this,o=this.store.getStrategyOfType(Bt);o.deactivate(),o.clear(),this.modifyStart$$=this.modifyControl.start$.subscribe(function(r){return t.onModifyStart(r)}),this.modifyEnd$$=this.modifyControl.end$.subscribe(function(r){return t.onModifyEnd(r)}),this.modifyChanges$$=this.modifyControl.changes$.subscribe(function(r){return t.onModifyChanges(r)}),this.modifyControl.setOlMap(this.map.ol)}},{key:"deactivateModifyControl",value:function(){void 0!==this.modifyStart$$&&this.modifyStart$$.unsubscribe(),void 0!==this.modifyEnd$$&&this.modifyEnd$$.unsubscribe(),void 0!==this.modifyChanges$$&&this.modifyChanges$$.unsubscribe(),void 0!==this.activeOlGeometry&&(1===this.selectedFeatures$.value.length&&this.addFeatureToStore(this.activeOlGeometry,this.selectedFeatures$.value[0]),this.finalizeMeasureOfOlGeometry(this.activeOlGeometry)),this.olDrawSource.clear(),this.store.activateStrategyOfType(Bt),this.activeOlGeometry=void 0,this.modifyControl.setOlMap(void 0)}},{key:"onModifyStart",value:function(t){this.onDrawStart(t)}},{key:"onModifyChanges",value:function(t){this.onDrawChanges(t)}},{key:"onModifyEnd",value:function(t){this.finalizeMeasureOfOlGeometry(t)}},{key:"finalizeMeasureOfOlGeometry",value:function(t){var o=Fs(t,this.projection);this.updateMeasureOfOlGeometry(t,o)}},{key:"updateMeasureOfOlGeometry",value:function(t,o){t.setProperties({_measure:o},!0),this.updateTooltipsOfOlGeometry(t)}},{key:"clearMeasures",value:function(){this.measure$.next({})}},{key:"addFeatureToStore",value:function(t,o){var r=o?o.properties.id:t.ol_uid,s=this.map.ol.getView().getProjection(),l=(new Ee.Z).writeGeometryObject(t,{featureProjection:s,dataProjection:s});this.store.update({type:be,geometry:l,projection:s.getCode(),properties:{id:r,measure:t.get("_measure")},meta:{id:r}})}},{key:"updateTooltipsOfOlGeometry",value:function(t){var o=t.get("_measure"),r=o.lengths,s=o.area,l=function u0(i){var a=Zs(i),n="";return i instanceof dn.Z?n="line-":i instanceof Tn.ZP&&(n="polygone-"),a.map(function(o){var r=o.get("_tooltip");return void 0===r?r=eu(o,!1,n):r.setPosition(o.getFlatCoordinates()),r})}(t);if(r.length===l.length)for(var c=0;c<l.length;c++){var u=r[c];void 0!==u&&this.updateOlTooltip(l[c],Qi(u,this.activeLengthUnit),this.activeLengthUnit,zt.Length)}void 0!==s&&this.updateOlTooltip(function d0(i){var a=function Xc(i){var a=i.get("_center"),n=(0,Ke.qg)(i.getExtent());return void 0!==a?a.setCoordinates(n):(a=new He.Z(n),i.set("_center",a)),a}(i),n=a.get("_tooltip");return void 0===n?n=eu(a,!0):n.setPosition(a.getFlatCoordinates()),n}(t),Qr(s,this.activeAreaUnit),this.activeAreaUnit,zt.Area)}},{key:"showTooltipsOfOlGeometry",value:function(t){var o=this;As(t).forEach(function(r){o.shouldShowTooltip(r)&&o.map.ol.addOverlay(r)})}},{key:"clearTooltipsOfOlGeometry",value:function(t){var o=this;As(t).forEach(function(r){void 0!==r&&void 0!==r.getMap()&&o.map.ol.removeOverlay(r)})}},{key:"updateTooltipsOfOlSource",value:function(t){var o=this;t.forEachFeature(function(r){o.updateTooltipsOfOlGeometry(r.getGeometry())})}},{key:"showTooltipsOfOlSource",value:function(t){var o=this;t.forEachFeature(function(r){o.showTooltipsOfOlGeometry(r.getGeometry())})}},{key:"clearTooltipsOfOlSource",value:function(t){var o=this;t.forEachFeature(function(r){void 0!==r.getGeometry()&&o.clearTooltipsOfOlGeometry(r.getGeometry())})}},{key:"updateOlTooltip",value:function(t,o,r,s){t.setProperties({_measure:o,_unit:r,_type:s},!0),t.getElement().innerHTML=this.computeTooltipInnerHTML(t),this.shouldShowTooltip(t)&&this.map.ol.addOverlay(t)}},{key:"computeTooltipInnerHTML",value:function(t){var o=t.getProperties();return Yi(o._measure,{decimal:1,unit:o._unit,unitAbbr:!0,locale:"fr"},this.languageService)}},{key:"shouldShowTooltip",value:function(t){if(!1===this.showTooltips)return!1;var o=t.getProperties(),r=o._measure;if(void 0===r)return!1;if(o._unit===zt.Length){var s=Qi(this.minSegmentLength,o._unit)||0;return r>Math.max(s,0)}return!0}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(z.uw),e.Y36(Te))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-measurer"]],viewQuery:function(n,t){var o;1&n&&e.Gf(mb,7),2&n&&e.iGM(o=e.CRH())&&(t.table=o.first)},inputs:{map:"map",store:"store",activeMeasureType:"activeMeasureType",minSegmentLength:"minSegmentLength"},decls:43,vars:60,consts:[[1,"measure-type-toggle","mat-typography"],[3,"value","change"],[3,"value"],[1,"measure-options","mat-typography"],[3,"disabled","checked","labelPosition","change"],[4,"ngIf"],[3,"checked","labelPosition","change",4,"ngIf"],[3,"checked","labelPosition","change"],[1,"measure-store-buttons"],["mat-icon-button","","color","accent",3,"matTooltip","disabled","click",4,"ngIf"],["mat-icon-button","","color","warn",3,"matTooltip","disabled","click",4,"ngIf"],[1,"table-compact",3,"store","template"],["table",""],[3,"measureType","measureUnit","measure","auto","placeholder","measureUnitChange",4,"ngIf"],[3,"measureType","measureUnit","measure","auto","placeholder","measureUnitChange"],["mat-icon-button","","color","accent",3,"matTooltip","disabled","click"],["svgIcon","calculator"],["mat-icon-button","","color","warn",3,"matTooltip","disabled","click"],["svgIcon","delete"]],template:function(n,t){1&n&&(e.TgZ(0,"div")(1,"div",0)(2,"mat-button-toggle-group",1),e.NdJ("change",function(r){return t.onMeasureTypeChange(r.value)}),e.TgZ(3,"mat-button-toggle",2),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"mat-button-toggle",2),e._uU(7),e.ALo(8,"translate"),e.qZA()()(),e.TgZ(9,"div",3)(10,"mat-slide-toggle",4),e.NdJ("change",function(r){return t.onToggleDrawControl(r.checked)}),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.YNc(13,hb,1,0,"mat-divider",5),e.ALo(14,"async"),e.YNc(15,vb,3,5,"mat-slide-toggle",6),e.ALo(16,"async"),e.YNc(17,yb,1,0,"mat-divider",5),e.ALo(18,"async"),e.ALo(19,"async"),e.YNc(20,_b,3,5,"mat-slide-toggle",6),e.ALo(21,"async"),e.YNc(22,bb,3,5,"mat-slide-toggle",6),e.ALo(23,"async"),e.YNc(24,Cb,1,0,"mat-divider",5),e.ALo(25,"async"),e.TgZ(26,"mat-slide-toggle",7),e.NdJ("change",function(r){return t.onToggleMeasureUnitsAuto(r.checked)}),e._uU(27),e.ALo(28,"translate"),e.qZA()(),e.YNc(29,Tb,3,2,"ng-container",5),e.ALo(30,"async"),e.YNc(31,xb,1,0,"mat-divider",5),e.ALo(32,"async"),e.ALo(33,"async"),e.TgZ(34,"div",8),e.YNc(35,kb,4,6,"button",9),e.ALo(36,"async"),e.ALo(37,"async"),e.YNc(38,Mb,4,6,"button",10),e.ALo(39,"async"),e.ALo(40,"async"),e.qZA(),e._UZ(41,"igo-entity-table",11,12),e.qZA()),2&n&&(e.xp6(2),e.Q6J("value",t.activeMeasureType),e.xp6(1),e.Q6J("value",t.measureType.Length),e.xp6(1),e.hij(" ",e.lcZ(5,24,"igo.geo.measure."+t.measureType.Length)," "),e.xp6(2),e.Q6J("value",t.measureType.Area),e.xp6(1),e.hij(" ",e.lcZ(8,26,"igo.geo.measure."+t.measureType.Area)," "),e.xp6(3),e.Q6J("disabled",t.drawControlIsDisabled)("checked",t.drawControlIsActive)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(12,28,"igo.geo.measure.toggleActive")," "),e.xp6(2),e.Q6J("ngIf",e.lcZ(14,30,t.hasLine$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(16,32,t.hasLine$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(18,34,t.hasLine$)||e.lcZ(19,36,t.hasArea$)),e.xp6(3),e.Q6J("ngIf",e.lcZ(21,38,t.hasArea$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(23,40,t.hasArea$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(25,42,t.hasArea$)),e.xp6(2),e.Q6J("checked",t.measureUnitsAuto)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(28,44,"igo.geo.measure.toggleAutoUnits")," "),e.xp6(2),e.Q6J("ngIf",e.lcZ(30,46,t.measure$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(32,48,t.hasLine$)||e.lcZ(33,50,t.hasArea$)),e.xp6(4),e.Q6J("ngIf",e.lcZ(36,52,t.hasLine$)||e.lcZ(37,54,t.hasArea$)),e.xp6(3),e.Q6J("ngIf",e.lcZ(39,56,t.hasLine$)||e.lcZ(40,58,t.hasArea$)),e.xp6(3),e.Q6J("store",t.store)("template",t.tableTemplate))},styles:[".measure-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.measure-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}.measure-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}.measure-options[_ngcontent-%COMP%]{overflow-x:hidden}.measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;margin:10px}.measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mat-slide-toggle-content{width:calc(100% - 60px)}.measure-store-buttons[_ngcontent-%COMP%]{margin-left:-2px}.measure-store-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-of-type{margin-left:14px}.table-compact[_ngcontent-%COMP%]     .mat-header-cell.mat-column-selectionCheckbox{width:52px}"],changeDetection:0}),i}(),yu=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,[{key:"transform",value:function(t,o){var l,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object.values(ut).indexOf(o)>=0?l=Qr(t,o):Object.values(ye).indexOf(o)>=0&&(l=Qi(t,o)),l&&Yi(l,{decimal:1,unit:o,unitAbbr:r,locale:"fr"})}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275pipe=e.Yjl({name:"measureFormat",type:i,pure:!0}),i}();function Fb(i,a){}var _u=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.cdRef=n,this.ngControl=t,this.olGeoJSON=new Ee.Z,this.ready=!1,this.olTooltip=this.createMeasureTooltip(),this.drawGuide=null,this.measure=!1,this._drawControlIsActive=!0,this.controlOptions={},this.onChange=function(){},this.onTouched=function(){},void 0!==this.ngControl&&(this.ngControl.valueAccessor=this)}return(0,v.Z)(a,[{key:"geometryType",get:function(){return this._geometryType},set:function(t){this._geometryType=t,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())}},{key:"drawControlIsActive",get:function(){return this._drawControlIsActive},set:function(t){if(this._drawControlIsActive=t,!1!==this.ready){if(this.deactivateControl(),!this._drawControlIsActive)return;this.toggleControl()}}},{key:"freehandDrawIsActive",get:function(){return this._freehandDrawIsActive},set:function(t){this._freehandDrawIsActive=t,this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),!1!==this.ready&&(!this.drawControlIsActive||this.toggleControl())}},{key:"drawStyle",get:function(){return this._drawStyle},set:function(t){void 0===t&&(t=ru()),this._drawStyle=t;var o=this.getGuideStyleFromDrawStyle(t);this.defaultDrawStyleRadius=void 0!==o?o.getRadius():null,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())}},{key:"overlayStyle",get:function(){return this._overlayStyle},set:function(t){this._overlayStyle=t}},{key:"value",get:function(){return this._value},set:function(t){this._value=t,!1!==this.ready&&(t?this.addGeoJSONToOverlay(t):this.olOverlaySource.clear(!0),this.onChange(t),this.toggleControl(),this.cdRef.detectChanges())}},{key:"olOverlaySource",get:function(){return this.olOverlayLayer.getSource()}},{key:"radius",set:function(t){var r,o=this;!1!==this.ready&&(this.modifyControl.getSource()&&this.modifyControl.getSource().refresh(),this.freehandDrawIsActive)&&setTimeout(function(){(r=o.modifyControl.olModifyInteraction)&&r.features_&&(r.features_.clear(),o.addGeoJSONToOverlay(o.value))},0)}},{key:"ngOnInit",value:function(){void 0===this.drawStyle&&(this.drawStyle=ru()),void 0===this.overlayStyle&&(this.overlayStyle=this.drawStyle),this.addOlOverlayLayer(),this.createDrawControl(),this.createModifyControl(),this.value&&this.addGeoJSONToOverlay(this.value),this.toggleControl(),this.ready=!0}},{key:"ngOnDestroy",value:function(){this.ready=!1,this.deactivateControl(),this.olOverlaySource.clear(),this.map.ol.removeLayer(this.olOverlayLayer)}},{key:"registerOnChange",value:function(t){this.onChange=t}},{key:"registerOnTouched",value:function(t){this.onTouched=t}},{key:"writeValue",value:function(t){this.value=t}},{key:"addOlOverlayLayer",value:function(){this.olOverlayLayer=new zn.Z({source:new nn.Z,zIndex:500,style:null}),this.map.ol.addLayer(this.olOverlayLayer)}},{key:"createDrawControl",value:function(){var t=this,o=Object.assign({},this.controlOptions,{geometryType:this.geometryType||"Point",drawingLayer:this.olOverlayLayer,interactionStyle:"function"==typeof this.drawStyle?this.drawStyle:function(r,s){var l=t.drawStyle;return t.updateDrawStyleWithDrawGuide(l,s),l}});this.drawControl=new ji(o)}},{key:"createModifyControl",value:function(){var t=this,o=Object.assign({},this.controlOptions,{layer:this.olOverlayLayer,drawStyle:"function"==typeof this.drawStyle?this.drawStyle:function(r,s){var l=t.drawStyle;return t.updateDrawStyleWithDrawGuide(l,s),l}});this.modifyControl=new hu(o)}},{key:"toggleControl",value:function(){var t;(t=!this.value&&this.geometryType?this.drawControl:this.modifyControl)!==this.activeControl&&(this.deactivateControl(),this.activateControl(t))}},{key:"activateControl",value:function(t){var o=this;this.activeControl=t,this.olGeometryEnds$$=t.end$.subscribe(function(r){return o.onOlGeometryEnds(r)}),!0===this.measure&&t===this.drawControl&&(this.olGeometryChanges$$=t.changes$.subscribe(function(r){return o.onOlGeometryChanges(r)})),t.setOlMap(this.map.ol,!1)}},{key:"deactivateControl",value:function(){this.removeMeasureTooltip(),void 0!==this.activeControl&&this.activeControl.setOlMap(void 0),void 0!==this.olGeometryEnds$$&&this.olGeometryEnds$$.unsubscribe(),void 0!==this.olGeometryChanges$$&&this.olGeometryChanges$$.unsubscribe(),this.activeControl=void 0}},{key:"onOlGeometryEnds",value:function(t){this.removeMeasureTooltip(),this.setOlGeometry(t)}},{key:"onOlGeometryChanges",value:function(t){"Point"!==t.getType()&&this.updateMeasureTooltip(t)}},{key:"setOlGeometry",value:function(t){var o;void 0!==t&&("Circle"===t.getType()&&(t=this.circleToPoint(t)),o=this.olGeoJSON.writeGeometryObject(t,{featureProjection:this.map.projection,dataProjection:"EPSG:4326"}),t.get("radius")&&(o.radius=t.get("radius"),t.set("radius",o.radius)),this.writeValue(o))}},{key:"circleToPoint",value:function(t){var o=t.getCenter(),r=re.vs(o,this.map.projection,"EPSG:4326"),s=Math.round(t.getRadius()*Math.cos(Math.PI/180*r[1]));return(t=new He.Z(o)).set("radius",s,!0),t}},{key:"addGeoJSONToOverlay",value:function(t){var o=this.olGeoJSON.readGeometry(t,{dataProjection:"EPSG:4326",featureProjection:this.map.projection}),r=new nt.Z({geometry:o});r.setStyle(this.overlayStyle),this.olOverlaySource.clear(),this.olOverlaySource.addFeature(r)}},{key:"createMeasureTooltip",value:function(){return new pc.Z({element:document.createElement("div"),offset:[-30,-10],className:["igo-map-tooltip","igo-map-tooltip-measure"].join(" "),stopEvent:!1})}},{key:"updateMeasureTooltip",value:function(t){var r=Fs(t,this.map.projection).lengths,s="Polygon"===t.getType()?r.length-2:r.length-1,l=r[s],c=Zs(t),u=c[s];if(0!==c.length&&void 0!==u){this.olTooltip.setPosition(u.getFlatCoordinates());var p=Yi(l,{decimal:1,unit:ye.Meters,unitAbbr:!0,locale:"fr"});this.olTooltip.getElement().innerHTML=p,void 0===this.olTooltip.getMap()&&this.map.ol.addOverlay(this.olTooltip)}else this.removeMeasureTooltip()}},{key:"removeMeasureTooltip",value:function(){this.olTooltip.getMap&&void 0!==this.olTooltip.getMap()&&(this.map.ol.removeOverlay(this.olTooltip),this.olTooltip.setMap(void 0))}},{key:"updateDrawStyleWithDrawGuide",value:function(t,o){var r=this.getGuideStyleFromDrawStyle(t);if(void 0!==r){var s=this.drawGuide;r.setRadius(!s||s<0?this.defaultDrawStyleRadius:s>0?s/o:s)}}},{key:"isStyleWithRadius",value:function(t){return"function"!=typeof t&&t.setRadius}},{key:"getGuideStyleFromDrawStyle",value:function(t){if(Array.isArray(t)&&(t=t[0]),this.isStyleWithRadius(t))return t}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.sBO),e.Y36(S.a5,10))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-geometry-form-field-input"]],inputs:{map:"map",geometryType:"geometryType",drawGuide:"drawGuide",measure:"measure",drawControlIsActive:"drawControlIsActive",freehandDrawIsActive:"freehandDrawIsActive",controlOptions:"controlOptions",drawStyle:"drawStyle",overlayStyle:"overlayStyle",value:"value",radius:"radius"},decls:1,vars:0,template:function(n,t){1&n&&e.YNc(0,Fb,0,0,"ng-template")},encapsulation:2,changeDetection:0}),i}(),bu=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,S.u5,S.UX,O.Ps,B.lN,le.c,I.ot,ot.vV,he]}),i}(),Es=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,bu,bu]}),i}();function Ib(i,a){if(1&i&&(e.TgZ(0,"button",2),e.ALo(1,"translate"),e._UZ(2,"mat-icon",3),e.qZA()),2&i){var n=e.oxw();e.Q6J("matTooltip",e.lcZ(1,3,"igo.geo.filter.filterBy"))("color",n.color),e.xp6(2),e.Q6J("matBadge",n.badge)}}function Lb(i,a){if(1&i&&e._UZ(0,"igo-time-filter-item",7),2&i){var n=e.oxw(2);e.Q6J("header",!1)("layer",n.layer)}}function Ob(i,a){if(1&i&&(e.TgZ(0,"div",4,5),e.YNc(2,Lb,1,2,"igo-time-filter-item",6),e.qZA()),2&i){var n=e.oxw();e.xp6(2),e.Q6J("ngIf",n.timeFilterCollapse&&n.options.timeFilter)}}var zi=function(){var i=function(){function a(){(0,h.Z)(this,a),this.color="primary",this.header=!0,this.timeFilterCollapse=!1}return(0,v.Z)(a,[{key:"badge",get:function(){var t=this.options.timeFilter;if(t&&t.enabled)return 1}},{key:"layer",get:function(){return this._layer},set:function(t){this._layer=t,t&&(this.options=this.layer.dataSource.options)}},{key:"ngOnInit",value:function(){this.options=this.layer.dataSource.options}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-time-filter-button"]],inputs:{layer:"layer",map:"map",color:"color",header:"header"},decls:2,vars:2,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["class","igo-layer-actions-container",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["matBadgeColor","warn","matBadgeSize","medium","svgIcon","history",3,"matBadge"],[1,"igo-layer-actions-container"],["ogcFilter",""],["igoListItem","",3,"header","layer",4,"ngIf"],["igoListItem","",3,"header","layer"]],template:function(n,t){1&n&&(e.YNc(0,Ib,3,5,"button",0),e.YNc(1,Ob,3,1,"div",1)),2&n&&(e.Q6J("ngIf",t.header&&t.options.timeFilterable&&t.options.timeFilter),e.xp6(1),e.Q6J("ngIf",t.header&&t.options.timeFilterable&&t.options.timeFilter))},changeDetection:0}),i}();function Db(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",3)(1,"mat-form-field"),e._UZ(2,"mat-datetimepicker-toggle",4)(3,"mat-datetimepicker",5,6),e.TgZ(5,"input",7),e.NdJ("ngModelChange",function(s){e.CHM(n);var l=e.oxw(2);return e.KtG(l.date=s)})("dateChange",function(s){e.CHM(n);var l=e.oxw(2);return e.KtG(l.handleDateChange(s))}),e.ALo(6,"translate"),e.qZA()()()}if(2&i){var t=e.MAs(4),o=e.oxw(2);e.xp6(2),e.Q6J("for",t),e.xp6(1),e.s9C("type",o.type),e.xp6(2),e.s9C("placeholder",e.lcZ(6,7,"igo.geo.timeFilter.date")),e.Q6J("matDatetimepicker",t)("ngModel",o.date)("min",o.min)("max",o.max)}}function Pb(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div")(1,"div",8)(2,"mat-form-field"),e._UZ(3,"mat-datetimepicker-toggle",4)(4,"mat-datetimepicker",5,9),e.TgZ(6,"input",10),e.NdJ("ngModelChange",function(l){e.CHM(n);var c=e.oxw(2);return e.KtG(c.startDate=l)})("input",function(){e.CHM(n);var l=e.oxw(2);return e.KtG(l.startDate)})("dateChange",function(l){e.CHM(n);var c=e.oxw(2);return e.KtG(c.handleDateChange(l))}),e.ALo(7,"translate"),e.qZA()()(),e.TgZ(8,"div",8)(9,"mat-form-field"),e._UZ(10,"mat-datetimepicker-toggle",4)(11,"mat-datetimepicker",5,11),e.TgZ(13,"input",7),e.NdJ("ngModelChange",function(l){e.CHM(n);var c=e.oxw(2);return e.KtG(c.endDate=l)})("dateChange",function(l){e.CHM(n);var c=e.oxw(2);return e.KtG(c.handleDateChange(l))}),e.ALo(14,"translate"),e.qZA()()()()}if(2&i){var t=e.MAs(5),o=e.MAs(12),r=e.oxw(2);e.xp6(3),e.Q6J("for",t),e.xp6(1),e.s9C("type",r.type),e.xp6(2),e.s9C("placeholder",e.lcZ(7,14,"igo.geo.timeFilter.startDate")),e.Q6J("matDatetimepicker",t)("ngModel",r.startDate)("min",r.min)("max",r.getRangeMaxDate()),e.xp6(4),e.Q6J("for",o),e.xp6(1),e.s9C("type",r.type),e.xp6(2),e.s9C("placeholder",e.lcZ(14,16,"igo.geo.timeFilter.endDate")),e.Q6J("matDatetimepicker",o)("ngModel",r.endDate)("min",r.getRangeMinDate())("max",r.max)}}function Eb(i,a){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,Db,7,9,"div",2),e.YNc(2,Pb,15,18,"div",0),e.qZA()),2&i){var n=e.oxw();e.xp6(1),e.Q6J("ngIf",!n.isRange),e.xp6(1),e.Q6J("ngIf",n.isRange)}}function $b(i,a){if(1&i&&(e.TgZ(0,"mat-option",14),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function Rb(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",3)(1,"mat-form-field")(2,"mat-select",12),e.NdJ("ngModelChange",function(r){e.CHM(n);var s=e.oxw(2);return e.KtG(s.year=r)})("selectionChange",function(r){e.CHM(n);var s=e.oxw(2);return e.KtG(s.handleYearChange(r))}),e.ALo(3,"translate"),e.YNc(4,$b,2,2,"mat-option",13),e.qZA()()()}if(2&i){var t=e.oxw(2);e.xp6(2),e.s9C("placeholder",e.lcZ(3,3,"igo.geo.timeFilter.date")),e.Q6J("ngModel",t.year),e.xp6(2),e.Q6J("ngForOf",t.listYears)}}function Jb(i,a){if(1&i&&(e.TgZ(0,"mat-option",14),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function Bb(i,a){if(1&i&&(e.TgZ(0,"mat-option",14),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function Ub(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div")(1,"div",8)(2,"mat-form-field")(3,"mat-select",12),e.NdJ("ngModelChange",function(r){e.CHM(n);var s=e.oxw(2);return e.KtG(s.startYear=r)})("selectionChange",function(r){e.CHM(n);var s=e.oxw(2);return e.KtG(s.handleYearChange(r))}),e.ALo(4,"translate"),e.YNc(5,Jb,2,2,"mat-option",13),e.qZA()()(),e.TgZ(6,"div",8)(7,"mat-form-field")(8,"mat-select",12),e.NdJ("ngModelChange",function(r){e.CHM(n);var s=e.oxw(2);return e.KtG(s.endYear=r)})("selectionChange",function(r){e.CHM(n);var s=e.oxw(2);return e.KtG(s.handleYearChange(r))}),e.ALo(9,"translate"),e.YNc(10,Bb,2,2,"mat-option",13),e.qZA()()()()}if(2&i){var t=e.oxw(2);e.xp6(3),e.s9C("placeholder",e.lcZ(4,6,"igo.geo.timeFilter.startDate")),e.Q6J("ngModel",t.startYear),e.xp6(2),e.Q6J("ngForOf",t.startListYears),e.xp6(3),e.s9C("placeholder",e.lcZ(9,8,"igo.geo.timeFilter.endDate")),e.Q6J("ngModel",t.endYear),e.xp6(2),e.Q6J("ngForOf",t.endListYears)}}function Nb(i,a){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,Rb,5,5,"div",2),e.YNc(2,Ub,11,10,"div",0),e.qZA()),2&i){var n=e.oxw();e.xp6(1),e.Q6J("ngIf",!n.isRange),e.xp6(1),e.Q6J("ngIf",n.isRange)}}function qb(i,a){if(1&i&&(e.TgZ(0,"p",23),e._uU(1),e.qZA()),2&i){var n=e.oxw(2);e.xp6(1),e.Oqu(n.year)}}function Gb(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",15)(1,"span"),e._uU(2),e.qZA(),e.TgZ(3,"mat-slider",16),e.NdJ("input",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.handleSliderYearChange(r))})("change",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.handleSliderYearChange(r))}),e.qZA(),e.TgZ(4,"span"),e._uU(5),e.qZA(),e.YNc(6,qb,2,1,"p",17),e.TgZ(7,"div",18,19)(9,"mat-slide-toggle",20),e.NdJ("change",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.toggleFilterState())}),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"button",21),e.NdJ("click",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.playYear(r))}),e._UZ(12,"mat-icon",22),e.qZA(),e.TgZ(13,"button",21),e.NdJ("click",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.resetFilter(r))}),e._UZ(14,"mat-icon",22),e.qZA()()()}if(2&i){var t=e.oxw();e.xp6(2),e.Oqu(t.startYear),e.xp6(1),e.s9C("step",t.step),e.Q6J("min",t.startYear)("max",t.endYear)("value",t.handleSliderValue())("color",t.color)("disabled",!t.options.enabled||!t.layer.visible),e.xp6(2),e.Oqu(t.endYear),e.xp6(1),e.Q6J("ngIf",t.options.enabled),e.xp6(3),e.Q6J("matTooltip",e.lcZ(10,17,"igo.geo.filter.toggleFilterState"))("color",t.color)("checked",t.options.enabled)("disabled",!t.layer.visible),e.xp6(2),e.Q6J("disabled",!t.options.enabled||!t.layer.visible),e.xp6(1),e.s9C("svgIcon",t.playIcon),e.xp6(1),e.Q6J("disabled",!t.options.enabled||!t.layer.visible),e.xp6(1),e.s9C("svgIcon",t.resetIcon)}}function Qb(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",3)(1,"mat-slider",24),e.NdJ("input",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.handleSliderDateChange(r))})("selectionChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.handleSliderDateChange(r))}),e.qZA(),e.TgZ(2,"p",23),e._uU(3),e.qZA(),e.TgZ(4,"button",25),e.NdJ("click",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.playFilter(r))}),e._UZ(5,"mat-icon",22),e.qZA()()}if(2&i){var t=e.oxw();e.xp6(1),e.s9C("step",t.step),e.Q6J("min",t.dateToNumber(t.min))("max",t.dateToNumber(t.max))("value",t.handleSliderValue()),e.xp6(2),e.Oqu(t.handleSliderTooltip()),e.xp6(2),e.s9C("svgIcon",t.playIcon)}}var Yb=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.dateAdapter=n,this.color="primary",this.listYears=[],this.startListYears=[],this.endListYears=[],this.playIcon="play-circle",this.resetIcon="replay",this.change=new e.vpe,this.yearChange=new e.vpe,this.dateAdapter.setLocale("fr")}return(0,v.Z)(a,[{key:"currentValue",set:function(t){if(t&&this.type!==lt.YEAR){var o=t.split("/");if(o.length>0){var r=new Date(o[0]),s=new Date(o[1]);isNaN(r.valueOf())||(this.startDate=r),isNaN(s.valueOf())||(this.endDate=s)}}}},{key:"type",get:function(){return void 0===this.options.type?lt.DATE:this.options.type}},{key:"isRange",get:function(){return void 0!==this.options.range&&this.options.style!==Jt.SLIDER&&this.options.range}},{key:"style",get:function(){return void 0===this.options.style?Jt.SLIDER:this.options.style}},{key:"step",get:function(){var t=108e5;if(void 0===this.options.step)switch(this.type){case lt.DATE:case lt.DATETIME:t=108e5;break;case lt.TIME:t=36e5;break;case lt.YEAR:t=31536e6;break;default:t=108e5}else t=this.getStepDefinition(this.options.step);return t}},{key:"timeInterval",get:function(){return void 0===this.options.timeInterval?2e3:this.options.timeInterval}},{key:"min",get:function(){if(this.options.min){var t=new Date(this.options.min);return new Date(t.getTime()+6e4*t.getTimezoneOffset())}}},{key:"max",get:function(){if(this.options.max){var t=new Date(this.options.max);return new Date(t.getTime()+6e4*t.getTimezoneOffset())}}},{key:"is",get:function(){return void 0!==this.options.range&&this.options.range}},{key:"ngOnInit",value:function(){if(void 0===this.startDate&&(this.startDate=new Date(this.min)),void 0===this.endDate&&(this.endDate=new Date(this.max)),void 0===this.startYear&&(this.startYear=new Date(this.startDate).getFullYear(),this.initStartYear=this.startYear),void 0===this.endYear&&(this.endYear=new Date(this.endDate).getFullYear(),this.initEndYear=this.endYear),this.isRange){for(var o=this.startYear;o<this.endYear;o++)this.startListYears.push(o);for(var r=this.startYear+1;r<=this.endYear;r++)this.endListYears.push(r)}else for(var t=this.startYear;t<=this.endYear+1;t++)this.listYears.push(t);this.options.enabled=void 0===this.options.enabled||this.options.enabled,this.checkFilterValue(),this.options.enabled?!this.isRange&&"slider"===this.style&&"year"===this.type&&this.yearChange.emit(this.year):(this.storeCurrentFilterValue(),this.yearChange.emit(void 0))}},{key:"storeCurrentFilterValue",value:function(){!this.isRange&&this.style===Jt.SLIDER&&this.type===lt.YEAR&&(this.options.value=this.year.toString())}},{key:"checkFilterValue",value:function(){var o=this.layer.dataSource.ol.getParams().TIME;if(this.isRange||this.style!==Jt.SLIDER||this.type!==lt.YEAR){if(this.isRange&&this.style===Jt.CALENDAR&&this.type===lt.YEAR&&o){this.startYear=parseInt(o.substr(0,4),10),this.endYear=parseInt(o.substr(5,4),10);for(var r=[],s=[],l=this.initStartYear;l<this.endYear;l++)r.push(l);for(var c=this.startYear+1;c<=this.initEndYear;c++)s.push(c);this.startListYears=r,this.endListYears=s}}else this.year=o?new Date(o.toString()).getFullYear()+1:this.options.value?new Date(this.options.value.toString()).getFullYear()+1:new Date(this.min).getFullYear()+1}},{key:"handleDateChange",value:function(t){this.setupDateOutput(),this.applyTypeChange(),this.change.emit(this.isRange?[this.startDate,this.endDate]:this.startDate)}},{key:"handleYearChange",value:function(t){if(this.isRange){this.endListYears=[];for(var o=this.startYear+1;o<=this.initEndYear;o++)this.endListYears.push(o);this.startListYears=[];for(var r=this.initStartYear+1;r<this.endYear;r++)this.startListYears.push(r);this.yearChange.emit([this.startYear,this.endYear])}else this.yearChange.emit(this.year)}},{key:"handleListYearChange",value:function(t){this.handleYearChange([this.startYear,this.endYear])}},{key:"handleListYearStartChange",value:function(t){this.change.emit([this.startDate,this.endDate])}},{key:"dateToNumber",value:function(t){return(t?new Date(t):new Date(this.min)).getTime()}},{key:"setSliderThumbLabel",value:function(t){var o=this.findThumbLabel(this.mySlider._elementRef.nativeElement.childNodes);o&&(o.textContent=t)}},{key:"findThumbLabel",value:function(t){var r,o=this;return t.forEach(function(s){"mat-slider-thumb-label-text"===s.className&&(r=s),s.children.length>0&&!r&&(r=o.findThumbLabel(s.childNodes))},this),r}},{key:"toggleFilterState",value:function(){this.options.enabled=!this.options.enabled,this.options.enabled?!this.isRange&&Jt.SLIDER&&this.type===lt.YEAR&&this.yearChange.emit(this.year):(this.stopFilter(),this.storeCurrentFilterValue(),this.change.emit(void 0))}},{key:"resetFilter",value:function(t){this.date=new Date(this.min),this.year=this.date.getFullYear(),!this.isRange&&Jt.SLIDER&&this.type===lt.YEAR?this.yearChange.emit(this.year):(this.setupDateOutput(),this.change.emit(void 0))}},{key:"playFilter",value:function(t){this.interval?this.stopFilter():(this.playIcon="pause-circle",this.interval=setInterval(function(o){var r,s=new Date(o.max);r=void 0===o.date?o.min.getTime():o.date.getTime(),r+=o.mySlider.step,o.date=new Date(r),r>s.getTime()&&o.stopFilter(),o.handleDateChange({value:o.date,date:o.date})},this.timeInterval,this))}},{key:"playYear",value:function(t){var o=this;this.year+this.mySlider.step>this.max.getFullYear()+this.mySlider.step&&(this.stopFilter(),this.resetFilter(t)),this.interval?this.stopFilter():(this.playIcon="pause-circle",this.interval=setInterval(function(){o.year+o.mySlider.step>o.max.getFullYear()?o.stopFilter():o.year=o.year+o.mySlider.step,o.yearChange.emit(o.year)},this.timeInterval,this))}},{key:"stopFilter",value:function(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play-circle"}},{key:"handleSliderDateChange",value:function(t){this.date=new Date(t.value),this.setSliderThumbLabel(this.handleSliderTooltip()),this.handleDateChange(t)}},{key:"handleSliderYearChange",value:function(t){this.year=t.value,this.yearChange.emit(this.year)}},{key:"handleSliderValue",value:function(){if(!0===this.options.current||!this.min){var t=new Date;this.date=this.getRoundedDate(t)}return this.type===lt.YEAR?this.year:void 0===this.date?this.min.getTime():this.date.getTime()}},{key:"handleSliderTooltip",value:function(){var t;switch(this.type){case lt.DATE:t=void 0===this.date?this.min.toDateString():this.date.toDateString();break;case lt.TIME:t=void 0===this.date?this.min.toTimeString():this.date.toTimeString();break;default:t=void 0===this.date?this.min.toUTCString():this.date.toUTCString()}return t}},{key:"setupDateOutput",value:function(){this.style===Jt.SLIDER?(this.startDate=new Date(this.date),this.startDate.setSeconds(-this.step/1e3),this.endDate=new Date(this.startDate),this.endDate.setSeconds(this.step/1e3)):!this.isRange&&this.date?(this.endDate=new Date(this.date),this.startDate=new Date(this.date)):(!this.isRange||!this.date&&this.date)&&this.date||(this.startDate=void 0===this.startDate?new Date(this.min):this.startDate,this.endDate=void 0===this.endDate?new Date(this.max):this.endDate)}},{key:"applyTypeChange",value:function(){switch(this.type){case lt.DATE:(void 0!==this.startDate||void 0!==this.endDate)&&(this.startDate.setHours(0),this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setHours(23),this.endDate.setMinutes(59),this.endDate.setSeconds(59));break;case lt.TIME:if(this.style===Jt.CALENDAR){if(this.startDate.getDay()!==this.min.getDay()){var t=this.startDate.getHours(),o=this.startDate.getMinutes();this.startDate=this.min,this.startDate.setHours(t),this.startDate.setMinutes(o)}if(this.endDate.getDay()!==this.min.getDay()){var r=this.endDate.getHours(),s=this.endDate.getMinutes();this.endDate=this.min,this.endDate.setHours(r),this.endDate.setMinutes(s)}}!this.isRange&&this.step>36e5&&(this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setMinutes(59),this.endDate.setSeconds(59))}}},{key:"getRangeMinDate",value:function(){return void 0===this.startDate?this.min:this.startDate}},{key:"getRangeMaxDate",value:function(){return void 0===this.endDate?this.max:this.endDate}},{key:"getRoundedDate",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=6e4*o;return new Date(Math.round(t.getTime()/r)*r)}},{key:"getStepDefinition",value:function(t){return H.duration(t).asMilliseconds()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(ie._A))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-time-filter-form"]],viewQuery:function(n,t){var o;1&n&&e.Gf(So.pH,5),2&n&&e.iGM(o=e.CRH())&&(t.mySlider=o.first)},inputs:{layer:"layer",options:"options",currentValue:"currentValue"},outputs:{change:"change",yearChange:"yearChange"},decls:5,vars:4,consts:[[4,"ngIf"],["class","igo-col igo-col-100 igo-col-100-m mat-typography",4,"ngIf"],["class","igo-col igo-col-100 igo-col-100-m",4,"ngIf"],[1,"igo-col","igo-col-100","igo-col-100-m"],["matSuffix","",1,"time-filter-mat-datetimepicker-toggle",3,"for"],["openOnFocus","true","timeInterval","5",3,"type"],["datetimePicker",""],["matInput","","autocomplete","false","readonly","readonly",3,"placeholder","matDatetimepicker","ngModel","min","max","ngModelChange","dateChange"],[1,"igo-col","igo-col-100"],["minDatetimePicker",""],["matInput","","autocomplete","false","readonly","readonly",3,"placeholder","matDatetimepicker","ngModel","min","max","ngModelChange","input","dateChange"],["maxDatetimePicker",""],[3,"placeholder","ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"igo-col","igo-col-100","igo-col-100-m","mat-typography"],["id","time-slider","tickInterval","auto","thumbLabel","",3,"step","min","max","value","color","disabled","input","change"],["class","date-below",4,"ngIf"],[1,"igo-layer-actions-container"],["actions",""],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","checked","disabled","change"],["mat-icon-button","","color","primary",3,"disabled","click"],[3,"svgIcon"],[1,"date-below"],["id","time-slider","tickInterval","auto","thumbLabel","",3,"step","min","max","value","input","selectionChange"],["mat-icon-button","","color","primary",3,"click"]],template:function(n,t){1&n&&(e.YNc(0,Eb,3,2,"div",0),e.YNc(1,Nb,3,2,"div",0),e._UZ(2,"br"),e.YNc(3,Gb,15,19,"div",1),e.YNc(4,Qb,6,6,"div",2)),2&n&&(e.Q6J("ngIf","calendar"===t.style&&"year"!==t.type),e.xp6(1),e.Q6J("ngIf","calendar"===t.style&&"year"===t.type),e.xp6(2),e.Q6J("ngIf",!t.isRange&&"slider"===t.style&&"year"===t.type),e.xp6(1),e.Q6J("ngIf","slider"===t.style&&"year"!==t.type))},dependencies:[C.sg,C.O5,S.Fj,S.JJ,S.On,ie.ey,O.Hw,I.lW,So.pH,ht.Rr,B.KE,B.R9,le.Nt,ke.gD,J.gM,Ai._R,Ai.C,Ai.RZ,E.X$],styles:[".igo-layer-filters-container[_ngcontent-%COMP%]{padding-left:5px}mat-slider[_ngcontent-%COMP%]     div.mat-slider-thumb-label{width:32px;height:32px;margin:0 auto}mat-slider[_ngcontent-%COMP%]     span.mat-slider-thumb-label-text{font-size:10px}#time-slider[_ngcontent-%COMP%]{width:70%;margin:0 auto}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){#time-slider[_ngcontent-%COMP%]{width:60%;margin:0 auto}}.date-below[_ngcontent-%COMP%]{margin:0}mat-form-field[_ngcontent-%COMP%]{text-align:center}mat-datetimepicker-toggle[_ngcontent-%COMP%]     .mat-icon{padding-bottom:30px}.igo-layer-actions-container[_ngcontent-%COMP%] > .mat-slide-toggle[_ngcontent-%COMP%]{vertical-align:middle}.time-filter-mat-datetimepicker-toggle[_ngcontent-%COMP%]     .mat-icon{width:auto}"]}),i}(),jb=function(a){return{disabled:a}};function Hb(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.layer.visible=!r.layer.visible)}),e.ALo(1,"translate"),e.ALo(2,"translate"),e._UZ(3,"mat-icon",11),e.ALo(4,"async"),e.qZA()}if(2&i){var t=e.oxw(2);e.Q6J("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.lcZ(1,4,"igo.geo.layer.hideLayer"):e.lcZ(2,6,"igo.geo.layer.showLayer")),e.xp6(3),e.Q6J("ngClass",e.VKq(10,jb,!1===e.lcZ(4,8,t.inResolutionRange$)))("svgIcon",t.layer.visible?"eye":"eye-off")}}var Vb=function(a){return{cursor:a}};function zb(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-list-item")(1,"mat-icon",7),e.NdJ("click",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.toggleFiltersCollapsed())}),e.qZA(),e.TgZ(2,"h4",8),e.NdJ("click",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.toggleLegendOnClick())}),e._uU(3),e.qZA(),e.YNc(4,Hb,5,12,"button",9),e.qZA()}if(2&i){var t=e.oxw(),o=e.MAs(2);e.xp6(1),e.Q6J("target",o)("collapsed",t.filtersCollapsed),e.xp6(1),e.Q6J("ngStyle",e.VKq(5,Vb,t.filtersCollapsed?"default":"pointer")),e.xp6(1),e.Oqu(t.layer.title),e.xp6(1),e.Q6J("ngIf",t.header)}}function Wb(i,a){if(1&i&&e._UZ(0,"igo-layer-legend",12),2&i){var n=e.oxw();e.Q6J("layer",n.layer)}}var jr=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.timeFilterService=n,this.color="primary",this.showLegend$=new x.X(!1),this.inResolutionRange$=new x.X(!0),this.filtersCollapsed=!1,this.header=!0}return(0,v.Z)(a,[{key:"datasource",get:function(){return this.layer.dataSource}},{key:"ngOnInit",value:function(){var t=this;this.resolution$$=this.layer.map.viewController.resolution$.subscribe(function(){t.inResolutionRange$.next(t.layer.isInResolutionsRange)})}},{key:"ngOnDestroy",value:function(){this.resolution$$.unsubscribe()}},{key:"handleYearChange",value:function(t){this.timeFilterService.filterByYear(this.datasource,t)}},{key:"handleDateChange",value:function(t){this.timeFilterService.filterByDate(this.datasource,t)}},{key:"toggleLegend",value:function(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}},{key:"toggleLegendOnClick",value:function(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)}},{key:"setVisible",value:function(){this.layer.visible=!0}},{key:"toggleFiltersCollapsed",value:function(){this.filtersCollapsed=!this.filtersCollapsed}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(du))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-time-filter-item"]],inputs:{header:"header",layer:"layer"},decls:8,vars:7,consts:[[4,"ngIf"],[1,"igo-datasource-filters-container"],["filters",""],[1,"igo-layer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],[3,"layer","options","currentValue","change","yearChange"],["mat-list-avatar","","igoCollapse","","svgIcon","chevron-up",1,"igo-chevron",3,"target","collapsed","click"],["matLine","",3,"ngStyle","click"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],[3,"ngClass","svgIcon"],[3,"layer"]],template:function(n,t){1&n&&(e.YNc(0,zb,5,7,"mat-list-item",0),e.TgZ(1,"div",1,2)(3,"div",3,4),e.YNc(5,Wb,1,1,"igo-layer-legend",5),e.ALo(6,"async"),e.qZA(),e.TgZ(7,"igo-time-filter-form",6),e.NdJ("change",function(r){return t.handleDateChange(r)})("yearChange",function(r){return t.handleYearChange(r)}),e.qZA()()),2&n&&(e.Q6J("ngIf",t.header),e.xp6(5),e.Q6J("ngIf",e.lcZ(6,5,t.showLegend$)),e.xp6(2),e.Q6J("layer",t.layer)("options",t.datasource.options.timeFilter)("currentValue",t.datasource.options.params.TIME))},styles:["[_nghost-%COMP%]{overflow:hidden}.igo-datasource-filters-container[_ngcontent-%COMP%]{text-align:center;width:100%;display:inline-block;padding-top:5px}.igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:1.125em;width:calc(100% - 18px)}"]}),i}();function Kb(i,a){if(1&i&&e._UZ(0,"igo-time-filter-item",2),2&i){var n=a.$implicit;e.Q6J("header",!0)("layer",n)}}var Hr=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.cdRef=n,this._layers=[]}return(0,v.Z)(a,[{key:"layers",get:function(){return this._layers},set:function(t){this._layers=t,this.cdRef.detectChanges()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-time-filter-list"]],inputs:{layers:"layers"},decls:3,vars:6,consts:[[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["igoListItem","",3,"header","layer"]],template:function(n,t){1&n&&(e.TgZ(0,"igo-list",0),e.YNc(1,Kb,1,2,"ng-template",1),e.ALo(2,"filterableDataSource"),e.qZA()),2&n&&(e.Q6J("navigation",!1)("selection",!1),e.xp6(1),e.Q6J("ngForOf",e.xi3(2,3,t.layers,"time")))},encapsulation:2,changeDetection:0}),i}(),eC=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,[{key:"wktToFeature",value:function(t,o,r){return(new Fi.Z).readFeature(t,{dataProjection:o,featureProjection:r})}},{key:"extentToWkt",value:function(t,o,r){var s=re.$A(o,r,t);return s=this.roundCoordinateArray(s,t,0),{wktPoly:"POLYGON((\n      ".concat(o[0]," ").concat(o[1],",\n      ").concat(o[0]," ").concat(o[3],",\n      ").concat(o[2]," ").concat(o[3],",\n      ").concat(o[2]," ").concat(o[1],",\n      ").concat(o[0]," ").concat(o[1],"))"),wktLine:"LINESTRING(\n      ".concat(o[0]," ").concat(o[1],",\n      ").concat(o[0]," ").concat(o[3],",\n      ").concat(o[2]," ").concat(o[3],",\n      ").concat(o[2]," ").concat(o[1],",\n      ").concat(o[0]," ").concat(o[1],")"),wktMultiPoints:"MULTIPOINT(\n        ".concat(o[0]," ").concat(o[1],",\n        ").concat(o[0]," ").concat(o[3],",\n        ").concat(o[2]," ").concat(o[3],",\n        ").concat(o[2]," ").concat(o[1],")")}}},{key:"roundCoordinateArray",value:function(t,o){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=re.U2(o),l=s.getUnits(),c=["ft","m","us-ft"];return-1!==c.indexOf(l)&&(t=this.roundArray(t,r)),t}},{key:"roundArray",value:function(t){for(var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<t.length;)t[r]=t[r].toFixed(o),r++;return t}},{key:"snrcToWkt",value:function(t,o){t=t.toLowerCase();var c=[["m","n","o","p"],["l","k","j","i"],["e","f","g","h"],["d","c","b","a"]],u=[["13","14","15","16"],["12","11","10","09"],["05","06","07","08"],["04","03","02","01"]],f=!1,m=!1,y=!1;if(/\d{2,3}[a-p][0,1][0-9]/gi.test(t)?y=!0:/\d{2,3}[a-p]/gi.test(t)?m=!0:/\d{2,3}/gi.test(t)&&(f=!0),f?t+="a01":m&&(t+="01"),/\d{2,3}[a-p][0,1][0-9]/gi.test(t)){var b=t.split(/(?=[a-p])/gi),w=b[0],T=b[1][0],M=b[1].split(T)[1],A=1;3===w.length&&(A=2);var L=w.substring(0,A),Z=w.substring(A),oe=0,Q=0,ae=0,xe=0;c.forEach(function(Nn){-1!==Nn.indexOf(T)&&(Q=c.indexOf(Nn),oe=Nn.indexOf(T))}),u.forEach(function(Nn){-1!==Nn.indexOf(M)&&(xe=u.indexOf(Nn),ae=Nn.indexOf(M))});var Me=0,Ce=0,Wt=0,wt=0,Kt=8,Fn=4;m?(Me=2*oe,Ce=1*Q,Wt=0,wt=0,Kt=2,Fn=1):y&&(Me=2*oe,Ce=1*Q,Wt=.5*ae,wt=.25*xe,Kt=.5,Fn=.25);var fe={ul:[{1:{from:-56,to:-64},2:{from:-64,to:-72},3:{from:-72,to:-80},4:{from:-80,to:-88},5:{from:-88,to:-96},6:{from:-96,to:-104},7:{from:-104,to:-112},8:{from:-112,to:-120},9:{from:-120,to:-128},10:{from:-128,to:-136}}[L].to+Me+Wt,{1:{from:44,to:48},2:{from:48,to:52},3:{from:52,to:56},4:{from:56,to:60},5:{from:60,to:64},6:{from:64,to:68},7:{from:68,to:72},8:{from:72,to:76},9:{from:76,to:-128}}[Z].to-Ce-wt]};return fe.lr=[fe.ul[0]+Kt,fe.ul[1]-Fn],fe.ur=[fe.ul[0],fe.ul[1]-Fn],fe.ll=[fe.ul[0]+Kt,fe.ul[1]],fe.ul=re.vs([fe.ul[0],fe.ul[1]],"EPSG:4326",o),fe.lr=re.vs([fe.lr[0],fe.lr[1]],"EPSG:4326",o),fe.ur=re.vs([fe.ur[0],fe.ur[1]],"EPSG:4326",o),fe.ll=re.vs([fe.ll[0],fe.ll[1]],"EPSG:4326",o),fe.ul=this.roundCoordinateArray(fe.ul,o,0),fe.lr=this.roundCoordinateArray(fe.lr,o,0),fe.ur=this.roundCoordinateArray(fe.ur,o,0),fe.ll=this.roundCoordinateArray(fe.ll,o,0),{wktPoly:"POLYGON(("+[fe.ul.join(" "),fe.ur.join(" "),fe.lr.join(" "),fe.ll.join(" "),fe.ul.join(" ")].join(",")+"))",wktLine:"LINESTRING("+[fe.ul.join(" "),fe.ur.join(" "),fe.lr.join(" "),fe.ll.join(" "),fe.ul.join(" ")].join(",")+")",wktMultiPoints:"MULTIPOINT("+[fe.ul.join(" "),fe.ur.join(" "),fe.lr.join(" "),fe.ll.join(" ")].join(",")+")"}}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function tC(i,a){if(1&i&&(e.TgZ(0,"mat-option",23),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n.alias)("id",n.name)("matTooltip",n.alias),e.xp6(1),e.hij(" ",n.alias," ")}}function nC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",24),e.NdJ("click",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.clearSelectedField())}),e._UZ(1,"mat-icon",25),e.qZA()}if(2&i){var t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active)}}function oC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-form-field",17),e.NdJ("mouseenter",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.inputClearable="selectField")})("mouseleave",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.inputClearable=void 0)}),e.TgZ(1,"input",18),e.NdJ("input",function(s){e.CHM(n);var l=e.oxw();return e.KtG(l.updateFieldsList(s.target.value))}),e.ALo(2,"translate"),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"mat-autocomplete",19,20),e.NdJ("optionSelected",function(s){e.CHM(n);var l=e.oxw();return e.KtG(l.changeField(s.option.id))}),e.YNc(10,tC,2,4,"mat-option",21),e.ALo(11,"async"),e.qZA(),e.YNc(12,nC,2,1,"button",22),e.qZA()}if(2&i){var t=e.MAs(9),o=e.oxw();e.Q6J("floatLabel",o.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,8,"igo.geo.sourceFields.selectField"))("disabled",!o.currentFilter.active)("matAutocomplete",t)("value",e.lcZ(3,10,o.selectedField$)?e.lcZ(4,12,o.selectedField$).alias:"")("matTooltip",e.lcZ(5,14,o.selectedField$)?e.lcZ(6,16,o.selectedField$).alias:e.lcZ(7,18,"igo.geo.sourceFields.selectField")),e.xp6(9),e.Q6J("ngForOf",e.lcZ(11,20,o.filteredFields$)),e.xp6(2),e.Q6J("ngIf",o.currentFilter.propertyName&&"selectField"===o.inputClearable&&o.currentFilter.active)}}function iC(i,a){if(1&i&&(e.TgZ(0,"mat-option",3),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n.key)("matTooltip",e.lcZ(1,3,"igo.geo.operators.tooltip."+n.key)),e.xp6(2),e.hij(" ",e.lcZ(3,5,"igo.geo.operators."+n.key)," ")}}function rC(i,a){if(1&i&&(e.TgZ(0,"mat-option",29),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n.type),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.spatialSelector."+n.type)," ")}}function aC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-form-field",26)(1,"mat-select",27),e.NdJ("selectionChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.changeSpatialSelector(r.value))}),e.YNc(2,rC,3,4,"mat-option",28),e.qZA()()}if(2&i){var t=e.oxw();e.xp6(1),e.Q6J("disabled",!t.currentFilter.active)("value",t.currentFilter.igoSpatialSelector),e.xp6(1),e.Q6J("ngForOf",t.igoSpatialSelectors)}}function sC(i,a){if(1&i&&(e.TgZ(0,"mat-option",33),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n)("matTooltip",n),e.xp6(1),e.hij(" ",n," ")}}function lC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",24),e.NdJ("click",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.clearProperty())}),e._UZ(1,"mat-icon",25),e.qZA()}if(2&i){var t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active)}}function cC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-form-field",30),e.NdJ("mouseenter",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.inputClearable="selectProperty")})("mouseleave",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.inputClearable=void 0)}),e.TgZ(1,"input",18),e.NdJ("input",function(s){e.CHM(n);var l=e.oxw();return e.KtG(l.updateValuesList(s.target.value))}),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"mat-autocomplete",19,31),e.NdJ("optionSelected",function(s){e.CHM(n);var l=e.oxw();return e.KtG(l.changeProperty(s.option.value))}),e.YNc(5,sC,2,3,"mat-option",32),e.ALo(6,"async"),e.qZA(),e.YNc(7,lC,2,1,"button",22),e.qZA()}if(2&i){var t=e.MAs(4),o=e.oxw();e.Q6J("floatLabel",o.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,8,"igo.geo.filter.placeholder"))("disabled",!o.currentFilter.active)("matAutocomplete",t)("value","expression"===o.detectProperty()?o.currentFilter.expression:o.currentFilter.pattern)("matTooltip","expression"===o.detectProperty()?o.currentFilter.expression||"":o.currentFilter.pattern||""),e.xp6(4),e.Q6J("ngForOf",e.lcZ(6,10,o.filteredValues$)),e.xp6(2),e.Q6J("ngIf",o.isClearable()&&"selectProperty"===o.inputClearable&&o.currentFilter.active)}}function uC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",24),e.NdJ("click",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.currentFilter.igoSNRC="")}),e._UZ(1,"mat-icon",25),e.qZA()}if(2&i){var t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active&&"selectSNRC"===t.inputClearable&&t.currentFilter.active)}}function pC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-form-field",34),e.NdJ("mouseenter",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.inputClearable="selectSNRC")})("mouseleave",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.inputClearable=void 0)}),e.TgZ(1,"input",35),e.NdJ("input",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.changeSNRC(r.target.value))}),e.ALo(2,"translate"),e.qZA(),e.YNc(3,uC,2,1,"button",22),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("floatLabel",t.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,5,"igo.geo.filter.placeholderSnrc"))("value",t.currentFilter.igoSNRC)("matTooltip",t.currentFilter.igoSNRC?t.currentFilter.igoSNRC:""),e.xp6(2),e.Q6J("ngIf",t.currentFilter.igoSNRC)}}function dC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",37),e.NdJ("click",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.changeMapExtentGeometry())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",38),e.qZA()}if(2&i){var t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active)("disabled",!t.currentFilter.active)("matTooltip",e.lcZ(1,3,"igo.geo.spatialSelector.btnSetExtent"))}}function gC(i,a){if(1&i&&(e.ynx(0),e.YNc(1,dC,3,5,"button",36),e.BQk()),2&i){var n=e.oxw();e.xp6(1),e.Q6J("ngIf","fixedExtent"===n.currentFilter.igoSpatialSelector)}}function fC(i,a){if(1&i&&(e.TgZ(0,"mat-option",33),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n)("matTooltip",n),e.xp6(1),e.hij(" ",n," ")}}function mC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",24),e.NdJ("click",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.clearProperty(1))}),e._UZ(1,"mat-icon",25),e.qZA()}if(2&i){var t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active)}}function hC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-form-field",39),e.NdJ("mouseenter",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.inputClearable="selectProperty1")})("mouseleave",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.inputClearable=void 0)}),e.TgZ(1,"input",40),e.NdJ("input",function(s){e.CHM(n);var l=e.oxw();return e.KtG(l.updateValuesList(s.target.value,1))}),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"mat-autocomplete",19,41),e.NdJ("optionSelected",function(s){e.CHM(n);var l=e.oxw();return e.KtG(l.changeNumericProperty(s.option.value,1))}),e.YNc(5,fC,2,3,"mat-option",32),e.ALo(6,"async"),e.qZA(),e.YNc(7,mC,2,1,"button",22),e.qZA()}if(2&i){var t=e.MAs(4),o=e.oxw();e.Q6J("floatLabel",o.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,7,"igo.geo.filter.placeholder"))("disabled",!o.currentFilter.active)("matAutocomplete",t)("value","lowerBoundary"===o.detectProperty(1)?o.currentFilter.lowerBoundary:o.currentFilter.begin),e.xp6(4),e.Q6J("ngForOf",e.lcZ(6,9,o.filteredValues$)),e.xp6(2),e.Q6J("ngIf",o.isClearable(1)&&"selectProperty1"===o.inputClearable&&o.currentFilter.active)}}function vC(i,a){if(1&i&&(e.TgZ(0,"mat-option",33),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n)("matTooltip",n),e.xp6(1),e.hij(" ",n," ")}}function yC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",24),e.NdJ("click",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.clearProperty(2))}),e._UZ(1,"mat-icon",25),e.qZA()}if(2&i){var t=e.oxw(2);e.Q6J("disabled",!t.currentFilter.active)}}function _C(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-form-field",39),e.NdJ("mouseenter",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.inputClearable="selectProperty2")})("mouseleave",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.inputClearable=void 0)}),e.TgZ(1,"input",40),e.NdJ("input",function(s){e.CHM(n);var l=e.oxw();return e.KtG(l.updateValuesList(s.target.value,2))}),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"mat-autocomplete",19,42),e.NdJ("optionSelected",function(s){e.CHM(n);var l=e.oxw();return e.KtG(l.changeNumericProperty(s.option.value,2))}),e.YNc(5,vC,2,3,"mat-option",32),e.ALo(6,"async"),e.qZA(),e.YNc(7,yC,2,1,"button",22),e.qZA()}if(2&i){var t=e.MAs(4),o=e.oxw();e.Q6J("floatLabel",o.floatLabel),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,7,"igo.geo.filter.placeholder"))("disabled",!o.currentFilter.active)("matAutocomplete",t)("value","upperBoundary"===o.detectProperty(2)?o.currentFilter.upperBoundary:o.currentFilter.end),e.xp6(4),e.Q6J("ngForOf",e.lcZ(6,9,o.filteredValues$)),e.xp6(2),e.Q6J("ngIf",o.isClearable(2)&&"selectProperty2"===o.inputClearable&&o.currentFilter.active)}}function bC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-ogc-filter-time",43),e.NdJ("datasourceChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.datasource=r)})("currentFilterChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.currentFilter=r)})("changeProperty",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.changeProperty(r.value,r.pos))}),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("datasource",t.datasource)("currentFilter",t.currentFilter)}}var CC=function(a,n){return{logical:a,logicalHidden:n}},SC=function(a,n){return{operator:a,dualInput:n}},wC=function(){return["expression","pattern"]},TC=function(){return["lowerBoundary","begin"]},xC=function(){return["upperBoundary","end"]},Cu=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.wktService=n,this.ogcFilterOperator=G,this.ogcFilterOperators$=new x.X(void 0),this.value="",this.selectedField$=new x.X(void 0),this.fields$=new x.X([]),this.color="primary",this.currentFilterIsSpatial$=new x.X(!1),this.defaultStepMillisecond=6e3,this._snrc="",this.floatLabel="never",this.allOgcFilterOperators=(new jt).operators,this.ogcFilterOperators$.next(this.allOgcFilterOperators),this.igoSpatialSelectors=[{type:"fixedExtent"},{type:"snrc"}]}return(0,v.Z)(a,[{key:"snrc",get:function(){return this._snrc},set:function(t){(/^\d{2}$/gi.test(t)||/^\d{2}[a-p]$/gi.test(t)||/^\d{2}[a-l][0,1][0-9]$/gi.test(t))&&(this._snrc=t,this.currentFilter.igoSNRC=t)}},{key:"activeFilters",get:function(){return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(t){return!0===t.active})}},{key:"allowedOperators",get:function(){return(new jt).computeAllowedOperators(this.fields$.value,this.currentFilter.propertyName,this.datasource.options.ogcFilters.allowedOperatorsType)}},{key:"ngOnInit",value:function(){var t=this;if(this.datasource.options.sourceFields){var o=this.datasource.options.sourceFields.filter(function(r){return void 0===r.excludeFromOgcFilters||!r.excludeFromOgcFilters});o.map(function(r){r.values&&r.values.sort()}),this.fields$.next(o)}this.updateFieldsList(),this.selectedField$.next(this.fields$.value.find(function(r){return r.name===t.currentFilter.propertyName})),this.updateValuesList(),this.selectedField$.subscribe(function(r){t.ogcFilterOperators$.next(t.allowedOperators),-1===Object.keys(t.allowedOperators).indexOf(t.currentFilter.operator)&&(t.currentFilter.operator=Object.keys(t.allowedOperators)[0],t.currentFilter.operator=Object.keys(t.allowedOperators)[0]),t.updateValuesList()}),this.currentFilterIsSpatial()}},{key:"updateFieldsList",value:function(t){this.filteredFields$=t&&t.length>0?(0,ge.of)(this._filterFields(t)):this.fields$,this.fields$.value.find(function(o){return o.name===t})&&this.changeField(t)}},{key:"updateValuesList",value:function(t,o){this.filteredValues$=(0,ge.of)(t&&t.length>0?this._filterValues(t):this.selectedField$.value?this.selectedField$.value.values:[]),t&&t.length>=1&&this.changeProperty(t,o)}},{key:"_filterFields",value:function(t){var o=new RegExp(t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),"gi");return this.fields$.value.filter(function(r){return o.test(r.alias.normalize("NFD").replace(/[\u0300-\u036f]/g,""))})}},{key:"_filterValues",value:function(t){var o=new RegExp(t.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,""),"gi");return this.selectedField$.value.values.filter(function(r){return r&&o.test(r.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,""))})}},{key:"clearSelectedField",value:function(){this.currentFilter.propertyName="",this.selectedField$.next(void 0),this.clearProperty()}},{key:"isClearable",value:function(t){var o=this.detectProperty(t);if(o)return this.currentFilter[o]}},{key:"clearProperty",value:function(t){var o=this.detectProperty(t);if(o)return this.currentFilter[o]=""}},{key:"toggleFilterState",value:function(t){var o=this;this.datasource.options.ogcFilters.interfaceOgcFilters.find(function(r){return r.filterid===o.currentFilter.filterid}).active=t.checked,this.refreshFilters()}},{key:"deleteFilter",value:function(){var t=this,o=this.datasource.options.ogcFilters;o.interfaceOgcFilters=o.interfaceOgcFilters.filter(function(r){return r.filterid!==t.currentFilter.filterid}),this.refreshFilters()}},{key:"changeLogical",value:function(t){this.currentFilter.parentLogical=t,this.refreshFilters()}},{key:"changeOperator",value:function(t){this.currentFilter.operator=t,this.currentFilterIsSpatial(),this.currentFilterIsSpatial$.value&&0===this.currentFilter.wkt_geometry.length?this.changeSpatialSelector(this.currentFilter.igoSpatialSelector):this.refreshFilters()}},{key:"changeField",value:function(t){var o=this;this.currentFilter.propertyName=t,this.selectedField$.next(this.fields$.value.find(function(r){return r.name===o.currentFilter.propertyName})),this.refreshFilters()}},{key:"changeCaseSensitive",value:function(t){this.currentFilter.matchCase=t.checked,this.refreshFilters()}},{key:"changeProperty",value:function(t,o){var r=this,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],l=this.detectProperty(o);l&&(this.datasource.options.ogcFilters.interfaceOgcFilters.find(function(c){return c.filterid===r.currentFilter.filterid})[l]=t,s&&this.refreshFilters())}},{key:"changeNumericProperty",value:function(t,o){this.changeProperty(parseFloat(t),o)}},{key:"changeSpatialSelector",value:function(t){this.currentFilter.igoSpatialSelector=t,"fixedExtent"===t&&this.changeMapExtentGeometry(!1),this.currentFilterIsSpatial(),this.refreshFilters()}},{key:"changeSNRC",value:function(t){this.snrc=t,this.changeSNRCGeometry()}},{key:"changeSNRCGeometry",value:function(){var t=this;!this.datasource.options.ogcFilters.interfaceOgcFilters.find(function(r){return r.filterid===t.currentFilter.filterid})||(this.snrc&&"snrc"===this.currentFilter.igoSpatialSelector&&(this.currentFilter.wkt_geometry=this.wktService.snrcToWkt(this.snrc,this.map.projection).wktPoly),this.refreshFilters())}},{key:"changeMapExtentGeometry",value:function(){var t=this,o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=this.datasource.options.ogcFilters.interfaceOgcFilters.find(function(s){return s.filterid===t.currentFilter.filterid});!r||("fixedExtent"===this.currentFilter.igoSpatialSelector&&(this.currentFilter.wkt_geometry=this.wktService.extentToWkt(this.map.projection,this.map.viewController.getExtent(),this.map.projection).wktPoly),o&&this.refreshFilters())}},{key:"detectProperty",value:function(t){switch(this.currentFilter.operator){case G.PropertyIsNotEqualTo:case G.PropertyIsEqualTo:case G.PropertyIsGreaterThan:case G.PropertyIsGreaterThanOrEqualTo:case G.PropertyIsLessThan:case G.PropertyIsLessThanOrEqualTo:return"expression";case G.PropertyIsLike:return"pattern";case G.PropertyIsBetween:return t&&1===t?"lowerBoundary":t&&2===t?"upperBoundary":void 0;case G.During:return t&&1===t?"begin":t&&2===t?"end":void 0;default:return}}},{key:"currentFilterIsSpatial",value:function(){var t=!1;this.currentFilter&&(t=-1!==[G.Contains,G.Intersects,G.Within].indexOf(this.currentFilter.operator)),this.currentFilterIsSpatial$.next(t)}},{key:"isTemporalOperator",value:function(){return this.currentFilter.operator.toLowerCase()===this.ogcFilterOperator.During.toLowerCase()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(eC))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filter-form"]],inputs:{refreshFilters:"refreshFilters",datasource:"datasource",map:"map",currentFilter:"currentFilter",floatLabel:"floatLabel"},decls:42,vars:76,consts:[["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","checked","click","change"],[3,"ngClass"],["tooltip-position","above","matTooltipShowDelay","500",3,"disabled","value","matTooltip","selectionChange"],["tooltip-position","above","matTooltipShowDelay","500",3,"value","matTooltip"],["class","field",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[3,"ngClass","floatLabel"],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","value","selectionChange"],["tooltip-position","above","matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["class","spatialSelector",4,"ngIf"],["class","singleInput",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[1,"igo-layer-button-group"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","delete"],["class","snrc",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[4,"ngIf"],["class","dualInput",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[3,"datasource","currentFilter","datasourceChange","currentFilterChange","changeProperty",4,"ngIf"],[1,"field",3,"floatLabel","mouseenter","mouseleave"],["matInput","","tooltip-position","above","matTooltipShowDelay","500",3,"placeholder","disabled","matAutocomplete","value","matTooltip","input"],[3,"optionSelected"],["autoCompleteField","matAutocomplete"],["matTooltipShowDelay","500",3,"value","id","matTooltip",4,"ngFor","ngForOf"],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear",3,"disabled","click",4,"ngIf"],["matTooltipShowDelay","500",3,"value","id","matTooltip"],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear",3,"disabled","click"],["svgIcon","close"],[1,"spatialSelector"],[3,"disabled","value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"singleInput",3,"floatLabel","mouseenter","mouseleave"],["autoCompleteValues","matAutocomplete"],["matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["matTooltipShowDelay","500",3,"value","matTooltip"],[1,"snrc",3,"floatLabel","mouseenter","mouseleave"],["matInput","","tooltip-position","above","matTooltipShowDelay","500",3,"placeholder","value","matTooltip","input"],["mat-button","","matSuffix","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click",4,"ngIf"],["mat-button","","matSuffix","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click"],["svgIcon","arrow-expand-all"],[1,"dualInput",3,"floatLabel","mouseenter","mouseleave"],["matInput","","type","number",3,"placeholder","disabled","matAutocomplete","value","input"],["autoDualValueOperator1","matAutocomplete"],["autoDualValueOperator2","matAutocomplete"],[3,"datasource","currentFilter","datasourceChange","currentFilterChange","changeProperty"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-checkbox",0),e.NdJ("click",function(r){return r.stopPropagation()})("change",function(r){return t.toggleFilterState(r)}),e.ALo(1,"translate"),e.qZA(),e.TgZ(2,"mat-form-field",1)(3,"mat-select",2),e.NdJ("selectionChange",function(r){return t.changeLogical(r.value)}),e.ALo(4,"translate"),e.TgZ(5,"mat-option",3),e.ALo(6,"translate"),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"mat-option",3),e.ALo(10,"translate"),e._uU(11),e.ALo(12,"translate"),e.qZA()()(),e.YNc(13,oC,13,22,"mat-form-field",4),e.ALo(14,"async"),e.ALo(15,"async"),e.ALo(16,"async"),e.ALo(17,"async"),e.TgZ(18,"mat-form-field",5),e.ALo(19,"async"),e.ALo(20,"async"),e.TgZ(21,"mat-select",6),e.NdJ("selectionChange",function(r){return t.changeOperator(r.value)}),e.ALo(22,"translate"),e.ALo(23,"translate"),e.YNc(24,iC,4,7,"mat-option",7),e.ALo(25,"keyvalue"),e.ALo(26,"async"),e.qZA()(),e.YNc(27,aC,3,3,"mat-form-field",8),e.ALo(28,"async"),e.YNc(29,cC,8,12,"mat-form-field",9),e.TgZ(30,"div",10)(31,"button",11),e.NdJ("click",function(){return t.deleteFilter()}),e.ALo(32,"translate"),e._UZ(33,"mat-icon",12),e.qZA()(),e.YNc(34,pC,4,7,"mat-form-field",13),e.ALo(35,"async"),e.YNc(36,gC,2,1,"ng-container",14),e.ALo(37,"async"),e._UZ(38,"br"),e.YNc(39,hC,8,11,"mat-form-field",15),e.YNc(40,_C,8,11,"mat-form-field",15),e.YNc(41,bC,1,2,"igo-ogc-filter-time",16)),2&n&&(e.Q6J("matTooltip",e.lcZ(1,27,"igo.geo.filter.toggleFilterState"))("checked",t.currentFilter.active),e.xp6(2),e.Q6J("ngClass",e.WLB(67,CC,0!==t.activeFilters.indexOf(t.currentFilter)&&!0===t.currentFilter.active,0===t.activeFilters.indexOf(t.currentFilter)||!0!==t.currentFilter.active)),e.xp6(1),e.Q6J("disabled",!t.currentFilter.active)("value",t.currentFilter.parentLogical)("matTooltip",t.currentFilter.parentLogical?e.lcZ(4,29,"igo.geo.operators.tooltip."+t.currentFilter.parentLogical):""),e.xp6(2),e.Q6J("value",t.ogcFilterOperator.And)("matTooltip",e.lcZ(6,31,"igo.geo.operators.tooltip.And")),e.xp6(2),e.hij(" ",e.lcZ(8,33,"igo.geo.operators.And")," "),e.xp6(2),e.Q6J("value",t.ogcFilterOperator.Or)("matTooltip",e.lcZ(10,35,"igo.geo.operators.tooltip.Or")),e.xp6(2),e.hij(" ",e.lcZ(12,37,"igo.geo.operators.Or")," "),e.xp6(2),e.Q6J("ngIf",!1===e.lcZ(14,39,t.currentFilterIsSpatial$)&&e.lcZ(15,41,t.fields$)&&e.lcZ(16,43,t.fields$).length>0&&""!==e.lcZ(17,45,t.fields$)[0].name),e.xp6(5),e.Q6J("ngClass",e.WLB(70,SC,!1===e.lcZ(19,47,t.currentFilterIsSpatial$),e.lcZ(20,49,t.currentFilterIsSpatial$)))("floatLabel",t.floatLabel),e.xp6(3),e.Q6J("matTooltip",t.currentFilter.operator?e.lcZ(22,51,"igo.geo.operators.tooltip."+t.currentFilter.operator):e.lcZ(23,53,"igo.geo.filter.selectOperator"))("disabled",!t.currentFilter.active)("value",t.currentFilter.operator),e.xp6(3),e.Q6J("ngForOf",e.lcZ(25,55,e.lcZ(26,57,t.ogcFilterOperators$))),e.xp6(3),e.Q6J("ngIf",e.lcZ(28,59,t.currentFilterIsSpatial$)),e.xp6(2),e.Q6J("ngIf",-1!==e.DdM(73,wC).indexOf(t.detectProperty())),e.xp6(2),e.Q6J("matTooltip",e.lcZ(32,61,"igo.geo.filter.removeFilter")),e.xp6(3),e.Q6J("ngIf",e.lcZ(35,63,t.currentFilterIsSpatial$)&&"snrc"===t.currentFilter.igoSpatialSelector),e.xp6(2),e.Q6J("ngIf",e.lcZ(37,65,t.currentFilterIsSpatial$)&&"fixedExtent"===t.currentFilter.igoSpatialSelector),e.xp6(3),e.Q6J("ngIf",!t.isTemporalOperator()&&-1!==e.DdM(74,TC).indexOf(t.detectProperty(1))),e.xp6(1),e.Q6J("ngIf",!t.isTemporalOperator()&&-1!==e.DdM(75,xC).indexOf(t.detectProperty(2))),e.xp6(1),e.Q6J("ngIf",t.isTemporalOperator()))},styles:["[_nghost-%COMP%]{width:100%;padding:5px 10px}  .mat-form-field .mat-icon svg{width:1em;height:1em;color:#d3d3d3}.mat-form-field[_ngcontent-%COMP%]{width:100%}.mat-select-arrow[_ngcontent-%COMP%]{visibility:hidden}.mat-slide-toggle[_ngcontent-%COMP%]{margin-top:10px}.logical[_ngcontent-%COMP%]{flex-flow:column nowrap;width:10%;max-width:45px;margin-left:5px}.logicalHidden[_ngcontent-%COMP%]{flex-flow:column nowrap;width:10%;visibility:hidden;max-width:45px;margin-left:5px}  .logical .mat-select-arrow{visibility:hidden}  .logicalHidden .mat-select-arrow{visibility:hidden}.field[_ngcontent-%COMP%]{width:20%}  .field .mat-select-arrow{visibility:hidden}.operator[_ngcontent-%COMP%]{width:12%;margin-left:10px;text-align:center}  .operator .mat-select-arrow{visibility:hidden}.spatialSelector[_ngcontent-%COMP%]{width:15%;margin-left:5px}  .spatialSelector .mat-select-arrow{visibility:hidden}.singleInput[_ngcontent-%COMP%]{width:30%;margin-left:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.singleInput[_ngcontent-%COMP%]{width:27%}}.snrc[_ngcontent-%COMP%]{width:20%;margin-left:5px}  .singleInput .mat-select-arrow{visibility:hidden}.dualInput[_ngcontent-%COMP%]{width:20%;margin-left:5px}  .dualInput .mat-select-arrow{visibility:hidden}.igo-layer-button-group[_ngcontent-%COMP%]{display:flex;float:right;padding-top:5px}.container[_ngcontent-%COMP%]{display:flex}"]}),i}();function kC(i,a){if(1&i&&e._UZ(0,"igo-ogc-filter-selection",2),2&i){var n=e.oxw();e.Q6J("refreshFilters",n.refreshFunc)("datasource",n.datasource)("map",n.map)("currentFilter",n.currentFilter)}}function MC(i,a){if(1&i&&e._UZ(0,"igo-ogc-filter-form",4),2&i){var n=a.$implicit,t=e.oxw(2);e.Q6J("currentFilter",n)("refreshFilters",t.refreshFunc)("datasource",t.datasource)("map",t.map)}}function FC(i,a){if(1&i&&e.YNc(0,MC,1,4,"ng-template",3),2&i){var n=e.oxw();e.Q6J("ngForOf",n.datasource.options.ogcFilters.interfaceOgcFilters)}}var Su=function(){var i=function(){function a(){(0,h.Z)(this,a),this.color="primary"}return(0,v.Z)(a,[{key:"refreshFunc",get:function(){return this.refreshFilters}},{key:"advancedOgcFilters",get:function(){if(this.datasource.options.ogcFilters)return this.datasource.options.ogcFilters.advancedOgcFilters}},{key:"currentFilter",get:function(){return this.datasource.options.ogcFilters.interfaceOgcFilters?this.datasource.options.ogcFilters.interfaceOgcFilters[0]:void 0}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filterable-form"]],inputs:{datasource:"datasource",map:"map",refreshFilters:"refreshFilters"},decls:2,vars:2,consts:[["igoListItem","",3,"refreshFilters","datasource","map","currentFilter",4,"ngIf"],[4,"ngIf"],["igoListItem","",3,"refreshFilters","datasource","map","currentFilter"],["ngFor","",3,"ngForOf"],[3,"currentFilter","refreshFilters","datasource","map"]],template:function(n,t){1&n&&(e.YNc(0,kC,1,4,"igo-ogc-filter-selection",0),e.YNc(1,FC,1,1,null,1)),2&n&&(e.Q6J("ngIf",!t.advancedOgcFilters),e.xp6(1),e.Q6J("ngIf",t.advancedOgcFilters&&t.datasource.options.ogcFilters.editable))},encapsulation:2}),i}();function ZC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-icon",9),e.NdJ("click",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.toggleFiltersCollapsed())}),e.qZA()}if(2&i){var t=e.oxw(),o=e.MAs(7);e.Q6J("target",o)("collapsed",t.filtersCollapsed)}}var AC=function(a){return{cursor:a}};function IC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"h4",10),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.toggleLegendOnClick())}),e._uU(1),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("ngStyle",e.VKq(3,AC,t.filtersCollapsed?"default":"pointer"))("matTooltip",t.layer.title),e.xp6(1),e.Oqu(t.layer.title)}}function LC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.addFilterToSequence())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",12),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("disabled",t.addFilterDisabled())("matTooltip",e.lcZ(1,3,"igo.geo.filter.addFilter"))("color",t.color)}}var OC=function(a){return{disabled:a}};function DC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.layer.visible=!r.layer.visible)}),e.ALo(1,"translate"),e.ALo(2,"translate"),e._UZ(3,"mat-icon",14),e.ALo(4,"async"),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.lcZ(1,4,"igo.geo.layer.hideLayer"):e.lcZ(2,6,"igo.geo.layer.showLayer")),e.xp6(3),e.Q6J("ngClass",e.VKq(10,OC,!1===e.lcZ(4,8,t.inResolutionRange$)))("svgIcon",t.layer.visible?"eye":"eye-off")}}function PC(i,a){if(1&i&&e._UZ(0,"igo-layer-legend",18),2&i){var n=e.oxw(2);e.Q6J("layer",n.layer)}}function EC(i,a){if(1&i&&(e.TgZ(0,"div",15,16),e.YNc(2,PC,1,1,"igo-layer-legend",17),e.ALo(3,"async"),e.qZA()),2&i){var n=e.oxw();e.xp6(2),e.Q6J("ngIf",e.lcZ(3,1,n.showLegend$))}}function $C(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"section",19),e._UZ(1,"mat-divider"),e.TgZ(2,"mat-checkbox",20),e.NdJ("change",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.changeOgcFilterType(r))})("ngModelChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.datasource.options.ogcFilters.advancedOgcFilters=r)}),e._uU(3),e.ALo(4,"translate"),e.qZA()()}if(2&i){var t=e.oxw();e.xp6(2),e.Q6J("ngModel",t.datasource.options.ogcFilters.advancedOgcFilters),e.xp6(1),e.hij(" ",e.lcZ(4,2,"igo.geo.filter.advancedOgcFilters")," ")}}var RC=function(a){return{"separate-item":a}},Wi=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.ogcFilterService=n,this.color="primary",this.defaultLogicalParent=G.And,this.hasActiveSpatialFilter=!1,this.filtersAreEditable=!0,this.filtersCollapsed=!0,this.hasSelector=!1,this.showLegend$=new x.X(!1),this.inResolutionRange$=new x.X(!0),this.header=!0,this.ogcFilterWriter=new jt}return(0,v.Z)(a,[{key:"refreshFunc",get:function(){return this.refreshFilters.bind(this)}},{key:"datasource",get:function(){return this.layer.dataSource}},{key:"ngOnInit",value:function(){var t=this;this.layer.visible&&(this.filtersCollapsed=!1);var o=this.datasource.options.ogcFilters;switch((o.pushButtons&&o.pushButtons.bundles.length>0||o.checkboxes&&o.checkboxes.bundles.length>0||o.radioButtons&&o.radioButtons.bundles.length>0||o.select&&o.select.bundles.length>0||o.autocomplete&&o.autocomplete.bundles.length>0)&&(void 0===o.advancedOgcFilters&&(o.advancedOgcFilters=!1),this.hasSelector=!0),this.datasource.options.type){case"wms":this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);break;case"wfs":this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource)}o&&(o.interfaceOgcFilters&&(this.lastRunOgcFilter=JSON.parse(JSON.stringify(o.interfaceOgcFilters)),o.interfaceOgcFilters.filter(function(s){return s.wkt_geometry}).length>=1&&(this.hasActiveSpatialFilter=!0)),this.filtersAreEditable=!!o.editable&&o.editable),this.resolution$$=this.layer.map.viewController.resolution$.subscribe(function(){t.inResolutionRange$.next(t.layer.isInResolutionsRange)})}},{key:"ngOnDestroy",value:function(){this.resolution$$.unsubscribe()}},{key:"addFilterToSequence",value:function(){this.filtersCollapsed=!1;var o=this.datasource.options.ogcFilters.interfaceOgcFilters||[],r=0===o.length?0:o[o.length-1].level,s="",l=this.datasource.options.sourceFields.filter(function(g){return!g.excludeFromOgcFilters});l.length>0&&(s=void 0===l[0].name?"":l[0].name);var c,u=this.datasource.options;u.fieldNameGeometry?c=u.fieldNameGeometry:this.datasource.options.paramsWFS&&this.datasource.options.paramsWFS.fieldNameGeometry&&(c=this.datasource.options.paramsWFS.fieldNameGeometry);var p=this.ogcFilterWriter.computeAllowedOperators(this.datasource.options.sourceFields,s,this.datasource.options.ogcFilters.allowedOperatorsType),d=Object.keys(p)[0];o.push(this.ogcFilterWriter.addInterfaceFilter({propertyName:s,operator:d,active:!0,igoSpatialSelector:"fixedExtent",srsName:this.map.projection},c,r,this.defaultLogicalParent)),this.datasource.options.ogcFilters.interfaceOgcFilters=o}},{key:"refreshFilters",value:function(t){!0===t&&(this.lastRunOgcFilter=void 0);var o=this.datasource.options.ogcFilters,r=o.interfaceOgcFilters?o.interfaceOgcFilters.filter(function(d){return!0===d.active}):[];if(0===r.length&&(o.filters=void 0,o.filtered=!1),r.length>1&&(r[0].parentLogical=r[1].parentLogical),this.hasActiveSpatialFilter=0!==r.filter(function(d){return-1!==["Contains","Intersects","Within"].indexOf(d.operator)}).length,JSON.stringify(this.lastRunOgcFilter)!==JSON.stringify(r)){if("wfs"===this.layer.dataSource.options.type)this.layer.dataSource.options.ogcFilters.filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(r),this.layer.dataSource.ol.refresh();else if("wms"===this.layer.dataSource.options.type&&o.enabled){var c="";if(r.length>=1){var u=this.layer.dataSource,p=u.options.ogcFilters;p.filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(r),c=this.ogcFilterWriter.buildFilter(p.filters,void 0,void 0,this.layer.dataSource.options.fieldNameGeometry,u.options)}this.ogcFilterService.filterByOgc(this.datasource,c),this.datasource.options.ogcFilters.filtered=0!==r.length}this.lastRunOgcFilter=JSON.parse(JSON.stringify(r))}this.layer.dataSource.setOgcFilters(o,!0)}},{key:"setVisible",value:function(){this.layer.visible=!0}},{key:"isAdvancedOgcFilters",value:function(){return this.datasource.options.ogcFilters.advancedOgcFilters}},{key:"addFilterDisabled",value:function(){return!this.datasource.options.sourceFields||0===this.datasource.options.sourceFields.length}},{key:"changeOgcFiltersAdvancedOgcFilters",value:function(t){this.datasource.options.ogcFilters.advancedOgcFilters=t}},{key:"changeOgcFilterType",value:function(t){this.changeOgcFiltersAdvancedOgcFilters(t.checked),t.checked&&this.refreshFilters(!0)}},{key:"toggleLegend",value:function(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}},{key:"toggleLegendOnClick",value:function(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)}},{key:"toggleFiltersCollapsed",value:function(){this.filtersCollapsed=!this.filtersCollapsed}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Os))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filterable-item"]],inputs:{layer:"layer",map:"map",header:"header"},decls:11,vars:12,consts:[[3,"ngClass"],["class","igo-chevron","mat-list-avatar","","igoCollapse","","svgIcon","chevron-up",3,"target","collapsed","click",4,"ngIf"],["matLine","","matTooltipShowDelay","500",3,"ngStyle","matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","color","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["ogcFilters",""],["class","igo-layer-legend-container",4,"ngIf"],[3,"datasource","map","refreshFilters"],["class","mat-typography advancedOgcFilters",4,"ngIf"],["mat-list-avatar","","igoCollapse","","svgIcon","chevron-up",1,"igo-chevron",3,"target","collapsed","click"],["matLine","","matTooltipShowDelay","500",3,"ngStyle","matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","color","click"],["svgIcon","plus"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],[3,"ngClass","svgIcon"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],[3,"layer"],[1,"mat-typography","advancedOgcFilters"],["labelPosition","before",3,"ngModel","change","ngModelChange"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"mat-list-item"),e.YNc(2,ZC,1,2,"mat-icon",1),e.YNc(3,IC,2,5,"h4",2),e.YNc(4,LC,3,5,"button",3),e.YNc(5,DC,5,12,"button",4),e.qZA(),e.TgZ(6,"div",null,5),e.YNc(8,EC,4,3,"div",6),e._UZ(9,"igo-ogc-filterable-form",7),e.YNc(10,$C,5,4,"section",8),e.qZA()()),2&n&&(e.Q6J("ngClass",e.VKq(10,RC,!0===t.header)),e.xp6(2),e.Q6J("ngIf",t.header),e.xp6(1),e.Q6J("ngIf",t.header),e.xp6(1),e.Q6J("ngIf",t.isAdvancedOgcFilters()&&t.filtersAreEditable),e.xp6(1),e.Q6J("ngIf",t.header),e.xp6(3),e.Q6J("ngIf",t.header),e.xp6(1),e.Q6J("datasource",t.datasource)("map",t.map)("refreshFilters",t.refreshFunc),e.xp6(1),e.Q6J("ngIf",t.hasSelector&&t.filtersAreEditable))},styles:["[_nghost-%COMP%]{overflow:hidden}.advancedOgcFilters[_ngcontent-%COMP%]{text-align:center;width:100%;display:inline-block}.mat-list-item[_ngcontent-%COMP%]{height:auto}.igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:1.125em;width:calc(100% - 18px)}mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}.separate-item[_ngcontent-%COMP%]{border-bottom:4px solid darkgrey}"]}),i}();function JC(i,a){1&i&&(e.TgZ(0,"div",3),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"igo.geo.filter.noFilterableLayer")))}function BC(i,a){if(1&i&&e._UZ(0,"igo-ogc-filterable-item",4),2&i){var n=a.$implicit;e.Q6J("header",!0)("layer",n)("map",n.map)}}var Vr=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filterable-list"]],inputs:{layers:"layers",map:"map"},decls:5,vars:10,consts:[[3,"navigation","selection"],["id","no-layer-message",4,"ngIf"],["ngFor","",3,"ngForOf"],["id","no-layer-message"],["igoListItem","",3,"header","layer","map"]],template:function(n,t){1&n&&(e.TgZ(0,"igo-list",0),e.YNc(1,JC,3,3,"div",1),e.ALo(2,"filterableDataSource"),e.YNc(3,BC,1,3,"ng-template",2),e.ALo(4,"filterableDataSource"),e.qZA()),2&n&&(e.Q6J("navigation",!1)("selection",!1),e.xp6(1),e.Q6J("ngIf",0===e.xi3(2,4,t.layers,"ogc").length),e.xp6(2),e.Q6J("ngForOf",e.xi3(4,7,t.layers,"ogc")))},styles:["#no-layer-message[_ngcontent-%COMP%]{padding:7%;text-align:center;font-size:medium;font-weight:700}"],changeDetection:0}),i}();function NC(i,a){if(1&i&&(e.TgZ(0,"button",2),e.ALo(1,"translate"),e._UZ(2,"mat-icon",3),e.qZA()),2&i){var n=e.oxw();e.Q6J("matTooltip",e.lcZ(1,3,"igo.geo.filter.filterBy"))("color",n.color),e.xp6(2),e.Q6J("matBadge",n.badge)}}function qC(i,a){if(1&i&&e._UZ(0,"igo-ogc-filterable-item",7),2&i){var n=e.oxw(2);e.Q6J("header",!1)("map",n.layer.map)("layer",n.layer)}}function GC(i,a){if(1&i&&(e.TgZ(0,"div",4,5),e.YNc(2,qC,1,3,"igo-ogc-filterable-item",6),e.qZA()),2&i){var n=e.oxw();e.xp6(2),e.Q6J("ngIf",n.ogcFilterCollapse&&n.options.ogcFilters.enabled)}}var Ki=function(){var i=function(){function a(){(0,h.Z)(this,a),this.color="primary",this.ogcFilterCollapse=!1}return(0,v.Z)(a,[{key:"badge",get:function(){var t,o,r,s,l,c=this.options.ogcFilters,u=0;if(c&&!c.advancedOgcFilters){if(c.pushButtons){var d=c.pushButtons.groups.find(function(P){return P.enabled}),g=0;d&&(null===(t=d.computedSelectors)||void 0===t||t.map(function(P){var Y;return g+=null===(Y=P.selectors)||void 0===Y?void 0:Y.filter(function(pe){return pe.enabled}).length})),u+=g}if(c.checkboxes){var m=c.checkboxes.groups.find(function(P){return P.enabled}),y=0;m&&(null===(o=m.computedSelectors)||void 0===o||o.map(function(P){var Y;return y+=null===(Y=P.selectors)||void 0===Y?void 0:Y.filter(function(pe){return pe.enabled}).length})),u+=y}if(c.radioButtons){var b=c.radioButtons.groups.find(function(P){return P.enabled}),w=0;b&&(null===(r=b.computedSelectors)||void 0===r||r.map(function(P){var Y;return w+=null===(Y=P.selectors)||void 0===Y?void 0:Y.filter(function(pe){return pe.enabled}).length})),u+=w}if(c.select){var M=c.select.groups.find(function(P){return P.enabled}),A=0;M&&(null===(s=M.computedSelectors)||void 0===s||s.map(function(P){var Y;return A+=null===(Y=P.selectors)||void 0===Y?void 0:Y.filter(function(pe){return pe.enabled}).length})),u+=A}if(c.autocomplete){var Z=c.autocomplete.groups.find(function(P){return P.enabled}),R=0;Z&&(null===(l=Z.computedSelectors)||void 0===l||l.map(function(P){var Y;return R+=null===(Y=P.selectors)||void 0===Y?void 0:Y.filter(function(pe){return pe.enabled}).length})),u+=R}}else{if(c&&c.filters&&!c.filters.filters)return 1;if(c&&c.filters&&c.filters.filters)return c.filters.filters.length}if(c.filters&&"During"===c.filters.operator&&c.filters.active&&c.interfaceOgcFilters&&c.interfaceOgcFilters[0].active){var V=c.interfaceOgcFilters[0];c.filters.calendarModeYear?(V.begin.substring(0,4)!==this.options.minDate.substring(0,4)||V.end.substring(0,4)!==this.options.maxDate.substring(0,4))&&(u+=1):(V.begin!==this.options.minDate||V.end!==this.options.maxDate)&&(u+=1)}return u>0?u:void 0}},{key:"layer",get:function(){return this._layer},set:function(t){this._layer=t,t&&(this.options=this.layer.dataSource.options)}},{key:"ngOnInit",value:function(){this.options=this.layer.dataSource.options}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filter-button"]],inputs:{layer:"layer",map:"map",color:"color",header:"header"},decls:2,vars:2,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["class","igo-layer-actions-container",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["matBadgeColor","warn","matBadgeSize","medium","svgIcon","filter",3,"matBadge"],[1,"igo-layer-actions-container"],["ogcFilter",""],["igoListItem","",3,"header","map","layer",4,"ngIf"],["igoListItem","",3,"header","map","layer"]],template:function(n,t){1&n&&(e.YNc(0,NC,3,5,"button",0),e.YNc(1,GC,3,1,"div",1)),2&n&&(e.Q6J("ngIf",t.header&&t.options.ogcFilters&&t.options.ogcFilters.enabled&&(t.options.ogcFilters.pushButtons||t.options.ogcFilters.checkboxes||t.options.ogcFilters.radioButtons||t.options.ogcFilters.select||t.options.ogcFilters.autocomplete||t.options.ogcFilters.editable)),e.xp6(1),e.Q6J("ngIf",t.options.ogcFilters&&t.options.ogcFilters.enabled&&(t.options.ogcFilters.pushButtons||t.options.ogcFilters.checkboxes||t.options.ogcFilters.radioButtons||t.options.ogcFilters.select||t.options.ogcFilters.autocomplete||t.options.ogcFilters.editable)))},changeDetection:0}),i}(),$s=function(){var i=function(){function a(){(0,h.Z)(this,a),this.defaultStepMillisecond=6e4}return(0,v.Z)(a,[{key:"step",value:function(t,o){return t.options.stepDate?t.options.stepDate:o.step}},{key:"stepMillisecond",value:function(t,o){var r=H.duration(this.step(t,o)).asMilliseconds();return 0===r?this.defaultStepMillisecond:r}},{key:"stepIsYearDuration",value:function(t){var o=H.duration(t);return 0!==o.years()&&0===o.months()&&0===o.weeks()&&0===o.days()&&0===o.hours()&&0===o.minutes()}},{key:"stepIsMonthDuration",value:function(t){var o=H.duration(t);return 0!==o.months()&&0===o.weeks()&&0===o.days()&&0===o.hours()&&0===o.minutes()}},{key:"stepIsWeekDuration",value:function(t){var o=H.duration(t);return 0!==o.weeks()&&7===o.days()&&0===o.hours()&&0===o.minutes()}},{key:"stepIsDayDuration",value:function(t){var o=H.duration(t);return 0!==o.days()&&0===o.hours()&&0===o.minutes()}},{key:"stepIsHourDuration",value:function(t){var o=H.duration(t);return 0!==o.hours()&&0===o.minutes()}},{key:"stepIsMinuteDuration",value:function(t){return 0!==H.duration(t).minutes()}},{key:"dateToNumber",value:function(t){var o=new Date;return t&&(o=new Date(t)),o.getTime()}},{key:"addStep",value:function(t,o){return H(t).add(o,"milliseconds").toDate()}},{key:"subtractStep",value:function(t,o){return H(t).subtract(o,"milliseconds").toDate()}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i}(),QC=["selection"];function YC(i,a){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.hij("",n.title," ")}}function jC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field")(2,"mat-select",11),e.NdJ("valueChange",function(r){e.CHM(n);var s=e.oxw(3);return e.KtG(s.currentPushButtonsGroup=r)}),e.ALo(3,"translate"),e.YNc(4,YC,2,2,"mat-option",12),e.qZA()()()}if(2&i){var t=e.oxw(3);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("value",t.currentPushButtonsGroup),e.xp6(2),e.Q6J("ngForOf",t.getPushButtonsGroups())}}function HC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-button-toggle",16),e.NdJ("change",function(){var l=e.CHM(n).$implicit,c=e.oxw(3).$implicit,u=e.oxw();return e.KtG(u.onSelectionChange(l,c.selectorType))}),e._uU(1),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw(4);e.Q6J("matTooltip",o.getToolTip(t))("ngStyle",o.getButtonColor(t))("checked",t.enabled)("value",t),e.xp6(1),e.hij("",t.title," ")}}function VC(i,a){if(1&i&&(e.ynx(0),e.TgZ(1,"h4"),e._uU(2),e.qZA(),e.TgZ(3,"mat-button-toggle-group",14),e.YNc(4,HC,2,5,"mat-button-toggle",15),e.qZA(),e.BQk()),2&i){var n=a.$implicit,t=e.oxw(3);e.xp6(2),e.Oqu(n.title),e.xp6(1),e.s9C("vertical",t.bundleIsVertical(n)),e.xp6(1),e.Q6J("ngForOf",n.selectors)}}function zC(i,a){if(1&i&&(e.TgZ(0,"div",8),e._UZ(1,"mat-divider"),e.YNc(2,jC,5,5,"div",9),e.YNc(3,VC,5,3,"ng-container",1),e.qZA()),2&i){var n=e.oxw(2);e.xp6(2),e.Q6J("ngIf",n.getPushButtonsGroups().length>1),e.xp6(1),e.Q6J("ngForOf",n.currentPushButtonsGroup.computedSelectors)}}function WC(i,a){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.hij("",n.title," ")}}function KC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field")(2,"mat-select",18),e.NdJ("valueChange",function(r){e.CHM(n);var s=e.oxw(3);return e.KtG(s.currentCheckboxesGroup=r)}),e.ALo(3,"translate"),e.YNc(4,WC,2,2,"mat-option",12),e.qZA()()()}if(2&i){var t=e.oxw(3);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("value",t.currentCheckboxesGroup),e.xp6(2),e.Q6J("ngForOf",t.getCheckboxesGroups())}}function XC(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-checkbox",21),e.NdJ("change",function(){var l=e.CHM(n).$implicit,c=e.oxw(3).$implicit,u=e.oxw();return e.KtG(u.onSelectionChange(l,c.selectorType))}),e._uU(1),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw(4);e.Q6J("matTooltip",o.getToolTip(t))("checked",t.enabled)("value",t),e.xp6(1),e.hij("",t.title," ")}}function e1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"u",24),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(5);return e.KtG(o.displayLessResults("checkbox"))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&i&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.filter.displayLessResults")," "))}function t1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"u",25),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(5);return e.KtG(o.displayMoreResults("checkbox"))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&i&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.filter.displayMoreResults")," "))}function n1(i,a){if(1&i&&(e.TgZ(0,"p"),e.YNc(1,e1,3,3,"u",22),e.YNc(2,t1,3,3,"u",23),e.qZA()),2&i){var n=e.oxw().$implicit,t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.isLessResults(n,"checkbox")),e.xp6(1),e.Q6J("ngIf",t.isMoreResults(n,"checkbox"))}}function o1(i,a){if(1&i&&(e.ynx(0),e.TgZ(1,"h4"),e._uU(2),e.qZA(),e.TgZ(3,"div",19),e.YNc(4,XC,2,4,"mat-checkbox",20),e.qZA(),e.YNc(5,n1,3,2,"p",2),e.BQk()),2&i){var n=a.$implicit,t=e.oxw(3);e.xp6(2),e.Oqu(n.title),e.xp6(2),e.Q6J("ngForOf",n.selectors),e.xp6(1),e.Q6J("ngIf",t.isLessResults(n,"checkbox")||t.isMoreResults(n,"checkbox"))}}function i1(i,a){if(1&i&&(e.TgZ(0,"div",17),e._UZ(1,"mat-divider"),e.YNc(2,KC,5,5,"div",9),e.YNc(3,o1,6,3,"ng-container",1),e.qZA()),2&i){var n=e.oxw(2);e.xp6(2),e.Q6J("ngIf",n.getCheckboxesGroups().length>1),e.xp6(1),e.Q6J("ngForOf",n.currentCheckboxesGroup.computedSelectors)}}function r1(i,a){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.hij("",n.title," ")}}function a1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field")(2,"mat-select",27),e.NdJ("valueChange",function(r){e.CHM(n);var s=e.oxw(3);return e.KtG(s.currentRadioButtonsGroup=r)}),e.ALo(3,"translate"),e.YNc(4,r1,2,2,"mat-option",12),e.qZA()()()}if(2&i){var t=e.oxw(3);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("value",t.currentRadioButtonsGroup),e.xp6(2),e.Q6J("ngForOf",t.getRadioButtonsGroups())}}function s1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-radio-button",30),e.NdJ("change",function(){e.CHM(n);var o=e.oxw(4);return e.KtG(o.emptyRadioButtons())}),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"translate"),e.qZA()}2&i&&(e.Q6J("matTooltip",e.lcZ(1,2,"igo.geo.filter.resetFilters")),e.xp6(2),e.hij("",e.lcZ(3,4,"igo.geo.filter.resetFilters")," "))}function l1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-radio-button",21),e.NdJ("change",function(){var l=e.CHM(n).$implicit,c=e.oxw(3).$implicit,u=e.oxw();return e.KtG(u.onSelectionChange(l,c.selectorType))}),e._uU(1),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw(4);e.Q6J("matTooltip",o.getToolTip(t))("checked",t.enabled)("value",t),e.xp6(1),e.hij("",t.title," ")}}function c1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"u",24),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(5);return e.KtG(o.displayLessResults("radio"))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&i&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.filter.displayLessResults")," "))}function u1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"u",25),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(5);return e.KtG(o.displayMoreResults("radio"))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&i&&(e.xp6(1),e.hij("",e.lcZ(2,1,"igo.geo.filter.displayMoreResults")," "))}function p1(i,a){if(1&i&&(e.TgZ(0,"p"),e.YNc(1,c1,3,3,"u",22),e.YNc(2,u1,3,3,"u",23),e.qZA()),2&i){var n=e.oxw().$implicit,t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.isLessResults(n,"radio")),e.xp6(1),e.Q6J("ngIf",t.isMoreResults(n,"radio"))}}function d1(i,a){if(1&i&&(e.ynx(0),e.TgZ(1,"h4"),e._uU(2),e.qZA(),e.TgZ(3,"mat-radio-group",28),e.YNc(4,s1,4,6,"mat-radio-button",29),e.YNc(5,l1,2,4,"mat-radio-button",20),e.YNc(6,p1,3,2,"p",2),e.qZA(),e.BQk()),2&i){var n=a.$implicit,t=e.oxw(3);e.xp6(2),e.Oqu(n.title),e.xp6(2),e.Q6J("ngIf",n.unfiltered),e.xp6(1),e.Q6J("ngForOf",n.selectors),e.xp6(1),e.Q6J("ngIf",t.isLessResults(n,"radio")||t.isMoreResults(n,"radio"))}}function g1(i,a){if(1&i&&(e.TgZ(0,"div",26),e._UZ(1,"mat-divider"),e.YNc(2,a1,5,5,"div",9),e.YNc(3,d1,7,4,"ng-container",1),e.qZA()),2&i){var n=e.oxw(2);e.xp6(2),e.Q6J("ngIf",n.getRadioButtonsGroups().length>1),e.xp6(1),e.Q6J("ngForOf",n.currentRadioButtonsGroup.computedSelectors)}}function f1(i,a){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.hij("",n.title," ")}}function m1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field")(2,"mat-select",32),e.NdJ("valueChange",function(r){e.CHM(n);var s=e.oxw(3);return e.KtG(s.currentSelectGroup=r)}),e.ALo(3,"translate"),e.YNc(4,f1,2,2,"mat-option",12),e.qZA()()()}if(2&i){var t=e.oxw(3);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("value",t.currentSelectGroup),e.xp6(2),e.Q6J("ngForOf",t.getSelectGroups())}}function h1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-button",36),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(4);return e.KtG(o.emptySelect())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",37),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.filter.resetFilters"))}var v1=function(){return{standalone:!0}};function y1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-checkbox",42),e.NdJ("ngModelChange",function(r){e.CHM(n);var s=e.oxw(5);return e.KtG(s.selectAllSelected=r)})("change",function(){e.CHM(n);var r=e.oxw(5);return e.KtG(r.toggleAllSelection())}),e._uU(1,"Tous "),e.qZA()}if(2&i){var t=e.oxw(5);e.Q6J("ngModel",t.selectAllSelected)("ngModelOptions",e.DdM(2,v1))}}function _1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-option",43),e.NdJ("onSelectionChange",function(s){e.CHM(n);var l=e.oxw(2).$implicit,c=e.oxw(3);return e.KtG(c.selectOptionClick(s.source.value,l,s))}),e._uU(1),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw(5);e.Q6J("matTooltip",o.getToolTip(t))("value",t),e.xp6(1),e.hij("",t.title," ")}}function b1(i,a){if(1&i&&(e.TgZ(0,"div")(1,"mat-select",38,39)(3,"div",19),e.YNc(4,y1,2,3,"mat-checkbox",40),e.qZA(),e.YNc(5,_1,2,3,"mat-option",41),e.qZA()()),2&i){var n=e.oxw().$implicit;e.xp6(1),e.Q6J("multiple",n.multiple)("placeholder",n.title),e.xp6(3),e.Q6J("ngIf",n.multiple),e.xp6(1),e.Q6J("ngForOf",n.selectors)}}function C1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-option",43),e.NdJ("onSelectionChange",function(s){e.CHM(n);var l=e.oxw(2).$implicit,c=e.oxw(3);return e.KtG(c.selectOptionClick(s.source.value,l))}),e._uU(1),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw(5);e.Q6J("matTooltip",o.getToolTip(t))("value",t),e.xp6(1),e.hij("",t.title," ")}}function S1(i,a){if(1&i&&(e.TgZ(0,"mat-select",44),e.YNc(1,C1,2,3,"mat-option",41),e.qZA()),2&i){var n=e.oxw().$implicit;e.Q6J("placeholder",n.title),e.xp6(1),e.Q6J("ngForOf",n.selectors)}}function w1(i,a){if(1&i&&(e.ynx(0),e.TgZ(1,"h4"),e._uU(2),e.qZA(),e.TgZ(3,"div",10),e.YNc(4,h1,3,3,"mat-button",33),e.TgZ(5,"mat-form-field"),e.YNc(6,b1,6,4,"div",34),e.YNc(7,S1,2,2,"ng-template",null,35,e.W1O),e.qZA()(),e.BQk()),2&i){var n=a.$implicit,t=e.MAs(8);e.xp6(2),e.Oqu(n.title),e.xp6(2),e.Q6J("ngIf",n.unfiltered&&!n.multiple),e.xp6(1),e.Udp("width",n.width?n.width:void 0,"%"),e.xp6(1),e.Q6J("ngIf",n.multiple)("ngIfElse",t)}}function T1(i,a){if(1&i&&(e.TgZ(0,"div",31),e._UZ(1,"mat-divider"),e.YNc(2,m1,5,5,"div",9),e.YNc(3,w1,9,6,"ng-container",1),e.qZA()),2&i){var n=e.oxw(2);e.xp6(2),e.Q6J("ngIf",n.getSelectGroups().length>1),e.xp6(1),e.Q6J("ngForOf",n.currentSelectGroup.computedSelectors)}}function x1(i,a){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.hij("",n.title," ")}}function k1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field")(2,"mat-select",46),e.NdJ("valueChange",function(r){e.CHM(n);var s=e.oxw(3);return e.KtG(s.currentAutocompleteGroup=r)}),e.ALo(3,"translate"),e.YNc(4,x1,2,2,"mat-option",12),e.qZA()()()}if(2&i){var t=e.oxw(3);e.xp6(2),e.Q6J("matTooltip",e.lcZ(3,3,"igo.geo.layer.legend.selectStyle"))("value",t.currentAutocompleteGroup),e.xp6(2),e.Q6J("ngForOf",t.getAutocompleteGroups())}}function M1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-button",36),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(4);return e.KtG(o.emptyAutocomplete())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",37),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.filter.resetFilters"))}function F1(i,a){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.hij(" ",n.value," ")}}function Z1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-form-field"),e._UZ(1,"input",48,49),e.TgZ(3,"mat-autocomplete",50,51),e.NdJ("optionSelected",function(l){e.CHM(n);var c=e.oxw(4);return e.KtG(c.autocompleteOptionClick(l.option.value))}),e.YNc(6,F1,2,2,"mat-option",12),e.ALo(7,"async"),e.qZA()()}if(2&i){var t=e.MAs(4),o=e.oxw().$implicit,r=e.oxw(3);e.Udp("width",o.width?o.width:void 0,"%"),e.xp6(1),e.Q6J("matAutocomplete",t)("placeholder",o.title),e.xp6(2),e.Q6J("displayWith",r.displayFn),e.xp6(3),e.Q6J("ngForOf",e.lcZ(7,6,r.filteredOgcAutocomplete[o.id]))}}function A1(i,a){if(1&i&&(e.ynx(0),e.TgZ(1,"h4"),e._uU(2),e.qZA(),e.TgZ(3,"div",10),e.YNc(4,M1,3,3,"mat-button",33),e.YNc(5,Z1,8,8,"mat-form-field",47),e.qZA(),e.BQk()),2&i){var n=a.$implicit,t=e.oxw(3);e.xp6(2),e.Oqu(n.title),e.xp6(2),e.Q6J("ngIf",n.unfiltered),e.xp6(1),e.Q6J("ngIf",t.filteredOgcAutocomplete[n.id])}}function I1(i,a){if(1&i&&(e.TgZ(0,"div",45),e._UZ(1,"mat-divider"),e.YNc(2,k1,5,5,"div",9),e.YNc(3,A1,6,3,"ng-container",1),e.qZA()),2&i){var n=e.oxw(2);e.xp6(2),e.Q6J("ngIf",n.getAutocompleteGroups().length>1),e.xp6(1),e.Q6J("ngForOf",n.currentAutocompleteGroup.computedSelectors)}}function L1(i,a){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,zC,4,2,"div",3),e.YNc(2,i1,4,2,"div",4),e.YNc(3,g1,4,2,"div",5),e.YNc(4,T1,4,2,"div",6),e.YNc(5,I1,4,2,"div",7),e.qZA()),2&i){var n=a.$implicit;e.xp6(1),e.Q6J("ngIf","pushButton"===n.selectorType),e.xp6(1),e.Q6J("ngIf","checkbox"===n.selectorType),e.xp6(1),e.Q6J("ngIf","radioButton"===n.selectorType),e.xp6(1),e.Q6J("ngIf","select"===n.selectorType),e.xp6(1),e.Q6J("ngIf","autocomplete"===n.selectorType)}}function O1(i,a){1&i&&(e.TgZ(0,"h4"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"igo.geo.filter.reportingDate")))}function D1(i,a){if(1&i&&(e.TgZ(0,"h4"),e._uU(1),e.qZA()),2&i){var n=e.oxw(2);e.xp6(1),e.Oqu(n.currentFilter.title)}}function P1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div"),e._UZ(1,"mat-divider"),e.YNc(2,O1,3,3,"h4",2),e.YNc(3,D1,2,1,"h4",2),e.TgZ(4,"igo-ogc-filter-time",52),e.NdJ("datasourceChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.datasource=r)})("currentFilterChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.currentFilter=r)})("changeProperty",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.changeProperty(r.value,r.pos))}),e.qZA()()}if(2&i){var t=e.oxw();e.xp6(2),e.Q6J("ngIf",!t.currentFilter.title),e.xp6(1),e.Q6J("ngIf",t.currentFilter.title),e.xp6(1),e.Q6J("datasource",t.datasource)("currentFilter",t.currentFilter)}}var wu=function(){var i=function(){function a(n,t,o,r,s){(0,h.Z)(this,a),this.ogcFilterService=n,this.formBuilder=t,this.domService=o,this.configService=r,this.cdRef=s,this.checkboxesIndex=5,this.radioButtonsIndex=5,this.baseIndex=5,this.ogcFilterOperator=G,this.color="primary",this.selectAllSelected=!1,this.selectEnabled$=new x.X(void 0),this.selectEnableds$=new x.X([]),this.autocompleteEnabled$=new x.X(void 0),this.filteredOgcAutocomplete={},this.ogcFilterWriter=new jt,this.buildForm()}return(0,v.Z)(a,[{key:"currentFilter",get:function(){return this._currentFilter},set:function(t){var o;this._currentFilter=t,null!==(o=this._currentFilter)&&void 0!==o&&o.sliderOptions&&(this._currentFilter.sliderOptions.enabled=!1)}},{key:"ogcFiltersSelectors",get:function(){var t,o,r,s,l,c,u,p,d,g,f,m,y,_,b,w,T,M,A,L,Z,R,V,P,Y,pe,ue,oe,Q,ae,xe=[];return!(null===(r=null===(o=null===(t=this.datasource)||void 0===t?void 0:t.options)||void 0===o?void 0:o.ogcFilters)||void 0===r)&&r.pushButtons&&xe.push(null===(c=null===(l=null===(s=this.datasource)||void 0===s?void 0:s.options)||void 0===l?void 0:l.ogcFilters)||void 0===c?void 0:c.pushButtons),!(null===(d=null===(p=null===(u=this.datasource)||void 0===u?void 0:u.options)||void 0===p?void 0:p.ogcFilters)||void 0===d)&&d.checkboxes&&xe.push(null===(m=null===(f=null===(g=this.datasource)||void 0===g?void 0:g.options)||void 0===f?void 0:f.ogcFilters)||void 0===m?void 0:m.checkboxes),!(null===(b=null===(_=null===(y=this.datasource)||void 0===y?void 0:y.options)||void 0===_?void 0:_.ogcFilters)||void 0===b)&&b.radioButtons&&xe.push(null===(M=null===(T=null===(w=this.datasource)||void 0===w?void 0:w.options)||void 0===T?void 0:T.ogcFilters)||void 0===M?void 0:M.radioButtons),!(null===(Z=null===(L=null===(A=this.datasource)||void 0===A?void 0:A.options)||void 0===L?void 0:L.ogcFilters)||void 0===Z)&&Z.select&&xe.push(null===(P=null===(V=null===(R=this.datasource)||void 0===R?void 0:R.options)||void 0===V?void 0:V.ogcFilters)||void 0===P?void 0:P.select),!(null===(ue=null===(pe=null===(Y=this.datasource)||void 0===Y?void 0:Y.options)||void 0===pe?void 0:pe.ogcFilters)||void 0===ue)&&ue.autocomplete&&xe.push(null===(ae=null===(Q=null===(oe=this.datasource)||void 0===oe?void 0:oe.options)||void 0===Q?void 0:Q.ogcFilters)||void 0===ae?void 0:ae.autocomplete),xe.sort(function(Me,Ce){return Me.order<Ce.order?-1:Me.order>Ce.order?1:0}),xe}},{key:"currentPushButtonsGroup",get:function(){return this.form.get("pushButtonsGroup").value},set:function(t){this.form.patchValue({pushButtonsGroup:t})}},{key:"currentCheckboxesGroup",get:function(){return this.form.get("checkboxesGroup").value},set:function(t){this.form.patchValue({checkboxesGroup:t})}},{key:"currentRadioButtonsGroup",get:function(){return this.form.get("radioButtonsGroup").value},set:function(t){this.form.patchValue({radioButtonsGroup:t})}},{key:"currentSelectGroup",get:function(){return this.form.get("selectGroup").value},set:function(t){this.form.patchValue({selectGroup:t}),this.cdRef.detectChanges()}},{key:"currentAutocompleteGroup",get:function(){return this.form.get("autocompleteGroup").value},set:function(t){this.form.patchValue({autocompleteGroup:t}),this.cdRef.detectChanges()}},{key:"selectEnabled",get:function(){return this.selectEnabled$.value},set:function(t){var o=this;this.selectEnabled$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentSelectGroup.computedSelectors.forEach(function(r){var s;null===(s=r.selectors)||void 0===s||s.forEach(function(l){l.enabled=t===l})}),this.applyFiltersTimeout=setTimeout(function(){o.applyFilters()},750)}},{key:"selectEnableds",get:function(){return this.selectEnableds$.value},set:function(t){var o=this;this.selectEnableds$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentSelectGroup.computedSelectors.forEach(function(r){var s;null===(s=r.selectors)||void 0===s||s.forEach(function(l){l.enabled=!!t.includes(l)})}),this.applyFiltersTimeout=setTimeout(function(){o.applyFilters()},750)}},{key:"autocompleteEnabled",get:function(){return this.autocompleteEnabled$.value},set:function(t){var o=this;this.autocompleteEnabled$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentAutocompleteGroup.computedSelectors.forEach(function(r){var s;null===(s=r.selectors)||void 0===s||s.forEach(function(l){l.enabled=t===l.title})}),this.applyFiltersTimeout=setTimeout(function(){o.applyFilters()},750)}},{key:"buildForm",value:function(){this.form=this.formBuilder.group({pushButtons:["",[S.kI.required]],radioButtons:["",[S.kI.required]],pushButtonsGroup:["",[S.kI.required]],checkboxesGroup:["",[S.kI.required]],radioButtonsGroup:["",[S.kI.required]],selectGroup:["",[S.kI.required]],select:["",[S.kI.required]],selectMulti:["",[S.kI.required]],autocompleteGroup:["",[S.kI.required]],autocomplete:["",[S.kI.required]]})}},{key:"getPushButtonsGroups",value:function(){var t,o,r;if(null!==(r=null===(o=null===(t=this.datasource)||void 0===t?void 0:t.options)||void 0===o?void 0:o.ogcFilters)&&void 0!==r&&r.pushButtons)return this.datasource.options.ogcFilters.pushButtons.groups}},{key:"getCheckboxesGroups",value:function(){var t,o,r;if(null!==(r=null===(o=null===(t=this.datasource)||void 0===t?void 0:t.options)||void 0===o?void 0:o.ogcFilters)&&void 0!==r&&r.checkboxes)return this.datasource.options.ogcFilters.checkboxes.groups}},{key:"getRadioButtonsGroups",value:function(){var t,o,r;if(null!==(r=null===(o=null===(t=this.datasource)||void 0===t?void 0:t.options)||void 0===o?void 0:o.ogcFilters)&&void 0!==r&&r.radioButtons)return this.datasource.options.ogcFilters.radioButtons.groups}},{key:"getSelectGroups",value:function(){var t,o,r;if(null!==(r=null===(o=null===(t=this.datasource)||void 0===t?void 0:t.options)||void 0===o?void 0:o.ogcFilters)&&void 0!==r&&r.select)return this.datasource.options.ogcFilters.select.groups}},{key:"getAutocompleteGroups",value:function(){var t,o,r;if(null!==(r=null===(o=null===(t=this.datasource)||void 0===t?void 0:t.options)||void 0===o?void 0:o.ogcFilters)&&void 0!==r&&r.autocomplete)return this.datasource.options.ogcFilters.autocomplete.groups}},{key:"ngOnInit",value:function(){return(0,ne.mG)(this,void 0,void 0,(0,Ne.Z)().mark(function t(){var o=this;return(0,Ne.Z)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!this.datasource.options.ogcFilters){s.next=15;break}if(this.datasource.options.ogcFilters.pushButtons&&(this.currentPushButtonsGroup=this.datasource.options.ogcFilters.pushButtons.groups.find(function(l){return l.enabled})||this.datasource.options.ogcFilters.pushButtons.groups[0]),this.datasource.options.ogcFilters.checkboxes&&(this.currentCheckboxesGroup=this.datasource.options.ogcFilters.checkboxes.groups.find(function(l){return l.enabled})||this.datasource.options.ogcFilters.checkboxes.groups[0]),this.datasource.options.ogcFilters.radioButtons&&(this.currentRadioButtonsGroup=this.datasource.options.ogcFilters.radioButtons.groups.find(function(l){return l.enabled})||this.datasource.options.ogcFilters.radioButtons.groups[0]),!this.datasource.options.ogcFilters.select){s.next=9;break}return this.currentSelectGroup=this.datasource.options.ogcFilters.select.groups.find(function(l){return l.enabled})||this.datasource.options.ogcFilters.select.groups[0],this.getSelectEnabled(),s.next=9,this.getSelectDomValues();case 9:if(!this.datasource.options.ogcFilters.autocomplete){s.next=14;break}return this.currentAutocompleteGroup=this.datasource.options.ogcFilters.autocomplete.groups.find(function(l){return l.enabled})||this.datasource.options.ogcFilters.autocomplete.groups[0],this.getAutocompleteEnabled(),s.next=14,this.getAutocompleteDomValues();case 14:this.applyFilters();case 15:this.form.get("pushButtonsGroup").valueChanges.pipe((0,De.b)(750)).subscribe(function(){o.onPushButtonsChangeGroup(),o.applyFilters()}),this.form.get("checkboxesGroup").valueChanges.pipe((0,De.b)(750)).subscribe(function(){o.onCheckboxesChangeGroup(),o.applyFilters()}),this.form.get("radioButtonsGroup").valueChanges.pipe((0,De.b)(750)).subscribe(function(){o.onRadioButtonsChangeGroup(),o.applyFilters()}),this.form.get("selectGroup").valueChanges.pipe((0,De.b)(750)).subscribe(function(){o.onSelectChangeGroup(),o.applyFilters()}),this.form.get("autocompleteGroup").valueChanges.pipe((0,De.b)(750)).subscribe(function(){o.onAutocompleteChangeGroup(),o.applyFilters()}),this.form.get("pushButtons").valueChanges.pipe((0,De.b)(750)).subscribe(function(){o.applyFilters()}),this.form.get("radioButtons").valueChanges.pipe((0,De.b)(750)).subscribe(function(){o.applyFilters()});case 22:case"end":return s.stop()}},t,this)}))}},{key:"getSelectEnabled",value:function(){var r,t=this,o=[];this.currentSelectGroup.computedSelectors.forEach(function(s){var l,c;s.multiple?(null===(l=s.selectors)||void 0===l||l.forEach(function(u){u.enabled&&o.push(u)}),t.selectEnableds=o,t.form.controls.selectMulti.setValue(o)):(null===(c=s.selectors)||void 0===c||c.forEach(function(u){u.enabled&&(r=u)}),t.form.controls.select.reset(r),t.selectEnabled$.subscribe(function(u){t.form.controls.select.value!==u&&t.form.controls.select.setValue(u)}),t.selectEnabled=r)})}},{key:"getAutocompleteEnabled",value:function(){var o,t=this;this.currentAutocompleteGroup.computedSelectors.forEach(function(r){var s;null===(s=r.selectors)||void 0===s||s.forEach(function(l){l.enabled&&(o=l.title,t.form.controls.autocomplete.setValue({id:l.filters.expression,value:l.title}))}),t.autocompleteEnabled=o})}},{key:"getToolTip",value:function(t){var o;return t.tooltip&&(o=Array.isArray(t.tooltip)?t.tooltip.join("\n"):t.tooltip),o||""}},{key:"getSelectDomValues",value:function(){var t,o;return(0,ne.mG)(this,void 0,void 0,(0,Ne.Z)().mark(function r(){var l,c,u,p,d,g,f,m,y,_,b,s=this;return(0,Ne.Z)().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:l=(0,D.Z)(this.datasource.options.ogcFilters.select.bundles),T.prev=1,l.s();case 3:if((c=l.n()).done){T.next=36;break}if(!(u=c.value).domSelectors){T.next=34;break}p=void 0,d=(0,D.Z)(u.domSelectors),T.prev=8,d.s();case 10:if((g=d.n()).done){T.next=25;break}f=g.value,m=void 0,y=(0,D.Z)(this.configService.getConfig("dom"));try{for(y.s();!(_=y.n()).done;)(f.id===(b=_.value).id||f.name===b.name)&&(m={id:b.id,url:b.url,name:b.name,values:b.values})}catch(M){y.e(M)}finally{y.f()}if(!m.url){T.next=21;break}return T.next=18,this.domService.getDom(m);case 18:p=T.sent,T.next=22;break;case 21:p=m.values;case 22:p&&function(){var M=u;M.selectors=[];var Z,A=void 0,L=(0,D.Z)(p);try{var R=function(){var Y,P=Z.value;u.multiple?(Y=!(null===(t=s.selectEnableds)||void 0===t||!t.find(function(pe){return pe.title===P.value})),A={title:P.value,enabled:Y,filters:{operator:f.operator,propertyName:f.propertyName,expression:P.id}}):A={title:P.value,enabled:(null===(o=s.selectEnabled)||void 0===o?void 0:o.title)===P.value,filters:{operator:f.operator,propertyName:f.propertyName,expression:P.id}},M.selectors.push(A)};for(L.s();!(Z=L.n()).done;)R()}catch(V){L.e(V)}finally{L.f()}s.getSelectGroups().find(function(V){return V.ids.includes(M.id)}).computedSelectors.find(function(V){return V.title===M.title}).selectors=M.selectors}();case 23:T.next=10;break;case 25:T.next=30;break;case 27:T.prev=27,T.t0=T.catch(8),d.e(T.t0);case 30:return T.prev=30,d.f(),T.finish(30);case 33:this.getSelectEnabled();case 34:T.next=3;break;case 36:T.next=41;break;case 38:T.prev=38,T.t1=T.catch(1),l.e(T.t1);case 41:return T.prev=41,l.f(),T.finish(41);case 44:case"end":return T.stop()}},r,this,[[1,38,41,44],[8,27,30,33]])}))}},{key:"getAutocompleteDomValues",value:function(){return(0,ne.mG)(this,void 0,void 0,(0,Ne.Z)().mark(function t(){var r,s,l,o=this;return(0,Ne.Z)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:r=(0,D.Z)(this.datasource.options.ogcFilters.autocomplete.bundles),u.prev=1,r.s();case 3:if((s=r.n()).done){u.next=9;break}if(!(l=s.value).domSelectors){u.next=7;break}return u.delegateYield((0,Ne.Z)().mark(function p(){var d,g,f,m,y,_,b,w;return(0,Ne.Z)().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:d=void 0,g=(0,D.Z)(l.domSelectors),M.prev=2,g.s();case 4:if((f=g.n()).done){M.next=19;break}m=f.value,y=void 0,_=(0,D.Z)(o.configService.getConfig("dom"));try{for(_.s();!(b=_.n()).done;)(m.id===(w=b.value).id||m.name===w.name)&&(y={id:w.id,url:w.url,name:w.name,values:w.values})}catch(A){_.e(A)}finally{_.f()}if(!y.url){M.next=15;break}return M.next=12,o.domService.getDom(y);case 12:d=M.sent,M.next=16;break;case 15:d=y.values;case 16:d&&function(){var A=l;A.selectors=[];var R,Z=(0,D.Z)(d);try{for(Z.s();!(R=Z.n()).done;){var V=R.value;A.selectors.push({title:V.value,enabled:!(!o.autocompleteEnabled||o.autocompleteEnabled!==V.value),filters:{operator:m.operator,propertyName:m.propertyName,expression:V.id}})}}catch(P){Z.e(P)}finally{Z.f()}o.getAutocompleteGroups().find(function(P){return P.ids.includes(A.id)}).computedSelectors.find(function(P){return P.title===A.title}).selectors=A.selectors}();case 17:M.next=4;break;case 19:M.next=24;break;case 21:M.prev=21,M.t0=M.catch(2),g.e(M.t0);case 24:return M.prev=24,g.f(),M.finish(24);case 27:o.filteredOgcAutocomplete[l.id]=new rt.y,o.cdRef.detectChanges(),o.filteredOgcAutocomplete[l.id]=o.form.controls.autocomplete.valueChanges.pipe((0,U.U)(function(A){if(A.length)return null==d?void 0:d.filter(function(L){var Z=A?A.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"";return L.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(Z)})}));case 30:case"end":return M.stop()}},p,null,[[2,21,24,27]])})(),"t0",7);case 7:u.next=3;break;case 9:u.next=14;break;case 11:u.prev=11,u.t1=u.catch(1),r.e(u.t1);case 14:return u.prev=14,r.f(),u.finish(14);case 17:case"end":return u.stop()}},t,this,[[1,11,14,17]])}))}},{key:"getButtonColor",value:function(t){var o;return t.color&&t.enabled&&(o={"background-color":"rgba(".concat(t.color,")")}),o}},{key:"bundleIsVertical",value:function(t){return!!t.vertical&&t.vertical}},{key:"onPushButtonsChangeGroup",value:function(){var t=this;this.getPushButtonsGroups().map(function(o){return o.enabled=!1}),this.getPushButtonsGroups().find(function(o){return o===t.currentPushButtonsGroup}).enabled=!0}},{key:"onCheckboxesChangeGroup",value:function(){var t=this;this.getCheckboxesGroups().map(function(o){return o.enabled=!1}),this.getCheckboxesGroups().find(function(o){return o===t.currentCheckboxesGroup}).enabled=!0}},{key:"onRadioButtonsChangeGroup",value:function(){var t=this;this.getRadioButtonsGroups().map(function(o){return o.enabled=!1}),this.getRadioButtonsGroups().find(function(o){return o===t.currentRadioButtonsGroup}).enabled=!0}},{key:"onSelectChangeGroup",value:function(){var t=this;this.getSelectGroups().map(function(o){return o.enabled=!1}),this.getSelectGroups().find(function(o){return o===t.currentSelectGroup}).enabled=!0}},{key:"onAutocompleteChangeGroup",value:function(){var t=this;this.getAutocompleteGroups().map(function(o){return o.enabled=!1}),this.getAutocompleteGroups().find(function(o){return o===t.currentAutocompleteGroup}).enabled=!0}},{key:"onSelectionChange",value:function(t,o){var r=this;clearTimeout(this.applyFiltersTimeout),"radioButton"===o&&this.emptyRadioButtons(),t&&(t.enabled=!t.enabled),this.applyFiltersTimeout=setTimeout(function(){r.applyFilters()},750)}},{key:"emptyRadioButtons",value:function(){var t=this;this.currentRadioButtonsGroup.computedSelectors.forEach(function(o){o.selectors.map(function(r){return r.enabled=!1}),t.applyFiltersTimeout=setTimeout(function(){t.applyFilters()},750)})}},{key:"emptySelect",value:function(){this.selectEnabled=void 0}},{key:"emptyAutocomplete",value:function(){this.autocompleteEnabled=void 0,this.form.controls.autocomplete.setValue(""),this.form.controls.autocomplete.markAsUntouched()}},{key:"toggleAllSelection",value:function(){if(this.selectAllSelected){var t=[];this.currentSelectGroup.computedSelectors.forEach(function(o){var r;null===(r=o.selectors)||void 0===r||r.forEach(function(s){t.push(s)})}),this.sel.options.forEach(function(o){return o.select()}),this.selectEnableds=t}else this.sel.options.forEach(function(o){return o.deselect()}),this.selectEnableds=[]}},{key:"selectOptionClick",value:function(t,o,r){if(o.multiple){var s=this.selectEnableds,l=!0;if(this.sel.options.forEach(function(d){d.selected||(l=!1)}),this.selectAllSelected=l,r.isUserInput)if(s.length){var u,c=(0,D.Z)(s);try{for(c.s();!(u=c.n()).done;){var p=u.value;if(p.title===t.title){if(p.enabled&&t.enabled){s.splice(s.indexOf(p),1),this.selectEnableds=s;break}}else if(s.indexOf(p)===s.length-1){s.push(t),this.selectEnableds=s;break}}}catch(d){c.e(d)}finally{c.f()}}else s.push(t),this.selectEnableds=s}else this.selectEnabled=t}},{key:"autocompleteOptionClick",value:function(t){this.autocompleteEnabled=t.value}},{key:"displayFn",value:function(t){return t?t.value:void 0}},{key:"applyFilters",value:function(){for(var t="",o=[],s=0,l=[this.currentPushButtonsGroup,this.currentCheckboxesGroup,this.currentRadioButtonsGroup,this.currentSelectGroup,this.currentAutocompleteGroup];s<l.length;s++){var c=l[s];c.computedSelectors&&c.computedSelectors.map(function(u){var p,d=[];null===(p=u.selectors)||void 0===p||p.filter(function(g){return!0===g.enabled}).forEach(function(g){return d.push(g.filters)}),d.length>=1&&o.push(1===d.length?d[0]:{logical:u.logical,filters:d})})}this.isTemporalOperator()&&this._currentFilter.active&&o.push(this.datasource.options.ogcFilters.interfaceOgcFilters[0]),o.length>=1&&(t=this.ogcFilterWriter.buildFilter(1===o.length?o[0]:{logical:"And",filters:o})),"wms"===this.datasource.options.type&&this.ogcFilterService.filterByOgc(this.datasource,t),"wfs"===this.datasource.options.type&&this.datasource.ol.refresh(),this.datasource.setOgcFilters(this.datasource.options.ogcFilters,!0)}},{key:"isMoreResults",value:function(t,o){var r=0,s=(0,D.Z)(t.selectors);try{for(s.s();!s.n().done;)r++}catch(p){s.e(p)}finally{s.f()}return r>("radio"===o?this.radioButtonsIndex:this.checkboxesIndex)}},{key:"displayMoreResults",value:function(t){"radio"===t?this.radioButtonsIndex+=5:this.checkboxesIndex+=5}},{key:"isLessResults",value:function(t,o){var r=0,s=(0,D.Z)(t.selectors);try{for(s.s();!s.n().done;)r++}catch(p){s.e(p)}finally{s.f()}return this.baseIndex!==("radio"===o?this.radioButtonsIndex:this.checkboxesIndex)&&r>this.baseIndex}},{key:"displayLessResults",value:function(t){"radio"===t?this.radioButtonsIndex=this.baseIndex:this.checkboxesIndex=this.baseIndex}},{key:"isTemporalOperator",value:function(){var t,o;return(null===(o=null===(t=this.currentFilter)||void 0===t?void 0:t.operator)||void 0===o?void 0:o.toLowerCase())===this.ogcFilterOperator.During.toLowerCase()}},{key:"changeProperty",value:function(t,o){var r=this,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],l=this.detectProperty(o);l&&(this.datasource.options.ogcFilters.interfaceOgcFilters.find(function(c){return c.filterid===r.currentFilter.filterid})[l]=t,s&&this.applyFilters())}},{key:"detectProperty",value:function(t){switch(this.currentFilter.operator){case G.PropertyIsNotEqualTo:case G.PropertyIsEqualTo:case G.PropertyIsGreaterThan:case G.PropertyIsGreaterThanOrEqualTo:case G.PropertyIsLessThan:case G.PropertyIsLessThanOrEqualTo:return"expression";case G.PropertyIsLike:return"pattern";case G.PropertyIsBetween:return t&&1===t?"lowerBoundary":t&&2===t?"upperBoundary":void 0;case G.During:return t&&1===t?"begin":t&&2===t?"end":void 0;default:return}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Os),e.Y36(S.QS),e.Y36(mr),e.Y36(j),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filter-selection"]],viewQuery:function(n,t){var o;1&n&&e.Gf(QC,5),2&n&&e.iGM(o=e.CRH())&&(t.sel=o.first)},inputs:{refreshFilters:"refreshFilters",datasource:"datasource",map:"map",checkboxesIndex:"checkboxesIndex",radioButtonsIndex:"radioButtonsIndex",baseIndex:"baseIndex",currentFilter:"currentFilter"},features:[e._Bn([mr])],decls:3,vars:3,consts:[[3,"formGroup"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","pushButtonGroups",4,"ngIf"],["class","checkboxGroups",4,"ngIf"],["class","radioButtonGroups",4,"ngIf"],["class","selectGroups",4,"ngIf"],["class","autocompleteGroups",4,"ngIf"],[1,"pushButtonGroups"],["class","groupsSelector",4,"ngIf"],[1,"groupsSelector"],["formControlName","pushButtonsGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","pushButtons","appearance","legacy","multiple","true",1,"mat-typography",3,"vertical"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","ngStyle","checked","value","change",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","ngStyle","checked","value","change"],[1,"checkboxGroups"],["formControlName","checkboxesGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[1,"checkboxes","mat-typography"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","checked","value","change",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","checked","value","change"],["class","lessResults mat-typography",3,"click",4,"ngIf"],["class","moreResults mat-typography",3,"click",4,"ngIf"],[1,"lessResults","mat-typography",3,"click"],[1,"moreResults","mat-typography",3,"click"],[1,"radioButtonGroups"],["formControlName","radioButtonsGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],["formControlName","radioButtons",1,"mat-typography"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","change",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","change"],[1,"selectGroups"],["formControlName","selectGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","click",4,"ngIf"],[4,"ngIf","ngIfElse"],["notMulti",""],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","click"],["svgIcon","filter-remove"],["formControlName","selectMulti",3,"multiple","placeholder"],["selection",""],[3,"ngModel","ngModelOptions","ngModelChange","change",4,"ngIf"],["tooltip-position","below","matTooltipDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","value","onSelectionChange",4,"ngFor","ngForOf"],[3,"ngModel","ngModelOptions","ngModelChange","change"],["tooltip-position","below","matTooltipDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","value","onSelectionChange"],["formControlName","select",3,"placeholder"],[1,"autocompleteGroups"],["formControlName","autocompleteGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[3,"width",4,"ngIf"],["matInput","","type","text","formControlName","autocomplete",1,"autocomplete",3,"matAutocomplete","placeholder"],["autocomplete",""],[3,"displayWith","optionSelected"],["auto","matAutocomplete","autocomplete",""],[3,"datasource","currentFilter","datasourceChange","currentFilterChange","changeProperty"]],template:function(n,t){1&n&&(e.TgZ(0,"form",0),e.YNc(1,L1,6,5,"div",1),e.qZA(),e.YNc(2,P1,5,4,"div",2)),2&n&&(e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("ngForOf",t.ogcFiltersSelectors),e.xp6(1),e.Q6J("ngIf",t.isTemporalOperator()))},styles:[".mat-button-toggle-group[_ngcontent-%COMP%]{margin:5px;flex-wrap:wrap;box-shadow:none!important;width:95%}.checkboxes[_ngcontent-%COMP%]{flex-wrap:wrap;box-shadow:none}.groupsSelector[_ngcontent-%COMP%]{text-align:center}mat-button-toggle[_ngcontent-%COMP%]{display:inline-flex;border:1.5px solid black;border-radius:5px;margin:5px;white-space:normal;min-height:40px;height:auto;width:142px}mat-button-toggle[_ngcontent-%COMP%]     .mat-button-toggle-label-content{line-height:inherit;font-size:small;display:block}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){mat-button-toggle[_ngcontent-%COMP%]{width:45%}}  .material-tooltip{white-space:pre-wrap}mat-checkbox[_ngcontent-%COMP%], mat-radio-button[_ngcontent-%COMP%]{margin:7px;width:95%;display:inline-flex;font-size:larger}mat-checkbox[_ngcontent-%COMP%]     label, mat-radio-button[_ngcontent-%COMP%]     label{white-space:normal}mat-checkbox[_ngcontent-%COMP%]{vertical-align:middle}mat-button[_ngcontent-%COMP%]{padding-right:10px;cursor:pointer}h4[_ngcontent-%COMP%]{margin:7px;text-align:left}u[_ngcontent-%COMP%]{cursor:pointer;color:#00f;margin:5px}p[_ngcontent-%COMP%]{margin:0;margin:initial}"]}),i}();function E1(i,a){if(1&i&&(e.TgZ(0,"mat-option",10),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.terrapi."+n)," ")}}var Rs=function(){var i=function(){function a(){(0,h.Z)(this,a),this.queryType=["Arrond","CircFed","CircProv","DirReg","Mun","MRC","AdmRegion","RegTour"],this.selectedTypeIndex=new S.p4(0),this.spatialType=Ie,this.activeDrawType=this.spatialType.Polygon,this.layers=[],this.eventType=new e.vpe,this.eventQueryType=new e.vpe,this.zoneChange=new e.vpe,this.zoneWithBufferChange=new e.vpe,this.bufferChange=new e.vpe,this.measureUnitChange=new e.vpe}return(0,v.Z)(a,[{key:"store",get:function(){return this._store},set:function(t){this._store=t}},{key:"ngOnInit",value:function(){0===this.selectedTypeIndex.value&&(this.type=this.spatialType.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)}},{key:"onTypeChange",value:function(t){0===this.selectedTypeIndex.value&&(this.type=Ie.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)}},{key:"onDrawTypeChange",value:function(t){this.activeDrawType=t,this.eventType.emit(this.activeDrawType)}},{key:"onSelectionChange",value:function(){this.eventQueryType.emit(this.selectedQueryType),this.zoneChange.emit(void 0)}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-spatial-filter-type"]],inputs:{store:"store",selectedQueryType:"selectedQueryType",zone:"zone",layers:"layers"},outputs:{eventType:"eventType",eventQueryType:"eventQueryType",zoneChange:"zoneChange",zoneWithBufferChange:"zoneWithBufferChange",bufferChange:"bufferChange",measureUnitChange:"measureUnitChange"},decls:20,vars:25,consts:[[3,"selectedIndex","selectedIndexChange","selectedTabChange"],[3,"label"],[3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"store","queryType","zone","layers","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange"],[1,"spatial-type-toggle"],[3,"value","change"],[3,"value","matTooltip"],["svgIcon","pentagon-outline"],["svgIcon","record-circle-outline"],[3,"value"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-tab-group",0),e.NdJ("selectedIndexChange",function(r){return t.selectedTypeIndex.setValue(r)})("selectedTabChange",function(r){return t.onTypeChange(r)}),e.TgZ(1,"mat-tab",1),e.ALo(2,"translate"),e.TgZ(3,"mat-form-field")(4,"mat-label"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"mat-select",2),e.NdJ("selectionChange",function(){return t.onSelectionChange()})("valueChange",function(r){return t.selectedQueryType=r}),e.YNc(8,E1,3,4,"mat-option",3),e.qZA()(),e.TgZ(9,"igo-spatial-filter-list",4),e.NdJ("zoneChange",function(r){return t.zoneChange.emit(r)})("zoneWithBufferChange",function(r){return t.zoneWithBufferChange.emit(r)})("bufferChange",function(r){return t.bufferChange.emit(r)})("measureUnitChange",function(r){return t.measureUnitChange.emit(r)}),e.qZA()(),e.TgZ(10,"mat-tab",1),e.ALo(11,"translate"),e.TgZ(12,"div",5)(13,"mat-button-toggle-group",6),e.NdJ("change",function(r){return t.onDrawTypeChange(r.value)}),e.TgZ(14,"mat-button-toggle",7),e.ALo(15,"translate"),e._UZ(16,"mat-icon",8),e.qZA(),e.TgZ(17,"mat-button-toggle",7),e.ALo(18,"translate"),e._UZ(19,"mat-icon",9),e.qZA()()()()()),2&n&&(e.Q6J("selectedIndex",t.selectedTypeIndex.value),e.xp6(1),e.Q6J("label",e.lcZ(2,15,"igo.geo.spatialFilter.predefined")),e.xp6(4),e.Oqu(e.lcZ(6,17,"igo.geo.spatialFilter.searchLabel")),e.xp6(2),e.Q6J("value",t.selectedQueryType),e.xp6(1),e.Q6J("ngForOf",t.queryType),e.xp6(1),e.Q6J("store",t.store)("queryType",t.selectedQueryType)("zone",t.zone)("layers",t.layers),e.xp6(1),e.Q6J("label",e.lcZ(11,19,"igo.geo.spatialFilter.draw")),e.xp6(3),e.Q6J("value",t.activeDrawType),e.xp6(1),e.Q6J("value",t.spatialType.Polygon)("matTooltip",e.lcZ(15,21,"igo.geo.spatialFilter.drawPolygon")),e.xp6(3),e.Q6J("value",t.spatialType.Point)("matTooltip",e.lcZ(18,23,"igo.geo.spatialFilter.drawCircle")))},styles:[".mat-form-field[_ngcontent-%COMP%]{padding:5px;width:95%;margin-left:2px}.mat-tab-group[_ngcontent-%COMP%]     .mat-tab-body-content{overflow:hidden}.mat-tab-group[_ngcontent-%COMP%]     .mat-tab-label{padding:10px}.mat-tab-group[_ngcontent-%COMP%]     .mat-tab-body-wrapper{margin-top:5px}.spatial-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.spatial-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:50%}.spatial-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}"],changeDetection:0}),i}();function $1(i,a){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.hij(" ",n.properties.nom," ")}}function R1(i,a){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.measure."+n)," ")}}var J1=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.spatialFilterService=n,this.messageService=t,this.languageService=o,this.layers=[],this.measureUnit=ye.Meters,this.formControl=new S.p4,this.bufferFormControl=new S.p4,this.zoneChange=new e.vpe,this.zoneWithBufferChange=new e.vpe,this.bufferChange=new e.vpe,this.measureUnitChange=new e.vpe}return(0,v.Z)(a,[{key:"store",get:function(){return this._store},set:function(t){this._store=t}},{key:"queryType",get:function(){return this._queryType},set:function(t){this.formControl.setValue(""),this._queryType=t}},{key:"zone",get:function(){return this._zone},set:function(t){this._zone=t,t||(this.zoneWithBuffer=void 0,this.bufferFormControl.setValue(0))}},{key:"measureUnits",get:function(){return[ye.Meters,ye.Kilometers]}},{key:"ngOnInit",value:function(){var t=this;this.formValueChanges$$=this.formControl.valueChanges.subscribe(function(o){o.length&&t.store.view.filter(function(r){var s=o.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return r.properties.nom.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(s)})}),this.bufferValueChanges$$=this.bufferFormControl.valueChanges.pipe((0,De.b)(500),(0,lo.x)()).subscribe(function(o){t.measureUnit===ye.Meters&&o>0&&o<=1e5?(t.bufferChange.emit(o),t.spatialFilterService.loadBufferGeometry(t.selectedZone,Ie.Predefined,o,t.queryType).subscribe(function(r){t.zoneWithBuffer=r,t.zoneWithBufferChange.emit(t.zoneWithBuffer)})):t.measureUnit===ye.Kilometers&&o>0&&o<=100?(t.bufferChange.emit(o),t.spatialFilterService.loadBufferGeometry(t.selectedZone,Ie.Predefined,1e3*o,t.queryType).subscribe(function(r){t.zoneWithBuffer=r,t.zoneWithBufferChange.emit(t.zoneWithBuffer)})):0===o&&t.layers.length>0?(t.bufferChange.emit(o),t.zoneWithBufferChange.emit(t.selectedZone)):(o<0||t.measureUnit===ye.Meters&&o>1e5||t.measureUnit===ye.Kilometers&&o>100)&&(t.bufferFormControl.setValue(0),t.messageService.alert(t.languageService.translate.instant("igo.geo.spatialFilter.bufferAlert"),t.languageService.translate.instant("igo.geo.spatialFilter.warning")))})}},{key:"ngOnDestroy",value:function(){this.formValueChanges$$.unsubscribe()}},{key:"displayFn",value:function(t){return t?t.properties.nom:void 0}},{key:"onZoneChange",value:function(t){var o=this;t&&this.queryType&&this.spatialFilterService.loadItemById(t,this.queryType).subscribe(function(r){o.selectedZone=r,o.zoneChange.emit(r)})}},{key:"onMeasureUnitChange",value:function(t){t!==this.measureUnit&&(this.measureUnit=t,this.measureUnitChange.emit(this.measureUnit),this.bufferFormControl.setValue(this.measureUnit===ye.Meters?1e3*this.bufferFormControl.value:this.bufferFormControl.value/1e3))}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Hi),e.Y36(Ae),e.Y36($))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-spatial-filter-list"]],inputs:{store:"store",queryType:"queryType",zone:"zone",layers:"layers"},outputs:{zoneChange:"zoneChange",zoneWithBufferChange:"zoneWithBufferChange",bufferChange:"bufferChange",measureUnitChange:"measureUnitChange"},decls:18,vars:17,consts:[[1,"form-list"],[1,"zone-list"],["type","text","matInput","",3,"placeholder","formControl","matAutocomplete"],["input",""],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"buffer-div"],[1,"buffer-form"],[1,"buffer"],["type","number","matInput","",3,"placeholder","formControl","value","readonly"],[1,"unit-field"],[3,"value","selectionChange"],[3,"value"]],template:function(n,t){if(1&n&&(e.TgZ(0,"form",0)(1,"mat-form-field",1),e._UZ(2,"input",2,3),e.ALo(4,"translate"),e.TgZ(5,"mat-autocomplete",4,5),e.NdJ("optionSelected",function(s){return t.onZoneChange(s.option.value)}),e.YNc(7,$1,2,2,"mat-option",6),e.ALo(8,"async"),e.qZA()(),e.TgZ(9,"form")(10,"div",7)(11,"form",8)(12,"mat-form-field",9),e._UZ(13,"input",10),e.ALo(14,"translate"),e.qZA()(),e.TgZ(15,"mat-form-field",11)(16,"mat-select",12),e.NdJ("selectionChange",function(s){return t.onMeasureUnitChange(s.value)}),e.YNc(17,R1,3,4,"mat-option",6),e.qZA()()()()()),2&n){var o=e.MAs(6);e.xp6(2),e.s9C("placeholder",e.lcZ(4,11,"igo.geo.spatialFilter.listLabel")),e.Q6J("formControl",t.formControl)("matAutocomplete",o),e.xp6(3),e.Q6J("displayWith",t.displayFn),e.xp6(2),e.Q6J("ngForOf",e.lcZ(8,13,t.store.view.all$())),e.xp6(6),e.s9C("placeholder",e.lcZ(14,15,"igo.geo.spatialFilter.buffer")),e.Q6J("formControl",t.bufferFormControl)("value",0)("readonly",!t.zone),e.xp6(3),e.Q6J("value",t.measureUnit),e.xp6(1),e.Q6J("ngForOf",t.measureUnits)}},dependencies:[C.sg,S._Y,S.Fj,S.wV,S.JJ,S.JL,S.F,S.oH,_t.XC,_t.ZL,ie.ey,B.KE,le.Nt,ke.gD,C.Ov,E.X$],styles:[".buffer-div[_ngcontent-%COMP%]{display:flex;width:100%;margin-left:2px;padding:5px}.zone-list[_ngcontent-%COMP%]{padding:5px;width:95%;margin-left:2px}.buffer[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;width:110%}.unit-field[_ngcontent-%COMP%]{width:110px;margin-left:30px}"],changeDetection:0}),i}();function B1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-slide-toggle",17),e.NdJ("change",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.onDrawControlChange())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("checked",t.drawControlIsActive)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.spatialFilter.drawControl")," ")}}function U1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-slide-toggle",17),e.NdJ("change",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.onfreehandControlChange())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("checked",t.freehandDrawIsActive)("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(2,3,"igo.geo.spatialFilter.freehandControl")," ")}}function N1(i,a){if(1&i&&(e.TgZ(0,"mat-option",6),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.measure."+n)," ")}}function q1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",18)(1,"form",19)(2,"mat-form-field",20),e._UZ(3,"input",21),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"mat-form-field",22)(6,"mat-select",23),e.NdJ("selectionChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.onMeasureUnitChange(r.value))}),e.YNc(7,N1,3,4,"mat-option",24),e.qZA()()()}if(2&i){var t=e.oxw();e.xp6(3),e.s9C("placeholder",e.lcZ(4,6,"igo.geo.spatialFilter.buffer")),e.Q6J("formControl",t.bufferFormControl)("value",0)("readonly",null===t.formControl.value),e.xp6(3),e.Q6J("value",t.measureUnit),e.xp6(1),e.Q6J("ngForOf",t.measureUnits)}}function G1(i,a){if(1&i&&(e.TgZ(0,"mat-option",6),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.measure."+n)," ")}}function Q1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",25)(1,"form",26)(2,"mat-form-field",27)(3,"input",28),e.NdJ("input",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.getRadius())}),e.ALo(4,"translate"),e.qZA()()(),e.TgZ(5,"mat-form-field",22)(6,"mat-select",23),e.NdJ("selectionChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.onMeasureUnitChange(r.value))}),e.YNc(7,G1,3,4,"mat-option",24),e.qZA()()()}if(2&i){var t=e.oxw();e.xp6(3),e.s9C("placeholder",e.lcZ(4,6,"igo.geo.spatialFilter.radius")),e.Q6J("formControl",t.radiusFormControl)("value",1e3)("readonly",t.freehandDrawIsActive&&null===t.formControl.value),e.xp6(3),e.Q6J("value",t.measureUnit),e.xp6(1),e.Q6J("ngForOf",t.measureUnits)}}function Y1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-radio-button",29),e.NdJ("change",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.onItemTypeChange(r))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){var t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.spatialFilter."+t)," ")}}function j1(i,a){1&i&&(e.TgZ(0,"mat-header-cell",40),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"igo.geo.spatialFilter.Thematics")))}function H1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-header-cell",41)(1,"mat-checkbox",42),e.NdJ("change",function(r){e.CHM(n);var s=e.oxw(2);return e.KtG(r?s.masterToggle():null)}),e.qZA()()}if(2&i){var t=e.oxw(2);e.xp6(1),e.Q6J("checked",t.isAllSelected())("indeterminate",t.selectedThematics.hasValue()&&!t.isAllSelected())}}function V1(i,a){1&i&&e._UZ(0,"mat-header-row")}function z1(i,a){1&i&&e._UZ(0,"mat-row")}function W1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-tree-node",43)(1,"li",44),e._UZ(2,"button",45),e._uU(3),e.TgZ(4,"mat-checkbox",46),e.NdJ("click",function(s){return s.stopPropagation()})("change",function(s){var c=e.CHM(n).$implicit,u=e.oxw(2);return e.KtG(s?u.onToggleChange(c):null)}),e.qZA()()()}if(2&i){var t=a.$implicit,o=e.oxw(2);e.xp6(3),e.hij(" ",t.name," "),e.xp6(1),e.Q6J("checked",o.selectedThematics.isSelected(t))}}function K1(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-nested-tree-node")(1,"div",44)(2,"button",47),e.NdJ("click",function(){var l=e.CHM(n).$implicit,c=e.oxw(2);return e.KtG(c.onToggleClick(l))}),e._UZ(3,"mat-icon",48),e.qZA(),e._uU(4),e.TgZ(5,"mat-checkbox",49),e.NdJ("change",function(s){var c=e.CHM(n).$implicit,u=e.oxw(2);return e.KtG(s?u.childrensToggle(c):null)}),e.qZA()(),e.TgZ(6,"ul",50),e.GkF(7,51),e.qZA()()}if(2&i){var t=a.$implicit,o=e.oxw(2);e.xp6(3),e.Q6J("svgIcon",o.treeControl.isExpanded(t)?"chevron-down":"chevron-right"),e.xp6(1),e.hij(" ",t.name," "),e.xp6(1),e.Q6J("checked",o.isAllSelected(t))("indeterminate",o.hasChildrenSelected(t)&&!o.isAllSelected(t)),e.xp6(1),e.ekj("example-tree-invisible",!o.treeControl.isExpanded(t))}}function X1(i,a){if(1&i&&(e.TgZ(0,"div",30)(1,"mat-table"),e.ynx(2,31),e.YNc(3,j1,3,3,"mat-header-cell",32),e.BQk(),e.ynx(4,33),e.YNc(5,H1,2,2,"mat-header-cell",34),e.BQk(),e.YNc(6,V1,1,0,"mat-header-row",35),e.YNc(7,z1,1,0,"mat-row",36),e.qZA(),e.TgZ(8,"mat-tree",37),e.YNc(9,W1,5,2,"mat-tree-node",38),e.YNc(10,K1,8,6,"mat-nested-tree-node",39),e.qZA()()),2&i){var n=e.oxw();e.xp6(6),e.Q6J("matHeaderRowDef",n.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",n.displayedColumns),e.xp6(1),e.Q6J("dataSource",n.dataSource)("treeControl",n.treeControl),e.xp6(2),e.Q6J("matTreeNodeDefWhen",n.hasChild)}}function eS(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",52),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.clearSearch())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("disabled",t.disabledClearSearch()),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.spatialFilter.clearSearch")," ")}}function tS(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",53),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.clearDrawZone())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("disabled",null===t.formControl.value),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.spatialFilter.clearForm")," ")}}function nS(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",54),e.NdJ("click",function(){e.CHM(n);var o=e.oxw();return e.KtG(o.toggleVisibleList())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",55),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.spatialFilter.showSearchResults"))}function oS(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",59),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(2);return e.KtG(o.toggleVisibleList())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",60),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.spatialFilter.hideSearchResults"))}function iS(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",56),e.YNc(1,oS,3,3,"button",57),e.TgZ(2,"igo-entity-table",58),e.NdJ("entitySelectChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.entityChange.emit(r))}),e.qZA()()}if(2&i){var t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.listIsVisible),e.xp6(1),e.Q6J("template",t.tableTemplate)("store",t.store)}}var Js=function(){var i=function(){function a(n,t,o,r){(0,h.Z)(this,a),this.cdRef=n,this.spatialFilterService=t,this.messageService=o,this.languageService=r,this.layers=[],this.allLayers=[],this.toggleSearch=new e.vpe,this.itemTypeChange=new e.vpe,this.thematicChange=new e.vpe,this.drawZoneEvent=new e.vpe,this.bufferEvent=new e.vpe,this.zoneWithBufferChange=new e.vpe,this.measureUnitChange=new e.vpe,this.radiusEvent=new e.vpe,this.freehandControl=new e.vpe,this.clearButtonEvent=new e.vpe,this.clearSearchEvent=new e.vpe,this.export=new e.vpe,this.openWorkspace=new e.vpe,this.entityChange=new e.vpe,this.itemType=[It.Address,It.Thematics],this.selectedItemType=It.Address,this.treeControl=new _v.VY(function(s){return s.children}),this.displayedColumns=["name","select"],this.childrens=[],this.groups=[],this.thematics=[],this.dataSource=new Kn.WX,this.selectedThematics=new Ta.Ov(!0,[]),this.value$=new x.X(void 0),this.drawGuide$=new x.X(null),this.overlayStyle$=new x.X(void 0),this.drawStyle$=new x.X(void 0),this.formControl=new S.p4,this.geometryTypeField=!1,this.geometryTypes=["Point","Polygon"],this.drawGuideField=!1,this.drawGuide=null,this.drawGuidePlaceholder="",this.measure=!1,this.drawControlIsActive=!0,this.freehandDrawIsActive=!1,this.buffer=0,this.radiusFormControl=new S.p4,this.bufferFormControl=new S.p4,this.measureUnit=ye.Meters,this.listIsVisible=!0}return(0,v.Z)(a,[{key:"type",get:function(){return this._type},set:function(t){var o=this;this._type=t;var r=this.geometryTypes.findIndex(function(u){return u===o.type});if(this.geometryType=this.geometryTypes[r],this.formControl.reset(),this.radius=void 0,this.drawGuide$.next(null),this.drawStyle$.next(void 0),this.type===Ie.Predefined&&this.formControl.setValue({type:"Point",coordinates:""}),this.type===Ie.Point)this.radius=1e3,this.radiusFormControl.setValue(this.radius),this.PointStyle=function(u,p){var d=u.getGeometry(),g=re.vs(d.getCoordinates(),o.map.projection,"EPSG:4326");return new ee.ZP({image:new Ue.Z({radius:o.radius/Math.cos(Math.PI/180*g[1])/p,stroke:new K.Z({width:2,color:"rgba(0, 153, 255)"}),fill:new te.Z({color:"rgba(0, 153, 255, 0.2)"})})})},this.overlayStyle=this.PointStyle,this.drawStyle$.next(this.overlayStyle);else{this.radius=void 0,this.PolyStyle=function(){return new ee.ZP({stroke:new K.Z({width:2,color:"rgba(0, 153, 255)"}),fill:new te.Z({color:"rgba(0, 153, 255, 0.2)"})})};var l=[0,153,255];this.overlayStyle=this.PolyStyle,this.drawStyle$.next(function(){return new ee.ZP({image:new Ue.Z({radius:8,stroke:new K.Z({width:2,color:"rgba(0, 153, 255)"}),fill:new te.Z({color:"rgba(0, 153, 255, 0.2)"})}),stroke:new K.Z({color:l.concat([1]),width:2}),fill:new te.Z({color:l.concat([.2])})})})}this.overlayStyle$.next(this.overlayStyle)}},{key:"store",get:function(){return this._store},set:function(t){var o=this;this._store=t,this._store.entities$.subscribe(function(){o.cdRef.detectChanges()})}},{key:"measureUnits",get:function(){return[ye.Meters,ye.Kilometers]}},{key:"thematicLength",get:function(){return this._thematicLength},set:function(t){this._thematicLength=t}},{key:"ngOnInit",value:function(){var t=this;this.spatialFilterService.loadThematicsList().subscribe(function(s){var c,l=(0,D.Z)(s);try{for(l.s();!(c=l.n()).done;)t.childrens.push(c.value),t.childrens.sort(function(d,g){return d.name.localeCompare(g.name)})}catch(d){l.e(d)}finally{l.f()}t.groups.push(t.languageService.translate.instant("igo.geo.terrapi.limites"));var p={name:t.groups[0],children:[]};t.thematics.push(p),t.childrens.forEach(function(d){d.group&&-1===t.groups.indexOf(d.group)&&(t.groups.push(d.group),t.thematics.push({name:d.group,children:[]})),d.group||(d.name===t.languageService.translate.instant("igo.geo.terrapi.AdmRegion")||d.name===t.languageService.translate.instant("igo.geo.terrapi.Mun")||d.name===t.languageService.translate.instant("igo.geo.terrapi.Arrond")||d.name===t.languageService.translate.instant("igo.geo.terrapi.CircFed")||d.name===t.languageService.translate.instant("igo.geo.terrapi.CircProv")||d.name===t.languageService.translate.instant("igo.geo.terrapi.DirReg")||d.name===t.languageService.translate.instant("igo.geo.terrapi.MRC")||d.name===t.languageService.translate.instant("igo.geo.terrapi.RegTour")?d.group=p.name:d.name===t.languageService.translate.instant("igo.geo.terrapi.routes")?d.group=t.languageService.translate.instant("igo.geo.spatialFilter.group.transport"):t.thematics.push({name:d.name,children:[],source:d.source})),t.thematics.sort(function(m,y){return m.name.localeCompare(y.name)})}),t.thematics.forEach(function(d){var f,g=(0,D.Z)(t.childrens);try{for(g.s();!(f=g.n()).done;){var m=f.value;m.group===d.name&&d.children.push(m)}}catch(y){g.e(y)}finally{g.f()}})}),this.dataSource.data=this.thematics,this.drawGuide$.next(null),this.value$.next(this.formControl.value?this.formControl.value:void 0),this.value$$=this.formControl.valueChanges.subscribe(function(s){s?(t.value$.next(s),t.drawZone=t.formControl.value,0!==t.buffer&&(t.drawZoneEvent.emit(t.drawZone),t.bufferFormControl.setValue(t.buffer))):(t.value$.next(void 0),t.drawZone=void 0)}),this.value$.subscribe(function(){t.getRadius(),t.cdRef.detectChanges()}),this.radiusChanges$$=this.radiusFormControl.valueChanges.subscribe(function(){t.getRadius(),t.cdRef.detectChanges()}),this.bufferChanges$$=this.bufferFormControl.valueChanges.pipe((0,De.b)(500)).subscribe(function(s){t.measureUnit===ye.Meters&&s>0&&s<=1e5?(t.buffer=s,t.bufferEvent.emit(s),t.spatialFilterService.loadBufferGeometry(t.drawZone,Ie.Polygon,s).subscribe(function(l){t.zoneWithBuffer=l,t.zoneWithBufferChange.emit(t.zoneWithBuffer)})):t.measureUnit===ye.Kilometers&&s>0&&s<=100?(t.buffer=s,t.bufferEvent.emit(s),t.spatialFilterService.loadBufferGeometry(t.drawZone,Ie.Polygon,1e3*s).subscribe(function(l){t.zoneWithBuffer=l,t.zoneWithBufferChange.emit(t.zoneWithBuffer)})):0===s?(t.buffer=s,t.bufferEvent.emit(s),t.drawZoneEvent.emit(t.drawZone)):(s<0||t.measureUnit===ye.Meters&&s>1e5||t.measureUnit===ye.Kilometers&&s>100)&&(t.bufferFormControl.setValue(0),t.buffer=0,t.messageService.alert(t.languageService.translate.instant("igo.geo.spatialFilter.bufferAlert"),t.languageService.translate.instant("igo.geo.spatialFilter.warning")))});var o=new On({}),r=new Bt({layer:new Je({zIndex:300,source:new Re,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1}),map:this.map,hitTolerance:15,motion:ce.Default,many:!0,dragBox:!0});this.store.addStrategy(r,!0),this.store.addStrategy(o,!1)}},{key:"ngOnDestroy",value:function(){this.value$$.unsubscribe(),this.radiusChanges$$.unsubscribe(),this.bufferChanges$$.unsubscribe(),this.cdRef.detach(),this.radiusChanges$$&&this.radiusChanges$$.unsubscribe(),this.value$$&&this.value$$.unsubscribe()}},{key:"onItemTypeChange",value:function(t){this.selectedItemType=t.value,this.itemTypeChange.emit(this.selectedItemType)}},{key:"onMeasureUnitChange",value:function(t){t!==this.measureUnit&&(this.measureUnit=t,this.measureUnitChange.emit(this.measureUnit),this.isPolygon()?this.bufferFormControl.setValue(this.measureUnit===ye.Meters?1e3*this.bufferFormControl.value:this.bufferFormControl.value/1e3):this.isPoint()&&this.radiusFormControl.setValue(this.measureUnit===ye.Meters?1e3*this.radiusFormControl.value:this.radiusFormControl.value/1e3))}},{key:"isPredefined",value:function(){return this.type===Ie.Predefined}},{key:"isPolygon",value:function(){return this.type===Ie.Polygon}},{key:"isPoint",value:function(){return this.type===Ie.Point}},{key:"hasChild",value:function(t,o){return!!o.children&&o.children.length}},{key:"onToggleClick",value:function(t){this.treeControl.isExpanded(t)?this.treeControl.collapse(t):this.treeControl.expand(t)}},{key:"isAllSelected",value:function(t){var r,o=this,s=0;return t?(r=t.children.length,t.children.forEach(function(l){o.selectedThematics.selected.find(function(c){return c===l})&&s++})):(r=this.selectedThematics.selected.length,this.thematics.forEach(function(l){-1===o.groups.indexOf(l.name)&&s++}),this.childrens.forEach(function(l){o.thematics.find(function(c){return c.source===l.source})||s++})),s>=1&&r===s}},{key:"hasChildrenSelected",value:function(t){var o=this,r=!1;return t.children.forEach(function(s){o.selectedThematics.selected.find(function(l){return l.source===s.source})&&(r=!0)}),r}},{key:"masterToggle",value:function(){var t=this;this.isAllSelected()?this.selectedThematics.clear():this.selectAll();var s,o=[],r=(0,D.Z)(this.selectedThematics.selected);try{for(r.s();!(s=r.n()).done;)o.push(s.value)}catch(c){r.e(c)}finally{r.f()}this.isAllSelected()?this.thematics.forEach(function(c){t.hasChild(0,c)&&t.treeControl.expand(c)}):this.thematics.forEach(function(c){t.hasChild(0,c)&&t.treeControl.collapse(c)}),this.thematicChange.emit(o)}},{key:"selectAll",value:function(t){var o=this;t?this.hasChild(0,t)&&t.children.forEach(function(r){return o.selectedThematics.select(r)}):(this.thematics.forEach(function(r){-1===o.groups.indexOf(r.name)&&o.selectedThematics.select(r)}),this.childrens.forEach(function(r){o.selectedThematics.selected.find(function(s){return s.source===r.source})||o.selectedThematics.select(r)}))}},{key:"childrensToggle",value:function(t){var o=this;this.isAllSelected(t)?t.children.forEach(function(u){return o.selectedThematics.deselect(u)}):this.selectAll(t);var l,r=[],s=(0,D.Z)(this.selectedThematics.selected);try{for(s.s();!(l=s.n()).done;)r.push(l.value)}catch(u){s.e(u)}finally{s.f()}this.treeControl.expand(t),this.thematicChange.emit(r)}},{key:"onToggleChange",value:function(t){var o=this,r=!1;void 0!==this.selectedThematics.selected.find(function(p){return p.source===t.source})&&(r=!0),this.childrens.forEach(function(p){p===t&&!1===r&&o.selectedThematics.select(p),p===t&&!0===r&&o.selectedThematics.deselect(p)}),this.thematics.forEach(function(p){p===t&&!1===r&&o.selectedThematics.select(p),p===t&&!0===r&&o.selectedThematics.deselect(p)});var c,s=[],l=(0,D.Z)(this.selectedThematics.selected);try{for(l.s();!(c=l.n()).done;)s.push(c.value)}catch(p){l.e(p)}finally{l.f()}this.thematicChange.emit(s)}},{key:"onDrawControlChange",value:function(){this.drawControlIsActive=!this.drawControlIsActive}},{key:"onfreehandControlChange",value:function(){this.freehandDrawIsActive=!this.freehandDrawIsActive,this.freehandControl.emit(this.freehandDrawIsActive)}},{key:"toggleSearchButton",value:function(){var t=this;this.isPredefined()||(this.buffer>0?(this.zoneWithBuffer.meta={id:void 0,title:"Zone"},this.zoneWithBuffer.properties={nom:"Zone",type:this.type},this.drawZoneEvent.emit(this.zoneWithBuffer)):(this.drawZone.meta={id:void 0,title:"Zone"},this.drawZone.properties={nom:"Zone",type:this.type},this.drawZoneEvent.emit(this.drawZone))),this.isPoint()?this.radiusEvent.emit(this.radius):this.isPolygon()&&this.bufferEvent.emit(this.buffer),this.toggleSearch.emit(),this.store.entities$.pipe((0,De.b)(500)).subscribe(function(o){o.length&&t.layers.length===t.thematicLength+1&&(t.openWorkspace.emit(),t.createTableTemplate())})}},{key:"clearButton",value:function(){this.loading=!0,this.store&&this.store.clear(),(this.isPoint()||this.isPolygon())&&(this.drawZone=void 0,this.formControl.reset()),this.bufferFormControl.setValue(0),this.buffer=0,this.bufferEvent.emit(0),this.clearButtonEvent.emit(),this.loading=!1,this.tableTemplate=void 0}},{key:"clearDrawZone",value:function(){this.formControl.reset(),this.bufferFormControl.setValue(0),this.buffer=0}},{key:"clearSearch",value:function(){this.selectedThematics.clear(),this.bufferFormControl.setValue(0),this.buffer=0,this.bufferEvent.emit(0),this.thematicChange.emit([]),this.clearSearchEvent.emit()}},{key:"disableSearchButton",value:function(){if(this.type===Ie.Predefined){if(this.selectedItemType===It.Address&&void 0!==this.queryType&&void 0!==this.zone)return this.loading;if(this.selectedItemType===It.Thematics&&void 0!==this.queryType&&void 0!==this.zone&&this.selectedThematics.selected.length>0)return this.loading}if(this.type===Ie.Polygon||this.type===Ie.Point){if(this.selectedItemType===It.Address&&null!==this.formControl.value)return this.loading;if(this.selectedItemType===It.Thematics&&this.selectedThematics.selected.length>0&&null!==this.formControl.value)return this.loading}return!0}},{key:"disabledClearSearch",value:function(){return this.selectedItemType===It.Address?void 0===this.queryType:void 0===this.queryType&&0===this.selectedThematics.selected.length}},{key:"getRadius",value:function(){var t;if(t=null!==this.formControl.value?this.measureUnit===ye.Meters?this.formControl.value.radius:this.formControl.value.radius/1e3:void 0,this.type===Ie.Point){if(this.freehandDrawIsActive){if(t){if(t>=1e5)return this.messageService.alert(this.languageService.translate.instant("igo.geo.spatialFilter.radiusAlert"),this.languageService.translate.instant("igo.geo.spatialFilter.warning")),void this.formControl.reset();if(t!==this.radiusFormControl.value)return void this.radiusFormControl.setValue(t)}}else if(this.radiusFormControl.value<0||this.measureUnit===ye.Meters&&this.radiusFormControl.value>=1e5||this.measureUnit===ye.Kilometers&&this.radiusFormControl.value>=100)return this.messageService.alert(this.languageService.translate.instant("igo.geo.spatialFilter.radiusAlert"),this.languageService.translate.instant("igo.geo.spatialFilter.warning")),this.radius=1e3,this.radiusFormControl.setValue(this.measureUnit===ye.Meters?this.radius:this.radius/1e3),void this.drawGuide$.next(this.radius);this.measureUnit===ye.Meters?(this.radius=this.radiusFormControl.value,this.drawGuide$.next(this.radius)):(this.radius=1e3*this.radiusFormControl.value,this.drawGuide$.next(1e3*this.radius)),this.overlayStyle$.next(this.PointStyle),this.drawStyle$.next(this.PointStyle)}}},{key:"toggleVisibleList",value:function(){this.listIsVisible=!this.listIsVisible}},{key:"createTableTemplate",value:function(){var t={name:"meta.title",title:this.languageService.translate.instant("igo.geo.spatialFilter.type"),renderer:at.UnsanitizedHTML},o={name:"properties.nom",title:this.languageService.translate.instant("igo.geo.spatialFilter.searchResults"),renderer:at.UnsanitizedHTML};this.tableTemplate={selection:!0,sort:!0,columns:[t,o]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.sBO),e.Y36(Hi),e.Y36(Ae),e.Y36($))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-spatial-filter-item"]],inputs:{map:"map",type:"type",queryType:"queryType",zone:"zone",loading:"loading",store:"store",layers:"layers",allLayers:"allLayers",thematicLength:"thematicLength"},outputs:{toggleSearch:"toggleSearch",itemTypeChange:"itemTypeChange",thematicChange:"thematicChange",drawZoneEvent:"drawZoneEvent",bufferEvent:"bufferEvent",zoneWithBufferChange:"zoneWithBufferChange",measureUnitChange:"measureUnitChange",radiusEvent:"radiusEvent",freehandControl:"freehandControl",clearButtonEvent:"clearButtonEvent",clearSearchEvent:"clearSearchEvent",export:"export",openWorkspace:"openWorkspace",entityChange:"entityChange"},decls:29,vars:42,consts:[[3,"formControl","map","geometryType","drawGuide","measure","drawControlIsActive","freehandDrawIsActive","drawStyle","overlayStyle","radius"],[1,"header"],[3,"checked","labelPosition","change",4,"ngIf"],["class","buffer-unit",4,"ngIf"],["class","radius-unit",4,"ngIf"],[1,"title","mat-typography"],[3,"value"],[3,"value","change",4,"ngFor","ngForOf"],["class","thematics",4,"ngIf"],[1,"buttons"],["mat-raised-button","","class","clear-search-button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","class","clear-form-button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary",1,"search-button",3,"disabled","click"],["mat-raised-button","",1,"remove-button",3,"disabled","click"],["mat-raised-button","",1,"export-button",3,"disabled","click"],["class","chevron-down","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["class","results",4,"ngIf"],[3,"checked","labelPosition","change"],[1,"buffer-unit"],[1,"buffer-form"],[1,"buffer"],["type","number","matInput","",3,"placeholder","formControl","value","readonly"],[1,"unit-field"],[3,"value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"radius-unit"],[1,"radius-form"],[1,"radius"],["type","number","matInput","",3,"placeholder","formControl","value","readonly","input"],[3,"value","change"],[1,"thematics"],["matColumnDef","name"],["class","thematics-header",4,"matHeaderCellDef"],["matColumnDef","select"],["class","checks-header",4,"matHeaderCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[3,"dataSource","treeControl"],["matTreeNodeToggle","",4,"matTreeNodeDef"],[4,"matTreeNodeDef","matTreeNodeDefWhen"],[1,"thematics-header"],[1,"checks-header"],[3,"checked","indeterminate","change"],["matTreeNodeToggle",""],[1,"mat-tree-node"],["mat-icon-button","","disabled",""],[1,"tree-check",3,"checked","click","change"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"tree-check-2",3,"checked","indeterminate","change"],[1,"tree-ul"],["matTreeNodeOutlet",""],["mat-raised-button","",1,"clear-search-button",3,"disabled","click"],["mat-raised-button","",1,"clear-form-button",3,"disabled","click"],["mat-icon-button","","matTooltipShowDelay","500",1,"chevron-down",3,"matTooltip","click"],["svgIcon","chevron-down"],[1,"results"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],[1,"results-list",3,"template","store","entitySelectChange"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click"],["svgIcon","chevron-up"]],template:function(n,t){1&n&&(e._UZ(0,"igo-geometry-form-field-input",0),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async"),e.TgZ(4,"div",1),e.YNc(5,B1,3,5,"mat-slide-toggle",2),e.YNc(6,U1,3,5,"mat-slide-toggle",2),e.qZA(),e.YNc(7,q1,8,8,"div",3),e.YNc(8,Q1,8,8,"div",4),e.TgZ(9,"mat-label",5),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"mat-radio-group",6),e.YNc(13,Y1,3,4,"mat-radio-button",7),e.qZA(),e.YNc(14,X1,11,5,"div",8),e.TgZ(15,"div",9),e.YNc(16,eS,3,4,"button",10),e.YNc(17,tS,3,4,"button",11),e.TgZ(18,"button",12),e.NdJ("click",function(){return t.toggleSearchButton()}),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"button",13),e.NdJ("click",function(){return t.clearButton()}),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"button",14),e.NdJ("click",function(){return t.export.emit()}),e._uU(25),e.ALo(26,"translate"),e.qZA()(),e.YNc(27,nS,3,3,"button",15),e.YNc(28,iS,3,3,"div",16)),2&n&&(e.Q6J("formControl",t.formControl)("map",t.map)("geometryType",t.geometryType)("drawGuide",e.lcZ(1,28,t.drawGuide$))("measure",t.measure)("drawControlIsActive",t.drawControlIsActive)("freehandDrawIsActive",t.freehandDrawIsActive)("drawStyle",e.lcZ(2,30,t.drawStyle$))("overlayStyle",e.lcZ(3,32,t.overlayStyle$))("radius",t.radius),e.xp6(5),e.Q6J("ngIf",!t.isPredefined()),e.xp6(1),e.Q6J("ngIf",!t.isPredefined()),e.xp6(1),e.Q6J("ngIf",t.isPolygon()),e.xp6(1),e.Q6J("ngIf",t.isPoint()),e.xp6(2),e.hij("",e.lcZ(11,34,"igo.geo.spatialFilter.search")," : "),e.xp6(2),e.Q6J("value",t.selectedItemType),e.xp6(1),e.Q6J("ngForOf",t.itemType),e.xp6(1),e.Q6J("ngIf","Thematics"===t.selectedItemType&&!t.tableTemplate||"Thematics"===t.selectedItemType&&t.tableTemplate&&!t.listIsVisible),e.xp6(2),e.Q6J("ngIf",t.isPredefined()),e.xp6(1),e.Q6J("ngIf",t.isPolygon()||t.isPoint()),e.xp6(1),e.Q6J("disabled",t.disableSearchButton()),e.xp6(1),e.hij(" ",e.lcZ(20,36,"igo.geo.spatialFilter.goSearch")," "),e.xp6(2),e.Q6J("disabled",0===t.allLayers.length),e.xp6(1),e.hij(" ",e.lcZ(23,38,"igo.geo.spatialFilter.removeLayer")," "),e.xp6(2),e.Q6J("disabled",!t.store.entities$.getValue().length),e.xp6(1),e.hij(" ",e.lcZ(26,40,"igo.geo.spatialFilter.exportLayer")," "),e.xp6(2),e.Q6J("ngIf",t.store.all().length&&t.tableTemplate&&!t.listIsVisible),e.xp6(1),e.Q6J("ngIf",t.store.all().length&&t.tableTemplate&&t.listIsVisible))},styles:[".header[_ngcontent-%COMP%]{margin-top:5px;width:100%}.mat-slide-toggle[_ngcontent-%COMP%]{padding:5px;margin-bottom:15px;width:98%}.mat-slide-toggle[_ngcontent-%COMP%]     .mat-slide-toggle-content{width:calc(100% - 20px)}.title[_ngcontent-%COMP%]{margin-left:5px;font-size:medium;font-size:initial}.mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-top:10px}.mat-radio-button[_ngcontent-%COMP%]{display:inline-flex;position:relative;margin-left:16px;margin-top:10px}.mat-form-field[_ngcontent-%COMP%]{margin-top:5px}.mat-column-select[_ngcontent-%COMP%]{overflow:auto}.buttons[_ngcontent-%COMP%]{margin-top:15px}.search-button[_ngcontent-%COMP%]{left:15px;width:46%}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.search-button[_ngcontent-%COMP%]{left:10px;width:45%;min-height:35px;white-space:normal;line-height:normal}}.export-button[_ngcontent-%COMP%]{left:15px;width:46%;margin-bottom:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.export-button[_ngcontent-%COMP%]{left:10px;margin-top:10px;width:45%;min-height:35px;white-space:normal;line-height:normal}}.remove-button[_ngcontent-%COMP%]{margin-top:12px;left:5px;width:46%}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.remove-button[_ngcontent-%COMP%]{margin:0;width:45%;min-height:35px;white-space:normal;line-height:normal}}.clear-form-button[_ngcontent-%COMP%]{left:5px;width:46%}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.clear-form-button[_ngcontent-%COMP%]{width:45%;min-height:35px;white-space:normal;line-height:normal}}.clear-search-button[_ngcontent-%COMP%]{left:5px;width:46%}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.clear-search-button[_ngcontent-%COMP%]{width:45%;min-height:35px;white-space:normal;line-height:normal}}.thematics[_ngcontent-%COMP%]{max-height:35%;overflow:auto;margin-top:5px;width:98%}.results[_ngcontent-%COMP%]{overflow:auto;max-height:250px;width:98%}.mat-column-typeResults[_ngcontent-%COMP%]{max-width:100px;margin-right:5px}.buffer-unit[_ngcontent-%COMP%], .radius-unit[_ngcontent-%COMP%]{display:flex;width:100%;margin-left:2px;padding:5px}.radius[_ngcontent-%COMP%], .buffer[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;width:110%}.unit-field[_ngcontent-%COMP%]{width:110px;margin-left:30px}.example-tree-invisible[_ngcontent-%COMP%]{display:none}.tree-ul[_ngcontent-%COMP%]{margin:0;padding:0 0 0 20px;list-style-type:none}.tree-check[_ngcontent-%COMP%], .tree-check-2[_ngcontent-%COMP%]{position:relative;margin-left:auto;margin-right:5px}.thematics-header[_ngcontent-%COMP%]{max-width:250px}.checks-header[_ngcontent-%COMP%]{padding:none;max-width:calc(100% - 316px);overflow:hidden}.mat-checkbox[_ngcontent-%COMP%]{padding:5px}.mat-tree-node[_ngcontent-%COMP%]{position:relative;min-height:42px;width:280px}.mat-header-cell[_ngcontent-%COMP%]{height:56px}.results[_ngcontent-%COMP%]{max-height:45%;width:98%}.results[_ngcontent-%COMP%]   igo-entity-table[_ngcontent-%COMP%]     div.table-container{overflow:visible;overflow:initial}"],changeDetection:0}),i}(),rS=["endDatepickerTime"],aS=["beginDatepickerTime"],sS=["beginTime"],lS=["endTime"];function cS(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-slide-toggle",4),e.NdJ("ngModelChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.sliderMode=r)})("change",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.modeChange(r))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("ngModel",t.sliderMode),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.filter.sliderModeTitle")," ")}}function uS(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",5)(1,"igo-ogc-filter-time-slider",6),e.NdJ("changeProperty",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.changePropertyByPass(r))}),e.qZA()()}if(2&i){var t=e.oxw();e.xp6(1),e.Q6J("begin",t.beginValue)("max",t.restrictedToStep()?t.maxDate:t.endValue)("currentFilter",t.currentFilter)("datasource",t.datasource)}}function pS(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",9)(1,"mat-form-field",10)(2,"mat-label"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"input",11),e.NdJ("change",function(l){e.CHM(n);var c=e.MAs(8),u=e.oxw(2);return e.KtG(u.yearOnlyInputChange(l,c,"begin"))}),e.qZA(),e._UZ(6,"mat-datepicker-toggle",12),e.TgZ(7,"mat-datepicker",13,14),e.NdJ("yearSelected",function(l){e.CHM(n);var c=e.MAs(8),u=e.oxw(2);return e.KtG(u.yearSelected(l,c,"begin"))}),e.qZA(),e._UZ(9,"input",15,16),e.qZA(),e.TgZ(11,"mat-form-field",10)(12,"mat-label"),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"input",11),e.NdJ("change",function(l){e.CHM(n);var c=e.MAs(18),u=e.oxw(2);return e.KtG(u.yearOnlyInputChange(l,c,"end"))}),e.qZA(),e._UZ(16,"mat-datepicker-toggle",12),e.TgZ(17,"mat-datepicker",13,17),e.NdJ("yearSelected",function(l){e.CHM(n);var c=e.MAs(18),u=e.oxw(2);return e.KtG(u.yearSelected(l,c,"end"))}),e.qZA(),e._UZ(19,"input",15,18),e.qZA(),e.TgZ(21,"button",19),e.NdJ("click",function(){e.CHM(n);var l=e.oxw(2);return e.KtG(l.resetFilter())}),e.ALo(22,"translate"),e._UZ(23,"mat-icon",20),e.qZA(),e.TgZ(24,"mat-slide-toggle",21),e.NdJ("change",function(){e.CHM(n);var l=e.oxw(2);return e.KtG(l.toggleFilterState())}),e.ALo(25,"translate"),e.qZA()()}if(2&i){var t=e.MAs(8),o=e.MAs(18),r=e.oxw(2);e.xp6(3),e.Oqu(e.lcZ(4,27,"igo.geo.timeFilter.startYear")),e.xp6(2),e.s9C("value",r.onlyYearBegin),e.Q6J("disabled",r.filterStateDisable),e.xp6(1),e.Q6J("for",t)("disabled",r.filterStateDisable),e.xp6(1),e.Q6J("startView",r.calendarView())("startAt",r.beginValue),e.xp6(2),e.Q6J("matDatepicker",t)("value",r.beginValue?r.beginValue:r.handleDate(r.datasource.options.minDate))("min",r.handleDate(r.datasource.options.minDate))("max",r.endValue&&!r.restrictedToStep()?r.endValue:r.handleDate(r.datasource.options.maxDate)),e.xp6(4),e.Oqu(e.lcZ(14,29,"igo.geo.timeFilter.endYear")),e.xp6(2),e.s9C("value",r.onlyYearEnd),e.Q6J("disabled",r.filterStateDisable),e.xp6(1),e.Q6J("for",o)("disabled",r.filterStateDisable),e.xp6(1),e.Q6J("startView",r.calendarView())("startAt",r.endValue),e.xp6(2),e.Q6J("matDatepicker",o)("value",r.endValue?r.endValue:r.handleDate(r.datasource.options.maxDate))("min",r.beginValue?r.beginValue:r.handleDate(r.datasource.options.minDate))("max",r.handleDate(r.datasource.options.maxDate)),e.xp6(2),e.Q6J("matTooltip",e.lcZ(22,31,"igo.geo.filter.resetFilters"))("disabled",r.filterStateDisable),e.xp6(2),e.s9C("svgIcon",r.resetIcon),e.xp6(1),e.Q6J("matTooltip",e.lcZ(25,33,"igo.geo.filter.toggleFilterState"))("checked",!r.filterStateDisable)}}function dS(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function gS(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-form-field",33)(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select",34),e.NdJ("selectionChange",function(){e.CHM(n),e.oxw();var r=e.MAs(5),s=e.oxw(2);return e.KtG(s.changeTemporalProperty(r.value,1))}),e.YNc(5,dS,2,2,"mat-option",35),e.qZA()()}if(2&i){var t=e.oxw(3);e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.geo.timeFilter.hour")),e.xp6(2),e.Q6J("formControl",t.beginHourFormControl),e.uIk("disabled",!t.currentFilter.active),e.xp6(1),e.Q6J("ngForOf",t.beginHours)}}function fS(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function mS(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-form-field",37)(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select",34),e.NdJ("selectionChange",function(){e.CHM(n),e.oxw();var r=e.MAs(5),s=e.oxw(2);return e.KtG(s.changeTemporalProperty(r.value,1))}),e.YNc(5,fS,2,2,"mat-option",35),e.qZA()()}if(2&i){var t=e.oxw(3);e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.geo.timeFilter.minute")),e.xp6(2),e.Q6J("formControl",t.beginMinuteFormControl),e.uIk("disabled",!t.currentFilter.active),e.xp6(1),e.Q6J("ngForOf",t.beginMinutes)}}function hS(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function vS(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-form-field",33)(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select",34),e.NdJ("selectionChange",function(){e.CHM(n),e.oxw();var r=e.MAs(4),s=e.oxw(3);return e.KtG(s.changeTemporalProperty(r.value,2))}),e.YNc(5,hS,2,2,"mat-option",35),e.qZA()()}if(2&i){var t=e.oxw(4);e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.geo.timeFilter.hour")),e.xp6(2),e.Q6J("formControl",t.endHourFormControl),e.uIk("disabled",!t.currentFilter.active),e.xp6(1),e.Q6J("ngForOf",t.endHours)}}function yS(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function _S(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-form-field",37)(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select",34),e.NdJ("selectionChange",function(){e.CHM(n),e.oxw();var r=e.MAs(4),s=e.oxw(3);return e.KtG(s.changeTemporalProperty(r.value,2))}),e.YNc(5,yS,2,2,"mat-option",35),e.qZA()()}if(2&i){var t=e.oxw(4);e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.geo.timeFilter.minute")),e.xp6(2),e.Q6J("formControl",t.endMinuteFormControl),e.uIk("disabled",!t.currentFilter.active),e.xp6(1),e.Q6J("ngForOf",t.endMinutes)}}function bS(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",23)(1,"mat-form-field",24),e._UZ(2,"mat-datepicker-toggle",12),e.TgZ(3,"input",25,38),e.NdJ("dateChange",function(){e.CHM(n);var s=e.MAs(4),l=e.oxw(3);return e.KtG(l.changeTemporalProperty(s.value,2))}),e.ALo(5,"translate"),e.qZA(),e._UZ(6,"span",27),e.TgZ(7,"mat-datepicker",28,17),e.NdJ("yearSelected",function(s){e.CHM(n);var l=e.MAs(8),c=e.oxw(3);return e.KtG(c.yearSelected(s,l,"end"))})("monthSelected",function(s){e.CHM(n);var l=e.MAs(8),c=e.oxw(3);return e.KtG(c.monthSelected(s,l,"end"))}),e.qZA()(),e.TgZ(9,"div",29),e.YNc(10,vS,6,6,"mat-form-field",30),e.YNc(11,_S,6,6,"mat-form-field",31),e.qZA()()}if(2&i){var t=e.MAs(8),o=e.oxw(3);e.xp6(2),e.Q6J("for",t)("disabled",o.filterStateDisable),e.xp6(1),e.Q6J("matDatepicker",t)("placeholder",e.lcZ(5,14,"igo.geo.timeFilter.endDate"))("matDatepickerFilter",o.dateFilter.bind(o,"end"))("value",o.endValue?o.endValue:o.handleDate(o.datasource.options.maxDate))("min",o.beginValue?o.beginValue:o.handleDate(o.datasource.options.minDate))("max",o.handleDate(o.datasource.options.maxDate))("disabled",o.filterStateDisable),e.uIk("disabled",!o.currentFilter.active),e.xp6(4),e.Q6J("startView",o.calendarView())("startAt",o.endValue),e.xp6(3),e.Q6J("ngIf","datetime"===o.calendarType()),e.xp6(1),e.Q6J("ngIf","datetime"===o.calendarType())}}function CS(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",22)(1,"div",23)(2,"mat-form-field",24),e._UZ(3,"mat-datepicker-toggle",12),e.TgZ(4,"input",25,26),e.NdJ("dateChange",function(){e.CHM(n);var s=e.MAs(5),l=e.oxw(2);return e.KtG(l.changeTemporalProperty(s.value,1))}),e.ALo(6,"translate"),e.qZA(),e._UZ(7,"span",27),e.TgZ(8,"mat-datepicker",28,14),e.NdJ("yearSelected",function(s){e.CHM(n);var l=e.MAs(9),c=e.oxw(2);return e.KtG(c.yearSelected(s,l,"begin"))})("monthSelected",function(s){e.CHM(n);var l=e.MAs(9),c=e.oxw(2);return e.KtG(c.monthSelected(s,l,"begin"))}),e.qZA()(),e.TgZ(10,"div",29),e.YNc(11,gS,6,6,"mat-form-field",30),e.YNc(12,mS,6,6,"mat-form-field",31),e.qZA()(),e.YNc(13,bS,12,16,"div",32),e.TgZ(14,"button",19),e.NdJ("click",function(){e.CHM(n);var s=e.oxw(2);return e.KtG(s.resetFilter())}),e.ALo(15,"translate"),e._UZ(16,"mat-icon",20),e.qZA(),e.TgZ(17,"mat-slide-toggle",21),e.NdJ("change",function(){e.CHM(n);var s=e.oxw(2);return e.KtG(s.toggleFilterState())}),e.ALo(18,"translate"),e.qZA()()}if(2&i){var t=e.MAs(9),o=e.oxw(2);e.xp6(3),e.Q6J("for",t)("disabled",o.filterStateDisable),e.xp6(1),e.Q6J("matDatepicker",t)("placeholder",e.lcZ(6,20,"igo.geo.timeFilter.startDate"))("matDatepickerFilter",o.dateFilter.bind(o,"begin"))("value",o.beginValue?o.beginValue:o.handleDate(o.datasource.options.minDate))("min",o.handleDate(o.datasource.options.minDate))("max",o.endValue&&!o.restrictedToStep()?o.endValue:o.handleDate(o.datasource.options.maxDate))("disabled",o.filterStateDisable),e.uIk("disabled",!o.currentFilter.active),e.xp6(4),e.Q6J("startView",o.calendarView())("startAt",o.beginValue),e.xp6(3),e.Q6J("ngIf","datetime"===o.calendarType()),e.xp6(1),e.Q6J("ngIf","datetime"===o.calendarType()),e.xp6(1),e.Q6J("ngIf",!o.restrictedToStep()),e.xp6(1),e.Q6J("matTooltip",e.lcZ(15,22,"igo.geo.filter.resetFilters"))("disabled",o.filterStateDisable),e.xp6(2),e.s9C("svgIcon",o.resetIcon),e.xp6(1),e.Q6J("matTooltip",e.lcZ(18,24,"igo.geo.filter.toggleFilterState"))("checked",!o.filterStateDisable)}}function SS(i,a){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,pS,26,35,"div",7),e.YNc(2,CS,19,26,"div",8),e.qZA()),2&i){var n=e.oxw();e.xp6(1),e.Q6J("ngIf",n.calendarTypeYear),e.xp6(1),e.Q6J("ngIf","year"!==n.calendarType())}}var Bs=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.ogcFilterTimeService=n,this.changeProperty=new e.vpe,this.beginHourFormControl=new S.p4,this.beginMinuteFormControl=new S.p4,this.endHourFormControl=new S.p4,this.endMinuteFormControl=new S.p4,this._defaultMin="1900-01-01",this._defaultMax="2052-01-06",this._defaultDisplayFormat="DD/MM/YYYY HH:mm A",this._defaultSliderModeEnabled=!0,this.ogcFilterOperator=G,this.sliderMode=!1,this.defaultStepMillisecond=6e4,this.calendarTypeYear=!1,this.resetIcon="replay"}return(0,v.Z)(a,[{key:"step",get:function(){return this.datasource.options.stepDate?this.datasource.options.stepDate:this.currentFilter.step}},{key:"stepMilliseconds",get:function(){var t=H.duration(this.step).asMilliseconds();return 0===t?this.defaultStepMillisecond:t}},{key:"beginValue",get:function(){return this._beginValue},set:function(t){this._beginValue=t}},{key:"endValue",get:function(){return this._endValue},set:function(t){this._endValue=t}},{key:"sliderInterval",get:function(){return void 0===this.currentFilter.sliderInterval?2e3:this.currentFilter.sliderInterval}},{key:"maxDate",get:function(){return this.datasource.options.maxDate?this.datasource.options.maxDate:this._defaultMax}},{key:"displayFormat",get:function(){return this.currentFilter.displayFormat?this.currentFilter.displayFormat:this._defaultDisplayFormat}},{key:"ngOnInit",value:function(){this.currentFilter.sliderOptions&&(this.currentFilter.sliderOptions.enabled=void 0!==this.currentFilter.sliderOptions.enabled?this.currentFilter.sliderOptions.enabled:this._defaultSliderModeEnabled),this.beginValue=this.parseFilter(this.handleMin()),this.endValue=this.parseFilter(this.handleMax()),this.onlyYearBegin=this.beginValue.getUTCFullYear(),this.onlyYearEnd=this.endValue.getUTCFullYear(),this.calendarTypeYear=this.isCalendarYearMode(),this.setFilterStateDisable(),this.updateHoursMinutesArray(),this.updateValues()}},{key:"parseFilter",value:function(t){if(!t)return new Date;if(isNaN(new Date(t).getTime())){if(t.search("now")>=0){var o=t.match(/years|months|weeks|days|hours|seconds/);if(t.match(/\+/)){var r=parseInt(t.substring(t.search("+")+1,o.index),10);return H().add(r,o[0]).toDate()}if(t.match(/\-/)){var s=parseInt(t.substring(t.search("-")+1,o.index),10);return H().subtract(s,o[0]).toDate()}return new Date}if(t.search("today")>=0){var l=H().endOf("day").toDate(),c=t.match(/years|months|weeks|days|hours|seconds/);if(t.match(/\+/)){var u=parseInt(t.substring(t.search("+")+1,c.index),10);return H(l).add(u,c[0]).toDate()}if(t.match(/\-/)){var p=parseInt(t.substring(t.search("-")+1,c.index),10);return H(l).subtract(p,c[0]).toDate()}return l}return new Date}return this.currentFilter.calendarModeYear?this.getDateFromStringWithoutTime(t):t?new Date(t):new Date}},{key:"changeTemporalProperty",value:function(t,o){var l,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=this.getDateTime(t,o);if(this.isCalendarYearMode())return 1===o?(this.beginValue=t,this.onlyYearBegin=this.beginValue.getFullYear(),l="".concat(this.onlyYearBegin,"-01-01")):(this.endValue=t,this.onlyYearEnd=this.endValue.getFullYear(),l="".concat(this.onlyYearEnd,"-01-01")),void this.changeProperty.next({value:l,pos:o,refreshFilter:r});2===o&&"date"===this.calendarType()&&!this.sliderMode&&(s=H(s).endOf("day").toDate()),1===o?(this.beginValue=s,this.restrictedToStep()&&this.changeTemporalProperty(this.ogcFilterTimeService.addStep(s,this.stepMilliseconds),2,r)):this.endValue=s,this.updateHoursMinutesArray(),this.changeProperty.next({value:s.toISOString(),pos:o,refreshFilter:r})}},{key:"handleDate",value:function(t){if(t&&""!==t)return"string"==typeof t&&this.currentFilter.calendarModeYear?this.getDateFromStringWithoutTime(t):new Date(t)}},{key:"calendarType",value:function(){return this.currentFilter.calendarModeYear?"year":this.stepMilliseconds<864e5?"datetime":"date"}},{key:"isCalendarYearMode",value:function(){return"year"===this.calendarType()}},{key:"yearOnlyInputChange",value:function(t,o,r){var l=this.getDateFromStringWithoutTime(t.target.value);this.yearSelected(l,o,r)}},{key:"yearSelected",value:function(t,o,r){var s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.ogcFilterTimeService.stepIsYearDuration(this.step)&&(o&&o.close(),"end"===r?t=H(t).endOf("year").toDate():"begin"===r&&this.restrictedToStep()&&!this.calendarTypeYear&&this.yearSelected(t,void 0,"end"),this.changeTemporalProperty(t,"begin"===r?1:2,s))}},{key:"monthSelected",value:function(t,o,r){var s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.ogcFilterTimeService.stepIsMonthDuration(this.step)&&(o&&o.close(),"end"===r?t=H(t).endOf("month").toDate():"begin"===r&&this.restrictedToStep()&&this.monthSelected(t,void 0,"end"),this.changeTemporalProperty(t,"begin"===r?1:2,s))}},{key:"calendarView",value:function(){var t=this.stepMilliseconds,o=Math.abs(this.parseFilter(this.currentFilter.end).getTime()-this.parseFilter(this.currentFilter.begin).getTime());return this.ogcFilterTimeService.stepIsYearDuration(this.step)?"multi-year":this.ogcFilterTimeService.stepIsMonthDuration(this.step)?"year":t<864e5&&o<864e5?"clock":"month"}},{key:"dateFilter",value:function(t,o){var r=new Date(o),s=r.getTime()-new Date(this.handleMin()).getTime();if(this.ogcFilterTimeService.stepIsYearDuration(this.step)){var l=H(r).diff(H(this.handleMin()),"years",!0);if("end"===t){var c=H(r).add(1,"d");return H(c).diff(H(this.handleMin()),"years",!0)%H.duration(this.step).asYears()==0}if("begin"===t)return l%H.duration(this.step).asYears()==0}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.step)){var p=H(r).diff(H(this.handleMin()),"months",!0);if("end"===t){var d=H(r).add(1,"d");return H(d).diff(H(this.handleMin()),"months",!0)%H.duration(this.step).asMonths()==0}if("begin"===t)return p%H.duration(this.step).asMonths()==0}else if(this.ogcFilterTimeService.stepIsWeekDuration(this.step)){var f=H(r).diff(H(this.handleMin()),"weeks",!0);if("end"===t){var m=H(r).add(1,"d");return H(m).diff(H(this.handleMin()),"weeks",!0)%H.duration(this.step).asWeeks()==0}if("begin"===t)return f%H.duration(this.step).asWeeks()==0}else if(this.ogcFilterTimeService.stepIsDayDuration(this.step)){var _=H(r).diff(H(this.handleMin()),"days",!0);if("end"===t){var b=H(r).add(1,"d"),T=H(b).diff(H(this.handleMin()),"days",!0)%H.duration(this.step).asDays();return T<1e-7&&T>-1e-7||0===T}if("begin"===t){var M=_%H.duration(this.step).asDays()+1;return M<1e-7&&M>-1e-7&&0!==M||1===M}}else{if(this.ogcFilterTimeService.stepIsHourDuration(this.step))return H(r).diff(H(this.handleMin()),"hours",!0)%H.duration(this.step).asHours()==0;if(this.ogcFilterTimeService.stepIsMinuteDuration(this.step))return!0}return s%this.stepMilliseconds==0}},{key:"getDateTime",value:function(t,o){var s,r=new Date(t);if(!this.sliderMode)switch(o){case 1:if(this.currentFilter.calendarModeYear){s=r.setHours(0,0);break}s=r.setHours(this.beginHourFormControl.value,this.beginMinuteFormControl.value);break;case 2:if(this.currentFilter.calendarModeYear){s=r.setHours(0,0);break}s=r.setHours(this.endHourFormControl.value,this.endMinuteFormControl.value)}return new Date(s||r)}},{key:"handleMinuteIncrement",value:function(){return this.ogcFilterTimeService.stepIsMinuteDuration(this.step)?this.stepMilliseconds<36e5?this.stepMilliseconds/1e3==60?1:this.stepMilliseconds/1e3:this.stepMilliseconds%36e5/60:this.ogcFilterTimeService.stepIsHourDuration(this.step)?60:1}},{key:"handleHourIncrement",value:function(){return this.ogcFilterTimeService.stepIsHourDuration(this.step)?this.stepMilliseconds/1e3/60/60:1}},{key:"fullBeginHoursArray",value:function(t){var o=this;this.beginHours=Array.from(t?{length:(this.endHourFormControl.value-0)/this.handleHourIncrement()+1}:{length:23/this.handleHourIncrement()+1},function(r,s){return 0+s*o.handleHourIncrement()}),this.beginHourFormControl.setValue(this.beginValue.getHours())}},{key:"fullEndHoursArray",value:function(t){var o=this;this.endHours=t?Array.from({length:(23-this.beginHourFormControl.value)/this.handleHourIncrement()+1},function(r,s){return o.beginHourFormControl.value+s*o.handleHourIncrement()}):Array.from({length:23/this.handleHourIncrement()+1},function(r,s){return 0+s*o.handleHourIncrement()}),this.endHourFormControl.setValue(this.endValue.getHours())}},{key:"fullBeginMinutesArray",value:function(t){var o=this;this.beginMinutes=Array.from(t?{length:(this.endMinuteFormControl.value-0)/this.handleMinuteIncrement()+1}:{length:59/this.handleMinuteIncrement()+1},function(r,s){return 0+s*o.handleMinuteIncrement()}),this.beginMinuteFormControl.setValue(this.beginValue.getMinutes())}},{key:"fullEndMinutesArray",value:function(t){var o=this;this.endMinutes=t?Array.from({length:(59-this.beginMinuteFormControl.value)/this.handleMinuteIncrement()+1},function(r,s){return o.beginMinuteFormControl.value+s*o.handleMinuteIncrement()}):Array.from({length:59/this.handleMinuteIncrement()+1},function(r,s){return 0+s*o.handleMinuteIncrement()}),this.endMinuteFormControl.setValue(this.endValue.getMinutes())}},{key:"updateHoursMinutesArray",value:function(){var t=new Date(this.beginValue),o=new Date(this.endValue);t.setHours(0,0)===o.setHours(0,0)?(this.fullBeginHoursArray(!0),this.fullEndHoursArray(!0),this.beginValue.getHours()===this.endValue.getHours()&&(this.fullBeginMinutesArray(!0),this.fullEndMinutesArray(!0))):(this.fullBeginHoursArray(),this.fullEndHoursArray(),this.fullBeginMinutesArray(),this.fullEndMinutesArray())}},{key:"updateValues",value:function(){this.changeTemporalProperty(this.beginValue,1,!1),this.changeTemporalProperty(this.endValue,2,!0)}},{key:"restrictedToStep",value:function(){return!!this.currentFilter.restrictToStep&&this.currentFilter.restrictToStep}},{key:"handleMin",value:function(){return this.currentFilter.begin?this.currentFilter.begin:this.datasource.options.minDate?this.datasource.options.minDate:this._defaultMin}},{key:"handleMax",value:function(){return this.currentFilter.end?this.currentFilter.end:this.datasource.options.maxDate?this.datasource.options.maxDate:this._defaultMax}},{key:"changePropertyByPass",value:function(t){this.changeProperty.next(t)}},{key:"modeChange",value:function(t){t.checked||this.updateValues()}},{key:"setFilterStateDisable",value:function(){this.filterStateDisable=!!this.currentFilter&&!this.currentFilter.active,"datetime"===this.calendarType()&&(!0===this.filterStateDisable?(this.beginHourFormControl.disable(),this.beginMinuteFormControl.disable(),this.endHourFormControl.disable(),this.endMinuteFormControl.disable()):(this.beginHourFormControl.enable(),this.beginMinuteFormControl.enable(),this.endHourFormControl.enable(),this.endMinuteFormControl.enable()))}},{key:"getDateFromStringWithoutTime",value:function(t){var o,r="01",s="01";if(10===t.length){var l=t.split("-");if(3!==l.length)throw new Error("Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY");o=l[0],r=l[1],s=l[2]}else{if(4!==t.length)return new Date(t);o=t}return new Date("".concat(o,"-").concat(r,"-").concat(s," 00:00:00"))}},{key:"resetFilter",value:function(){var o,r,s,l,t=this.datasource.options.ogcFilters.filters;if(this.calendarTypeYear){if("today"===t.end){var c=(new Date).toLocaleDateString("en-CA");l="".concat(c.substring(0,4),"-01-01")}else l="".concat(t.end.substring(0,4),"-01-01");s="".concat(t.begin.substring(0,4),"-01-01"),o=this.getDateFromStringWithoutTime(s),r=this.getDateFromStringWithoutTime(l)}else o=this.parseFilter(t.begin),r=this.parseFilter(t.end),s=o.toISOString(),l=r.toISOString();(this.currentFilter.begin!==s||this.currentFilter.end!==l)&&(this.beginValue=o,this.endValue=r,this.updateValues())}},{key:"toggleFilterState",value:function(){this.currentFilter.active=!0!==this.currentFilter.active,this.setFilterStateDisable(),this.updateValues()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36($s))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filter-time"]],viewQuery:function(n,t){var o;1&n&&(e.Gf(rS,5),e.Gf(aS,5),e.Gf(sS,5),e.Gf(lS,5)),2&n&&(e.iGM(o=e.CRH())&&(t.endDatepickerTime=o.first),e.iGM(o=e.CRH())&&(t.beginDatepickerTime=o.first),e.iGM(o=e.CRH())&&(t.beginTime=o.first),e.iGM(o=e.CRH())&&(t.endTime=o.first))},inputs:{datasource:"datasource",currentFilter:"currentFilter"},outputs:{changeProperty:"changeProperty"},decls:4,vars:3,consts:[[1,"datetime-container"],[3,"ngModel","ngModelChange","change",4,"ngIf"],["class","slider-container",4,"ngIf"],[4,"ngIf"],[3,"ngModel","ngModelChange","change"],[1,"slider-container"],[3,"begin","max","currentFilter","datasource","changeProperty"],["class","year-input-container",4,"ngIf"],["class","datetime-input-container",4,"ngIf"],[1,"year-input-container"],[1,"year-input"],["matInput","",1,"year-input-only-year",3,"value","disabled","change"],["matSuffix","",3,"for","disabled"],["panelClass","datepicker-year",3,"startView","startAt","yearSelected"],["beginDatepicker",""],["matInput","","enabled","false","readonly","true",1,"year-input-hide",3,"matDatepicker","value","min","max"],["beginYear",""],["endDatepicker",""],["endYear",""],["mat-icon-button","","color","primary",1,"reset-button",3,"matTooltip","disabled","click"],[3,"svgIcon"],["tooltip-position","below","matTooltipShowDelay","500",1,"toggle-filter-state",3,"matTooltip","checked","change"],[1,"datetime-input-container"],[1,"datetime-input"],[1,"date-input"],["matInput","",3,"matDatepicker","placeholder","matDatepickerFilter","value","min","max","disabled","dateChange"],["begin",""],[1,"filler"],[3,"startView","startAt","yearSelected","monthSelected"],[1,"time-input"],["class","hour-input",4,"ngIf"],["class","minute-input",4,"ngIf"],["class","datetime-input",4,"ngIf"],[1,"hour-input"],[3,"formControl","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"minute-input"],["end",""]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.YNc(1,cS,3,4,"mat-slide-toggle",1),e.YNc(2,uS,2,4,"div",2),e.YNc(3,SS,3,2,"div",3),e.qZA()),2&n&&(e.xp6(1),e.Q6J("ngIf",null==t.currentFilter.sliderOptions?null:t.currentFilter.sliderOptions.enabled),e.xp6(1),e.Q6J("ngIf",t.sliderMode),e.xp6(1),e.Q6J("ngIf",!t.sliderMode))},styles:["input{text-align:center!important;margin:auto 5px!important}.slider-container[_ngcontent-%COMP%]{text-align:center}.datetime-input[_ngcontent-%COMP%]{display:inline-block;width:100px;margin:10px 0 5px 10px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.datetime-input[_ngcontent-%COMP%]{width:36%;margin:0}}.date-input[_ngcontent-%COMP%]{width:100px;margin-right:25px}.time-input[_ngcontent-%COMP%]{margin-right:25px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.time-input[_ngcontent-%COMP%]{margin-right:5px}}.hour-input[_ngcontent-%COMP%], .minute-input[_ngcontent-%COMP%]{width:35px;margin-left:7px}.year-input[_ngcontent-%COMP%]{width:98px;margin:10px 14px 5px 4px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.year-input[_ngcontent-%COMP%]{width:32%;margin:0 0 0 10px}}.year-input-hide[_ngcontent-%COMP%]{width:120px;margin-right:25px;display:none}.year-input-only-year[_ngcontent-%COMP%]{width:120px;margin-right:25px}.reset-button[_ngcontent-%COMP%]{width:25px;padding-left:8px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.reset-button[_ngcontent-%COMP%]{padding-left:8px}}.toggle-filter-state[_ngcontent-%COMP%]{padding-left:20px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.toggle-filter-state[_ngcontent-%COMP%]{padding-left:12px}}  .datepicker-year   .mat-calendar-arrow{display:none}  .datepicker-year   .mat-calendar-period-button{pointer-events:none}  .datepicker-year   .mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover{background-color:#0000001f;border-radius:999px}"]}),i}(),wS=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.ogcFilterTimeService=n,this.changeProperty=new e.vpe,this.sliderValue=1,this.calculatedStep=0,this._defaultDisplayFormat="DD/MM/YYYY HH:mm A",this._defaultSliderInterval=2e3,this.playIcon="play-circle",this.resetIcon="replay",this.sliderDisplayWith=this.sliderDisplayWith.bind(this)}return(0,v.Z)(a,[{key:"sliderInterval",get:function(){return void 0===this.currentFilter.sliderInterval?this._defaultSliderInterval:this.currentFilter.sliderInterval}},{key:"displayFormat",get:function(){var t;return null!==(t=this.currentFilter.sliderOptions)&&void 0!==t&&t.displayFormat?this.currentFilter.sliderOptions.displayFormat:this.currentFilter.displayFormat?this.currentFilter.displayFormat:this._defaultDisplayFormat}},{key:"beginMillisecond",get:function(){return this.ogcFilterTimeService.dateToNumber(this.begin)}},{key:"maxMillisecond",get:function(){return this.ogcFilterTimeService.dateToNumber(this.max)}},{key:"stepMillisecond",get:function(){return this.ogcFilterTimeService.stepMillisecond(this.datasource,this.currentFilter)}},{key:"ngOnInit",value:function(){this.calculateStep(),this.handleSliderInput({value:1})}},{key:"sliderDisplayWith",value:function(t){var o=new Date(this.beginMillisecond+(t-1)*this.stepMillisecond);if(this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){var r=H.duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).years();o=H(this.beginMillisecond).add((t-1)*r,"year").toDate()}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){var s=H.duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).months();o=H(this.beginMillisecond).add((t-1)*s,"month").toDate()}return H(o).format(this.displayFormat)}},{key:"playFilter",value:function(t){var o=this;this.interval?this.stopFilter():(this.playIcon="pause-circle",this.interval=setInterval(function(r){o.slider.value<o.calculatedStep?(o.slider._increment(1),o.slider._emitInputEvent()):o.stopFilter()},this.sliderInterval,this))}},{key:"stopFilter",value:function(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play-circle"}},{key:"resetFilter",value:function(t){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play-circle",this.slider.value=1,this.slider._emitInputEvent()}},{key:"handleSliderInput",value:function(t){if(t)if(this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){var o=H.duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).years(),r=H(this.beginMillisecond).add((t.value-1)*o,"year").toDate(),s=H(r).add(o,"year").toDate();this.changeProperty.next({value:H(r).toDate().toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:H(s).toDate().toISOString(),pos:2,refreshFilter:!0})}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){var l=H.duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).months(),c=H(this.beginMillisecond).add((t.value-1)*l,"month").toDate(),u=H(c).add(l,"month").toDate();this.changeProperty.next({value:H(c).startOf("month").toDate().toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:H(u).toDate().toISOString(),pos:2,refreshFilter:!0})}else if(this.ogcFilterTimeService.stepIsDayDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))||this.ogcFilterTimeService.stepIsHourDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))||this.ogcFilterTimeService.stepIsMinuteDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){var p=new Date(this.beginMillisecond+this.stepMillisecond*(t.value-1));this.changeProperty.next({value:p.toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:new Date(this.ogcFilterTimeService.addStep(p.toISOString(),this.stepMillisecond)).toISOString(),pos:2,refreshFilter:!0})}}},{key:"calculateStep",value:function(){for(var t=1;this.maxMillisecond-(this.beginMillisecond+t*this.stepMillisecond)>=-1;t++)this.calculatedStep=t}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36($s))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filter-time-slider"]],viewQuery:function(n,t){var o;1&n&&e.Gf(So.pH,5),2&n&&e.iGM(o=e.CRH())&&(t.slider=o.first)},inputs:{currentFilter:"currentFilter",begin:"begin",max:"max",datasource:"datasource"},outputs:{changeProperty:"changeProperty"},decls:6,vars:7,consts:[[1,"slider-container"],["id","time-slider","thumbLabel","",3,"step","min","max","ngModel","displayWith","ngModelChange","input"],["mat-icon-button","","color","primary",3,"click"],[3,"svgIcon"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"mat-slider",1),e.NdJ("ngModelChange",function(r){return t.sliderValue=r})("input",function(r){return t.handleSliderInput(r)}),e.qZA(),e.TgZ(2,"button",2),e.NdJ("click",function(r){return t.playFilter(r)}),e._UZ(3,"mat-icon",3),e.qZA(),e.TgZ(4,"button",2),e.NdJ("click",function(r){return t.resetFilter(r)}),e._UZ(5,"mat-icon",3),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("step",1)("min",1)("max",t.calculatedStep)("ngModel",t.sliderValue)("displayWith",t.sliderDisplayWith),e.xp6(2),e.Q6J("svgIcon",t.playIcon),e.xp6(2),e.s9C("svgIcon",t.resetIcon))},dependencies:[S.JJ,S.On,O.Hw,I.lW,So.pH],styles:["input{text-align:center!important;margin:auto 5px!important}  .mat-slider-thumb{transform:scale(0)!important}  .mat-slider-thumb-label{transform:rotate(45deg)!important;border-radius:50% 50% 0!important;background-color:#ffd740!important}  .mat-slider-thumb-label-text{opacity:1!important;transform:rotate(135deg)!important}  .mat-slider-horizontal .mat-slider-thumb-label{top:10px!important;transform:rotate(225deg)!important}  .mat-slider-horizontal.cdk-focused .mat-slider-thumb-label{transform:rotate(225deg)!important}.datetime-container[_ngcontent-%COMP%], .slider-container[_ngcontent-%COMP%]{text-align:center}.datetime-input[_ngcontent-%COMP%]{display:inline-block;margin:5px 25px}.date-input[_ngcontent-%COMP%]{width:120px;margin-right:25px}.time-input[_ngcontent-%COMP%]{display:inherit;margin-right:25px}.hour-input[_ngcontent-%COMP%], .minute-input[_ngcontent-%COMP%]{width:40px}.minute-input[_ngcontent-%COMP%]{margin-left:10px}"]}),i}(),Jn=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[{provide:ie.Ad,useValue:"fr-FR"}]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[du,Os,$s,Hi],imports:[C.ez,S.u5,S.UX,_t.Bb,O.Ps,I.ot,Ot.Nh,Ft.Fk,Ve.Tx,Pe.p0,Kn.dp,ot.vV,pt.p9,So.KP,ht.rP,B.lN,le.c,ie.Ng,ke.LD,X.ie,J.AV,jn.FA,ie.XK,Ai.ni,Ai.IZ,he,Fo,Po,yo,Pl,Gg,Jo,Es,bt.g]}),i}();e.B6R(zi,[C.O5,O.Hw,I.lW,J.gM,Yt,bt.k,jr],[E.X$]),e.B6R(jr,[C.mk,C.O5,C.PC,O.Hw,I.lW,X.Tg,X.eA,ie.X2,J.gM,Ni,Do,Yb],[C.Ov,E.X$]),e.B6R(Hr,[C.sg,Yt,Pn,jr],[pu]),e.B6R(Cu,[C.mk,C.sg,C.O5,_t.XC,_t.ZL,ie.ey,O.Hw,I.lW,pt.oG,B.KE,B.R9,le.Nt,ke.gD,J.gM,Bs],[C.Ov,E.X$,vo]),e.B6R(Ki,[C.O5,O.Hw,I.lW,J.gM,Yt,bt.k,Wi],[E.X$]),e.B6R(wu,[C.sg,C.O5,C.PC,S._Y,S.Fj,S.JJ,S.JL,S.On,S.sg,S.u,_t.XC,_t.ZL,ie.ey,O.Hw,Ft.VQ,Ft.U0,ot.A9,ot.Yi,pt.oG,B.KE,le.Nt,ke.gD,Mt.d,J.gM,Bs],[C.Ov,E.X$]),e.B6R(Su,[C.sg,C.O5,Yt,Cu,wu],[]),e.B6R(Wi,[C.mk,C.O5,C.PC,S.JJ,S.On,O.Hw,I.lW,pt.oG,X.Tg,X.eA,ie.X2,Mt.d,J.gM,Ni,Do,Su],[C.Ov,E.X$]),e.B6R(Vr,[C.sg,C.O5,Yt,Pn,Wi],[E.X$,pu]),e.B6R(Rs,[C.sg,ie.ey,O.Hw,Ot.SP,Ot.uX,ot.A9,ot.Yi,B.KE,B.hX,ke.gD,J.gM,J1],[E.X$]),e.B6R(Js,[C.sg,C.O5,S._Y,S.Fj,S.wV,S.JJ,S.JL,S.F,S.oH,ie.ey,O.Hw,I.lW,Ft.VQ,Ft.U0,Pe.BZ,Pe.fO,Pe.as,Pe.w1,Pe.nj,Pe.ge,Pe.XQ,Pe.Gk,Kn.GZ,Kn.fQ,Kn.eu,Kn.gi,Kn.uo,Kn.Ar,pt.oG,ht.Rr,B.KE,B.hX,le.Nt,ke.gD,J.gM,ho,_u],[C.Ov,E.X$]),e.B6R(Bs,[C.sg,C.O5,S.JJ,S.On,S.oH,ie.ey,O.Hw,I.lW,ht.Rr,B.KE,B.hX,B.R9,le.Nt,ke.gD,J.gM,jn.Mq,jn.hl,jn.nW,wS],[E.X$]);var Tu=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n)}((0,wi.Z)(Error)),xS=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){var t;return(0,h.Z)(this,n),t=a.call(this,"Invalid file"),Object.setPrototypeOf((0,kt.Z)(t),n.prototype),t}return(0,v.Z)(n)}(Tu),xu=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){var t;return(0,h.Z)(this,n),t=a.call(this,"Nothing to export"),Object.setPrototypeOf((0,kt.Z)(t),n.prototype),t}return(0,v.Z)(n)}(Tu),ve=_n(["URL","GeoJSON","GML","GPX","KML","Shapefile","CSVcomma","CSVsemicolon"]),hn=_n(["UTF8","LATIN1"]),Ns=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.config=n,this.aggregateInComment=!0,this.ogreUrl=this.config.getConfig("importExport.url");var t=this.config.getConfig("importExport.gpxAggregateInComment");void 0!==t&&(this.aggregateInComment=t)}return(0,v.Z)(a,[{key:"export",value:function(t,o,r,s){var l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"EPSG:4326",c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"EPSG:4326",u=this.generateFeature(t,o);return this.exportAsync(u,o,r,s,l,c)}},{key:"generateFeature",value:function(t,o){return o===ve.GPX&&this.aggregateInComment?this.generateAggregatedFeature(t):t.map(function(r){var l=r.getKeys().filter(function(c){return!c.startsWith("_")}).reduce(function(c,u){return c[u]=r.get(u),c},{geometry:r.getGeometry()});return new nt.Z(l)})}},{key:"generateAggregatedFeature",value:function(t){return t.map(function(o){var r=o.getKeys().filter(function(u){return!u.startsWith("_")}),s="",l=r.reduce(function(u,p){return p&&"geometry"!==p&&("id"===p&&o.get("draw")?s+=p+":"+o.get("draw")+"   \r\n":s+=p+":"+o.get(p)+"   \r\n"),u[p]=o.get(p),u},{geometry:o.getGeometry()}),c=new nt.Z(l);return c.set("name",o.getId()),c.set("cmt",s),c})}},{key:"exportAsync",value:function(t,o,r,s,l,c){var u=this;return new rt.y(function(g){if(u.nothingToExport(t,o))g.error(new xu);else if(Object.keys(a.ogreFormats).indexOf(o)>=0){if(!u.ogreUrl)return void(a.noOgreFallbacks.indexOf(o)>=0?u.exportToFile(t,g,o,r,l,c):g.error(new xS));u.exportWithOgre(t,g,o,r,s,l,c)}else u.exportToFile(t,g,o,r,l,c)})}},{key:"exportToFile",value:function(t,o,r,s,l,c){(function hl(i,a,n){!function ed(i,a){var n=document.createElement("a");n.setAttribute("href",i),n.setAttribute("download",a),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}("data:".concat(a,",").concat(encodeURIComponent(i)),n)})((new Fr[r]).writeFeatures(t,{dataProjection:c,featureProjection:l,featureType:"feature",featureNS:"http://example.com/feature"}),"text/plain;charset=utf-8","".concat(s,".").concat(r.toLowerCase())),o.complete()}},{key:"exportWithOgre",value:function(t,o,r,s,l,c,u){var p=(new Ee.Z).writeFeatures(t,{dataProjection:u,featureProjection:c}),d="".concat(this.ogreUrl,"/convertJson"),g=document.createElement("form");if(g.style.display="none",document.body.appendChild(g),g.setAttribute("method","post"),g.setAttribute("target","_blank"),g.setAttribute("action",d),l===hn.UTF8)g.acceptCharset="UTF-8",g.enctype="application/x-www-form-urlencoded; charset=utf-8;";else if(l===hn.LATIN1){var m=JSON.parse(p);m.features.map(function(L){var Z=String.fromCharCode.apply(null,(0,bv.cv)(JSON.stringify(L.properties),{mode:"replacement"}));L.properties=JSON.parse(Z)}),p=JSON.stringify(m);var y=document.createElement("input");y.setAttribute("type","hidden"),y.setAttribute("name","encoding"),y.setAttribute("value","ISO-8859-1"),g.appendChild(y)}if("CSVsemicolon"===r){var _=document.createElement("input");_.setAttribute("type","hidden"),_.setAttribute("name","lco"),_.setAttribute("value","SEPARATOR=SEMICOLON"),g.appendChild(_)}var b=document.createElement("input");b.setAttribute("type","hidden"),b.setAttribute("name","json"),b.setAttribute("value",p),g.appendChild(b);var w=document.createElement("input"),T="Shapefile"===r?"".concat(s,".zip"):"".concat(s,".").concat(r.toLowerCase());("CSVcomma"===r||"CSVsemicolon"===r)&&(T="".concat(s,".csv")),T=(T=T.replace(" ","_")).normalize("NFD").replace(/[\u0300-\u036f]/g,""),w.setAttribute("type","hidden"),w.setAttribute("name","outputName"),w.setAttribute("value",T),g.appendChild(w);var M=a.ogreFormats[r];("CSVcomma"===r||"CSVsemicolon"===r)&&(M="CSV");var A=document.createElement("input");A.setAttribute("type","hidden"),A.setAttribute("name","format"),A.setAttribute("value",M),g.appendChild(A),g.submit(),document.body.removeChild(g),o.complete()}},{key:"nothingToExport",value:function(t,o){return 0===t.length||"GPX"===o&&void 0===t.find(function(s){return["Point","LineString","MultiLineString"].indexOf(s.getGeometry().getType())>=0})}}]),a}();return i.ogreFormats={GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"ESRI Shapefile",CSVcomma:"CSVcomma",CSVsemicolon:"CSVsemicolon"},i.noOgreFallbacks=["GML","GPX","KML"],i.\u0275fac=function(n){return new(n||i)(e.LFG(j))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function zr(i,a,n,t,o,r,s){if(0!==a.length){var l=qs(i);r?function AS(i,a,n,t,o,r,s,l){var p,d,y,c=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],u=i.map(function(A){return At(A,a.projection)});if(t.getStyleList(n.toString()+".styleByAttribute")){var g=t.getStyleList(n.toString()+".styleByAttribute");p=function(L,Z){return o.createStyleByAttribute(L,g,Z)}}else if(t.getStyleList(n.toString()+".clusterStyle")){var f=t.getStyleList(n.toString()+".clusterParam");d=t.getStyleList(n.toString()+".distance"),p=function(L,Z){var R=o.createStyle(t.getStyleList(n.toString()+".clusterStyle"),L,Z);return o.createClusterStyle(L,Z,f,R)}}else if(t.getStyleList(n.toString()+".style"))p=function(L,Z){return o.createStyle(t.getStyleList(n.toString()+".style"),L,Z)};else if(t.getStyleList("default.clusterStyle")&&"Point"===i[0].geometry.type){var m=t.getStyleList("default.clusterParam");d=t.getStyleList("default.distance"),p=function(L,Z){var R=o.createStyle(t.getStyleList("default.clusterStyle"),L,Z);return o.createClusterStyle(L,Z,m,R)}}else p=function(L,Z){return o.createStyle(t.getStyleList("default.style"),L,Z)};t.getStyleList(n.toString()+".clusterStyle")?(y=new gn(Object.assign({distance:d,type:"cluster",queryable:!0},s))).ol.source.addFeatures(u):t.getStyleList(n.toString())?(y=new Re(Object.assign({type:"vector",queryable:!0},s))).ol.addFeatures(u):t.getStyleList("default.clusterStyle")&&"Point"===i[0].geometry.type?(y=new gn(Object.assign({distance:d,type:"cluster",queryable:!0},s))).ol.source.addFeatures(u):(y=new Re(Object.assign({type:"vector",queryable:!0},s))).ol.addFeatures(u);var M=new Je(Object.assign({title:n,id:r||Ye(),isIgoInternalLayer:!0,source:y,style:p},l));a.addLayer(M),c&&mn(a,u)}(a,n,l,r,s):function ZS(i,a,n){var t=i.map(function(l){return At(l,a.projection)}),r=new Re({type:"vector",queryable:!0});r.ol.addFeatures(t);var s=new Je({title:n,isIgoInternalLayer:!0,source:r,style:$S()});s.setExtent(Er(a,t)),a.addLayer(s),mn(a,t)}(a,n,l);var c=o.translate,u=c.instant("igo.geo.dropGeoFile.success.title"),p=c.instant("igo.geo.dropGeoFile.success.text",{value:l});t.success(p,u)}else!function DS(i,a,n){var t=n.translate,o=t.instant("igo.geo.dropGeoFile.empty.title"),r=t.instant("igo.geo.dropGeoFile.empty.text",{value:i.name,mimeType:i.type});a.error(r,o)}(i,t,o)}function IS(i,a,n,t){var o=t.translate,r=o.instant("igo.geo.dropGeoFile.invalid.title"),s=o.instant("igo.geo.dropGeoFile.invalid.text",{value:i.name,mimeType:i.type});n.error(s,r)}function LS(i,a,n,t){var o=t.translate,r=o.instant("igo.geo.dropGeoFile.unreadable.title"),s=o.instant("igo.geo.dropGeoFile.unreadable.text",{value:i.name});n.error(s,r)}function OS(i,a,n,t,o){var r=t.translate,s=r.instant("igo.geo.dropGeoFile.tooLarge.title"),l=r.instant("igo.geo.dropGeoFile.tooLarge.text",{value:i.name,size:o});n.error(l,s)}function PS(i,a,n){var t=n.translate,o=t.instant("igo.geo.dropGeoFile.invalidSRS.title"),r=t.instant("igo.geo.dropGeoFile.invalidSRS.text",{value:i.name,mimeType:i.type});a.error(r,o)}function ES(i,a,n,t){var o=t.translate.instant("igo.geo.dropGeoFile.ogreServer.title"),r=t.translate.instant("igo.geo.dropGeoFile.ogreServer.text");n.error(r,o)}function Mu(i){return i.name.split(".").pop().toLowerCase()}function qs(i){return i.name.substr(0,i.name.lastIndexOf("."))}function $S(){var i=Math.floor(255*Math.random()),a=Math.floor(255*Math.random()),n=Math.floor(255*Math.random()),t=new K.Z({color:[i,a,n,1],width:2}),o=new te.Z({color:[i,a,n,.4]});return function(r){var s=r.get("_style");return s?(new xn).createStyle(s):new ee.ZP({stroke:t,fill:o,image:new Ue.Z({radius:5,stroke:t,fill:o}),text:r.get("_mapTitle")?new Lt.Z({text:r.get("_mapTitle").toString(),offsetX:5,offsetY:-5,font:"12px Calibri,sans-serif",fill:new te.Z({color:"#000"}),stroke:new K.Z({color:"#fff",width:3}),overflow:!0}):void 0})}}var ii=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n)}((0,wi.Z)(Error)),Fu=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){var t;return(0,h.Z)(this,n),t=a.call(this,"Invalid file"),Object.setPrototypeOf((0,kt.Z)(t),n.prototype),t}return(0,v.Z)(n)}(ii),Xi=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){var t;return(0,h.Z)(this,n),t=a.call(this,"Failed to read file"),Object.setPrototypeOf((0,kt.Z)(t),n.prototype),t}return(0,v.Z)(n)}(ii),Zu=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){var t;return(0,h.Z)(this,n),t=a.call(this,"Nothing to import"),Object.setPrototypeOf((0,kt.Z)(t),n.prototype),t}return(0,v.Z)(n)}(ii),RS=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){var t;return(0,h.Z)(this,n),t=a.call(this,"File is too large"),Object.setPrototypeOf((0,kt.Z)(t),Zu.prototype),t}return(0,v.Z)(n)}(ii),JS=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){var t;return(0,h.Z)(this,n),t=a.call(this,"Invalid SRS definition"),Object.setPrototypeOf((0,kt.Z)(t),Zu.prototype),t}return(0,v.Z)(n)}(ii),BS=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){var t;return(0,h.Z)(this,n),t=a.call(this,"Error 500 with OGRE"),Object.setPrototypeOf((0,kt.Z)(t),n.prototype),t}return(0,v.Z)(n)}(ii),Au=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.http=n,this.config=t,this.ogreUrl=this.config.getConfig("importExport.url");var o=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(o||30)*Math.pow(1024,2)}return(0,v.Z)(a,[{key:"import",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"EPSG:4326",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"EPSG:4326";return this.importAsync(t,o,r)}},{key:"getFileImporter",value:function(t){var o=Mu(t),r=t.type,s=[].concat((0,Fe.Z)(a.allowedMimeTypes),(0,Fe.Z)(a.allowedZipMimeTypes)),l=a.allowedExtensions;if(!(s.indexOf(r)<0&&l.indexOf(o)<0)){if("application/json"===r||["json","geojson","kml","gpx"].indexOf(o)>=0)return this.importFile;if(void 0!==this.ogreUrl)return this.importFileWithOgre}}},{key:"importAsync",value:function(t,o,r){var s=this;return new rt.y(function(u){if(t.size>=s.clientSideFileSizeMax)u.error(new RS);else{var p=s.getFileImporter(t);void 0!==p?p.call(s,t,u,o,r):u.error(new Fu)}})}},{key:"importFile",value:function(t,o,r,s){var l=this,c=new FileReader;c.onload=function(u){try{var p=l.parseFeaturesFromFile(t,u.target.result,r,s);o.next(p)}catch(d){o.error(new Xi)}o.complete()},c.onerror=function(u){o.error(new Xi)},c.readAsText(t,"UTF-8")}},{key:"importFileWithOgre",value:function(t,o,r,s){var l=this,c="".concat(this.ogreUrl,"/convert"),u=new FormData;u.append("upload",t),u.append("sourceSrs",r),u.append("targetSrs",s),u.append("formatOutput","GEOJSON"),u.append("skipFailures",""),this.http.post(c,u,{headers:new W.WM}).subscribe(function(p){if(null!==p)if((p.errors||[]).length>0)o.error(new Xi);else{var g=l.parseFeaturesFromGeoJSON(t,p,s);o.next(g),o.complete()}else o.error(new Xi)},function(p){p.error.caught=!0;var d=p.error.msg||"";"No valid files found"===d?o.error(new Fu):d&&d.startWith("ERROR 1: Failed to process SRS definition")?o.error(new JS):o.error(500===p.status?new BS:new Xi)})}},{key:"parseFeaturesFromFile",value:function(t,o,r,s){var p,l=Mu(t),c=t.type,u=new Ee.Z;if("application/vnd.google-earth.kml+xml"===c)p=new ns.ZP;else if("application/gml+xml"===c)p=new tc.Z;else if("application/gpx+xml"===c)p=new ts.Z;else switch(l){case"kml":p=new ns.ZP;break;case"gpx":p=new ts.Z;break;case"gml":p=new tc.Z;break;default:p=u}return p.readFeatures(o,{dataProjection:r,featureProjection:s}).map(function(f){return Object.assign(u.writeFeatureObject(f),{projection:s,meta:{id:Ye(),title:qs(t)}})})}},{key:"parseFeaturesFromGeoJSON",value:function(t,o,r){var s=new Ee.Z;return s.readFeatures(o).map(function(u){return Object.assign(s.writeFeatureObject(u),{projection:r,meta:{id:Ye(),title:qs(t)}})})}}]),a}();return i.allowedMimeTypes=["application/gml+xml","application/vnd.google-earth.kml+xml","application/gpx+xml","application/json"],i.allowedZipMimeTypes=["application/zip","application/x-zip-compressed","application/x-zip"],i.allowedExtensions=["geojson","kml","gpx","json","gml"],i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG(j))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),Wr=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.injector=n,this.styleList={}}return(0,v.Z)(a,[{key:"getStyleList",value:function(t){return se.resolve(this.styleList,t)}},{key:"load",value:function(t){var o=this,r=t.default||{};if(!t.path)return this.styleList=r,!0;var s=this.injector.get(W.eN);return new Promise(function(l,c){s.get(t.path).pipe((0,Ze.K)(function(u){return console.log("StyleList file ".concat(t.path," could not be read")),l(!0),(0,fi._)(u.error||"Server error")})).subscribe(function(u){o.styleList=se.mergeDeep(r,u),l(!0)})})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(e.zs3))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function US(i,a){if(1&i&&(e.TgZ(0,"p",16),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){var n=e.oxw().$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,"igo.geo.importExportForm.projections."+n.translateKey,n))}}function NS(i,a){if(1&i&&(e.TgZ(0,"p",16),e._uU(1),e.qZA()),2&i){var n=e.oxw().$implicit;e.xp6(1),e.Oqu(n.alias)}}function qS(i,a){if(1&i&&(e.TgZ(0,"mat-option",14),e.NdJ("click",function(o){return o.stopPropagation()}),e.YNc(1,US,3,4,"p",15),e.YNc(2,NS,2,1,"p",15),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.Q6J("ngIf",n.translateKey),e.xp6(1),e.Q6J("ngIf",!n.translateKey)}}function GS(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"form",5)(1,"div",6)(2,"mat-form-field")(3,"mat-label"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"mat-select",7),e.NdJ("valueChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.inputProj=r)}),e.YNc(7,qS,3,3,"mat-option",8),e.ALo(8,"async"),e.qZA()()(),e.TgZ(9,"div",9),e.ALo(10,"translate"),e.ALo(11,"translate"),e.TgZ(12,"button",10),e.NdJ("click",function(){e.CHM(n);var r=e.MAs(19);return e.KtG(r.click())}),e.ALo(13,"async"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e._UZ(16,"igo-spinner",11),e.ALo(17,"async"),e.TgZ(18,"input",12,13),e.NdJ("click",function(){e.CHM(n);var r=e.MAs(19);return e.KtG(r.value=null)})("change",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.importFiles(r.target.files))}),e.qZA()()()}if(2&i){var t=e.oxw();e.Q6J("formGroup",t.importForm),e.xp6(4),e.Oqu(e.lcZ(5,10,"igo.geo.importExportForm.importProjPlaceholder")),e.xp6(2),e.Q6J("value",t.inputProj),e.xp6(1),e.Q6J("ngForOf",e.lcZ(8,12,t.projections$)),e.xp6(2),e.Q6J("matTooltip",t.importForm.invalid?e.lcZ(10,14,"igo.geo.importExportForm.projections.choose"):e.lcZ(11,16,"igo.geo.importExportForm.importButton")),e.xp6(3),e.Q6J("disabled",t.importForm.invalid||e.lcZ(13,18,t.loading$)),e.xp6(2),e.hij(" ",e.lcZ(15,20,"igo.geo.importExportForm.importButton")," "),e.xp6(2),e.Q6J("shown",e.lcZ(17,22,t.loading$)),e.xp6(2),e.Udp("display","none")}}var QS=function(a){return{size:a}};function YS(i,a){if(1&i&&(e.TgZ(0,"div")(1,"h4"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ul")(5,"li"),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"li"),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"li"),e._uU(12),e.ALo(13,"translate"),e.qZA()()()),2&i){var n=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,4,"igo.geo.importExportForm.importClarifications")),e.xp6(4),e.Oqu(e.xi3(7,6,"igo.geo.importExportForm.importSizeMax",e.VKq(13,QS,n.fileSizeMb))),e.xp6(3),e.Oqu(e.lcZ(10,9,"igo.geo.importExportForm.importFormatAuthorized")),e.xp6(3),e.Oqu(e.lcZ(13,11,"igo.geo.importExportForm.importShpZip"))}}function jS(i,a){if(1&i&&e._UZ(0,"igo-custom-html",20),2&i){var n=e.oxw(2);e.Q6J("html",n.importHtmlClarifications)}}function HS(i,a){if(1&i&&(e.TgZ(0,"section",17),e.YNc(1,YS,14,15,"div",18),e.YNc(2,jS,1,1,"igo-custom-html",19),e.qZA()),2&i){var n=e.oxw();e.xp6(1),e.Q6J("ngIf",""===n.importHtmlClarifications),e.xp6(1),e.Q6J("ngIf",""!==n.importHtmlClarifications)}}function VS(i,a){1&i&&(e.TgZ(0,"section",17)(1,"h4"),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&i&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"igo.geo.importExportForm.exportNoLayersExportable")))}function zS(i,a){if(1&i&&(e.TgZ(0,"span",31),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){var n=e.oxw(2);e.xp6(1),e.AsE(" (+",n.layers.length-1," ",e.lcZ(2,2,2===(null==n.layers?null:n.layers.length)?"igo.geo.importExportForm.other":"igo.geo.importExportForm.others"),") ")}}function WS(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-slide-toggle",34),e.NdJ("click",function(o){e.CHM(n);var r=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.onlySelectedClick(o,r.id))})("checked",function(){e.CHM(n);var o=e.oxw().$implicit,r=e.oxw(2);return e.KtG(r.inLayersIdToExportSelectionOnly(o))})("change",function(o){e.CHM(n);var r=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.onlySelected(o,r.id))}),e.TgZ(1,"small"),e._uU(2),e.ALo(3,"translate"),e.qZA()()}2&i&&(e.Q6J("labelPosition","after"),e.xp6(2),e.Oqu(e.lcZ(3,2,"igo.geo.importExportForm.exportSelectedFeature")))}var KS=function(a){return{"igo-export-layer-mat-option":a}};function XS(i,a){if(1&i&&(e.TgZ(0,"mat-option",32),e.NdJ("click",function(r){return r.stopPropagation()}),e.TgZ(1,"p",16),e._uU(2),e.qZA(),e.TgZ(3,"p",16),e.YNc(4,WS,4,4,"mat-slide-toggle",33),e.qZA()()),2&i){var n=a.$implicit,t=e.oxw(2);e.Q6J("ngClass",e.VKq(4,KS,t.layerHasSelectedFeatures(n)))("value",n.id),e.xp6(2),e.Oqu(n.title),e.xp6(2),e.Q6J("ngIf",t.layerHasSelectedFeatures(n))}}function ew(i,a){if(1&i&&(e.TgZ(0,"mat-option",2),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n.key),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.export.format."+n.value)," ")}}function tw(i,a){if(1&i&&(e.ynx(0),e.YNc(1,ew,3,4,"mat-option",35),e.ALo(2,"keyvalue"),e.ALo(3,"async"),e.BQk()),2&i){var n=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,e.lcZ(3,3,n.formats$)))}}function nw(i,a){1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"igo.geo.export.noFormat.title")," "))}function ow(i,a){1&i&&(e.TgZ(0,"div",6)(1,"mat-form-field"),e._UZ(2,"input",37),e.ALo(3,"translate"),e.qZA()()),2&i&&(e.xp6(2),e.s9C("placeholder",e.lcZ(3,1,"igo.geo.importExportForm.exportFileNamePlaceholder")))}function iw(i,a){if(1&i&&(e.TgZ(0,"mat-option",2),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n.key),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.export.encoding."+n.value)," ")}}function rw(i,a){if(1&i&&(e.ynx(0),e.YNc(1,iw,3,4,"mat-option",35),e.ALo(2,"keyvalue"),e.ALo(3,"async"),e.BQk()),2&i){var n=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,e.lcZ(3,3,n.encodings$)))}}function aw(i,a){if(1&i&&(e.TgZ(0,"div",6)(1,"mat-form-field")(2,"mat-label"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"mat-select",38),e.YNc(6,rw,4,5,"ng-container",18),e.ALo(7,"async"),e.qZA()()()),2&i){var n=e.oxw(2);e.xp6(3),e.Oqu(e.lcZ(4,2,"igo.geo.importExportForm.encodingPlaceholder")),e.xp6(3),e.Q6J("ngIf",0!==e.lcZ(7,4,n.encodings$).length)}}function sw(i,a){1&i&&(e.TgZ(0,"div",39)(1,"mat-slide-toggle",40),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&i&&(e.xp6(1),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(3,2,"igo.geo.importExportForm.exportCombineResults")," "))}function lw(i,a){1&i&&(e.TgZ(0,"div",41)(1,"mat-slide-toggle",42),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&i&&(e.xp6(1),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(3,2,"igo.geo.importExportForm.exportSeparator")," "))}function cw(i,a){1&i&&(e.TgZ(0,"div",43)(1,"mat-slide-toggle",44),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&i&&(e.xp6(1),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(3,2,"igo.geo.importExportForm.exportFeatureInExtent")," "))}function uw(i,a){if(1&i&&e._UZ(0,"igo-custom-html",20),2&i){var n=e.oxw(2);e.Q6J("html",n.exportHtmlClarifications)}}function pw(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"form",5)(1,"div",6)(2,"mat-form-field")(3,"mat-label"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"mat-select",21),e.NdJ("valueChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.layers=r)}),e.TgZ(7,"mat-select-trigger"),e._uU(8),e.YNc(9,zS,3,4,"span",22),e.qZA(),e.YNc(10,XS,5,6,"mat-option",23),e.ALo(11,"async"),e.qZA()()(),e.TgZ(12,"div",6)(13,"mat-form-field")(14,"mat-label"),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"mat-select",24),e.YNc(18,tw,4,5,"ng-container",18),e.ALo(19,"async"),e.YNc(20,nw,3,3,"mat-option",25),e.ALo(21,"async"),e.qZA()()(),e.YNc(22,ow,4,3,"div",26),e.YNc(23,aw,8,6,"div",26),e.YNc(24,sw,4,4,"div",27),e.YNc(25,lw,4,4,"div",28),e.YNc(26,cw,4,4,"div",29),e.TgZ(27,"div",30)(28,"button",10),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.handleExportFormSubmit(r.form.value))}),e.ALo(29,"async"),e._uU(30),e.ALo(31,"translate"),e.ALo(32,"translate"),e.ALo(33,"translate"),e.qZA(),e._UZ(34,"igo-spinner",11),e.ALo(35,"async"),e.qZA(),e.YNc(36,uw,1,1,"igo-custom-html",19),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("formGroup",t.form),e.xp6(4),e.Oqu(e.lcZ(5,18,"igo.geo.importExportForm.exportLayerPlaceholder")),e.xp6(2),e.Q6J("value",t.layers),e.xp6(2),e.hij(" ",t.layers.length?t.getLayerTitleById(t.layers[0]):""," "),e.xp6(1),e.Q6J("ngIf",t.layers.length>1),e.xp6(1),e.Q6J("ngForOf",e.lcZ(11,20,t.exportableLayers$)),e.xp6(5),e.Oqu(e.lcZ(16,22,"igo.geo.importExportForm.exportFormatPlaceholder")),e.xp6(3),e.Q6J("ngIf",0!==e.lcZ(19,24,t.formats$).length),e.xp6(2),e.Q6J("ngIf",0===e.lcZ(21,26,t.formats$).length),e.xp6(2),e.Q6J("ngIf",t.forceNaming&&"URL"!==t.form.value.format),e.xp6(1),e.Q6J("ngIf","CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format),e.xp6(1),e.Q6J("ngIf",t.layers.length>1&&("CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format)),e.xp6(1),e.Q6J("ngIf",t.layers.length>1&&("CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format)&&t.form.value.combineLayers),e.xp6(1),e.Q6J("ngIf","URL"!==t.form.value.format),e.xp6(2),e.Q6J("disabled",!t.form.valid||e.lcZ(29,28,t.loading$)),e.xp6(2),e.hij(" ","URL"!==t.form.value.format?e.lcZ(31,30,"igo.geo.importExportForm.exportButton"):t.form.value.layers.length>1?e.lcZ(32,32,"igo.geo.importExportForm.exportButtonLinks"):e.lcZ(33,34,"igo.geo.importExportForm.exportButtonLink")," "),e.xp6(4),e.Q6J("shown",e.lcZ(35,36,t.loading$)),e.xp6(2),e.Q6J("ngIf",""!==t.exportHtmlClarifications)}}var Iu=function(){var i=function(){function a(n,t,o,r,s,l,c,u,p,d,g){(0,h.Z)(this,a),this.importService=n,this.exportService=t,this.languageService=o,this.messageService=r,this.styleListService=s,this.styleService=l,this.formBuilder=c,this.config=u,this.cdRef=p,this.storageService=d,this.downloadService=g,this.formats$=new x.X(void 0),this.encodings$=new x.X(void 0),this.exportableLayers$=new x.X([]),this.loading$=new x.X(!1),this.forceNaming=!1,this.controlFormat="format",this.espgCodeRegex=new RegExp("^\\d{4,6}"),this.projections$=new x.X([]),this.popupChecked=!1,this.previousLayerSpecs$=new x.X(void 0),this.selectFirstProj=!1,this._projectionsLimitations={},this.selectedMode="import",this.selectMode=new e.vpe,this.exportOptions$=new x.X(void 0),this.exportOptionsChange=new e.vpe,this.loadConfig(),this.buildForm(),this.computeProjections(),this.importHtmlClarifications=this.languageService.translate.instant("igo.geo.importExportForm.importHtmlClarifications"),this.exportHtmlClarifications=this.languageService.translate.instant("igo.geo.importExportForm.exportHtmlClarifications")}return(0,v.Z)(a,[{key:"projectionsLimitations",get:function(){return this._projectionsLimitations||{}},set:function(t){this._projectionsLimitations=t,this.computeProjections()}},{key:"layers",get:function(){return this.form.get("layers").value},set:function(t){this.form.patchValue({layers:t})}},{key:"inputProj",get:function(){return this.importForm.get("inputProj").value},set:function(t){this.importForm.patchValue({inputProj:t})}},{key:"popupAllowed",get:function(){return this.storageService.get("importExportPopupAllowed")||!1},set:function(t){this.storageService.set("importExportPopupAllowed",t)}},{key:"ngOnInit",value:function(){var t=this;this.layers$$=this.map.layers$.subscribe(function(r){t.exportableLayers$.next(r.filter(function(s){return s instanceof Je&&!0===s.exportable||s.dataSource.options.download&&s.dataSource.options.download.url}))});var o=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(o||30)*Math.pow(1024,2),this.fileSizeMb=this.clientSideFileSizeMax/Math.pow(1024,2),this.exportOptions$$=this.exportOptions$.pipe((0,Nt.n)(function(r){return!r})).subscribe(function(r){t.form.patchValue(r,{emitEvent:!0}),r.layers&&t.computeFormats(r.layers.map(function(s){return t.map.getLayerById(s)}))}),this.formLayer$$=this.form.get("format").valueChanges.subscribe(function(r){var s,l=Object.keys(Ns.ogreFormats);!t.popupChecked&&(null===(s=t.form.get("layers").value)||void 0===s?void 0:s.length)>1&&(l.indexOf(r)>=0||r===ve.URL)&&(t.handlePopup(!0)||t.form.patchValue({format:void 0},{emitEvent:!1}))}),this.formLayer$$=this.form.get("layers").valueChanges.subscribe(function(r){t.handlePreviousLayerSpecs();var s=r instanceof Array?r:[r];t.form.patchValue({layers:s},{emitEvent:!1});var l=s.map(function(u){return t.map.getLayerById(u)});t.computeFormats(l),-1===Object.keys(t.formats$.value).indexOf(t.form.value.format)&&t.form.patchValue({format:void 0}),t.loading$.next(!0);var c=[];l.forEach(function(u){u instanceof Je&&0===u.dataSource.ol.getFeatures().length&&(c.push({id:u.id,visible:u.visible,opacity:u.opacity,queryable:u.queryable}),u.opacity=0,u.visible=!0)}),t.previousLayerSpecs$.next(c),setTimeout(function(){t.loading$.next(!1)},500)}),this.formats$$=this.formats$.pipe((0,Nt.n)(function(r){return!r})).subscribe(function(r){1===Object.keys(r).length&&t.form.patchValue({format:r[Object.keys(r)[0]]})}),this.encodings$$=this.encodings$.pipe((0,Nt.n)(function(r){return!r})).subscribe(function(r){1===Object.keys(r).length&&t.form.patchValue({encoding:r[Object.keys(r)[0]]})}),this.exportableLayers$$=this.exportableLayers$.pipe((0,Nt.n)(function(r){return!r})).subscribe(function(r){1===r.length&&t.form.patchValue({layers:r[0].id})}),this.form.controls[this.controlFormat].valueChanges.subscribe(function(r){t.form.patchValue(r===ve.CSVcomma||r===ve.CSVsemicolon?{encoding:hn.LATIN1}:{encoding:hn.UTF8}),t.cdRef.detectChanges()}),this.importForm.patchValue(this.selectFirstProj?0===this.projections$.value.length?{inputProj:{translateKey:"nad83",alias:"NAD83",code:"EPSG:4326",zone:""}}:{inputProj:this.projections$.value[0]}:{inputProj:void 0})}},{key:"computeProjections",value:function(){this.projectionsConstraints=function $c(i){var a=i.mtmZone,n=i.utmZone;return{projFromConfig:!1!==i.projFromConfig,nad83:!1!==i.nad83,wgs84:!1!==i.wgs84,webMercator:!1!==i.webMercator,utm:!1!==i.utm,mtm:!1!==i.mtm,utmZone:{minZone:n&&n.minZone?n.minZone:17,maxZone:n&&n.maxZone?n.maxZone:21},mtmZone:{minZone:a&&a.minZone?a.minZone:2,maxZone:a&&a.maxZone?a.maxZone:10}}}(this.projectionsLimitations);var t=[];if(this.projectionsConstraints.nad83&&t.push({translateKey:"nad83",alias:"NAD83",code:"EPSG:4269",zone:""}),this.projectionsConstraints.wgs84&&t.push({translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:""}),this.projectionsConstraints.webMercator&&t.push({translateKey:"webMercator",alias:"Web Mercator",code:"EPSG:3857",zone:""}),this.projectionsConstraints.mtm)for(var r=this.projectionsConstraints.mtmZone.maxZone,s=this.projectionsConstraints.mtmZone.minZone;s<=r;s++){var l=s<10?"EPSG:3218".concat(s):"EPSG:321".concat(80+s);t.push({translateKey:"mtm",alias:"MTM ".concat(s),code:l,zone:"".concat(s)})}if(this.projectionsConstraints.utm)for(var u=this.projectionsConstraints.utmZone.maxZone,p=this.projectionsConstraints.utmZone.minZone;p<=u;p++){var d=p<10?"EPSG:3260".concat(p):"EPSG:326".concat(p);t.push({translateKey:"utm",alias:"UTM ".concat(p),code:d,zone:"".concat(p)})}var g=[];this.projectionsConstraints.projFromConfig&&(g=this.config.getConfig("projections")||[]),this.projections$.next(g.concat(t))}},{key:"getWorkspaceByLayerId",value:function(t){var o=this.store.all().find(function(r){return r.layer.id===t});if(o)return o}},{key:"getLayerTitleById",value:function(t){var o;return null===(o=this.map.getLayerById(t))||void 0===o?void 0:o.title}},{key:"layerHasSelectedFeatures",value:function(t){var o=this.getWorkspaceByLayerId(t.id);if(o)return!!o.entityStore.stateView.firstBy(function(s){return!0===s.state.selected})}},{key:"onlySelected",value:function(t,o){var r=this.form.value.layersWithSelection;t.checked?r.push(o):r=r.filter(function(s){return s!==o}),this.form.patchValue({layersWithSelection:r})}},{key:"onlySelectedClick",value:function(t,o){this.form.value.layers.find(function(r){return r===o})&&t.stopPropagation()}},{key:"inLayersIdToExportSelectionOnly",value:function(t){return!!this.form.value.layersWithSelection.find(function(o){return o===t.id})}},{key:"ngOnDestroy",value:function(){this.layers$$.unsubscribe(),this.exportableLayers$$.unsubscribe(),this.formats$$.unsubscribe(),this.encodings$$.unsubscribe(),this.formLayer$$.unsubscribe(),this.exportOptions$$&&this.exportOptions$$.unsubscribe(),this.exportOptionsChange.emit(this.form.value),this.handlePreviousLayerSpecs()}},{key:"handlePreviousLayerSpecs",value:function(){var t=this,o=this.previousLayerSpecs$.value;o&&o.length&&o.forEach(function(r){var s=t.map.getLayerById(r.id);s.visible=r.visible,s.opacity=r.opacity,s.queryable=r.queryable}),this.previousLayerSpecs$.next(void 0)}},{key:"importFiles",value:function(t){var o=this,r=this.inputProj.code;this.espgCodeRegex.test(r)&&(r="EPSG:".concat(r)),this.loading$.next(!0);var l,s=(0,D.Z)(t);try{var c=function(){var p=l.value;o.importService.import(p,r).subscribe(function(d){return o.onFileImportSuccess(p,d)},function(d){return o.onFileImportError(p,d)},function(){o.loading$.next(!1)})};for(s.s();!(l=s.n()).done;)c()}catch(u){s.e(u)}finally{s.f()}}},{key:"handlePopup",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],o=window.open("","popup","width=1, height=1");o.close();var r=window.open("","popup","width=1, height=1");return!r||r.closed||void 0===r.closed||null===r?(this.onPopupBlockedError(t),this.popupAllowed=!1):(r.close(),this.popupAllowed=!0,this.popupChecked=!0),this.popupAllowed}},{key:"handleExportFormSubmit",value:function(t){var o=this;this.loading$.next(!0);var r=Object.keys(Ns.ogreFormats);!this.popupChecked&&t.layers.length>1&&(r.indexOf(t.format)>=0||t.format===ve.URL)&&!this.popupAllowed&&this.handlePopup();var p,s=[],l=[],c="",u=(0,D.Z)(t.layers.entries());try{var d=function(){var m=(0,Qe.Z)(p.value,2),y=m[0],_=m[1],b=o.map.getLayerById(_);t.format!==ve.CSVsemicolon&&t.format!==ve.CSVcomma||!t.combineLayers||1===t.layers.length?(c=b.title,t.name&&(c=t.name)):c=o.languageService.translate.instant("igo.geo.export.combinedLayers");var w=b.dataSource.options;if(t.format===ve.URL&&w.download&&(w.download.url||w.download.dynamicUrl))return setTimeout(function(){var Q=w.download.url||w.download.dynamicUrl;Q.match(/service=wfs/gi)?o.downloadService.open(b):window.open(Q,"_blank"),o.loading$.next(!1)},500),{v:void 0};var T=o.getWorkspaceByLayerId(_),M=void 0;if(T&&T.entityStore&&T.entityStore.stateView.all().length)M=-1!==t.layersWithSelection.indexOf(_)&&t.featureInMapExtent?T.entityStore.stateView.all().filter(function(Q){return Q.state.inMapExtent&&Q.state.selected}).map(function(Q){return Q.entity.ol}):-1===t.layersWithSelection.indexOf(_)||t.featureInMapExtent?t.featureInMapExtent?T.entityStore.stateView.all().filter(function(Q){return Q.state.inMapExtent}).map(function(Q){return Q.entity.ol}):T.entityStore.stateView.all().map(function(Q){return Q.entity.ol}):T.entityStore.stateView.all().filter(function(Q){return Q.state.selected}).map(function(Q){return Q.entity.ol});else{var A=b.dataSource.ol;M=t.featureInMapExtent?A.getFeaturesInExtent(b.map.viewController.getExtent()):A.getFeatures(),b.dataSource instanceof gn&&(M=M.flatMap(function(Q){return Q.get("features")}))}var L=o.languageService.translate,Z=[];if(t.format===ve.Shapefile||t.format===ve.GPX?M.forEach(function(Q){var ae=Q.getGeometry().getType(),xe=Z.find(function(Me){return Me.geometryType===ae});xe?xe.features.push(Q):Z.push({geometryType:ae,features:[Q]})}):Z=[{geometryType:"",features:M}],Z.forEach(function(Q){Q.features.forEach(function(ae){var xe=ae.get("rad");if(xe){var Me=[ae.get("longitude"),ae.get("latitude")],Ce=(0,Tn.iu)(Me,xe,500);Ce.transform("EPSG:4326",ae.get("_projection")),ae.setGeometry(Ce)}})}),t.format===ve.GPX){if(Z.length>(Z=Z.filter(function(Q){return["LineString","Point"].includes(Q.geometryType)})).length){var P=L.instant("igo.geo.export.gpx.error.poly.title"),Y=L.instant("igo.geo.export.gpx.error.poly.text");o.messageService.error(Y,P,{timeOut:2e4})}}else if((t.format===ve.CSVsemicolon||t.format===ve.CSVcomma)&&t.combineLayers){if(Z.forEach(function(Q){return s.push(Q)}),y!==t.layers.length-1)return"continue";var pe=void 0;s.forEach(function(Q){Q.features.forEach(function(ae){if(t.separator)if(pe){if(ae.get("_featureStore").layer.options.title!==pe.get("_featureStore").layer.options.title){var xe=o.createTitleEmptyRows(pe,ae);l.push(xe[2]),l.push(xe[0]),l.push(xe[1])}}else{var Me=o.createTitleEmptyRows(ae,ae);l.push(Me[0])}l.push(ae),pe=ae})})}if(0===Z.length){o.loading$.next(!1);var ue=L.instant("igo.geo.export.nothing.title"),oe=L.instant("igo.geo.export.nothing.text");o.messageService.error(oe,ue,{timeOut:2e4})}else(t.format!==ve.CSVsemicolon&&t.format!==ve.CSVcomma||!t.combineLayers)&&Z.map(function(Q){return o.exportService.export(Q.features,t.format,c+Q.geometryType,t.encoding,o.map.projection).subscribe(function(){},function(ae){return o.onFileExportError(ae)},function(){o.onFileExportSuccess(),Q.features.forEach(function(ae){o.circleToPoint(ae)}),o.loading$.next(!1)})})};for(u.s();!(p=u.n()).done;){var g=d();if("continue"!==g&&"object"==typeof g)return g.v}}catch(f){u.e(f)}finally{u.f()}(t.format===ve.CSVsemicolon||t.format===ve.CSVcomma)&&t.combineLayers&&this.exportService.export(l,t.format,c,t.encoding,this.map.projection).subscribe(function(){},function(f){return o.onFileExportError(f)},function(){o.onFileExportSuccess(),l.forEach(function(f){o.circleToPoint(f)}),o.loading$.next(!1)})}},{key:"createTitleEmptyRows",value:function(t,o){var r=o.clone(),s=o.clone(),l=o.clone(),c=t.getKeys(),u="";for(var p in c)if("geometry"!==c[p]){u=c[p];break}var d=o.getKeys(),g="";for(var f in d)if("geometry"!==d[f]){g=d[f];break}var m=o.getKeys();c.forEach(function(w){m.includes(w)&&w!==u&&m.push(w)}),m.unshift(u);var y="";for(var _ in m)if("geometry"!==m[_]){y=m[_];break}return m.forEach(function(w){var T=c.length===d.length&&c.every(function(M,A){return M===d[A]});w!==y||T?w===y&&T||w===g?(r.set(w,o.get("_featureStore").layer.options.title,!0),s.set(w,w,!0),l.unset(w,!0)):"geometry"!==w?(r.unset(w,!0),s.set(w,w,!0),l.unset(w,!0)):(r.unset(w,!0),l.unset(w,!0)):(r.set(w,o.get("_featureStore").layer.options.title+" ===============>",!0),s.set(w,w,!0),l.unset(w,!0)),d.includes(w)||s.unset(w,!0)}),[r,s,l]}},{key:"circleToPoint",value:function(t){if(t.get("rad")){var r=new He.Z([t.get("longitude"),t.get("latitude")]);r.transform("EPSG:4326",t.get("_projection")),t.setGeometry(r)}}},{key:"buildForm",value:function(){this.importForm=this.formBuilder.group({inputProj:["",[S.kI.required]]}),this.form=this.formBuilder.group(this.forceNaming?{format:["",[S.kI.required]],layers:[[],[S.kI.required]],layersWithSelection:[[]],encoding:[hn.UTF8,[S.kI.required]],combineLayers:[!0,[S.kI.required]],separator:[!1,[S.kI.required]],featureInMapExtent:[!1,[S.kI.required]],name:["",[S.kI.required]]}:{format:["",[S.kI.required]],layers:[[],[S.kI.required]],layersWithSelection:[[]],encoding:[hn.UTF8,[S.kI.required]],combineLayers:[!0,[S.kI.required]],separator:[!1,[S.kI.required]],featureInMapExtent:[!1,[S.kI.required]]})}},{key:"onFileImportSuccess",value:function(t,o){this.config.getConfig("importWithStyle")?zr(t,o,this.map,this.messageService,this.languageService,this.styleListService,this.styleService):zr(t,o,this.map,this.messageService,this.languageService)}},{key:"onFileImportError",value:function(t,o){this.loading$.next(!1),function ku(i,a,n,t,o){({"Invalid file":IS,"File is too large":OS,"Failed to read file":LS,"Invalid SRS definition":PS,"Error 500 with OGRE":ES})[a.message](i,a,n,t,o=o||30)}(t,o,this.messageService,this.languageService,this.fileSizeMb)}},{key:"onPopupBlockedError",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.loading$.next(!1);var o=this.languageService.translate,r=o.instant("igo.geo.export.popupBlocked.title"),s=o.instant(t?"igo.geo.export.popupBlocked.selectAgain":"igo.geo.export.popupBlocked.retry"),l=o.instant("igo.geo.export.popupBlocked.text",{extraMessage:s});this.messageService.error(l,r,{timeOut:2e4})}},{key:"onFileExportError",value:function(t){this.loading$.next(!1),function kS(i,a,n){if(i instanceof xu)!function FS(i,a){var n=a.translate,t=n.instant("igo.geo.export.nothing.title"),o=n.instant("igo.geo.export.nothing.text");i.error(o,t)}(a,n);else{var t=n.translate,o=t.instant("igo.geo.export.failed.title"),r=t.instant("igo.geo.export.failed.text");a.error(r,o)}}(t,this.messageService,this.languageService)}},{key:"loadConfig",value:function(){void 0!==this.config.getConfig("importExport.forceNaming")&&(this.forceNaming=this.config.getConfig("importExport.forceNaming")),this.computeFormats(),this.loadEncodings()}},{key:"encodingDefaultValue",value:function(t){return t===ve.CSVcomma||t===ve.CSVsemicolon?(this.form.patchValue({encoding:hn.LATIN1}),hn.LATIN1):(this.form.patchValue({encoding:hn.UTF8}),hn.UTF8)}},{key:"loadEncodings",value:function(){this.encodings$.next(hn)}},{key:"computeFormats",value:function(t){var o=this,r=Object.keys(ve),s={onlyUrl:!1,onlyVector:!1,vectorAndUrl:!1,customList:!1},l=[];if(t&&t.length)if(t.forEach(function(y){var _;!y||(null!==(_=y.dataSource.options.download)&&void 0!==_&&_.allowedFormats?(s.customList=!0,l.push({layer:y.title,formats:o.validateListFormat(y.dataSource.options.download.allowedFormats)})):y instanceof Je||!y.dataSource.options.download||!y.dataSource.options.download.url?y.dataSource.options.download&&(y.dataSource.options.download.url||y.dataSource.options.download.dynamicUrl)?s.vectorAndUrl=!0:y instanceof Je&&(s.onlyVector=!0):s.onlyUrl=!0)}),!0===s.onlyUrl&&!1===s.onlyVector)r=["URL"];else if(!0===s.onlyVector&&!1===s.onlyUrl){if(this.computeFormats(),ve.URL in this.formats$.value){var c=Object.keys(this.formats$.value).filter(function(y){return"URL"!==y});r=c}}else if(!0===s.vectorAndUrl&&!1===s.onlyUrl&&!1===s.onlyVector&&(this.computeFormats(),!(ve.URL in this.formats$.value))){var u=Object.keys(this.formats$.value);u.push("URL"),r=u}if(void 0!==this.config.getConfig("importExport.formats")){var p=this.validateListFormat(this.config.getConfig("importExport.formats"));r=p}if(s.customList){var d,g=[],f=l[0].formats;l.map(function(y){g.push(y.layer),d=y.formats.filter(function(_){return f.includes(_)}),f=y.formats});var m=d.filter(function(y){return r.includes(y)});m.length>0?(this.formats$.next(_n(m)),t&&t.length&&t.length>1&&this.messageService.alert(this.languageService.translate.instant("igo.geo.export.customList.text",{value:g.join()}),this.languageService.translate.instant("igo.geo.export.customList.title"))):(this.formats$.next([]),this.messageService.alert(this.languageService.translate.instant("igo.geo.export.noFormat.text"),this.languageService.translate.instant("igo.geo.export.noFormat.title")))}else this.formats$.next(_n(r))}},{key:"validateListFormat",value:function(t){return t.filter(function(o){if(o.toUpperCase()===ve.CSVcomma.toUpperCase()||o.toUpperCase()===ve.CSVsemicolon.toUpperCase()||o.toUpperCase()===ve.GML.toUpperCase()||o.toUpperCase()===ve.GPX.toUpperCase()||o.toUpperCase()===ve.GeoJSON.toUpperCase()||o.toUpperCase()===ve.KML.toUpperCase()||o.toUpperCase()===ve.Shapefile.toUpperCase()||o.toUpperCase()===ve.URL.toUpperCase())return o}).map(function(o){return o.toUpperCase()===ve.CSVcomma.toUpperCase()?o=ve.CSVcomma:o.toUpperCase()===ve.CSVsemicolon.toUpperCase()?o=ve.CSVsemicolon:o.toUpperCase()===ve.GML.toUpperCase()?o=ve.GML:o.toUpperCase()===ve.GPX.toUpperCase()?o=ve.GPX:o.toUpperCase()===ve.GeoJSON.toUpperCase()?o=ve.GeoJSON:o.toUpperCase()===ve.KML.toUpperCase()?o=ve.KML:o.toUpperCase()===ve.Shapefile.toUpperCase()?o=ve.Shapefile:o.toUpperCase()===ve.URL.toUpperCase()?o=ve.URL:void 0})}},{key:"modeChanged",value:function(t){this.selectMode.emit(t)}},{key:"onFileExportSuccess",value:function(){!function MS(i,a){var n=a.translate,t=n.instant("igo.geo.export.success.title"),o=n.instant("igo.geo.export.success.text");i.success(o,t)}(this.messageService,this.languageService)}},{key:"onImportExportChange",value:function(t){this.selectedMode=t.value}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Au),e.Y36(Ns),e.Y36($),e.Y36(Ae),e.Y36(Wr),e.Y36(xn),e.Y36(S.QS),e.Y36(j),e.Y36(e.sBO),e.Y36(Te),e.Y36(gu))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-import-export"]],inputs:{selectFirstProj:"selectFirstProj",map:"map",projectionsLimitations:"projectionsLimitations",store:"store",selectedMode:"selectedMode",exportOptions$:"exportOptions$"},outputs:{selectMode:"selectMode",exportOptionsChange:"exportOptionsChange"},decls:14,vars:17,consts:[[1,"import-export-toggle","mat-typography"],[3,"value","change"],[3,"value"],["class","igo-form",3,"formGroup",4,"ngIf"],["class","mat-typography",4,"ngIf"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],[3,"value","valueChange"],[3,"value","click",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500",1,"igo-form-button-group",3,"matTooltip"],["mat-raised-button","","type","button",3,"disabled","click"],[3,"shown"],["hidden","","type","file",3,"click","change"],["fileInput",""],[3,"value","click"],["mat-line","",4,"ngIf"],["mat-line",""],[1,"mat-typography"],[4,"ngIf"],["class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"],["multiple","",3,"value","valueChange"],["class","export-select-trigger",4,"ngIf"],[3,"ngClass","value","click",4,"ngFor","ngForOf"],["formControlName","format"],["disabled","true",4,"ngIf"],["class","igo-input-container",4,"ngIf"],["class","export-combine-layers mat-typography",4,"ngIf"],["class","export-separator mat-typography",4,"ngIf"],["class","export-options mat-typography",4,"ngIf"],[1,"igo-form-button-group"],[1,"export-select-trigger"],[3,"ngClass","value","click"],[3,"labelPosition","click","checked","change",4,"ngIf"],[3,"labelPosition","click","checked","change"],[3,"value",4,"ngFor","ngForOf"],["disabled","true"],["matInput","","formControlName","name",3,"placeholder"],["formControlName","encoding"],[1,"export-combine-layers","mat-typography"],["formControlName","combineLayers",3,"labelPosition"],[1,"export-separator","mat-typography"],["formControlName","separator",3,"labelPosition"],[1,"export-options","mat-typography"],["formControlName","featureInMapExtent",3,"labelPosition"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"mat-button-toggle-group",1),e.NdJ("change",function(r){return t.onImportExportChange(r)}),e.TgZ(2,"mat-button-toggle",2),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"mat-button-toggle",2),e._uU(6),e.ALo(7,"translate"),e.qZA()()(),e.YNc(8,GS,20,24,"form",3),e.YNc(9,HS,3,2,"section",4),e.YNc(10,VS,4,3,"section",4),e.ALo(11,"async"),e.YNc(12,pw,37,38,"form",3),e.ALo(13,"async")),2&n&&(e.xp6(1),e.Q6J("value",t.selectedMode),e.xp6(1),e.Q6J("value","import"),e.xp6(1),e.hij(" ",e.lcZ(4,9,"igo.geo.importExportForm.importTabTitle")," "),e.xp6(2),e.Q6J("value","export"),e.xp6(1),e.hij(" ",e.lcZ(7,11,"igo.geo.importExportForm.exportTabTitle")," "),e.xp6(2),e.Q6J("ngIf","import"===t.selectedMode),e.xp6(1),e.Q6J("ngIf","import"===t.selectedMode),e.xp6(1),e.Q6J("ngIf",0===e.lcZ(11,13,t.exportableLayers$).length&&"export"===t.selectedMode),e.xp6(2),e.Q6J("ngIf",e.lcZ(13,15,t.exportableLayers$).length>0&&"export"===t.selectedMode))},dependencies:[J.gM,S._Y,S.Fj,S.JJ,S.JL,S.sg,S.u,C.mk,C.sg,C.O5,I.lW,ot.A9,ot.Yi,B.KE,B.hX,ke.gD,ke.$L,ie.ey,le.Nt,ht.Rr,Sr,Aa,C.Ov,E.X$,vo],styles:["mat-option.igo-export-layer-mat-option[_ngcontent-%COMP%]{height:5em;line-height:1em}.import-export-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}.import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}h4[_ngcontent-%COMP%]{padding:0 5px}.igo-form[_ngcontent-%COMP%]{padding:15px 5px}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}igo-spinner[_ngcontent-%COMP%]{position:absolute;padding-left:10px}.export-options[_ngcontent-%COMP%], .export-combine-layers[_ngcontent-%COMP%], .export-separator[_ngcontent-%COMP%]{overflow-x:hidden}.export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%], .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%], .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;margin:10px}.export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mat-slide-toggle-content, .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mat-slide-toggle-content, .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mat-slide-toggle-content{width:calc(100% - 60px)}.export-select-trigger[_ngcontent-%COMP%]{opacity:.75;font-size:.75em}"]}),i}(),Lu=new e.OlP("styleListOptions");function Ou(i){return{provide:Lu,useValue:i}}function dw(i,a){return function(){return i.load(a)}}var Du=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[Ou({}),{provide:e.ip1,useFactory:dw,multi:!0,deps:[Wr,Lu]}]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i}(),Kr=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[O.Ps,J.AV,S.u5,S.UX,C.ez,I.ot,ot.vV,Ot.Nh,ke.LD,ie.Ng,B.lN,le.c,ht.rP,he,wr,Jo,Yg,Eo,Du.forRoot(),Du]}),i}(),ft=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,he,Fl,O.Ps,I.ot,J.AV]}),i}();function fw(i,a){if(1&i&&(e.TgZ(0,"mat-option",5),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.measure."+n)," ")}}e.B6R(xy,[C.mk,C.sg,C.O5,O.Hw,I.lW,J.gM,Bc],[E.X$]),e.B6R(Bc,[C.O5,Be],[]);var mw=function(){var i=function(){function a(){(0,h.Z)(this,a),this.measure$=new x.X(void 0),this._auto=!1,this.measureUnitChange=new e.vpe}return(0,v.Z)(a,[{key:"measure",get:function(){return this.measure$.value},set:function(t){this.measure$.next(t)}},{key:"auto",get:function(){return this._auto},set:function(t){this.toggleAutoUnit(t)}},{key:"measureUnits",get:function(){return Object.values(this.measureType===zt.Area?ut:ye)}},{key:"ngOnDestroy",value:function(){this.toggleAutoUnit(!1)}},{key:"onMeasureUnitChange",value:function(t){this.measureUnit=t,this.measureUnitChange.emit(t)}},{key:"toggleAutoUnit",value:function(t){var o=this;void 0!==this.measure$$&&this.measure$$.unsubscribe(),!0===t&&(this.measure$$=this.measure$.subscribe(function(r){o.computeBestMeasureUnit(r)})),this._auto=t}},{key:"computeBestMeasureUnit",value:function(t){var o=this.measureUnit;this.measureType===zt.Area?o=function s0(i){for(var a=ut.SquareMeters,n=i,t=[ut.SquareKilometers];n>1e6&&t.length>0;)n=Qr(i,a=t.pop());return a}(t):this.measureType===zt.Length&&(o=function a0(i){for(var a=ye.Meters,n=i,t=[ye.Kilometers];n>1e3&&t.length>0;)n=Qi(i,a=t.pop());return a}(t)),o!==this.measureUnit&&this.onMeasureUnitChange(o)}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-measurer-item"]],inputs:{measureType:"measureType",measureUnit:"measureUnit",measure:"measure",auto:"auto",placeholder:"placeholder"},outputs:{measureUnitChange:"measureUnitChange"},decls:9,vars:11,consts:[["appearance","outline","floatLabel","always",1,"measure-field"],["matInput","",3,"readonly","value"],[1,"unit-field"],[3,"value","disabled","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-form-field",0)(1,"mat-label"),e._uU(2),e.qZA(),e._UZ(3,"input",1),e.ALo(4,"measureFormat"),e.ALo(5,"async"),e.qZA(),e.TgZ(6,"mat-form-field",2)(7,"mat-select",3),e.NdJ("selectionChange",function(r){return t.onMeasureUnitChange(r.value)}),e.YNc(8,fw,3,4,"mat-option",4),e.qZA()()),2&n&&(e.xp6(2),e.Oqu(t.placeholder),e.xp6(1),e.Q6J("readonly",!0)("value",e.xi3(4,6,e.lcZ(5,9,t.measure$)||0,t.measureUnit)),e.xp6(4),e.Q6J("value",t.measureUnit)("disabled",t.auto),e.xp6(1),e.Q6J("ngForOf",t.measureUnits))},dependencies:[C.sg,B.KE,B.hX,le.Nt,ke.gD,ie.ey,C.Ov,E.X$,yu],styles:["[_nghost-%COMP%]{display:flex;width:100%;padding:5px 10px}.measure-field[_ngcontent-%COMP%]{pointer-events:none;display:flex;flex-flow:column nowrap;width:100%}.unit-field[_ngcontent-%COMP%]{width:50px;margin-left:10px;margin-top:10px}"],changeDetection:0}),i}(),Pu=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,I.ot,ot.vV,O.Ps,J.AV,B.lN,le.c,ke.LD,ht.rP,Mt.t,he,$o]}),i}();e.B6R(Ps,[C.O5,I.lW,ot.A9,ot.Yi,O.Hw,J.gM,ht.Rr,Mt.d,ho,mw],[C.Ov,E.X$]),e.B6R(vu,[C.O5],[E.X$,yu]);var Eu=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Pu]}),i}(),er=function(){return(i=er||(er={}))[i.None=0]="None",i[i.Move=1]="Move",i[i.Zoom=2]="Zoom",i[i.ZoomIfOutMapExtent=3]="ZoomIfOutMapExtent",er;var i}(),Gs=function(){var i=function(){function a(){(0,h.Z)(this,a),this.features$=new x.X([[],void 0])}return(0,v.Z)(a,[{key:"setFeatures",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:er.None;this.features$.next([t,o])}},{key:"clear",value:function(){this.features$.next([[],er.None])}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),hw=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.component=n,this.overlayService=t,this.format=new Ee.Z}return(0,v.Z)(a,[{key:"map",get:function(){return this.component.map}},{key:"ngOnInit",value:function(){var t=this;this.features$$=this.overlayService.features$.subscribe(function(o){return t.handleFeatures(o[0],o[1])})}},{key:"ngOnDestroy",value:function(){this.features$$.unsubscribe()}},{key:"handleFeatures",value:function(t,o){}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Be,2),e.Y36(Gs))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoOverlay",""]]}),i}(),Xr=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i}(),vw=function(){var i=function(){function a(n,t,o,r,s){(0,h.Z)(this,a),this.http=n,this.messageService=t,this.activityService=o,this.languageService=r,this.configService=s}return(0,v.Z)(a,[{key:"print",value:function(t,o){var r=this,s=new $e.x,l=o.paperFormat,c=+o.resolution,u=o.orientation;this.activityId=this.activityService.register();var d=new Cv.ZP({orientation:u,format:l.toLowerCase()}),g=[d.internal.pageSize.width,d.internal.pageSize.height],f=[10,10,10,10],m=g[0]-f[3]-f[1],y=g[1]-f[0]-f[2],_=[m,y],b=[0,0];if(void 0!==o.title&&(b=this.getTitleSize(o.title,m,y,d),this.addTitle(d,o.title,b[0],f[3]+b[1],.35277777777777775*b[0])),void 0!==o.subtitle){var w,T=b[0];w=this.getSubTitleSize(o.subtitle,m,y,d),this.addSubTitle(d,o.subtitle,.7*T,f[3]+w,1.7*T*.35277777777777775),f[0]=f[0]+.7*b[0]*.35277777777777775}return(!0===o.showProjection||!0===o.showScale)&&this.addProjScale(d,t,c,o.showProjection,o.showScale),""!==o.comment&&this.addComment(d,o.comment),this.addMap(d,t,c,_,f).subscribe(function(M){return(0,ne.mG)(r,void 0,void 0,(0,Ne.Z)().mark(function A(){return(0,Ne.Z)().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(M!==Le.Done){Z.next=18;break}return Z.next=3,this.addScale(d,t,f);case 3:return Z.next=5,this.handleMeasureLayer(d,t,f);case 5:if("none"===o.legendPosition){Z.next=16;break}if(!(["topleft","topright","bottomleft","bottomright"].indexOf(o.legendPosition)>-1)){Z.next=11;break}return Z.next=9,this.addLegendSamePage(d,t,f,c,o.legendPosition);case 9:Z.next=14;break;case 11:if("newpage"!==o.legendPosition){Z.next=14;break}return Z.next=14,this.addLegend(d,t,f,c);case 14:Z.next=18;break;case 16:return Z.next=18,this.saveDoc(d);case 18:(M===Le.Done||M===Le.Error)&&(this.activityService.unregister(this.activityId),s.next(Le.Done));case 19:case"end":return Z.stop()}},A,this)}))}),s}},{key:"handleMeasureLayer",value:function(t,o,r){return(0,ne.mG)(this,void 0,void 0,(0,Ne.Z)().mark(function s(){var l,c;return(0,Ne.Z)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!o.layers.find(function(d){return d.visible&&d.id.startsWith("igo-measures-")})){p.next=5;break}return c=o.ol.getOverlayContainer(),p.next=4,Ii(c,{scale:1,backgroundColor:null}).then(function(d){l=d});case 4:this.addCanvas(t,l,r);case 5:case"end":return p.stop()}},s,this)}))}},{key:"getLayersLegendHtml",value:function(t,o,r){var s=this;return new rt.y(function(l){var c="",u=function Zv(i,a){var o,n=[],t=(0,D.Z)(i);try{for(t.s();!(o=t.n()).done;){var r=o.value,s=r.options.legendOptions;if(!1!==r.visible){var u,l=r.dataSource.getLegend(void 0,a)||[],c=(0,D.Z)(l);try{for(c.s();!(u=c.n()).done;){var p=u.value;void 0!==p.url&&n.push({title:r.title||"",url:p.url,display:void 0===(null==s?void 0:s.display)||s.display})}}catch(d){c.e(d)}finally{c.f()}}}}catch(d){t.e(d)}finally{t.f()}return n}(t.layers,{resolution:t.viewController.getResolution(),extent:t.viewController.getExtent(),projection:t.viewController.getOlProjection().getCode(),size:t.ol.getSize()});if(0===u.filter(function(d){return!0===d.display}).length)return l.next(c),void l.complete();c+='<style media="screen" type="text/css">',c+=".html2canvas-container { width: "+o+"mm !important; height: 2000px !important; }",c+="table.tableLegend {table-layout: auto;}",c+="div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}",c+="</style>",c+='<font size="3" face="Times" >',c+='<div class="styleLegend">',c+='<table class="tableLegend" >';var p=u.filter(function(d){return d.display}).map(function(d){return s.getDataImage(d.url).pipe((0,U.U)(function(g){return"<tr><td>"+d.title.toUpperCase()+"</td></tr>"+'<tr><td><img src="'+g+'"></td></tr>'}))});(0,un.D)(p).subscribe(function(d){c=d.reduce(function(g,f){return g+f},c),c+="</table>",l.next(c+="</div>"),l.complete()})})}},{key:"getDataImage",value:function(t){return new dr(this.http,this.configService).transform(t)}},{key:"getLayersLegendImage",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"png",r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;return(0,ne.mG)(this,void 0,void 0,(0,Ne.Z)().mark(function l(){var c,p,d,g,f;return(0,Ne.Z)().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return c=new $e.x,y.next=4,this.getLayersLegendHtml(t,200,s).toPromise();case 4:return p=y.sent,o=o.toLowerCase(),0===p.length&&(p='<font size="12" face="Courier New" >',p+='<div align="center"><b>NO LEGEND</b></div>'),(d=window.document.createElement("div")).style.position="absolute",d.style.top="0",window.document.body.appendChild(d),d.innerHTML=p,y.next=14,this.timeout(1);case 14:return y.next=16,Ii(d,{useCORS:!0}).catch(function(_){console.log(_)});case 16:if(g=y.sent){f=Le.Done;try{r?this.generateCanvaFileToZip(g,"legendImage."+o):this.saveCanvasImageAsFile(g,"legendImage",o),d.parentNode.removeChild(d)}catch(_){f=Le.Error}c.next(f)}return y.abrupt("return",c);case 19:case"end":return y.stop()}},l,this)}))}},{key:"getTitleSize",value:function(t,o,r,s){var c=Math.round(2*(r+145)*.05)/2;s.setFont("Times","bold"),s.getTextWidth(t);var f,p=s.getStringUnitWidth(t)*c/s.internal.scaleFactor,d=Math.round(2*(r+150)*.037)/2,g=0;return p>=o?(f=0,(g=Math.round(o/t.length*96/25.4))<d&&(g=d)):(f=(o-p)/2,g=c),[g,f]}},{key:"getSubTitleSize",value:function(t,o,r,s){var l=.7*Math.round(2*(r+145)*.05)/2;s.setFont("Times","bold");var c=s.getStringUnitWidth(t)*l/s.internal.scaleFactor;return c>=o?0:(o-c)/2}},{key:"addTitle",value:function(t,o,r,s,l){t.setFont("Times","bold"),t.setFontSize(r),t.text(o,s,l)}},{key:"addSubTitle",value:function(t,o,r,s,l){t.setFont("Times","bold"),t.setFontSize(r),t.text(o,s,l)}},{key:"addComment",value:function(t,o){var c=t.internal.pageSize.height-5;t.setFont("courier"),t.setFontSize(16),t.text(o,20,c)}},{key:"addProjScale",value:function(t,o,r,s,l){var c=this.languageService.translate,g=t.internal.pageSize.height-15,f="";!0===s&&(f+=c.instant("igo.geo.printForm.projection")+": "+o.projection),!0===l&&(!0===s&&(f+="   "),f+=c.instant("igo.geo.printForm.scale")+": ~ 1 / "+ps(o.viewController.getScale(r))),t.setFont("courier"),t.setFontSize(16),t.text(f,20,g)}},{key:"addLegend",value:function(t,o,r,s){return(0,ne.mG)(this,void 0,void 0,(0,Ne.Z)().mark(function l(){var c,u,p,d,f,m;return(0,Ne.Z)().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return c=t.internal.pageSize.width,_.next=3,this.getLayersLegendHtml(o,c,s).toPromise();case 3:if(""!==(u=_.sent)){_.next=8;break}return _.next=7,this.saveDoc(t);case 7:return _.abrupt("return",!0);case 8:return(p=window.document.createElement("div")).style.position="absolute",p.style.top="0",window.document.body.appendChild(p),p.innerHTML=u,_.next=15,this.timeout(1);case 15:return _.next=17,Ii(p,{useCORS:!0}).catch(function(b){console.log(b)});case 17:return(d=_.sent)&&(f=[25.4*d.width*.85/s,25.4*d.height*.85/s],t.addPage(),m=d.toDataURL("image/png"),t.addImage(m,"PNG",10,10,f[0],f[1]),p.parentNode.removeChild(p)),_.next=21,this.saveDoc(t);case 21:case"end":return _.stop()}},l,this)}))}},{key:"addLegendSamePage",value:function(t,o,r,s,l){return(0,ne.mG)(this,void 0,void 0,(0,Ne.Z)().mark(function c(){var u,p,d,g,f,y;return(0,Ne.Z)().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return u=t.internal.pageSize.width,b.next=3,this.getLayersLegendHtml(o,u,s).toPromise();case 3:if(""!==(p=b.sent)){b.next=8;break}return b.next=7,this.saveDoc(t);case 7:return b.abrupt("return",!0);case 8:return(d=window.document.createElement("div")).style.position="absolute",d.style.top="0",window.document.body.appendChild(d),d.innerHTML=p,b.next=15,this.timeout(1);case 15:return b.next=17,Ii(d,{useCORS:!0}).catch(function(w){console.log(w)});case 17:if(!(g=b.sent)){b.next=26;break}return y=[25.4*g.width*.85/s,25.4*g.height*.85/s],"bottomright"===l?f=[t.internal.pageSize.height-r[2]-y[1],r[1],r[2],t.internal.pageSize.width-r[1]-y[0]]:"topright"===l?f=[r[0],r[1],t.internal.pageSize.height-r[0]-y[1],t.internal.pageSize.width-r[1]-y[0]]:"bottomleft"===l?f=[t.internal.pageSize.height-r[2]-y[1]-15,t.internal.pageSize.width-r[3]-y[0],r[2]+15,r[3]]:"topleft"===l&&(f=[r[0],t.internal.pageSize.width-r[3]-y[0],t.internal.pageSize.height-r[0]-y[1],r[3]]),this.addCanvas(t,g,f),d.parentNode.removeChild(d),b.next=26,this.saveDoc(t);case 26:case"end":return b.stop()}},c,this)}))}},{key:"addScale",value:function(t,o,r){return(0,ne.mG)(this,void 0,void 0,(0,Ne.Z)().mark(function s(){var l,u,p,d,g,f,m;return(0,Ne.Z)().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:for(l=o.ol.getSize(),o.ol.getView().calculateExtent(l),p=o.ol.getOverlayContainerStopEvent(),d=p.getElementsByTagName("button"),g=Array.from(d),f=0,m=g;f<m.length;f++)m[f].setAttribute("data-html2canvas-ignore","true");return w.next=8,Ii(p,{scale:1,backgroundColor:null,allowTaint:!0,useCORS:!0}).then(function(T){u=T});case 8:this.addCanvas(t,u,r);case 10:case"end":return w.stop()}},s,this)}))}},{key:"defineNbFileToProcess",value:function(t){this.nbFileToProcess=t}},{key:"timeout",value:function(t){return new Promise(function(o){return setTimeout(o,t)})}},{key:"addCanvas",value:function(t,o,r){var s;if(o&&(s=o.toDataURL("image/png")),void 0!==s){var l=this.getImageSizeToFitPdf(t,o,r);t.addImage(s,"PNG",r[3],r[0],l[0],l[1]),t.rect(r[3],r[0],l[0],l[1])}}},{key:"addMap",value:function(t,o,r,s,l){var m,c=this,u=new $e.x,p=o.ol.getSize(),d=o.ol.getView().calculateExtent(p),g=Math.round(s[0]*r/25.4),f=Math.round(s[1]*r/25.4);return o.ol.once("rendercomplete",function(y){var _=y.target.getViewport().getElementsByTagName("canvas"),b=o.status$.subscribe(function(w){if(clearTimeout(m),w===Le.Done){b.unsubscribe();var T=Le.Done;try{var A,M=(0,D.Z)(_);try{for(M.s();!(A=M.n()).done;){var L=A.value;0!==L.width&&c.addCanvas(t,L,l)}}catch(Z){M.e(Z)}finally{M.f()}}catch(Z){T=Le.Error,c.messageService.error(c.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),c.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"))}c.renderMap(o,p,d),u.next(T)}});m=window.setTimeout(function(){b.unsubscribe();var w=Le.Done;try{var M,T=(0,D.Z)(_);try{for(T.s();!(M=T.n()).done;){var A=M.value;0!==A.width&&c.addCanvas(t,A,l)}}catch(L){T.e(L)}finally{T.f()}}catch(L){w=Le.Error,c.messageService.error(c.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),c.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"))}c.renderMap(o,p,d),u.next(w)},200)}),this.renderMap(o,[g,f],d),u}},{key:"downloadMapImage",value:function(t,o){var r=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"png",l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]&&arguments[4],p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",f=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],m=new $e.x;this.activityId=this.activityService.register();var y=this.languageService.translate;return t.ol.once("rendercomplete",function(_){s=s.toLowerCase();var b=_.target.getViewport().getElementsByTagName("canvas")[0],w=document.createElement("canvas"),T=w.getContext("2d"),M=0,A=10,L=b.width,Z=b.height;T.font="20px Calibri";var R=T.measureText(g).width;Z=""!==p?Z+30:Z,Z=""!==d?Z+30:Z;var V=(Z=!1!==l||!1!==c?Z+30:Z)-10,P=Math.ceil(R/L),Y=(Z=""!==g?Z+30*P:Z)-20*P+5;if(w.width=L,w.height=Z,"jpeg"===s&&(T.fillStyle="#ffffff",T.fillRect(0,0,L,Z),T.fillStyle="#000000"),""!==p&&(T.font="26px Calibri",M=30,T.textAlign="center",T.fillText(p,L/2,20,.9*L)),""!==d&&(T.font="26px Calibri",M=60,T.textAlign="center",T.fillText(d,L/2,50,.9*L)),T.font="20px Calibri",!1!==l){var pe=y.instant("igo.geo.printForm.projection");T.textAlign="start",T.fillText(pe+": "+t.projection,A,V),A+=200}if(!1!==c){var ue=y.instant("igo.geo.printForm.scale"),oe=t.viewController.getScale(o);T.textAlign="start",T.fillText(ue+": ~ 1 / "+ps(oe),A,V)}if(""!==g)if(T.textAlign="center",1===P)T.fillText(g,L/2,Y);else for(var Ce,ae=Math.floor(g.length/P),xe="",Me=0,Wt=0;Wt<P;Wt++)P-1>Wt?(Ce=(xe=g.substr(Me,ae)).lastIndexOf(" "),T.fillText(xe.substr(0,Ce),L/2,Y),Me+=Ce,Y+=20):T.fillText(g.substr(Me),L/2,Y);T.drawImage(b,0,M);var wt=Le.Done,Kt="map."+s;"tiff"===s.toLowerCase()&&(Kt="map"+t.projection.replace(":","_")+"."+s);try{f?(s.toLowerCase(),r.generateCanvaFileToZip(w,Kt)):r.saveCanvasImageAsFile(w,Kt,s)}catch(rr){wt=Le.Error}if(m.next(wt),"tiff"===s.toLowerCase()){var Fn=Kt.substring(0,Kt.toLowerCase().indexOf(".tiff"))+".tfw",fe=r.getWorldFileInformation(t),ui=new Blob([fe],{type:"text/plain;charset=utf-8"});f?r.addFileToZip(Fn,ui):((0,ss.saveAs)(ui,Fn),r.saveFileProcessing())}}),t.ol.renderSync(),m}},{key:"renderMap",value:function(t,o,r){t.ol.updateSize(),t.ol.renderSync()}},{key:"saveDoc",value:function(t){return(0,ne.mG)(this,void 0,void 0,(0,Ne.Z)().mark(function o(){return(0,Ne.Z)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,t.save("map.pdf",{returnPromise:!0});case 2:case"end":return s.stop()}},o)}))}},{key:"getImageSizeToFitPdf",value:function(t,o,r){var s=t.internal.pageSize.getHeight()-(r[0]+r[2]),l=t.internal.pageSize.getWidth()-(r[1]+r[3]),c=o.height,u=o.width,p=c/s,d=u/l,g=p>d?p:d;return[g>1?u/g:u,g>1?c/g:c]}},{key:"getWorldFileInformation",value:function(t){var o=t.viewController.getResolution(),r=t.viewController.getExtent();return[o,0,0,-o,r[0]+o/.5,r[3]-o/.5].join("\n")}},{key:"saveCanvasImageAsFile",value:function(t,o,r){var s="image/"+r,l=this;try{t.toDataURL(),navigator.msSaveBlob?(navigator.msSaveBlob(t.msToBlob(),o),this.saveFileProcessing()):t.toBlob(function(c){(0,ss.saveAs)(c,o),l.saveFileProcessing()},s)}catch(c){this.messageService.error(this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"))}}},{key:"generateCanvaFileToZip",value:function(t,o){var s=this;(!this.hasOwnProperty("zipFile")||void 0===this.zipFile)&&(this.zipFile=new Sv);try{t.toDataURL(),navigator.msSaveBlob?this.addFileToZip(o,t.msToBlob()):t.toBlob(function(l){s.addFileToZip(o,l)},"image/jpeg")}catch(l){this.messageService.error(this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"))}}},{key:"addFileToZip",value:function(t,o){this.zipFile.file(t,o),this.nbFileToProcess--,0===this.nbFileToProcess&&(this.getZipFile(),this.activityService.unregister(this.activityId))}},{key:"saveFileProcessing",value:function(){this.nbFileToProcess--,0===this.nbFileToProcess&&this.activityService.unregister(this.activityId)}},{key:"getZipFile",value:function(){var t=this;this.zipFile.generateAsync({type:"blob"}).then(function(o){(0,ss.saveAs)(o,"map.zip"),delete t.zipFile})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG(Ae),e.LFG(mi),e.LFG($),e.LFG(j))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),$u=_n(["Pdf","Image"]),Ru=_n(["A0","A1","A2","A3","A4","A5","Letter","Legal"]),Ju=_n(["landscape","portrait"]),Bu=_n(["72","96","150","300"]),Uu=_n(["Bmp","Gif","Jpeg","Png","Tiff"]),Nu=_n(["none","topright","topleft","bottomleft","bottomright","newpage"]);function yw(i,a){if(1&i&&(e.TgZ(0,"mat-option",19),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n.key),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.printForm.legendPositions."+n.value)," ")}}function _w(i,a){if(1&i&&(e.TgZ(0,"mat-option",19),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n.key),e.xp6(1),e.hij(" ",n.value," ")}}function bw(i,a){if(1&i&&(e.TgZ(0,"mat-option",19),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n.key),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.printForm.paperFormats."+n.value)," ")}}function Cw(i,a){if(1&i&&(e.TgZ(0,"mat-option",19),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n.key),e.xp6(1),e.hij(" ",n.value," ")}}function Sw(i,a){if(1&i&&(e.TgZ(0,"mat-option",19),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n.key),e.xp6(1),e.hij(" ",n.value+" PPI"," ")}}function ww(i,a){if(1&i&&(e.TgZ(0,"mat-option",19),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n.key),e.xp6(1),e.hij(" ",e.lcZ(2,2,"igo.geo.printForm."+n.value)," ")}}var Tw=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.formBuilder=n,this.outputFormats=$u,this.paperFormats=Ru,this.orientations=Ju,this.resolutions=Bu,this.imageFormats=Uu,this.legendPositions=Nu,this.isPrintService=!0,this.submit=new e.vpe,this.form=this.formBuilder.group({title:["",[]],subtitle:["",[]],comment:["",[]],outputFormat:["",[S.kI.required]],paperFormat:["",[S.kI.required]],imageFormat:["",[S.kI.required]],resolution:["",[S.kI.required]],orientation:["",[S.kI.required]],legendPosition:["",[S.kI.required]],showProjection:!1,showScale:!1,showLegend:!1,doZipFile:[{hidden:this.isPrintService}]})}return(0,v.Z)(a,[{key:"imageFormat",get:function(){return this.imageFormatField.value},set:function(t){this.imageFormatField.setValue(t||Uu.Jpeg,{onlySelf:!0})}},{key:"outputFormat",get:function(){return this.outputFormatField.value},set:function(t){this.outputFormatField.setValue(t||$u.Pdf,{onlySelf:!0})}},{key:"paperFormat",get:function(){return this.paperFormatField.value},set:function(t){this.paperFormatField.setValue(t||Ru.Letter,{onlySelf:!0})}},{key:"orientation",get:function(){return this.orientationField.value},set:function(t){this.orientationField.setValue(t||Ju.landscape,{onlySelf:!0})}},{key:"resolution",get:function(){return this.resolutionField.value},set:function(t){this.resolutionField.setValue(t||Bu[96],{onlySelf:!0})}},{key:"legendPosition",get:function(){return this.legendPositionField.value},set:function(t){this.legendPositionField.setValue(t||Nu.none,{onlySelf:!0})}},{key:"title",get:function(){return this.titleField.value},set:function(t){this.titleField.setValue(t,{onlySelf:!0})}},{key:"subtitle",get:function(){return this.subtitleField.value},set:function(t){this.subtitleField.setValue(t,{onlySelf:!0})}},{key:"comment",get:function(){return this.commentField.value},set:function(t){this.commentField.setValue(t,{onlySelf:!0})}},{key:"showProjection",get:function(){return this.showProjectionField.value},set:function(t){this.showProjectionField.setValue(t,{onlySelf:!0})}},{key:"showScale",get:function(){return this.showScaleField.value},set:function(t){this.showScaleField.setValue(t,{onlySelf:!0})}},{key:"showLegend",get:function(){return this.showLegendField.value},set:function(t){this.showLegendField.setValue(t,{onlySelf:!0})}},{key:"doZipFile",get:function(){return this.doZipFileField.value},set:function(t){this.doZipFileField.setValue(t,{onlySelf:!0})}},{key:"outputFormatField",get:function(){return this.form.controls.outputFormat}},{key:"paperFormatField",get:function(){return this.form.controls.paperFormat}},{key:"imageFormatField",get:function(){return this.form.controls.imageFormat}},{key:"orientationField",get:function(){return this.form.controls.orientation}},{key:"resolutionField",get:function(){return this.form.controls.resolution}},{key:"commentField",get:function(){return this.form.controls.comment}},{key:"showProjectionField",get:function(){return this.form.controls.showProjection}},{key:"showScaleField",get:function(){return this.form.controls.showScale}},{key:"showLegendField",get:function(){return this.form.controls.showLegend}},{key:"doZipFileField",get:function(){return this.form.controls.doZipFile}},{key:"titleField",get:function(){return this.form.controls.title}},{key:"subtitleField",get:function(){return this.form.controls.subtitle}},{key:"legendPositionField",get:function(){return this.form.controls.legendPosition}},{key:"ngOnInit",value:function(){this.doZipFileField.setValue(!1)}},{key:"handleFormSubmit",value:function(t,o){t.isPrintService=this.isPrintService,o&&this.submit.emit(t)}},{key:"toggleImageSaveProp",value:function(){this.isPrintService="Image"!==this.outputFormatField.value}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(S.QS))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-print-form"]],inputs:{disabled$:"disabled$",imageFormat:"imageFormat",outputFormat:"outputFormat",paperFormat:"paperFormat",orientation:"orientation",resolution:"resolution",legendPosition:"legendPosition",title:"title",subtitle:"subtitle",comment:"comment",showProjection:"showProjection",showScale:"showScale",showLegend:"showLegend",doZipFile:"doZipFile"},outputs:{submit:"submit"},decls:65,vars:72,consts:[[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],["matInput","","formControlName","title",3,"placeholder"],["matInput","","formControlName","subtitle",3,"placeholder"],["matInput","","formControlName","comment",3,"placeholder"],[1,"print-slide-toggle-container","mat-typography"],["formControlName","showProjection",1,"print-option",3,"labelPosition"],["formControlName","showScale",1,"print-option",3,"labelPosition"],["formControlName","doZipFile",1,"print-option",3,"labelPosition"],["formControlName","legendPosition",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["formControlName","outputFormat",3,"placeholder","selectionChange"],["formControlName","paperFormat",3,"placeholder"],["formControlName","imageFormat",3,"placeholder"],[1,"igo-input-container",2,"display","none"],["formControlName","resolution",3,"placeholder"],["formControlName","orientation",3,"placeholder"],[1,"igo-form-button-group","print-button-top-padding"],["mat-raised-button","","type","button",3,"disabled","click"],[3,"value"]],template:function(n,t){1&n&&(e.TgZ(0,"form",0)(1,"div",1)(2,"mat-form-field"),e._UZ(3,"input",2),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"div",1)(6,"mat-form-field"),e._UZ(7,"input",3),e.ALo(8,"translate"),e.qZA()(),e.TgZ(9,"div",1)(10,"mat-form-field"),e._UZ(11,"input",4),e.ALo(12,"translate"),e.qZA()(),e.TgZ(13,"div",1)(14,"div",5)(15,"mat-slide-toggle",6),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.TgZ(18,"mat-slide-toggle",7),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"mat-slide-toggle",8),e._uU(22),e.ALo(23,"translate"),e.qZA()()(),e.TgZ(24,"div",1)(25,"mat-form-field")(26,"mat-select",9),e.ALo(27,"translate"),e.YNc(28,yw,3,4,"mat-option",10),e.ALo(29,"keyvalue"),e.qZA()()(),e.TgZ(30,"div",1)(31,"mat-form-field")(32,"mat-select",11),e.NdJ("selectionChange",function(){return t.toggleImageSaveProp()}),e.ALo(33,"translate"),e.YNc(34,_w,2,2,"mat-option",10),e.ALo(35,"keyvalue"),e.qZA()()(),e.TgZ(36,"div",1)(37,"mat-form-field")(38,"mat-select",12),e.ALo(39,"translate"),e.YNc(40,bw,3,4,"mat-option",10),e.ALo(41,"keyvalue"),e.qZA()()(),e.TgZ(42,"div",1)(43,"mat-form-field")(44,"mat-select",13),e.ALo(45,"translate"),e.YNc(46,Cw,2,2,"mat-option",10),e.ALo(47,"keyvalue"),e.qZA()()(),e.TgZ(48,"div",14)(49,"mat-form-field")(50,"mat-select",15),e.ALo(51,"translate"),e.YNc(52,Sw,2,2,"mat-option",10),e.ALo(53,"keyvalue"),e.qZA()()(),e.TgZ(54,"div",1)(55,"mat-form-field")(56,"mat-select",16),e.ALo(57,"translate"),e.YNc(58,ww,3,4,"mat-option",10),e.ALo(59,"keyvalue"),e.qZA()()(),e.TgZ(60,"div",17)(61,"button",18),e.NdJ("click",function(){return t.handleFormSubmit(t.form.value,t.form.valid)}),e.ALo(62,"async"),e._uU(63),e.ALo(64,"translate"),e.qZA()()()),2&n&&(e.Q6J("formGroup",t.form),e.xp6(3),e.s9C("placeholder",e.lcZ(4,32,"igo.geo.printForm.title")),e.xp6(4),e.s9C("placeholder",e.lcZ(8,34,"igo.geo.printForm.subtitle")),e.xp6(4),e.s9C("placeholder",e.lcZ(12,36,"igo.geo.printForm.comment")),e.xp6(4),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(17,38,"igo.geo.printForm.showProjection")," "),e.xp6(2),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(20,40,"igo.geo.printForm.showScale")," "),e.xp6(2),e.Udp("display",t.isPrintService?"none":""),e.Q6J("labelPosition","before"),e.xp6(1),e.hij(" ",e.lcZ(23,42,"igo.geo.printForm.doZipFile")," "),e.xp6(4),e.s9C("placeholder",e.lcZ(27,44,"igo.geo.printForm.legendPosition")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(29,46,t.legendPositions)),e.xp6(4),e.s9C("placeholder",e.lcZ(33,48,"igo.geo.printForm.outputFormat")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(35,50,t.outputFormats)),e.xp6(2),e.Udp("display",t.isPrintService?"block":"none"),e.xp6(2),e.s9C("placeholder",e.lcZ(39,52,"igo.geo.printForm.paperFormat")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(41,54,t.paperFormats)),e.xp6(2),e.Udp("display",t.isPrintService?"none":"block"),e.xp6(2),e.s9C("placeholder",e.lcZ(45,56,"igo.geo.printForm.imageFormat")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(47,58,t.imageFormats)),e.xp6(4),e.s9C("placeholder",e.lcZ(51,60,"igo.geo.printForm.resolution")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(53,62,t.resolutions)),e.xp6(2),e.Udp("display",t.isPrintService?"block":"none"),e.xp6(2),e.s9C("placeholder",e.lcZ(57,64,"igo.geo.printForm.orientation")),e.xp6(2),e.Q6J("ngForOf",e.lcZ(59,66,t.orientations)),e.xp6(3),e.Q6J("disabled",!t.form.valid||e.lcZ(62,68,t.disabled$)),e.xp6(2),e.hij(" ",e.lcZ(64,70,"igo.geo.printForm.saveBtn")," "))},dependencies:[C.sg,S._Y,S.Fj,S.JJ,S.JL,S.sg,S.u,I.lW,B.KE,ke.gD,ie.ey,le.Nt,ht.Rr,C.Ov,E.X$,vo],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}.print-slide-toggle-container[_ngcontent-%COMP%]{overflow-x:hidden}.print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;margin:10px}.print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mat-slide-toggle-content{width:calc(100% - 60px)}.print-option[_ngcontent-%COMP%]{display:block;margin-right:10px;margin-bottom:15px}.print-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}.igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center}"]}),i}(),qu=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.printService=n,this.disabled$=new x.X(!1)}return(0,v.Z)(a,[{key:"map",get:function(){return this._map},set:function(t){this._map=t}},{key:"outputFormat",get:function(){return this._outputFormat},set:function(t){this._outputFormat=t}},{key:"paperFormat",get:function(){return this._paperFormat},set:function(t){this._paperFormat=t}},{key:"orientation",get:function(){return this._orientation},set:function(t){this._orientation=t}},{key:"imageFormat",get:function(){return this._imageFormat},set:function(t){this._imageFormat=t}},{key:"legendPosition",get:function(){return this._legendPosition},set:function(t){this._legendPosition=t}},{key:"resolution",get:function(){return this._resolution},set:function(t){this._resolution=t}},{key:"handleFormSubmit",value:function(t){var o=this;if(this.disabled$.next(!0),!0===t.isPrintService)this.printService.print(this.map,t).pipe((0,We.q)(1)).subscribe(function(){o.disabled$.next(!1)});else{var r=1;t.showLegend&&r++,"tiff"===t.imageFormat.toLowerCase()&&r++,this.printService.defineNbFileToProcess(r);var s=+t.resolution,l=t.showLegend?2:1;this.printService.downloadMapImage(this.map,s,t.imageFormat,t.showProjection,t.showScale,t.showLegend,t.title,t.subtitle,t.comment,t.doZipFile).pipe((0,We.q)(1)).subscribe(function(){--l||o.disabled$.next(!1)}),t.showLegend&&this.printService.getLayersLegendImage(this.map,t.imageFormat,t.doZipFile,+s).then(function(){--l||o.disabled$.next(!1)})}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(vw))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-print"]],inputs:{map:"map",outputFormat:"outputFormat",paperFormat:"paperFormat",orientation:"orientation",imageFormat:"imageFormat",legendPosition:"legendPosition",resolution:"resolution"},decls:1,vars:7,consts:[[3,"outputFormat","paperFormat","orientation","imageFormat","resolution","legendPosition","disabled$","submit"]],template:function(n,t){1&n&&(e.TgZ(0,"igo-print-form",0),e.NdJ("submit",function(r){return t.handleFormSubmit(r)}),e.qZA()),2&n&&e.Q6J("outputFormat",t.outputFormat)("paperFormat",t.paperFormat)("orientation",t.orientation)("imageFormat",t.imageFormat)("resolution",t.resolution)("legendPosition",t.legendPosition)("disabled$",t.disabled$)},dependencies:[Tw],encapsulation:2}),i}(),Qs=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,S.u5,S.UX,O.Ps,I.ot,ke.LD,ie.Ng,le.c,B.lN,ht.rP,he,Jo]}),i}();function xw(i){return new Gc(i.getConfig("searchSources.".concat(Gc.id))||{})}var tr=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[{provide:St,useFactory:xw,multi:!0,deps:[j]}]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[Cs],imports:[C.ez,he,Ln]}),i}(),Ys=(0,v.Z)(function i(){(0,h.Z)(this,i)}),js=(0,v.Z)(function i(a){(0,h.Z)(this,i),this.sources=a});function Mw(i){return new js(i)}var ea=function(){return(i=ea||(ea={}))[i.GeoJSON=0]="GeoJSON",i[i.JSON=1]="JSON",ea;var i}(),ta=function(){return(i=ta||(ta={})).Route="route",i.Trip="trip",ta;var i}(),Zo=function(){return(i=Zo||(Zo={})).Coord="coord",i.Text="text",Zo;var i}(),Bn=function(){return(i=Bn||(Bn={})).Stop="stop",i.Route="route",i.Vertex="vertex",Bn;var i}(),Un=function(){return(i=Un||(Un={})).Start="start",i.Intermediate="intermediate",i.End="end",Un;var i}();function Hs(i){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"position";i.view.sort({direction:a,valueAccessor:function(o){return o[n]}})}function na(i,a){var n=Un.Intermediate;return 0===i?n=Un.Start:i===a-1&&(n=Un.End),n}function Vs(i){var t,a=Ye(),n=i.all();t=0===i.count?[0]:n.map(function(c){return c.position});var o=Math.max.apply(Math,(0,Fe.Z)(t)),r=o,s=o+1,l=i.all().find(function(c){return c.position===o});return l&&(l.position=s,l.relativePosition=na(s,i.count+1)),i.insert({id:a,position:r,relativePosition:na(r,i.count+1)}),Hs(i),i.get(a)}function zs(i,a){var n=[new ee.ZP({geometry:i.getGeometry(),image:new Ue.Z({radius:7,stroke:new K.Z({color:"#FF0000",width:3})})})],t=no({text:i.get("stopText"),opacity:i.get("stopOpacity"),markerColor:i.get("stopColor"),markerOutlineColor:[255,255,255]}),o=[new ee.ZP({stroke:new K.Z({color:"rgba(106, 121, 130, ".concat(i.get("active")?.75:0,")"),width:10})}),new ee.ZP({stroke:new K.Z({color:"rgba(79, 169, 221, ".concat(i.get("active")?.75:0,")"),width:6})})];return i.get("type")===Bn.Stop?t:"vertex"===i.get("type")?n:i.get("type")===Bn.Route?o:void 0}function Pw(i,a,n){var t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=a.geometry.coordinates,s=new dn.Z(r),l=s.transform(n,i.map.projection),c=(new Ee.Z).writeGeometryObject(l,{featureProjection:i.map.projection,dataProjection:i.map.projection}),u=i.get(a.id),p=u?u.meta.revision:0,d={type:be,geometry:c,projection:i.map.projection,properties:{id:a.id,type:Bn.Route,active:t,direction:a},meta:{id:a.id,revision:p+1},ol:new nt.Z({geometry:l})};i.update(d)}function oa(i){if(0!==i)return i>=1e5?co.roundToNDecimal(Math.round(i)/1e3,1)+" km":i>=1e4||i>=1e3?co.roundToNDecimal(Math.round(i)/100/10,1)+" km":co.roundToNDecimal(i,0)+" m"}function Gu(i){if(i>=3600){var a=Math.floor(i/3600),n=Math.round(60*(i/3600-a));return 60===n?a+1+" h":a+" h "+n+" min"}return i>=60?Math.round(i/60)+" min":i+" s"}function Qu(i,a,n,t,o,r,s){var u,l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=s.translate,p="forward",d="rotate-270",g=$w(t,s),f=Ew(a,s),m="straight"===a?"":c.instant("igo.geo.directions.modifier.prefix"),y=m+f;if((null==a?void 0:a.search("slight"))>=0&&(y=f),"uturn"===a?(p="forward",d="rotate-90"):"sharp right"===a||"right"===a?(p="subdirectory-arrow-right",d="icon-flipped"):"slight right"===a?(p="forward",d="rotate-290"):"straight"===a?p="forward":"slight left"===a?(p="forward",d="rotate-250"):("left"===a||"sharp left"===a)&&(p="subdirectory-arrow-left",d="icon-flipped"),"turn"===i)u="straight"===a?c.instant("igo.geo.directions.turn.straight",{route:n}):"uturn"===a?c.instant("igo.geo.directions.turn.uturn",{route:n}):c.instant("igo.geo.directions.turn.else",{route:n,aggregatedDirection:y,translatedModifier:f});else if("new name"===i)u=c.instant("igo.geo.directions.new name",{route:n,translatedDirection:g}),p="compass",d="";else if("depart"===i)u=c.instant("igo.geo.directions.depart",{route:n,translatedDirection:g}),p="compass",d="";else if("arrive"===i)if(l){var _=f?", ":"";u=c.instant("igo.geo.directions.arrive.lastStep",{coma:_,aggregatedDirection:y=f?y:""})}else u=c.instant("igo.geo.directions.arrive.intermediate",{route:n}),p="map-marker",d="";else if("merge"===i)u=c.instant("igo.geo.directions.merge",{route:n}),p="forward",d="rotate-270";else if("on ramp"===i)u=c.instant("igo.geo.directions.on ramp",{aggregatedDirection:y});else if("off ramp"===i)u=c.instant("igo.geo.directions.off ramp",{aggregatedDirection:y});else if("fork"===i)u=a.search("left")>=0?c.instant("igo.geo.directions.fork.left",{route:n}):a.search("right")>=0?c.instant("igo.geo.directions.fork.right",{route:n}):c.instant("igo.geo.directions.fork.else",{route:n});else if("end of road"===i)u=c.instant("igo.geo.directions.end of road",{translatedModifier:f,route:n});else if("use lane"===i)u=c.instant("igo.geo.directions.use lane");else if("continue"===i&&"uturn"!==a)u=c.instant("igo.geo.directions.continue.notUturn",{route:n}),p="forward",d="rotate-270";else if("roundabout"===i){var b=c.instant(1===r?"igo.geo.directions.cntSuffix.first":"igo.geo.directions.cntSuffix.secondAndMore");u=c.instant("igo.geo.directions.roundabout",{exit:r,cntSuffix:b,route:n}),p="chart-donut",d=""}else"rotary"===i?(u=c.instant("igo.geo.directions.rotary"),p="chart-donut",d=""):"roundabout turn"===i?(u=c.instant("igo.geo.directions.roundabout turn"),p="chart-donut",d=""):"exit roundabout"===i?(u=c.instant("igo.geo.directions.exit roundabout",{route:n}),p="forward",d="rotate-270"):u="notification"===i?c.instant("igo.geo.directions.notification"):"uturn"===a?c.instant("igo.geo.directions.uturnText",{translatedDirection:g,route:n}):c.instant("igo.geo.directions.unknown");return p=l?"flag-variant":p,d=l?"":d,{instruction:u,image:p=0===o?"compass":p,cssClass:d=0===o?"":d}}function Ew(i,a){var n=a.translate;return"uturn"===i?n.instant("igo.geo.directions.uturn"):"sharp right"===i?n.instant("igo.geo.directions.sharp right"):"right"===i?n.instant("igo.geo.directions.right"):"slight right"===i?n.instant("igo.geo.directions.slight right"):"sharp left"===i?a.translate.instant("igo.geo.directions.sharp left"):"left"===i?a.translate.instant("igo.geo.directions.left"):"slight left"===i?a.translate.instant("igo.geo.directions.slight left"):"straight"===i?a.translate.instant("igo.geo.directions.straight"):i}function $w(i,a){var n=a.translate;return i>=337||i<23?n.instant("igo.geo.cardinalPoints.n"):i<67?n.instant("igo.geo.cardinalPoints.ne"):i<113?n.instant("igo.geo.cardinalPoints.e"):i<157?n.instant("igo.geo.cardinalPoints.se"):i<203?n.instant("igo.geo.cardinalPoints.s"):i<247?n.instant("igo.geo.cardinalPoints.sw"):i<293?n.instant("igo.geo.cardinalPoints.w"):i<337?n.instant("igo.geo.cardinalPoints.nw"):void 0}function Rw(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(n);var o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.clearStop(o))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",11),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.clearStop"))}function Jw(i,a){if(1&i&&(e.TgZ(0,"mat-option",14),e._uU(1),e.qZA()),2&i){var n=a.$implicit;e.Q6J("value",n)("matTooltip",n.meta?n.meta.title:""),e.xp6(1),e.hij(" ",n.meta?n.meta.title:""," ")}}function Bw(i,a){if(1&i&&(e.TgZ(0,"mat-optgroup",12),e.YNc(1,Jw,2,3,"mat-option",13),e.qZA()),2&i){var n=a.$implicit;e.Q6J("label",n.source.title)("disabled",!1===n.source.enabled),e.xp6(1),e.Q6J("ngForOf",n.results)}}function Uw(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(2).$implicit,r=e.oxw();return e.KtG(r.removeStop(o))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",21),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.removeStop"))}function Nw(i,a){1&i&&(e.TgZ(0,"button",22),e.ALo(1,"translate"),e._UZ(2,"mat-icon",23),e.qZA()),2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.removeStop"))}function qw(i,a){if(1&i&&(e.TgZ(0,"div",15)(1,"button",16),e.ALo(2,"translate"),e._UZ(3,"mat-icon",17),e.qZA(),e.YNc(4,Uw,3,3,"button",18),e.ALo(5,"async"),e.YNc(6,Nw,3,3,"button",19),e.ALo(7,"async"),e.qZA()),2&i){var n=e.oxw(2);e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,3,"igo.geo.directionsForm.moveStop")),e.xp6(3),e.Q6J("ngIf",e.lcZ(5,5,n.stopsStore.count$)>2),e.xp6(2),e.Q6J("ngIf",e.lcZ(7,7,n.stopsStore.count$)<=2)}}function Gw(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",2),e.NdJ("touchenter",function(){var c=e.CHM(n).$implicit,u=e.oxw();return e.KtG(u.onStopEnter(c))})("touchleave",function(){e.CHM(n);var l=e.oxw();return e.KtG(l.onStopLeave())})("mouseover",function(){var c=e.CHM(n).$implicit,u=e.oxw();return e.KtG(u.onStopEnter(c))})("mouseleave",function(){e.CHM(n);var l=e.oxw();return e.KtG(l.onStopLeave())})("cdkDragStarted",function(){e.CHM(n);var l=e.oxw();return e.KtG(l.stopIsDragged=!0)})("cdkDragEnded",function(){e.CHM(n);var l=e.oxw();return e.KtG(l.stopIsDragged=!1)}),e.TgZ(1,"div",3)(2,"mat-form-field")(3,"input",4),e.NdJ("focus",function(){var c=e.CHM(n).$implicit,u=e.oxw();return e.KtG(u.onInputFocus(c))})("ngModelChange",function(l){var c=e.CHM(n);return e.KtG(c.$implicit.text=l)})("keyup",function(l){var u=e.CHM(n).$implicit,p=e.oxw();return e.KtG(p.setStopText(l,u))})("keydown.enter",function(l){return l.preventDefault()}),e.qZA(),e.YNc(4,Rw,3,3,"button",5),e.TgZ(5,"mat-autocomplete",6,7),e.NdJ("optionSelected",function(l){var u=e.CHM(n).$implicit,p=e.oxw();return e.KtG(p.chooseProposal(l,u))}),e.YNc(7,Bw,2,3,"mat-optgroup",8),e.qZA()()(),e.YNc(8,qw,8,9,"div",9),e.qZA()}if(2&i){var t=a.$implicit,o=e.MAs(6),r=e.oxw();e.xp6(1),e.Q6J("ngClass",r.getNgClass(t)),e.xp6(2),e.s9C("id",t.id),e.Q6J("placeholder",r.getPlaceholder(t))("matTooltip",t.text)("ngModel",t.text)("matAutocomplete",o),e.xp6(1),e.Q6J("ngIf",(t.text||t.coordinates)&&r.stopWithHover&&t.id===r.stopWithHover.id),e.xp6(1),e.Q6J("displayWith",r.getOptionText),e.xp6(2),e.Q6J("ngForOf",t.searchProposals),e.xp6(1),e.Q6J("ngIf",!r.stopIsDragged&&r.stopWithHover&&t.id===r.stopWithHover.id)}}var Qw=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.languageService=n,this.invalidKeys=["Control","Shift","Alt"],this.onMapClickEventKeys=[],this.stopIsDragged=!1,this.coordRoundedDecimals=6,this.debounce=200,this.length=2,this.stopInputHasFocus=new e.vpe(!1)}return(0,v.Z)(a,[{key:"ngOnDestroy",value:function(){this.unlistenMapSingleClick()}},{key:"onStopEnter",value:function(t){this.stopWithHover=t}},{key:"onStopLeave",value:function(){this.stopWithHover=void 0}},{key:"getOptionText",value:function(t){return t instanceof Object?null!=t&&t.meta?t.meta.title:"":t}},{key:"chooseProposal",value:function(t,o){var r=t.option.value;if(r){var s,l=r.geometry;if("Point"===l.type)s=l.coordinates;else{var c=(0,ls.Z)(r.geometry);s=[c.geometry.coordinates[0],c.geometry.coordinates[1]]}s&&(o.coordinates=s,o.text=r.meta.title,this.stopsStore.update(o))}}},{key:"setStopText",value:function(t,o){this.unlistenMapSingleClick();var r=t.target.value;0===r.length?this.clearStop(o):this.validateTerm(r)&&(o.text=r,this.stopsStore.update(o))}},{key:"validateTerm",value:function(t){return!(!this.keyIsValid(t)||!(t.length>=this.length||0===t.length))}},{key:"keyIsValid",value:function(t){return void 0===this.invalidKeys.find(function(o){return o===t})}},{key:"getNgClass",value:function(t){return this.stopWithHover&&t.id===this.stopWithHover.id?"igo-input-container reduce":"igo-input-container"}},{key:"getPlaceholder",value:function(t){var o="";return t.relativePosition?(t.relativePosition===Un.Intermediate&&(o=" #"+t.position),this.languageService.translate.instant("igo.geo.directionsForm."+t.relativePosition)+o):""}},{key:"removeStop",value:function(t){!function Aw(i,a){i.delete(a),function Zw(i){var a=(0,Fe.Z)(i.all());a.sort(function(n,t){return n.position-t.position}),a.map(function(n,t){n.position=t,n.relativePosition=na(n.position,a.length)}),a&&i.updateMany(a)}(i)}(this.stopsStore,t)}},{key:"clearStop",value:function(t){this.stopsStore.update({id:t.id,relativePosition:t.relativePosition,position:t.position})}},{key:"drop",value:function(t){this.moveStops(t.previousIndex,t.currentIndex)}},{key:"moveStops",value:function(t,o){if(t!==o){var r=(0,Fe.Z)(this.stopsStore.view.all());(0,Li.bA)(r,t,o),r.map(function(s,l){s.relativePosition=na(l,r.length),s.position=l}),this.stopsStore.updateMany(r),Hs(this.stopsStore)}}},{key:"onInputFocus",value:function(t){var o;(!t.text||0===(null===(o=t.text)||void 0===o?void 0:o.length))&&(this.unlistenMapSingleClick(),this.stopInputHasFocus.emit(!0),this.listenMapSingleClick(t))}},{key:"listenMapSingleClick",value:function(t){var o=this,r=this.stopsFeatureStore.layer.map.ol.once("singleclick",function(s){var c=Rt(re.vs(s.coordinate,o.stopsFeatureStore.layer.map.projection,o.projection),o.coordRoundedDecimals);t.text=c.join(","),t.coordinates=c,o.stopsStore.update(t),setTimeout(function(){o.stopInputHasFocus.emit(!1)},500)});this.onMapClickEventKeys.push(r)}},{key:"unlistenMapSingleClick",value:function(){this.onMapClickEventKeys.map(function(t){st.B(t)}),this.onMapClickEventKeys=[]}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36($))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-directions-inputs"]],inputs:{stopsStore:"stopsStore",stopsFeatureStore:"stopsFeatureStore",projection:"projection",coordRoundedDecimals:"coordRoundedDecimals",debounce:"debounce",length:"length"},outputs:{stopInputHasFocus:"stopInputHasFocus"},decls:3,vars:3,consts:[["cdkDropList","",1,"stops-list",3,"cdkDropListDropped"],["touchleave","","cdkDragLockAxis","y","class","stop-box mat-typography","cdkDrag","",3,"touchenter","touchleave","mouseover","mouseleave","cdkDragStarted","cdkDragEnded",4,"ngFor","ngForOf"],["touchleave","","cdkDragLockAxis","y","cdkDrag","",1,"stop-box","mat-typography",3,"touchenter","touchleave","mouseover","mouseleave","cdkDragStarted","cdkDragEnded"],[3,"ngClass"],["type","text","matTooltipShowDelay","500","aria-label","Number","matInput","",3,"id","placeholder","matTooltip","ngModel","matAutocomplete","focus","ngModelChange","keyup","keydown.enter"],["mat-button","","matTooltipShowDelay","500","matSuffix","","mat-icon-button","","color","warn","aria-label","Clear",3,"matTooltip","click",4,"ngIf"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"label","disabled",4,"ngFor","ngForOf"],["class","igo-form-button-group",4,"ngIf"],["mat-button","","matTooltipShowDelay","500","matSuffix","","mat-icon-button","","color","warn","aria-label","Clear",3,"matTooltip","click"],["svgIcon","close"],[3,"label","disabled"],["matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["matTooltipShowDelay","500",3,"value","matTooltip"],[1,"igo-form-button-group"],["cdkDragHandle","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"swipe-vertical",3,"matTooltip"],["svgIcon","gesture-swipe-vertical"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["disabled","true","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","delete"],["disabled","true","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip"],["svgIcon","blank"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.NdJ("cdkDropListDropped",function(r){return t.drop(r)}),e.YNc(1,Gw,9,10,"div",1),e.ALo(2,"async"),e.qZA()),2&n&&(e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,t.stopsStore.view.all$())))},dependencies:[C.mk,C.sg,C.O5,Li.Wj,Li.Zt,Li.Bh,S.Fj,S.JJ,S.On,O.Hw,I.lW,B.KE,B.R9,le.Nt,ie.ey,ie.Nv,J.gM,_t.XC,_t.ZL,C.Ov,E.X$],styles:[".igo-input-container[_ngcontent-%COMP%]{width:100%}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.igo-input-container.reduce[_ngcontent-%COMP%]{width:70%}.igo-input-container.reduce[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.stops-list[_ngcontent-%COMP%]{max-width:100%;min-height:60px;display:block;background:white;border-radius:4px;overflow:hidden;padding:20px 10px}.swipe-vertical[_ngcontent-%COMP%]{cursor:move}.stop-box[_ngcontent-%COMP%]{height:60px;padding:20px 10px;color:#000000de;display:flex;flex-direction:row;align-items:center;justify-content:space-between;box-sizing:border-box;background:white}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.stops-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .stop-box[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]}),i}(),Yw=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.directionsSourceService=n}return(0,v.Z)(a,[{key:"route",value:function(t){var o=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0!==t.length)return this.directionsSourceService.sources.filter(function(s){return s.enabled}).map(function(s){return o.routeSource(s,t,r)})}},{key:"routeSource",value:function(t,o){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=t.route(o,r);return s}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(js))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function nr(i){return void 0!==i.search}function Yu(i){return void 0!==i.reverseSearch}function Ws(i){return void 0!==i.reverseSearch&&!0===i.showInPointerSummary}function ju(i,a){var n="";return a.split("").forEach(function(t,o){t!==i.charAt(o)&&(n+=t)}),n}function ri(i,a){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!i||!a)return 0;var t=n?i:i.toLowerCase(),o=n?a:a.toLowerCase(),r=ju(t,o),s=ju(o,t),l=r+s,c=0;return l.length&&(c=l.length/t.length*100),100-Math.floor(c)}var vn=function(){function i(a){(0,h.Z)(this,i),this.sources=a}return(0,v.Z)(i,[{key:"getSources",value:function(){return this.sources}},{key:"getEnabledSources",value:function(){return this.getSources().filter(function(n){return!0===n.enabled})}},{key:"enableSourcesByType",value:function(n){this.getSources().forEach(function(t){t.enabled=t.constructor.type===n})}},{key:"setParamFromSetting",value:function(n,t){n.setParamFromSetting(t)}}]),i}(),or=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.searchSourceService=n,this.mapService=t}return(0,v.Z)(a,[{key:"search",value:function(t){var r,s,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.termIsValid(t))return[];var u,l=(null===(r=this.mapService.getMap())||void 0===r?void 0:r.projection)||"EPSG:3857",c=hc(t,l,{forceNA:o.forceNA});return c.lonLat?this.reverseSearch(c.lonLat,{distance:c.radius,conf:c.conf}):(c.message&&console.log(c.message),o.extent=null===(s=this.mapService.getMap())||void 0===s?void 0:s.viewController.getExtent("EPSG:4326"),u=o.getEnabledOnly||void 0===o.getEnabledOnly?this.searchSourceService.getEnabledSources():this.searchSourceService.getSources(),o.sourceId?u=u.filter(function(p){return p.getId()===o.sourceId}):o.searchType&&(u=u.filter(function(p){return p.getType()===o.searchType})),u=u.filter(nr),this.searchSources(u,t,o))}},{key:"reverseSearch",value:function(t,o){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=r?Ws:Yu,l=this.searchSourceService.getEnabledSources().filter(s);return this.reverseSearchSources(l,t,o||{})}},{key:"searchSources",value:function(t,o,r){return t.map(function(s){return{request:s.search(o,r),reverse:!1,source:s}})}},{key:"reverseSearchSources",value:function(t,o,r){return t.map(function(s){return{request:s.reverseSearch(o,r),reverse:!0,source:s}})}},{key:"termIsValid",value:function(t){return"string"==typeof t&&""!==t}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(vn),e.LFG(Vt))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function jw(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){e.CHM(n);var o=e.oxw();return e.KtG(o.resetStops())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",6),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.resetDirectionsBtn"))}function Hw(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(n);var o=e.oxw();return e.KtG(o.zoomRoute())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",7),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.zoomRoute"))}function Vw(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(n);var o=e.oxw();return e.KtG(o.copyDirectionsToClipboard())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",8),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.copy"))}function zw(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(){e.CHM(n);var o=e.oxw();return e.KtG(o.copyLinkToClipboard())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",9),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.geo.directionsForm.link"))}var Ww=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.languageService=n,this.messageService=t,this.route=o,this.zoomToActiveRoute$=new $e.x}return(0,v.Z)(a,[{key:"activeRoute",get:function(){return this.routesFeatureStore.all().find(function(t){return t.properties.active})}},{key:"resetStops",value:function(){this.stopsStore.clearStops()}},{key:"addStop",value:function(){Vs(this.stopsStore)}},{key:"copyLinkToClipboard",value:function(){if(Gn.copy(this.getUrl())){var o=this.languageService.translate,r=o.instant("igo.geo.directionsForm.dialog.copyTitle"),s=o.instant("igo.geo.directionsForm.dialog.copyMsgLink");this.messageService.success(s,r)}}},{key:"zoomRoute",value:function(){this.zoomToActiveRoute$.next()}},{key:"copyDirectionsToClipboard",value:function(){var t=this.directionsToText();if(Gn.copy(t)){var r=this.languageService.translate,s=r.instant("igo.geo.directionsForm.dialog.copyTitle"),l=r.instant("igo.geo.directionsForm.dialog.copyMsg");this.messageService.success(l,s)}}},{key:"directionsToText",value:function(){var t=this,o="\t",r=this.languageService.translate.instant("igo.geo.directionsForm.instructions")+":\n",s="",l=this.languageService.translate.instant("igo.geo.directionsForm.summary")+": \n"+o+this.activeRoute.properties.direction.title+"\n"+o+oa(this.activeRoute.properties.direction.distance)+"\n"+o+Gu(this.activeRoute.properties.direction.duration)+"\n\n"+this.languageService.translate.instant("igo.geo.directionsForm.stopsList")+":\n",c=this.languageService.translate.instant("igo.geo.directionsForm.link")+":\n"+o+this.getUrl(),u=1;this.stopsStore.view.all().forEach(function(g){var f="",m="";g.text!==Rt(g.coordinates).join(",")?(m=g.text,f=" ( ".concat(Rt(g.coordinates).join(",")," )")):m=Rt(g.coordinates).join(","),s=s+o+u.toLocaleString()+". "+m+f+"\n",u++});var p=0;return this.activeRoute.properties.direction.steps.forEach(function(g){var f=t.formatStep(g,p).instruction,m=void 0===oa(g.distance)?"":" ("+oa(g.distance)+")";r=r+o+(p+1).toLocaleString()+". "+f+m+"\n",p++}),l+s+"\n"+c+"\n\n"+r}},{key:"formatStep",value:function(t,o){return Qu(t.maneuver.type,t.maneuver.modifier,t.name,t.maneuver.bearing_after,o,t.maneuver.exit,this.languageService,o===this.activeRoute.properties.direction.steps.length-1)}},{key:"getUrl",value:function(){if(this.route){var t="";this.contextUri&&(t="context=".concat(this.contextUri,"&"));var o=this.routesFeatureStore.all().map(function(p){return p.properties.id}).indexOf(this.activeRoute.properties.id),r="";0!==o&&(r="&".concat(this.route.options.directionsOptionsKey,"=result:").concat(o));var l=this.route.options.directionsCoordKey,c=this.stopsStore.view.all().map(function(p){return Rt(p.coordinates,6)}),u="";if(c.length>=2)return u="".concat(l,"=").concat(c.join(";")),"".concat(location.origin).concat(location.pathname,"?").concat(t,"tool=directions&sidenav=1&").concat(u).concat(r)}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Ae),e.Y36(Io,8))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-directions-buttons"]],inputs:{contextUri:"contextUri",zoomToActiveRoute$:"zoomToActiveRoute$",stopsStore:"stopsStore",routesFeatureStore:"routesFeatureStore"},decls:13,vars:17,consts:[[1,"igo-form-button-group"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click"],["svgIcon","map-marker-plus"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","file-restore"],["svgIcon","magnify-plus-outline"],["svgIcon","content-copy"],["svgIcon","link"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return t.addStop()}),e.ALo(2,"translate"),e._UZ(3,"mat-icon",2),e.qZA(),e.YNc(4,jw,3,3,"button",3),e.ALo(5,"async"),e.ALo(6,"async"),e.YNc(7,Hw,3,3,"button",4),e.ALo(8,"async"),e.YNc(9,Vw,3,3,"button",4),e.ALo(10,"async"),e.YNc(11,zw,3,3,"button",4),e.ALo(12,"async"),e.qZA()),2&n&&(e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,5,"igo.geo.directionsForm.addStop")),e.xp6(3),e.Q6J("ngIf",e.lcZ(5,7,t.routesFeatureStore.count$)>=1||e.lcZ(6,9,t.stopsStore.count$)>=1),e.xp6(3),e.Q6J("ngIf",e.lcZ(8,11,t.routesFeatureStore.count$)>=1),e.xp6(2),e.Q6J("ngIf",e.lcZ(10,13,t.routesFeatureStore.count$)>=1),e.xp6(2),e.Q6J("ngIf",e.lcZ(12,15,t.routesFeatureStore.count$)>=1))},dependencies:[C.O5,O.Hw,I.lW,J.gM,C.Ov,E.X$]}),i}();function Kw(i,a){if(1&i&&(e.TgZ(0,"mat-option",9),e._uU(1),e.qZA()),2&i){var n=a.$implicit,t=a.index,o=e.oxw(3);e.Q6J("value",n),e.xp6(1),e.lnq(" Option ",t+1," : ",o.formatDistance(n.distance)," (",o.formatDuration(n.duration),") ")}}function Xw(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-form-field")(1,"mat-select",7),e.NdJ("selectionChange",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.changeRoute())})("ngModelChange",function(r){e.CHM(n);var s=e.oxw(2);return e.KtG(s.activeDirection=r)}),e.ALo(2,"translate"),e.YNc(3,Kw,2,4,"mat-option",8),e.qZA()()}if(2&i){var t=e.oxw(2);e.xp6(1),e.s9C("placeholder",e.lcZ(2,3,"igo.geo.directionsForm.drivingOptions")),e.Q6J("ngModel",t.activeDirection),e.xp6(2),e.Q6J("ngForOf",t.directions)}}function eT(i,a){1&i&&e._UZ(0,"mat-divider")}function tT(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-list-item",10),e.NdJ("mouseenter",function(){var c=e.CHM(n).$implicit,u=e.oxw(2);return e.KtG(u.showSegment(c))})("click",function(){var c=e.CHM(n).$implicit,u=e.oxw(2);return e.KtG(u.showSegment(c,!0))}),e._UZ(1,"mat-icon",11),e.TgZ(2,"h4",12),e._uU(3),e.qZA(),e.TgZ(4,"h4",13),e._uU(5),e.qZA()()}if(2&i){var t=a.$implicit,o=a.index,r=e.oxw(2);e.xp6(1),e.s9C("svgIcon",r.formatStep(t,o).image),e.Q6J("ngClass",r.formatStep(t,o).cssClass),e.xp6(2),e.AsE("",o+1,". ",r.formatStep(t,o).instruction,""),e.xp6(2),e.Oqu(r.formatDistance(t.distance))}}function nT(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",1),e.YNc(1,Xw,4,5,"mat-form-field",2),e.YNc(2,eT,1,0,"mat-divider",2),e.TgZ(3,"mat-list",3),e.NdJ("mouseleave",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.onStepsListBlur())}),e.TgZ(4,"h2",4),e._uU(5),e.qZA(),e.TgZ(6,"h2",5),e._uU(7),e.qZA(),e.YNc(8,tT,6,5,"mat-list-item",6),e._UZ(9,"mat-divider"),e.qZA()()}if(2&i){var t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.directions&&t.directions.length>1),e.xp6(1),e.Q6J("ngIf",t.directions&&0===t.directions.length),e.xp6(3),e.Oqu(t.activeDirection.title),e.xp6(2),e.AsE("",t.formatDistance(t.activeDirection.distance),", ",t.formatDuration(t.activeDirection.duration),""),e.xp6(1),e.Q6J("ngForOf",t.activeDirection.steps)}}var oT=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.languageService=n,this.cdRef=t}return(0,v.Z)(a,[{key:"ngOnInit",value:function(){var t=this;this.entities$$=this.routesFeatureStore.entities$.pipe((0,De.b)(200)).subscribe(function(o){var r=o.find(function(s){return s.properties.active});t.directions=o.map(function(s){return s.properties.direction}),t.activeDirection=r?r.properties.direction:void 0,t.cdRef.detectChanges()})}},{key:"ngOnDestroy",value:function(){this.entities$$.unsubscribe()}},{key:"changeRoute",value:function(){this.routesFeatureStore.entities$.value.map(function(t){return t.properties.active=!t.properties.active}),this.routesFeatureStore.layer.ol.getSource().getFeatures().map(function(t){return t.set("active",!t.get("active"))})}},{key:"formatDistance",value:function(t){return oa(t)}},{key:"formatDuration",value:function(t){return Gu(t)}},{key:"formatStep",value:function(t,o){return Qu(t.maneuver.type,t.maneuver.modifier,t.name,t.maneuver.bearing_after,o,t.maneuver.exit,this.languageService,o===this.activeDirection.steps.length-1)}},{key:"onStepsListBlur",value:function(){this.stepFeatureStore.clear()}},{key:"showSegment",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.showRouteSegmentGeometry(t,o)}},{key:"showRouteSegmentGeometry",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.geometry.coordinates,s="vertex",l=new dn.Z(r),c=l.transform("EPSG:4326",this.stepFeatureStore.layer.map.projection),u=c.getCoordinates(),p=u[0],d=new He.Z(p),g=new nt.Z({geometry:d}),f=(new Ee.Z).writeGeometryObject(d,{featureProjection:this.stepFeatureStore.layer.map.projection,dataProjection:this.stepFeatureStore.layer.map.projection}),m=this.stepFeatureStore.get(s),y=m?m.meta.revision:0,_={type:be,geometry:f,projection:this.stepFeatureStore.layer.map.projection,properties:{id:s,step:t,type:Bn.Vertex},meta:{id:s,revision:y+1},ol:g};this.stepFeatureStore.update(_),o&&this.stepFeatureStore.layer.map.viewController.zoomToExtent(g.getGeometry().getExtent())}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-directions-results"]],inputs:{routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore"},decls:1,vars:1,consts:[["class","igo-input-container",4,"ngIf"],[1,"igo-input-container"],[4,"ngIf"],[3,"mouseleave"],["mat-header","",1,"igo-route-title","mat-typography"],["mat-subheader",""],["class","igo-steps","igoListItem","",3,"mouseenter","click",4,"ngFor","ngForOf"],[3,"placeholder","ngModel","selectionChange","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["igoListItem","",1,"igo-steps",3,"mouseenter","click"],["mat-list-icon","",3,"ngClass","svgIcon"],["mat-line",""],["mat-line","",1,"right"]],template:function(n,t){1&n&&e.YNc(0,nT,10,6,"div",0),2&n&&e.Q6J("ngIf",t.directions&&t.activeDirection)},dependencies:[C.mk,C.sg,C.O5,S.JJ,S.On,O.Hw,X.i$,X.Tg,ie.X2,X.Nh,X.gs,Mt.d,B.KE,ie.ey,ke.gD,E.X$],styles:[".igo-input-container[_ngcontent-%COMP%]{width:100%;padding:20px 10px}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:70%}.igo-route-title[_ngcontent-%COMP%]{font-weight:700}.igo-steps[_ngcontent-%COMP%]{cursor:pointer}.mat-line[_ngcontent-%COMP%]{word-wrap:break-word!important;white-space:pre-wrap!important}.mat-line.right[_ngcontent-%COMP%]{text-align:right}.rotate-90[_ngcontent-%COMP%]{transform:rotate(90deg)}.rotate-45[_ngcontent-%COMP%]{transform:rotate(45deg)}.rotate-270[_ngcontent-%COMP%]{transform:rotate(270deg)}.rotate-250[_ngcontent-%COMP%]{transform:rotate(250deg)}.rotate-290[_ngcontent-%COMP%]{transform:rotate(290deg)}.icon-flipped[_ngcontent-%COMP%]{transform:scaleY(-1)}"]}),i}(),Hu=function(){var i=function(){function a(n,t,o,r,s){(0,h.Z)(this,a),this.cdRef=n,this.languageService=t,this.directionsService=o,this.searchService=r,this.queryService=s,this.projection="EPSG:4326",this.routesQueries$$=[],this.focusOnStop=!1,this.isTranslating=!1,this.previousStops=[],this.searchs$$=[],this.debounce=200,this.length=2,this.coordRoundedDecimals=6,this.zoomToActiveRoute$=new $e.x}return(0,v.Z)(a,[{key:"ngOnInit",value:function(){var t=this;this.queryService.queryEnabled=!1,this.initEntityStores(),setTimeout(function(){(function Iw(i,a){var n=new an({motion:ce.None});xo(i,new Je({isIgoInternalLayer:!0,id:"igo-direction-stops-layer",title:a.translate.instant("igo.geo.directionsForm.stopLayer"),zIndex:911,source:new Re,showInLayerList:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-stops-layer",links:[{syncedDelete:!0,linkedIds:["igo-direction-route-layer"],properties:[]}]},exportable:!0,browsable:!1,style:zs})),i.layer.visible=!0,Ei(i,n)})(t.stopsFeatureStore,t.languageService),function Lw(i,a){var n=new an({motion:ce.None});xo(i,new Je({isIgoInternalLayer:!0,id:"igo-direction-route-layer",title:a.translate.instant("igo.geo.directionsForm.routeLayer"),zIndex:910,source:new Re,showInLayerList:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-route-layer"},exportable:!0,browsable:!1,style:zs})),i.layer.visible=!0,Ei(i,n)}(t.routesFeatureStore,t.languageService),function Ow(i){var a=new an({motion:ce.None});xo(i,new Je({isIgoInternalLayer:!0,id:"igo-direction-step-layer",title:"",zIndex:910,source:new Re,showInLayerList:!1,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-route-layer"},exportable:!1,browsable:!1,style:zs})),i.layer.visible=!0,Ei(i,a)}(t.stepFeatureStore),t.initOlInteraction()},1)}},{key:"ngOnDestroy",value:function(){this.queryService.queryEnabled=!0,this.storeEmpty$$.unsubscribe(),this.storeChange$$.unsubscribe(),this.routesQueries$$.map(function(t){return t.unsubscribe()}),this.zoomRoute$$.unsubscribe(),this.freezeStores()}},{key:"freezeStores",value:function(){this.stopsFeatureStore.layer.map.ol.removeInteraction(this.selectStopInteraction),this.stopsFeatureStore.layer.map.ol.removeInteraction(this.translateStop),this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute),this.stopsFeatureStore.deactivateStrategyOfType(an),this.routesFeatureStore.deactivateStrategyOfType(an),this.stepFeatureStore.deactivateStrategyOfType(an)}},{key:"initEntityStores",value:function(){this.watcher=new _i(this.stopsStore,this.cdRef),this.monitorEmptyEntityStore(),this.monitorEntityStoreChange(),this.monitorActiveRouteZoom()}},{key:"monitorActiveRouteZoom",value:function(){var t=this;this.zoomRoute$$=this.zoomToActiveRoute$.subscribe(function(){if(t.routesFeatureStore.count>=1){var o=t.routesFeatureStore.all().find(function(s){return s.properties.active});if(o){o.ol.getGeometry();var r=o.ol.getGeometry().getExtent();t.routesFeatureStore.layer.map.viewController.zoomToExtent(r)}}})}},{key:"initOlInteraction",value:function(){var t=this;this.selectStopInteraction=new Xa.Z({layers:[this.stopsFeatureStore.layer.ol],hitTolerance:7,condition:function(r){return"pointermove"===r.type&&!r.dragging}}),this.translateStop=new Kl.Z({features:this.selectStopInteraction.getFeatures()}),this.translateStop.on("translating",function(o){t.isTranslating=!0,t.executeStopTranslation(o.features)}),this.translateStop.on("translateend",function(o){t.isTranslating=!1,t.executeStopTranslation(o.features)}),this.selectedRoute=new Xa.Z({layers:[this.routesFeatureStore.layer.ol],condition:dc.V4,hitTolerance:7,filter:function(r){return r.get("type")===Bn.Route&&r.get("active")&&!t.isTranslating}}),this.selectedRoute.on("select",function(o){if(!1===t.focusOnStop){var r=Rt(re.vs(o.mapBrowserEvent.coordinate,t.routesFeatureStore.layer.map.projection,t.projection),t.coordRoundedDecimals),s=Vs(t.stopsStore);s.text=r.join(","),s.coordinates=[r[0],r[1]]}}),this.stopsFeatureStore.layer.map.ol.addInteraction(this.selectStopInteraction),this.stopsFeatureStore.layer.map.ol.addInteraction(this.translateStop),this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute)}},{key:"onStopInputHasFocusChange",value:function(t){t?this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute):this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute)}},{key:"executeStopTranslation",value:function(t){if(0!==t.getLength()){var o=t.getArray()[0],r=o.getId(),s=re.vs(o.getGeometry().getCoordinates(),this.stopsFeatureStore.layer.map.projection,this.projection),l=this.stopsStore.get(r),c=Rt(s,this.coordRoundedDecimals);l.coordinates=c,l.text=c.join(","),this.stopsStore.update(l)}}},{key:"monitorEmptyEntityStore",value:function(){var t=this;this.storeEmpty$$=this.stopsStore.count$.pipe((0,lo.x)()).subscribe(function(o){if(o<2){if(Vs(t.stopsStore),2===t.stopsStore.count)return void t.stopsStore.storeInitialized$.next(!0);t.stopsStore.storeInitialized$.next(!1)}t.routesQueries$$.map(function(r){return r.unsubscribe()})})}},{key:"monitorEntityStoreChange",value:function(){var t=this;this.storeChange$$=this.stopsStore.entities$.pipe((0,De.b)(this.debounce)).subscribe(function(o){t.handleStopDiff(o),Hs(t.stopsStore),t.handleStopsFeature(),t.getRoutes(t.isTranslating)})}},{key:"cancelSearch",value:function(){this.searchs$$.map(function(t){return t.unsubscribe()})}},{key:"handleStopDiff",value:function(t){var o=this,r=t.map(function(c){return se.removeUndefined(Object.assign({id:c.id,text:c.text,coordinates:c.coordinates}))}),s=Xp.findChanges(this.previousStops,r,["coordinates"]),l=s.added.concat(s.modified);l&&l.map(function(c){var u=c.newValue;if(u){var p=o.stopsStore.get(u.id),d=p.text;if(!d||0===d.length)return;var f,g=hc(d,o.stopsFeatureStore.layer.map.projection),m=!1;g.lonLat&&(m=!0),f=o.searchService.search(d,{searchType:"Feature"}),o.cancelSearch();var y=f.map(function(_){return _.request.pipe((0,U.U)(function(b){return b.filter(function(w){return m?"Point"===w.data.geometry.type&&w.data.geometry:w.data.geometry})}))});o.searchs$$=y.map(function(_){return _.pipe((0,U.U)(function(b){return b.filter(function(w){return m?"Point"===w.data.geometry.type&&w.data.geometry:w.data.geometry})})).subscribe(function(b){if(b.length>0){var w=b[0].source,T=b[0].meta,M=b.map(function(L){return L.data});p.searchProposals||(p.searchProposals=[]),p.searchProposals=p.searchProposals.filter(function(L){return L.type===(m?Zo.Coord:Zo.Text)});var A=p.searchProposals.find(function(L){return L.source===w});A?A.results=M:p.searchProposals.push({type:m?Zo.Coord:Zo.Text,source:w,meta:T,results:M})}o.cdRef.detectChanges()})})}}),this.previousStops=r}},{key:"handleStopsFeature",value:function(){var t=this,o=this.stopsStore.all();o.filter(function(l){return l.coordinates}).map(function(l){return t.addStopOverlay(l)}),this.stopsFeatureStore.all().map(function(l){t.stopsStore.get(l.properties.id)||t.stopsFeatureStore.delete(l)}),o.filter(function(l){return!l.coordinates}).map(function(l){var c=t.stopsFeatureStore.get(l.id);c&&t.stopsFeatureStore.delete(c)})}},{key:"getRoutes",value:function(){var t=this,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.stopsStore.view.all().filter(function(u){return u.coordinates});if(r.length<2)this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());else{var s=r.map(function(u){return Rt(u.coordinates,t.coordRoundedDecimals)}),l={overview:!0,steps:!1,alternatives:!1,continue_straight:!1};this.routesQueries$$.map(function(u){return u.unsubscribe()});var c=this.directionsService.route(s,o?l:void 0);c&&c.map(function(u){return t.routesQueries$$.push(u.subscribe(function(p){t.routesFeatureStore.deleteMany(t.routesFeatureStore.all()),p.map(function(d){return Pw(t.routesFeatureStore,d,t.projection,d===p[0])})}))})}}},{key:"addStopOverlay",value:function(t){!function Dw(i,a,n,t,o){var r,s;switch(i.relativePosition){case Un.Start:r="#008000",s=o.translate.instant("igo.geo.directionsForm.start");break;case Un.End:r="#f64139",s=o.translate.instant("igo.geo.directionsForm.end");break;default:r="#ffd700",s=o.translate.instant("igo.geo.directionsForm.intermediate")+" #"+i.position}var l=new He.Z(re.vs(i.coordinates,t,n.map.projection)),c=(new Ee.Z).writeGeometryObject(l,{featureProjection:n.map.projection,dataProjection:n.map.projection}),u=n.get(i.id),d={type:be,geometry:c,projection:n.map.projection,properties:{id:i.id,type:Bn.Stop,stopText:s,stopColor:r,stopOpacity:1,stop:i},meta:{id:i.id,revision:(u?u.meta.revision:0)+1},ol:new nt.Z({geometry:l})};n.update(d)}(t,0,this.stopsFeatureStore,this.projection,this.languageService)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.sBO),e.Y36($),e.Y36(Yw),e.Y36(or),e.Y36(Cs))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-directions"]],inputs:{contextUri:"contextUri",stopsStore:"stopsStore",stopsFeatureStore:"stopsFeatureStore",routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore",debounce:"debounce",length:"length",coordRoundedDecimals:"coordRoundedDecimals",zoomToActiveRoute$:"zoomToActiveRoute$"},decls:4,vars:12,consts:[[3,"contextUri","zoomToActiveRoute$","routesFeatureStore","stopsStore"],[3,"coordRoundedDecimals","projection","stopsFeatureStore","stopsStore","debounce","length","stopInputHasFocus"],[3,"stepFeatureStore","routesFeatureStore"]],template:function(n,t){1&n&&(e._UZ(0,"igo-directions-buttons",0),e.TgZ(1,"igo-directions-inputs",1),e.NdJ("stopInputHasFocus",function(r){return t.onStopInputHasFocusChange(r)}),e.qZA(),e._UZ(2,"br")(3,"igo-directions-results",2)),2&n&&(e.Q6J("contextUri",t.contextUri)("zoomToActiveRoute$",t.zoomToActiveRoute$)("routesFeatureStore",t.routesFeatureStore)("stopsStore",t.stopsStore),e.xp6(1),e.Q6J("coordRoundedDecimals",t.coordRoundedDecimals)("projection",t.projection)("stopsFeatureStore",t.stopsFeatureStore)("stopsStore",t.stopsStore)("debounce",t.debounce)("length",t.length),e.xp6(2),e.Q6J("stepFeatureStore",t.stepFeatureStore)("routesFeatureStore",t.routesFeatureStore))},dependencies:[Qw,Ww,oT]}),i}(),Ks=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[{provide:js,useFactory:Mw,deps:[Ys]}],imports:[C.ez,Li._t,S.u5,S.UX,O.Ps,I.ot,X.ie,Mt.t,B.lN,le.c,ie.Ng,ke.LD,J.AV,_t.Bb,he]}),i}();function iT(i){return new vn(i)}var ia=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.languageService=n}return(0,v.Z)(a,[{key:"formatResult",value:function(t){return t}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG($))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i}(),aT=function(){function i(){(0,h.Z)(this,i)}return(0,v.Z)(i,[{key:"encodeKey",value:function(n){return encodeURIComponent(n)}},{key:"encodeValue",value:function(n){return encodeURIComponent(n)}},{key:"decodeKey",value:function(n){return decodeURIComponent(n)}},{key:"decodeValue",value:function(n){return decodeURIComponent(n)}}]),i}(),Vu=function(){var i=function(a){(0,N.Z)(t,a);var n=(0,q.Z)(t);function t(o,r,s,l,c,u){var p;(0,h.Z)(this,t),(p=n.call(this,l,s)).http=o,p.languageService=r,p.formatter=c,p.title$=new x.X(""),p.hashtagsLieuxToKeep=[],p.languageService.translate.get(p.options.title).subscribe(function(g){return p.title$.next(g)});var d=u.get(tt);return p.settings.length&&(d?d.authenticate$.subscribe(function(){p.getAllowedTypes()}):p.getAllowedTypes()),p}return(0,v.Z)(t,[{key:"title",get:function(){return this.title$.getValue()}},{key:"getId",value:function(){return t.id}},{key:"getType",value:function(){return t.type}},{key:"getDefaultOptions",value:function(){var r,s=this.options.params&&this.options.params.limit?Number(this.options.params.limit):void 0,l=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):void 0,c=null!==(r=this.options.params)&&void 0!==r&&r.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","codes-postaux","routes","intersections","municipalites","mrc","regadmin","lieux"];return{title:"igo.geo.search.icherche.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==c.indexOf("adresses"),hashtags:["adresse"]},{title:"igo.geo.search.icherche.type.oldAddress",value:"anciennes-adresses",enabled:-1!==c.indexOf("anciennes-adresses"),hashtags:["anciennes-adresses"]},{title:"igo.geo.search.icherche.type.postalCode",value:"codes-postaux",enabled:-1!==c.indexOf("codes-postaux"),hashtags:["code-postal"]},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==c.indexOf("routes"),hashtags:["route"]},{title:"igo.geo.search.icherche.type.intersection",value:"intersections",enabled:-1!==c.indexOf("intersections"),hashtags:["intersection","+"]},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==c.indexOf("municipalites"),hashtags:["municipalit\xe9","mun"]},{title:"igo.geo.search.icherche.type.oldCity",value:"anciennes-municipalites",enabled:-1!==c.indexOf("anciennes-municipalites"),hashtags:["anciennes-municipalites"]},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==c.indexOf("mrc"),hashtags:["mrc"]},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==c.indexOf("regadmin"),hashtags:["r\xe9gion-administrative","regadmin"]},{title:"igo.geo.search.icherche.type.entreprise",value:"entreprises",enabled:-1!==c.indexOf("entreprises"),available:!1,hashtags:["entreprise"]},{title:"igo.geo.search.icherche.type.place",value:"lieux",enabled:-1!==c.indexOf("lieux"),hashtags:["lieu"]},{title:"igo.geo.search.icherche.type.exit",value:"sorties-autoroute",enabled:-1!==c.indexOf("sorties-autoroute"),hashtags:["sortie","sorties","exit"]},{title:"igo.geo.search.icherche.type.km",value:"bornes-km",enabled:-1!==c.indexOf("bornes-km"),hashtags:["borne","bornes","rep\xe8re","km"]},{title:"igo.geo.search.icherche.type.gcc",value:"bornes-gcc",enabled:-1!==c.indexOf("bornes-gcc"),hashtags:["borne","bornes","rep\xe8re","gcc","ccg"]},{title:"igo.geo.search.icherche.type.cn",value:"bornes-cn",enabled:-1!==c.indexOf("bornes-cn"),hashtags:["borne","bornes","cn"]},{title:"igo.geo.search.icherche.type.sumi",value:"bornes-sumi",enabled:-1!==c.indexOf("bornes-sumi"),hashtags:["borne","bornes","sumi"]},{title:"igo.geo.search.icherche.type.hq",value:"hq",enabled:-1!==c.indexOf("hq"),hashtags:["hq"]},{title:"igo.geo.search.icherche.type.cadastre",value:"cadastre",enabled:-1!==c.indexOf("cadastre"),hashtags:["cadastre"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===s},{title:"5",value:5,enabled:5===s||!s},{title:"10",value:10,enabled:10===s},{title:"25",value:25,enabled:25===s},{title:"50",value:50,enabled:50===s}]},{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:10===l},{title:"30 %",value:30,enabled:30===l||!l},{title:"50 %",value:50,enabled:50===l},{title:"75 %",value:75,enabled:75===l},{title:"100 %",value:100,enabled:100===l}]},{type:"radiobutton",title:"restrictExtent",name:"loc",values:[{title:"igo.geo.search.icherche.restrictExtent.map",value:"true",enabled:!1},{title:"igo.geo.search.icherche.restrictExtent.quebec",value:"false",enabled:!0}]}]}}},{key:"search",value:function(r,s){var l=this,c=this.computeRequestParams(r,s||{});return c.get("type").length?(this.options.params.page=c.get("page")||"1",this.http.get("".concat(this.searchUrl,"/geocode"),{params:c}).pipe((0,U.U)(function(u){return l.extractResults(u,r)}),(0,Ze.K)(function(u){throw u.error.toDisplay=!0,u.error.title=l.languageService.translate.instant(l.getDefaultOptions().title),u}))):(0,ge.of)([])}},{key:"getAllowedTypes",value:function(){var r=this;return this.http.get("".concat(this.searchUrl,"/types")).subscribe(function(s){var l=r.settings.find(function(c){return"type"===c.name});l.values.forEach(function(c){var u=new RegExp("^".concat(c.value,"(\\.|$)")),p=s.filter(function(d){return u.test(d)});c.available=p.length>0,"lieux"===c.value&&(r.hashtagsLieuxToKeep=(0,Fe.Z)(new Set(p.map(function(d){return d.split(".")}).reduce(function(d,g){return d.concat(g)}).filter(function(d){return"lieux"!==d}))))}),r.setParamFromSetting(l,!1)})}},{key:"computeRequestParams",value:function(r,s){var l=Object.assign({geometry:!0,bbox:!0,icon:!0,type:"adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi"},this.params,this.computeOptionsParam(r,s||{}).params,{q:this.computeTerm(r),page:s.page});if("true"===l.loc){var c=(0,Qe.Z)(s.extent,4),u=c[0],p=c[1],d=c[2],g=c[3];l.loc="".concat(u,",").concat(p,";").concat(d,",").concat(p,";").concat(d,",").concat(g,";").concat(u,",").concat(g,";").concat(u,",").concat(p)}else"false"===l.loc&&delete l.loc;return/#[A-Za-z]+/.test(l.q)&&(l.type="lieux"),new W.LE({fromObject:se.removeUndefined(l),encoder:new aT})}},{key:"extractResults",value:function(r,s){var l=this;return r.features.map(function(c){return l.formatter.formatResult(l.dataToResult(c,s,r))})}},{key:"dataToResult",value:function(r,s,l){var c=this.computeProperties(r),u=[this.getId(),c.type,c.code].join(".");return{source:this,data:{type:be,projection:"EPSG:4326",geometry:r.geometry,extent:r.bbox,properties:c,meta:{id:u,title:r.properties.nom}},meta:{dataType:be,id:u,title:r.properties.nom,titleHtml:(r.highlight.title||r.properties.nom)+(r.highlight.title2?" <small> "+r.highlight.title2+"</small>":"")+(r.highlight.title3?"<br><small> "+r.highlight.title3+"</small>":""),icon:r.icon||"map-marker",score:r.score||ri(s.trim(),r.properties.nom),nextPage:l.features.length%+this.options.params.limit==0&&+this.options.params.page<10}}}},{key:"computeProperties",value:function(r){var s=se.removeKeys(r.properties,t.propertiesBlacklist);if(!r.geometry)return Object.assign({type:r.index},s);var c,p,l={GoogleMaps:""};if("Point"===r.geometry.type)c=ln.getGoogleMapsCoordLink(r.geometry.coordinates[0],r.geometry.coordinates[1]);else{var u=(0,ls.Z)(r.geometry);c=ln.getGoogleMapsCoordLink(u.geometry.coordinates[0],u.geometry.coordinates[1])}p=ln.getGoogleMapsNameLink("routes"===r.index?r.properties.nom+", "+r.properties.municipalite:"municipalites"===r.index?r.properties.nom+", ville":"mrc"===r.index?"mrc+"+r.properties.nom:"regadmin"===r.index?r.properties.nom+",+QC":r.properties.nom||r.highlight.title),l.GoogleMaps="<a href="+c+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByCoord")+"</a> <br /> <a href="+p+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByName")+"</a>","Point"===r.geometry.type&&(l.GoogleStreetView=ln.getGoogleStreetViewLink(r.geometry.coordinates[0],r.geometry.coordinates[1]));var d={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign({type:r.index},s,l,d)}},{key:"computeTerm",value:function(r){var s=this;return(r.match(/(#[A-Za-z]+)/g)||[]).some(function(u){var p=u.substring(1);return s.hashtagsLieuxToKeep.some(function(d){return d.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")===p.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")})})||(r=r.replace(/(#[A-Za-z]+)/g,"")),r.replace(/[^\w\xc0-\xff !\-\+\(\)\.\/\xbd\xbc\xbe,'#]+/g,"")}},{key:"computeOptionsParam",value:function(r,s){var l=(0,Se.Z)((0,we.Z)(t.prototype),"getHashtagsValid",this).call(this,r,"type");return l&&(s.params=Object.assign(s.params||{},{type:l.join(",")})),s}}]),t}(St);return i.id="icherche",i.type=be,i.propertiesBlacklist=[],i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG($),e.LFG(Te),e.LFG("options"),e.LFG(ia),e.LFG(e.zs3))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,ne.gn)([(0,$t.q)({maxCacheCount:20})],i.prototype,"search",null),i}(),zu=function(){var i=function(a){(0,N.Z)(t,a);var n=(0,q.Z)(t);function t(o,r,s,l,c){var u;(0,h.Z)(this,t),(u=n.call(this,l,s)).http=o,u.languageService=r,u.title$=new x.X(""),u.languageService.translate.get(u.options.title).subscribe(function(d){return u.title$.next(d)});var p=c.get(tt);return u.settings.length&&(p?p.authenticate$.subscribe(function(){u.getAllowedTypes()}):u.getAllowedTypes()),u}return(0,v.Z)(t,[{key:"title",get:function(){return this.title$.getValue()}},{key:"getId",value:function(){return t.id}},{key:"getType",value:function(){return t.type}},{key:"getDefaultOptions",value:function(){var r=this.options.params&&this.options.params.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","municipalites","mrc","regadmin"];return{title:"igo.geo.search.ichercheReverse.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==r.indexOf("adresses")},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==r.indexOf("routes"),available:!1},{title:"igo.geo.search.icherche.type.district",value:"arrondissements",enabled:-1!==r.indexOf("arrondissements")},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==r.indexOf("municipalites")},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==r.indexOf("mrc")},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==r.indexOf("regadmin")}]},{type:"radiobutton",title:"radius",name:"bufferInput",values:[{title:"100 m",value:100,enabled:!this.options.distance||100===this.options.distance},{title:"500 m",value:500,enabled:500===this.options.distance},{title:"1 km",value:1e3,enabled:1e3===this.options.distance},{title:"2 km",value:2e3,enabled:2e3===this.options.distance},{title:"5 km",value:5e3,enabled:5e3===this.options.distance}]}]}}},{key:"reverseSearch",value:function(r,s){var l=this,c=this.computeRequestParams(r,s||{});return c.get("type").length?this.http.get("".concat(this.searchUrl,"/locate"),{params:c}).pipe((0,U.U)(function(u){return l.extractResults(u)})):(0,ge.of)([])}},{key:"getAllowedTypes",value:function(){var r=this;return this.http.get("".concat(this.searchUrl,"/types")).subscribe(function(s){var l=r.settings.find(function(c){return"type"===c.name});l.values.forEach(function(c){c.available=s.indexOf(c.value)>-1}),r.setParamFromSetting(l,!1)})}},{key:"computeRequestParams",value:function(r,s){return(s.distance||this.options.distance)&&(s.params=Object.assign(s.params||{},{bufferInput:s.distance||this.options.distance})),new W.LE({fromObject:Object.assign({loc:r.join(","),sort:"distance",geometry:!0,icon:!0},s.params||{},this.params)})}},{key:"extractResults",value:function(r){var s=this;return r.features.map(function(l){return s.dataToResult(l)})}},{key:"getSubtitle",value:function(r){if(!this.settings.length)return"";var s="";if("arrondissements"===r.properties.type)s=r.properties.municipalite+" (Arrondissement)";else{var c=this.settings.find(function(u){return"type"===u.name}).values.find(function(u){return u.value===r.properties.type});c&&(s=this.languageService.translate.instant(c.title))}return s}},{key:"dataToResult",value:function(r){var s=this.computeProperties(r),l=this.computeExtent(r),c=[this.getId(),s.type,s.code].join("."),u=r.properties.nom,p=" <small> "+this.getSubtitle(r)+"</small>";return{source:this,data:{type:be,projection:"EPSG:4326",geometry:r.geometry,extent:l,properties:s,meta:{id:c,title:r.properties.nom}},meta:{dataType:be,id:c,title:r.properties.nom,titleHtml:u+p,icon:r.icon||"map-marker",pointerSummaryTitle:this.getSubtitle(r)+": "+r.properties.nom}}}},{key:"computeProperties",value:function(r){var s=se.removeKeys(r.properties,t.propertiesBlacklist),l={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign(s,l)}},{key:"computeExtent",value:function(r){return r.bbox?[r.bbox[0],r.bbox[2],r.bbox[1],r.bbox[3]]:void 0}}]),t}(St);return i.id="icherchereverse",i.type=be,i.propertiesBlacklist=[],i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG($),e.LFG(Te),e.LFG("options"),e.LFG(e.zs3))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,ne.gn)([(0,$t.q)({maxCacheCount:20})],i.prototype,"reverseSearch",null),i}();function sT(i){return new ia(i)}function cT(i,a,n,t,o,r){return new Vu(i,a,n,t.getConfig("searchSources.".concat(Vu.id)),o,r)}function pT(i,a,n,t,o){return new zu(i,a,n,t.getConfig("searchSources.".concat(zu.id)),o)}var Wu=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.languageService=n}return(0,v.Z)(a,[{key:"formatResult",value:function(t){return t}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG($))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i}(),Ku=function(){var i=function(a){(0,N.Z)(t,a);var n=(0,q.Z)(t);function t(o,r,s,l){var c;return(0,h.Z)(this,t),(c=n.call(this,o,s)).languageService=r,c.title$=new x.X(""),c.projections=l,c.languageService.translate.get(c.options.title).subscribe(function(u){return c.title$.next(u)}),c}return(0,v.Z)(t,[{key:"title",get:function(){return this.title$.getValue()}},{key:"getId",value:function(){return t.id}},{key:"getType",value:function(){return t.type}},{key:"getDefaultOptions",value:function(){return{title:"igo.geo.search.coordinates.name",order:1,showInSettings:!1}}},{key:"reverseSearch",value:function(r,s){return(0,ge.of)([this.dataToResult(r,s)])}},{key:"dataToResult",value:function(r,s){var l=function Ev(i){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=[];return i.forEach(function(t){var o=t<0?Math.ceil(t):Math.floor(t),r=t<0?60*(o-t):60*(t-o),s=Math.floor(r),l=(60*(r-s)).toFixed(a);n.push("".concat(o,"\xb0 ").concat(s,"' ").concat(l,'"'))}),n}(r),u=function Jv(i,a){var n=re.vs(i,"EPSG:4326","EPSG:3857"),t=[{code:"EPSG:3857",alias:"Web Mercator",coord:n,igo2CoordFormat:"".concat(Rt(n).join(", ")," ; 3857")}],o=function Bv(i){return Math.ceil((i[0]+180)/6)}(i),r=o<10?"EPSG:3260".concat(o):"EPSG:326".concat(o),s="UTM-".concat(o),l=re.vs(i,"EPSG:4326",r);t.push({code:r,alias:"UTM",coord:l,igo2CoordFormat:"".concat(s," ").concat(Rt(l).join(", "))});var c=function Uv(i){var n,a=i[0];return a<-51&&a>-54&&(n=1),a<-54&&a>-57&&(n=2),a<-57&&a>-60&&(n=3),a<-60&&a>-63&&(n=4),a<-63&&a>-66&&(n=5),a<-66&&a>-69&&(n=6),a<-69&&a>-72&&(n=7),a<-72&&a>-75&&(n=8),a<-75&&a>-78&&(n=9),a<-78&&a>-81&&(n=10),n}(i);if(c){var u=c<10?"EPSG:3218".concat(c):"EPSG:321".concat(80+c),p="MTM-".concat(c),d=re.vs(i,"EPSG:4326",u);t.push({code:u,alias:"MTM",coord:d,igo2CoordFormat:"".concat(p," ").concat(Rt(d).join(", "))})}return a.forEach(function(g){var f=re.vs(i,"EPSG:4326",g.code),m=g.code.split(":")[1];t.push({code:g.code,alias:g.alias||g.code,coord:f,igo2CoordFormat:"".concat(Rt(f).join(", ")," ; ").concat(m)})}),t}(r,this.projections).reduce(function(Z,R){return Z[R.alias]=R.igo2CoordFormat,Z},{}),p=Rt(r,6).join(", "),d=l.join(", "),g={type:"Point",coordinates:[r[0],r[1]]},f={},m="";if(s.distance){f[this.languageService.translate.instant("igo.geo.search.coordinates.radius")]=s.distance,m="<br><small>Rayon: "+s.distance+" m</small>";var _=re.vs([r[0],r[1]],"EPSG:4326","EPSG:3857"),b=new Zi.Z(_,s.distance),w=(0,Tn.Bb)(b),T=new Ee.Z;g=JSON.parse(T.writeGeometry(w.transform("EPSG:3857","EPSG:4326")))}return s.conf&&(f[this.languageService.translate.instant("igo.geo.search.coordinates.conf")]=s.conf,m+=""===m?"<br>":"<small> - </small>",m+="<small>Confiance: "+s.conf+"%</small>"),f[this.languageService.translate.instant("igo.geo.search.coordinates.coord")]=p,f[this.languageService.translate.instant("igo.geo.search.coordinates.coordDMS")]=d,{source:this,data:{type:be,projection:"EPSG:4326",geometry:g,extent:void 0,properties:Object.assign(f,u,{GoogleMaps:ln.getGoogleMapsCoordLink(r[0],r[1]),GoogleStreetView:ln.getGoogleStreetViewLink(r[0],r[1]),OpenStreetMap:Uy.getOpenStreetMapLink(r[0],r[1],14),Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"}),meta:{id:r[0].toString()+","+r[1].toString(),title:p}},meta:{dataType:be,id:r[0].toString()+","+r[1].toString(),title:p,titleHtml:p+m,icon:"map-marker",score:100}}}}]),t}(St);return i.id="coordinatesreverse",i.type=be,i.\u0275fac=function(n){return new(n||i)(e.LFG("options"),e.LFG($),e.LFG(Te),e.LFG("projections"))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,ne.gn)([(0,$t.q)({maxCacheCount:20})],i.prototype,"reverseSearch",null),i}();function gT(i){return new Wu(i)}function mT(i,a,n,t){return new Ku(i.getConfig("searchSources.".concat(Ku.id)),a,n,i.getConfig("projections")||[])}var ra=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.languageService=n}return(0,v.Z)(a,[{key:"formatResult",value:function(t){var o=this,r=["title","abstract","groupTitle","metadataUrl","downloadUrl","urlInfo","name"],s=Object.entries(t.properties).filter(function(c){var u=(0,Qe.Z)(c,1);return-1!==r.indexOf(u[0])}).reduce(function(c,u){var f,p=(0,Qe.Z)(u,2),d=p[0],g=p[1];try{f=o.languageService.translate.instant("igo.geo.search.ilayer.properties."+d)}catch(m){f=d}return c[f]=g||"",c},{}),l=Object.assign({},t);return l.properties=s,l}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG($))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i}(),Xu=function(){var i=function(a){(0,N.Z)(t,a);var n=(0,q.Z)(t);function t(o,r,s,l,c){var u;return(0,h.Z)(this,t),(u=n.call(this,l,s)).http=o,u.languageService=r,u.formatter=c,u.title$=new x.X(""),u.languageService.translate.get(u.options.title).subscribe(function(p){return u.title$.next(p)}),u}return(0,v.Z)(t,[{key:"title",get:function(){return this.title$.getValue()}},{key:"getId",value:function(){return t.id}},{key:"getType",value:function(){return t.type}},{key:"getDefaultOptions",value:function(){var r=this.options.params&&this.options.params.limit?Number(this.options.params.limit):void 0,s=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):void 0;return{title:"igo.geo.search.ilayer.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.ilayer.type.layer",value:"layer",enabled:!0,hashtags:["layer","layers","couche","couches"]},{title:"igo.geo.search.ilayer.type.groupLayer",value:"group",enabled:!1,hashtags:["gr-layer","gr-layers","gr-couche","gr-couches"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===r},{title:"5",value:5,enabled:5===r||!r},{title:"10",value:10,enabled:10===r},{title:"25",value:25,enabled:25===r},{title:"50",value:50,enabled:50===r}]},{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:10===s},{title:"30 %",value:30,enabled:30===s},{title:"50 %",value:50,enabled:50===s||!s},{title:"75 %",value:75,enabled:75===s},{title:"100 %",value:100,enabled:100===s}]}]}}},{key:"search",value:function(r,s){var l=this,c=this.computeSearchRequestParams(r,s||{});return c.get("q")&&c.get("type")?(this.options.params.page=c.get("page")||"1",this.http.get(this.searchUrl,{params:c}).pipe((0,U.U)(function(u){return l.extractResults(u,r)}))):(0,ge.of)([])}},{key:"computeSearchRequestParams",value:function(r,s){return new W.LE({fromObject:se.removeUndefined(Object.assign({q:this.computeTerm(r)},this.params,this.computeOptionsParam(r,s||{}).params,{page:s.page}))})}},{key:"computeTerm",value:function(r){return r.replace(/(#[^\s]*)/g,"").replace(/[^\w\xc0-\xff !\-\(\),'#]+/g,"")}},{key:"computeOptionsParam",value:function(r,s){var l=(0,Se.Z)((0,we.Z)(t.prototype),"getHashtagsValid",this).call(this,r,"type");return l&&(s.params=Object.assign(s.params||{},{type:l.join(",")})),s}},{key:"extractResults",value:function(r,s){var l=this;return r.items.map(function(c){return l.dataToResult(c,s,r)})}},{key:"dataToResult",value:function(r,s,l){var c=this.computeLayerOptions(r),u=r.highlight.title||r.properties.title,p=r.highlight.groupTitle||r.properties.groupTitle,d=p?' <small style="color: #6f6969"> '+p+"</small>":"";return{source:this,meta:{dataType:Vi,id:[this.getId(),r.properties.id].join("."),title:r.properties.title,titleHtml:u+d,icon:"Layer"===r.properties.type?"layers":"map",score:r.score||ri(s.trim(),r.properties.name),nextPage:l.items.length%+this.options.params.limit==0&&+this.options.params.page<10},data:c}}},{key:"computeLayerOptions",value:function(r){var s=r.properties.url,l=this.extractQueryParamsFromSourceUrl(s);return se.removeUndefined({sourceOptions:{id:r.properties.id,type:r.properties.format,url:s,queryFormat:l.queryFormat,queryHtmlTarget:l.queryHtmlTarget,params:"wms"===r.properties.format?{LAYERS:r.properties.name}:void 0,layer:"wms"===r.properties.format?void 0:r.properties.name,optionsFromCapabilities:!0,crossOrigin:"anonymous"},title:r.properties.title,maxResolution:Zt(Number(r.properties.maxScaleDenom)),minResolution:Zt(Number(r.properties.minScaleDenom)),metadata:{url:r.properties.metadataUrl,extern:!!r.properties.metadataUrl||void 0,abstract:r.properties.abstract||void 0},properties:this.formatter.formatResult(r).properties})}},{key:"extractQueryParamsFromSourceUrl",value:function(r){var s,l,c=this.options.queryFormat;if(c){for(var u=function(){var m=d[p],y=c[m];if("*"===y)return s=Xe[m.toUpperCase()],"break";var _=y.urls;return Array.isArray(_)?(_.forEach(function(b){-1!==r.indexOf(b)&&(s=Xe[m.toUpperCase()])}),"break"):void 0},p=0,d=Object.keys(c);p<d.length&&"break"!==u();p++);(s===Xe.HTML||s===Xe.HTMLGML2)&&(l="iframe")}return{queryFormat:s,queryHtmlTarget:l}}}]),t}(St);return i.id="ilayer",i.type=Vi,i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG($),e.LFG(Te),e.LFG("options"),e.LFG(ra))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,ne.gn)([(0,$t.q)({maxCacheCount:20})],i.prototype,"search",null),i}();function vT(i){return new ra(i)}function _T(i,a,n,t,o){return new Xu(i,a,n,t.getConfig("searchSources.".concat(Xu.id)),o)}var ep=[be,Vi];function CT(i,a){if(1&i&&(e.TgZ(0,"mat-radio-button",7),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){var n=a.$implicit,t=e.oxw();e.Q6J("value",n),e.xp6(1),e.hij(" ",e.lcZ(2,2,t.getSearchTypeTitle(n))," ")}}var ST=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.searchSourceService=n,this.searchType$=new x.X(void 0),this.searchTypes=ep,this.searchTypeChange=new e.vpe}return(0,v.Z)(a,[{key:"searchType",get:function(){return this.searchType$.value},set:function(t){this.setSearchType(t)}},{key:"ngOnInit",value:function(){var t=this;this.searchType$$=this.searchType$.pipe((0,lo.x)()).subscribe(function(o){return t.onSetSearchType(o)})}},{key:"ngOnDestroy",value:function(){this.searchType$$.unsubscribe()}},{key:"onSearchTypeChange",value:function(t){this.setSearchType(t)}},{key:"getSearchTypeTitle",value:function(t){return"igo.geo.search.".concat(t.toLowerCase(),".title")}},{key:"setSearchType",value:function(t){this.searchType$.next(t)}},{key:"onSetSearchType",value:function(t){null!=t&&(this.searchSourceService.enableSourcesByType(t),this.searchTypeChange.emit(t))}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(vn))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-search-selector"]],inputs:{searchTypes:"searchTypes",searchType:"searchType"},outputs:{searchTypeChange:"searchTypeChange"},decls:9,vars:8,consts:[[1,"igo-search-selector"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"igo-search-selector-button",3,"matTooltip","matMenuTriggerFor"],["svgIcon","menu-down"],["xPosition","before","yPosition","above",1,"no-border-radius"],["searchSelectorMenu","matMenu"],[1,"igo-search-selector-radio-group",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(n,t){if(1&n&&(e.TgZ(0,"div",0)(1,"button",1),e.ALo(2,"translate"),e._UZ(3,"mat-icon",2),e.qZA(),e.TgZ(4,"mat-menu",3,4)(6,"mat-radio-group",5),e.NdJ("change",function(s){return t.onSearchTypeChange(s.value)}),e.ALo(7,"async"),e.YNc(8,CT,3,4,"mat-radio-button",6),e.qZA()()()),2&n){var o=e.MAs(5);e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,4,"igo.geo.search.menu.tooltip"))("matMenuTriggerFor",o),e.xp6(5),e.Q6J("value",e.lcZ(7,6,t.searchType$)),e.xp6(2),e.Q6J("ngForOf",t.searchTypes)}},dependencies:[C.sg,J.gM,O.Hw,I.lW,Ve.VK,Ve.p6,Ft.VQ,Ft.U0,C.Ov,E.X$],styles:[".igo-search-selector-button[_ngcontent-%COMP%]     div.mat-button-ripple-round{border-radius:0}.igo-search-selector-radio-group[_ngcontent-%COMP%]{display:inline-flex;flex-direction:column}.igo-search-selector-radio-group[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin:5px}"],changeDetection:0}),i}(),Xs=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,J.AV,O.Ps,I.ot,Ve.Tx,Ft.Fk,Ot.Nh,pt.p9,he]}),i}();function wT(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",8)(1,"button",9),e.NdJ("click",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.checkUncheckAllSources(r))}),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.qZA()()}if(2&i){var t=e.oxw();e.xp6(2),e.Oqu(t.searchSourcesAllEnabled?e.lcZ(4,3,"igo.geo.search.searchSources.selectAll"):e.lcZ(3,1,"igo.geo.search.searchSources.unselectAll"))}}function TT(i,a){if(1&i&&(e.TgZ(0,"button",15),e._uU(1),e.qZA()),2&i){var n=e.oxw().$implicit,t=e.MAs(6);e.Q6J("matMenuTriggerFor",t),e.xp6(1),e.hij("",n.title," ")}}function xT(i,a){if(1&i&&(e.TgZ(0,"button",16),e._uU(1),e.qZA()),2&i){var n=e.oxw().$implicit;e.xp6(1),e.hij(" ",n.title," ")}}function kT(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-radio-button",22),e.NdJ("click",function(s){return s.stopPropagation()})("change",function(s){var c=e.CHM(n).$implicit,u=e.oxw(2).$implicit,p=e.oxw().$implicit,d=e.oxw();return e.KtG(d.settingsValueCheckedRadioButton(s,p,u,c))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw(4);e.Q6J("value",t)("matTooltip",o.getAvailableHashtagsValues(t))("checked",t.enabled),e.xp6(1),e.hij(" ",e.lcZ(2,4,t.title)," ")}}function MT(i,a){if(1&i&&(e.TgZ(0,"span")(1,"mat-radio-group",20),e.YNc(2,kT,3,6,"mat-radio-button",21),e.qZA()()),2&i){var n=e.oxw().$implicit;e.xp6(1),e.Q6J("value",n),e.xp6(1),e.Q6J("ngForOf",n.values)}}function FT(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",8)(1,"button",9),e.NdJ("click",function(r){e.CHM(n);var s=e.oxw(2).$implicit,l=e.oxw().$implicit,c=e.oxw();return e.KtG(c.checkUncheckAll(r,l,s))}),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.qZA()()}if(2&i){var t=e.oxw(2).$implicit;e.xp6(2),e.Oqu(t.allEnabled||void 0===t.allEnabled?e.lcZ(3,1,"igo.geo.search.searchSources.settings.unselectAll"):e.lcZ(4,3,"igo.geo.search.searchSources.settings.selectAll"))}}function ZT(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-checkbox",24),e.NdJ("click",function(l){return l.stopPropagation()})("change",function(l){var u=e.CHM(n).$implicit,p=e.oxw(2).$implicit,d=e.oxw().$implicit,g=e.oxw();return e.KtG(g.settingsValueCheckedCheckbox(l,d,p,u))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw(2).$implicit,r=e.oxw(2);e.Udp("display",r.displayBlock),e.Q6J("checked",t.enabled)("value",o)("matTooltip",r.getAvailableHashtagsValues(t)),e.xp6(1),e.hij(" ",e.lcZ(2,6,t.title)," ")}}function AT(i,a){if(1&i&&(e.TgZ(0,"span"),e.YNc(1,FT,5,5,"div",5),e.YNc(2,ZT,3,8,"mat-checkbox",23),e.qZA()),2&i){var n=e.oxw().$implicit,t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",n.values.length>3),e.xp6(1),e.Q6J("ngForOf",t.getAvailableValues(n))}}function IT(i,a){if(1&i&&(e.ynx(0),e.TgZ(1,"button",15),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-menu",17,18),e.YNc(6,MT,3,2,"span",19),e.YNc(7,AT,3,2,"span",19),e.qZA(),e.BQk()),2&i){var n=a.$implicit,t=e.MAs(5);e.xp6(1),e.Q6J("matMenuTriggerFor",t),e.xp6(1),e.hij(" ",e.lcZ(3,5,"igo.geo.search.searchSources.settings."+n.title)," "),e.xp6(2),e.Q6J("ngSwitch",n.type),e.xp6(2),e.Q6J("ngSwitchCase","radiobutton"),e.xp6(1),e.Q6J("ngSwitchCase","checkbox")}}function LT(i,a){if(1&i){var n=e.EpF();e.ynx(0),e.TgZ(1,"span",10)(2,"mat-checkbox",11),e.NdJ("click",function(r){return r.stopPropagation()})("change",function(r){var l=e.CHM(n).$implicit,c=e.oxw();return e.KtG(c.onCheckSearchSource(r,l))}),e.qZA(),e.YNc(3,TT,2,2,"button",12),e.YNc(4,xT,2,1,"button",13),e.qZA(),e.TgZ(5,"mat-menu",null,14),e.YNc(7,IT,8,7,"ng-container",6),e.qZA(),e.BQk()}if(2&i){var t=a.$implicit;e.xp6(2),e.Q6J("checked",t.enabled)("value",t),e.xp6(1),e.Q6J("ngIf",t.settings.length>0),e.xp6(1),e.Q6J("ngIf",0===t.settings.length),e.xp6(3),e.Q6J("ngForOf",t.settings)}}function OT(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"span"),e._UZ(1,"mat-divider"),e.TgZ(2,"span",25)(3,"mat-slide-toggle",26),e.NdJ("change",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.changePointerReverseSearch(r))})("click",function(r){return r.stopPropagation()}),e.ALo(4,"translate"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"mat-slide-toggle",26),e.NdJ("change",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.changeSearchResultsGeometry(r))})("click",function(r){return r.stopPropagation()}),e.ALo(8,"translate"),e._uU(9),e.ALo(10,"translate"),e.qZA()()()}if(2&i){var t=e.oxw();e.xp6(3),e.Q6J("matTooltip",e.lcZ(4,8,"igo.geo.search.pointerSearchSummary.tooltip"))("checked",t.pointerSummaryEnabled)("labelPosition","after"),e.xp6(2),e.hij(" ",e.lcZ(6,10,"igo.geo.search.pointerSearchSummary.title")," "),e.xp6(2),e.Q6J("matTooltip",e.lcZ(8,12,"igo.geo.search.searchResultsGeometry.tooltip"))("checked",t.searchResultsGeometryEnabled)("labelPosition","after"),e.xp6(2),e.hij(" ",e.lcZ(10,14,"igo.geo.search.searchResultsGeometry.title")," ")}}var DT=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.searchSourceService=n,this.mediaService=t,this.storageService=o,this.hasPointerReverseSearchSource=!1,this.searchSourcesAllEnabled=!1,this.buffer=[],this.lastKeyTime=Date.now(),this.displayBlock="block",this.pointerSummaryEnabled=!1,this.searchResultsGeometryEnabled=!1,this.searchSourceChange=new e.vpe,this.pointerSummaryStatus=new e.vpe,this.searchResultsGeometryStatus=new e.vpe}return(0,v.Z)(a,[{key:"isTouchScreen",get:function(){return this.mediaService.isTouchScreen()}},{key:"handleKeyboardEvent",value:function(t){"F2"===t.key&&(this.pointerSummaryEnabled=!this.pointerSummaryEnabled,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled))}},{key:"ngOnInit",value:function(){this.hasPointerReverseSearchSource=this.hasReverseSearchSourcesForPointerSummary()}},{key:"getSearchSources",value:function(){var t=this.searchSourceService.getSources().filter(nr).filter(function(s){return s.available&&"map"!==s.getId()&&s.showInSettings}),o=this.searchSourceService.getSources().filter(Yu).filter(function(s){return s.available&&"map"!==s.getId()&&s.showInSettings}),r=t.concat(o);return this.computeSourcesCheckAllBehavior(r),r}},{key:"hasReverseSearchSourcesForPointerSummary",value:function(){return!!this.searchSourceService.getEnabledSources().filter(Ws).length}},{key:"settingsValueCheckedCheckbox",value:function(t,o,r,s){s.enabled=t.checked,o.setParamFromSetting(r),this.searchSourceChange.emit(o)}},{key:"computeSettingCheckAllBehavior",value:function(t){t.allEnabled=void 0===t.allEnabled?!t.values.find(function(o){return o.enabled}):!t.allEnabled}},{key:"computeSourcesCheckAllBehavior",value:function(t){var o=t.filter(function(s){return s.enabled}).length,r=t.filter(function(s){return!s.enabled}).length;this.searchSourcesAllEnabled=!(o>=r)}},{key:"checkUncheckAll",value:function(t,o,r){t.stopPropagation(),this.computeSettingCheckAllBehavior(r),r.values.forEach(function(s){s.enabled=r.allEnabled}),o.setParamFromSetting(r),this.searchSourceChange.emit(o)}},{key:"checkUncheckAllSources",value:function(t){var o=this;t.stopPropagation(),this.getSearchSources().map(function(r){r.enabled=o.searchSourcesAllEnabled,o.searchSourceChange.emit(r)})}},{key:"settingsValueCheckedRadioButton",value:function(t,o,r,s){r.values.forEach(function(l){l.enabled=l.value!==s.value?!t.source.checked:t.source.checked}),o.setParamFromSetting(r),this.searchSourceChange.emit(o)}},{key:"onCheckSearchSource",value:function(t,o){o.enabled=t.checked;var r=this.storageService.get(o.getId()+".options")||{};r.enabled=o.enabled,this.storageService.set(o.getId()+".options",r),this.searchSourceChange.emit(o)}},{key:"getAvailableValues",value:function(t){return t.values.filter(function(o){return!1!==o.available})}},{key:"getAvailableHashtagsValues",value:function(t){if(t.hashtags)return t.hashtags.map(function(o){return"#"+o}).join(", ")}},{key:"stopPropagation",value:function(t){t.stopPropagation()}},{key:"changePointerReverseSearch",value:function(t){this.pointerSummaryEnabled=t.checked,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled)}},{key:"changeSearchResultsGeometry",value:function(t){this.searchResultsGeometryEnabled=t.checked,this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(vn),e.Y36(xt),e.Y36(Te))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-search-settings"]],hostBindings:function(n,t){1&n&&e.NdJ("keydown",function(r){return t.handleKeyboardEvent(r)},!1,e.evT)},inputs:{pointerSummaryEnabled:"pointerSummaryEnabled",searchResultsGeometryEnabled:"searchResultsGeometryEnabled"},outputs:{searchSourceChange:"searchSourceChange",pointerSummaryStatus:"pointerSummaryStatus",searchResultsGeometryStatus:"searchResultsGeometryStatus"},decls:9,vars:7,consts:[[1,"igo-search-settings"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"igo-search-settings-button",3,"matTooltip","matMenuTriggerFor"],["svgIcon","chevron-down"],[1,"no-border-radius"],["searchSettingsMenu","matMenu"],["class","checkAllButton",4,"ngIf"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"checkAllButton"],["mat-raised-button","",3,"click"],[1,"igo-search-settings-search-source"],[1,"igo-search-settings-checkbox",3,"checked","value","click","change"],["mat-menu-item","",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",4,"ngIf"],["sub_menu","matMenu"],["mat-menu-item","",3,"matMenuTriggerFor"],["mat-menu-item",""],["yPosition","above",3,"ngSwitch"],["test_sub_menu","matMenu"],[4,"ngSwitchCase"],[1,"igo-search-settings-radio-group",3,"value"],["class","mat-typography",3,"value","matTooltip","checked","click","change",4,"ngFor","ngForOf"],[1,"mat-typography",3,"value","matTooltip","checked","click","change"],["class","mat-menu-item",3,"display","checked","value","matTooltip","click","change",4,"ngFor","ngForOf"],[1,"mat-menu-item",3,"checked","value","matTooltip","click","change"],[1,"pointer-summary-slide-toggle-container","mat-typography"],["tooltip-position","below","matTooltipShowDelay","500",1,"pointer-summary-option",3,"matTooltip","checked","labelPosition","change","click"]],template:function(n,t){if(1&n&&(e.TgZ(0,"div",0)(1,"button",1),e.ALo(2,"translate"),e._UZ(3,"mat-icon",2),e.qZA(),e.TgZ(4,"mat-menu",3,4),e.YNc(6,wT,5,5,"div",5),e.YNc(7,LT,8,5,"ng-container",6),e.YNc(8,OT,11,16,"span",7),e.qZA()()),2&n){var o=e.MAs(5);e.xp6(1),e.Q6J("matTooltip",e.lcZ(2,5,"igo.geo.search.menu.tooltip"))("matMenuTriggerFor",o),e.xp6(5),e.Q6J("ngIf",t.getSearchSources().length>4),e.xp6(1),e.Q6J("ngForOf",t.getSearchSources()),e.xp6(1),e.Q6J("ngIf",t.hasPointerReverseSearchSource&&!t.isTouchScreen)}},dependencies:[C.sg,C.O5,C.RF,C.n9,J.gM,O.Hw,I.lW,Ve.VK,Ve.OP,Ve.p6,Ft.VQ,Ft.U0,pt.oG,Mt.d,ht.Rr,E.X$],styles:[".checkAllButton[_ngcontent-%COMP%]{text-align:center;padding:0 5px}.igo-search-settings-button[_ngcontent-%COMP%]     div.mat-button-ripple-round{border-radius:0}.igo-search-settings-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.igo-search-settings-radio-group[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin:5px}.igo-search-settings-checkbox[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{display:flex}.igo-search-settings-search-source[_ngcontent-%COMP%]{display:flex;width:100%}.igo-search-settings-search-source[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{display:flex;margin-left:5px;margin-right:5px}.pointer-summary-option[_ngcontent-%COMP%]{display:block;margin-right:10px;margin-bottom:15px}.pointer-summary-slide-toggle-container[_ngcontent-%COMP%]{overflow-x:hidden}.pointer-summary-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{margin:10px}"],changeDetection:0}),i}(),el=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,J.AV,O.Ps,I.ot,Ve.Tx,Ft.Fk,pt.p9,Mt.t,ht.rP,he]}),i}(),PT=["input"];function ET(i,a){if(1&i&&(e.TgZ(0,"mat-label"),e._uU(1),e.qZA()),2&i){var n=e.oxw();e.xp6(1),e.Oqu(n.label)}}function $T(i,a){if(1&i&&(e.TgZ(0,"button",10),e._UZ(1,"mat-icon",11),e.qZA()),2&i){var n=e.oxw();e.Q6J("color",n.color),e.xp6(1),e.s9C("svgIcon",n.searchIcon)}}function RT(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.onClearButtonClick())}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",13),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("color",t.color)("matTooltip",e.lcZ(1,2,"igo.geo.search.clearSearch"))}}function JT(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-search-selector",14),e.NdJ("searchTypeChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.onSearchTypeChange(r))}),e.ALo(1,"async"),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("searchTypes",t.searchTypes)("searchType",e.lcZ(1,2,t.searchType$))}}function BT(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-search-settings",15),e.NdJ("pointerSummaryStatus",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.pointerSummaryStatus.emit(r))})("searchResultsGeometryStatus",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.searchResultsGeometryStatus.emit(r))})("searchSourceChange",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.onSearchSettingsChange())}),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("pointerSummaryEnabled",t.pointerSummaryEnabled)("searchResultsGeometryEnabled",t.searchResultsGeometryEnabled)}}var UT=function(a){return{empty:a}},NT=function(a){return{hasSearchIcon:a}},tl=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.languageService=n,this.searchService=t,this.searchSourceService=o,this.placeholder$=new x.X("igo.geo.search.placeholder"),this.empty$=new x.X(!0),this.stream$=new x.X(""),this.searchTypes=ep,this.searchType$=new x.X(void 0),this.pointerSummaryStatus=new e.vpe,this.searchResultsGeometryStatus=new e.vpe,this.term$=new x.X(""),this.disabled$=new x.X(!1),this.pointerSummaryEnabled=!1,this.searchResultsGeometryEnabled=!1,this.floatLabel="never",this.appearance="legacy",this.color="primary",this.termSplitter="|",this.debounce=200,this.minLength=2,this.searchSelector=!1,this.searchSettings=!1,this.forceNA=!1,this.searchTermChange=new e.vpe,this.search=new e.vpe,this.searchTypeChange=new e.vpe,this.clearFeature=new e.vpe,this.searchSettingsChange=new e.vpe}return(0,v.Z)(a,[{key:"searchType",get:function(){return this.searchType$.value},set:function(t){this.setSearchType(t)}},{key:"term",get:function(){return this.term$.value},set:function(t){this.setTerm(t)}},{key:"disabled",get:function(){return this.disabled$.value},set:function(t){this.disabled$.next(t)}},{key:"empty",get:function(){return 0===this.term.length}},{key:"ngOnInit",value:function(){var t=this;this.term$$=this.term$.subscribe(function(o){t.empty$.next(void 0===o||0===o.length)}),this.stream$$=this.stream$.pipe((0,xi.D)(function(o){return""===o?_o.E:(0,Ti.H)(t.debounce)})).subscribe(function(o){return t.onSetTerm(o)}),this.handlePlaceholder(),this.searchType$$=this.searchType$.pipe((0,lo.x)()).subscribe(function(o){return t.onSetSearchType(o)})}},{key:"ngOnDestroy",value:function(){this.term$$.unsubscribe(),this.stream$$.unsubscribe(),this.searchType$$.unsubscribe()}},{key:"onKeyup",value:function(t){this.keyIsValid(t.key)&&this.setTerm(t.target.value)}},{key:"onClearButtonClick",value:function(){this.clear(),this.clearFeature.emit()}},{key:"onSearchTypeChange",value:function(t){this.setSearchType(t)}},{key:"setSearchType",value:function(t){this.searchType$.next(t)}},{key:"onSearchSettingsChange",value:function(){this.doSearch(this.term),this.searchSettingsChange.emit(),this.handlePlaceholder()}},{key:"setTerm",value:function(t){if(!this.disabled){(t=t||"")!==this.term&&this.term$.next(t);var o=t.replace(/(#[^\s]*)/g,"").trim();(o.length>=this.minLength||0===o.length)&&this.stream$.next(t)}}},{key:"clear",value:function(){this.term$.next(""),this.stream$.next(""),this.input.nativeElement.focus()}},{key:"keyIsValid",value:function(t){return-1===a.invalidKeys.indexOf(t)}},{key:"onSetTerm",value:function(t){this.searchTermChange.emit(t),this.doSearch(t)}},{key:"handlePlaceholder",value:function(){var t=(0,Fe.Z)(new Set(this.searchSourceService.getEnabledSources().filter(function(r){return!["map","coordinatesreverse"].includes(r.getId())}).map(function(r){return r.getType()}))),o="igo.geo.search.placeholder";1===t.length?o="igo.geo.search.".concat(t[0].toLowerCase(),".placeholder"):0===t.length&&(o="igo.geo.search.emptyType.placeholder"),this.placeholder$.next(o)}},{key:"onSetSearchType",value:function(t){if(null!=t){this.searchTypeChange.emit(t);var o="igo.geo.search.".concat(t.toLowerCase(),".placeholder");this.placeholder$.next(o),this.setTerm(this.term)}}},{key:"doSearch",value:function(t){var r,o=this;this.researches$$&&(this.researches$$.map(function(l){return l.unsubscribe()}),this.researches$$=void 0),this.termSplitter&&t.match(new RegExp(this.termSplitter,"g"))?(r=t.split(this.termSplitter).filter(function(l){return l.length>=o.minLength}),this.store&&this.store.clear()):r=[t];var s=[];r.map(function(l){""!==(l?l.replace(/(#[^\s]*)/g,"").trim():"")?s=s.concat(o.searchService.search(l,{forceNA:o.forceNA})):void 0!==o.store&&o.store.clear()}),this.researches$$=s.map(function(l){return l.request.subscribe(function(c){o.onResearchCompleted(l,c)})})}},{key:"onResearchCompleted",value:function(t,o){if(this.search.emit({research:t,results:o}),void 0!==this.store){var r=this.store.all().filter(function(s){return s.source!==t.source}).concat(o);this.store.updateMany(r)}}}]),a}();return i.invalidKeys=["Control","Shift","Alt","ArrowDown","ArrowUp","ArrowRight","ArrowLeft"],i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(or),e.Y36(vn))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-search-bar"]],viewQuery:function(n,t){var o;1&n&&e.Gf(PT,7),2&n&&e.iGM(o=e.CRH())&&(t.input=o.first)},inputs:{searchTypes:"searchTypes",searchType:"searchType",term:"term",disabled:"disabled",pointerSummaryEnabled:"pointerSummaryEnabled",searchResultsGeometryEnabled:"searchResultsGeometryEnabled",floatLabel:"floatLabel",appearance:"appearance",placeholder:"placeholder",label:"label",color:"color",termSplitter:"termSplitter",debounce:"debounce",minLength:"minLength",searchIcon:"searchIcon",searchSelector:"searchSelector",searchSettings:"searchSettings",forceNA:"forceNA",store:"store"},outputs:{pointerSummaryStatus:"pointerSummaryStatus",searchResultsGeometryStatus:"searchResultsGeometryStatus",searchTermChange:"searchTermChange",search:"search",searchTypeChange:"searchTypeChange",clearFeature:"clearFeature",searchSettingsChange:"searchSettingsChange"},decls:16,vars:28,consts:[[1,"igo-search-bar-container",3,"ngClass"],[3,"floatLabel","appearance"],[4,"ngIf"],["matInput","","autocomplete","off",3,"ngClass","disabled","placeholder","value","keyup","touchend"],["input",""],[1,"search-bar-buttons"],["mat-icon-button","",3,"color",4,"ngIf"],["mat-icon-button","",3,"color","matTooltip","click",4,"ngIf"],[3,"searchTypes","searchType","searchTypeChange",4,"ngIf"],[3,"pointerSummaryEnabled","searchResultsGeometryEnabled","pointerSummaryStatus","searchResultsGeometryStatus","searchSourceChange",4,"ngIf"],["mat-icon-button","",3,"color"],[3,"svgIcon"],["mat-icon-button","",3,"color","matTooltip","click"],["svgIcon","close"],[3,"searchTypes","searchType","searchTypeChange"],[3,"pointerSummaryEnabled","searchResultsGeometryEnabled","pointerSummaryStatus","searchResultsGeometryStatus","searchSourceChange"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.ALo(1,"async"),e.TgZ(2,"mat-form-field",1),e.YNc(3,ET,2,1,"mat-label",2),e.TgZ(4,"input",3,4),e.NdJ("keyup",function(r){return t.onKeyup(r)})("touchend",function(r){return t.onKeyup(r)}),e.ALo(6,"async"),e.ALo(7,"async"),e.ALo(8,"translate"),e.ALo(9,"async"),e.qZA()(),e.TgZ(10,"div",5),e.YNc(11,$T,2,2,"button",6),e.YNc(12,RT,3,4,"button",7),e.ALo(13,"async"),e.YNc(14,JT,2,4,"igo-search-selector",8),e.YNc(15,BT,1,2,"igo-search-settings",9),e.qZA()()),2&n&&(e.Q6J("ngClass",e.VKq(24,UT,e.lcZ(1,12,t.empty$))),e.xp6(2),e.Q6J("floatLabel",t.floatLabel)("appearance",t.appearance),e.xp6(1),e.Q6J("ngIf",t.label),e.xp6(1),e.Q6J("ngClass",e.VKq(26,NT,t.searchIcon))("disabled",e.lcZ(6,14,t.disabled$))("placeholder",t.placeholder?t.placeholder:e.lcZ(7,16,t.placeholder$)?e.lcZ(8,18,t.placeholder$.value):void 0)("value",e.lcZ(9,20,t.term$)),e.xp6(7),e.Q6J("ngIf",void 0!==t.searchIcon),e.xp6(1),e.Q6J("ngIf",!1===e.lcZ(13,22,t.empty$)),e.xp6(2),e.Q6J("ngIf",t.searchSelector),e.xp6(1),e.Q6J("ngIf",t.searchSettings))},dependencies:[C.mk,C.O5,J.gM,O.Hw,I.lW,B.KE,B.hX,le.Nt,ST,DT,C.Ov,E.X$],styles:['[_nghost-%COMP%]     .mat-form-field{padding:0 5px}[_nghost-%COMP%]     .mat-form-field-wrapper{margin-bottom:-1.5em}[_nghost-%COMP%]     span.mat-form-field-label-wrapper{top:-20px}[_nghost-%COMP%]     div.mat-form-field-infix{left:5px;right:5px;padding:0 0 12px!important}[_nghost-%COMP%]     div.mat-form-field-underline{display:none}.igo-search-bar-container[_ngcontent-%COMP%]{position:relative;width:100%;display:inline-flex;overflow:hidden}.igo-search-bar-container[_ngcontent-%COMP%] > mat-form-field[_ngcontent-%COMP%]{width:calc(100% - 80px)}.igo-search-bar-container.empty[_ngcontent-%COMP%] > mat-form-field[_ngcontent-%COMP%]{width:calc(100% - 40px)}.search-bar-buttons[_ngcontent-%COMP%]{position:relative;right:0px;display:inline-flex;top:0}.search-bar-buttons[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:nth-child(2):before{content:"";left:0px;top:5px;border-right:1px solid #ddd;height:28px}igo-search-selector[_ngcontent-%COMP%]{background-color:#fff;top:0;border-radius:0}igo-search-settings[_ngcontent-%COMP%]{background-color:#fff;top:0;border-radius:0}'],changeDetection:0}),i}(),tp=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,S.u5,J.AV,O.Ps,I.ot,Ve.Tx,Ft.Fk,B.lN,le.c,he,Xs,el]}),i}();function qT(i,a){if(1&i&&e._UZ(0,"mat-icon",4),2&i){var n=e.oxw();e.s9C("svgIcon",n.showIcons?n.icon:"blank")}}function GT(i,a){if(1&i&&e._UZ(0,"h4",5),2&i){var n=e.oxw();e.Q6J("innerHtml",n.titleHtml,e.oJD)("matTooltip",n.tooltipHtml)}}function QT(i,a){if(1&i&&(e.TgZ(0,"h4",6),e._uU(1),e.qZA()),2&i){var n=e.oxw();e.Q6J("matTooltip",n.title),e.xp6(1),e.Oqu(n.title)}}function YT(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){e.CHM(n);var o=e.oxw();return e.KtG(o.onZoomHandler())}),e._UZ(1,"mat-icon",8),e.qZA()}}var jT=[[["","igoSearchItemToolbar",""]]],HT=["[igoSearchItemToolbar]"],VT=function(){var i=function(){function a(){(0,h.Z)(this,a),this.withZoomButton=!1,this.zoomEvent=new e.vpe,this.format=new Ee.Z}return(0,v.Z)(a,[{key:"title",get:function(){return en(this.result)}},{key:"titleHtml",get:function(){return function hd(i){var a=i.meta||{};return a.titleHtml?a.titleHtml:fo(i,a.titleHtmlProperty||"titleHtml")}(this.result)}},{key:"tooltipHtml",get:function(){return this.titleHtml.replace(/<small?[^>]+(>|$)/g,"\n").replace(/<\/?[^>]+(>|$)/g,"")}},{key:"icon",get:function(){return ur(this.result)}},{key:"onZoomHandler",value:function(){var t=this.format.readFeature(this.result.data,{dataProjection:this.result.data.projection,featureProjection:this.map.projection});mn(this.map,[t],ce.Default)}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-search-results-item"]],inputs:{result:"result",map:"map",showIcons:"showIcons",withZoomButton:"withZoomButton"},outputs:{zoomEvent:"zoomEvent"},ngContentSelectors:HT,decls:6,vars:4,consts:[["mat-list-avatar","",3,"svgIcon",4,"ngIf"],["matLine","","matTooltipShowDelay","500","matTooltipClass","search-result-tooltip",3,"innerHtml","matTooltip",4,"ngIf"],["matLine","","matTooltipShowDelay","500",3,"matTooltip",4,"ngIf"],["igoStopPropagation","","mat-icon-button","",3,"click",4,"ngIf"],["mat-list-avatar","",3,"svgIcon"],["matLine","","matTooltipShowDelay","500","matTooltipClass","search-result-tooltip",3,"innerHtml","matTooltip"],["matLine","","matTooltipShowDelay","500",3,"matTooltip"],["igoStopPropagation","","mat-icon-button","",3,"click"],["svgIcon","magnify"]],template:function(n,t){1&n&&(e.F$t(jT),e.TgZ(0,"mat-list-item"),e.YNc(1,qT,1,1,"mat-icon",0),e.YNc(2,GT,1,2,"h4",1),e.YNc(3,QT,2,2,"h4",2),e.YNc(4,YT,2,0,"button",3),e.Hsn(5),e.qZA()),2&n&&(e.xp6(1),e.Q6J("ngIf",t.icon),e.xp6(1),e.Q6J("ngIf",t.titleHtml),e.xp6(1),e.Q6J("ngIf",!t.titleHtml),e.xp6(1),e.Q6J("ngIf",t.withZoomButton))},dependencies:[C.O5,J.gM,O.Hw,X.Tg,X.eA,ie.X2,I.lW,Oo],styles:["[_nghost-%COMP%]     small{color:#8c8c8c}  .search-result-tooltip{white-space:pre-line}"],changeDetection:0}),i}(),zT=["igoSearchItemToolbar"];function WT(i,a){1&i&&e.GkF(0)}var np=function(a){return{results:a}};function KT(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-collapsible",6),e.NdJ("toggle",function(l){e.CHM(n);var c=e.oxw().$implicit,u=e.oxw();return e.KtG(u.collapsed[c.source.title]=l)}),e.YNc(1,WT,1,0,"ng-container",7),e.qZA()}if(2&i){var t=e.oxw().$implicit,o=e.MAs(4),r=e.oxw();e.Tol(t.source.getId()),e.Q6J("title",r.computeGroupTitle(t))("collapsed",r.collapsed[t.source.title]),e.xp6(1),e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.VKq(6,np,t.results))}}function XT(i,a){1&i&&e.GkF(0)}function ex(i,a){if(1&i&&e.YNc(0,XT,1,0,"ng-container",7),2&i){var n=e.oxw().$implicit,t=e.MAs(4);e.Q6J("ngTemplateOutlet",t)("ngTemplateOutletContext",e.VKq(2,np,n.results))}}var tx=function(a){return{result:a}};function nx(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-search-results-item",9),e.NdJ("focus",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.resultFocus.emit(l))})("unfocus",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.resultUnfocus.emit(l))})("select",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.onResultSelect(l))})("mouseenter",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.resultFocus.emit(l))})("mouseleave",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.resultUnfocus.emit(l))}),e.GkF(1,10),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw(3);e.Q6J("map",o.map)("result",t)("showIcons",o.showIcons)("withZoomButton",o.withZoomButton)("focused",o.store.state.get(t).focused)("selected",o.store.state.get(t).selected),e.xp6(1),e.Q6J("ngTemplateOutlet",o.templateSearchToolbar)("ngTemplateOutletContext",e.VKq(8,tx,t))}}function ox(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"span",11),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(2).$implicit,r=e.oxw();return e.KtG(r.displayMoreResults(o))}),e.TgZ(1,"u"),e._uU(2),e.ALo(3,"translate"),e.qZA()()}2&i&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"igo.geo.search.displayMoreResults")))}function ix(i,a){if(1&i&&(e.YNc(0,nx,2,10,"ng-template",1),e.YNc(1,ox,4,3,"span",8)),2&i){var n=a.results,t=e.oxw().$implicit,o=e.oxw();e.Q6J("ngForOf",n),e.xp6(1),e.Q6J("ngIf",o.isMoreResults(t))}}function rx(i,a){if(1&i&&(e.YNc(0,KT,2,8,"igo-collapsible",3),e.YNc(1,ex,1,4,"ng-template",null,4,e.W1O),e.YNc(3,ix,2,2,"ng-template",null,5,e.W1O)),2&i){var n=e.MAs(2),t=e.oxw();e.Q6J("ngIf",t.mode===t.searchResultMode.Grouped)("ngIfElse",n)}}var ir=function(){return(i=ir||(ir={})).Grouped="grouped",i.Flat="flat",ir;var i}(),op=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.cdRef=n,this.searchService=t,this.searchResultMode=ir,this.pageIterator=[],this.collapsed=[],this.mode=ir.Grouped,this.withZoomButton=!1,this.settingsChange$=new x.X(void 0),this.termSplitter="|",this.resultFocus=new e.vpe,this.resultUnfocus=new e.vpe,this.resultSelect=new e.vpe,this.moreResults=new e.vpe,this.resultMouseenter=new e.vpe,this.resultMouseleave=new e.vpe}return(0,v.Z)(a,[{key:"term",get:function(){return this._term},set:function(t){this._term=t,this.pageIterator=[]}},{key:"results$",get:function(){return void 0===this._results$&&(this._results$=this.liftResults()),this._results$}},{key:"ngOnInit",value:function(){var t=this;this.watcher=new _i(this.store,this.cdRef),this.settingsChange$$=this.settingsChange$.subscribe(function(){t.pageIterator=[]})}},{key:"ngOnDestroy",value:function(){this.watcher.destroy(),this.settingsChange$$.unsubscribe()}},{key:"computeGroupTitle",value:function(t){var o=[t.source.title],r=t.results.length;return r>1&&o.push("(".concat(r,")")),o.join(" ")}},{key:"onResultSelect",value:function(t){this.store.state.get(t)&&!0===this.store.state.get(t).selected||(this.store.state.update(t,{focused:!0,selected:!0},!0),this.resultSelect.emit(t))}},{key:"liftResults",value:function(){var t=this;return this.store.stateView.all$().pipe((0,xi.D)(function(o){return 0===o.length?_o.E:(0,Ti.H)(200)}),(0,U.U)(function(o){return t.groupResults(o.map(function(r){return r.entity}).sort(t.sortByOrder))}))}},{key:"sortByOrder",value:function(t,o){return t.source.displayOrder-o.source.displayOrder}},{key:"groupResults",value:function(t){var o=this,r=new Map;return t.forEach(function(s){var l=s.source,c=r.get(l);void 0===c&&r.set(l,c=[]),c.push(s)}),Array.from(r.keys()).map(function(s){return void 0===o.pageIterator[s.getId()]&&(o.pageIterator[s.getId()]=1),{source:s,results:r.get(s)}})}},{key:"isMoreResults",value:function(t){var o=this.store.getStrategyOfType(Qt);return!(null==o?void 0:o.active)&&t.results&&!0===t.results[t.results.length-1].meta.nextPage}},{key:"displayMoreResults",value:function(t){var s,o=this,r={sourceId:t.source.getId(),page:++this.pageIterator[t.source.getId()]};s=this.termSplitter&&this.term.match(new RegExp(this.termSplitter,"g"))?this.term.split(this.termSplitter):[this.term];var l=[];s.map(function(c){l=l.concat(o.searchService.search(c,r))}),l.map(function(c){c.request.subscribe(function(u){var p=t.results.concat(u);u.length||(p[p.length-1].meta.nextPage=!1),o.moreResults.emit({research:c,results:p})})})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.sBO),e.Y36(or))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-search-results"]],contentQueries:function(n,t,o){var r;1&n&&e.Suo(o,zT,5),2&n&&e.iGM(r=e.CRH())&&(t.templateSearchToolbar=r.first)},inputs:{map:"map",store:"store",showIcons:"showIcons",mode:"mode",withZoomButton:"withZoomButton",term:"term",settingsChange$:"settingsChange$",termSplitter:"termSplitter"},outputs:{resultFocus:"resultFocus",resultUnfocus:"resultUnfocus",resultSelect:"resultSelect",moreResults:"moreResults",resultMouseenter:"resultMouseenter",resultMouseleave:"resultMouseleave"},decls:4,vars:4,consts:[[3,"navigation"],["ngFor","",3,"ngForOf"],["groupTemplate",""],[3,"class","title","collapsed","toggle",4,"ngIf","ngIfElse"],["flatTemplate",""],["storeItemTemplate",""],[3,"title","collapsed","toggle"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","moreResults mat-typography",3,"click",4,"ngIf"],["igoListItem","","color","accent",3,"map","result","showIcons","withZoomButton","focused","selected","focus","unfocus","select","mouseenter","mouseleave"],["igoSearchItemToolbar","",3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"moreResults","mat-typography",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"igo-list",0),e.YNc(1,rx,5,2,"ng-template",1,2,e.W1O),e.ALo(3,"async"),e.qZA()),2&n&&(e.Q6J("navigation",!0),e.xp6(1),e.Q6J("ngForOf",e.lcZ(3,2,t.results$)))},dependencies:[C.sg,C.O5,C.tP,Fa,Yt,Pn,VT,C.Ov,E.X$],styles:[".moreResults[_ngcontent-%COMP%]{cursor:pointer;color:#00f;float:right;margin-right:10px;margin-top:5px}igo-list[_ngcontent-%COMP%]     mat-list{height:100%}"],changeDetection:0}),i}();function ax(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",1),e.NdJ("mouseenter",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.onMouseEvent(r))})("mouseleave",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.onMouseEvent(r))})("click",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.onToggleClick(r))}),e.ALo(1,"translate"),e.ALo(2,"async"),e.ALo(3,"async"),e._UZ(4,"mat-icon",2),e.ALo(5,"async"),e.ALo(6,"async"),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,4,e.lcZ(2,6,t.tooltip$)))("color",e.lcZ(3,8,t.isPreview$)?"":t.added?"warn":""),e.xp6(4),e.Q6J("matBadgeHidden",e.lcZ(5,10,t.inRange$))("svgIcon",e.lcZ(6,12,t.isPreview$)?"plus":t.added?"delete":"plus")}}var ip=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.layerService=n,this.tooltip$=new x.X("igo.geo.catalog.layer.addToMap"),this.inRange$=new x.X(!0),this.isPreview$=new x.X(!1),this.layersSubcriptions=[],this.mouseInsideAdd=!1,this._color="primary"}return(0,v.Z)(a,[{key:"color",get:function(){return this._color},set:function(t){this._color=t}},{key:"ngOnInit",value:function(){var t=this;"Layer"===this.layer.meta.dataType&&(this.added=-1!==this.map.layers.findIndex(function(o){return o.id===t.layer.data.sourceOptions.id})),this.resolution$$=this.map.viewController.resolution$.subscribe(function(o){t.isInResolutionsRange(o),t.tooltip$.next(t.computeTooltip())})}},{key:"ngOnDestroy",value:function(){this.resolution$$.unsubscribe()}},{key:"onMouseEvent",value:function(t){this.onToggleClick(t)}},{key:"onToggleClick",value:function(t){var o=this;if(void 0!==this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest),"mouseenter"!==t.type||!this.mouseInsideAdd)switch(t.type){case"click":this.isPreview$.value||(this.added?this.remove():this.add()),this.isPreview$.next(!1);break;case"mouseenter":!this.isPreview$.value&&!this.added&&(this.lastTimeoutRequest=setTimeout(function(){o.add(),o.isPreview$.next(!0)},500)),this.mouseInsideAdd=!0;break;case"mouseleave":this.isPreview$.value&&(this.remove(),this.isPreview$.next(!1)),this.mouseInsideAdd=!1}}},{key:"add",value:function(){this.added||(this.added=!0,this.addLayerToMap())}},{key:"remove",value:function(){this.added&&(this.added=!1,this.removeLayerFromMap(),this.layersSubcriptions.map(function(t){return t.unsubscribe()}),this.layersSubcriptions=[])}},{key:"addLayerToMap",value:function(){var t=this;if(void 0!==this.map&&this.layer.meta.dataType===Vi){var o=this.layer.data;void 0===o.sourceOptions.optionsFromApi&&(o.sourceOptions.optionsFromApi=!0),this.layersSubcriptions.push(this.layerService.createAsyncLayer(o).subscribe(function(r){return t.map.addLayer(r)}))}}},{key:"removeLayerFromMap",value:function(){if(void 0!==this.map&&this.layer.meta.dataType===Vi){var t=this.map.getLayerById(this.layer.data.sourceOptions.id);this.map.removeLayer(t)}}},{key:"isInResolutionsRange",value:function(t){this.inRange$.next(t>=(this.layer.data.minResolution||0)&&t<=(this.layer.data.maxResolution||1/0))}},{key:"computeTooltip",value:function(){return this.added?this.inRange$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Ge))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-search-add-button"]],inputs:{layer:"layer",added:"added",map:"map",color:"color"},decls:1,vars:1,consts:[["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click",4,"ngIf"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click"],["matBadge","icon","igoMatBadgeIcon","eye-off","igoMatBadgeInverseColor","true","matBadgeDisabled","true","matBadgeSize","small","matBadgePosition","after",3,"matBadgeHidden","svgIcon"]],template:function(n,t){1&n&&e.YNc(0,ax,7,14,"button",0),2&n&&e.Q6J("ngIf","Layer"===t.layer.meta.dataType)},dependencies:[C.O5,bt.k,J.gM,O.Hw,I.lW,Oo,Ma,C.Ov,E.X$],changeDetection:0}),i}(),rp=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,bt.g,J.AV,O.Ps,X.ie,I.ot,Po,yo,Cr,he,fr,wo]}),i}(),sx=function(){var i=function(){function a(n,t,o,r){(0,h.Z)(this,a),this.component=n,this.searchService=t,this.searchSourceService=o,this.mediaService=r,this.pointerSearchStore=new mt([]),this.reverseSearch$$=[],this.hasPointerReverseSearchSource=!1,this.searchPointerSummaryFeatureId="searchPointerSummaryFeatureId",this.igoSearchPointerSummaryDelay=1e3,this.igoSearchPointerSummaryEnabled=!1}return(0,v.Z)(a,[{key:"map",get:function(){return this.component.map}},{key:"mapProjection",get:function(){return this.component.map.projection}},{key:"ngOnInit",value:function(){var t=this;this.listenToMapPointerMove(),this.subscribeToPointerStore(),this.map.status$.pipe((0,We.q)(1)).subscribe(function(){t.store=new Dt([],{map:t.map}),t.initStore()}),this.layers$$=this.map.layers$.subscribe(function(o){t.store&&!o.find(function(r){return"searchPointerSummaryId"===r.id})&&t.initStore()})}},{key:"initStore",value:function(){xo(this.store,new Je({isIgoInternalLayer:!0,id:"searchPointerSummaryId",title:"searchPointerSummary",zIndex:900,source:new Re,showInLayerList:!1,exportable:!1,browsable:!1,style:lx}))}},{key:"ngAfterContentChecked",value:function(){this.hasPointerReverseSearchSource=!!this.searchSourceService.getEnabledSources().filter(Ws).length}},{key:"ngOnDestroy",value:function(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unsubscribeReverseSearch(),this.layers$$.unsubscribe()}},{key:"subscribeToPointerStore",value:function(){var t=this;this.store$$=this.pointerSearchStore.entities$.subscribe(function(o){t.entitiesToPointerOverlay(o)})}},{key:"computeSummaryClosestFeature",value:function(t){var o={};return t.map(function(r){r.data.properties.type&&r.data.properties.distance>=0&&(o.hasOwnProperty(r.data.properties.type)?r.data.properties.distance<o[r.data.properties.type].distance&&(o[r.data.properties.type]={distance:r.data.properties.distance,title:r.meta.pointerSummaryTitle||r.meta.title}):o[r.data.properties.type]={distance:r.data.properties.distance,title:r.meta.pointerSummaryTitle||r.meta.title})}),o}},{key:"entitiesToPointerOverlay",value:function(t){var o=this.computeSummaryClosestFeature(t),r=Object.keys(o),s=[],l=[];t.map(function(c){var u=r.indexOf(c.data.properties.type);-1!==u?(l.push(o[c.data.properties.type].title),r.splice(u,1),s.push(c.data.properties.type)):-1===s.indexOf(c.data.properties.type)&&l.push(c.meta.pointerSummaryTitle||c.meta.title)}),l.length&&this.addPointerOverlay(l.join("\n"))}},{key:"listenToMapPointerMove",value:function(){var t=this;this.pointerMoveListener=this.map.ol.on("pointermove",function(o){return t.onMapEvent(o)})}},{key:"unsubscribeToPointerStore",value:function(){this.store$$.unsubscribe()}},{key:"unsubscribeReverseSearch",value:function(){this.reverseSearch$$.map(function(t){return t.unsubscribe()}),this.reverseSearch$$=[]}},{key:"unlistenToMapPointerMove",value:function(){(0,st.B)(this.pointerMoveListener),this.pointerMoveListener=void 0}},{key:"onMapEvent",value:function(t){var o=this;!t.dragging&&this.igoSearchPointerSummaryEnabled&&this.hasPointerReverseSearchSource&&!this.mediaService.isTouchScreen()?(void 0!==this.lastTimeoutRequest&&(clearTimeout(this.lastTimeoutRequest),this.clearLayer(),this.unsubscribeReverseSearch()),this.lonLat=(0,re.vs)(t.coordinate,this.mapProjection,"EPSG:4326"),this.lastTimeoutRequest=setTimeout(function(){o.onSearchCoordinate()},this.igoSearchPointerSummaryDelay)):this.clearLayer()}},{key:"sortByOrder",value:function(t,o){return t.source.displayOrder-o.source.displayOrder}},{key:"onSearchCoordinate",value:function(){var t=this;this.pointerSearchStore.clear();var o=this.searchService.reverseSearch(this.lonLat,{params:{geometry:"false",icon:"false"}},!0),r=function(c){o.length>0&&t.reverseSearch$$.push(o[c].request.subscribe(function(u){t.onSearch({research:o[c],results:u})}))};for(var s in o)r(s)}},{key:"onSearch",value:function(t){var o=t.results,r=this.pointerSearchStore.all().filter(function(s){return s.source!==t.research.source}).concat(o);this.pointerSearchStore.load(r.sort(this.sortByOrder))}},{key:"addPointerOverlay",value:function(t){this.clearLayer();var o=new He.Z((0,re.vs)(this.lonLat,"EPSG:4326",this.mapProjection)),r=new nt.Z({geometry:o}),s=(new Ee.Z).writeGeometryObject(o,{featureProjection:this.mapProjection,dataProjection:this.mapProjection});this.store.setLayerFeatures([{type:be,geometry:s,projection:this.mapProjection,properties:{id:this.searchPointerSummaryFeatureId,pointerSummary:t},meta:{id:this.searchPointerSummaryFeatureId},ol:r}],ce.None)}},{key:"clearLayer",value:function(){this.store&&this.store.clearLayer()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Be,2),e.Y36(or),e.Y36(vn),e.Y36(xt))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoSearchPointerSummary",""]],inputs:{igoSearchPointerSummaryDelay:"igoSearchPointerSummaryDelay",igoSearchPointerSummaryEnabled:"igoSearchPointerSummaryEnabled"}}),i}();function lx(i,a){return new ee.ZP({image:new bo.Z({src:"./assets/igo2/geo/icons/cross_black_18px.svg",imgSize:[18,18]}),text:new Lt.Z({text:i.get("pointerSummary"),textAlign:"left",textBaseline:"bottom",font:"12px Calibri,sans-serif",fill:new te.Z({color:"#000"}),backgroundFill:new te.Z({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new K.Z({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new K.Z({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:-10,padding:[2.5,2.5,2.5,2.5]})})}var aa=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a,providers:[or,{provide:vn,useFactory:iT,deps:[St]},{provide:ia,useFactory:sT,deps:[$]},{provide:Wu,useFactory:gT,deps:[$]},{provide:ra,useFactory:vT,deps:[$]}]}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,tp,Xs,rp,el,tp,Xs,rp,el]}),i}(),dx=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.cdRef=n,this.complete=new e.vpe,this.cancel=new e.vpe}return(0,v.Z)(a,[{key:"onUpdateInputs",value:function(){this.cdRef.detectChanges()}},{key:"onClose",value:function(){this.cancel.emit()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-ogc-filter"]],inputs:{layer:"layer",map:"map"},outputs:{complete:"complete",cancel:"cancel"},decls:1,vars:3,consts:[["igoListItem","",3,"layer","header","map"]],template:function(n,t){1&n&&e._UZ(0,"igo-ogc-filterable-item",0),2&n&&e.Q6J("layer",t.layer)("header",!1)("map",t.map)},dependencies:[Wi],changeDetection:0}),i}(),nl=new e.OlP("OgcFilterWidget");function gx(i){return i.create(dx)}var ap=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,I.ot,he,Jn]}),i}(),ol=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t){var o;return(0,h.Z)(this,n),(o=a.call(this,t)).options=t,o.inResolutionRange$=new x.X(!0),o.map.viewController.resolution$.subscribe(function(r){o.inResolutionRange$.next(r>o.layer.minResolution&&r<o.layer.maxResolution)}),o}return(0,v.Z)(n,[{key:"layer",get:function(){return this.options.layer}},{key:"map",get:function(){return this.options.map}},{key:"getLayerWksOptionTabQuery",value:function(){var o;return void 0===(null===(o=this.layer.options.workspace.queryOptions)||void 0===o?void 0:o.tabQuery)||this.layer.options.workspace.queryOptions.tabQuery}},{key:"getLayerWksOptionMapQuery",value:function(){var o;return void 0===(null===(o=this.layer.options.workspace.queryOptions)||void 0===o?void 0:o.mapQueryOnOpenTab)||this.layer.options.workspace.queryOptions.mapQueryOnOpenTab}},{key:"getInResolutionRange",value:function(){return this.inResolutionRange$.value}}]),n}(Ya),sp=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.storageService=n,this.configService=t,this.ws$=new x.X(void 0)}return(0,v.Z)(a,[{key:"zoomAuto",get:function(){return this.storageService.get("zoomAuto")}},{key:"createWorkspace",value:function(t,o){var r;if(!1!==(null===(r=t.options.workspace)||void 0===r?void 0:r.enabled)&&!t.dataSource.options.edition){t.options.workspace=Object.assign({},t.options.workspace,{srcId:t.id,workspaceId:t.id,enabled:!0});var s=new ol({id:t.id,title:t.title,layer:t,map:o,entityStore:this.createFeatureStore(t,o),actionStore:new Hn([]),meta:{tableTemplate:void 0}});return this.createTableTemplate(s,t),s}}},{key:"createFeatureStore",value:function(t,o){var r=new Dt([],{map:o});r.bindLayer(t);var s=new Rr({}),l=new Xo({}),c=new $r({}),u=new On({}),p=this.configService.getConfig("queryOverlayStyle"),d=new Bt({layer:new Je({zIndex:300,source:new Re,style:function(f){return oo(Object.assign({},{feature:f},p.selection||{}))},showInLayerList:!1,exportable:!1,browsable:!1}),map:o,hitTolerance:15,motion:this.zoomAuto?ce.Default:ce.None,many:!0,dragBox:!0});return r.addStrategy(s,!0),r.addStrategy(l,!0),r.addStrategy(c,!0),r.addStrategy(d,!0),r.addStrategy(u,!1),r.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(),!0),r}},{key:"createTableTemplate",value:function(t,o){var r=this,s=o.dataSource.options.sourceFields||[],l=o.dataSource.options.relations||[];if(0!==s.length){var c=s.map(function(p){return{name:"properties.".concat(p.name),title:p.alias?p.alias:p.name,renderer:at.UnsanitizedHTML,tooltip:p.tooltip}}),u=l.map(function(p){return{name:"properties.".concat(p.name),title:p.alias?p.alias:p.name,renderer:at.Icon,icon:p.icon,parent:p.parent,type:"relation",tooltip:p.tooltip,onClick:function(){r.ws$.next(p.title)},cellClassFunc:function(){return{class_icon:!0}}}});c.push.apply(c,(0,Fe.Z)(u)),t.meta.tableTemplate={selection:!0,sort:!0,columns:c}}else t.entityStore.entities$.pipe((0,Nt.n)(function(p){return 0===p.length}),(0,We.q)(1)).subscribe(function(p){var d=p[0].ol,g=d.getKeys().filter(function(f){return!f.startsWith("_")&&"geometry"!==f&&f!==d.getGeometryName()&&!f.match(/boundedby/gi)}).map(function(f){return{name:"properties.".concat(f),title:f,renderer:at.UnsanitizedHTML}});t.meta.tableTemplate={selection:!0,sort:!0,columns:g}})}},{key:"createFilterInMapExtentOrResolutionStrategy",value:function(){return new Qt({filterClauseFunc:function(r){return!0===r.state.inMapExtent&&!0===r.state.inMapResolution}})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(Te),e.LFG(j))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),lp=function(){var i=function(){function a(n,t,o,r){(0,h.Z)(this,a),this.layerService=n,this.storageService=t,this.styleService=o,this.configService=r,this.ws$=new x.X(void 0)}return(0,v.Z)(a,[{key:"zoomAuto",get:function(){return this.storageService.get("zoomAuto")}},{key:"createWorkspace",value:function(t,o){var s,l,c,u,p,d,g,f,m,y,_,b,r=this;if(t.options.workspace&&!o.layers.find(function(P){return P.id===t.id+".WfsWorkspaceTableDest"})&&!t.dataSource.options.edition){var w=t.dataSource,T=t.id+".WmsWorkspaceTableSrc",M=t.id+".WfsWorkspaceTableDest";t.options.linkedLayers||(t.options.linkedLayers={linkId:T,links:[]});var A={syncedDelete:!0,linkedIds:[M],properties:[ze.ZINDEX,ze.VISIBLE]};null!==(s=t.options.workspace)&&void 0!==s&&s.minResolution||A.properties.push(ze.MINRESOLUTION);var L=!1;!(null===(l=w.options.ogcFilters)||void 0===l)&&l.enabled&&(A.properties.push(ze.OGCFILTERS),L=!0),null!==(c=t.options.workspace)&&void 0!==c&&c.maxResolution||A.properties.push(ze.MAXRESOLUTION);var Z=[];t.options.linkedLayers.links&&(Z=JSON.parse(JSON.stringify(t.options.linkedLayers.links))),Z.push(A),t.options.linkedLayers.linkId=t.options.linkedLayers.linkId?t.options.linkedLayers.linkId:T,t.options.linkedLayers.links=Z;var R,V={srcId:t.id,workspaceId:void 0,enabled:!1,queryOptions:{mapQueryOnOpenTab:null===(p=null===(u=t.options.workspace)||void 0===u?void 0:u.queryOptions)||void 0===p?void 0:p.mapQueryOnOpenTab,tabQuery:null===(g=null===(d=t.options.workspace)||void 0===d?void 0:d.queryOptions)||void 0===g?void 0:g.tabQuery},pageSize:null===(f=t.options.workspace)||void 0===f?void 0:f.pageSize,pageSizeOptions:null===(m=t.options.workspace)||void 0===m?void 0:m.pageSizeOptions};return this.layerService.createAsyncLayer({isIgoInternalLayer:!0,id:M,linkedLayers:{linkId:M},workspace:V,showInLayerList:!1,opacity:0,title:t.title,minResolution:(null===(y=t.options.workspace)||void 0===y?void 0:y.minResolution)||t.minResolution||0,maxResolution:(null===(_=t.options.workspace)||void 0===_?void 0:_.maxResolution)||t.maxResolution||1/0,style:this.styleService.createStyle({fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},circle:{fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},radius:5}}),sourceOptions:{download:w.options.download,type:"wfs",url:w.options.urlWfs||w.options.url,queryable:!0,relations:w.options.relations,queryTitle:w.options.queryTitle,queryFormatAsWms:null===(b=t.options.workspace)||void 0===b||!b.enabled||w.options.queryFormatAsWms,params:w.options.paramsWFS,ogcFilters:Object.assign({},w.ogcFilters,{enabled:L}),sourceFields:w.options.sourceFields||void 0}}).subscribe(function(P){var Y,pe,ue,oe,Q,ae,xe;if(o.addLayer(P),t.ol.setProperties({linkedLayers:{linkId:t.options.linkedLayers.linkId,links:Z}},!1),P.dataSource.ol.refresh(),null!==(Y=t.options.workspace)&&void 0!==Y&&Y.enabled)return R=new ol({id:t.id,title:t.title,layer:P,map:o,entityStore:r.createFeatureStore(P,o),actionStore:new Hn([]),meta:{tableTemplate:void 0}}),r.createTableTemplate(R,P),P.options.workspace.workspaceId=P.id,t.options.workspace=Object.assign({},t.options.workspace,{enabled:!0,srcId:t.id,workspaceId:P.id,queryOptions:{mapQueryOnOpenTab:null===(ue=null===(pe=t.options.workspace)||void 0===pe?void 0:pe.queryOptions)||void 0===ue?void 0:ue.mapQueryOnOpenTab,tabQuery:null===(Q=null===(oe=t.options.workspace)||void 0===oe?void 0:oe.queryOptions)||void 0===Q?void 0:Q.tabQuery},pageSize:null===(ae=t.options.workspace)||void 0===ae?void 0:ae.pageSize,pageSizeOptions:null===(xe=t.options.workspace)||void 0===xe?void 0:xe.pageSizeOptions}),delete w.options.download,R}),R}}},{key:"createFeatureStore",value:function(t,o){var r=new Dt([],{map:o});r.bindLayer(t);var s=new Rr({}),l=new Xo({}),c=new $r({}),u=new On({}),p=this.configService.getConfig("queryOverlayStyle"),d=new Bt({layer:new Je({zIndex:300,source:new Re,style:function(f){return oo(Object.assign({},{feature:f},p.selection||{}))},showInLayerList:!1,exportable:!1,browsable:!1}),map:o,hitTolerance:15,motion:this.zoomAuto?ce.Default:ce.None,many:!0,dragBox:!0});return r.addStrategy(s,!0),r.addStrategy(l,!0),r.addStrategy(c,!0),r.addStrategy(d,!0),r.addStrategy(u,!1),r.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(),!0),r}},{key:"createTableTemplate",value:function(t,o){var r=this,s=o.dataSource.options.sourceFields||[],l=o.dataSource.options.relations||[];if(0!==s.length){var c=s.map(function(p){return{name:"properties.".concat(p.name),title:p.alias?p.alias:p.name,renderer:at.UnsanitizedHTML,tooltip:p.tooltip}}),u=l.map(function(p){return{name:"properties.".concat(p.name),title:p.alias?p.alias:p.name,renderer:at.Icon,icon:p.icon,parent:p.parent,type:"relation",tooltip:p.tooltip,onClick:function(){r.ws$.next(p.title)},cellClassFunc:function(){return{class_icon:!0}}}});c.push.apply(c,(0,Fe.Z)(u)),t.meta.tableTemplate={selection:!0,sort:!0,columns:c}}else t.entityStore.entities$.pipe((0,Nt.n)(function(p){return 0===p.length}),(0,We.q)(1)).subscribe(function(p){var d=p[0].ol,g=d.getKeys().filter(function(f){return!f.startsWith("_")&&"geometry"!==f&&f!==d.getGeometryName()&&!f.match(/boundedby/gi)}).map(function(f){return{name:"properties.".concat(f),title:f,renderer:at.UnsanitizedHTML}});t.meta.tableTemplate={selection:!0,sort:!0,columns:g}})}},{key:"createFilterInMapExtentOrResolutionStrategy",value:function(){return new Qt({filterClauseFunc:function(r){return!0===r.state.inMapExtent&&!0===r.state.inMapResolution}})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(Ge),e.LFG(Te),e.LFG(xn),e.LFG(j))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),mx=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.dialogRef=n,this.languageService=t,this.data=o}return(0,v.Z)(a,[{key:"cancelAction",value:function(){this.data.cancel=!0,this.dialogRef.close(this.data.cancel)}},{key:"confirmedAction",value:function(){this.data.cancel=!1,this.dialogRef.close(this.data.cancel)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(z.so),e.Y36($),e.Y36(z.WI))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-confirmation-popup-component"]],decls:8,vars:2,consts:[["mat-dialog-content",""],[1,"mat-typography"],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"p",1),e._uU(2),e.qZA()(),e.TgZ(3,"div",2)(4,"button",3),e.NdJ("click",function(){return t.confirmedAction()}),e._uU(5,"Ok "),e.qZA(),e.TgZ(6,"button",4),e.NdJ("click",function(){return t.cancelAction()}),e._uU(7),e.qZA()()),2&n&&(e.xp6(2),e.Oqu(t.languageService.translate.instant("add"===t.data.type?"igo.geo.workspace.addConfirmation":"igo.geo.workspace.deleteConfirmation")),e.xp6(5),e.hij("",t.languageService.translate.instant("igo.geo.workspace.cancel")," "))},dependencies:[I.lW,z.xY,z.H8],styles:["div.mat-dialog-actions[_ngcontent-%COMP%]{justify-content:center}"]}),i}(),cp=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t,o,r,s){var l;return(0,h.Z)(this,n),(l=a.call(this,t)).options=t,l.editionWorkspaceService=o,l.dialog=r,l.configService=s,l.inResolutionRange$=new x.X(!0),l.olDrawingLayerSource=new nn.Z,l.geometryType=Gi,l.modifyStyle=new ee.ZP({stroke:new K.Z({color:"rgba(255,255,255,1)",width:1}),fill:new te.Z({color:"rgba(0,161,222,1)"}),image:new Ue.Z({radius:7,stroke:new K.Z({color:"rgba(255,255,255,1)",width:1}),fill:new te.Z({color:"rgba(0,161,222,1)"})})}),l.newFeaturefilterClauseFunc=function(c){return!0===c.state.newFeature},l.editFeaturefilterClauseFunc=function(c){return!0===c.state.edit},l.map.viewController.resolution$.subscribe(function(c){l.inResolutionRange$.next(c>l.layer.minResolution&&c<l.layer.maxResolution)}),l.drawControl=l.createDrawControl(),l.drawControl.setGeometryType(l.geometryType.Point),l.map.removeLayer(l.olDrawingLayer),l.olDrawingLayer=new Je({id:"igo-draw-layer",title:"edition",zIndex:300,source:new Re,showInLayerList:!1,exportable:!1,browsable:!1,workspace:{enabled:!1}}),l}return(0,v.Z)(n,[{key:"layer",get:function(){return this.options.layer}},{key:"map",get:function(){return this.options.map}},{key:"getInResolutionRange",value:function(){return this.inResolutionRange$.value}},{key:"deleteFeature",value:function(o,r){var s=this;setTimeout(function(){s.dialog.open(mx,{disableClose:!1,data:{type:"delete"}}).afterClosed().subscribe(function(c){if(!1===c){var u,p,d=r.layer.dataSource.options.edition.baseUrl,g=r.layer.dataSource.options.edition.deleteUrl;p=d.length?s.configService.getConfig("edition.url")?s.configService.getConfig("edition.url")+d+"?"+g:d+"?"+g:s.configService.getConfig("edition.url")?s.configService.getConfig("edition.url")+g:g;var m,f=(0,D.Z)(r.meta.tableTemplate.columns);try{for(f.s();!(m=f.n()).done;){var y=m.value;for(var _ in o.properties){var b=y.name;b.includes("properties.")&&(b=b.split(".")[1]),b===_&&!0===y.primary&&(u=o.properties[_])}}}catch(w){f.e(w)}finally{f.f()}p&&s.editionWorkspaceService.deleteFeature(r,p+=u)}})},250)}},{key:"editFeature",value:function(o,r){var s=this;o.edition=!0;var l,d,c=!1,u=r.layer.dataSource.options.edition,p=(0,D.Z)(r.meta.tableTemplate.columns);try{var g=function(){var y=d.value;if(("list"===y.type||"autocomplete"===y.type)&&s.editionWorkspaceService.getDomainValues(y.relation).subscribe(function(w){y.domainValues=w}),!1===c)for(var _ in o.properties){var b=y.name;if(b.includes("properties.")&&(b=b.split(".")[1]),b===_&&!0===y.primary){l=o.properties[_],c=!0;break}}};for(p.s();!(d=p.n()).done;)g()}catch(m){p.e(m)}finally{p.f()}l?(o.original_properties=JSON.parse(JSON.stringify(o.properties)),o.original_geometry=o.geometry,o.idkey=l,r.entityStore.state.updateAll({edit:!1}),r.entityStore.stateView.filter(this.editFeaturefilterClauseFunc),this.addFeatureToStore(o,r)):!o.newFeature&&u.geomType&&(o.newFeature=!0,this.editionWorkspaceService.adding$.next(!0),r.entityStore.state.updateAll({newFeature:!1}),r.entityStore.stateView.filter(this.newFeaturefilterClauseFunc),u.addWithDraw?this.onGeometryTypeChange(u.geomType,o,r):(r.entityStore.insert(o),r.entityStore.state.update(o,{newFeature:!0},!0)))}},{key:"createDrawControl",value:function(o,r,s){return new ji({geometryType:void 0,drawingLayerSource:this.olDrawingLayerSource,drawingLayerStyle:new ee.ZP({}),interactionStyle:tu(o,r,s)})}},{key:"onGeometryTypeChange",value:function(o,r,s){this.drawControl.setGeometryType(o),this.toggleDrawControl(r,s)}},{key:"toggleDrawControl",value:function(o,r){this.deactivateDrawControl(),this.activateDrawControl(o,r)}},{key:"deactivateDrawControl",value:function(){!this.drawControl||(this.drawEnd$$&&this.drawEnd$$.unsubscribe(),this.drawControl.setOlMap(void 0))}},{key:"activateDrawControl",value:function(o,r){var s=this;this.drawEnd$$=this.drawControl.end$.subscribe(function(l){s.addFeatureToStore(o,r,l)}),this.drawControl.setOlMap(this.map.ol,!0)}},{key:"addFeatureToStore",value:function(o,r,s){var l=this.map.ol.getView().getProjection(),c=o.geometry;s?(r.entityStore.insert(o),r.entityStore.state.update(o,{newFeature:!0},!0),c=(new Ee.Z).writeGeometryObject(s,{featureProjection:l,dataProjection:"EPSG:4326"}),o.geometry=c):r.entityStore.state.update(o,{edit:!0},!0),o.projection="EPSG:4326";var u=At(o,l.getCode());this.olDrawingLayer.dataSource.ol.clear(),this.olDrawingLayer.dataSource.ol.addFeature(u),this.map.addLayer(this.olDrawingLayer),this.deactivateDrawControl(),this.createModifyInteraction(u,o,r)}},{key:"deleteDrawings",value:function(){this.map.removeLayer(this.olDrawingLayer),this.olDrawingLayerSource.clear(),this.map.ol.removeInteraction(this.modify)}},{key:"createModifyInteraction",value:function(o,r,s){var l=this;this.map.ol.removeInteraction(this.modify);var c=new wv.Z([o],{unique:!0});this.modify=new as.Z({features:c}),this.map.ol.addInteraction(this.modify),c.forEach(function(u){u.setStyle(l.modifyStyle)}),this.modify.on("modifyend",function(u){var p,d=null===(p=u.features.getArray()[0])||void 0===p?void 0:p.getGeometry();d&&l.addFeatureToStore(r,s,d)})}}]),n}(Ya),up=function(){var i=function(){function a(n,t,o,r,s,l,c,u,p){(0,h.Z)(this,a),this.layerService=n,this.storageService=t,this.configService=o,this.messageService=r,this.languageService=s,this.http=l,this.dialog=c,this.styleService=u,this.authInterceptor=p,this.ws$=new x.X(void 0),this.adding$=new x.X(!1),this.relationLayers$=new x.X(void 0),this.rowsInMapExtentCheckCondition$=new x.X(!0),this.loading=!1}return(0,v.Z)(a,[{key:"zoomAuto",get:function(){return this.storageService.get("zoomAuto")}},{key:"createWorkspace",value:function(t,o){var s,l,c,u,p,d,g,f,m,y,_,b,r=this;if(!0===(null===(s=t.options.workspace)||void 0===s?void 0:s.enabled)&&!0===t.dataSource.options.edition.enabled){var w;(w=t.options.workspace?t.options.workspace:{}).srcId=t.id,w.workspaceId=t.id,w.enabled=!0,w.pageSize=null===(l=t.options.workspace)||void 0===l?void 0:l.pageSize,w.pageSizeOptions=null===(c=t.options.workspace)||void 0===c?void 0:c.pageSizeOptions;var T=t.dataSource,M=t.id+".WmsWorkspaceTableSrc",A=t.id+".WfsWorkspaceTableDest";t.options.linkedLayers||(t.options.linkedLayers={linkId:M,links:[]});var L={syncedDelete:!0,linkedIds:[A],properties:[ze.ZINDEX,ze.VISIBLE]};null!==(u=t.options.workspace)&&void 0!==u&&u.minResolution||L.properties.push(ze.MINRESOLUTION);var Z=!1;!(null===(p=T.options.ogcFilters)||void 0===p)&&p.enabled&&(L.properties.push(ze.OGCFILTERS),Z=!0),null!==(d=t.options.workspace)&&void 0!==d&&d.maxResolution||L.properties.push(ze.MAXRESOLUTION);var V,R=[];return t.options.linkedLayers.links&&(R=JSON.parse(JSON.stringify(t.options.linkedLayers.links))),R.push(L),t.options.linkedLayers.linkId=t.options.linkedLayers.linkId?t.options.linkedLayers.linkId:M,t.options.linkedLayers.links=R,this.layerService.createAsyncLayer({id:A,linkedLayers:{linkId:A},workspace:{srcId:t.id,workspaceId:void 0,enabled:!1,queryOptions:{mapQueryOnOpenTab:null===(f=null===(g=t.options.workspace)||void 0===g?void 0:g.queryOptions)||void 0===f?void 0:f.mapQueryOnOpenTab,tabQuery:!1},pageSize:null===(m=t.options.workspace)||void 0===m?void 0:m.pageSize,pageSizeOptions:null===(y=t.options.workspace)||void 0===y?void 0:y.pageSizeOptions},showInLayerList:!1,opacity:0,title:t.title,minResolution:(null===(_=t.options.workspace)||void 0===_?void 0:_.minResolution)||t.minResolution||0,maxResolution:(null===(b=t.options.workspace)||void 0===b?void 0:b.maxResolution)||t.maxResolution||1/0,style:this.styleService.createStyle({fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},circle:{fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},radius:5}}),sourceOptions:{download:T.options.download,type:"wfs",url:T.options.urlWfs||T.options.url,queryable:!0,relations:T.options.relations,queryTitle:T.options.queryTitle,params:T.options.paramsWFS,ogcFilters:Object.assign({},T.ogcFilters,{enabled:Z}),sourceFields:T.options.sourceFields||void 0,edition:T.options.edition}}).subscribe(function(P){return o.addLayer(P),t.ol.setProperties({linkedLayers:{linkId:t.options.linkedLayers.linkId,links:R}},!1),P.dataSource.ol.refresh(),V=new cp({id:t.id,title:t.title,layer:P,map:o,entityStore:r.createFeatureStore(P,o),actionStore:new Hn([]),meta:{tableTemplate:void 0}},r,r.dialog,r.configService),r.createTableTemplate(V,P),P.options.workspace.workspaceId=P.id,t.options.workspace=Object.assign({},t.options.workspace,{wksConfig:w}),delete T.options.download,V}),V}}},{key:"createFeatureStore",value:function(t,o){var r=new Dt([],{map:o});r.bindLayer(t);var s=new Rr({}),l=new Xo({}),c=new $r({}),u=new On({}),p=new Bt({layer:new Je({zIndex:300,source:new Re,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1}),map:o,hitTolerance:15,motion:this.zoomAuto?ce.Default:ce.None,many:!0,dragBox:!0});return r.addStrategy(s,!0),r.addStrategy(l,!0),r.addStrategy(c,!0),r.addStrategy(p,!0),r.addStrategy(u,!1),r.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(),!0),r}},{key:"createTableTemplate",value:function(t,o){var s,l,d,g,f,r=this,c=o.dataSource.options.sourceFields||[],u=o.dataSource.options.relations||[],p=at.UnsanitizedHTML;d=[{name:"edition",title:void 0,renderer:at.ButtonGroup,primary:!1,valueAccessor:function(){return[{editMode:!1,icon:"pencil",color:"primary",disabled:!1===o.dataSource.options.edition.modifyButton,click:function(_){t.editFeature(_,t)}},{editMode:!1,icon:"delete",color:"warn",disabled:!1===o.dataSource.options.edition.deleteButton,click:function(_){t.deleteFeature(_,t)}},{editMode:!0,icon:"check",color:"primary",disabled:r.loading,click:function(_){r.saveFeature(_,t)}},{editMode:!0,icon:"alpha-x",color:"primary",disabled:r.loading,click:function(_){r.cancelEdit(t,_)}}]}}],0!==c.length?(g=c.map(function(m){var y={name:"properties.".concat(m.name),title:m.alias?m.alias:m.name,renderer:p,valueAccessor:void 0,cellClassFunc:function(){var b={};if(m.type)return b["class_".concat(m.type)]=!0,b},primary:!0===m.primary,visible:m.visible,validation:m.validation,linkColumnForce:m.linkColumnForce,type:m.type,domainValues:void 0,relation:void 0,multiple:m.multiple,step:m.step,tooltip:m.tooltip};return("list"===m.type||"autocomplete"===m.type)&&r.getDomainValues(m.relation).subscribe(function(_){y.domainValues=_,y.relation=m.relation}),y}),f=u.map(function(m){return{name:"properties.".concat(m.name),title:m.alias?m.alias:m.name,renderer:at.Icon,icon:m.icon,parent:m.parent,type:"relation",tooltip:m.tooltip,onClick:function(){!1===r.adding$.getValue()&&r.ws$.next(m.title)},cellClassFunc:function(){return{class_icon:!0}}}}),(s=g).push.apply(s,(0,Fe.Z)(f)),(l=g).push.apply(l,(0,Fe.Z)(d)),t.meta.tableTemplate={selection:!1,sort:!0,columns:g}):t.entityStore.entities$.pipe((0,Nt.n)(function(m){return 0===m.length}),(0,We.q)(1)).subscribe(function(m){var y=m[0].ol,_=y.getKeys().filter(function(b){return!b.startsWith("_")&&"geometry"!==b&&b!==y.getGeometryName()&&!b.match(/boundedby/gi)}).map(function(b){return{name:"properties.".concat(b),title:b,renderer:p}});t.meta.tableTemplate={selection:!1,sort:!0,columns:_}})}},{key:"createFilterInMapExtentOrResolutionStrategy",value:function(){return new Qt({filterClauseFunc:function(r){return!0===r.state.inMapExtent&&!0===r.state.inMapResolution}})}},{key:"saveFeature",value:function(t,o){if(!this.validateFeature(t,o))return!1;this.sanitizeParameter(t,o);var r=o.layer.dataSource.options.edition.baseUrl,s=this.configService.getConfig("edition.url");if(s?s+=r||"":s=r,t.newFeature){s+=o.layer.dataSource.options.edition.addUrl;var c=new W.WM(o.layer.dataSource.options.edition.addHeaders);this.addFeature(t,o,s,c)}else{s+="post"!==o.layer.dataSource.options.edition.modifyProtocol?"?"+o.layer.dataSource.options.edition.modifyUrl+t.idkey:o.layer.dataSource.options.edition.modifyUrl;var u=o.layer.dataSource.options.edition.modifyProtocol,d=new W.WM(o.layer.dataSource.options.edition.modifyHeaders);this.modifyFeature(t,o,s,d,u)}}},{key:"addFeature",value:function(t,o,r,s){var c,u,l=this;for(var p in o.layer.dataSource.options.edition.hasGeometry&&(t.properties.longitude=t.geometry.coordinates[0],t.properties.latitude=t.geometry.coordinates[1]),t.properties){var g,d=(0,D.Z)(o.layer.dataSource.options.sourceFields);try{for(d.s();!(g=d.n()).done;){var f=g.value;(f.name===p&&(null===(c=f.validation)||void 0===c?void 0:c.readonly)||f.name===p&&!1===(null===(u=f.validation)||void 0===u?void 0:u.send))&&delete t.properties[p]}}catch(m){d.e(m)}finally{d.f()}}this.loading=!0,this.http.post("".concat(r),t.properties,{headers:s}).subscribe(function(){l.loading=!1,o.entityStore.stateView.clear(),o.deleteDrawings(),o.entityStore.delete(t);var m=l.languageService.translate.instant("igo.geo.workspace.addSuccess");l.messageService.success(m),l.refreshMap(o.layer,o.layer.map),l.adding$.next(!1),l.rowsInMapExtentCheckCondition$.next(!0)},function(m){l.loading=!1,m.error.caught=!0;var b,y=l.languageService.translate.instant("igo.geo.workspace.addError"),_=o.layer.dataSource.options.edition.messages;_?(_.forEach(function(w){var T=Object.keys(w)[0];m.error.message.includes(T)&&l.messageService.error(b=w[T])}),b||l.messageService.error(y)):l.messageService.error(y)})}},{key:"deleteFeature",value:function(t,o){var r=this;this.loading=!0,this.http.delete("".concat(o),{}).subscribe(function(){r.loading=!1;var s=r.languageService.translate.instant("igo.geo.workspace.deleteSuccess");r.messageService.success(s),r.refreshMap(t.layer,t.layer.map);var c,l=(0,D.Z)(t.layer.options.sourceOptions.relations);try{var u=function(){var d=c.value;t.map.layers.forEach(function(g){g.title===d.title&&g.dataSource.ol.refresh()})};for(l.s();!(c=l.n()).done;)u()}catch(p){l.e(p)}finally{l.f()}},function(s){r.loading=!1,s.error.caught=!0;var u,l=r.languageService.translate.instant("igo.geo.workspace.addError"),c=t.layer.dataSource.options.edition.messages;c?(c.forEach(function(p){var d=Object.keys(p)[0];s.error.message.includes(d)&&r.messageService.error(u=p[d])}),u||r.messageService.error(l)):r.messageService.error(l)})}},{key:"modifyFeature",value:function(t,o,r,s){var u,p,l=this,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"patch";for(var d in o.layer.dataSource.options.edition.hasGeometry&&(t.properties.longitude=t.geometry.coordinates[0],t.properties.latitude=t.geometry.coordinates[1]),t.properties){var f,g=(0,D.Z)(o.layer.dataSource.options.sourceFields);try{for(g.s();!(f=g.n()).done;){var m=f.value;(m.name===d&&(null===(u=m.validation)||void 0===u?void 0:u.readonly)||m.name===d&&!1===(null===(p=m.validation)||void 0===p?void 0:p.send)||"boundedBy"===d)&&delete t.properties[d]}}catch(y){g.e(y)}finally{g.f()}}this.loading=!0,this.http[c]("".concat(r),t.properties,{headers:s}).subscribe(function(){l.loading=!1,l.cancelEdit(o,t,!0);var y=l.languageService.translate.instant("igo.geo.workspace.modifySuccess");l.messageService.success(y),l.refreshMap(o.layer,o.layer.map);var w,_=[],b=(0,D.Z)(o.layer.options.sourceOptions.relations);try{var T=function(){var A=w.value;o.map.layers.forEach(function(L){L.title===A.title&&(_.push(L),L.dataSource.ol.refresh())})};for(b.s();!(w=b.n()).done;)T()}catch(M){b.e(M)}finally{b.f()}l.relationLayers$.next(_)},function(y){l.loading=!1,y.error.caught=!0;var w,_=l.languageService.translate.instant("igo.geo.workspace.addError"),b=o.layer.dataSource.options.edition.messages;b?(b.forEach(function(T){var M=Object.keys(T)[0];y.error.message.includes(M)&&l.messageService.error(w=T[M])}),w||l.messageService.error(_)):l.messageService.error(_)})}},{key:"cancelEdit",value:function(t,o){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];o.edition=!1,this.adding$.next(!1),t.deleteDrawings(),t.entityStore.stateView.clear(),o.newFeature?(t.entityStore.delete(o),t.deactivateDrawControl(),this.rowsInMapExtentCheckCondition$.next(!0)):(r||(o.properties=o.original_properties,o.geometry=o.original_geometry),delete o.original_properties,delete o.original_geometry)}},{key:"getDomainValues",value:function(t){var o=t.url;return o||(o=this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+t.table:t.table),this.http.get(o).pipe((0,U.U)(function(r){return r}),(0,Ze.K)(function(r){return r.error.caught=!0,(0,fi._)(r)}))}},{key:"refreshMap",value:function(t,o){var s,l,r=this,c=t.dataSource.ol;c.setLoader(function(_,b,w,T,M){t.customWFSLoader(t.ol.getSource(),t.options.sourceOptions,r.authInterceptor,_,b,w,T,M,!0)}),c.refresh();var d,p=(0,D.Z)(o.layers);try{for(p.s();!(d=p.n()).done;){var g=d.value;if(g.id!==t.id&&(null===(s=g.options.linkedLayers)||void 0===s?void 0:s.linkId.includes(t.id.substr(0,t.id.indexOf(".")-1)))&&(null===(l=g.options.linkedLayers)||void 0===l?void 0:l.linkId.includes("WmsWorkspaceTableSrc"))){var f=g.dataSource.ol,m=f.getParams();m._t=(new Date).getTime(),f.updateParams(m)}}}catch(y){p.e(y)}finally{p.f()}}},{key:"validateFeature",value:function(t,o){var l,c,r=this,s=this.languageService.translate,u=!0;return o.meta.tableTemplate.columns.forEach(function(p){p.hasOwnProperty("validation")&&p.validation&&(c=sa(p.name),Object.keys(p.validation).forEach(function(d){switch(d){case"mandatory":p.validation[d]&&(!t.properties.hasOwnProperty(c)||!t.properties[c])&&(u=!1,l=s.instant("igo.geo.formValidation.mandatory",{column:p.title}),r.messageService.error(l));break;case"minValue":t.properties.hasOwnProperty(c)&&t.properties[c]&&t.properties[c]<p.validation[d]&&(u=!1,l=s.instant("igo.geo.formValidation.minValue",{column:p.title,value:p.validation[d]}),r.messageService.error(l));break;case"maxValue":t.properties.hasOwnProperty(c)&&t.properties[c]&&t.properties[c]>p.validation[d]&&(u=!1,l=s.instant("igo.geo.formValidation.maxValue",{column:p.title,value:p.validation[d]}),r.messageService.error(l));break;case"minLength":t.properties.hasOwnProperty(c)&&t.properties[c]&&t.properties[c].length<p.validation[d]&&(u=!1,l=s.instant("igo.geo.formValidation.minLength",{column:p.title,value:p.validation[d]}),r.messageService.error(l));break;case"maxLength":t.properties.hasOwnProperty(c)&&t.properties[c]&&t.properties[c].length>p.validation[d]&&(u=!1,l=s.instant("igo.geo.formValidation.maxLength",{column:p.title,value:p.validation[d]}),r.messageService.error(l))}}))}),u}},{key:"sanitizeParameter",value:function(t,o){o.meta.tableTemplate.columns.forEach(function(r){"list"===r.type&&t.properties[sa(r.name)]&&(t.properties[sa(r.name)]=t.properties[sa(r.name)].toString())})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(Ge),e.LFG(Te),e.LFG(j),e.LFG(Ae),e.LFG($),e.LFG(W.eN),e.LFG(z.uw),e.LFG(xn),e.LFG(xr))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function sa(i){return i.includes("properties.")?i.split(".")[1]:i}var pp=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(t){var o;return(0,h.Z)(this,n),(o=a.call(this,t)).options=t,o.inResolutionRange$=new x.X(!0),o.map.viewController.resolution$.subscribe(function(r){o.inResolutionRange$.next(r>o.layer.minResolution&&r<o.layer.maxResolution)}),o}return(0,v.Z)(n,[{key:"layer",get:function(){return this.options.layer}},{key:"map",get:function(){return this.options.map}},{key:"getLayerWksOptionTabQuery",value:function(){var o;return void 0===(null===(o=this.layer.options.workspace.queryOptions)||void 0===o?void 0:o.tabQuery)||this.layer.options.workspace.queryOptions.tabQuery}},{key:"getLayerWksOptionMapQuery",value:function(){var o;return void 0===(null===(o=this.layer.options.workspace.queryOptions)||void 0===o?void 0:o.mapQueryOnOpenTab)||this.layer.options.workspace.queryOptions.mapQueryOnOpenTab}},{key:"getInResolutionRange",value:function(){return this.inResolutionRange$.value}}]),n}(Ya),dp=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.storageService=n,this.configService=t,this.ws$=new x.X(void 0)}return(0,v.Z)(a,[{key:"zoomAuto",get:function(){return this.storageService.get("zoomAuto")}},{key:"createWorkspace",value:function(t,o){var r;if(!1!==(null===(r=t.options.workspace)||void 0===r?void 0:r.enabled)&&!t.dataSource.options.edition){t.options.workspace=Object.assign({},t.options.workspace,{srcId:t.id,workspaceId:t.id,enabled:!0});var s=new pp({id:t.id,title:t.title,layer:t,map:o,entityStore:this.createFeatureStore(t,o),actionStore:new Hn([]),meta:{tableTemplate:void 0}});return this.createTableTemplate(s,t),s}}},{key:"createFeatureStore",value:function(t,o){var r=new Dt([],{map:o});r.bindLayer(t);var s=new Rr({}),l=new Xo({}),c=new $r({}),u=new On({}),p=this.configService.getConfig("queryOverlayStyle"),d=new Bt({layer:new Je({zIndex:300,source:new Re,style:function(f){return oo(Object.assign({},{feature:f},p.selection||{}))},showInLayerList:!1,exportable:!1,browsable:!1}),map:o,hitTolerance:15,motion:this.zoomAuto?ce.Default:ce.None,many:!0,dragBox:!0});return r.addStrategy(s,!0),r.addStrategy(l,!0),r.addStrategy(c,!0),r.addStrategy(d,!0),r.addStrategy(u,!1),r.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(),!0),r}},{key:"createTableTemplate",value:function(t,o){var r=this,s=o.dataSource.options.sourceFields||[],l=o.dataSource.options.relations||[];if(0!==s.length){var c=s.map(function(p){return{name:"properties.".concat(p.name),title:p.alias?p.alias:p.name,renderer:at.UnsanitizedHTML,tooltip:p.tooltip}}),u=l.map(function(p){return{name:"properties.".concat(p.name),title:p.alias?p.alias:p.name,renderer:at.Icon,icon:p.icon,parent:p.parent,type:"relation",tooltip:p.tooltip,onClick:function(){r.ws$.next(p.title)},cellClassFunc:function(){return{class_icon:!0}}}});c.push.apply(c,(0,Fe.Z)(u)),t.meta.tableTemplate={selection:!0,sort:!0,columns:c}}else t.entityStore.entities$.pipe((0,Nt.n)(function(p){return 0===p.length}),(0,We.q)(1)).subscribe(function(p){var d=p[0].ol,g=d.getKeys().filter(function(f){return!f.startsWith("_")&&"geometry"!==f&&f!==d.getGeometryName()&&!f.match(/boundedby/gi)}).map(function(f){return{name:"properties.".concat(f),title:f,renderer:at.UnsanitizedHTML}});t.meta.tableTemplate={selection:!0,sort:!0,columns:g}})}},{key:"createFilterInMapExtentOrResolutionStrategy",value:function(){return new Qt({filterClauseFunc:function(r){return!0===r.state.inMapExtent&&!0===r.state.inMapResolution}})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(Te),e.LFG(j))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),hx=function(){var i=function(){function a(n,t,o,r,s){(0,h.Z)(this,a),this.component=n,this.wfsWorkspaceService=t,this.wmsWorkspaceService=o,this.editionWorkspaceService=r,this.featureWorkspaceService=s,this.entities$$=[],this.changeWorkspace=new e.vpe,this.disableSwitch=new e.vpe,this.relationLayers=new e.vpe,this.rowsInMapExtentCheckCondition=new e.vpe}return(0,v.Z)(a,[{key:"workspaceStore",get:function(){return this.component.store}},{key:"ngOnInit",value:function(){var t=this;this.layers$$=this.map.layers$.pipe((0,De.b)(50)).subscribe(function(o){return t.onLayersChange(o)}),this.featureWorkspaceService.ws$.subscribe(function(o){t.changeWorkspace.emit(o)}),this.wmsWorkspaceService.ws$.subscribe(function(o){t.changeWorkspace.emit(o)}),this.wfsWorkspaceService.ws$.subscribe(function(o){t.changeWorkspace.emit(o)}),this.editionWorkspaceService.ws$.subscribe(function(o){t.changeWorkspace.emit(o)}),this.editionWorkspaceService.adding$.subscribe(function(o){t.disableSwitch.emit(o)}),this.editionWorkspaceService.relationLayers$.subscribe(function(o){t.relationLayers.emit(o)}),this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe(function(o){t.rowsInMapExtentCheckCondition.emit(o)})}},{key:"ngOnDestroy",value:function(){this.layers$$.unsubscribe(),this.entities$$.map(function(t){return t.unsubscribe()})}},{key:"onLayersChange",value:function(t){var o=this,r=t.filter(function(u){return o.layerIsEditable(u)}),s=r.map(function(u){return u.id}),l=r.map(function(u){return o.getOrCreateWorkspace(u)}).filter(function(u){return void 0!==u}),c=this.workspaceStore.all().filter(function(u){return s.indexOf(u.id)<0});c.length>0&&(c.forEach(function(u){u.entityStore.deactivateStrategyOfType(Xo),u.deactivate()}),this.workspaceStore.state.updateMany(c,{active:!1,selected:!1}),this.workspaceStore.deleteMany(c)),l.length>0&&this.workspaceStore.insertMany(l)}},{key:"getOrCreateWorkspace",value:function(t){var o,r,s,l;if(void 0===this.workspaceStore.get(t.id)){if(t.dataSource instanceof Wo&&!0!==(null===(o=t.dataSource.options.edition)||void 0===o?void 0:o.enabled))return this.wfsWorkspaceService.createWorkspace(t,this.map);if(t.dataSource instanceof Ht&&!0!==(null===(r=t.dataSource.options.edition)||void 0===r?void 0:r.enabled)){if(!t.dataSource.options.paramsWFS)return;var p=this.wmsWorkspaceService.createWorkspace(t,this.map);return null==p||p.inResolutionRange$.subscribe(function(f){t.dataSource.options.queryable=!f,p.layer.dataSource.options.queryable=f}),p}if(t.dataSource instanceof Re&&!0===t.exportable&&!0!==(null===(s=t.dataSource.options.edition)||void 0===s?void 0:s.enabled))return this.featureWorkspaceService.createWorkspace(t,this.map);if(t.dataSource instanceof Ht&&!0===(null===(l=t.dataSource.options.edition)||void 0===l?void 0:l.enabled))return this.editionWorkspaceService.createWorkspace(t,this.map)}}},{key:"layerIsEditable",value:function(t){var o,r,s=t.dataSource;return s instanceof Wo||s instanceof Re||s instanceof Ht&&((null===(o=(s.options||{}).ogcFilters)||void 0===o?void 0:o.enabled)||void 0!==(null===(r=s.options.paramsWFS)||void 0===r?void 0:r.featureTypes))}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(ql),e.Y36(sp),e.Y36(lp),e.Y36(up),e.Y36(dp))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoWorkspaceSelector",""]],inputs:{map:"map"},outputs:{changeWorkspace:"changeWorkspace",disableSwitch:"disableSwitch",relationLayers:"relationLayers",rowsInMapExtentCheckCondition:"rowsInMapExtentCheckCondition"}}),i}(),gp=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez]}),i}(),fp=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez]}),i}(),vx=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,I.ot,z.Is,ot.vV]}),i}(),mp=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[{provide:nl,useFactory:gx,deps:[Qa]}],imports:[C.ez,he,Nl,gp,fp,ap,z.Is,gp,fp,ap,vx]}),i}(),hp=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){var t;return(0,h.Z)(this,n),(t=a.apply(this,arguments)).storeInitialized$=new x.X(!1),t}return(0,v.Z)(n,[{key:"clearStops",value:function(){this.storeInitialized$.next(!1),this.clear()}}]),n}(mt),vp=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n)}(Dt),yp=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n)}(Dt),_p=function(i){(0,N.Z)(n,i);var a=(0,q.Z)(n);function n(){return(0,h.Z)(this,n),a.apply(this,arguments)}return(0,v.Z)(n)}(Dt),_x=function(){var i=function(a){(0,N.Z)(t,a);var n=(0,q.Z)(t);function t(o,r){var s;return(0,h.Z)(this,t),(s=n.call(this)).http=o,s.config=r,s.directionsUrl="https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/",s.options=s.config.getConfig("directionsSources.osrm")||{},s.directionsUrl=s.options.url||s.directionsUrl,s}return(0,v.Z)(t,[{key:"enabled",get:function(){return!1!==this.options.enabled},set:function(r){this.options.enabled=r}},{key:"getName",value:function(){return t._name}},{key:"route",value:function(r){var s=this,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=this.getRouteParams(l);return this.http.get(this.directionsUrl+r.join(";"),{params:c}).pipe((0,U.U)(function(u){return s.extractRoutesData(u)}))}},{key:"extractRoutesData",value:function(r){var s=this,l=[];return r.routes.forEach(function(c){l.push(s.formatRoute(c,r.waypoints))}),l}},{key:"getRouteParams",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.alternatives=void 0===r.alternatives||r.alternatives,r.steps=void 0===r.steps||r.steps,r.geometries=void 0!==r.geometries?r.geometries:"geojson",r.overview=void 0!==r.overview&&r.overview,r.continue_straight=void 0!==r.continue_straight&&r.continue_straight,new W.LE({fromObject:{alternatives:r.alternatives?"true":"false",overview:r.overview?"simplified":"full",steps:r.steps?"true":"false",geometries:r.geometries?r.geometries:"geojson",continue_straight:r.continue_straight?"true":"false"}})}},{key:"formatRoute",value:function(r,s){var l=[];return r.legs.forEach(function(c){c.steps.forEach(function(u){l.push(u)})}),{id:Ye(),title:r.legs[0].summary,source:t._name,sourceType:ta.Route,order:1,format:ea.GeoJSON,icon:"directions",projection:"EPSG:4326",waypoints:s,distance:r.distance,duration:r.duration,geometry:r.geometry,legs:r.legs,steps:l,weight:r.weight,weight_name:r.weight_name}}}]),t}(Ys);return i._name="OSRM Qu\xe9bec",i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG(j))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,ne.gn)([(0,$t.q)({maxCacheCount:20})],i.prototype,"route",null),i}();function bx(i,a){return new _x(i,a)}var bp=function(){var i=function(a){(0,N.Z)(t,a);var n=(0,q.Z)(t);function t(o,r,s,l){var c;return(0,h.Z)(this,t),(c=n.call(this,l,s)).http=o,c.languageService=r,c}return(0,v.Z)(t,[{key:"getId",value:function(){return t.id}},{key:"getType",value:function(){return t.type}},{key:"getDefaultOptions",value:function(){return{title:"Cadastre (Qu\xe9bec)",searchUrl:"https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?"}}},{key:"search",value:function(r,s){var l=this;r=(r=(r=r.endsWith(",")?r.slice(0,-1):r).startsWith(",")?r.substr(1):r).replace(/ /g,"");var c=this.computeSearchRequestParams(r,s||{});return c.get("numero")&&c.get("numero").match(/^[0-9,]+$/g)?this.http.get(this.searchUrl,{params:c,responseType:"text"}).pipe((0,U.U)(function(u){return l.extractResults(u,r)})):(0,ge.of)([])}},{key:"computeSearchRequestParams",value:function(r,s){return new W.LE({fromObject:Object.assign({numero:r,epsg:"4326"},this.params,s.params||{})})}},{key:"extractResults",value:function(r,s){var l=this;return r.split("<br />").filter(function(c){return c.length>0}).map(function(c){return l.dataToResult(c,s)})}},{key:"dataToResult",value:function(r,s){var l=r.split(";"),c=l[0],p=this.computeGeometry(l[7]),d={NoLot:c,Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"},g=[this.getId(),"cadastre",c].join(".");return{source:this,meta:{dataType:be,id:g,title:c,score:ri(s.trim(),c),icon:"map-marker"},data:{type:be,projection:"EPSG:4326",geometry:p,properties:d,meta:{id:g,title:c}}}}},{key:"computeGeometry",value:function(r){var s=(new Fi.Z).readFeature(r,{dataProjection:"EPSG:4326",featureProjection:"EPSG:4326"});return{type:s.getGeometry().getType(),coordinates:s.getGeometry().getCoordinates()}}}]),t}(St);return i.id="cadastre",i.type=be,i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG($),e.LFG(Te),e.LFG("options"))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,ne.gn)([(0,$t.q)({maxCacheCount:20})],i.prototype,"search",null),i}();function Sx(i,a,n,t){return new bp(i,a,n,t.getConfig("searchSources.".concat(bp.id)))}var Cp=function(){var i=function(a){(0,N.Z)(t,a);var n=(0,q.Z)(t);function t(o,r,s){var l;return(0,h.Z)(this,t),(l=n.call(this,r,s)).http=o,l}return(0,v.Z)(t,[{key:"getId",value:function(){return t.id}},{key:"getType",value:function(){return t.type}},{key:"getDefaultOptions",value:function(){return{title:"Nominatim (OSM)",searchUrl:"https://nominatim.openstreetmap.org/search",settings:[{type:"checkbox",title:"results type",name:"amenity",values:[{title:"igo.geo.search.nominatim.type.food",value:"bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant",enabled:!1},{title:"igo.geo.search.nominatim.type.health",value:"baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary",enabled:!1},{title:"igo.geo.search.nominatim.type.entertainment",value:"arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium                           ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe",enabled:!1},{title:"igo.geo.search.nominatim.type.finance",value:"atm,bank,bureau_de_change",enabled:!1}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"10",value:10,enabled:!0},{title:"20",value:20,enabled:!1},{title:"50",value:50,enabled:!1}]},{type:"radiobutton",title:"restrictExtent",name:"countrycodes",values:[{title:"igo.geo.search.nominatim.country.canada",value:"CA",enabled:!0},{title:"igo.geo.search.nominatim.country.all",value:null,enabled:!1}]},{type:"radiobutton",title:"multiple object",name:"dedupe",values:[{title:"igo.geo.search.searchSources.settings.true",value:0,enabled:!1},{title:"igo.geo.search.searchSources.settings.false",value:1,enabled:!0}]}]}}},{key:"search",value:function(r,s){var l=this,c=this.computeSearchRequestParams(r,s||{});return c.get("q")?this.http.get(this.searchUrl,{params:c}).pipe((0,U.U)(function(u){return l.extractResults(u,r)})):(0,ge.of)([])}},{key:"computeSearchRequestParams",value:function(r,s){return new W.LE({fromObject:Object.assign({q:this.computeTerm(r),format:"json"},this.params,s.params||{})})}},{key:"extractResults",value:function(r,s){var l=this;return r.map(function(c){return l.dataToResult(c,s)})}},{key:"dataToResult",value:function(r,s){var l=this.computeProperties(r),c=this.computeGeometry(r),u=this.computeExtent(r),p=[this.getId(),"place",r.place_id].join(".");return{source:this,meta:{dataType:be,id:p,title:r.display_name,icon:"map-marker",score:ri(s.trim(),r.display_name)},data:{type:be,projection:"EPSG:4326",geometry:c,extent:u,properties:l,meta:{id:p,title:r.display_name}}}}},{key:"computeProperties",value:function(r){return{display_name:r.display_name,place_id:r.place_id,osm_type:r.osm_type,class:r.class,type:r.type}}},{key:"computeGeometry",value:function(r){return{type:"Point",coordinates:[parseFloat(r.lon),parseFloat(r.lat)]}}},{key:"computeExtent",value:function(r){return[parseFloat(r.boundingbox[2]),parseFloat(r.boundingbox[0]),parseFloat(r.boundingbox[3]),parseFloat(r.boundingbox[1])]}},{key:"computeTerm",value:function(r){return this.computeTermTags(r)}},{key:"computeTermTags",value:function(r){var s=(0,Se.Z)((0,we.Z)(t.prototype),"getHashtagsValid",this).call(this,r,"amenity");return s?s.length?(r=r.replace(/(#[^\s]*)/g,""),s.forEach(function(l){r+="+["+l+"]"}),r):null:this.computeTermSettings(r)}},{key:"computeTermSettings",value:function(r){return this.options.settings.forEach(function(s){"amenity"===s.name&&s.values.forEach(function(l){l.enabled&&"string"==typeof l.value&&l.value.split(",").forEach(function(u){r+="+["+u+"]"})})}),r}}]),t}(St);return i.id="nominatim",i.type=be,i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG("options"),e.LFG(Te))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,ne.gn)([(0,$t.q)({maxCacheCount:20})],i.prototype,"search",null),i}();function Tx(i,a,n){return new Cp(i,a.getConfig("searchSources.".concat(Cp.id)),n)}var Sp=function(){var i=function(a){(0,N.Z)(t,a);var n=(0,q.Z)(t);function t(o,r,s,l){var c;if((0,h.Z)(this,t),(c=n.call(this,l,s)).http=o,c.languageService=r,c.storedQueriesOptions=l,c.storedQueriesOptions&&!c.storedQueriesOptions.available)return(0,jl.Z)(c);var f="title";if(c.storedQueriesOptions||(console.log(" No configuration for this search source (storedqueries). You will use the default values"),c.storedQueriesOptions={storedquery_id:"rtss",fields:[{name:"rtss",defaultValue:"-99"},{name:"chainage",defaultValue:"0",splitPrefix:"\\+"}],outputformat:"text/xml; subtype=gml/3.1.1",srsname:"EPSG:4326",resultTitle:f},c.resultTitle=f,console.log("Default values",c.storedQueriesOptions)),!c.storedQueriesOptions.storedquery_id)throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"');if(!c.storedQueriesOptions.fields)throw new Error('Stored Queries :You have to set "fields" into options. ex: fields: {"name": "rtss", "defaultValue": "-99"}');if(c.storedQueriesOptions.outputformat=c.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",c.storedQueriesOptions.srsname=c.storedQueriesOptions.srsname||"EPSG:4326",c.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")&&c.storedQueriesOptions.outputformat.toLowerCase().includes("getfeaturebyid"))throw new Error("You must set a geojson format for your stored query. This is due to an openlayers issue) (wfs 1.1.0 & gml 3.1.1 limitation)");return c.storedQueriesOptions.fields instanceof Array||(c.storedQueriesOptions.fields=[c.storedQueriesOptions.fields]),c.multipleFieldsQuery=c.storedQueriesOptions.fields.length>1,c.storedQueriesOptions.fields.forEach(function(b,w){if(c.multipleFieldsQuery&&!b.splitPrefix&&0!==w)throw new Error("Stored Queries :You must set a field spliter into your field definition (optional for the first one!)");if(!b.defaultValue)throw new Error("Stored Queries :You must set a field default value into your field definition")}),c.storedQueriesOptions.resultTitle=c.storedQueriesOptions.resultTitle||c.resultTitle,c}return(0,v.Z)(t,[{key:"getId",value:function(){return t.id}},{key:"getType",value:function(){return t.type}},{key:"getDefaultOptions",value:function(){return{title:"Stored Queries",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}}},{key:"search",value:function(r,s){var l=this,c=this.termSplitter(r,this.storedQueriesOptions.fields),u=this.computeRequestParams(s||{},c);return this.options.params=this.options.params?this.options.params:{},this.options.params.page=s.page?String(s.page):"1",new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:u,responseType:"text"}).pipe((0,U.U)(function(p){var d=l.extractResults(l.extractWFSData(p),r);if(d.sort(function(m,y){return m.meta.score>y.meta.score||m.meta.score===y.meta.score&&m.meta.titleHtml<y.meta.titleHtml?1:-1}),d.reverse(),d.length>Number(l.options.params.limit)){var g=Number(l.options.params.limit)*Number(l.options.params.page),f=d.length;(d=d.slice(0,g))[d.length-1].meta.nextPage=g<f}return d})):this.http.get(this.searchUrl,{params:u}).pipe((0,U.U)(function(p){return l.extractResults(l.extractWFSData(p),r)}))}},{key:"getFormatFromOptions",value:function(){var r,s=this.storedQueriesOptions.outputformat,l=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(s)&&(r=Ee.Z),l.test(s)&&(r=Co.Z),new r}},{key:"extractWFSData",value:function(r){var s=this.getFormatFromOptions(),l=Ee.Z,c=s.readFeatures(r);return JSON.parse((new l).writeFeatures(c))}},{key:"termSplitter",value:function(r,s){var l={},c=r,u=0;return s.forEach(function(d){l[d.name]=d.defaultValue;var g=new RegExp(d.splitPrefix+"(.+)","i");g.test(c)&&(u=d.splitPrefix?u+=1:u,c=c.split(g)[1])}),0===u?(l[s[0].name]=r,l):(c=r,(0,Fe.Z)(s).reverse().forEach(function(d){var g=new RegExp(d.splitPrefix||"(.+)","i");if(c||""!==c){var f=c.split(g);c=f[0],f[1]&&(l[d.name]=f[1].trim())}}),l)}},{key:"computeRequestParams",value:function(r,s){var l=this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")?"2.0.0":"1.1.0";return new W.LE({fromObject:Object.assign({service:"wfs",version:l,request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},s,this.params,r.params||{})})}},{key:"extractResults",value:function(r,s){var l=this;return r.features.map(function(c){return l.dataToResult(c,s)})}},{key:"dataToResult",value:function(r,s){var l=this.computeProperties(r),c=[this.getId(),l.type,r.id].join("."),u=r.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:be,projection:"EPSG:4326",geometry:r.geometry,properties:l,meta:{id:c,title:r.properties[u]}},meta:{dataType:be,id:c,title:r.properties.title,titleHtml:r.properties[u],icon:"map-marker",score:ri(s.trim(),r.properties.title?r.properties.title:r.properties[u])}}}},{key:"computeProperties",value:function(r){return Object.assign({},se.removeKeys(r.properties,t.propertiesBlacklist),{Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"})}}]),t}(St);return i.id="storedqueries",i.type=be,i.propertiesBlacklist=["boundedBy","id","coord_x","coord_y"],i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG($),e.LFG(Te),e.LFG("options"))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,ne.gn)([(0,$t.q)({maxCacheCount:20})],i.prototype,"search",null),i}(),wp=function(){var i=function(a){(0,N.Z)(t,a);var n=(0,q.Z)(t);function t(o,r,s,l){var c;if((0,h.Z)(this,t),(c=n.call(this,l,s)).http=o,c.languageService=r,c.storedQueriesOptions=l,!c.storedQueriesOptions||c.storedQueriesOptions&&!c.storedQueriesOptions.available)return(0,jl.Z)(c);if(!c.storedQueriesOptions.storedquery_id)throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"');if(!c.storedQueriesOptions.longField)throw new Error('Stored Queries :You have to set "longField" to map the longitude coordinate to the query params.');if(!c.storedQueriesOptions.latField)throw new Error('Stored Queries :You have to set "latField" to map the latitude coordinate to the query params.');return c.storedQueriesOptions.outputformat=c.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",c.storedQueriesOptions.srsname=c.storedQueriesOptions.srsname||"EPSG:4326",c.storedQueriesOptions.resultTitle=c.storedQueriesOptions.resultTitle||c.resultTitle,c}return(0,v.Z)(t,[{key:"getId",value:function(){return t.id}},{key:"getType",value:function(){return t.type}},{key:"getDefaultOptions",value:function(){return{title:"Stored Queries (reverse)",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}}},{key:"reverseSearch",value:function(r,s){var l=this,c=this.computeRequestParams(r,s||{});return new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:c,responseType:"text"}).pipe((0,U.U)(function(u){return l.extractResults(l.extractWFSData(u))})):this.http.get(this.searchUrl,{params:c}).pipe((0,U.U)(function(u){return l.extractResults(l.extractWFSData(u))}))}},{key:"getFormatFromOptions",value:function(){var r,s=this.storedQueriesOptions.outputformat,l=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(s)&&(r=Ee.Z),l.test(s)&&(r=Co.Z),new r}},{key:"extractWFSData",value:function(r){var s=this.getFormatFromOptions(),l=Ee.Z,c=s.readFeatures(r);return JSON.parse((new l).writeFeatures(c))}},{key:"computeRequestParams",value:function(r,s){var l={};return l[this.storedQueriesOptions.longField]=r[0],l[this.storedQueriesOptions.latField]=r[1],new W.LE({fromObject:Object.assign({service:"WFS",version:"1.1.0",request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},l,this.params,s.params||{})})}},{key:"extractResults",value:function(r){var s=this;return r.features.map(function(l){return s.dataToResult(l)})}},{key:"dataToResult",value:function(r){var s=this.computeProperties(r),l=[this.getId(),s.type,r.id].join("."),c=r.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:be,projection:"EPSG:4326",geometry:r.geometry,properties:s,meta:{id:l,title:r.properties[c]}},meta:{dataType:be,id:l,title:r.properties[c],icon:"map-marker"}}}},{key:"computeProperties",value:function(r){var s=se.removeKeys(r.properties,t.propertiesBlacklist),l={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign(s,{type:r.properties.doc_type},l)}}]),t}(St);return i.id="storedqueriesreverse",i.type=be,i.propertiesBlacklist=[],i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG($),e.LFG(Te),e.LFG("options"))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),(0,ne.gn)([(0,$t.q)({maxCacheCount:20})],i.prototype,"reverseSearch",null),i}();function kx(i,a,n,t){return new Sp(i,a,n,t.getConfig("searchSources.".concat(Sp.id)))}function Fx(i,a,n,t){return new wp(i,a,n,t.getConfig("searchSources.".concat(wp.id)))}function il(i){return i.entityStore.getStrategyOfType(Qt).active$.pipe((0,U.U)(function(a){return a?"igo.geo.workspace.inMapExtent.active.tooltip":"igo.geo.workspace.inMapExtent.inactive.tooltip"}))}function rl(i){return i.entityStore.stateView.manyBy$(function(a){return!0===a.state.selected}).pipe((0,U.U)(function(a){return a.length>=1}))}function Ax(i,a){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&i){const n=e.oxw();e.xp6(1),e.Oqu(n.pointerCoord)}}const Lx=me.Bz.forChild([{path:"simple-map",component:(()=>{class i{constructor(n,t,o,r){this.languageService=n,this.dataSourceService=t,this.layerService=o,this.mediaService=r,this.pointerCoordDelay=0,this.map=new ct({controls:{attribution:{collapsed:!0},scaleLine:!0}}),this.view={center:[-73,47.2],zoom:6,rotation:.75},this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(s=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:s}))})}get media(){return this.mediaService.getMedia()}get isTouchScreen(){return this.mediaService.isTouchScreen()}onPointerMove(n){this.pointerCoord=n}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Et),e.Y36(Ge),e.Y36(xt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-simple-map"]],decls:21,vars:11,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/simple-map"],["igoPointerPosition","",3,"map","view","pointerPositionDelay","pointerPositionCoord"],[3,"infoContent"],["color","primary",3,"map"],["color","primary",3,"map","showIfNoRotation"],[4,"ngIf"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Simple Map"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e.NdJ("pointerPositionCoord",function(r){return t.onPointerMove(r)}),e._UZ(14,"igo-info-section",2)(15,"igo-zoom-button",3)(16,"igo-geolocate-button",3)(17,"igo-home-extent-button",3)(18,"igo-rotation-button",4)(19,"igo-wake-lock-button",3),e.qZA()(),e.YNc(20,Ax,2,1,"p",5)),2&n&&(e.xp6(13),e.Q6J("map",t.map)("view",t.view)("pointerPositionDelay",t.pointerCoordDelay),e.xp6(1),e.Q6J("infoContent",t.pointerCoord),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("map",t.map)("showIfNoRotation",!0),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("ngIf",!t.isTouchScreen))},dependencies:[C.O5,F.a8,F.dn,F.n5,F.$j,Be,vt,Ri,Ji,Bi,Oy,_y,gy],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:350px}"]}),i})()}]);let Ox=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,Lx,F.QW,I.ot,ft]}),i})();function Dx(i,a){if(1&i&&e._UZ(0,"igo-metadata-button",6)(1,"igo-download-button",6)(2,"igo-ogc-filter-button",7)(3,"igo-time-filter-button",7)(4,"igo-track-feature-button",8),2&i){const n=a.layer;e.Q6J("layer",n),e.xp6(1),e.Q6J("layer",n),e.xp6(1),e.Q6J("header",!0)("layer",n),e.xp6(1),e.Q6J("header",!0)("layer",n),e.xp6(1),e.Q6J("layer",n)("trackFeature",!0)}}const Ex=me.Bz.forChild([{path:"layer",component:(()=>{class i{constructor(n,t,o){this.languageService=n,this.dataSourceService=t,this.layerService=o,this.map=new ct({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],maxLayerZoomExtent:[-11e6,45e5,-45e5,1e7],zoom:7},this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",visible:!0,baseLayer:!0,source:c}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"shp"},ogcFilters:{enabled:!0,editable:!0,filters:{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"10043"}}}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"WFS ",visible:!0,source:c}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:"geojson_utf8",srsName:"EPSG:32198",outputFormatDownload:"shp"},ogcFilters:{enabled:!0,editable:!0,filters:{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"12072"}},formatOptions:{dataProjection:"EPSG:32198"}}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"WFS (Custom EPSG)",visible:!0,source:c,removable:!1}))}),this.layerService.createAsyncLayer({sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",optionsFromCapabilities:!0,params:{LAYERS:"parc_routier",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.layerService.createAsyncLayer({title:"R\xe9seau routier",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"bgr_v_sous_route_res_sup_act",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.layerService.createAsyncLayer({title:"lieu habit\xe9",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",optionsFromCapabilities:!0,params:{LAYERS:"lieuhabite",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.layerService.createAsyncLayer({title:"sh_dis_eco",visible:!1,sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",optionsFromCapabilities:!0,params:{LAYERS:"sh_dis_eco",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.layerService.createAsyncLayer({title:"nurc:Arc_Sample_Parent",visible:!1,legendOptions:{display:!0,stylesAvailable:[{name:"rain",title:"Pluie"},{name:"raster",title:"D\xe9faut"}]},sourceOptions:{type:"wms",url:"https://demo.geo-solutions.it/geoserver/ows",optionsFromCapabilities:!0,params:{LAYERS:"nurc:Arc_Sample",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.layerService.createAsyncLayer({title:"Avertissements routier",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"evenements",VERSION:"1.3.0"}}}).subscribe(c=>this.map.addLayer(c)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",refreshIntervalSec:15,params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"}}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle",source:c,metadata:{url:"https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp",extern:!0}}))})}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Et),e.Y36(Ge))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-layer"]],decls:19,vars:7,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/layer"],[3,"map","view"],["color","primary",3,"map"],["title","Layers"],["floatLabel","never",3,"map","layers","expandLegendOfVisibleLayers","queryBadge"],["igoLayerItemToolbar",""],[3,"layer"],[3,"header","layer"],[3,"layer","trackFeature"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Simple Map"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2),e.qZA(),e.TgZ(15,"igo-panel",3)(16,"igo-layer-list",4),e.YNc(17,Dx,5,8,"ng-template",null,5,e.W1O),e.qZA()()()),2&n&&(e.xp6(13),e.Q6J("map",t.map)("view",t.view),e.xp6(1),e.Q6J("map",t.map),e.xp6(2),e.Q6J("map",t.map)("layers",t.map.layers)("expandLegendOfVisibleLayers",!1)("queryBadge",!0))},dependencies:[F.a8,F.dn,F.n5,F.$j,Ut,Be,vt,ko,Gr,zi,Ki,Vo,ub],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]}),i})()}]);let $x=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Ex,F.QW,I.ot,O.Ps,Pt,ft,Fo,Jn,wo,Yr]}),i})();const Jx=me.Bz.forChild([{path:"legend",component:(()=>{class i{constructor(n,t,o){this.languageService=n,this.dataSourceService=t,this.layerService=o,this.map=new ct({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:7},this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(l=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",visible:!0,baseLayer:!0,source:l}))}),this.layerService.createAsyncLayer({title:"legend with display:false",visible:!0,legendOptions:{display:!1,html:"test html"},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",optionsFromCapabilities:!0,params:{LAYERS:"sh_dis_eco",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.layerService.createAsyncLayer({title:"legend in html",visible:!0,legendOptions:{display:!0,html:'<h2 style="background-color: blue;">HTML l\xe9gende</h2>'},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",optionsFromCapabilities:!1,params:{LAYERS:"sh_sreg_eco",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.layerService.createAsyncLayer({title:"legend with url param",visible:!0,legendOptions:{url:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxASEhUQEBISFRUVFRAQFRUQFRUVFRAPFRUWFhUVFRUYHSggGBolGxUVITEiJSkrLi4uFx8zODMsNygtLisBCgoKDg0OGhAQGy0dHyUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tKy0tLS0tLS0tLf/AABEIAKgBLAMBIgACEQEDEQH/xAAbAAABBQEBAAAAAAAAAAAAAAACAQMEBQYAB//EADwQAAIBAwEGAwYFAgUEAwAAAAECAAMEESEFEjFBUWETInEGFDKBkaFCscHR8FJyFSNTYoIzQ5LxFqLh/8QAGQEAAwEBAQAAAAAAAAAAAAAAAAECAwQF/8QAJREBAQACAgEFAAEFAAAAAAAAAAECERIhAwQTMUFRYRQiI3Gh/9oADAMBAAIRAxEAPwB0QhAEMTFQhCEEQhACEIQRFEYEIQgiEIAU6IIsAWLEnQAp0KmBqSdFBY+g5D1OBGD4nxYBHQafQzLPzTDLVbYeHLObh2LARwwyD+4PQiFNJZZuMrLLqlnRJ0ZFiTp0A6KEOM4OITuF8q4L8ydVp9sc2+0atrlw/hVGLBw2MnO66gsMdBpjHeYZeoxmXGOjH0+Vx5UsSLEm7ndEM6IYAhgmEYJgCGCYRgmIBMEwjAJgAmAYRgkwAGjTxxjGniBipGo5UjcAthCEAGEIwMQhAEIGAHFEERcxgYiiBmEDADzFgAxcwA50HMXMANh5H/tA+rrJhXy8JDXJDAcSpx6jB/SE18u6uuhGnqeU4vPP8m7+PR9N34tT9V20FZD4ifMcmHSSra5V1DKdD9Qeh7yLd1d4HAOJm7W9q27NlWKE55cOozzleLLTPz4b7bPM7MrbXbC1AFRQGb4d84OemP17Rk7YYsUREJUn8XxhfjI7gzp5xyXGrjMj3l5uYVfjYeX/AGrzb15D5mRau0N0Bt3e3uAVhoO56ympms1Z6lTtgaaDHAdgBiZZ+Tc1G3i8fe60FsN0AZ1iLUzXpDTRifqpHGVh2ioGMP8AIQtm3G9WUdmbX+04nNw3Y7+Wsb/peRJ0Qz0HkOMQzokQcTBM4xCYBxgGKTBJgCEwTFJgEwBCYBMUmCTABaMvHGMacxGZeNw3jUCWwMIGNAwgYwdBhAxoGEDAHAYQMbBigwBzMIGNAwgYA4DFzGwYWYwPMXMbzCBgD1PjxxylRUuEpv4J0PDXPx9BLNDrI17bMtd2PmVgrNngHwNdZzeeTqur02dm4RquAWK4A111yOxme2tXZicaAcuZGf3/ADl7UrFtRwA68x69jM/eVGffZcBkyxA0bdAGZHjna/Jl0pKdJmuFUN8A3ufyA+UGz3jVABIOWBOez5z05fWSrxs0qV2g1DbrY/pJAx35H6yMoxWDjhq2Ou8Dp/5GdDmBYsy7yF87rnGpx/NZfWd4yrg65JGeJHM6SjpjcthUK+apUI7glifyMnUKhV9zPH4vpjT7yMpteF0tL6qwAK6j0zr6x72YY1HLlQNwNnHMnQfrIyVAujHThx0lt7MhQKqjj5W/46iRjO42zyvG6XGYhMSJmdLjdmITOJgkwBSYJMQmITAOJgkziYJMA4mATOJgEwDiYBM4mATAOYxpzCJjTGIG3MbzFcwMwCzBhAxpQekPdPSPVLcOAwgYzgxd6GjPAwsxkNFDQB7MUNGhnpDCGPVLcOAxQY3unpFzA9nQYoMaBhAxBO2bS3qijvk+g1kXbFVqlY0qWAB56jHn0EnbPfw1ZzngeExu3L2qRu0iVNVtWGclQPyyZz+T+7LTfx9Y7XdfaNvRQh2ydFAXBJY6AADhrjjMlW2jRSqCyVFLb2vlO8uobKjQj9oT2lMUmpHILbp8TGSHU6b2OIzIVwtVt1moFmUEK9IhlI7a9esMJB5Ll9L1dnqLUCk29TJJ05KSfuAT9BK/w/PpodBwGdOGny9NInsrfstSpQq+UMDuqdd0jj+hkg4Fbf5Zzj7Qm5bKq9yWHLq1QUEeqd1UffAxx5LpzPDSU9G/pl2dKTnd0YlgCfly4R72huHqV6dKjhgi4wdBvEfY6SOthUGfFZKYbG8KZLVHA5Y5SsZNdoz3vpate0agXdyuQG3X4gH85P8AZ2p4dfdfmCgP+08P0lNcW3jDK090IMIc6jHAd47sWuxanv8AEFR8wZOuul7beoMEiBmFVyTnrGjmdHbmKTBJiZnYgCExCYpWAYg4mAWiEwC0AItAJiFoBaAKTAJiFoJMA5jGnMJjG2gDTmDmKwMHBhomsFsI4trLJLaP07aepxjjtqmNn2jbWA6TRi1gNbCK4Y0TLJnvch0hrZdpc+COkcShJ4YnyyVVOzjwtO0tVoiOCkJWoXalNnANl2l74U4UIaxPtRe59oq2faXvgTnTAJ0+gkZSKm2M9pK2F8NSQeOnT9pQJbFqbVq9ZRpujGm4O2ect/amoynLZ3dfh00PUzMW9AK2uMH4S3mHbAPOeLbvderJrUO+IHXcRqjqOBekx9QGUg4+RjKW1VGyhK9cAjP/ABM0lihGFqPT64Ua/wD1kza9gXVGViMHOFpv59eBMmZ96O4xjaNBxVNTdw7ndXPEA8TIj3JBPE68wdZtKeyvGTB31ZSSrqGTB5EZOT85namyqu97rk+Lx8TAx4e98Weu7p1zNMcti46VtrSZnFRR5hkH04D6ayStlU1YAknJydSPU/WaB9jigoCbxYnLMys28Txzidsy2KKcsxzyKFQO2WzFzK4M8XXIR9/e0KsWA83TdXQQrOo6VlBXy7+8OfHiJZ7QsS2rboA1UhRnI4a6SHswO9dd4g6jkVOnYiPG7icpp6LTtwVB7RDajpBt78DRvvH/AH1ZvPPYxvilR/dlne7iSPGUwHdYf1U/C9j+TDWwgGzzHGrATkuR1mmPqML8xN8GU+Ki1LDtGv8ADzLujWUyQKAM6Zhhe3PblOmaNlBNjNT7oOkZqW4j9vEuVZr3CC1oJoDbxipZw4Q+VULUBGzb9polsIZsBF7cHJmPdD0ie5zTe4RPcu0qeKJudaJbacaMaW9ne9TH3m3tnRTMUWxMKjWllQIMfvUe3FctnFNsZdLTE40BF7lPhFL7tE92ls9CR3oGL3aOEREoR8W8NaZEdEPdo4REa2kPaFLdQky33pA2yM0mHaTl5bqqmE2yF8ErJgg4xxI4ntnjMc9N0yppgINTUYjyjkWc8PQYlvR2luVGSrndUgZ6k8FH3k7aNrTqqoqaLxWmuSSepxr+vpPPn8uxmLFwrb9Niyg6u5O4D0A+Jzrw9Jq7C/p1BuFjjucHeHHOD3GnLnrpMnteg4ICEBVyCyjSmnMKvXlnnnAwDqxb3wUhcYxhDg5wF1K/fB6lm7StS9lu/bf+5Mo8gU548vrxMpG2NW8fxd8cMbpXQjP1kKx2zcAZVsjjg8DrJr+0tXnTXPDOsXU+D+Vi1uxH+YFUDnnOR+kp9pbVpou4nDUZ46+n8/SQ7zaNWpjeY45gcBKa+vV1GBk/U6/nz/8AcJjunbqHql+w1NUlTwHEHtrofQiFb3qrh38nJQOHqU5fKV1FN3LvjH9J4N0P84QqVJqzg/g7jgOhmmmdu2pvr1t1cZ1Gc/hP04SGu2WQ7rR2nWVk3AVwowN7OCZn9s13yKemBqMYixm+itaVdtA8DJ9ttANznm4uWXnLSy2lgZzDLx/gmbZ3lbTIMrqN6d7GZWU9rqeJkb3vLgrFMP1VybaxdidJorJmHGUGwwzAEiX7XAAwY/H5ssPhOfjmS0R1Mbq0hK1nIGQY5bXe8NTOvH1Eyc98OkoUYnu8RLgR9amZtM2dxAtvOahJIEBjK5xPFEqUwJBeprJt3UAEzdzdeY6zPLzaOePbcps9e0L/AA4dJW09o1BxWSKe1+oM5OUdXE89liAodYX+KrOF6hj5wcTyXhHGODaYkZipgG3Uw5jinC/U84a3APOVhsl6wDa9GMXKjiuBVWGMGUPgVOTSXRFQcY5kNLTwRIm0LfyH0MEXbDiI1dbSBUiPotMNtawR8OOKZO7nAL/zny5a6jF3l/cU3L587ZHDRKY00HLJ4dh3mr2lvhjVpkFMtvr1A79ZE8ajcDBAD8xzHQZ+k5rdNpNswdsOiDxBlm1HLGuhx24/MSDUuVxvU9NBkdcgZ/naX+1dj7zDGCNEHYAfw/OUd7sKoDoDz4fQSsbiLMg0L9eRZTofLwJ5nEsVvSQMEHn007zPvs6qOXI4wOcdt7e4A3TqOGvDMu4xPKrK8r1GGE0zrK0lE1Ygtr9ZEqUq+8QoYZ5dPST9mbHz56p0HIx6khbtqRs62asByAz5Tkj+cZZ3VZKaGjTxvt9usgXF+f8Ap0RjGBnkO8C2UJlmbLccnv0zJ190966iws3VFwQGxqe31lZcMu8TjGekds7nVmYZz5cc4l5bEciM8MjEufKag3FvkZWQDvLLClX3TumSXtlaVtOlNTZidJodhW53gWjFCgqydZVSGzIzvS8Me29s75KaY5yBd7Wzw+0qQ5PGMuxBnJa6pjFqu1anDlJFLaeBrKRq2kAVsysUZRa0/aDdfBOk0uydso/AzynajkHIh7P2g9MhgSJ1Y7nbmuq9sN0McZWXe1FHEiZq22m1ZNG+kS22O1U5ZjD3h7azvdrKRoZlbi5JYnM1dD2YTmWPzjh2BRGm4PpJ7vdPUnw0NGgx+IYhtbCW7UpFqWy88iGhtULa68ZKS1XtHfcFJyHM6tZNyePUG3NZ9DGXsao+FozVsq/4XEVLW6/1F+kWv4Dmo3A6GMV2uRwUH5yZv3K8d0wm2qy/HSPy1ho0K2vao+ND8pY09rrzBHqIFLbFBtOB7x2rbpUGVIilB9b6mw4iQ7w02U4xwMYr7PbGglXWsXXJ1Eq5CRQ1qLGk3hnO4xGP9szW6lQgklH+IngSM66GW3+IFC6qMgtu4P4uWgme2xc+bygZGpI7Hh9dJGrs9xOb3mm3HfGOXEAc+8JNsgndIKnkCMcOEpBt5kwTjQa4568B9oR21Tc+dRoQo7aZOvpF7d+4rnPqr1LpSQB3PXGRgfpGGZs4ABGn01IP86SppIh1QkajTPLOknWTMjEE59f6c4+uknjpUy2kJqx0Hy5aZlZtO6GoB04a8AeklOzZYKJQ3jK2jNjtLwxRlkb97J8qDA4EnnOe4Pwrr8v3nF6IGCfl1hU95x/lKFX+o8Zqz2KgAmrnXiB0mh9/NWhlk0XTMzFeg40G8x68pK2O1Viafhs2RoADmFn2UokUE4IkqpSKiC9AqcEFSDqDxEnOuV1itVIrLepvHEuLeljUyBQoYOZNNWZZ1rhE4NOqtI9N51SpMuDbloDVI2z44Rlt5jhQT/aM/lJFLZF2w0oVPmMfnNJGWWSDdJvSFd6LiXjez17/AKLfMr+8hXexrofFRf5YP5TWVjew+z+0igmq2f7UAYXHGU+xvZhviqndHTnLC62Va6qr+YDkRmZZZY29LmOWu24ttpBlGCIFVWJ4mZT2c2dVQ5Z/T0mqLGLnvo+Om4DwWAPKMLCDTfbLTmtUPLEaOzRyJj2/6wg8Ogrq+yHPwuZCqbGuR8NQ/OX+8YYc9fyhqBl22Rd/6sae0vV/Eh9QZqKtZxwUn+3EHxcjJRvprFYcrJVEqf8AdoBu6a/Yxmnof8moyH+ipn9ZsPBzqAV9RKu+2dVbiiOv0Mjirki2ntCVIS4XHLe5H5y2uHpumQRqJm721qoMeE7pzUgkj+085SJfvRPlLGm3JshkPTBi3Z8nqX4RtpWtKmlR6jYPiNu4x5RMlV2Z4qnwgxUebI54zgA8M/vNPV2OtxVFWuc0qYyFzoWJzrJVrWp1AapA8FDu00XgzD8Rx3hy0VxYil7NVCm8FJAIAAGdSAePPlIdXZaqPMCOJJweWh/Oenrf1ar+HTUIAN9ieRI8oA689eEZuEWoDSuAjZ47vlA7b2fN8oTy/o4fjzZaCqcjTHCPVr8annqPUHj+8l7Z2HUouSgLodQVGcfIcJR1mA0PPryM11Kjek6zqkNkNnXnKe8phqrdznEstnWdWq2KSlsfTHrNLsj2URH8W4IJ4hAeJ7mFymI1az+yNg75B0A5F8y7q0UoEK64HBWOCra6AGLta7u97IUIg0AQ4wO3IwrfaAqLuVNQ2hBBAJ7f0kdpF3e1TU6NeDSqkKh3W6/hbtkcD2jaq1u281XXBwFVgQegbGD9Yxf7JqU8VKJ38fhPxYGvz/PSS6hS5okjRlBOD8SkcQecc/4VDWvKdUZyS3VskyOwPIymt3K1N09cazTWNMtooLHoNZVx0UyRKNJzyku12RVqHyAn0ms2T7Lu2GqkAdBrNTQtqNEYAGn84CRdLlrIbO9i3YDxHx2XUy+tfY61p6shc/7tf/yWr7RxooP/AIn8sSK+0UY+YVVPZTg/XSLo7s74NOmMU6aL6LGffQ3lzg+kYN1RByXYf8WB9eOPtHqN5bVPxjPDJGDJCsudpVkbcYadeokG6vqg83FTx04TV07ZOJdHXln9JL8OnjAVT2wBCSj4YY12chcZzoMSds72NtUqeNVyznXU6D5cJqVorn/poMcMYMSuBzXP7R446K3Y1taOBhRpwkKvbrn4BCNUE+Rs9uYjqk8xH0O04Oen3hmQaVxHQ8pKauOs7HeRd4wlJ6wCSSP/AFBL9MxsRcmAPo/Uzt8dzGgIYWMONbtAas3yhPpIdZzHsaSTV7/eMXNJXGHVWHRgD+cbWqOAEcCdY52FTfbCouhRVZAcE+G3T1z9pSXexqlNadOnh0Vt473kxrkZHMCbMiRquDpJuMPahegtOmFGMsxZyPxdsyjvL2lTfKrvMRrnXHp0mpvLEOMA4lDtL2WqMd5GGnUcfpMbhdtJlNKOl7TVN4gBR2lXdWdC8rA1PIx0O7oGMXbOzqlFt90I5EjUGVlglZ6quadUIuSCqnX7TTDH7ic7GztLBLVXRMKgAJJ1Zmmd2rdMy75JGuF5GOUPfXfd3SygkgucEjlkTrzYl61QOyAqOQPOTwvLsTKadTu2NMipwA4HnGNneEy7yjUHjnOnTEtP/itzVQhmCZ+ZxFs/YitSXcVxgnU45RzHorlNoV9cimA3MlcfvHqQtCQ7O9NyDnChlIP9XD85p7T2ctwAKi75HNjmHfez1vU0A3ca+XT6yuPSeW2HX2cUtvU7iiykg+clGHyOn3m02PbW9BQDUTqSGBLH5cpW3fskRqnm7DQ/aV52Qy6MHHqTC205I2F17UUlG7SBbvwEz9z7Q12/Hx5KMYjVts4D8DH6mFb7IqbxCocciREfR+32rWHmZyf1k239oXPHQyPU2DXOuAOgzGDs9wQCsCae020rDDYj1SiG1plfRgCJkLi2qLjcU9TLjZVZ9CYocy0sjQdf+zSz/tHGLb+Lzor8s/vJi3MJLnJ0jvRy7O0Cw/CAPU/vHDUx3iUzn4sQXccBHpBqqik7w0PUfr1jxRzqpGO/WNEQPFxwMVitomHzHkqHrEnQkI5TrmOi4nTpRDW5jouDOnRmIV2jq3ESdFQJ68YJJnToASkLqZFr7S1wonTobBErMRrG3M6dEAKxkynV0nTowi3Qpt8QBi0FpcAonToEbr2VPO9gQhTUjAnTpROWniGyTp0ZK+uwBgb/AEE6dIqofpEwy4X4hn1nToqccbxQMhRH7a7zyAnToYlXVq0ZVA3ETp0mnB1LVcaxilQXOAIk6HxSSjSAEra+8moiTppZuJnRy3vAeJklWXOQZ06R8KO+IesBlnTo7Q//2Q=="},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",optionsFromCapabilities:!0,params:{LAYERS:"sh_reg_eco",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"shp"},ogcFilters:{enabled:!0,editable:!0,filters:{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"10043"}}}).subscribe(l=>{this.map.addLayer(this.layerService.createLayer({title:"WFS ",visible:!0,source:l}))}),this.layerService.createAsyncLayer({title:"Commission scolaire anglophone",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",params:{LAYERS:"WMS_MEQ_CS_ANGLO",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.layerService.createAsyncLayer({title:"R\xe9seau routier",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"bgr_v_sous_route_res_sup_act",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.layerService.createAsyncLayer({title:"lieu habit\xe9",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",optionsFromCapabilities:!0,params:{LAYERS:"lieuhabite",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.layerService.createAsyncLayer({title:"Avertissements routier",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"evenements",VERSION:"1.3.0"}}}).subscribe(l=>this.map.addLayer(l)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",refreshIntervalSec:15,params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"}}).subscribe(l=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle",visible:!0,source:l,metadata:{url:"https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp",extern:!0}}))})}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Et),e.Y36(Ge))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-legend"]],decls:17,vars:8,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/layer"],[3,"map","view"],["color","primary",3,"map"],["title","Legends"],[3,"layers","excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Simple Map with a legend list"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2),e.qZA(),e.TgZ(15,"igo-panel",3),e._UZ(16,"igo-layer-legend-list",4),e.qZA()()),2&n&&(e.xp6(13),e.Q6J("map",t.map)("view",t.view),e.xp6(1),e.Q6J("map",t.map),e.xp6(2),e.Q6J("layers",t.map.layers)("excludeBaseLayers",!0)("allowShowAllLegends",!0)("updateLegendOnResolutionChange",!1)("showAllLegendsValue",!1))},dependencies:[F.a8,F.dn,F.n5,F.$j,Ut,Be,vt,qi],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]}),i})()}]);let Bx=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Jx,F.QW,I.ot,O.Ps,Pt,ft,Fo,Jn,wo,Yr]}),i})();const Nx=me.Bz.forChild([{path:"overlay",component:(()=>{class i{constructor(n,t,o){this.languageService=n,this.dataSourceService=t,this.layerService=o,this.map=new ct({overlay:!0,controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:6}}ngOnInit(){this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(n=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:n}))})}ngAfterViewInit(){this.map.overlay.setFeatures([{type:be,projection:"EPSG:4326",meta:{id:1},properties:{},geometry:{type:"Point",coordinates:[-73,46.6]}},{type:be,projection:"EPSG:4326",meta:{id:2},properties:{},geometry:{type:"LineString",coordinates:[[-72,47.8],[-73.5,47.4],[-72.4,48.6]]}},{type:be,projection:"EPSG:4326",meta:{id:3},properties:{},geometry:{type:"Polygon",coordinates:[[[-71,46.8],[-73,47],[-71.2,46.6]]]}}],ce.None)}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Et),e.Y36(Ge))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-overlay"]],decls:15,vars:3,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/overlay"],[3,"map","view"],["color","primary",3,"map"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Overlay"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2),e.qZA()()),2&n&&(e.xp6(13),e.Q6J("map",t.map)("view",t.view),e.xp6(1),e.Q6J("map",t.map))},dependencies:[F.a8,F.dn,F.n5,F.$j,Be,vt],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]}),i})()}]);let qx=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Nx,F.QW,I.ot,ft,Xr]}),i})();function Gx(i,a){if(1&i){const n=e.EpF();e.TgZ(0,"igo-form",4),e.NdJ("submitForm",function(o){e.CHM(n);const r=e.oxw();return e.KtG(r.onSubmit(o))}),e.ALo(1,"async"),e._UZ(2,"igo-form-group",5),e.TgZ(3,"div",6)(4,"button",7),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.fillForm())}),e._uU(5," Fill Form "),e.qZA(),e.TgZ(6,"button",7),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.clearForm())}),e._uU(7," Clear Form "),e.qZA(),e.TgZ(8,"button",8),e._uU(9," Submit "),e.qZA()()()}if(2&i){const n=a.ngIf,t=e.oxw();e.Q6J("form",n)("formData",e.lcZ(1,4,t.data$)),e.xp6(2),e.Q6J("group",n.groups[0]),e.xp6(6),e.Q6J("disabled",t.submitDisabled)}}const Yx=me.Bz.forChild([{path:"geometry",component:(()=>{class i{constructor(n,t,o,r){this.languageService=n,this.formService=t,this.dataSourceService=o,this.layerService=r,this.map=new ct({controls:{attribution:{collapsed:!0},scaleLine:!0}}),this.view={center:[-73,47.2],zoom:15},this.form$=new x.X(void 0),this.data$=new x.X(void 0),this.submitDisabled=!0}ngOnInit(){this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(r=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:r}))});const t=[{name:"geometry",title:"Geometry",options:{validator:S.kI.required},type:"geometry",inputs:{map:this.map,geometryTypeField:!0,geometryType:"Polygon",drawGuideField:!0,drawGuide:50,drawGuidePlaceholder:"Draw Guide",drawStyle:new ee.ZP({stroke:new K.Z({color:[255,0,0,1],width:2}),fill:new te.Z({color:[255,0,0,.2]}),image:new Ue.Z({radius:8,stroke:new K.Z({color:[255,0,0,1]}),fill:new te.Z({color:[255,0,0,.2]})})})}},{name:"name",title:"Name",options:{validator:S.kI.required}}].map(r=>this.formService.field(r)),o=this.formService.form([],[this.formService.group({name:"info"},t)]);this.valueChanges$$=o.control.valueChanges.subscribe(()=>{this.submitDisabled=!o.control.valid}),this.form$.next(o)}ngOnDestroy(){this.valueChanges$$.unsubscribe()}fillForm(){this.data$.next({name:"Place",geometry:JSON.stringify({type:"Polygon",coordinates:[[[-106,42],[-107,31],[-81,32],[-82,42],[-106,42]]]})})}clearForm(){this.form$.value.control.reset()}onSubmit(n){alert(JSON.stringify(n))}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Ea),e.Y36(Et),e.Y36(Ge))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-geometry"]],decls:13,vars:6,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/form"],[3,"map","view"],["color","primary",3,"map"],[3,"form","formData","submitForm",4,"ngIf"],[3,"form","formData","submitForm"],[3,"group"],["formButtons",""],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Geometry Form"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.TgZ(9,"igo-map-browser",1),e._UZ(10,"igo-zoom-button",2),e.qZA(),e.YNc(11,Gx,10,6,"igo-form",3),e.ALo(12,"async"),e.qZA()),2&n&&(e.xp6(9),e.Q6J("map",t.map)("view",t.view),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("ngIf",e.lcZ(12,4,t.form$)))},dependencies:[C.O5,I.lW,F.a8,F.dn,F.n5,F.$j,Pa,Ol,Be,vt,C.Ov],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}igo-map-browser[_ngcontent-%COMP%]{width:500px;height:500px}"]}),i})()}]);let jx=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,Yx,I.ot,F.QW,Ci,Es,ft]}),i})();const Vx=me.Bz.forChild([{path:"feature",component:(()=>{class i{constructor(n,t,o){this.languageService=n,this.dataSourceService=t,this.layerService=o,this.map=new ct({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:6},this.tableTemplate={selection:!0,selectMany:!0,sort:!0,columns:[{name:"properties.id",title:"ID"},{name:"properties.name",title:"Name"},{name:"properties.description",title:"Description"}]},this.store=new Dt([],{map:this.map})}ngOnInit(){const n=new an({});this.store.addStrategy(n);const t=new Bt({map:this.map,motion:ce.Default});this.store.addStrategy(t),this.store.load([{meta:{id:1},type:"Feature",geometry:{type:"Point",coordinates:[-72,47.8]},projection:"EPSG:4326",properties:{id:1,name:"Name 1",description:"Description 1"}},{meta:{id:4},type:"Feature",geometry:{type:"Point",coordinates:[-71,46.8]},projection:"EPSG:4326",properties:{id:4,name:"Name 4",description:"Description 4"}},{meta:{id:5},type:"Feature",geometry:{type:"Point",coordinates:[-73,45.8]},projection:"EPSG:4326",properties:{id:5,name:"Name 5",description:"Description 5"}},{meta:{id:2},type:"Feature",geometry:{type:"LineString",coordinates:[[-72,47.8],[-73.5,47.4],[-72.4,48.6]]},projection:"EPSG:4326",properties:{id:2,name:"Name 2",description:"Description 2"}},{meta:{id:3},type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71,46.8],[-73,47],[-71.2,46.6]]]},projection:"EPSG:4326",properties:{id:3,name:"Name 3",description:"Description 3"}}]),this.layerService.createAsyncLayer({title:"MVT test",visible:!0,sourceOptions:{type:"mvt",url:"https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf",queryable:!0},mapboxStyle:{url:"assets/mapboxStyleExample-vectortile.json",source:"ahocevar"}}).subscribe(o=>this.map.addLayer(o)),this.dataSourceService.createAsyncDataSource({type:"vector"}).subscribe(o=>{const r=this.layerService.createLayer({title:"Vector Layer",source:o,animation:{duration:2e3},mapboxStyle:{url:"assets/mapboxStyleExample-feature.json",source:"source_nameX"}});this.map.addLayer(r),this.store.bindLayer(r),n.activate(),t.activate()})}ngOnDestroy(){this.store.destroy()}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Et),e.Y36(Ge))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-feature"]],decls:12,vars:5,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geom/feature"],[3,"map","view"],["color","primary",3,"map"],[3,"store","template"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Feature"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.TgZ(9,"igo-map-browser",1),e._UZ(10,"igo-zoom-button",2),e.qZA(),e._UZ(11,"igo-entity-table",3),e.qZA()),2&n&&(e.xp6(9),e.Q6J("map",t.map)("view",t.view),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("store",t.store)("template",t.tableTemplate))},dependencies:[F.a8,F.dn,F.n5,F.$j,ho,Be,vt],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]}),i})()}]);let zx=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Vx,C.ez,F.QW,I.ot,O.Ps,Pt,$o,ft,Rn]}),i})();const Kx=me.Bz.forChild([{path:"hover",component:(()=>{class i{constructor(n,t,o,r){this.languageService=n,this.dataSourceService=t,this.layerService=o,this.mediaService=r,this.pointerCoordDelay=0,this.pointerHoverFeatureDelay=0,this.map=new ct({controls:{attribution:{collapsed:!0},scaleLine:!0}}),this.view={center:[-73,47.2],zoom:8,projection:"EPSG:3857"},this.dataSourceService.createAsyncDataSource({type:"wmts",url:"https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts",layer:"carte_gouv_qc_public",matrixSet:"EPSG_3857",version:"1.3.0"}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"Quebec",visible:!0,baseLayer:!0,source:c}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"adn_bassin_n1_public_v",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"3.0.0",outputFormat:void 0,outputFormatDownload:"shp"}}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"WFS (polygon)",visible:!0,source:c}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",params:{featureTypes:"MSP_CASERNE_PUBLIC",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"shp"}}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"WFS (point)",visible:!0,source:c,styleByAttribute:{attribute:"en_caserne",data:["true","false"],stroke:["red","blue"],fill:["#ffffff","#ffffff"],radius:[7,7],width:[2,2]},hoverStyle:{label:{attribute:"Caserne: ${no_caserne}\xa0\n Mun: ${nom_ssi}",style:{textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:{color:"#000"},backgroundFill:{color:"rgba(255, 255, 255, 0.5)"},backgroundStroke:{color:"rgba(200, 200, 200, 0.75)",width:2},stroke:{color:"#fff",width:3},overflow:!0,offsetX:20,offsetY:10,padding:[2.5,2.5,2.5,2.5]}},baseStyle:{circle:{stroke:{color:"orange",width:5},width:[5],radius:15}}}}))})}get media(){return this.mediaService.getMedia()}get isTouchScreen(){return this.mediaService.isTouchScreen()}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Et),e.Y36(Ge),e.Y36(xt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-hover"]],decls:18,vars:9,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/hover"],["igoHoverFeature","",3,"map","view","igoHoverFeatureDelay","igoHoverFeatureEnabled"],["color","primary",3,"map"],["color","primary",3,"map","showIfNoRotation"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Hover"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2)(15,"igo-geolocate-button",2)(16,"igo-home-extent-button",2)(17,"igo-rotation-button",3),e.qZA()()),2&n&&(e.xp6(13),e.Q6J("map",t.map)("view",t.view)("igoHoverFeatureDelay",t.pointerHoverFeatureDelay)("igoHoverFeatureEnabled",!0),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("map",t.map)("showIfNoRotation",!0))},dependencies:[F.a8,F.dn,F.n5,F.$j,Be,vt,Ri,Ji,Bi,fy],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:500px}"]}),i})()}]);let Xx=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,Kx,F.QW,I.ot,ft]}),i})();const tk=me.Bz.forChild([{path:"measure",component:(()=>{class i{constructor(n,t,o){this.languageService=n,this.dataSourceService=t,this.layerService=o,this.map=new ct({controls:{attribution:{collapsed:!0},scaleLine:!0}}),this.view={center:[-73,47.2],zoom:6,projection:"EPSG:3857"},this.store=new Dt([],{map:this.map}),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(r=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:r}))})}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Et),e.Y36(Ge))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-measure"]],decls:16,vars:5,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/measure"],[3,"map","view"],["color","primary",3,"map"],[3,"store","map"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Simple Map"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2),e.qZA(),e._UZ(15,"igo-measurer",3),e.qZA()),2&n&&(e.xp6(13),e.Q6J("map",t.map)("view",t.view),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("store",t.store)("map",t.map))},dependencies:[F.a8,F.dn,F.n5,F.$j,Be,vt,Ps],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-measurer[_ngcontent-%COMP%]     mat-divider{position:inherit!important;left:inherit!important;width:160px!important}"]}),i})()}]);let nk=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[tk,F.QW,ft,Eu]}),i})();const ik=me.Bz.forChild([{path:"draw",component:(()=>{class i{constructor(n,t,o,r){this.languageService=n,this.dataSourceService=t,this.layerService=o,this.mapService=r,this.map=new ct({controls:{attribution:{collapsed:!0},scaleLine:!0}}),this.view={center:[-73,47.2],zoom:6,projection:"EPSG:3857"},this.stores=[],this.mapService.setMap(this.map),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(s=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:s}))})}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Et),e.Y36(Ge),e.Y36(Vt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-draw"]],decls:16,vars:5,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/draw"],[3,"map","view"],["color","primary",3,"map"],[3,"stores","map"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Simple Map"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2),e.qZA(),e._UZ(15,"igo-draw",3),e.qZA()),2&n&&(e.xp6(13),e.Q6J("map",t.map)("view",t.view),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("stores",t.stores)("map",t.map))},dependencies:[F.a8,F.dn,F.n5,F.$j,Be,vt,su],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-draw[_ngcontent-%COMP%]     mat-divider{position:inherit!important;left:inherit!important;width:160px!important}"]}),i})()}]);let rk=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[ik,F.QW,ft,fu]}),i})();function ak(i,a){if(1&i&&(e.ynx(0),e.TgZ(1,"h1"),e._uU(2,"Query Title : "),e.TgZ(3,"span",5),e._uU(4),e.qZA()(),e._UZ(5,"igo-feature-details",6),e.BQk()),2&i){const n=a.ngIf,t=e.oxw();e.xp6(4),e.Oqu(t.getTitle(n)),e.xp6(1),e.Q6J("feature",n)}}const lk=me.Bz.forChild([{path:"query",component:(()=>{class i{constructor(n,t,o,r){this.languageService=n,this.dataSourceService=t,this.layerService=o,this.overlayService=r,this.feature$=new x.X(void 0),this.map=new ct({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:6},this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(s=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:s}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryable:!0,queryTitle:"num_rts",params:{layers:"bgr_v_sous_route_res_sup_act",version:"1.3.0"}}).subscribe(s=>{this.map.addLayer(this.layerService.createLayer({title:"WMS",source:s,sourceOptions:s.options}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryable:!0,queryFormat:Xe.HTMLGML2,queryHtmlTarget:fn.IFRAME,params:{layers:"bgr_v_sous_route_res_sup_act",version:"1.3.0"}}).subscribe(s=>{this.map.addLayer(this.layerService.createLayer({title:"WMS html with a pre call in GML",source:s,sourceOptions:s.options}))}),this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0,queryTitle:"So beautiful ${name}",sourceFields:[{name:"name",alias:"Alias name"},{name:"description",alias:"Alias description"}]}).subscribe(s=>{this.map.addLayer(this.layerService.createLayer({title:"Vector Layer",source:s,sourceOptions:s.options})),this.addFeatures(s)})}addFeatures(n){const t=new nt.Z({name:"feature1",geometry:new dn.Z([re.vs([-72,47.8],"EPSG:4326","EPSG:3857"),re.vs([-73.5,47.4],"EPSG:4326","EPSG:3857"),re.vs([-72.4,48.6],"EPSG:4326","EPSG:3857")])}),o=new nt.Z({name:"feature2",geometry:new He.Z(re.vs([-73,46.6],"EPSG:4326","EPSG:3857"))}),r=new nt.Z({name:"feature3",geometry:new Tn.ZP([[re.vs([-71,46.8],"EPSG:4326","EPSG:3857"),re.vs([-73,47],"EPSG:4326","EPSG:3857"),re.vs([-71.2,46.6],"EPSG:4326","EPSG:3857")]])});n.ol.addFeatures([t,o,r]),this.layerService.createAsyncLayer({title:"Vector tile with custom getfeatureinfo url",visible:!0,sourceOptions:{type:"mvt",url:"https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf",queryable:!0,queryUrl:"https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=wms_mern_reg_admin&LAYERS=wms_mern_reg_admin&DPI=96&MAP_RESOLUTION=96&FORMAT_OPTIONS=dpi%3A96&INFO_FORMAT=geojson&FEATURE_COUNT=5&I=50&J=50&CRS=EPSG:{srid}&STYLES=&WIDTH=101&HEIGHT=101&BBOX={xmin},{ymin},{xmax},{ymax}",queryLayerFeatures:!1,queryFormat:"geojson"},mapboxStyle:{url:"assets/mapboxStyleExample-vectortile.json",source:"ahocevar"}}).subscribe(s=>this.map.addLayer(s)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/incendie.fcgi",queryable:!0,queryUrl:"https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=SDA_MUNIC_S_20K&LAYERS=SDA_MUNIC_S_20K&DPI=96&MAP_RESOLUTION=96&FORMAT_OPTIONS=dpi%3A96&INFO_FORMAT=geojson&FEATURE_COUNT=5&I=50&J=50&CRS=EPSG:{srid}&STYLES=&WIDTH=101&HEIGHT=101&BBOX={xmin},{ymin},{xmax},{ymax}",queryFormat:"geojson",params:{layers:"caserne",version:"1.3.0"}}).subscribe(s=>{this.map.addLayer(this.layerService.createLayer({title:"WMS with custom getfeatureinfo url",source:s,sourceOptions:s.options}))})}handleQueryResults(n){const t=n.features;let o;t.length&&t[0]&&(o=t[0],this.feature$.next(o),this.map.queryResultsOverlay.setFeatures([o],ce.None))}getTitle(n){return en(n)}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Et),e.Y36(Ge),e.Y36(Gs))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-query"]],decls:18,vars:7,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/query"],["igoOverlay","","igoQuery","",3,"map","view","queryFeatures","query"],["color","primary",3,"map"],["title","Details"],[4,"ngIf"],[2,"background-color","#e0e0e0"],[3,"feature"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Query"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e.NdJ("query",function(r){return t.handleQueryResults(r)}),e._UZ(14,"igo-zoom-button",2),e.qZA(),e.TgZ(15,"igo-panel",3),e.YNc(16,ak,6,2,"ng-container",4),e.ALo(17,"async"),e.qZA()()),2&n&&(e.xp6(13),e.Q6J("map",t.map)("view",t.view)("queryFeatures",!0),e.xp6(1),e.Q6J("map",t.map),e.xp6(2),e.Q6J("ngIf",e.lcZ(17,5,t.feature$)))},dependencies:[C.O5,F.a8,F.dn,F.n5,F.$j,Ut,Be,vt,hw,qc,Mo,C.Ov],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]}),i})()}]);let ck=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[lk,C.ez,F.QW,I.ot,O.Ps,Pt,ft,Xr,tr,Rn]}),i})();const pk=me.Bz.forChild([{path:"catalog",component:(()=>{class i{constructor(n,t,o,r,s){this.configService=n,this.languageService=t,this.layerService=o,this.catalogService=r,this.storageService=s,this.map=new ct({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:7},this.catalogStore=new mt([]),this.catalogItemStore=new mt([])}ngOnInit(){this.layerService.createAsyncLayer({title:"OSM",sourceOptions:{type:"osm"}}).subscribe(n=>this.map.addLayer(n)),this.loadCatalogs()}onCatalogSelectChange(n){this.loadCatalogItems(n.catalog)}loadCatalogs(){this.catalogService.loadCatalogs().subscribe(n=>{this.catalogStore.clear(),this.catalogStore.load(n.concat(this.storageService.get("addedCatalogs")||[]))})}loadCatalogItems(n){this.catalogService.loadCatalogItems(n).subscribe(t=>{this.catalogItemStore.clear(),this.catalogItemStore.load(t)})}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(j),e.Y36($),e.Y36(Ge),e.Y36(ws),e.Y36(Te))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-catalog"]],decls:23,vars:6,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/catalog"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments"],[3,"map","view"],["color","primary",3,"map"],["title","Catalog Library"],[3,"store","catalogSelectChange"],["title","Catalog Browser"],[3,"store","map"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Catalog"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: ConfigService, LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"br"),e._uU(13," See catalog section of the "),e.TgZ(14,"a",1),e._uU(15," environment config"),e.qZA(),e._UZ(16,"hr"),e.qZA(),e.TgZ(17,"igo-map-browser",2),e._UZ(18,"igo-zoom-button",3),e.qZA(),e.TgZ(19,"igo-panel",4)(20,"igo-catalog-library",5),e.NdJ("catalogSelectChange",function(r){return t.onCatalogSelectChange(r)}),e.qZA()(),e.TgZ(21,"igo-panel",6),e._UZ(22,"igo-catalog-browser",7),e.qZA()()),2&n&&(e.xp6(17),e.Q6J("map",t.map)("view",t.view),e.xp6(1),e.Q6J("map",t.map),e.xp6(2),e.Q6J("store",t.catalogStore),e.xp6(2),e.Q6J("store",t.catalogItemStore)("map",t.map))},dependencies:[F.a8,F.dn,F.n5,F.$j,Ut,Be,vt,Ts,Ls],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]}),i})()}]);let dk=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[ha({default:ja.igo})],imports:[C.ez,pk,F.QW,I.ot,O.Ps,J.AV,sr,Pt,ft,uu]}),i})();var gk=k(39051);Error,Error;var qt=function(){return(i=qt||(qt={}))[i.null=0]="null",i[i.read=1]="read",i[i.write=2]="write",qt;var i}(),yn=function(){var i=function(){function a(n,t,o,r,s,l,c){var u=this;(0,h.Z)(this,a),this.http=n,this.authService=t,this.languageService=o,this.config=r,this.messageService=s,this.storageService=l,this.route=c,this.context$=new x.X(void 0),this.contexts$=new x.X({ours:[]}),this.defaultContextId$=new x.X(void 0),this.editedContext$=new x.X(void 0),this.importedContext=[],this.toolsChanged$=new $e.x,this.mapViewFromRoute={},this.options=Object.assign({basePath:"contexts",contextListFile:"_contexts.json",defaultContextUri:"_default"},this.config.getConfig("context")),this.baseUrl=this.options.url,this.readParamsFromRoute(),this.authService.hasAuthService?this.authService.logged$.subscribe(function(p){p&&(u.contexts$.pipe((0,uo.T)(1),(0,An.P)()).subscribe(function(d){u.handleContextsChange()}),u.loadContexts())}):(this.loadContexts(),this.handleContextsChange(!1))}return(0,v.Z)(a,[{key:"defaultContextUri",get:function(){return this.storageService.get("favorite.context.uri")||this._defaultContextUri||this.options.defaultContextUri},set:function(t){this._defaultContextUri=t}},{key:"get",value:function(t,o){var r=this.baseUrl+"/contexts";return t&&this.authService.authenticated&&(r+="?permission="+t.join(),o&&(r+="&hidden=true")),this.http.get(r)}},{key:"getById",value:function(t){return this.http.get(this.baseUrl+"/contexts/"+t)}},{key:"getDetails",value:function(t){var o=this,r="".concat(this.baseUrl,"/contexts/").concat(t,"/details");return this.http.get(r).pipe((0,Ze.K)(function(s){throw o.handleError(s,t),s}))}},{key:"getDefault",value:function(){var t=this;if(this.authService.authenticated)return this.http.get(this.baseUrl+"/contexts/default").pipe((0,qo.b)(function(s){t.defaultContextId$.next(s.id)}));var r=this.storageService.get("favorite.context.uri");return this.defaultContextId$.next(r),this.getContextByUri(r)}},{key:"getProfilByUser",value:function(){return this.baseUrl?this.http.get(this.baseUrl+"/profils?"):(0,ge.of)([])}},{key:"setDefault",value:function(t){return this.authService.authenticated?this.http.post(this.baseUrl+"/contexts/default",{defaultContextId:t}):(this.storageService.set("favorite.context.uri",t),(0,ge.of)(void 0))}},{key:"hideContext",value:function(t){return this.http.post(this.baseUrl+"/contexts/"+t+"/hide",{})}},{key:"showContext",value:function(t){return this.http.post(this.baseUrl+"/contexts/"+t+"/show",{})}},{key:"delete",value:function(t){var o=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s={ours:[]};if(Object.keys(this.contexts$.value).forEach(function(c){return s[c]=o.contexts$.value[c].filter(function(u){return u.id!==t})}),r)return this.importedContext=this.importedContext.filter(function(c){return c.id!==t}),(0,ge.of)(this.contexts$.next(s));var l=this.baseUrl+"/contexts/"+t;return this.http.delete(l).pipe((0,qo.b)(function(c){o.contexts$.next(s)}))}},{key:"create",value:function(t){var o=this;return this.http.post(this.baseUrl+"/contexts",t).pipe((0,U.U)(function(s){return s.permission=o.authService.authenticated?qt[qt.write]:qt[qt.read],o.contexts$.value.ours.unshift(s),o.contexts$.next(o.contexts$.value),s}))}},{key:"clone",value:function(t){var o=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.baseUrl+"/contexts/"+t+"/clone";return this.http.post(s,r).pipe((0,U.U)(function(l){return l.permission=qt[qt.write],o.contexts$.value.ours.unshift(l),o.contexts$.next(o.contexts$.value),l}))}},{key:"update",value:function(t,o){return this.http.patch(this.baseUrl+"/contexts/"+t,o)}},{key:"addToolAssociation",value:function(t,o){var r="".concat(this.baseUrl,"/contexts/").concat(t,"/tools");return this.http.post(r,{toolId:o})}},{key:"deleteToolAssociation",value:function(t,o){var r="".concat(this.baseUrl,"/contexts/").concat(t,"/tools/").concat(o);return this.http.delete(r)}},{key:"getPermissions",value:function(t){return this.http.get(this.baseUrl+"/contexts/"+t+"/permissions")}},{key:"addPermissionAssociation",value:function(t,o,r){var s=this,l="".concat(this.baseUrl,"/contexts/").concat(t,"/permissions");return this.http.post(l,{profil:o,typePermission:r}).pipe((0,Ze.K)(function(u){throw s.handleError(u,void 0,!0),[u]}))}},{key:"deletePermissionAssociation",value:function(t,o){var r="".concat(this.baseUrl,"/contexts/").concat(t,"/permissions/").concat(o);return this.http.delete(r)}},{key:"getLocalContexts",value:function(){var t=this.getPath(this.options.contextListFile);return this.http.get(t).pipe((0,U.U)(function(o){return{ours:o}}))}},{key:"getLocalContext",value:function(t){var o=this,r=this.getPath("".concat(t,".json"));return this.http.get(r).pipe((0,Vl.z)(function(s){if(!s.base)return(0,ge.of)(s);var l=o.getPath("".concat(s.base,".json"));return o.http.get(l).pipe((0,U.U)(function(c){var u=s;return u.map=se.mergeDeep(c.map,s.map),u.layers=(c.layers||[]).concat(s.layers||[]).reverse().filter(function(p,d,g){return!p.id||g.findIndex(function(f){return f.id===p.id})===d}).reverse(),u.toolbar=s.toolbar||c.toolbar,u.message=s.message||c.message,u.messages=s.messages||c.messages,u.tools=(s.tools||[]).concat(c.tools||[]).filter(function(p,d,g){return g.findIndex(function(f){return f.name===p.name})===d}),u}),(0,Ze.K)(function(c){throw o.handleError(c,t),c}))}),(0,Ze.K)(function(s){throw o.handleError(s,t),s}))}},{key:"loadContexts",value:function(t,o){var r=this;(this.baseUrl?this.get(t,o):this.getLocalContexts()).subscribe(function(l){l.ours=r.importedContext.concat(l.ours),r.contexts$.next(l)})}},{key:"loadDefaultContext",value:function(){var t=this,o=function(){var s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!s&&t.baseUrl&&t.authService.authenticated?t.getDefault().subscribe(function(l){t.defaultContextUri=l.uri,t.addContextToList(l),t.setContext(l)},function(){t.defaultContextId$.next(void 0),t.loadContext(t.defaultContextUri)}):t.loadContext(t.defaultContextUri)};this.route&&this.route.options.contextKey?this.route.queryParams.pipe((0,De.b)(100)).subscribe(function(r){var s=r[t.route.options.contextKey],l=!1;s&&(t.defaultContextUri=s,l=!0),o(l)}):o()}},{key:"loadContext",value:function(t){var o=this,r=this.context$.value;r&&r.uri===t||this.getContextByUri(t).pipe((0,An.P)()).subscribe(function(s){o.addContextToList(s),o.setContext(s)},function(s){t!==o.options.defaultContextUri&&o.loadContext(o.options.defaultContextUri)})}},{key:"setContext",value:function(t){this.handleContextMessage(t);var o=this.context$.value;if(o&&t&&t.id===o.id)return void 0===t.map.view.keepCurrentView&&(t.map.view.keepCurrentView=!0),void this.context$.next(t);t.map||(t.map={view:{}}),Object.assign(t.map.view,this.mapViewFromRoute),this.context$.next(t)}},{key:"loadEditedContext",value:function(t){var o=this;this.getContextByUri(t).subscribe(function(r){o.setEditedContext(r)})}},{key:"setEditedContext",value:function(t){this.editedContext$.next(t)}},{key:"getContextFromMap",value:function(t,o){var u,r=t.ol.getView(),s=r.getProjection().getCode(),l=new He.Z(r.getCenter()).transform(s,"EPSG:4326"),c={uri:Ye(),title:"",scope:"private",map:{view:{center:l.getCoordinates(),zoom:r.getZoom(),projection:s,maxZoomOnExtent:t.viewController.maxZoomOnExtent}},layers:[],tools:[]};u=!0===o?t.layers$.getValue().filter(function(_){return!0===_.baseLayer||"searchPointerSummaryId"===_.options.id}).sort(function(_,b){return _.zIndex-b.zIndex}):t.layers$.getValue().filter(function(_){return!_.id.includes("WfsWorkspaceTableDest")}).sort(function(_,b){return _.zIndex-b.zIndex});var g,p=0,d=(0,D.Z)(u);try{for(d.s();!(g=d.n()).done;){var m=g.value,y={id:m.options.id?String(m.options.id):void 0,layerOptions:{title:m.options.title,zIndex:++p,visible:m.visible},sourceOptions:{type:m.dataSource.options.type,params:m.dataSource.options.params,url:m.dataSource.options.url,queryable:m.queryable}};y.sourceOptions.type&&c.layers.push(y)}}catch(_){d.e(_)}finally{d.f()}return c.tools=this.tools.map(function(_){return{id:String(_.id),global:_.global}}),c}},{key:"getContextFromLayers",value:function(t,o,r){var s=this.context$.getValue(),l=t.ol.getView(),c=l.getProjection().getCode(),p={uri:r,title:r,map:{view:{center:new He.Z(l.getCenter()).transform(c,"EPSG:4326").getCoordinates(),zoom:l.getZoom(),projection:c}},layers:[],toolbar:[],tools:[],extraFeatures:[]},d=t.layers$.getValue();return p.layers=d.filter(function(g){return g.baseLayer}).map(function(g){return{baseLayer:!0,sourceOptions:g.options.sourceOptions,title:g.options.title,visible:g.visible}}),o.forEach(function(g){var f=s.layers.find(function(A){var L=A.source;return L&&g.id===L.id&&!A.baseLayer});if(f){var m=f.style;f.styleByAttribute?m=void 0:f.clusterBaseStyle&&(m=void 0,delete f.sourceOptions.source,delete f.sourceOptions.format),p.layers.push({baseLayer:f.baseLayer,title:g.options.title,zIndex:g.zIndex,styleByAttribute:f.styleByAttribute,clusterBaseStyle:f.clusterBaseStyle,style:m,clusterParam:f.clusterParam,visible:g.visible,opacity:g.opacity,sourceOptions:f.sourceOptions})}else if(g.ol.getSource()instanceof nn.Z){var b,w=new Ee.Z;if(g.ol.getSource()instanceof Xl.Z){var T=g.ol.getSource();b=w.writeFeatures(T.getFeatures(),{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})}else{var M=g.ol.getSource();b=w.writeFeatures(M.getFeatures(),{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})}(b=JSON.parse(b)).name=g.options.title,p.extraFeatures.push(b)}else{var _=g.options;_.zIndex=g.zIndex,delete _.source,p.layers.push(_)}}),p.toolbar=this.toolbar,p.tools=this.tools,p}},{key:"setTools",value:function(t){this.tools=t}},{key:"setToolbar",value:function(t){this.toolbar=t}},{key:"handleContextMessage",value:function(t){var o=this;this.context$.value&&t.uri&&this.context$.value.uri!==t.uri&&this.messageService.removeAllAreNotError(),t.messages=t.messages?t.messages:[],t.messages.push(t.message),t.messages.map(function(r){r&&o.messageService.message(r)})}},{key:"getContextByUri",value:function(t){if(this.baseUrl){for(var o,r=0,s=Object.keys(this.contexts$.value);r<s.length&&!(o=this.contexts$.value[s[r]].find(function(p){return p.uri===t}));r++);return o&&o.imported?(0,ge.of)(o):this.getDetails(o?o.id:t)}var u=this.contexts$.value.ours.find(function(p){return p.uri===t&&!0===p.imported});return u?(0,ge.of)(u):this.getLocalContext(t)}},{key:"getContextLayers",value:function(t){var o=[];return t.layers$.getValue().forEach(function(s){!s.baseLayer&&"searchPointerSummaryId"!==s.options.id&&o.push(s)}),o}},{key:"readParamsFromRoute",value:function(){var t=this;!this.route||this.route.queryParams.subscribe(function(o){var r=t.route.options.centerKey;r&&o[r]&&(t.mapViewFromRoute.center=o[r].split(",").map(Number));var l=t.route.options.projectionKey;l&&o[l]&&(t.mapViewFromRoute.projection=o[l]);var u=t.route.options.zoomKey;u&&o[u]&&(t.mapViewFromRoute.zoom=Number(o[u]))})}},{key:"getPath",value:function(t){var o=this.options.basePath.replace(/\/$/,"");return"".concat(o,"/").concat(t)}},{key:"handleError",value:function(t,o,r){var s=this.contexts$.value.ours.find(function(c){return c.uri===o}),l=s?s.title:o;t.error.title=this.languageService.translate.instant("igo.context.contextManager.invalid.title"),t.error.message=this.languageService.translate.instant("igo.context.contextManager.invalid.text",{value:l}),t.error.toDisplay=!0,r&&(t.error.title=this.languageService.translate.instant("igo.context.contextManager.errors.addPermissionTitle"),t.error.message=this.languageService.translate.instant("igo.context.contextManager.errors.addPermission")),this.messageService.error(t.error.message,t.error.title)}},{key:"handleContextsChange",value:function(){var t=this,o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=this.context$.value,s=this.editedContext$.value;(!r||r.uri===this.options.defaultContextUri)&&(o=!1),o&&this.findContext(r)?(this.getContextByUri(r.uri).pipe((0,An.P)()).subscribe(function(c){t.toolsChanged$.next(c)}),this.baseUrl&&this.authService.authenticated&&this.getDefault().subscribe()):(this.defaultContextUri=void 0,this.loadDefaultContext());var l=this.findContext(s);(!l||"write"!==l.permission)&&this.setEditedContext(void 0)}},{key:"addContextToList",value:function(t){this.findContext(t)||this.contexts$.value&&this.contexts$.value.public&&(this.contexts$.value.public.push({id:t.id,uri:t.uri,title:t.title,scope:t.scope,permission:qt[qt.read]}),this.contexts$.next(this.contexts$.value))}},{key:"findContext",value:function(t){if(!t)return!1;for(var r,o=this.contexts$.value,s=0,l=Object.keys(o);s<l.length&&!(r=o[l[s]].find(function(p){return t.id&&p.id===t.id||t.uri&&p.uri===t.uri}));s++);return r}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG(tt),e.LFG($),e.LFG(j),e.LFG(Ae),e.LFG(Te),e.LFG(Io,8))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),al=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[S.u5,S.UX,C.ez,I.ot,ot.vV,Mt.t,Ot.Nh,ke.LD,ie.Ng,B.lN,le.c,pt.p9,he,wr,J.AV]}),i}(),kp=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.contextService=t,this.mediaService=o,this.component=n}return(0,v.Z)(a,[{key:"map",get:function(){return this.component.map}},{key:"ngOnInit",value:function(){var t=this;this.context$$=this.contextService.context$.pipe((0,po.h)(function(o){return void 0!==o})).subscribe(function(o){return t.handleContextChange(o)})}},{key:"ngOnDestroy",value:function(){this.context$$.unsubscribe()}},{key:"handleContextChange",value:function(t){if(void 0!==t.map){var o=t.map.view;(!this.component.view||!0!==o.keepCurrentView)&&(this.component.view=o),this.component.map.geolocationController&&this.component.map.geolocationController.updateGeolocationOptions(o);var r=t.map.controls;if(!this.component.controls&&r){if(this.mediaService.isMobile()&&"boolean"!=typeof r.scaleLine){var s=r.scaleLine;s.minWidth||(s.minWidth=Math.min(64,s.minWidth),r.scaleLine=s)}this.component.controls=r}}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Be),e.Y36(yn),e.Y36(xt))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoMapContext",""]]}),i}(),Mp=function(){var i=function(){function a(n,t,o,r,s,l,c){(0,h.Z)(this,a),this.component=n,this.contextService=t,this.layerService=o,this.configService=r,this.styleListService=s,this.styleService=l,this.route=c,this.contextLayers=[],this.removeLayersOnContextChange=!0}return(0,v.Z)(a,[{key:"map",get:function(){return this.component.map}},{key:"ngOnInit",value:function(){var t=this;if(this.context$$=this.contextService.context$.pipe((0,po.h)(function(r){return void 0!==r})).subscribe(function(r){return t.handleContextChange(r)}),this.route&&this.route.options.visibleOnLayersKey&&this.route.options.visibleOffLayersKey&&this.route.options.contextKey)var o=this.route.queryParams.subscribe(function(r){Object.keys(r).length>0&&(t.queryParams=r,o.unsubscribe())})}},{key:"ngOnDestroy",value:function(){this.context$$.unsubscribe()}},{key:"handleContextChange",value:function(t){var o=this;if(void 0!==t.layers){!0===this.removeLayersOnContextChange?this.map.removeAllLayers():this.map.removeLayers(this.contextLayers),this.contextLayers=[];var r=Ca.T.apply(void 0,(0,Fe.Z)(t.layers.map(function(s,l){return o.layerService.createAsyncLayer(s,t.uri)})));r.pipe((0,gk.f)(r.pipe((0,De.b)(500)))).subscribe(function(s){s=s.filter(function(l){return void 0!==l}).map(function(l){return l.visible=o.computeLayerVisibilityFromUrl(l),l.zIndex=l.zIndex,l}),o.contextLayers.concat(s),o.map.addLayers(s),t.extraFeatures&&t.extraFeatures.forEach(function(l){var c=new Ee.Z,u=l.name;l=JSON.stringify(l),l=c.readFeatures(l,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}),o.configService.getConfig("importWithStyle")?function Mk(i,a,n,t,o){var r,s,u;if(t.getStyleList(n.toString()+".styleByAttribute")){var l=t.getStyleList(n.toString()+".styleByAttribute");r=function(m,y){return o.createStyleByAttribute(m,l,y)}}else if(t.getStyleList(n.toString()+".clusterStyle")){var c=t.getStyleList(n.toString()+".clusterParam");s=t.getStyleList(n.toString()+".distance"),r=function(m,y){var _=o.createStyle(t.getStyleList(n.toString()+".clusterStyle"),m,y);return o.createClusterStyle(m,y,c,_)}}else r=t.getStyleList(n.toString()+".style")?function(m,y){return o.createStyle(t.getStyleList(n.toString()+".style"),m,y)}:function(m,y){return o.createStyle(t.getStyleList("default.style"),m,y)};t.getStyleList(n.toString()+".clusterStyle")?(u=new gn({distance:s,type:"cluster",queryable:!0})).ol.source.addFeatures(i):(u=new Re({type:"vector",queryable:!0})).ol.addFeatures(i);var g=new Je({title:n,isIgoInternalLayer:!0,source:u,style:r});a.addLayer(g)}(l,o.map,u,o.styleListService,o.styleService):function kk(i,a,n){var t=Math.floor(255*Math.random()),o=Math.floor(255*Math.random()),r=Math.floor(255*Math.random()),s=new K.Z({color:[t,o,r,1],width:2}),l=new te.Z({color:[t,o,r,.4]}),u=new Re({type:"vector",queryable:!0});u.ol.addFeatures(i);var p=new Je({title:n,isIgoInternalLayer:!0,source:u,style:new ee.ZP({stroke:s,fill:l,image:new Ue.Z({radius:5,stroke:s,fill:l})})});a.addLayer(p)}(l,o.map,u)})})}}},{key:"computeLayerVisibilityFromUrl",value:function(t){var o=this.queryParams,s=t.id,l=t.visible;if(!o||!s)return l;var c=o[this.route.options.contextKey];if(c===this.contextService.context$.value.uri||!c){var u="",p="",d=[],g=[];this.route.options.visibleOnLayersKey&&o[this.route.options.visibleOnLayersKey]&&(u=o[this.route.options.visibleOnLayersKey]),this.route.options.visibleOffLayersKey&&o[this.route.options.visibleOffLayersKey]&&(p=o[this.route.options.visibleOffLayersKey]),"*"===u&&(l=!0),"*"===p&&(l=!1),d=u.split(","),g=p.split(","),(d.indexOf(s)>-1||d.indexOf(s.toString())>-1)&&(l=!0),(g.indexOf(s)>-1||g.indexOf(s.toString())>-1)&&(l=!1)}return l}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(Be),e.Y36(yn),e.Y36(Ge),e.Y36(j),e.Y36(Wr),e.Y36(xn),e.Y36(Io,8))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoLayerContext",""]],inputs:{removeLayersOnContextChange:"removeLayersOnContextChange"}}),i}(),ai=function(){return(i=ai||(ai={})).always="always",i.never="never",i.default="default",ai;var i}(),Fp=function(){var i=(0,v.Z)(function a(n){(0,h.Z)(this,a),this.dialogRef=n});return i.\u0275fac=function(n){return new(n||i)(e.Y36(z.so))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-bookmark-dialog"]],decls:14,vars:14,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],["matInput","","required","","autocomplete","off","maxlength","128",3,"placeholder","ngModel","ngModelChange"],["mat-dialog-actions",""],["mat-button","","color","primary",3,"disabled","click"],["mat-button","",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"h1",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"div",1)(4,"mat-form-field")(5,"input",2),e.NdJ("ngModelChange",function(r){return t.title=r}),e.ALo(6,"translate"),e.qZA()()(),e.TgZ(7,"div",3)(8,"button",4),e.NdJ("click",function(){return t.dialogRef.close(t.title)}),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"button",5),e.NdJ("click",function(){return t.dialogRef.close(!1)}),e._uU(12),e.ALo(13,"translate"),e.qZA()()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,6,"igo.context.bookmarkButton.dialog.title")),e.xp6(4),e.Q6J("placeholder",e.lcZ(6,8,"igo.context.bookmarkButton.dialog.placeholder"))("ngModel",t.title),e.xp6(3),e.Q6J("disabled",!t.title),e.xp6(1),e.hij(" ",e.lcZ(10,10,"igo.common.confirmDialog.confirmBtn")," "),e.xp6(3),e.hij(" ",e.lcZ(13,12,"igo.common.confirmDialog.cancelBtn")," "))},dependencies:[S.Fj,S.JJ,S.Q7,S.nD,S.On,I.lW,B.KE,z.uh,z.xY,z.H8,le.Nt,E.X$],encapsulation:2}),i}();function Rk(i,a){if(1&i&&e._UZ(0,"mat-icon",7),2&i){var n=e.oxw(2);e.s9C("svgIcon",n.context.icon?n.context.icon:"public"===n.context.scope?"earth":"star")}}function Jk(i,a){if(1&i&&e._UZ(0,"img",8),2&i){var n=e.oxw(2);e.Q6J("src",n.context.iconImage,e.LSH)}}function Bk(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.favoriteClick(r.context))}),e.ALo(1,"translate"),e.YNc(2,Rk,1,1,"mat-icon",5),e.YNc(3,Jk,1,1,"img",6),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("matTooltip",t.auth.authenticated?e.lcZ(1,4,"igo.context.contextManager.favorite"):"")("color",t.default?"primary":"default"),e.xp6(2),e.Q6J("ngIf",!t.context.iconImage),e.xp6(1),e.Q6J("ngIf",t.context.iconImage)}}function Uk(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){e.CHM(n);var r=e.oxw();return e.KtG(r.favoriteClick(r.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",9),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("matTooltip",e.lcZ(1,2,"igo.context.contextManager.favorite"))("color",t.default?"primary":"default")}}function Nk(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.save.emit(r.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",22),e.qZA()}if(2&i){var t=e.oxw(2);e.Q6J("matTooltip",e.lcZ(1,2,"igo.context.contextManager.save"))("color",t.color)}}function qk(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",23),e.NdJ("click",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.managePermissions.emit(r.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",24),e.qZA()}if(2&i){var t=e.oxw(2);e.Q6J("matTooltip",e.lcZ(1,2,"igo.context.contextManager.managePermissions"))("color",t.color)}}function Gk(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.clone.emit(r.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",26),e.qZA()}if(2&i){var t=e.oxw(2);e.Q6J("matTooltip",e.lcZ(1,2,"igo.context.contextManager.clone"))("color",t.color)}}function Qk(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",27),e.NdJ("click",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.edit.emit(r.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",28),e.qZA()}if(2&i){var t=e.oxw(2);e.Q6J("color",t.color)("matTooltip",e.lcZ(1,2,"igo.context.contextManager.edit"))}}function Yk(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",29),e.NdJ("click",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.hide.emit(r.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",30),e.qZA()}if(2&i){var t=e.oxw(2);e.Q6J("color",t.color)("matTooltip",e.lcZ(1,2,"igo.context.contextManager.hide"))}}function jk(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",29),e.NdJ("click",function(){e.CHM(n);var r=e.oxw(2);return e.KtG(r.show.emit(r.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",31),e.qZA()}if(2&i){var t=e.oxw(2);e.Q6J("color",t.color)("matTooltip",e.lcZ(1,2,"igo.context.contextManager.show"))}}function Hk(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",32),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(2);return e.KtG(o.delete.emit(o.context))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",33),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.context.contextManager.delete"))}function Vk(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"div",10),e.YNc(1,Nk,3,4,"button",11),e.TgZ(2,"div",12,13),e.YNc(4,qk,3,4,"button",14),e.YNc(5,Gk,3,4,"button",15),e.YNc(6,Qk,3,4,"button",16),e.YNc(7,Yk,3,4,"button",17),e.YNc(8,jk,3,4,"button",17),e.YNc(9,Hk,3,3,"button",18),e.qZA(),e.TgZ(10,"button",19),e.NdJ("click",function(){e.CHM(n);var s=e.oxw();return e.KtG(s.collapsed=!s.collapsed)}),e._UZ(11,"mat-icon",20),e.qZA()()}if(2&i){var t=e.MAs(3),o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.collapsed&&o.selected&&(o.context.permission===o.typePermission[o.typePermission.write]||o.context.imported)),e.xp6(3),e.Q6J("ngIf",o.canShare&&!o.context.imported),e.xp6(1),e.Q6J("ngIf",!o.context.imported),e.xp6(1),e.Q6J("ngIf",o.context.permission===o.typePermission[o.typePermission.write]&&!o.context.imported),e.xp6(1),e.Q6J("ngIf",!o.context.hidden&&!o.context.imported),e.xp6(1),e.Q6J("ngIf",o.context.hidden&&!o.context.imported),e.xp6(1),e.Q6J("ngIf",o.context.permission===o.typePermission[o.typePermission.write]||o.context.imported),e.xp6(1),e.Q6J("color",o.color)("target",t)("collapsed",o.collapsed)}}var zk=function(a){return{"mat-list-item-light":a}},Wk=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.auth=n,this.storageService=t,this.typePermission=qt,this.color="primary",this.collapsed=!0,this.showFavorite=!0,this.edit=new e.vpe,this.delete=new e.vpe,this.save=new e.vpe,this.clone=new e.vpe,this.hide=new e.vpe,this.show=new e.vpe,this.favorite=new e.vpe,this.managePermissions=new e.vpe,this.manageTools=new e.vpe}return(0,v.Z)(a,[{key:"hidden",get:function(){return this.context.hidden}},{key:"canShare",get:function(){return!0===this.storageService.get("canShare")}},{key:"favoriteClick",value:function(t){this.favorite.emit(t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(tt),e.Y36(Te))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-context-item"]],inputs:{showFavorite:"showFavorite",context:"context",default:"default",selected:"selected"},outputs:{edit:"edit",delete:"delete",save:"save",clone:"clone",hide:"hide",show:"show",favorite:"favorite",managePermissions:"managePermissions",manageTools:"manageTools"},decls:6,vars:7,consts:[[1,"mat-list-item",3,"ngClass"],["mat-list-avatar","","mat-icon-button","","igoStopPropagation","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["matLine",""],["igoStopPropagation","","class","igo-actions-container",4,"ngIf"],["mat-list-avatar","","mat-icon-button","","igoStopPropagation","","matTooltipShowDelay","500",3,"matTooltip","color","click"],[3,"svgIcon",4,"ngIf"],[3,"src",4,"ngIf"],[3,"svgIcon"],[3,"src"],["svgIcon","star"],["igoStopPropagation","",1,"igo-actions-container"],["class","save-button","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],[1,"igo-actions-expand-container"],["actions",""],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["class","clone-button","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["class","edit-button","mat-icon-button","","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","hide-button","mat-icon-button","","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","delete-button","mat-icon-button","","color","warn","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","igoCollapse","",1,"actions-button",3,"color","target","collapsed","click"],["svgIcon","dots-horizontal"],["mat-icon-button","","matTooltipShowDelay","500",1,"save-button",3,"matTooltip","color","click"],["svgIcon","content-save"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","account-arrow-right"],["mat-icon-button","","matTooltipShowDelay","500",1,"clone-button",3,"matTooltip","color","click"],["svgIcon","content-copy"],["mat-icon-button","","matTooltipShowDelay","500",1,"edit-button",3,"color","matTooltip","click"],["svgIcon","pencil"],["mat-icon-button","","matTooltipShowDelay","500",1,"hide-button",3,"color","matTooltip","click"],["svgIcon","eye"],["svgIcon","eye-off"],["mat-icon-button","","color","warn","matTooltipShowDelay","500",1,"delete-button",3,"matTooltip","click"],["svgIcon","delete"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-list-item",0),e.YNc(1,Bk,4,6,"button",1),e.YNc(2,Uk,3,4,"button",1),e.TgZ(3,"h4",2),e._uU(4),e.qZA(),e.YNc(5,Vk,12,10,"div",3),e.qZA()),2&n&&(e.Q6J("ngClass",e.VKq(5,zk,t.hidden)),e.xp6(1),e.Q6J("ngIf",t.auth.authenticated),e.xp6(1),e.Q6J("ngIf",!t.auth.authenticated&&t.showFavorite),e.xp6(2),e.Oqu(t.context.title),e.xp6(1),e.Q6J("ngIf",t.auth.authenticated))},dependencies:[C.mk,C.O5,O.Hw,I.lW,J.gM,X.Tg,X.eA,ie.X2,Do,Oo,E.X$],styles:["[_nghost-%COMP%]{overflow:hidden}.igo-actions-container[_ngcontent-%COMP%]{flex-shrink:0}.igo-actions-expand-container[_ngcontent-%COMP%]{display:inline-flex}mat-list-item[_ngcontent-%COMP%]     .mat-list-item-content .mat-list-text{padding:0}mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}mat-list-item.mat-list-item-light[_ngcontent-%COMP%]     .mat-list-item-content{color:#969696}"],changeDetection:0}),i}();function Kk(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){e.CHM(n);var o=e.oxw(2);return e.KtG(o.clearFilter())}),e._UZ(1,"mat-icon",15),e.qZA()}}function Xk(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-form-field",11)(1,"input",12),e.NdJ("ngModelChange",function(r){e.CHM(n);var s=e.oxw();return e.KtG(s.term=r)}),e.ALo(2,"translate"),e.qZA(),e.YNc(3,Kk,2,0,"button",13),e.qZA()}if(2&i){var t=e.oxw();e.Q6J("ngClass",t.auth.authenticated&&t.configService.getConfig("context")?"context-filter-min-width":"context-filter-max-width"),e.xp6(1),e.Q6J("placeholder",e.lcZ(2,4,"igo.context.contextManager.filterPlaceHolder"))("ngModel",t.term),e.xp6(2),e.Q6J("ngIf",t.term.length)}}function eM(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(n);var o=e.oxw();return e.KtG(o.toggleSort(!0))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",17),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.context.contextManager.sortAlphabetically"))}function tM(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(n);var o=e.oxw();return e.KtG(o.toggleSort(!1))}),e.ALo(1,"translate"),e._UZ(2,"mat-icon",18),e.qZA()}2&i&&e.Q6J("matTooltip",e.lcZ(1,1,"igo.context.contextManager.sortContextOrder"))}function nM(i,a){if(1&i&&e._UZ(0,"igo-actionbar",19),2&i){var n=e.oxw();e.Q6J("iconColor",n.color)("store",n.actionStore)("withIcon",!0)("withTitle","overlay"===n.actionbarMode)("horizontal",!1)("mode",n.actionbarMode)}}function oM(i,a){if(1&i&&(e.TgZ(0,"button",20),e.ALo(1,"translate"),e._UZ(2,"mat-icon",21),e.qZA()),2&i){e.oxw();var n=e.MAs(7);e.Q6J("matTooltip",e.lcZ(1,2,"igo.context.contextManager.filterUser"))("matMenuTriggerFor",n)}}function iM(i,a){if(1&i&&(e.TgZ(0,"button",27),e._uU(1),e.qZA()),2&i){var n=e.oxw().$implicit,t=e.MAs(6);e.Q6J("matMenuTriggerFor",t),e.xp6(1),e.hij(" ",n.title," ")}}function rM(i,a){if(1&i&&(e.TgZ(0,"button",9),e._uU(1),e.qZA()),2&i){var n=e.oxw().$implicit;e.xp6(1),e.hij(" ",n.title," ")}}function aM(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"mat-checkbox",8),e.NdJ("click",function(s){return s.stopPropagation()})("change",function(){var l=e.CHM(n).$implicit,c=e.oxw().$implicit,u=e.oxw();return e.KtG(u.userSelection(l,c))}),e._uU(1),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw(2);e.Q6J("checked",o.getPermission(t).checked),e.xp6(1),e.hij(" ",t.title," ")}}function sM(i,a){if(1&i){var n=e.EpF();e.ynx(0),e.TgZ(1,"span",7)(2,"mat-checkbox",22),e.NdJ("click",function(s){return s.stopPropagation()})("change",function(){var l=e.CHM(n).$implicit,c=e.oxw();return e.KtG(c.userSelection(l))}),e.qZA(),e.YNc(3,iM,2,2,"button",23),e.YNc(4,rM,2,1,"button",24),e.qZA(),e.TgZ(5,"mat-menu",null,25),e.YNc(7,aM,2,2,"mat-checkbox",26),e.qZA(),e.BQk()}if(2&i){var t=a.$implicit,o=e.oxw();e.xp6(2),e.Q6J("checked",o.getPermission(t).checked)("indeterminate",o.getPermission(t).indeterminate),e.xp6(1),e.Q6J("ngIf",t.childs),e.xp6(1),e.Q6J("ngIf",!t.childs),e.xp6(3),e.Q6J("ngForOf",t.childs)}}function lM(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-context-item",31),e.NdJ("edit",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.edit.emit(l))})("delete",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.delete.emit(l))})("clone",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.clone.emit(l))})("save",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.save.emit(l))})("hide",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.hideContext(l))})("show",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.showContext(l))})("favorite",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.favorite.emit(l))})("manageTools",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.manageTools.emit(l))})("managePermissions",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.managePermissions.emit(l))})("select",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.select.emit(l))})("unselect",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.unselect.emit(l))}),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw(3);e.Q6J("selected",o.selectedContext&&o.selectedContext.uri===t.uri)("context",t)("default",t.id&&o.defaultContextId&&o.defaultContextId===t.id)}}function cM(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-collapsible",30),e.NdJ("toggle",function(s){e.CHM(n);var l=e.oxw().$implicit,c=e.oxw();return e.KtG(c.collapsed[c.titleMapping[l.key]]=s)}),e.ALo(1,"translate"),e.YNc(2,lM,1,3,"ng-template",10),e.qZA()}if(2&i){var t=e.oxw().$implicit,o=e.oxw();e.Q6J("title",e.lcZ(1,3,o.titleMapping[t.key]))("collapsed",o.collapsed[o.titleMapping[t.key]]),e.xp6(2),e.Q6J("ngForOf",t.value)}}function uM(i,a){if(1&i){var n=e.EpF();e.TgZ(0,"igo-context-item",32),e.NdJ("favorite",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.favorite.emit(l))})("select",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.select.emit(l))})("unselect",function(){var l=e.CHM(n).$implicit,c=e.oxw(3);return e.KtG(c.unselect.emit(l))}),e.qZA()}if(2&i){var t=a.$implicit,o=e.oxw(3);e.Q6J("showFavorite",o.configService.getConfig("favoriteContext4NonAuthenticated"))("selected",o.selectedContext&&o.selectedContext.uri===t.uri)("context",t)("default",o.configService.getConfig("context")?o.defaultContextId===t.id:o.defaultContextId===t.uri)}}function pM(i,a){if(1&i&&e.YNc(0,uM,1,4,"ng-template",10),2&i){var n=e.oxw().$implicit;e.Q6J("ngForOf",n.value)}}function dM(i,a){if(1&i&&(e.YNc(0,cM,3,5,"igo-collapsible",28),e.YNc(1,pM,1,1,null,29)),2&i){var n=a.$implicit,t=e.oxw();e.Q6J("ngIf",n.value.length&&t.auth.authenticated),e.xp6(1),e.Q6J("ngIf",n.value.length&&!t.auth.authenticated)}}var ca=function(){var i=function(){function a(n,t,o,r,s,l,c){(0,h.Z)(this,a),this.cdRef=n,this.contextService=t,this.configService=o,this.auth=r,this.dialog=s,this.languageService=l,this.storageService=c,this.contextsInitial={ours:[]},this.contexts$=new x.X(this.contextsInitial),this.change$=new vi.t(1),this._contexts={ours:[]},this.collapsed=[],this.select=new e.vpe,this.unselect=new e.vpe,this.edit=new e.vpe,this.delete=new e.vpe,this.save=new e.vpe,this.clone=new e.vpe,this.create=new e.vpe,this.hide=new e.vpe,this.show=new e.vpe,this.showHiddenContexts=new e.vpe,this.favorite=new e.vpe,this.managePermissions=new e.vpe,this.manageTools=new e.vpe,this.filterPermissionsChanged=new e.vpe,this.titleMapping={ours:"igo.context.contextManager.ourContexts",shared:"igo.context.contextManager.sharedContexts",public:"igo.context.contextManager.publicContexts"},this.permissions=[],this.actionStore=new Hn([]),this.actionbarMode=Dn.Overlay,this.color="primary",this.showHidden=!1,this._term="",this._sortedAlpha=void 0,this.showContextFilter=ai.always,this.thresholdToFilter=5}return(0,v.Z)(a,[{key:"contexts",get:function(){return this._contexts},set:function(t){this._contexts=t,this.cdRef.detectChanges(),this.next()}},{key:"selectedContext",get:function(){return this._selectedContext},set:function(t){this._selectedContext=t,this.cdRef.detectChanges()}},{key:"map",get:function(){return this._map},set:function(t){this._map=t}},{key:"defaultContextId",get:function(){return this.configService.getConfig("context")?this._defaultContextId:this.storageService.get("favorite.context.uri")||this._defaultContextId},set:function(t){this._defaultContextId=t}},{key:"term",get:function(){return this._term},set:function(t){this._term=t,this.next()}},{key:"sortedAlpha",get:function(){return this._sortedAlpha},set:function(t){this._sortedAlpha=t,this.next()}},{key:"ngOnInit",value:function(){var t=this;this.change$$=this.change$.pipe((0,xi.D)(function(){return 0===t.contexts.ours.length?_o.E:(0,Ti.H)(50)})).subscribe(function(){t.contexts$.next(t.filterContextsList(t.contexts))}),this.actionStore.load([{id:"emptyContext",title:this.languageService.translate.instant("igo.context.contextManager.emptyContext"),icon:"map-outline",tooltip:this.languageService.translate.instant("igo.context.contextManager.emptyContextTooltip"),handler:function(){t.createContext(!0)}},{id:"contextFromMap",title:this.languageService.translate.instant("igo.context.contextManager.contextMap"),icon:"map-check",tooltip:this.languageService.translate.instant("igo.context.contextManager.contextMapTooltip"),handler:function(){t.createContext(!1)}}])}},{key:"next",value:function(){this.change$.next()}},{key:"filterContextsList",value:function(t){var o=this;if(""===this.term)return this.sortedAlpha&&(t=this.sortContextsList(t)),t;var s={ours:t.ours.filter(function(u){var p=o.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return u.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(p)})};if(this.contexts.public){var l=t.public.filter(function(u){var p=o.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return u.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(p)});s.public=l}if(this.contexts.shared){var c=t.shared.filter(function(u){var p=o.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return u.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(p)});s.shared=c}return this.sortedAlpha&&(s=this.sortContextsList(s)),s}},{key:"ngOnDestroy",value:function(){this.change$$.unsubscribe()}},{key:"showFilter",value:function(){switch(this.showContextFilter){case ai.always:return!0;case ai.never:return!1;default:var t=this.contexts.ours.length;return t+=this.contexts.public?this.contexts.public.length:0,(t+=this.contexts.shared?this.contexts.shared.length:0)>=this.thresholdToFilter}}},{key:"sortContextsList",value:function(t){var o=this;if(t){var r=JSON.parse(JSON.stringify(t));return r.ours.sort(function(s,l){return o.normalize(s.title)<o.normalize(l.title)?-1:o.normalize(s.title)>o.normalize(l.title)?1:0}),r.shared?r.shared.sort(function(s,l){return o.normalize(s.title)<o.normalize(l.title)?-1:o.normalize(s.title)>o.normalize(l.title)?1:0}):r.public&&r.public.sort(function(s,l){return o.normalize(s.title)<o.normalize(l.title)?-1:o.normalize(s.title)>o.normalize(l.title)?1:0}),r}}},{key:"normalize",value:function(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}},{key:"toggleSort",value:function(t){this.sortedAlpha=t}},{key:"clearFilter",value:function(){this.term=""}},{key:"createContext",value:function(t){var o=this;this.dialog.open(Fp,{disableClose:!1}).afterClosed().pipe((0,We.q)(1)).subscribe(function(r){r&&o.create.emit({title:r,empty:t})})}},{key:"getPermission",value:function(t){if(t)return this.permissions.find(function(r){return r.name===t.name})}},{key:"userSelection",value:function(t,o){var r=this.getPermission(t);if(r&&(r.checked=!r.checked,this.storageService.set("contexts.permissions."+r.name,r.checked),r.indeterminate=!1),o){var c,s=!1,l=(0,D.Z)(o.childs);try{for(l.s();!(c=l.n()).done;)if(this.getPermission(c.value).checked!==r.checked){s=!0;break}}catch(_){l.e(_)}finally{l.f()}var d=this.getPermission(o);d&&(d.checked=r.checked,this.storageService.set("contexts.permissions."+d.name,r.checked),d.indeterminate=s)}if(t.childs){var f,g=(0,D.Z)(t.childs);try{for(g.s();!(f=g.n()).done;){var y=this.getPermission(f.value);y&&y.checked!==r.checked&&(y.checked=r.checked,this.storageService.set("contexts.permissions."+y.name,r.checked))}}catch(_){g.e(_)}finally{g.f()}}this.filterPermissionsChanged.emit(this.permissions)}},{key:"hideContext",value:function(t){if(t.hidden=!0,!this.showHidden){var o={ours:[],shared:[],public:[]};o.ours=this.contexts.ours.filter(function(r){return r.id!==t.id}),o.shared=this.contexts.shared.filter(function(r){return r.id!==t.id}),o.public=this.contexts.public.filter(function(r){return r.id!==t.id}),this.contexts=o}this.hide.emit(t)}},{key:"showContext",value:function(t){t.hidden=!1,this.show.emit(t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.sBO),e.Y36(yn),e.Y36(j),e.Y36(tt),e.Y36(z.uw),e.Y36($),e.Y36(Te))},i.\u0275cmp=e.Xpm({type:i,selectors:[["igo-context-list"]],inputs:{contexts:"contexts",selectedContext:"selectedContext",map:"map",defaultContextId:"defaultContextId",term:"term"},outputs:{select:"select",unselect:"unselect",edit:"edit",delete:"delete",save:"save",clone:"clone",create:"create",hide:"hide",show:"show",showHiddenContexts:"showHiddenContexts",favorite:"favorite",managePermissions:"managePermissions",manageTools:"manageTools",filterPermissionsChanged:"filterPermissionsChanged"},decls:17,vars:16,consts:[[3,"navigation"],[3,"ngClass",4,"ngIf"],["class","sort-alpha","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["class","add-context-button","icon","plus",3,"iconColor","store","withIcon","withTitle","horizontal","mode",4,"ngIf"],["class","users-filter","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","matMenuTriggerFor",4,"ngIf"],["accountMenu","matMenu"],[4,"ngFor","ngForOf"],[1,"profilsMenu"],[1,"mat-menu-item",3,"checked","click","change"],["mat-menu-item",""],["ngFor","",3,"ngForOf"],[3,"ngClass"],["matInput","","type","text",3,"placeholder","ngModel","ngModelChange"],["mat-button","","mat-icon-button","","matSuffix","","class","clear-button","aria-label","Clear","color","warn",3,"click",4,"ngIf"],["mat-button","","mat-icon-button","","matSuffix","","aria-label","Clear","color","warn",1,"clear-button",3,"click"],["svgIcon","close"],["mat-icon-button","","matTooltipShowDelay","500",1,"sort-alpha",3,"matTooltip","click"],["color","primary","svgIcon","sort-alphabetical-variant"],["color","warn","svgIcon","sort-variant-remove"],["icon","plus",1,"add-context-button",3,"iconColor","store","withIcon","withTitle","horizontal","mode"],["mat-icon-button","","matTooltipShowDelay","500",1,"users-filter",3,"matTooltip","matMenuTriggerFor"],["color","primary","svgIcon","filter-menu"],[1,"mat-menu-item",3,"checked","indeterminate","click","change"],["mat-menu-item","",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",4,"ngIf"],["subAccountMenu","matMenu"],["class","mat-menu-item",3,"checked","click","change",4,"ngFor","ngForOf"],["mat-menu-item","",3,"matMenuTriggerFor"],[3,"title","collapsed","toggle",4,"ngIf"],[4,"ngIf"],[3,"title","collapsed","toggle"],["igoListItem","","color","accent",3,"selected","context","default","edit","delete","clone","save","hide","show","favorite","manageTools","managePermissions","select","unselect"],["igoListItem","","color","accent",3,"showFavorite","selected","context","default","favorite","select","unselect"]],template:function(n,t){1&n&&(e.TgZ(0,"igo-list",0),e.YNc(1,Xk,4,6,"mat-form-field",1),e.YNc(2,eM,3,3,"button",2),e.YNc(3,tM,3,3,"button",2),e.YNc(4,nM,1,6,"igo-actionbar",3),e.YNc(5,oM,3,4,"button",4),e.TgZ(6,"mat-menu",null,5),e.YNc(8,sM,8,5,"ng-container",6),e.TgZ(9,"span",7)(10,"mat-checkbox",8),e.NdJ("click",function(r){return r.stopPropagation()})("change",function(){return t.showHiddenContexts.emit()}),e.qZA(),e.TgZ(11,"button",9),e._uU(12),e.ALo(13,"translate"),e.qZA()()(),e.YNc(14,dM,2,2,"ng-template",10),e.ALo(15,"keyvalue"),e.ALo(16,"async"),e.qZA()),2&n&&(e.Q6J("navigation",!0),e.xp6(1),e.Q6J("ngIf",t.showFilter()),e.xp6(1),e.Q6J("ngIf",!t.sortedAlpha),e.xp6(1),e.Q6J("ngIf",t.sortedAlpha),e.xp6(1),e.Q6J("ngIf",t.auth.authenticated&&t.configService.getConfig("context")),e.xp6(1),e.Q6J("ngIf",t.auth.authenticated&&t.configService.getConfig("context")),e.xp6(3),e.Q6J("ngForOf",t.users),e.xp6(2),e.Q6J("checked",t.showHidden),e.xp6(2),e.hij(" ",e.lcZ(13,10,"igo.context.contextManager.showHidden")," "),e.xp6(2),e.Q6J("ngForOf",e.lcZ(15,12,e.lcZ(16,14,t.contexts$))))},dependencies:[C.mk,C.sg,C.O5,S.Fj,S.JJ,S.On,B.KE,B.R9,le.Nt,O.Hw,I.lW,J.gM,pt.oG,Ve.VK,Ve.OP,Ve.p6,Yt,Pn,Fa,bi,Wk,C.Ov,vo,E.X$],styles:[".context-filter-max-width[_ngcontent-%COMP%]{width:calc(100% - 100px);margin:5px;padding-left:6px}.context-filter-min-width[_ngcontent-%COMP%]{width:calc(100% - 135px);margin:5px;padding-left:6px}.clear-button[_ngcontent-%COMP%]{padding-right:5px}mat-form-field[_ngcontent-%COMP%]{height:40px}.profilsMenu[_ngcontent-%COMP%]{display:flex}.profilsMenu[_ngcontent-%COMP%] > mat-checkbox[_ngcontent-%COMP%]{width:8px}.add-context-button[_ngcontent-%COMP%]{margin:0;width:40px;display:inline-flex;overflow:hidden}"],changeDetection:0}),i}(),sl=function(){var i=function(){function a(n,t,o,r,s,l,c,u,p){(0,h.Z)(this,a),this.contextService=t,this.mapService=o,this.languageService=r,this.confirmDialogService=s,this.messageService=l,this.auth=c,this.storageService=u,this.cdRef=p,this.component=n}return(0,v.Z)(a,[{key:"onSelect",value:function(t){this.contextService.loadContext(t.uri)}},{key:"onEdit",value:function(t){this.contextService.loadEditedContext(t.uri)}},{key:"onSave",value:function(t){var o=this,r=this.mapService.getMap(),s=this.contextService.getContextFromMap(r),l=function(){var p=o.languageService.translate,d=p.instant("igo.context.contextManager.dialog.saveMsg",{value:t.title}),g=p.instant("igo.context.contextManager.dialog.saveTitle");o.messageService.success(d,g)};if(t.imported)return s.title=t.title,this.contextService.delete(t.id,!0),void this.contextService.create(s).subscribe(function(u){o.contextService.loadContext(u.uri),l()});this.contextService.update(t.id,{layers:s.layers,map:{view:s.map.view}}).subscribe(function(){l()})}},{key:"onFavorite",value:function(t){var o=this;t.id||(t.id=t.uri),this.contextService.setDefault(t.id).subscribe(function(){o.previousMessageId&&o.messageService.remove(o.previousMessageId),o.contextService.defaultContextId$.next(t.id);var r=o.languageService.translate,s=r.instant("igo.context.contextManager.dialog.favoriteMsg",{value:t.title}),l=r.instant("igo.context.contextManager.dialog.favoriteTitle"),c=o.messageService.success(s,l);o.previousMessageId=c.toastId,o.cdRef.detectChanges()})}},{key:"onManageTools",value:function(t){this.contextService.loadEditedContext(t.uri)}},{key:"onManagePermissions",value:function(t){this.contextService.loadEditedContext(t.uri)}},{key:"onDelete",value:function(t){var o=this,r=this.languageService.translate;this.confirmDialogService.open(r.instant("igo.context.contextManager.dialog.confirmDelete")).subscribe(function(s){s&&o.contextService.delete(t.id,t.imported).subscribe(function(){var l=r.instant("igo.context.contextManager.dialog.deleteMsg",{value:t.title}),c=r.instant("igo.context.contextManager.dialog.deleteTitle");o.messageService.info(l,c)})})}},{key:"onClone",value:function(t){var o=this;this.contextService.clone(t.id,{title:t.title+"-copy",uri:t.uri+"-copy"}).subscribe(function(){var s=o.languageService.translate,l=s.instant("igo.context.contextManager.dialog.cloneMsg",{value:t.title}),c=s.instant("igo.context.contextManager.dialog.cloneTitle");o.messageService.success(l,c)})}},{key:"onCreate",value:function(t){var o=this,r=t.title,l=this.contextService.getContextFromMap(this.component.map,t.empty);l.title=r,this.contextService.create(l).subscribe(function(){var c=o.languageService.translate,u=c.instant("igo.context.bookmarkButton.dialog.createTitle"),p=c.instant("igo.context.bookmarkButton.dialog.createMsg",{value:l.title});o.messageService.success(p,u),o.contextService.loadContext(l.uri)})}},{key:"loadContexts",value:function(){var r,t=["none"],o=(0,D.Z)(this.component.permissions);try{for(o.s();!(r=o.n()).done;){var s=r.value;(!0===s.checked||!0===s.indeterminate)&&t.push(s.name)}}catch(l){o.e(l)}finally{o.f()}this.contextService.loadContexts(t,!!this.component.showHidden)}},{key:"showHiddenContexts",value:function(){this.component.showHidden=!this.component.showHidden,this.storageService.set("contexts.showHidden",this.component.showHidden),this.loadContexts()}},{key:"onShowContext",value:function(t){this.contextService.showContext(t.id).subscribe()}},{key:"onHideContext",value:function(t){this.contextService.hideContext(t.id).subscribe()}},{key:"ngOnInit",value:function(){var t=this;this.component.contexts={ours:[]},this.component.showHidden=this.storageService.get("contexts.showHidden"),this.contexts$$=this.contextService.contexts$.subscribe(function(r){return t.handleContextsChange(r)}),this.defaultContextId$$=this.contextService.defaultContextId$.subscribe(function(r){t.component.defaultContextId=r});var o=this.storageService.get("favorite.context.uri");o&&!this.auth.authenticated&&this.contextService.defaultContextId$.next(o),this.selectedContext$$=this.contextService.context$.pipe((0,De.b)(100)).subscribe(function(r){return t.component.selectedContext=r}),this.auth.authenticate$.subscribe(function(r){r&&t.contextService.getProfilByUser().subscribe(function(s){t.component.users=s,t.component.permissions=[];var u,l=t.component.users.reduce(function(_,b){return _=_.concat(b),b.childs?_.concat(b.childs):_},[]),c=(0,D.Z)(l);try{for(c.s();!(u=c.n()).done;){var p=u.value,d={name:p.name,checked:t.storageService.get("contexts.permissions."+p.name)};null===d.checked&&(d.checked=!0),t.component.permissions.push(d)}}catch(_){c.e(_)}finally{c.f()}var m,g=["none"],f=(0,D.Z)(t.component.permissions);try{for(f.s();!(m=f.n()).done;){var y=m.value;(!0===y.checked||!0===y.indeterminate)&&g.push(y.name)}}catch(_){f.e(_)}finally{f.f()}t.contextService.loadContexts(g,!!t.component.showHidden)})})}},{key:"ngOnDestroy",value:function(){this.contexts$$.unsubscribe(),this.selectedContext$$.unsubscribe(),this.defaultContextId$$.unsubscribe()}},{key:"handleContextsChange",value:function(t){this.component.contexts=t}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.Y36(ca,2),e.Y36(yn),e.Y36(Vt),e.Y36($),e.Y36(Za),e.Y36(Ae),e.Y36(tt),e.Y36(Te),e.Y36(e.sBO))},i.\u0275dir=e.lG2({type:i,selectors:[["","igoContextListBinding",""]],hostBindings:function(n,t){1&n&&e.NdJ("select",function(r){return t.onSelect(r)})("edit",function(r){return t.onEdit(r)})("save",function(r){return t.onSave(r)})("favorite",function(r){return t.onFavorite(r)})("manageTools",function(r){return t.onManageTools(r)})("managePermissions",function(r){return t.onManagePermissions(r)})("delete",function(r){return t.onDelete(r)})("clone",function(r){return t.onClone(r)})("create",function(r){return t.onCreate(r)})("filterPermissionsChanged",function(){return t.loadContexts()})("showHiddenContexts",function(){return t.showHiddenContexts()})("show",function(r){return t.onShowContext(r)})("hide",function(r){return t.onHideContext(r)})}}),i}(),Ip=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.http=n,this.config=t,this.baseUrl=this.config.getConfig("context.url")}return(0,v.Z)(a,[{key:"get",value:function(){return this.baseUrl?this.http.get(this.baseUrl+"/pois"):_o.E}},{key:"delete",value:function(t){return this.http.delete(this.baseUrl+"/pois/"+t)}},{key:"create",value:function(t){return this.http.post(this.baseUrl+"/pois",t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(W.eN),e.LFG(j))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i}(),Lp=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[Ip],imports:[C.ez,he,Fl,Cr,Ka,S.u5,O.Ps,I.ot,ke.LD,ie.Ng,J.AV,B.lN,z.Is,le.c]}),i}(),ll=function(){var i=function(){function a(){(0,h.Z)(this,a)}return(0,v.Z)(a,null,[{key:"forRoot",value:function(){return{ngModule:a}}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,S.u5,S.UX,B.lN,le.c,O.Ps,I.ot,J.AV,X.ie,pt.p9,Ft.Fk,z.Is,Ve.Tx,ie.Ng,_t.Bb,Ka,yo,Jo,Po,Cr,he,al,Lp,gr]}),i}(),si=function(){return(i=si||(si={})).layer="layer",i.context="context",si;var i}(),Mn=function(){return(i=Mn||(Mn={})).import="import",i.export="export",Mn;var i}(),li=function(){var i=function(){function a(){(0,h.Z)(this,a),this.importExportType$=new x.X(si.layer),this.selectedMode$=new x.X(Mn.import),this.exportOptions$=new x.X(void 0)}return(0,v.Z)(a,[{key:"setImportExportType",value:function(t){this.importExportType$.next(t)}},{key:"setMode",value:function(t){this.selectedMode$.next(t)}},{key:"setsExportOptions",value:function(t){this.exportOptions$.next(t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),Gt=function(){var i=function(){function a(n,t){(0,h.Z)(this,a),this.toolService=n,this.importExportState=t,this.openSidenav$=new x.X(void 0)}return(0,v.Z)(a,[{key:"toolbox",get:function(){return this.toolService.toolbox}},{key:"toolToActivateFromOptions",value:function(t){if(t){if("importExport"===t.tool){var o=this.importExportState.exportOptions$.value;o?(o.layers=t.options.layers,o.featureInMapExtent=t.options.featureInMapExtent):o={layers:t.options.layers,featureInMapExtent:t.options.featureInMapExtent},this.importExportState.setsExportOptions(o),this.importExportState.setMode(Mn.export)}this.toolbox.getTool(t.tool)&&(this.toolbox.activateTool(t.tool),this.openSidenav$.next(!0))}}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(Ro),e.LFG(li))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}();function ci(i,a){i.entityStore.getStrategyOfType(Bt).setMotion(a.get("zoomAuto")?ce.Default:ce.None)}var cl=function(){var i=function(){function a(n){(0,h.Z)(this,a),this.igoStorageService=n}return(0,v.Z)(a,[{key:"storageService",get:function(){return this.igoStorageService}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(Te))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),S2=function(){var i=function(){function a(n,t,o,r){(0,h.Z)(this,a),this.storageState=n,this.languageService=t,this.toolState=o,this.mediaService=r,this.maximize$=new x.X(this.storageService.get("workspaceMaximize")),this.zoomAuto$=new x.X(!1)}return(0,v.Z)(a,[{key:"storageService",get:function(){return this.storageState.storageService}},{key:"zoomAuto",get:function(){return this.storageService.get("zoomAuto")}},{key:"ngOnDestroy",value:function(){this.storageChange$$&&this.storageChange$$.unsubscribe()}},{key:"loadActions",value:function(t,o,r){var s=this.buildActions(t,o,r);t.actionStore.load(s)}},{key:"buildActions",value:function(t,o,r){var s=this;return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Nt.n)(function(l){return"zoomAuto"!==l.key||l.event===Sn.CLEARED})).subscribe(function(){s.zoomAuto$.next(s.zoomAuto),ci(t,s.storageService)}),[{id:"zoomAuto",checkbox:!0,title:"igo.integration.workspace.zoomAuto.title",tooltip:"igo.integration.workspace.zoomAuto.tooltip",checkCondition:this.zoomAuto$,handler:function(){ci(t,s.storageService),s.storageService.set("zoomAuto",!s.storageService.get("zoomAuto"))}},{id:"filterInMapExtent",checkbox:!0,title:"igo.integration.workspace.inMapExtent.title",tooltip:il(t),checkCondition:o,handler:function(){return o.next(!o.value)}},{id:"selectedOnly",checkbox:!0,title:"igo.integration.workspace.selected.title",tooltip:"igo.integration.workspace.selected.tooltip",checkCondition:r,handler:function(){return r.next(!r.value)}},{id:"clearselection",icon:"select-off",title:"igo.integration.workspace.clearSelection.title",tooltip:"igo.integration.workspace.clearSelection.tooltip",handler:function(c){c.entityStore.state.updateMany(c.entityStore.view.all(),{selected:!1})},args:[t],availability:function(c){return rl(c)}},{id:"featureDownload",icon:"file-export",title:"igo.integration.workspace.download.title",tooltip:"igo.integration.workspace.download.tooltip",handler:function(c){var u=c.entityStore.getStrategyOfType(Qt),p=c.entityStore.getStrategyOfType(On);s.toolState.toolToActivateFromOptions({tool:"importExport",options:{layers:[c.layer.id],featureInMapExtent:u.active,layersWithSelection:p.active?[c.layer.id]:[]}})},args:[t]},{id:"maximize",title:this.languageService.translate.instant("igo.integration.workspace.maximize"),tooltip:this.languageService.translate.instant("igo.integration.workspace.maximizeTooltip"),icon:"resize",display:function(){return s.maximize$.pipe((0,U.U)(function(c){return!c&&!s.mediaService.isMobile()}))},handler:function(){s.mediaService.isMobile()||s.maximize$.next(!0)}},{id:"standardExtent",title:this.languageService.translate.instant("igo.integration.workspace.standardExtent"),tooltip:this.languageService.translate.instant("igo.integration.workspace.standardExtentTooltip"),icon:"resize",display:function(){return s.maximize$.pipe((0,U.U)(function(c){return c&&!s.mediaService.isMobile()}))},handler:function(){s.maximize$.next(!1)}}]}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(cl),e.LFG($),e.LFG(Gt),e.LFG(xt))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),w2=function(){var i=function(){function a(n,t,o,r,s){(0,h.Z)(this,a),this.ogcFilterWidget=n,this.storageState=t,this.languageService=o,this.mediaService=r,this.toolState=s,this.maximize$=new x.X(this.storageService.get("workspaceMaximize")),this.selectOnlyCheckCondition$=new x.X(!1),this.zoomAuto$=new x.X(!1)}return(0,v.Z)(a,[{key:"storageService",get:function(){return this.storageState.storageService}},{key:"zoomAuto",get:function(){return this.storageService.get("zoomAuto")}},{key:"ngOnDestroy",value:function(){this.storageChange$$&&this.storageChange$$.unsubscribe()}},{key:"loadActions",value:function(t,o,r){var s=this.buildActions(t,o,r);t.actionStore.load(s)}},{key:"buildActions",value:function(t,o,r){var l,s=this;this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Nt.n)(function(u){return"zoomAuto"!==(null==u?void 0:u.key)||(null==u?void 0:u.event)===Sn.CLEARED})).subscribe(function(){s.zoomAuto$.next(s.zoomAuto),ci(t,s.storageService)});var c=[{id:"zoomAuto",checkbox:!0,title:"igo.integration.workspace.zoomAuto.title",tooltip:"igo.integration.workspace.zoomAuto.tooltip",checkCondition:this.zoomAuto$,handler:function(){ci(t,s.storageService),s.storageService.set("zoomAuto",!s.storageService.get("zoomAuto"))}},{id:"filterInMapExtent",checkbox:!0,title:"igo.integration.workspace.inMapExtent.title",tooltip:il(t),checkCondition:o,handler:function(){return o.next(!o.value)}},{id:"selectedOnly",checkbox:!0,title:"igo.integration.workspace.selected.title",tooltip:"igo.integration.workspace.selected.title",checkCondition:r,handler:function(){return r.next(!r.value)}},{id:"clearselection",icon:"select-off",title:"igo.integration.workspace.clearSelection.title",tooltip:"igo.integration.workspace.clearSelection.tooltip",handler:function(p){p.entityStore.state.updateMany(p.entityStore.view.all(),{selected:!1})},args:[t],availability:function(p){return rl(p)}},{id:"wfsDownload",icon:"file-export",title:"igo.integration.workspace.download.title",tooltip:"igo.integration.workspace.download.tooltip",handler:function(p){var d=p.entityStore.getStrategyOfType(Qt),g=p.entityStore.getStrategyOfType(On);s.toolState.toolToActivateFromOptions({tool:"importExport",options:{layers:[p.layer.id],featureInMapExtent:d.active,layersWithSelection:g.active?[p.layer.id]:[]}})},args:[t]},{id:"ogcFilter",icon:"filter",title:"igo.integration.workspace.ogcFilter.title",tooltip:"igo.integration.workspace.ogcFilter.tooltip",handler:function(p,d){d.activateWidget(p,{map:d.map,layer:d.layer})},args:[this.ogcFilterWidget,t]},{id:"maximize",title:this.languageService.translate.instant("igo.integration.workspace.maximize"),tooltip:this.languageService.translate.instant("igo.integration.workspace.maximizeTooltip"),icon:"resize",display:function(){return s.maximize$.pipe((0,U.U)(function(p){return!p&&!s.mediaService.isMobile()}))},handler:function(){s.mediaService.isMobile()||s.maximize$.next(!0)}},{id:"standardExtent",title:this.languageService.translate.instant("igo.integration.workspace.standardExtent"),tooltip:this.languageService.translate.instant("igo.integration.workspace.standardExtentTooltip"),icon:"resize",display:function(){return s.maximize$.pipe((0,U.U)(function(p){return p&&!s.mediaService.isMobile()}))},handler:function(){s.maximize$.next(!1)}}];return null!==(l=t.layer.dataSource.options.ogcFilters)&&void 0!==l&&l.enabled?c:c.filter(function(u){return"ogcFilter"!==u.id})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(nl),e.LFG(cl),e.LFG($),e.LFG(xt),e.LFG(Gt))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),T2=function(){var i=function(){function a(n,t,o,r,s){(0,h.Z)(this,a),this.ogcFilterWidget=n,this.storageState=t,this.languageService=o,this.mediaService=r,this.toolState=s,this.maximize$=new x.X(this.storageService.get("workspaceMaximize")),this.zoomAuto$=new x.X(!1)}return(0,v.Z)(a,[{key:"storageService",get:function(){return this.storageState.storageService}},{key:"zoomAuto",get:function(){return this.storageService.get("zoomAuto")}},{key:"ngOnDestroy",value:function(){this.storageChange$$&&this.storageChange$$.unsubscribe()}},{key:"loadActions",value:function(t,o,r){var s=this.buildActions(t,o,r);t.actionStore.load(s)}},{key:"buildActions",value:function(t,o,r){var l,s=this;this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Nt.n)(function(u){return"zoomAuto"!==(null==u?void 0:u.key)||(null==u?void 0:u.event)===Sn.CLEARED})).subscribe(function(){s.zoomAuto$.next(s.zoomAuto),ci(t,s.storageService)});var c=[{id:"zoomAuto",checkbox:!0,title:"igo.integration.workspace.zoomAuto.title",tooltip:"igo.integration.workspace.zoomAuto.tooltip",checkCondition:this.zoomAuto$,handler:function(){ci(t,s.storageService),s.storageService.set("zoomAuto",!s.storageService.get("zoomAuto"))}},{id:"filterInMapExtent",checkbox:!0,title:"igo.integration.workspace.inMapExtent.title",tooltip:il(t),checkCondition:o,handler:function(){return o.next(!o.value)}},{id:"selectedOnly",checkbox:!0,title:"igo.integration.workspace.selected.title",tooltip:"igo.integration.workspace.selected.title",checkCondition:r,handler:function(){return r.next(!r.value)}},{id:"clearselection",icon:"select-off",title:"igo.integration.workspace.clearSelection.title",tooltip:"igo.integration.workspace.clearSelection.tooltip",handler:function(p){p.entityStore.state.updateMany(p.entityStore.view.all(),{selected:!1})},args:[t],availability:function(p){return rl(p)}},{id:"wfsDownload",icon:"file-export",title:"igo.integration.workspace.download.title",tooltip:"igo.integration.workspace.download.tooltip",handler:function(p){var d=p.entityStore.getStrategyOfType(Qt),g=p.entityStore.getStrategyOfType(On);s.toolState.toolToActivateFromOptions({tool:"importExport",options:{layers:[p.layer.id],featureInMapExtent:d.active,layersWithSelection:g.active?[p.layer.id]:[]}})},args:[t]},{id:"ogcFilter",icon:"filter",title:"igo.integration.workspace.ogcFilter.title",tooltip:"igo.integration.workspace.ogcFilter.tooltip",handler:function(p,d){d.activateWidget(p,{map:d.map,layer:d.layer})},args:[this.ogcFilterWidget,t]},{id:"maximize",title:this.languageService.translate.instant("igo.integration.workspace.maximize"),tooltip:this.languageService.translate.instant("igo.integration.workspace.maximizeTooltip"),icon:"resize",display:function(){return s.maximize$.pipe((0,U.U)(function(p){return!p&&!s.mediaService.isMobile()}))},handler:function(){s.mediaService.isMobile()||s.maximize$.next(!0)}},{id:"standardExtent",title:this.languageService.translate.instant("igo.integration.workspace.standardExtent"),tooltip:this.languageService.translate.instant("igo.integration.workspace.standardExtentTooltip"),icon:"resize",display:function(){return s.maximize$.pipe((0,U.U)(function(p){return p&&!s.mediaService.isMobile()}))},handler:function(){s.maximize$.next(!1)}}];return null!==(l=t.layer.dataSource.options.ogcFilters)&&void 0!==l&&l.enabled?c:c.filter(function(u){return"ogcFilter"!==u.id})}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(nl),e.LFG(cl),e.LFG($),e.LFG(xt),e.LFG(Gt))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),ua=function(){var i=function(){function a(n,t,o,r){(0,h.Z)(this,a),this.featureActionsService=n,this.wfsActionsService=t,this.editionActionsService=o,this.storageService=r,this.workspacePanelExpanded=!1,this.workspaceEnabled$=new x.X(!1),this.rowsInMapExtentCheckCondition$=new x.X(!0),this.selectOnlyCheckCondition$=new x.X(!1),this.workspaceMaximize$=new x.X(this.storageService.get("workspaceMaximize")),this.actionMaximize$$=[],this.activeWorkspaceWidget$=new x.X(void 0),this.workspace$=new x.X(void 0),this.initWorkspaces()}return(0,v.Z)(a,[{key:"store",get:function(){return this._store}},{key:"workspaceSelection",get:function(){var t;return this.workspace$.value?null===(t=this.workspace$.value)||void 0===t?void 0:t.entityStore.stateView.manyBy(function(o){return!0===o.state.selected}):[]}},{key:"workspaceSelection$",get:function(){var t,o;return this.workspace$.value?null===(o=null===(t=this.workspace$.value)||void 0===t?void 0:t.entityStore)||void 0===o?void 0:o.stateView.manyBy$(function(r){return!0===r.state.selected}):(0,ge.of)([])}},{key:"initWorkspaces",value:function(){var t=this;this._store=new Gl([]),this._store.stateView.firstBy$(function(o){return!0===o.state.active}).subscribe(function(o){t.workspace$.next(o?o.entity:void 0)}),this._store.stateView.all$().subscribe(function(o){o.map(function(r){r.entity.actionStore.empty&&(r.entity instanceof ol?t.wfsActionsService.loadActions(r.entity,t.rowsInMapExtentCheckCondition$,t.selectOnlyCheckCondition$):r.entity instanceof pp?t.featureActionsService.loadActions(r.entity,t.rowsInMapExtentCheckCondition$,t.selectOnlyCheckCondition$):r.entity instanceof cp&&t.editionActionsService.loadActions(r.entity,t.rowsInMapExtentCheckCondition$,t.selectOnlyCheckCondition$))})}),this.actionMaximize$$.push(this.featureActionsService.maximize$.subscribe(function(o){t.setWorkspaceIsMaximized(o)})),this.actionMaximize$$.push(this.wfsActionsService.maximize$.subscribe(function(o){t.setWorkspaceIsMaximized(o)})),this.actionMaximize$$.push(this.editionActionsService.maximize$.subscribe(function(o){t.setWorkspaceIsMaximized(o)})),this.activeWorkspace$$=this.workspace$.subscribe(function(o){void 0!==t.activeWorkspaceWidget$$&&(t.activeWorkspaceWidget$$.unsubscribe(),t.activeWorkspaceWidget$$=void 0),void 0!==o&&(t.activeWorkspaceWidget$$=o.widget$.subscribe(function(r){return t.activeWorkspaceWidget$.next(r)}))}),this.rowsInMapExtentCheckCondition$$=this.rowsInMapExtentCheckCondition$.subscribe(function(o){t._store.stateView.all().map(function(r){if(!r.entity.actionStore.empty){var s=r.entity.entityStore.getStrategyOfType(Qt);s&&(o?s.activate():s.deactivate())}})}),this.selectOnlyCheckCondition$$=this.selectOnlyCheckCondition$.subscribe(function(o){t._store.stateView.all().map(function(r){if(!r.entity.actionStore.empty){var s=r.entity.entityStore.getStrategyOfType(On);s&&(o?s.activate():s.deactivate())}})})}},{key:"setWorkspaceIsMaximized",value:function(t){this.storageService.set("workspaceMaximize",t),this.workspaceMaximize$.next(t)}},{key:"setActiveWorkspaceById",value:function(t){var o=this.store.all().find(function(r){return r.id===t});o&&this.store.activateWorkspace(o)}},{key:"setActiveWorkspaceByTitle",value:function(t){var o=this.store.all().find(function(r){return r.title===t});o&&this.store.activateWorkspace(o)}},{key:"ngOnDestroy",value:function(){this.teardownWorkspaces(),this.actionMaximize$$.map(function(t){return t.unsubscribe()}),this.rowsInMapExtentCheckCondition$$&&this.selectOnlyCheckCondition$$.unsubscribe(),this.selectOnlyCheckCondition$$&&this.selectOnlyCheckCondition$$.unsubscribe()}},{key:"teardownWorkspaces",value:function(){this.store.clear(),void 0!==this.activeWorkspaceWidget$$&&this.activeWorkspaceWidget$$.unsubscribe(),void 0!==this.activeWorkspace$$&&this.activeWorkspace$$.unsubscribe()}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(S2),e.LFG(w2),e.LFG(T2),e.LFG(Te))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),pl=function(){var i=function(){function a(n,t,o){(0,h.Z)(this,a),this.searchSourceService=n,this.storageService=t,this.configService=o,this.searchOverlayStyle={},this.searchOverlayStyleSelection={},this.searchOverlayStyleFocus={},this.searchTermSplitter$=new x.X("|"),this.searchTerm$=new x.X(void 0),this.searchType$=new x.X(void 0),this.searchDisabled$=new x.X(!1),this.searchResultsGeometryEnabled$=new x.X(!1),this.searchSettingsChange$=new x.X(void 0),this.selectedResult$=new x.X(void 0),this.store=new mt([]);var r=this.configService.getConfig("searchOverlayStyle");r&&(this.searchOverlayStyle=r.base,this.searchOverlayStyleSelection=r.selection,this.searchOverlayStyleFocus=r.focus);var s=this.storageService.get("searchResultsGeometryEnabled");s&&this.searchResultsGeometryEnabled$.next(s),this.store.addStrategy(this.createCustomFilterTermStrategy(),!1)}return(0,v.Z)(a,[{key:"searchTypes",get:function(){return this.searchSourceService.getEnabledSources().map(function(t){return t.constructor.type})}},{key:"createCustomFilterTermStrategy",value:function(){return new Qt({filterClauseFunc:function(r){return 100===r.entity.meta.score}})}},{key:"activateCustomFilterTermStrategy",value:function(){var t=this.store.getStrategyOfType(Qt);void 0!==t&&t.activate()}},{key:"deactivateCustomFilterTermStrategy",value:function(){var t=this.store.getStrategyOfType(Qt);void 0!==t&&t.deactivate()}},{key:"enableSearch",value:function(){this.searchDisabled$.next(!1)}},{key:"disableSearch",value:function(){this.searchDisabled$.next(!0)}},{key:"setSearchTerm",value:function(t){this.searchTerm$.next(t)}},{key:"setSearchType",value:function(t){this.searchSourceService.enableSourcesByType(t),this.searchType$.next(t)}},{key:"setSearchSettingsChange",value:function(){this.searchSettingsChange$.next(!0)}},{key:"setSelectedResult",value:function(t){this.selectedResult$.next(t)}},{key:"setSearchResultsGeometryStatus",value:function(t){this.storageService.set("searchResultsGeometryEnabled",t),this.searchResultsGeometryEnabled$.next(t)}}]),a}();return i.\u0275fac=function(n){return new(n||i)(e.LFG(vn),e.LFG(Te),e.LFG(j))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(),IF=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[aa]}),i}(),$F=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,O.Ps,bt.g,J.AV,I.ot,he,Rn,aa,Da,Pt,Ds,Eo]}),i}(),Bp=function(){var i=(0,v.Z)(function a(){(0,h.Z)(this,a)});return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[IF,$F]}),i}();const VF=["mapBrowser"];function zF(i,a){1&i&&(e.TgZ(0,"span",11),e._uU(1," F2 activate/deactivate the pointer location. "),e.qZA())}function WF(i,a){if(1&i&&e._UZ(0,"igo-search-add-button",12),2&i){const n=a.result,t=e.oxw();e.Q6J("map",t.map)("layer",n)}}function KF(i,a){if(1&i&&(e.TgZ(0,"igo-panel",11),e._UZ(1,"igo-feature-details",13),e.qZA()),2&i){const n=e.oxw();e.xp6(1),e.Q6J("feature",n.selectedFeature)}}function XF(i,a){if(1&i&&e._UZ(0,"igo-actionbar",14),2&i){const n=e.oxw();e.Q6J("store",n.store)("withIcon",!1)("horizontal",!0)("mode","context")}}const tZ=me.Bz.forChild([{path:"search",component:(()=>{class i{constructor(n,t,o,r,s,l){this.languageService=n,this.projectionService=t,this.mapService=o,this.layerService=r,this.searchState=s,this.mediaService=l,this.store=new Hn([]),this.igoSearchPointerSummaryEnabled=!1,this.termSplitter="|",this.map=new ct({overlay:!0,controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:7},this.settingsChange$=new x.X(void 0),this.mapService.setMap(this.map),this.layerService.createAsyncLayer({title:"OSM",sourceOptions:{type:"osm"}}).subscribe(c=>{this.osmLayer=c,this.map.addLayer(c)})}get searchStore(){return this.searchState.store}get isTouchScreen(){return this.mediaService.isTouchScreen()}onPointerSummaryStatusChange(n){this.igoSearchPointerSummaryEnabled=n}onSearchTermChange(n=""){this.term=n,n.replace(/(#[^\s]*)/g,"").trim().length<2&&(this.searchStore.clear(),this.selectedFeature=void 0)}onSearch(n){const t=n.results;this.searchStore.state.updateAll({focused:!1,selected:!1});const o=this.searchStore.entities$.value.filter(r=>r.source!==n.research.source).concat(t);this.searchStore.updateMany(o)}onSearchSettingsChange(){this.settingsChange$.next(!0)}onResultFocus(n){this.tryAddFeatureToMap(n),this.selectedFeature=n.data}tryAddFeatureToMap(n){n.meta.dataType===be&&void 0!==n.data.geometry&&this.map.searchResultsOverlay.setFeatures([n.data],ce.Default)}ngOnInit(){this.store.load([{id:"coordinates",title:"coordinates",handler:()=>this.searchCoordinate(this.lonlat)},{id:"googleMaps",title:"googleMap",handler:()=>this.openGoogleMaps(this.lonlat)},{id:"googleStreetView",title:"googleStreetView",handler:()=>this.openGoogleStreetView(this.lonlat)}])}ngOnDestroy(){this.store.destroy()}removeFeatureFromMap(){this.map.searchResultsOverlay.clear()}onContextMenuOpen(n){const t=this.mapPosition(n),o=this.mapService.getMap().ol.getCoordinateFromPixel(t);this.mapProjection=this.mapService.getMap().projection,this.lonlat=re.vs(o,this.mapProjection,"EPSG:4326")}mapPosition(n){const t=n;return t.y=t.y-this.mapBrowser.nativeElement.getBoundingClientRect().top+window.scrollY,t.x=t.x-this.mapBrowser.nativeElement.getBoundingClientRect().left+window.scrollX,[t.x,t.y]}searchCoordinate(n){this.searchStore.clear(),this.term=n.map(t=>t.toFixed(6)).join(", ")}openGoogleMaps(n){window.open(ln.getGoogleMapsCoordLink(n[0],n[1]))}openGoogleStreetView(n){window.open(ln.getGoogleStreetViewLink(n[0],n[1]))}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Pi),e.Y36(Vt),e.Y36(Ge),e.Y36(pl),e.Y36(xt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-search"]],viewQuery:function(n,t){if(1&n&&e.Gf(VF,7,e.SBq),2&n){let o;e.iGM(o=e.CRH())&&(t.mapBrowser=o.first)}},decls:30,vars:16,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/search"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments"],["title","Details",4,"ngIf"],["igoOverlay","","igoLongPress","","igoSearchPointerSummary","",3,"map","view","igoContextMenu","igoSearchPointerSummaryDelay","igoSearchPointerSummaryEnabled","menuPosition"],["mapBrowser",""],["color","primary",3,"map"],["title","Search"],[3,"term","searchSettings","store","termSplitter","pointerSummaryStatus","searchTermChange","search","clearFeature","searchSettingsChange"],["placeholder","false",3,"store","term","termSplitter","settingsChange$","resultFocus","resultSelect","moreResults"],["igoSearchItemToolbar",""],["actionbarMenu",""],["title","Details"],[3,"map","layer"],[3,"feature"],[3,"store","withIcon","horizontal","mode"]],template:function(n,t){if(1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Search"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: ConfigService, LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"br"),e._uU(13," See search section of the "),e.TgZ(14,"a",1),e._uU(15," environment config"),e.qZA(),e._UZ(16,"hr")(17,"br"),e.YNc(18,zF,2,0,"span",2),e.qZA(),e.TgZ(19,"igo-map-browser",3,4),e.NdJ("menuPosition",function(r){return t.onContextMenuOpen(r)}),e._UZ(21,"igo-zoom-button",5),e.qZA(),e.TgZ(22,"igo-panel",6)(23,"igo-search-bar",7),e.NdJ("pointerSummaryStatus",function(r){return t.onPointerSummaryStatusChange(r)})("searchTermChange",function(r){return t.onSearchTermChange(r)})("search",function(r){return t.onSearch(r)})("clearFeature",function(){return t.removeFeatureFromMap()})("searchSettingsChange",function(){return t.onSearchSettingsChange()}),e.qZA(),e.TgZ(24,"igo-search-results",8),e.NdJ("resultFocus",function(r){return t.onResultFocus(r)})("resultSelect",function(r){return t.onResultFocus(r)})("moreResults",function(r){return t.onSearch(r)}),e.YNc(25,WF,1,2,"ng-template",null,9,e.W1O),e.qZA()(),e.YNc(27,KF,2,1,"igo-panel",2),e.qZA(),e.YNc(28,XF,1,4,"ng-template",null,10,e.W1O)),2&n){const o=e.MAs(29);e.xp6(18),e.Q6J("ngIf",!t.isTouchScreen),e.xp6(1),e.Q6J("map",t.map)("view",t.view)("igoContextMenu",o)("igoSearchPointerSummaryDelay",500)("igoSearchPointerSummaryEnabled",t.igoSearchPointerSummaryEnabled),e.xp6(2),e.Q6J("map",t.map),e.xp6(2),e.Q6J("term",t.term)("searchSettings",!0)("store",t.searchStore)("termSplitter",t.termSplitter),e.xp6(1),e.Q6J("store",t.searchStore)("term",t.term)("termSplitter",t.termSplitter)("settingsChange$",t.settingsChange$),e.xp6(3),e.Q6J("ngIf",t.selectedFeature)}},dependencies:[C.O5,F.a8,F.dn,F.n5,F.$j,Ut,Be,vt,tl,op,ip,sx,bi,Zl,qg,Mo],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{height:100%;width:100%;padding-top:10px}"]}),i})()}]);let nZ=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[{provide:St,useFactory:mT,multi:!0,deps:[j,$,Te,Pi]},{provide:St,useFactory:Sx,multi:!0,deps:[W.eN,$,Te,j]},{provide:St,useFactory:cT,multi:!0,deps:[W.eN,$,Te,j,ia,e.zs3]},{provide:St,useFactory:_T,multi:!0,deps:[W.eN,$,Te,j,ra]},{provide:St,useFactory:Tx,multi:!0,deps:[W.eN,j,Te]},{provide:St,useFactory:pT,multi:!0,deps:[W.eN,$,Te,j,e.zs3]},{provide:St,useFactory:kx,multi:!0,deps:[W.eN,$,Te,j]},{provide:St,useFactory:Fx,multi:!0,deps:[W.eN,$,Te,j]}],imports:[C.ez,tZ,F.QW,I.ot,O.Ps,J.AV,Ln.forRoot(),Pt,ft,aa.forRoot(),Bp,gr,Al,Rn]}),i})();const iZ=me.Bz.forChild([{path:"print",component:(()=>{class i{constructor(n,t){this.languageService=n,this.layerService=t,this.map=new ct({controls:{attribution:{collapsed:!1}}}),this.view={center:[-73,47.2],zoom:9},this.layerService.createAsyncLayer({title:"Quebec Base Map",sourceOptions:{type:"wmts",url:"https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts",layer:"carte_gouv_qc_ro",matrixSet:"EPSG_3857",version:"1.3.0",crossOrigin:"anonymous",attributions:"\xa9 <a href='http://www.droitauteur.gouv.qc.ca/copyright.php' target='_blank'><img src='https://geoegl.msp.gouv.qc.ca/gouvouvert/public/images/quebec/gouv_qc_logo.png' width='64' height='14'>Gouvernement du Qu\xe9bec</a> / <a href='https://www.igouverte.org/' target='_blank'>IGO2</a>"}}).subscribe(o=>this.map.addLayer(o)),this.layerService.createAsyncLayer({title:"School board",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{LAYERS:"MELS_CS_ANGLO_S",VERSION:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(o=>this.map.addLayer(o)),this.layerService.createAsyncLayer({title:"Embacle",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(o=>this.map.addLayer(o))}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Ge))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-print"]],decls:19,vars:8,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/print"],[3,"map","view"],["color","primary",3,"map"],["color","primary",3,"map","showIfNoRotation"],[3,"map"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Print"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2)(15,"igo-geolocate-button",2)(16,"igo-home-extent-button",2)(17,"igo-rotation-button",3),e.qZA(),e._UZ(18,"igo-print",4),e.qZA()),2&n&&(e.xp6(13),e.Q6J("map",t.map)("view",t.view),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("map",t.map)("showIfNoRotation",!1),e.xp6(1),e.Q6J("map",t.map))},dependencies:[F.a8,F.dn,F.n5,F.$j,Be,vt,Ri,Ji,Bi,qu],styles:["igo-map-browser[_ngcontent-%COMP%]{width:900px;height:1000px}"]}),i})()}]);let rZ=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[iZ,F.QW,I.ot,Ln,ft,Qs]}),i})();const sZ=me.Bz.forChild([{path:"import-export",component:(()=>{class i{constructor(n,t){this.languageService=n,this.layerService=t,this.map=new ct({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:9},this.store=new Gl([]),this.layerService.createAsyncLayer({title:"OSM",sourceOptions:{type:"osm"}}).subscribe(o=>this.map.addLayer(o))}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Ge))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-import-export"]],decls:16,vars:5,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/import-export"],[3,"map","view"],["color","primary",3,"map"],[3,"store","map"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Import / Export"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2),e.qZA(),e._UZ(15,"igo-import-export",3),e.qZA()),2&n&&(e.xp6(13),e.Q6J("map",t.map)("view",t.view),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("store",t.store)("map",t.map))},dependencies:[F.a8,F.dn,F.n5,F.$j,Be,vt,Iu],styles:["igo-map-browser[_ngcontent-%COMP%]{width:900px;height:1000px}"]}),i})()}]);let lZ=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[Ou({path:"./assets/import-style.json"})],imports:[sZ,F.QW,I.ot,Ln,ft,Kr]}),i})();const uZ=me.Bz.forChild([{path:"directions",component:(()=>{class i{constructor(n,t,o,r){this.projectionService=n,this.languageService=t,this.layerService=o,this.mapService=r,this.map=new ct({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:9,geolocate:!1},this.stopsStore=new hp([]),this.stopsFeatureStore=new vp([],{map:this.map}),this.stepFeatureStore=new _p([],{map:this.map}),this.routesFeatureStore=new yp([],{map:this.map}),this.zoomToActiveRoute$=new $e.x,this.mapService.setMap(this.map),this.layerService.createAsyncLayer({title:"OSM",sourceOptions:{type:"osm"}}).subscribe(s=>this.map.addLayer(s))}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(Pi),e.Y36($),e.Y36(Ge),e.Y36(Vt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-directions"]],decls:19,vars:12,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/directions"],[3,"map","view"],["color","primary",3,"map"],["color","primary",3,"map","showIfNoRotation"],[3,"stopsStore","stopsFeatureStore","stepFeatureStore","routesFeatureStore","zoomToActiveRoute$"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Directions"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2)(15,"igo-geolocate-button",2)(16,"igo-home-extent-button",2)(17,"igo-rotation-button",3),e.qZA(),e._UZ(18,"igo-directions",4),e.qZA()),2&n&&(e.xp6(13),e.Q6J("map",t.map)("view",t.view),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("map",t.map)("showIfNoRotation",!1),e.xp6(1),e.Q6J("stopsStore",t.stopsStore)("stopsFeatureStore",t.stopsFeatureStore)("stepFeatureStore",t.stepFeatureStore)("routesFeatureStore",t.routesFeatureStore)("zoomToActiveRoute$",t.zoomToActiveRoute$))},dependencies:[F.a8,F.dn,F.n5,F.$j,Be,vt,Ri,Ji,Bi,Hu],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]}),i})()}]);let pZ=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[{provide:Ys,useFactory:bx,multi:!0,deps:[W.eN,j]}],imports:[uZ,F.QW,I.ot,Ln,ft,Ks]}),i})();const gZ=me.Bz.forChild([{path:"time-filter",component:(()=>{class i{constructor(n,t,o){this.languageService=n,this.dataSourceService=t,this.layerService=o,this.map=new ct({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:7},this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(s=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:s}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi",params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"},timeFilterable:!0,timeFilter:{min:"2013",max:"2019",range:!1,type:lt.YEAR,style:Jt.SLIDER,step:1,timeInterval:2e3}}).subscribe(s=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle YEAR",visible:!0,source:s}))})}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Et),e.Y36(Ge))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-time-filter"]],decls:21,vars:4,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/time-filter"],[3,"map","view"],["color","primary",3,"map"],["title","Layers"],[3,"layers"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Time filter"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"npm install --save moment@2.22.2"),e.qZA(),e.TgZ(8,"li"),e._uU(9,"npm install --save @mat-datetimepicker/core@3.0.0-beta.0"),e.qZA(),e.TgZ(10,"li"),e._uU(11,"Dependencies: LanguageService"),e.qZA(),e._UZ(12,"br"),e._uU(13," See the "),e.TgZ(14,"a",0),e._uU(15,"code of this example"),e.qZA(),e._UZ(16,"hr"),e.qZA(),e.TgZ(17,"igo-map-browser",1),e._UZ(18,"igo-zoom-button",2),e.qZA(),e.TgZ(19,"igo-panel",3),e._UZ(20,"igo-time-filter-list",4),e.qZA()()),2&n&&(e.xp6(17),e.Q6J("map",t.map)("view",t.view),e.xp6(1),e.Q6J("map",t.map),e.xp6(2),e.Q6J("layers",t.map.layers))},dependencies:[F.a8,F.dn,F.n5,F.$j,Ut,Be,vt,Hr],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]}),i})()}]);let fZ=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[gZ,F.QW,I.ot,O.Ps,Pt,ft,Jn]}),i})();const hZ=me.Bz.forChild([{path:"ogc-filter",component:(()=>{class i{constructor(n,t,o){this.languageService=n,this.dataSourceService=t,this.layerService=o,this.map=new ct({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:7},this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:m}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"code_municipalite",alias:"# de la municipalit\xe9e"},{name:"date_observation",excludeFromOgcFilters:!0},{name:"urgence",values:["imm\xe9diate","inconnue"]}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:it.All,filters:{logical:"Or",filters:[{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"10043"},{operator:"Intersects",geometryName:"the_geom",wkt_geometry:"MULTIPOLYGON(((\n              -8379441.158019895 5844447.897707146,\n              -8379441.158019895 5936172.331649357,\n              -8134842.66750733 5936172.331649357,\n              -8134842.66750733 5844447.897707146,\n              -8379441.158019895 5844447.897707146\n            ), (\n              -8015003 5942074,\n              -8015003 5780349,\n              -7792364 5780349,\n              -7792364 5942074,\n              -8015003 5942074\n            )))"}]}}}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (PropertyIsEqualTo OR Intersects)",source:m,style:new ee.ZP({image:new Ue.Z({radius:5,fill:new te.Z({color:"white"}),stroke:new K.Z({color:"orange",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:it.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-21T00:00:00-05:00",end:"2016-01-26T00:00:00-05:00"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2016-02-10T00:00:00-05:00",stepDate:"P2D"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, Step: P2D)",id:"1",source:m,style:new ee.ZP({image:new Ue.Z({radius:5,fill:new te.Z({color:"white"}),stroke:new K.Z({color:"red",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:it.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01T04:00:00-05:00",end:"2016-01-12T16:00:00-05:00"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2016-02-14T20:00:00-05:00",stepDate:"PT4H"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, Step: PT4H)",id:"2",source:m,style:new ee.ZP({image:new Ue.Z({radius:5,fill:new te.Z({color:"white"}),stroke:new K.Z({color:"blue",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:it.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01T00:00:00-05:00",end:"2016-03-31T00:00:00-05:00",displayFormat:"MMMM"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2018-12-31T00:00:00-05:00",stepDate:"P1M"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, Step: P1M)",id:"3",source:m,style:new ee.ZP({image:new Ue.Z({radius:5,fill:new te.Z({color:"white"}),stroke:new K.Z({color:"yellow",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:it.All,filters:{operator:"During",propertyName:"date_observation",begin:"2014-01-01T00:00:00-05:00",end:"2019-12-31T00:00:00-05:00",sliderOptions:{interval:2e3,displayFormat:"YY"},displayFormat:"YYYY"}},minDate:"2014-01-01T00:00:00-05:00",maxDate:"2019-12-31T00:00:00-05:00",stepDate:"P1Y"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, Step: P1Y)",id:"4",source:m,style:new ee.ZP({image:new Ue.Z({radius:5,fill:new te.Z({color:"white"}),stroke:new K.Z({color:"green",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:it.All,filters:{operator:"During",propertyName:"date_observation",begin:"today - 2 days",end:"today"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2025-12-31T00:00:00-05:00",stepDate:"P1D"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, Interval from Now, Step: P1D)",id:"5",source:m,style:new ee.ZP({image:new Ue.Z({radius:5,fill:new te.Z({color:"white"}),stroke:new K.Z({color:"black",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:it.All,filters:{operator:"During",propertyName:"date_observation",begin:"2019-01-01 00:00:00",restrictToStep:!0}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2025-12-31T00:00:00-05:00",stepDate:"P1M"}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cle (During, RestrictToStep, Step: P1M)",id:"6",source:m,style:new ee.ZP({image:new Ue.Z({radius:5,fill:new te.Z({color:"black"}),stroke:new K.Z({color:"red",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi",optionsFromCapabilities:!0,params:{LAYERS:"vg_observation_v_inondation23avril2017_wmst",VERSION:"1.3.0"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:"Time"}],ogcFilters:{enabled:!0,editable:!0,filters:{operator:"During",propertyName:"date_observation"},allowedOperatorsType:it.Time}}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Inondation (During, optionsFromCapabilities)",source:m}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",urlWfs:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"radars_photos",VERSION:"1.3.0"},ogcFilters:{enabled:!0,editable:!0,pushButtons:{selectorType:"pushButton",order:2,groups:[{title:"Nom du group1 - push",name:"1 - push",ids:["id1"]}],bundles:[{id:"id1",title:"R\xe9gions",logical:"Or",vertical:!0,selectors:[{title:"Montr\xe9al & Laval",enabled:!1,tooltip:"Here a tooltip explaning ...",filters:{logical:"Or",filters:[{operator:"PropertyIsEqualTo",propertyName:"region",expression:"Montr\xe9al"},{operator:"PropertyIsEqualTo",propertyName:"region",expression:"Laval"}]}},{title:"Outside Montr\xe9al & Laval",enabled:!1,tooltip:"Here a tooltip explaning ...",filters:{logical:"And",filters:[{operator:"PropertyIsNotEqualTo",propertyName:"region",expression:"Montr\xe9al"},{operator:"PropertyIsNotEqualTo",propertyName:"region",expression:"Laval"}]}}]}]},checkboxes:{selectorType:"checkbox",order:1,groups:[{title:"Nom du group1 - checkbox",name:"1 - checkbox",ids:["id1"]}],bundles:[{id:"id1",title:"Type de radar photo",logical:"Or",selectors:[{title:"Radar photo fixe",enabled:!0,tooltip:"Here a tooltip explaning ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo fixe"}},{title:"Radar photo mobile",enabled:!1,tooltip:"Here a tooltip explaning ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo mobile"}},{title:"Radar photo fixe + feu rouge",enabled:!1,color:"0,200,0",tooltip:"Here a tooltip explaning ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo fixe et surveillance au feu rouge"}},{title:"Radar feu rouge",enabled:!1,color:"255,0,0",tooltip:"Here a tooltip explaning ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Appareil de surveillance au feu rouge"}}]}]},allowedOperatorsType:it.Basic},paramsWFS:{featureTypes:"radars_photos",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"1.1.0",outputFormat:"geojson",outputFormatDownload:"shp"}}).subscribe(m=>{this.map.addLayer(this.layerService.createLayer({title:"Filterable WMS layers with predefined filters (push buttons)",source:m}))})}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Et),e.Y36(Ge))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-ogc-filter"]],decls:17,vars:5,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/ogc-filter"],[3,"map","view"],["color","primary",3,"map"],["title","Layers"],[3,"map","layers"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Ogc filter"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2),e.qZA(),e.TgZ(15,"igo-panel",3),e._UZ(16,"igo-ogc-filterable-list",4),e.qZA()()),2&n&&(e.xp6(13),e.Q6J("map",t.map)("view",t.view),e.xp6(1),e.Q6J("map",t.map),e.xp6(2),e.Q6J("map",t.map)("layers",t.map.layers))},dependencies:[F.a8,F.dn,F.n5,F.$j,Ut,Be,vt,Vr],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]}),i})()}]);let vZ=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[hZ,F.QW,I.ot,O.Ps,Pt,ft,Jn]}),i})();function yZ(i,a){if(1&i&&(e.ynx(0),e._UZ(1,"igo-feature-details",6),e.BQk()),2&i){const n=a.ngIf;e.xp6(1),e.Q6J("feature",n)}}const bZ=me.Bz.forChild([{path:"spatial-filter",component:(()=>{class i{constructor(n,t,o,r,s,l,c){this.matIconRegistry=n,this.spatialFilterService=t,this.dataSourceService=o,this.layerService=r,this.messageService=s,this.languageService=l,this.cdRef=c,this.map=new ct({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:6},this.itemType=It.Address,this.layers=[],this.activeLayers=[],this.buffer=0,this.iterator=1,this.selectedFeature$=new x.X(void 0),this.format=new Ee.Z,this.store=new mt([]),this.spatialListStore=new mt([]),this.loading=!1,this.thematicLength=0,this.measureUnit=ye.Meters,this.unsubscribe$=new $e.x,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(u=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:u}))})}ngOnInit(){for(const n of this.map.layers)n.title&&n.title.includes(this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"))&&this.layers.push(n)}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}getOutputType(n){this.type=n,this.queryType=void 0}getOutputQueryType(n){this.queryType=n,this.queryType&&this.loadFilterList()}loadFilterList(){this.spatialFilterService.loadFilterList(this.queryType).pipe((0,En.R)(this.unsubscribe$)).subscribe(n=>{n.sort((t,o)=>t.properties.nom<o.properties.nom?-1:t.properties.nom>o.properties.nom?1:0),this.spatialListStore.clear(),this.spatialListStore.load(n)})}getOutputToggleSearch(){this.loadThematics()}getOutputClearSearch(){this.zone=void 0,this.queryType=void 0}clearMap(){this.map.removeLayers(this.layers),this.layers=[],this.activeLayers=[],this.thematicLength=0,this.iterator=1,this.type===Ie.Predefined&&(this.zone=void 0,this.queryType=void 0)}loadThematics(){this.loading=!0;let t,n=!0;(0===this.buffer||this.type===Ie.Point)&&this.tryAddFeaturesToMap([this.zone]),t=this.itemType!==It.Thematics?[{name:""}]:this.thematics,this.measureUnit===ye.Kilometers&&this.type!==Ie.Point&&(this.buffer=1e3*this.buffer),this.type===Ie.Polygon&&(this.buffer=0);const o=[];t.forEach(r=>{o.push(this.spatialFilterService.loadFilterItem(this.zone,this.itemType,this.queryType,r,this.buffer).pipe((0,qo.b)(s=>{this.store.insertMany(s);const l=[],c=[];let u,p;s.forEach(d=>{"Point"===d.geometry.type?(d.properties.longitude=d.geometry.coordinates[0],d.properties.latitude=d.geometry.coordinates[1],l.push(d),u=d.meta.id):(c.push(d),p=d.meta.id)}),this.tryAddPointToMap(l,u),this.tryAddLayerToMap(c,p),s.length?(n=!1,this.thematicLength+=1,r.zeroResults=!1,this.cdRef.detectChanges()):r.zeroResults=!0,s.length>=1e4&&this.messageService.alert(this.languageService.translate.instant("igo.geo.spatialFilter.maxSizeAlert"),this.languageService.translate.instant("igo.geo.spatialFilter.warning"),{timeOut:1e4})})))}),(0,un.D)(o).pipe((0,En.R)(this.unsubscribe$)).subscribe(()=>{this.loading=!1,n&&this.messageService.alert(this.languageService.translate.instant("igo.geo.spatialFilter.zeroResults"),this.languageService.translate.instant("igo.geo.spatialFilter.warning"),{timeOut:1e4})})}onZoneChange(n,t){this.zone=n,n&&(t?this.tryAddFeaturesToMap([n],!0):this.tryAddFeaturesToMap([n]),this.zoomToFeatureExtent(n))}tryAddFeaturesToMap(n,t){var o,r,s,l;let c=1;for(const u of n){if(this.type===Ie.Predefined)for(const p of this.layers){if(p.options._internal&&p.options._internal.code===u.properties.code&&!t){if(null===(o=p.title)||void 0===o||!o.startsWith("Zone")){const d=this.layers.indexOf(p);this.layers.splice(d,1)}return}if(null!==(r=p.title)&&void 0!==r&&r.startsWith("Zone")){this.activeLayers=[];const d=this.layers.indexOf(p);this.layers.splice(d,1),this.map.removeLayer(p)}}else{if(t)for(const p of this.activeLayers)if(1===this.activeLayers.length&&(null===(s=p.title)||void 0===s?void 0:s.startsWith("Zone"))){const d=this.layers.indexOf(p);this.layers.splice(d,1),this.map.removeLayer(p)}this.activeLayers=[]}for(const p of this.layers)null!==(l=p.title)&&void 0!==l&&l.startsWith("Zone")&&c++;this.defaultStyle=(p,d)=>{const g=n[0].coordinates;return new ee.ZP({image:new Ue.Z({radius:g?this.buffer/Math.cos(Math.PI/180*g[1])/d:void 0,fill:new te.Z({color:"rgba(200, 200, 20, 0.2)"}),stroke:new K.Z({width:1,color:"orange"})}),stroke:new K.Z({width:1,color:"orange"}),fill:new te.Z({color:"rgba(200, 200, 20, 0.2)"})})},this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,We.q)(1)).subscribe(p=>{const d=this.layerService.createLayer({isIgoInternalLayer:!0,title:"Zone "+c+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),workspace:{enabled:!0},_internal:{code:this.type===Ie.Predefined?u.properties.code:void 0},source:p,visible:!0}),g=n.map(m=>At(m,this.map.projection));if(this.type!==Ie.Predefined){const m=this.type===Ie.Point?"Cercle":"Polygone";g[0].set("nom","Zone",!0),g[0].set("type",m,!0)}p.ol.addFeatures(g),d.ol.setStyle(this.defaultStyle),this.map.addLayer(d),this.layers.push(d),this.activeLayers.push(d),this.cdRef.detectChanges()})}}tryAddPointToMap(n,t){var o;let r=1;if(n.length){if(void 0===this.map)return;for(const s of this.layers)null!==(o=s.title)&&void 0!==o&&o.startsWith(n[0].meta.title)&&r++;this.dataSourceService.createAsyncDataSource({type:"cluster",id:t,queryable:!0,distance:120,meta:{title:"Cluster"}}).pipe((0,We.q)(1)).subscribe(s=>{const l=n[0].meta.icon;let c;c=l&&this.createSvgIcon(l)||no();const u=this.layerService.createLayer({isIgoInternalLayer:!0,title:n[0].meta.title+" "+r+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:s,visible:!0,style:c}),p=n.map(g=>At(g,this.map.projection));s.ol.getSource().addFeatures(p),this.layers.find(g=>g.id===u.id)&&(this.map.removeLayer(this.layers.find(g=>g.id===u.id)),r-=1,u.title=n[0].meta.title+" "+r+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),u.options.title=u.title),this.iterator=r,this.map.addLayer(u),this.layers.push(u),this.pushLayer(u),this.cdRef.detectChanges()})}}createSvgIcon(n){let t;return this.matIconRegistry.getNamedSvgIcon(n).subscribe(o=>{const r=new XMLSerializer;o.setAttribute("width","30"),o.setAttribute("height","30"),o.setAttribute("fill","rgba(0, 128, 255)"),o.setAttribute("stroke","white");const s=r.serializeToString(o);t=new ee.ZP({image:new bo.Z({src:"data:image/svg+xml;utf8,"+s})})}),t}tryAddLayerToMap(n,t){var o;let r=1;if(n.length){if(void 0===this.map)return;for(const s of this.layers)null!==(o=s.title)&&void 0!==o&&o.startsWith(n[0].meta.title)&&r++;this.dataSourceService.createAsyncDataSource({type:"vector",id:t,queryable:!0}).pipe((0,We.q)(1)).subscribe(s=>{const l=this.layerService.createLayer({isIgoInternalLayer:!0,title:n[0].meta.title+" "+r+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:s,visible:!0}),c=n.map(p=>At(p,this.map.projection));s.ol.addFeatures(c),this.layers.find(p=>p.id===l.id)&&(this.map.removeLayer(this.layers.find(p=>p.id===l.id)),r-=1,l.title=n[0].meta.title+" "+r+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),l.options.title=l.title),this.map.addLayer(l),this.layers.push(l),this.pushLayer(l),this.cdRef.detectChanges()})}}zoomToFeatureExtent(n){if(n){const t=this.format.readFeature(n,{dataProjection:n.projection,featureProjection:this.map.projection});mn(this.map,[t],ce.Zoom)}}pushLayer(n){for(const t of this.activeLayers)if(t.id===n.id)return;this.activeLayers.push(n)}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(O.jv),e.Y36(Hi),e.Y36(Et),e.Y36(Ge),e.Y36(Ae),e.Y36($),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-spatial-filter"]],inputs:{type:"type",itemType:"itemType",freehandDrawIsActive:"freehandDrawIsActive"},decls:21,vars:20,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/query"],["igoOverlay","","igoQuery","",3,"map","view","queryFeatures"],["color","primary",3,"map"],[3,"store","selectedQueryType","zone","layers","eventType","eventQueryType","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange"],[3,"type","queryType","map","zone","loading","store","layers","allLayers","thematicLength","radiusEvent","bufferEvent","measureUnitChange","freehandControl","drawZoneEvent","zoneWithBufferChange","itemTypeChange","thematicChange","toggleSearch","clearButtonEvent","clearSearchEvent"],[4,"ngIf"],[3,"feature"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Query"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"li"),e._uU(7,"Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"hr"),e.qZA(),e.TgZ(13,"igo-map-browser",1),e._UZ(14,"igo-zoom-button",2),e.qZA(),e.TgZ(15,"igo-panel")(16,"igo-spatial-filter-type",3),e.NdJ("eventType",function(r){return t.getOutputType(r)})("eventQueryType",function(r){return t.getOutputQueryType(r)})("zoneChange",function(r){return t.onZoneChange(r)})("zoneWithBufferChange",function(r){return t.onZoneChange(r,!0)})("bufferChange",function(r){return t.buffer=r})("measureUnitChange",function(r){return t.measureUnit=r}),e.qZA(),e.TgZ(17,"igo-spatial-filter-item",4),e.NdJ("radiusEvent",function(r){return t.buffer=r})("bufferEvent",function(r){return t.buffer=r})("measureUnitChange",function(r){return t.measureUnit=r})("freehandControl",function(r){return t.freehandDrawIsActive=r})("drawZoneEvent",function(r){return t.zone=r})("zoneWithBufferChange",function(r){return t.onZoneChange(r,!0)})("itemTypeChange",function(r){return t.itemType=r})("thematicChange",function(r){return t.thematics=r})("toggleSearch",function(){return t.getOutputToggleSearch()})("clearButtonEvent",function(){return t.clearMap()})("clearSearchEvent",function(){return t.getOutputClearSearch()}),e.qZA()(),e.TgZ(18,"igo-panel"),e.YNc(19,yZ,2,1,"ng-container",5),e.ALo(20,"async"),e.qZA()()),2&n&&(e.xp6(13),e.Q6J("map",t.map)("view",t.view)("queryFeatures",!0),e.xp6(1),e.Q6J("map",t.map),e.xp6(2),e.Q6J("store",t.spatialListStore)("selectedQueryType",t.queryType)("zone",t.zone)("layers",t.activeLayers),e.xp6(1),e.Q6J("type",t.type)("queryType",t.queryType)("map",t.map)("zone",t.zone)("loading",t.loading)("store",t.store)("layers",t.activeLayers)("allLayers",t.layers)("thematicLength",t.thematicLength),e.xp6(2),e.Q6J("ngIf",e.lcZ(20,18,t.selectedFeature$)))},dependencies:[F.a8,F.dn,F.n5,F.$j,Ut,Be,vt,qc,Mo,Rs,Js,C.O5,C.Ov],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}igo-form[_ngcontent-%COMP%]{display:none}igo-spatial-filter-item[_ngcontent-%COMP%]     .thematics-header{max-width:225px}"],changeDetection:0}),i})()}]);let CZ=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[bZ,F.QW,I.ot,O.Ps,Pt,ft,Ln,tr,Rn,Ds,Jn,Ci,C.ez]}),i})();function SZ(i,a){if(1&i){const n=e.EpF();e.TgZ(0,"igo-entity-table-paginator",6),e.NdJ("paginatorChange",function(o){e.CHM(n);const r=e.oxw(2);return e.KtG(r.paginatorChange(o))}),e.qZA()}if(2&i){const n=e.oxw().ngIf,t=e.oxw();e.Q6J("store",n.entityStore)("paginatorOptions",t.paginatorOptions)("entitySortChange$",t.entitySortChange$)}}function wZ(i,a){if(1&i&&(e.ynx(0),e.YNc(1,SZ,1,3,"igo-entity-table-paginator",5),e.ALo(2,"async"),e.BQk()),2&i){const n=a.ngIf;e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,n.inResolutionRange$))}}function TZ(i,a){if(1&i&&e._UZ(0,"igo-actionbar",10),2&i){const n=e.oxw().ngIf,t=e.oxw();e.Q6J("store",n.actionStore)("horizontal",!0)("withToggleButton",!0)("withTitle",!0)("mode",t.actionbarMode)}}function xZ(i,a){if(1&i&&e._UZ(0,"igo-entity-table",11),2&i){const n=e.oxw().ngIf,t=e.oxw();e.Q6J("paginator",t.workspacePaginator)("scrollBehavior",t.scrollBehavior)("store",n.entityStore)("template",n.meta.tableTemplate)}}function kZ(i,a){1&i&&(e.TgZ(0,"mat-card-content"),e._uU(1," No data available at this scale. Please zoom in. "),e.qZA())}function MZ(i,a){if(1&i&&(e.ynx(0),e.YNc(1,TZ,1,5,"igo-actionbar",7),e.YNc(2,xZ,1,4,"igo-entity-table",8),e.ALo(3,"async"),e.YNc(4,kZ,2,0,"mat-card-content",4),e.ALo(5,"async"),e._UZ(6,"igo-workspace-widget-outlet",9),e.BQk()),2&i){const n=a.ngIf;e.xp6(1),e.Q6J("ngIf",n.actionStore),e.xp6(1),e.Q6J("ngIf",n.entityStore&&n.meta&&n.meta.tableTemplate&&e.lcZ(3,4,n.inResolutionRange$)),e.xp6(2),e.Q6J("ngIf",!1===e.lcZ(5,6,n.inResolutionRange$)),e.xp6(2),e.Q6J("workspace",n)}}const ZZ=me.Bz.forChild([{path:"workspace",component:(()=>{class i{constructor(n,t,o,r){this.languageService=n,this.dataSourceService=t,this.layerService=o,this.workspaceState=r,this.entitySortChange$=new x.X(!1),this.paginatorOptions={pageSize:5,pageSizeOptions:[1,5,10,15,30,50,100],showFirstLastButtons:!0},this.map=new ct({controls:{attribution:{collapsed:!0}}}),this.view={center:[-72,47.2],zoom:5},this.actionbarMode=Dn.Overlay,this.scrollBehavior=Lo.Instant}get workspaceStore(){return this.workspaceState.store}ngOnInit(){this.selectedWorkspace$=this.workspaceStore.stateView.firstBy$(t=>!0===t.state.selected).pipe((0,U.U)(t=>{const o=void 0===t?void 0:t.entity;return o&&o.actionStore.view.filter(r=>"wfsDownload"!==r.id),o})),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(t=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:t}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{featureTypes:"etablissement_mtq",fieldNameGeometry:"geometry",version:"2.0.0",outputFormat:"geojson"},sourceFields:[{name:"idetablis",alias:"ID"},{name:"nometablis",alias:"Name"},{name:"typetablis",alias:"Type"}]}).subscribe(t=>{this.map.addLayer(this.layerService.createLayer({title:"Simple WFS ",maxResolution:3e3,visible:!0,source:t}))})}paginatorChange(n){this.workspacePaginator=n}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Et),e.Y36(Ge),e.Y36(ua))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-workspace"]],decls:16,vars:11,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/workspace"],[3,"map","view"],["color","primary",3,"map"],["igoWorkspaceSelector","",3,"store","map"],[4,"ngIf"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange",4,"ngIf"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange"],[3,"store","horizontal","withToggleButton","withTitle","mode",4,"ngIf"],["class","table-compact table-centered",3,"paginator","scrollBehavior","store","template",4,"ngIf"],[3,"workspace"],[3,"store","horizontal","withToggleButton","withTitle","mode"],[1,"table-compact","table-centered",3,"paginator","scrollBehavior","store","template"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Workspace"),e.qZA(),e.TgZ(5,"mat-card-content"),e._uU(6," See the "),e.TgZ(7,"a",0),e._uU(8,"code of this example"),e.qZA()(),e.TgZ(9,"igo-map-browser",1),e._UZ(10,"igo-zoom-button",2),e.qZA(),e._UZ(11,"igo-workspace-selector",3),e.YNc(12,wZ,3,3,"ng-container",4),e.ALo(13,"async"),e.YNc(14,MZ,7,8,"ng-container",4),e.ALo(15,"async"),e.qZA()),2&n&&(e.xp6(9),e.Q6J("map",t.map)("view",t.view),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("store",t.workspaceStore)("map",t.map),e.xp6(1),e.Q6J("ngIf",e.lcZ(13,7,t.selectedWorkspace$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(15,9,t.selectedWorkspace$)))},dependencies:[C.O5,F.a8,F.dn,F.n5,F.$j,bi,ho,Ml,ql,fm,Be,vt,hx,C.Ov],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}igo-entity-table[_ngcontent-%COMP%]{height:400px}igo-actionbar[_ngcontent-%COMP%]{height:48px}"]}),i})()}]);let AZ=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[C.ez,ZZ,F.QW,I.ot,O.Ps,ka,Pl,hm,Pt,ft,mp]}),i})();function IZ(i,a){1&i&&e._UZ(0,"igo-metadata-button",10),2&i&&e.Q6J("layer",a.layer)}const OZ=me.Bz.forChild([{path:"context",component:(()=>{class i{constructor(n,t,o){this.languageService=n,this.mapService=t,this.overlayService=o,this.map=new ct({controls:{attribution:{collapsed:!0}}}),this.view={center:[-73,47.2],zoom:6},this.mapService.setMap(this.map)}}return i.\u0275fac=function(n){return new(n||i)(e.Y36($),e.Y36(Vt),e.Y36(Gs))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-context"]],decls:28,vars:8,consts:[["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/context/context"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/contexts"],["igoMapContext","","igoLayerContext","",3,"map"],["color","primary",3,"map"],["color","primary",3,"map","showIfNoRotation"],["title","Contexts list"],["igoContextListBinding","",3,"map"],["title","Layers"],["igoLayerListBinding","",3,"map"],["igoLayerItemToolbar",""],[3,"layer"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-card")(1,"mat-card-subtitle"),e._uU(2,"Geo"),e.qZA(),e.TgZ(3,"mat-card-title"),e._uU(4,"Context"),e.qZA(),e.TgZ(5,"mat-card-content")(6,"p"),e._uU(7,"* Dependencies: LanguageService"),e.qZA(),e._UZ(8,"br"),e._uU(9," See the "),e.TgZ(10,"a",0),e._uU(11,"code of this example"),e.qZA(),e._UZ(12,"br"),e._uU(13," See "),e.TgZ(14,"a",1),e._uU(15," contexts"),e.qZA(),e._UZ(16,"hr"),e.qZA(),e.TgZ(17,"igo-map-browser",2),e._UZ(18,"igo-zoom-button",3)(19,"igo-geolocate-button",3)(20,"igo-home-extent-button",3)(21,"igo-rotation-button",4),e.qZA(),e.TgZ(22,"igo-panel",5),e._UZ(23,"igo-context-list",6),e.qZA(),e.TgZ(24,"igo-panel",7)(25,"igo-layer-list",8),e.YNc(26,IZ,1,1,"ng-template",null,9,e.W1O),e.qZA()()()),2&n&&(e.xp6(17),e.Q6J("map",t.map),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("map",t.map),e.xp6(1),e.Q6J("map",t.map)("showIfNoRotation",!0),e.xp6(2),e.Q6J("map",t.map),e.xp6(2),e.Q6J("map",t.map))},dependencies:[F.a8,F.dn,F.n5,F.$j,Ut,Be,vt,Ri,Ji,Bi,ko,qr,Vo,ca,sl,kp,Mp],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{margin-bottom:5px}"]}),i})()}]);let DZ=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[W.Ed,OZ,F.QW,I.ot,O.Ps,Pt,ft,Fo,wo,Xr,tr,Rn,ll]}),i})();const PZ=[{path:"",redirectTo:"/home",pathMatch:"full"},{path:"**",redirectTo:"/home"}];let EZ=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[me.Bz.forRoot(PZ,{useHash:!0}),me.Bz]}),i})(),$Z=(()=>{class i{constructor(n,t,o){this.changeDetectorRef=n,this.media=t,this.renderer=o,this.title="IGO",this.version=yl,this.themeClass="deeppurple-theme",this.mobileQuery=t.matchMedia("(max-width: 600px)"),this._mobileQueryListener=()=>n.detectChanges(),this.mobileQuery.addEventListener("change",this._mobileQueryListener),this.renderer.addClass(document.body,this.themeClass),this.detectOldBrowser()}ngOnDestroy(){this.mobileQuery.removeEventListener("change",this._mobileQueryListener)}detectOldBrowser(){qn.satisfies({ie:"<11",chrome:"<64",firefox:"<60"})&&console.log("Very old browser ! ",qn.getBrowser())}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(e.sBO),e.Y36(Yn.vx),e.Y36(e.Qsj))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-root"]],decls:91,vars:8,consts:[[1,"example-container"],["color","primary",1,"example-toolbar"],["mat-icon-button","",3,"click"],["svgIcon","menu"],[1,"example-sidenav-container"],["opened","true","fixedTopGap","56",3,"mode","fixedInViewport"],["snav",""],["mat-list-item","","routerLink","."],["mat-list-item","","routerLink","activity"],["mat-list-item","","routerLink","config"],["mat-list-item","","routerLink","language"],["mat-list-item","","routerLink","media"],["mat-list-item","","routerLink","message"],["mat-list-item","","routerLink","request"],["mat-list-item","","routerLink","auth-form"],["mat-list-item","","routerLink","action"],["mat-list-item","","routerLink","dynamic-component"],["mat-list-item","","routerLink","entity-table"],["mat-list-item","","routerLink","entity-selector"],["mat-list-item","","routerLink","form"],["mat-list-item","","routerLink","table"],["mat-list-item","","routerLink","tool"],["mat-list-item","","routerLink","widget"],["mat-list-item","","routerLink","simple-map"],["mat-list-item","","routerLink","layer"],["mat-list-item","","routerLink","legend"],["mat-list-item","","routerLink","overlay"],["mat-list-item","","routerLink","geometry"],["mat-list-item","","routerLink","feature"],["mat-list-item","","routerLink","hover"],["mat-list-item","","routerLink","measure"],["mat-list-item","","routerLink","draw"],["mat-list-item","","routerLink","query"],["mat-list-item","","routerLink","catalog"],["mat-list-item","","routerLink","search"],["mat-list-item","","routerLink","print"],["mat-list-item","","routerLink","import-export"],["mat-list-item","","routerLink","directions"],["mat-list-item","","routerLink","time-filter"],["mat-list-item","","routerLink","ogc-filter"],["mat-list-item","","routerLink","spatial-filter"],["mat-list-item","","routerLink","workspace"],["mat-list-item","","routerLink","context"]],template:function(n,t){if(1&n){const o=e.EpF();e.TgZ(0,"div",0)(1,"mat-toolbar",1)(2,"button",2),e.NdJ("click",function(){e.CHM(o);const s=e.MAs(10);return e.KtG(s.toggle())}),e._UZ(3,"mat-icon",3),e.qZA(),e.TgZ(4,"h1"),e._uU(5),e.qZA(),e.TgZ(6,"h5"),e._uU(7),e.qZA()(),e.TgZ(8,"mat-sidenav-container",4)(9,"mat-sidenav",5,6)(11,"mat-nav-list")(12,"a",7),e._uU(13,"Home"),e.qZA(),e._UZ(14,"hr"),e.TgZ(15,"a",8),e._uU(16,"Activity"),e.qZA(),e.TgZ(17,"a",9),e._uU(18,"Config"),e.qZA(),e.TgZ(19,"a",10),e._uU(20,"Language"),e.qZA(),e.TgZ(21,"a",11),e._uU(22,"Media"),e.qZA(),e.TgZ(23,"a",12),e._uU(24,"Message"),e.qZA(),e.TgZ(25,"a",13),e._uU(26,"Request"),e.qZA(),e._UZ(27,"hr"),e.TgZ(28,"a",14),e._uU(29,"Authentification"),e.qZA(),e._UZ(30,"hr"),e.TgZ(31,"a",15),e._uU(32,"Action"),e.qZA(),e.TgZ(33,"a",16),e._uU(34,"Dynamic Component"),e.qZA(),e.TgZ(35,"a",17),e._uU(36,"Entity Table"),e.qZA(),e.TgZ(37,"a",18),e._uU(38,"Entity Selector"),e.qZA(),e.TgZ(39,"a",19),e._uU(40,"Form"),e.qZA(),e.TgZ(41,"a",20),e._uU(42,"Table"),e.qZA(),e.TgZ(43,"a",21),e._uU(44,"Tool"),e.qZA(),e.TgZ(45,"a",22),e._uU(46,"Widget"),e.qZA(),e._UZ(47,"hr"),e.TgZ(48,"a",23),e._uU(49,"Simple map"),e.qZA(),e.TgZ(50,"a",24),e._uU(51,"Layer"),e.qZA(),e.TgZ(52,"a",25),e._uU(53,"Legend"),e.qZA(),e.TgZ(54,"a",26),e._uU(55,"Overlay"),e.qZA(),e.TgZ(56,"a",27),e._uU(57,"Geometry"),e.qZA(),e.TgZ(58,"a",28),e._uU(59,"Feature"),e.qZA(),e.TgZ(60,"a",29),e._uU(61,"Hover"),e.qZA(),e.TgZ(62,"a",30),e._uU(63,"Measure"),e.qZA(),e.TgZ(64,"a",31),e._uU(65,"Draw"),e.qZA(),e.TgZ(66,"a",32),e._uU(67,"Query"),e.qZA(),e.TgZ(68,"a",33),e._uU(69,"Catalog"),e.qZA(),e.TgZ(70,"a",34),e._uU(71,"Search"),e.qZA(),e.TgZ(72,"a",35),e._uU(73,"Print"),e.qZA(),e.TgZ(74,"a",36),e._uU(75,"Import/Export"),e.qZA(),e.TgZ(76,"a",37),e._uU(77,"Directions"),e.qZA(),e.TgZ(78,"a",38),e._uU(79,"Time filter"),e.qZA(),e.TgZ(80,"a",39),e._uU(81,"OGC filter"),e.qZA(),e.TgZ(82,"a",40),e._uU(83,"Spatial filter"),e.qZA(),e.TgZ(84,"a",41),e._uU(85,"Workspace"),e.qZA(),e._UZ(86,"hr"),e.TgZ(87,"a",42),e._uU(88,"Context"),e.qZA()()(),e.TgZ(89,"mat-sidenav-content"),e._UZ(90,"router-outlet"),e.qZA()()()}2&n&&(e.ekj("example-is-mobile",t.mobileQuery.matches),e.xp6(5),e.Oqu(t.title),e.xp6(2),e.Oqu(t.version.lib),e.xp6(1),e.Udp("margin-top",t.mobileQuery.matches?56:0,"px"),e.xp6(1),e.Q6J("mode",t.mobileQuery.matches?"over":"side")("fixedInViewport",t.mobileQuery.matches))},dependencies:[so.JX,so.TM,so.Rh,fl.Ye,I.lW,O.Hw,X.Hk,X.Tg,me.lC,me.yS],styles:["h1[_ngcontent-%COMP%]{width:100%;text-align:center;font-size:26px}.example-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:absolute;top:0;bottom:0;left:0;right:0}.example-is-mobile[_ngcontent-%COMP%]   .example-toolbar[_ngcontent-%COMP%]{position:fixed;z-index:2}.example-sidenav-container[_ngcontent-%COMP%]{flex:1}.example-is-mobile[_ngcontent-%COMP%]   .example-sidenav-container[_ngcontent-%COMP%]{flex:1 0 auto}mat-sidenav[_ngcontent-%COMP%]{background-color:#00000008}.example-is-mobile[_ngcontent-%COMP%]   mat-sidenav[_ngcontent-%COMP%]{background-color:#fff}mat-sidenav-content[_ngcontent-%COMP%]{padding:10px}[_ngcontent-%COMP%]:ng-deep   .mat-tooltip-hide[_ngcontent-%COMP%]{display:none!important}"]}),i})();const RZ={showDelay:500,hideDelay:0,touchendHideDelay:0,disableTooltipInteractivity:!0};let JZ=(()=>{class i{constructor(n,t){n.addSvgIconSet(t.bypassSecurityTrustResourceUrl("./assets/igo2/core/icons/mdi.svg"))}}return i.\u0275fac=function(n){return new(n||i)(e.LFG(O.jv),e.LFG(Tt.H7))},i.\u0275mod=e.oAB({type:i,bootstrap:[$Z]}),i.\u0275inj=e.cJS({providers:[{provide:e.ip1,useFactory:BZ,deps:[$],multi:!0},{provide:J.Jm,useValue:RZ}],imports:[cd,Tt.b2,gi.PW,so.SJ,fl.g0,I.ot,O.Ps,X.ie,bm,wm,km,Zm,Lm,Pm,Rm,Nm,Ym,Vm,Xm,oh,ah,ph,mh,Qh,Ox,$x,Bx,qx,jx,zx,Xx,nk,rk,ck,dk,nZ,rZ,lZ,pZ,fZ,vZ,CZ,AZ,DZ,EZ,Tt.t6]}),i})();function BZ(i){return()=>new Promise(a=>{i.translate.getTranslation(i.getLanguage()).subscribe(()=>{console.info(`Successfully initialized '${i.getLanguage()}' language.'`)},n=>{console.error(`Problem with '${i.getLanguage()}' language initialization.'`)},()=>{a(null)})})}k(15977),ja.production&&(0,e.G48)(),Tt.q6().bootstrapModule(JZ).catch(i=>console.log(i))},46700:(ao,ga,k)=>{var Tt={"./af":58685,"./af.js":58685,"./ar":254,"./ar-dz":4312,"./ar-dz.js":4312,"./ar-kw":32614,"./ar-kw.js":32614,"./ar-ly":18630,"./ar-ly.js":18630,"./ar-ma":28674,"./ar-ma.js":28674,"./ar-sa":49032,"./ar-sa.js":49032,"./ar-tn":24730,"./ar-tn.js":24730,"./ar.js":254,"./az":53052,"./az.js":53052,"./be":60150,"./be.js":60150,"./bg":63069,"./bg.js":63069,"./bm":13466,"./bm.js":13466,"./bn":18516,"./bn-bd":90557,"./bn-bd.js":90557,"./bn.js":18516,"./bo":26273,"./bo.js":26273,"./br":9588,"./br.js":9588,"./bs":19815,"./bs.js":19815,"./ca":83331,"./ca.js":83331,"./cs":21320,"./cs.js":21320,"./cv":72219,"./cv.js":72219,"./cy":68266,"./cy.js":68266,"./da":66427,"./da.js":66427,"./de":67435,"./de-at":52871,"./de-at.js":52871,"./de-ch":12994,"./de-ch.js":12994,"./de.js":67435,"./dv":82357,"./dv.js":82357,"./el":95649,"./el.js":95649,"./en-au":59961,"./en-au.js":59961,"./en-ca":19878,"./en-ca.js":19878,"./en-gb":3924,"./en-gb.js":3924,"./en-ie":70864,"./en-ie.js":70864,"./en-il":91579,"./en-il.js":91579,"./en-in":30940,"./en-in.js":30940,"./en-nz":16181,"./en-nz.js":16181,"./en-sg":44301,"./en-sg.js":44301,"./eo":85291,"./eo.js":85291,"./es":54529,"./es-do":53764,"./es-do.js":53764,"./es-mx":12584,"./es-mx.js":12584,"./es-us":63425,"./es-us.js":63425,"./es.js":54529,"./et":35203,"./et.js":35203,"./eu":70678,"./eu.js":70678,"./fa":83483,"./fa.js":83483,"./fi":96262,"./fi.js":96262,"./fil":52521,"./fil.js":52521,"./fo":34555,"./fo.js":34555,"./fr":63131,"./fr-ca":88239,"./fr-ca.js":88239,"./fr-ch":21702,"./fr-ch.js":21702,"./fr.js":63131,"./fy":267,"./fy.js":267,"./ga":23821,"./ga.js":23821,"./gd":71753,"./gd.js":71753,"./gl":4074,"./gl.js":4074,"./gom-deva":92762,"./gom-deva.js":92762,"./gom-latn":5969,"./gom-latn.js":5969,"./gu":82809,"./gu.js":82809,"./he":45402,"./he.js":45402,"./hi":315,"./hi.js":315,"./hr":10410,"./hr.js":10410,"./hu":38288,"./hu.js":38288,"./hy-am":67928,"./hy-am.js":67928,"./id":71334,"./id.js":71334,"./is":86959,"./is.js":86959,"./it":34864,"./it-ch":51124,"./it-ch.js":51124,"./it.js":34864,"./ja":36141,"./ja.js":36141,"./jv":29187,"./jv.js":29187,"./ka":42136,"./ka.js":42136,"./kk":94332,"./kk.js":94332,"./km":18607,"./km.js":18607,"./kn":84305,"./kn.js":84305,"./ko":70234,"./ko.js":70234,"./ku":16003,"./ku.js":16003,"./ky":75061,"./ky.js":75061,"./lb":32786,"./lb.js":32786,"./lo":66183,"./lo.js":66183,"./lt":50029,"./lt.js":50029,"./lv":24169,"./lv.js":24169,"./me":68577,"./me.js":68577,"./mi":68177,"./mi.js":68177,"./mk":50337,"./mk.js":50337,"./ml":65260,"./ml.js":65260,"./mn":52325,"./mn.js":52325,"./mr":14695,"./mr.js":14695,"./ms":75334,"./ms-my":37151,"./ms-my.js":37151,"./ms.js":75334,"./mt":63570,"./mt.js":63570,"./my":97963,"./my.js":97963,"./nb":88028,"./nb.js":88028,"./ne":86638,"./ne.js":86638,"./nl":50302,"./nl-be":66782,"./nl-be.js":66782,"./nl.js":50302,"./nn":33501,"./nn.js":33501,"./oc-lnc":50563,"./oc-lnc.js":50563,"./pa-in":50869,"./pa-in.js":50869,"./pl":65302,"./pl.js":65302,"./pt":49687,"./pt-br":74884,"./pt-br.js":74884,"./pt.js":49687,"./ro":79107,"./ro.js":79107,"./ru":33627,"./ru.js":33627,"./sd":30355,"./sd.js":30355,"./se":83427,"./se.js":83427,"./si":11848,"./si.js":11848,"./sk":54590,"./sk.js":54590,"./sl":20184,"./sl.js":20184,"./sq":56361,"./sq.js":56361,"./sr":78965,"./sr-cyrl":81287,"./sr-cyrl.js":81287,"./sr.js":78965,"./ss":25456,"./ss.js":25456,"./sv":70451,"./sv.js":70451,"./sw":77558,"./sw.js":77558,"./ta":51356,"./ta.js":51356,"./te":73693,"./te.js":73693,"./tet":21243,"./tet.js":21243,"./tg":42500,"./tg.js":42500,"./th":55768,"./th.js":55768,"./tk":77761,"./tk.js":77761,"./tl-ph":35780,"./tl-ph.js":35780,"./tlh":29590,"./tlh.js":29590,"./tr":33807,"./tr.js":33807,"./tzl":93857,"./tzl.js":93857,"./tzm":60654,"./tzm-latn":8806,"./tzm-latn.js":8806,"./tzm.js":60654,"./ug-cn":30845,"./ug-cn.js":30845,"./uk":19232,"./uk.js":19232,"./ur":47052,"./ur.js":47052,"./uz":77967,"./uz-latn":32233,"./uz-latn.js":32233,"./uz.js":77967,"./vi":98615,"./vi.js":98615,"./x-pseudo":12320,"./x-pseudo.js":12320,"./yo":31313,"./yo.js":31313,"./zh-cn":64490,"./zh-cn.js":64490,"./zh-hk":55910,"./zh-hk.js":55910,"./zh-mo":98262,"./zh-mo.js":98262,"./zh-tw":44223,"./zh-tw.js":44223};function e(I){var O=gi(I);return k(O)}function gi(I){if(!k.o(Tt,I)){var O=new Error("Cannot find module '"+I+"'");throw O.code="MODULE_NOT_FOUND",O}return Tt[I]}e.keys=function(){return Object.keys(Tt)},e.resolve=gi,ao.exports=e,e.id=46700}},ao=>{ao.O(0,[736],()=>ao(ao.s=73750)),ao.O()}]);
//# sourceMappingURL=main.b08525f6f10a68b1.js.map