(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[590],{21724:(Ee,ce,s)=>{"use strict";s.d(ce,{kT:()=>X,oj:()=>K,mK:()=>T,u_:()=>q});var y=s(33712),e=s(83600),d=s(24708),g=s(93020),R=s(64002),o=s(54844),h=s(1296),j=s(78600),x=s(51672),w=s(90916),b=s(13680),E=s(34896);let T=(()=>{class _{injector;options;tokenKey;constructor(S){this.injector=S;const P=this.injector.get(e.aW);this.options=P.getConfig("auth"),this.tokenKey=this.options?.tokenKey}set(S){localStorage.setItem(this.tokenKey,S)}remove(){localStorage.removeItem(this.tokenKey)}get(){return localStorage.getItem(this.tokenKey)}decode(){const S=this.get();if(S)return(0,b.i)(S)}isExpired(){const S=this.decode(),P=(new Date).getTime()/1e3;return!(S&&P<S.exp)}static \u0275fac=function(P){return new(P||_)(E.CoB(E.zZn))};static \u0275prov=E.wxM({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})();var a=s(57880);let K=(()=>{class _{http;tokenService;config;languageService;messageService;router;authenticate$=new o.g(void 0);logged$=new o.g(void 0);redirectUrl;languageForce=!1;anonymous=!1;authOptions;get hasAuthService(){return void 0!==this.authOptions?.url}get user(){const S=this.decodeToken();return S?.user?S.user:null}constructor(S,P,I,U,G,O){this.http=S,this.tokenService=P,this.config=I,this.languageService=U,this.messageService=G,this.router=O,this.authOptions=this.config.getConfig("auth"),this.authenticate$.next(this.authenticated),this.authenticate$.subscribe(F=>{this.logged$.next(F),w.y.next()})}login(S,P){const I=new y.UD({"Content-Type":"application/json"}),U={username:S,password:this.encodePassword(P)};return this.loginCall(U,I)}loginWithToken(S,P,I){const U=new y.UD({"Content-Type":"application/json"});return this.loginCall({token:S,typeConnection:P,infosUser:I},U)}loginAnonymous(){return this.anonymous=!0,this.logged$.next(!0),(0,h.of)(!0)}refresh(){return this.http.post(`${this.authOptions?.url}/refresh`,{}).pipe((0,j.y)(S=>{this.tokenService.set(S.token)}),(0,x.a)(S=>{throw S.error.caught=!0,S}))}logout(){return this.anonymous=!1,this.tokenService.remove(),this.authenticate$.next(!1),(0,h.of)(!0)}isAuthenticated(){return!this.tokenService.isExpired()}getToken(){return this.tokenService.get()}decodeToken(){if(this.isAuthenticated())return this.tokenService.decode()}goToRedirectUrl(){if(!this.router)return;const S=this.redirectUrl||this.router.url;S===this.authOptions.loginRoute?this.router.navigateByUrl(this.authOptions.homeRoute||"/"):S&&this.router.navigateByUrl(S)}getUserInfo(){return this.http.get(this.authOptions?.url+"/info")}getProfils(){return this.http.get(`${this.authOptions?.url}/profils`)}updateUser(S){return this.http.patch(this.authOptions?.url,S)}encodePassword(S){return R.Q1.encode(S)}get logged(){return this.authenticated||this.isAnonymous}get isAnonymous(){return this.anonymous}get authenticated(){return this.isAuthenticated()}get isAdmin(){return!!this.decodeToken()?.user?.isAdmin}loginCall(S,P){return this.http.post(`${this.authOptions?.url}/login`,S,{headers:P}).pipe((0,j.y)(I=>{this.tokenService.set(I.token);const U=this.decodeToken();U?.user&&(U.user.locale&&!this.languageForce&&this.languageService.setLanguage(U.user.locale),U.user.isExpired&&this.messageService.alert("igo.auth.error.Password expired")),this.authenticate$.next(!0)}),(0,x.a)(I=>{throw I.error.caught=!0,I}))}static \u0275fac=function(P){return new(P||_)(E.CoB(y.KK),E.CoB(T),E.CoB(e.aW),E.CoB(d.ov),E.CoB(g.mi),E.CoB(a.E5,8))};static \u0275prov=E.wxM({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})();var B=s(11772);let X=(()=>{class _{config;tokenService;http;authOptions;refreshInProgress=!1;trustHosts;hostsWithCredentials;hostsWithAuthByKey;constructor(S,P,I){this.config=S,this.tokenService=P,this.http=I,this.authOptions=this.config.getConfig("auth"),this.trustHosts=this.authOptions?.trustHosts||[],this.trustHosts.push(window.location.hostname),this.hostsWithCredentials=this.authOptions?.hostsWithCredentials||[],this.hostsWithAuthByKey=this.authOptions?.hostsByKey||[]}intercept(S,P){const I=this.handleHostsWithCredentials(S.url);let U=S.clone();const G=this.handleHostsAuthByKey(S.url);if(G&&(U=U.clone({params:U.params.set(G.key,G.value)})),I)return U=S.clone({withCredentials:I}),P.handle(U);this.refreshToken();const O=this.tokenService.get(),F=document.createElement("a");if(F.href=U.url,""===F.host&&(F.href=F.href),!O||-1===this.trustHosts.indexOf(F.hostname))return P.handle(U);let r=U.clone({headers:U.headers.set("Authorization",`Bearer ${O}`)});const ie=this.tokenService.decode();if("true"===r.params.get("_i")&&ie?.user?.sourceId){const ae=B.Cy.hashStr(ie.user.sourceId);r=r.clone({params:r.params.set("_i",ae)})}else"true"===r.params.get("_i")&&(r=r.clone({params:r.params.delete("_i")}));return P.handle(r)}interceptXhr(S,P){const I=this.handleHostsWithCredentials(P);if(I)return S.withCredentials=I,!0;this.refreshToken();const U=document.createElement("a");U.href=P;const G=this.tokenService.get();return!(!G||-1===this.trustHosts.indexOf(U.hostname)||(S.setRequestHeader("Authorization","Bearer "+G),0))}alterUrlWithKeyAuth(S){const P=this.handleHostsAuthByKey(S);if(P){const U=S.split(/[?&]/);let G=U.shift();const O=U.filter(F=>0!==F.length);return O.push(`${P.key}=${P.value}`),O.length&&(G+="?"+O.join("&")),G}}handleHostsWithCredentials(S){let P=!1;for(const I of this.hostsWithCredentials)if(new RegExp(I.domainRegFilters).test(S)){P=void 0!==I.withCredentials?I.withCredentials:void 0;break}return P}handleHostsAuthByKey(S){let P;for(const G of this.hostsWithAuthByKey)if(new RegExp(G.domainRegFilters).test(S)&&!new RegExp(`${G.keyProperty}=${G.keyValue}`,"gm").test(S)){P={key:G.keyProperty,value:G.keyValue};break}return P}refreshToken(){const S=this.tokenService.decode(),P=(new Date).getTime()/1e3;if(!this.refreshInProgress&&S&&P<S.exp&&P>S.exp-1800){this.refreshInProgress=!0;const I=this.authOptions?.url;return this.http.post(`${I}/refresh`,{}).subscribe(U=>{this.tokenService.set(U.token),this.refreshInProgress=!1},U=>(U.error.caught=!0,U))}}static \u0275fac=function(P){return new(P||_)(E.CoB(e.aW),E.CoB(T),E.CoB(y.KK))};static \u0275prov=E.wxM({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})();var V=s(70772),z=s(83680),W=s(19432);let A=(()=>{class _{configService;monitoringOptions;injector;authService;constructor(S,P,I){this.configService=S,this.monitoringOptions=P,this.injector=I,this.monitoringOptions?.identifyUser&&this.configService.isLoaded$.pipe((0,z.K)(U=>U),(0,W.G)(()=>(this.authService=this.injector.get(K),this.authService?.authenticate$))).subscribe(U=>{this._identifyUser(U?this.authService.user:null)})}_identifyUser(S){"sentry"===this.monitoringOptions.provider&&(0,V.L7)(S)}static \u0275fac=function(P){return new(P||_)(E.CoB(e.aW),E.CoB(V.ct,8),E.CoB(E.zZn))};static \u0275prov=E.wxM({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})();function q(_){return _?[{provide:A,useClass:A,deps:[e.aW,V.ct,E.zZn]},{provide:E.kZF,useFactory:()=>()=>{},deps:[A],multi:!0}]:[]}},97092:(Ee,ce,s)=>{"use strict";s.d(ce,{U:()=>d});var y=s(34896),e=s(50168);let d=(()=>{class g{_sanitizer;constructor(o){this._sanitizer=o}transform(o){return this._sanitizer.bypassSecurityTrustHtml(o)}static \u0275fac=function(h){return new(h||g)(y.GI1(e.mI,16))};static \u0275pipe=y.UTH({name:"sanitizeHtml",type:g,pure:!0,standalone:!0})}return g})()},6316:(Ee,ce,s)=>{"use strict";s.d(ce,{q:()=>h});var y=s(34896),e=s(64002),d=s(65044),g=s(88908);const R=["target"];function o(j,x){}let h=(()=>{class j{dynamicComponentService;cdRef;component;inputs={};subscribers={};dynamicComponent;target;constructor(w,b){this.dynamicComponentService=w,this.cdRef=b}ngOnChanges(w){const b=w.component,E=w.inputs,T=w.subscribers,a=e.Yv.objectsAreEquivalent;if(b&&b.currentValue){if(b.currentValue!==b.previousValue)this.createComponent(b.currentValue);else{const K=E&&a(E.currentValue||{},E.previousValue||{}),M=T&&a(T.currentValue||{},T.previousValue||{});!1===K&&this.updateInputs(),!1===M&&this.updateSubscribers()}this.cdRef.detectChanges()}}ngOnDestroy(){this.dynamicComponent&&this.dynamicComponent.destroy()}createComponent(w){void 0!==this.dynamicComponent&&this.dynamicComponent.destroy(),this.dynamicComponent=w instanceof d.A?w:this.dynamicComponentService.create(w),this.renderComponent()}renderComponent(){this.updateInputs(),this.updateSubscribers(),this.dynamicComponent.setTarget(this.target)}updateInputs(){this.dynamicComponent.updateInputs(this.inputs)}updateSubscribers(){this.dynamicComponent.updateSubscribers(this.subscribers)}static \u0275fac=function(b){return new(b||j)(y.GI1(g.O),y.GI1(y.kD9))};static \u0275cmp=y.In1({type:j,selectors:[["igo-dynamic-outlet"]],viewQuery:function(b,E){if(1&b&&y.CC$(R,7,y.y8U),2&b){let T;y.wto(T=y.Gqi())&&(E.target=T.first)}},inputs:{component:"component",inputs:"inputs",subscribers:"subscribers"},standalone:!0,features:[y.SYr,y.UHJ],decls:2,vars:0,consts:[["target",""]],template:function(b,E){1&b&&y.yuY(0,o,0,0,"ng-template",null,0,y.gJz)},styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}"],changeDetection:0})}return j})()},77020:(Ee,ce,s)=>{"use strict";s.d(ce,{qm:()=>y.q});var y=s(6316)},88908:(Ee,ce,s)=>{"use strict";s.d(ce,{O:()=>d});var y=s(65044),e=s(34896);let d=(()=>{class g{resolver;constructor(o){this.resolver=o}create(o){const h=this.resolver.resolveComponentFactory(o);return new y.A(h)}static \u0275fac=function(h){return new(h||g)(e.CoB(e.ce5))};static \u0275prov=e.wxM({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})()},65044:(Ee,ce,s)=>{"use strict";s.d(ce,{A:()=>e});var y=s(21296);class e{componentFactory;componentRef;subscriptions=[];target;inputs={};inputs$$={};subscribers={};constructor(g){this.componentFactory=g}setTarget(g){this.target=g,this.componentRef=g.createComponent(this.componentFactory),this.updateInputs(this.inputs),this.updateSubscribers(this.subscribers)}destroy(){void 0!==this.target&&this.target.clear(),void 0!==this.componentRef&&(this.componentRef.destroy(),this.componentRef=void 0),this.unobserveAllInputs(),this.unsubscribeAll()}updateInputs(g){if(this.inputs=g,void 0===this.componentRef)return;const R=this.componentRef.instance;this.componentFactory.inputs.forEach(h=>{const j=h.propName;this.unobserveInput(j);const x=g[j];g.hasOwnProperty(j)&&(x instanceof y._?this.observeInput(j,x):this.setInputValue(R,j,x))}),"function"==typeof R.onUpdateInputs&&R.onUpdateInputs()}setInputValue(g,R,o){if(o===g[R])return;const j=Object.getPrototypeOf(g),x=Object.getOwnPropertyDescriptor(j,R);void 0!==x&&void 0!==x.set?x.set.call(g,o):g[R]=o}updateSubscribers(g){if(this.subscribers=g,void 0===this.componentRef)return;const R=this.componentRef.instance;this.componentFactory.outputs.forEach(h=>{const j=h.propName;if(g.hasOwnProperty(j)){const x=R[j],w=g[j];Array.isArray(w)?w.forEach(b=>{this.subscriptions.push(x.subscribe(b))}):this.subscriptions.push(x.subscribe(w))}})}observeInput(g,R){this.inputs$$[g]=R.subscribe(o=>{const h=this.componentRef.instance;this.setInputValue(h,g,o),"function"==typeof h.onUpdateInputs&&h.onUpdateInputs()})}unobserveInput(g){void 0!==this.inputs$$[g]&&(this.inputs$$[g].unsubscribe(),this.inputs$$[g]=void 0)}unobserveAllInputs(){Object.values(this.inputs$$).forEach(g=>{void 0!==g&&g.unsubscribe()}),this.inputs$$={}}unsubscribeAll(){this.subscriptions.forEach(g=>g.unsubscribe()),this.subscriptions=[]}}},66165:(Ee,ce,s)=>{"use strict";s.d(ce,{s:()=>T});var y=s(65056),e=s(34896),d=s(46176),g=s(50244),R=s(77872),o=s(54844),h=s(22788),x=(s(63892),s(87556));function w(a,K){if(1&a&&(e.I0R(0,"mat-option",4),e.OEk(1),e.C$Y()),2&a){const M=e.GaO();e.E7m("value",M.emptyValue),e.yG2(),e.cNF(M.emptyText)}}function b(a,K){if(1&a&&(e.I0R(0,"mat-option",4),e.OEk(1),e.wVc(2,"async"),e.C$Y()),2&a){const M=e.GaO();e.E7m("value",M.multiSelectValue),e.yG2(),e.cNF(e.kDX(2,2,M.multiText$))}}function E(a,K){if(1&a&&(e.I0R(0,"mat-option",4),e.OEk(1),e.C$Y()),2&a){const M=K.$implicit,L=e.GaO();e.E7m("value",M.entity),e.yG2(),e.oRS(" ",L.titleAccessor(M.entity)," ")}}let T=(()=>{class a{cdRef;selected$=new o.g(void 0);multiText$=new o.g(void 0);multiSelectValue={id:"IGO_MULTI_SELECT"};emptyValue={id:"IGO_EMPTY_SELECT"};selected$$;watcher;store;titleAccessor=h.YB;emptyText=void 0;multi=!1;multiAllText="All";multiNoneText="None";placeholder;disabled=!1;selectedChange=new e._w7;constructor(M){this.cdRef=M}ngOnInit(){this.watcher=new x.Y(this.store,this.cdRef),this.selected$$=this.store.stateView.manyBy$(M=>!0===M.state.selected).subscribe(M=>{const L=M.map(oe=>oe.entity);this.onSelectFromStore(L)})}ngOnDestroy(){this.watcher.destroy(),this.selected$$.unsubscribe()}onSelectionChange(M){const L=M.value instanceof Array?M.value:[M.value],oe=L.find(X=>X===this.multiSelectValue);let N=L.filter(X=>X!==this.multiSelectValue);void 0!==oe&&(N.length===this.store.count?N=[]:N.length<this.store.count&&(N=this.store.all())),N=N.filter(X=>X!==this.emptyValue),0===N.length?this.store.state.updateAll({selected:!1}):this.store.state.updateMany(N,{selected:!0},!0),this.selectedChange.emit({selected:!0,value:this.multi?N:M.value})}onSelectFromStore(M){this.selected$.next(!0===this.multi?M:M.length>0?M[0]:void 0),this.updateMultiToggleWithEntities(M)}updateMultiToggleWithEntities(M){M.length===this.store.count&&this.multiText$.value!==this.multiNoneText?this.multiText$.next(this.multiNoneText):M.length<this.store.count&&this.multiText$.value!==this.multiAllText&&this.multiText$.next(this.multiAllText)}static \u0275fac=function(L){return new(L||a)(e.GI1(e.kD9))};static \u0275cmp=e.In1({type:a,selectors:[["igo-entity-selector"]],inputs:{store:"store",titleAccessor:"titleAccessor",emptyText:"emptyText",multi:"multi",multiAllText:"multiAllText",multiNoneText:"multiNoneText",placeholder:"placeholder",disabled:"disabled"},outputs:{selectedChange:"selectedChange"},standalone:!0,features:[e.UHJ],decls:7,vars:11,consts:[["subscriptSizing","dynamic",1,"igo-entity-selector"],[3,"disabled","value","multiple","placeholder","selectionChange"],[3,"value",4,"ngIf"],["ngFor","",3,"ngForOf"],[3,"value"]],template:function(L,oe){1&L&&(e.I0R(0,"mat-form-field",0)(1,"mat-select",1),e.qCj("selectionChange",function(B){return oe.onSelectionChange(B)}),e.wVc(2,"async"),e.yuY(3,w,2,2,"mat-option",2)(4,b,3,4,"mat-option",2)(5,E,2,2,"ng-template",3),e.wVc(6,"async"),e.C$Y()()),2&L&&(e.yG2(),e.E7m("disabled",oe.disabled)("value",e.kDX(2,7,oe.selected$))("multiple",oe.multi)("placeholder",oe.placeholder),e.yG2(2),e.E7m("ngIf",void 0!==oe.emptyText&&!1===oe.multi),e.yG2(),e.E7m("ngIf",!0===oe.multi),e.yG2(),e.E7m("ngForOf",e.kDX(6,9,oe.store.stateView.all$())))},dependencies:[g.wb,g.Up,R.d5,R.kX,d.I5,y.u_,d.Ax,y.Iw,y.a],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"],changeDetection:0})}return a})()},800:(Ee,ce,s)=>{"use strict";s.d(ce,{I:()=>h});var y=s(34896),e=s(54872),d=s(24708),g=s(9588),R=s(54844);s(80544);let h=(()=>{class j{languageService;mediaService;disabled=!1;hidePageSize=!1;pageIndex=0;pageSize=50;pageSizeOptions=[5,10,20,50,100,200];showFirstLastButtons=!0;count$$;entitySortChange$$;paginationLabelTranslation$$=[];entitySortChange$=new R.g(!1);store;paginatorOptions;page;length=0;paginatorChange=new y._w7;constructor(w,b){this.languageService=w,this.mediaService=b}paginator;ngOnChanges(){this.unsubscribeAll(),this.count$$=this.store.stateView.count$.subscribe(w=>{this.length=w,this.emitPaginator()}),this.entitySortChange$$=this.entitySortChange$.subscribe(()=>{this.paginator&&this.paginator.firstPage()}),this.initPaginatorOptions(),this.translateLabels()}initPaginatorOptions(){this.disabled=this.paginatorOptions?.disabled||this.disabled,this.pageIndex=this.paginatorOptions?.pageIndex||this.pageIndex,this.pageSize=this.paginatorOptions?.pageSize||this.pageSize,this.pageSizeOptions=this.paginatorOptions?.pageSizeOptions||this.pageSizeOptions,this.mediaService.isMobile()?(this.showFirstLastButtons=!1,this.hidePageSize=!0):(this.showFirstLastButtons=this.paginatorOptions?.showFirstLastButtons||this.showFirstLastButtons,this.hidePageSize=this.paginatorOptions?.hidePageSize||this.hidePageSize)}translateLabels(){this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.firstPageLabel").subscribe(w=>{this.paginator._intl.firstPageLabel=w})),this.paginator._intl.getRangeLabel=this.rangeLabel,this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.itemsPerPageLabel").subscribe(w=>{this.paginator._intl.itemsPerPageLabel=w})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.lastPageLabel").subscribe(w=>{this.paginator._intl.lastPageLabel=w})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.nextPageLabel").subscribe(w=>{this.paginator._intl.nextPageLabel=w})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.previousPageLabel").subscribe(w=>{this.paginator._intl.previousPageLabel=w}))}rangeLabel=(w,b,E)=>{const T=new R.g("");if(this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.of").subscribe(M=>{T.next(M)})),0===E||0===b)return`0 ${T.value} ${E}`;const a=w*b;return`${a+1} - ${a<(E=Math.max(E,0))?Math.min(a+b,E):a+b} ${T.value} ${E}`};unsubscribeAll(){this.paginationLabelTranslation$$.map(w=>w.unsubscribe()),this.count$$&&this.count$$.unsubscribe(),this.entitySortChange$$&&this.entitySortChange$$.unsubscribe()}ngOnDestroy(){this.unsubscribeAll()}emitPaginator(){this.paginatorChange.emit(this.paginator)}static \u0275fac=function(b){return new(b||j)(y.GI1(d.ov),y.GI1(g.QB))};static \u0275cmp=y.In1({type:j,selectors:[["igo-entity-table-paginator"]],viewQuery:function(b,E){if(1&b&&y.CC$(e.Qb,7),2&b){let T;y.wto(T=y.Gqi())&&(E.paginator=T.first)}},inputs:{entitySortChange$:"entitySortChange$",store:"store",paginatorOptions:"paginatorOptions"},outputs:{page:"page",paginatorChange:"paginatorChange"},standalone:!0,features:[y.SYr,y.UHJ],decls:1,vars:7,consts:[[3,"disabled","hidePageSize","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons","page"]],template:function(b,E){1&b&&(y.I0R(0,"mat-paginator",0),y.qCj("page",function(){return E.emitPaginator()}),y.C$Y()),2&b&&y.E7m("disabled",E.disabled)("hidePageSize",E.hidePageSize)("length",E.length)("pageIndex",E.pageIndex)("pageSize",E.pageSize)("pageSizeOptions",E.pageSizeOptions)("showFirstLastButtons",E.showFirstLastButtons)},dependencies:[e.w5,e.Qb],styles:["[_nghost-%COMP%]     .mat-mdc-paginator-container{min-height:unset}"],changeDetection:0})}return j})()},14944:(Ee,ce,s)=>{"use strict";s.d(ce,{E:()=>qt});var y=s(65056),e=s(34896),d=s(71904),g=s(61792),R=s(69400),o=s(34672),h=s(58539),j=s(46176),x=s(24392),w=s(50244),b=s(32328),E=s(42536),T=s(77872),a=s(76768),K=s(80956),M=s(27e3),L=s(64002),oe=s(72584),N=s(30816),B=s.n(N),X=s(54844),V=s(21296),z=s(24112),W=s(40604),A=s(97092),q=s(19644),_=s(696),u=s(24100),S=s(800),P=s(80544),I=s(89888),U=s(72672);let G=(()=>{class Te{renderer;el;static selectedCls="igo-entity-table-row-selected";static highlightedCls="igo-entity-table-row-highlighted";selection=!1;selectOnClick=!0;highlightSelection=!0;set selected(pe){!1!==this.selection&&pe!==this._selected&&(this.toggleSelected(pe),this.scroll())}get selected(){return this._selected}_selected=!1;scrollBehavior=U.qK.Auto;select=new e._w7;onClick(){!1===this.selection||!1===this.selectOnClick||(this.toggleSelected(!0),this.select.emit(this))}constructor(pe,ye){this.renderer=pe,this.el=ye}toggleSelected(pe){this._selected=pe,!0===pe?(this.addCls(Te.selectedCls),!0===this.highlightSelection&&this.addCls(Te.highlightedCls)):(this.removeCls(Te.selectedCls),this.removeCls(Te.highlightedCls))}scroll(){!0===this._selected&&(0,I.c)(this.el.nativeElement,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})}addCls(pe){this.renderer.addClass(this.el.nativeElement,pe)}removeCls(pe){this.renderer.removeClass(this.el.nativeElement,pe)}static \u0275fac=function(ye){return new(ye||Te)(e.GI1(e.q87),e.GI1(e.GMv))};static \u0275dir=e.Sc5({type:Te,selectors:[["","igoEntityTableRow",""]],hostBindings:function(ye,xe){1&ye&&e.qCj("click",function(){return xe.onClick()})},inputs:{selection:"selection",selectOnClick:"selectOnClick",highlightSelection:"highlightSelection",selected:"selected",scrollBehavior:"scrollBehavior"},outputs:{select:"select"},standalone:!0})}return Te})();var O=s(42664);function F(Te,ut){if(1&Te){const pe=e.KQA();e.SAx(0),e.I0R(1,"mat-checkbox",11),e.qCj("change",function(xe){e.usT(pe);const Ge=e.GaO(3);return e.CGJ(Ge.onToggleRows(xe.checked))}),e.C$Y(),e.k70()}if(2&Te){const pe=ut.ngIf,ye=e.GaO(3);e.yG2(),e.E7m("checked",pe===ye.entityTableSelectionState.All)("indeterminate",pe===ye.entityTableSelectionState.Some)}}function Q(Te,ut){if(1&Te&&(e.SAx(0),e.yuY(1,F,2,2,"ng-container",10),e.wVc(2,"async"),e.k70()),2&Te){const pe=e.GaO(2);e.yG2(),e.E7m("ngIf",e.kDX(2,1,pe.selectionState$))}}function r(Te,ut){if(1&Te&&(e.I0R(0,"th",9),e.yuY(1,Q,3,3,"ng-container",10),e.C$Y()),2&Te){const pe=e.GaO();e.yG2(),e.E7m("ngIf",pe.selectMany)}}function ie(Te,ut){if(1&Te){const pe=e.KQA();e.I0R(0,"td",12)(1,"mat-checkbox",13),e.qCj("mousedown",function(xe){return xe.shiftKey?xe.preventDefault():null})("click",function(xe){const qe=e.usT(pe).$implicit,Ue=e.GaO();return e.CGJ(xe.shiftKey?Ue.onShiftToggleRow(!Ue.rowIsSelected(qe.record),qe.record,xe):xe.stopPropagation())})("change",function(xe){const qe=e.usT(pe).$implicit,Ue=e.GaO();return e.CGJ(Ue.onToggleRow(xe.checked,qe.record))}),e.C$Y()()}if(2&Te){const pe=ut.$implicit,ye=e.GaO();e.yG2(),e.E7m("checked",ye.rowIsSelected(pe.record))}}function ae(Te,ut){if(1&Te&&(e.I0R(0,"th",16),e.OEk(1),e.C$Y()),2&Te){const pe=e.GaO(2).$implicit;e.E7m("matTooltip",pe.tooltip?pe.tooltip:void 0),e.yG2(),e.oRS(" ",pe.title," ")}}function fe(Te,ut){1&Te&&(e.SAx(0),e.yuY(1,ae,2,2,"th",15),e.k70())}function le(Te,ut){if(1&Te&&(e.I0R(0,"th",18),e.OEk(1),e.C$Y()),2&Te){const pe=e.GaO(2).$implicit;e.E7m("matTooltip",pe.tooltip?pe.tooltip:void 0),e.yG2(),e.oRS(" ",pe.title," ")}}function ue(Te,ut){1&Te&&(e.SAx(0),e.yuY(1,le,2,2,"th",17),e.k70())}function se(Te,ut){if(1&Te&&(e.I0R(0,"td",22),e.OEk(1),e.C$Y()),2&Te){const pe=e.GaO().$implicit,ye=e.GaO(3).$implicit;e.E7m("ngClass",pe.cellData[ye.name].class),e.yG2(),e.oRS(" ",pe.cellData[ye.name].value," ")}}function ge(Te,ut){if(1&Te&&(e.wR5(0,"img",26),e.wVc(1,"async"),e.wVc(2,"secureImage")),2&Te){const pe=e.GaO(2).$implicit,ye=e.GaO(3).$implicit;e._6D("src",e.kDX(1,1,e.kDX(2,3,pe.cellData[ye.name].value)),e.K6U)}}function Ie(Te,ut){1&Te&&(e.I0R(0,"span"),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&Te&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.common.entity-table.targetHtmlUrl")," "))}function Re(Te,ut){if(1&Te&&(e.I0R(0,"td",22)(1,"a",23),e.qCj("click",function(ye){return ye.stopPropagation()}),e.yuY(2,ge,3,5,"img",24)(3,Ie,3,3,"ng-template",null,25,e.gJz),e.C$Y()()),2&Te){const pe=e.Gew(4),ye=e.GaO().$implicit,xe=e.GaO(3).$implicit;e.E7m("ngClass",ye.cellData[xe.name].class),e.yG2(),e._6D("href",ye.cellData[xe.name].value,e.K6U),e.yG2(),e.E7m("ngIf",ye.cellData[xe.name].isImg)("ngIfElse",pe)}}function He(Te,ut){if(1&Te&&(e.SAx(0),e.yuY(1,se,2,2,"td",20)(2,Re,5,4,"ng-template",null,21,e.gJz),e.k70()),2&Te){const pe=ut.$implicit,ye=e.Gew(3),xe=e.GaO(3).$implicit;e.yG2(),e.E7m("ngIf",!pe.cellData[xe.name].isUrl)("ngIfElse",ye)}}function ht(Te,ut){1&Te&&(e.SAx(0),e.yuY(1,He,4,2,"ng-container",19),e.k70())}function rt(Te,ut){if(1&Te&&e.wR5(0,"td",29),2&Te){const pe=e.GaO().$implicit,ye=e.GaO(3).$implicit;e.E7m("ngClass",pe.cellData[ye.name].class)("innerHTML",pe.cellData[ye.name].value,e.E3n)}}function xt(Te,ut){if(1&Te&&(e.wR5(0,"img",26),e.wVc(1,"async"),e.wVc(2,"secureImage")),2&Te){const pe=e.GaO(2).$implicit,ye=e.GaO(3).$implicit;e._6D("src",e.kDX(1,1,e.kDX(2,3,pe.cellData[ye.name].value)),e.K6U)}}function Rt(Te,ut){1&Te&&(e.I0R(0,"span"),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&Te&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.geo.targetHtmlUrl")," "))}function Ze(Te,ut){if(1&Te&&(e.I0R(0,"td",22)(1,"a",23),e.qCj("click",function(ye){return ye.stopPropagation()}),e.yuY(2,xt,3,5,"img",24)(3,Rt,3,3,"ng-template",null,25,e.gJz),e.C$Y()()),2&Te){const pe=e.Gew(4),ye=e.GaO().$implicit,xe=e.GaO(3).$implicit;e.E7m("ngClass",ye.cellData[xe.name].class),e.yG2(),e._6D("href",ye.cellData[xe.name].value,e.K6U),e.yG2(),e.E7m("ngIf",ye.cellData[xe.name].isImg)("ngIfElse",pe)}}function Kt(Te,ut){if(1&Te&&(e.SAx(0),e.yuY(1,rt,1,2,"td",27)(2,Ze,5,4,"ng-template",null,28,e.gJz),e.k70()),2&Te){const pe=ut.$implicit,ye=e.Gew(3),xe=e.GaO(3).$implicit;e.yG2(),e.E7m("ngIf",!pe.cellData[xe.name].isUrl)("ngIfElse",ye)}}function ve(Te,ut){1&Te&&(e.SAx(0),e.yuY(1,Kt,4,2,"ng-container",19),e.k70())}function $e(Te,ut){if(1&Te){const pe=e.KQA();e.I0R(0,"div",43),e.wR5(1,"mat-datepicker-toggle",44),e.I0R(2,"input",45),e.qCj("dateChange",function(xe){e.usT(pe);const Ge=e.GaO(2).$implicit,qe=e.GaO(3).$implicit,Ue=e.GaO();return e.CGJ(Ue.onDateChange(qe.name,Ge.record,xe))}),e.C$Y(),e.wR5(3,"mat-datepicker",null,46),e.C$Y()}if(2&Te){const pe=e.Gew(4),ye=e.GaO(2).$implicit,xe=e.GaO(3).$implicit;e.yG2(),e.E7m("for",pe),e.yG2(),e._6D("value",ye.cellData[xe.name].value),e.E7m("matDatepicker",pe)("formControlName",xe.name)}}function Ne(Te,ut){if(1&Te){const pe=e.KQA();e.I0R(0,"input",47),e.qCj("focus",function(xe){e.usT(pe);const Ge=e.GaO(5).$implicit;return e.CGJ(Ge.onFocus(xe))})("keypress",function(xe){e.usT(pe);const Ge=e.GaO(5).$implicit;return e.CGJ(Ge.onChange(xe))})("blur",function(xe){e.usT(pe);const Ge=e.GaO(5).$implicit;return e.CGJ(Ge.onBlur(xe))}),e.C$Y()}if(2&Te){const pe=e.GaO(5).$implicit;e.E7m("formControlName",pe.name)}}function Ae(Te,ut){if(1&Te){const pe=e.KQA();e.I0R(0,"input",48),e.qCj("input",function(xe){e.usT(pe);const Ge=e.GaO(2).$implicit,qe=e.GaO(3).$implicit,Ue=e.GaO();return e.CGJ(Ue.onValueChange(qe.name,Ge.record,xe))}),e.C$Y()}if(2&Te){const pe=e.GaO(2).$implicit,ye=e.GaO(3).$implicit,xe=e.GaO();e._6D("step",ye.step),e._6D("value",pe.cellData[ye.name].value),e._6D("readonly",xe.getValidationAttributeValue(ye,"readonly")),e._6D("required",xe.getValidationAttributeValue(ye,"mandatory")),e._6D("min",xe.getValidationAttributeValue(ye,"minValue")),e._6D("max",xe.getValidationAttributeValue(ye,"maxValue")),e.E7m("formControlName",ye.name)}}function dt(Te,ut){if(1&Te){const pe=e.KQA();e.I0R(0,"input",49),e.qCj("input",function(xe){e.usT(pe);const Ge=e.GaO(2).$implicit,qe=e.GaO(3).$implicit,Ue=e.GaO();return e.CGJ(Ue.onValueChange(qe.name,Ge.record,xe))}),e.C$Y()}if(2&Te){const pe=e.GaO(2).$implicit,ye=e.GaO(3).$implicit,xe=e.GaO();e._6D("value",pe.cellData[ye.name].value),e._6D("readonly",xe.getValidationAttributeValue(ye,"readonly")),e._6D("required",xe.getValidationAttributeValue(ye,"mandatory")),e.E7m("formControlName",ye.name)}}function je(Te,ut){if(1&Te){const pe=e.KQA();e.I0R(0,"mat-checkbox",50),e.qCj("change",function(xe){e.usT(pe);const Ge=e.GaO(2).$implicit,qe=e.GaO(3).$implicit,Ue=e.GaO();return e.CGJ(Ue.onBooleanValueChange(qe.name,Ge.record,xe))}),e.C$Y()}if(2&Te){const pe=e.GaO(2).$implicit,ye=e.GaO(3).$implicit;e.E7m("formControlName",ye.name)("checked",pe.cellData[ye.name].value)}}function Ke(Te,ut){if(1&Te&&(e.I0R(0,"mat-option",53),e.OEk(1),e.C$Y()),2&Te){const pe=ut.$implicit;e.E7m("value",pe.id)("disabled",pe.disabled),e.yG2(),e.oRS(" ",pe.value," ")}}function yt(Te,ut){if(1&Te){const pe=e.KQA();e.I0R(0,"mat-select",51),e.qCj("selectionChange",function(xe){e.usT(pe);const Ge=e.GaO(2).$implicit,qe=e.GaO(3).$implicit,Ue=e.GaO();return e.CGJ(Ue.onSelectValueChange(qe.name,Ge.record,xe))}),e.yuY(1,Ke,2,3,"mat-option",52),e.C$Y()}if(2&Te){const pe=e.GaO(2).$implicit,ye=e.GaO(3).$implicit,xe=e.GaO();e._6D("required",xe.getValidationAttributeValue(ye,"mandatory")),e.E7m("formControlName",ye.name)("multiple",ye.multiple)("value",pe.cellData[ye.name].value),e.yG2(),e.E7m("ngForOf",ye.domainValues)}}function Le(Te,ut){if(1&Te&&e.wR5(0,"input",54),2&Te){e.GaO();const pe=e.Gew(9),ye=e.GaO().$implicit,xe=e.GaO(3).$implicit,Ge=e.GaO();e._6D("required",Ge.getValidationAttributeValue(xe,"mandatory")),e._6D("value",ye.cellData[xe.name].value),e._6D("readonly",Ge.getValidationAttributeValue(xe,"readonly")),e.E7m("formControlName",xe.name)("matAutocomplete",pe)}}function vt(Te,ut){if(1&Te&&(e.I0R(0,"mat-option",55),e.OEk(1),e.C$Y()),2&Te){const pe=ut.$implicit;e.E7m("value",pe.id),e.yG2(),e.oRS(" ",pe.value," ")}}function Se(Te,ut){if(1&Te){const pe=e.KQA();e.I0R(0,"td",32),e.yuY(1,$e,5,4,"div",33)(2,Ne,1,1,"input",34)(3,Ae,1,7,"input",35)(4,dt,1,4,"input",36)(5,je,1,2,"mat-checkbox",37)(6,yt,2,5,"mat-select",38)(7,Le,1,5,"input",39),e.I0R(8,"mat-autocomplete",40,41),e.qCj("optionSelected",function(xe){e.usT(pe);const Ge=e.GaO().$implicit,qe=e.GaO(3).$implicit,Ue=e.GaO();return e.CGJ(Ue.onAutocompleteValueChange(qe,Ge.record,xe))}),e.yuY(10,vt,2,2,"mat-option",42),e.wVc(11,"async"),e.C$Y()()}if(2&Te){const pe=e.GaO().$implicit,ye=e.GaO(3).$implicit,xe=e.GaO();e.E7m("formGroup",xe.formGroup)("ngClass",pe.cellData[ye.name].class),e.yG2(),e.E7m("ngIf","date"===ye.type),e.yG2(),e.E7m("ngIf","time"===ye.type),e.yG2(),e.E7m("ngIf","number"===ye.type),e.yG2(),e.E7m("ngIf",!ye.type||"string"===ye.type),e.yG2(),e.E7m("ngIf","boolean"===ye.type),e.yG2(),e.E7m("ngIf","list"===ye.type),e.yG2(),e.E7m("ngIf","autocomplete"===ye.type),e.yG2(3),e.E7m("ngForOf",e.kDX(11,10,xe.filteredOptions[ye.name]))}}function Be(Te,ut){if(1&Te&&(e.wR5(0,"td",29),e.wVc(1,"sanitizeHtml")),2&Te){const pe=e.GaO(2).$implicit,ye=e.GaO(3).$implicit;e.E7m("ngClass",pe.cellData[ye.name].class)("innerHTML",e.kDX(1,2,pe.cellData[ye.name].value),e.E3n)}}function ze(Te,ut){if(1&Te&&(e.wR5(0,"img",26),e.wVc(1,"async"),e.wVc(2,"secureImage")),2&Te){const pe=e.GaO(3).$implicit,ye=e.GaO(3).$implicit;e._6D("src",e.kDX(1,1,e.kDX(2,3,pe.cellData[ye.name].value)),e.K6U)}}function St(Te,ut){1&Te&&(e.I0R(0,"span"),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&Te&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.geo.targetHtmlUrl")," "))}function Dt(Te,ut){if(1&Te&&(e.I0R(0,"td",22)(1,"a",23),e.qCj("click",function(ye){return ye.stopPropagation()}),e.yuY(2,ze,3,5,"img",24)(3,St,3,3,"ng-template",null,25,e.gJz),e.C$Y()()),2&Te){const pe=e.Gew(4),ye=e.GaO(2).$implicit,xe=e.GaO(3).$implicit;e.E7m("ngClass",ye.cellData[xe.name].class),e.yG2(),e._6D("href",ye.cellData[xe.name].value,e.K6U),e.yG2(),e.E7m("ngIf",ye.cellData[xe.name].isImg)("ngIfElse",pe)}}function mo(Te,ut){if(1&Te&&e.yuY(0,Be,2,4,"td",27)(1,Dt,5,4,"ng-template",null,56,e.gJz),2&Te){const pe=e.Gew(2),ye=e.GaO().$implicit,xe=e.GaO(3).$implicit;e.E7m("ngIf",!ye.cellData[xe.name].isUrl)("ngIfElse",pe)}}function Bo(Te,ut){if(1&Te&&(e.SAx(0),e.yuY(1,Se,12,12,"td",30)(2,mo,3,2,"ng-template",null,31,e.gJz),e.k70()),2&Te){const pe=ut.$implicit,ye=e.Gew(3),xe=e.GaO(4);e.yG2(),e.E7m("ngIf",xe.isEdition(pe.record))("ngIfElse",ye)}}function Xe(Te,ut){1&Te&&(e.SAx(0),e.yuY(1,Bo,4,2,"ng-container",19),e.k70())}function ct(Te,ut){if(1&Te){const pe=e.KQA();e.I0R(0,"mat-icon",60),e.qCj("click",function(xe){e.usT(pe);const Ge=e.GaO(4).$implicit;return e.CGJ(Ge.onClick(xe))}),e.C$Y()}if(2&Te){const pe=e.GaO().$implicit,ye=e.GaO(3).$implicit;e._6D("svgIcon",pe.cellData[ye.name].value||ye.icon)}}function tt(Te,ut){if(1&Te&&e.wR5(0,"mat-icon",61),2&Te){const pe=e.GaO().$implicit,ye=e.GaO(3).$implicit;e._6D("svgIcon",pe.cellData[ye.name].value||ye.icon)}}function st(Te,ut){if(1&Te&&(e.I0R(0,"td",22),e.yuY(1,ct,1,1,"mat-icon",58)(2,tt,1,1,"mat-icon",59),e.C$Y()),2&Te){const pe=ut.$implicit,ye=e.GaO(3).$implicit;e.E7m("ngClass",pe.cellData[ye.name].class),e.yG2(),e.E7m("ngIf",ye.onClick),e.yG2(),e.E7m("ngIf",!ye.onClick)}}function it(Te,ut){1&Te&&(e.SAx(0),e.yuY(1,st,3,3,"td",57),e.k70())}function Ri(Te,ut){if(1&Te){const pe=e.KQA();e.I0R(0,"button",65),e.qCj("mousedown",function(){e.usT(pe);const xe=e.GaO(2).$implicit,Ge=e.GaO().$implicit,qe=e.GaO(4);return e.CGJ(qe.onButtonClick(xe.click,Ge.record))}),e.wR5(1,"mat-icon",61),e.C$Y()}if(2&Te){const pe=e.GaO(2).$implicit;e.E7m("color",pe.color)("disabled",pe.disabled),e.yG2(),e._6D("svgIcon",pe.icon)}}function Qt(Te,ut){if(1&Te){const pe=e.KQA();e.I0R(0,"button",66),e.qCj("mousedown",function(){e.usT(pe);const xe=e.GaO(2).$implicit,Ge=e.GaO().$implicit,qe=e.GaO(4);return e.CGJ(qe.onButtonClick(xe.click,Ge.record))}),e.wR5(1,"mat-icon",61),e.C$Y()}if(2&Te){const pe=e.GaO(2).$implicit;e.E7m("color",pe.color)("disabled",pe.disabled),e.yG2(),e._6D("svgIcon",pe.icon)}}function ao(Te,ut){if(1&Te&&(e.SAx(0),e.yuY(1,Ri,2,3,"button",63)(2,Qt,2,3,"button",64),e.k70()),2&Te){const pe=e.GaO().$implicit;e.yG2(),e.E7m("ngIf","mat-icon-button"===pe.style),e.yG2(),e.E7m("ngIf","mat-icon-button"!==pe.style)}}function mt(Te,ut){if(1&Te&&(e.I0R(0,"span"),e.yuY(1,ao,3,2,"ng-container",10),e.C$Y()),2&Te){const pe=ut.$implicit,ye=e.GaO().$implicit,xe=e.GaO(4);e.yG2(),e.E7m("ngIf",xe.isEdition(ye.record)===pe.editMode||void 0===pe.editMode)}}function $t(Te,ut){if(1&Te&&(e.SAx(0),e.I0R(1,"td",22),e.yuY(2,mt,2,1,"span",62),e.C$Y(),e.k70()),2&Te){const pe=ut.$implicit,ye=e.GaO(3).$implicit;e.yG2(),e.E7m("ngClass",pe.cellData[ye.name].class),e.yG2(),e.E7m("ngForOf",pe.cellData[ye.name].value)}}function Lo(Te,ut){1&Te&&(e.SAx(0),e.yuY(1,$t,3,2,"ng-container",19),e.k70())}function Uo(Te,ut){if(1&Te&&(e.SAx(0),e.yuY(1,ht,2,0,"ng-container",10)(2,ve,2,0,"ng-container",10)(3,Xe,2,0,"ng-container",10)(4,it,2,0,"ng-container",10)(5,Lo,2,0,"ng-container",10),e.k70()),2&Te){const pe=ut.ngIf,ye=e.GaO(2);e.yG2(),e.E7m("ngIf",pe===ye.entityTableColumnRenderer.Default),e.yG2(),e.E7m("ngIf",pe===ye.entityTableColumnRenderer.HTML),e.yG2(),e.E7m("ngIf",pe===ye.entityTableColumnRenderer.UnsanitizedHTML),e.yG2(),e.E7m("ngIf",pe===ye.entityTableColumnRenderer.Icon),e.yG2(),e.E7m("ngIf",pe===ye.entityTableColumnRenderer.ButtonGroup)}}function Si(Te,ut){if(1&Te&&(e.SAx(0,14),e.yuY(1,fe,2,0,"ng-container",10)(2,ue,2,0,"ng-container",10)(3,Uo,6,5,"ng-container",10),e.k70()),2&Te){const pe=ut.$implicit,ye=e.GaO();e.E7m("matColumnDef",pe.name),e.yG2(),e.E7m("ngIf",ye.columnIsSortable(pe)),e.yG2(),e.E7m("ngIf",!ye.columnIsSortable(pe)),e.yG2(),e.E7m("ngIf",ye.getColumnRenderer(pe))}}function Bt(Te,ut){if(1&Te&&e.wR5(0,"tr",67),2&Te){const pe=e.GaO();e.E7m("ngClass",pe.getHeaderClass())}}function eo(Te,ut){if(1&Te){const pe=e.KQA();e.I0R(0,"tr",68),e.qCj("select",function(){const Ge=e.usT(pe).$implicit,qe=e.GaO();return e.CGJ(qe.onRowSelect(Ge.record))})("click",function(){const Ge=e.usT(pe).$implicit,qe=e.GaO();return e.CGJ(qe.onRowClick(Ge.record))}),e.C$Y()}if(2&Te){const pe=ut.$implicit,ye=e.GaO();e.E7m("scrollBehavior",ye.scrollBehavior)("ngClass",ye.getRowClass(pe.record))("selection",ye.selection)("selected",ye.rowIsSelected(pe.record))}}function uo(Te,ut){if(1&Te){const pe=e.KQA();e.I0R(0,"igo-entity-table-paginator",69),e.qCj("paginatorChange",function(xe){e.usT(pe);const Ge=e.GaO();return e.CGJ(Ge.paginatorChange(xe))}),e.C$Y()}if(2&Te){const pe=e.GaO();e.E7m("store",pe.store)("paginatorOptions",pe.paginatorOptions)("entitySortChange$",pe.entitySortChange$)}}const zt=Te=>({height:Te});let qt=(()=>{class Te{cdRef;formBuilder;_focusMonitor;_elementRef;ngControl;_parentForm;_controlName;_defaultErrorStateMatcher;dateAdapter;entitySortChange$=new X.g(!1);formGroup=new d.k1({});filteredOptions={};entityTableColumnRenderer=P.G8;entityTableSelectionState=P.mi;selectionState$=new X.g(void 0);selection$$;dataSource$$;lastRecordCheckedKey;store;set paginator(pe){this._paginator=pe,this.dataSource.paginator=pe}get paginator(){return this._paginator}_paginator;template;scrollBehavior=P.qK.Auto;sortNullsFirst=!1;withPaginator=!1;paginatorOptions;entityClick=new e._w7;entitySelectChange=new e._w7;entitySortChange=new e._w7(void 0);get headers(){let pe=this.template.columns.filter(ye=>!1!==ye.visible).map(ye=>ye.name);return!0===this.selectionCheckbox&&(pe=["selectionCheckbox"].concat(pe)),pe}dataSource=new K._c;get selection(){return this.template.selection||!1}get selectionCheckbox(){return this.template.selectionCheckbox||!1}get selectMany(){return this.template.selectMany||!1}get fixedHeader(){return void 0===this.template.fixedHeader||this.template.fixedHeader}get tableHeight(){return this.template.tableHeight?this.template.tableHeight:"auto"}constructor(pe,ye,xe,Ge,qe,Ue,Ut,Me,Lt){this.cdRef=pe,this.formBuilder=ye,this._focusMonitor=xe,this._elementRef=Ge,this.ngControl=qe,this._parentForm=Ue,this._controlName=Ut,this._defaultErrorStateMatcher=Me,this.dateAdapter=Lt,this.dateAdapter.setLocale("fr-CA")}ngOnInit(){this.handleDatasource(),this.dataSource.paginator=this.paginator,this.store.state.change$.pipe((0,z.o)(100)).subscribe(()=>{this.handleDatasource(),this.refresh()})}ngOnChanges(pe){const ye=pe.store;ye&&ye.currentValue!==ye.previousValue&&this.handleDatasource()}onValueChange(pe,ye,xe){const Ge=this.getColumnKeyWithoutPropertiesTag(pe);ye.entity.properties[Ge]=xe.target.value}onBooleanValueChange(pe,ye,xe){const Ge=this.getColumnKeyWithoutPropertiesTag(pe);ye.entity.properties[Ge]=xe.checked}onSelectValueChange(pe,ye,xe){const Ge=this.getColumnKeyWithoutPropertiesTag(pe);ye.entity.properties[Ge]=xe.value}onAutocompleteValueChange(pe,ye,xe){this.formGroup.controls[pe.name].setValue(xe.option.viewValue);const Ge=this.getColumnKeyWithoutPropertiesTag(pe.name);ye.entity.properties[Ge]=xe.option.value}onDateChange(pe,ye,xe){const qe=B()(xe.value).format("YYYY-MM-DD"),Ue=this.getColumnKeyWithoutPropertiesTag(pe);ye.entity.properties[Ue]=qe}enableEdit(pe){const ye=pe.entity.properties||pe.entity;this.template.columns.forEach(xe=>{xe.title=xe.validation?.mandatory&&!xe.title.includes("*")?xe.title+" *":xe.title;const Ge=this.getColumnKeyWithoutPropertiesTag(xe.name);if("boolean"===xe.type)ye[Ge]&&null!==ye[Ge]?"string"==typeof ye[Ge]&&(ye[Ge]=JSON.parse(ye[Ge].toLowerCase())):ye[Ge]=!1,this.formGroup.setControl(xe.name,this.formBuilder.control(ye[Ge]));else if("list"===xe.type)xe.multiple?this.formGroup.setControl(xe.name,this.formBuilder.control([ye[Ge]])):(this.formGroup.setControl(xe.name,this.formBuilder.control(ye[Ge])),this.formGroup.controls[xe.name].setValue("string"==typeof ye[Ge]?parseInt(ye[Ge]):ye[Ge]));else if("autocomplete"===xe.type){this.formGroup.setControl(xe.name,this.formBuilder.control(ye[Ge])),this.filteredOptions[xe.name]=new V._,this.filteredOptions[xe.name]=this.formGroup.controls[xe.name].valueChanges.pipe((0,W.k)(Ue=>{if(Ue?.length)return xe.domainValues?.filter(Ut=>{const Me=Ue?Ue.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"";return Ut.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(Me)})}));let qe=ye[Ge];if(xe.domainValues.forEach(Ue=>{"string"==typeof qe&&L.eU.isValidNumber(qe)&&!L.eU.isOctalNumber(qe)&&(qe=parseInt(qe)),(Ue.value===qe||Ue.id===qe)&&(qe=Ue.value)}),this.formGroup.controls[xe.name].setValue(qe),this.isEdition(pe)&&xe.linkColumnForce){const Ue=pe.entity;this.formGroup.controls[xe.name].setValue(Ue?.properties[this.getColumnKeyWithoutPropertiesTag(xe.linkColumnForce)])}}else if("date"===xe.type){if(!1!==xe.visible)if(ye[Ge]){let qe=B()(ye[Ge]);ye[Ge]=qe.utc().format("YYYY-MM-DD"),this.formGroup.setControl(xe.name,this.formBuilder.control(ye[Ge]))}else{const qe=this.getColumnKeyWithoutPropertiesTag(xe.name);pe.entity.properties[qe]=null,this.formGroup.setControl(xe.name,this.formBuilder.control(null))}}else this.formGroup.setControl(xe.name,this.formBuilder.control(ye[Ge]));this.formGroup.controls[xe.name]&&this.getValidationAttributeValue(xe,"readonly")&&this.formGroup.controls[xe.name].disable()})}handleDatasource(){this.unsubscribeStore(),this.selection$$=this.store.stateView.manyBy$(pe=>!0===pe.state.selected).subscribe(pe=>{const ye=pe[0],xe=this.store.stateView.all().indexOf(ye),Ge=this.paginator?this.paginator.pageSize*(this.paginator.pageIndex+1):0;if(this.paginator&&(xe<(this.paginator?Ge-this.paginator.pageSize:0)||xe>=Ge)){const Ue=Math.floor(xe/this.paginator.pageSize);this.dataSource.paginator.pageIndex=Ue}this.selectionState$.next(this.computeSelectionState(pe))}),this.dataSource$$=this.store.stateView.all$().subscribe(pe=>{pe[0]&&this.enableEdit(pe[0]),this.dataSource.data=pe.map(ye=>({record:ye,cellData:this.template.columns.reduce((xe,Ge)=>{const qe=this.getValue(ye,Ge);return xe[Ge.name]={class:this.getCellClass(ye,Ge),value:qe,isUrl:this.isUrl(qe),isImg:this.isImg(qe)},xe},{})}))})}ngOnDestroy(){this.unsubscribeStore()}unsubscribeStore(){this.selection$$&&this.selection$$.unsubscribe(),this.dataSource$$&&this.dataSource$$.unsubscribe()}getTrackByFunction(){return(pe,ye)=>ye.record.ref}refresh(){this.cdRef.detectChanges()}paginatorChange(pe){this.paginator=pe}onSort(pe){const ye=pe.direction,xe=this.template.columns.find(Ge=>Ge.name===pe.active);"asc"===ye||"desc"===ye?(this.store.stateView.sort({valueAccessor:Ge=>this.getValue(Ge,xe),direction:ye,nullsFirst:this.sortNullsFirst}),this.entitySortChange.emit({column:xe,direction:ye}),this.entitySortChange$.next(!0)):this.store.stateView.sort(void 0)}onRowClick(pe){this.lastRecordCheckedKey=this.store.stateView.getKey(pe),this.entityClick.emit(pe.entity)}onRowSelect(pe){if(!1===this.selection)return;const ye=pe.entity;this.store.state.update(ye,{selected:!0},!0),this.entitySelectChange.emit({added:[ye]})}onToggleRows(pe){if(!1===this.selection)return;const ye=this.store.view.all();this.entitySelectChange.emit({added:[ye]}),this.store.state.updateMany(ye,{selected:pe})}onToggleRow(pe,ye){if(!1===this.selection)return;const xe=ye.entity;this.store.state.update(xe,{selected:pe},!0===pe&&!this.selectMany),!0===pe&&this.entitySelectChange.emit({added:[xe]}),this.lastRecordCheckedKey=this.store.stateView.getKey(ye)}onShiftToggleRow(pe,ye,xe){if(!1===this.selection)return;if(!1===this.selectMany||void 0===this.lastRecordCheckedKey)return void this.onToggleRow(pe,ye);const Ge=window.document.createRange();Ge.selectNode(xe.target),window.getSelection().removeAllRanges(),window.getSelection().addRange(Ge),xe.stopImmediatePropagation();const qe=this.store.stateView.all(),Ue=qe.indexOf(ye),Ut=this.store.stateView.get(this.lastRecordCheckedKey),Lt=[Ue,qe.indexOf(Ut)],_t=qe.slice(Math.min(...Lt),Math.max(...Lt)+1).map(Gt=>Gt.entity);this.store.state.updateMany(_t,{selected:pe}),!0===pe&&this.entitySelectChange.emit({added:_t}),this.lastRecordCheckedKey=this.store.stateView.getKey(ye)}computeSelectionState(pe){const ye=P.mi,xe=pe.length;return 0===xe?ye.None:xe===this.store.stateView.count?ye.All:ye.Some}columnIsSortable(pe){let ye=pe.sort;return void 0===ye&&(ye=void 0!==this.template.sort&&this.template.sort),ye}rowIsSelected(pe){const ye=pe.state;return!!ye.selected&&ye.selected}isImg(pe){return!!this.isUrl(pe)&&-1!==["jpg","png","gif"].indexOf(pe.split(".").pop().toLowerCase())}isUrl(pe){return"string"==typeof pe&&("https://"===pe.slice(0,8)||"http://"===pe.slice(0,7))}getValue(pe,ye){const xe=pe.entity;let Ge;if(void 0!==ye.valueAccessor)return ye.valueAccessor(xe,pe);if(void 0!==this.template.valueAccessor)return this.template.valueAccessor(xe,ye.name,pe);if(Ge=this.store.getProperty(xe,ye.name),"boolean"===ye.type)null==Ge||""===Ge?Ge=!1:"boolean"!=typeof Ge&&void 0!==Ge&&(Ge="number"==typeof Ge?!!Ge:JSON.parse(Ge.toLowerCase())),this.isEdition(pe)||(Ge=Ge?"&#10003;":"");else if("list"===ye.type&&Ge&&ye.domainValues){const qe=pe.entity;if(ye.multiple){let Ue;Ue="string"==typeof Ge?Ge.match(/[\w.-]+/g).map(Number):Ge;let Ut=[];ye.domainValues.forEach(Me=>{Ue.includes(Me.id)&&Ut.push(pe.edition?Me.id:Me.value)}),Ge=this.isEdition(pe)?Ue:Ut}else!this.isEdition(pe)&&ye.linkColumnForce?Ge=qe?.properties[this.getColumnKeyWithoutPropertiesTag(ye.linkColumnForce)]:ye.domainValues.forEach(Ue=>{"string"==typeof Ge&&L.eU.isValidNumber(Ge)&&!L.eU.isOctalNumber(Ge)&&(Ge=parseInt(Ge)),(Ue.value===Ge||Ue.id===Ge)&&(Ge=this.isEdition(pe)?Ue.id:Ue.value)})}else if("autocomplete"===ye.type&&Ge&&ye.domainValues){const qe=pe.entity;!this.isEdition(pe)&&ye.linkColumnForce?Ge=qe?.properties[this.getColumnKeyWithoutPropertiesTag(ye.linkColumnForce)]:ye.domainValues.forEach(Ue=>{"string"==typeof Ge&&L.eU.isValidNumber(Ge)&&!L.eU.isOctalNumber(Ge)&&(Ge=parseInt(Ge)),(Ue.value===Ge||Ue.id===Ge)&&(Ge=Ue.value)})}else"date"===ye.type&&(this.isEdition(pe)?Ge&&(Ge=B()(Ge).format(),this.formGroup.controls[ye.name].setValue(Ge)):!this.isEdition(pe)&&null===Ge&&(Ge=""));return void 0===Ge&&(Ge=""),Ge}getValidationAttributeValue(pe,ye){return void 0!==pe.validation&&void 0!==pe.validation[ye]&&pe.validation[ye]}isEdition(pe){return!!pe.entity.edition}getColumnRenderer(pe){return void 0!==pe.renderer?pe.renderer:P.G8.Default}getTableClass(){return{"igo-entity-table-with-selection":this.selection}}getHeaderClass(){const pe=this.template.headerClassFunc;return pe instanceof Function?pe():{}}getRowClass(pe){const xe=this.template.rowClassFunc;return xe instanceof Function?xe(pe.entity,pe):{}}getCellClass(pe,ye){const xe=pe.entity,Ge={},qe=this.template.cellClassFunc;qe instanceof Function&&Object.assign(Ge,qe(xe,ye,pe));const Ue=ye.cellClassFunc;return Ue instanceof Function&&Object.assign(Ge,Ue(xe,pe)),Ge}onButtonClick(pe,ye){this.enableEdit(ye),"function"==typeof pe&&pe(ye.entity,ye)}getColumnKeyWithoutPropertiesTag(pe){return pe.includes("properties.")?pe.split(".")[1]:pe}static \u0275fac=function(ye){return new(ye||Te)(e.GI1(e.kD9),e.GI1(d.KE),e.GI1(O.Kk),e.GI1(e.GMv),e.GI1(d.eq,10),e.GI1(d.SC,8),e.GI1(d.Wo,8),e.GI1(j.u9),e.GI1(j.Wu))};static \u0275cmp=e.In1({type:Te,selectors:[["igo-entity-table"]],inputs:{store:"store",paginator:"paginator",template:"template",scrollBehavior:"scrollBehavior",sortNullsFirst:"sortNullsFirst",withPaginator:"withPaginator",paginatorOptions:"paginatorOptions"},outputs:{entityClick:"entityClick",entitySelectChange:"entitySelectChange",entitySortChange:"entitySortChange"},standalone:!0,features:[e.M5G([{provide:w.u0,useExisting:Te},(0,g.CA)()]),e.SYr,e.UHJ],decls:9,vars:11,consts:[[1,"table-container",3,"ngStyle"],["id","currentWorkspaceTable","mat-table","","matSort","",3,"ngClass","dataSource","trackBy","matSortChange"],["matColumnDef","selectionCheckbox",1,"mat-cell-checkbox"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",3,"ngClass",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","igoEntityTableRow","",3,"scrollBehavior","ngClass","selection","selected","select","click",4,"matRowDef","matRowDefColumns"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange",4,"ngIf"],["mat-header-cell",""],[4,"ngIf"],[3,"checked","indeterminate","change"],["mat-cell",""],[3,"checked","mousedown","click","change"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",3,"matTooltip",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header","",3,"matTooltip"],["mat-header-cell","",3,"matTooltip",4,"matHeaderCellDef"],["mat-header-cell","",3,"matTooltip"],[4,"matCellDef"],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"ngIf","ngIfElse"],["isAnUrlDefault",""],["mat-cell","",1,"mat-cell-text",3,"ngClass"],["target","_blank","rel","noopener noreferrer",3,"href","click"],["igoImageError","","width","50","heigth","auto",3,"src",4,"ngIf","ngIfElse"],["notImg",""],["igoImageError","","width","50","heigth","auto",3,"src"],["mat-cell","","class","mat-cell-text",3,"ngClass","innerHTML",4,"ngIf","ngIfElse"],["isAnUrlHTML",""],["mat-cell","",1,"mat-cell-text",3,"ngClass","innerHTML"],["mat-cell","","class","mat-cell-text edition",3,"formGroup","ngClass",4,"ngIf","ngIfElse"],["isUnsanitizedHTML",""],["mat-cell","",1,"mat-cell-text","edition",3,"formGroup","ngClass"],["class","date-picker",4,"ngIf"],["matInput","","type","time","step","900",3,"formControlName","focus","keypress","blur",4,"ngIf"],["matInput","","type","number","class","class_number_edition",3,"formControlName","step","value","readonly","required","min","max","input",4,"ngIf"],["matInput","","type","text",3,"formControlName","value","readonly","required","input",4,"ngIf"],[3,"formControlName","checked","change",4,"ngIf"],[3,"required","formControlName","multiple","value","selectionChange",4,"ngIf"],["matInput","","type","text",3,"formControlName","matAutocomplete","required","value","readonly",4,"ngIf"],["panelWidth","430px",3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"date-picker"],["matSuffix","",3,"for"],["matInput","",3,"matDatepicker","formControlName","value","dateChange"],["picker",""],["matInput","","type","time","step","900",3,"formControlName","focus","keypress","blur"],["matInput","","type","number",1,"class_number_edition",3,"formControlName","step","value","readonly","required","min","max","input"],["matInput","","type","text",3,"formControlName","value","readonly","required","input"],[3,"formControlName","checked","change"],[3,"required","formControlName","multiple","value","selectionChange"],[3,"value","disabled",4,"ngFor","ngForOf"],[3,"value","disabled"],["matInput","","type","text",3,"formControlName","matAutocomplete","required","value","readonly"],[3,"value"],["isAnUrlUnsanitizedHTML",""],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"matCellDef"],[3,"svgIcon","click",4,"ngIf"],[3,"svgIcon",4,"ngIf"],[3,"svgIcon","click"],[3,"svgIcon"],[4,"ngFor","ngForOf"],["igoStopPropagation","","mat-icon-button","",3,"color","disabled","mousedown",4,"ngIf"],["igoStopPropagation","","mat-mini-fab","",3,"color","disabled","mousedown",4,"ngIf"],["igoStopPropagation","","mat-icon-button","",3,"color","disabled","mousedown"],["igoStopPropagation","","mat-mini-fab","",3,"color","disabled","mousedown"],["mat-header-row","",3,"ngClass"],["mat-row","","igoEntityTableRow","",3,"scrollBehavior","ngClass","selection","selected","select","click"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange"]],template:function(ye,xe){1&ye&&(e.I0R(0,"div",0)(1,"table",1),e.qCj("matSortChange",function(qe){return xe.onSort(qe)}),e.SAx(2,2),e.yuY(3,r,2,1,"th",3)(4,ie,2,1,"td",4),e.k70(),e.yuY(5,Si,4,4,"ng-container",5)(6,Bt,1,1,"tr",6)(7,eo,1,4,"tr",7),e.C$Y(),e.yuY(8,uo,1,3,"igo-entity-table-paginator",8),e.C$Y()),2&ye&&(e.E7m("ngStyle",e.S45(9,zt,xe.tableHeight)),e.yG2(),e.E7m("ngClass",xe.getTableClass())("dataSource",xe.dataSource)("trackBy",xe.getTrackByFunction()),e.yG2(4),e.E7m("ngForOf",xe.template.columns),e.yG2(),e.E7m("matHeaderRowDef",xe.headers)("matHeaderRowDefSticky",xe.fixedHeader),e.yG2(),e.E7m("matRowDefColumns",xe.headers),e.yG2(),e.E7m("ngIf",xe.withPaginator))},dependencies:[y.a,S.I,G,d.y,d.ot,d.O4,d.ue,d.u,d.eJ,d.Gu,d._t,q.M,R.U1,R.e,j.I5,R.cG,o.oJ,o.um,o.CI,h.Vn,h.WK,x.iU,x.SU,x.Ul,x.yu,w.wb,w.Gm,b.oB,b.qL,E.cN,E.yi,j.Ko,j.Ax,T.d5,T.kX,a.Su,a.E9,a.e6,K.If,K.wL,K.ie,K.aG,K.Af,K.uc,K.gx,K.qC,K.cX,K.yC,K._I,M.KO,M.a4,y.QF,y.Iw,y.u_,y.Qt,d.sl,d.uW,d.Wo,A.U,_.k,u.m,oe.O0,oe.sD],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}.table-compact[_nghost-%COMP%]   tr.mat-mdc-header-row[_ngcontent-%COMP%], .table-compact[_nghost-%COMP%]     mat-checkbox .mat-ripple{height:36px}.table-compact[_nghost-%COMP%]   tr.mat-mdc-row[_ngcontent-%COMP%], .table-compact[_nghost-%COMP%]     mat-checkbox .mat-ripple{height:28px}[_nghost-%COMP%]   .table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto;flex:1 1 auto}[_nghost-%COMP%]   .mat-cell-text[_ngcontent-%COMP%]{overflow:hidden;word-wrap:break-word}[_nghost-%COMP%]   entity-table[_ngcontent-%COMP%]   table.igo-entity-table-with-selection[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{-o-box-shadow:2px 0px 2px 0px #dddddd;box-shadow:2px 0 2px #ddd;cursor:pointer}[_nghost-%COMP%]   table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:7px}[_nghost-%COMP%]   .class_hidden[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]   .class_display_none[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .class_boolean[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_number[_ngcontent-%COMP%]{text-align:center;padding-right:35px!important}[_nghost-%COMP%]   .class_string[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_text[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_number_edition[_ngcontent-%COMP%]{text-align:left}[_nghost-%COMP%]   td.edition[_ngcontent-%COMP%]{background:#a6a6a633}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{border-bottom:1px solid darkgrey}"],changeDetection:0})}return Te})()},68488:(Ee,ce,s)=>{"use strict";s.d(ce,{sh:()=>y.s,qc:()=>g.qc,qq:()=>g.qq,xx:()=>g.xx,uk:()=>g.uk,YX:()=>g.YX,G8:()=>g.G8,Eh:()=>d.E,I7:()=>e.I,qK:()=>g.qK,sH:()=>g.sH,_I:()=>g._I,u6:()=>g.u6,mU:()=>g.mU,YB:()=>g.YB,E$:()=>g.E$});var y=s(66165),e=s(800),d=s(14944),g=s(80544)},72672:(Ee,ce,s)=>{"use strict";s.d(ce,{G8:()=>e,mi:()=>g,qK:()=>d});var e=function(R){return R.Default="Default",R.HTML="HTML",R.UnsanitizedHTML="UnsanitizedHTML",R.Editable="Editable",R.Icon="Icon",R.ButtonGroup="ButtonGroup",R}(e||{}),d=function(R){return R.Auto="auto",R.Instant="instant",R.Smooth="smooth",R}(d||{}),g=function(R){return R.None="None",R.All="All",R.Some="Some",R}(g||{})},22788:(Ee,ce,s)=>{"use strict";s.d(ce,{E$:()=>R,YB:()=>g,_I:()=>d,mU:()=>h,sH:()=>o,u6:()=>e});var y=s(63596);function e(j,x){return(0,y.t)(j,x).safeObject}function d(j){const x=j.meta||{};return x.id?x.id:e(j,x.idProperty||"id")}function g(j){const x=j.meta||{};return x.title?x.title:e(j,x.titleProperty||"title")}function R(j){const x=j.meta||{};return x.titleHtml?x.titleHtml:e(j,x.titleHtmlProperty||"titleHtml")}function o(j){const x=j.meta||{};return x.icon?x.icon:e(j,x.iconProperty||"icon")}function h(j){return(j.meta||{}).revision||0}},80544:(Ee,ce,s)=>{"use strict";s.d(ce,{qc:()=>d.q,qq:()=>w,xx:()=>b,uk:()=>x,YX:()=>R.Y,G8:()=>y.G8,qK:()=>y.qK,mi:()=>y.mi,sH:()=>e.sH,_I:()=>e._I,u6:()=>e.u6,mU:()=>e.mU,YB:()=>e.YB,E$:()=>e.E$});var y=s(72672),e=s(22788),d=s(63892),R=(s(64868),s(87556));s(27060);var j=s(54844);class x{options;stores=[];get active(){return this.active$.value}active$=new j.g(!1);constructor(T={}){this.options=T,this.options=T}activate(){!0===this.active&&this.doDeactivate(),this.active$.next(!0),this.doActivate()}deactivate(){this.active$.next(!1),this.doDeactivate()}bindStore(T){this.stores.indexOf(T)<0&&this.stores.push(T)}unbindStore(T){const a=this.stores.indexOf(T);a>=0&&this.stores.splice(a,1)}doActivate(){}doDeactivate(){}}class w extends x{options;constructor(T){super(T),this.options=T}filters=new Map;bindStore(T){super.bindStore(T),!0===this.active&&this.filterStore(T)}unbindStore(T){super.unbindStore(T),!0===this.active&&this.unfilterStore(T)}doActivate(){this.filterAll()}doDeactivate(){this.unfilterAll()}filterAll(){this.stores.forEach(T=>this.filterStore(T))}unfilterAll(){this.stores.forEach(T=>this.unfilterStore(T))}filterStore(T){this.filters.set(T,T.stateView.addFilter(this.options.filterClauseFunc))}unfilterStore(T){const a=this.filters.get(T);void 0!==a&&(T.stateView.removeFilter(a),this.filters.delete(T))}}class b extends x{filters=new Map;bindStore(T){super.bindStore(T),!0===this.active&&this.filterStore(T)}unbindStore(T){super.unbindStore(T),!0===this.active&&this.unfilterStore(T)}doActivate(){this.filterAll()}doDeactivate(){this.unfilterAll()}filterAll(){this.stores.forEach(T=>this.filterStore(T))}unfilterAll(){this.stores.forEach(T=>this.unfilterStore(T))}filterStore(T){this.filters.has(T)||this.filters.set(T,T.stateView.addFilter(K=>!0===K.state.selected))}unfilterStore(T){const a=this.filters.get(T);void 0!==a&&(T.stateView.removeFilter(a),this.filters.delete(T))}}},64868:(Ee,ce,s)=>{"use strict";s.d(ce,{E:()=>d});var y=s(23680),e=s(22788);class d{options;index=new Map;change$=new y.o(1);getKey;constructor(R={}){this.options=R,this.getKey=R.getKey?R.getKey:e._I,this.next()}clear(){this.index.size>0&&(this.index.clear(),this.next())}get(R){return this.index.get(this.getKey(R))||{}}set(R,o){this.setMany([R],o)}setMany(R,o){R.forEach(h=>{this.index.set(this.getKey(h),Object.assign({},o))}),this.next()}setAll(R){Array.from(this.index.keys()).forEach(o=>{this.index.set(o,Object.assign({},R))}),this.next()}update(R,o,h=!1){this.updateMany([R],o,h)}updateMany(R,o,h=!1){if(!0===h)return this.updateManyExclusive(R,o);R.forEach(j=>{const x=Object.assign({},this.get(j),o);this.index.set(this.getKey(j),x)}),this.next()}reverse(R,o){this.reverseMany([R],o)}reverseMany(R,o){R.forEach(h=>{const j=this.get(h),x=o.reduce((E,T)=>(E[T]=j[T]||!1,E),{}),w=this.reverseChanges(x),b=Object.assign({},j,w);this.index.set(this.getKey(h),b)}),this.next()}updateAll(R){const o=this.getAllKeys();Array.from(o).forEach(h=>{const j=Object.assign({},this.index.get(h),R);this.index.set(h,j)}),this.next()}updateManyExclusive(R,o){const h=this.reverseChanges(o),j=R.map(w=>this.getKey(w));new Set(j.concat(Array.from(this.getAllKeys()))).forEach(w=>{const b=this.index.get(w)||{};j.indexOf(w)>=0?this.index.set(w,Object.assign({},b,o)):!0===Object.keys(h).some(T=>void 0!==b[T]&&b[T]!==h[T])&&this.index.set(w,Object.assign({},b,h))}),this.next()}reverseChanges(R){return Object.entries(R).reduce((o,h)=>{const[j,x]=h;return"boolean"==typeof x&&(o[j]=!x),o},{})}getAllKeys(){const R=Array.from(this.options?.index?.keys()??[]);return new Set(Array.from(this.index.keys()).concat(R))}next(){this.change$.next()}}},63892:(Ee,ce,s)=>{"use strict";s.d(ce,{q:()=>R});var y=s(54844),e=s(22788),d=s(64868),g=s(27060);class R{entities$=new y.g([]);count$=new y.g(0);get count(){return this.count$.value}empty$=new y.g(!0);get empty(){return this.empty$.value}state;view;stateView;getKey;getProperty;get index(){return this._index}_index;get pristine(){return this._pristine}_pristine=!0;strategies=[];constructor(h,j={}){this.getKey=j.getKey?j.getKey:e._I,this.getProperty=j.getProperty?j.getProperty:e.u6,this.state=this.createStateManager(),this.view=this.createDataView(),this.stateView=this.createStateView(),this.view.lift(),this.stateView.lift(),h.length>0?this.load(h):this._index=this.generateIndex(h)}get(h){return this.index.get(h)}all(){return this.entities$.value}load(h,j=!0){this._index=this.generateIndex(h),this._pristine=j,this.next()}softClear(){this.index&&this.index.size>0?(this.index.clear(),this._pristine=!0,this.next()):this.index&&this.updateCount()}clear(){this.stateView.clear(),this.view.clear(),this.state.clear(),this.softClear()}destroy(){this.stateView.destroy(),this.view.destroy(),this.clear()}insert(h){this.insertMany([h])}insertMany(h){h.forEach(j=>this.index.set(this.getKey(j),j)),this._pristine=!1,this.next()}update(h){this.updateMany([h])}updateMany(h){h.forEach(j=>this.index.set(this.getKey(j),j)),this._pristine=!1,this.next()}addStrategy(h,j=!1){if(void 0!==this.strategies.find(w=>h.constructor===w.constructor))throw new Error("A strategy of this type already exists on that EntityStore.");return this.strategies.push(h),h.bindStore(this),!0===j&&h.activate(),this}removeStrategy(h){const j=this.strategies.indexOf(h);return j>=0&&(this.strategies.splice(j,1),h.unbindStore(this)),this}getStrategyOfType(h){return this.strategies.find(j=>j instanceof h)}activateStrategyOfType(h){const j=this.getStrategyOfType(h);void 0!==j&&j.activate()}deactivateStrategyOfType(h){const j=this.getStrategyOfType(h);void 0!==j&&j.deactivate()}delete(h){this.deleteMany([h])}deleteMany(h){h.forEach(j=>this.index.delete(this.getKey(j))),this._pristine=!1,this.next()}generateIndex(h){const j=h.map(x=>[this.getKey(x),x]);return new Map(j)}next(){this.entities$.next(Array.from(this.index.values())),this.updateCount()}updateCount(){const h=this.index.size,j=0===h;this.count$.next(h),this.empty$.next(j)}createStateManager(){return new d.E({getKey:this.getKey,index:this.index})}createDataView(){return new g.u(this.entities$)}createStateView(){return new g.u(this.view.all$()).join({source:this.state.change$,reduce:h=>{const j=this.getKey(h),x=this.state.get(h),w=this.stateView.get(j);if(void 0!==w&&w.entity===h&&this.statesAreTheSame(w.state,x))return w;const b=w?w.revision+1:1;return{entity:h,state:x,revision:b,ref:`${j}-${b}`}}}).createIndex(h=>this.getKey(h.entity))}statesAreTheSame(h,j){if(h===j)return!0;const x=0===Object.keys(h).length,w=0===Object.keys(j).length;return x&&w}}},27060:(Ee,ce,s)=>{"use strict";s.d(ce,{u:()=>h});var y=s(64002),e=s(54844),d=s(35876),g=s(40604),R=s(68013),o=s(24112);class h{source$;values$=new e.g([]);values$$;lifted=!1;joins=[];filter$=new e.g(void 0);filters$=new e.g([]);filterIndex=new Map;sort$=new e.g(void 0);get getKey(){return this.getKey$.value}getKey$=new e.g(void 0);count$=new e.g(0);get count(){return this.count$.value}empty$=new e.g(!0);get empty(){return this.empty$.value}get index(){return this._index}_index;constructor(x){this.source$=x}get(x){if(void 0===this._index)throw new Error("This view has no index, therefore, this method is unavailable.");return this.index.get(x)}all(){return this.values$.value}all$(){return this.values$}firstBy(x){return this.values$.value.find(x)}firstBy$(x){return this.values$.pipe((0,g.k)(w=>w.find(x)))}manyBy(x){return this.values$.value.filter(x)}manyBy$(x){return this.values$.pipe((0,g.k)(w=>w.filter(x)))}clear(){this.filter(void 0),this.sort(void 0)}destroy(){void 0!==this.values$$&&this.values$$.unsubscribe(),this.clear()}createIndex(x){return this._index=new Map,this.getKey$.next(x),this}join(x){if(!0===this.lifted)throw new Error("This view has already been lifted, therefore, no join is allowed.");return this.joins.push(x),this}filter(x){return this.filter$.next(x),this}addFilter(x){const w=(0,y.uq)();return this.filterIndex.set(w,x),this.filters$.next(Array.from(this.filterIndex.values())),w}removeFilter(x){this.filterIndex.delete(x),this.filters$.next(Array.from(this.filterIndex.values()))}sort(x){return this.sort$.next(x),this}lift(){this.lifted=!0;const w=[this.joins.length>0?this.liftJoinedSource():this.liftSource(),this.filters$,this.filter$,this.sort$,this.getKey$];this.values$$=(0,d.E)(w).pipe((0,R.s)(1),(0,o.o)(5)).subscribe(b=>{const[E,T,a,K,M]=b,L=this.processValues(E,T,a,K);this.setValues(L,void 0!==M)})}liftSource(){return this.source$}liftJoinedSource(){const x=[this.source$,(0,d.E)(this.joins.map(w=>w.source))];return(0,d.E)(x).pipe((0,g.k)(w=>{const[b,E]=w;return b.reduce((T,a)=>{const K=this.computeJoinedValue(a,E);return void 0!==K&&T.push(K),T},[])}))}computeJoinedValue(x,w){let b=x,E=0;for(;void 0!==b&&E<this.joins.length;)b=this.joins[E].reduce(b,w[E]),E+=1;return b}processValues(x,w,b,E){return x=x.slice(0),x=this.filterValues(x,w.concat([b])),this.sortValues(x,E)}filterValues(x,w){return 0===w.length?x:x.filter(b=>w.filter(E=>void 0!==E).every(E=>E(b)))}sortValues(x,w){return void 0===w?x:x.sort((b,E)=>y.Yv.naturalCompare(w.valueAccessor(b),w.valueAccessor(E),w.direction,w.nullsFirst))}setValues(x,w){!0===w&&(this._index=this.generateIndex(x)),this.values$.next(x);const b=x.length,E=0===b;this.count$.next(b),this.empty$.next(E)}generateIndex(x){const w=x.map(b=>[this.getKey(b),b]);return new Map(w)}}},87556:(Ee,ce,s)=>{"use strict";s.d(ce,{Y:()=>d});var y=s(64002),e=s(68013);class d{cdRef;store;innerStateIndex=new Map;entities$$;state$$;constructor(R,o){this.setChangeDetector(o),this.setStore(R)}destroy(){this.setChangeDetector(void 0),this.setStore(void 0)}setStore(R){if(void 0===R)return this.teardownObservers(),this.innerStateIndex.clear(),void(this.store=void 0);this.setStore(void 0),this.store=R,this.setupObservers(),this.detectChanges()}setChangeDetector(R){this.cdRef=R}setupObservers(){this.teardownObservers(),this.entities$$=this.store.entities$.subscribe(R=>this.onEntitiesChange(R)),this.state$$=this.store.state.change$.pipe((0,e.s)(1)).subscribe(()=>this.onStateChange())}teardownObservers(){void 0!==this.entities$$&&this.entities$$.unsubscribe(),void 0!==this.state$$&&this.state$$.unsubscribe(),this.entities$$=void 0,this.state$$=void 0}onEntitiesChange(R){this.detectChanges()}onStateChange(){let R=!1;const o=this.store.state.index,h=this.innerStateIndex;o.size!==h.size&&(R=this.detectChanges());const j=Array.from(o.keys());for(const x of j){const w=o.get(x),b=h.get(x);!1===R&&(void 0===b?R=this.detectChanges():y.Yv.objectsAreEquivalent(w,b)||(R=this.detectChanges())),this.innerStateIndex.set(x,Object.assign({},w))}}detectChanges(){return void 0!==this.cdRef&&this.cdRef.detectChanges(),!0}}},58136:(Ee,ce,s)=>{"use strict";s.d(ce,{_:()=>h});var y=s(65056),e=s(6316),d=s(25812),g=s(34896),R=s(69368);function o(j,x){if(1&j&&(g.SAx(0),g.wR5(1,"igo-dynamic-outlet",1),g.k70()),2&j){const w=g.GaO();g.yG2(),g.E7m("component",w.getFieldComponent())("inputs",w.getFieldInputs())("subscribers",w.getFieldSubscribers())}}let h=(()=>{class j{formFieldService;field;fieldInputs=void 0;fieldSubscribers=void 0;get fieldOptions(){return this.field.options||{}}constructor(w){this.formFieldService=w}getFieldComponent(){return this.formFieldService.getFieldByType(this.field.type||"text")}getFieldInputs(){if(void 0!==this.fieldInputs)return this.fieldInputs;const w=this.fieldOptions.errors||{};return this.fieldInputs=Object.assign({placeholder:this.field.title,disableSwitch:this.fieldOptions.disableSwitch||!1},Object.assign({},this.field.inputs||{}),{formControl:this.field.control,errors:Object.assign({},(0,d.uu)(),w)}),this.fieldInputs}getFieldSubscribers(){return void 0!==this.fieldSubscribers||(this.fieldSubscribers=Object.assign({},this.field.subscribers||{})),this.fieldSubscribers}static \u0275fac=function(b){return new(b||j)(g.GI1(R.Q))};static \u0275cmp=g.In1({type:j,selectors:[["igo-form-field"]],inputs:{field:"field"},standalone:!0,features:[g.UHJ],decls:1,vars:1,consts:[[4,"ngIf"],[3,"component","inputs","subscribers"]],template:function(b,E){1&b&&g.yuY(0,o,2,3,"ng-container",0),2&b&&g.E7m("ngIf",void 0!==E.field)},dependencies:[y.u_,e.q],styles:["mat-form-field{width:100%}  .igo-form-disable-switch{margin-right:8px}"],changeDetection:0})}return j})()},87004:(Ee,ce,s)=>{"use strict";s.d(ce,{Y:()=>w});var y=s(65056),e=s(34896),d=s(71904),g=s(63596),R=s(25812);const o=["buttons"],h=["*",[["","formButtons",""]]],j=b=>({"igo-form-body-with-buttons":b}),x=["*","[formButtons]"];let w=(()=>{class b{form;formData;autocomplete="off";submitForm=new e._w7;buttons;get hasButtons(){return 0!==this.buttons.nativeElement.children.length}constructor(){}ngOnChanges(T){const a=T.formData;a&&a.currentValue!==a.previousValue&&(void 0===a.currentValue?this.clear():this.setData(a.currentValue))}onSubmit(){this.submitForm.emit(this.getData())}getData(){const T={};return(0,R.aC)(this.form).forEach(a=>{this.updateDataWithFormField(T,a)}),T}setData(T){this.form.fields.forEach(a=>{a.control.setValue((0,g.t)(T,a.name).safeObject)}),this.form.groups.forEach(a=>{a.fields.forEach(K=>{K.control.setValue((0,g.t)(T,K.name).safeObject)})})}updateDataWithFormField(T,a){const K=a.control;K.disabled||(T[a.name]=K.value)}clear(){this.form.control.reset()}static \u0275fac=function(a){return new(a||b)};static \u0275cmp=e.In1({type:b,selectors:[["igo-form"]],viewQuery:function(a,K){if(1&a&&e.CC$(o,7),2&a){let M;e.wto(M=e.Gqi())&&(K.buttons=M.first)}},inputs:{form:"form",formData:"formData",autocomplete:"autocomplete"},outputs:{submitForm:"submitForm"},standalone:!0,features:[e.SYr,e.UHJ],ngContentSelectors:x,decls:7,vars:5,consts:[[3,"autocomplete","formGroup","ngSubmit"],[1,"igo-form-body",3,"ngClass"],[1,"igo-form-content"],[1,"igo-form-buttons"],["buttons",""]],template:function(a,K){1&a&&(e.kPM(h),e.I0R(0,"form",0),e.qCj("ngSubmit",function(){return K.onSubmit()}),e.I0R(1,"div",1)(2,"div",2),e._Xx(3),e.C$Y(),e.I0R(4,"div",3,4),e._Xx(6,1),e.C$Y()()()),2&a&&(e.E7m("autocomplete",K.autocomplete)("formGroup",K.form.control),e.yG2(),e.E7m("ngClass",e.S45(3,j,K.hasButtons)))},dependencies:[d.y,d.sz,d.u,d.sl,d.uW,y.QF],styles:["[_nghost-%COMP%]{display:block}form[_ngcontent-%COMP%]{width:100%;height:100%}.igo-form-body[_ngcontent-%COMP%], .igo-form-content[_ngcontent-%COMP%]{height:100%}.igo-form-body-with-buttons[_ngcontent-%COMP%]   .igo-form-content[_ngcontent-%COMP%]{height:calc(100% - 56px)}.igo-form-content[_ngcontent-%COMP%]{display:flex}"],changeDetection:0})}return b})()},69368:(Ee,ce,s)=>{"use strict";s.d(ce,{Q:()=>e});var y=s(34896);let e=(()=>{class d{static fields={};static register(R,o){d.fields[R]=o}constructor(){}getFieldByType(R){return d.fields[R]}static \u0275fac=function(o){return new(o||d)};static \u0275prov=y.wxM({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})()},25812:(Ee,ce,s)=>{"use strict";function y(o){if(o.validator){const h=o.validator({});if(h&&h.required)return!0}return!!o.controls&&void 0!==Object.keys(o.controls).find(j=>y(o.controls[j]))}function e(){return{required:"igo.common.form.errors.required",email:"igo.common.form.errors.email"}}function d(o,h){const w=Object.keys(o.errors||{}).map(b=>h[b]).filter(b=>void 0!==b);return w.length>0?w[0]:""}function g(o){return o.groups.reduce((h,j)=>h.concat(j.fields),[].concat(o.fields))}s.d(ce,{KW:()=>d,aC:()=>g,qs:()=>y,uu:()=>e})},19644:(Ee,ce,s)=>{"use strict";s.d(ce,{M:()=>e});var y=s(34896);let e=(()=>{class d{el;errorImageUrl="./assets/igo2/common/images/na.png";hideError=!1;constructor(R){this.el=R}onError(R){this.hideError?this.el.nativeElement.style.display="none":R.target.src=this.errorImageUrl}static \u0275fac=function(o){return new(o||d)(y.GI1(y.GMv))};static \u0275dir=y.Sc5({type:d,selectors:[["","igoImageError",""]],hostBindings:function(o,h){1&o&&y.qCj("error",function(x){return h.onError(x)})},inputs:{errorImageUrl:"errorImageUrl",hideError:"hideError"},standalone:!0})}return d})()},696:(Ee,ce,s)=>{"use strict";s.d(ce,{k:()=>x});var y=s(21124),e=s(33712),d=s(83600),g=s(21296),R=s(51672),o=s(19432),h=s(90916),j=s(34896);class x{http;configService;constructor(b,E){this.http=b,this.configService=E}transform(b){const E=new e.UD({"Content-Type":"text/plain",activityInterceptor:"false",interceptError:"false"}),T=new RegExp(this.configService?.getConfig("depot.url")+'.*?(?="|$)');return T.test(b)&&(b=b.match(T)[0]),this.http.get(b,{headers:E,responseType:"blob"}).pipe((0,R.a)(a=>{throw a.error.caught=!0,a.error.toDisplay=!1,a}),(0,o.G)(a=>new g._(K=>{const M=new FileReader;M.readAsDataURL(a),M.onloadend=()=>{K.next(M.result),K.complete()}})))}static \u0275fac=function(E){return new(E||x)(j.GI1(e.KK,16),j.GI1(d.aW,16))};static \u0275pipe=j.UTH({name:"secureImage",type:x,pure:!0,standalone:!0})}(0,y.UN)([(0,h.w)({maxCacheCount:20}),(0,y.YR)("design:type",Function),(0,y.YR)("design:paramtypes",[String]),(0,y.YR)("design:returntype",g._)],x.prototype,"transform",null)},880:(Ee,ce,s)=>{"use strict";s.d(ce,{E:()=>T});var y=s(65056),e=s(34672),d=s(32328),g=s(27e3),R=s(72584),o=s(1296),h=s(97780),j=s(26496),x=s(34896);function w(a,K){if(1&a){const M=x.KQA();x.I0R(0,"button",3),x.qCj("click",function(){x.usT(M);const oe=x.GaO(2);return x.CGJ(oe.startInteractiveTour())}),x.wVc(1,"translate"),x.wVc(2,"translate"),x.wR5(3,"mat-icon",4),x.C$Y()}if(2&a){const M=x.GaO(2);x.E7m("ngClass",M.getClass())("matTooltip",M.disabledTourButton?x.kDX(1,3,"igo.common.interactiveTour.disaledTooltipTourToolButton"):x.kDX(2,5,"igo.common.interactiveTour.tooltipTourToolButton"))("disabled",M.disabledTourButton)}}function b(a,K){if(1&a){const M=x.KQA();x.I0R(0,"button",5),x.qCj("click",function(){x.usT(M);const oe=x.GaO(2);return x.CGJ(oe.startInteractiveTour())}),x.OEk(1),x.wVc(2,"translate"),x.wVc(3,"translate"),x.wVc(4,"async"),x.wR5(5,"mat-icon",6),x.wVc(6,"translate"),x.wVc(7,"translate"),x.C$Y()}if(2&a){const M=x.GaO(2);x.E7m("ngClass",M.getClass())("disabled",M.disabledTourButton),x.yG2(),x.CAO(" ",x.kDX(2,5,"igo.common.interactiveTour.buttonTitle")," ",x.kDX(3,7,x.kDX(4,9,M.discoverTitleInLocale$))," "),x.yG2(4),x.E7m("matTooltip",M.disabledTourButton?x.kDX(6,11,"igo.common.interactiveTour.disaledTooltipTourToolButton"):x.kDX(7,13,"igo.common.interactiveTour.tooltipTourToolButton"))}}function E(a,K){if(1&a&&(x.SAx(0),x.yuY(1,w,4,7,"button",1)(2,b,8,15,"ng-template",null,2,x.gJz),x.k70()),2&a){const M=x.Gew(3),L=x.GaO();x.yG2(),x.E7m("ngIf","icon"===L.styleButton)("ngIfElse",M)}}let T=(()=>{class a{interactiveTourService;toolService;tourToStart="";styleButton;discoverTitleInLocale$=(0,o.of)("IGO");getClass(){return{"tour-button-tool-icon":"icon"===this.styleButton,"tour-button-tool":"raised"===this.styleButton}}get toolbox(){return this.toolService.toolbox}getTourToStart(){return this.tourToStart?this.tourToStart:this.activeToolName}get activeToolName(){if(this.toolbox)return this.isActiveTool?this.toolbox.activeTool$.getValue().name:"global"}get isActiveTool(){if(this.toolbox)return void 0!==this.toolbox.activeTool$.getValue()}get isToolHaveTour(){return!("about"===this.activeToolName&&!this.tourToStart)&&this.interactiveTourService.isToolHaveTourConfig(this.getTourToStart())}get showTourButton(){let M,L;return M=this.isToolHaveTour,!1!==M&&!(this.interactiveTourService.isMobile()&&(L=this.isTourDisplayInMobile,!1===L))}get isTourDisplayInMobile(){return this.interactiveTourService.isTourDisplayInMobile()}get disabledTourButton(){return this.interactiveTourService.disabledTourButton(this.activeToolName)}constructor(M,L){this.interactiveTourService=M,this.toolService=L}startInteractiveTour(){const M=this.getTourToStart();M&&this.interactiveTourService.startTour(M)}static \u0275fac=function(L){return new(L||a)(x.GI1(j.I),x.GI1(h.I))};static \u0275cmp=x.In1({type:a,selectors:[["igo-interactive-tour"]],inputs:{tourToStart:"tourToStart",styleButton:"styleButton",discoverTitleInLocale$:"discoverTitleInLocale$"},standalone:!0,features:[x.UHJ],decls:1,vars:1,consts:[[4,"ngIf"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","matTooltip","disabled","click",4,"ngIf","ngIfElse"],["raisedButton",""],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","matTooltip","disabled","click"],["iconPositionEnd","","svgIcon","presentation-play"],["color","primary","mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","disabled","click"],["iconPositionEnd","","svgIcon","presentation-play",3,"matTooltip"]],template:function(L,oe){1&L&&x.yuY(0,E,4,2,"ng-container",0),2&L&&x.E7m("ngIf",oe.showTourButton)},dependencies:[y.u_,e.oJ,e.Gw,e.um,y.QF,g.KO,g.a4,d.oB,d.qL,y.a,R.O0,R.sD],styles:["igo-interactive-tour>button.mat-mdc-raised-button.tour-button-tool-icon{box-shadow:none}.shepherd-has-title .shepherd-content .shepherd-header{padding:.5em .75em}.shepherd-title{margin:0!important;font-weight:revert!important}.shepherd-progress{margin-right:15px;color:#737373}.shepherd-text{font-size:14px!important}.shepherd-element{border:1px solid;border-color:#474747;box-shadow:4px 5px #65656599}\n"],encapsulation:2})}return a})()},15e3:(Ee,ce,s)=>{"use strict";s.d(ce,{C:()=>R});var y=s(83600),e=s(51672),d=s(34896),g=s(33712);let R=(()=>{class o{http;configService;jsonURL;allToursOptions;constructor(j,x){this.http=j,this.configService=x,this.jsonURL=this.getPathToConfigFile()}loadConfigTour(){this.getJSON().subscribe(j=>{this.allToursOptions=j},j=>{throw new Error("Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.")})}getPathToConfigFile(){return this.configService.getConfig("interactiveTour.pathToConfigFile")||"./config/interactiveTour.json"}getJSON(){return this.http.get(this.jsonURL).pipe((0,e.a)(j=>{throw j.error.caught=!0,j}))}getTourOptionData(j){if(void 0===this.allToursOptions)return;let x=j;return x=x.replace(/\s/g,""),this.allToursOptions[x]}static \u0275fac=function(x){return new(x||o)(d.CoB(g.KK),d.CoB(y.aW))};static \u0275prov=d.wxM({token:o,factory:o.\u0275fac})}return o})()},26496:(Ee,ce,s)=>{"use strict";s.d(ce,{I:()=>x});var y=s(83600),e=s(24708),d=s(9588),g=s(16548),R=s(91112),o=s(15e3),h=s(34896),j=s(44668);let x=(()=>{class w{configService;mediaService;languageService;interactiveTourLoader;shepherdService;previousStep;nextIndex=1;constructor(E,T,a,K,M){this.configService=E,this.mediaService=T,this.languageService=a,this.interactiveTourLoader=K,this.shepherdService=M,this.isAppHaveTour()&&this.interactiveTourLoader.loadConfigTour()}isAppHaveTour(){const E=this.configService.getConfig("interactiveTour.activateInteractiveTour");return void 0===E||E}isToolHaveTourConfig(E){return void 0!==this.interactiveTourLoader.getTourOptionData(E)}disabledTourButton(E){const T=this.interactiveTourLoader.getTourOptionData(E);if(T?.conditions)for(const a of T?.conditions)if(null===document.querySelector(a))return!0;return!1}isMobile(){return this.mediaService.isMobile()}isTourDisplayInMobile(){const E=this.configService.getConfig("interactiveTour.tourInMobile");return void 0===E||E}getButtons(E){return"noBackButton"===E?[{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]:"first"===E?[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.exitButton"),type:"cancel"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]:"last"===E?[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.backButton"),type:"back"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.exitButton"),type:"cancel"}]:[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.backButton"),type:"back"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]}getAction(E){return{click:"click"}[E.toLowerCase()]}addProgress(){const E=this;let T=0;const K=setInterval(()=>{if(E.getCurrentStep()){if(E.getCurrentStep().options.attachTo.element&&!document.querySelector(E.getCurrentStep().options.attachTo.element))return E.cancel(),void clearInterval(K);{const M=E.getCurrentStep().getElement();M&&M.querySelectorAll(".shepherd-content, .shepherd-text").forEach(N=>{N.classList.add("mat-typography")});const L=M?M.querySelector(".shepherd-header"):void 0;if(T++,(L||T>21)&&clearInterval(K),L){const oe=E.steps,N=document.createElement("span");N.className="shepherd-progress",N.innerText=`${oe.indexOf(E.getCurrentStep())+1}/${oe.length}`,L.insertBefore(N,M.querySelector(".shepherd-cancel-icon"))}}}},100)}checkNext(E,T,a){if(T.getCurrentStep()){if(T.getCurrentStep().options.attachTo.element&&document.querySelector(T.getCurrentStep().options.attachTo.element))return void T.complete();if(E.index===T.steps.length-1)return void T.complete();T.steps.splice(E.index,1);const K=T.steps[E.index];K.options.attachTo.element&&!document.querySelector(K.options.attachTo.element)?a.checkNext(E,T,a):(T._setupModal(),T.show(K.id))}}executeAction(E,T){if(!T||T.condition&&("!"===T.condition.charAt(0)&&document.querySelector(T.condition.slice(1))||"!"!==T.condition.charAt(0)&&!document.querySelector(T.condition)))return;const a=document.querySelector(T.element||E.element),K=this.getAction(T.action);a&&K&&a[K]()}executeActionPromise(E,T){return new Promise(a=>{if(this.executeAction(E,T),!T||!T.waitFor)return void a();let K=0;const M=T.maxWait?T.maxWait/100:20,L=setInterval(()=>{K++,(K>M||document.querySelector(T.waitFor))&&(clearInterval(L),a())},100)})}getShepherdSteps(E){const T=[];let a=0;for(const K of E.steps){const M=K.position??E.position;T.push({attachTo:{element:K.element,on:M},floatingUIOptions:{middleware:["auto"===M&&(0,g.EX)(),(0,R.E3)({mainAxis:15})].filter(Boolean)},beforeShowPromise:()=>Promise.all([this.executeActionPromise(this.previousStep,this.previousStep?this.previousStep.beforeChange:void 0),this.executeActionPromise(K,K.beforeShow)]),buttons:this.getButtons(0===a?"first":a+1===E.steps.length?"last":E.steps[a].noBackButton?"noBackButton":void 0),classes:K.class,highlightClass:K.highlightClass,scrollTo:K.scrollToElement||E.scrollToElement||!0,canClickTarget:K.disableInteraction?!K.disableInteraction:void 0,title:this.languageService.translate.instant(K.title||E.title),text:[this.languageService.translate.instant(K.text)],when:{show:()=>{this.executeAction(K,K.onShow)},hide:()=>{this.previousStep=K,this.executeAction(K,K.onHide)}}}),a++}return T}startTour(E){const T=this.interactiveTourLoader.getTourOptionData(E);this.shepherdService.defaultStepOptions={classes:T.class,highlightClass:T.highlightClass,canClickTarget:!T.disableInteraction||!T.disableInteraction,cancelIcon:{enabled:!0}};const a=this.getShepherdSteps(T);this.shepherdService.modal=!0,this.shepherdService.confirmCancel=!1,this.shepherdService.addSteps(a),this.shepherdService.tourObject.on("show",this.addProgress),this.shepherdService.tourObject.on("cancel",K=>{this.checkNext(K,this.shepherdService.tourObject,this)}),this.shepherdService.start()}static \u0275fac=function(T){return new(T||w)(h.CoB(y.aW),h.CoB(d.QB),h.CoB(e.ov),h.CoB(o.C),h.CoB(j.c))};static \u0275prov=h.wxM({token:w,factory:w.\u0275fac,providedIn:"root"})}return w})()},64080:(Ee,ce,s)=>{"use strict";s.d(ce,{H:()=>y});var y=function(e){return e.Radio="radio",e.Checkbox="checkbox",e}(y||{})},24100:(Ee,ce,s)=>{"use strict";s.d(ce,{m:()=>e});var y=s(34896);let e=(()=>{class d{onClick(R){R.stopPropagation()}static \u0275fac=function(o){return new(o||d)};static \u0275dir=y.Sc5({type:d,selectors:[["","igoStopPropagation",""]],hostBindings:function(o,h){1&o&&y.qCj("click",function(x){return h.onClick(x)})},standalone:!0})}return d})()},97780:(Ee,ce,s)=>{"use strict";s.d(ce,{I:()=>d});var y=s(10988),e=s(34896);let d=(()=>{class g{static tools={};toolbox=new y.E;static register(o){g.tools[o.name]=o}constructor(){this.toolbox.setTools(this.getTools())}getTool(o){return g.tools[o]}getTools(){return Object.values(g.tools)}static \u0275fac=function(h){return new(h||g)};static \u0275prov=e.wxM({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})()},10988:(Ee,ce,s)=>{"use strict";s.d(ce,{E:()=>d});var y=s(54844),e=s(68488);class d{options;activeTool$=new y.g(void 0);toolbar$=new y.g([]);activeTool$$;activeToolHistory=[];store=new e.qc([],{getKey:R=>R.name});get tools$(){return this.store.entities$}constructor(R={}){this.options=R,this.setToolbar(R.toolbar),this.initStore()}destroy(){this.activeTool$$.unsubscribe(),this.store.destroy()}getTool(R){return this.store.get(R)}getTools(){return this.store.all()}setTools(R){this.store.load(R)}getToolbar(){return this.toolbar$.getValue()}setToolbar(R){this.toolbar$.next(R||[])}activateTool(R,o={}){const h=this.getTool(R);void 0!==h&&this.store.state.update(h,{active:!0,options:o},!0)}activatePreviousTool(){if(this.activeToolHistory.length<=1)return void this.deactivateTool();const[R,o]=this.activeToolHistory.splice(-2,2);this.activateTool(R)}deactivateTool(){this.clearActiveToolHistory(),this.store.state.updateAll({active:!1})}initStore(){this.store=new e.qc([],{getKey:R=>R.name}),this.activeTool$$=this.store.stateView.firstBy$(R=>!0===R.state.active).subscribe(R=>{if(void 0===R)return void this.setActiveTool(void 0);const o=R.entity,h=Object.assign({},o.options||{},R.state.options||{});this.setActiveTool(Object.assign({},o,{options:h}))})}setActiveTool(R){this.activeTool$.next(R),void 0===R?this.clearActiveToolHistory():this.activeToolHistory=this.activeToolHistory.filter(o=>o!==R.name).concat([R.name])}clearActiveToolHistory(){this.activeToolHistory=[]}}},26431:(Ee,ce,s)=>{"use strict";s.d(ce,{A:()=>o});var y=s(65056),e=s(34896),g=(s(77020),s(6316));function R(h,j){if(1&h&&e.wR5(0,"igo-dynamic-outlet",1),2&h){const x=e.GaO();e.E7m("component",x.widget)("inputs",x.inputs)("subscribers",x.getEffectiveSubscribers())}}let o=(()=>{class h{baseSubscribers={cancel:x=>this.onCancel(x),complete:x=>this.onComplete(x)};widget;inputs;subscribers={};complete=new e._w7;cancel=new e._w7;constructor(){}ngOnDestroy(){this.destroyWidget()}getEffectiveSubscribers(){const x=Object.assign({},this.subscribers);return Object.keys(this.baseSubscribers).forEach(w=>{const b=x[w],E=this.baseSubscribers[w];x[w]=void 0!==b?T=>{b(T),E(T)}:E}),x}onCancel(x){this.cancel.emit(x),this.destroyWidget()}onComplete(x){this.complete.emit(x),this.destroyWidget()}destroyWidget(){void 0!==this.widget&&this.widget.destroy(),this.widget=void 0}static \u0275fac=function(w){return new(w||h)};static \u0275cmp=e.In1({type:h,selectors:[["igo-widget-outlet"]],inputs:{widget:"widget",inputs:"inputs",subscribers:"subscribers"},outputs:{complete:"complete",cancel:"cancel"},standalone:!0,features:[e.UHJ],decls:1,vars:1,consts:[[3,"component","inputs","subscribers",4,"ngIf"],[3,"component","inputs","subscribers"]],template:function(w,b){1&w&&e.yuY(0,R,1,3,"igo-dynamic-outlet",0),2&w&&e.E7m("ngIf",b.widget)},dependencies:[y.u_,g.q],styles:["[_nghost-%COMP%]   igo-dynamic-outlet[_ngcontent-%COMP%]{height:100%}"],changeDetection:0})}return h})()},62228:(Ee,ce,s)=>{"use strict";s.d(ce,{MF:()=>T,AI:()=>F,m0:()=>E,mK:()=>fi,ii:()=>Ti,Q9:()=>ge,Ex:()=>ht,L0:()=>xi,YM:()=>je,Mx:()=>f,Qo:()=>H,qm:()=>Z.qm,sh:()=>b.sh,qc:()=>b.qc,qq:()=>b.qq,xx:()=>b.xx,uk:()=>b.uk,YX:()=>b.YX,G8:()=>b.G8,Eh:()=>b.Eh,I7:()=>b.I7,qK:()=>b.qK,Kg:()=>gt,Yl:()=>St.Y,AB:()=>it,O8:()=>ze,eO:()=>Dt,qS:()=>Yn,uK:()=>rt,OE:()=>Ri,wr:()=>Lo,bQ:()=>Zt,YN:()=>bi,Gq:()=>Eo,Se:()=>Bn,iA:()=>ii,MJ:()=>kt.M,Er:()=>Ut.E,In:()=>Lt.I,gl:()=>Li,yM:()=>_i,qU:()=>Xt,SM:()=>Hi,cP:()=>Xi,Ux:()=>dt.U,kd:()=>Pt.k,hj:()=>Vo,is:()=>qo,mw:()=>$o.m,ys:()=>ki,oz:()=>dn,Iv:()=>lo,aA:()=>In,IF:()=>hi.I,Eb:()=>wi.E,cT:()=>yn,cx:()=>Oi,ec:()=>ir,uF:()=>Ii,cr:()=>Un,Qv:()=>vo,sH:()=>b.sH,_I:()=>b._I,u6:()=>b.u6,mU:()=>b.mU,YB:()=>b.YB,E$:()=>b.E$});var y=s(65056),e=s(34672),d=s(48512),g=s(32328),R=s(63916),o=s(87848),h=s(27e3),j=s(9588),x=s(72584),w=s(54844),b=s(68488),E=function(ee){return ee.Dock="dock",ee.Overlay="overlay",ee.Context="context",ee}(E||{});class T extends b.qc{}var a=s(34896),K=s(58539),M=s(88404);function L(ee,De){if(1&ee&&(a.wR5(0,"mat-icon",7),a.wVc(1,"async")),2&ee){const D=a.GaO(3);a._6D("svgIcon",a.kDX(1,1,D.icon$))}}function oe(ee,De){if(1&ee&&(a.I0R(0,"button",5),a.wVc(1,"async"),a.yuY(2,L,2,3,"mat-icon",6),a.C$Y()),2&ee){const D=a.GaO(2);a.E7m("color",D.color)("disabled",a.kDX(1,4,D.disabled$))("disableRipple",!0),a.yG2(2),a.E7m("ngIf",D.withIcon)}}function N(ee,De){if(1&ee&&(a.I0R(0,"span",8),a.OEk(1),a.wVc(2,"translate"),a.C$Y()),2&ee){const D=a.GaO(2);a.yG2(),a.cNF(a.kDX(2,1,D.title))}}function B(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"mat-list-item",2),a.qCj("click",function(){a.usT(D);const me=a.GaO();return a.CGJ(me.onClick())}),a.wVc(1,"translate"),a.wVc(2,"async"),a.wVc(3,"async"),a.yuY(4,oe,3,6,"button",3)(5,N,3,3,"span",4),a.C$Y()}if(2&ee){const D=a.GaO();a.E7m("matTooltip",D.withTooltip?a.kDX(1,4,a.kDX(2,6,D.tooltip$)||D.title):"")("ngClass",a.kDX(3,8,D.ngClass$)),a.yG2(4),a.E7m("ngIf",D.withIcon),a.yG2(),a.E7m("ngIf",D.withTitle)}}function X(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"mat-checkbox",11),a.qCj("change",function(){a.usT(D);const me=a.GaO(2);return a.CGJ(me.action.handler())}),a.wVc(1,"async"),a.OEk(2),a.wVc(3,"translate"),a.C$Y()}if(2&ee){const D=a.GaO(2);a.E7m("checked",a.kDX(1,2,D.checkCondition$)),a.yG2(2),a.oRS(" ",a.kDX(3,4,D.title)," ")}}function V(ee,De){if(1&ee&&(a.I0R(0,"mat-list-item",9),a.wVc(1,"translate"),a.wVc(2,"async"),a.wVc(3,"async"),a.yuY(4,X,4,6,"mat-checkbox",10),a.C$Y()),2&ee){const D=a.GaO();a.E7m("matTooltip",D.withTooltip?a.kDX(1,3,a.kDX(2,5,D.tooltip$)||D.title):"")("ngClass",a.kDX(3,7,D.ngClass$)),a.yG2(4),a.E7m("ngIf",D.withTitle)}}let z=(()=>{class ee{disabled$=new w.g(!1);checkCondition$=new w.g(void 0);icon$=new w.g(void 0);tooltip$=new w.g(void 0);noDisplay$=new w.g(!1);ngClass$=new w.g({});ngClass$$;disabled$$;availability$$;icon$$;checkCondition$$;tooltip$$;noDisplay$$;display$$;action;color="default";withTitle=!0;withIcon=!0;withTooltip=!0;set disabled(D){this.disabled$.next(D)}get disabled(){return this.disabled$.value}set noDisplay(D){this.noDisplay$.next(D)}get noDisplay(){return this.noDisplay$.value}trigger=new a._w7;get title(){return this.action.title}constructor(){}ngOnInit(){const D=this.action.args||[];void 0!==this.action.ngClass&&(this.ngClass$$=this.action.ngClass(...D).subscribe(te=>this.updateNgClass(te))),(0,M.X)(this.action.icon)?this.icon$$=this.action.icon.subscribe(te=>this.updateIcon(te)):this.updateIcon(this.action.icon),(0,M.X)(this.action.checkCondition)?this.checkCondition$$=this.action.checkCondition.subscribe(te=>this.updateCheckCondition(te)):this.updateCheckCondition(this.action.checkCondition),(0,M.X)(this.action.tooltip)?this.tooltip$$=this.action.tooltip.subscribe(te=>this.updateTooltip(te)):this.updateTooltip(this.action.tooltip),void 0!==this.action.availability&&(this.availability$$=this.action.availability(...D).subscribe(te=>this.disabled=!te)),this.disabled$$=this.disabled$.subscribe(te=>this.updateNgClass({"igo-actionbar-item-disabled":te})),void 0!==this.action.display&&(this.display$$=this.action.display(...D).subscribe(te=>this.noDisplay=!te)),this.noDisplay$$=this.noDisplay$.subscribe(te=>this.updateNgClass({"igo-actionbar-item-no-display":te}))}ngOnDestroy(){void 0!==this.ngClass$$&&(this.ngClass$$.unsubscribe(),this.ngClass$$=void 0),void 0!==this.availability$$&&(this.availability$$.unsubscribe(),this.availability$$=void 0),void 0!==this.display$$&&(this.display$$.unsubscribe(),this.display$$=void 0),void 0!==this.checkCondition$$&&(this.checkCondition$$.unsubscribe(),this.checkCondition$$=void 0),void 0!==this.icon$$&&(this.icon$$.unsubscribe(),this.icon$$=void 0),void 0!==this.tooltip$$&&(this.tooltip$$.unsubscribe(),this.tooltip$$=void 0),this.disabled$$.unsubscribe(),this.noDisplay$$.unsubscribe()}onClick(){!0!==this.disabled&&this.trigger.emit(this.action)}updateNgClass(D){this.ngClass$.next(Object.assign({},this.ngClass$.value,D))}updateTooltip(D){this.tooltip$.next(D)}updateCheckCondition(D){this.checkCondition$.next(D)}updateIcon(D){this.icon$.next(D)}static \u0275fac=function(te){return new(te||ee)};static \u0275cmp=a.In1({type:ee,selectors:[["igo-actionbar-item"]],inputs:{action:"action",color:"color",withTitle:"withTitle",withIcon:"withIcon",withTooltip:"withTooltip",disabled:"disabled",noDisplay:"noDisplay"},outputs:{trigger:"trigger"},standalone:!0,features:[a.UHJ],decls:2,vars:2,consts:[["class","actionbar-item","matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",3,"matTooltip","ngClass","click",4,"ngIf"],["class","item-checkbox","matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",3,"matTooltip","ngClass",4,"ngIf"],["matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",1,"actionbar-item",3,"matTooltip","ngClass","click"],["matListItemAvatar","","mat-icon-button","",3,"color","disabled","disableRipple",4,"ngIf"],["matLine","",4,"ngIf"],["matListItemAvatar","","mat-icon-button","",3,"color","disabled","disableRipple"],[3,"svgIcon",4,"ngIf"],[3,"svgIcon"],["matLine",""],["matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",1,"item-checkbox",3,"matTooltip","ngClass"],[3,"checked","change",4,"ngIf"],[3,"checked","change"]],template:function(te,me){1&te&&a.yuY(0,B,6,10,"mat-list-item",0)(1,V,5,9,"mat-list-item",1),2&te&&(a.E7m("ngIf",!me.action.checkbox),a.yG2(),a.E7m("ngIf",me.action.checkbox))},dependencies:[y.u_,R.iI,R.g9,R.EV,h.KO,h.a4,y.QF,e.oJ,e.um,g.oB,g.qL,K.Vn,K.WK,y.a,x.O0,x.sD],styles:["[_nghost-%COMP%]     mat-list-item:hover{cursor:pointer}[_nghost-%COMP%]   mat-list-item.igo-actionbar-item-disabled[_ngcontent-%COMP%]{color:#00000042;cursor:default!important}[_nghost-%COMP%]   mat-list-item.igo-actionbar-item-no-display[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     button[matlistitemavatar]{margin-left:4px}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     button .mat-mdc-button-persistent-ripple{display:none}[_nghost-%COMP%]   .item-checkbox[_ngcontent-%COMP%]     mat-checkbox label{margin-left:28px}[_nghost-%COMP%]   .actionbar-item[_ngcontent-%COMP%]   [matline][_ngcontent-%COMP%]{padding-left:16px}"],changeDetection:0})}return ee})();var W=s(23416);function A(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"div",5)(1,"button",6),a.qCj("click",function(){a.usT(D);const me=a.GaO();return a.CGJ(me.scrollUp())}),a.wVc(2,"translate"),a.wR5(3,"mat-icon",7),a.C$Y()()}2&ee&&(a.yG2(),a.E7m("matTooltip",a.kDX(2,1,"igo.common.actionbar.scrollUp")))}function q(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"igo-actionbar-item",10),a.qCj("trigger",function(){a.usT(D);const me=a.GaO(2);return a.CGJ(me.onTriggerAction(me.toggleCollapseAction))}),a.C$Y()}if(2&ee){const D=a.GaO(2);a.E7m("withTitle",!1)("withIcon",!0)("color",D.color)("disabled",D.store.view.empty)("action",D.toggleCollapseAction)}}function _(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"igo-actionbar-item",13),a.qCj("trigger",function(){const ke=a.usT(D).$implicit,Qe=a.GaO(3);return a.CGJ(Qe.onTriggerAction(ke))}),a.C$Y()}if(2&ee){const D=De.$implicit,te=a.GaO(3);a.E7m("withTitle",te.withTitle)("withIcon",te.withIcon)("withTooltip",te.withTooltip)("color",te.color)("disabled",te.store.state.get(D).disabled)("action",D)}}function u(ee,De){if(1&ee&&(a.yuY(0,_,1,6,"ng-template",11,12,a.gJz),a.wVc(2,"async")),2&ee){const D=a.GaO(2);a.E7m("ngForOf",a.kDX(2,1,D.store.view.all$()))}}function S(ee,De){if(1&ee&&(a.I0R(0,"mat-list",8),a.yuY(1,q,1,5,"igo-actionbar-item",9)(2,u,3,3,null,3),a.C$Y()),2&ee){const D=a.GaO();a.yG2(),a.E7m("ngIf",D.withToggleButton),a.yG2(),a.E7m("ngIf",!D.collapsed)}}function P(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"div",14)(1,"button",6),a.qCj("click",function(){a.usT(D);const me=a.GaO();return a.CGJ(me.scrollDown())}),a.wVc(2,"translate"),a.wR5(3,"mat-icon",15),a.C$Y()()}2&ee&&(a.yG2(),a.E7m("matTooltip",a.kDX(2,1,"igo.common.actionbar.scrollDown")))}function I(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"igo-actionbar-item",20),a.qCj("trigger",function(){const ke=a.usT(D).$implicit,Qe=a.GaO(2);return a.CGJ(Qe.onTriggerAction(ke))}),a.C$Y()}if(2&ee){const D=De.$implicit,te=a.GaO(2);a.E7m("withTitle",te.withTitle)("withIcon",te.withIcon)("color",te.color)("action",D)}}function U(ee,De){if(1&ee&&(a.I0R(0,"div")(1,"button",16),a.wVc(2,"translate"),a.wR5(3,"mat-icon",17),a.C$Y(),a.I0R(4,"mat-menu",18,19)(6,"mat-list"),a.yuY(7,I,1,4,"ng-template",11),a.wVc(8,"async"),a.C$Y()()()),2&ee){const D=a.Gew(5),te=a.GaO();a.yG2(),a.E7m("matTooltip",a.kDX(2,10,"igo.common.actionbar.icon"))("matMenuTriggerFor",D)("disabled",te.store.view.empty)("color",te.iconColor),a.yG2(2),a.E7m("svgIcon",te.icon),a.yG2(),a.m8U(te.overlayClass),a.E7m("xPosition",te.xPosition)("yPosition",te.yPosition),a.yG2(3),a.E7m("ngForOf",a.kDX(8,12,te.store.view.all$()))}}function G(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"igo-actionbar-item",20),a.qCj("trigger",function(){const ke=a.usT(D).$implicit,Qe=a.GaO(2);return a.CGJ(Qe.onTriggerAction(ke))}),a.C$Y(),a.wR5(1,"br")}if(2&ee){const D=De.$implicit,te=a.GaO(2);a.E7m("withTitle",te.withTitle)("withIcon",te.withIcon)("color",te.color)("action",D)}}function O(ee,De){if(1&ee&&(a.I0R(0,"mat-card",21)(1,"mat-list"),a.yuY(2,G,2,4,"ng-template",11),a.wVc(3,"async"),a.C$Y()()),2&ee){const D=a.GaO();a.yG2(2),a.E7m("ngForOf",a.kDX(3,1,D.store.view.all$()))}}let F=(()=>{class ee{overlay;elRef;cdRef;mediaService;actionbarMode=E;collapsed=!1;toggleCollapseAction={id:"actionbar_toggle",icon:"dots-vertical",handler:()=>{this.collapsed=!this.collapsed}};watcher;heightCondition$=new w.g(!1);positionConditionTop$=new w.g(!0);positionConditionLow$=new w.g(!0);store;mode=E.Dock;withToggleButton=!1;horizontal=!1;color="default";iconColor="default";withTitle=!0;withTooltip=!0;scrollActive=!0;withIcon=!0;icon="dots-horizontal";xPosition="before";yPosition="above";set overlayClass(D){this._overlayClass=D}get overlayClass(){return[this._overlayClass,"igo-actionbar-overlay"].join(" ")}_overlayClass="";isCollapsed=this.collapsed;get withTitleClass(){return this.withTitle}get withIconClass(){return this.withIcon}get horizontalClass(){return this.horizontal}get heightCondition(){const D=this.elRef.nativeElement;return!1===this.scrollActive&&D.clientHeight<D.scrollHeight}get positionConditionTop(){return 0!==this.elRef.nativeElement.scrollTop}get positionConditionLow(){const D=this.elRef.nativeElement;return!(D.scrollTop>=D.scrollHeight-D.clientHeight)}get isDesktop(){return this.mediaService.getMedia()===j.oZ.Desktop}constructor(D,te,me,ke){this.overlay=D,this.elRef=te,this.cdRef=me,this.mediaService=ke}ngOnChanges(D){const te=D.store;te&&te.currentValue!==te.previousValue&&(void 0!==this.watcher&&this.watcher.destroy(),this.watcher=new b.YX(this.store,this.cdRef))}ngOnDestroy(){this.watcher.destroy()}onTriggerAction(D){D.handler(...D.args||[])}scrollDown(){this.elRef.nativeElement.scrollBy(0,52)}scrollUp(){this.elRef.nativeElement.scrollBy(0,-52)}static \u0275fac=function(te){return new(te||ee)(a.GI1(W.mc),a.GI1(a.GMv),a.GI1(a.kD9),a.GI1(j.QB))};static \u0275cmp=a.In1({type:ee,selectors:[["igo-actionbar"]],hostVars:8,hostBindings:function(te,me){2&te&&a.eAK("is-collapsed",me.isCollapsed)("with-title",me.withTitleClass)("with-icon",me.withIconClass)("horizontal",me.horizontalClass)},inputs:{store:"store",mode:"mode",withToggleButton:"withToggleButton",horizontal:"horizontal",color:"color",iconColor:"iconColor",withTitle:"withTitle",withTooltip:"withTooltip",scrollActive:"scrollActive",withIcon:"withIcon",icon:"icon",xPosition:"xPosition",yPosition:"yPosition",overlayClass:"overlayClass"},standalone:!0,features:[a.SYr,a.UHJ],decls:5,vars:5,consts:[["id","topChevron",4,"ngIf"],["matListItemIcon","",4,"ngIf"],["id","lowChevron",4,"ngIf"],[4,"ngIf"],["class","context-menu-card mat-elevation-z4",4,"ngIf"],["id","topChevron"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click"],["svgIcon","chevron-up"],["matListItemIcon",""],["color","accent",3,"withTitle","withIcon","color","disabled","action","trigger",4,"ngIf"],["color","accent",3,"withTitle","withIcon","color","disabled","action","trigger"],["ngFor","",3,"ngForOf"],["buttonContent",""],["color","accent",3,"withTitle","withIcon","withTooltip","color","disabled","action","trigger"],["id","lowChevron"],["svgIcon","chevron-down"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"buttonOverlay",3,"matTooltip","matMenuTriggerFor","disabled","color"],[3,"svgIcon"],["overlapTrigger","true",1,"igo-compact-menu","igo-no-min-width-menu",3,"xPosition","yPosition"],["actionbarMenu","matMenu"],["color","accent",3,"withTitle","withIcon","color","action","trigger"],[1,"context-menu-card","mat-elevation-z4"]],template:function(te,me){1&te&&a.yuY(0,A,4,3,"div",0)(1,S,3,2,"mat-list",1)(2,P,4,3,"div",2)(3,U,9,14,"div",3)(4,O,4,3,"mat-card",4),2&te&&(a.E7m("ngIf",me.heightCondition&&me.positionConditionTop&&me.isDesktop),a.yG2(),a.E7m("ngIf",me.mode===me.actionbarMode.Dock),a.yG2(),a.E7m("ngIf",me.heightCondition&&me.positionConditionLow&&me.isDesktop),a.yG2(),a.E7m("ngIf",me.mode===me.actionbarMode.Overlay),a.yG2(),a.E7m("ngIf",me.mode===me.actionbarMode.Context))},dependencies:[y.u_,e.oJ,e.um,h.KO,h.a4,g.oB,g.qL,R.iI,R.oL,R.Y1,z,y.Iw,o._A,o.aM,o.yG,d.NR,d.SM,y.a,x.O0,x.sD],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto;position:relative}.horizontal[_nghost-%COMP%]{max-width:100%;overflow:unset}.horizontal[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{width:auto;white-space:nowrap}.horizontal[_nghost-%COMP%]   igo-actionbar-item[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]   .buttonOverlay[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .context-menu-card[_ngcontent-%COMP%]{padding:8px 3px;margin:10px}[_nghost-%COMP%]   #topChevron[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff;z-index:3;display:flex;justify-content:center}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){[_nghost-%COMP%]   #topChevron[_ngcontent-%COMP%]{position:fixed;top:unset}}@supports (-ms-accelerator: true){[_nghost-%COMP%]   #topChevron[_ngcontent-%COMP%]{position:fixed;top:unset}}[_nghost-%COMP%]   #lowChevron[_ngcontent-%COMP%]{position:sticky;bottom:0;background-color:#fff;z-index:3;display:flex;justify-content:center}[_nghost-%COMP%]   .igo-actionbar-overlay[_ngcontent-%COMP%]{min-width:inherit!important;padding-top:0;padding-bottom:0}[_nghost-%COMP%]   .igo-actionbar-overlay[_ngcontent-%COMP%]   .mat-mdc-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]   .igo-actionbar-overlay[_ngcontent-%COMP%]   .mat-mdc-menu-content[_ngcontent-%COMP%]:not(:empty){padding-top:0;padding-bottom:0}[_nghost-%COMP%]     .mdc-list-item__primary-text{white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;line-height:18px;-webkit-box-orient:vertical;-webkit-line-clamp:2}"],changeDetection:0})}return ee})();var ie=s(71904),ae=s(50244),fe=s(42536),le=s(47080),ue=s(50068);function se(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"div",4)(1,"color-chrome",5),a.qCj("onChange",function(me){a.usT(D);const ke=a.GaO();return a.CGJ(ke.handleChange(me))}),a.C$Y(),a.I0R(2,"div",6)(3,"button",7),a.qCj("click",function(me){a.usT(D);const ke=a.GaO();return a.CGJ(ke.handleClick(me))}),a.OEk(4),a.wVc(5,"translate"),a.C$Y()()()}if(2&ee){const D=a.GaO();a.yG2(),a.E7m("color",D.colorPicker),a.yG2(3),a.oRS(" ",a.kDX(5,2,"igo.common.confirmDialog.applyBtn")," ")}}let ge=(()=>{class ee{isOpen=!1;set value(D){this._value=this.formatColor(D??"#000"),this.colorPicker=this._value,this.onChange(this.value),this.onTouch(this.value)}get value(){return this._value}_value;outputFormat="rgba";colorChange=new a._w7;colorPicker;onChange=()=>{};onTouch=()=>{};writeValue(D){this.value=D}registerOnChange(D){this.onChange=D}registerOnTouched(D){this.onTouch=D}handleClick(D){D.preventDefault(),D.stopPropagation(),this.isOpen=!1,this.value=this.colorPicker}handleChange(D){this.colorPicker=this.formatColor(D.color.rgb,"rgba"),this.colorChange.emit(this.formatColor(this.colorPicker))}formatColor(D,te=this.outputFormat){switch(te){case"hex":D=(0,ue.c)(D).toHexString();break;case"rgba":default:D=(0,ue.c)(D).toRgbString();break;case"hsla":D=(0,ue.c)(D).toHsvString()}return D}static \u0275fac=function(te){return new(te||ee)};static \u0275cmp=a.In1({type:ee,selectors:[["igo-color-picker-form-field"]],inputs:{outputFormat:"outputFormat"},outputs:{colorChange:"colorChange"},standalone:!0,features:[a.M5G([{provide:ie.Y6,useExisting:(0,a.wd)(()=>ee),multi:!0}]),a.UHJ],decls:6,vars:7,consts:[["floatLabel","always","tooltip-position","below","matTooltipShowDelay","500","subscriptSizing","dynamic","cdkOverlayOrigin","",1,"fill-field",3,"click"],["trigger","cdkOverlayOrigin"],["type","text","matInput","",3,"readonly"],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"picker"],[3,"color","onChange"],[1,"buttons"],["mat-flat-button","","color","primary",3,"click"]],template:function(te,me){if(1&te&&(a.I0R(0,"mat-form-field",0,1),a.qCj("click",function(){return me.isOpen=!me.isOpen}),a.I0R(2,"mat-label"),a.OEk(3),a.C$Y(),a.wR5(4,"input",2),a.C$Y(),a.yuY(5,se,6,4,"ng-template",3),a.qCj("backdropClick",function(){return me.isOpen=!1})),2&te){const ke=a.Gew(1);a.yG2(3),a.cNF(me.colorPicker),a.yG2(),a.m4B("background",me.colorPicker),a.E7m("readonly",!0),a.yG2(),a.E7m("cdkConnectedOverlayOrigin",ke)("cdkConnectedOverlayOpen",me.isOpen)("cdkConnectedOverlayHasBackdrop",!0)}},dependencies:[ae.wb,ae.Up,ae.w5,W.wW,fe.cN,fe.yi,W.eC,le.on,le.OY,e.oJ,e.Gw,x.O0,x.sD],styles:[".picker[_ngcontent-%COMP%]{left:100%;position:absolute;top:100%;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 3px 1px -2px #0003,0 2px 2px #00000024,0 1px 5px #0000001f}.picker[_ngcontent-%COMP%]     .chrome-picker{box-shadow:none}.picker[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{padding:4px 12px 8px;display:flex;justify-content:flex-end}"]})}return ee})();var Re=s(40600);let He=(()=>{class ee{dialogRef;confirmMessage;titleKey="igo.common.confirmDialog.title";proccessKey="igo.common.confirmDialog.confirmBtn";cancelKey="igo.common.confirmDialog.cancelBtn";constructor(D){this.dialogRef=D}static \u0275fac=function(te){return new(te||ee)(a.GI1(Re.yI))};static \u0275cmp=a.In1({type:ee,selectors:[["igo-confirm-dialog"]],standalone:!0,features:[a.UHJ],decls:13,vars:12,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"click"],["mat-flat-button","",3,"click"]],template:function(te,me){1&te&&(a.I0R(0,"h2",0),a.OEk(1),a.wVc(2,"translate"),a.C$Y(),a.I0R(3,"div",1),a.OEk(4),a.wVc(5,"translate"),a.C$Y(),a.I0R(6,"div",2)(7,"button",3),a.qCj("click",function(){return me.dialogRef.close(!0)}),a.OEk(8),a.wVc(9,"translate"),a.C$Y(),a.I0R(10,"button",4),a.qCj("click",function(){return me.dialogRef.close(!1)}),a.OEk(11),a.wVc(12,"translate"),a.C$Y()()),2&te&&(a.yG2(),a.oRS(" ",a.kDX(2,4,me.titleKey),"\n"),a.yG2(3),a.oRS(" ",a.kDX(5,6,me.confirmMessage),"\n"),a.yG2(4),a.oRS(" ",a.kDX(9,8,me.proccessKey)," "),a.yG2(3),a.oRS(" ",a.kDX(12,10,me.cancelKey)," "))},dependencies:[Re.WQ,Re.iU,Re.Yp,e.oJ,e.Gw,x.O0,x.sD],styles:["h2[_ngcontent-%COMP%]{margin:5px 0 10px}div[mat-dialog-content][_ngcontent-%COMP%]{max-width:200px}div[mat-dialog-actions][_ngcontent-%COMP%]{margin:10px 0 0}"]})}return ee})(),ht=(()=>{class ee{dialog;constructor(D){this.dialog=D}open(D,te){const me={title:"igo.common.confirmDialog.title",modeYesNo:!1,...te},ke=this.dialog.open(He,{disableClose:!1});return ke.componentInstance.confirmMessage=D,ke.componentInstance.titleKey=me.title,me.modeYesNo&&(ke.componentInstance.proccessKey="igo.common.confirmDialog.yes",ke.componentInstance.cancelKey="igo.common.confirmDialog.no"),ke.afterClosed()}static \u0275fac=function(te){return new(te||ee)(a.CoB(Re.qW))};static \u0275prov=a.wxM({token:ee,factory:ee.\u0275fac,providedIn:"root"})}return ee})(),rt=(()=>{class ee{static forRoot(){return{ngModule:ee,providers:[]}}static \u0275fac=function(te){return new(te||ee)};static \u0275mod=a.a4G({type:ee});static \u0275inj=a.s3X({providers:[ht],imports:[He]})}return ee})();var xt=s(66165);s(800),s(14944);var Ae=s(24708),dt=s(97092);let je=(()=>{class ee{get html(){return this._html}set html(D){this._html=D}_html="";constructor(){}static \u0275fac=function(te){return new(te||ee)};static \u0275cmp=a.In1({type:ee,selectors:[["igo-custom-html"]],inputs:{html:"html"},standalone:!0,features:[a.UHJ],decls:2,vars:3,consts:[[1,"custom-html",3,"innerHTML"]],template:function(te,me){1&te&&(a.wR5(0,"div",0),a.wVc(1,"sanitizeHtml")),2&te&&a.E7m("innerHTML",a.kDX(1,1,me.html),a.E3n)},dependencies:[dt.U],styles:["[_nghost-%COMP%]   .custom-html[_ngcontent-%COMP%]{padding:20px}"]})}return ee})();var Ke=s(58136),yt=s(25812);function Le(ee,De){if(1&ee&&(a.I0R(0,"div",5),a.wR5(1,"igo-form-field",6),a.C$Y()),2&ee){const D=De.$implicit,te=a.GaO(2);a.E7m("ngClass",te.getFieldNgClass(D)),a.yG2(),a.E7m("field",D)}}function vt(ee,De){if(1&ee&&(a.I0R(0,"div",3),a.yuY(1,Le,2,2,"div",4),a.C$Y()),2&ee){const D=a.GaO();a.yG2(),a.E7m("ngForOf",D.group.fields)}}function Se(ee,De){if(1&ee&&(a.I0R(0,"mat-error"),a.OEk(1),a.wVc(2,"translate"),a.C$Y()),2&ee){const D=a.GaO();a.yG2(),a.cNF(a.kDX(2,1,D.getErrorMessage()))}}const Be=["*"];let ze=(()=>{class ee{group;errors;get formControl(){return this.group.control}constructor(){}getFieldColSpan(D){let te=2;const me=D.options||{};return me.cols&&me.cols>0&&(te=Math.min(me.cols,2)),te}getFieldNgClass(D){return{[`igo-form-field-colspan-${this.getFieldColSpan(D)}`]:!0}}getErrorMessage(){return(0,yt.KW)(this.formControl,(this.group.options||{}).errors||{})}static \u0275fac=function(te){return new(te||ee)};static \u0275cmp=a.In1({type:ee,selectors:[["igo-form-group"]],inputs:{group:"group",errors:"errors"},standalone:!0,features:[a.UHJ],ngContentSelectors:Be,decls:4,vars:2,consts:[["class","igo-form-group-fields",4,"ngIf"],[1,"igo-form-group-extra-content"],[4,"ngIf"],[1,"igo-form-group-fields"],["class","igo-form-field-wrapper",3,"ngClass",4,"ngFor","ngForOf"],[1,"igo-form-field-wrapper",3,"ngClass"],[3,"field"]],template:function(te,me){1&te&&(a.kPM(),a.yuY(0,vt,2,1,"div",0),a.I0R(1,"div",1),a._Xx(2),a.C$Y(),a.yuY(3,Se,3,3,"mat-error",2)),2&te&&(a.E7m("ngIf",me.group&&me.group.fields.length>0),a.yG2(3),a.E7m("ngIf",me.formControl.errors))},dependencies:[y.u_,y.Iw,y.QF,Ke._,ae.wb,ae.wJ,x.O0,x.sD],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block;overflow:auto;padding:10px 5px;box-sizing:border-box}[_nghost-%COMP%]   .igo-form-field-colspan-2[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .igo-form-field-colspan-1[_ngcontent-%COMP%]{width:50%}"],changeDetection:0})}return ee})();var St=s(87004);let Dt=(()=>{class ee{formBuilder;constructor(D){this.formBuilder=D}form(D,te){const me=this.formBuilder.group({});return D.forEach(ke=>{me.addControl(ke.name,ke.control)}),te.forEach(ke=>{me.addControl(ke.name,ke.control)}),{fields:D,groups:te,control:me}}group(D,te){const me=D.options||{},ke=this.formBuilder.group({});if(te.forEach(Qe=>{ke.addControl(Qe.name,Qe.control)}),me.validator){const Qe=this.getValidators(me.validator);ke.setValidators(Qe)}return Object.assign({},D,{fields:te,control:ke})}field(D){const te=D.options||{},ke=this.formBuilder.control({value:"",disabled:te.disabled});if(te.validator){const Qe=this.getValidators(te.validator);ke.setValidators(Qe)}return Object.assign({type:"text"},D,{control:ke})}extendFieldConfig(D,te){const me=Object.assign({},D.options||{},te.options||{}),ke=Object.assign({},D.inputs||{},te.inputs||{}),Qe=Object.assign({},D.subscribers||{},te.subscribers||{});return Object.assign({},D,{options:me,inputs:ke,subscribers:Qe})}getValidators(D){return Array.isArray(D)?D.map(te=>this.getValidator(te)):this.getValidator(D)}getValidator(D){if("string"!=typeof D)return D;const me=D.match(/^([a-zA-Z]{3,15})\((.{0,20})\)$/);return me?ie.AQ[me[1]](me[2]):ie.AQ[D]}static \u0275fac=function(te){return new(te||ee)(a.CoB(ie.KE))};static \u0275prov=a.wxM({token:ee,factory:ee.\u0275fac,providedIn:"root"})}return ee})();function mo(ee,De){1&ee&&a.wR5(0,"igo-form-field",11),2&ee&&a.E7m("field",De.$implicit)}function Bo(ee,De){1&ee&&a.wR5(0,"igo-form-group",12),2&ee&&a.E7m("group",De.$implicit)}function Xe(ee,De){if(1&ee&&(a.I0R(0,"div",8),a.yuY(1,mo,1,1,"igo-form-field",9)(2,Bo,1,1,"igo-form-group",10),a.C$Y()),2&ee){const D=a.GaO().ngIf;a.yG2(),a.E7m("ngForOf",D.fields),a.yG2(),a.E7m("ngForOf",D.groups)}}function ct(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"igo-form",3),a.qCj("submitForm",function(me){a.usT(D);const ke=a.GaO();return a.CGJ(ke.onSubmit(me))}),a.wVc(1,"async"),a.yuY(2,Xe,3,2,"div",4),a.I0R(3,"div",5)(4,"button",6),a.qCj("click",function(){a.usT(D);const me=a.GaO();return a.CGJ(me.cancel())}),a.OEk(5),a.wVc(6,"translate"),a.C$Y(),a.I0R(7,"button",7),a.OEk(8),a.wVc(9,"translate"),a.C$Y()()()}if(2&ee){const D=De.ngIf,te=a.GaO();a.E7m("form",D)("formData",a.kDX(1,5,te.data$)),a.yG2(2),a.E7m("ngIf",D.fields.length),a.yG2(3),a.oRS(" ",a.kDX(6,7,te.data.cancelButtonText)," "),a.yG2(3),a.oRS(" ",a.kDX(9,9,te.data.processButtonText)," ")}}function tt(ee,De){if(1&ee&&a.wR5(0,"igo-custom-html",13),2&ee){const D=a.GaO();a.E7m("html",D.data.notice)}}let st=(()=>{class ee{languageService;dialogRef;formService;data;form$=new w.g(void 0);data$=new w.g(void 0);constructor(D,te,me,ke){this.languageService=D,this.dialogRef=te,this.formService=me,this.data=ke,this.data.processButtonText=this.data.processButtonText??"igo.common.formDialog.processButtonText",this.data.cancelButtonText=this.data.cancelButtonText??"igo.common.formDialog.cancelButtonText",this.data.title=this.data.title??"igo.common.formDialog.title",this.data$=this.data.data$;let Qe=[],co=[];this.data.formFieldConfigs?.map(Ho=>Qe.push(this.formService.field(Ho))),this.data.formGroupsConfigs?.map(Ho=>{const Tn=Ho.formFieldConfigs?.map(zo=>this.formService.field(zo));co.push(this.formService.group({name:Ho.name},Tn))});const ni=this.formService.form(Qe,co);this.form$.next(ni)}onSubmit(D){const te=this.form$.getValue();te.control.valid?this.dialogRef.close(D):te.groups?.length?te.groups.map(me=>{Object.keys(me.control.controls).map(ke=>{me.control.controls[ke].markAsTouched(),me.control.controls[ke].updateValueAndValidity()})}):te.fields.map(me=>{me.control.markAsTouched(),me.control.updateValueAndValidity()})}cancel(){this.dialogRef.close()}static \u0275fac=function(te){return new(te||ee)(a.GI1(Ae.ov),a.GI1(Re.yI),a.GI1(Dt),a.GI1(Re.sR))};static \u0275cmp=a.In1({type:ee,selectors:[["igo-form-dialog"]],standalone:!0,features:[a.UHJ],decls:7,vars:7,consts:[["mat-dialog-title",""],[3,"form","formData","submitForm",4,"ngIf"],[3,"html",4,"ngIf"],[3,"form","formData","submitForm"],["class","form-dialog-container",4,"ngIf"],["formButtons","","mat-dialog-actions",""],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary"],[1,"form-dialog-container"],[3,"field",4,"ngFor","ngForOf"],[3,"group",4,"ngFor","ngForOf"],[3,"field"],[3,"group"],[3,"html"]],template:function(te,me){1&te&&(a.I0R(0,"h1",0),a.OEk(1),a.wVc(2,"translate"),a.C$Y(),a.yuY(3,ct,10,11,"igo-form",1),a.wVc(4,"async"),a.I0R(5,"div"),a.yuY(6,tt,1,1,"igo-custom-html",2),a.C$Y()),2&te&&(a.yG2(),a.cNF(a.kDX(2,3,me.data.title)),a.yG2(2),a.E7m("ngIf",a.kDX(4,5,me.form$)),a.yG2(3),a.E7m("ngIf",me.data.notice&&""!==me.data.notice))},dependencies:[Re.WQ,y.u_,St.Y,y.Iw,Ke._,ze,Re.Yp,e.oJ,e.Gw,je,y.a,x.O0,x.sD],styles:["[_nghost-%COMP%]   div[mat-dialog-actions][_ngcontent-%COMP%]{margin:10px 0 0}[_nghost-%COMP%]   .form-dialog-container[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .form-dialog-container[_ngcontent-%COMP%]   igo-form-field[_ngcontent-%COMP%], [_nghost-%COMP%]   .form-dialog-container[_ngcontent-%COMP%]   igo-form-group[_ngcontent-%COMP%]{display:block;height:auto}"]})}return ee})(),it=(()=>{class ee{dialog;constructor(D){this.dialog=D}open(D,te){const me={formFieldConfigs:D.formFieldConfigs,formGroupsConfigs:D.formGroupsConfigs,...te};return this.dialog.open(st,{disableClose:!1,data:me,...te}).afterClosed()}static \u0275fac=function(te){return new(te||ee)(a.CoB(Re.qW))};static \u0275prov=a.wxM({token:ee,factory:ee.\u0275fac})}return ee})(),Ri=(()=>{class ee{static forRoot(){return{ngModule:ee,providers:[]}}static \u0275fac=function(te){return new(te||ee)};static \u0275mod=a.a4G({type:ee});static \u0275inj=a.s3X({providers:[it],imports:[Re.sr,st]})}return ee})();var Qt=s(21124),ao=s(46176),mt=s(77872),$t=s(69368);function Lo(ee){return De=>{$t.Q.register(ee,De)}}function Uo(ee,De){if(1&ee&&(a.I0R(0,"mat-option",4),a.OEk(1),a.C$Y()),2&ee){const D=De.$implicit;a.E7m("value",D.value),a.yG2(),a.oRS(" ",D.title," ")}}function Si(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"mat-icon",5),a.qCj("click",function(){a.usT(D);const me=a.GaO();return a.CGJ(me.onDisableSwitchClick())}),a.wVc(1,"async"),a.C$Y()}if(2&ee){const D=a.GaO();a.E7m("svgIcon",!0===a.kDX(1,1,D.disabled$)?"checkbox-blank-outline":"checkbox-marked-outline")}}function Bt(ee,De){if(1&ee&&(a.I0R(0,"mat-error"),a.OEk(1),a.wVc(2,"translate"),a.C$Y()),2&ee){const D=a.GaO();a.yG2(),a.cNF(a.kDX(2,1,D.getErrorMessage()))}}let eo=class Is{disabled$=new w.g(!1);set choices(De){this.choices$.next(De)}get choices(){return this.choices$.value}choices$=new w.g([]);multiple=!1;formControl;placeholder;errors;disableSwitch=!1;get required(){return(0,yt.qs)(this.formControl)}ngOnInit(){this.disabled$.next(this.formControl.disabled)}getErrorMessage(){return(0,yt.KW)(this.formControl,this.errors)}onDisableSwitchClick(){this.toggleDisabled()}toggleDisabled(){const De=!this.disabled$.value;!0===De?this.formControl.disable():this.formControl.enable(),this.disabled$.next(De)}static \u0275fac=function(D){return new(D||Is)};static \u0275cmp=a.In1({type:Is,selectors:[["igo-form-field-select"]],inputs:{choices:"choices",multiple:"multiple",formControl:"formControl",placeholder:"placeholder",errors:"errors",disableSwitch:"disableSwitch"},standalone:!0,features:[a.UHJ],decls:6,vars:9,consts:[[3,"multiple","required","placeholder","formControl"],[3,"value",4,"ngFor","ngForOf"],["class","igo-form-disable-switch","matPrefix","",3,"svgIcon","click",4,"ngIf"],[4,"ngIf"],[3,"value"],["matPrefix","",1,"igo-form-disable-switch",3,"svgIcon","click"]],template:function(D,te){1&D&&(a.I0R(0,"mat-form-field")(1,"mat-select",0),a.yuY(2,Uo,2,2,"mat-option",1),a.wVc(3,"async"),a.C$Y(),a.yuY(4,Si,2,3,"mat-icon",2)(5,Bt,3,3,"mat-error",3),a.C$Y()),2&D&&(a.yG2(),a.E7m("multiple",te.multiple)("required",te.required)("placeholder",te.placeholder)("formControl",te.formControl),a.yG2(),a.E7m("ngForOf",a.kDX(3,7,te.choices$)),a.yG2(2),a.E7m("ngIf",!0===te.disableSwitch),a.yG2(),a.E7m("ngIf",te.formControl.errors))},dependencies:[ae.wb,ae.Up,ae.wJ,ae.is,mt.d5,mt.kX,ao.I5,ie.y,ie.ue,ie.eJ,ie.sl,ie.ug,y.Iw,ao.Ax,y.u_,g.oB,g.qL,y.a,x.O0,x.sD],encapsulation:2,changeDetection:0})};function uo(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"mat-icon",4),a.qCj("click",function(){a.usT(D);const me=a.GaO();return a.CGJ(me.onDisableSwitchClick())}),a.wVc(1,"async"),a.C$Y()}if(2&ee){const D=a.GaO();a.E7m("svgIcon",!0===a.kDX(1,1,D.disabled$)?"checkbox-blank-outline":"checkbox-marked-outline")}}function zt(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"button",5),a.qCj("click",function(){a.usT(D);const me=a.GaO();return a.CGJ(me.togglePassword())}),a.wR5(1,"mat-icon",6),a.C$Y()}if(2&ee){const D=a.GaO();a.yG2(),a.E7m("svgIcon",D.hide?"eye-off":"eye")}}function qt(ee,De){if(1&ee&&(a.I0R(0,"mat-error"),a.OEk(1),a.wVc(2,"translate"),a.C$Y()),2&ee){const D=a.GaO();a.yG2(),a.cNF(a.kDX(2,1,D.getErrorMessage()))}}eo=(0,Qt.UN)([Lo("select")],eo);let Te=class Ts{cdRef;disabled$=new w.g(!1);hide=!0;lastTimeoutRequest;formControl;placeholder;isPassword;errors;disableSwitch=!1;get required(){return(0,yt.qs)(this.formControl)}constructor(De){this.cdRef=De}ngOnInit(){this.disabled$.next(this.formControl.disabled)}getErrorMessage(){return(0,yt.KW)(this.formControl,this.errors)}onDisableSwitchClick(){this.toggleDisabled()}toggleDisabled(){const De=!this.disabled$.value;!0===De?this.formControl.disable():this.formControl.enable(),this.disabled$.next(De)}togglePassword(){this.hide=!this.hide,this.delayedHide()}delayedHide(De=1e4){this.isPassword&&!this.hide&&(this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest),this.lastTimeoutRequest=setTimeout(()=>{this.hide=!0,this.cdRef.detectChanges()},De))}static \u0275fac=function(D){return new(D||Ts)(a.GI1(a.kD9))};static \u0275cmp=a.In1({type:Ts,selectors:[["igo-form-field-text"]],inputs:{formControl:"formControl",placeholder:"placeholder",isPassword:"isPassword",errors:"errors",disableSwitch:"disableSwitch"},standalone:!0,features:[a.UHJ],decls:5,vars:7,consts:[["matInput","",3,"type","required","placeholder","formControl","blur","change"],["class","igo-form-disable-switch","matPrefix","",3,"svgIcon","click",4,"ngIf"],["type","button","matSuffix","","mat-icon-button","",3,"click",4,"ngIf"],[4,"ngIf"],["matPrefix","",1,"igo-form-disable-switch",3,"svgIcon","click"],["type","button","matSuffix","","mat-icon-button","",3,"click"],["color","primary",3,"svgIcon"]],template:function(D,te){1&D&&(a.I0R(0,"mat-form-field")(1,"input",0),a.qCj("blur",function(){return te.delayedHide(0)})("change",function(){return te.delayedHide()}),a.C$Y(),a.yuY(2,uo,2,3,"mat-icon",1)(3,zt,2,1,"button",2)(4,qt,3,3,"mat-error",3),a.C$Y()),2&D&&(a.yG2(),a.E7m("type",te.isPassword&&te.hide?"password":"text")("required",te.isPassword?"true":te.required)("placeholder",te.placeholder)("formControl",te.formControl),a.yG2(),a.E7m("ngIf",!0===te.disableSwitch),a.yG2(),a.E7m("ngIf",te.isPassword),a.yG2(),a.E7m("ngIf",te.formControl.errors))},dependencies:[ae.wb,ae.Up,ae.wJ,ae.is,ae.Gm,fe.cN,fe.yi,ie.y,ie.ot,ie.ue,ie.eJ,ie.sl,ie.ug,y.u_,g.oB,g.qL,e.oJ,e.um,y.a,x.O0,x.sD],encapsulation:2,changeDetection:0})};function ut(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"mat-icon",3),a.qCj("click",function(){a.usT(D);const me=a.GaO();return a.CGJ(me.onDisableSwitchClick())}),a.wVc(1,"async"),a.C$Y()}if(2&ee){const D=a.GaO();a.E7m("svgIcon",!0===a.kDX(1,1,D.disabled$)?"checkbox-blank-outline":"checkbox-marked-outline")}}function pe(ee,De){if(1&ee&&(a.I0R(0,"mat-error"),a.OEk(1),a.wVc(2,"translate"),a.C$Y()),2&ee){const D=a.GaO();a.yG2(),a.cNF(a.kDX(2,1,D.getErrorMessage()))}}Te=(0,Qt.UN)([Lo("text"),(0,Qt.YR)("design:paramtypes",[a.kD9])],Te);let ye=class Es{disabled$=new w.g(!1);formControl;placeholder;errors;disableSwitch=!1;get required(){return(0,yt.qs)(this.formControl)}ngOnInit(){this.disabled$.next(this.formControl.disabled)}getErrorMessage(){return(0,yt.KW)(this.formControl,this.errors)}onDisableSwitchClick(){this.toggleDisabled()}toggleDisabled(){const De=!this.disabled$.value;!0===De?this.formControl.disable():this.formControl.enable(),this.disabled$.next(De)}static \u0275fac=function(D){return new(D||Es)};static \u0275cmp=a.In1({type:Es,selectors:[["igo-form-field-textarea"]],inputs:{formControl:"formControl",placeholder:"placeholder",errors:"errors",disableSwitch:"disableSwitch"},standalone:!0,features:[a.UHJ],decls:5,vars:5,consts:[["matInput","",3,"required","placeholder","formControl"],["class","igo-form-disable-switch","matPrefix","",3,"svgIcon","click",4,"ngIf"],[4,"ngIf"],["matPrefix","",1,"igo-form-disable-switch",3,"svgIcon","click"]],template:function(D,te){1&D&&(a.I0R(0,"mat-form-field")(1,"textarea",0),a.OEk(2,"  "),a.C$Y(),a.yuY(3,ut,2,3,"mat-icon",1)(4,pe,3,3,"mat-error",2),a.C$Y()),2&D&&(a.yG2(),a.E7m("required",te.required)("placeholder",te.placeholder)("formControl",te.formControl),a.yG2(2),a.E7m("ngIf",!0===te.disableSwitch),a.yG2(),a.E7m("ngIf",te.formControl.errors))},dependencies:[ae.wb,ae.Up,ae.wJ,ae.is,fe.cN,fe.yi,ie.y,ie.ot,ie.ue,ie.eJ,ie.sl,ie.ug,y.u_,g.oB,g.qL,y.a,x.O0,x.sD],encapsulation:2,changeDetection:0})};ye=(0,Qt.UN)([Lo("textarea")],ye);var Ut=s(880),Me=s(15e3),Lt=s(26496);let Zt=(()=>{class ee{static \u0275fac=function(te){return new(te||ee)};static \u0275mod=a.a4G({type:ee});static \u0275inj=a.s3X({providers:[Lt.I,Me.C],imports:[Ut.E]})}return ee})();function _t(ee,De){1&ee&&a.C_f(0)}function Gt(ee,De){1&ee&&a.C_f(0)}const ft=(ee,De)=>({obj:ee,baseKey:De});function At(ee,De){if(1&ee&&(a.SAx(0),a.yuY(1,Gt,1,0,"ng-container",2),a.k70()),2&ee){const D=a.GaO(2).$implicit,te=a.GaO().baseKey,me=a.GaO(),ke=a.Gew(5);a.yG2(),a.E7m("ngTemplateOutlet",ke)("ngTemplateOutletContext",a.IBC(2,ft,D.value,me.getKey(te,D.key)))}}function Go(ee,De){if(1&ee&&(a.I0R(0,"p")(1,"span")(2,"b"),a.OEk(3),a.C$Y(),a.OEk(4," : "),a.C$Y(),a.wR5(5,"span",10),a.C$Y()),2&ee){const D=a.GaO(2).$implicit,te=a.GaO().baseKey,me=a.GaO();a.yG2(3),a.cNF(me.getKey(te,D.key)),a.yG2(2),a.E7m("innerHtml",D.value,a.E3n)}}function Gn(ee,De){if(1&ee&&(a.SAx(0),a.yuY(1,At,2,5,"ng-container",8)(2,Go,6,2,"ng-template",null,9,a.gJz),a.k70()),2&ee){const D=a.Gew(3),te=a.GaO().$implicit,me=a.GaO(2);a.yG2(),a.E7m("ngIf",me.isObject(te.value))("ngIfElse",D)}}function $n(ee,De){if(1&ee&&(a.SAx(0),a.yuY(1,Gn,4,2,"ng-container",7),a.k70()),2&ee){const D=De.$implicit,te=a.GaO().baseKey,me=a.GaO();a.yG2(),a.E7m("ngIf",-1===me.ignoreKeys.indexOf(me.getKey(te,D.key)))}}function To(ee,De){1&ee&&(a.yuY(0,$n,2,1,"ng-container",6),a.wVc(1,"keyvalue")),2&ee&&a.E7m("ngForOf",a.kDX(1,1,De.obj))}const on=ee=>({obj:ee});let ai=(()=>{class ee{dialogRef;title;data;ignoreKeys;constructor(D){this.dialogRef=D}isObject(D){return"object"==typeof D&&!Array.isArray(D)}getKey(D,te){return(D?D+".":"")+te}static \u0275fac=function(te){return new(te||ee)(a.GI1(Re.yI))};static \u0275cmp=a.In1({type:ee,selectors:[["igo-json-dialog"]],standalone:!0,features:[a.UHJ],decls:9,vars:5,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["loopObject",""],["mat-dialog-actions",""],["mat-button","","color","primary",3,"click"],[4,"ngFor","ngForOf"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["notObject",""],[1,"propertyValue",3,"innerHtml"]],template:function(te,me){if(1&te&&(a.I0R(0,"h1",0),a.OEk(1),a.C$Y(),a.I0R(2,"div",1),a.yuY(3,_t,1,0,"ng-container",2)(4,To,2,3,"ng-template",null,3,a.gJz),a.C$Y(),a.I0R(6,"div",4)(7,"button",5),a.qCj("click",function(){return me.dialogRef.close(!1)}),a.OEk(8," OK "),a.C$Y()()),2&te){const ke=a.Gew(5);a.yG2(),a.cNF(me.title),a.yG2(2),a.E7m("ngTemplateOutlet",ke)("ngTemplateOutletContext",a.S45(3,on,me.data))}},dependencies:[Re.WQ,Re.iU,y.XV,y.Iw,y.u_,Re.Yp,e.oJ,e.Gw,y.uq],encapsulation:2})}return ee})(),Li=(()=>{class ee{dialog;constructor(D){this.dialog=D}open(D,te,me){const ke=this.dialog.open(ai,{disableClose:!1});return ke.componentInstance.data=te,ke.componentInstance.title=D,ke.componentInstance.ignoreKeys=me??[],ke.afterClosed()}static \u0275fac=function(te){return new(te||ee)(a.CoB(Re.qW))};static \u0275prov=a.wxM({token:ee,factory:ee.\u0275fac})}return ee})(),bi=(()=>{class ee{static forRoot(){return{ngModule:ee}}static \u0275fac=function(te){return new(te||ee)};static \u0275mod=a.a4G({type:ee});static \u0275inj=a.s3X({providers:[Li],imports:[ai]})}return ee})();var Qo=s(21232),li=s(64080);function Gi(ee,De){if(1&ee&&(a.I0R(0,"mat-checkbox",10),a.OEk(1),a.C$Y()),2&ee){const D=De.$implicit;a._6D("formControlName",D.value),a.yG2(),a.cNF(D.title||D.value)}}function $i(ee,De){if(1&ee&&a.yuY(0,Gi,2,2,"ng-template",9),2&ee){const D=a.GaO();a.E7m("ngForOf",D.data.choices)}}function Zo(ee,De){if(1&ee&&(a.I0R(0,"mat-radio-button",13),a.OEk(1),a.C$Y()),2&ee){const D=De.$implicit;a.E7m("value",D.value),a.yG2(),a.oRS(" ",D.title||D.value," ")}}function ci(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"mat-radio-group",11),a.qCj("change",function(me){a.usT(D);const ke=a.GaO();return a.CGJ(ke.onChange(me))}),a.yuY(1,Zo,2,2,"mat-radio-button",12),a.C$Y()}if(2&ee){const D=a.GaO();a.yG2(),a.E7m("ngForOf",D.data.choices)}}let Yo=(()=>{class ee{formBuilder;languageService;dialogRef;data;formGroup;isDisabled$=new w.g(!0);constructor(D,te,me,ke){this.formBuilder=D,this.languageService=te,this.dialogRef=me,this.data=ke,this.formGroup=this.formBuilder.group(this.getFg()),this.data.selectFieldText=this.data.selectFieldText??"igo.common.selectValueDialog.selectFieldText",this.data.processButtonText=this.data.processButtonText??"igo.common.selectValueDialog.processButtonText",this.data.cancelButtonText=this.data.cancelButtonText??"igo.common.selectValueDialog.cancelButtonText",this.data.title=this.data.title??"igo.common.selectValueDialog.multipleTitle",this.data.type===li.H.Radio&&(this.data.title="igo.common.selectValueDialog.title")}ngOnInit(){this.formGroup.valueChanges.subscribe(()=>this.canProcess())}getFg(){const D={};return this.data.choices.map(te=>D[te.value]=!1),D}canProcess(){const D=this.data.choices.map(me=>me.value),te=[];D.map(me=>this.formGroup.value[me]?te.push(me):void 0),this.isDisabled$.next(!te.length)}save(){const D=this.data.choices.map(me=>me.value),te=[];D.map(me=>this.formGroup.value[me]?te.push(me):void 0),this.dialogRef.close({choices:te})}cancel(){this.dialogRef.close()}onChange(D){const te={};this.data.choices.map(me=>te[me.value]=!1),te[D.value]=!0,this.formGroup.setValue(te)}static \u0275fac=function(te){return new(te||ee)(a.GI1(ie.KE),a.GI1(Ae.ov),a.GI1(Re.yI),a.GI1(Re.sR,8))};static \u0275cmp=a.In1({type:ee,selectors:[["igo-select-value-check-radio-dialog"]],standalone:!0,features:[a.UHJ],decls:16,vars:15,consts:[["mat-dialog-title",""],[1,"igo-form",3,"formGroup"],[1,"choices-section"],[4,"ngIf"],[3,"change",4,"ngIf"],["mat-dialog-actions",""],[1,"button-group"],["mat-raised-button","","type","button",3,"click"],["id","processBtnDialog","mat-raised-button","","type","button","color","primary",3,"disabled","click"],["ngFor","",3,"ngForOf"],[3,"formControlName"],[3,"change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(te,me){1&te&&(a.I0R(0,"h1",0),a.OEk(1),a.wVc(2,"translate"),a.C$Y(),a.I0R(3,"form",1)(4,"section",2),a.yuY(5,$i,1,1,null,3)(6,ci,2,1,"mat-radio-group",4),a.C$Y(),a.I0R(7,"div",5)(8,"div",6)(9,"button",7),a.qCj("click",function(){return me.cancel()}),a.OEk(10),a.wVc(11,"translate"),a.C$Y(),a.I0R(12,"button",8),a.qCj("click",function(){return me.save()}),a.wVc(13,"async"),a.OEk(14),a.wVc(15,"translate"),a.C$Y()()()()),2&te&&(a.yG2(),a.cNF(a.kDX(2,7,me.data.title)),a.yG2(2),a.E7m("formGroup",me.formGroup),a.yG2(2),a.E7m("ngIf","checkbox"===me.data.type),a.yG2(),a.E7m("ngIf","radio"===me.data.type),a.yG2(4),a.oRS(" ",a.kDX(11,9,me.data.cancelButtonText)," "),a.yG2(2),a.E7m("disabled",a.kDX(13,11,me.isDisabled$)),a.yG2(2),a.oRS(" ",a.kDX(15,13,me.data.processButtonText)," "))},dependencies:[Re.WQ,ie.y,ie.sz,ie.ue,ie.u,ie.sl,ie.uW,ie.Wo,y.u_,y.Iw,K.Vn,K.WK,Qo.yk,Qo.cv,Qo.cT,Re.Yp,e.oJ,e.Gw,y.a,x.O0,x.sD],styles:["[_nghost-%COMP%]  div[mat-dialog-actions]{margin:10px 0 0}[_nghost-%COMP%]  section.choices-section{max-width:auto;display:grid;grid-template-columns:auto auto;grid-gap:0px;padding:5px}"]})}return ee})(),Vo=(()=>{class ee{dialog;constructor(D){this.dialog=D}open(D,te){const me={choices:D,...te};return this.dialog.open(Yo,{disableClose:!1,data:me,...te}).afterClosed()}static \u0275fac=function(te){return new(te||ee)(a.CoB(Re.qW))};static \u0275prov=a.wxM({token:ee,factory:ee.\u0275fac})}return ee})(),Eo=(()=>{class ee{static forRoot(){return{ngModule:ee,providers:[]}}static \u0275fac=function(te){return new(te||ee)};static \u0275mod=a.a4G({type:ee});static \u0275inj=a.s3X({providers:[Vo],imports:[Yo]})}return ee})();s(23302);var Yt=s(24112),Io=s(94204);const ui=ee=>({"igo-spinner-container":!0,"igo-spinner-shown":ee});let qo=(()=>{class ee{shown$=new w.g(!1);set shown(D){this.shown$.next(D)}get shown(){return this.shown$.value}constructor(){}show(){this.shown=!0}hide(){this.shown=!1}static \u0275fac=function(te){return new(te||ee)};static \u0275cmp=a.In1({type:ee,selectors:[["igo-spinner"]],inputs:{shown:"shown"},standalone:!0,features:[a.UHJ],decls:4,vars:5,consts:[[3,"ngClass"],[1,"igo-spinner-background"],["diameter","40","mode","indeterminate"]],template:function(te,me){1&te&&(a.I0R(0,"div",0),a.wVc(1,"async"),a.wR5(2,"div",1)(3,"mat-progress-spinner",2),a.C$Y()),2&te&&a.E7m("ngClass",a.S45(3,ui,a.kDX(1,1,me.shown$)))},dependencies:[y.QF,Io.cm,y.a],styles:["[_nghost-%COMP%]   .igo-spinner-container[_ngcontent-%COMP%]{display:none;position:relative;pointer-events:none}[_nghost-%COMP%]   .igo-spinner-container.igo-spinner-shown[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]{height:40px;width:40px;border-radius:50%}[_nghost-%COMP%]   .igo-spinner-background[_ngcontent-%COMP%]{height:36px;width:36px;border-radius:50%;border:4px solid #ffffff;position:absolute;top:2px;left:2px}"]})}return ee})();var Ai=s(17469),ot=s(76768),go=s(80956),to=s(64002),jo=s(93244),An=s(11484),ki=function(ee){return ee[ee.primary=0]="primary",ee[ee.accent=1]="accent",ee[ee.warn=2]="warn",ee}(ki||{}),xo=s(728),ei=s(40604);class Bi extends Ai.Cc{_database;_model;_sort;get filter(){return this._filterChange.value}set filter(De){this._filterChange.next(De)}_filterChange=new w.g("");constructor(De,D,te){super(),this._database=De,this._model=D,this._sort=te}connect(){return this._database?(0,xo.U)(this._database.dataChange,this._filterChange,this._sort.sortChange).pipe((0,ei.k)(()=>this.getFilteredData(this._database.data)),(0,ei.k)(D=>this.getSortedData(D))):(0,xo.U)([])}disconnect(){}getFilteredData(De){return this.filter?De.slice().filter(D=>-1!==this._model.columns.filter(me=>me.filterable).map(me=>to.Yv.resolve(D,me.name)).join(" ").toLowerCase().indexOf(this.filter.toLowerCase())):De}getSortedData(De){return this._sort.active&&""!==this._sort.direction?De.sort((D,te)=>{const me=to.Yv.resolve(D,this._sort.active),ke=to.Yv.resolve(te,this._sort.active);return to.Yv.naturalCompare(ke,me,this._sort.direction)}):De}}const nn=["filter"];function Ui(ee,De){1&ee&&(a.I0R(0,"div",12)(1,"mat-form-field",13),a.wR5(2,"input",14,15),a.wVc(4,"translate"),a.C$Y()()),2&ee&&(a.yG2(2),a.E7m("placeholder",a.kDX(4,1,"igo.common.table.filter")))}function rn(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"th",16)(1,"mat-checkbox",17),a.qCj("change",function(me){a.usT(D);const ke=a.GaO();return a.CGJ(me?ke.masterToggle():null)}),a.C$Y()()}if(2&ee){const D=a.GaO();a.yG2(),a.E7m("checked",D.selection.hasValue()&&D.isAllSelected())("indeterminate",D.selection.hasValue()&&!D.isAllSelected())}}function So(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"td",18)(1,"mat-checkbox",19),a.qCj("click",function(me){return me.stopPropagation()})("change",function(me){const Qe=a.usT(D).$implicit,co=a.GaO();return a.CGJ(me?co.selection.toggle(Qe):null)}),a.C$Y()()}if(2&ee){const D=De.$implicit,te=a.GaO();a.yG2(),a.E7m("checked",te.selection.isSelected(D))}}function Ko(ee,De){if(1&ee&&(a.I0R(0,"th",25),a.OEk(1),a.C$Y()),2&ee){const D=a.GaO(2).$implicit;a.yG2(),a.oRS(" ",D.title," ")}}function pi(ee,De){1&ee&&(a.SAx(0),a.yuY(1,Ko,2,1,"th",24),a.k70())}function Po(ee,De){if(1&ee&&(a.I0R(0,"th",16),a.OEk(1),a.C$Y()),2&ee){const D=a.GaO(2).$implicit;a.yG2(),a.cNF(D.title)}}function mi(ee,De){1&ee&&(a.SAx(0),a.yuY(1,Po,2,1,"th",6),a.k70())}const Wo=()=>({});function ti(ee,De){if(1&ee&&(a.I0R(0,"td",27),a.OEk(1),a.C$Y()),2&ee){const D=De.$implicit,te=a.GaO(2).$implicit,me=a.GaO();a.E7m("ngClass",me.model.cellClassFunc?me.model.cellClassFunc(D,te):a.q4q(2,Wo)),a.yG2(),a.oRS(" ",me.getValue(D,te.name)," ")}}function Yi(ee,De){1&ee&&(a.SAx(0),a.yuY(1,ti,2,3,"td",26),a.k70())}function gi(ee,De){if(1&ee&&a.wR5(0,"td",29),2&ee){const D=De.$implicit,te=a.GaO(2).$implicit,me=a.GaO();a.E7m("ngClass",me.model.cellClassFunc?me.model.cellClassFunc(D,te):a.q4q(2,Wo))("innerHTML",me.getValue(D,te.name),a.E3n)}}function sn(ee,De){1&ee&&a.yuY(0,gi,1,3,"td",28)}function an(ee,De){if(1&ee&&(a.SAx(0,20),a.yuY(1,pi,2,0,"ng-container",21)(2,mi,2,0,"ng-container",21)(3,Yi,2,0,"ng-container",22)(4,sn,1,0,"ng-template",null,23,a.gJz),a.k70()),2&ee){const D=De.$implicit,te=a.Gew(5);a.E7m("matColumnDef",D.name),a.yG2(),a.E7m("ngIf",D.sortable),a.yG2(),a.E7m("ngIf",!D.sortable),a.yG2(),a.E7m("ngIf",!D.html)("ngIfElse",te)}}function ln(ee,De){1&ee&&a.wR5(0,"th",16)}function Vi(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"button",31),a.qCj("click",function(me){const Qe=a.usT(D).$implicit,co=a.GaO().$implicit,ni=a.GaO();return a.CGJ(ni.handleClickAction(me,Qe,co))}),a.wR5(1,"mat-icon",32),a.C$Y()}if(2&ee){const D=De.$implicit,te=a.GaO(2);a.E7m("color",te.getActionColor(D.color)),a.yG2(),a._6D("svgIcon",D.icon)}}function oo(ee,De){if(1&ee&&(a.I0R(0,"td",18),a.yuY(1,Vi,2,2,"button",30),a.C$Y()),2&ee){const D=a.GaO();a.yG2(),a.E7m("ngForOf",D.model.actions)}}function cn(ee,De){1&ee&&a.wR5(0,"tr",33)}function un(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"tr",34),a.qCj("click",function(){const ke=a.usT(D).$implicit,Qe=a.GaO();return a.CGJ(Qe.selection.toggle(ke))}),a.C$Y()}if(2&ee){const D=De.$implicit,te=a.GaO();a.E7m("ngClass",te.model.rowClassFunc?te.model.rowClassFunc(D):a.q4q(1,Wo))}}let dn=(()=>{class ee{get database(){return this._database}set database(D){this._database=D}_database;get model(){return this._model}set model(D){this._model=D}_model;get hasFilterInput(){return this._hasFIlterInput}set hasFilterInput(D){this._hasFIlterInput=D}_hasFIlterInput=!0;displayedColumns;dataSource;selection=new Ai.e2(!0,[]);select=new a._w7;filter;sort;ngOnInit(){this.dataSource=new Bi(this.database,this.model,this.sort),this.model&&(this.displayedColumns=this.model.columns.filter(D=>!1!==D.displayed).map(D=>D.name),this.model.selectionCheckbox&&this.displayedColumns.unshift("selectionCheckbox"),this.model.actions&&this.model.actions.length&&this.displayedColumns.push("action")),this.selection.changed.subscribe(D=>this.select.emit(D))}ngAfterViewInit(){this.filter&&(0,jo.w)(this.filter.nativeElement,"keyup").pipe((0,Yt.o)(150),(0,An.a)()).subscribe(()=>{this.dataSource&&(this.dataSource.filter=this.filter.nativeElement.value)})}ngOnChanges(D){D.database&&(this.dataSource=new Bi(this.database,this.model,this.sort),this.selection.clear())}getActionColor(D){return ki[D]}getValue(D,te){return to.Yv.resolve(D,te)}isAllSelected(){return this.selection.selected.length===this.database.data.length}masterToggle(){this.isAllSelected()?this.selection.clear():this.database.data.forEach(D=>this.selection.select(D))}handleClickAction(D,te,me){D.stopPropagation(),te.click(me)}static \u0275fac=function(te){return new(te||ee)};static \u0275cmp=a.In1({type:ee,selectors:[["igo-table"]],viewQuery:function(te,me){if(1&te&&(a.CC$(nn,5),a.CC$(ot.E9,7)),2&te){let ke;a.wto(ke=a.Gqi())&&(me.filter=ke.first),a.wto(ke=a.Gqi())&&(me.sort=ke.first)}},inputs:{database:"database",model:"model",hasFilterInput:"hasFilterInput"},outputs:{select:"select"},standalone:!0,features:[a.SYr,a.UHJ],decls:14,vars:5,consts:[[1,"table-box"],["class","table-header",4,"ngIf"],[1,"table-container"],["mat-table","","matSort","",3,"dataSource"],["table",""],["matColumnDef","selectionCheckbox"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"ngClass","click",4,"matRowDef","matRowDefColumns"],[1,"table-header"],["floatPlaceholder","never"],["matInput","",3,"placeholder"],["filter",""],["mat-header-cell",""],[3,"checked","indeterminate","change"],["mat-cell",""],[3,"checked","click","change"],[3,"matColumnDef"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["cellHTML",""],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"matCellDef"],["mat-cell","",1,"mat-cell-text",3,"ngClass"],["mat-cell","","class","mat-cell-text",3,"ngClass","innerHTML",4,"matCellDef"],["mat-cell","",1,"mat-cell-text",3,"ngClass","innerHTML"],["mat-mini-fab","",3,"color","click",4,"ngFor","ngForOf"],["mat-mini-fab","",3,"color","click"],[3,"svgIcon"],["mat-header-row",""],["mat-row","",3,"ngClass","click"]],template:function(te,me){1&te&&(a.I0R(0,"div",0),a.yuY(1,Ui,5,3,"div",1),a.I0R(2,"div",2)(3,"table",3,4),a.SAx(5,5),a.yuY(6,rn,2,2,"th",6)(7,So,2,1,"td",7),a.k70(),a.yuY(8,an,6,5,"ng-container",8),a.SAx(9,9),a.yuY(10,ln,1,0,"th",6)(11,oo,2,1,"td",7),a.k70(),a.yuY(12,cn,1,0,"tr",10)(13,un,1,2,"tr",11),a.C$Y()()()),2&te&&(a.yG2(),a.E7m("ngIf",me.hasFilterInput),a.yG2(2),a.E7m("dataSource",me.dataSource),a.yG2(5),a.E7m("ngForOf",me.model.columns),a.yG2(4),a.E7m("matHeaderRowDef",me.displayedColumns),a.yG2(),a.E7m("matRowDefColumns",me.displayedColumns))},dependencies:[y.u_,ae.wb,ae.Up,fe.cN,fe.yi,go.If,go.wL,go.ie,go.aG,go.Af,go.uc,go.gx,go.qC,go.cX,go.yC,go._I,ot.Su,ot.E9,ot.e6,K.Vn,K.WK,y.Iw,y.QF,e.oJ,e.CI,g.oB,g.qL,x.O0,x.sD],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}.table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto;flex:1 1 auto}.table-box[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.table-header[_ngcontent-%COMP%]{min-height:64px;max-width:500px;display:flex;flex:0 1 auto;align-items:baseline;padding:8px 24px 0;font-size:20px;justify-content:space-between}tr[mat-header-row][_ngcontent-%COMP%], tr[mat-row][_ngcontent-%COMP%]{height:60px}.mat-cell-text[_ngcontent-%COMP%]{overflow:hidden;word-wrap:break-word}td[mat-cell][_ngcontent-%COMP%]{padding-right:15px}th.mat-mdc-header-cell[_ngcontent-%COMP%]{padding-right:5px}button[_ngcontent-%COMP%]{margin-right:10px}"]})}return ee})();var hi=s(97780),pn=s(6316),wi=s(10988),oi=s(53291);function mn(ee="300ms",De="ease-in-out"){return(0,oi.gV)("toolSlideInOut",[(0,oi.K2)("enter",(0,oi.wb)({transform:"translate3d(0, 0, 0)"})),(0,oi.aK)("void => enter",(0,oi.Cs)(ee+" "+De))])}function gn(ee,De){if(1&ee&&(a.wR5(0,"igo-actionbar",2),a.wVc(1,"async"),a.wVc(2,"async"),a.wVc(3,"async")),2&ee){const D=a.GaO();a.E7m("store",D.actionStore)("withIcon",!0)("withTitle",a.kDX(1,6,D.toolbarWithTitle$))("withTooltip",!1===a.kDX(2,8,D.toolbarWithTitle$))("scrollActive",a.kDX(3,10,D.toolbarWithTitle$))("horizontal",!1)}}const hn=(ee,De)=>({"igo-tool-container-with-toolbar":ee,"igo-tool-container-with-animation":De});function fn(ee,De){if(1&ee){const D=a.KQA();a.I0R(0,"div",3),a.qCj("@toolSlideInOut.start",function(){a.usT(D);const me=a.GaO();return a.CGJ(me.onAnimationStart())})("@toolSlideInOut.done",function(){a.usT(D);const me=a.GaO();return a.CGJ(me.onAnimationComplete())}),a.wVc(1,"async"),a.wR5(2,"igo-dynamic-outlet",4),a.C$Y()}if(2&ee){const D=De.ngIf,te=a.GaO();a.E7m("ngClass",a.IBC(6,hn,!te.actionStore.empty,te.animate))("@toolSlideInOut",a.kDX(1,4,te.animation$)),a.yG2(2),a.E7m("component",D.component)("inputs",te.getToolInputs(D))}}let yn=(()=>{class ee{activeTool$=new w.g(void 0);get isActive(){return!!this.activeTool$.value}actionStore=new T([]);animation$=new w.g("none");toolbar$=new w.g([]);toolbarWithTitle$=this.activeTool$.pipe((0,ei.k)(D=>void 0===D));activeTool$$;toolbar$$;animating$=new w.g(!1);animating$$;toolbox;animate=!1;color="white";get classColorGrey(){return"grey"===this.color}get classColorPrimary(){return"primary"===this.color}ngOnInit(){this.toolbar$$=this.toolbox.toolbar$.subscribe(D=>this.onToolbarChange(D)),this.activeTool$$=this.toolbox.activeTool$.subscribe(D=>this.onActiveToolChange(D))}ngOnDestroy(){this.toolbar$$.unsubscribe(),this.activeTool$$.unsubscribe(),this.actionStore.destroy()}onAnimationStart(){this.animating$.next(!0)}onAnimationComplete(){this.animating$.next(!1)}getToolInputs(D){return D.options||{}}onToolbarChange(D){this.setToolbar(D)}onActiveToolChange(D){this.animate?this.onAnimate(()=>this.setActiveTool(D)):this.setActiveTool(D)}setActiveTool(D){if(void 0===D)this.actionStore.state.updateAll({active:!1});else{const te=this.actionStore.get(D.name);void 0!==te&&this.actionStore.state.update(te,{active:!0},!0)}this.activeTool$.next(D),this.animate&&this.animation$.next("enter")}setToolbar(D){const te=D.reduce((me,ke)=>{const Qe=this.toolbox.getTool(ke);return void 0===Qe||me.push({id:Qe.name,title:Qe.title,icon:Qe.icon,tooltip:Qe.tooltip,args:[Qe,this.toolbox],handler:(co,ni)=>{ni.activateTool(co.name)},ngClass:(co,ni)=>this.toolbox.activeTool$.pipe((0,ei.k)(Ho=>{let Tn=!1;void 0!==Ho&&co.name===Ho.name&&(Tn=!0);let zo=!1;return void 0!==Ho&&co.name===Ho.parent&&(zo=!0),{"tool-activated":Tn,"children-tool-activated":zo}}))}),me},[]);this.actionStore.load(te),this.toolbar$.next(D)}onAnimate(D){this.unAnimate(),this.animating$$=this.animating$.subscribe(te=>{te||(D.call(this),this.unAnimate())})}unAnimate(){this.animating$$&&this.animating$$.unsubscribe()}static \u0275fac=function(te){return new(te||ee)};static \u0275cmp=a.In1({type:ee,selectors:[["igo-toolbox"]],hostVars:4,hostBindings:function(te,me){2&te&&a.eAK("color-grey",me.classColorGrey)("color-primary",me.classColorPrimary)},inputs:{toolbox:"toolbox",animate:"animate",color:"color"},standalone:!0,features:[a.UHJ],decls:4,vars:6,consts:[[3,"store","withIcon","withTitle","withTooltip","scrollActive","horizontal",4,"ngIf"],["class","igo-tool-container mat-body-1",3,"ngClass",4,"ngIf"],[3,"store","withIcon","withTitle","withTooltip","scrollActive","horizontal"],[1,"igo-tool-container","mat-body-1",3,"ngClass"],[3,"component","inputs"]],template:function(te,me){1&te&&(a.yuY(0,gn,4,12,"igo-actionbar",0),a.wVc(1,"async"),a.yuY(2,fn,3,9,"div",1),a.wVc(3,"async")),2&te&&(a.E7m("ngIf",a.kDX(1,2,me.toolbar$).length>0),a.yG2(2),a.E7m("ngIf",a.kDX(3,4,me.activeTool$)))},dependencies:[y.u_,F,y.QF,pn.q,y.a],styles:["[_nghost-%COMP%]{display:block;position:relative;overflow:hidden;width:100%;height:100%}[_nghost-%COMP%]     .mdc-list-item--with-leading-avatar .mdc-list-item__start{margin:0}[_nghost-%COMP%]   .igo-tool-container[_ngcontent-%COMP%]{position:absolute;inset:0;margin-bottom:0}[_nghost-%COMP%]   .igo-tool-container-with-animation[_ngcontent-%COMP%]{transform:translate3d(100%,0,0)}[_nghost-%COMP%]   .igo-tool-container-with-toolbar[_ngcontent-%COMP%]{left:50px}[_nghost-%COMP%]   igo-actionbar[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]   igo-actionbar.with-title[_ngcontent-%COMP%]{width:100%;overflow:auto}[_nghost-%COMP%]   igo-actionbar[_ngcontent-%COMP%]:not(.with-title){width:48px;overflow:hidden;-o-box-shadow:2px 0px 2px 0px #dddddd;box-shadow:2px 0 2px #ddd}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   igo-actionbar[_ngcontent-%COMP%]:not(.with-title){overflow:auto}}[_nghost-%COMP%]   igo-dynamic-outlet[_ngcontent-%COMP%]{overflow:auto}"],data:{animation:[mn()]},changeDetection:0})}return ee})(),ii=(()=>{class ee{static \u0275fac=function(te){return new(te||ee)};static \u0275mod=a.a4G({type:ee});static \u0275inj=a.s3X({})}return ee})();var Cn=s(88908);let Oi=(()=>{class ee{dynamicComponentService;constructor(D){this.dynamicComponentService=D}create(D){return this.dynamicComponentService.create(D)}static \u0275fac=function(te){return new(te||ee)(a.CoB(Cn.O))};static \u0275prov=a.wxM({token:ee,factory:ee.\u0275fac,providedIn:"root"})}return ee})(),Bn=(()=>{class ee{static \u0275fac=function(te){return new(te||ee)};static \u0275mod=a.a4G({type:ee});static \u0275inj=a.s3X({providers:[Oi],imports:[ii,ii]})}return ee})();class Un extends b.qc{activeWorkspace$=new w.g(void 0);activateWorkspace(De){const D=this.activeWorkspace$.value;void 0!==D&&D.deactivate(),this.deactivateWorkspace(),void 0!==De&&(this.state.update(De,{active:!0,selected:!0},!0),this.activeWorkspace$.next(De),De.activate())}deactivateWorkspace(){const De=this.activeWorkspace$.value;void 0!==De&&(De.deactivate(),this.activeWorkspace$.next(void 0))}}let Ii=(()=>{class ee{store;disabled;selectedChange=new a._w7;getWorkspaceTitle(D){return(0,b.YB)(D)}onSelectedChange(D){const te=D.value;this.store.activateWorkspace(te),this.selectedChange.emit({selected:!0,value:te})}static \u0275fac=function(te){return new(te||ee)};static \u0275cmp=a.In1({type:ee,selectors:[["igo-workspace-selector"]],inputs:{store:"store",disabled:"disabled"},outputs:{selectedChange:"selectedChange"},standalone:!0,features:[a.UHJ],decls:1,vars:4,consts:[[3,"store","multi","titleAccessor","disabled","selectedChange"]],template:function(te,me){1&te&&(a.I0R(0,"igo-entity-selector",0),a.qCj("selectedChange",function(Qe){return me.onSelectedChange(Qe)}),a.C$Y()),2&te&&a.E7m("store",me.store)("multi",!1)("titleAccessor",me.getWorkspaceTitle)("disabled",me.disabled)},dependencies:[xt.s],changeDetection:0})}return ee})();var ro=s(26431);function Mo(ee,De){if(1&ee){const D=a.KQA();a.SAx(0),a.I0R(1,"igo-widget-outlet",1),a.qCj("cancel",function(){const ke=a.usT(D).ngIf,Qe=a.GaO();return a.CGJ(Qe.onWidgetCancel(ke))})("complete",function(){const ke=a.usT(D).ngIf,Qe=a.GaO();return a.CGJ(Qe.onWidgetComplete(ke))}),a.wVc(2,"async"),a.wVc(3,"async"),a.C$Y(),a.k70()}if(2&ee){const D=De.ngIf,te=a.GaO();a.yG2(),a.E7m("widget",D)("inputs",a.kDX(2,3,te.widgetInputs$))("subscribers",a.kDX(3,5,te.widgetSubscribers$))}}let vo=(()=>{class ee{workspace;deactivateWidget=new a._w7;get widget$(){return this.workspace.widget$}get widgetInputs$(){return this.workspace.widgetInputs$}get widgetSubscribers$(){return this.workspace.widgetSubscribers$}constructor(){}onWidgetCancel(D){this.workspace.deactivateWidget(),this.deactivateWidget.emit(D)}onWidgetComplete(D){this.workspace.deactivateWidget(),this.deactivateWidget.emit(D)}static \u0275fac=function(te){return new(te||ee)};static \u0275cmp=a.In1({type:ee,selectors:[["igo-workspace-widget-outlet"]],inputs:{workspace:"workspace"},outputs:{deactivateWidget:"deactivateWidget"},standalone:!0,features:[a.UHJ],decls:2,vars:3,consts:[[4,"ngIf"],[3,"widget","inputs","subscribers","cancel","complete"]],template:function(te,me){1&te&&(a.yuY(0,Mo,4,7,"ng-container",0),a.wVc(1,"async")),2&te&&a.E7m("ngIf",a.kDX(1,1,me.widget$))},dependencies:[y.u_,ro.A,y.a],styles:["igo-widget-outlet[_ngcontent-%COMP%]{height:100%}"],changeDetection:0})}return ee})(),Yn=(()=>{class ee{el;matIconRegistry;set igoMatBadgeIcon(D){this.matIconRegistry.getNamedSvgIcon(D).subscribe(te=>{this.svg=te,this.updateSvg()})}svg;set matBadgeHidden(D){this.hidden=D,this.updateHidden()}hidden=!1;set matBadgeDisabled(D){this.disabled=D,this.updateDisabled()}disabled=!1;set igoMatBadgeInverseColor(D){this.inverseColor=D,this.updateColor()}inverseColor=!1;set igoMatBadgeInheritColor(D){this.inheritColor=D,this.updateColor()}inheritColor=!1;set igoMatBadgeColor(D){this.color=D,this.updateColor()}color;set igoMatBadgeBackgroundColor(D){this.backgroundColor=D,this.updateColor()}backgroundColor;get badge(){return this.el.nativeElement.querySelector(".mat-badge-content")}originalColor;constructor(D,te){this.el=D,this.matIconRegistry=te}ngOnInit(){this.badge.style.alignItems="center",this.badge.style.justifyContent="center",this.updateHidden(),this.updateColor(),this.updateSvg()}updateSvg(){this.badge&&(this.badge.innerHTML="",this.svg&&this.badge.appendChild(this.svg))}updateColor(){this.badge&&(this.color||this.backgroundColor?(this.badge.style.color=this.color?this.color:"",this.badge.style.background=this.backgroundColor?this.backgroundColor:""):this.inheritColor?this.inverseColor?(this.badge.style.color="currentColor",this.badge.style.background="none"):(this.badge.style.color="",this.badge.style.background="currentColor"):this.inheritColor||(this.inverseColor?(this.badge.style.color=window.getComputedStyle(this.badge,null).getPropertyValue("background-color"),this.badge.style.background="none"):(this.badge.style.color="",this.badge.style.background="")),this.originalColor=this.badge.style.color,this.updateDisabled())}updateHidden(){this.badge&&(this.badge.style.display=this.hidden?"none":"flex")}updateDisabled(){!this.badge||!this.inverseColor||(this.disabled?(this.originalColor=this.badge.style.color,this.badge.style.color="#b9b9b9"):this.badge.style.color=this.originalColor)}static \u0275fac=function(te){return new(te||ee)(a.GI1(a.GMv),a.GI1(g.iK))};static \u0275dir=a.Sc5({type:ee,selectors:[["","igoMatBadgeIcon",""]],inputs:{igoMatBadgeIcon:"igoMatBadgeIcon",matBadgeHidden:"matBadgeHidden",matBadgeDisabled:"matBadgeDisabled",igoMatBadgeInverseColor:"igoMatBadgeInverseColor",igoMatBadgeInheritColor:"igoMatBadgeInheritColor",igoMatBadgeColor:"igoMatBadgeColor",igoMatBadgeBackgroundColor:"igoMatBadgeBackgroundColor"},standalone:!0,features:[a.M5G([g.oB])]})}return ee})(),fi=(()=>{class ee{renderer;el;get target(){return this._target}set target(D){this._target=D}_target;get collapsed(){return this._collapsed}set collapsed(D){D?this.collapseTarget():this.expandTarget(),this._collapsed=D,this.toggle.emit(D)}_collapsed=!1;toggle=new a._w7;click(){this.collapsed=!this.collapsed}constructor(D,te){this.renderer=D,this.el=te}collapseTarget(){this.renderer.addClass(this.target,"igo-collapsed"),this.renderer.addClass(this.el.nativeElement,"collapsed")}expandTarget(){this.renderer.removeClass(this.target,"igo-collapsed"),this.renderer.removeClass(this.el.nativeElement,"collapsed")}static \u0275fac=function(te){return new(te||ee)(a.GI1(a.q87),a.GI1(a.GMv))};static \u0275dir=a.Sc5({type:ee,selectors:[["","igoCollapse",""]],hostBindings:function(te,me){1&te&&a.qCj("click",function(){return me.click()})},inputs:{target:"target",collapsed:"collapsed"},outputs:{toggle:"toggle"},standalone:!0})}return ee})();const yi=["*"];let Ti=(()=>{class ee{get title(){return this._title}set title(D){this._title=D}_title="";get collapsed(){return this._collapsed}set collapsed(D){this._collapsed=D,this.toggle.emit(D)}_collapsed=!1;toggle=new a._w7;static \u0275fac=function(te){return new(te||ee)};static \u0275cmp=a.In1({type:ee,selectors:[["igo-collapsible"]],inputs:{title:"title",collapsed:"collapsed"},outputs:{toggle:"toggle"},standalone:!0,features:[a.UHJ],ngContentSelectors:yi,decls:7,vars:3,consts:[["svgIcon","chevron-up","matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"target","collapsed","toggle"],["matListItemTitle",""],["content",""]],template:function(te,me){if(1&te&&(a.kPM(),a.I0R(0,"mat-list-item")(1,"mat-icon",0),a.qCj("toggle",function(Qe){return me.collapsed=Qe}),a.C$Y(),a.I0R(2,"span",1),a.OEk(3),a.C$Y()(),a.I0R(4,"div",null,2),a._Xx(6),a.C$Y()),2&te){const ke=a.Gew(5);a.yG2(),a.E7m("target",ke)("collapsed",me.collapsed),a.yG2(2),a.cNF(me.title)}},dependencies:[R.iI,R.g9,R.Y1,R.UV,g.oB,g.qL,fi],styles:["[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item.mat-mdc-list-item-avatar{height:auto;width:auto;padding:0}mat-list-item[_ngcontent-%COMP%]{overflow:hidden}"]})}return ee})();var Wi=s(60336),Ei=s(6560),Ni=s(37496);let xi=(()=>{class ee{overlay;viewContainerRef;elementRef;overlayRef;sub;menuContext;menuPosition=new a._w7;constructor(D,te,me){this.overlay=D,this.viewContainerRef=te,this.elementRef=me}onContextMenu(D){let te,me;if(D instanceof MouseEvent?(te=D.x,me=D.y):D instanceof TouchEvent&&(te=D.touches[0].pageX,me=D.touches[0].pageY),!te||!me)return;this.close(),D.preventDefault(),this.menuPosition.emit({x:te,y:me}),this.overlayRef=null;const ke=this.overlay.position().flexibleConnectedTo({x:te,y:me}).withPositions([{originX:"end",originY:"bottom",overlayX:"start",overlayY:"top"}]);this.overlayRef=this.overlay.create({positionStrategy:ke,scrollStrategy:this.overlay.scrollStrategies.close()}),this.overlayRef.attach(new Wi.CC(this.menuContext,this.viewContainerRef,{$implicit:void 0})),this.sub=(0,jo.w)(document,"click").pipe((0,Ei.I)(Qe=>{const co=Qe.target;return this.close(),!!this.overlayRef&&!this.overlayRef.overlayElement.contains(co)}),(0,Ni.U)(1)).subscribe(()=>this.close()),this.sub=(0,jo.w)(document,"contextmenu").pipe((0,Ei.I)(Qe=>{const co=Qe.target;if(co&&!this.elementRef.nativeElement.contains(co)&&!this.overlayRef.overlayElement.contains(co))return!0;Qe.preventDefault()}),(0,Ni.U)(1)).subscribe(()=>this.close())}close(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=null),this.sub&&this.sub.unsubscribe()}static \u0275fac=function(te){return new(te||ee)(a.GI1(W.mc),a.GI1(a.y8U),a.GI1(a.GMv))};static \u0275dir=a.Sc5({type:ee,selectors:[["","igoContextMenu",""]],hostBindings:function(te,me){1&te&&a.qCj("longpress",function(Qe){return me.onContextMenu(Qe)})("contextmenu",function(Qe){return me.onContextMenu(Qe)})},inputs:{menuContext:[a.Wk5.None,"igoContextMenu","menuContext"]},outputs:{menuPosition:"menuPosition"},standalone:!0})}return ee})(),Hi=(()=>{class ee{touchTimeout;touchDuration=400;onlyIOS=!0;longpress=new a._w7;constructor(){}touchstart(D){D.touches.length>1?this.touchEnd():this.touchTimeout=setTimeout(()=>{this.onlyIOS?"iOS"===to.sX.getOSName()&&this.longpress.emit(D):this.longpress.emit(D)},this.touchDuration)}touchend(){this.touchEnd()}touchEnd(){clearTimeout(this.touchTimeout)}static \u0275fac=function(te){return new(te||ee)};static \u0275dir=a.Sc5({type:ee,selectors:[["","igoLongPress",""]],hostBindings:function(te,me){1&te&&a.qCj("touchstart",function(Qe){return me.touchstart(Qe)})("touchmove",function(){return me.touchend()})("touchcancel",function(){return me.touchend()})("touchend",function(){return me.touchend()})},inputs:{touchDuration:"touchDuration",onlyIOS:"onlyIOS"},outputs:{longpress:"longpress"},standalone:!0})}return ee})();var zi=s(35392),Vn=s(39732),ne=s(51672),Ye=s(33712);let f=(()=>{class ee{http;constructor(D){this.http=D}getDom(D){var te=this;return(0,zi.c)(function*(){const me=D.url;let ke;return yield te.http.get(me).pipe((0,ei.k)(Qe=>(ke=Qe,Qe)),(0,ne.a)(Qe=>(0,Vn.c)(Qe))).toPromise(),ke})()}static \u0275fac=function(te){return new(te||ee)(a.CoB(Ye.KK))};static \u0275prov=a.wxM({token:ee,factory:ee.\u0275fac,providedIn:"root"})}return ee})(),H=(()=>{class ee{allowedExtensions=[];filesDropped=new a._w7;filesInvalid=new a._w7;background="inherit";onDragOver(D){D.preventDefault(),D.stopPropagation(),this.background="#999"}onDragLeave(D){D.preventDefault(),D.stopPropagation(),this.background="inherit"}onDrop(D){if(D.preventDefault(),D.stopPropagation(),D.alreadyFired)return;D.alreadyFired=!0,this.background="inherit";const te=this.validExtensions(D);te.valid.length&&this.filesDropped.emit(te.valid),te.invalid.length&&this.filesInvalid.emit(te.invalid)}validExtensions(D){const te=D.dataTransfer.files,me={valid:[],invalid:[]};if(te.length>0)for(const ke of te){const Qe=ke.name.split(".")[ke.name.split(".").length-1];0===this.allowedExtensions.length||-1!==this.allowedExtensions.lastIndexOf(Qe)&&0!==ke.size?me.valid.push(ke):me.invalid.push(ke)}return me}static \u0275fac=function(te){return new(te||ee)};static \u0275dir=a.Sc5({type:ee,selectors:[["","igoDragAndDrop",""]],hostVars:2,hostBindings:function(te,me){1&te&&a.qCj("dragover",function(Qe){return me.onDragOver(Qe)})("dragleave",function(Qe){return me.onDragLeave(Qe)})("drop",function(Qe){return me.onDrop(Qe)}),2&te&&a.m4B("background",me.background)},inputs:{allowedExtensions:"allowedExtensions"},outputs:{filesDropped:"filesDropped",filesInvalid:"filesInvalid"},standalone:!0})}return ee})();var Z=s(77020);const _e=["flexibleMain"],we=["*",[["","igoFlexibleFill",""]]],We=["*","[igoFlexibleFill]"];let gt=(()=>{class ee{el;mediaService;static transitionTime=250;main;get initial(){return this._initial}set initial(D){this._initial=D}_initial="0";get collapsed(){return this._collapsed}set collapsed(D){this._collapsed=D}_collapsed="0";get expanded(){return this._expanded}set expanded(D){this._expanded=D}_expanded="100%";get initialMobile(){return this._initialMobile}set initialMobile(D){this._initialMobile=D}_initialMobile=this.expanded;get collapsedMobile(){return this._collapsedMobile}set collapsedMobile(D){this._collapsedMobile=D}_collapsedMobile=this.collapsed;get expandedMobile(){return this._expandedMobile}set expandedMobile(D){this._expandedMobile=D}_expandedMobile=this.expanded;get direction(){return this._direction}set direction(D){this._direction=D}_direction="column";get state(){return this._state}set state(D){const te={initial:this.initial,collapsed:this.collapsed,expanded:this.expanded};this.mediaService.isMobile()&&Object.assign(te,{initial:this.initialMobile,collapsed:this.collapsedMobile,expanded:this.expandedMobile});const me=te[D];void 0!==me&&(this.setSize(me),setTimeout(()=>{this._state=D},ee.transitionTime))}_state="initial";mediaService$$;constructor(D,te){this.el=D,this.mediaService=te}ngOnInit(){this.el.nativeElement.className+=this.direction,this.mediaService$$=this.mediaService.media$.subscribe(D=>this.state=this.state)}ngOnDestroy(){this.mediaService$$&&this.mediaService$$.unsubscribe()}setSize(D){this._state="transition","column"===this.direction?this.main.nativeElement.style.height=D:"row"===this.direction&&(this.main.nativeElement.style.width=D)}static \u0275fac=function(te){return new(te||ee)(a.GI1(a.GMv),a.GI1(j.QB))};static \u0275cmp=a.In1({type:ee,selectors:[["igo-flexible"]],viewQuery:function(te,me){if(1&te&&a.CC$(_e,7),2&te){let ke;a.wto(ke=a.Gqi())&&(me.main=ke.first)}},inputs:{initial:"initial",collapsed:"collapsed",expanded:"expanded",initialMobile:"initialMobile",collapsedMobile:"collapsedMobile",expandedMobile:"expandedMobile",direction:"direction",state:"state"},standalone:!0,features:[a.UHJ],ngContentSelectors:We,decls:8,vars:4,consts:[["flexibleMain",""],[1,"igo-container"],[1,"igo-flexible-fill"]],template:function(te,me){1&te&&(a.kPM(we),a.I0R(0,"div",null,0)(2,"div",1),a._Xx(3),a.C$Y()(),a.I0R(4,"div",2)(5,"div")(6,"div",1),a._Xx(7,1),a.C$Y()()()),2&te&&a.qim("igo-flexible-main ",me.state," ",me.direction,"")},styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}.column[_nghost-%COMP%]{flex-direction:column}.row[_nghost-%COMP%]{flex-direction:row}[_nghost-%COMP%]   .igo-flexible-main[_ngcontent-%COMP%]{flex:0 0 auto;overflow:hidden}[_nghost-%COMP%]   .igo-flexible-main.column[_ngcontent-%COMP%]{transition:height .25s ease-in}[_nghost-%COMP%]   .igo-flexible-main.row[_ngcontent-%COMP%]{transition:width .25s ease-in}[_nghost-%COMP%]   .igo-flexible-fill[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:absolute;inset:0}[_nghost-%COMP%]   .igo-container[_ngcontent-%COMP%]{height:100%;overflow:hidden;position:relative}[_nghost-%COMP%]     .igo-flexible-fill{flex:1 1 auto;overflow:hidden;position:relative}[_nghost-%COMP%]     .igo-content{height:100%;width:100%;overflow:auto}[_nghost-%COMP%]     igo-panel{height:100%}"]})}return ee})();var kt=s(19644),Pt=s(696);let Xt=(()=>{class ee{renderer;el;static focusedCls="igo-list-item-focused";static selectedCls="igo-list-item-selected";static disabledCls="igo-list-item-disabled";get color(){return this._color}set color(D){this._color=D}_color="primary";get focused(){return this._focused}set focused(D){D!==this._focused&&(this.disabled||(D?this.beforeFocus.emit(this):this.beforeUnfocus.emit(this),this._focused=D,!0!==this.selected&&this.toggleFocusedClass(),D?this.focus.emit(this):this.unfocus.emit(this)))}_focused=!1;get selected(){return this._selected}set selected(D){D!==this._selected&&(this.disabled||(D?this.beforeSelect.emit(this):this.beforeUnselect.emit(this),this._selected=D,this._focused=D,this.toggleSelectedClass(),D?this.select.emit(this):this.unselect.emit(this)))}_selected=!1;get disabled(){return this._disabled}set disabled(D){D!==this._disabled&&(!0===D&&(this.selected=!1),D?this.beforeDisable.emit(this):this.beforeEnable.emit(this),this._disabled=D,this.toggleDisabledClass(),D?this.disable.emit(this):this.enable.emit(this))}_disabled=!1;beforeSelect=new a._w7;beforeFocus=new a._w7;beforeUnselect=new a._w7;beforeUnfocus=new a._w7;beforeDisable=new a._w7;beforeEnable=new a._w7;focus=new a._w7;unfocus=new a._w7;select=new a._w7;unselect=new a._w7;disable=new a._w7;enable=new a._w7;onClick(){this.selected=!0}constructor(D,te){this.renderer=D,this.el=te}getOffsetTop(){return this.el.nativeElement.offsetTop-5}toggleFocusedClass(){this.focused?this.addCls(ee.focusedCls):this.removeCls(ee.focusedCls)}toggleSelectedClass(){this.selected?(this.addCls(ee.selectedCls),this.removeCls(ee.focusedCls)):this.removeCls(ee.selectedCls)}toggleDisabledClass(){this.disabled?this.addCls(ee.disabledCls):this.removeCls(ee.disabledCls)}addCls(D){this.renderer.addClass(this.el.nativeElement,D)}removeCls(D){this.renderer.removeClass(this.el.nativeElement,D)}static \u0275fac=function(te){return new(te||ee)(a.GI1(a.q87),a.GI1(a.GMv))};static \u0275dir=a.Sc5({type:ee,selectors:[["","igoListItem",""]],hostBindings:function(te,me){1&te&&a.qCj("click",function(){return me.onClick()})},inputs:{color:"color",focused:"focused",selected:"selected",disabled:"disabled"},outputs:{beforeSelect:"beforeSelect",beforeFocus:"beforeFocus",beforeUnselect:"beforeUnselect",beforeUnfocus:"beforeUnfocus",beforeDisable:"beforeDisable",beforeEnable:"beforeEnable",focus:"focus",unfocus:"unfocus",select:"select",unselect:"unselect",disable:"disable",enable:"enable"},standalone:!0})}return ee})(),Fo=(()=>{class ee{el;clickout=new a._w7;handleMouseClick(D,te){te&&(this.el.nativeElement.contains(te)||this.clickout.emit(D))}constructor(D){this.el=D}static \u0275fac=function(te){return new(te||ee)(a.GI1(a.GMv))};static \u0275dir=a.Sc5({type:ee,selectors:[["","igoClickout",""]],hostBindings:function(te,me){1&te&&a.qCj("click",function(Qe){return me.handleMouseClick(Qe,Qe.target)},!1,a.wLc)},outputs:{clickout:"clickout"},standalone:!0})}return ee})();const No=ee=>({selectable:ee}),Sn=["*"];let _i=(()=>{class ee{el;get navigation(){return this._navigation}set navigation(D){this._navigation=D}_navigation=!0;get selection(){return this._selection}set selection(D){this._selection=D}_selection=!0;get selectedItem(){return this._selectedItem}set selectedItem(D){this.focusedItem=D,this._selectedItem=D}_selectedItem;get focusedItem(){return this._focusedItem}set focusedItem(D){this._focusedItem=D}_focusedItem;navigationEnabled;listItems$$;subscriptions=[];listItems;handleKeyboardEvent(D){this.navigationEnabled&&("ArrowUp"===D.key||"ArrowDown"===D.key?(D.preventDefault(),this.navigate(D.key)):"Enter"===D.key&&this.select(this.focusedItem))}constructor(D){this.el=D}ngOnInit(){this.enableNavigation()}ngAfterViewInit(){this.listItems.length&&this.init(),this.listItems$$=this.listItems.changes.subscribe(D=>this.init())}ngOnDestroy(){this.listItems$$.unsubscribe()}focus(D){this.selection&&(this.unfocus(),void 0!==D&&(D.focused=!0))}unfocus(){void 0!==this.focusedItem&&(this.focusedItem.focused=!1),this.focusedItem=void 0}focusNext(){const D=this.listItems.toArray();let te;const me=this.el.nativeElement;let ke=!0,Qe=this.getFocusedIndex();for(void 0===Qe&&(Qe=-1);ke&&Qe<D.length-1;)Qe+=1,te=D[Qe],ke=te.disabled;void 0!==te&&this.focus(te),D[Qe+1]?void 0!==te&&!this.isScrolledIntoView(te.el.nativeElement)&&(me.scrollTop=te.el.nativeElement.offsetTop+te.el.nativeElement.children[0].offsetHeight-me.clientHeight):me.scrollTop=me.scrollHeight-me.clientHeight}focusPrevious(){const D=this.listItems.toArray();let te;const me=this.el.nativeElement;let ke=!0,Qe=this.getFocusedIndex();for(;ke&&Qe>0;)Qe-=1,te=D[Qe],ke=te.disabled;void 0!==te&&this.focus(te),D[Qe-1]?void 0!==te&&!this.isScrolledIntoView(te.el.nativeElement)&&(me.scrollTop=te.el.nativeElement.offsetTop-3):me.scrollTop=0}select(D){this.selection&&(this.unselect(),void 0!==D&&(D.selected=!0))}unselect(){this.unfocus(),void 0!==this.selectedItem&&(this.selectedItem.selected=!1),this.selectedItem=void 0}enableNavigation(){this.navigation&&(this.navigationEnabled=!0)}disableNavigation(){this.navigationEnabled=!1}scrollToItem(D){this.el.nativeElement.scrollTop=D.getOffsetTop()}isScrolledIntoView(D){const te=this.el.nativeElement.scrollTop+this.el.nativeElement.offsetTop,ke=D.offsetTop;return ke+D.children[0].offsetHeight<=te+this.el.nativeElement.clientHeight&&ke>=te}init(){this.subscribe(),this.selectedItem=this.findSelectedItem(),this.focusedItem=this.findFocusedItem(),this.enableNavigation()}subscribe(){this.unsubscribe(),this.listItems.toArray().forEach(D=>{this.subscriptions.push(D.beforeSelect.subscribe(te=>this.handleItemBeforeSelect(te))),this.subscriptions.push(D.select.subscribe(te=>this.handleItemSelect(te))),this.subscriptions.push(D.beforeFocus.subscribe(te=>this.handleItemBeforeFocus(te))),this.subscriptions.push(D.focus.subscribe(te=>this.handleItemFocus(te)))},this)}unsubscribe(){this.subscriptions.forEach(D=>D.unsubscribe()),this.subscriptions=[]}handleItemBeforeFocus(D){D!==this.focusedItem&&this.unfocus()}handleItemFocus(D){this.focusedItem=D}handleItemBeforeSelect(D){D!==this.focusedItem&&this.unselect()}handleItemSelect(D){this.selectedItem=D}findSelectedItem(){return this.listItems.toArray().find(D=>D.selected)}findFocusedItem(){return this.listItems.toArray().find(D=>D.focused)}getFocusedIndex(){return this.listItems.toArray().findIndex(D=>D===this.focusedItem)}navigate(D){switch(D){case"ArrowUp":this.focusPrevious();break;case"ArrowDown":this.focusNext()}}static \u0275fac=function(te){return new(te||ee)(a.GI1(a.GMv))};static \u0275cmp=a.In1({type:ee,selectors:[["igo-list"]],contentQueries:function(te,me,ke){if(1&te&&a.szK(ke,Xt,5),2&te){let Qe;a.wto(Qe=a.Gqi())&&(me.listItems=Qe)}},hostBindings:function(te,me){1&te&&a.qCj("keydown",function(Qe){return me.handleKeyboardEvent(Qe)},!1,a.wLc)("enter",function(Qe){return me.handleKeyboardEvent(Qe)},!1,a.wLc)},inputs:{navigation:"navigation",selection:"selection"},standalone:!0,features:[a.UHJ],ngContentSelectors:Sn,decls:2,vars:3,consts:[["igoClickout","",3,"ngClass","clickout","click"]],template:function(te,me){1&te&&(a.kPM(),a.I0R(0,"mat-list",0),a.qCj("clickout",function(){return me.disableNavigation()})("click",function(){return me.enableNavigation()}),a._Xx(1),a.C$Y()),2&te&&a.E7m("ngClass",a.S45(1,No,me.selection))},dependencies:[R.iI,R.oL,Fo,y.QF],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto;position:relative}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item .mdc-list-item__primary-text{white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;max-height:36px;line-height:18px;-webkit-box-orient:vertical;-webkit-line-clamp:2}[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item.mdc-list-item--with-leading-icon{height:48px}[_nghost-%COMP%]     .mat-mdc-list   igo-collapsible>.mat-mdc-list-item>.mdc-list-item__primary-text>.mat-mdc-list-item{font-weight:700;opacity:.9}[_nghost-%COMP%]   mat-list.selectable[_ngcontent-%COMP%]     [igolistitem]:not(.igo-list-item-disabled) mat-list-item:hover{cursor:pointer}[_nghost-%COMP%]     [igolistitem]:focus{outline:none}"]})}return ee})();const jn=ee=>({"igo-cursor-pointer":ee});function Kn(ee,De){if(1&ee&&(a.I0R(0,"div",2)(1,"div",3),a._Xx(2,1),a.C$Y(),a.I0R(3,"h3",4),a.OEk(4),a._Xx(5,2),a.C$Y(),a.I0R(6,"div",5),a._Xx(7,3),a.C$Y()()),2&ee){const D=a.GaO();a.E7m("ngClass",a.S45(2,jn,!0===D.cursorPointer)),a.yG2(4),a.oRS(" ",D.title," ")}}const Di=["*",[["","panelLeftButton",""]],[["","panelHeader",""]],[["","panelRightButton",""]]],wn=["*","[panelLeftButton]","[panelHeader]","[panelRightButton]"];let Xi=(()=>{class ee{title;get withHeader(){return this._withHeader}set withHeader(D){this._withHeader=D}_withHeader=!0;cursorPointer=!1;static \u0275fac=function(te){return new(te||ee)};static \u0275cmp=a.In1({type:ee,selectors:[["igo-panel"]],hostVars:2,hostBindings:function(te,me){2&te&&a.eAK("igo-panel-with-header",me.withHeader)},inputs:{title:"title",withHeader:"withHeader",cursorPointer:"cursorPointer"},standalone:!0,features:[a.UHJ],ngContentSelectors:wn,decls:3,vars:1,consts:[["class","igo-panel-header","title","",3,"ngClass",4,"ngIf"],["title","",1,"igo-panel-content"],["title","",1,"igo-panel-header",3,"ngClass"],[1,"panel-left"],[1,"igo-panel-title"],[1,"panel-right"]],template:function(te,me){1&te&&(a.kPM(Di),a.yuY(0,Kn,8,4,"div",0),a.I0R(1,"div",1),a._Xx(2),a.C$Y()),2&te&&a.E7m("ngIf",me.withHeader)},dependencies:[y.u_,y.QF],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;overflow:hidden}[_nghost-%COMP%]   igo-interactive-tour[_ngcontent-%COMP%]{position:absolute;top:0;right:0}[_nghost-%COMP%]   .igo-panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;height:48px;text-align:center}[_nghost-%COMP%]   .igo-panel-title[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;margin:0;font-weight:600;flex:1}[_nghost-%COMP%]   .igo-panel-content[_ngcontent-%COMP%]{flex:1;overflow:auto}[_nghost-%COMP%]   .igo-cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .panel-left[_ngcontent-%COMP%], [_nghost-%COMP%]   .panel-right[_ngcontent-%COMP%]{display:flex;min-width:40px}[_nghost-%COMP%]   .panel-right[_ngcontent-%COMP%]:not(:empty){padding-right:4px}"],changeDetection:0})}return ee})();var $o=s(24100);class lo{dataChange=new w.g([]);get data(){return this.dataChange.value}constructor(De){De&&this.dataChange.next(De)}set(De){this.dataChange.next(De)}add(De){const D=this.data.slice();D.push(De),this.set(D)}remove(De){const D=this.data.slice(),te=D.indexOf(De);D.splice(te,1),this.set(D)}}function In(ee){return De=>{hi.I.register(Object.assign({},ee,{component:De}))}}var or=s(61616);class ir{options;widget$=new w.g(void 0);widgetInputs$=new w.g({});widgetSubscribers$=new w.g({});entities$$;change=new or.E;change$;get id(){return this.options.id}get title(){return this.options.title}get meta(){return this.options.meta||{}}get entityStore(){return this.options.entityStore}get actionStore(){return this.options.actionStore}get widget(){return this.widget$.value}get hasWidget(){return void 0!==this.widget}constructor(De){this.options=De}get active(){return this.active$.value}active$=new w.g(!1);activate(){!0===this.active&&this.deactivate(),this.active$.next(!0),void 0!==this.entityStore&&(this.entities$$=this.entityStore.stateView.all$().subscribe(()=>this.onStateChange())),this.change.next()}deactivate(){this.active$.next(!1),this.deactivateWidget(),void 0!==this.entities$$&&this.entities$$.unsubscribe(),void 0!==this.change$&&this.change$.unsubscribe()}activateWidget(De,D={},te={}){this.widget$.next(De),this.widgetInputs$.next(D),this.widgetSubscribers$.next(te),this.change.next()}deactivateWidget(){this.widget$.next(void 0),this.change.next()}onStateChange(){this.change.next()}}},37240:(Ee,ce,s)=>{"use strict";s.d(ce,{SS:()=>yi,cl:()=>ao,kP:()=>Xe,AX:()=>Ti,W2:()=>ci,Sm:()=>vn,KS:()=>to,M9:()=>ae,Mb:()=>xi,k5:()=>Mi,mE:()=>Oi});var y=s(65056),e=s(71904),d=s(34672),g=s(24296),R=s(46176),o=s(75180),h=s(50244),j=s(42536),x=s(77872),w=s(62228),b=s(83600),E=s(93020),T=s(72584),a=s(54844),K=s(37496),M=s(21724),L=s(24708),oe=s(84112),N=s(21720),B=s(49496),X=s(64002),V=s(12396),z=s(80848),W=s(3784),A=s(28772),q=s(61616),_=s(1296),u=s(68013),S=s(83680),P=s(51672),I=s(78600),U=s(40604),G=s(9240),O=s(24112),F=function(ne){return ne[ne.null=0]="null",ne[ne.read=1]="read",ne[ne.write=2]="write",ne}(F||{}),r=s(34896),ie=s(33712);let ae=(()=>{class ne{http;authService;languageService;config;messageService;storageService;exportService;route;context$=new a.g(void 0);contexts$=new a.g({ours:[]});defaultContextId$=new a.g(void 0);editedContext$=new a.g(void 0);importedContext=[];toolsChanged$=new q.E;mapViewFromRoute={};options;baseUrl;tools;toolbar;get defaultContextUri(){return this.storageService.get("favorite.context.uri")||this._defaultContextUri||this.options.defaultContextUri}set defaultContextUri(f){this._defaultContextUri=f}_defaultContextUri;constructor(f,H,Z,_e,we,We,gt,Ot){this.http=f,this.authService=H,this.languageService=Z,this.config=_e,this.messageService=we,this.storageService=We,this.exportService=gt,this.route=Ot,this.options=Object.assign({basePath:"contexts",contextListFile:"_contexts.json",defaultContextUri:"_default"},this.config.getConfig("context")),this.baseUrl=this.options.url??"",this.readParamsFromRoute(),this.authService.hasAuthService?this.authService.logged$.subscribe(lt=>{lt&&(this.contexts$.pipe((0,u.s)(1),(0,S.K)()).subscribe(kt=>{this.handleContextsChange()}),this.loadContexts())}):(this.loadContexts(),this.handleContextsChange(!1))}get(f,H){let Z=this.baseUrl+"/contexts";return f&&this.authService.authenticated&&(Z+="?permission="+f.join(),H&&(Z+="&hidden=true")),this.http.get(Z)}getById(f){return this.http.get(this.baseUrl+"/contexts/"+f)}getDetails(f){return this.http.get(`${this.baseUrl}/contexts/${f}/details`).pipe((0,P.a)(Z=>{throw this.handleError(Z,f),Z}))}getDefault(){if(this.authService.authenticated)return this.http.get(this.baseUrl+"/contexts/default").pipe((0,I.y)(H=>{this.defaultContextId$.next(H.id)}));{const f=this.storageService.get("favorite.context.uri");return this.defaultContextId$.next(f),this.getContextByUri(f)}}getProfilByUser(){return this.baseUrl?this.http.get(this.baseUrl+"/profils?"):(0,_.of)([])}setDefault(f){return this.authService.authenticated?this.http.post(this.baseUrl+"/contexts/default",{defaultContextId:f}):(this.storageService.set("favorite.context.uri",f),(0,_.of)(void 0))}hideContext(f){return this.http.post(this.baseUrl+"/contexts/"+f+"/hide",{})}showContext(f){return this.http.post(this.baseUrl+"/contexts/"+f+"/show",{})}delete(f,H=!1){const Z={ours:[]};return Object.keys(this.contexts$.value).forEach(we=>Z[we]=this.contexts$.value[we].filter(We=>We.id!==f)),H?(this.importedContext=this.importedContext.filter(we=>we.id!==f),(0,_.of)(this.contexts$.next(Z))):this.http.delete(this.baseUrl+"/contexts/"+f).pipe((0,I.y)(we=>{this.contexts$.next(Z)}))}create(f){return this.http.post(this.baseUrl+"/contexts",f).pipe((0,U.k)(Z=>(Z.permission=this.authService.authenticated?F[F.write]:F[F.read],this.contexts$.value.ours.unshift(Z),this.contexts$.next(this.contexts$.value),Z)))}clone(f,H={}){return this.http.post(this.baseUrl+"/contexts/"+f+"/clone",H).pipe((0,U.k)(_e=>(_e.permission=F[F.write],this.contexts$.value.ours.unshift(_e),this.contexts$.next(this.contexts$.value),_e)))}update(f,H){return this.http.patch(this.baseUrl+"/contexts/"+f,H)}addToolAssociation(f,H){return this.http.post(`${this.baseUrl}/contexts/${f}/tools`,{toolId:H})}deleteToolAssociation(f,H){return this.http.delete(`${this.baseUrl}/contexts/${f}/tools/${H}`)}getPermissions(f){return this.http.get(this.baseUrl+"/contexts/"+f+"/permissions")}addPermissionAssociation(f,H,Z){return this.http.post(`${this.baseUrl}/contexts/${f}/permissions`,{profil:H,typePermission:Z}).pipe((0,P.a)(We=>{throw this.handleError(We,void 0,!0),[We]}))}deletePermissionAssociation(f,H){return this.http.delete(`${this.baseUrl}/contexts/${f}/permissions/${H}`)}getLocalContexts(){const f=this.getPath(this.options.contextListFile);return this.http.get(f).pipe((0,U.k)(H=>({ours:H})))}getLocalContext(f){const H=this.getPath(`${f}.json`);return this.http.get(H).pipe((0,G.O)(Z=>{if(!Z.base)return(0,_.of)(Z);const _e=this.getPath(`${Z.base}.json`);return this.http.get(_e).pipe((0,U.k)(we=>{const We=Z;return We.map=X.Yv.mergeDeep(we.map,Z.map),We.layers=(we.layers||[]).concat(Z.layers||[]).reverse().filter((gt,Ot,lt)=>!gt.id||lt.findIndex(kt=>kt.id===gt.id)===Ot).reverse(),We.toolbar=Z.toolbar||we.toolbar,We.message=Z.message||we.message,We.messages=Z.messages||we.messages,We.tools=(Z.tools||[]).concat(we.tools||[]).filter((gt,Ot,lt)=>lt.findIndex(kt=>kt.name===gt.name)===Ot),We}),(0,P.a)(we=>{throw this.handleError(we,f),we}))}),(0,P.a)(Z=>{throw this.handleError(Z,f),Z}))}loadContexts(f,H){let Z;Z=this.baseUrl?this.get(f,H):this.getLocalContexts(),Z.subscribe(_e=>{_e.ours=this.importedContext.concat(_e.ours),this.contexts$.next(_e)})}loadDefaultContext(){const f=(H=!1)=>{!H&&this.baseUrl&&this.authService.authenticated?this.getDefault().subscribe(Z=>{this.defaultContextUri=Z.uri,this.addContextToList(Z),this.setContext(Z)},()=>{this.defaultContextId$.next(void 0),this.loadContext(this.defaultContextUri)}):this.loadContext(this.defaultContextUri)};this.route&&this.route.options.contextKey?this.route.queryParams.pipe((0,O.o)(100)).subscribe(H=>{const Z=H[this.route.options.contextKey];let _e=!1;Z&&(this.defaultContextUri=Z,_e=!0),f(_e)}):f()}loadContext(f){const H=this.context$.value;H&&H.uri===f||this.getContextByUri(f).pipe((0,S.K)()).subscribe(Z=>{this.addContextToList(Z),this.setContext(Z)},Z=>{f!==this.options.defaultContextUri&&this.loadContext(this.options.defaultContextUri)})}setContext(f){this.handleContextMessage(f);const H=this.context$.value;if(H&&f&&f.id===H.id)return void 0===f.map.view.keepCurrentView&&(f.map.view.keepCurrentView=!0),void this.context$.next(f);f.map||(f.map={view:{}}),Object.assign(f.map.view,this.mapViewFromRoute),this.context$.next(f)}loadEditedContext(f){this.getContextByUri(f).subscribe(H=>{this.setEditedContext(H)})}setEditedContext(f){this.editedContext$.next(f)}getContextFromMap(f,H){const Z=f.ol.getView(),_e=Z.getProjection().getCode(),we=new z.c(Z.getCenter()).transform(_e,"EPSG:4326"),We={uri:(0,X.uq)(),title:"",scope:"private",map:{view:{center:we.getCoordinates(),zoom:Z.getZoom(),projection:_e,maxZoomOnExtent:f.viewController.maxZoomOnExtent}},layers:[],tools:[]};let gt=[];gt=!0===H?f.layers$.getValue().filter(lt=>!0===lt.baseLayer||"searchPointerSummaryId"===lt.options.id).sort((lt,kt)=>lt.zIndex-kt.zIndex):f.layers$.getValue().filter(lt=>!lt.id.includes("WfsWorkspaceTableDest")).sort((lt,kt)=>lt.zIndex-kt.zIndex);let Ot=0;for(const lt of gt){const kt={title:lt.options.title,zIndex:++Ot,visible:lt.visible,security:lt.options.security,opacity:lt.opacity},Pt={id:lt.options.id?String(lt.options.id):void 0,layerOptions:kt,sourceOptions:{type:lt.dataSource.options.type,params:lt.dataSource.options.params,url:lt.dataSource.options.url,queryable:lt.queryable}};Pt.sourceOptions.type&&We.layers.push(Pt)}return We.tools=this.tools.map(lt=>({id:String(lt.id),global:lt.global})),We}getContextFromLayers(f,H,Z,_e){const we=this.context$.getValue(),We=f.ol.getView(),gt=We.getProjection().getCode(),lt={uri:Z,title:Z,map:{view:{center:new z.c(We.getCenter()).transform(gt,"EPSG:4326").getCoordinates(),zoom:We.getZoom(),projection:gt,keepCurrentView:_e}},layers:[],toolbar:[],tools:[],extraFeatures:[]},kt=f.layers$.getValue();return lt.layers=kt.filter(Pt=>Pt.baseLayer).map(Pt=>({baseLayer:!0,sourceOptions:Pt.options.sourceOptions,title:Pt.options.title,visible:Pt.visible})),H.forEach(Pt=>{const no=we.layers.find(Xt=>{const Fo=Xt.source;return Fo&&Pt.id===Fo.id&&!Xt.baseLayer});if(no){let Xt=no,Fo=Xt.style;Xt.igoStyle?.styleByAttribute?Fo=void 0:Xt.igoStyle?.clusterBaseStyle&&(Fo=void 0,delete no.sourceOptions.source,delete no.sourceOptions.format),lt.layers.push({baseLayer:no.baseLayer,title:Pt.options.title,zIndex:Pt.zIndex,igoStyle:{styleByAttribute:Xt.igoStyle?.styleByAttribute,clusterBaseStyle:Xt.igoStyle?.clusterBaseStyle},style:Fo,clusterParam:no.clusterParam,visible:Pt.visible,opacity:Pt.opacity,sourceOptions:no.sourceOptions})}else if(Pt.ol.getSource()instanceof A.c){const Xt=this.getExtraFeatures(Pt);Xt.name=Pt.options.title,Xt.opacity=Pt.opacity,Xt.visible=Pt.visible,lt.extraFeatures.push(Xt)}else{const Xt=Pt.options;Xt.zIndex=Pt.zIndex,Xt.visible=Pt.visible,Xt.opacity=Pt.opacity,delete Xt.source,lt.layers.push(Xt)}}),lt.toolbar=this.toolbar,lt.tools=this.tools,lt}getExtraFeatures(f){const H=new V.c;let Z;f.ol.getSource()instanceof W.c?(Z=f.ol.getSource().getFeatures(),Z=Z.flatMap(gt=>gt.get("features"))):Z=f.ol.getSource().getFeatures();const _e=this.exportService.generateFeature(Z,"GeoJSON","_featureStore"),we=H.writeFeatures(_e,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});return JSON.parse(we)}setTools(f){this.tools=f}setToolbar(f){this.toolbar=f}handleContextMessage(f){this.context$.value&&f.uri&&this.context$.value.uri!==f.uri&&this.messageService.removeAllAreNotError(),f.messages=f.messages?f.messages:[],f.messages.push(f.message),f.messages.map(H=>{H&&this.messageService.message(H)})}getContextByUri(f){if(this.baseUrl){let Z;for(const we of Object.keys(this.contexts$.value))if(Z=this.contexts$.value[we].find(We=>We.uri===f),Z)break;return Z&&Z.imported?(0,_.of)(Z):this.getDetails(Z?Z.id:f)}const H=this.contexts$.value.ours.find(Z=>Z.uri===f&&!0===Z.imported);return H?(0,_.of)(H):this.getLocalContext(f)}getContextLayers(f){const H=[];return f.layers$.getValue().forEach(_e=>{!_e.baseLayer&&"searchPointerSummaryId"!==_e.options.id&&H.push(_e)}),H}readParamsFromRoute(){this.route&&this.route.queryParams.subscribe(f=>{const H=this.route.options.centerKey;H&&f[H]&&(this.mapViewFromRoute.center=f[H].split(",").map(Number));const Z=this.route.options.projectionKey;Z&&f[Z]&&(this.mapViewFromRoute.projection=f[Z]);const _e=this.route.options.zoomKey;_e&&f[_e]&&(this.mapViewFromRoute.zoom=Number(f[_e]))})}getPath(f){return`${this.options.basePath.replace(/\/$/,"")}/${f}`}handleError(f,H,Z){const _e=this.contexts$.value.ours.find(We=>We.uri===H),we=_e?_e.title:H;f.error.title=this.languageService.translate.instant("igo.context.contextManager.invalid.title"),f.error.message=this.languageService.translate.instant("igo.context.contextManager.invalid.text",{value:we}),f.error.toDisplay=!0,Z&&(f.error.title=this.languageService.translate.instant("igo.context.contextManager.errors.addPermissionTitle"),f.error.message=this.languageService.translate.instant("igo.context.contextManager.errors.addPermission")),this.messageService.error("igo.context.contextManager.errors.addPermission","igo.context.contextManager.errors.addPermissionTitle")}handleContextsChange(f=!0){const H=this.context$.value,Z=this.editedContext$.value;(!H||H.uri===this.options.defaultContextUri)&&(f=!1),f&&this.findContext(H)?(this.getContextByUri(H.uri).pipe((0,S.K)()).subscribe(we=>{this.toolsChanged$.next(we)}),this.baseUrl&&this.authService.authenticated&&this.getDefault().subscribe()):(this.defaultContextUri=void 0,this.loadDefaultContext());const _e=this.findContext(Z);(!_e||"write"!==_e.permission)&&this.setEditedContext(void 0)}addContextToList(f){this.findContext(f)||this.contexts$.value&&this.contexts$.value.public&&(this.contexts$.value.public.push({id:f.id,uri:f.uri,title:f.title,scope:f.scope,permission:F[F.read]}),this.contexts$.next(this.contexts$.value))}findContext(f){if(!f)return!1;const H=this.contexts$.value;let Z;for(const _e of Object.keys(H))if(Z=H[_e].find(We=>f.id&&We.id===f.id||f.uri&&We.uri===f.uri),Z)break;return Z}static \u0275fac=function(H){return new(H||ne)(r.CoB(ie.KK),r.CoB(M.oj),r.CoB(L.ov),r.CoB(b.aW),r.CoB(E.mi),r.CoB(N.yQ),r.CoB(B.YNI),r.CoB(oe.k$,8))};static \u0275prov=r.wxM({token:ne,factory:ne.\u0275fac,providedIn:"root"})}return ne})();var fe=s(21296);class le extends Error{}class se extends le{constructor(){super("Nothing to export"),Object.setPrototypeOf(this,se.prototype)}}let ge=(()=>{class ne{export(f){return this.exportAsync(f)}exportAsync(f){return new fe._(Z=>{if(!0===this.nothingToExport(f))return void Z.error(new se);const we=JSON.stringify(f);(0,X.We)(we,"text/json;charset=utf-8",`${f.uri}.json`),Z.complete()})}nothingToExport(f){return void 0===f.map}static \u0275fac=function(H){return new(H||ne)};static \u0275prov=r.wxM({token:ne,factory:ne.\u0275fac,providedIn:"root"})}return ne})();class ht extends Error{}class rt extends ht{constructor(){super("Invalid file"),Object.setPrototypeOf(this,rt.prototype)}}class xt extends ht{constructor(){super("Failed to read file"),Object.setPrototypeOf(this,xt.prototype)}}class Rt extends ht{constructor(){super("Nothing to import"),Object.setPrototypeOf(this,Rt.prototype)}}class Ze extends ht{constructor(){super("File is too large"),Object.setPrototypeOf(this,Rt.prototype)}}function Ne(ne,Ye,f){f.error("igo.context.contextImportExport.import.invalid.text","igo.context.contextImportExport.import.invalid.title",void 0,{value:ne.name,mimeType:ne.type})}function Ae(ne,Ye,f,H){f.error("igo.context.contextImportExport.import.tooLarge.text","igo.context.contextImportExport.import.tooLarge.title",void 0,{value:ne.name,size:H})}function dt(ne,Ye,f){f.error("igo.context.contextImportExport.import.unreadable.text","igo.context.contextImportExport.import.unreadable.title",void 0,{value:ne.name})}function Be(ne){return(new V.c).readFeatures(ne,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})}let ze=(()=>{class ne{config;static allowedMimeTypes=["application/json"];static allowedExtensions="json";clientSideFileSizeMax;constructor(f){this.config=f;const H=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(H||30)*Math.pow(1024,2)}import(f){return this.importAsync(f)}getFileImporter(f){const H=function yt(ne){return ne.name.split(".").pop().toLowerCase()}(f),Z=f.type,_e=[...ne.allowedMimeTypes],we=ne.allowedExtensions;if(!(_e.indexOf(Z)<0&&we.indexOf(H)<0||"application/json"!==Z&&H!==ne.allowedExtensions))return this.importFile}importAsync(f){return new fe._(Z=>{if(f.size>=this.clientSideFileSizeMax)return void Z.error(new Ze);const _e=this.getFileImporter(f);void 0!==_e?_e.call(this,f,Z):Z.error(new rt)})}importFile(f,H){const Z=new FileReader;Z.onload=_e=>{try{const we=this.parseContextFromFile(f,_e.target.result);H.next(we)}catch{H.error(new xt)}H.complete()},Z.onerror=_e=>{H.error(new xt)},Z.readAsText(f,"UTF-8")}parseContextFromFile(f,H){return JSON.parse(H)}static \u0275fac=function(H){return new(H||ne)(r.CoB(b.aW))};static \u0275prov=r.wxM({token:ne,factory:ne.\u0275fac,providedIn:"root"})}return ne})();const St=ne=>({size:ne});function Dt(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"div")(1,"form",5)(2,"div",6)(3,"button",7),r.qCj("click",function(){r.usT(f);const Z=r.Gew(10);return r.CGJ(Z.click())}),r.wVc(4,"async"),r.OEk(5),r.wVc(6,"translate"),r.C$Y(),r.wR5(7,"igo-spinner",8),r.wVc(8,"async"),r.I0R(9,"input",9,10),r.qCj("click",function(){r.usT(f);const Z=r.Gew(10);return r.CGJ(Z.value=null)})("change",function(Z){r.usT(f);const _e=r.GaO();return r.CGJ(_e.importFiles(Z.target.files))}),r.C$Y()()(),r.I0R(11,"section",11)(12,"h4"),r.OEk(13),r.wVc(14,"translate"),r.C$Y(),r.I0R(15,"ul")(16,"li"),r.OEk(17),r.wVc(18,"translate"),r.C$Y()()()()}if(2&ne){const f=r.GaO();r.yG2(3),r.E7m("disabled",r.kDX(4,7,f.loading$)),r.yG2(2),r.oRS(" ",r.kDX(6,9,"igo.geo.importExportForm.importButton")," "),r.yG2(2),r.E7m("shown",r.kDX(8,11,f.loading$)),r.yG2(2),r.m4B("display","none"),r.yG2(4),r.cNF(r.kDX(14,13,"igo.geo.importExportForm.importClarifications")),r.yG2(4),r.oRS(" ",r.g7$(18,15,"igo.geo.importExportForm.importSizeMax",r.S45(18,St,f.fileSizeMb))," ")}}function mo(ne,Ye){if(1&ne&&(r.I0R(0,"mat-option",2),r.OEk(1),r.C$Y()),2&ne){const f=Ye.$implicit;r.E7m("value",f),r.yG2(),r.cNF(f.title)}}function Bo(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"form",12)(1,"div",13)(2,"mat-form-field",14)(3,"mat-label"),r.OEk(4),r.wVc(5,"translate"),r.C$Y(),r.wR5(6,"input",15),r.C$Y()(),r.I0R(7,"div",13)(8,"mat-form-field")(9,"mat-label"),r.OEk(10),r.wVc(11,"translate"),r.C$Y(),r.I0R(12,"mat-select",16)(13,"mat-option",17,18),r.qCj("click",function(){r.usT(f);const Z=r.Gew(14),_e=r.GaO();return r.CGJ(_e.selectAll(Z))}),r.OEk(15),r.wVc(16,"translate"),r.C$Y(),r.wR5(17,"mat-divider"),r.yuY(18,mo,2,2,"mat-option",19),r.C$Y()()(),r.I0R(19,"div",6)(20,"button",7),r.qCj("click",function(){r.usT(f);const Z=r.GaO();return r.CGJ(Z.handleExportFormSubmit(Z.form.value))}),r.wVc(21,"async"),r.OEk(22),r.wVc(23,"translate"),r.C$Y(),r.wR5(24,"igo-spinner",8),r.wVc(25,"async"),r.C$Y()()}if(2&ne){const f=r.GaO();r.E7m("formGroup",f.form),r.yG2(4),r.cNF(r.kDX(5,9,"igo.context.contextImportExport.export.exportContextName")),r.yG2(6),r.cNF(r.kDX(11,11,"igo.context.contextImportExport.export.exportPlaceHolder")),r.yG2(3),r.E7m("value",1),r.yG2(2),r.oRS(" ",r.kDX(16,13,"igo.context.contextImportExport.export.exportSelectAll")," "),r.yG2(3),r.E7m("ngForOf",f.userControlledLayerList),r.yG2(2),r.E7m("disabled",!f.form.valid||r.kDX(21,15,f.loading$)),r.yG2(2),r.oRS(" ",r.kDX(23,17,"igo.geo.importExportForm.exportButton")," "),r.yG2(2),r.E7m("shown",r.kDX(25,19,f.loading$))}}let Xe=(()=>{class ne{contextImportService;contextExportService;messageService;formBuilder;config;contextService;form;layers;inputProj="EPSG:4326";loading$=new a.g(!1);forceNaming=!1;layerList;userControlledLayerList;res;clientSideFileSizeMax;fileSizeMb;activeImportExport="import";layers$$;map;constructor(f,H,Z,_e,we,We){this.contextImportService=f,this.contextExportService=H,this.messageService=Z,this.formBuilder=_e,this.config=we,this.contextService=We,this.buildForm()}ngOnInit(){const f=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(f||30)*Math.pow(1024,2),this.fileSizeMb=this.clientSideFileSizeMax/Math.pow(1024,2),this.layers$$=this.map.layers$.subscribe(()=>{this.layerList=this.contextService.getContextLayers(this.map),this.userControlledLayerList=this.layerList.filter(H=>H.showInLayerList)})}importFiles(f){this.loading$.next(!0);for(const H of f)this.contextImportService.import(H).pipe((0,K.U)(1)).subscribe(Z=>this.onFileImportSuccess(H,Z),Z=>this.onFileImportError(H,Z),()=>{this.loading$.next(!1)})}handleExportFormSubmit(f){this.loading$.next(!0),this.res=this.contextService.getContextFromLayers(this.map,f.layers,f.name,!1),this.res.imported=!0,this.contextExportService.export(this.res).pipe((0,K.U)(1)).subscribe(()=>{},H=>this.onFileExportError(H),()=>{this.onFileExportSuccess(),this.loading$.next(!1)})}buildForm(){this.form=this.formBuilder.group({layers:["",[e.AQ.required]],name:["",[e.AQ.required]]})}onFileImportSuccess(f,H){!function ve(ne,Ye,f,H){if(Object.keys(Ye).length<=0)return void function je(ne,Ye){Ye.error("igo.context.contextImportExport.import.empty.text","igo.context.contextImportExport.import.empty.title",void 0,{value:ne.name})}(ne,f);const Z=function Le(ne){return ne.name.substr(0,ne.name.lastIndexOf("."))}(ne);(function Ke(ne,Ye,f){ne.title=Ye,ne.imported=!0,f.contexts$.value.ours.unshift(ne),f.contexts$.next(f.contexts$.value),f.importedContext.unshift(ne),f.loadContext(ne.uri)})(Ye,Z,H),f.success("igo.context.contextImportExport.import.success.text","igo.context.contextImportExport.import.success.title",void 0,{value:Z})}(f,H,this.messageService,this.contextService)}onFileImportError(f,H){this.loading$.next(!1),function $e(ne,Ye,f,H){({"Invalid file":Ne,"File is too large":Ae,"Failed to read file":dt})[Ye.message](ne,Ye,f,H=H||30)}(f,H,this.messageService,this.fileSizeMb)}onFileExportError(f){this.loading$.next(!1),function Ie(ne,Ye){ne instanceof se?this.handleNothingToExportError(Ye):Ye.error("igo.context.contextImportExport.export.failed.text","igo.context.contextImportExport.export.failed.title")}(f,this.messageService)}onFileExportSuccess(){!function Re(ne){ne.success("igo.context.contextImportExport.export.success.text","igo.context.contextImportExport.export.success.title")}(this.messageService)}selectAll(f){f._selected&&(this.form.controls.layers.setValue(this.userControlledLayerList),f._selected=!0),!1===f._selected&&this.form.controls.layers.setValue([])}onImportExportChange(f){this.activeImportExport=f.value}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(H){return new(H||ne)(r.GI1(ze),r.GI1(ge),r.GI1(E.mi),r.GI1(e.KE),r.GI1(b.aW),r.GI1(ae))};static \u0275cmp=r.In1({type:ne,selectors:[["igo-context-import-export"]],inputs:{map:"map"},standalone:!0,features:[r.UHJ],decls:10,vars:11,consts:[[1,"import-export-toggle","mat-typography"],[3,"value","change"],[3,"value"],[4,"ngIf"],["class","igo-form",3,"formGroup",4,"ngIf"],[1,"igo-form"],[1,"igo-form-button-group"],["mat-raised-button","","type","button",3,"disabled","click"],[3,"shown"],["type","file",3,"click","change"],["fileInput",""],[1,"mat-typography"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],[1,"example-full-width"],["formControlName","name","matInput","",3,"value"],["formControlName","layers","multiple",""],[3,"value","click"],["e",""],[3,"value",4,"ngFor","ngForOf"]],template:function(H,Z){1&H&&(r.I0R(0,"div",0)(1,"mat-button-toggle-group",1),r.qCj("change",function(we){return Z.onImportExportChange(we)}),r.I0R(2,"mat-button-toggle",2),r.OEk(3),r.wVc(4,"translate"),r.C$Y(),r.I0R(5,"mat-button-toggle",2),r.OEk(6),r.wVc(7,"translate"),r.C$Y()()(),r.yuY(8,Dt,19,20,"div",3)(9,Bo,26,21,"form",4)),2&H&&(r.yG2(),r.E7m("value",Z.activeImportExport),r.yG2(),r.E7m("value","import"),r.yG2(),r.oRS(" ",r.kDX(4,7,"igo.geo.importExportForm.importTabTitle")," "),r.yG2(2),r.E7m("value","export"),r.yG2(),r.oRS(" ",r.kDX(7,9,"igo.geo.importExportForm.exportTabTitle")," "),r.yG2(2),r.E7m("ngIf","import"===Z.activeImportExport),r.yG2(),r.E7m("ngIf","export"===Z.activeImportExport))},dependencies:[g.ue,g.gn,g.KU,y.u_,e.y,e.sz,e.ot,e.ue,e.u,e.SC,d.oJ,d.Gw,w.is,e.sl,e.uW,e.Wo,h.wb,h.Up,h.w5,j.cN,j.yi,x.d5,x.kX,R.I5,R.Ax,o.U,o.k,y.Iw,y.a,T.O0,T.sD],styles:[".import-export-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}.import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}.igo-input-container[_ngcontent-%COMP%]{padding:10px}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}h4[_ngcontent-%COMP%]{padding:0 5px}.igo-form[_ngcontent-%COMP%]{padding:15px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}igo-spinner[_ngcontent-%COMP%]{position:absolute;padding-left:10px}"]})}return ne})();var tt=s(32328),st=s(27e3);function it(ne,Ye){if(1&ne&&(r.I0R(0,"span",11),r.OEk(1),r.C$Y()),2&ne){const f=r.GaO();r.yG2(),r.oRS("",f.prefix,"-")}}let Ri=(()=>{class ne{formBuilder;messageService;form;prefix;get btnSubmitText(){return this._btnSubmitText}set btnSubmitText(f){this._btnSubmitText=f}_btnSubmitText;get context(){return this._context}set context(f){this._context=f,this.buildForm()}_context;get disabled(){return this._disabled}set disabled(f){this._disabled=f}_disabled=!1;submitForm=new r._w7;clone=new r._w7;delete=new r._w7;constructor(f,H){this.formBuilder=f,this.messageService=H}ngOnInit(){this.buildForm()}handleFormSubmit(f){let H=Object.assign({},f);H=X.Yv.removeNull(H),H.uri=H.uri.replace(" ",""),H.uri=H.uri?this.prefix+"-"+H.uri:this.prefix,this.submitForm.emit(H)}copyTextToClipboard(){const f=this.prefix+"-"+this.form.value.uri.replace(" ","");X._D.copy(f)&&this.messageService.success("igo.context.contextManager.dialog.copyMsg","igo.context.contextManager.dialog.copyTitle")}buildForm(){const f=this.context||{},H=f.uri.split("-");this.prefix=H.shift();const Z=H.join("-");this.form=this.formBuilder.group({title:[f.title],uri:[Z||" "]})}static \u0275fac=function(H){return new(H||ne)(r.GI1(e.KE),r.GI1(E.mi))};static \u0275cmp=r.In1({type:ne,selectors:[["igo-context-form"]],inputs:{btnSubmitText:"btnSubmitText",context:"context",disabled:"disabled"},outputs:{submitForm:"submitForm",clone:"clone",delete:"delete"},standalone:!0,features:[r.UHJ],decls:19,vars:18,consts:[[1,"igo-form",3,"formGroup","ngSubmit"],[1,"full-width"],["matInput","","required","","maxlength","128","formControlName","title",3,"placeholder"],["id","uriInput",1,"full-width"],["class","prefix",4,"ngIf"],[1,"fieldWrapper"],["matInput","","maxlength","64","floatLabel","always","formControlName","uri",3,"placeholder"],["id","copyButton","type","button","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click"],["svgIcon","content-copy"],[1,"igo-form-button-group"],["mat-raised-button","","type","submit",3,"disabled"],[1,"prefix"]],template:function(H,Z){1&H&&(r.I0R(0,"form",0),r.qCj("ngSubmit",function(){return Z.handleFormSubmit(Z.form.value)}),r.I0R(1,"mat-form-field",1),r.wR5(2,"input",2),r.wVc(3,"translate"),r.I0R(4,"mat-error"),r.OEk(5),r.wVc(6,"translate"),r.C$Y()(),r.I0R(7,"mat-form-field",3),r.yuY(8,it,2,1,"span",4),r.I0R(9,"span",5),r.wR5(10,"input",6),r.wVc(11,"translate"),r.C$Y()(),r.I0R(12,"button",7),r.qCj("click",function(){return Z.copyTextToClipboard()}),r.wVc(13,"translate"),r.wR5(14,"mat-icon",8),r.C$Y(),r.I0R(15,"div",9)(16,"button",10),r.OEk(17),r.wVc(18,"translate"),r.C$Y()()()),2&H&&(r.E7m("formGroup",Z.form),r.yG2(2),r.E7m("placeholder",r.kDX(3,8,"igo.context.contextManager.form.title")),r.yG2(3),r.oRS(" ",r.kDX(6,10,"igo.context.contextManager.form.titleRequired")," "),r.yG2(3),r.E7m("ngIf",Z.prefix),r.yG2(2),r.E7m("placeholder",r.kDX(11,12,"igo.context.contextManager.form.uri")),r.yG2(2),r.E7m("matTooltip",r.kDX(13,14,"igo.context.contextManager.form.copy")),r.yG2(4),r.E7m("disabled",!Z.form.valid||Z.disabled),r.yG2(),r.oRS(" ",r.kDX(18,16,"igo.context.contextManager.form.edit")," "))},dependencies:[e.y,e.sz,e.ot,e.ue,e.u,e.eJ,e.Mj,e.sl,e.uW,e.Wo,h.wb,h.Up,h.wJ,j.cN,j.yi,y.u_,d.oJ,d.Gw,d.um,st.KO,st.a4,tt.oB,tt.qL,T.O0,T.sD],styles:["form[_ngcontent-%COMP%]{margin:10px}.full-width[_ngcontent-%COMP%]{width:100%}#uriInput[_ngcontent-%COMP%]   .fieldWrapper[_ngcontent-%COMP%]{display:block;overflow:hidden}#uriInput[_ngcontent-%COMP%]   .prefix[_ngcontent-%COMP%]{float:left}#copyButton[_ngcontent-%COMP%]{width:24px;float:right;position:relative;top:-58px;left:5px}"]})}return ne})();function Qt(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"igo-context-form",1),r.qCj("submitForm",function(Z){r.usT(f);const _e=r.GaO();return r.CGJ(_e.submitForm.emit(Z))}),r.wVc(1,"translate"),r.C$Y()}if(2&ne){const f=r.GaO();r.E7m("btnSubmitText",r.kDX(1,2,"igo.context.contextManager.save"))("context",f.context)}}let ao=(()=>{class ne{cd;get context(){return this._context}set context(f){this._context=f,this.refresh()}_context;submitForm=new r._w7;constructor(f){this.cd=f}refresh(){this.cd.detectChanges()}static \u0275fac=function(H){return new(H||ne)(r.GI1(r.kD9))};static \u0275cmp=r.In1({type:ne,selectors:[["igo-context-edit"]],inputs:{context:"context"},outputs:{submitForm:"submitForm"},standalone:!0,features:[r.UHJ],decls:1,vars:1,consts:[[3,"btnSubmitText","context","submitForm",4,"ngIf"],[3,"btnSubmitText","context","submitForm"]],template:function(H,Z){1&H&&r.yuY(0,Qt,2,4,"igo-context-form",0),2&H&&r.E7m("ngIf",Z.context)},dependencies:[y.u_,Ri,T.O0,T.sD],encapsulation:2})}return ne})();var mt=s(63916);function $t(ne,Ye){if(1&ne&&r.wR5(0,"mat-icon",7),2&ne){const f=r.GaO(2);r._6D("svgIcon",f.context.icon?f.context.icon:"public"===f.context.scope?"earth":"star")}}function Lo(ne,Ye){if(1&ne&&r.wR5(0,"img",8),2&ne){const f=r.GaO(2);r.E7m("src",f.context.iconImage,r.K6U)}}function Uo(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",4),r.qCj("click",function(){r.usT(f);const Z=r.GaO();return r.CGJ(Z.favoriteClick(Z.context))}),r.wVc(1,"translate"),r.yuY(2,$t,1,1,"mat-icon",5)(3,Lo,1,1,"img",6),r.C$Y()}if(2&ne){const f=r.GaO();r.E7m("matTooltip",f.auth.authenticated?r.kDX(1,4,"igo.context.contextManager.favorite"):"")("color",f.default?"primary":"default"),r.yG2(2),r.E7m("ngIf",!f.context.iconImage),r.yG2(),r.E7m("ngIf",f.context.iconImage)}}function Si(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",4),r.qCj("click",function(){r.usT(f);const Z=r.GaO();return r.CGJ(Z.favoriteClick(Z.context))}),r.wVc(1,"translate"),r.wR5(2,"mat-icon",9),r.C$Y()}if(2&ne){const f=r.GaO();r.E7m("matTooltip",r.kDX(1,2,"igo.context.contextManager.favorite"))("color",f.default?"primary":"default")}}function Bt(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",21),r.qCj("click",function(){r.usT(f);const Z=r.GaO(2);return r.CGJ(Z.save.emit(Z.context))}),r.wVc(1,"translate"),r.wR5(2,"mat-icon",22),r.C$Y()}if(2&ne){const f=r.GaO(2);r.E7m("matTooltip",r.kDX(1,2,"igo.context.contextManager.save"))("color",f.color)}}function eo(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",23),r.qCj("click",function(){r.usT(f);const Z=r.GaO(2);return r.CGJ(Z.managePermissions.emit(Z.context))}),r.wVc(1,"translate"),r.wR5(2,"mat-icon",24),r.C$Y()}if(2&ne){const f=r.GaO(2);r.E7m("matTooltip",r.kDX(1,2,"igo.context.contextManager.managePermissions"))("color",f.color)}}function uo(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",25),r.qCj("click",function(){r.usT(f);const Z=r.GaO(2);return r.CGJ(Z.clone.emit(Z.context))}),r.wVc(1,"translate"),r.wR5(2,"mat-icon",26),r.C$Y()}if(2&ne){const f=r.GaO(2);r.E7m("matTooltip",r.kDX(1,2,"igo.context.contextManager.clone"))("color",f.color)}}function zt(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",27),r.qCj("click",function(){r.usT(f);const Z=r.GaO(2);return r.CGJ(Z.edit.emit(Z.context))}),r.wVc(1,"translate"),r.wR5(2,"mat-icon",28),r.C$Y()}if(2&ne){const f=r.GaO(2);r.E7m("color",f.color)("matTooltip",r.kDX(1,2,"igo.context.contextManager.edit"))}}function qt(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",29),r.qCj("click",function(){r.usT(f);const Z=r.GaO(2);return r.CGJ(Z.hide.emit(Z.context))}),r.wVc(1,"translate"),r.wR5(2,"mat-icon",30),r.C$Y()}if(2&ne){const f=r.GaO(2);r.E7m("color",f.color)("matTooltip",r.kDX(1,2,"igo.context.contextManager.hide"))}}function Te(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",29),r.qCj("click",function(){r.usT(f);const Z=r.GaO(2);return r.CGJ(Z.show.emit(Z.context))}),r.wVc(1,"translate"),r.wR5(2,"mat-icon",31),r.C$Y()}if(2&ne){const f=r.GaO(2);r.E7m("color",f.color)("matTooltip",r.kDX(1,2,"igo.context.contextManager.show"))}}function ut(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",32),r.qCj("click",function(){r.usT(f);const Z=r.GaO(2);return r.CGJ(Z.delete.emit(Z.context))}),r.wVc(1,"translate"),r.wR5(2,"mat-icon",33),r.C$Y()}2&ne&&r.E7m("matTooltip",r.kDX(1,1,"igo.context.contextManager.delete"))}function pe(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"div",10),r.yuY(1,Bt,3,4,"button",11),r.I0R(2,"div",12,13),r.yuY(4,eo,3,4,"button",14)(5,uo,3,4,"button",15)(6,zt,3,4,"button",16)(7,qt,3,4,"button",17)(8,Te,3,4,"button",17)(9,ut,3,3,"button",18),r.C$Y(),r.I0R(10,"button",19),r.qCj("click",function(){r.usT(f);const Z=r.GaO();return r.CGJ(Z.collapsed=!Z.collapsed)}),r.wR5(11,"mat-icon",20),r.C$Y()()}if(2&ne){const f=r.Gew(3),H=r.GaO();r.yG2(),r.E7m("ngIf",H.collapsed&&H.selected&&(H.context.permission===H.typePermission[H.typePermission.write]||H.context.imported)),r.yG2(3),r.E7m("ngIf",H.canShare&&!H.context.imported),r.yG2(),r.E7m("ngIf",!H.context.imported),r.yG2(),r.E7m("ngIf",H.context.permission===H.typePermission[H.typePermission.write]&&!H.context.imported),r.yG2(),r.E7m("ngIf",!H.context.hidden&&!H.context.imported),r.yG2(),r.E7m("ngIf",H.context.hidden&&!H.context.imported),r.yG2(),r.E7m("ngIf",H.context.permission===H.typePermission[H.typePermission.write]||H.context.imported),r.yG2(),r.E7m("color",H.color)("target",f)("collapsed",H.collapsed)}}const ye=ne=>({"mat-list-item-light":ne});let xe=(()=>{class ne{auth;storageService;typePermission=F;color="primary";collapsed=!0;showFavorite=!0;context;default;selected;edit=new r._w7;delete=new r._w7;save=new r._w7;clone=new r._w7;hide=new r._w7;show=new r._w7;favorite=new r._w7;managePermissions=new r._w7;manageTools=new r._w7;get hidden(){return this.context.hidden}get canShare(){return!0===this.storageService.get("canShare")}constructor(f,H){this.auth=f,this.storageService=H}favoriteClick(f){this.favorite.emit(f)}static \u0275fac=function(H){return new(H||ne)(r.GI1(M.oj),r.GI1(N.yQ))};static \u0275cmp=r.In1({type:ne,selectors:[["igo-context-item"]],inputs:{showFavorite:"showFavorite",context:"context",default:"default",selected:"selected"},outputs:{edit:"edit",delete:"delete",save:"save",clone:"clone",hide:"hide",show:"show",favorite:"favorite",managePermissions:"managePermissions",manageTools:"manageTools"},standalone:!0,features:[r.UHJ],decls:6,vars:7,consts:[[1,"mat-list-item",3,"ngClass"],["matListItemAvatar","","mat-icon-button","","igoStopPropagation","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["matListItemTitle",""],["matListItemMeta","","igoStopPropagation","","class","igo-actions-container",4,"ngIf"],["matListItemAvatar","","mat-icon-button","","igoStopPropagation","","matTooltipShowDelay","500",3,"matTooltip","color","click"],[3,"svgIcon",4,"ngIf"],[3,"src",4,"ngIf"],[3,"svgIcon"],[3,"src"],["svgIcon","star"],["matListItemMeta","","igoStopPropagation","",1,"igo-actions-container"],["class","save-button","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],[1,"igo-actions-expand-container"],["actions",""],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["class","clone-button","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["class","edit-button","mat-icon-button","","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","hide-button","mat-icon-button","","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","delete-button","mat-icon-button","","color","warn","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","igoCollapse","",1,"actions-button",3,"color","target","collapsed","click"],["svgIcon","dots-horizontal"],["mat-icon-button","","matTooltipShowDelay","500",1,"save-button",3,"matTooltip","color","click"],["svgIcon","content-save"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","account-arrow-right"],["mat-icon-button","","matTooltipShowDelay","500",1,"clone-button",3,"matTooltip","color","click"],["svgIcon","content-copy"],["mat-icon-button","","matTooltipShowDelay","500",1,"edit-button",3,"color","matTooltip","click"],["svgIcon","pencil"],["mat-icon-button","","matTooltipShowDelay","500",1,"hide-button",3,"color","matTooltip","click"],["svgIcon","eye"],["svgIcon","eye-off"],["mat-icon-button","","color","warn","matTooltipShowDelay","500",1,"delete-button",3,"matTooltip","click"],["svgIcon","delete"]],template:function(H,Z){1&H&&(r.I0R(0,"mat-list-item",0),r.yuY(1,Uo,4,6,"button",1)(2,Si,3,4,"button",1),r.I0R(3,"span",2),r.OEk(4),r.C$Y(),r.yuY(5,pe,12,10,"div",3),r.C$Y()),2&H&&(r.E7m("ngClass",r.S45(5,ye,Z.hidden)),r.yG2(),r.E7m("ngIf",Z.auth.authenticated),r.yG2(),r.E7m("ngIf",!Z.auth.authenticated&&Z.showFavorite),r.yG2(2),r.cNF(Z.context.title),r.yG2(),r.E7m("ngIf",Z.auth.authenticated))},dependencies:[mt.iI,mt.g9,mt.EV,mt.UV,mt.At,y.QF,y.u_,d.oJ,d.um,w.mw,st.KO,st.a4,tt.oB,tt.qL,w.mK,T.O0,T.sD],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-actions-container[_ngcontent-%COMP%]{flex-shrink:0}[_nghost-%COMP%]   .igo-actions-expand-container[_ngcontent-%COMP%]{display:inline-flex}[_nghost-%COMP%]   mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}[_nghost-%COMP%]   button[matlistitemavatar][_ngcontent-%COMP%]{margin-right:8px}"],changeDetection:0})}return ne})();var Ge=s(58539),qe=s(87848),Ue=s(23680),Ut=s(69936),Me=s(25376),Lt=s(40600);let Zt=(()=>{class ne{dialogRef;title;constructor(f){this.dialogRef=f}static \u0275fac=function(H){return new(H||ne)(r.GI1(Lt.yI))};static \u0275cmp=r.In1({type:ne,selectors:[["igo-bookmark-dialog"]],standalone:!0,features:[r.UHJ],decls:14,vars:14,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],["matInput","","required","","autocomplete","off","maxlength","128",3,"placeholder","ngModel","ngModelChange"],["mat-dialog-actions",""],["mat-button","","color","primary",3,"disabled","click"],["mat-button","",3,"click"]],template:function(H,Z){1&H&&(r.I0R(0,"h1",0),r.OEk(1),r.wVc(2,"translate"),r.C$Y(),r.I0R(3,"div",1)(4,"mat-form-field")(5,"input",2),r.iHE("ngModelChange",function(we){return r.kNx(Z.title,we)||(Z.title=we),we}),r.wVc(6,"translate"),r.C$Y()()(),r.I0R(7,"div",3)(8,"button",4),r.qCj("click",function(){return Z.dialogRef.close(Z.title)}),r.OEk(9),r.wVc(10,"translate"),r.C$Y(),r.I0R(11,"button",5),r.qCj("click",function(){return Z.dialogRef.close(!1)}),r.OEk(12),r.wVc(13,"translate"),r.C$Y()()),2&H&&(r.yG2(),r.oRS(" ",r.kDX(2,6,"igo.context.bookmarkButton.dialog.title"),"\n"),r.yG2(4),r.E7m("placeholder",r.kDX(6,8,"igo.context.bookmarkButton.dialog.placeholder")),r.OKB("ngModel",Z.title),r.yG2(3),r.E7m("disabled",!Z.title),r.yG2(),r.oRS(" ",r.kDX(10,10,"igo.common.confirmDialog.confirmBtn")," "),r.yG2(3),r.oRS(" ",r.kDX(13,12,"igo.common.confirmDialog.cancelBtn")," "))},dependencies:[Lt.WQ,Lt.iU,h.wb,h.Up,j.cN,j.yi,e.y,e.ot,e.ue,e.eJ,e.Mj,e._G,Lt.Yp,d.oJ,d.Gw,T.O0,T.sD],encapsulation:2})}return ne})();var _t=function(ne){return ne.always="always",ne.never="never",ne.default="default",ne}(_t||{});function Gt(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",16),r.qCj("click",function(){r.usT(f);const Z=r.GaO(2);return r.CGJ(Z.clearFilter())}),r.wR5(1,"mat-icon",17),r.C$Y()}}function ft(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"mat-form-field",13)(1,"mat-label"),r.OEk(2),r.wVc(3,"translate"),r.C$Y(),r.I0R(4,"input",14),r.iHE("ngModelChange",function(Z){r.usT(f);const _e=r.GaO();return r.kNx(_e.term,Z)||(_e.term=Z),r.CGJ(Z)}),r.wVc(5,"translate"),r.C$Y(),r.yuY(6,Gt,2,0,"button",15),r.C$Y()}if(2&ne){const f=r.GaO();r.yG2(2),r.cNF(r.kDX(3,4,"igo.context.contextManager.filterPlaceHolder")),r.yG2(2),r.E7m("placeholder",r.kDX(5,6,"igo.context.contextManager.filterPlaceHolder")),r.OKB("ngModel",f.term),r.yG2(2),r.E7m("ngIf",f.term.length)}}function At(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",18),r.qCj("click",function(){r.usT(f);const Z=r.GaO();return r.CGJ(Z.toggleSort(!0))}),r.wVc(1,"translate"),r.wR5(2,"mat-icon",19),r.C$Y()}2&ne&&r.E7m("matTooltip",r.kDX(1,1,"igo.context.contextManager.sortAlphabetically"))}function Go(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",18),r.qCj("click",function(){r.usT(f);const Z=r.GaO();return r.CGJ(Z.toggleSort(!1))}),r.wVc(1,"translate"),r.wR5(2,"mat-icon",20),r.C$Y()}2&ne&&r.E7m("matTooltip",r.kDX(1,1,"igo.context.contextManager.sortContextOrder"))}function Gn(ne,Ye){if(1&ne&&r.wR5(0,"igo-actionbar",21),2&ne){const f=r.GaO();r.E7m("iconColor",f.color)("store",f.actionStore)("withIcon",!0)("withTitle","overlay"===f.actionbarMode)("horizontal",!1)("mode",f.actionbarMode)}}function $n(ne,Ye){if(1&ne&&(r.I0R(0,"button",22),r.wVc(1,"translate"),r.wR5(2,"mat-icon",23),r.C$Y()),2&ne){r.GaO();const f=r.Gew(9);r.E7m("matTooltip",r.kDX(1,2,"igo.context.contextManager.filterUser"))("matMenuTriggerFor",f)}}function To(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",9)(1,"mat-checkbox",26),r.qCj("click",function(Z){return Z.stopPropagation()})("change",function(){r.usT(f);const Z=r.GaO().$implicit,_e=r.GaO();return r.CGJ(_e.handleToggleCategory(Z))}),r.C$Y(),r.I0R(2,"span"),r.OEk(3),r.C$Y()()}if(2&ne){const f=r.GaO().$implicit,H=r.GaO();r.yG2(),r.E7m("checked",H.getPermission(f).checked)("indeterminate",H.getPermission(f).indeterminate),r.yG2(2),r.cNF(f.title)}}function on(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",9)(1,"mat-checkbox",10),r.qCj("click",function(Z){return Z.stopPropagation()})("change",function(){const _e=r.usT(f).$implicit,we=r.GaO(2).$implicit,We=r.GaO();return r.CGJ(We.handleToggleCategory(_e,we))}),r.OEk(2),r.C$Y()()}if(2&ne){const f=Ye.$implicit,H=r.GaO(3);r.yG2(),r.E7m("checked",H.getPermission(f).checked),r.yG2(),r.oRS(" ",f.title," ")}}function ai(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",27)(1,"mat-checkbox",26),r.qCj("click",function(Z){return Z.stopPropagation()})("change",function(){r.usT(f);const Z=r.GaO().$implicit,_e=r.GaO();return r.CGJ(_e.handleToggleCategory(Z))}),r.C$Y(),r.I0R(2,"span"),r.OEk(3),r.C$Y()(),r.I0R(4,"mat-menu",null,28),r.yuY(6,on,3,2,"button",29),r.C$Y()}if(2&ne){const f=r.Gew(5),H=r.GaO().$implicit,Z=r.GaO();r.E7m("matMenuTriggerFor",f),r.yG2(),r.E7m("checked",Z.getPermission(H).checked)("indeterminate",Z.getPermission(H).indeterminate),r.yG2(2),r.cNF(H.title),r.yG2(3),r.E7m("ngForOf",H.childs)}}function Li(ne,Ye){if(1&ne&&(r.SAx(0),r.yuY(1,To,4,3,"button",24)(2,ai,7,5,"ng-template",null,25,r.gJz),r.k70()),2&ne){const f=Ye.$implicit,H=r.Gew(3);r.yG2(),r.E7m("ngIf",!f.childs)("ngIfElse",H)}}function bi(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"igo-context-item",33),r.qCj("edit",function(){const _e=r.usT(f).$implicit,we=r.GaO(3);return r.CGJ(we.edit.emit(_e))})("delete",function(){const _e=r.usT(f).$implicit,we=r.GaO(3);return r.CGJ(we.delete.emit(_e))})("clone",function(){const _e=r.usT(f).$implicit,we=r.GaO(3);return r.CGJ(we.clone.emit(_e))})("save",function(){const _e=r.usT(f).$implicit,we=r.GaO(3);return r.CGJ(we.save.emit(_e))})("hide",function(){const _e=r.usT(f).$implicit,we=r.GaO(3);return r.CGJ(we.hideContext(_e))})("show",function(){const _e=r.usT(f).$implicit,we=r.GaO(3);return r.CGJ(we.showContext(_e))})("favorite",function(){const _e=r.usT(f).$implicit,we=r.GaO(3);return r.CGJ(we.favorite.emit(_e))})("manageTools",function(){const _e=r.usT(f).$implicit,we=r.GaO(3);return r.CGJ(we.manageTools.emit(_e))})("managePermissions",function(){const _e=r.usT(f).$implicit,we=r.GaO(3);return r.CGJ(we.managePermissions.emit(_e))})("select",function(){const _e=r.usT(f).$implicit,we=r.GaO(3);return r.CGJ(we.select.emit(_e))})("unselect",function(){const _e=r.usT(f).$implicit,we=r.GaO(3);return r.CGJ(we.unselect.emit(_e))}),r.C$Y()}if(2&ne){const f=Ye.$implicit,H=r.GaO(3);r.E7m("selected",H.selectedContext&&H.selectedContext.uri===f.uri)("context",f)("default",f.id&&H.defaultContextId&&H.defaultContextId===f.id)}}function Qo(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"igo-collapsible",32),r.qCj("toggle",function(Z){r.usT(f);const _e=r.GaO().$implicit,we=r.GaO();return r.CGJ(we.collapsed[we.titleMapping[_e.key]]=Z)}),r.wVc(1,"translate"),r.yuY(2,bi,1,3,"ng-template",11),r.C$Y()}if(2&ne){const f=r.GaO().$implicit,H=r.GaO();r.E7m("title",r.kDX(1,3,H.titleMapping[f.key]))("collapsed",H.collapsed[H.titleMapping[f.key]]),r.yG2(2),r.E7m("ngForOf",f.value)}}function li(ne,Ye){1&ne&&r.C_f(0)}function Gi(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"igo-context-item",34),r.qCj("favorite",function(){const _e=r.usT(f).$implicit,we=r.GaO(2);return r.CGJ(we.favorite.emit(_e))})("select",function(){const _e=r.usT(f).$implicit,we=r.GaO(2);return r.CGJ(we.select.emit(_e))})("unselect",function(){const _e=r.usT(f).$implicit,we=r.GaO(2);return r.CGJ(we.unselect.emit(_e))}),r.C$Y()}if(2&ne){const f=Ye.$implicit,H=r.GaO(2);r.E7m("showFavorite",H.configService.getConfig("favoriteContext4NonAuthenticated"))("selected",H.selectedContext&&H.selectedContext.uri===f.uri)("context",f)("default",H.contextConfigs?H.defaultContextId===f.id:H.defaultContextId===f.uri)}}function $i(ne,Ye){if(1&ne&&r.yuY(0,Qo,3,5,"igo-collapsible",30)(1,li,1,0,"ng-container",31)(2,Gi,1,4,"ng-template",11),2&ne){const f=Ye.$implicit,H=r.GaO();r.E7m("ngIf",f.value.length&&H.auth.authenticated),r.yG2(),r.E7m("ngIf",f.value.length&&!H.auth.authenticated),r.yG2(),r.E7m("ngForOf",f.value)}}function Zo(ne,Ye){1&ne&&(r.I0R(0,"div",35),r.OEk(1),r.wVc(2,"translate"),r.C$Y()),2&ne&&(r.yG2(),r.oRS(" ",r.kDX(2,1,"igo.context.contextManager.noResult")," "))}let ci=(()=>{class ne{cdRef;configService;auth;dialog;languageService;storageService;contextConfigs;contextsInitial={ours:[]};contexts$=new a.g(this.contextsInitial);change$=new Ue.o(1);change$$;get contexts(){return this._contexts}set contexts(f){this._contexts=f,this.next()}_contexts={ours:[]};get selectedContext(){return this._selectedContext}set selectedContext(f){this._selectedContext=f,this.cdRef.detectChanges()}_selectedContext;get map(){return this._map}set map(f){this._map=f}_map;get defaultContextId(){return this.contextConfigs?this._defaultContextId:this.storageService.get("favorite.context.uri")||this._defaultContextId}set defaultContextId(f){this._defaultContextId=f}_defaultContextId;collapsed=[];select=new r._w7;unselect=new r._w7;edit=new r._w7;delete=new r._w7;save=new r._w7;clone=new r._w7;create=new r._w7;hide=new r._w7;show=new r._w7;showHiddenContexts=new r._w7;favorite=new r._w7;managePermissions=new r._w7;manageTools=new r._w7;filterPermissionsChanged=new r._w7;titleMapping={ours:"igo.context.contextManager.ourContexts",shared:"igo.context.contextManager.sharedContexts",public:"igo.context.contextManager.publicContexts"};users;permissions=[];actionStore=new w.MF([]);actionbarMode=w.m0.Overlay;color="primary";showHidden=!1;set term(f){this._term=f,this.next()}get term(){return this._term}_term="";get sortedAlpha(){return this._sortedAlpha}set sortedAlpha(f){this._sortedAlpha=f,this.next()}_sortedAlpha=void 0;showContextFilter=_t.always;thresholdToFilter=5;get isEmpty(){return!this.contexts.ours.length&&!this.contexts.public?.length&&!this.contexts.shared?.length}constructor(f,H,Z,_e,we,We){this.cdRef=f,this.configService=H,this.auth=Z,this.dialog=_e,this.languageService=we,this.storageService=We,this.contextConfigs=this.configService.getConfig("context")}ngOnInit(){this.change$$=this.change$.pipe((0,Me.C)(()=>(0,Ut.k)(50))).subscribe(()=>{this.contexts$.next(this.filterContextsList(this.contexts))}),this.actionStore.load([{id:"emptyContext",title:this.languageService.translate.instant("igo.context.contextManager.emptyContext"),icon:"map-outline",tooltip:this.languageService.translate.instant("igo.context.contextManager.emptyContextTooltip"),handler:()=>{this.createContext(!0)}},{id:"contextFromMap",title:this.languageService.translate.instant("igo.context.contextManager.contextMap"),icon:"map-check",tooltip:this.languageService.translate.instant("igo.context.contextManager.contextMapTooltip"),handler:()=>{this.createContext(!1)}}])}next(){this.change$.next()}filterContextsList(f){if(""===this.term)return this.sortedAlpha&&(f=this.sortContextsList(f)),f;{let Z={ours:f.ours.filter(_e=>{const we=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return _e.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(we)})};if(this.contexts.public){const _e=f.public.filter(we=>{const We=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return we.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(We)});Z.public=_e}if(this.contexts.shared){const _e=f.shared.filter(we=>{const We=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return we.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(We)});Z.shared=_e}return this.sortedAlpha&&(Z=this.sortContextsList(Z)),Z}}ngOnDestroy(){this.change$$.unsubscribe()}showFilter(){switch(this.showContextFilter){case _t.always:return!0;case _t.never:return!1;default:let f=this.contexts.ours.length;return f+=this.contexts.public?this.contexts.public.length:0,f+=this.contexts.shared?this.contexts.shared.length:0,f>=this.thresholdToFilter}}sortContextsList(f){if(f){const H=JSON.parse(JSON.stringify(f));return H.ours.sort((Z,_e)=>this.normalize(Z.title)<this.normalize(_e.title)?-1:this.normalize(Z.title)>this.normalize(_e.title)?1:0),H.shared?H.shared.sort((Z,_e)=>this.normalize(Z.title)<this.normalize(_e.title)?-1:this.normalize(Z.title)>this.normalize(_e.title)?1:0):H.public&&H.public.sort((Z,_e)=>this.normalize(Z.title)<this.normalize(_e.title)?-1:this.normalize(Z.title)>this.normalize(_e.title)?1:0),H}}normalize(f){return f.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}toggleSort(f){this.sortedAlpha=f}clearFilter(){this.term=""}createContext(f){this.dialog.open(Zt,{disableClose:!1}).afterClosed().pipe((0,K.U)(1)).subscribe(H=>{H&&this.create.emit({title:H,empty:f})})}getPermission(f){if(f)return this.permissions.find(Z=>Z.name===f.name)}handleToggleCategory(f,H){const Z=this.getPermission(f);if(Z&&(Z.checked=!Z.checked,this.storageService.set("contexts.permissions."+Z.name,Z.checked),Z.indeterminate=!1),H){let _e=!1;for(const We of H.childs)if(this.getPermission(We).checked!==Z.checked){_e=!0;break}const we=this.getPermission(H);we&&(we.checked=Z.checked,this.storageService.set("contexts.permissions."+we.name,Z.checked),we.indeterminate=_e)}if(f.childs)for(const _e of f.childs){const we=this.getPermission(_e);we&&we.checked!==Z.checked&&(we.checked=Z.checked,this.storageService.set("contexts.permissions."+we.name,Z.checked))}this.filterPermissionsChanged.emit(this.permissions)}hideContext(f){if(f.hidden=!0,!this.showHidden){const H={ours:[],shared:[],public:[]};H.ours=this.contexts.ours.filter(Z=>Z.id!==f.id),H.shared=this.contexts.shared.filter(Z=>Z.id!==f.id),H.public=this.contexts.public.filter(Z=>Z.id!==f.id),this.contexts=H}this.hide.emit(f)}showContext(f){f.hidden=!1,this.show.emit(f)}static \u0275fac=function(H){return new(H||ne)(r.GI1(r.kD9),r.GI1(b.aW),r.GI1(M.oj),r.GI1(Lt.qW),r.GI1(L.ov),r.GI1(N.yQ))};static \u0275cmp=r.In1({type:ne,selectors:[["igo-context-list"]],inputs:{contexts:"contexts",selectedContext:"selectedContext",map:"map",defaultContextId:"defaultContextId",term:"term"},outputs:{select:"select",unselect:"unselect",edit:"edit",delete:"delete",save:"save",clone:"clone",create:"create",hide:"hide",show:"show",showHiddenContexts:"showHiddenContexts",favorite:"favorite",managePermissions:"managePermissions",manageTools:"manageTools",filterPermissionsChanged:"filterPermissionsChanged"},standalone:!0,features:[r.UHJ],decls:20,vars:17,consts:[[3,"navigation"],[1,"context-filter-container"],["floatLabel","always",4,"ngIf"],[1,"actions-container"],["class","sort-alpha","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["class","add-context-button","icon","plus",3,"iconColor","store","withIcon","withTitle","horizontal","mode",4,"ngIf"],["class","users-filter","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","matMenuTriggerFor",4,"ngIf"],["accountMenu","matMenu"],[4,"ngFor","ngForOf"],["mat-menu-item","",1,"profil-menu"],[3,"checked","click","change"],["ngFor","",3,"ngForOf"],["class","no-result",4,"ngIf"],["floatLabel","always"],["matInput","","type","text",3,"placeholder","ngModel","ngModelChange"],["mat-icon-button","","matSuffix","","class","clear-button","aria-label","Clear","color","warn",3,"click",4,"ngIf"],["mat-icon-button","","matSuffix","","aria-label","Clear","color","warn",1,"clear-button",3,"click"],["svgIcon","close"],["mat-icon-button","","matTooltipShowDelay","500",1,"sort-alpha",3,"matTooltip","click"],["color","primary","svgIcon","sort-alphabetical-variant"],["color","warn","svgIcon","sort-variant-remove"],["icon","plus",1,"add-context-button",3,"iconColor","store","withIcon","withTitle","horizontal","mode"],["mat-icon-button","","matTooltipShowDelay","500",1,"users-filter",3,"matTooltip","matMenuTriggerFor"],["color","primary","svgIcon","filter-menu"],["mat-menu-item","","class","profil-menu",4,"ngIf","ngIfElse"],["withSubMenu",""],[3,"checked","indeterminate","click","change"],["mat-menu-item","",1,"profil-menu",3,"matMenuTriggerFor"],["subAccountMenu","matMenu"],["mat-menu-item","","class","profil-menu",4,"ngFor","ngForOf"],[3,"title","collapsed","toggle",4,"ngIf"],[4,"ngIf"],[3,"title","collapsed","toggle"],["igoListItem","","color","accent",3,"selected","context","default","edit","delete","clone","save","hide","show","favorite","manageTools","managePermissions","select","unselect"],["igoListItem","","color","accent",3,"showFavorite","selected","context","default","favorite","select","unselect"],[1,"no-result"]],template:function(H,Z){1&H&&(r.I0R(0,"igo-list",0)(1,"div",1),r.yuY(2,ft,7,8,"mat-form-field",2),r.I0R(3,"div",3),r.yuY(4,At,3,3,"button",4)(5,Go,3,3,"button",4)(6,Gn,1,6,"igo-actionbar",5)(7,$n,3,4,"button",6),r.I0R(8,"mat-menu",null,7),r.yuY(10,Li,4,2,"ng-container",8),r.I0R(11,"button",9)(12,"mat-checkbox",10),r.qCj("click",function(we){return we.stopPropagation()})("change",function(){return Z.showHiddenContexts.emit()}),r.C$Y(),r.I0R(13,"span"),r.OEk(14),r.wVc(15,"translate"),r.C$Y()()()()(),r.yuY(16,$i,3,3,"ng-template",11),r.wVc(17,"keyvalue"),r.wVc(18,"async"),r.yuY(19,Zo,3,3,"div",12),r.C$Y()),2&H&&(r.E7m("navigation",!0),r.yG2(2),r.E7m("ngIf",Z.showFilter()),r.yG2(2),r.E7m("ngIf",!Z.sortedAlpha),r.yG2(),r.E7m("ngIf",Z.sortedAlpha),r.yG2(),r.E7m("ngIf",Z.auth.authenticated&&Z.contextConfigs),r.yG2(),r.E7m("ngIf",Z.auth.authenticated&&Z.contextConfigs),r.yG2(3),r.E7m("ngForOf",Z.users),r.yG2(2),r.E7m("checked",Z.showHidden),r.yG2(2),r.oRS(" ",r.kDX(15,11,"igo.context.contextManager.showHidden")," "),r.yG2(2),r.E7m("ngForOf",r.kDX(17,13,r.kDX(18,15,Z.contexts$))),r.yG2(3),r.E7m("ngIf",Z.isEmpty))},dependencies:[w.yM,y.u_,h.wb,h.Up,h.w5,h.Gm,j.cN,j.yi,e.y,e.ot,e.ue,e._G,d.oJ,d.um,tt.oB,tt.qL,st.KO,st.a4,w.AI,qe._A,qe.aM,qe.OQ,qe.yG,y.Iw,Ge.Vn,Ge.WK,w.ii,xe,w.qU,y.a,y.uq,T.O0,T.sD],styles:["[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}.context-filter-container[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 4px}.context-filter-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.context-filter-min-width[_ngcontent-%COMP%]{width:calc(100% - 135px);margin:5px;padding-left:6px}.profil-menu[_ngcontent-%COMP%]{padding-left:8px}.profil-menu[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin-right:8px}.add-context-button[_ngcontent-%COMP%]{margin:0;width:40px;display:inline-flex;overflow:hidden}.actions-container[_ngcontent-%COMP%]{margin-left:4px}.no-result[_ngcontent-%COMP%]{padding:16px}"],changeDetection:0})}return ne})();var Yo=s(69400),Vo=s(21232);function Eo(ne,Ye){1&ne&&(r.I0R(0,"div",3)(1,"h4"),r.OEk(2),r.wVc(3,"translate"),r.C$Y(),r.I0R(4,"p"),r.OEk(5),r.wVc(6,"translate"),r.C$Y()()),2&ne&&(r.yG2(2),r.cNF(r.kDX(3,2,"igo.context.permission.readOnlyTitle")),r.yG2(3),r.cNF(r.kDX(6,4,"igo.context.permission.readOnlyMsg")))}function _o(ne,Ye){1&ne&&(r.I0R(0,"mat-radio-button",8),r.OEk(1),r.wVc(2,"translate"),r.C$Y()),2&ne&&(r.yG2(),r.oRS(" ",r.kDX(2,1,"igo.context.permission.scope.public")," "))}function Yt(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"div",3)(1,"mat-radio-group",4),r.iHE("ngModelChange",function(Z){r.usT(f);const _e=r.GaO(2);return r.kNx(_e.context.scope,Z)||(_e.context.scope=Z),r.CGJ(Z)}),r.qCj("change",function(){r.usT(f);const Z=r.GaO(2);return r.CGJ(Z.scopeChanged.emit(Z.context))}),r.I0R(2,"mat-radio-button",5),r.OEk(3),r.wVc(4,"translate"),r.C$Y(),r.I0R(5,"mat-radio-button",6),r.OEk(6),r.wVc(7,"translate"),r.C$Y(),r.yuY(8,_o,3,3,"mat-radio-button",7),r.C$Y()()}if(2&ne){const f=r.GaO(2);r.yG2(),r.OKB("ngModel",f.context.scope),r.yG2(2),r.oRS(" ",r.kDX(4,4,"igo.context.permission.scope.private")," "),r.yG2(3),r.oRS(" ",r.kDX(7,6,"igo.context.permission.scope.shared")," "),r.yG2(2),r.E7m("ngIf",f.authService.isAdmin)}}function Io(ne,Ye){if(1&ne&&(r.I0R(0,"mat-option",20),r.OEk(1),r.wR5(2,"br"),r.I0R(3,"small",21),r.OEk(4),r.C$Y()()),2&ne){const f=Ye.$implicit;r.E7m("value",f),r.yG2(),r.oRS(" ",f.title,""),r.yG2(3),r.cNF(f.name)}}function ui(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"form",9),r.qCj("ngSubmit",function(){r.usT(f);const Z=r.GaO(2);return r.CGJ(Z.handleFormSubmit(Z.form.value))}),r.I0R(1,"mat-form-field",10),r.wR5(2,"input",11),r.wVc(3,"translate"),r.I0R(4,"mat-autocomplete",12,13),r.qCj("optionSelected",function(Z){r.usT(f);const _e=r.GaO(2);return r.CGJ(_e.onProfilSelected(Z.option.value))}),r.yuY(6,Io,5,3,"mat-option",14),r.C$Y(),r.I0R(7,"mat-error"),r.OEk(8),r.wVc(9,"translate"),r.C$Y()(),r.I0R(10,"mat-radio-group",15)(11,"mat-radio-button",16),r.OEk(12),r.wVc(13,"translate"),r.C$Y(),r.I0R(14,"mat-radio-button",17),r.OEk(15),r.wVc(16,"translate"),r.C$Y()(),r.I0R(17,"div",18)(18,"button",19),r.OEk(19),r.wVc(20,"translate"),r.C$Y()()()}if(2&ne){const f=r.Gew(5),H=r.GaO(2);r.E7m("formGroup",H.form),r.yG2(2),r.E7m("placeholder",r.kDX(3,11,"igo.context.permission.user"))("formControl",H.formControl)("matAutocomplete",f),r.yG2(2),r.E7m("displayWith",H.displayFn),r.yG2(2),r.E7m("ngForOf",H.profils),r.yG2(2),r.oRS(" ",r.kDX(9,13,"igo.context.permission.profilRequired")," "),r.yG2(4),r.oRS(" ",r.kDX(13,15,"igo.context.permission.read")," "),r.yG2(3),r.oRS(" ",r.kDX(16,17,"igo.context.permission.write")," "),r.yG2(3),r.E7m("disabled",!H.form.valid),r.yG2(),r.oRS(" ",r.kDX(20,19,"igo.context.permission.addBtn")," ")}}function qo(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",29),r.qCj("click",function(){r.usT(f);const Z=r.GaO().$implicit,_e=r.GaO(5);return r.CGJ(_e.removePermission.emit(Z))}),r.wVc(1,"translate"),r.wR5(2,"mat-icon",30),r.C$Y()}2&ne&&r.E7m("matTooltip",r.kDX(1,1,"igo.context.permission.delete"))}function di(ne,Ye){if(1&ne&&(r.I0R(0,"mat-list-item"),r.wR5(1,"mat-icon",25),r.I0R(2,"h4",26),r.OEk(3),r.I0R(4,"small",21),r.OEk(5),r.C$Y()(),r.I0R(6,"div",27),r.yuY(7,qo,3,3,"button",28),r.C$Y()()),2&ne){const f=Ye.$implicit,H=r.GaO(5);r.yG2(3),r.oRS(" ",f.profilTitle," "),r.yG2(2),r.cNF(f.profil),r.yG2(2),r.E7m("ngIf",H.canWrite||f.profil===H.authService.decodeToken().user.sourceId)}}function Co(ne,Ye){if(1&ne&&(r.I0R(0,"igo-collapsible",24),r.wVc(1,"translate"),r.yuY(2,di,8,3,"ng-template",22),r.C$Y()),2&ne){const f=r.GaO().$implicit;r.E7m("title",r.kDX(1,2,"igo.context.permission."+f.key)),r.yG2(2),r.E7m("ngForOf",f.value)}}function Ai(ne,Ye){1&ne&&r.yuY(0,Co,3,4,"igo-collapsible",23),2&ne&&r.E7m("ngIf",Ye.$implicit.value.length)}function ot(ne,Ye){if(1&ne&&(r.I0R(0,"igo-list"),r.yuY(1,Ai,1,1,"ng-template",22),r.wVc(2,"keyvalue"),r.C$Y()),2&ne){const f=r.GaO(2);r.yG2(),r.E7m("ngForOf",r.kDX(2,1,f.permissions))}}function go(ne,Ye){if(1&ne&&(r.I0R(0,"div"),r.yuY(1,Eo,7,6,"div",1)(2,Yt,9,8,"div",1)(3,ui,21,21,"form",2)(4,ot,3,3,"igo-list",0),r.C$Y()),2&ne){const f=r.GaO();r.yG2(),r.E7m("ngIf",!f.canWrite),r.yG2(),r.E7m("ngIf",f.canWrite),r.yG2(),r.E7m("ngIf","private"!==f.context.scope&&f.canWrite),r.yG2(),r.E7m("ngIf",f.permissions&&"private"!==f.context.scope)}}let to=(()=>{class ne{formBuilder;cd;http;authService;config;form;get context(){return this._context}set context(f){this._context=f,this.cd.detectChanges()}_context;get permissions(){return this._permissions}set permissions(f){this._permissions=f,this.cd.detectChanges()}_permissions;get profils(){return this._profils}set profils(f){this._profils=f,this.cd.detectChanges()}_profils=[];get canWrite(){return this.context.permission===F[F.write]}baseUrlProfils;formControl=new e.yM;formValueChanges$$;addPermission=new r._w7;removePermission=new r._w7;scopeChanged=new r._w7;constructor(f,H,Z,_e,we){this.formBuilder=f,this.cd=H,this.http=Z,this.authService=_e,this.config=we}ngOnInit(){this.buildForm(),this.baseUrlProfils=this.config.getConfig("context.url")+"/profils-users?",this.formValueChanges$$=this.formControl.valueChanges.subscribe(f=>{f.length?(this.http.get(this.baseUrlProfils+"q="+f).subscribe(H=>{this.profils=H}),this.profils.filter(H=>{const Z=f.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),_e=H.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return(H.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")+_e).includes(Z)})):this.profils=[]})}displayFn(f){return f?f.title:void 0}handleFormSubmit(f){this.addPermission.emit(f)}buildForm(){this.form=this.formBuilder.group({profil:[],typePermission:["read"]})}onProfilSelected(f){this.form.setValue({profil:f.name,typePermission:this.form.value.typePermission})}static \u0275fac=function(H){return new(H||ne)(r.GI1(e.KE),r.GI1(r.kD9),r.GI1(ie.KK),r.GI1(M.oj),r.GI1(b.aW))};static \u0275cmp=r.In1({type:ne,selectors:[["igo-context-permissions"]],inputs:{context:"context",permissions:"permissions"},outputs:{addPermission:"addPermission",removePermission:"removePermission",scopeChanged:"scopeChanged"},standalone:!0,features:[r.UHJ],decls:1,vars:1,consts:[[4,"ngIf"],["class","scopeForm",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"scopeForm"],[3,"ngModel","ngModelChange","change"],["value","private"],["value","protected"],["value","public",4,"ngIf"],["value","public"],[3,"formGroup","ngSubmit"],[1,"full-width"],["matInput","","required","",3,"placeholder","formControl","matAutocomplete"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["formControlName","typePermission"],["value","read"],["value","write"],[1,"igo-form-button-group"],["mat-raised-button","","type","submit",3,"disabled"],[3,"value"],[1,"mat-typography"],["ngFor","",3,"ngForOf"],[3,"title",4,"ngIf"],[3,"title"],["matListItemIcon","","svgIcon","account-outline"],["matListItemTitle",""],["matListItemMeta","","igoStopPropagation","",1,"igo-actions-container"],["mat-icon-button","","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","delete"]],template:function(H,Z){1&H&&r.yuY(0,go,5,4,"div",0),2&H&&r.E7m("ngIf",Z.context)},dependencies:[y.u_,Vo.yk,Vo.cv,Vo.cT,e.y,e.sz,e.ot,e.ue,e.u,e.eJ,e._G,e.sl,e.ug,e.uW,e.Wo,h.wb,h.Up,h.wJ,j.cN,j.yi,Yo.U1,Yo.e,R.I5,Yo.cG,y.Iw,R.Ax,d.oJ,d.Gw,d.um,w.yM,w.ii,mt.iI,mt.g9,mt.Y1,mt.UV,mt.At,tt.oB,tt.qL,w.mw,st.KO,st.a4,y.uq,T.O0,T.sD],styles:["[_nghost-%COMP%]{margin:10px}.full-width[_ngcontent-%COMP%]{width:100%}mat-radio-button[_ngcontent-%COMP%]{padding:14px 14px 14px 0}.scopeForm[_ngcontent-%COMP%], form[_ngcontent-%COMP%]{padding:5px}"]})}return ne})();s(44876),s(61252),s(54584),s(53291);let Yi=(()=>{class ne{contextService;route;language="";constructor(f,H){this.contextService=f,this.route=H,this.route.queryParams.subscribe(Z=>{Z.lang&&(this.language=Z.lang)})}getUrlWithApi(f){return this.language?`${location.origin+location.pathname}?context=${f.uri}&lang=${this.language}`:`${location.origin+location.pathname}?context=${f.uri}`}createContextShared(f,H){const Z=this.contextService.getContextFromMap(f);return Z.scope="public",Z.title=H.title,Z.uri=H.uri,this.contextService.create(Z)}updateContextShared(f,H,Z){const _e=this.contextService.getContextFromMap(f);return this.contextService.update(Z,{title:H.title,map:_e.map})}getUrlWithoutApi(f,H){if(!(this.route&&this.route.options.visibleOnLayersKey&&this.route.options.visibleOffLayersKey&&f.viewController.getZoom()))return;const Z=H.layerlistControls.querystring;let _e=this.route.options.visibleOnLayersKey,we=this.route.options.visibleOffLayersKey;const We=f.layers,gt=We.filter(lo=>lo.visible&&!lo.isIgoInternalLayer),Ot=We.filter(lo=>!lo.visible&&!lo.isIgoInternalLayer);0===gt.length&&(_e=""),0===Ot.length&&(we="");let lt="",kt=[];gt.length>Ot.length?(lt=`${_e}=*&${we}=`,kt=Ot):(lt=`${we}=*&${_e}=`,kt=gt);for(const lo of kt)lo.id&&(lt+=lo.id+",");const Pt=[],no=this.contextService.context$.value.layers;for(const lo of no)(typeof lo.id<"u"||typeof lo.source<"u")&&Pt.push(lo.id||lo.source.id);const Xt=this.makeLayersByService(We,Pt,"wms"),Fo=this.makeLayersByService(We,Pt,"wmts"),No=this.makeLayersByService(We,Pt,"arcgisrest"),Sn=this.makeLayersByService(We,Pt,"imagearcgisrest"),_i=this.makeLayersByService(We,Pt,"tilearcgisrest");lt=lt.substr(0,lt.length-1);const jn=this.route.options.centerKey,Kn=this.route.options.contextKey,Di=`${this.route.options.zoomKey}=${f.viewController.getZoom()}`,wn=f.viewController.getCenter("EPSG:4326")||[],On=`${jn}=${wn[0].toFixed(5).replace(/\.([^0]+)0+$/,".$1")},${wn[1].toFixed(5).replace(/\.([^0]+)0+$/,".$1")}`.replace(/.00000/g,"");let $o="";this.contextService.context$.value&&($o=`${Kn}=${this.contextService.context$.value.uri}`);let ho=this.language?`${location.origin}${location.pathname}?${$o}&${Di}&${On}&${lt}&${Z}&${Xt}&${Z}&${Fo}&${No}&${Sn}&${_i}&lang=${this.language}`:`${location.origin}${location.pathname}?${$o}&${Di}&${On}&${lt}&${Z}&${Xt}&${Z}&${Fo}&${No}&${Sn}&${_i}`;for(let lo=0;lo<5;lo++)ho=ho.replace(/&&/g,"&"),ho=ho.endsWith("&")?ho.slice(0,-1):ho;return ho=ho.endsWith("&")?ho.slice(0,-1):ho,ho=ho.replace("?&wm","&wm"),ho=ho.replace("?&","?"),ho}makeLayersByService(f,H,Z){const _e=[];for(const We of f.filter(gt=>gt.dataSource.options?.type===Z))if(-1===H.indexOf(We.id)){let lt,gt=encodeURIComponent(We.dataSource.options.url),Ot="";switch(We.dataSource.options.type.toLowerCase()){case"wms":const no=We.dataSource.options;Ot=encodeURIComponent(no.params.LAYERS),lt="1.3.0"===no.params.VERSION?lt:no.params.VERSION;break;case"wmts":case"arcgisrest":case"imagearcgisrest":case"tilearcgisrest":Ot=encodeURIComponent(We.dataSource.options.layer)}const kt=`${Ot}:igoz${We.zIndex}`;let Pt="";if(lt){const no=-1===We.dataSource.options.url.indexOf("?")?"?":"&";Pt=encodeURIComponent(`${no}VERSION=${lt}`)}gt=`${gt}${Pt}`,_e.find(no=>no.url===gt)?_e.forEach(no=>{no.url===gt&&no.layers.push(kt)}):_e.push({url:gt,layers:[kt]})}let we="";if(_e.length>=1){let We,gt;switch(Z.toLowerCase()){case"wms":We=this.route.options.wmsUrlKey,gt=this.route.options.wmsLayersKey;break;case"wmts":We=this.route.options.wmtsUrlKey,gt=this.route.options.wmtsLayersKey;break;case"arcgisrest":We=this.route.options.arcgisUrlKey,gt=this.route.options.arcgisLayersKey;break;case"imagearcgisrest":We=this.route.options.iarcgisUrlKey,gt=this.route.options.iarcgisLayersKey;break;case"tilearcgisrest":We=this.route.options.tarcgisUrlKey,gt=this.route.options.tarcgisLayersKey;break;default:We="",gt=""}let Ot="",lt="";_e.forEach(kt=>{Ot+=`${kt.url},`,lt+=`(${kt.layers.join(",")}),`}),Ot=Ot.endsWith(",")?Ot.slice(0,-1):Ot,lt=lt.endsWith(",")?lt.slice(0,-1):lt,we=`${We}=${Ot}&${gt}=${lt}`}return we}static \u0275fac=function(H){return new(H||ne)(r.CoB(ae),r.CoB(oe.k$,8))};static \u0275prov=r.wxM({token:ne,factory:ne.\u0275fac,providedIn:"root"})}return ne})();function gi(ne,Ye){if(1&ne&&(r.I0R(0,"span",11),r.OEk(1),r.C$Y()),2&ne){const f=r.GaO();r.yG2(),r.oRS("",f.userId,"-")}}function sn(ne,Ye){if(1&ne&&(r.I0R(0,"button",12),r.OEk(1),r.wVc(2,"translate"),r.C$Y()),2&ne){const f=r.GaO();r.E7m("disabled",!f.form.valid),r.yG2(),r.oRS(" ",r.kDX(2,2,"igo.context.shareMap.button")," ")}}function an(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"button",13),r.qCj("click",function(){r.usT(f);const Z=r.GaO();return r.CGJ(Z.updateContextShared(Z.form.value))}),r.OEk(1),r.wVc(2,"translate"),r.C$Y()}2&ne&&(r.yG2(),r.oRS(" ",r.kDX(2,1,"igo.context.shareMap.refreshBtn")," "))}function ln(ne,Ye){if(1&ne){const f=r.KQA();r.I0R(0,"div",14)(1,"mat-form-field"),r.wR5(2,"textarea",15,16),r.wVc(4,"translate"),r.I0R(5,"button",17),r.qCj("click",function(){r.usT(f);const Z=r.Gew(3),_e=r.GaO();return r.CGJ(_e.copyTextToClipboard(Z))}),r.wVc(6,"translate"),r.wR5(7,"mat-icon",18),r.C$Y()(),r.wR5(8,"div"),r.C$Y()}if(2&ne){const f=r.GaO();r.yG2(2),r.E7m("placeholder",r.kDX(4,3,"igo.context.shareMap.placeholderLink"))("value",f.url),r.yG2(3),r.E7m("matTooltip",r.kDX(6,5,"igo.context.shareMap.copy"))}}let Vi=(()=>{class ne{languageService;messageService;auth;shareMapService;formBuilder;form;map;url;userId;idContextShared;constructor(f,H,Z,_e,we){this.languageService=f,this.messageService=H,this.auth=Z,this.shareMapService=_e,this.formBuilder=we}ngOnInit(){this.auth.authenticate$.subscribe(f=>{const H=this.auth.decodeToken();this.userId=H?.user?.id.toString(),this.buildForm()})}createUrl(f={}){const H=Object.assign({},f);H.uri=this.userId?`${this.userId}-${f.uri}`:f.uri,this.url=this.shareMapService.getUrlWithApi(H),this.shareMapService.createContextShared(this.map,H).subscribe(Z=>{this.idContextShared=Z.id,this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:H.title})},Z=>{Z.error.title=this.languageService.translate.instant("igo.context.shareMap.errorTitle"),this.messageService.showError(Z)})}updateContextShared(f={}){const H=Object.assign({},f);H.uri=this.userId?`${this.userId}-${f.uri}`:f.uri,this.shareMapService.updateContextShared(this.map,H,this.idContextShared).subscribe(Z=>{this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:H.title})},Z=>{Z.error.title=this.languageService.translate.instant("igo.context.shareMap.errorTitle"),this.messageService.showError(Z)})}copyTextToClipboard(f){X._D.copy(f)&&this.messageService.success("igo.context.shareMap.dialog.copyMsg","igo.context.shareMap.dialog.copyTitle")}buildForm(){this.url=void 0;const f=(0,X.uq)();let H="Partage ";H+=this.userId?`(${this.userId}-${f})`:`(${f})`,this.form=this.formBuilder.group({title:[H],uri:[f]})}static \u0275fac=function(H){return new(H||ne)(r.GI1(L.ov),r.GI1(E.mi),r.GI1(M.oj),r.GI1(Yi),r.GI1(e.KE))};static \u0275cmp=r.In1({type:ne,selectors:[["igo-share-map-api"]],inputs:{map:"map"},standalone:!0,features:[r.UHJ],decls:21,vars:18,consts:[[1,"igo-form",3,"formGroup","ngSubmit"],[1,"igo-input-container"],["matInput","","required","","formControlName","title",3,"placeholder"],["id","uriInput",1,"igo-input-container"],["class","prefix",4,"ngIf"],[1,"fieldWrapper"],["matInput","","required","","formControlName","uri",3,"readonly","placeholder"],[1,"igo-form-button-group"],["mat-raised-button","","type","submit",3,"disabled",4,"ngIf"],["mat-raised-button","","type","button",3,"click",4,"ngIf"],["class","igo-input-container linkToShare",4,"ngIf"],[1,"prefix"],["mat-raised-button","","type","submit",3,"disabled"],["mat-raised-button","","type","button",3,"click"],[1,"igo-input-container","linkToShare"],["matInput","","readonly","","rows","3",1,"textAreaWithButton",3,"placeholder","value"],["textArea",""],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click"],["svgIcon","content-copy"]],template:function(H,Z){1&H&&(r.I0R(0,"form",0),r.qCj("ngSubmit",function(){return Z.createUrl(Z.form.value)}),r.I0R(1,"div",1)(2,"mat-form-field"),r.wR5(3,"input",2),r.wVc(4,"translate"),r.I0R(5,"mat-error"),r.OEk(6),r.wVc(7,"translate"),r.C$Y()()(),r.I0R(8,"div",3)(9,"mat-form-field"),r.yuY(10,gi,2,1,"span",4),r.I0R(11,"span",5),r.wR5(12,"input",6),r.wVc(13,"translate"),r.C$Y(),r.I0R(14,"mat-error"),r.OEk(15),r.wVc(16,"translate"),r.C$Y()()(),r.I0R(17,"div",7),r.yuY(18,sn,3,4,"button",8)(19,an,3,3,"button",9),r.C$Y()(),r.yuY(20,ln,9,7,"div",10)),2&H&&(r.E7m("formGroup",Z.form),r.yG2(3),r.E7m("placeholder",r.kDX(4,10,"igo.context.contextManager.form.title")),r.yG2(3),r.oRS(" ",r.kDX(7,12,"igo.context.contextManager.form.titleRequired")," "),r.yG2(4),r.E7m("ngIf",Z.userId),r.yG2(2),r.E7m("readonly",!Z.userId)("placeholder",r.kDX(13,14,"igo.context.contextManager.form.uri")),r.yG2(3),r.oRS(" ",r.kDX(16,16,"igo.context.contextManager.form.uriRequired")," "),r.yG2(3),r.E7m("ngIf",!Z.url),r.yG2(),r.E7m("ngIf",Z.url),r.yG2(),r.E7m("ngIf",Z.url))},dependencies:[e.y,e.sz,e.ot,e.ue,e.u,e.eJ,e.sl,e.uW,e.Wo,h.wb,h.Up,h.wJ,j.cN,j.yi,y.u_,d.oJ,d.Gw,d.um,st.KO,st.a4,tt.oB,tt.qL,T.O0,T.sD],styles:['@charset "UTF-8";mat-form-field[_ngcontent-%COMP%]{width:100%}#uriInput[_ngcontent-%COMP%]   .fieldWrapper[_ngcontent-%COMP%]{display:block;overflow:hidden}#uriInput[_ngcontent-%COMP%]   .prefix[_ngcontent-%COMP%]{float:left}.linkToShare\\a0[_ngcontent-%COMP%] {padding:25px 5px 5px}.linkToShare\\a0[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none;width:100%;line-height:1.3;height:40px;overflow-y:hidden;word-wrap:normal;word-break:break-all}.linkToShare\\a0[_ngcontent-%COMP%]   textarea.textAreaWithButton[_ngcontent-%COMP%]{width:calc(100% - 60px)}.linkToShare\\a0[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{float:right;margin:-10px 0}.igo-form[_ngcontent-%COMP%]{padding:20px 5px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}']})}return ne})();var oo=s(35876);function cn(ne,Ye){1&ne&&(r.I0R(0,"h4"),r.OEk(1),r.wVc(2,"translate"),r.C$Y()),2&ne&&(r.yG2(),r.oRS(" ",r.kDX(2,1,"igo.context.shareMap.included")," "))}function un(ne,Ye){1&ne&&(r.I0R(0,"li"),r.OEk(1),r.wVc(2,"translate"),r.C$Y()),2&ne&&(r.yG2(),r.oRS(" ",r.kDX(2,1,"igo.context.shareMap.context")," "))}function dn(ne,Ye){1&ne&&(r.I0R(0,"li"),r.OEk(1),r.wVc(2,"translate"),r.C$Y()),2&ne&&(r.yG2(),r.oRS(" ",r.kDX(2,1,"igo.context.shareMap.center")," "))}function kn(ne,Ye){1&ne&&(r.I0R(0,"li"),r.OEk(1),r.wVc(2,"translate"),r.C$Y()),2&ne&&(r.yG2(),r.oRS(" ",r.kDX(2,1,"igo.context.shareMap.zoom")," "))}function hi(ne,Ye){1&ne&&(r.I0R(0,"li"),r.OEk(1),r.wVc(2,"translate"),r.C$Y()),2&ne&&(r.yG2(),r.oRS(" ",r.kDX(2,1,"igo.context.shareMap.addedLayers")," "))}function pn(ne,Ye){1&ne&&(r.I0R(0,"li"),r.OEk(1),r.wVc(2,"translate"),r.C$Y()),2&ne&&(r.yG2(),r.oRS(" ",r.kDX(2,1,"igo.context.shareMap.visibleInvisible")," "))}function wi(ne,Ye){1&ne&&(r.I0R(0,"h4"),r.OEk(1),r.wVc(2,"translate"),r.C$Y()),2&ne&&(r.yG2(),r.oRS(" ",r.kDX(2,1,"igo.context.shareMap.excluded")," "))}function oi(ne,Ye){1&ne&&(r.I0R(0,"li"),r.OEk(1),r.wVc(2,"translate"),r.C$Y()),2&ne&&(r.yG2(),r.oRS(" ",r.kDX(2,1,"igo.context.shareMap.order")," "))}function mn(ne,Ye){1&ne&&(r.I0R(0,"li"),r.OEk(1),r.wVc(2,"translate"),r.C$Y()),2&ne&&(r.yG2(),r.oRS(" ",r.kDX(2,1,"igo.context.shareMap.opacity")," "))}function gn(ne,Ye){1&ne&&(r.I0R(0,"li"),r.OEk(1),r.wVc(2,"translate"),r.C$Y()),2&ne&&(r.yG2(),r.oRS(" ",r.kDX(2,1,"igo.context.shareMap.filterOgc")," "))}function hn(ne,Ye){1&ne&&(r.I0R(0,"li"),r.OEk(1),r.wVc(2,"translate"),r.C$Y()),2&ne&&(r.yG2(),r.oRS(" ",r.kDX(2,1,"igo.context.shareMap.filterTime")," "))}function fn(ne,Ye){1&ne&&(r.I0R(0,"div"),r.yuY(1,cn,3,3,"h4",7),r.wVc(2,"translate"),r.I0R(3,"ul"),r.yuY(4,un,3,3,"li",7),r.wVc(5,"translate"),r.yuY(6,dn,3,3,"li",7),r.wVc(7,"translate"),r.yuY(8,kn,3,3,"li",7),r.wVc(9,"translate"),r.yuY(10,hi,3,3,"li",7),r.wVc(11,"translate"),r.yuY(12,pn,3,3,"li",7),r.wVc(13,"translate"),r.C$Y(),r.yuY(14,wi,3,3,"h4",7),r.wVc(15,"translate"),r.I0R(16,"ul"),r.yuY(17,oi,3,3,"li",7),r.wVc(18,"translate"),r.yuY(19,mn,3,3,"li",7),r.wVc(20,"translate"),r.yuY(21,gn,3,3,"li",7),r.wVc(22,"translate"),r.yuY(23,hn,3,3,"li",7),r.wVc(24,"translate"),r.C$Y()()),2&ne&&(r.yG2(),r.E7m("ngIf",""!==r.kDX(2,11,"igo.context.shareMap.included")),r.yG2(3),r.E7m("ngIf",""!==r.kDX(5,13,"igo.context.shareMap.context")),r.yG2(2),r.E7m("ngIf",""!==r.kDX(7,15,"igo.context.shareMap.center")),r.yG2(2),r.E7m("ngIf",""!==r.kDX(9,17,"igo.context.shareMap.zoom")),r.yG2(2),r.E7m("ngIf",""!==r.kDX(11,19,"igo.context.shareMap.addedLayers")),r.yG2(2),r.E7m("ngIf",""!==r.kDX(13,21,"igo.context.shareMap.visibleInvisible")),r.yG2(2),r.E7m("ngIf",""!==r.kDX(15,23,"igo.context.shareMap.excluded")),r.yG2(3),r.E7m("ngIf",""!==r.kDX(18,25,"igo.context.shareMap.order")),r.yG2(2),r.E7m("ngIf",""!==r.kDX(20,27,"igo.context.shareMap.opacity")),r.yG2(2),r.E7m("ngIf",""!==r.kDX(22,29,"igo.context.shareMap.filterOgc")),r.yG2(2),r.E7m("ngIf",""!==r.kDX(24,31,"igo.context.shareMap.filterTime")))}function yn(ne,Ye){1&ne&&(r.wR5(0,"igo-custom-html",9),r.wVc(1,"translate")),2&ne&&r.E7m("html",r.kDX(1,1,"igo.context.shareMap.htmlClarifications"))}let _n=(()=>{class ne{messageService;shareMapService;cdRef;mapState$$;map;url;publicShareOption={layerlistControls:{querystring:""}};constructor(f,H,Z){this.messageService=f,this.shareMapService=H,this.cdRef=Z}ngOnInit(){this.resetUrl(),this.mapState$$=(0,oo.E)([this.map.viewController.state$,this.map.status$]).subscribe(f=>{this.resetUrl(),this.cdRef.detectChanges()})}ngAfterViewInit(){this.resetUrl()}ngOnDestroy(){this.mapState$$.unsubscribe()}resetUrl(f={}){this.url=this.shareMapService.getUrlWithoutApi(this.map,this.publicShareOption)}copyTextToClipboard(f){X._D.copy(f)&&this.messageService.success("igo.context.shareMap.dialog.copyMsg","igo.context.shareMap.dialog.copyTitle")}static \u0275fac=function(H){return new(H||ne)(r.GI1(E.mi),r.GI1(Yi),r.GI1(r.kD9))};static \u0275cmp=r.In1({type:ne,selectors:[["igo-share-map-url"]],inputs:{map:"map"},standalone:!0,features:[r.UHJ],decls:17,vars:13,consts:[[1,"igo-input-container","linkToShare"],["matInput","","readonly","","rows","3",3,"placeholder","value"],["textArea",""],[1,"igo-form-button-group"],["mat-raised-button","",3,"click"],["svgIcon","content-copy"],[1,"mat-typography"],[4,"ngIf"],["class","shareCustomPadding","class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"]],template:function(H,Z){if(1&H){const _e=r.KQA();r.I0R(0,"div",0)(1,"mat-form-field"),r.wR5(2,"textarea",1,2),r.wVc(4,"translate"),r.C$Y(),r.I0R(5,"div",3)(6,"button",4),r.qCj("click",function(){r.usT(_e);const We=r.Gew(3);return r.CGJ(Z.copyTextToClipboard(We))}),r.wR5(7,"mat-icon",5),r.OEk(8),r.wVc(9,"translate"),r.C$Y()(),r.I0R(10,"div"),r.wR5(11,"br"),r.I0R(12,"section",6),r.yuY(13,fn,25,33,"div",7),r.wVc(14,"translate"),r.yuY(15,yn,2,3,"igo-custom-html",8),r.wVc(16,"translate"),r.C$Y()()()}2&H&&(r.yG2(2),r.E7m("placeholder",r.kDX(4,5,"igo.context.shareMap.placeholderLink"))("value",Z.url),r.yG2(6),r.oRS(" ",r.kDX(9,7,"igo.context.shareMap.copy")," "),r.yG2(5),r.E7m("ngIf",""===r.kDX(14,9,"igo.context.shareMap.htmlClarifications")),r.yG2(2),r.E7m("ngIf",""!==r.kDX(16,11,"igo.context.shareMap.htmlClarifications")))},dependencies:[h.wb,h.Up,j.cN,j.yi,d.oJ,d.Gw,tt.oB,tt.qL,y.u_,w.YM,T.O0,T.sD],styles:['@charset "UTF-8";mat-form-field[_ngcontent-%COMP%]{width:100%}.linkToShare\\a0[_ngcontent-%COMP%] {padding:25px 5px 5px}.linkToShare\\a0[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none;width:100%;line-height:1.3;height:40px;overflow-y:hidden;word-wrap:normal;word-break:break-all}.linkToShare\\a0[_ngcontent-%COMP%]   textarea.textAreaWithButton[_ngcontent-%COMP%]{width:calc(100% - 60px)}.linkToShare\\a0[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{float:right;margin:-10px 0}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}igo-custom-html.shareCustomPadding[_ngcontent-%COMP%]{padding:0}']})}return ne})();var ji=s(18268);function ii(ne,Ye){if(1&ne&&(r.I0R(0,"mat-tab-group")(1,"mat-tab",2),r.wVc(2,"translate"),r.wR5(3,"igo-share-map-api",3),r.C$Y(),r.I0R(4,"mat-tab",2),r.wVc(5,"translate"),r.wR5(6,"igo-share-map-url",3),r.C$Y()()),2&ne){const f=r.GaO();r.yG2(),r.E7m("label",r.kDX(2,4,"igo.context.shareMap.shareWithApi")),r.yG2(2),r.E7m("map",f.map),r.yG2(),r.E7m("label",r.kDX(5,6,"igo.context.shareMap.shareWithUrl")),r.yG2(2),r.E7m("map",f.map)}}function Cn(ne,Ye){if(1&ne&&r.wR5(0,"igo-share-map-url",3),2&ne){const f=r.GaO();r.E7m("map",f.map)}}let Oi=(()=>{class ne{config;map;hasApi=!1;constructor(f){this.config=f,this.hasApi=!!this.config.getConfig("context.url")}static \u0275fac=function(H){return new(H||ne)(r.GI1(b.aW))};static \u0275cmp=r.In1({type:ne,selectors:[["igo-share-map"]],inputs:{map:"map"},standalone:!0,features:[r.UHJ],decls:2,vars:2,consts:[[4,"ngIf"],[3,"map",4,"ngIf"],[3,"label"],[3,"map"]],template:function(H,Z){1&H&&r.yuY(0,ii,7,8,"mat-tab-group",0)(1,Cn,1,1,"igo-share-map-url",1),2&H&&(r.E7m("ngIf",Z.hasApi),r.yG2(),r.E7m("ngIf",!Z.hasApi))},dependencies:[y.u_,ji.WG,ji.aJ,ji._q,Vi,_n,T.O0,T.sD]})}return ne})(),yi=(()=>{class ne{contextService;messageService;component;editedContext$$;submitSuccessed=new r._w7;onEdit(f){this.contextService.update(this.component.context.id,f).subscribe(()=>{this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:f.title||this.component.context.title}),this.contextService.setEditedContext(void 0),this.submitSuccessed.emit(f)})}constructor(f,H,Z){this.contextService=H,this.messageService=Z,this.component=f}ngOnInit(){this.editedContext$$=this.contextService.editedContext$.subscribe(f=>this.handleEditedContextChange(f))}ngOnDestroy(){this.editedContext$$.unsubscribe()}handleEditedContextChange(f){this.component.context=f}static \u0275fac=function(H){return new(H||ne)(r.GI1(ao,2),r.GI1(ae),r.GI1(E.mi))};static \u0275dir=r.Sc5({type:ne,selectors:[["","igoContextEditBinding",""]],hostBindings:function(H,Z){1&H&&r.qCj("submitForm",function(we){return Z.onEdit(we)})},outputs:{submitSuccessed:"submitSuccessed"},standalone:!0})}return ne})(),Ti=(()=>{class ne{contextService;mapService;languageService;confirmDialogService;messageService;auth;storageService;cdRef;component;contexts$$;selectedContext$$;defaultContextId$$;previousMessageId;onSelect(f){this.contextService.loadContext(f.uri)}onEdit(f){this.contextService.loadEditedContext(f.uri)}onSave(f){const H=this.mapService.getMap(),Z=this.contextService.getContextFromMap(H),_e=()=>{this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:f.title})};if(f.imported)return Z.title=f.title,this.contextService.delete(f.id,!0),void this.contextService.create(Z).subscribe(We=>{this.contextService.loadContext(We.uri),_e()});this.contextService.update(f.id,{layers:Z.layers,map:{view:Z.map.view}}).subscribe(()=>{_e()})}onFavorite(f){f.id||(f.id=f.uri),this.contextService.setDefault(f.id).subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId),this.contextService.defaultContextId$.next(f.id);const H=this.messageService.success("igo.context.contextManager.dialog.favoriteMsg","igo.context.contextManager.dialog.favoriteTitle",void 0,{value:f.title});this.previousMessageId=H.toastId,this.cdRef.detectChanges()})}onManageTools(f){this.contextService.loadEditedContext(f.uri)}onManagePermissions(f){this.contextService.loadEditedContext(f.uri)}onDelete(f){this.confirmDialogService.open(this.languageService.translate.instant("igo.context.contextManager.dialog.confirmDelete")).subscribe(Z=>{Z&&this.contextService.delete(f.id,f.imported).subscribe(()=>{this.messageService.info("igo.context.contextManager.dialog.deleteMsg","igo.context.contextManager.dialog.deleteTitle",void 0,{value:f.title})})})}onClone(f){this.contextService.clone(f.id,{title:f.title+"-copy",uri:f.uri+"-copy"}).subscribe(()=>{this.messageService.success("igo.context.contextManager.dialog.cloneMsg","igo.context.contextManager.dialog.cloneTitle",void 0,{value:f.title})})}onCreate(f){const{title:H,empty:Z}=f,_e=this.contextService.getContextFromMap(this.component.map,Z);_e.title=H,this.contextService.create(_e).subscribe(()=>{this.messageService.success("igo.context.bookmarkButton.dialog.createMsg","igo.context.bookmarkButton.dialog.createTitle",void 0,{value:_e.title}),this.contextService.loadContext(_e.uri)})}loadContexts(){const f=["none"];for(const H of this.component.permissions)(!0===H.checked||!0===H.indeterminate)&&f.push(H.name);this.contextService.loadContexts(f,!!this.component.showHidden)}showHiddenContexts(){this.component.showHidden=!this.component.showHidden,this.storageService.set("contexts.showHidden",this.component.showHidden),this.loadContexts()}onShowContext(f){this.contextService.showContext(f.id).subscribe()}onHideContext(f){this.contextService.hideContext(f.id).subscribe()}constructor(f,H,Z,_e,we,We,gt,Ot,lt){this.contextService=H,this.mapService=Z,this.languageService=_e,this.confirmDialogService=we,this.messageService=We,this.auth=gt,this.storageService=Ot,this.cdRef=lt,this.component=f}ngOnInit(){this.component.contexts={ours:[]},this.component.showHidden=this.storageService.get("contexts.showHidden"),this.contexts$$=this.contextService.contexts$.subscribe(H=>this.handleContextsChange(H)),this.defaultContextId$$=this.contextService.defaultContextId$.subscribe(H=>{this.component.defaultContextId=H});const f=this.storageService.get("favorite.context.uri");f&&!this.auth.authenticated&&this.contextService.defaultContextId$.next(f),this.selectedContext$$=this.contextService.context$.pipe((0,O.o)(100)).subscribe(H=>this.component.selectedContext=H),this.auth.authenticate$.subscribe(H=>{H&&this.contextService.getProfilByUser().subscribe(Z=>{this.component.users=Z,this.component.permissions=[];const _e=this.component.users.reduce((We,gt)=>(We=We.concat(gt),gt.childs?We.concat(gt.childs):We),[]);for(const We of _e){const gt={name:We.name,checked:this.storageService.get("contexts.permissions."+We.name)};null===gt.checked&&(gt.checked=!0),this.component.permissions.push(gt)}const we=["none"];for(const We of this.component.permissions)(!0===We.checked||!0===We.indeterminate)&&we.push(We.name);this.contextService.loadContexts(we,!!this.component.showHidden)})})}ngOnDestroy(){this.contexts$$.unsubscribe(),this.selectedContext$$.unsubscribe(),this.defaultContextId$$.unsubscribe()}handleContextsChange(f){this.component.contexts=f}static \u0275fac=function(H){return new(H||ne)(r.GI1(ci,2),r.GI1(ae),r.GI1(B.u00),r.GI1(L.ov),r.GI1(w.Ex),r.GI1(E.mi),r.GI1(M.oj),r.GI1(N.yQ),r.GI1(r.kD9))};static \u0275dir=r.Sc5({type:ne,selectors:[["","igoContextListBinding",""]],hostBindings:function(H,Z){1&H&&r.qCj("select",function(we){return Z.onSelect(we)})("edit",function(we){return Z.onEdit(we)})("save",function(we){return Z.onSave(we)})("favorite",function(we){return Z.onFavorite(we)})("manageTools",function(we){return Z.onManageTools(we)})("managePermissions",function(we){return Z.onManagePermissions(we)})("delete",function(we){return Z.onDelete(we)})("clone",function(we){return Z.onClone(we)})("create",function(we){return Z.onCreate(we)})("filterPermissionsChanged",function(){return Z.loadContexts()})("showHiddenContexts",function(){return Z.showHiddenContexts()})("show",function(we){return Z.onShowContext(we)})("hide",function(we){return Z.onHideContext(we)})},standalone:!0,features:[r.M5G([w.Ex])]})}return ne})(),vn=(()=>{class ne{contextService;languageService;messageService;cd;component;editedContext$$;onAddPermission(f){f.profil?this.contextService.addPermissionAssociation(this.component.context.id,f.profil,f.typePermission).subscribe(Z=>{for(const we of Z)this.component.permissions[f.typePermission].push(we);this.messageService.success("igo.context.permission.dialog.addMsg","igo.context.permission.dialog.addTitle",void 0,{value:f.profil}),this.cd.detectChanges()}):this.messageService.error("igo.context.contextManager.errors.addPermissionEmpty","igo.context.contextManager.errors.addPermissionTitle")}onRemovePermission(f){this.contextService.deletePermissionAssociation(this.component.context.id,f.id).subscribe(()=>{const Z=this.component.permissions[f.typePermission].findIndex(we=>we.id===f.id);this.component.permissions[f.typePermission].splice(Z,1),this.messageService.success("igo.context.permission.dialog.deleteMsg","igo.context.permission.dialog.deleteTitle",void 0,{value:f.profil}),this.cd.detectChanges()})}onScopeChanged(f){const H=f.scope;this.contextService.update(f.id,{scope:H}).subscribe(()=>{this.messageService.success("igo.context.permission.dialog.scopeChangedMsg","igo.context.permission.dialog.scopeChangedTitle",void 0,{value:"igo.context.permission.scope."+H})})}constructor(f,H,Z,_e,we){this.contextService=H,this.languageService=Z,this.messageService=_e,this.cd=we,this.component=f}ngOnInit(){this.editedContext$$=this.contextService.editedContext$.subscribe(f=>this.handleEditedContextChange(f))}ngOnDestroy(){this.editedContext$$.unsubscribe(),this.contextService.editedContext$.next(void 0)}handleEditedContextChange(f){this.component.context=f,f&&this.contextService.getPermissions(f.id).subscribe(H=>{const Z={read:(H=H||[]).filter(_e=>"read"===_e.typePermission.toString()),write:H.filter(_e=>"write"===_e.typePermission.toString())};return this.component.permissions=Z})}static \u0275fac=function(H){return new(H||ne)(r.GI1(to,2),r.GI1(ae),r.GI1(L.ov),r.GI1(E.mi),r.GI1(r.kD9))};static \u0275dir=r.Sc5({type:ne,selectors:[["","igoContextPermissionsBinding",""]],hostBindings:function(H,Z){1&H&&r.qCj("addPermission",function(we){return Z.onAddPermission(we)})("removePermission",function(we){return Z.onRemovePermission(we)})("scopeChanged",function(we){return Z.onScopeChanged(we)})},standalone:!0})}return ne})();var Wi=s(728),Ei=s(6560),Ni=s(86708);let xi=(()=>{class ne{component;contextService;layerService;configService;styleListService;styleService;route;context$$;queryParams;contextLayers=[];removeLayersOnContextChange=!0;get map(){return this.component.map}constructor(f,H,Z,_e,we,We,gt){this.component=f,this.contextService=H,this.layerService=Z,this.configService=_e,this.styleListService=we,this.styleService=We,this.route=gt}ngOnInit(){this.context$$=this.contextService.context$.pipe((0,Ei.I)(f=>void 0!==f)).subscribe(f=>this.handleContextChange(f)),this.route&&this.route.options.visibleOnLayersKey&&this.route.options.visibleOffLayersKey&&this.route.options.contextKey&&this.route.queryParams.pipe((0,S.K)(f=>!X.Yv.isEmpty(f))).subscribe(f=>{this.queryParams=f})}ngOnDestroy(){this.context$$.unsubscribe()}handleContextChange(f){if(void 0===f.layers)return;!0===this.removeLayersOnContextChange?this.map.removeAllLayers():this.map.removeLayers(this.contextLayers),this.contextLayers=[];const H=(0,Wi.U)(...f.layers.map((Z,_e)=>this.layerService.createAsyncLayer(Z,f.uri)));H.pipe((0,Ni.c)(H.pipe((0,O.o)(500)))).subscribe(Z=>{this.handleAddLayers(Z),f.extraFeatures&&f.extraFeatures.forEach(_e=>{this.configService.getConfig("importExport")?.importWithStyle?function Se(ne,Ye,f,H){let Z,_e,we;if(f.getStyleList(ne.name+".styleByAttribute")){const Ot=f.getStyleList(ne.name+".styleByAttribute");Z=(lt,kt)=>H.createStyleByAttribute(lt,Ot,kt)}else if(f.getStyleList(ne.name+".clusterStyle")){const Ot=f.getStyleList(ne.name+".clusterParam");_e=f.getStyleList(ne.name+".distance"),Z=(lt,kt)=>{const Pt=H.createStyle(f.getStyleList(ne.name+".clusterStyle"),lt,kt);return H.createClusterStyle(lt,kt,Ot,Pt)}}else Z=f.getStyleList(ne.name+".style")?(Ot,lt)=>H.createStyle(f.getStyleList(ne.name+".style"),Ot,lt):(Ot,lt)=>H.createStyle(f.getStyleList("default.style"),Ot,lt);const We=Be(ne);f.getStyleList(ne.name+".clusterStyle")?(we=new B.aaH({distance:_e,type:"cluster",queryable:!0}),we.ol.source.addFeatures(We)):(we=new B.EBb({type:"vector",queryable:!0}),we.ol.addFeatures(We));const gt=new B.Mdo({title:ne.name,isIgoInternalLayer:!0,source:we,style:Z,opacity:ne.opacity,visible:ne.visible});Ye.addLayer(gt)}(_e,this.map,this.styleListService,this.styleService):function vt(ne,Ye){const H=Be(ne),Z=new B.EBb({type:"vector",queryable:!0});Z.ol.addFeatures(H);let _e,we=!1;const We=H[0]?.getKeys()??[];We.includes("_style")||We.includes("_mapTitle")?_e=(0,B.M4J)():(_e=(0,B.Cyp)(),we=!0);const gt=new B.Mdo({title:ne.name,isIgoInternalLayer:!0,source:Z,igoStyle:{editable:we},style:_e,visible:ne.visible,opacity:ne.opacity});Ye.addLayer(gt)}(_e,this.map)})}),this.layerService.createAsyncIdbLayers(f.uri).pipe((0,O.o)(500)).subscribe(Z=>this.handleAddLayers(Z))}handleAddLayers(f){f=f.filter(H=>void 0!==H).map(H=>(H.visible=this.computeLayerVisibilityFromUrl(H),H.zIndex=H.zIndex,H)),this.contextLayers.concat(f),this.map.addLayers(f)}computeLayerVisibilityFromUrl(f){const H=this.queryParams,_e=f.id;let we=f.visible;if(!H||!_e)return we;const We=H[this.route.options.contextKey];if(We===this.contextService.context$.value.uri||!We){let gt="",Ot="",lt=[],kt=[];this.route.options.visibleOnLayersKey&&H[this.route.options.visibleOnLayersKey]&&(gt=H[this.route.options.visibleOnLayersKey]),this.route.options.visibleOffLayersKey&&H[this.route.options.visibleOffLayersKey]&&(Ot=H[this.route.options.visibleOffLayersKey]),"*"===gt&&(we=!0),"*"===Ot&&(we=!1),lt=gt.split(","),kt=Ot.split(","),(lt.indexOf(_e)>-1||lt.indexOf(_e.toString())>-1)&&(we=!0),(kt.indexOf(_e)>-1||kt.indexOf(_e.toString())>-1)&&(we=!1)}return we}static \u0275fac=function(H){return new(H||ne)(r.GI1(B.q2F),r.GI1(ae),r.GI1(B.IZ6),r.GI1(b.aW),r.GI1(B.cTh),r.GI1(B.UND),r.GI1(oe.k$,8))};static \u0275dir=r.Sc5({type:ne,selectors:[["","igoLayerContext",""]],inputs:{removeLayersOnContextChange:"removeLayersOnContextChange"},standalone:!0,features:[r.M5G([ie.SU])]})}return ne})();var Hi=s(9588);let Mi=(()=>{class ne{contextService;mediaService;component;context$$;get map(){return this.component.map}constructor(f,H,Z){this.contextService=H,this.mediaService=Z,this.component=f}ngOnInit(){this.context$$=this.contextService.context$.pipe((0,Ei.I)(f=>void 0!==f)).subscribe(f=>this.handleContextChange(f))}ngOnDestroy(){this.context$$.unsubscribe()}handleContextChange(f){if(void 0===f.map)return;const H=f.map.view;(!this.component.view||!0!==H.keepCurrentView||f.map.view.projection!==this.map.projection)&&(this.component.view=H),this.component.map.geolocationController&&this.component.map.geolocationController.updateGeolocationOptions(H);const Z=f.map.controls;if(!this.component.controls&&Z){if(this.mediaService.isMobile()&&"boolean"!=typeof Z.scaleLine){const _e=Z.scaleLine;_e.minWidth||(_e.minWidth=Math.min(64,_e.minWidth),Z.scaleLine=_e)}this.component.controls=Z}}static \u0275fac=function(H){return new(H||ne)(r.GI1(B.q2F),r.GI1(ae),r.GI1(Hi.QB))};static \u0275dir=r.Sc5({type:ne,selectors:[["","igoMapContext",""]],standalone:!0})}return ne})()},23302:(Ee,ce,s)=>{"use strict";s.d(ce,{U9:()=>e.U,YP:()=>y.Y});var y=s(12044),e=s(99744);s(48576)},48576:(Ee,ce,s)=>{"use strict";s.d(ce,{b:()=>g});var y=s(20968),e=s(99744),d=s(34896);let g=(()=>{class R{activityService;constructor(h){this.activityService=h}intercept(h,j){const x=h.headers.get("activityInterceptor");if(x){const b=h.clone({headers:h.headers.delete("activityInterceptor")});if("false"===x)return j.handle(b)}const w=this.activityService.register();return j.handle(h).pipe((0,y.U)(()=>{this.activityService.unregister(w)}))}static \u0275fac=function(j){return new(j||R)(d.CoB(e.U))};static \u0275prov=d.wxM({token:R,factory:R.\u0275fac})}return R})()},12044:(Ee,ce,s)=>{"use strict";s.d(ce,{Y:()=>g});var y=s(33712),e=s(48576),d=s(34896);let g=(()=>{class R{static forRoot(){return{ngModule:R,providers:[{provide:y.So,useClass:e.b,multi:!0}]}}static \u0275fac=function(j){return new(j||R)};static \u0275mod=d.a4G({type:R});static \u0275inj=d.s3X({})}return R})()},99744:(Ee,ce,s)=>{"use strict";s.d(ce,{U:()=>g});var y=s(64002),e=s(54844),d=s(34896);let g=(()=>{class R{counter$=new e.g(0);ids=[];constructor(){}register(){const h=(0,y.uq)();return this.ids.push(h),this.counter$.next(this.ids.length),h}unregister(h){const j=this.ids.indexOf(h);-1!==j&&(this.ids.splice(j,1),this.counter$.next(this.ids.length))}static \u0275fac=function(j){return new(j||R)};static \u0275prov=d.wxM({token:R,factory:R.\u0275fac,providedIn:"root"})}return R})()},83600:(Ee,ce,s)=>{"use strict";s.d(ce,{aW:()=>d.a,mK:()=>y.m,W0:()=>e.W0,WU:()=>g.W});var y=s(81424),e=s(68656),d=s(81252),g=s(49692)},81424:(Ee,ce,s)=>{"use strict";s.d(ce,{m:()=>d});var y=s(68656),e=s(34896);let d=(()=>{class g{static forRoot(){return{ngModule:g,providers:[(0,y.W0)({}),(0,y.Gc)()]}}static \u0275fac=function(h){return new(h||g)};static \u0275mod=e.a4G({type:g});static \u0275inj=e.s3X({})}return g})()},68656:(Ee,ce,s)=>{"use strict";s.d(ce,{Gc:()=>o,W0:()=>g});var y=s(34896),e=s(81252);let d=new y.UbH("configOptions");function g(h){return{provide:d,useValue:h}}function R(h,j){return()=>h.load(j)}function o(){return{provide:y.kZF,useFactory:R,multi:!0,deps:[e.a,d]}}},81252:(Ee,ce,s)=>{"use strict";s.d(ce,{a:()=>w});var y=s(33712),e=s(64002),d=s(54844),g=s(39732),R=s(51672);const o={showMenuButton:{alternativeKey:"menu.button.visible",mayBeRemoveIn:new Date("2024-06-06")},menuButtonReverseColor:{alternativeKey:"menu.button.useThemeColor",mayBeRemoveIn:new Date("2024-06-06")},importWithStyle:{alternativeKey:"importExport.importWithStyle",mayBeRemoveIn:new Date("2024-06-06")},hasGeolocateButton:{alternativeKey:"geolocate.button.visible",mayBeRemoveIn:new Date("2024-06-06")}},h=new Map(Object.entries(o).filter(([b,E])=>E.alternativeKey).map(([b,E])=>[E.alternativeKey,{deprecatedKey:b}]));var j=s(49692),x=s(34896);let w=(()=>{class b{config;httpClient;configDeprecated=new Map(Object.entries(o));_isLoaded$=new d.g(null);isLoaded$=this._isLoaded$.asObservable();constructor(T){this.httpClient=new y.KK(T)}getConfigs(){return Array.from(this.configDeprecated.keys()).map(T=>{void 0!==e.Yv.resolve(this.config,T)&&this.handleDeprecatedConfig(T)}),this.config}getConfig(T,a){let K=e.Yv.resolve(this.config,T);return this.configDeprecated.get(T)&&void 0!==K?this.handleDeprecatedConfig(T):void 0===K&&(K=this.handleDeprecationPossibility(T)),K??a}handleDeprecatedConfig(T){const a=this.configDeprecated.get(T);let K=`This config (${T}) is deprecated and will be removed shortly`;a.alternativeKey&&(K+=` You should use this key (${a.alternativeKey}) as an alternate solution`),new Date>=a.mayBeRemoveIn?console.error(K):console.warn(K)}handleDeprecationPossibility(T){const a=h.get(T);if(a)return this.getConfig(a.deprecatedKey)}load(T){const a=T.default;return T.path?new Promise((K,M)=>{this.httpClient.get(T.path).pipe((0,R.a)(L=>(console.log(`Configuration file ${T.path} could not be read`),K(!0),(0,g.c)(L.error||"Server error")))).subscribe(L=>{this.config=e.Yv.mergeDeep(e.Yv.mergeDeep({version:j.W},a),L),this._isLoaded$.next(!0),K(!0)})}):(this.config=a,this._isLoaded$.next(!0),!0)}static \u0275fac=function(a){return new(a||b)(x.CoB(y.m))};static \u0275prov=x.wxM({token:b,factory:b.\u0275fac,providedIn:"root"})}return b})()},49692:(Ee,ce,s)=>{"use strict";s.d(ce,{W:()=>y});const y={lib:"17.0.0-next.3",releaseDate:1710249630294}},24708:(Ee,ce,s)=>{"use strict";s.d(ce,{_s:()=>d,ov:()=>K,QW:()=>L});var y=s(72584),e=s(34896);let d=(()=>{class X{static \u0275fac=function(W){return new(W||X)};static \u0275mod=e.a4G({type:X});static \u0275inj=e.s3X({imports:[y.O0]})}return X})();var g=s(33712),R=s(64002),o=s(54844),h=s(83680),j=s(19432),x=s(44816),w=s(40604),b=s(78600);class E{configService;prefix;suffix;httpClient;_isLoaded$=new o.g(null);isLoaded$=this._isLoaded$.asObservable();constructor(V,z,W,A=".json"){this.configService=z,this.prefix=W,this.suffix=A,this.httpClient=new g.KK(V)}getTranslation(V){const z=this.httpClient.get(`locale/libs_locale/${V}.json`);return this.configService.isLoaded$.pipe((0,h.K)(W=>W),(0,j.G)(()=>{if(this.configService&&!this.prefix){const q=this.configService.getConfig("language.prefix");this.prefix=!q||Array.isArray(q)?q:[q]}if(!this.prefix||0===this.prefix.length)return this._isLoaded$.next(!0),z;const W=this.prefix.map(q=>this.httpClient.get(`${q}${V}${this.suffix}`));return(0,x.y)([z,...W]).pipe((0,w.k)(q=>q.reduce((_,u)=>R.Yv.mergeDeep(_,u),{})),(0,b.y)(()=>{this._isLoaded$.next(!0)}))}))}}var T=s(83600),a=s(35876);let K=(()=>{class X{translate;language;language$=new o.g(void 0);constructor(z){this.translate=z,this.language=this.translate.getBrowserLang();const W=this.getLanguage();this.translate.setDefaultLang(W),this.language$.next(W)}getLanguage(){return this.language.match(/en|fr/)?this.language:"en"}setLanguage(z){this.language=z.match(/en|fr/)?z:"en",(0,a.E)([this.translate.use(this.language),this.translate.reloadLang(this.language)]).subscribe(()=>{this.language$.next(this.language)})}static \u0275fac=function(W){return new(W||X)(e.CoB(y.qS))};static \u0275prov=e.wxM({token:X,factory:X.\u0275fac,providedIn:"root"})}return X})();class M{handle(V){if(!V.translateService.langs.length)throw new Error("Translations are not yet loaded.          Check that the LanguageService is injected.");if("igo."===V.key.substr(0,4))throw new Error(`The Key "${V.key}" is missing in locale file.`);return V.key}}function L(X){return(0,e.AFj)([(0,e.ai8)(y.O0.forRoot(oe(X))),{provide:e.kZF,useFactory:V=>()=>V.translate.currentLoader.isLoaded$?.pipe((0,h.K)(z=>!0===z)),deps:[K],multi:!0}])}const oe=X=>({defaultLanguage:"fr",loader:X??N,missingTranslationHandler:{provide:y.sf,useClass:M}}),N={provide:y._E,useFactory:function B(X,V){return new E(X,V,void 0,void 0)},deps:[g.m,T.aW]}},9588:(Ee,ce,s)=>{"use strict";s.d(ce,{oZ:()=>y,cz:()=>e,QB:()=>o});var y=function(h){return h.Mobile="mobile",h.Tablet="tablet",h.Desktop="desktop",h}(y||{}),e=function(h){return h.Portrait="portrait",h.Landscape="landscape",h}(e||{}),d=s(73192),g=s(54844),R=s(34896);let o=(()=>{class h{media$=new g.g(void 0);orientation$=new g.g(void 0);constructor(x){x.observe([d.kP.HandsetLandscape]).subscribe(w=>{w.matches&&(this.media$.next(y.Mobile),this.orientation$.next(e.Landscape))}),x.observe([d.kP.HandsetPortrait]).subscribe(w=>{w.matches&&(this.media$.next(y.Mobile),this.orientation$.next(e.Portrait))}),x.observe([d.kP.TabletLandscape]).subscribe(w=>{w.matches&&(this.media$.next(y.Tablet),this.orientation$.next(e.Landscape))}),x.observe([d.kP.TabletPortrait]).subscribe(w=>{w.matches&&(this.media$.next(y.Tablet),this.orientation$.next(e.Portrait))}),x.observe([d.kP.WebLandscape]).subscribe(w=>{w.matches&&(this.media$.next(y.Desktop),this.orientation$.next(e.Landscape))}),x.observe([d.kP.WebPortrait]).subscribe(w=>{w.matches&&(this.media$.next(y.Desktop),this.orientation$.next(e.Portrait))})}getMedia(){return this.media$.value}getOrientation(){return this.orientation$.value}isTouchScreen(){return"ontouchstart"in document.documentElement}isMobile(){return"mobile"===this.getMedia()}isDesktop(){return"desktop"===this.getMedia()}static \u0275fac=function(w){return new(w||h)(R.CoB(d.w$))};static \u0275prov=R.wxM({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})()},93020:(Ee,ce,s)=>{"use strict";s.d(ce,{UD:()=>d,mi:()=>b});var y=s(38472),e=s(34896);let d=(()=>{class E{static forRoot(){return{ngModule:E,providers:[]}}static \u0275fac=function(K){return new(K||E)};static \u0275mod=e.a4G({type:E});static \u0275inj=e.s3X({imports:[y.gv.forRoot({positionClass:"toast-bottom-right",timeOut:1e4,extendedTimeOut:1e4,titleClass:"mat-subtitle-2",messageClass:"toast-message",closeButton:!0,progressBar:!0,enableHtml:!0,tapToDismiss:!0,maxOpened:4,preventDuplicates:!0,resetTimeoutOnDuplicate:!0,countDuplicates:!1,includeTitleDuplicates:!0})]})}return E})();var g=function(E){return E.ERROR="error",E.ALERT="warning",E.WARNING="warning",E.INFO="info",E.SUCCESS="success",E.SHOW="show",E}(g||{}),R=s(83600),o=s(24708),h=s(54844),j=s(44816),x=s(24112),w=s(83680);let b=(()=>{class E{injector;configService;languageService;messages$=new h.g([]);options;activeMessageTranslations=[];constructor(a,K,M){this.injector=a,this.configService=K,this.languageService=M,this.options=this.configService.getConfig("message"),this.languageService.language$.pipe((0,x.o)(500)).subscribe(L=>{0===this.toastr.toasts.length&&(this.activeMessageTranslations=[]),this.toastr.toasts.map(oe=>{const N=this.activeMessageTranslations.find(B=>B.id===oe.toastId);if(N){const B={...N.textInterpolateParams},X={...N.titleInterpolateParams};N.textInterpolateParams&&Object.keys(N.textInterpolateParams).map(V=>{V&&(B[V]=this.languageService.translate.instant(N.textInterpolateParams[V]))}),N.titleInterpolateParams&&Object.keys(N.titleInterpolateParams).map(V=>{V&&(X[V]=this.languageService.translate.instant(N.titleInterpolateParams[V]))}),(0,j.y)([this.languageService.translate.get(N.textKey,B),this.languageService.translate.get(N.titleKey,X)]).pipe((0,w.K)()).subscribe(V=>{oe.toastRef.componentInstance.message=V[0],oe.toastRef.componentInstance.title=V[1]})}})})}get toastr(){return this.injector.get(y.SA)}showError(a){return a.error.caught=!0,this.error(a.error.message,a.error.title)}message(a){const K=a.type;this.toastr.toastrConfig.iconClasses[K]=`toast-${K}`,this.messages$.next(this.messages$.value.concat([a])),a.options=a.options||{};const M=new Date;if(a.options.from=a.options.from?a.options.from:new Date("1 jan 1900"),a.options.to=a.options.to?a.options.to:new Date("1 jan 3000"),"string"==typeof a.options.from&&(a.options.from=new Date(Date.parse(a.options.from.replace(/-/g," ")))),"string"==typeof a.options.to&&(a.options.to=new Date(Date.parse(a.options.to.replace(/-/g," ")))),M>a.options.from&&M<a.options.to&&(!1===a.showIcon&&(this.toastr.toastrConfig.iconClasses[K]=`toast-${K} toast-no-icon`),(a=this.handleTemplate(a)).text)){let L;switch(a.type){case g.SUCCESS:L=this.success(a.text,a.title,a.options,a.textInterpolateParams,a.titleInterpolateParams);break;case g.ERROR:L=this.error(a.text,a.title,a.options,a.textInterpolateParams,a.titleInterpolateParams);break;case g.INFO:L=this.info(a.text,a.title,a.options,a.textInterpolateParams,a.titleInterpolateParams);break;case g.SHOW:L=this.show(a.text,a.title,a.options,a.textInterpolateParams,a.titleInterpolateParams);break;case g.ALERT:case g.WARNING:L=this.alert(a.text,a.title,a.options,a.textInterpolateParams,a.titleInterpolateParams);break;default:L=this.info(a.text,a.title,a.options,a.textInterpolateParams,a.titleInterpolateParams)}a.options.id=L.toastId}}success(a,K="igo.core.message.success",M={},L,oe){return this.handleNgxToastr("success",a,K,M,L,oe)}error(a,K="igo.core.message.error",M={},L,oe){return this.handleNgxToastr("error",a,K,M,L,oe)}info(a,K="igo.core.message.info",M={},L,oe){return this.handleNgxToastr("info",a,K,M,L,oe)}alert(a,K="igo.core.message.alert",M={},L,oe){return this.handleNgxToastr("alert",a,K,M,L,oe)}show(a,K="igo.core.message.info",M={},L,oe){return this.handleNgxToastr("show",a,K,M,L,oe)}handleNgxToastr(a,K,M,L={},oe,N){const B={...oe},X={...N};oe&&Object.keys(oe).map(A=>{const q=oe[A];q&&(B[A]="string"==typeof q?this.languageService.translate.instant(q):q)}),N&&Object.keys(N).map(A=>{if(A){const q=N[A];X[A]="string"==typeof q?this.languageService.translate.instant(q):q}});const V=this.languageService.translate.instant(K,B),z=this.languageService.translate.instant(M,X);let W;switch(a){case"success":W=this.toastr.success(V,z,L);break;case"error":W=this.toastr.error(V,z,L);break;case"show":case"info":W=this.toastr.info(V,z,L);break;case"alert":W=this.toastr.warning(V,z,L)}return this.activeMessageTranslations.push({id:W.toastId,titleKey:M,textKey:K,textInterpolateParams:oe,titleInterpolateParams:N}),W}remove(a){this.toastr.remove(a)}removeAllAreNotError(){for(const a of this.messages$.value)a.type!==g.ERROR&&this.remove(a.options.id)}handleTemplate(a){if(!this.options?.template||a.html)return a;let K=this.options?.template;return K=K.replace("${text}",a.text),K=K.replace("${title}",a.title),a.html=void 0,a.text=K,a.title=void 0,a}static \u0275fac=function(K){return new(K||E)(e.CoB(e.zZn),e.CoB(R.aW),e.CoB(o.ov))};static \u0275prov=e.wxM({token:E,factory:E.\u0275fac,providedIn:"root"})}return E})()},70772:(Ee,ce,s)=>{"use strict";s.d(ce,{ct:()=>T,L7:()=>d,ms:()=>a});var y=s(11687);const e=L=>L.enableTracing||!!L.tracesSampleRate||!!L.tracesSampler,d=L=>{(0,y.u6)(L?{id:L.id,username:`${L.firstName} ${L.lastName}`,email:L.email}:null)};var g=s(34896),R=s(57880),o=s(25556),h=s(51540),j=s(75848),x=s(68123);const E=L=>{if(void 0!==L.enabled&&!L.enabled)return[];(L=>{if((0,h.WS)().getClient())return;const N=e(L),B={dsn:L.dsn,environment:L.environment,release:L.release,integrations:[N&&new j.CC({routingInstrumentation:o.CI}),L.enableReplay&&new x.SQ].filter(Boolean)};(0,o._6)(B)})(L);const N=e(L);return[{provide:g.eAe,useFactory:()=>(L=>(0,o.W4)({logErrors:L.logErrors,...L.errorHandlerOptions??{}}))(L)},N&&{provide:o.a4,deps:[R.E5]},N&&{provide:g.kZF,useFactory:()=>()=>{},deps:[o.a4],multi:!0}].filter(Boolean)},T=new g.UbH("monitoring.options");function a(L){if(!L)return[];const oe=[{provide:T,useValue:L}];return"sentry"===L.provider&&oe.push(...E(L)),oe}},39882:(Ee,ce,s)=>{"use strict";s.d(ce,{u:()=>o});var y=s(34896),e=s(93020),d=s(93244),g=s(24112),R=s(31792);let o=(()=>{class h{messageService;injector;stateChangeEventEmitter=new y._w7;onlineSubscription;offlineSubscription;previousMessageId;state={connection:window.navigator.onLine};constructor(x,w){this.messageService=x,this.injector=w,this.checkNetworkState()}checkNetworkState(){this.onlineSubscription=(0,d.w)(window,"online").subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId);const x=this.messageService.info("igo.core.network.online.message","igo.core.network.online.title");this.previousMessageId=x.toastId,this.state.connection=!0,this.emitEvent()}),this.offlineSubscription=(0,d.w)(window,"offline").subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId);const x=this.messageService.info("igo.core.network.offline.message","igo.core.network.offline.title");this.previousMessageId=x.toastId,this.state.connection=!1,this.emitEvent()})}emitEvent(){this.stateChangeEventEmitter.emit(this.state)}ngOnDestroy(){try{this.offlineSubscription.unsubscribe(),this.onlineSubscription.unsubscribe()}catch{}}currentState(x=!0){return x?this.stateChangeEventEmitter.pipe((0,g.o)(300),(0,R.W)(this.state)):this.stateChangeEventEmitter.pipe((0,g.o)(300))}static \u0275fac=function(w){return new(w||h)(y.CoB(e.mi),y.CoB(y.zZn))};static \u0275prov=y.wxM({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})()},84112:(Ee,ce,s)=>{"use strict";s.d(ce,{k$:()=>R});var y=s(34896),e=s(57880);let d=new y.UbH("routeServiceOptions"),R=(()=>{class o{router;route;options;constructor(j,x,w){this.router=j,this.route=x,this.options=Object.assign({},{centerKey:"center",zoomKey:"zoom",projectionKey:"projection",contextKey:"context",searchKey:"search",visibleOnLayersKey:"visiblelayers",visibleOffLayersKey:"invisiblelayers",directionsCoordKey:"routing",directionsOptionsKey:"routingOptions",toolKey:"tool",wmsUrlKey:"wmsUrl",wmsLayersKey:"wmsLayers",wmtsUrlKey:"wmtsUrl",wmtsLayersKey:"wmtsLayers",arcgisUrlKey:"arcgisUrl",arcgisLayersKey:"arcgisLayers",iarcgisUrlKey:"iarcgisUrl",iarcgisLayersKey:"iarcgisLayers",tarcgisUrlKey:"tarcgisUrl",tarcgisLayersKey:"tarcgisLayers",vectorKey:"vector"},w)}get queryParams(){let j=decodeURIComponent(location.search);if(j.includes("\xa2er=")){j=j.replace("\xa2er","&center");const x=j.slice(1).split("&").map(w=>w.split("=")).reduce((w,b)=>{const[E,T]=b.map(decodeURIComponent);return w[E]=T,w},{});this.router.navigate([],{queryParams:x})}return this.route.queryParams}static \u0275fac=function(x){return new(x||o)(y.CoB(e.E5),y.CoB(e.gV),y.CoB(d,8))};static \u0275prov=y.wxM({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})()},21720:(Ee,ce,s)=>{"use strict";s.d(ce,{kR:()=>g,Ab:()=>e,yQ:()=>h,Om:()=>d});var y=s(54844),e=function(j){return j.SESSION="Session",j.LOCAL="Local",j}(e||{}),d=function(j){return j.ADDED="Added",j.MODIFIED="Modified",j.REMOVED="Removed",j.CLEARED="Cleared",j}(d||{});class g{options;storageChange$=new y.g(void 0);constructor(x){this.options=x.getConfig("storage")||{key:"igo"}}get(x,w){let b;if((!w||w===e.SESSION)&&(b=sessionStorage.getItem(`${this.options.key}.${x}`)),(w===e.LOCAL||!b&&!w)&&(b=localStorage.getItem(`${this.options.key}.${x}`)),b)try{b=JSON.parse(b)}catch{}return b}set(x,w,b=e.LOCAL){const E=this.get(x,b);b===e.SESSION?sessionStorage.setItem(`${this.options.key}.${x}`,JSON.stringify(w)):localStorage.setItem(`${this.options.key}.${x}`,JSON.stringify(w));const T=this.get(x,b);T!==E&&this.storageChange$.next({key:x,scope:b,event:void 0!==E?d.MODIFIED:d.ADDED,previousValue:E,currentValue:T})}remove(x,w=e.LOCAL){const b=this.get(x,w);w===e.SESSION?sessionStorage.removeItem(`${this.options.key}.${x}`):localStorage.removeItem(`${this.options.key}.${x}`),this.storageChange$.next({key:x,scope:w,event:d.REMOVED,previousValue:b})}clear(x=e.LOCAL){x===e.SESSION?sessionStorage.clear():localStorage.clear(),this.storageChange$.next({scope:x,event:d.CLEARED})}}var R=s(83600),o=s(34896);let h=(()=>{class j extends g{config;constructor(w){super(w),this.config=w}static \u0275fac=function(b){return new(b||j)(o.CoB(R.aW))};static \u0275prov=o.wxM({token:j,factory:j.\u0275fac,providedIn:"root"})}return j})()},28660:(Ee,ce,s)=>{"use strict";s.d(ce,{I:()=>e,S:()=>y});var y=function(d){return d.wms="wms",d.wmts="wmts",d.arcgisrest="esriJSON",d.imagearcgisrest="esriJSON",d.tilearcgisrest="esriJSON",d}(y||{}),e=function(d){return d.FeatureLayer="Feature Layer",d.RasterLayer="Raster Layer",d.GroupLayer="Group Layer",d}(e||{})},21780:(Ee,ce,s)=>{"use strict";s.d(ce,{S:()=>z});var y=s(21124),e=s(33712),d=s(64002),g=s(156),R=s(49240),o=s(36584),h=s(73592),j=s(61252),x=s(46184),w=s(44816),b=s(1296),E=s(21296),T=s(40604),a=s(51672),K=s(90916),M=s(14191),L=s(59324),oe=s(49704),N=s(88824),B=s(28660),X=s(34896),V=s(12268);class z{http;mapService;parsers={wms:new R.c,wmts:new o.c,esriJSON:new h.c};constructor(A,q){this.http=A,this.mapService=q}getWMSOptions(A){return this.getCapabilities("wms",A.url,A.params.VERSION).pipe((0,T.k)(u=>u?this.parseWMSOptions(A,u):void 0))}getWMTSOptions(A){return this.getCapabilities("wmts",A.url,A.version).pipe((0,T.k)(S=>S?this.parseWMTSOptions(A,S):void 0))}getCartoOptions(A){return this.http.jsonp("https://"+A.account+".carto.com/api/v2/viz/"+A.mapId+"/viz.json","callback").pipe((0,T.k)(_=>this.parseCartoOptions(A,_)))}getArcgisOptions(A){const q=A.url+"/"+A.layer+"?f=json",_=this.getCapabilities("arcgisrest",A.url),u=this.http.get(q);return(0,w.y)([u,_]).pipe((0,T.k)(S=>this.parseArcgisOptions(A,S[0],S[1])))}getImageArcgisOptions(A){const q=A.url+"/"+A.layer+"?f=json",_=A.url+"/legend?f=json",u=this.getCapabilities("imagearcgisrest",A.url),S=this.http.get(q),P=this.http.get(_).pipe((0,T.k)(I=>I),(0,a.a)(I=>(console.log("No legend associated with this Image Service"),(0,b.of)(I))));return(0,w.y)([S,P,u]).pipe((0,T.k)(I=>this.parseTileOrImageArcgisOptions(A,I[0],I[1],I[2])))}getTileArcgisOptions(A){const q=A.url+"/"+A.layer+"?f=json",_=A.url+"/legend?f=json",u=this.getCapabilities("tilearcgisrest",A.url),S=this.http.get(q),P=this.http.get(_).pipe((0,T.k)(I=>I),(0,a.a)(I=>(console.log("No legend associated with this Tile Service"),(0,b.of)(I))));return(0,w.y)([S,P,u]).pipe((0,T.k)(I=>this.parseTileOrImageArcgisOptions(A,I[0],I[1],I[2])))}getCapabilities(A,q,_){const u=new e.i4({fromObject:{request:"GetCapabilities",service:A.toUpperCase(),version:_||"1.3.0",_i:"true"}});let S;return S="esriJSON"===B.S[A]?this.http.get(q+"?f=json"):this.http.get(q,{params:u,responseType:"text"}),S.pipe((0,T.k)(P=>{if("esriJSON"===B.S[A])return P;if(String(P).toLowerCase().includes("serviceexception")&&String(P).toLowerCase().includes("access denied"))throw{error:{message:"Service error getCapabilities: Access is denied"}};return this.parsers[A].read(P)}),(0,a.a)(P=>{throw typeof P.error<"u"&&(P.error.caught=!0),P}))}parseWMSOptions(A,q){const u=this.findDataSourceInCapabilities(q.Capability.Layer,A.params.LAYERS);if(!u)throw{error:{message:"Layer not found"}};const S=u.DataURL?u.DataURL[0]:void 0,P=u.Abstract?u.Abstract:void 0,I=u.KeywordList?u.KeywordList:void 0;let U=u.queryable;const G=this.getTimeFilter(u),O=G&&Object.keys(G).length>0,F=u.Style?this.getStyle(u.Style):void 0;let Q=!0;u.EX_GeographicBoundingBox?u.EX_GeographicBoundingBox.forEach((le,ue)=>{ue<2&&(le>180||le<-180)&&(Q=!1),ue>=2&&(le>90||le<-90)&&(Q=!1)}):Q=!1;const r=Q?j.W0(u.EX_GeographicBoundingBox,"EPSG:4326",this.mapService.getMap().projection):void 0;let ie;const ae=[oe.cv.GEOJSON,oe.cv.GEOJSON2,oe.cv.GML3,oe.cv.GML2,oe.cv.JSON,oe.cv.HTML];for(const le of ae)if(-1!==q.Capability.Request.GetFeatureInfo.Format.indexOf(le)){const ue=Object.keys(oe.cv).find(se=>oe.cv[se]===le);ie=oe.s5[ue];break}ie||(U=!1);const fe=d.Yv.removeUndefined({_layerOptionsFromSource:{title:u.Title,maxResolution:(0,L.bg)(u.MaxScaleDenominator),minResolution:(0,L.bg)(u.MinScaleDenominator),extent:r,metadata:{url:S?S.OnlineResource:void 0,extern:!!S||void 0,abstract:P,keywordList:I},legendOptions:F},queryable:U,queryFormat:ie,timeFilter:O?G:void 0,timeFilterable:!!O||void 0,minDate:O?G.min:void 0,maxDate:O?G.max:void 0,stepDate:O?G.step:void 0});return d.Yv.mergeDeep(fe,A)}parseWMTSOptions(A,q){const _=q.Contents.Layer.find(I=>I.Identifier===A.layer),u=(0,x.o)(q,A),S=Object.assign(u,A),P=d.Yv.removeUndefined({_layerOptionsFromSource:{title:_.Title}});return d.Yv.mergeDeep(P,S)}parseCartoOptions(A,q){const _=[],u=q.layers[1].options.layer_definition;u.layers.forEach(P=>{_.push({type:P.type.toLowerCase(),options:P.options,legend:P.legend})});const S=d.Yv.removeUndefined({config:{version:u.version,layers:_}});return d.Yv.mergeDeep(S,A)}parseArcgisOptions(A,q,_){const u=q.name;let S,P;S=q.drawingInfo?.renderer?q.drawingInfo.renderer:void 0,q.drawingInfo&&(P=(new N.y).generateStyle(q,"esriMeters"===q.units?"m":"degrees"));const I=new g.c({target:q.copyrightText});let U,G;if(q.timeInfo){const Q=q.timeInfo.timeExtent;U=Q[0]+","+Q[1];const r=new Date;r.setTime(Q[0]);const ie=new Date;ie.setTime(Q[1]),G={min:r.toUTCString(),max:ie.toUTCString(),range:!0,type:M.U.DATETIME,style:M.D.CALENDAR}}const O=Object.assign({},{style:P,LAYERS:A.layer?"show:"+A.layer:void 0,time:U}),F=d.Yv.removeUndefined({params:O,_layerOptionsFromSource:{title:u,minResolution:(0,L.bg)(q.maxScale),maxResolution:(0,L.bg)(q.minScale),metadata:{extern:!1,abstract:q.description||_.serviceDescription}},legendInfo:S,timeFilter:G,sourceFields:q.fields,queryTitle:q.displayField});return F.attributions=I,d.Yv.mergeDeep(F,A)}parseTileOrImageArcgisOptions(A,q,_,u){const S=q.name,P=_.layers?_.layers.find(Q=>Q.layerName===S):void 0,I=new g.c({target:q.copyrightText});let U,G;if(q.timeInfo){const Q=q.timeInfo.timeExtent;U=Q[0]+","+Q[1];const r=new Date;r.setTime(Q[0]);const ie=new Date;ie.setTime(Q[1]),G={min:r.toUTCString(),max:ie.toUTCString(),range:!0,type:M.U.DATETIME,style:M.D.CALENDAR}}const O=Object.assign({},{LAYERS:A.layer?"show:"+A.layer:void 0,time:U}),F=d.Yv.removeUndefined({params:O,_layerOptionsFromSource:{title:S,minResolution:(0,L.bg)(q.maxScale),maxResolution:(0,L.bg)(q.minScale),metadata:{extern:!1,abstract:q.description||u.serviceDescription}},legendInfo:P,timeFilter:G,sourceFields:q.fields,queryTitle:q.displayField});return F.attributions=I,d.Yv.mergeDeep(F,A)}findDataSourceInCapabilities(A,q){if(Array.isArray(A)){let _;return A.find(u=>(_=this.findDataSourceInCapabilities(u,q),void 0!==_),this),_}return A.Layer?this.findDataSourceInCapabilities(A.Layer,q):A.Name&&A.Name===q?A:void 0}getTimeFilter(A){let q;if(A.Dimension){const _={};if(q=A.Dimension[0],q.values){const u=q.values.split("/");_.min=void 0!==u[0]?u[0]:void 0,_.max=void 0!==u[1]?u[1]:void 0,_.step=void 0!==u[2]?u[2]:void 0}return q.default&&(_.value=q.default),_}}getStyle(A){return{stylesAvailable:A.map(u=>({name:u.Name,title:u.Title})).filter((u,S,P)=>P.findIndex(I=>I.name===u.name)===S)}}static \u0275fac=function(q){return new(q||z)(X.CoB(e.KK),X.CoB(V.u))};static \u0275prov=X.wxM({token:z,factory:z.\u0275fac,providedIn:"root"})}(0,y.UN)([(0,K.w)({maxCacheCount:20}),(0,y.YR)("design:type",Function),(0,y.YR)("design:paramtypes",[Object]),(0,y.YR)("design:returntype",E._)],z.prototype,"getArcgisOptions",null),(0,y.UN)([(0,K.w)({maxCacheCount:20}),(0,y.YR)("design:type",Function),(0,y.YR)("design:paramtypes",[Object]),(0,y.YR)("design:returntype",E._)],z.prototype,"getImageArcgisOptions",null),(0,y.UN)([(0,K.w)({maxCacheCount:20}),(0,y.YR)("design:type",Function),(0,y.YR)("design:paramtypes",[Object]),(0,y.YR)("design:returntype",E._)],z.prototype,"getTileArcgisOptions",null),(0,y.UN)([(0,K.w)({maxCacheCount:20}),(0,y.YR)("design:type",Function),(0,y.YR)("design:paramtypes",[String,String,String]),(0,y.YR)("design:returntype",E._)],z.prototype,"getCapabilities",null)},61200:(Ee,ce,s)=>{"use strict";s.d(ce,{O:()=>M});var y=s(21724),e=s(24708),d=s(93020),g=s(64002),R=s(54844),o=s(21296),h=s(1296),j=s(44816),x=s(51672),w=s(40604),b=s(21780),E=s(3544),T=s(92344),a=s(34896);class K{}let M=(()=>{class L{capabilitiesService;optionsService;wfsDataSourceService;languageService;messageService;authInterceptor;datasources$=new R.g([]);constructor(N,B,X,V,z,W){this.capabilitiesService=N,this.optionsService=B,this.wfsDataSourceService=X,this.languageService=V,this.messageService=z,this.authInterceptor=W}createAsyncDataSource(N,B){if(!N.type)throw console.error(N),new Error("Datasource needs a type");let X;switch(N.type.toLowerCase()){case"osm":X=this.createOSMDataSource(N);break;case"vector":X=this.createFeatureDataSource(N);break;case"wfs":X=this.createWFSDataSource(N);break;case"wms":const V=N;g.Yv.removeDuplicateCaseInsensitive(V.params),X=this.createWMSDataSource(V,B);break;case"wmts":X=this.createWMTSDataSource(N);break;case"xyz":X=this.createXYZDataSource(N);break;case"tiledebug":X=this.createTileDebugDataSource(N);break;case"carto":X=this.createCartoDataSource(N);break;case"arcgisrest":X=this.createArcGISRestDataSource(N,B);break;case"imagearcgisrest":X=this.createArcGISRestImageDataSource(N,B);break;case"websocket":X=this.createWebSocketDataSource(N);break;case"mvt":X=this.createMVTDataSource(N);break;case"tilearcgisrest":X=this.createTileArcGISRestDataSource(N,B);break;case"cluster":X=this.createClusterDataSource(N);break;default:throw console.error(N),new Error("Invalid datasource type")}return this.datasources$.next(this.datasources$.value.concat([X])),X}createOSMDataSource(N){return new o._(B=>B.next(new E.yC(N)))}createFeatureDataSource(N){return new o._(B=>B.next(new E.EB(N)))}createWebSocketDataSource(N){return new o._(B=>B.next(new E.cR(N)))}createWFSDataSource(N){return new o._(B=>B.next(new E.ak(N,this.wfsDataSourceService,this.authInterceptor)))}createWMSDataSource(N,B){const X=[];return N.optionsFromCapabilities&&window.navigator.onLine&&X.push(this.capabilitiesService.getWMSOptions(N).pipe((0,x.a)(V=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:N.params.LAYERS}),V}))),this.optionsService&&N.optionsFromApi&&window.navigator.onLine&&X.push(this.optionsService.getWMSOptions(N,B).pipe((0,x.a)(V=>(V.error.toDisplay=!0,V.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),V.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,h.of)({}))))),X.push((0,h.of)(N)),(0,j.y)(X).pipe((0,w.k)(V=>{const z=V.reduce((W,A)=>g.Yv.mergeDeep(W,A));return new E.CK(z,this.wfsDataSourceService)}),(0,x.a)(()=>(0,h.of)(void 0)))}createWMTSDataSource(N){return N.optionsFromCapabilities&&window.navigator.onLine?this.capabilitiesService.getWMTSOptions(N).pipe((0,w.k)(B=>B?new E.m6(B):void 0),(0,x.a)(()=>(this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:N.layer}),(0,h.of)(void 0)))):new o._(B=>B.next(new E.m6(N)))}createXYZDataSource(N){return new o._(B=>B.next(new E.nA(N)))}createTileDebugDataSource(N){return new o._(B=>B.next(new E.Uv(N)))}createCartoDataSource(N){return N.mapId?this.capabilitiesService.getCartoOptions(N).pipe((0,w.k)(B=>new E.aI(B))):new o._(B=>B.next(new E.aI(N)))}createArcGISRestDataSource(N,B){const X=[];return window.navigator.onLine&&X.push(this.capabilitiesService.getArcgisOptions(N).pipe((0,x.a)(V=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:N.layer}),V}))),this.optionsService&&N.optionsFromApi&&window.navigator.onLine&&X.push(this.optionsService.getArcgisRestOptions(N,B).pipe((0,x.a)(V=>(V.error.toDisplay=!0,V.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),V.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,h.of)({}))))),X.push((0,h.of)(N)),(0,j.y)(X).pipe((0,w.k)(V=>{const z=V.reduce((W,A)=>g.Yv.mergeDeep(W,A));return new E.IH(z)}),(0,x.a)(()=>(0,h.of)(void 0)))}createArcGISRestImageDataSource(N,B){const X=[];return window.navigator.onLine&&X.push(this.capabilitiesService.getImageArcgisOptions(N).pipe((0,x.a)(V=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:N.params.LAYERS}),V}))),this.optionsService&&N.optionsFromApi&&window.navigator.onLine&&X.push(this.optionsService.getArcgisRestOptions(N,B).pipe((0,x.a)(V=>(V.error.toDisplay=!0,V.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),V.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,h.of)({}))))),X.push((0,h.of)(N)),(0,j.y)(X).pipe((0,w.k)(V=>{const z=V.reduce((W,A)=>g.Yv.mergeDeep(W,A));return new E.yA(z)}),(0,x.a)(()=>(0,h.of)(void 0)))}createTileArcGISRestDataSource(N,B){const X=[];return window.navigator.onLine&&X.push(this.capabilitiesService.getImageArcgisOptions(N).pipe((0,x.a)(V=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:N.params.LAYERS}),V}))),this.optionsService&&N.optionsFromApi&&window.navigator.onLine&&X.push(this.optionsService.getArcgisRestOptions(N,B).pipe((0,x.a)(V=>(V.error.toDisplay=!0,V.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),V.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,h.of)({}))))),X.push((0,h.of)(N)),(0,j.y)(X).pipe((0,w.k)(V=>{const z=V.reduce((W,A)=>g.Yv.mergeDeep(W,A));return new E.W4(z)}),(0,x.a)(()=>(0,h.of)(void 0)))}createMVTDataSource(N){return new o._(B=>B.next(new E.cv(N)))}createClusterDataSource(N){return new o._(B=>B.next(new E.a(N)))}static \u0275fac=function(B){return new(B||L)(a.CoB(b.S),a.CoB(K,8),a.CoB(T.Q),a.CoB(e.ov),a.CoB(d.mi),a.CoB(y.kT))};static \u0275prov=a.wxM({token:L,factory:L.\u0275fac,providedIn:"root"})}return L})()},93176:(Ee,ce,s)=>{"use strict";s.d(ce,{a:()=>g});var y=s(64002),e=s(3784),d=s(67732);class g extends d.E{createOlSource(){return this.options.format=this.getSourceFormatFromOptions(this.options),this.options.source=super.createOlSource(),new e.c(this.options)}generateId(){return(0,y.uq)()}onUnwatch(){}}},94052:(Ee,ce,s)=>{"use strict";s.d(ce,{C:()=>e});var y=s(47864);class e{options;dataService;id;ol;legend;constructor(g={},R){this.options=g,this.dataService=R,this.options=g,this.id=this.options.id||this.generateId(),this.ol=this.createOlSource()}generateId(){return(0,y.KC)(this.options)}getLegend(g,R){return this.legend?this.legend:[]}setLegend(g){return this.legend=g.url?[{url:g.url}]:g.html?[{html:g.html}]:[],this.legend}}},67732:(Ee,ce,s)=>{"use strict";s.d(ce,{E:()=>R});var y=s(12396),e=s(83900),d=s(28772),g=s(94052);class R extends g.C{createOlSource(){const h={format:this.getSourceFormatFromOptions(this.options)};return new d.c(Object.assign(h,this.options))}getSourceFormatFromOptions(h){if(h.format)return h.format;let j;const x=h.formatType;if(x){if(j=e[x],void 0===j)throw new Error("Invalid vector source format ${formatType}.")}else j=y.c;const w=h.formatOptions;let b;return b=w?new j(w):new j,b}onUnwatch(){}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}}},3544:(Ee,ce,s)=>{"use strict";s.d(ce,{IH:()=>X,aI:()=>N,a:()=>F.a,EB:()=>e.E,yA:()=>z,cv:()=>O,yC:()=>g,W4:()=>W.W,Uv:()=>_,ak:()=>b,CK:()=>T.C,m6:()=>M,cR:()=>u,nA:()=>o});var y=s(94052),e=s(67732),d=s(19860);class g extends y.C{createOlSource(){return this.options.url||(this.options.url="https://tile.openstreetmap.org/{z}/{x}/{y}.png"),new d.c(this.options)}onUnwatch(){}}var R=s(49228);class o extends y.C{createOlSource(){return new R.c(this.options)}onUnwatch(){}}var h=s(91784),j=s(28772),x=s(40912),w=s(38084);class b extends y.C{options;wfsService;authInterceptor;set ogcFilters(r){this.options.ogcFilters=r}get ogcFilters(){return this.options.ogcFilters}constructor(r,ie,ae){super((0,w.w$)(r,"wfs")),this.options=r,this.wfsService=ie,this.authInterceptor=ae;const fe=this.options.ogcFilters,le=this.options.paramsWFS.fieldNameGeometry||w.k3,ue=new x.S;this.options.ogcFilters=ue.defineOgcFiltersDefaultOptions(fe,le),this.options.ogcFilters.enabled&&this.options.ogcFilters.editable&&(r.sourceFields||[]).filter(se=>!se.values).length>0&&this.wfsService.getSourceFieldsFromWFS(this.options),fe?.pushButtons&&(fe.pushButtons.selectorType="pushButton"),fe?.checkboxes&&(fe.checkboxes.selectorType="checkbox"),fe?.radioButtons&&(fe.radioButtons.selectorType="radioButton"),fe?.select&&(fe.select.selectorType="select"),fe?.autocomplete&&(fe.autocomplete.selectorType="autocomplete"),this.setOgcFilters(this.options.ogcFilters,!0)}createOlSource(){return new j.c({format:(0,w.So)(this.options),strategy:h.OK})}setOgcFilters(r,ie=!1){this.ogcFilters=r,ie&&this.ol.notify("ogcFilters",this.ogcFilters)}onUnwatch(){}}s(92344);var T=s(21808),a=s(46184),K=s(43940);class M extends y.C{constructor(r){super(r)}createOlSource(){const r=Object.assign({tileGrid:(0,K.g)(this.options.projection)},this.options);return new a.c(r)}onUnwatch(){}}var L=s(51008),oe=s(49704);class N extends y.C{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:oe.Il.BLANK}createOlSource(){const ie=Object.assign({crossOrigin:this.options.crossOrigin?this.options.crossOrigin:"anonymous"},this.options);return new L.c(ie)}getLegend(){const r=super.getLegend();if(r.length>0)return r;let ie="<table>";if(this.options.config.layers[0].legend)return this.options.config.layers[0].legend.items.forEach(ae=>{!0===ae.visible&&(ie+='<tr><td><p><font size="5" color="'+ae.value+'"> &#9679</font></p></td><td>'+ae.name+"</td></tr>")}),ie+="</table>",[{html:ie}];{const ae=this.options.config.layers[0].options,fe=["polygon-fill:","marker-fill:","shield-fill:","building-fill:","line-color:"];for(const le of fe)if(ae.cartocss.includes(le)){const ue=ae.cartocss.split(le).pop(),se=ue.substr(0,ue.indexOf(";"));if(se.includes("ramp")){const ge=se.split(", (")[1].split(","),Ie=se.split(", (")[2].split(",");for(let Re=0;Re<ge.length;Re++)ge[Re]=ge[Re].replace(/("|\))/g,""),Ie[Re]=Ie[Re].replace(/("|\))/g,""),"="===Ie[Re].replace(/\s+/g,"")&&(Ie[Re]="Autres"),ie+='<tr><td><p><font size="5" color="'+ge[Re]+'"> &#9679</font></p></td><td>'+Ie[Re]+"</td></tr>";break}ie+='<tr><td><p><font size="5" color="'+se+'"> &#9679</font></p></td><td>'+(ae.layer_name?ae.layer_name:"")+"</td></tr>";break}return ie+="</table>",[{html:ie}]}}onUnwatch(){}}var B=s(73592);class X extends y.C{createOlSource(){const r=new B.c;return new j.c({attributions:this.options.params.attributions,overlaps:!1,format:r,url:function(ie,ae,fe){const le=this.options.url+"/"+this.options.layer+"/query/",se=["f=json",`geometry=${encodeURIComponent('{"xmin":'+ie[0]+',"ymin":'+ie[1]+',"xmax":'+ie[2]+',"ymax":'+ie[3]+',"spatialReference":{"wkid":102100}}')}`,"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"];return this.options.params.time&&se.push(`time=${this.options.params.time}`),this.options.params.customParams&&this.options.params.customParams.forEach(ge=>{se.push(ge)}),`${le}?${se.join("&")}`}.bind(this),strategy:h.OK})}getLegend(){const r=this.options.legendInfo,ie=super.getLegend();if(void 0===r||ie.length>0)return ie;if(!r)return;let fe,le,ue,ae="<table>";if(r.legend)for(const se of r.legend)fe=this.htmlImgSrc(se.contentType,se.imageData),le=se.label?se.label.replace("<Null>","Null"):"",ae+="<tr><td align='left'><img src=\""+fe+'" alt =\'\' /></td><td class="mat-typography">'+le+"</td></tr>";else if("uniqueValue"===r.type)for(const se of r.uniqueValueInfos)le=se.label.replace("<Null>","Null"),"esriPMS"===se.symbol.type?(fe=this.htmlImgSrc(se.symbol.contentType,se.symbol.imageData),ae+="<tr><td align='left'><img src=\""+fe+'" alt =\'\' /></td><td class="mat-typography">'+le+"</td></tr>"):"esriPMS"!==se.symbol.type&&(ue=this.createSVG(se.symbol),ae+="<tr><td align='left'>"+ue+'</td><td class="mat-typography">'+le+"</td></tr>");else"simple"===r.type&&(le=r.label?r.label.replace("<Null>","Null"):"","esriPMS"===r.symbol.type?(fe=this.htmlImgSrc(r.symbol.contentType,r.symbol.imageData),ae+="<tr><td align='left'><img src=\""+fe+'" alt =\'\' /></td><td class="mat-typography">'+le+"</td></tr>"):"esriPMS"!==r.symbol.type&&(ue=this.createSVG(r.symbol),ae+="<tr><td align='left'>"+ue+'</td><td class="mat-typography">'+le+"</td></tr>"));return ae+="</table>",[{html:ae}]}htmlImgSrc(r,ie){return`data:${r};base64,${ie}`}createSVG(r){let ie="";const ae=r.color?r.color:[0,0,0,0];if("esriSLS"===r.type){const le="stroke:rgba("+ae[0]+","+ae[1]+","+ae[2]+","+ae[3]+")",ue="stroke-width:"+(r.width?r.width:0);"esriSLSSolid"===r.style?ie='<svg height="30" width="30"><line x1="0" y1="15" x2="30" y2="15" style="'+le+";"+ue+'"/></svg>':"esriSLSDash"===r.style&&(ie='<svg height="30" width="30"><line x1="0" y1="15" x2="30" y2="15" style="'+le+";"+ue+'" stroke-dasharray="5,5"/></svg>')}else if("esriSMSCircle"===r.style||"esriSFSSolid"===r.style){const fe=r.outline.color,se="stroke:rgba("+fe[0]+","+fe[1]+","+fe[2]+","+fe[3]+")",ge="stroke-width:"+r.outline.width,Ie="fill:rgba("+ae[0]+","+ae[1]+","+ae[2]+","+ae[3]+")";ie="esriSMSCircle"===r.style?'<svg height="30" width="30"><circle cx="15" cy="15" r="'+r.size/2+'" style="'+se+";"+ge+";"+Ie+'"/></svg>':'<svg height="30" width="30"><rect x="5" y="5" width="20" height="20" style ="'+se+";"+ge+";"+Ie+'"/></svg>'}return ie}onUnwatch(){}}var V=s(38952);class z extends y.C{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:oe.Il.BLANK}createOlSource(){const r=void 0===this.options.layer?this.options.params:Object.assign({LAYERS:`show:${this.options.layer}`},this.options.params);return"object"==typeof r.renderingRule&&(r.renderingRule=JSON.stringify(r.renderingRule)),new V.c({ratio:1,params:r,url:this.options.url})}getLegend(){const r=this.options.legendInfo,ie=super.getLegend();if(void 0===r||void 0===this.options.layer||ie.length>0)return ie;if(!r)return;let ae="<table>";for(const fe of r.legend)ae+=`<tr><td align='left'><img src="${this.options.url}/${r.layerId}/images/${fe.url}" alt ='' /></td><td class="mat-typography">`+fe.label.replace("<Null>","Null")+"</td></tr>";return ae+="</table>",[{html:ae}]}onUnwatch(){}}var W=s(92424),A=s(19508),q=s(48720);class _ extends y.C{createOlSource(){const r=JSON.parse(JSON.stringify(this.options));return this.options.tileGrid&&(delete r.tileGrid,r.tileGrid=new q.c(this.options.tileGrid)),new A.c(r)}onUnwatch(){}}class u extends e.E{ws;createOlSource(){return this.createWebSocket(),this.options.format=this.getSourceFormatFromOptions(this.options),super.createOlSource()}createWebSocket(){this.ws=new WebSocket(this.options.url),this.ws.onmessage=this.onMessage.bind(this),this.options.onclose&&(this.ws.onclose=this.onClose.bind(this)),this.options.onerror&&(this.ws.onerror=this.onError.bind(this)),this.options.onopen&&(this.ws.onopen=this.onOpen.bind(this))}onMessage(r){const ie=this.options.format.readFeature(r.data);switch(this.options.onmessage){case"update":const ae=this.ol.getFeatureById(ie.getId());ae&&this.ol.removeFeature(ae),this.ol.addFeature(ie);break;case"delete":this.ol.clear(!0),this.ol.addFeature(ie);break;default:this.ol.addFeature(ie)}}onClose(r){}onError(r){}onOpen(r){}onUnwatch(){this.ws.close()}}var S=s(64002),P=s(58264),I=s(99668),U=s(19076),G=s(11772);class O extends y.C{createOlSource(){let r;return r="feature"===this.options.featureClass?new I.c({featureClass:P.c}):new I.c,this.options.format=r,new U.c(this.options)}generateId(){return this.options.url?G.Cy.hashStr("mvt"+this.options.url):(0,S.uq)()}onUnwatch(){}}var F=s(93176)},92424:(Ee,ce,s)=>{"use strict";s.d(ce,{W:()=>g});var y=s(96120),e=s(49704),d=s(94052);class g extends d.C{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:e.Il.BLANK}createOlSource(){return new y.c(this.options)}getLegend(){const o=this.options.legendInfo,h=super.getLegend();if(void 0===o||void 0===this.options.layer||h.length>0)return h;if(!o)return;let j="<table>";for(const x of o.legend)j+=`<tr><td align='left'><img src="${this.options.url}/${o.layerId}/images/${x.url}" alt ='' /></td><td class="mat-typography">`+x.label.replace("<Null>","Null")+"</td></tr>";return j+="</table>",[{html:j}]}onUnwatch(){}}},92344:(Ee,ce,s)=>{"use strict";s.d(ce,{Q:()=>x});var y=s(21296),e=s(1296),d=s(35876),g=s(10211);class R{}var o=s(38084),h=s(34896),j=s(33712);let x=(()=>{class w extends R{http;constructor(E){super(),this.http=E}getData(){return console.log("This is defining a data service."),"This is defining a data service."}getSourceFieldsFromWFS(E){E.sourceFields&&0!==E.sourceFields.length?this.defineFieldAndValuefromWFS(E).subscribe(T=>{E.sourceFields.forEach(a=>{void 0===a.alias&&(a.alias=a.name),(void 0===a.values||0===a.values.length)&&(a.values=T.find(K=>K.name===a.name).values)})}):(E.sourceFields=[],this.defineFieldAndValuefromWFS(E).subscribe(T=>{E.sourceFields=T}))}wfsGetFeature(E,T=o.G4,a=o.sn,K,M=0,L=!1){const N=(0,o.as)(E,T,a,K,M,L).find(X=>"getfeature"===X.name).value,B=E.paramsWFS.outputFormat;return L||o._K.test(B)||!B?this.http.get(N,{responseType:"text"}):this.http.get(N)}defineFieldAndValuefromWFS(E){return new y._(T=>{const a=[];let K,M,L,oe,N;oe=(0,o.So)(E);const B=JSON.parse(JSON.stringify(E));delete B.paramsWFS.outputFormat,delete B.formatOptions,N=(0,o.So)(B);let X=E.sourceFields?.filter(V=>!V.values).map(V=>V.name);this.wfsGetFeature(E,1,void 0,void 0,0,!0).pipe((0,g.m)(V=>String(V).toLowerCase().includes("exception")?(0,e.of)(!1):(0,e.of)(!0)),(0,g.m)(V=>this.wfsGetFeature(E,1).pipe((0,g.m)(z=>{const W=oe.readFeatures(z);K=W[0].getKeys(),(E.sourceFields||0===E.sourceFields.length)&&(X=K),M=K.filter(_=>X.includes(_)&&_!==W[0].getGeometryName()&&!_.match(/boundedby/gi)),L=M.join(",");const A=[];let q=0;if(!V&&"2.0.0"===E.paramsWFS.version&&E.paramsWFS.maxFeatures>o.G4){for(;q<E.paramsWFS.maxFeatures;)A.push(this.wfsGetFeature(E,1e3,E.paramsWFS.srsName,L,q)),q+=1e3;N=oe}else A.push(this.wfsGetFeature(E,E.paramsWFS.maxFeatures||o.G4,E.paramsWFS.srsName,L,0,!0));return(0,d.E)(A)})))).subscribe(V=>{let z=[];V.map(W=>{const A=N.readFeatures(W);z=z.concat(A)}),this.built_properties_value(z).forEach(W=>{a.push(W)}),T.next(a),T.complete()})})}built_properties_value(E){if(0===E.length)return[];const T=Object.assign({},E[0].getProperties());delete T[E[0].getGeometryName()],delete T.boundedBy;const a=[];for(const K in T)if(T.hasOwnProperty(K)){const M="object"==typeof E[0].get(K)?void 0:typeof E[0].get(K);a.push({name:K,alias:K,type:M,values:[T[K]]})}return E.every(K=>{const M=K.getProperties();for(const L in M)M.hasOwnProperty(L)&&L in T&&a.filter(oe=>oe.name===L).forEach(oe=>{-1===oe.values.indexOf(M[L])&&oe.values.push(M[L])});return!0}),a}static \u0275fac=function(T){return new(T||w)(h.CoB(j.KK))};static \u0275prov=h.wxM({token:w,factory:w.\u0275fac,providedIn:"root"})}return w})()},21808:(Ee,ce,s)=>{"use strict";s.d(ce,{C:()=>j});var y=s(64002),e=s(45804),d=s(54844),g=s(40912),R=s(49704),o=s(94052),h=s(38084);class j extends o.C{options;wfsService;get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:R.Il.BLANK}set ogcFilters(w){this.options.ogcFilters=w}get ogcFilters(){return this.options.ogcFilters}set timeFilter(w){this.options.timeFilter=w}get timeFilter(){return this.options.timeFilter}timeFilter$=new d.g(void 0);constructor(w,b){super(w),this.options=w,this.wfsService=b;const E=w.params,T=E.DPI||96;E.DPI=T,E.MAP_RESOLUTION=T,E.FORMAT_OPTIONS="dpi:"+T,w.refreshIntervalSec&&w.refreshIntervalSec>0&&setInterval(()=>{this.refresh()},1e3*w.refreshIntervalSec);let a=h.k3;if(w.paramsWFS){const N=(0,h.w$)(w,"wms");y.Yv.mergeDeep(w.paramsWFS,N.paramsWFS),a=w.paramsWFS.fieldNameGeometry||a,w.download=Object.assign({},w.download,{dynamicUrl:this.buildDynamicDownloadUrlFromParamsWFS(w)})}w.sourceFields&&0!==w.sourceFields.length?w.sourceFields.forEach(N=>{N.alias=N.alias?N.alias:N.name}):w.sourceFields=[];const K=w.ogcFilters,M=new g.S;K?(K.advancedOgcFilters=!(K.pushButtons||K.checkboxes||K.radioButtons||K.select||K.autocomplete),K.advancedOgcFilters&&K.filters&&K.filters.calendarModeYear&&(K.advancedOgcFilters=!1),K.pushButtons&&(K.pushButtons.selectorType="pushButton"),K.checkboxes&&(K.checkboxes.selectorType="checkbox"),K.radioButtons&&(K.radioButtons.selectorType="radioButton"),K.select&&(K.select.selectorType="select"),K.autocomplete&&(K.autocomplete.selectorType="autocomplete")):w.ogcFilters=M.defineOgcFiltersDefaultOptions(K,a,"wms"),E.LAYERS.split(",").length>1&&K&&K.enabled&&(console.log("*******************************"),console.log("BE CAREFULL, YOUR WMS LAYERS ("+E.LAYERS+") MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! "),console.log("*******************************")),w.paramsWFS&&K&&K.enabled&&K.editable&&(w.sourceFields||[]).filter(N=>!N.values).length>0&&this.wfsService.getSourceFieldsFromWFS(w);const L=M.handleOgcFiltersAppliedValue(w,a);E.FILTER=L,this.ol.updateParams({FILTER:E.FILTER}),this.setOgcFilters(K,!0);const oe=w;oe?.timeFilterable&&oe?.timeFilter&&this.setTimeFilter(oe.timeFilter,!0)}refresh(){this.ol.updateParams({igoRefresh:Math.random()})}buildDynamicDownloadUrlFromParamsWFS(w){return(0,h.as)(w).find(T=>"getfeature"===T.name).value}createOlSource(){return new e.c(Object.assign({ratio:1},this.options))}setOgcFilters(w,b=!1){this.ogcFilters=w,b&&this.ol.notify("ogcFilters",this.ogcFilters)}setTimeFilter(w,b=!1){this.timeFilter=w,b&&(this.timeFilter$.next(this.timeFilter),this.ol.notify("timeFilter",this.ogcFilters))}getLegend(w,b){let E=super.getLegend();if(E.length>0&&void 0===w&&!b?.scale)return E;let a,T=!1;b?.size&&b?.extent&&b?.projection&&this.options.contentDependentLegend&&(a="1.3.0"===this.params.VERSION||void 0===this.params.VERSION?"CRS":"SRS",T=!0);const K=this.params;let M=[];void 0!==K.LAYERS&&(M=K.LAYERS.split(","));const L=this.options.url.replace(/\?$/,""),oe=["REQUEST=GetLegendGraphic","SERVICE=WMS","FORMAT=image/png","SLD_VERSION=1.1.0",`VERSION=${K.VERSION||"1.3.0"}`];return void 0!==w&&oe.push(`STYLE=${w}`),void 0!==b?.scale&&oe.push(`SCALE=${b.scale}`),T&&(oe.push(`WIDTH=${b.size[0]}`),oe.push(`HEIGHT=${b.size[1]}`),oe.push(`BBOX=${b.extent.join(",")}`),oe.push(`${a}=${b.projection}`)),E=M.map(N=>{const B=L.match(/\?/)?"&":"?";return{url:`${L}${B}${oe.join("&")}&LAYER=${N}`,title:M.length>1?N:void 0,currentStyle:void 0===w?void 0:w}}),E}onUnwatch(){}}},38084:(Ee,ce,s)=>{"use strict";s.d(ce,{G4:()=>K,So:()=>z,_K:()=>oe,as:()=>X,k3:()=>L,sn:()=>a,w$:()=>V,yK:()=>B});var y=s(11544),e=s(83900),d=s(58288),g=s(12396),R=s(73592),o=s(79084),h=s(10416),j=s(17439),x=s(95456),w=s(14984),b=s(61972),E=s(1676),T=s(40912);const a="EPSG:3857",K=5e3,M="2.0.0",L="geometry",oe=new RegExp(/(.*)?gml(.*)?/gi);function B(W,A,q,_,u){const S=W.paramsWFS,P=X(W,void 0,W.paramsWFS.srsName);let I;_?.enabled&&(I=_?.filters);const U=new T.S,G=U.buildFilter(I,A,q,_?.geometryName,W);let O=U.handleOgcFiltersAppliedValue(W,_?.geometryName,A,q),F="filter";O||(F="bbox",O=A.join(",")+","+q.getCode()),S.xmlFilter=_?.advancedOgcFilters?G:`${F}=${O}`;let Q=P.find(ie=>"getfeature"===ie.name).value;return Q=/(filter|bbox)=.*/gi.test(S.xmlFilter)?`${Q}&${S.xmlFilter}`:Q,W.download=Object.assign({},W.download,{dynamicUrl:Q}),u&&(Q+=`$&_t${(new Date).getTime()}`),Q.replace(/&&/g,"&")}function X(W,A,q,_,u=0,S=!1){const P="2.0.0",I=W.urlWfs,U=W.paramsWFS,G=A||K,O=U.version===P?`startIndex=${u}`:"",F=q||a;let Q=U.outputFormat?`outputFormat=${U.outputFormat}`:"",r=U.version?`version=${U.version}`:`version=${M}`;const ae=`${U.version===P?"typenames":"typename"}=${U.featureTypes}`,fe=U.version===P?"count":"maxFeatures";let le=A?`${fe}=${G}`:U.maxFeatures?`${fe}=${U.maxFeatures}`:`${fe}=${G}`;S&&(Q="",r="version=1.1.0",le=le.replace("count","maxFeatures"));const ue=q?`srsname=${F}`:U.srsName?"srsname="+U.srsName:`srsname=${F}`;let se="",ge="";_&&(se=`propertyName=${_}`,ge=`valueReference=${_}`);const Ie=W.sourceFields;if(!se&&Ie&&Ie.length>0){const xt=[];W.sourceFields.forEach(Rt=>{xt.push(Rt.name)}),se=`propertyName=${xt.join(",")},${U.fieldNameGeometry}`}const Re=-1===I.indexOf("?")?"?":"&";let ht=`${I}${Re}service=WFS&request=GetFeature&${r}&${ae}&`;ht+=`${Q}&${ue}&${le}&${se}&${O}`;let rt=`${I}?service=WFS&request=GetPropertyValue&version=${P}&${ae}&`;return rt+=`&${le}&${ge}`,[{name:"outputformat",value:Q},{name:"version",value:r},{name:"typename",value:ae},{name:"count",value:le},{name:"srsname",value:ue},{name:"propertyname",value:se},{name:"valuereference",value:ge},{name:"getcapabilities",value:`${I}${Re}service=WFS&request=GetCapabilities&${r}`.replace(/&&/g,"&")},{name:"getfeature",value:ht.replace(/&&/g,"&")},{name:"getpropertyvalue",value:rt.replace(/&&/g,"&")}]}function V(W,A){A&&"wfs"===A&&(W.paramsWFS=W.params);const q=W.paramsWFS;let _;return W.urlWfs=W.urlWfs||W.url,q.version=q.version||M,q.fieldNameGeometry=q.fieldNameGeometry||L,q.maxFeatures=q.maxFeatures||K,q.outputFormat&&(_=q.outputFormat),(oe.test(_)||!_)&&(q.version="1.1.0"),Object.assign({},W)}function z(W){const A=W;let q;const _=A.paramsWFS.outputFormat?A.paramsWFS.outputFormat:void 0;return _?e[_]?(q=e[_],new q(A.formatOptions)):_.toLowerCase().match("gml2")?(q=y.c,new q({...A.formatOptions,gmlFormat:x.c})):_.toLowerCase().match("gml32")?(q=y.c,new q({...A.formatOptions,gmlFormat:b.c})):_.toLowerCase().match("gml3")?(q=y.c,new q({...A.formatOptions,gmlFormat:w.c})):_.toLowerCase().match("topojson")?(q=d.c,new q(A.formatOptions)):_.toLowerCase().match("geojson")?(q=g.c,new q(A.formatOptions)):_.toLowerCase().match("esrijson")?(q=R.c,new q(A.formatOptions)):_.toLowerCase().match("json")?(q=g.c,new q(A.formatOptions)):_.toLowerCase().match("gpx")?(q=o.c,new q(A.formatOptions)):_.toLowerCase().match("WKT")?(q=h.c,new q(A.formatOptions)):_.toLowerCase().match("osmxml")?(q=E.c,new q(A.formatOptions)):_.toLowerCase().match("kml")?(q=j.cp,new q(A.formatOptions)):new q:(q=y.c,new q(A.formatOptions))}},43940:(Ee,ce,s)=>{"use strict";s.d(ce,{g:()=>g});var y=s(94448),e=s(61252),d=s(27984);function g(R){const h=e._M(R||"EPSG:3857").getExtent(),j=(0,y.K6)(h)/256,x=new Array(20),w=new Array(20);for(let b=0;b<20;++b)x[b]=j/Math.pow(2,b),w[b]=b;return new d.c({origin:(0,y.Iq)(h),resolutions:x,matrixIds:w})}},69488:(Ee,ce,s)=>{"use strict";s.d(ce,{k:()=>V});var y=s(65056),e=s(34672),d=s(32328),g=s(27e3),R=s(24708),o=s(93020),h=s(84112),j=s(64002),x=s(72584),w=s(61616),b=s(54844),E=s(59324),T=s(72156),a=s(49172),M=(s(19188),s(34896));function L(z,W){if(1&z){const A=M.KQA();M.I0R(0,"button",6),M.qCj("click",function(){M.usT(A);const _=M.GaO();return M.CGJ(_.resetStops())}),M.wVc(1,"translate"),M.wR5(2,"mat-icon",7),M.C$Y()}2&z&&M.E7m("matTooltip",M.kDX(1,1,"igo.geo.directionsForm.resetDirectionsBtn"))}function oe(z,W){if(1&z){const A=M.KQA();M.I0R(0,"button",1),M.qCj("click",function(){M.usT(A);const _=M.GaO();return M.CGJ(_.zoomRoute())}),M.wVc(1,"translate"),M.wR5(2,"mat-icon",8),M.C$Y()}2&z&&M.E7m("matTooltip",M.kDX(1,1,"igo.geo.directionsForm.zoomRoute"))}function N(z,W){if(1&z){const A=M.KQA();M.I0R(0,"button",1),M.qCj("click",function(){M.usT(A);const _=M.GaO();return M.CGJ(_.copyDirectionsToClipboard())}),M.wVc(1,"translate"),M.wR5(2,"mat-icon",9),M.C$Y()}2&z&&M.E7m("matTooltip",M.kDX(1,1,"igo.geo.directionsForm.copy"))}function B(z,W){if(1&z){const A=M.KQA();M.I0R(0,"button",1),M.qCj("click",function(){M.usT(A);const _=M.GaO();return M.CGJ(_.copyLinkToClipboard())}),M.wVc(1,"translate"),M.wR5(2,"mat-icon",10),M.C$Y()}2&z&&M.E7m("matTooltip",M.kDX(1,1,"igo.geo.directionsForm.link"))}function X(z,W){if(1&z){const A=M.KQA();M.I0R(0,"button",11),M.qCj("click",function(){M.usT(A);const _=M.GaO();return M.CGJ(_.printDirections())}),M.wVc(1,"async"),M.wVc(2,"translate"),M.wR5(3,"mat-icon",12),M.C$Y()}if(2&z){const A=M.GaO();M.E7m("disabled",M.kDX(1,2,A.disabled$))("matTooltip",M.kDX(2,4,"igo.geo.directionsForm.print"))}}let V=(()=>{class z{languageService;messageService;route;directionsService;get activeRoute(){return this.routesFeatureStore.all().find(A=>A.properties.active)}contextUri;zoomToActiveRoute$=new w.E;stopsStore;routesFeatureStore;stepFeatureStore;disabled$=new b.g(!1);constructor(A,q,_,u){this.languageService=A,this.messageService=q,this.route=_,this.directionsService=u}resetStops(){this.stopsStore.clearStops()}addStop(){(0,a.um)(this.stopsStore)}copyLinkToClipboard(){j._D.copy(this.getUrl())&&this.messageService.success("igo.geo.directionsForm.dialog.copyMsgLink","igo.geo.directionsForm.dialog.copyTitle")}zoomRoute(){this.zoomToActiveRoute$.next()}copyDirectionsToClipboard(){const A=this.directionsToText();j._D.copy(A)&&this.messageService.success("igo.geo.directionsForm.dialog.copyMsg","igo.geo.directionsForm.dialog.copyTitle")}directionsToText(){const A="\t";let q=this.languageService.translate.instant("igo.geo.directionsForm.instructions")+":\n",_="";const u=this.languageService.translate.instant("igo.geo.directionsForm.summary")+": \n"+A+this.activeRoute.properties.direction.title+"\n"+A+(0,a.YX)(this.activeRoute.properties.direction.distance)+"\n"+A+(0,a.AD)(this.activeRoute.properties.direction.duration)+"\n\n"+this.languageService.translate.instant("igo.geo.directionsForm.stopsList")+":\n",S=this.languageService.translate.instant("igo.geo.directionsForm.link")+":\n"+A+this.getUrl();let P=1;this.stopsStore.view.all().forEach(G=>{let O="",F="";G.text!==(0,E.uE)(G.coordinates).join(",")?(F=G.text,O=` ( ${(0,E.uE)(G.coordinates).join(",")} )`):F=(0,E.uE)(G.coordinates).join(","),_=_+A+P.toLocaleString()+". "+F+O+"\n",P++});let I=0;return this.activeRoute.properties.direction.steps.forEach(G=>{const O=this.formatStep(G,I).instruction,F=void 0===(0,a.YX)(G.distance)?"":" ("+(0,a.YX)(G.distance)+")";q=q+A+(I+1).toLocaleString()+". "+O+F+"\n",I++}),u+_+"\n"+S+"\n\n"+q}formatStep(A,q){return(0,a.qe)(A.maneuver.type,A.maneuver.modifier,A.name,A.maneuver.bearing_after,q,A.maneuver.exit,this.languageService,q===this.activeRoute.properties.direction.steps.length-1)}getUrl(){if(!this.route)return;let A="";this.contextUri&&(A=`context=${this.contextUri}&`);const q=this.routesFeatureStore.all().map(I=>I.properties.id).indexOf(this.activeRoute.properties.id);let _="";0!==q&&(_=`&${this.route.options.directionsOptionsKey}=result:${q}`);const u=this.route.options.directionsCoordKey,S=this.stopsStore.view.all().map(I=>(0,E.uE)(I.coordinates,6));let P="";return S.length>=2?(P=`${u}=${S.join(";")}`,`${location.origin}${location.pathname}?${A}tool=directions&sidenav=1&${P}${_}`):void 0}printDirections(){this.stepFeatureStore.clear(),this.disabled$.next(!0),this.directionsService.downloadDirection(this.routesFeatureStore.map,this.activeRoute.properties.direction).subscribe(()=>{this.disabled$.next(!1)})}static \u0275fac=function(q){return new(q||z)(M.GI1(R.ov),M.GI1(o.mi),M.GI1(h.k$,8),M.GI1(T.WI))};static \u0275cmp=M.In1({type:z,selectors:[["igo-directions-buttons"]],inputs:{contextUri:"contextUri",zoomToActiveRoute$:"zoomToActiveRoute$",stopsStore:"stopsStore",routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore"},standalone:!0,features:[M.UHJ],decls:15,vars:20,consts:[[1,"igo-form-button-group"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click"],["svgIcon","map-marker-plus"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"disabled","matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","file-restore"],["svgIcon","magnify-plus-outline"],["svgIcon","content-copy"],["svgIcon","link"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"disabled","matTooltip","click"],["svgIcon","printer"]],template:function(q,_){1&q&&(M.I0R(0,"div",0)(1,"button",1),M.qCj("click",function(){return _.addStop()}),M.wVc(2,"translate"),M.wR5(3,"mat-icon",2),M.C$Y(),M.yuY(4,L,3,3,"button",3),M.wVc(5,"async"),M.wVc(6,"async"),M.yuY(7,oe,3,3,"button",4),M.wVc(8,"async"),M.yuY(9,N,3,3,"button",4),M.wVc(10,"async"),M.yuY(11,B,3,3,"button",4),M.wVc(12,"async"),M.yuY(13,X,4,6,"button",5),M.wVc(14,"async"),M.C$Y()),2&q&&(M.yG2(),M.E7m("matTooltip",M.kDX(2,6,"igo.geo.directionsForm.addStop")),M.yG2(3),M.E7m("ngIf",M.kDX(5,8,_.routesFeatureStore.count$)>=1||M.kDX(6,10,_.stopsStore.count$)>=1),M.yG2(3),M.E7m("ngIf",M.kDX(8,12,_.routesFeatureStore.count$)>=1),M.yG2(2),M.E7m("ngIf",M.kDX(10,14,_.routesFeatureStore.count$)>=1),M.yG2(2),M.E7m("ngIf",M.kDX(12,16,_.routesFeatureStore.count$)>=1),M.yG2(2),M.E7m("ngIf",M.kDX(14,18,_.routesFeatureStore.count$)>=1))},dependencies:[e.oJ,e.um,g.KO,g.a4,d.oB,d.qL,y.u_,y.a,x.O0,x.sD]})}return z})()},8984:(Ee,ce,s)=>{"use strict";s.d(ce,{k:()=>_});var y=s(21600),e=s(65056),d=s(34896),g=s(71904),R=s(69400),o=s(34672),h=s(46176),j=s(50244),x=s(32328),w=s(42536),b=s(27e3),E=s(24708),T=s(83552),a=s(61252),K=s(72584),M=s(12472),L=s(59324),oe=s(9452),N=s(49172);function X(u,S){if(1&u){const P=d.KQA();d.I0R(0,"button",11),d.qCj("click",function(){d.usT(P);const U=d.GaO().$implicit,G=d.GaO();return d.CGJ(G.clearStop(U))}),d.wVc(1,"translate"),d.wR5(2,"mat-icon",12),d.C$Y()}2&u&&d.E7m("matTooltip",d.kDX(1,1,"igo.geo.directionsForm.clearStop"))}function V(u,S){if(1&u&&(d.I0R(0,"mat-option",15),d.OEk(1),d.C$Y()),2&u){const P=S.$implicit;d.E7m("value",P)("matTooltip",P.meta?P.meta.title:""),d.yG2(),d.oRS(" ",P.meta?P.meta.title:""," ")}}function z(u,S){if(1&u&&(d.I0R(0,"mat-optgroup",13),d.yuY(1,V,2,3,"mat-option",14),d.C$Y()),2&u){const P=S.$implicit;d.E7m("label",P.source.title)("disabled",!1===P.source.enabled),d.yG2(),d.E7m("ngForOf",P.results)}}function W(u,S){if(1&u){const P=d.KQA();d.I0R(0,"button",20),d.qCj("click",function(){d.usT(P);const U=d.GaO(2).$implicit,G=d.GaO();return d.CGJ(G.removeStop(U))}),d.wVc(1,"translate"),d.wR5(2,"mat-icon",21),d.C$Y()}2&u&&d.E7m("matTooltip",d.kDX(1,1,"igo.geo.directionsForm.removeStop"))}function A(u,S){if(1&u&&(d.I0R(0,"div",16)(1,"button",17),d.wVc(2,"translate"),d.wR5(3,"mat-icon",18),d.C$Y(),d.yuY(4,W,3,3,"button",19),d.wVc(5,"async"),d.C$Y()),2&u){const P=d.GaO(2);d.yG2(),d.E7m("matTooltip",d.kDX(2,2,"igo.geo.directionsForm.moveStop")),d.yG2(3),d.E7m("ngIf",d.kDX(5,4,P.stopsStore.count$)>2)}}function q(u,S){if(1&u){const P=d.KQA();d.I0R(0,"div",2),d.qCj("touchenter",function(){const G=d.usT(P).$implicit,O=d.GaO();return d.CGJ(O.onStopEnter(G))})("touchleave",function(){d.usT(P);const U=d.GaO();return d.CGJ(U.onStopLeave())})("mouseover",function(){const G=d.usT(P).$implicit,O=d.GaO();return d.CGJ(O.onStopEnter(G))})("mouseleave",function(){d.usT(P);const U=d.GaO();return d.CGJ(U.onStopLeave())})("cdkDragStarted",function(){d.usT(P);const U=d.GaO();return d.CGJ(U.stopIsDragged=!0)})("cdkDragEnded",function(){d.usT(P);const U=d.GaO();return d.CGJ(U.stopIsDragged=!1)}),d.I0R(1,"div",3)(2,"mat-form-field",4)(3,"mat-label"),d.OEk(4),d.C$Y(),d.I0R(5,"input",5),d.qCj("focus",function(){const G=d.usT(P).$implicit,O=d.GaO();return d.CGJ(O.onInputFocus(G))}),d.iHE("ngModelChange",function(U){const O=d.usT(P).$implicit;return d.kNx(O.text,U)||(O.text=U),d.CGJ(U)}),d.qCj("keyup",function(U){const O=d.usT(P).$implicit,F=d.GaO();return d.CGJ(F.setStopText(U,O))})("keydown.enter",function(U){return U.preventDefault()}),d.C$Y(),d.yuY(6,X,3,3,"button",6),d.I0R(7,"mat-autocomplete",7,8),d.qCj("optionSelected",function(U){const O=d.usT(P).$implicit,F=d.GaO();return d.CGJ(F.chooseProposal(U,O))}),d.yuY(9,z,2,3,"mat-optgroup",9),d.C$Y()()(),d.yuY(10,A,6,6,"div",10),d.C$Y()}if(2&u){const P=S.$implicit,I=d.Gew(8),U=d.GaO();d.yG2(),d.E7m("ngClass",U.getNgClass(P)),d.yG2(3),d.cNF(U.getPlaceholder(P)),d.yG2(),d._6D("id",P.id),d.E7m("placeholder",U.getPlaceholder(P))("matTooltip",P.text),d.OKB("ngModel",P.text),d.E7m("matAutocomplete",I),d.yG2(),d.E7m("ngIf",(P.text||P.coordinates)&&U.stopWithHover&&P.id===U.stopWithHover.id),d.yG2(),d.E7m("displayWith",U.getOptionText),d.yG2(2),d.E7m("ngForOf",P.searchProposals),d.yG2(),d.E7m("ngIf",!U.stopIsDragged&&U.stopWithHover&&P.id===U.stopWithHover.id)}}s(19188);let _=(()=>{class u{languageService;invalidKeys=["Control","Shift","Alt"];onMapClickEventKeys=[];stopWithHover;stopIsDragged=!1;stopsStore;stopsFeatureStore;projection;coordRoundedDecimals=6;debounce=200;length=2;stopInputHasFocus=new d._w7(!1);constructor(P){this.languageService=P}ngOnDestroy(){this.unlistenMapSingleClick()}onStopEnter(P){this.stopWithHover=P}onStopLeave(){this.stopWithHover=void 0}getOptionText(P){return P instanceof Object?P?.meta?P.meta.title:"":P}chooseProposal(P,I){const U=P.option.value;if(U){let G;const O=U.geometry;if("Point"===O.type)G=O.coordinates;else{const F=(0,M.c)(U.geometry);G=[F.geometry.coordinates[0],F.geometry.coordinates[1]]}G&&(I.coordinates=G,I.text=U.meta.title,this.stopsStore.update(I))}}setStopText(P,I){this.unlistenMapSingleClick();const U=P.target.value;0===U.length?this.clearStop(I):this.validateTerm(U)&&(I.text=U,this.stopsStore.update(I))}validateTerm(P){return!(!this.keyIsValid(P)||!(P.length>=this.length||0===P.length))}keyIsValid(P){return void 0===this.invalidKeys.find(I=>I===P)}getNgClass(P){return this.stopWithHover&&P.id===this.stopWithHover.id?"igo-input-container reduce":"igo-input-container"}getPlaceholder(P){let I="";return P.relativePosition?(P.relativePosition===oe.mq.Intermediate&&(I=" #"+P.position),this.languageService.translate.instant("igo.geo.directionsForm."+P.relativePosition)+I):""}removeStop(P){(0,N.Wy)(this.stopsStore,P)}clearStop(P){this.stopsStore.update({id:P.id,relativePosition:P.relativePosition,position:P.position})}drop(P){this.moveStops(P.previousIndex,P.currentIndex)}moveStops(P,I){if(P!==I){const U=[...this.stopsStore.view.all()];(0,y.qv)(U,P,I),U.map((G,O)=>{G.relativePosition=(0,N.MG)(O,U.length),G.position=O}),this.stopsStore.updateMany(U),(0,N.GE)(this.stopsStore)}}onInputFocus(P){(!P.text||0===P.text?.length)&&(this.unlistenMapSingleClick(),this.stopInputHasFocus.emit(!0),this.listenMapSingleClick(P))}listenMapSingleClick(P){const I=this.stopsFeatureStore.layer.map.ol.once("singleclick",U=>{const G=a.AF(U.coordinate,this.stopsFeatureStore.layer.map.projection,this.projection),O=(0,L.uE)(G,this.coordRoundedDecimals);P.text=O.join(","),P.coordinates=O,this.stopsStore.update(P),setTimeout(()=>{this.stopInputHasFocus.emit(!1)},500)});this.onMapClickEventKeys.push(I)}unlistenMapSingleClick(){this.onMapClickEventKeys.map(P=>{T.S(P)}),this.onMapClickEventKeys=[]}static \u0275fac=function(I){return new(I||u)(d.GI1(E.ov))};static \u0275cmp=d.In1({type:u,selectors:[["igo-directions-inputs"]],inputs:{stopsStore:"stopsStore",stopsFeatureStore:"stopsFeatureStore",projection:"projection",coordRoundedDecimals:"coordRoundedDecimals",debounce:"debounce",length:"length"},outputs:{stopInputHasFocus:"stopInputHasFocus"},standalone:!0,features:[d.UHJ],decls:3,vars:3,consts:[["cdkDropList","",1,"stops-list",3,"cdkDropListDropped"],["touchleave","","cdkDragLockAxis","y","class","stop-box","cdkDrag","",3,"touchenter","touchleave","mouseover","mouseleave","cdkDragStarted","cdkDragEnded",4,"ngFor","ngForOf"],["touchleave","","cdkDragLockAxis","y","cdkDrag","",1,"stop-box",3,"touchenter","touchleave","mouseover","mouseleave","cdkDragStarted","cdkDragEnded"],[3,"ngClass"],["subscriptSizing","dynamic"],["type","text","matTooltipShowDelay","500","aria-label","Number","matInput","",3,"id","placeholder","matTooltip","ngModel","matAutocomplete","focus","ngModelChange","keyup","keydown.enter"],["mat-icon-button","","matSuffix","","matTooltipShowDelay","500","color","warn","aria-label","Clear",3,"matTooltip","click",4,"ngIf"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"label","disabled",4,"ngFor","ngForOf"],["class","igo-form-button-group",4,"ngIf"],["mat-icon-button","","matSuffix","","matTooltipShowDelay","500","color","warn","aria-label","Clear",3,"matTooltip","click"],["svgIcon","close"],[3,"label","disabled"],["matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["matTooltipShowDelay","500",3,"value","matTooltip"],[1,"igo-form-button-group"],["cdkDragHandle","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"swipe-vertical",3,"matTooltip"],["svgIcon","gesture-swipe-vertical"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","delete"]],template:function(I,U){1&I&&(d.I0R(0,"div",0),d.qCj("cdkDropListDropped",function(O){return U.drop(O)}),d.yuY(1,q,11,11,"div",1),d.wVc(2,"async"),d.C$Y()),2&I&&(d.yG2(),d.E7m("ngForOf",d.kDX(2,1,U.stopsStore.view.all$())))},dependencies:[y.Cm,e.Iw,y.w5,e.QF,j.wb,j.Up,j.w5,j.Gm,w.cN,w.yi,g.y,g.ot,g.ue,g._G,R.U1,R.e,h.I5,h.Ar,R.cG,b.KO,b.a4,e.u_,o.oJ,o.um,x.oB,x.qL,h.Ax,y.A3,e.a,K.O0,K.sD],styles:["[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{display:flex;align-items:center;padding-left:12px}[_nghost-%COMP%]   .stops-list[_ngcontent-%COMP%]{max-width:100%;min-height:60px;display:block;background:#fff;border-radius:4px;overflow:hidden;padding:20px 10px}[_nghost-%COMP%]   .swipe-vertical[_ngcontent-%COMP%]{cursor:move}[_nghost-%COMP%]   .stop-box[_ngcontent-%COMP%]{color:#000000de;display:flex;flex-direction:row;align-items:center;justify-content:space-between;box-sizing:border-box;background:#fff}[_nghost-%COMP%]   .stop-box[_ngcontent-%COMP%]:not(:last-child){margin-bottom:16px}[_nghost-%COMP%]   .cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}[_nghost-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}[_nghost-%COMP%]   .cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}[_nghost-%COMP%]   .stops-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .stop-box[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})}return u})()},72184:(Ee,ce,s)=>{"use strict";s.d(ce,{c:()=>q});var y=s(65056),e=s(71904),d=s(46176),g=s(75180),R=s(50244),o=s(32328),h=s(63916),j=s(77872),x=s(24708),w=s(58264),b=s(12396),E=s(62808),T=s(80848),a=s(72584),K=s(24112),M=s(68392),L=s(9452),oe=s(49172),B=(s(19188),s(34896));function X(_,u){if(1&_&&(B.I0R(0,"mat-option",9),B.OEk(1),B.C$Y()),2&_){const S=u.$implicit,P=u.index,I=B.GaO(3);B.E7m("value",S),B.yG2(),B.MjK(" Option ",P+1," : ",I.formatDistance(S.distance)," (",I.formatDuration(S.duration),") ")}}function V(_,u){if(1&_){const S=B.KQA();B.I0R(0,"mat-form-field")(1,"mat-label"),B.OEk(2),B.wVc(3,"translate"),B.C$Y(),B.I0R(4,"mat-select",7),B.qCj("selectionChange",function(){B.usT(S);const I=B.GaO(2);return B.CGJ(I.changeRoute())}),B.iHE("ngModelChange",function(I){B.usT(S);const U=B.GaO(2);return B.kNx(U.activeDirection,I)||(U.activeDirection=I),B.CGJ(I)}),B.wVc(5,"translate"),B.yuY(6,X,2,4,"mat-option",8),B.C$Y()()}if(2&_){const S=B.GaO(2);B.yG2(2),B.cNF(B.kDX(3,4,"igo.geo.directionsForm.drivingOptions")),B.yG2(2),B._6D("placeholder",B.kDX(5,6,"igo.geo.directionsForm.drivingOptions")),B.OKB("ngModel",S.activeDirection),B.yG2(2),B.E7m("ngForOf",S.directions)}}function z(_,u){1&_&&B.wR5(0,"mat-divider")}function W(_,u){if(1&_){const S=B.KQA();B.I0R(0,"mat-list-item",10),B.qCj("mouseenter",function(){const U=B.usT(S).$implicit,G=B.GaO(2);return B.CGJ(G.showSegment(U))})("click",function(){const U=B.usT(S).$implicit,G=B.GaO(2);return B.CGJ(G.showSegment(U,!0))}),B.wR5(1,"mat-icon",11),B.I0R(2,"span",12),B.OEk(3),B.C$Y(),B.I0R(4,"span",13),B.OEk(5),B.C$Y()()}if(2&_){const S=u.$implicit,P=u.index,I=B.GaO(2);B.yG2(),B._6D("svgIcon",I.formatStep(S,P).image),B.E7m("ngClass",I.formatStep(S,P).cssClass),B.yG2(2),B.CAO(" ",P+1,". ",I.formatStep(S,P).instruction," "),B.yG2(2),B.oRS(" ",I.formatDistance(S.distance)," ")}}function A(_,u){if(1&_){const S=B.KQA();B.I0R(0,"div",1),B.yuY(1,V,7,8,"mat-form-field",2)(2,z,1,0,"mat-divider",2),B.I0R(3,"mat-list",3),B.qCj("mouseleave",function(){B.usT(S);const I=B.GaO();return B.CGJ(I.onStepsListBlur())}),B.I0R(4,"h2",4),B.OEk(5),B.C$Y(),B.I0R(6,"span",5),B.OEk(7),B.C$Y(),B.yuY(8,W,6,5,"mat-list-item",6),B.wR5(9,"mat-divider"),B.C$Y()()}if(2&_){const S=B.GaO();B.yG2(),B.E7m("ngIf",S.directions&&S.directions.length>1),B.yG2(),B.E7m("ngIf",S.directions&&0===S.directions.length),B.yG2(3),B.cNF(S.activeDirection.title),B.yG2(2),B.CAO(" ",S.formatDistance(S.activeDirection.distance),", ",S.formatDuration(S.activeDirection.duration)," "),B.yG2(),B.E7m("ngForOf",S.activeDirection.steps)}}let q=(()=>{class _{languageService;cdRef;activeDirection;directions;entities$$;routesFeatureStore;stepFeatureStore;constructor(S,P){this.languageService=S,this.cdRef=P}ngOnInit(){this.entities$$=this.routesFeatureStore.entities$.pipe((0,K.o)(200)).subscribe(S=>{const P=S.find(I=>I.properties.active);this.directions=S.map(I=>I.properties.direction),this.activeDirection=P?P.properties.direction:void 0,this.cdRef.detectChanges()})}ngOnDestroy(){this.entities$$.unsubscribe()}changeRoute(){this.routesFeatureStore.entities$.value.map(S=>S.properties.active=!S.properties.active),this.routesFeatureStore.layer.ol.getSource().getFeatures().map(S=>S.set("active",!S.get("active")))}formatDistance(S){return(0,oe.YX)(S)}formatDuration(S){return(0,oe.AD)(S)}formatStep(S,P){return(0,oe.qe)(S.maneuver.type,S.maneuver.modifier,S.name,S.maneuver.bearing_after,P,S.maneuver.exit,this.languageService,P===this.activeDirection.steps.length-1)}onStepsListBlur(){this.stepFeatureStore.clear()}showSegment(S,P=!1){this.showRouteSegmentGeometry(S,P)}showRouteSegmentGeometry(S,P=!1){const U="vertex",Q=new E.c(S.geometry.coordinates).transform("EPSG:4326",this.stepFeatureStore.layer.map.projection).getCoordinates()[0],r=new T.c(Q),ie=new w.c({geometry:r}),ae=(new b.c).writeGeometryObject(r,{featureProjection:this.stepFeatureStore.layer.map.projection,dataProjection:this.stepFeatureStore.layer.map.projection}),fe=this.stepFeatureStore.get(U);this.stepFeatureStore.update({type:M.Y,geometry:ae,projection:this.stepFeatureStore.layer.map.projection,properties:{id:U,step:S,type:L.SC.Vertex},meta:{id:U,revision:(fe?fe.meta.revision:0)+1},ol:ie}),P&&this.stepFeatureStore.layer.map.viewController.zoomToExtent(ie.getGeometry().getExtent())}static \u0275fac=function(P){return new(P||_)(B.GI1(x.ov),B.GI1(B.kD9))};static \u0275cmp=B.In1({type:_,selectors:[["igo-directions-results"]],inputs:{routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore"},standalone:!0,features:[B.UHJ],decls:1,vars:1,consts:[["class","igo-input-container",4,"ngIf"],[1,"igo-input-container"],[4,"ngIf"],[3,"mouseleave"],["mat-header","",1,"igo-route-title"],[1,"mat-caption"],["class","igo-steps","igoListItem","",3,"mouseenter","click",4,"ngFor","ngForOf"],[3,"placeholder","ngModel","selectionChange","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["igoListItem","",1,"igo-steps",3,"mouseenter","click"],["matListItemIcon","",3,"ngClass","svgIcon"],[1,"igo-step-text"],["matListItemMeta",""]],template:function(P,I){1&P&&B.yuY(0,A,10,6,"div",0),2&P&&B.E7m("ngIf",I.directions&&I.activeDirection)},dependencies:[y.u_,R.wb,R.Up,R.w5,j.d5,j.kX,d.I5,e.y,e.ue,e._G,y.Iw,d.Ax,g.U,g.k,h.iI,h.oL,h.g9,h.Y1,h.At,o.oB,o.qL,y.QF,a.O0,a.sD],styles:[".igo-input-container[_ngcontent-%COMP%]{width:100%;padding:20px 10px;box-sizing:border-box}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:70%}.igo-route-title[_ngcontent-%COMP%]{font-weight:700}.igo-steps[_ngcontent-%COMP%]{cursor:pointer;padding:35px 0}.igo-steps[_ngcontent-%COMP%]   .igo-step-text[_ngcontent-%COMP%]{overflow-wrap:break-word;word-wrap:break-word;white-space:pre-wrap}.mat-mdc-list-item[_ngcontent-%COMP%]{word-wrap:break-word!important;white-space:pre-wrap!important}.rotate-90[_ngcontent-%COMP%]{transform:rotate(90deg)}.rotate-45[_ngcontent-%COMP%]{transform:rotate(45deg)}.rotate-270[_ngcontent-%COMP%]{transform:rotate(270deg)}.rotate-250[_ngcontent-%COMP%]{transform:rotate(250deg)}.rotate-290[_ngcontent-%COMP%]{transform:rotate(290deg)}.icon-flipped[_ngcontent-%COMP%]{transform:scaleY(-1)}"]})}return _})()},96580:(Ee,ce,s)=>{"use strict";s.d(ce,{U:()=>y});class y{}},62747:(Ee,ce,s)=>{"use strict";s.d(ce,{U:()=>q});var y=s(43424),e=s(62228),d=s(24708),g=s(64002),R=s(96764),o=s(25696),h=s(98492),j=s(61252),x=s(72584),w=s(61616),b=s(11484),E=s(24112),T=s(40604),a=s(20624),K=s(34080),M=s(93199),L=s(29216),oe=s(69488),N=s(8984),B=s(72184),X=s(9452),V=s(40043),z=s(49172),A=(s(19188),s(34896));let q=(()=>{class _{cdRef;languageService;directionsService;searchService;queryService;watcher;projection="EPSG:4326";zoomRoute$$;storeEmpty$$;storeChange$$;routesQueries$$=[];selectStopInteraction;translateStop;selectedRoute;focusOnStop=!1;isTranslating=!1;previousStops=[];searchs$$=[];contextUri;stopsStore;stopsFeatureStore;routesFeatureStore;stepFeatureStore;debounce=200;length=2;coordRoundedDecimals=6;zoomToActiveRoute$=new w.E;get directionControlIsActive(){return!this.queryService.queryEnabled}get interactions(){return[this.selectStopInteraction,this.translateStop,this.selectedRoute]}constructor(S,P,I,U,G){this.cdRef=S,this.languageService=P,this.directionsService=I,this.searchService=U,this.queryService=G}ngOnInit(){this.queryService.queryEnabled=!1,this.initEntityStores(),setTimeout(()=>{(0,z.CM)(this.stopsFeatureStore,this.languageService),(0,z.MV)(this.routesFeatureStore,this.languageService),(0,z.sH)(this.stepFeatureStore),this.initOlInteraction()},1)}ngOnDestroy(){this.queryService.queryEnabled=!0,this.storeEmpty$$.unsubscribe(),this.storeChange$$.unsubscribe(),this.routesQueries$$.map(S=>S.unsubscribe()),this.zoomRoute$$.unsubscribe(),this.freezeStores()}freezeStores(){this.interactions.map(S=>this.routesFeatureStore.layer.map.ol.removeInteraction(S)),this.stopsFeatureStore.deactivateStrategyOfType(a.E),this.routesFeatureStore.deactivateStrategyOfType(a.E),this.stepFeatureStore.deactivateStrategyOfType(a.E)}initEntityStores(){this.watcher=new e.YX(this.stopsStore,this.cdRef),this.monitorEmptyEntityStore(),this.monitorEntityStoreChange(),this.monitorActiveRouteZoom()}monitorActiveRouteZoom(){this.zoomRoute$$=this.zoomToActiveRoute$.subscribe(()=>{if(this.routesFeatureStore.count>=1){const S=this.routesFeatureStore.all().find(P=>P.properties.active);if(S){S.ol.getGeometry();const P=S.ol.getGeometry().getExtent();this.routesFeatureStore.layer.map.viewController.zoomToExtent(P)}}})}initOlInteraction(){this.selectStopInteraction=new o.c({layers:[this.stopsFeatureStore.layer.ol],hitTolerance:7,condition:S=>"pointermove"===S.type&&!S.dragging}),this.translateStop=new h.c({features:this.selectStopInteraction.getFeatures()}),this.translateStop.on("translating",S=>{this.isTranslating=!0,this.executeStopTranslation(S.features)}),this.translateStop.on("translateend",S=>{this.isTranslating=!1,this.executeStopTranslation(S.features)}),this.selectedRoute=new o.c({layers:[this.routesFeatureStore.layer.ol],condition:R.gx,hitTolerance:7,filter:S=>S.get("type")===X.SC.Route&&S.get("active")&&!this.isTranslating}),this.selectedRoute.on("select",S=>{if(!1===this.focusOnStop){const P=(0,K.uE)(j.AF(S.mapBrowserEvent.coordinate,this.routesFeatureStore.layer.map.projection,this.projection),this.coordRoundedDecimals),I=(0,z.um)(this.stopsStore);I.text=P.join(","),I.coordinates=[P[0],P[1]]}}),this.interactions.map(S=>this.routesFeatureStore.layer.map.ol.addInteraction(S))}onStopInputHasFocusChange(S){S?this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute):this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute)}executeStopTranslation(S){if(0===S.getLength())return;const P=S.getArray()[0],I=P.getId(),U=j.AF(P.getGeometry().getCoordinates(),this.stopsFeatureStore.layer.map.projection,this.projection),G=this.stopsStore.get(I),O=(0,K.uE)(U,this.coordRoundedDecimals);G.coordinates=O,G.text=O.join(","),this.stopsStore.update(G)}monitorEmptyEntityStore(){this.storeEmpty$$=this.stopsStore.count$.pipe((0,b.a)()).subscribe(S=>{if(S<2){if((0,z.um)(this.stopsStore),2===this.stopsStore.count)return void this.stopsStore.storeInitialized$.next(!0);this.stopsStore.storeInitialized$.next(!1)}this.routesQueries$$.map(P=>P.unsubscribe())})}monitorEntityStoreChange(){this.storeChange$$=this.stopsStore.entities$.pipe((0,E.o)(this.debounce)).subscribe(S=>{this.handleStopDiff(S),(0,z.GE)(this.stopsStore),this.handleStopsFeature(),this.getRoutes(this.isTranslating)})}cancelSearch(){this.searchs$$.map(S=>S.unsubscribe())}handleStopDiff(S){const P=S.map(G=>g.Yv.removeUndefined({id:G.id,text:G.text,coordinates:G.coordinates})),I=g.OI.findChanges(this.previousStops,P,["coordinates"]),U=I.added.concat(I.modified);U&&U.map(G=>{const O=G.newValue;if(O){const F=this.stopsStore.get(O.id),Q=F.text;if(!Q||0===Q.length)return;const r=(0,K.Sc)(Q,this.stopsFeatureStore.layer.map.projection);let ie,ae=!1;r.lonLat&&(ae=!0),ie=this.searchService.search(Q,{searchType:"Feature"}),this.cancelSearch();const fe=ie.map(le=>le.request.pipe((0,T.k)(ue=>ue.filter(se=>ae?"Point"===se.data.geometry.type&&se.data.geometry:se.data.geometry))));this.searchs$$=fe.map(le=>le.pipe((0,T.k)(ue=>ue.filter(se=>ae?"Point"===se.data.geometry.type&&se.data.geometry:se.data.geometry))).subscribe(ue=>{if(ue.length>0){const se=ue[0].source,ge=ue[0].meta,Ie=ue.map(He=>He.data);F.searchProposals||(F.searchProposals=[]),F.searchProposals=F.searchProposals.filter(He=>He.type===(ae?X.S_.Coord:X.S_.Text));let Re=F.searchProposals.find(He=>He.source===se);Re?Re.results=Ie:F.searchProposals.push({type:ae?X.S_.Coord:X.S_.Text,source:se,meta:ge,results:Ie})}this.cdRef.detectChanges()}))}}),this.previousStops=P}handleStopsFeature(){const S=this.stopsStore.all();S.filter(U=>U.coordinates).map(U=>this.addStopOverlay(U)),this.stopsFeatureStore.all().map(U=>{this.stopsStore.get(U.properties.id)||this.stopsFeatureStore.delete(U)}),S.filter(U=>!U.coordinates).map(U=>{const G=this.stopsFeatureStore.get(U.id);G&&this.stopsFeatureStore.delete(G)})}getRoutes(S=!1){const P=this.stopsStore.view.all().filter(O=>O.coordinates);if(P.length<2)return void this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());const I=P.map(O=>(0,K.uE)(O.coordinates,this.coordRoundedDecimals));this.routesQueries$$.map(O=>O.unsubscribe());const G=this.directionsService.route(I,S?{overview:!0,steps:!1,alternatives:!1,continue_straight:!1}:void 0);G&&G.map(O=>this.routesQueries$$.push(O.subscribe(F=>{this.routesFeatureStore.deleteMany(this.routesFeatureStore.all()),F.map(Q=>(0,z.S_)(this.routesFeatureStore,Q,this.projection,Q===F[0]))})))}addStopOverlay(S){(0,z.Mx)(S,this.stopsStore,this.stopsFeatureStore,this.projection,this.languageService)}onToggleDirectionsControl(S){this.queryService.queryEnabled=!S;const P=this.routesFeatureStore.layer.map.ol;this.interactions.map(I=>S?P.addInteraction(I):P.removeInteraction(I))}static \u0275fac=function(P){return new(P||_)(A.GI1(A.kD9),A.GI1(d.ov),A.GI1(V.W),A.GI1(L._),A.GI1(M.E))};static \u0275cmp=A.In1({type:_,selectors:[["igo-directions"]],inputs:{contextUri:"contextUri",stopsStore:"stopsStore",stopsFeatureStore:"stopsFeatureStore",routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore",debounce:"debounce",length:"length",coordRoundedDecimals:"coordRoundedDecimals",zoomToActiveRoute$:"zoomToActiveRoute$"},standalone:!0,features:[A.UHJ],decls:7,vars:18,consts:[[1,"directions-options"],[3,"checked","labelPosition","change"],[3,"stepFeatureStore","contextUri","zoomToActiveRoute$","routesFeatureStore","stopsStore"],[3,"coordRoundedDecimals","projection","stopsFeatureStore","stopsStore","debounce","length","stopInputHasFocus"],[3,"stepFeatureStore","routesFeatureStore"]],template:function(P,I){1&P&&(A.I0R(0,"div",0)(1,"mat-slide-toggle",1),A.qCj("change",function(G){return I.onToggleDirectionsControl(G.checked)}),A.OEk(2),A.wVc(3,"translate"),A.C$Y()(),A.wR5(4,"igo-directions-buttons",2),A.I0R(5,"igo-directions-inputs",3),A.qCj("stopInputHasFocus",function(G){return I.onStopInputHasFocusChange(G)}),A.C$Y(),A.wR5(6,"igo-directions-results",4)),2&P&&(A.yG2(),A.E7m("checked",I.directionControlIsActive)("labelPosition","before"),A.yG2(),A.oRS(" ",A.kDX(3,16,"igo.geo.directionsForm.toggleActive")," "),A.yG2(2),A.E7m("stepFeatureStore",I.stepFeatureStore)("contextUri",I.contextUri)("zoomToActiveRoute$",I.zoomToActiveRoute$)("routesFeatureStore",I.routesFeatureStore)("stopsStore",I.stopsStore),A.yG2(),A.E7m("coordRoundedDecimals",I.coordRoundedDecimals)("projection",I.projection)("stopsFeatureStore",I.stopsFeatureStore)("stopsStore",I.stopsStore)("debounce",I.debounce)("length",I.length),A.yG2(),A.E7m("stepFeatureStore",I.stepFeatureStore)("routesFeatureStore",I.routesFeatureStore))},dependencies:[y.GE,y.cP,oe.k,N.k,B.c,x.O0,x.sD],styles:[".directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}.directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}.directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}"]})}return _})()},74180:(Ee,ce,s)=>{"use strict";s.d(ce,{W0:()=>e,c9:()=>g});var y=s(96580);class e{sources;constructor(o){this.sources=o}}function d(R){return new e(R)}function g(){return{provide:e,useFactory:d,deps:[y.U]}}},9452:(Ee,ce,s)=>{"use strict";s.d(ce,{SC:()=>g,S_:()=>d,Yn:()=>y,g1:()=>e,mq:()=>R});var y=function(o){return o[o.GeoJSON=0]="GeoJSON",o[o.JSON=1]="JSON",o}(y||{}),e=function(o){return o.Route="route",o.Trip="trip",o}(e||{}),d=function(o){return o.Coord="coord",o.Text="text",o}(d||{}),g=function(o){return o.Stop="stop",o.Route="route",o.Vertex="vertex",o}(g||{}),R=function(o){return o.Start="start",o.Intermediate="intermediate",o.End="end",o}(R||{})},40043:(Ee,ce,s)=>{"use strict";s.d(ce,{W:()=>B});var y=s(35392),e=s(65056),d=s(23302),g=s(83600),R=s(24708),o=s(64002),h=s(96116),j=s.n(h),x=s(864),E=(s(32256),s(30816)),T=s.n(E),a=s(61616),K=s(29272),M=s(47580),L=s(49172),oe=s(34896),N=s(74180);let B=(()=>{class X{directionsSourceService;configService;languageService;printService;document;activityService;constructor(z,W,A,q,_,u){this.directionsSourceService=z,this.configService=W,this.languageService=A,this.printService=q,this.document=_,this.activityService=u}route(z,W={}){if(0!==z.length)return this.directionsSourceService.sources.filter(A=>A.enabled).map(A=>this.routeSource(A,z,W))}routeSource(z,W,A={}){return z.route(W,A)}downloadDirection(z,W){var A=this;const q=this.activityService.register(),_=new a.E,u=new x.default({orientation:"p",format:"Letter",unit:"mm"}),S=[u.internal.pageSize.width,u.internal.pageSize.height],P=[10,10,10,10],G=[S[0],S[1]-P[0]-P[2]],O=`${W.title} (${(0,L.YX)(W.distance)}, ${(0,L.AD)(W.duration)})`;return u.text(O,u.internal.pageSize.width/2,25,{align:"center"}),P[0]+=20,this.printService.addMap(u,z,96,G,P,M.ID.none).subscribe(function(){var r=(0,y.c)(function*(ie){ie===o.qM.Done&&(yield A.addInstructions(u,W,O),A.setPageHeaderFooter(u),yield u.save(`${O}.pdf`,{returnPromise:!0})),A.activityService.unregister(q),_.next(ie)});return function(ie){return r.apply(this,arguments)}}()),_}setHTMLTableContent(z){var W=this;return(0,y.c)(function*(){const A=yield W.directionsInstruction(z),q=document.createElement("table"),_=document.createElement("tbody");for(let I=0;I<A.length;I++){const U=A[I];var u=document.createElement("tr"),S=document.createElement("td"),P=document.createElement("td");const G=document.createElement("img");G.src=U.icon;const O=document.createElement("span");if(O.innerHTML=U.instruction,S.appendChild(G),P.appendChild(O),U.distance){const F=document.createElement("span");F.style.verticalAlign="middle",F.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+U.distance,P.appendChild(F)}u.append(S),u.append(P),_.appendChild(u)}return q.appendChild(_),q})()}directionsInstruction(z){var W=this;return(0,y.c)(function*(){const q=W.document.getElementsByTagName("igo-directions-results")[0].getElementsByTagName("mat-list")[0].getElementsByTagName("mat-list-item");let _=[];for(let S=0;S<q.length;S++){const I=q[S].getElementsByTagName("mat-icon")[0],U=I.getAttribute("data-mat-icon-name");if(!_.some(O=>O.name===U)){const O=yield j()(I,{scale:3});_.push({name:U,icon:O.toDataURL()})}}let u=[];for(let S=0;S<z.steps.length;S++){const P=z.steps[S],I=(0,L.qe)(P.maneuver.type,P.maneuver.modifier,P.name,P.maneuver.bearing_after,S,P.maneuver.exit,W.languageService,S===z.steps.length-1),U=(0,L.YX)(P.distance);u.push({instruction:S+1+". "+I.instruction,icon:_.find(G=>G.name===I.image).icon,distance:U?"("+U+")":void 0})}return u})()}addInstructions(z,W,A){var q=this;return(0,y.c)(function*(){z.addPage(),z.text(A,z.internal.pageSize.width/2,25,{align:"center"});const u=yield q.setHTMLTableContent(W);z.autoTable({html:u,startY:30,margin:{top:20,bottom:20},columnStyles:{0:{cellWidth:10}},theme:"plain",styles:{fontSize:12},didDrawCell:function(P){if(0===P.column.index&&"body"===P.cell.section){P.row.height=10;const U=P.cell.raw.getElementsByTagName("img")[0];z.addImage(U.src,P.cell.x,P.cell.y,8,8)}}})})()}setPageHeaderFooter(z){const W=z.getNumberOfPages(),A=T()(Date.now()).format("DD/MM/YYYY hh:mm").toString(),_=this.configService.getConfig("directionsSources.logo")||"assets/logo.png";for(let u=0;u<W;u++){z.setPage(u),z.setFontSize(8);const S=z.internal.pageSize,P=S.height?S.height:S.getHeight(),I=S.width?S.width:S.getWidth();z.text(A,10,10,{baseline:"top"}),z.addImage(_,"PNG",I-20,5,10,10),z.text(A,10,P-10),z.text("Page "+z.getCurrentPageInfo().pageNumber+" / "+W,I-20,P-10)}}static \u0275fac=function(W){return new(W||X)(oe.CoB(N.W0),oe.CoB(g.aW),oe.CoB(R.ov),oe.CoB(K.K),oe.CoB(e.Ud),oe.CoB(d.U9))};static \u0275prov=oe.wxM({token:X,factory:X.\u0275fac,providedIn:"root"})}return X})()},49172:(Ee,ce,s)=>{"use strict";s.d(ce,{AD:()=>P,CM:()=>W,GE:()=>oe,MG:()=>N,MV:()=>A,Mx:()=>_,S_:()=>u,Wy:()=>V,YX:()=>S,qe:()=>I,sH:()=>q,um:()=>X});var y=s(64002),e=s(58264),d=s(12396),g=s(80848),R=s(62808),o=s(61252),h=s(54776),j=s(87544),x=s(45212),w=s(67732),b=s(70524),E=s(68392),T=s(64096),a=s(20624),K=s(2892),M=s(47572),L=s(9452);function oe(O,F="asc",Q="position"){O.view.sort({direction:F,valueAccessor:r=>r[Q]})}function N(O,F){let Q=L.mq.Intermediate;return 0===O?Q=L.mq.Start:O===F-1&&(Q=L.mq.End),Q}function X(O){const F=(0,y.uq)(),Q=O.all();let r;r=0===O.count?[0]:Q.map(ue=>ue.position);const ie=Math.max(...r),ae=ie,fe=ie+1,le=O.all().find(ue=>ue.position===ie);return le&&(le.position=fe,le.relativePosition=N(fe,O.count+1)),O.insert({id:F,position:ae,relativePosition:N(ae,O.count+1)}),oe(O),O.get(F)}function V(O,F){O.delete(F),function B(O){const F=[...O.all()];F.sort((Q,r)=>Q.position-r.position),F.map((Q,r)=>{Q.position=r,Q.relativePosition=N(Q.position,F.length)}),F&&O.updateMany(F)}(O)}function z(O,F){const Q=[new h.cp({geometry:O.getGeometry(),image:new j.c({radius:7,stroke:new x.c({color:"#FF0000",width:3})})})],r=(0,M.o)({text:O.get("stopText"),opacity:O.get("stopOpacity"),markerColor:O.get("stopColor"),markerOutlineColor:[255,255,255]}),ie=[new h.cp({stroke:new x.c({color:`rgba(106, 121, 130, ${O.get("active")?.75:0})`,width:10})}),new h.cp({stroke:new x.c({color:`rgba(79, 169, 221, ${O.get("active")?.75:0})`,width:6})})];return O.get("type")===L.SC.Stop?r:"vertex"===O.get("type")?Q:O.get("type")===L.SC.Route?ie:void 0}function W(O,F){const Q=new a.E({motion:E.S.None}),r=new K.M({isIgoInternalLayer:!0,id:"igo-direction-stops-layer",title:F.translate.instant("igo.geo.directionsForm.stopLayer"),zIndex:911,source:new w.E,showInLayerList:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-stops-layer",links:[{syncedDelete:!0,linkedIds:["igo-direction-route-layer"],properties:[]}]},exportable:!0,browsable:!1,style:z});(0,b.m)(O,r),O.layer.visible=!0,(0,T.s)(O,Q)}function A(O,F){const Q=new a.E({motion:E.S.None}),r=new K.M({isIgoInternalLayer:!0,id:"igo-direction-route-layer",title:F.translate.instant("igo.geo.directionsForm.routeLayer"),zIndex:910,source:new w.E,showInLayerList:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-route-layer"},exportable:!0,browsable:!1,style:z});(0,b.m)(O,r),O.layer.visible=!0,(0,T.s)(O,Q)}function q(O){const F=new a.E({motion:E.S.None}),Q=new K.M({isIgoInternalLayer:!0,id:"igo-direction-step-layer",title:"",zIndex:910,source:new w.E,showInLayerList:!1,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-route-layer"},exportable:!1,browsable:!1,style:z});(0,b.m)(O,Q),O.layer.visible=!0,(0,T.s)(O,F)}function _(O,F,Q,r,ie){let ae,fe;switch(O.relativePosition){case L.mq.Start:ae="#008000",fe=ie.translate.instant("igo.geo.directionsForm.start");break;case L.mq.End:ae="#f64139",fe=ie.translate.instant("igo.geo.directionsForm.end");break;default:ae="#ffd700",fe=ie.translate.instant("igo.geo.directionsForm.intermediate")+" #"+O.position}const le=new g.c(o.AF(O.coordinates,r,Q.map.projection)),ue=(new d.c).writeGeometryObject(le,{featureProjection:Q.map.projection,dataProjection:Q.map.projection}),se=Q.get(O.id),Ie={type:E.Y,geometry:ue,projection:Q.map.projection,properties:{id:O.id,type:L.SC.Stop,stopText:fe,stopColor:ae,stopOpacity:1,stop:O},meta:{id:O.id,revision:(se?se.meta.revision:0)+1},ol:new e.c({geometry:le})};Q.update(Ie)}function u(O,F,Q,r=!1,ie=!1){const le=new R.c(F.geometry.coordinates).transform(Q,O.map.projection),ue=(new d.c).writeGeometryObject(le,{featureProjection:O.map.projection,dataProjection:O.map.projection}),se=O.get(F.id),Ie={type:E.Y,geometry:ue,projection:O.map.projection,properties:{id:F.id,type:L.SC.Route,active:r,direction:F},meta:{id:F.id,revision:(se?se.meta.revision:0)+1},ol:new e.c({geometry:le})};O.update(Ie)}function S(O){if(0!==O)return O>=1e5?y.UD.roundToNDecimal(Math.round(O)/1e3,1)+" km":O>=1e4||O>=1e3?y.UD.roundToNDecimal(Math.round(O)/100/10,1)+" km":y.UD.roundToNDecimal(O,0)+" m"}function P(O){if(O>=3600){const F=Math.floor(O/3600),Q=Math.round(60*(O/3600-F));return 60===Q?F+1+" h":F+" h "+Q+" min"}return O>=60?Math.round(O/60)+" min":O+" s"}function I(O,F,Q,r,ie,ae,fe,le=!1){const ue=fe.translate;let se,ge="forward",Ie="rotate-270";const Re=function G(O,F){const Q=F.translate;return O>=337||O<23?Q.instant("igo.geo.cardinalPoints.n"):O<67?Q.instant("igo.geo.cardinalPoints.ne"):O<113?Q.instant("igo.geo.cardinalPoints.e"):O<157?Q.instant("igo.geo.cardinalPoints.se"):O<203?Q.instant("igo.geo.cardinalPoints.s"):O<247?Q.instant("igo.geo.cardinalPoints.sw"):O<293?Q.instant("igo.geo.cardinalPoints.w"):O<337?Q.instant("igo.geo.cardinalPoints.nw"):void 0}(r,fe),He=function U(O,F){const Q=F.translate;return"uturn"===O?Q.instant("igo.geo.directions.uturn"):"sharp right"===O?Q.instant("igo.geo.directions.sharp right"):"right"===O?Q.instant("igo.geo.directions.right"):"slight right"===O?Q.instant("igo.geo.directions.slight right"):"sharp left"===O?F.translate.instant("igo.geo.directions.sharp left"):"left"===O?F.translate.instant("igo.geo.directions.left"):"slight left"===O?F.translate.instant("igo.geo.directions.slight left"):"straight"===O?F.translate.instant("igo.geo.directions.straight"):O}(F,fe);let rt=("straight"===F?"":ue.instant("igo.geo.directions.modifier.prefix"))+He;if(F?.search("slight")>=0&&(rt=He),"uturn"===F?(ge="forward",Ie="rotate-90"):"sharp right"===F||"right"===F?(ge="subdirectory-arrow-right",Ie="icon-flipped"):"slight right"===F?(ge="forward",Ie="rotate-290"):"straight"===F?ge="forward":"slight left"===F?(ge="forward",Ie="rotate-250"):("left"===F||"sharp left"===F)&&(ge="subdirectory-arrow-left",Ie="icon-flipped"),"turn"===O)se="straight"===F?ue.instant("igo.geo.directions.turn.straight",{route:Q}):"uturn"===F?ue.instant("igo.geo.directions.turn.uturn",{route:Q}):ue.instant("igo.geo.directions.turn.else",{route:Q,aggregatedDirection:rt,translatedModifier:He});else if("new name"===O)se=ue.instant("igo.geo.directions.new name",{route:Q,translatedDirection:Re}),ge="compass",Ie="";else if("depart"===O)se=ue.instant("igo.geo.directions.depart",{route:Q,translatedDirection:Re}),ge="compass",Ie="";else if("arrive"===O)le?(rt=He?rt:"",se=ue.instant("igo.geo.directions.arrive.lastStep",{coma:He?", ":"",aggregatedDirection:rt})):(se=ue.instant("igo.geo.directions.arrive.intermediate",{route:Q}),ge="map-marker",Ie="");else if("merge"===O)se=ue.instant("igo.geo.directions.merge",{route:Q}),ge="forward",Ie="rotate-270";else if("on ramp"===O)se=ue.instant("igo.geo.directions.on ramp",{aggregatedDirection:rt});else if("off ramp"===O)se=ue.instant("igo.geo.directions.off ramp",{aggregatedDirection:rt});else if("fork"===O)se=F.search("left")>=0?ue.instant("igo.geo.directions.fork.left",{route:Q}):F.search("right")>=0?ue.instant("igo.geo.directions.fork.right",{route:Q}):ue.instant("igo.geo.directions.fork.else",{route:Q});else if("end of road"===O)se=ue.instant("igo.geo.directions.end of road",{translatedModifier:He,route:Q});else if("use lane"===O)se=ue.instant("igo.geo.directions.use lane");else if("continue"===O&&"uturn"!==F)se=ue.instant("igo.geo.directions.continue.notUturn",{route:Q}),ge="forward",Ie="rotate-270";else if("roundabout"===O){const xt=ue.instant(1===ae?"igo.geo.directions.cntSuffix.first":"igo.geo.directions.cntSuffix.secondAndMore");se=ue.instant("igo.geo.directions.roundabout",{exit:ae,cntSuffix:xt,route:Q}),ge="chart-donut",Ie=""}else"rotary"===O?(se=ue.instant("igo.geo.directions.rotary"),ge="chart-donut",Ie=""):"roundabout turn"===O?(se=ue.instant("igo.geo.directions.roundabout turn"),ge="chart-donut",Ie=""):"exit roundabout"===O?(se=ue.instant("igo.geo.directions.exit roundabout",{route:Q}),ge="forward",Ie="rotate-270"):se="notification"===O?ue.instant("igo.geo.directions.notification"):"uturn"===F?ue.instant("igo.geo.directions.uturnText",{translatedDirection:Re,route:Q}):ue.instant("igo.geo.directions.unknown");return ge=le?"flag-variant":ge,Ie=le?"":Ie,ge=0===ie?"compass":ge,Ie=0===ie?"":Ie,{instruction:se,image:ge,cssClass:Ie}}},72156:(Ee,ce,s)=>{"use strict";s.d(ce,{SY:()=>g.SY,WI:()=>y.W,aW:()=>g.aW,cz:()=>g.cz,qM:()=>g.qM});var y=s(40043),g=(s(9452),s(49172),s(19188))},19188:(Ee,ce,s)=>{"use strict";s.d(ce,{SY:()=>g,aW:()=>o,cz:()=>R,qM:()=>h});var y=s(62228),e=s(54844),d=s(40240);class g extends y.qc{storeInitialized$=new e.g(!1);clearStops(){this.storeInitialized$.next(!1),this.clear()}}class R extends d.y{}class o extends d.y{}class h extends d.y{}},28616:(Ee,ce,s)=>{"use strict";s.d(ce,{w:()=>u});var y=s(65056),e=s(34896),d=s(32328),g=s(62228),R=s(83600),o=s(93020),h=s(39882),j=s(64002),x=s(72584),w=s(61616),b=s(94364),a=(s(89500),s(78168),s(33712)),K=s(50168);function M(S,P){if(1&S&&(e.I0R(0,"td"),e.wR5(1,"mat-icon",7),e.C$Y()),2&S){const I=e.GaO(3);e.yG2(),e._6D("svgIcon",I.icon)}}function L(S,P){if(1&S){const I=e.KQA();e.I0R(0,"td")(1,"a",8),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"button",9),e.qCj("click",function(){e.usT(I);const G=e.GaO().$implicit,O=e.GaO(2);return e.CGJ(O.copyTextToClipboard(G.value))}),e.wR5(5,"mat-icon",10),e.C$Y()()}if(2&S){const I=e.GaO().$implicit,U=e.GaO(2);e.yG2(),e._6D("href",I.value,e.K6U),e.yG2(),e.CAO(" ",e.kDX(3,3,"igo.geo.targetHtmlUrl")," ",U.title,"")}}function oe(S,P){if(1&S&&(e.I0R(0,"td",11),e.OEk(1),e.C$Y()),2&S){const I=e.GaO().$implicit;e.yG2(),e.oRS(" ",I.key," ")}}function N(S,P){if(1&S&&e.wR5(0,"td",12),2&S){const I=e.GaO().$implicit;e.E7m("innerHTML",I.value,e.E3n)}}const B=()=>({cursor:"pointer",color:"blue"});function X(S,P){if(1&S){const I=e.KQA();e.I0R(0,"td")(1,"u",13),e.qCj("click",function(){e.usT(I);const G=e.GaO().$implicit,O=e.GaO(2);return e.CGJ(O.openSecureUrl(G.value))}),e.OEk(2),e.C$Y()()}if(2&S){const I=e.GaO().$implicit,U=e.GaO(2);e.yG2(),e.E7m("ngStyle",e.q4q(2,B)),e.yG2(),e.cNF(U.getEmbeddedLinkText(I.value))}}function V(S,P){if(1&S){const I=e.KQA();e.I0R(0,"td")(1,"u",13),e.qCj("click",function(){e.usT(I);const G=e.GaO().$implicit,O=e.GaO(2);return e.CGJ(O.openSecureUrl(G.value))}),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"button",9),e.qCj("click",function(){e.usT(I);const G=e.GaO().$implicit,O=e.GaO(2);return e.CGJ(O.copyTextToClipboard(G.value))}),e.wR5(5,"mat-icon",10),e.C$Y()()}2&S&&(e.yG2(),e.E7m("ngStyle",e.q4q(4,B)),e.yG2(),e.cNF(e.kDX(3,2,"igo.geo.targetHtmlUrl")))}function z(S,P){if(1&S){const I=e.KQA();e.I0R(0,"td")(1,"a",14),e.qCj("click",function(){e.usT(I);const G=e.GaO().$implicit,O=e.GaO(2);return e.CGJ(O.openSecureUrl(G.value))}),e.wR5(2,"img",15),e.wVc(3,"async"),e.wVc(4,"secureImage"),e.C$Y()()}if(2&S){const I=e.GaO().$implicit;e.yG2(),e._6D("href",I.value,e.K6U),e.yG2(),e._6D("src",e.kDX(3,2,e.kDX(4,4,I.value)),e.K6U)}}function W(S,P){if(1&S&&(e.wR5(0,"td",12),e.wVc(1,"json")),2&S){const I=e.GaO().$implicit;e.E7m("innerHTML",e.kDX(1,1,I.value),e.E3n)}}function A(S,P){if(1&S&&(e.I0R(0,"tr"),e.yuY(1,M,2,1,"td",4)(2,L,6,5,"td",4)(3,oe,2,1,"td",5)(4,N,1,1,"td",6)(5,X,3,3,"td",4)(6,V,6,5,"td",4)(7,z,5,6,"td",4)(8,W,2,3,"td",6),e.C$Y()),2&S){const I=P.$implicit,U=e.GaO(2);e.yG2(),e.E7m("ngIf","_blank"===U.feature.properties.target&&"url"===I.key),e.yG2(),e.E7m("ngIf","_blank"===U.feature.properties.target&&"url"===I.key),e.yG2(),e.E7m("ngIf",void 0===U.feature.properties.target),e.yG2(),e.E7m("ngIf",void 0===U.feature.properties.target&&!U.isObject(I.value)&&!U.isUrl(I.value)&&!U.isEmbeddedLink(I.value)),e.yG2(),e.E7m("ngIf",void 0===U.feature.properties.target&&U.isEmbeddedLink(I.value)),e.yG2(),e.E7m("ngIf",void 0===U.feature.properties.target&&!U.isObject(I.value)&&(U.isDoc(I.value)||U.isUrl(I.value))&&!U.isImg(I.value)),e.yG2(),e.E7m("ngIf",void 0===U.feature.properties.target&&!U.isObject(I.value)&&U.isUrl(I.value)&&U.isImg(I.value)),e.yG2(),e.E7m("ngIf",void 0===U.feature.properties.target&&U.isObject(I.value))}}function q(S,P){if(1&S&&(e.I0R(0,"table",2)(1,"tbody"),e.yuY(2,A,9,8,"tr",3),e.wVc(3,"keyvalue"),e.C$Y()()),2&S){const I=e.GaO();e.yG2(2),e.E7m("ngForOf",e.kDX(3,1,I.filterFeatureProperties(I.feature)))}}function _(S,P){if(1&S&&e.wR5(0,"iframe",16),2&S){const I=e.GaO();e.E7m("srcdoc",I.htmlSanitizer(I.feature.properties),e.E3n)("src",I.urlSanitizer(I.feature.properties.url),e.CaN)}}let u=(()=>{class S{http;cdRef;sanitizer;networkService;messageService;configService;state;unsubscribe$=new w.E;ready=!1;get source(){return this._source}set source(I){this._source=I,this.cdRef.detectChanges()}map;toolbox;get feature(){return this._feature}set feature(I){this._feature=I,this.cdRef.detectChanges(),this.selectFeature.emit()}_feature;_source;routeEvent=new e._w7;selectFeature=new e._w7;htmlDisplayEvent=new e._w7;get title(){return(0,g.YB)(this.feature)}get icon(){return(0,g.sH)(this.feature)||"link"}constructor(I,U,G,O,F,Q){this.http=I,this.cdRef=U,this.sanitizer=G,this.networkService=O,this.messageService=F,this.configService=Q,this.networkService.currentState().pipe((0,b.a)(this.unsubscribe$)).subscribe(r=>{this.state=r})}ngOnInit(){this.ready=!0}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}urlSanitizer(I){return this.sanitizer.bypassSecurityTrustResourceUrl(I)}isHtmlDisplay(){return this.feature&&this.isObject(this.feature.properties)&&"iframe"===this.feature.properties.target?(this.htmlDisplayEvent.emit(!0),!0):(this.htmlDisplayEvent.emit(!1),!1)}htmlSanitizer(I){if(I.body){if(!/<base href="[\w:\/\.]+">/.test(I.body)){const G=new URL(I.url,window.location.origin);I.body=I.body.replace("<head>",`<head><base href="${G.origin}">`)}return this.sanitizer.bypassSecurityTrustHtml(I.body)}}isObject(I){return"object"==typeof I}openSecureUrl(I){let U;const G=new RegExp(this.configService?.getConfig("depot.url")+'.*?(?="|$)');if(G.test(I))U=I.match(G)[0],this.http.get(U,{responseType:"blob"}).subscribe(F=>{const Q=URL.createObjectURL(F);window.open(Q,"_blank"),this.cdRef.detectChanges()},F=>{this.messageService.error("igo.geo.targetHtmlUrlUnauthorized","igo.geo.targetHtmlUrlUnauthorizedTitle")});else{let F=I;if(this.isEmbeddedLink(I)){var O=document.createElement("div");O.innerHTML=I,F=O.children[0].getAttribute("href")}window.open(F,"_blank")}}isUrl(I){if("string"==typeof I)return/^https?:\/\//.test(I)}isDoc(I){if("string"==typeof I)return!!this.isUrl(I)&&/(pdf|docx?|xlsx?)$/.test(I.toLowerCase())}isImg(I){if("string"==typeof I)return!!this.isUrl(I)&&/(jpe?g|png|gif)$/.test(I.toLowerCase())}isEmbeddedLink(I){return"string"==typeof I&&1===(I.match(/<a/g)||[]).length}getEmbeddedLinkText(I){let G=I.match(/(?:>).*?(?=<|$)/)[0];return G=G.replace(/>/g,""),G}filterFeatureProperties(I){const U=I.meta?I.meta.alias:void 0,G={};let O;return this.map&&this.map.forcedOffline$.pipe((0,b.a)(this.unsubscribe$)).subscribe(F=>{O=F}),I.properties&&I.properties.Route&&this.toolbox&&!this.toolbox.getTool("directions")&&delete I.properties.Route,U?(Object.keys(U).forEach(F=>{G[U[F]]=I.properties[F]}),G):(void 0!==O&&O?I.meta&&I.meta.excludeAttributeOffline&&I.meta.excludeAttributeOffline.forEach(Q=>{delete I.properties[Q]}):this.state.connection&&I.meta&&I.meta.excludeAttribute?I.meta.excludeAttribute.forEach(Q=>{delete I.properties[Q]}):!this.state.connection&&I.meta&&I.meta.excludeAttributeOffline&&I.meta.excludeAttributeOffline.forEach(Q=>{delete I.properties[Q]}),I.properties)}copyTextToClipboard(I){j._D.copy(I)&&this.messageService.success("igo.geo.query.link.message")}static \u0275fac=function(U){return new(U||S)(e.GI1(a.KK),e.GI1(e.kD9),e.GI1(K.mI),e.GI1(h.u),e.GI1(o.mi),e.GI1(R.aW))};static \u0275cmp=e.In1({type:S,selectors:[["igo-feature-details"]],inputs:{source:"source",map:"map",toolbox:"toolbox",feature:"feature"},outputs:{routeEvent:"routeEvent",selectFeature:"selectFeature",htmlDisplayEvent:"htmlDisplayEvent"},standalone:!0,features:[e.UHJ],decls:2,vars:2,consts:[["class","igo-striped mat-typography",4,"ngIf"],[3,"srcdoc","src",4,"ngIf"],[1,"igo-striped","mat-typography"],[4,"ngFor","ngForOf"],[4,"ngIf"],["id","keyValue",4,"ngIf"],[3,"innerHTML",4,"ngIf"],["matListItemIcon","",3,"svgIcon"],["target","_blank","rel","noopener noreferrer",3,"href"],["mat-icon-button","",1,"copyClipboard",3,"click"],["svgIcon","content-copy"],["id","keyValue"],[3,"innerHTML"],[3,"ngStyle","click"],["target","_blank","rel","noopener noreferrer",3,"href","click"],["igoImageError","","width","225","height","auto",3,"src"],[3,"srcdoc","src"]],template:function(U,G){1&U&&e.yuY(0,q,4,3,"table",0)(1,_,1,2,"iframe",1),2&U&&(e.E7m("ngIf",G.ready&&G.feature&&G.isObject(G.feature.properties)&&"iframe"!==G.feature.properties.target),e.yG2(),e.E7m("ngIf",G.isHtmlDisplay()))},dependencies:[y.u_,y.Iw,d.oB,d.qL,y.Qt,g.MJ,y.a,y.ED,y.uq,x.O0,x.sD,g.kd],styles:["table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px}#keyValue[_ngcontent-%COMP%]{width:30%}table[_ngcontent-%COMP%]     .routing{cursor:pointer}iframe[_ngcontent-%COMP%]{height:calc(100% - 4px);width:100%;border:0}.copyClipboard[_ngcontent-%COMP%]{border:none;background:transparent;cursor:pointer}"],changeDetection:0})}return S})()},86464:(Ee,ce,s)=>{"use strict";s.d(ce,{U:()=>g});var y=s(34896),e=s(54844),d=s(28616);let g=(()=>{class R{el;component;get feature(){return this.component.feature}feature$=new e.g(void 0);routingEvent=new y._w7;setFeature(){this.feature$.next(this.feature)}constructor(h,j){this.el=j,this.component=h}ngOnInit(){this.feature$.subscribe(()=>{this.feature.geometry&&this.bindClicking()})}bindClicking(){setTimeout(()=>{const h=this.el.nativeElement.querySelector("span.routing");h&&h.addEventListener("click",()=>{this.routingEvent.emit()})},1)}static \u0275fac=function(j){return new(j||R)(y.GI1(d.w,2),y.GI1(y.GMv))};static \u0275dir=y.Sc5({type:R,selectors:[["","igoFeatureDetailsDirective",""]],hostBindings:function(j,x){1&j&&y.qCj("selectFeature",function(){return x.setFeature()})},outputs:{routingEvent:"routingEvent"},standalone:!0})}return R})()},72432:(Ee,ce,s)=>{"use strict";s.d(ce,{Y:()=>w});var y=s(65056),e=s(34896),d=s(62228),g=s(64002),R=s(54844),o=s(68392);const h=["igoForm"],j=["*",[["","formButtons",""]]],x=["*","[formButtons]"];let w=(()=>{class b{form;set feature(T){this.feature$.next(T)}get feature(){return this.feature$.value}feature$=new R.g(void 0);submitForm=new e._w7;igoForm;constructor(){}onSubmit(T){const a=this.formDataToFeature(T);this.submitForm.emit(a)}getData(){return this.formDataToFeature(this.igoForm.getData())}formDataToFeature(T){const a={},K={};void 0===this.feature?K.id=(0,g.uq)():(Object.assign(a,this.feature.properties),Object.assign(K,this.feature.meta,{revision:(0,d.mU)(this.feature)+1}));Object.entries(T).forEach(oe=>{const[N,B]=oe;if(N.startsWith("properties.")){const X=N.substr(11);a[X]=B}});let L=T.geometry;return void 0===L&&void 0!==this.feature&&(L=this.feature.geometry),{meta:K,type:o.Y,geometry:L,projection:"EPSG:4326",properties:a}}static \u0275fac=function(a){return new(a||b)};static \u0275cmp=e.In1({type:b,selectors:[["igo-feature-form"]],viewQuery:function(a,K){if(1&a&&e.CC$(h,7),2&a){let M;e.wto(M=e.Gqi())&&(K.igoForm=M.first)}},inputs:{form:"form",feature:"feature"},outputs:{submitForm:"submitForm"},standalone:!0,features:[e.UHJ],ngContentSelectors:x,decls:5,vars:4,consts:[[3,"form","formData","submitForm"],["igoForm",""]],template:function(a,K){1&a&&(e.kPM(j),e.I0R(0,"igo-form",0,1),e.qCj("submitForm",function(L){return K.onSubmit(L)}),e.wVc(2,"async"),e._Xx(3),e._Xx(4,1,["formButtons",""]),e.C$Y()),2&a&&e.E7m("form",K.form)("formData",e.kDX(2,2,K.feature$))},dependencies:[d.Yl,y.a],styles:["[_nghost-%COMP%]{display:block}igo-form[_ngcontent-%COMP%]{height:100%}"],changeDetection:0})}return b})()},39844:(Ee,ce,s)=>{"use strict";s.d(ce,{Yf:()=>R.Yf,wP:()=>y.w,Su:()=>R.Su,ym:()=>R.ym,E9:()=>R.E9,kj:()=>R.kj,q1:()=>R.q1,qK:()=>R.qK,K6:()=>R.K6,Ki:()=>R.Ki,Yv:()=>R.Yv,QX:()=>R.QX,sf:()=>R.sf,Uz:()=>R.Uz,mM:()=>R.mM});var y=s(28616);s(86464);s(72432);var R=s(76572)},70524:(Ee,ce,s)=>{"use strict";s.d(ce,{m:()=>d});var y=s(3544),e=s(2892);function d(g,R){void 0===g.layer?(R=R||new e.M({source:new y.EB}),g.bindLayer(R),void 0===g.layer.map&&g.map.addLayer(g.layer)):void 0===g.layer.map&&g.map.addLayer(g.layer)}},68392:(Ee,ce,s)=>{"use strict";s.d(ce,{S:()=>e,Y:()=>y});const y="Feature";var e=function(d){return d[d.None=0]="None",d[d.Move=1]="Move",d[d.Zoom=2]="Zoom",d[d.Default=3]="Default",d}(e||{})},14672:(Ee,ce,s)=>{"use strict";s.d(ce,{In:()=>E,K6:()=>b,Ki:()=>L,QX:()=>N,Wg:()=>X,Yv:()=>oe,gV:()=>B,q1:()=>K,qK:()=>T});var y=s(62228),e=s(64002),d=s(94448),g=s(12396),R=s(62808),o=s(80848),h=s(36752),j=s(61252),x=s(54776),w=s(68392);function b(V,z,W){W=W||y._I;const q=(new g.c).readFeature(V,{dataProjection:V.projection,featureProjection:z});q.setId(W(V));const _=(0,y.YB)(V);void 0!==_&&q.set("_title",_,!0),void 0!==V.extent&&q.set("_extent",V.extent,!0),void 0!==V.projection&&q.set("_projection",V.projection,!0);const u=(0,y.u6)(V,"meta.mapTitle");void 0!==u&&q.set("_mapTitle",u,!0),q.set("_entityRevision",(0,y.mU)(V),!0);const S=(0,y.sH)(V);return void 0!==S&&q.set("_icon",S,!0),V.meta&&V.meta.style&&q.set("_style",V.meta.style,!0),V.sourceId&&q.set("_sourceId",V.sourceId,!0),q}function E(V,z,W,A="EPSG:4326"){let q,_,u,S;W?(_=W.get("title"),W.get("sourceOptions")&&(u=W.get("sourceOptions").excludeAttribute,S=W.get("sourceOptions").excludeAttributeOffline)):_=V.get("_title");const P=new g.c,I=V.getProperties(),U=V.getType();if("Polygon"===U){const r=V.getEnds();q=new h.cp(V.getFlatCoordinates(),"XY",r)}else"Point"===U?q=new o.c(V.getFlatCoordinates(),"XY"):"LineString"===U&&(q=new R.c(V.getFlatCoordinates(),"XY"));const G=P.writeGeometryObject(q,{dataProjection:A,featureProjection:z}),O=V.getId()?V.getId():(0,e.uq)(),F=V.get("_mapTitle"),Q=j.W0(V.getExtent(),z,A);return{type:w.Y,projection:A,extent:Q,meta:{id:O,title:_||F||O,mapTitle:F,excludeAttribute:u,excludeAttributeOffline:S},properties:I,geometry:G,ol:V}}function T(V,z,W,A="EPSG:4326"){let q,_,u,S;const P=new g.c,U=V.getKeys().filter(r=>!r.startsWith("_")&&"geometry"!==r).reduce((r,ie)=>(r[ie]=V.get(ie),r),{}),G=P.writeGeometryObject(V.getGeometry(),{dataProjection:A,featureProjection:z});if(W){q=W.get("title");const r=W.get("sourceOptions");r&&(_=r.excludeAttribute,u=r.excludeAttributeOffline,S=r.idColumn||("arcgisrest"===r.type||"tilearcgisrest"===r.type?"OBJECTID":void 0))}else q=V.get("_title");const O=V.get("_mapTitle"),F=V.getId()?V.getId():V.get(S)?V.get(S):(0,e.uq)();return V.get("_newFeature"),{type:w.Y,projection:A,extent:V.get("_extent"),meta:{id:F,title:q||O||F,mapTitle:O,revision:V.getRevision(),style:V.get("_style"),excludeAttribute:_,excludeAttributeOffline:u},properties:U,geometry:G,ol:V}}function K(V,z){const W=d.Gu();return V.forEach(A=>{const q=function a(V,z){let W=d.Gu();const A=V.get("_extent"),q=V.get("_projection");if(void 0!==A&&void 0!==q)W=j.W0(A,q,z);else{const _=V.getGeometry();null!==_&&(W=_.getExtent())}return W}(A,z);d.SU(W,q)}),W}function M(V,z){const[W,A]=d.iK(V);return[z[3]?V[0]-W*z[3]:V[0],z[2]?V[1]-A*z[2]:V[1],z[1]?V[2]+W*z[1]:V[2],z[0]?V[3]+A*z[0]:V[3]]}function L(V,z,W=.05){const A=Array.isArray(W)?W:[W,W,W,W],_=M(V,[-1,-1,-1,-1].map((u,S)=>u*A[S]));return!d.cP(_,z)}function oe(V,z,W){W=W||.004;const A=V.getExtent(),q=d.kh(A),_=d.kh(z);return!(0===_&&V.getZoom()>13)&&_/q<W}function N(V,z,W=w.S.Default,A,q){const _=V.getExtent(),S=K(z,V.getOlProjection());let P=S;void 0!==A&&(P=M(P,A)),W===w.S.Zoom?V.zoomToExtent(P):W===w.S.Move?V.moveToExtent(P):W===w.S.Default&&(L(_,S)||oe(V,S,q))&&V.zoomToExtent(P)}function B(V){V.setStyle(new x.cp({}))}function X(V,z){const W=new Map;z.forEach(u=>{W.set(u.getId(),u)});const A=[];V.forEach(u=>{const S=W.get(u.getId());void 0===S||S.get("_entityRevision")!==u.get("_entityRevision")?A.push(u):W.delete(S.getId())});const q=Array.from(W.keys());return{add:z.filter(u=>q.indexOf(u.getId())>=0),remove:A}}},76572:(Ee,ce,s)=>{"use strict";s.d(ce,{Yf:()=>y.Y,Su:()=>y.S,ym:()=>g.y,IV:()=>R.I,CE:()=>j,_c:()=>K,E9:()=>T.E,oJ:()=>N,kj:()=>M.k,eu:()=>E,q1:()=>e.q1,qK:()=>e.qK,K6:()=>e.K6,Ki:()=>e.Ki,Yv:()=>e.Yv,QX:()=>e.QX,sf:()=>B.s,Uz:()=>B.U,mM:()=>d.m});var y=s(68392),e=s(14672),d=s(70524),g=s(40240),R=s(33436),o=s(62228),h=s(24112);class j extends o.uk{options;stores$$=new Map;resolution$$=[];empty$$;constructor(V){super(V),this.options=V}bindStore(V){super.bindStore(V),!0===this.active&&this.watchStore(V),this.empty$$=V.empty$.subscribe(()=>this.updateEntitiesInResolution(V,V.layer.map.viewController.getResolution()))}unbindStore(V){super.unbindStore(V),!0===this.active&&this.unwatchStore(V)}doActivate(){this.stores.forEach(V=>this.watchStore(V))}doDeactivate(){this.unwatchAll()}watchStore(V){this.stores$$.has(V)||(this.updateEntitiesInResolution(V,V.layer.map.viewController.getResolution()),this.resolution$$.push(V.layer.map.viewController.resolution$.pipe((0,h.o)(250)).subscribe(z=>{this.updateEntitiesInResolution(V,z)})))}updateEntitiesInResolution(V,z){V.state.updateAll(z>V.layer.minResolution&&z<V.layer.maxResolution?{inMapResolution:!0}:{inMapResolution:!1})}unwatchStore(V){void 0!==this.stores$$.get(V)&&this.stores$$.delete(V)}unwatchAll(){this.stores$$.clear(),this.resolution$$.map(V=>V.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}var x=s(64002),w=s(91296),b=s(47864);class E extends o.uk{options;propertyTypeDetectorService;capabilitiesService;stores$$=new Map;states$$=[];empty$$;map;constructor(V,z,W){super(V),this.options=V,this.propertyTypeDetectorService=z,this.capabilitiesService=W,this.map=V.map}bindStore(V){super.bindStore(V),!0===this.active&&this.watchStore(V)}unbindStore(V){super.unbindStore(V),!0===this.active&&this.unwatchStore(V)}doActivate(){this.stores.forEach(V=>this.watchStore(V))}doDeactivate(){this.unwatchAll()}watchStore(V){this.stores$$.has(V)||(this.updateEntitiesPropertiesState(V),this.states$$.push(this.map.layers$.pipe((0,h.o)(250),(0,w.c)()).subscribe(([z,W])=>{let A;z&&(A=z.map(_=>_.id));const q=W.filter(_=>!A.includes(_.id));this.updateEntitiesPropertiesState(V,q)})),this.states$$.push(V.entities$.pipe((0,h.o)(250)).subscribe(z=>{this.updateEntitiesPropertiesState(V)})))}updateEntitiesPropertiesState(V,z){const W=this.map.layers.map(G=>G.id);let A=[];A=z?V.entities$.value:V.stateView.all().length?V.stateView.all().filter(O=>!O.state.geoService).map(O=>O.entity):V.entities$.value;const _=A.slice(0,A.length>=250?250:A.length);let u=[];_.map(G=>{u=u.concat(Object.keys(G.properties||{}))}),u=[...new Set(u)];const S={};u.map(G=>{S[G]=[...new Set(A.map(O=>O.properties[G]))]});const P={};Object.entries(S).forEach(G=>{const[O,F]=G,Q=F.filter(r=>this.propertyTypeDetectorService.isGeoService(r));Q?.length&&(P[O]=Q)});const I=[];Object.entries(P).forEach(G=>{const[O,F]=G;F.map(Q=>{const r=this.propertyTypeDetectorService.getGeoService(Q,u);if(r){const ie=u.filter(fe=>r.propertiesForLayerName.includes(fe)),ae=ie.length?ie[0]:void 0;ae&&I.push({url:Q,urlProperty:O,layerNameProperty:ae,geoService:r})}})});const U=[];I.map(G=>{const O=G.url,F=G.geoService.type||"wms";S[G.layerNameProperty].map(Q=>{let ie,r=Q;["arcgisrest","imagearcgisrest","tilearcgisrest"].includes(F)&&(r=void 0,ie=Q);const ae=x.Yv.removeUndefined({sourceOptions:{type:F||"wms",url:O,optionsFromCapabilities:!0,optionsFromApi:!0,params:{LAYERS:r,LAYER:ie}}}),fe=(0,b.KC)(ae.sourceOptions);U.push({geoServiceAssociation:G,state:{added:void 0!==W.find(le=>le===fe),haveGeoServiceProperties:!0,type:F,url:O,layerName:Q}})})}),U.map(G=>{const O=G.geoServiceAssociation.urlProperty,F=G.geoServiceAssociation.layerNameProperty,Q=G.state.url,r=G.state.layerName,ie=A.filter(fe=>fe.properties[O]===Q&&fe.properties[F]===r);V.state.updateMany(ie,{geoService:G.state},!0)})}unwatchStore(V){void 0!==this.stores$$.get(V)&&this.stores$$.delete(V)}unwatchAll(){this.stores$$.clear(),this.states$$.map(V=>V.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}var T=s(20624),a=s(93176);class K extends o.uk{options;stores$$=new Map;constructor(V){super(V),this.options=V}bindStore(V){super.bindStore(V),!0===this.active&&this.watchStore(V)}unbindStore(V){super.unbindStore(V),!0===this.active&&this.unwatchStore(V)}doActivate(){this.stores.forEach(V=>this.watchStore(V))}doDeactivate(){this.unwatchAll()}watchStore(V){this.stores$$.has(V)||(this.onSourceChanges(V),V.layer.ol.getSource().on("change",W=>{this.onSourceChanges(V)}))}unwatchStore(V){void 0!==this.stores$$.get(V)&&this.stores$$.delete(V)}unwatchAll(){Array.from(this.stores$$.entries()).forEach(V=>{}),this.stores$$.clear()}onSourceChanges(V){let z=V.layer.ol.getSource().getFeatures();V.layer.dataSource instanceof a.a&&(z=z.flatMap(W=>W.get("features"))),0===z.length?V.clear():V.setStoreOlFeatures(z)}}var M=s(18080),L=s(82304),oe=s(53404);class N extends o.uk{options;stores$$=new Map;constructor(V){super(V),this.options=V}bindStore(V){super.bindStore(V),!0===this.active&&this.watchStore(V)}unbindStore(V){super.unbindStore(V),!0===this.active&&this.unwatchStore(V)}doActivate(){this.stores.forEach(V=>this.watchStore(V))}doDeactivate(){this.unwatchAll()}initStoreSearchIndex(V){V.searchDocument=new L.Document({tokenize:"full"})}watchStore(V){this.stores$$.has(V)||(this.initStoreSearchIndex(V),V.entities$.pipe((0,oe.O)(z=>!z.length)).subscribe(()=>this.onEntitiesChanges(V)))}unwatchStore(V){void 0!==this.stores$$.get(V)&&(V.searchDocument=void 0,this.stores$$.delete(V))}unwatchAll(){Array.from(this.stores$$.entries()).forEach(V=>{}),this.stores$$.clear()}onEntitiesChanges(V){const z=this.options.percentDistinctValueRatio||2,W=[];V.index.forEach((u,S)=>{const P=u.properties;P.igoSearchID=S,W.push(P)});const A=[];let q=[],_=[];if(this.options.sourceFields)q=this.options.sourceFields.filter(u=>!u.searchIndex?.enabled),_=this.options.sourceFields.filter(u=>u.searchIndex?.enabled).map(u=>Object.assign({},{field:u.name,tokenize:"full"},u.searchIndex));else if(W.length){const u=Object.keys(W[0]),S=[];q=u.map(I=>{const U=[...new Set(W.map(G=>G[I]))];U.length/W.length*100<=z||U.every(G=>Number(G)===G&&G%1!=0)?q.push(I):S.push(I)}).filter(I=>I),_=S.filter(I=>"igoSearchID"!==I).map(I=>({field:I,tokenize:"full"}))}V.index.forEach((u,S)=>{const P=JSON.parse(JSON.stringify(u.properties));q.map(I=>delete P[I]),Object.keys(P).length&&A.push(P)}),0===A.length?this.initStoreSearchIndex(V):(V.searchDocument=new L.Document({document:{id:"igoSearchID",index:_}}),A.map(u=>{V.searchDocument.add(u.igoSearchID,u)}))}}var B=s(64096)},40240:(Ee,ce,s)=>{"use strict";s.d(ce,{y:()=>R});var y=s(62228),e=s(94448),d=s(68392),g=s(14672);class R extends y.qc{layer;map;get source(){return this.layer?this.layer.dataSource:void 0}set searchDocument(h){this._searchDocument=h}get searchDocument(){return this._searchDocument}_searchDocument;constructor(h,j){super(h,j),this.map=j.map}bindLayer(h){return this.layer=h,this}setLayerFeatures(h,j=d.S.Default,x,w,b){b=b||y._I,this.checkLayer();const E=h.map(T=>(0,g.K6)(T,this.map.projection,b));this.setLayerOlFeatures(E,j,x,w)}setStoreOlFeatures(h){this.checkLayer();const j=h.map(x=>(x.set("_featureStore",this,!0),(0,g.qK)(x,this.layer.map.projection)));this.load(j)}clearLayer(){this.checkLayer(),this.source.ol.clear()}checkLayer(){if(void 0===this.layer)throw new Error("This FeatureStore is not bound to a layer.")}setLayerOlFeatures(h,j=d.S.Default,x,w){const b=this.layer.ol.getSource(),E=(0,g.Wg)(b.getFeatures(),h);E.remove.length>0&&this.removeOlFeaturesFromLayer(E.remove),E.add.length>0&&this.addOlFeaturesToLayer(E.add),E.add.length>0?(0,g.QX)(this.map.viewController,E.add,j,x,w):E.remove.length>0&&(0,g.QX)(this.map.viewController,h,j,x,w)}setLayerExtent(){let h=this.entities$.getValue(),j=e.Gu(),x=[];h.forEach(b=>{x.push((0,g.K6)(b,this.map.projection))});const w=(0,g.q1)(x,this.map.viewProjection);e.SU(j,w),this.layer.setExtent(j)}addOlFeaturesToLayer(h){h.forEach(j=>{j.set("_featureStore",this,!0)}),this.source.ol.addFeatures(h)}removeOlFeaturesFromLayer(h){h.forEach(j=>{this.source.ol.removeFeature(j)})}}},64096:(Ee,ce,s)=>{"use strict";s.d(ce,{U:()=>g,s:()=>d});var y=s(20624),e=s(18080);function d(R,o){void 0===R.getStrategyOfType(y.E)?(o=o||new y.E({}),R.addStrategy(o),o.activate()):R.activateStrategyOfType(y.E)}function g(R,o){void 0===R.getStrategyOfType(e.k)?(o=o||new e.k({map:R.map}),R.addStrategy(o),o.activate()):R.activateStrategyOfType(e.k)}},33436:(Ee,ce,s)=>{"use strict";s.d(ce,{I:()=>R});var y=s(62228),e=s(94448),d=s(53404),g=s(24112);class R extends y.uk{options;stores$$=new Map;states$$=[];empty$$;constructor(h){super(h),this.options=h}bindStore(h){super.bindStore(h),!0===this.active&&this.watchStore(h),this.empty$$=h.empty$.pipe((0,d.O)(j=>!j)).subscribe(()=>this.updateEntitiesInExtent(h))}unbindStore(h){super.unbindStore(h),!0===this.active&&this.unwatchStore(h)}doActivate(){this.stores.forEach(h=>this.watchStore(h))}doDeactivate(){this.unwatchAll()}watchStore(h){this.stores$$.has(h)||(this.updateEntitiesInExtent(h),this.states$$.push(h.layer.map.viewController.state$.pipe((0,g.o)(250)).subscribe(()=>this.updateEntitiesInExtent(h))))}updateEntitiesInExtent(h){if(h?.layer?.map?.viewController){h.state.updateAll({inMapExtent:!1});const j=h.layer.map.viewController.getExtent(),w=this.getFeaturesInExtent(h.entities$.value,j);h.state.updateMany(w,{inMapExtent:!0},!1)}}getFeaturesInExtent(h,j){return h.reduce((x,w)=>{const b=w.ol?.getGeometry();if(b){const E=b.getExtent();e.K0(E,j)&&x.push(w)}else x.push(w);return x},[])}unwatchStore(h){void 0!==this.stores$$.get(h)&&this.stores$$.delete(h)}unwatchAll(){this.stores$$.clear(),this.states$$.map(h=>h.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}},20624:(Ee,ce,s)=>{"use strict";s.d(ce,{E:()=>d});var y=s(62228),e=s(68392);class d extends y.uk{options;stores$$=new Map;motion;constructor(R){super(R),this.options=R,this.setMotion(R.motion)}bindStore(R){super.bindStore(R),!0===this.active&&this.watchStore(R)}unbindStore(R){super.unbindStore(R),!0===this.active&&this.unwatchStore(R)}setMotion(R){this.motion=R}doActivate(){this.stores.forEach(R=>this.watchStore(R))}doDeactivate(){this.unwatchAll()}watchStore(R){if(this.stores$$.has(R))return;const o=R.view.all$().subscribe(h=>this.onFeaturesChange(h,R));this.stores$$.set(R,o)}unwatchStore(R){const o=this.stores$$.get(R);void 0!==o&&(o.unsubscribe(),this.stores$$.delete(R))}unwatchAll(){Array.from(this.stores$$.entries()).forEach(R=>{R[1].unsubscribe()}),this.stores$$.clear()}onFeaturesChange(R,o){0===R.length?o.clearLayer():o.setLayerFeatures(R,this.selectMotion(o),this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)}selectMotion(R){return void 0!==this.motion?this.motion:!0===R.pristine||R.count>R.view.count?e.S.Default:e.S.None}}},18080:(Ee,ce,s)=>{"use strict";s.d(ce,{E:()=>T,k:()=>a});var y=s(62228),e=s(83552),d=s(56224),g=s(35876),R=s(40604),o=s(24112),h=s(68013),j=s(3544),x=s(2892),w=s(59324),b=s(68392),E=s(40240);class T extends d.c{constructor(M){super(M)}}class a extends y.uk{options;mapClickListener;olDragSelectInteraction;olDragSelectInteractionEndKey;stores$$;motion;get map(){return this.options.map}get overlayStore(){return this._overlayStore}_overlayStore;constructor(M){super(M),this.options=M,this.setMotion(M.motion),this._overlayStore=this.createOverlayStore()}bindStore(M){super.bindStore(M),!0===this.active&&this.activate()}unbindStore(M){super.unbindStore(M),!0===this.active&&this.activate()}setMotion(M){this.motion=M}unselectAll(){this.stores.forEach(M=>{M.state.updateAll({selected:!1})})}clear(){this.overlayStore.source.ol.clear(),this.overlayStore.clear()}deactivateSelection(){this.unlistenToMapClick(),this.removeDragBoxInteraction(),this.unwatchAll()}doActivate(){this.addOverlayLayer(),this.listenToMapClick(),!0===this.options.dragBox&&this.addDragBoxInteraction(),this.watchAll()}doDeactivate(){this.deactivateSelection(),this.removeOverlayLayer()}watchAll(){this.unwatchAll();const M=this.stores.map(L=>L.stateView.manyBy$(oe=>!0===oe.state.selected).pipe((0,R.k)(oe=>oe.map(N=>N.entity))));this.stores$$=(0,g.E)(M).pipe((0,o.o)(5),(0,h.s)(1),(0,R.k)(L=>L.reduce((oe,N)=>oe.concat(N)))).subscribe(L=>this.onSelectFromStore(L))}unwatchAll(){void 0!==this.stores$$&&this.stores$$.unsubscribe()}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",M=>{this.onMapClick(M)})}unlistenToMapClick(){(0,e.S)(this.mapClickListener)}onMapClick(M){const L=!(0,w.q)(M),oe=!L,N=M.map.getFeaturesAtPixel(M.pixel,{hitTolerance:this.options.hitTolerance||0,layerFilter:B=>void 0!==this.stores.find(V=>V.layer?.ol===B)});this.onSelectFromMap(N,L,oe)}addDragBoxInteraction(){let M;const L=this.map.ol.getInteractions().getArray();for(const oe of L)if(oe instanceof T){M=oe;break}void 0===M&&(M=new T({condition:w.q}),this.map.ol.addInteraction(M),this.olDragSelectInteraction=M),this.olDragSelectInteractionEndKey=M.on("boxend",oe=>this.onDragBoxEnd(oe))}removeDragBoxInteraction(){void 0!==this.olDragSelectInteractionEndKey&&(0,e.S)(this.olDragSelectInteractionEndKey),void 0!==this.olDragSelectInteraction&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=void 0}onDragBoxEnd(M){const L=!(0,w.q)(M.mapBrowserEvent),N=M.target.getGeometry().getExtent(),B=this.stores.reduce((X,V)=>{const z=V.layer.ol.getSource();return X.push(...z.getFeaturesInExtent(N)),X},[]);this.onSelectFromMap(B,L,!1)}onSelectFromStore(M){const L=this.motion,N=this.overlayStore.layer.ol.getSource().getFeatures().map(V=>V.getId()),B=M.map(this.overlayStore.getKey);let X;X=0!==M.length&&(N.length!==B.length||!N.every(V=>B.indexOf(V)>=0)),this.overlayStore.setLayerFeatures(M,X?L:b.S.None,this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)}onSelectFromMap(M,L,oe){const N=this.groupFeaturesByStore(M);this.stores.forEach(B=>{const X=N.get(B);void 0===X&&!0===L?this.unselectAllFeaturesFromStore(B):void 0===X&&!1===L||this.selectFeaturesFromStore(B,X,L,oe)})}selectFeaturesFromStore(M,L,oe,N){!0===N?M.state.reverseMany(L,["selected"]):M.state.updateMany(L,{selected:!0},oe)}unselectAllFeaturesFromStore(M){M.state.updateAll({selected:!1})}groupFeaturesByStore(M){const L=new Map;return null==M||M.forEach(oe=>{const N=oe.get("_featureStore");if(void 0===N)return;let B=L.get(N);void 0===B&&(B=[],L.set(N,B));const X=N.get(oe.getId());void 0!==X&&B.push(X)}),L}createOverlayStore(){const M=this.options.layer?this.options.layer:this.createOverlayLayer();return new E.y([],{map:this.map}).bindLayer(M)}createOverlayLayer(){return new x.M({zIndex:300,source:new j.EB,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1})}addOverlayLayer(){void 0===this.overlayStore.layer.map&&this.map.addLayer(this.overlayStore.layer)}removeOverlayLayer(){this.overlayStore.source.ol.clear(),this.map.removeLayer(this.overlayStore.layer)}}},5196:(Ee,ce,s)=>{"use strict";s.d(ce,{e:()=>e,w:()=>y});var y=function(d){return d.BasicNumericOperator="basicnumericoperator",d.Basic="basic",d.BasicAndSpatial="basicandspatial",d.Spatial="spatial",d.All="all",d.Time="time",d}(y||{}),e=function(d){return d.BBOX="BBox",d.PropertyIsBetween="PropertyIsBetween",d.Contains="Contains",d.During="During",d.PropertyIsEqualTo="PropertyIsEqualTo",d.PropertyIsGreaterThan="PropertyIsGreaterThan",d.PropertyIsGreaterThanOrEqualTo="PropertyIsGreaterThanOrEqualTo",d.Intersects="Intersects",d.PropertyIsNull="PropertyIsNull",d.PropertyIsLessThan="PropertyIsLessThan",d.PropertyIsLessThanOrEqualTo="PropertyIsLessThanOrEqualTo",d.PropertyIsLike="PropertyIsLike",d.PropertyIsNotEqualTo="PropertyIsNotEqualTo",d.Within="Within",d.And="And",d.Or="Or",d.Not="Not",d}(e||{})},40912:(Ee,ce,s)=>{"use strict";s.d(ce,{S:()=>j});var y=s(64002),e=s(11544),d=s(10416),g=s(68470),R=s(30816),o=s.n(R),h=s(5196);class j{filterSequence=[];operators={[h.e.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[h.e.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[h.e.PropertyIsLike]:{spatial:!1,fieldRestrict:["string"]},[h.e.PropertyIsGreaterThan]:{spatial:!1,fieldRestrict:["number"]},[h.e.PropertyIsGreaterThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[h.e.PropertyIsLessThan]:{spatial:!1,fieldRestrict:["number"]},[h.e.PropertyIsLessThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[h.e.PropertyIsBetween]:{spatial:!1,fieldRestrict:["number"]},[h.e.During]:{spatial:!1,fieldRestrict:[]},[h.e.PropertyIsNull]:{spatial:!1,fieldRestrict:[]},[h.e.Intersects]:{spatial:!0,fieldRestrict:[]},[h.e.Within]:{spatial:!0,fieldRestrict:[]},[h.e.Contains]:{spatial:!0,fieldRestrict:[]}};defineOgcFiltersDefaultOptions(w,b,E){let T=!0;return E&&"wms"===E&&(T=!1),(w=w||{}).enabled=void 0===w.enabled?T:w.enabled,w.editable=void 0===w.editable?T:w.editable,w.geometryName=b,w.advancedOgcFilters=!0,w.enabled&&(w.pushButtons||w.checkboxes||w.radioButtons||w.select||w.autocomplete)&&(w.advancedOgcFilters=!1),w}buildFilter(w,b,E,T,a){let K,M,L;if(M=!/intersects|contains|within/gi.test(JSON.stringify(w)),w&&(T=void 0!==w.geometryName?w.geometryName:T),b&&w&&(K=g.OK(T,b,E.getCode())),!w)return"bbox="+b.join(",")+","+E.getCode();w=this.checkIgoFiltersProperties(w,T,E),L=b&&M?g.iG(K,this.bundleFilter(w,a)):this.bundleFilter(w,a);const oe={srsName:"",featureNS:"",featurePrefix:"",featureTypes:["featureTypes"],filter:L,outputFormat:"",geometryName:T},N=(new e.c).writeGetFeature(oe);return"filter="+(new XMLSerializer).serializeToString(N).split(/typenames *=|typename *=\"featureTypes\" *>/gi)[1].split(/<\/Query><\/GetFeature>/gi)[0]}bundleFilter(w,b){if(w instanceof Array){const E=[];return w.forEach(T=>{E.push(this.bundleFilter(T,b))}),E}return w.hasOwnProperty("logical")?this.createFilter({operator:w.logical,logicalArray:this.bundleFilter(w.filters,b)},b):w.hasOwnProperty("operator")?this.createFilter(w,b):void 0}createFilter(w,b){const E=w.operator,T=w.logicalArray,a=w.propertyName,K=w.pattern,M=!w.matchCase||w.matchCase,L=w.wildCard?w.wildCard:"*",oe=w.singleChar?w.singleChar:".",N=w.escapeChar?w.escapeChar:"!",B=w.lowerBoundary,X=w.upperBoundary,V=w.geometryName,z=w.extent,W=w.wkt_geometry,A=w.srsName?w.srsName:"EPSG:3857",q=this.parseFilterOptionDate(w.begin,b?b.minDate:void 0),_=this.parseFilterOptionDate(w.end,b?b.maxDate:void 0),u=w.expression;let S;switch(W&&(S=(new d.c).readGeometry(W,{dataProjection:A,featureProjection:A||"EPSG:3857"})),E.toLowerCase()){case h.e.BBOX.toLowerCase():return g.OK(V,z,A);case h.e.PropertyIsBetween.toLowerCase():return g.YX(a,B||-1e40,X||1e40);case h.e.Contains.toLowerCase():return g.Y7(V,S,A);case h.e.During.toLowerCase():return g.In(a,q,_);case h.e.PropertyIsEqualTo.toLowerCase():return g.cv(a,u,M);case h.e.PropertyIsGreaterThan.toLowerCase():return g.kP(a,u);case h.e.PropertyIsGreaterThanOrEqualTo.toLowerCase():return g.Ky(a,u);case h.e.Intersects.toLowerCase():return g.K0(V,S,A);case h.e.PropertyIsNull.toLowerCase():return g.Av(a);case h.e.PropertyIsLessThan.toLowerCase():return g.cP(a,u);case h.e.PropertyIsLessThanOrEqualTo.toLowerCase():return g.ov(a,u);case h.e.PropertyIsLike.toLowerCase():return g.G2(a,K?K.replace(/[()_]/gi,oe):L,L,oe,N,M);case h.e.PropertyIsNotEqualTo.toLowerCase():return g.Qb(a,u,M);case h.e.Within.toLowerCase():return g.Cu(V,S,A);case h.e.And.toLowerCase():return g.iG.apply(null,T);case h.e.Or.toLowerCase():return g.or.apply(null,T);case h.e.Not.toLowerCase():return g.ik.apply(null,T);default:return}}defineInterfaceFilterSequence(w,b,E="",T=-1){return w instanceof Array?w.forEach(a=>{this.filterSequence.concat(this.defineInterfaceFilterSequence(a,b,E,T))}):w.hasOwnProperty("logical")?this.filterSequence.concat(this.defineInterfaceFilterSequence(w.filters,b,w.logical,T+=1)):w.hasOwnProperty("operator")&&this.filterSequence.push(this.addInterfaceFilter(w,b,T,E)),this.filterSequence}computeAllowedOperators(w,b,E){let a,K,M,T={};if(w&&b){const L=w.find(oe=>oe.name===b);a=L&&L.allowedOperatorsType?L.allowedOperatorsType:E}switch(w&&w.map(L=>{if(!L.allowedOperatorsType)return;const oe=L.allowedOperatorsType.toLowerCase();(oe===h.w.All.toLowerCase()||oe===h.w.Spatial.toLowerCase()||oe===h.w.BasicAndSpatial.toLowerCase())&&(K=!0,oe===h.w.All.toLowerCase()&&(M=!0))}),a=a||h.w.BasicAndSpatial,a.toLowerCase()){case h.w.All:T=this.operators;break;case h.w.Spatial:T={[h.e.Intersects]:{spatial:!0,fieldRestrict:[]},[h.e.Within]:{spatial:!0,fieldRestrict:[]}};break;case h.w.BasicAndSpatial:T={[h.e.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[h.e.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[h.e.Intersects]:{spatial:!0,fieldRestrict:[]},[h.e.Within]:{spatial:!0,fieldRestrict:[]}};break;case h.w.Basic:T={[h.e.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[h.e.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]}};break;case h.w.Time:T={[h.e.During]:{spatial:!1,fieldRestrict:[]}};break;case h.w.BasicNumericOperator:T={[h.e.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[h.e.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[h.e.PropertyIsGreaterThan]:{spatial:!1,fieldRestrict:["number"]},[h.e.PropertyIsGreaterThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[h.e.PropertyIsLessThan]:{spatial:!1,fieldRestrict:["number"]},[h.e.PropertyIsLessThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]}};break;default:T={[h.e.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[h.e.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[h.e.Intersects]:{spatial:!0,fieldRestrict:[]},[h.e.Within]:{spatial:!0,fieldRestrict:[]}}}return K&&(T.Intersects={spatial:!0,fieldRestrict:[]},T.Within={spatial:!0,fieldRestrict:[]},M&&(T.Contains={spatial:!0,fieldRestrict:[]})),T}addInterfaceFilter(w,b,E=0,T="Or"){w||(w={operator:"PropertyIsEqualTo"});const a={propertyName:"",operator:"",active:"",filterid:(0,y.uq)(),step:"",begin:"",end:"",sliderOptions:{},lowerBoundary:"",upperBoundary:"",expression:"",pattern:"",wildCard:"*",singleChar:".",escapeChar:"!",matchCase:!0,igoSpatialSelector:"",igoSNRC:"",geometryName:"",geometry:"",wkt_geometry:"",extent:"",srsName:"",parentLogical:"",level:0};return Object.assign(a,{parentLogical:T,level:E,geometryName:b},w)}checkIgoFiltersProperties(w,b,E,T=!1){const a=[];return w instanceof Array?(w.forEach(K=>{a.push(this.checkIgoFiltersProperties(K,b,E,T))}),a):w.hasOwnProperty("logical")?Object.assign({},{logical:w.logical,filters:this.checkIgoFiltersProperties(w.filters,b,E,T)}):w.hasOwnProperty("operator")?this.addFilterProperties(w,b,E,T):void 0}addFilterProperties(w,b,E,T=!1){const a=w.hasOwnProperty("filterid")?w.filterid:(0,y.uq)(),K=w.hasOwnProperty("active")?w.active:T,M=w.hasOwnProperty("srsName")?w.srsName:E?E.getCode():"EPSG:3857";return Object.assign({},{filterid:a,active:K,igoSpatialSelector:"fixedExtent",srsName:M},w,{geometryName:b})}rebuiltIgoOgcFilterObjectFromSequence(w){if(w instanceof Array&&w.length>=1){let E,a,b=w[0].parentLogical,T=[];return w.forEach(K=>{const M=Object.assign({},K),L=w.indexOf(K);E=L>=0&&L<w.length-1?w[L+1]:M,delete M.active,delete M.filterid,delete M.parentLogical,T.push(M),1===w.length?a=M:b!==E.parentLogical&&(1===T.length?console.log("You must set at least two operator in a logical ("+b+")"):(a=Object.assign({},{logical:b,filters:T}),T=[a],b=E.parentLogical))}),a}}computeIgoSelector(w){if(w.groups.every(E=>void 0!==E.computedSelectors))return w;let b;if(w.groups&&w.bundles){if(!w.bundles.every(E=>void 0!==E.id))throw new Error("You must set an id for each of your bundles");b=y.Yv.copyDeep(w),b.groups.forEach(E=>{E.title=E.title?E.title:E.name,E.enabled=!!E.enabled&&E.enabled,E.computedSelectors=y.Yv.copyDeep(b.bundles.filter(T=>E.ids.includes(T.id)))})}else!w.groups&&w.bundles?(b=y.Yv.copyDeep(w),b.groups=[{title:"group1",name:"group1",computedSelectors:y.Yv.copyDeep(b.bundles)}]):b={bundles:w,groups:[{title:"group1",name:"group1",computedSelectors:y.Yv.copyDeep(w)}],selectorType:b.selectorType};return b.groups.find(E=>E.enabled)||(b.groups[0].enabled=!0),b}handleOgcFiltersAppliedValue(w,b,E,T){const a=w.ogcFilters;if(!a)return;const K=[];let M="",L="";if(a.enabled&&(a.pushButtons||a.checkboxes||a.radioButtons||a.select||a.autocomplete)){let N;if(a.pushButtons){N=a.pushButtons;const B=this.formatGroupAndFilter(a,N);for(const X of B)K.push(X)}if(a.checkboxes){N=a.checkboxes;const B=this.formatGroupAndFilter(a,N);for(const X of B)K.push(X)}if(a.radioButtons){N=a.radioButtons;const B=this.verifyMultipleEnableds(N),X=this.formatGroupAndFilter(a,B);for(const V of X)K.push(V)}if(a.select){N=a.select;const B=this.verifyMultipleEnableds(N),X=this.formatGroupAndFilter(a,B);for(const V of X)K.push(V)}if(a.autocomplete){N=a.autocomplete;const B=this.formatGroupAndFilter(a,N);for(const X of B)K.push(X)}K.length>=1&&(M=this.buildFilter(1===K.length?K[0]:{logical:"And",filters:K},E,T,a.geometryName))}a.enabled&&a.filters&&(a.geometryName=a.geometryName||b,L=this.buildFilter(a.filters,E,T,a.geometryName,w));let oe=a.advancedOgcFilters?L:M;return"wms"===w.type&&(oe=this.formatProcessedOgcFilter(oe,w.params.LAYERS)),"wfs"===w.type&&(oe=this.formatProcessedOgcFilter(oe,w.params.featureTypes)),oe}verifyMultipleEnableds(w){return w.bundles.forEach(b=>{if(!b.multiple&&b.selectors){const E=b.selectors.reduce((T,a,K)=>!0===a.enabled?T.concat(K):T,[]);E.length>1&&(E.splice(0,1),E.forEach(T=>{b.selectors[T].enabled=!1}))}}),w}formatGroupAndFilter(w,b){const E=(b=this.computeIgoSelector(b)).groups.find(a=>a.enabled).computedSelectors,T=[];return E.map(a=>{const K=[],M=a.selectors;M&&(M.filter(L=>!0===L.enabled).forEach(L=>K.push(L.filters)),1===K.length?T.push(K[0]):K.length>1&&T.push({logical:a.logical,filters:K}))}),"pushButton"===b.selectorType?w.pushButtons=b:"checkbox"===b.selectorType?w.checkboxes=b:"radioButton"===b.selectorType?w.radioButtons=b:"select"===b.selectorType?w.select=b:"autocomplete"===b.selectorType&&(w.autocomplete=b),T}formatProcessedOgcFilter(w,b){if(!w)return;let E="";return 0===w.length&&-1===b.indexOf(",")?E=w:b.split(",").forEach(a=>{E=`${E}(${w.replace("filter=","")})`}),E=E.replace(/\(\)/g,""),E.length>0?E.replace("filter=",""):void 0}parseFilterOptionDate(w,b){return w?"today"===w?void 0:o()(w).isValid()?w:void 0:b}}},14191:(Ee,ce,s)=>{"use strict";s.d(ce,{D:()=>e,U:()=>y});var y=function(d){return d.DATE="date",d.TIME="time",d.DATETIME="datetime",d.YEAR="year",d}(y||{}),e=function(d){return d.CALENDAR="calendar",d.SLIDER="slider",d}(e||{})},17115:(Ee,ce,s)=>{"use strict";s.d(ce,{i:()=>E});var y=s(83552),e=s(96764),d=s(32736),g=s(99376),R=s(25696),o=s(53156),h=s(28772),j=s(61616),x=s(54844),w=s(93244),b=s(36124);class E{options;start$=new j.E;end$=new j.E;changes$=new j.E;modify$=new j.E;select$=new j.E;abort$=new j.E;freehand$=new x.g(!1);ispredefinedRadius$=new x.g(!1);predefinedRadius$=new x.g(void 0);radiusDrawEnd$=new x.g(void 0);keyDown$$;olGeometryType;olInteractionStyle;olMap;olDrawingLayer;olDrawInteraction;olSelectInteraction;olModifyInteraction;onDrawStartKey;onDrawEndKey;onDrawAbortKey;onDrawKey;radius;mousePosition;get radiusVal(){return this.predefinedRadius$.getValue()}set radiusValData(a){this.predefinedRadius$.next(a)}get active(){return void 0!==this.olMap}get olDrawingLayerSource(){return this.olDrawingLayer.getSource()}constructor(a){this.options=a,this.olDrawingLayer=a.drawingLayer?a.drawingLayer:this.createOlInnerOverlayLayer(),this.olGeometryType=this.options.geometryType,this.olInteractionStyle=this.options.interactionStyle}setOlMap(a,K){if(!a)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlInteractions(),void(this.olMap=a);this.olMap=a,this.addOlInnerOverlayLayer(),this.addOlInteractions(K)}getSource(){return this.olDrawingLayerSource}setOlInteractionStyle(a){this.olInteractionStyle=a}setGeometryType(a){this.olGeometryType=a}getGeometryType(){return this.olGeometryType}createOlInnerOverlayLayer(){return new o.c({source:this.options.drawingLayerSource?this.options.drawingLayerSource:new h.c,style:this.options.drawingLayerStyle,zIndex:500})}removeOlInnerOverlayLayer(){!this.options.drawingLayer&&this.olMap&&this.olMap.removeLayer(this.olDrawingLayer)}addOlInnerOverlayLayer(){this.options.drawingLayer||this.olMap.addLayer(this.olDrawingLayer)}clearOlInnerOverlaySource(){!this.options.drawingLayer&&!this.options.drawingLayerSource&&this.olDrawingLayerSource.clear(!0)}addOlInteractions(a){let K;if(K=this.freehand$.getValue()?new d.cp("Point"===this.olGeometryType?{type:"Circle",source:this.getSource(),style:"function"==typeof this.olInteractionStyle?void 0:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!0}:{type:this.olGeometryType,source:this.getSource(),style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!0}):this.ispredefinedRadius$.getValue()?new d.cp({type:"Point",source:this.getSource(),stopClick:!0,style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:()=>!1}):new d.cp({type:this.olGeometryType,source:this.getSource(),stopClick:!0,style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:()=>!1}),this.olMap.addInteraction(K),this.olDrawInteraction=K,this.onDrawStartKey=K.on("drawstart",M=>this.onDrawStart(M)),this.onDrawEndKey=K.on("drawend",M=>this.onDrawEnd(M)),this.onDrawAbortKey=K.on("drawabort",M=>this.abort$.next(M.feature.getGeometry())),a){const M=new g.c({source:this.getSource()});if(this.olMap.addInteraction(M),this.olModifyInteraction=M,!this.olSelectInteraction){const L=new R.c({condition:e.q0,style:void 0});this.olMap.addInteraction(L),this.olSelectInteraction=L,this.olSelectInteraction.on("select",oe=>this.onSelect(oe))}}}removeOlInteractions(){this.unsubscribeKeyDown(),(0,y.S)([this.onDrawStartKey,this.onDrawEndKey,this.onDrawKey,this.onDrawAbortKey]),this.olMap&&(this.olMap.removeInteraction(this.olDrawInteraction),this.olMap.removeInteraction(this.olModifyInteraction)),this.olDrawInteraction=void 0,this.olModifyInteraction=void 0}onDrawStart(a){const K=a.feature.getGeometry();this.start$.next(K),this.clearOlInnerOverlaySource(),this.onDrawKey=K.on("change",M=>{this.mousePosition=(0,b.y6)(M),this.changes$.next(M.target)}),this.subscribeKeyDown()}onDrawEnd(a){"Point"===a.feature.getGeometry().getType()&&this.radiusDrawEnd$.next(this.predefinedRadius$.getValue()),this.unsubscribeKeyDown(),(0,y.S)(this.onDrawKey);const K=a.feature.getGeometry();K.on("change",()=>{this.modify$.next(K)}),this.end$.next(K)}onSelect(a){1===a.selected.length&&this.select$.next(a.selected[0])}subscribeKeyDown(){this.unsubscribeKeyDown(),this.keyDown$$=(0,w.w)(document,"keydown").subscribe(a=>{"Escape"!==a.key?("Backspace"===a.key&&this.olDrawInteraction.removeLastPoint(),"Enter"===a.key&&this.olDrawInteraction.finishDrawing()," "!==a.key||this.olMap.getView().animate({center:this.mousePosition,duration:100})):this.olDrawInteraction.abortDrawing()})}unsubscribeKeyDown(){this.keyDown$$&&(this.keyDown$$.unsubscribe(),this.keyDown$$=void 0)}}},48908:(Ee,ce,s)=>{"use strict";s.d(ce,{i4:()=>y.i,Up:()=>K});var y=s(17115),e=s(58264),d=s(83552),g=s(12760),R=s(36752),o=s(56224),h=s(32736),j=s(99376),x=s(98492),w=s(53156),b=s(28772),E=s(61616),T=s(93244),a=s(36124);class K{options;start$=new E.E;end$=new E.E;changes$=new E.E;olMap;olOverlayLayer;olModifyInteraction;onModifyStartKey;onModifyEndKey;onModifyKey;olModifyInteractionIsActive=!1;olTranslateInteraction;onTranslateStartKey;onTranslateEndKey;onTranslateKey;olTranslateInteractionIsActive=!1;olDrawInteraction;onDrawStartKey;onDrawEndKey;onDrawKey;olDrawInteractionIsActive=!1;mousePosition;keyDown$$;drawKeyUp$$;drawKeyDown$$;removedOlInteractions=[];olLinearRingsLayer;olOuterGeometry;get active(){return void 0!==this.olMap}get olOverlaySource(){return this.olOverlayLayer.getSource()}get olLinearRingsSource(){return this.olLinearRingsLayer.getSource()}modify=!0;translate=!0;constructor(N){this.options=N,void 0!==N.modify&&(this.modify=N.modify),void 0!==N.translate&&(this.translate=N.translate),this.olOverlayLayer=void 0!==N.layer?N.layer:this.createOlInnerOverlayLayer(),this.olLinearRingsLayer=this.createOlLinearRingsLayer()}setOlMap(N){if(void 0===N)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlModifyInteraction(),this.removeOlTranslateInteraction(),this.removeOlDrawInteraction(),void(this.olMap=N);this.olMap=N,this.addOlInnerOverlayLayer(),!0===this.modify&&this.addOlDrawInteraction(),!0===this.translate&&(this.addOlTranslateInteraction(),this.activateTranslateInteraction()),!0===this.modify&&(this.addOlModifyInteraction(),this.activateModifyInteraction())}getSource(){return this.olOverlaySource}setOlGeometry(N){const B=new e.c({geometry:N});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(B)}createOlInnerOverlayLayer(){return new w.c({source:this.options.source?this.options.source:new b.c,style:this.options.layerStyle,zIndex:500})}addOlInnerOverlayLayer(){void 0===this.options.layer&&this.olMap.addLayer(this.olOverlayLayer)}removeOlInnerOverlayLayer(){void 0===this.options.layer&&void 0!==this.olMap&&this.olMap.removeLayer(this.olOverlayLayer)}clearOlInnerOverlaySource(){void 0===this.options.layer&&void 0===this.options.source&&this.olOverlaySource.clear(!0)}createOlLinearRingsLayer(){return new w.c({source:new b.c,style:(0,a.cb)(),zIndex:500})}addOlLinearRingsLayer(){this.olMap.addLayer(this.olLinearRingsLayer)}removeOlLinearRingsLayer(){this.olMap.removeLayer(this.olLinearRingsLayer)}clearOlLinearRingsSource(){this.olLinearRingsSource.clear(!0)}addOlModifyInteraction(){const N=new j.c({source:this.olOverlaySource,style:this.options.drawStyle});this.olModifyInteraction=N}removeOlModifyInteraction(){void 0!==this.olModifyInteraction&&(this.deactivateModifyInteraction(),this.olModifyInteraction=void 0)}activateModifyInteraction(){!0!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!0,this.onModifyStartKey=this.olModifyInteraction.on("modifystart",N=>this.onModifyStart(N)),this.onModifyEndKey=this.olModifyInteraction.on("modifyend",N=>this.onModifyEnd(N)),this.olMap.addInteraction(this.olModifyInteraction))}deactivateModifyInteraction(){!1!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!1,(0,d.S)([this.onModifyStartKey,this.onModifyEndKey,this.onModifyKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olModifyInteraction))}onModifyStart(N){const B=N.features.item(0).getGeometry();this.start$.next(B),this.onModifyKey=B.on("change",X=>{this.mousePosition=(0,a.y6)(X),this.changes$.next(X.target)}),this.subscribeToKeyDown()}onModifyEnd(N){(0,d.S)(this.onModifyKey),this.end$.next(N.features.item(0).getGeometry()),this.unsubscribeToKeyDown()}subscribeToKeyDown(){this.keyDown$$=(0,T.w)(document,"keydown").subscribe(N=>{" "!==N.key||this.olMap.getView().animate({center:this.mousePosition,duration:0})})}unsubscribeToKeyDown(){void 0!==this.keyDown$$&&this.keyDown$$.unsubscribe()}addOlTranslateInteraction(){const N=new x.c({layers:[this.olOverlayLayer]});this.olTranslateInteraction=N}removeOlTranslateInteraction(){void 0!==this.olTranslateInteraction&&(this.deactivateTranslateInteraction(),this.olTranslateInteraction=void 0)}activateTranslateInteraction(){!0!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!0,this.onTranslateStartKey=this.olTranslateInteraction.on("translatestart",N=>this.onTranslateStart(N)),this.onTranslateEndKey=this.olTranslateInteraction.on("translateend",N=>this.onTranslateEnd(N)),this.olMap.addInteraction(this.olTranslateInteraction))}deactivateTranslateInteraction(){!1!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!1,(0,d.S)([this.onTranslateStartKey,this.onTranslateEndKey,this.onTranslateKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olTranslateInteraction))}onTranslateStart(N){const B=N.features.item(0).getGeometry();this.start$.next(B),this.onTranslateKey=B.on("change",X=>{})}onTranslateEnd(N){(0,d.S)(this.onTranslateKey),this.end$.next(N.features.item(0).getGeometry())}addOlDrawInteraction(){const N=new h.cp({type:"Polygon",source:this.olLinearRingsSource,stopClick:!0,style:(0,a.cb)(),condition:B=>(this.olOuterGeometry||this.getOlGeometry()).intersectsCoordinate(B.coordinate)});this.olDrawInteraction=N,this.subscribeToDrawKeyDown()}subscribeToDrawKeyDown(){this.drawKeyDown$$=(0,T.w)(document,"keydown").subscribe(N=>{if("Control"!==N.key)return;this.unsubscribeToDrawKeyDown();const B=this.getOlGeometry();!B||!(B instanceof R.cp)||(this.subscribeToDrawKeyUp(),this.deactivateModifyInteraction(),this.deactivateTranslateInteraction(),this.activateDrawInteraction())})}subscribeToDrawKeyUp(){this.drawKeyUp$$=(0,T.w)(document,"keyup").subscribe(N=>{"Control"===N.key&&(this.unsubscribeToDrawKeyUp(),this.unsubscribeToKeyDown(),this.deactivateDrawInteraction(),this.activateModifyInteraction(),!0===this.translate&&this.activateTranslateInteraction(),this.subscribeToDrawKeyDown(),this.olOuterGeometry=void 0,this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()))})}unsubscribeToDrawKeyDown(){void 0!==this.drawKeyDown$$&&this.drawKeyDown$$.unsubscribe()}unsubscribeToDrawKeyUp(){void 0!==this.drawKeyUp$$&&this.drawKeyUp$$.unsubscribe()}removeOlDrawInteraction(){void 0!==this.olDrawInteraction&&(this.unsubscribeToKeyDown(),this.unsubscribeToDrawKeyUp(),this.unsubscribeToDrawKeyDown(),this.deactivateDrawInteraction(),this.clearOlLinearRingsSource(),this.olDrawInteraction=void 0)}activateDrawInteraction(){!0!==this.olDrawInteractionIsActive&&(this.clearOlLinearRingsSource(),this.addOlLinearRingsLayer(),this.olMap.getInteractions().forEach(N=>{N instanceof o.c&&(this.olMap.removeInteraction(N),this.removedOlInteractions.push(N))}),this.olDrawInteractionIsActive=!0,this.onDrawStartKey=this.olDrawInteraction.on("drawstart",N=>this.onDrawStart(N)),this.onDrawEndKey=this.olDrawInteraction.on("drawend",N=>this.onDrawEnd(N)),this.olMap.addInteraction(this.olDrawInteraction))}deactivateDrawInteraction(){!1!==this.olDrawInteractionIsActive&&(this.removeOlLinearRingsLayer(),this.removedOlInteractions.forEach(N=>{this.olMap.addInteraction(N)}),this.removedOlInteractions=[],this.olDrawInteractionIsActive=!1,(0,d.S)([this.onDrawStartKey,this.onDrawEndKey,this.onDrawKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olDrawInteraction))}onDrawStart(N){const B=N.feature.getGeometry();this.olOuterGeometry=this.getOlGeometry().clone();const X=B.getLinearRing().getCoordinates();this.addLinearRingToOlGeometry(X),this.start$.next(this.getOlGeometry()),this.onDrawKey=B.on("change",V=>{this.mousePosition=(0,a.y6)(V);const W=V.target.getLinearRing(0).getCoordinates();this.updateLinearRingOfOlGeometry(W),this.changes$.next(this.getOlGeometry())}),this.subscribeToKeyDown()}onDrawEnd(N){(0,d.S)(this.onDrawKey),this.olOuterGeometry=void 0;const B=N.feature.getGeometry().getLinearRing().getCoordinates();this.updateLinearRingOfOlGeometry(B),this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()),this.unsubscribeToKeyDown()}addLinearRingToOlGeometry(N){const B=this.getOlGeometry(),X=new g.c(N);(0,a.wv)(B,X)}updateLinearRingOfOlGeometry(N){const B=this.getOlGeometry(),V=B.getLinearRings().slice(0,-1).map(z=>z.getCoordinates());V.push(N),B.setCoordinates(V)}getOlGeometry(){const N=this.olOverlaySource.getFeatures();return N.length>0?N[0].getGeometry():void 0}}s(52836)},52836:(Ee,ce,s)=>{"use strict";Error},36124:(Ee,ce,s)=>{"use strict";s.d(ce,{cb:()=>w,gD:()=>x,wv:()=>a,y6:()=>K});var y=s(36752),e=s(87544),d=s(45212),g=s(88872),R=s(54776);function x(M){return new e.c({stroke:new d.c({color:(M=M||[0,153,255]).concat([1]),width:2}),fill:new g.c({color:M.concat([.2])}),radius:8})}function w(){return new R.cp({stroke:new d.c({color:[0,153,255,1],width:2})})}function a(M,L){M.appendLinearRing(L)}function K(M){const L=M.target;return L instanceof y.cp?L.getFlatCoordinates().slice(-4,-2):L.getFlatCoordinates().slice(-2)}s(72855),s(11432),s(52836)},41912:(Ee,ce,s)=>{"use strict";s.d(ce,{Up:()=>d.Up,i4:()=>d.i4}),s(52836),s(36124);var d=s(48908)},99228:(Ee,ce,s)=>{"use strict";s.d(ce,{IZ:()=>y.I,Md:()=>e.Md,aG:()=>e.aG,wL:()=>e.wL});var y=s(7036),e=s(56708)},8492:(Ee,ce,s)=>{"use strict";s.d(ce,{i:()=>y});const y="Layer"},7036:(Ee,ce,s)=>{"use strict";s.d(ce,{I:()=>W});var y=s(21724),e=s(93020),d=s(64002),g=s(54776),R=s(80372),o=s(21296),h=s(1296),j=s(35876),x=s(40604),w=s(51672),b=s(10211),E=s(61200),T=s(3544),a=s(39532),K=s(82048);function M(A){const q=A;return"mvt"===q.sourceOptions?.type&&(q.igoStyle?.styleByAttribute?.hoverStyle||q.igoStyle?.hoverStyle)&&(q.sourceOptions.featureClass=q.sourceOptions.featureClass||"feature"),A}var L=s(56708),oe=s(34896),N=s(33712),B=s(61616),X=s(83680),V=s(96832);let z=(()=>{class A{ngxIndexedDBService;dbName="layerData";constructor(_){this.ngxIndexedDBService=_}update(_){const u=new B.E;return this.ngxIndexedDBService.getByID(this.dbName,_.layerId).pipe((0,X.K)(),(0,b.m)(S=>S?this.customUpdate(_):this.ngxIndexedDBService.add(this.dbName,_))).subscribe(S=>{u.next(S),u.complete()}),u}customUpdate(_){const u=new B.E;return this.ngxIndexedDBService.deleteByKey(this.dbName,_.layerId).pipe((0,b.m)(P=>P?this.ngxIndexedDBService.add(this.dbName,_):(0,h.of)(void 0))).subscribe(P=>{P&&u.next(P),u.complete()}),u}getByID(_){return this.ngxIndexedDBService.getByID(this.dbName,_)}deleteByKey(_){return this.ngxIndexedDBService.deleteByKey(this.dbName,_)}getAll(){return this.ngxIndexedDBService.getAll(this.dbName)}static \u0275fac=function(u){return new(u||A)(oe.CoB(V.aQ))};static \u0275prov=oe.wxM({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})(),W=(()=>{class A{http;styleService;dataSourceService;geoNetworkService;messageService;layerDBService;authInterceptor;constructor(_,u,S,P,I,U,G){this.http=_,this.styleService=u,this.dataSourceService=S,this.geoNetworkService=P,this.messageService=I,this.layerDBService=U,this.authInterceptor=G}createLayer(_){if(!_.source)return;let u;switch(_.source.options&&_.source.options._layerOptionsFromSource&&(_=d.Yv.mergeDeep(_.source.options._layerOptionsFromSource,_||{})),_.source.constructor){case T.yC:case T.m6:case T.nA:case T.Uv:case T.aI:case T.W4:u=this.createTileLayer(_);break;case T.EB:case T.ak:case T.IH:case T.cR:case T.a:u=this.createVectorLayer(_);break;case T.yA:case T.CK:u=this.createImageLayer(_);break;case T.cv:const S=M(_);u=this.createVectorTileLayer(S)}return u}createAsyncLayer(_,u){const S=M(_);return S.source?new o._(P=>P.next(this.createLayer(S))):this.dataSourceService.createAsyncDataSource(S.sourceOptions,u).pipe((0,x.k)(P=>{if(void 0!==P)return this.createLayer(Object.assign(S,{source:P}))}))}createImageLayer(_){return new L.Iw(_,this.messageService,this.authInterceptor)}createTileLayer(_){return new L.t9(_,this.messageService,this.authInterceptor)}createVectorLayer(_){let S,u=_.style;if(_.igoStyle||(_.igoStyle={}),this.handleLegacyStyles(_,["styleByAttribute","hoverStyle","mapboxStyle","clusterBaseStyle","style"]),_.igoStyle.igoStyleObject&&!_.idbInfo?.storeToIdb?u=(U,G)=>this.styleService.createStyle(_.igoStyle.igoStyleObject,U,G):_.igoStyle.igoStyleObject&&_.idbInfo?.storeToIdb&&(u=this.styleService.parseStyle("style",_.igoStyle.igoStyleObject)),_.source instanceof T.IH)u=_.source.options.params.style;else if(_.igoStyle?.styleByAttribute){const U=this.styleService;_.style=(G,O)=>U.createStyleByAttribute(G,_.igoStyle.styleByAttribute,O),S=new L.Md(_,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)}if(_.source instanceof T.a){const U=this.styleService,G=_.igoStyle.clusterBaseStyle;_.style=(O,F)=>U.createClusterStyle(O,F,_.clusterParam,G),S=new L.Md(_,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)}const I=Object.assign({},_,{style:u});return S||(S=new L.Md(I,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)),this.applyMapboxStyle(S,I),S}handleLegacyStyles(_,u){u.map(S=>{if(_[S]){let P=S;if("style"===S){if(_[S]instanceof g.cp)return;if("object"!=typeof _[S])return;P="igoStyleObject"}_.igoStyle[P]=_[S],delete _[S],console.warn(`\n        The location of this style option (${S}) is deprecated.\n        Please move this property within igoStyle property.\n        Ex: ${S}: {...} must be transfered to igoStyle: { ${P}: {...} }\n        This legacy conversion will be deleted in 2024.\n        `)}})}createVectorTileLayer(_){let u,S;if(_.igoStyle||(_.igoStyle={}),this.handleLegacyStyles(_,["styleByAttribute","hoverStyle","mapboxStyle","style"]),_.igoStyle.igoStyleObject&&(u=(U,G)=>this.styleService.createStyle(_.igoStyle.igoStyleObject,U,G)),_.igoStyle.styleByAttribute){const U=this.styleService;_.style=(G,O)=>U.createStyleByAttribute(G,_.igoStyle.styleByAttribute,O),S=new L.qR(_,this.messageService,this.authInterceptor)}const I=Object.assign({},_,{style:u});return S||(S=new L.qR(I,this.messageService,this.authInterceptor)),this.applyMapboxStyle(S,I),S}applyMapboxStyle(_,u){u.igoStyle?.mapboxStyle&&this.getStuff(u.igoStyle.mapboxStyle.url).subscribe(S=>{if(S.sprite){const P=this.getAbsoluteUrl(u.igoStyle.mapboxStyle.url,S.sprite);this.getStuff(P+".json").subscribe(I=>{(0,R.M7)(_.ol,S,u.igoStyle.mapboxStyle.source,void 0,I,P+".png")})}else(0,R.M7)(_.ol,S,u.igoStyle.mapboxStyle.source)})}getStuff(_){return this.http.get(_).pipe((0,x.k)(u=>u),(0,w.a)(u=>(console.log("No style was found"),(0,h.of)(u))))}getAbsoluteUrl(_,u){return new RegExp("^http|//","i").test(u)?u:"/"===_.substr(_.length-1)?_+u:_+"/"+u}createAsyncIdbLayers(_="*"){return this.layerDBService.getAll().pipe((0,b.m)(u=>{const P=("*"!==_?u.filter(I=>I.detailedContextUri===_):u).map(I=>Object.assign({},I.layerOptions,{sourceOptions:I.sourceOptions}));return(0,j.E)(P.map(I=>this.createAsyncLayer(I)))}))}static \u0275fac=function(u){return new(u||A)(oe.CoB(N.KK),oe.CoB(K.U),oe.CoB(E.O),oe.CoB(a.U),oe.CoB(e.mi),oe.CoB(z),oe.CoB(y.kT,8))};static \u0275prov=oe.wxM({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})()},56708:(Ee,ce,s)=>{"use strict";s.d(ce,{Iw:()=>R,aG:()=>e.a,t9:()=>j,wL:()=>e.w,Md:()=>x.M,qR:()=>b});var y=s(55792),e=s(68252),d=s(87816),g=s(29632);class R extends y.a{messageService;authInterceptor;watcher;constructor(T,a,K){super(T,a,K),this.messageService=a,this.authInterceptor=K,this.watcher=new g.s(this,this.messageService),this.status$=this.watcher.status$,this.status$.subscribe(M=>{0===M&&(this.olLoadingProblem=!0)})}createOlLayer(){const T=Object.assign({},this.options,{source:this.options.source.ol}),a=new d.c(T);return this.authInterceptor&&a.getSource().setImageLoadFunction((K,M)=>{this.customLoader(K,M,this.authInterceptor,this.messageService)}),a}setMap(T){void 0===T?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(T)}customLoader(T,a,K,M){const L=new XMLHttpRequest,oe=K.alterUrlWithKeyAuth(a);let N=a;if(oe&&(N=oe),L.open("GET",N),!K.interceptXhr(L,N))return L.abort(),void(T.getImage().src=N);L.responseType="arraybuffer",L.onload=function(){const X=new Uint8Array(this.response);(new TextDecoder).decode(X).includes("ServiceExceptionReport")&&M.error("igo.geo.dataSource.optionsApiUnavailable","igo.geo.dataSource.unavailableTitle");const z=new Blob([X],{type:"image/png"}),A=window.URL.createObjectURL(z);T.getImage().src=A},L.send()}}var o=s(24124),h=s(48004);class j extends y.a{messageService;authInterceptor;watcher;constructor(T,a,K){super(T,a),this.messageService=a,this.authInterceptor=K,this.watcher=new h.e(this),this.status$=this.watcher.status$}createOlLayer(){const T=Object.assign({},this.options,{source:this.options.source.ol}),a=new o.c(T);return a.getSource().setTileLoadFunction((M,L)=>{this.customLoader(M,L,this.authInterceptor)}),a}customLoader(T,a,K){const M=K.alterUrlWithKeyAuth(a);let L=a;M&&(L=M),T.getImage().src=L}setMap(T){void 0===T?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(T)}}var x=s(2892),w=s(28184);class b extends y.a{messageService;authInterceptor;watcher;constructor(T,a,K){super(T,a,K),this.messageService=a,this.authInterceptor=K,this.watcher=new h.e(this),this.status$=this.watcher.status$}createOlLayer(){const T=Object.assign({},this.options,{source:this.options.source.ol}),a=new w.c(T);return a.getSource().setTileLoadFunction((M,L)=>{const oe=this.customLoader(L,M.getFormat(),this.authInterceptor,M.onLoad.bind(M));oe&&M.setLoader(oe)}),a}customLoader(T,a,K,M,L){return(oe,N,B)=>{const X=new XMLHttpRequest;let V=T;if("function"!=typeof T){const z=K.alterUrlWithKeyAuth(T);z&&(V=z)}else V=T(oe,N,B);X.open("GET",V),K&&K.interceptXhr(X,V),"arraybuffer"===a.getType()&&(X.responseType="arraybuffer"),X.onload=z=>{if(!X.status||X.status>=200&&X.status<300){const W=a.getType();let A;"json"===W||"text"===W?A=X.responseText:"xml"===W?(A=X.responseXML,A||(A=(new DOMParser).parseFromString(X.responseText,"application/xml"))):"arraybuffer"===W&&(A=X.response),A?M.call(this,a.readFeatures(A,{extent:oe,featureProjection:B}),a.readProjection(A)):L.call(this)}else L.call(this)},X.onerror=()=>{L.call(this)},X.send()}}setMap(T){void 0===T?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(T)}}},68252:(Ee,ce,s)=>{"use strict";s.d(ce,{a:()=>y,w:()=>e});var y=function(d){return d.OPACITY="opacity",d.VISIBLE="visible",d.OGCFILTERS="ogcFilters",d.MINRESOLUTION="minResolution",d.MAXRESOLUTION="maxResolution",d.ZINDEX="zIndex",d.TIMEFILTER="timeFilter",d}(y||{}),e=function(d){return d.TITLE="title",d.ABSTRACT="abstract",d.CUSTOM="custom",d}(e||{})},55792:(Ee,ce,s)=>{"use strict";s.d(ce,{a:()=>R});var y=s(54844),e=s(35876),d=s(40604),g=s(59324);class R{options;messageService;authInterceptor;geoDBService;layerDBService;collapsed;dataSource;legend;legendCollapsed=!0;firstLoadComponent=!0;map;ol;olLoadingProblem=!1;status$;hasBeenVisible$=new y.g(void 0);hasBeenVisible$$;resolution$$;get isIgoInternalLayer(){return this.options.isIgoInternalLayer||!1}get id(){return this.options.id||this.dataSource.id}get alias(){return this.options.alias}get title(){return this.options.title}set title(h){this.options.title=h}get zIndex(){return this.ol.getZIndex()}set zIndex(h){this.ol.setZIndex(h)}get baseLayer(){return this.options.baseLayer}set baseLayer(h){this.options.baseLayer=h}get opacity(){return this.ol.get("opacity")}set opacity(h){this.ol.setOpacity(h)}set isInResolutionsRange(h){this.isInResolutionsRange$.next(h)}get isInResolutionsRange(){return this.isInResolutionsRange$.value}isInResolutionsRange$=new y.g(!1);set maxResolution(h){this.ol.setMaxResolution(0===h?0:h||1/0),this.updateInResolutionsRange()}get maxResolution(){return this.ol.getMaxResolution()}set minResolution(h){this.ol.setMinResolution(h||0),this.updateInResolutionsRange()}get minResolution(){return this.ol.getMinResolution()}set visible(h){this.ol.setVisible(h),this.visible$.next(h),!this.hasBeenVisible$.value&&h&&this.hasBeenVisible$.next(h),this.options?.messages&&h&&this.options?.messages.filter(j=>j.options?.showOnEachLayerVisibility).map(j=>this.showMessage(j))}get visible(){return this.visible$.value}visible$=new y.g(void 0);get displayed(){return this.visible&&this.isInResolutionsRange}displayed$=(0,e.E)([this.isInResolutionsRange$,this.visible$]).pipe((0,d.k)(h=>h[0]&&h[1]));get showInLayerList(){return!1!==this.options.showInLayerList}constructor(h,j,x,w,b){this.options=h,this.messageService=j,this.authInterceptor=x,this.geoDBService=w,this.layerDBService=b,this.dataSource=h.source,this.ol=this.createOlLayer(),void 0!==h.zIndex&&(this.zIndex=h.zIndex),h.baseLayer&&void 0===h.visible&&(h.visible=!1),this.maxResolution=h.maxResolution||(0,g.bg)(Number(h.maxScaleDenom)),this.minResolution=h.minResolution||(0,g.bg)(Number(h.minScaleDenom)),this.visible=void 0===h.visible||h.visible,this.opacity=void 0===h.opacity?1:h.opacity,h.legendOptions&&(h.legendOptions.url||h.legendOptions.html)&&(this.legend=this.dataSource.setLegend(h.legendOptions)),this.legendCollapsed=!h.legendOptions||!h.legendOptions.collapsed||h.legendOptions.collapsed,this.ol.set("_layer",this,!0)}setMap(h){this.map=h,this.unobserveResolution(),void 0!==h&&(this.observeResolution(),this.hasBeenVisible$$=this.hasBeenVisible$.subscribe(()=>{this.options.messages&&this.visible&&this.options.messages.map(j=>{this.showMessage(j)})}))}showMessage(h){this.messageService&&(h.title=h.title,h.text=h.text,this.messageService.message(h))}observeResolution(){this.resolution$$=this.map.viewController.resolution$.subscribe(()=>this.updateInResolutionsRange())}unobserveResolution(){void 0!==this.resolution$$&&(this.resolution$$.unsubscribe(),this.resolution$$=void 0)}updateInResolutionsRange(){if(void 0!==this.map){const h=this.map.viewController.getResolution();this.isInResolutionsRange=h>=this.minResolution&&h<=(void 0===this.maxResolution?1/0:this.maxResolution)}else this.isInResolutionsRange=!1}}},2892:(Ee,ce,s)=>{"use strict";s.d(ce,{M:()=>A});var y=s(64002),e=s(83552),d=s(99980),g=s(44876),R=s(12396),o=s(53156),h=s(61252),j=s(54760),x=s(2500),w=s(93244),b=s(3360),E=s(1296),T=s(24112),a=s(2924),K=s(10211),M=s(83680),L=s(51672),oe=s(67732),N=s(38084),B=s(51512),X=s(96659),z=s(84052),W=s(55792);class A extends W.a{messageService;authInterceptor;geoNetworkService;geoDBService;layerDBService;previousLoadExtent;previousLoadResolution;previousOgcFilters;xhrAccumulator=[];watcher;trackFeatureListenerId;get browsable(){return!1!==this.options.browsable}get exportable(){return!1!==this.options.exportable}constructor(_,u,S,P,I,U){super(_,u,S,I,U),this.messageService=u,this.authInterceptor=S,this.geoNetworkService=P,this.geoDBService=I,this.layerDBService=U,this.watcher=new z.w(this),this.status$=this.watcher.status$}createOlLayer(){const _=this.options.opacity||1,u=!1!==this.options.visible,S=this.options.minResolution||(0,B.bg)(Number(this.options.minScaleDenom)),P=this.options.maxResolution||(0,B.bg)(Number(this.options.maxScaleDenom)),I=this.options.sourceOptions;this.dataSource instanceof oe.E&&(I?.preload?.bypassResolution||I?.preload?.bypassVisible)&&(this.options.opacity=0,I.preload.bypassResolution&&(this.options.minResolution||this.options.maxResolution)&&(this.options.minResolution=0,this.options.maxResolution=1/0),I.preload.bypassVisible&&!u&&(this.options.visible=!0));const U=Object.assign({},this.options,{source:this.options.source.ol,sourceOptions:this.options.sourceOptions||this.options.source.options});this.options.animation&&this.dataSource.ol.on("addfeature",function(Q){this.flash(Q.feature)}.bind(this)),this.options.idbInfo?.storeToIdb&&this.geoDBService&&(this.options.idbInfo.firstLoad&&this.maintainFeaturesInIdb(),this.dataSource.ol.once("featuresloadend",()=>{this.dataSource.ol.on("addfeature",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("changefeature",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("clear",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("removefeature",()=>this.maintainFeaturesInIdb())})),this.dataSource instanceof oe.E&&(I?.preload?.bypassResolution||I?.preload?.bypassVisible)&&this.dataSource.ol.once("featuresloadend",()=>{_&&(this.opacity=_),I.preload.bypassResolution&&(this.minResolution=S,this.maxResolution=P),I.preload.bypassVisible&&(this.visible=u)}),this.options.trackFeature&&this.enableTrackFeature(this.options.trackFeature);const G=new o.c(U),O=G.getSource(),F=O.getUrl();if("function"==typeof F)return G;if(F||"wfs"===U.sourceOptions?.type){let Q;const r=U.sourceOptions;Q="wfs"===r?.type&&(r.params||r.paramsWFS)?(ie,ae,fe,le,ue)=>{this.customWFSLoader(O,r,this.authInterceptor,ie,ae,fe,le,ue)}:(ie,ae,fe,le,ue)=>{this.customLoader(O,F,this.authInterceptor,ie,ae,fe,le,ue)},Q&&O.setLoader(Q)}else if(this.options.idbInfo?.storeToIdb&&this.geoDBService){const Q=(r,ie,ae,fe,le)=>{this.customIDBLoader(O,U.id,r,ae,fe,le)};Q&&O.setLoader(Q)}return this.options.idbInfo?.storeToIdb&&this.geoDBService&&G.once("sourceready",()=>{this.options.idbInfo.firstLoad&&this.maintainOptionsInIdb(),(0,w.w)(G,"change").pipe((0,T.o)(750)).subscribe(()=>this.maintainOptionsInIdb()),G.on("change:zIndex",()=>this.maintainOptionsInIdb())}),G}removeLayerFromIDB(){this.geoDBService&&this.layerDBService&&(0,b.E)(this.geoDBService.deleteByKey(this.id),this.layerDBService.deleteByKey(this.id)).subscribe()}maintainOptionsInIdb(){this.options.igoStyle.igoStyleObject=function V(q){const _=q.getStyle();return"function"==typeof _||_ instanceof Array?void 0:{fill:{color:_.getFill().getColor()},stroke:{color:_.getStroke().getColor(),width:2},circle:{fill:{color:_.getImage().getFill().getColor()},stroke:{color:_.getImage().getStroke().getColor(),width:2},radius:5}}}(this.ol);const _=y.Yv.removeUndefined({layerId:this.id,detailedContextUri:this.options.idbInfo.contextUri,sourceOptions:{id:this.id,type:"vector",queryable:!0},layerOptions:{workspace:this.options.workspace,zIndex:this.ol?this.zIndex:1e6,id:this.id,isIgoInternalLayer:this.isIgoInternalLayer,title:this.title,igoStyle:this.options.igoStyle,idbInfo:Object.assign({},this.options.idbInfo,{firstLoad:!1})},insertEvent:`${this.title}-${this.id}-${new Date}`});this.layerDBService.update(_)}maintainFeaturesInIdb(){const _=this.dataSource.ol.getFeatures(),u=JSON.parse((new R.c).writeFeatures(_,{dataProjection:"EPSG:4326",featureProjection:this.dataSource.ol.getProjection()||"EPSG:3857"}));this.geoDBService.update(this.id,this.id,u,X.G.User,`${this.title}-${this.id}-${new Date}`)}flash(_){const u=(new Date).getTime(),S=this.ol.on("postrender",function P(I){const U=(0,x.wX)(I),G=I.frameState,O=_.getGeometry().clone(),F=G.time-u,Q=F/this.options.animation.duration,r=(0,g.Q7)(1-Q),ie=(0,d.f4)(this.options.animation.color||"red");ie[3]=r;let ae=this.ol.getStyleFunction().call(this,_).find(le=>le.getImage());ae||(ae=this.ol.getStyleFunction().call(this,_)[0]);const fe=ae.clone();switch(_.getGeometry().getType()){case"Point":if(null!==fe.getImage()&&"function"==typeof fe.getImage().getRadius){const le=(0,g.Q7)(Q)*(3*fe.getImage().getRadius());fe.getImage().setRadius(le),fe.getImage().setOpacity(r)}break;case"LineString":fe.getImage()&&(fe.getImage().getStroke().setColor(ie),fe.getImage().getStroke().setWidth((0,g.Q7)(Q)*(3*fe.getImage().getStroke().getWidth()))),fe.getStroke()&&(fe.getStroke().setColor(ie),fe.getStroke().setWidth((0,g.Q7)(Q)*(3*fe.getStroke().getWidth())));break;case"Polygon":fe.getImage()&&fe.getImage().getFill().setColor(ie),fe.getFill()&&fe.getFill().setColor(ie)}if(fe.setText(""),U.setStyle(fe),U.drawGeometry(O),F>this.options.animation.duration)return(0,e.S)(S),void this.map.ol.render();this.map.ol.render()}.bind(this))}setMap(_){void 0===_?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(_)}setExtent(_){this.options.extent=_}onUnwatch(){this.dataSource.onUnwatch(),this.stopAnimation()}stopAnimation(){this.dataSource.ol.un("addfeature",function(_){this.visible&&this.flash(_.feature)}.bind(this))}enableTrackFeature(_){this.trackFeatureListenerId=this.dataSource.ol.on("addfeature",this.trackFeature.bind(this,_))}centerMapOnFeature(_){const u=this.dataSource.ol.getFeatureById(_);u&&this.map.ol.getView().setCenter(u.getGeometry().getCoordinates())}trackFeature(_,u){u.feature.getId()===_&&this.visible&&this.centerMapOnFeature(_)}disableTrackFeature(_){(0,e.S)(this.trackFeatureListenerId)}customWFSLoader(_,u,S,P,I,U,G,O,F){{const Q=u.paramsWFS,r=Q.srsName?new j.c({code:Q.srsName}):U,ie=h.W0(P,U,r),ae=u.ogcFilters;if(this.previousLoadExtent&&this.previousLoadExtent!==ie||this.previousLoadResolution&&this.previousLoadResolution!==I||this.previousOgcFilters&&this.previousOgcFilters!==ae){_.removeLoadedExtent(this.previousLoadExtent);for(let ue of this.xhrAccumulator)ue.abort()}this.previousLoadExtent=ie,this.previousLoadResolution=I,this.previousOgcFilters=ae,Q.srsName=Q.srsName||U.getCode();const fe=(0,N.yK)(u,ie,r,ae,F);let le=0;if("2.0.0"===Q.version&&Q.maxFeatures>N.G4)for(;le<Q.maxFeatures;){let se=fe.replace("count="+Q.maxFeatures,"count=1000");se=se.replace("startIndex=0","0"),se+="&startIndex="+le,se.replace(/&&/g,"&"),this.getFeatures(_,S,ie,r,U,se,G,O),le+=1e3}else this.getFeatures(_,S,ie,r,U,fe,G,O)}}getFeatures(_,u,S,P,I,U,G,O){const F=new XMLHttpRequest,Q=u.alterUrlWithKeyAuth(U);let r=U;Q&&(r=Q),F.open("GET",r),u&&u.interceptXhr(F,r);const ie=()=>{_.removeLoadedExtent(S),O()};F.onerror=ie,F.onload=()=>{if(200===F.status&&F.responseText.length>0){const ae=_.getFormat().readFeatures(F.responseText,{dataProjection:P,featureProjection:I});ae?(_.addFeatures(ae),G(ae)):G([])}else ie()},this.xhrAccumulator.push(F),F.send()}customLoader(_,u,S,P,I,U,G,O){const F=new XMLHttpRequest;let Q=u;if("function"!=typeof u){const r=S.alterUrlWithKeyAuth(u);r&&(Q=r)}if(this.geoNetworkService&&"function"!=typeof u){let ae=_.getFormat().getType();const fe=()=>{_.removeLoadedExtent(P),O()},le={responseType:ae};this.geoNetworkService.geoDBService.get(u).pipe((0,a.o)(750)).pipe((0,K.m)(ue=>ue?(0,E.of)(ue):this.geoNetworkService.get(Q,le).pipe((0,M.K)(),(0,L.a)(se=>{throw fe(),se})))).subscribe(ue=>{if(ue){const se=_.getFormat(),ge=se.getType();let Ie;if("json"===ge||"text"===ge?Ie=ue:"xml"===ge?(Ie=ue,Ie||(Ie=(new DOMParser).parseFromString(ue,"application/xml"))):"arraybuffer"===ge&&(Ie=ue),Ie){const Re=se.readFeatures(Ie,{extent:P,featureProjection:U});_.addFeatures(Re),G(Re)}else fe()}})}else{F.open("GET",Q);const r=_.getFormat();"arraybuffer"===r.getType()&&(F.responseType="arraybuffer"),S&&S.interceptXhr(F,Q);const ie=()=>{_.removeLoadedExtent(P),O()};F.onerror=ie,F.onload=()=>{if(!F.status||F.status>=200&&F.status<300){const ae=r.getType();let fe;if("json"===ae||"text"===ae?fe=F.responseText:"xml"===ae?(fe=F.responseXML,fe||(fe=(new DOMParser).parseFromString(F.responseText,"application/xml"))):"arraybuffer"===ae&&(fe=F.response),fe){const le=r.readFeatures(fe,{extent:P,featureProjection:U});_.addFeatures(le),G(le)}else ie()}else ie()},F.send()}}customIDBLoader(_,u,S,P,I,U){if(this.geoNetworkService){const G=()=>{_.removeLoadedExtent(S),U()};this.geoNetworkService.geoDBService.get(u).subscribe(O=>{if(O){const F=_.getFormat(),Q=F.getType();let r;if("json"===Q||"text"===Q?r=O:"xml"===Q?(r=O,r||(r=(new DOMParser).parseFromString(O,"application/xml"))):"arraybuffer"===Q&&(r=O),r){const ie=F.readFeatures(r,{extent:S,featureProjection:P});_.addFeatures(ie,F.readProjection(r)),I(ie)}else G()}})}}}},29632:(Ee,ce,s)=>{"use strict";s.d(ce,{s:()=>e});var y=s(64002);class e extends y.WO{id;loaded=0;loading=0;source;messageService;constructor(g,R){super(),this.source=g.options.source.ol,this.id=(0,y.uq)(),this.messageService=R}watch(){this.source.on("imageloadstart",g=>this.handleLoadStart(g)),this.source.on("imageloadend",g=>this.handleLoadEnd(g)),this.source.on("imageloaderror",g=>this.handleLoadEnd(g)),this.source.on("imageloaderror",g=>this.handleLoadError(g))}unwatch(){this.source.un("imageloadstart",g=>this.handleLoadStart(g)),this.source.un("imageloadend",g=>this.handleLoadEnd(g)),this.source.un("imageloaderror",g=>this.handleLoadEnd(g)),this.source.un("imageloaderror",g=>this.handleLoadError(g))}handleLoadStart(g){g.image.__watchers__||(g.image.__watchers__=[]),g.image.__watchers__.push(this.id),this.loading+=1,this.status=y.qM.Working}handleLoadEnd(g){if(!g.image.__watchers__)return;const R=g.image.__watchers__.indexOf(this.id);if(R<0)return;g.image.__watchers__.splice(R,1),this.loaded+=1;const o=this.loading;this.loaded>=o&&o===this.loading&&(this.status=y.qM.Done,this.loaded=this.loading=0)}handleLoadError(g){g.image.__watchers__&&(this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:g.target.params_.LAYERS}),this.loaded=-1,this.loading=0,this.status=y.qM.Error)}}},48004:(Ee,ce,s)=>{"use strict";s.d(ce,{e:()=>e});var y=s(64002);class e extends y.WO{id;loaded=0;loading=0;source;constructor(g){super(),this.source=g.options.source.ol,this.id=(0,y.uq)()}watch(){this.source.on("tileloadstart",g=>this.handleLoadStart(g)),this.source.on("tileloadend",g=>this.handleLoadEnd(g)),this.source.on("tileloaderror",g=>this.handleLoadEnd(g))}unwatch(){this.source.un("tileloadstart",g=>this.handleLoadStart(g)),this.source.un("tileloadend",g=>this.handleLoadEnd(g)),this.source.un("tileloaderror",g=>this.handleLoadEnd(g))}handleLoadStart(g){g.tile.__watchers__||(g.tile.__watchers__=[]),g.tile.__watchers__.push(this.id),this.loading+=1,this.status=y.qM.Working}handleLoadEnd(g){if(!g.tile.__watchers__)return;const R=g.tile.__watchers__.indexOf(this.id);if(R<0)return;g.tile.__watchers__.splice(R,1),this.loaded+=1;const o=this.loading;this.loaded>=o&&o===this.loading&&(this.status=y.qM.Done,this.loaded=this.loading=0)}}},84052:(Ee,ce,s)=>{"use strict";s.d(ce,{w:()=>d});var y=s(64002),e=s(93176);class d extends y.WO{id;loaded=0;loading=0;layer;constructor(R){super(),this.layer=R,this.id=(0,y.uq)()}watch(){let R=this.layer.options.source.ol;this.layer.dataSource instanceof e.a&&(R=this.layer.options.source.options.source),R.getUrl()&&(R.on("featuresloadstart",o=>this.handleLoadStart(o)),R.on("featuresloadend",o=>this.handleLoadEnd(o)),R.on("featuresloaderror",o=>this.handleLoadEnd(o)))}unwatch(){let R=this.layer.options.source.ol;this.layer.dataSource instanceof e.a&&(R=this.layer.options.source.options.source),R.getUrl()&&(R.un("featuresloadstart",o=>this.handleLoadStart(o)),R.un("featuresloadend",o=>this.handleLoadEnd(o)),R.un("featuresloaderror",o=>this.handleLoadEnd(o)))}handleLoadStart(R){this.loading+=1,this.status=y.qM.Working}handleLoadEnd(R){this.loaded+=1;const o=this.loading;this.loaded>=o&&o===this.loading&&(this.status=y.qM.Done,this.loaded=this.loading=0)}}},48920:(Ee,ce,s)=>{"use strict";s.d(ce,{Q:()=>L});var y=s(65056),e=s(34672),d=s(32328),g=s(27e3),R=s(9588),o=s(72584),j=(s(89500),s(53291));function x(){return(0,j.gV)("baseLayerSwitcherState",[(0,j.K2)("collapseIcon",(0,j.wb)({height:"40px",width:"40px",overflow:"hidden"})),(0,j.K2)("collapseMap",(0,j.wb)({height:"80px",overflow:"hidden"})),(0,j.K2)("expand",(0,j.wb)({overflow:"hidden"})),(0,j.aK)("collapse => expand",(0,j.Cs)("200ms")),(0,j.aK)("expand => collapse",(0,j.Cs)("200ms"))])}var w=s(60192),b=s(34896);function E(oe,N){1&oe&&(b.I0R(0,"div",6)(1,"button",7),b.wVc(2,"translate"),b.wR5(3,"mat-icon",8),b.C$Y()()),2&oe&&(b.yG2(),b.E7m("matTooltip",b.kDX(2,1,"igo.geo.mapButtons.baselayerSwitcher")))}function T(oe,N){if(1&oe&&(b.wR5(0,"igo-mini-basemap",9),b.wVc(1,"translate")),2&oe){const B=N.$implicit,X=N.index,V=b.GaO(2);b.E7m("map",V.map)("baseLayer",B)("title",V.baseLayers.length>2&&!V.expand?b.kDX(1,5,"igo.geo.baselayersSwitcher.title"):B.title)("display",V.expand||0===X&&!V.useStaticIcon)("disabled",!V.expand&&V.baseLayers.length>1)}}function a(oe,N){1&oe&&(b.I0R(0,"div",10),b.wR5(1,"mat-icon",11),b.C$Y())}const K=oe=>({"container-expand":oe});function M(oe,N){if(1&oe){const B=b.KQA();b.I0R(0,"div",1),b.qCj("@baseLayerSwitcherState.start",function(){b.usT(B);const V=b.GaO();return b.CGJ(V.showButton=!1)})("@baseLayerSwitcherState.done",function(){b.usT(B);const V=b.GaO();return b.CGJ(V.showButton=!0)})("click",function(){b.usT(B);const V=b.GaO();return b.CGJ(V.collapseOrExpand())}),b.yuY(1,E,4,3,"div",2),b.I0R(2,"div",3),b.yuY(3,T,2,7,"igo-mini-basemap",4),b.C$Y(),b.yuY(4,a,2,0,"div",5),b.C$Y()}if(2&oe){const B=b.GaO();b.E7m("ngClass",b.S45(5,K,B.expand))("@baseLayerSwitcherState",B.expand?"expand":B.useStaticIcon?"collapseIcon":"collapseMap"),b.yG2(),b.E7m("ngIf",B.useStaticIcon&&!B.expand&&B.showButton),b.yG2(2),b.E7m("ngForOf",B.baseLayers),b.yG2(),b.E7m("ngIf",B.hasMoreThanTwo)}}let L=(()=>{class oe{mediaService;map;useStaticIcon;_baseLayers=[];expand=!1;showButton=!0;layers$$;get hasMoreThanTwo(){return this.baseLayers.length>1}constructor(B){this.mediaService=B,this.mediaService.media$.value===R.oZ.Mobile&&void 0===this.useStaticIcon&&(this.useStaticIcon=!0)}ngAfterViewInit(){this.layers$$=this.map.layers$.subscribe(B=>{this._baseLayers=B.filter(X=>X.baseLayer)})}ngOnDestroy(){this.layers$$.unsubscribe()}collapseOrExpand(){this.expand=!(!this.hasMoreThanTwo&&!this.useStaticIcon||this.expand)}get baseLayers(){const B=this.map.viewController.getResolution(),X=this.map.viewController.getZoom(),V=this._baseLayers.filter(W=>(!W.options.maxResolution||B<=W.options.maxResolution)&&(!W.options.minResolution||B>=W.options.minResolution)&&(!W.options.source.options.maxZoom||X<=W.options.source.options.maxZoom)&&(!W.options.source.options.minZoom||X>=W.options.source.options.minZoom)),z=V.filter(W=>!W.visible);return z.length+1===V.length?z:V}static \u0275fac=function(X){return new(X||oe)(b.GI1(R.QB))};static \u0275cmp=b.In1({type:oe,selectors:[["igo-baselayers-switcher"]],inputs:{map:"map",useStaticIcon:"useStaticIcon"},standalone:!0,features:[b.UHJ],decls:1,vars:1,consts:[["class","igo-baselayers-switcher-container",3,"ngClass","click",4,"ngIf"],[1,"igo-baselayers-switcher-container",3,"ngClass","click"],["class","igo-baselayers-switcher-button-container",4,"ngIf"],[1,"basemap-list"],[3,"map","baseLayer","title","display","disabled",4,"ngFor","ngForOf"],["class","more-baselayers",4,"ngIf"],[1,"igo-baselayers-switcher-button-container"],["mat-icon-button","","matTooltipPosition","right","color","primary",3,"matTooltip"],["svgIcon","image-multiple"],[3,"map","baseLayer","title","display","disabled"],[1,"more-baselayers"],["color","primary","svgIcon","menu-down",1,"material-icons","mat-icon"]],template:function(X,V){1&X&&b.yuY(0,M,5,7,"div",0),2&X&&b.E7m("ngIf",V.baseLayers.length>0)},dependencies:[y.u_,y.QF,e.oJ,e.um,g.KO,g.a4,d.oB,d.qL,y.Iw,w._,o.O0,o.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}.basemap-list[_ngcontent-%COMP%]   igo-mini-basemap[_ngcontent-%COMP%]{display:block}.basemap-list[_ngcontent-%COMP%]   igo-mini-basemap[_ngcontent-%COMP%]:not(:first-child){margin-top:4px}.igo-baselayers-switcher-container[_ngcontent-%COMP%]{height:auto;position:relative}.container-expand[_ngcontent-%COMP%]{overflow:hidden;border-width:0}.more-baselayers[_ngcontent-%COMP%]{width:80px;height:20px;background-color:#fff;text-align:center;cursor:pointer}.more-baselayers[_ngcontent-%COMP%]:hover{background-color:#efefef}.igo-baselayers-switcher-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}.igo-baselayers-switcher-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"],data:{animation:[x()]}})}return oe})()},60192:(Ee,ce,s)=>{"use strict";s.d(ce,{_:()=>x});var y=s(65056),d=(s(99228),s(7036)),g=s(9364),R=s(89500),o=s(34896);function h(w,b){if(1&w&&(o.I0R(0,"div",5),o.OEk(1),o.C$Y()),2&w){const E=o.GaO(2);o.yG2(),o.cNF(E.title)}}function j(w,b){if(1&w){const E=o.KQA();o.I0R(0,"div",2),o.qCj("click",function(){o.usT(E);const a=o.GaO();return o.CGJ(a.changeBaseLayer(a.baseLayer))}),o.wR5(1,"igo-map-browser",3),o.yuY(2,h,2,1,"div",4),o.C$Y()}if(2&w){const E=o.GaO();o.yG2(),o.E7m("map",E.basemap),o.yG2(),o.E7m("ngIf",E.title)}}let x=(()=>{class w{layerService;appRef;map;disabled;title;get display(){return this._display}set display(E){this._display=E,this.basemap.ol.getView().changed()}_display;get baseLayer(){return this._baseLayer}set baseLayer(E){this._baseLayer=E,this.handleBaseLayerChanged(E)}_baseLayer;basemap=new R.y({controls:{},interactions:!1});constructor(E,T){this.layerService=E,this.appRef=T}ngAfterViewInit(){this.handleMainMapViewChange(this.map.ol.getView()),this.map.viewController.olView.on("change",E=>{this.handleMainMapViewChange(E.target)}),this.map.ol.on("pointerdrag",E=>{this.handleMainMapViewChange(E.target.getView())})}ngOnDestroy(){this.map.viewController.olView.un("change",E=>{this.handleMainMapViewChange(E.target)}),this.map.ol.un("pointerdrag",E=>{this.handleMainMapViewChange(E.target.getView())})}changeBaseLayer(E){this.disabled||(this.map.changeBaseLayer(E),this.appRef.tick())}handleMainMapViewChange(E){const T=E.getProperties();this.basemap.viewController.olView.setResolution(T.resolution),this.basemap.viewController.olView.setRotation(T.rotation),this.basemap.viewController.olView.setCenter(this.map.viewController.getCenter())}handleBaseLayerChanged(E){this.basemap.removeAllLayers();const T=Object.assign(Object.create(E.options),E.options,{visible:!0,baseLayer:!1}),a=this.layerService.createLayer(T);this.basemap.addLayer(a),this.handleLinkedBaseLayer(a)}handleLinkedBaseLayer(E){const T=E.options.linkedLayers;if(!T)return;const a=T.links;a&&a.map(M=>{M.linkedIds.map(L=>{const oe=this.map.layers.find(N=>N.options.linkedLayers?.linkId===L);if(oe){const N=Object.assign(Object.create(oe.options),oe.options,{zIndex:9e3,visible:oe.options.linkedLayers?.showInMiniBaseMap??!0,baseLayer:!1});this.basemap.addLayer(this.layerService.createLayer(N))}})})}static \u0275fac=function(T){return new(T||w)(o.GI1(d.I),o.GI1(o.Swk))};static \u0275cmp=o.In1({type:w,selectors:[["igo-mini-basemap"]],inputs:{map:"map",disabled:"disabled",title:"title",display:"display",baseLayer:"baseLayer"},standalone:!0,features:[o.UHJ],decls:2,vars:1,consts:[[1,"igo-mini-basemap-container"],[3,"click",4,"ngIf"],[3,"click"],[3,"map"],["class","igo-mini-basemap-title",4,"ngIf"],[1,"igo-mini-basemap-title"]],template:function(T,a){1&T&&(o.I0R(0,"div",0),o.yuY(1,j,3,2,"div",1),o.C$Y()),2&T&&(o.yG2(),o.E7m("ngIf",a.display))},dependencies:[y.u_,g.q],styles:[".igo-mini-basemap-container[_ngcontent-%COMP%]{width:80px;height:80px;background-color:#ffffff03;border:2px solid white;box-shadow:0 1px 4px #0000004d;cursor:pointer}.igo-mini-basemap-container[_ngcontent-%COMP%]:hover   .igo-mini-basemap-title[_ngcontent-%COMP%]{color:#000;text-shadow:0 0 5px white}.igo-mini-basemap-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}.igo-mini-basemap-title[_ngcontent-%COMP%]{position:relative;top:-76px;height:76px;width:76px;text-align:center;vertical-align:bottom;color:#fff;text-shadow:0 0 5px black;white-space:normal;display:flex;align-items:flex-end;justify-content:center}"],changeDetection:0})}return w})()},42860:(Ee,ce,s)=>{"use strict";s.d(ce,{c:()=>b});var y=s(65056),e=s(34672),d=s(32328),g=s(27e3),R=s(83600),o=s(72584),h=s(54844),x=(s(89500),s(34896));function w(E,T){if(1&E){const a=x.KQA();x.I0R(0,"div",1)(1,"button",2),x.qCj("click",function(){x.usT(a);const M=x.GaO();return x.CGJ(M.onGeolocationClick())}),x.wVc(2,"translate"),x.wVc(3,"translate"),x.wR5(4,"mat-icon",3),x.wVc(5,"async"),x.C$Y()()}if(2&E){const a=x.GaO();x.yG2(),x.E7m("matTooltip",a.map.geolocationController.tracking?x.kDX(2,3,"igo.geo.mapButtons.geolocateInactive"):x.kDX(3,5,"igo.geo.mapButtons.geolocate"))("color",a.color),x.yG2(3),x._6D("svgIcon",x.kDX(5,7,a.icon$))}}let b=(()=>{class E{configService;tracking$$;icon$=new h.g("crosshairs-gps");get map(){return this._map}set map(a){this._map=a}_map;get color(){return this._color}set color(a){this._color=a}_color;constructor(a){this.configService=a}ngAfterContentInit(){this.map.ol.once("rendercomplete",()=>{this.tracking$$=this.map.geolocationController.tracking$.subscribe(a=>{a||this.configService.getConfig("geolocate.basic")?this.icon$.next("crosshairs-gps"):this.icon$.next("crosshairs")})})}ngOnDestroy(){this.tracking$$&&this.tracking$$.unsubscribe()}onGeolocationClick(){this.map.geolocationController.tracking=!this.map.geolocationController.tracking}static \u0275fac=function(K){return new(K||E)(x.GI1(R.aW))};static \u0275cmp=x.In1({type:E,selectors:[["igo-geolocate-button"]],inputs:{map:"map",color:"color"},standalone:!0,features:[x.UHJ],decls:1,vars:1,consts:[["class","igo-geolocate-button-container",4,"ngIf"],[1,"igo-geolocate-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","click"],[3,"svgIcon"]],template:function(K,M){1&K&&x.yuY(0,w,6,9,"div",0),2&K&&x.E7m("ngIf",M.map.geolocationController)},dependencies:[y.u_,e.oJ,e.um,g.KO,g.a4,d.oB,d.qL,y.a,o.O0,o.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-geolocate-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-geolocate-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return E})()},34419:(Ee,ce,s)=>{"use strict";s.d(ce,{e:()=>x});var y=s(34672),e=s(32328),d=s(27e3),g=s(83600),R=s(61252),o=s(72584),j=(s(89500),s(34896));let x=(()=>{class w{configService;map;color;extentOverride;centerOverride;zoomOverride;homeExtentButtonExtent;homeExtentButtonCenter;homeExtentButtonZoom;constructor(E){this.configService=E,this.computeHomeExtent()}computeHomeExtent(){const E=this.configService.getConfig("homeExtentButton");this.homeExtentButtonExtent=this.extentOverride||E?.homeExtButtonExtent,this.homeExtentButtonCenter=this.centerOverride||E?.homeExtButtonCenter,this.homeExtentButtonZoom=this.zoomOverride||E?.homeExtButtonZoom,this.centerOverride&&this.zoomOverride&&(this.homeExtentButtonExtent=void 0)}onToggleClick(){if(this.computeHomeExtent(),this.homeExtentButtonExtent)this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);else if(this.homeExtentButtonCenter&&this.homeExtentButtonZoom){const E=R.QH(this.homeExtentButtonCenter,this.map.viewController.olView.getProjection().getCode());this.map.viewController.olView.setCenter(E),this.map.viewController.zoomTo(this.homeExtentButtonZoom)}}static \u0275fac=function(T){return new(T||w)(j.GI1(g.aW))};static \u0275cmp=j.In1({type:w,selectors:[["igo-home-extent-button"]],inputs:{map:"map",color:"color",extentOverride:"extentOverride",centerOverride:"centerOverride",zoomOverride:"zoomOverride"},standalone:!0,features:[j.UHJ],decls:4,vars:4,consts:[[1,"igo-home-extent-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","click"],["svgIcon","home-map-marker"]],template:function(T,a){1&T&&(j.I0R(0,"div",0)(1,"button",1),j.qCj("click",function(){return a.onToggleClick()}),j.wVc(2,"translate"),j.wR5(3,"mat-icon",2),j.C$Y()()),2&T&&(j.yG2(),j.E7m("matTooltip",j.kDX(2,2,"igo.geo.mapButtons.home-extent"))("color",a.color))},dependencies:[y.oJ,y.um,d.KO,d.a4,e.oB,e.qL,o.O0,o.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-home-extent-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-home-extent-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return w})()},34080:(Ee,ce,s)=>{"use strict";s.d(ce,{cd:()=>d.c,eq:()=>g.e,yG:()=>b.yG,Y1:()=>R.Y,q2:()=>o.q,u0:()=>b.u0,kn:()=>b.kn,qM:()=>b.qM,i6:()=>w.i,w1:()=>T.w,qc:()=>a.q,KG:()=>b.KG,rE:()=>b.rE,uE:()=>b.uE,Sc:()=>b.Sc,ET:()=>b.ET,KM:()=>b.KM}),s(48920),s(60192);var d=s(42860),g=s(34419),R=s(94440),o=s(9364),w=(s(55452),s(78416),s(65972),s(76332)),b=s(51512),T=(s(72124),s(50208)),a=s(75872)},94440:(Ee,ce,s)=>{"use strict";s.d(ce,{Y:()=>g});var y=s(65056),e=s(34896);function d(R,o){if(1&R&&(e.I0R(0,"div",1)(1,"pre"),e.OEk(2),e.C$Y()()),2&R){const h=e.GaO();e.yG2(2),e.cNF(h.infoContent)}}let g=(()=>{class R{infoContent="";constructor(){}static \u0275fac=function(j){return new(j||R)};static \u0275cmp=e.In1({type:R,selectors:[["igo-info-section"]],inputs:{infoContent:"infoContent"},standalone:!0,features:[e.UHJ],decls:1,vars:1,consts:[["class","infoSection",4,"ngIf"],[1,"infoSection"]],template:function(j,x){1&j&&e.yuY(0,d,3,1,"div",0),2&j&&e.E7m("ngIf",x.infoContent&&x.infoContent.length)},dependencies:[y.u_],styles:[".infoSection[_ngcontent-%COMP%]{border-radius:10px;background-color:#6e6e6e66;padding:2.5px;position:absolute;text-align:center;top:5px;left:50%;text-shadow:0 0 5px white,0 0 10px white,0 0 15px white}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.infoSection[_ngcontent-%COMP%]{top:50px;left:10%}}"]})}return R})()},9364:(Ee,ce,s)=>{"use strict";s.d(ce,{q:()=>o});var y=s(23302),e=s(64002),g=(s(89500),s(34896));const R=["*"];let o=(()=>{class h{activityService;activityId;status$$;map;get view(){return this._view}set view(x){this._view=x,void 0!==this.map&&this.map.updateView(x)}_view;get controls(){return this._controls}set controls(x){this._controls=x,void 0!==this.map&&this.map.updateControls(x)}_controls;id=`igo-map-target-${(0,e.uq)()}`;constructor(x){this.activityService=x}ngOnInit(){this.status$$=this.map.status$.subscribe(x=>this.handleStatusChange(x))}ngAfterViewInit(){this.map.setTarget(this.id)}ngOnDestroy(){this.map.setTarget(void 0),this.activityService.unregister(this.activityId),this.status$$.unsubscribe()}handleStatusChange(x){x===e.qM.Working&&void 0===this.activityId?this.activityId=this.activityService.register():x===e.qM.Done&&void 0!==this.activityId&&(this.activityService.unregister(this.activityId),this.activityId=void 0)}static \u0275fac=function(w){return new(w||h)(g.GI1(y.U9))};static \u0275cmp=g.In1({type:h,selectors:[["igo-map-browser"]],inputs:{map:"map",view:"view"},standalone:!0,features:[g.UHJ],ngContentSelectors:R,decls:2,vars:1,consts:[[1,"igo-map-browser-target",3,"id"]],template:function(w,b){1&w&&(g.kPM(),g.wR5(0,"div",0),g._Xx(1)),2&w&&g.E7m("id",b.id)},styles:["[_nghost-%COMP%]{position:relative;display:block}[_nghost-%COMP%], .igo-map-browser-target[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]     .ol-attribution{flex-flow:row;left:50px;bottom:5px;text-align:left;padding:0;margin-right:90px;background-color:#fff0;width:calc(100% - 100px)}[_nghost-%COMP%]     .ol-attribution.ol-logo-only{height:inherit}[_nghost-%COMP%]     .ol-attribution.ol-collapsed{background:none}[_nghost-%COMP%]     .ol-attribution.ol-collapsed button{transform:none}[_nghost-%COMP%]     .ol-attribution button{transform:rotate(180deg);background-color:#fff;cursor:pointer;outline:none}[_nghost-%COMP%]     .ol-scale-line-inner{color:#000;border-color:#000;text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px;box-shadow:0 1px 0 1px #fff9}[_nghost-%COMP%]     .ol-scale-line{background-color:#fff0;bottom:4px;transform:translate(-50%);left:50%}[_nghost-%COMP%]     .ol-scale-bar{background-color:#fff0;bottom:4px;transform:translate(-50%);left:50%}[_nghost-%COMP%]     .ol-scale-text{text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px}[_nghost-%COMP%]     .ol-scale-step-text{text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px}[_nghost-%COMP%]     canvas{display:block}"]})}return h})()},55452:(Ee,ce,s)=>{"use strict";s.d(ce,{O:()=>d}),s(89500);var e=s(34896);let d=(()=>{class g{map;displayCenter$$;constructor(){}ngAfterViewInit(){this.map&&(this.displayCenter$$=this.map.mapCenter$.subscribe(o=>{document.getElementById("mapCenter").style.visibility=o?"visible":"hidden"})),this.letZoom()}ngOnDestroy(){this.displayCenter$$&&this.displayCenter$$.unsubscribe()}letZoom(){document.getElementById("mapCenter").addEventListener("wheel",o=>{o.deltaY>0?this.map.viewController.zoomOut():this.map.viewController.zoomIn()},!0)}static \u0275fac=function(h){return new(h||g)};static \u0275cmp=e.In1({type:g,selectors:[["igo-map-center"]],inputs:{map:"map"},standalone:!0,features:[e.UHJ],decls:3,vars:0,consts:[["id","mapCenter",1,"mapCenter"],[1,"vertical"],[1,"horizontal"]],template:function(h,j){1&h&&(e.I0R(0,"div",0),e.wR5(1,"div",1)(2,"div",2),e.C$Y())},styles:[".mapCenter[_ngcontent-%COMP%]{width:30px;height:30px;position:absolute;top:50%;left:50%;transform:translate(-15px,-15px);pointer-events:none}.mapCenter[_ngcontent-%COMP%]   .vertical[_ngcontent-%COMP%], .mapCenter[_ngcontent-%COMP%]   .horizontal[_ngcontent-%COMP%]{width:4px;height:30px;position:absolute;left:13px;background-color:#000}.mapCenter[_ngcontent-%COMP%]   .horizontal[_ngcontent-%COMP%]{transform:rotate(90deg)}"]})}return g})()},78416:(Ee,ce,s)=>{"use strict";s.d(ce,{a:()=>j});var y=s(65056),e=s(34896),d=s(34672),g=s(32328),R=s(27e3),o=s(83600),h=s(72584);let j=(()=>{class x{configService;get sidenavOpened(){return this._sidenavOpenend}set sidenavOpened(b){this._sidenavOpenend=b,this.getClassMenuButton()}_sidenavOpenend;openSidenav=new e._w7;useThemeColor;menuButtonClass;constructor(b){this.configService=b;const E=this.configService.getConfig("menu.button.useThemeColor");this.useThemeColor=void 0!==E&&E}getClassMenuButton(){this.menuButtonClass={"menu-button-white-background":!this.useThemeColor}}onToggleSidenavClick(){this.openSidenav.emit()}static \u0275fac=function(E){return new(E||x)(e.GI1(o.aW))};static \u0275cmp=e.In1({type:x,selectors:[["igo-menu-button"]],inputs:{sidenavOpened:"sidenavOpened"},outputs:{openSidenav:"openSidenav"},standalone:!0,features:[e.UHJ],decls:3,vars:4,consts:[["mat-icon-button","","id","menu-button","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","matTooltip","click"],["svgIcon","menu"]],template:function(E,T){1&E&&(e.I0R(0,"button",0),e.qCj("click",function(){return T.onToggleSidenavClick()}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",1),e.C$Y()),2&E&&e.E7m("ngClass",T.menuButtonClass)("matTooltip",e.kDX(1,2,T.sidenavOpened?"menu.close":"menu.open"))},dependencies:[d.oJ,d.um,y.QF,R.KO,R.a4,g.oB,g.qL,h.O0,h.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}"]})}return x})()},65972:(Ee,ce,s)=>{"use strict";s.d(ce,{I:()=>x});var y=s(65056),e=s(34672),d=s(32328),g=s(27e3),R=s(72584),h=(s(89500),s(34896));const j=w=>[w];let x=(()=>{class w{btnStyle="onlineStyle";map;color;enabled=!1;constructor(){}ngOnInit(){this.map.forcedOffline$.next(this.enabled)}onClick(){this.enabled=!this.enabled,this.handleButtonStyle(),this.map.forcedOffline$.next(this.enabled)}handleButtonStyle(){this.btnStyle=this.enabled?"offlineStyle":"onlineStyle"}static \u0275fac=function(T){return new(T||w)};static \u0275cmp=h.In1({type:w,selectors:[["igo-offline-button"]],inputs:{map:"map",color:"color",enabled:"enabled"},standalone:!0,features:[h.UHJ],decls:5,vars:9,consts:[[1,"igo-user-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","ngClass","color","click"],["svgIcon","wifi-strength-off"]],template:function(T,a){1&T&&(h.I0R(0,"div",0)(1,"button",1),h.qCj("click",function(){return a.onClick()}),h.wVc(2,"translate"),h.wVc(3,"translate"),h.wR5(4,"mat-icon",2),h.C$Y()()),2&T&&(h.yG2(),h.E7m("matTooltip",a.enabled?h.kDX(2,3,"igo.geo.mapButtons.online"):h.kDX(3,5,"igo.geo.mapButtons.offline"))("ngClass",h.S45(7,j,a.btnStyle))("color",a.enabled?a.color:null))},dependencies:[e.oJ,e.um,g.KO,g.a4,y.QF,d.oB,d.qL,R.O0,R.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .onlineStyle[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .onlineStyle[_ngcontent-%COMP%]:hover{background-color:#efefef}[_nghost-%COMP%]   .offlineStyle[_ngcontent-%COMP%]{width:40px;background-color:#b9b9b9}"]})}return w})()},76332:(Ee,ce,s)=>{"use strict";s.d(ce,{i:()=>E});var y=s(65056),e=s(34672),d=s(32328),g=s(27e3),R=s(72584),o=s(72855),h=s(54844),x=(s(89500),s(34896));const w=(T,a)=>({azimuth:T,rotation:a});function b(T,a){if(1&T){const K=x.KQA();x.I0R(0,"div",1),x.wVc(1,"async"),x.wVc(2,"translate"),x.wVc(3,"translate"),x.I0R(4,"button",2),x.qCj("click",function(){x.usT(K);const L=x.GaO();return x.CGJ(L.map.viewController.resetRotation())}),x.wVc(5,"async"),x.wR5(6,"mat-icon",3),x.wVc(7,"async"),x.C$Y()()}if(2&T){const K=x.GaO();x.E7m("matTooltip",x.kDX(1,4,K.rotated$)?x.g7$(2,6,"igo.geo.mapButtons.resetRotation",x.IBC(15,w,K.azimuthRounded,K.rotationRounded)):x.kDX(3,9,"igo.geo.mapButtons.tipRotation")),x.yG2(4),x.E7m("color",K.color)("disabled",!1===x.kDX(5,11,K.rotated$)),x.yG2(2),x.E7m("ngStyle",x.kDX(7,13,K.currentStyle$))}}let E=(()=>{class T{rotated$=new h.g(!1);azimuthRounded=0;rotationRounded=0;currentStyle$=new h.g({transform:"rotate(0rad)"});map;showIfNoRotation;color;constructor(){}ngAfterContentInit(){this.map.viewController.rotation$.subscribe(K=>{const M=K||0,L=180*M/Math.PI;this.rotationRounded=Math.round(L),this.azimuthRounded=Math.round((0,o.g9)(-1*L)),this.currentStyle$.next({transform:"rotate("+M+"rad)"}),this.rotated$.next(0!==M)})}static \u0275fac=function(M){return new(M||T)};static \u0275cmp=x.In1({type:T,selectors:[["igo-rotation-button"]],inputs:{map:"map",showIfNoRotation:"showIfNoRotation",color:"color"},standalone:!0,features:[x.UHJ],decls:2,vars:3,consts:[["class","igo-rotation-button-container","matTooltipPosition","left",3,"matTooltip",4,"ngIf"],["matTooltipPosition","left",1,"igo-rotation-button-container",3,"matTooltip"],["mat-icon-button","","matTooltipPosition","left",3,"color","disabled","click"],["svgIcon","navigation",3,"ngStyle"]],template:function(M,L){1&M&&(x.yuY(0,b,8,18,"div",0),x.wVc(1,"async")),2&M&&x.E7m("ngIf",x.kDX(1,1,L.rotated$)&&!L.showIfNoRotation||L.showIfNoRotation)},dependencies:[y.u_,g.KO,g.a4,e.oJ,e.um,d.oB,d.qL,y.Qt,y.a,R.O0,R.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-rotation-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-rotation-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return T})()},86908:(Ee,ce,s)=>{"use strict";s.d(ce,{G:()=>e});var y=s(83552);class e{olMap;observerKeys=[];getOlMap(){return this.olMap}setOlMap(g){if(void 0!==g&&void 0!==this.getOlMap())throw new Error("This controller is already bound to a map.");if(void 0===g)return this.teardownObservers(),void(this.olMap=g);this.olMap=g}teardownObservers(){this.observerKeys.forEach(g=>(0,y.S)(g)),this.observerKeys=[]}}},89019:(Ee,ce,s)=>{"use strict";s.d(ce,{I:()=>y});var y=function(e){return e.Position="position",e.PositionDirection="positionDirection",e.Accuracy="accuracy",e.Buffer="buffer",e}(y||{})},42364:(Ee,ce,s)=>{"use strict";s.d(ce,{E:()=>V});var y=s(58264),e=s(2296),d=s(80848),g=s(28668),R=s(36752),o=s(61252),h=s(49412),j=s(54776),x=s(87544),w=s(88872),b=s(45212),E=s(62632),T=s(71888),a=s(54844),K=s(51712),M=s(19432),L=s(68392),oe=s(14672),N=s(36404),B=s(86908),X=s(89019);class V extends B.G{map;options;storageService;configService;arrowRotation;subscriptions$$=[];geolocationOverlay;positionFeatureStyle=new j.cp({image:new x.c({radius:6,fill:new w.c({color:"#3399CC"}),stroke:new b.c({color:"#fff",width:2})})});accuracyFeatureStyle=new j.cp({stroke:new b.c({color:"rgba(120, 120, 120, 0.4)",width:1}),fill:new w.c({color:"rgba(120, 120, 120, 0.4)"})});get bufferStyle(){return new j.cp({stroke:new b.c({width:2,color:this.buffer.bufferStroke}),fill:new w.c({color:this.buffer.bufferFill}),text:new E.c({textAlign:"left",offsetX:10,offsetY:-10,font:"12px Calibri,sans-serif",text:this.buffer.showBufferRadius?`${this.buffer.bufferRadius}m`:"",fill:new w.c({color:"#000"}),stroke:new b.c({color:"#fff",width:3})})})}get arrowStyle(){return new j.cp({image:new T.c({radius:5.5,fill:new w.c({color:"rgba(0, 132, 202)"}),stroke:new b.c({color:"#fff",width:1.5}),points:3,displacement:[0,9],rotation:this.arrowRotation,rotateWithView:!0})})}geolocation;emissionIntervalSeconds$=new a.g(5);position$=new a.g(void 0);tracking$=new a.g(void 0);followPosition$=new a.g(void 0);lastPosition;set buffer(W){this._buffer=W,this.handleFeatureCreation(this.position$.value)}get buffer(){return this._buffer}_buffer;set accuracyThreshold(W){this._accuracyThreshold=W,this.handleFeatureCreation(this.position$.value)}get accuracyThreshold(){return this._accuracyThreshold}_accuracyThreshold;get olGeolocation(){return this.geolocation}get tracking(){return this.geolocation.getTracking()}set tracking(W){this.geolocation.setTracking(W||!1),this.tracking$.next(W),this.storageService&&void 0!==W&&this.storageService.set("geolocation.tracking",W),W||this.position$.next(void 0)}set followPosition(W){this._followPosition=W,this.followPosition$.next(W),!1===this.configService?.getConfig("geolocate.followPosition")&&(this._followPosition=!1,this.followPosition$.next(!1)),this.handleFeatureCreation(this.position$.value),this.storageService&&void 0!==W&&this.storageService.set("geolocation.followPosition",W)}get followPosition(){return this._followPosition}_followPosition;constructor(W,A,q,_){super(),this.map=W,this.options=A,this.storageService=q,this.configService=_,this.geolocationOverlay=new N.m(this.map),this._followPosition=!(!this.options||!this.options.followPosition)&&this.options.followPosition,this._buffer=this.options&&this.options.buffer?this.options.buffer:void 0,this._accuracyThreshold=this.options&&this.options.accuracyThreshold?this.options.accuracyThreshold:5e3}setOlMap(W){super.setOlMap(W),this.setupObservers()}deleteGeolocationFeatures(){this.deleteFeatureByType(X.I.Position),this.deleteFeatureByType(X.I.PositionDirection),this.deleteFeatureByType(X.I.Accuracy),this.deleteFeatureByType(X.I.Buffer)}setupObservers(){this.tracking$.subscribe(A=>{A?this.onPositionChange(!0,!0):this.deleteGeolocationFeatures()}),this.geolocation=new e.c({trackingOptions:{enableHighAccuracy:!0,maximumAge:1e4,timeout:6e5},projection:this.options.projection});let W=!1;this.subscriptions$$.push(this.emissionIntervalSeconds$.pipe((0,M.G)(A=>(0,K.I)(1e3*A))).subscribe(()=>{W===this.tracking?this.onPositionChange(!0):(W=this.tracking,this.onPositionChange(!0,!0))})),this.geolocation.on("change",A=>{this.onPositionChange(!1,!1)})}updateArrowFeatureOrientation(W){const A=o.AF(W.position,W.projection,"EPSG:4326");if(!this.lastPosition)return void(this.lastPosition={coordinates:A,dateTime:new Date});const q=this.getFeatureByType(X.I.PositionDirection),_=W?.speed>1.25&&this.distanceBetweenPoints(this.lastPosition.coordinates,A)>.003;if(W.accuracy<=this.accuracyThreshold&&_){var P=Math.atan2(A[0]-this.lastPosition.coordinates[0],A[1]-this.lastPosition.coordinates[1]);P<0&&(P=2*Math.PI+P),this.arrowRotation=P,q&&q.setStyle(this.arrowStyle),this.lastPosition={coordinates:A,dateTime:new Date}}else q&&(new Date).getTime()-this.lastPosition.dateTime.getTime()>3e3&&(0,oe.gV)(q)}distanceBetweenPoints(W,A){return h.c$(W,A)/1e3}addOnChangedListener(W){let A=()=>{W(this.geolocation)};return this.geolocation.on("change",A),A}deleteChangedListener(W){this.geolocation.un("change",W)}updateGeolocationOptions(W){if(!W)return;let A=W.geolocate,q=W.alwaysTracking;if(this.storageService){const _=this.storageService.get("geolocation.tracking");null!=_&&(A=_);const u=this.storageService.get("geolocation.followPosition");null!=u&&(q=u)}this.tracking=A,this.followPosition=q,this.buffer=W.buffer}teardownObservers(){this.subscriptions$$.length&&this.subscriptions$$.map(W=>W.unsubscribe()),super.teardownObservers()}onPositionChange(W=!1,A=!1){if(!this.tracking)return;const q=this.geolocation.getProperties();if(q.accuracy>this.accuracyThreshold)return console.warn("Poor geolocation accuracy. No position are stored/shown"),void this.position$.next(void 0);const _={position:q.position,projection:this.geolocation.getProjection().getCode(),accuracy:q.accuracy,altitude:q.altitude,altitudeAccuracy:q.altitudeAccuracy,heading:q.heading,speed:q.speed,enableHighAccuracy:!!q.trackingOptions?.enableHighAccuracy,timestamp:new Date};this.handleFeatureCreation(_),this.handleViewFromFeatures(_,A),W&&this.position$.next(_)}getFeatureByType(W){return this.geolocationOverlay.dataSource.ol.getFeatureById(W)}deleteFeatureByType(W){const A=this.geolocationOverlay?.dataSource.ol.getFeatureById(W);A&&this.geolocationOverlay.dataSource.ol.removeFeature(A)}handleFeatureCreation(W){if(!W||!W.position)return;const A=new d.c(W.position),q=(0,R.IH)(new g.c(W.position,W.accuracy||0));let _=this.getFeatureByType(X.I.Position),u=this.getFeatureByType(X.I.PositionDirection),S=this.getFeatureByType(X.I.Accuracy);const P=!!_,I=!!u,U=!!S;if(I||(u=new y.c({geometry:A}),u.setId(X.I.PositionDirection),(0,oe.gV)(u)),P||(_=new y.c({geometry:A}),_.setId(X.I.Position),_.setStyle(this.positionFeatureStyle)),U||(S=new y.c({geometry:q}),S.setId(X.I.Accuracy),S.setStyle(this.accuracyFeatureStyle)),A&&(P?_.setGeometry(A):this.geolocationOverlay.addOlFeature(_,L.S.None),I?u.setGeometry(A):this.geolocationOverlay.addOlFeature(u,L.S.None),this.updateArrowFeatureOrientation(W),U?S.setGeometry(q):this.geolocationOverlay.addOlFeature(S,L.S.None),this.buffer)){let G=this.getFeatureByType(X.I.Buffer);const O=!!G,F=new g.c(W.position,this.buffer.bufferRadius);O||(G=new y.c(F),G.setId(X.I.Buffer),G.setStyle(this.positionFeatureStyle)),G.setStyle(this.bufferStyle),O?G.setGeometry(F):this.geolocationOverlay.addOlFeature(G,L.S.None)}}handleViewFromFeatures(W,A=!1){const P=[this.getFeatureByType(X.I.Position),this.getFeatureByType(X.I.PositionDirection),this.getFeatureByType(X.I.Accuracy),this.getFeatureByType(X.I.Buffer)].filter(I=>I);if(P.length>0){const I=(0,oe.q1)(P,this.map.viewProjection),U=W?.speed>12.5?[.25,.25,.25,.25]:[.15,.1,.1,.1],G=(0,oe.Ki)(this.map.getExtent(),I,U);let O=this.followPosition&&G?L.S.Move:L.S.None;A&&(O=L.S.Zoom),O!==L.S.None&&(0,oe.QX)(this.map.viewController,P,O)}}}},87272:(Ee,ce,s)=>{"use strict";s.d(ce,{c:()=>x});var y=s(44876),e=s(61252),d=s(54844),g=s(61616),R=s(24112),o=s(93836),h=s(59324),j=s(86908);class x extends j.G{options;rotation$=new d.g(0);resolution$=new d.g(void 0);state$=new d.g(void 0);padding=[0,0,0,0];maxZoomOnExtent=19;maxLayerZoomExtent;extent$=new g.E;extent$$;states=[];stateIndex=0;get stateHistory(){return!!this.options&&!0===this.options.stateHistory}get olView(){return this.olMap.getView()}constructor(b){super(),this.options=b}setPadding(b){(b.top||0===b.top)&&(this.padding[0]=b.top),(b.right||0===b.right)&&(this.padding[1]=b.right),(b.bottom||0===b.bottom)&&(this.padding[2]=b.bottom),(b.left||0===b.left)&&(this.padding[3]=b.left)}setOlMap(b){super.setOlMap(b),this.setupObservers()}setupObservers(){!0===this.stateHistory&&this.observerKeys.push(this.olMap.on("moveend",b=>this.onMoveEnd(b))),this.extent$$=this.extent$.pipe((0,R.o)(25)).subscribe(b=>{this.setExtent(b.extent,b.action)})}monitorRotation(){this.observerKeys.push(this.olMap.getView().on("change:rotation",b=>{this.rotation$.next(b.target.getRotation())})),this.rotation$.next(this.getRotation())}teardownObservers(){super.teardownObservers(),void 0!==this.extent$$&&(this.extent$$.unsubscribe(),this.extent$$=void 0)}getOlProjection(){return this.olView.getProjection()}getCenter(b){let E=this.olView.getCenter();return b&&E&&(E=e.AF(E,this.getOlProjection(),b)),E}getExtent(b){let E=this.olView.calculateExtent(this.olMap.getSize());return b&&E&&(E=e.W0(E,this.getOlProjection(),b)),E}getScale(b=96){return(0,h.iC)(this.getResolution(),this.getOlProjection().getUnits(),b)}getResolution(){return this.olView.getResolution()}getZoom(){return Math.round(this.olView.getZoom())}zoomIn(){this.zoomTo(this.olView.getZoom()+1)}zoomOut(){this.zoomTo(this.olView.getZoom()-1)}zoomTo(b){this.olView.cancelAnimations(),this.olView.animate({zoom:b,duration:250,easing:y.Q7})}moveToExtent(b){this.extent$.next({extent:b,action:o.a.Move})}zoomToExtent(b){this.extent$.next({extent:b,action:o.a.Zoom})}getRotation(){return this.olView.getRotation()}resetRotation(){this.olView.animate({rotation:0})}hasPreviousState(){return this.states.length>1&&this.stateIndex>0}hasNextState(){return this.states.length>1&&this.stateIndex<this.states.length-1}previousState(){this.hasPreviousState()&&this.setStateIndex(this.stateIndex-1)}nextState(){this.hasNextState()&&this.setStateIndex(this.stateIndex+1)}clearStateHistory(){this.states=[],this.stateIndex=0}setInitialState(){this.states.length>0&&this.setStateIndex(0)}setExtent(b,E,T=!0){const a=this.olView;a.cancelAnimations();const K=T?500:0,M=a.getZoom(),L=a.getCenter(),oe=[b[0]+(b[2]-b[0])/2,b[1]+(b[3]-b[1])/2],N=Math.sqrt(Math.pow(L[0]-oe[0],2)+Math.pow(L[1]-oe[1],2)),B=a.calculateExtent(),X=Math.sqrt(Math.pow(B[2]-B[0],2)+Math.pow(B[3]-B[1],2)),W=N/((Math.sqrt(Math.pow(b[2]-b[0],2)+Math.pow(b[3]-b[1],2))+X)/2),A=E===o.a.Move||M>this.maxZoomOnExtent?M:this.maxZoomOnExtent;a.fit(b,{size:this.olMap.getSize(),maxZoom:A,padding:this.padding,duration:W>4?0:K,callback:q=>{q||a.fit(b,{size:this.olMap.getSize(),maxZoom:A,padding:this.padding,duration:W>4?0:K})}})}setStateIndex(b){this.stateIndex=b,this.setState(this.states[b])}setState(b){this.olView.animate({resolution:b.resolution,center:b.center,duration:0})}onMoveEnd(b){const E=this.getResolution();this.resolution$.value!==E&&this.resolution$.next(E);const T={resolution:E,center:this.getCenter(),zoom:this.getZoom()};if(!0===this.stateHistory){const a=this.stateIndex;(0,h.Ko)(T,0===this.states.length?void 0:this.states[a])||(this.states=this.states.slice(0,a+1).concat([T]),this.stateIndex=this.states.length-1)}this.state$.next(T)}}},87159:(Ee,ce,s)=>{"use strict";s.d(ce,{C:()=>z});var y=s(62228),e=s(9588),d=s(64002),g=s(58264),R=s(83552),o=s(80848),h=s(36752),j=s(62808),x=s(53156),w=s(28184),b=s(24328),E=s(19076),T=s(83680),a=s(67732),K=s(70524),M=s(68392),L=s(40240),oe=s(56708),N=s(9364),B=s(59800),X=s(82048),V=s(34896);let z=(()=>{class W{component;mediaService;styleService;store;pointerHoverFeatureStore=new y.qc([]);lastTimeoutRequest;store$$;layers$$;selectionLayer;selectionMVT={};mvtStyleOptions;pointerMoveListener;singleClickMapListener;hoverFeatureId="hoverFeatureId";igoHoverFeatureDelay=1e3;igoHoverFeatureEnabled=!1;mouseout(){clearTimeout(this.lastTimeoutRequest),this.clearLayer()}get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(q,_,u){this.component=q,this.mediaService=_,this.styleService=u}ngOnInit(){this.map.status$.pipe((0,T.K)(q=>q===d.qM.Done)).subscribe(()=>{this.store=new L.y([],{map:this.map}),this.initStore(),this.listenToMapPointerMove(),this.subscribeToPointerStore(),this.listenToMapClick()}),this.layers$$=this.map.layers$.subscribe(q=>{this.store&&!q.find(_=>"hoverFeatureId"===_.id)&&this.initStore()})}initStore(){const q=this.store,_=new oe.Md({isIgoInternalLayer:!0,id:"hoverFeatureId",title:"hoverFeature",zIndex:900,source:new a.E,showInLayerList:!1,exportable:!1,browsable:!1,style:B._o});(0,K.m)(q,_),this.selectionLayer=new w.c({map:this.map.ol,zIndex:901,renderMode:"vector",declutter:!0,source:new E.c({projection:this.map.projection}),style:(u,S)=>{if(this.mvtStyleOptions&&u.getId()in this.selectionMVT)return this.createHoverStyle(u,this.mvtStyleOptions,S)}})}createHoverStyle(q,_,u){const S={..._};let P=_.label?_.label.attribute:void 0,I=!!_.label?.style;if(q.get("_isLabel")){const U=S.data?S.data.length:0,G=[],O=[],F=[],Q=[];for(let r=0;r<U;r++)G.push(0),O.push("rgba(255, 255, 255, 0)"),F.push(0),Q.push("rgba(255, 255, 255, 0)");S.radius=G,S.stroke=O,S.width=F,S.fill=Q}else S.label=void 0,I=!1,P=void 0;return!I&&P&&(S.label.style={textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:{color:"#000"},backgroundFill:{color:"rgba(255, 255, 255, 0.5)"},backgroundStroke:{color:"rgba(200, 200, 200, 0.75)",width:2},stroke:{color:"#fff",width:3},overflow:!0,offsetX:10,offsetY:20,padding:[2.5,2.5,2.5,2.5]}),this.styleService.createStyleByAttribute(q,S,u)}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unlistenToMapSingleClick(),this.layers$$.unsubscribe()}subscribeToPointerStore(){this.store$$=this.pointerHoverFeatureStore.entities$.subscribe(q=>{this.addFeatureOverlay(q)})}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",q=>this.onMapEvent(q))}listenToMapClick(){this.singleClickMapListener=this.map.ol.on("singleclick",q=>this.onMapSingleClickEvent(q))}unsubscribeToPointerStore(){this.store$$.unsubscribe()}unlistenToMapPointerMove(){(0,R.S)(this.pointerMoveListener),this.pointerMoveListener=void 0}unlistenToMapSingleClick(){(0,R.S)(this.singleClickMapListener),this.singleClickMapListener=void 0}onMapSingleClickEvent(q){this.clearLayer()}onMapEvent(q){if(q.dragging||!this.igoHoverFeatureEnabled||this.mediaService.isTouchScreen())return void this.clearLayer();typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);let u,_=-1/0;const S=this.map.ol.getPixelFromCoordinate(q.coordinate);this.lastTimeoutRequest=setTimeout(()=>{if(this.map.ol.forEachFeatureAtPixel(S,(P,I)=>{if(!I)return;const U=this.map.getLayerByOlUId(I.ol_uid);this.canProcessHover(U)&&(U.zIndex<=_||(_=U.zIndex,u=I))},{hitTolerance:10,layerFilter:P=>P instanceof x.c||P instanceof w.c}),!u)return this.clearLayer(),void this.pointerHoverFeatureStore.clear();this.map.ol.forEachFeatureAtPixel(S,(P,I)=>{if(void 0===P.get("hoverSummary")&&P.getProperties()!==this.pointerHoverFeatureStore.all()[0]?.getProperties()){let U;if(this.clearLayer(),I instanceof x.c){const G=this.map.getLayerByOlUId(I.ol_uid);if(!this.canProcessHover(G))return;let O=this.handleRenderFeature(P);this.setLayerStyleFromOptions(G,O);const F=[O];O.set("_isLabel",!1);const Q=new g.c;Q.setProperties(O.getProperties());const r="Point"===O.getGeometry().getType()?O.getGeometry():new o.c(q.coordinate);return Q.setGeometry(r),Q.setId(O.getId()),Q.set("_isLabel",!0),this.setLayerStyleFromOptions(G,Q),F.push(Q),this.pointerHoverFeatureStore.load(F),U=G,!0}if(I instanceof w.c){const G=this.map.getLayerByOlUId(I.ol_uid);if(!this.canProcessHover(G))return;G?.options?.igoStyle?.styleByAttribute?.hoverStyle?this.mvtStyleOptions=G.options.igoStyle.styleByAttribute.hoverStyle:G?.options?.igoStyle?.hoverStyle&&(this.mvtStyleOptions=G.options.igoStyle.hoverStyle),this.selectionLayer.setSource(I.getSource()),I.getFeatures(q.pixel).then(O=>{if(!O.length)return this.selectionMVT={},this.selectionLayer.changed(),void this.clearLayer();const F=O[0];if(!F)return void this.clearLayer();let Q=this.handleRenderFeature(F);Q.set("_isLabel",!1);const r=new g.c;r.setProperties(Q.getProperties());const ie="Point"===Q.getGeometry().getType()?Q.getGeometry():new o.c(q.coordinate);r.setGeometry(ie),r.setId(Q.getId()),r.set("_isLabel",!0),this.setLayerStyleFromOptions(G,r),this.pointerHoverFeatureStore.load([r]),this.selectionMVT[F.getId()]=Q,this.selectionLayer.changed()}),U=G}}},{hitTolerance:10,layerFilter:P=>P===u})},this.igoHoverFeatureDelay)}canProcessHover(q){return!(!q||!q.visible||!q.options||!q.options.igoStyle?.styleByAttribute&&!q.options.igoStyle?.hoverStyle||q.options.igoStyle?.styleByAttribute&&!q.options.igoStyle?.styleByAttribute.hoverStyle&&!q.options.igoStyle?.hoverStyle)}handleRenderFeature(q){let _;return q instanceof b.cp?(_=new g.c({geometry:this.getGeometry(q)}),_.setId(q.getId())):q instanceof g.c&&(_=q),_.setProperties(q.getProperties()),_}addFeatureOverlay(q){if(q.length>0){const _=q[0];this.clearLayer();const u=new g.c({geometry:_.getGeometry(),meta:{id:this.hoverFeatureId},hoverSummary:this.getHoverSummary(_.getProperties())});this.store.setLayerOlFeatures([u],M.S.None)}}setLayerStyleFromOptions(q,_){const u=this.store.layer.map.viewController.getResolution();q?.options?.igoStyle?.styleByAttribute?.hoverStyle?this.store.layer.ol.setStyle(this.createHoverStyle(_,q.options.igoStyle.styleByAttribute.hoverStyle,u)):q?.options?.igoStyle?.hoverStyle&&this.store.layer.ol.setStyle(this.createHoverStyle(_,q.options.igoStyle.hoverStyle,u))}getHoverSummary(q){let _="";for(const[u,S]of Object.entries(q))!u.startsWith("_")&&"geometry"!==u&&(_+=`${u}: ${S}\n`);return _.length>=2?_.slice(0,-2):_}getGeometry(q){let _;if(q.getOrientedFlatCoordinates){const u=q.getOrientedFlatCoordinates(),S=[];switch(u.forEach((P,I)=>{I%2==0&&S.push([parseFloat(u[I]),parseFloat(u[I+1])])}),q.getType()){case"Point":_=new o.c(S);break;case"Polygon":_=new h.cp([S]);break;case"LineString":_=new j.c([S])}}else _=q.getGeometry();return _}clearLayer(){this.selectionMVT={},this.selectionLayer&&this.selectionLayer.changed(),this.store&&this.store.clearLayer()}static \u0275fac=function(_){return new(_||W)(V.GI1(N.q,2),V.GI1(e.QB),V.GI1(X.U))};static \u0275dir=V.Sc5({type:W,selectors:[["","igoHoverFeature",""]],hostBindings:function(_,u){1&_&&V.qCj("mouseout",function(){return u.mouseout()})},inputs:{igoHoverFeatureDelay:"igoHoverFeatureDelay",igoHoverFeatureEnabled:"igoHoverFeatureEnabled"},standalone:!0})}return W})()},51512:(Ee,ce,s)=>{"use strict";s.d(ce,{C3:()=>h.C,yG:()=>y.y,U1:()=>R.U,u0:()=>d.u,kn:()=>o.k,qM:()=>j.q,KG:()=>a,rE:()=>g.rE,bg:()=>g.bg,uE:()=>g.uE,Sc:()=>g.Sc,ET:()=>E,KM:()=>T});var y=s(89500),d=(s(93836),s(12268)),g=s(59324),R=s(55760),o=s(50056),h=s(87159),j=s(16660);function E(M){let L=-54;if(M<-81||M>L)return 0;{let B=2;for(;Math.abs(M-L)>3;)L-=3,B++;return B}}function T(M){let L=-180,B=1;for(;Math.abs(M-L)>6;)L+=6,B++;return B}function a(M){const L=M.mtmZone,oe=M.utmZone;return{projFromConfig:!1!==M.projFromConfig,nad83:!1!==M.nad83,wgs84:!1!==M.wgs84,webMercator:!1!==M.webMercator,utm:!1!==M.utm,mtm:!1!==M.mtm,utmZone:{minZone:oe&&oe.minZone?oe.minZone:17,maxZone:oe&&oe.maxZone?oe.maxZone:21},mtmZone:{minZone:L&&L.minZone?L.minZone:2,maxZone:L&&L.maxZone?L.maxZone:10}}}s(42364),s(89019),s(87272),s(19724)},19724:(Ee,ce,s)=>{"use strict";s.d(ce,{GK:()=>L,S8:()=>oe,UR:()=>x,aY:()=>T,m:()=>E,yP:()=>M});var y=s(56096),e=s(21808),d=s(40912),g=s(56708);function R(N){return N.options.linkedLayers}function o(N,B){return N.layers.find(X=>X.options.linkedLayers?.linkId===B)}function x(N,B,X){let V=B,z=V,W=!0;for(;W;)V=z,z=w(N,V,X),W=!!z;return W||function h(N,B){let X=!1;const V=R(N);return V?.links&&(X=!!V.links.find(W=>W.properties.includes(B))),X}(V,X)||(V=void 0),W?z:V}function w(N,B,X){if(B?.options.linkedLayers?.linkId){const V=B.options.linkedLayers.linkId;let z=N.layers.filter(W=>{const A=W.options.linkedLayers;if(A&&A.links)return A.links.find(_=>_.linkedIds.includes(V)&&_.properties.includes(X))});return z.length>1&&console.warn(`Your layer ${B.title||B.id} must only have 1 parent (${z.map(W=>W.title||W.id)})\n            , The first parent (${z[0].title||z[0].id}) will be use to sync properties`),z[0]}}function b(N,B,X){let V=[];return B?.options.linkedLayers?.links&&B.options.linkedLayers.links.filter(z=>z.properties.includes(X)).map(z=>{V=V.concat(z.linkedIds)}),V.map(z=>o(N,z))}function E(N,B,X,V){return b(N,B,V).map(W=>{X.push(W),b(N,W,V)&&E(N,W,X,V)}),X}function T(N,B){let X=B,V=X,z=!0;for(;z;)X=V,V=a(N,X),z=!!V;return z||function j(N){let B=!1;const X=R(N);return X?.links&&(B=!!X.links.find(z=>z.syncedDelete)),B}(X)||(X=void 0),z?V:X}function a(N,B){if(B.options.linkedLayers?.linkId){const X=B.options.linkedLayers.linkId;let V=N.layers.filter(z=>{const W=z.options.linkedLayers;if(W&&W.links)return W.links.find(q=>q.linkedIds.includes(X)&&q.syncedDelete)});return V.length>1&&console.warn(`Your layer ${B.title||B.id} must only have 1 parent (${V.map(z=>z.title||z.id)})\n          , The first parent (${V[0].title||V[0].id}) will be use to sync properties`),V[0]}}function K(N,B){let X=[];return B?.options.linkedLayers?.links&&B.options.linkedLayers.links.filter(V=>V.syncedDelete).map(V=>{X=X.concat(V.linkedIds)}),X.map(V=>o(N,V))}function M(N,B,X){return K(N,B).map(z=>{X.push(z),K(N,z)&&M(N,z,X)}),X}function L(N,B){const X={},V=Object.keys(g.aG);V.map(z=>{X[g.aG[z]]=[]}),B.filter(z=>R(z)).map(z=>{V.map(W=>{const A=g.aG[W],q=x(N,z,A),u=X[A].map(S=>S.id);q&&!u.includes(q.id)&&X[A].push(q)})}),Object.keys(X).map(z=>{X[z].map(A=>A.ol.notify(z,void 0))})}function oe(N,B,X){if(!B)return;const V=new d.S;let z=!0,W=!0;const A=B.key;let q;if("ogcFilters"===A?(z=!1,W=!0,q=X.dataSource.options.ogcFilters):"timeFilter"===A?(z=!1,W=!0,q=X.dataSource.options.timeFilter):(z=!0,W=!1,q=X.ol.get(A)),R(X)){let u=x(N,X,A);u||(u=X);const S=[u];E(N,u,S,A);let P=!1;const I=X.options.source.options.type,U=X.dataSource.options;S.map(G=>{if(X&&G&&(0,y.gV)(X.ol)!==(0,y.gV)(G?.ol)){const O=G.options.source.options.type;if(z)G.ol.set(A,q,!0),"visible"===A&&G.visible$.next(q),("minResolution"===A||"maxResolution"===A)&&(P=!0);else if(W)if("ogcFilters"===A){if(G.dataSource.setOgcFilters(q,!1),"wfs"===O&&G.ol.getSource().refresh(),"wms"===O){let F;"wfs"===I?F=V.handleOgcFiltersAppliedValue(U,X.dataSource.options.fieldNameGeometry,void 0,N.viewController.getOlProjection()):"wms"===I&&(F=X.dataSource.ol.getParams().FILTER),G.dataSource.ol.updateParams({FILTER:F})}}else if(G.dataSource instanceof e.C&&"timeFilter"===A){G.dataSource.setTimeFilter(q,!1);const F=X.ol.getSource().getParams().TIME;G.dataSource.ol.updateParams({TIME:F})}}}),P&&N.viewController.resolution$.next(N.viewController.resolution$.value)}}},50056:(Ee,ce,s)=>{"use strict";s.d(ce,{k:()=>o});var y=s(34896),e=s(9588),d=s(83552),g=s(61252),R=s(9364);let o=(()=>{class h{component;mediaService;lastTimeoutRequest;pointerMoveListener;mapClickListener;pointerPositionDelay=1e3;pointerPositionCoord=new y._w7;get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(x,w){this.component=x,this.mediaService=w}ngOnInit(){this.listenToMapPointerMove(),this.listenToMapClick()}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unlistenToMapClick()}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",x=>this.onPointerEvent(x,this.pointerPositionDelay))}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",x=>this.onPointerEvent(x,0))}unlistenToMapPointerMove(){(0,d.S)(this.pointerMoveListener),this.pointerMoveListener=void 0}unlistenToMapClick(){this.mapClickListener=void 0}onPointerEvent(x,w){if(x.dragging||this.mediaService.isTouchScreen())return;typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);const b=(0,g.AF)(x.coordinate,this.mapProjection,"EPSG:4326");this.lastTimeoutRequest=setTimeout(()=>{this.pointerPositionCoord.emit(b)},w)}static \u0275fac=function(w){return new(w||h)(y.GI1(R.q,2),y.GI1(e.QB))};static \u0275dir=y.Sc5({type:h,selectors:[["","igoPointerPosition",""]],inputs:{pointerPositionDelay:"pointerPositionDelay"},outputs:{pointerPositionCoord:"pointerPositionCoord"},standalone:!0})}return h})()},93836:(Ee,ce,s)=>{"use strict";s.d(ce,{a:()=>y});var y=function(e){return e[e.Move=0]="Move",e[e.Zoom=1]="Zoom",e}(y||{})},12268:(Ee,ce,s)=>{"use strict";s.d(ce,{u:()=>e});var y=s(34896);let e=(()=>{class d{map;constructor(){}getMap(){return this.map}setMap(R){this.map=R}static \u0275fac=function(o){return new(o||d)};static \u0275prov=y.wxM({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})()},89500:(Ee,ce,s)=>{"use strict";s.d(ce,{y:()=>X});var y=s(28900),e=s(17500),d=s(156),g=s(78960),R=s(77272),o=s(61252),h=s(42124),j=s(56096),x=s(3576),w=s(54844),b=s(91296),E=s(53404),T=s(56708),a=s(36404),K=s(64002),M=s(11484);class L extends K.WO{propertyChange$=new w.g(void 0);loaded=0;loading=0;layers=[];subscriptions=[];constructor(){super()}watch(){}unwatch(){this.layers.forEach(z=>this.unwatchLayer(z),this)}setPropertyChange(z,W){[T.aG.TIMEFILTER,T.aG.OGCFILTERS,T.aG.VISIBLE,T.aG.OPACITY,T.aG.MINRESOLUTION,T.aG.MAXRESOLUTION].includes(z.key)&&this.propertyChange$.next({event:z,layer:W})}watchLayer(z){if(void 0===z.status$)return;z.ol.on("propertychange",A=>this.setPropertyChange(A,z)),z.dataSource.ol.on("propertychange",A=>this.setPropertyChange(A,z)),this.layers.push(z);const W=z.status$.pipe((0,M.a)()).subscribe(A=>{A===K.qM.Error&&(this.loading=0,this.loaded=-1),A===K.qM.Working?this.loading+=1:A===K.qM.Done&&(this.loaded+=1),this.loaded>=this.loading?(this.loading=this.loaded=0,this.status=K.qM.Done):this.loading>0&&(this.status=K.qM.Working)});this.subscriptions.push(W)}unwatchLayer(z){z.ol.un("propertychange",A=>this.setPropertyChange(A,z)),z.dataSource.ol.un("propertychange",A=>this.setPropertyChange(A,z)),z.status$.next(K.qM.Done);const W=this.layers.indexOf(z);W>=0&&(-1!==[K.qM.Working,K.qM.Waiting].indexOf(z.watcher.status)&&(this.loaded+=1),this.subscriptions[W].unsubscribe(),this.subscriptions.splice(W,1),this.layers.splice(W,1),z.watcher.unwatch())}}var oe=s(42364),N=s(87272),B=s(19724);class X{storageService;configService;ol;forcedOffline$=new w.g(!1);layers$=new w.g([]);layersAddedByClick$=new w.g(void 0);status$;propertyChange$;overlay;queryResultsOverlay;searchResultsOverlay;viewController;geolocationController;swipeEnabled$=new w.g(!1);mapCenter$=new w.g(!1);selectedFeatures$=new w.g(null);bufferDataSource;layerWatcher;options;mapViewOptions;defaultOptions={controls:{attribution:!1}};get layers(){return this.layers$.value}get projection(){return this.projectionCode}get viewProjection(){return this.viewController.getOlProjection()}get projectionCode(){return this.viewProjection.getCode()}constructor(z,W,A){this.storageService=W,this.configService=A,this.options=Object.assign({},this.defaultOptions,z),this.layerWatcher=new L,this.status$=this.layerWatcher.status$,this.propertyChange$=this.layerWatcher.propertyChange$,h.sV(x.c),this.init()}init(){const z=[];this.options.controls&&(this.options.controls.attribution&&z.push(new d.c(!0===this.options.controls.attribution?{}:this.options.controls.attribution)),this.options.controls.scaleLine&&z.push(new g.c(!0===this.options.controls.scaleLine?{}:this.options.controls.scaleLine)));let W={};!1===this.options.interactions&&(W={altShiftDragRotate:!1,doubleClickZoom:!1,keyboard:!1,mouseWheelZoom:!1,shiftDragZoom:!1,dragPan:!1,pinchRotate:!1,pinchZoom:!1}),this.ol=new y.c({interactions:R.Q(W),controls:z}),this.setView(this.options.view||{}),this.viewController=new N.c({stateHistory:!0}),this.viewController.setOlMap(this.ol),this.overlay=new a.m(this),this.queryResultsOverlay=new a.m(this),this.searchResultsOverlay=new a.m(this),this.ol.once("rendercomplete",()=>{this.geolocationController=new oe.E(this,{projection:this.viewController.getOlProjection()},this.storageService,this.configService),this.geolocationController.setOlMap(this.ol),this.geolocationController&&this.geolocationController.updateGeolocationOptions(this.mapViewOptions),this.layers$.pipe((0,b.c)()).subscribe(([A,q])=>{let _;A&&(_=A.map(S=>S.id));const u=q.filter(S=>!_.includes(S.id));for(const S of u)S.options.linkedLayers&&S.ol.once("postrender",()=>{(0,B.GK)(this,u)})}),this.viewController.monitorRotation()}),this.propertyChange$.pipe((0,E.O)(A=>!A)).subscribe(A=>(0,B.S8)(this,A.event,A.layer))}setTarget(z){this.ol.setTarget(z),void 0!==z?this.layerWatcher.subscribe(()=>{},null):this.layerWatcher.unsubscribe()}updateView(z){const A={...this.ol.getView().getProperties(),...z};z.zoom&&null==z.resolution&&(A.resolution=void 0),this.setView(A),z.maxZoomOnExtent&&(this.viewController.maxZoomOnExtent=z.maxZoomOnExtent),this.mapViewOptions=z}setView(z){void 0!==this.viewController&&this.viewController.clearStateHistory();const W={constrainResolution:!0,...z};z.center&&(W.center=o.QH(z.center,z.projection)),this.ol.setView(new e.cp(W)),z.maxLayerZoomExtent&&(this.viewController.maxLayerZoomExtent=z.maxLayerZoomExtent)}updateControls(z){if(void 0===z)return;const W=[];z.attribution&&W.push(new d.c(!0===z.attribution?{}:z.attribution)),z.scaleLine&&W.push(new g.c(!0===z.scaleLine?{}:z.scaleLine)),Object.assign([],this.ol.getControls().getArray()).forEach(q=>{this.ol.removeControl(q)}),W.forEach(q=>{this.ol.addControl(q)})}getCenter(z){return this.viewController.getCenter(z)}getExtent(z){return this.viewController.getExtent(z)}getZoom(){return this.viewController.getZoom()}changeBaseLayer(z){if(z){for(const W of this.getBaseLayers())W.visible=!1;z.visible=!0,this.viewController.olView.setMinZoom(z.dataSource.options.minZoom||(this.options.view||{}).minZoom),this.viewController.olView.setMaxZoom(z.dataSource.options.maxZoom||(this.options.view||{}).maxZoom)}}getBaseLayers(){return this.layers.filter(z=>!0===z.baseLayer)}getLayerById(z){return this.layers.find(W=>W.id&&W.id===z)}getLayerByAlias(z){return this.layers.find(W=>W.alias&&W.alias===z)}getLayerByOlUId(z){return this.layers.find(W=>(0,j.gV)(W.ol)&&(0,j.gV)(W.ol)===z)}getLayerByOlLayer(z){const W=(0,j.gV)(z);return this.getLayerByOlUId(W)}addLayer(z,W=!0){this.addLayers([z])}addLayers(z,W=!0){let A=0,q=0;const _=z.map(u=>{if(!u)return;const S=u.zIndex?0:u.baseLayer?q++:A++;return this.doAddLayer(u,S)}).filter(u=>void 0!==u);this.setLayers([].concat(this.layers,_))}removeLayer(z){this.removeLayers([z])}removeLayers(z){const W=this.layers$.value.slice(0),A=[];z.forEach(q=>{q instanceof T.Md&&q.removeLayerFromIDB();const _=W.indexOf(q);_>=0&&(A.push(q),W.splice(_,1),this.handleLinkedLayersDeletion(q,A),A.map(u=>{const S=W.indexOf(u);S>=0&&W.splice(S,1)}))}),A.forEach(q=>this.doRemoveLayer(q)),this.setLayers(W)}handleLinkedLayersDeletion(z,W){let A=(0,B.aY)(this,z);A||(A=z);const q=(0,B.yP)(this,A,[A]);for(const _ of q)W.push(_)}removeAllLayers(){this.layers.forEach(z=>this.doRemoveLayer(z)),this.layers$.next([])}raiseLayer(z){const W=this.getLayerIndex(z);W>1&&this.moveLayer(z,W,W-1)}raiseLayers(z){for(const W of z)this.raiseLayer(W)}lowerLayer(z){const W=this.getLayerIndex(z);W<this.layers.length-1&&this.moveLayer(z,W,W+1)}lowerLayers(z){const W=z.reverse();for(const A of W)this.lowerLayer(A)}moveLayer(z,W,A){const q=this.layers[A],u=z.zIndex;q.baseLayer||z.baseLayer||(z.zIndex=q.zIndex,q.zIndex=u,this.layers[A]=z,this.layers[W]=q,this.layers$.next(this.layers.slice(0)))}doAddLayer(z,W){z.baseLayer&&z.visible&&this.changeBaseLayer(z);const A=this.getLayerById(z.id);if(void 0===A){if(!z.baseLayer&&z.zIndex&&(z.zIndex+=10),void 0===z.zIndex||0===z.zIndex){const q=Math.max(z.baseLayer?0:10,...this.layers.filter(_=>_.baseLayer===z.baseLayer&&_.zIndex<200).map(_=>_.zIndex));z.zIndex=q+1+W}return z.baseLayer&&z.zIndex>9&&(z.zIndex=10),z.setMap(this),this.layerWatcher.watchLayer(z),this.ol.addLayer(z.ol),z}A.visible=!0}doRemoveLayer(z){this.layerWatcher.unwatchLayer(z),this.ol.removeLayer(z.ol),z.setMap(void 0)}setLayers(z){this.layers$.next(this.sortLayersByZIndex(z).slice(0))}sortLayersByZIndex(z){return z.sort((W,A)=>A.zIndex-W.zIndex)}getLayerIndex(z){return this.layers.findIndex(W=>W===z)}}},59324:(Ee,ce,s)=>{"use strict";s.d(ce,{G2:()=>o,Ko:()=>h,Re:()=>a,Sc:()=>g,bg:()=>x,iC:()=>w,mC:()=>T,q:()=>b,rE:()=>j,uE:()=>E});var y=s(64002),e=s(872),d=s(61252);function g(L,oe,N={}){let B,X,V,z,W,A,q,_,u,S,P,I,U,G,O,F,Q,r,ie,le;const ue=new RegExp("(\\s*;\\s*[\\d]{4,6})","g"),se="([-+])?([\\d]{1,3})([,.](\\d+))?",ge=`${se}[\\s,]+${se}`,Ie=new RegExp(`^${ge}$`,"g"),Re="([0-9]{1,2})[:|\xb0]?\\s*([0-9]{1,2})?[:|'|\u2032|\u2019]?\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\s*[\"|\u2033|\u201d]?\\s*",He=`${Re}([N|S|E|W|O]),?\\s*${Re}([N|S|E|W|O])`,ht=new RegExp(`^${He}$`,"gi"),rt="(UTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",xt=new RegExp(`^${rt}`,"gi"),Rt="(MTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",Ze=new RegExp(`^${Rt}`,"gi"),Kt="([-+])?(\\d{1,3})[,.](\\d+)",ve=`${Kt}\\s*[,]?\\s*${Kt}`,$e=new RegExp(`^${ve}`,"g"),Ne="([-+])?(\\d{1,3})[\\s,.]{1}(\\d{1,2})[\\s,.]{1}(\\d{1,2})[.,]?(\\d{1,5})?",Ae=`${Ne}\\s*[,.]?\\s*${Ne}`,dt=new RegExp(`^${Ae}`,"g"),je="LAT\\s*[\\s:]*\\s*([-+])?(\\d{1,2})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*LONG\\s*[\\s:]*\\s*([-+])?(\\d{1,3})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*UNC\\s*[\\s:]?\\s*(\\d+)\\s*CONF\\s*[\\s:]?\\s*(\\d{1,3})",Ke=new RegExp(`^${je}?`,"gi"),yt="([-+]?\\d+)[,.]?(\\d+)?",Le=`${yt}[\\s,]+${yt}`,vt=new RegExp(`^${Le}$`,"g");let Se=!1;if(L=L.toLocaleUpperCase().trim(),ue.test(L)?[X,le]=L.split(";").map(Be=>Be.trim()):X=L,Ie.test(X))[,V,r,,_,u,ie,,G]=X.match(ge),r=parseFloat((V||"")+r+"."+_),ie=parseFloat((u||"")+ie+"."+G);else if(ht.test(X))[,z,W,A,q,S,P,I,U]=X.match(He),("S"===q||"N"===q)&&(z=[S,S=z][0],W=[P,P=W][0],A=[I,I=A][0],q=[U,U=q][0]),r=R(parseFloat(z),parseFloat(W),parseFloat(A),q),ie=R(parseFloat(S),parseFloat(P),parseFloat(I),U);else if(xt.test(X)){Se=!0,[,,O,r,ie]=X.match(rt);const Be=Number(O)<10?`EPSG:3260${O}`:`EPSG:326${O}`;[r,ie]=d.AF([parseFloat(r),parseFloat(ie)],Be,"EPSG:4326")}else if(Ze.test(X)){Se=!0,[,,O,r,ie]=X.match(Rt);const Be=Number(O)<10?`EPSG:3218${O}`:`EPSG:321${80+Number(O)}`;[r,ie]=d.AF([parseFloat(r),parseFloat(ie)],Be,"EPSG:4326")}else if(dt.test(X))[,V,z,W,A,_,u,S,P,I,G]=X.match(Ae),r=R(parseFloat((V||"")+z),parseFloat(W),parseFloat(A),q),ie=R(parseFloat((u||"")+S),parseFloat(P),parseFloat(I),U);else if($e.test(X))[,V,z,_,u,S,G]=X.match(ve),r=R(parseFloat((V||"")+z),parseFloat(W),parseFloat(A),q),ie=R(parseFloat((u||"")+S),parseFloat(P),parseFloat(I),U);else if(Ke.test(X))[,u,S,P,I,,U,V,z,W,A,,q,F,Q]=X.match(je),q||(q="W"),r=W&&W.length>2?parseFloat((V||"")+z+"."+W):R(parseFloat(z),parseFloat(W),parseFloat(A),q),ie=P&&P.length>2?parseFloat((u||"")+S+"."+P):R(parseFloat(S),parseFloat(P),parseFloat(I),U);else{if(!vt.test(X))return{lonLat:void 0,message:"",radius:void 0,conf:void 0};Se=!0,[,r,_,ie,G]=X.match(Le),_&&(r=parseFloat(r+"."+_)),G&&(ie=parseFloat(ie+"."+G))}if(N.forceNA&&!Se&&(r>0&&ie>0&&(r>ie?r=-r:ie=-ie),r>ie&&(r=[ie,ie=r][0])),B=[Number(r),Number(ie)],void 0!==le&&"4326"!==le||B[0]>180||B[0]<-180||B[1]>90||B[1]<-90){const Be=le?"EPSG:"+le:oe,ze="EPSG:4326";try{B=d.AF(B,Be,ze)}catch{return{lonLat:void 0,message:"Projection "+Be+" not supported",radius:void 0,conf:void 0}}}return Math.abs(B[0])<=180&&Math.abs(B[1])<=90?{lonLat:B,message:"",radius:F?parseInt(F,10):void 0,conf:Q?parseInt(Q,10):void 0}:{lonLat:void 0,message:"Coordinate out of Longitude/Latitude bounds",radius:void 0,conf:void 0}}function R(L,oe,N,B){oe=oe||0,N=N||0;const X=L<0;let V=Math.abs(L)+oe/60+N/3600;return(X||"S"===B||"W"===B)&&(V=-V),V}function o(L,oe=3){const N=[];return L.forEach(B=>{const X=B<0?Math.ceil(B):Math.floor(B),V=B<0?60*(X-B):60*(B-X),z=Math.floor(V),W=(60*(V-z)).toFixed(oe);N.push(`${X}\xb0 ${z}' ${W}"`)}),N}function h(L,oe){if(void 0===L||void 0===oe)return!1;const N=1e-4;return L.zoom===oe.zoom&&Math.trunc(L.center[0]/N)===Math.trunc(oe.center[0]/N)&&Math.trunc(L.center[1]/N)===Math.trunc(oe.center[1]/N)}function j(L){return(L=Math.round(L))<1e4?L+"":(L=Math.round(L/1e3))<1e3?L+"K":(L=Math.round(L/1e3))+"M"}function x(L,oe=96){return L/(39.3701*oe)}function w(L,oe="m",N=96){return L*d.q[oe]*39.3701*N}function b(L){const oe=L.originalEvent;return!oe.altKey&&(e.q2?oe.metaKey:oe.ctrlKey)&&!oe.shiftKey}function E(L,oe=3){return[y.UD.roundToNDecimal(L[0],oe),y.UD.roundToNDecimal(L[1],oe)]}function T(L,oe=3){return E(L,oe).map(N=>N.toString())}function a(L,oe){const N=d.AF(L,"EPSG:4326","EPSG:3857"),B=[{code:"EPSG:3857",alias:"Web Mercator",coord:N,igo2CoordFormat:`${E(N).join(", ")} ; 3857`}],X=function K(L){return Math.ceil((L[0]+180)/6)}(L),V=X<10?`EPSG:3260${X}`:`EPSG:326${X}`,z=`UTM-${X}`,W=d.AF(L,"EPSG:4326",V);B.push({code:V,alias:"UTM",coord:W,igo2CoordFormat:`${z} ${E(W).join(", ")}`});const A=function M(L){const oe=L[0];let N;return oe<-51&&oe>-54&&(N=1),oe<-54&&oe>-57&&(N=2),oe<-57&&oe>-60&&(N=3),oe<-60&&oe>-63&&(N=4),oe<-63&&oe>-66&&(N=5),oe<-66&&oe>-69&&(N=6),oe<-69&&oe>-72&&(N=7),oe<-72&&oe>-75&&(N=8),oe<-75&&oe>-78&&(N=9),oe<-78&&oe>-81&&(N=10),N}(L);if(A){const q=A<10?`EPSG:3218${A}`:`EPSG:321${80+A}`,_=`MTM-${A}`,u=d.AF(L,"EPSG:4326",q);B.push({code:q,alias:"MTM",coord:u,igo2CoordFormat:`${_} ${E(u).join(", ")}`})}return oe.forEach(q=>{const _=d.AF(L,"EPSG:4326",q.code),u=q.code.split(":")[1];B.push({code:q.code,alias:q.alias||q.code,coord:_,igo2CoordFormat:`${E(_).join(", ")} ; ${u}`})}),B}},55760:(Ee,ce,s)=>{"use strict";s.d(ce,{U:()=>o});var y=s(93020),e=s(39882),d=s(35876),g=s(9364),R=s(34896);let o=(()=>{class h{networkService;messageService;component;get map(){return this.component.map}previousMessageId;constructor(x,w,b){this.networkService=w,this.messageService=b,this.component=x}ngAfterViewInit(){const x=window.navigator.onLine;this.map.forcedOffline$.subscribe(w=>{const b=window.navigator.onLine;if(!x||x!==b||w)if(this.previousMessageId&&this.messageService.remove(this.previousMessageId),!w&&b){const E=this.messageService.info("igo.geo.network.online.message","igo.geo.network.online.title");this.previousMessageId=E.toastId}else if(w){const E=this.messageService.info("igo.geo.network.offline.message","igo.geo.network.offline.title");this.previousMessageId=E.toastId}}),(0,d.E)([this.networkService.currentState(),this.map.forcedOffline$,this.map.layers$]).subscribe(w=>{this.handleLayersOnlineState(w[0].connection,w[1],w[2])})}handleNonOfflinableLayerResolution(x,w,b){!x||w?b.maxResolution=0:(x||!w)&&(b.maxResolution=b.options.maxResolution||1/0)}handleLayersOnlineState(x,w,b){b.forEach(E=>{let T;if(!E.isIgoInternalLayer){if(E.options.sourceOptions?.pathOffline&&(T=E.options.sourceOptions),!T)return void this.handleNonOfflinableLayerResolution(x,w,E);{const a=T.type;if("mvt"===a&&E.ol.getSource().refresh(),!x||w){if(["vector","cluster"].includes(a))return;E.ol.getSource().setUrl(T.pathOffline)}else if(x&&w)this.handleNonOfflinableLayerResolution(x,w,E);else{if(["vector","cluster"].includes(a))return;E.ol.getSource().setUrl(T.url)}}}})}static \u0275fac=function(w){return new(w||h)(R.GI1(g.q),R.GI1(e.u),R.GI1(y.mi))};static \u0275dir=R.Sc5({type:h,selectors:[["","igoMapOffline",""]],standalone:!0})}return h})()},16660:(Ee,ce,s)=>{"use strict";s.d(ce,{q:()=>o});var y=s(83600),e=s(61252),d=s(42124),g=s(3576),R=s(34896);let o=(()=>{class h{config;constructor(x){this.config=x,(this.config.getConfig("projections")||[]).forEach(b=>{b.alias=b.alias?b.alias:b.code,this.registerProjection(b)});for(let b=1;b<61;b++)this.registerProjection({code:b<10?`EPSG:3260${b}`:`EPSG:326${b}`,def:`+proj=utm +zone=${b} +datum=WGS84 +units=m +no_defs`,extent:void 0});for(let b=1;b<11;b++){const E=b<10?`EPSG:3218${b}`:`EPSG:321${80+b}`;let T;T=Number(b)<=2?-50-3*Number(b):Number(b)>=12?-81-3*(Number(b)-12):-49.5-3*Number(b),this.registerProjection({code:E,def:`+proj=tmerc +lat_0=0 +lon_0=${T} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"`,extent:void 0})}}registerProjection(x){g.c.defs(x.code,x.def),d.sV(g.c),x.extent&&e._M(x.code).setExtent(x.extent)}static \u0275fac=function(w){return new(w||h)(R.CoB(y.aW))};static \u0275prov=R.wxM({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})()},72124:(Ee,ce,s)=>{"use strict";s.d(ce,{Q:()=>g});var y=s(2500),d=(s(89500),s(34896));let g=(()=>{class R{map;layers;pos1;pos3;inDragAction=!1;swipeEnabled$$;boundPrerender=this.prerender.bind(this);constructor(){}ngAfterViewInit(){this.getListOfLayers(),this.swipeEnabled$$=this.map.swipeEnabled$.subscribe(h=>{h?this.displaySwipe():this.displaySwipeOff()}),this.letZoom()}ngOnDestroy(){this.swipeEnabled$$.unsubscribe(),this.map.swipeEnabled$.unsubscribe(),this.displaySwipeOff()}displaySwipe(){this.swipeId&&(this.swipeId.style.visibility="visible"),this.layers.map(h=>h.ol.on("prerender",this.boundPrerender)),this.layers.map(h=>h.ol.on("postrender",this.postrender)),this.map.ol.render()}displaySwipeOff(){this.swipeId&&(this.swipeId.style.visibility="hidden"),this.layers.map(h=>h.ol.un("prerender",this.boundPrerender)),this.layers.map(h=>h.ol.un("postrender",this.postrender)),this.map.ol.render(),this.layers=[]}get swipeId(){return document.getElementById("igo-layer-swipe")}getListOfLayers(){this.map.selectedFeatures$.subscribe(h=>{if(this.layers=[],null!==h)for(const j of h)this.layers.includes(j)||this.layers.push(j)})}dragDown(h){this.inDragAction=!0,h.preventDefault(),"mousedown"===h.type?(this.pos3=h.clientX,this.mouseSwipe(),document.onmouseup=this.closeDragMouseElement):"touchstart"===h.type&&(document.getElementById("arrows").style.visibility="hidden",this.pos3=h.touches[0].clientX,this.touchSwipe(),document.ontouchend=this.closeDragTouchElement)}mouseSwipe(){document.addEventListener("mousemove",h=>{this.inDragAction&&(h.preventDefault(),this.pos1=this.pos3-h.clientX,this.pos3=h.clientX,this.swipeId.style.left=this.swipeId.offsetLeft-this.pos1+"px"),this.map.ol.render()})}touchSwipe(){document.addEventListener("touchmove",h=>{this.inDragAction&&(h.preventDefault(),document.getElementById("arrows").style.visibility="hidden",this.pos1=this.pos3-h.changedTouches[0].clientX,this.pos3=h.changedTouches[0].clientX,this.swipeId.style.left=this.swipeId.offsetLeft-this.pos1+"px"),this.map.ol.render()})}closeDragMouseElement(){document.onmouseup=null,document.onmousemove=null,this.inDragAction=!1}closeDragTouchElement(){document.ontouchend=null,document.ontouchmove=null,document.getElementById("arrows").style.visibility="visible",this.inDragAction=!1}prerender(h){const j=h.context,x=this.map.ol.getSize(),w=this.swipeId.offsetLeft,b=(0,y.sv)(h,[w,0]),E=(0,y.sv)(h,[0,0]),T=(0,y.sv)(h,[w,x[1]]),a=(0,y.sv)(h,[0,x[1]]);j.save(),j.beginPath(),j.moveTo(b[0],b[1]),j.lineTo(T[0],T[1]),j.lineTo(a[0],a[1]),j.lineTo(E[0],E[1]),j.closePath(),j.clip()}postrender(h){h.context.restore(),h.context.save()}letZoom(){document.getElementById("igo-layer-swipe").addEventListener("wheel",h=>{h.deltaY>0?this.map.viewController.zoomOut():this.map.viewController.zoomIn()},!0)}static \u0275fac=function(j){return new(j||R)};static \u0275cmp=d.In1({type:R,selectors:[["igo-swipe-control"]],inputs:{map:"map"},standalone:!0,features:[d.UHJ],decls:5,vars:0,consts:[["id","igo-layer-swipe",1,"igo-swipe-control-container",3,"mousedown","mouseup","touchstart","touchend"],[1,"igo-swipe-control-line"],["id","arrows",1,"igo-swipe-control-arrows"],[1,"igo-arrow-left"],[1,"igo-arrow-right"]],template:function(j,x){1&j&&(d.I0R(0,"div",0),d.qCj("mousedown",function(b){return x.dragDown(b)})("mouseup",function(){return x.closeDragMouseElement()})("touchstart",function(b){return x.dragDown(b)})("touchend",function(){return x.closeDragTouchElement()}),d.wR5(1,"div",1),d.I0R(2,"div",2),d.wR5(3,"div",3)(4,"div",4),d.C$Y()())},styles:[".igo-swipe-control-container[_ngcontent-%COMP%]{position:absolute;width:80px;height:100%;top:0%;left:50%;cursor:grab;z-index:1;transform:translate(-40px)}.igo-swipe-control-container[_ngcontent-%COMP%]:active{cursor:grabbing}.igo-swipe-control-line[_ngcontent-%COMP%]{position:absolute;width:4px;height:100%;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#5e5a5a}.igo-swipe-control-arrows[_ngcontent-%COMP%]{position:absolute;width:32px;height:32px;left:50%;top:50%;transform:translate(-50%,-50%);margin-top:-16px;padding:5px 4px;background-color:#5e5a5a;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0)}.igo-swipe-control-arrows[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:inline-block;width:0;height:0;border-top:10px solid transparent;border-bottom:10px solid transparent}.igo-swipe-control-arrows[_ngcontent-%COMP%]   .igo-arrow-right[_ngcontent-%COMP%]{margin-left:4px;border-left:10px solid white}.igo-swipe-control-arrows[_ngcontent-%COMP%]   .igo-arrow-left[_ngcontent-%COMP%]{border-right:10px solid white}.igo-swipe-control-arrows[_ngcontent-%COMP%]:active{display:none}"]})}return R})()},50208:(Ee,ce,s)=>{"use strict";s.d(ce,{w:()=>E});var y=s(65056),e=s(34672),d=s(32328),g=s(27e3),R=s(21720),o=s(64002),h=s(72584),j=s(60904),x=s.n(j),w=s(54844),b=s(34896);let E=(()=>{class T{storageService;color="primary";get enabled(){return this.storageService.get("wakeLockEnabled")}set enabled(K){this.storageService.set("wakeLockEnabled",K)}noSleep;icon$=new w.g("sleep");visible=!1;constructor(K){this.storageService=K,this.noSleep=new(x()),o.sX.satisfies({ie:">0",edge:"<84",chrome:"<84",firefox:">0",opera:"<70",safari:">0"})&&(this.disableWakeLock(),this.enabled=!1,window.addEventListener("blur",()=>{this.disableWakeLock(),this.enabled=!1})),this.enabled?this.enableWakeLock():this.disableWakeLock()}enableWakeLock(){this.noSleep.enable(),this.enabled=!0,this.icon$.next("sleep-off")}disableWakeLock(){this.noSleep.disable(),this.enabled=!1,this.icon$.next("sleep")}toggleWakeLock(){this.enabled?this.disableWakeLock():this.enableWakeLock()}static \u0275fac=function(M){return new(M||T)(b.GI1(R.yQ))};static \u0275cmp=b.In1({type:T,selectors:[["igo-wake-lock-button"]],inputs:{color:"color",enabled:"enabled"},standalone:!0,features:[b.UHJ],decls:6,vars:9,consts:[[1,"igo-wake-lock-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"color","matTooltip","click"],[3,"svgIcon"]],template:function(M,L){1&M&&(b.I0R(0,"div",0)(1,"button",1),b.qCj("click",function(){return L.toggleWakeLock()}),b.wVc(2,"translate"),b.wVc(3,"translate"),b.wR5(4,"mat-icon",2),b.wVc(5,"async"),b.C$Y()()),2&M&&(b.yG2(),b.E7m("color",L.color)("matTooltip",L.enabled?b.kDX(2,3,"igo.geo.mapButtons.preventScreenLock"):b.kDX(3,5,"igo.geo.mapButtons.letScreenLock")),b.yG2(3),b._6D("svgIcon",b.kDX(5,7,L.icon$)))},dependencies:[e.oJ,e.um,g.KO,g.a4,d.oB,d.qL,y.a,h.O0,h.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-wake-lock-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-wake-lock-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return T})()},75872:(Ee,ce,s)=>{"use strict";s.d(ce,{q:()=>j});var y=s(34672),e=s(32328),d=s(27e3),g=s(72584),o=(s(89500),s(34896));const h=x=>({zoom:x});let j=(()=>{class x{map;color;get zoom(){return this.map.viewController.getZoom()}get minZoom(){return this.map.viewController.olView.getMinZoom()||1}get maxZoom(){return this.map.viewController.olView.getMaxZoom()}constructor(){}static \u0275fac=function(E){return new(E||x)};static \u0275cmp=o.In1({type:x,selectors:[["igo-zoom-button"]],inputs:{map:"map",color:"color"},standalone:!0,features:[o.UHJ],decls:7,vars:16,consts:[[1,"igo-zoom-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","disabled","click"],["svgIcon","plus"],["svgIcon","minus"]],template:function(E,T){1&E&&(o.I0R(0,"div",0)(1,"button",1),o.qCj("click",function(){return T.map.viewController.zoomIn()}),o.wVc(2,"translate"),o.wR5(3,"mat-icon",2),o.C$Y(),o.I0R(4,"button",1),o.qCj("click",function(){return T.map.viewController.zoomOut()}),o.wVc(5,"translate"),o.wR5(6,"mat-icon",3),o.C$Y()()),2&E&&(o.yG2(),o.E7m("matTooltip",o.g7$(2,6,"igo.geo.mapButtons.zoomIn",o.S45(12,h,T.zoom+1)))("color",T.color)("disabled",T.zoom>=T.maxZoom),o.yG2(3),o.E7m("matTooltip",o.g7$(5,9,"igo.geo.mapButtons.zoomOut",o.S45(14,h,T.zoom-1)))("color",T.color)("disabled",T.zoom<=T.minZoom))},dependencies:[y.oJ,y.um,d.KO,d.a4,e.oB,e.qL,g.O0,g.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]{width:40px}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#fff}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#efefef}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-bottom:2px}"]})}return x})()},49312:(Ee,ce,s)=>{"use strict";s.d(ce,{K8:()=>y.K8,y:()=>d.y,wP:()=>y.wP,aK:()=>y.aK,ox:()=>y.ox,cD:()=>y.cD,ie:()=>y.ie});var y=s(45076),d=(s(87080),s(79280))},87080:(Ee,ce,s)=>{"use strict";s.d(ce,{j:()=>g});var y=s(69904),e=s(8512),d=s(34896);let g=(()=>{class R{transform(h,j,x=!1,w=1){let b;return Object.values(y.Mh).indexOf(j)>=0?b=(0,e.Ej)(h,j):Object.values(y.K8).indexOf(j)>=0&&(b=(0,e.iK)(h,j)),b&&(0,e.wP)(b,{decimal:1,unit:j,unitAbbr:x,locale:"fr"})}static \u0275fac=function(j){return new(j||R)};static \u0275pipe=d.UTH({name:"measureFormat",type:R,pure:!0,standalone:!0})}return R})()},79280:(Ee,ce,s)=>{"use strict";s.d(ce,{y:()=>Rt});var y=s(65056),e=s(34672),d=s(24296),g=s(75180),R=s(32328),o=s(43424),h=s(27e3),j=s(62228),x=s(24708),w=s(21720),b=s(64002),E=s(83552),T=s(12396),a=s(28772),K=s(54776),M=s(72584),L=s(54844),oe=s(68013),N=s(3544),B=s(39844),X=s(41912),V=s(99228),W=(s(89500),s(69904)),A=s(8512),q=s(40600),_=s(87080),u=s(34896);function S(Ze,Kt){if(1&Ze&&(u.I0R(0,"table",3)(1,"thead")(2,"tr")(3,"th",4),u.OEk(4),u.wVc(5,"translate"),u.C$Y()()(),u.I0R(6,"tbody")(7,"tr")(8,"td"),u.OEk(9),u.wVc(10,"measureFormat"),u.C$Y(),u.I0R(11,"td"),u.OEk(12),u.wVc(13,"translate"),u.C$Y()(),u.I0R(14,"tr")(15,"td"),u.OEk(16),u.wVc(17,"measureFormat"),u.C$Y(),u.I0R(18,"td"),u.OEk(19),u.wVc(20,"translate"),u.C$Y()(),u.I0R(21,"tr")(22,"td"),u.OEk(23),u.wVc(24,"measureFormat"),u.C$Y(),u.I0R(25,"td"),u.OEk(26),u.wVc(27,"translate"),u.C$Y()(),u.I0R(28,"tr")(29,"td"),u.OEk(30),u.wVc(31,"measureFormat"),u.C$Y(),u.I0R(32,"td"),u.OEk(33),u.wVc(34,"translate"),u.C$Y()()()()),2&Ze){const ve=u.GaO();u.yG2(4),u.oRS(" ",u.kDX(5,9,"igo.geo.measure.dialog.length.title")," "),u.yG2(5),u.cNF(u.g7$(10,11,ve.data.length,ve.measureLengthUnit.Meters)),u.yG2(3),u.cNF(u.kDX(13,14,"igo.geo.measure.dialog.lengthInMeters")),u.yG2(4),u.oRS(" ",u.g7$(17,16,ve.data.length,ve.measureLengthUnit.Kilometers)," "),u.yG2(3),u.cNF(u.kDX(20,19,"igo.geo.measure.dialog.lengthInKilometers")),u.yG2(4),u.cNF(u.g7$(24,21,ve.data.length,ve.measureLengthUnit.Miles)),u.yG2(3),u.cNF(u.kDX(27,24,"igo.geo.measure.dialog.lengthInMiles")),u.yG2(4),u.cNF(u.g7$(31,26,ve.data.length,ve.measureLengthUnit.Feet)),u.yG2(3),u.cNF(u.kDX(34,29,"igo.geo.measure.dialog.lengthInFeet"))}}function P(Ze,Kt){if(1&Ze&&(u.I0R(0,"table",3)(1,"thead")(2,"tr")(3,"th",4),u.OEk(4),u.wVc(5,"translate"),u.C$Y()()(),u.I0R(6,"tbody")(7,"tr")(8,"td"),u.OEk(9),u.wVc(10,"measureFormat"),u.C$Y(),u.I0R(11,"td"),u.OEk(12),u.wVc(13,"translate"),u.C$Y()(),u.I0R(14,"tr")(15,"td"),u.OEk(16),u.wVc(17,"measureFormat"),u.C$Y(),u.I0R(18,"td"),u.OEk(19),u.wVc(20,"translate"),u.C$Y()(),u.I0R(21,"tr")(22,"td"),u.OEk(23),u.wVc(24,"measureFormat"),u.C$Y(),u.I0R(25,"td"),u.OEk(26),u.wVc(27,"translate"),u.C$Y()(),u.I0R(28,"tr")(29,"td"),u.OEk(30),u.wVc(31,"measureFormat"),u.C$Y(),u.I0R(32,"td"),u.OEk(33),u.wVc(34,"translate"),u.C$Y()(),u.I0R(35,"tr")(36,"td"),u.OEk(37),u.wVc(38,"measureFormat"),u.C$Y(),u.I0R(39,"td"),u.OEk(40),u.wVc(41,"translate"),u.C$Y()(),u.I0R(42,"tr")(43,"td"),u.OEk(44),u.wVc(45,"translate"),u.C$Y(),u.I0R(46,"td"),u.OEk(47),u.wVc(48,"measureFormat"),u.C$Y()()()()),2&Ze){const ve=u.GaO();u.yG2(4),u.oRS(" ",u.kDX(5,13,"igo.geo.measure.dialog.area.title")," "),u.yG2(5),u.cNF(u.g7$(10,15,ve.data.area,ve.measureAreaUnit.SquareMeters)),u.yG2(3),u.cNF(u.kDX(13,18,"igo.geo.measure.dialog.areaInSquareMeters")),u.yG2(4),u.oRS(" ",u.g7$(17,20,ve.data.area,ve.measureAreaUnit.SquareKilometers)," "),u.yG2(3),u.oRS(" ",u.kDX(20,23,"igo.geo.measure.dialog.areaInSquareKilometers")," "),u.yG2(4),u.cNF(u.g7$(24,25,ve.data.area,ve.measureAreaUnit.SquareMiles)),u.yG2(3),u.cNF(u.kDX(27,28,"igo.geo.measure.dialog.areaInSquareMiles")),u.yG2(4),u.cNF(u.g7$(31,30,ve.data.area,ve.measureAreaUnit.Acres)),u.yG2(3),u.cNF(u.kDX(34,33,"igo.geo.measure.dialog.areaInAcres")),u.yG2(4),u.cNF(u.g7$(38,35,ve.data.area,ve.measureAreaUnit.Hectares)),u.yG2(3),u.cNF(u.kDX(41,38,"igo.geo.measure.dialog.areaInHectares")),u.yG2(4),u.cNF(u.kDX(45,40,"igo.geo.measure.dialog.perimeterInMeters")),u.yG2(3),u.cNF(u.g7$(48,42,ve.data.perimeter,ve.measureLengthUnit.Meters))}}let I=(()=>{class Ze{dialogRef;data;measureAreaUnit=W.Mh;measureLengthUnit=W.K8;constructor(ve,$e){this.dialogRef=ve,this.data=$e}onNoClick(){this.dialogRef.close()}static \u0275fac=function($e){return new($e||Ze)(u.GI1(q.yI),u.GI1(q.sR))};static \u0275cmp=u.In1({type:Ze,selectors:[["igo-measurer-dialog"]],standalone:!0,features:[u.UHJ],decls:6,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["class","mat-typography",4,"ngIf"],[1,"mat-typography"],["colspan","2"]],template:function($e,Ne){1&$e&&(u.I0R(0,"h3",0),u.OEk(1),u.wVc(2,"translate"),u.C$Y(),u.I0R(3,"div",1),u.yuY(4,S,35,31,"table",2)(5,P,49,45,"table",2),u.C$Y()),2&$e&&(u.yG2(),u.cNF(u.kDX(2,3,"igo.geo.measure.dialog.title")),u.yG2(3),u.E7m("ngIf",Ne.data.length>0),u.yG2(),u.E7m("ngIf",Ne.data.area>0))},dependencies:[q.WQ,q.iU,y.u_,M.O0,M.sD,_.j],styles:["[_nghost-%COMP%]{font-family:Roboto,Helvetica Neue,sans-serif}h3[_ngcontent-%COMP%]{text-align:center;margin:0}table[_ngcontent-%COMP%]{width:100%;padding:10px}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{padding-left:10px}"]})}return Ze})();var U=s(46176),G=s(50244),O=s(42536),F=s(77872);function Q(Ze,Kt){if(1&Ze&&(u.I0R(0,"mat-option",5),u.OEk(1),u.wVc(2,"translate"),u.C$Y()),2&Ze){const ve=Kt.$implicit;u.E7m("value",ve),u.yG2(),u.oRS(" ",u.kDX(2,2,"igo.geo.measure."+ve)," ")}}let r=(()=>{class Ze{measure$=new L.g(void 0);measure$$;measureType;measureUnit;set measure(ve){this.measure$.next(ve)}get measure(){return this.measure$.value}set auto(ve){this.toggleAutoUnit(ve)}get auto(){return this._auto}_auto=!1;placeholder;measureUnitChange=new u._w7;get measureUnits(){return Object.values(this.measureType===W.gn.Area?W.Mh:W.K8)}constructor(){}ngOnDestroy(){this.toggleAutoUnit(!1)}onMeasureUnitChange(ve){this.measureUnit=ve,this.measureUnitChange.emit(ve)}toggleAutoUnit(ve){void 0!==this.measure$$&&this.measure$$.unsubscribe(),!0===ve&&(this.measure$$=this.measure$.subscribe($e=>{this.computeBestMeasureUnit($e)})),this._auto=ve}computeBestMeasureUnit(ve){let $e=this.measureUnit;this.measureType===W.gn.Area?$e=(0,A.AX)(ve):this.measureType===W.gn.Length&&($e=(0,A.Gs)(ve)),$e!==this.measureUnit&&this.onMeasureUnitChange($e)}static \u0275fac=function($e){return new($e||Ze)};static \u0275cmp=u.In1({type:Ze,selectors:[["igo-measurer-item"]],inputs:{measureType:"measureType",measureUnit:"measureUnit",measure:"measure",auto:"auto",placeholder:"placeholder"},outputs:{measureUnitChange:"measureUnitChange"},standalone:!0,features:[u.UHJ],decls:9,vars:12,consts:[["floatLabel","always",1,"measure-field"],["matInput","",3,"disabled","readonly","value"],[1,"unit-field"],[3,"value","disabled","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function($e,Ne){1&$e&&(u.I0R(0,"mat-form-field",0)(1,"mat-label"),u.OEk(2),u.C$Y(),u.wR5(3,"input",1),u.wVc(4,"measureFormat"),u.wVc(5,"async"),u.C$Y(),u.I0R(6,"mat-form-field",2)(7,"mat-select",3),u.qCj("selectionChange",function(dt){return Ne.onMeasureUnitChange(dt.value)}),u.yuY(8,Q,3,4,"mat-option",4),u.C$Y()()),2&$e&&(u.yG2(2),u.cNF(Ne.placeholder),u.yG2(),u.E7m("disabled",!0)("readonly",!0)("value",u.g7$(4,7,u.kDX(5,10,Ne.measure$)||0,Ne.measureUnit)),u.yG2(4),u.E7m("value",Ne.measureUnit)("disabled",Ne.auto),u.yG2(),u.E7m("ngForOf",Ne.measureUnits))},dependencies:[G.wb,G.Up,G.w5,O.cN,O.yi,F.d5,F.kX,U.I5,y.Iw,U.Ax,y.a,M.O0,M.sD,_.j],styles:["[_nghost-%COMP%]{display:flex;width:100%;padding:5px 10px}[_nghost-%COMP%]   .measure-field[_ngcontent-%COMP%]{pointer-events:none;flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{margin-left:8px;flex:1}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}"],changeDetection:0})}return Ze})();const ie=["table"];function ae(Ze,Kt){1&Ze&&u.wR5(0,"mat-divider")}function fe(Ze,Kt){if(1&Ze){const ve=u.KQA();u.I0R(0,"mat-slide-toggle",7),u.qCj("change",function(Ne){u.usT(ve);const Ae=u.GaO();return u.CGJ(Ae.onToggleDisplayLines(Ne.checked))}),u.OEk(1),u.wVc(2,"translate"),u.C$Y()}if(2&Ze){const ve=u.GaO();u.E7m("checked",ve.displayLines)("labelPosition","before"),u.yG2(),u.oRS(" ",u.kDX(2,3,"igo.geo.measure.toggleDisplayLines")," ")}}function le(Ze,Kt){1&Ze&&u.wR5(0,"mat-divider")}function ue(Ze,Kt){if(1&Ze){const ve=u.KQA();u.I0R(0,"mat-slide-toggle",7),u.qCj("change",function(Ne){u.usT(ve);const Ae=u.GaO();return u.CGJ(Ae.onToggleDisplayDistance(Ne.checked))}),u.OEk(1),u.wVc(2,"translate"),u.C$Y()}if(2&Ze){const ve=u.GaO();u.E7m("checked",ve.displayDistance)("labelPosition","before"),u.yG2(),u.oRS(" ",u.kDX(2,3,"igo.geo.measure.toggleDisplayDistance")," ")}}function se(Ze,Kt){if(1&Ze){const ve=u.KQA();u.I0R(0,"mat-slide-toggle",7),u.qCj("change",function(Ne){u.usT(ve);const Ae=u.GaO();return u.CGJ(Ae.onToggleDisplayAreas(Ne.checked))}),u.OEk(1),u.wVc(2,"translate"),u.C$Y()}if(2&Ze){const ve=u.GaO();u.E7m("checked",ve.displayAreas)("labelPosition","before"),u.yG2(),u.oRS(" ",u.kDX(2,3,"igo.geo.measure.toggleDisplayAreas")," ")}}function ge(Ze,Kt){1&Ze&&u.wR5(0,"mat-divider")}function Ie(Ze,Kt){if(1&Ze){const ve=u.KQA();u.I0R(0,"igo-measurer-item",14),u.qCj("measureUnitChange",function(Ne){u.usT(ve);const Ae=u.GaO(2);return u.CGJ(Ae.onLengthUnitChange(Ne))}),u.wVc(1,"translate"),u.C$Y()}if(2&Ze){const ve=u.GaO().ngIf,$e=u.GaO();u.E7m("measureType",$e.measureType.Length)("measureUnit",$e.activeLengthUnit)("measure",ve.length)("auto",$e.measureUnitsAuto)("placeholder",u.kDX(1,5,$e.activeMeasureType===$e.measureType.Area?"igo.geo.measure.perimeter":"igo.geo.measure.length"))}}function Re(Ze,Kt){if(1&Ze){const ve=u.KQA();u.I0R(0,"igo-measurer-item",14),u.qCj("measureUnitChange",function(Ne){u.usT(ve);const Ae=u.GaO(2);return u.CGJ(Ae.onAreaUnitChange(Ne))}),u.wVc(1,"translate"),u.C$Y()}if(2&Ze){const ve=u.GaO().ngIf,$e=u.GaO();u.E7m("measureType",$e.measureType.Area)("measureUnit",$e.activeAreaUnit)("measure",ve.area)("auto",$e.measureUnitsAuto)("placeholder",u.kDX(1,5,"igo.geo.measure.area"))}}function He(Ze,Kt){if(1&Ze&&(u.SAx(0),u.yuY(1,Ie,2,7,"igo-measurer-item",13)(2,Re,2,7,"igo-measurer-item",13),u.k70()),2&Ze){const ve=u.GaO();u.yG2(),u.E7m("ngIf",ve.activeMeasureType===ve.measureType.Length||ve.activeMeasureType===ve.measureType.Area),u.yG2(),u.E7m("ngIf",ve.activeMeasureType===ve.measureType.Area)}}function ht(Ze,Kt){1&Ze&&u.wR5(0,"mat-divider")}function rt(Ze,Kt){if(1&Ze){const ve=u.KQA();u.I0R(0,"button",15),u.qCj("click",function(){u.usT(ve);const Ne=u.GaO();return u.CGJ(Ne.onCalculateClick())}),u.wVc(1,"translate"),u.wVc(2,"async"),u.wR5(3,"mat-icon",16),u.C$Y()}if(2&Ze){const ve=u.GaO();u.E7m("matTooltip",u.kDX(1,2,"igo.geo.measure.actionbar.calculate.tooltip"))("disabled",0===u.kDX(2,4,ve.selectedFeatures$).length)}}function xt(Ze,Kt){if(1&Ze){const ve=u.KQA();u.I0R(0,"button",17),u.qCj("click",function(){u.usT(ve);const Ne=u.GaO();return u.CGJ(Ne.onDeleteClick())}),u.wVc(1,"translate"),u.wVc(2,"async"),u.wR5(3,"mat-icon",18),u.C$Y()}if(2&Ze){const ve=u.GaO();u.E7m("matTooltip",u.kDX(1,2,"igo.geo.measure.actionbar.delete.tooltip"))("disabled",0===u.kDX(2,4,ve.selectedFeatures$).length)}}let Rt=(()=>{class Ze{languageService;dialog;storageService;document;tableTemplate;subscriptions$$=[];measureType=W.gn;measureAreaUnit=W.Mh;measureLengthUnit=W.K8;measureUnitsAuto=!1;displayDistance=!0;displayLines=!0;displayAreas=!0;hasLine$=new L.g(!1);hasArea$=new L.g(!1);measure$=new L.g({});selectedFeatures$=new L.g([]);showTooltips=!0;drawControlIsDisabled=!0;drawLineControl;drawPolygonControl;modifyControl;activeOlGeometry;activeLengthUnit=W.K8.Meters;activeAreaUnit=W.Mh.SquareMeters;onFeatureAddedKey;onFeatureRemovedKey;activeDrawControl;drawStart$$;drawEnd$$;drawChanges$$;modifyStart$$;modifyEnd$$;modifyChanges$$;selectedFeatures$$;olDrawSource=new a.c;map;store;set activeMeasureType(ve){this.setActiveMeasureType(ve)}get activeMeasureType(){return this._activeMeasureType}_activeMeasureType;minSegmentLength=10;table;get drawControlIsActive(){return void 0!==this.activeDrawControl}get projection(){return this.map.ol.getView().getProjection().getCode()}constructor(ve,$e,Ne,Ae){this.languageService=ve,this.dialog=$e,this.storageService=Ne,this.document=Ae,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,columns:[{name:"length",title:this.languageService.translate.instant("igo.geo.measure.lengthHeader"),valueAccessor:dt=>{const je=this.activeLengthUnit,Ke=(0,A.iK)(dt.properties.measure.length,je);return(0,A.wP)(Ke,{decimal:1,unit:je,unitAbbr:!1,locale:"fr"})}},{name:"area",title:this.languageService.translate.instant("igo.geo.measure.areaHeader"),valueAccessor:dt=>{const je=this.activeAreaUnit,Ke=(0,A.Ej)(dt.properties.measure.area,je);return Ke?(0,A.wP)(Ke,{decimal:1,unit:je,unitAbbr:!1,locale:"fr"}):""}}]}}ngOnInit(){this.getSavedUnits(),this.initStore(),this.createDrawLineControl(),this.createDrawPolygonControl(),this.createModifyControl(),this.toggleDrawControl(),this.updateTooltipsOfOlSource(this.store.source.ol),this.checkDistanceAreaToggle(),this.setActiveMeasureType(W.gn.Length)}ngOnDestroy(){this.setActiveMeasureType(void 0),this.deactivateModifyControl(),this.freezeStore(),this.subscriptions$$.map(ve=>ve.unsubscribe())}onMeasureTypeChange(ve){this.activeMeasureType=ve}onToggleDrawControl(ve){!0===ve?this.toggleDrawControl():this.deactivateDrawControl()}onToggleMeasureUnitsAuto(ve){this.measureUnitsAuto=ve}onToggleDisplayDistance(ve){this.displayDistance=ve,this.onDisplayDistance(),this.storageService.set("distanceToggle",!!ve,w.Ab.SESSION)}onToggleDisplayLines(ve){this.displayLines=ve,this.onDisplayLines(),this.storageService.set("linesToggle",!!ve,w.Ab.SESSION)}onToggleDisplayAreas(ve){this.displayAreas=ve,this.onDisplayAreas(),this.storageService.set("areasToggle",!!ve,w.Ab.SESSION)}checkDistanceAreaToggle(){!1===this.storageService.get("distanceToggle")&&(this.displayDistance=!1),!1===this.storageService.get("linesToggle")&&(this.displayLines=!1),!1===this.storageService.get("areasToggle")&&(this.displayAreas=!1)}onDisplayDistance(){const ve=this.document.getElementsByClassName("igo-map-tooltip-measure-polygone-segments");this.displayDistance?Array.from(ve).map($e=>$e.classList.remove("igo-map-tooltip-hidden")):Array.from(ve).map($e=>$e.classList.add("igo-map-tooltip-hidden"))}onDisplayLines(){const ve=this.document.getElementsByClassName("igo-map-tooltip-measure-line-segments");this.displayLines?Array.from(ve).map($e=>{$e.classList.remove("igo-map-tooltip-hidden")}):Array.from(ve).map($e=>{$e.classList.add("igo-map-tooltip-hidden")})}onDisplayAreas(){const ve=this.document.getElementsByClassName("igo-map-tooltip-measure-area");this.displayAreas?Array.from(ve).map($e=>$e.classList.remove("igo-map-tooltip-hidden")):Array.from(ve).map($e=>$e.classList.add("igo-map-tooltip-hidden"))}onLengthUnitChange(ve){this.activeLengthUnit=ve,this.saveCurrentUnits(),this.refreshTableAndTooltip()}onAreaUnitChange(ve){this.activeAreaUnit=ve,this.saveCurrentUnits(),this.refreshTableAndTooltip()}refreshTableAndTooltip(){this.store.stateView.clear(),this.updateTooltipsOfOlSource(this.store.source.ol),void 0!==this.activeOlGeometry&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)}onCalculateClick(){const ve=this.selectedFeatures$.value,$e=ve.reduce((dt,je)=>dt+je.properties.measure.area||0,0),Ne=ve.reduce((dt,je)=>"Polygon"===je.geometry.type?dt:dt+je.properties.measure.length||0,0),Ae=ve.reduce((dt,je)=>"LineString"===je.geometry.type?dt:dt+je.properties.measure.length||0,0);this.openDialog({area:$e,length:Ne,perimeter:Ae})}onDeleteClick(){this.store.deleteMany(this.selectedFeatures$.value),this.selectedFeatures$.value.forEach(ve=>{this.olDrawSource.getFeatures().forEach($e=>{const Ne=$e.getGeometry();ve.properties.id===Ne.ol_uid&&this.olDrawSource.removeFeature($e)})})}onModifyClick(){if(1===this.selectedFeatures$.value.length)if(!0===this.modifyControl.active)this.deactivateModifyControl(),this.toggleDrawControl();else{const ve=this.selectedFeatures$.value[0],Ne=this.store.layer.ol.getSource().getFeatures().find(Ae=>Ae.get("id")===ve.properties.id);if(void 0!==Ne){this.deactivateDrawControl(),this.activateModifyControl();const Ae=Ne.getGeometry();this.clearTooltipsOfOlGeometry(Ae),this.modifyControl.setOlGeometry(Ae)}}}openDialog(ve){this.dialog.open(I,{data:ve})}initStore(){const ve=this.store,$e=new V.Md({title:this.languageService.translate.instant("igo.geo.measure.layerTitle"),isIgoInternalLayer:!0,id:`igo-measures-${(0,b.uq)()}`,zIndex:200,source:new N.EB,style:(0,A.wr)(),showInLayerList:!0,exportable:!0,browsable:!1,workspace:{enabled:!1}});(0,B.mM)(ve,$e),ve.layer.visible=!0,$e.visible$.subscribe(Ne=>{const Ae=this.document.getElementsByClassName("igo-map-tooltip-measure");Ne?Array.from(Ae).map(dt=>dt.classList.remove("igo-map-tooltip-measure-by-display")):Array.from(Ae).map(dt=>dt.classList.add("igo-map-tooltip-measure-by-display"))}),(0,B.sf)(ve),(0,B.Uz)(ve,new B.kj({map:this.map,many:!0})),this.onFeatureAddedKey=ve.source.ol.on("addfeature",Ne=>{const Ae=Ne.feature,dt=Ae.getGeometry();this.updateMeasureOfOlGeometry(dt,Ae.get("measure")),this.onDisplayDistance(),this.onDisplayLines(),this.onDisplayAreas()}),this.onFeatureRemovedKey=ve.source.ol.on("removefeature",Ne=>{const Ae=Ne.feature.getGeometry();this.clearTooltipsOfOlGeometry(Ae)}),this.selectedFeatures$$=ve.stateView.manyBy$(Ne=>!0===Ne.state.selected).pipe((0,oe.s)(1)).subscribe(Ne=>{!0===this.modifyControl.active&&this.deactivateModifyControl(),this.selectedFeatures$.next(Ne.map(Ae=>Ae.entity))}),this.subscriptions$$.push(this.store.entities$.subscribe(Ne=>{Ne.find(Ae=>"Polygon"===Ae.geometry.type)?this.hasArea$.next(!0):this.hasArea$.next(!1),Ne.find(Ae=>"LineString"===Ae.geometry.type)?this.hasLine$.next(!0):this.hasLine$.next(!1)})),this.subscriptions$$.push(this.store.count$.subscribe(Ne=>{this.store.layer.options.showInLayerList=Ne>=1}))}freezeStore(){const ve=this.store;this.selectedFeatures$$.unsubscribe(),(0,E.S)(this.onFeatureAddedKey),(0,E.S)(this.onFeatureRemovedKey),ve.deactivateStrategyOfType(B.E9),ve.deactivateStrategyOfType(B.kj)}createDrawLineControl(){this.drawLineControl=new X.i4({geometryType:"LineString",drawingLayerSource:this.olDrawSource,interactionStyle:(0,A.yK)(),drawingLayerStyle:new K.cp({})})}createDrawPolygonControl(){this.drawPolygonControl=new X.i4({geometryType:"Polygon",drawingLayerSource:this.olDrawSource,interactionStyle:(0,A.yK)(),drawingLayerStyle:new K.cp({})})}createModifyControl(){this.modifyControl=new X.Up({source:this.olDrawSource,drawStyle:(0,A.yK)(),layerStyle:new K.cp({})})}toggleDrawControl(){this.deactivateDrawControl(),this.activeMeasureType===W.gn.Length?this.activateDrawControl(this.drawLineControl):this.activeMeasureType===W.gn.Area&&this.activateDrawControl(this.drawPolygonControl)}activateDrawControl(ve){this.drawControlIsDisabled=!1,this.activeDrawControl=ve,this.drawStart$$=ve.start$.subscribe($e=>this.onDrawStart($e)),this.drawEnd$$=ve.end$.subscribe($e=>this.onDrawEnd($e)),this.drawChanges$$=ve.changes$.subscribe($e=>this.onDrawChanges($e)),this.drawChanges$$=ve.abort$.subscribe($e=>{this.clearTooltipsOfOlGeometry($e),this.clearMeasures()}),ve.setOlMap(this.map.ol,!1)}deactivateDrawControl(){void 0!==this.activeDrawControl&&(this.olDrawSource.clear(),void 0!==this.drawStart$$&&this.drawStart$$.unsubscribe(),void 0!==this.drawEnd$$&&this.drawEnd$$.unsubscribe(),void 0!==this.drawChanges$$&&this.drawChanges$$.unsubscribe(),this.clearTooltipsOfOlSource(this.olDrawSource),void 0!==this.activeOlGeometry&&this.clearTooltipsOfOlGeometry(this.activeOlGeometry),this.activeDrawControl.setOlMap(void 0),this.activeDrawControl=void 0,this.activeOlGeometry=void 0)}setActiveMeasureType(ve){this._activeMeasureType=ve,this.clearMeasures(),this.toggleDrawControl()}onDrawStart(ve){this.activeOlGeometry=ve}onDrawEnd(ve){this.activeOlGeometry=void 0,this.finalizeMeasureOfOlGeometry(ve),this.addFeatureToStore(ve),this.clearTooltipsOfOlGeometry(ve),this.olDrawSource.clear(!0)}onDrawChanges(ve){const $e=(0,A.ox)(ve,this.projection);this.updateMeasureOfOlGeometry(ve,Object.assign({},$e,{area:void 0})),this.measure$.next($e)}activateModifyControl(){const ve=this.store.getStrategyOfType(B.kj);ve.deactivate(),ve.clear(),this.modifyStart$$=this.modifyControl.start$.subscribe($e=>this.onModifyStart($e)),this.modifyEnd$$=this.modifyControl.end$.subscribe($e=>this.onModifyEnd($e)),this.modifyChanges$$=this.modifyControl.changes$.subscribe($e=>this.onModifyChanges($e)),this.modifyControl.setOlMap(this.map.ol)}deactivateModifyControl(){void 0!==this.modifyStart$$&&this.modifyStart$$.unsubscribe(),void 0!==this.modifyEnd$$&&this.modifyEnd$$.unsubscribe(),void 0!==this.modifyChanges$$&&this.modifyChanges$$.unsubscribe(),void 0!==this.activeOlGeometry&&(1===this.selectedFeatures$.value.length&&this.addFeatureToStore(this.activeOlGeometry,this.selectedFeatures$.value[0]),this.finalizeMeasureOfOlGeometry(this.activeOlGeometry)),this.olDrawSource.clear(),this.store.activateStrategyOfType(B.kj),this.activeOlGeometry=void 0,this.modifyControl.setOlMap(void 0)}onModifyStart(ve){this.onDrawStart(ve)}onModifyChanges(ve){this.onDrawChanges(ve)}onModifyEnd(ve){this.finalizeMeasureOfOlGeometry(ve)}finalizeMeasureOfOlGeometry(ve){const $e=(0,A.ox)(ve,this.projection);this.updateMeasureOfOlGeometry(ve,$e)}updateMeasureOfOlGeometry(ve,$e){ve.setProperties({_measure:$e},!0),this.updateTooltipsOfOlGeometry(ve)}clearMeasures(){this.measure$.next({})}addFeatureToStore(ve,$e){const Ne=$e?$e.properties.id:ve.ol_uid,Ae=this.map.ol.getView().getProjection(),dt=(new T.c).writeGeometryObject(ve,{featureProjection:Ae,dataProjection:Ae});this.store.update({type:B.Yf,geometry:dt,projection:Ae.getCode(),properties:{id:Ne,measure:ve.get("_measure")},meta:{id:Ne}})}updateTooltipsOfOlGeometry(ve){const $e=ve.get("_measure"),Ne=$e.lengths,Ae=$e.area,dt=(0,A.Og)(ve);if(Ne.length===dt.length)for(let je=0;je<dt.length;je++){const Ke=Ne[je];void 0!==Ke&&this.updateOlTooltip(dt[je],(0,A.iK)(Ke,this.activeLengthUnit),this.activeLengthUnit,W.gn.Length)}void 0!==Ae&&this.updateOlTooltip((0,A.IP)(ve),(0,A.Ej)(Ae,this.activeAreaUnit),this.activeAreaUnit,W.gn.Area)}showTooltipsOfOlGeometry(ve){(0,A.aK)(ve).forEach($e=>{this.shouldShowTooltip($e)&&this.map.ol.addOverlay($e)})}clearTooltipsOfOlGeometry(ve){(0,A.aK)(ve).forEach($e=>{void 0!==$e&&void 0!==$e.getMap()&&this.map.ol.removeOverlay($e)})}updateTooltipsOfOlSource(ve){ve.forEachFeature($e=>{this.updateTooltipsOfOlGeometry($e.getGeometry())})}showTooltipsOfOlSource(ve){ve.forEachFeature($e=>{this.showTooltipsOfOlGeometry($e.getGeometry())})}clearTooltipsOfOlSource(ve){ve.forEachFeature($e=>{void 0!==$e.getGeometry()&&this.clearTooltipsOfOlGeometry($e.getGeometry())})}updateOlTooltip(ve,$e,Ne,Ae){ve.setProperties({_measure:$e,_unit:Ne,_type:Ae},!0),ve.getElement().innerHTML=this.computeTooltipInnerHTML(ve),this.shouldShowTooltip(ve)&&this.map.ol.addOverlay(ve)}computeTooltipInnerHTML(ve){const $e=ve.getProperties();return(0,A.wP)($e._measure,{decimal:1,unit:$e._unit,unitAbbr:!0,locale:"fr"},this.languageService)}shouldShowTooltip(ve){if(!1===this.showTooltips)return!1;const $e=ve.getProperties(),Ne=$e._measure;if(void 0===Ne)return!1;if($e._unit===W.gn.Length){const Ae=(0,A.iK)(this.minSegmentLength,$e._unit)||0;return Ne>Math.max(Ae,0)}return!0}saveCurrentUnits(){this.storageService.set("distanceUnit",this.activeLengthUnit,w.Ab.SESSION),this.storageService.set("areaUnit",this.activeAreaUnit,w.Ab.SESSION)}getSavedUnits(){const ve=this.storageService.get("distanceUnit"),$e=this.storageService.get("areaUnit");this.activeLengthUnit=ve||this.activeLengthUnit,this.activeAreaUnit=$e||this.activeAreaUnit}static \u0275fac=function($e){return new($e||Ze)(u.GI1(x.ov),u.GI1(q.qW),u.GI1(w.yQ),u.GI1(y.Ud))};static \u0275cmp=u.In1({type:Ze,selectors:[["igo-measurer"]],viewQuery:function($e,Ne){if(1&$e&&u.CC$(ie,7),2&$e){let Ae;u.wto(Ae=u.Gqi())&&(Ne.table=Ae.first)}},inputs:{map:"map",store:"store",activeMeasureType:"activeMeasureType",minSegmentLength:"minSegmentLength"},standalone:!0,features:[u.UHJ],decls:43,vars:60,consts:[[1,"measure-type-toggle","mat-typography"],[3,"value","change"],[3,"value"],[1,"measure-options","mat-typography"],[3,"disabled","checked","labelPosition","change"],[4,"ngIf"],[3,"checked","labelPosition","change",4,"ngIf"],[3,"checked","labelPosition","change"],[1,"measure-store-buttons"],["mat-icon-button","","color","accent",3,"matTooltip","disabled","click",4,"ngIf"],["mat-icon-button","","color","warn",3,"matTooltip","disabled","click",4,"ngIf"],[1,"table-compact",3,"store","template"],["table",""],[3,"measureType","measureUnit","measure","auto","placeholder","measureUnitChange",4,"ngIf"],[3,"measureType","measureUnit","measure","auto","placeholder","measureUnitChange"],["mat-icon-button","","color","accent",3,"matTooltip","disabled","click"],["svgIcon","calculator"],["mat-icon-button","","color","warn",3,"matTooltip","disabled","click"],["svgIcon","delete"]],template:function($e,Ne){1&$e&&(u.I0R(0,"div")(1,"div",0)(2,"mat-button-toggle-group",1),u.qCj("change",function(dt){return Ne.onMeasureTypeChange(dt.value)}),u.I0R(3,"mat-button-toggle",2),u.OEk(4),u.wVc(5,"translate"),u.C$Y(),u.I0R(6,"mat-button-toggle",2),u.OEk(7),u.wVc(8,"translate"),u.C$Y()()(),u.I0R(9,"div",3)(10,"mat-slide-toggle",4),u.qCj("change",function(dt){return Ne.onToggleDrawControl(dt.checked)}),u.OEk(11),u.wVc(12,"translate"),u.C$Y(),u.yuY(13,ae,1,0,"mat-divider",5),u.wVc(14,"async"),u.yuY(15,fe,3,5,"mat-slide-toggle",6),u.wVc(16,"async"),u.yuY(17,le,1,0,"mat-divider",5),u.wVc(18,"async"),u.wVc(19,"async"),u.yuY(20,ue,3,5,"mat-slide-toggle",6),u.wVc(21,"async"),u.yuY(22,se,3,5,"mat-slide-toggle",6),u.wVc(23,"async"),u.yuY(24,ge,1,0,"mat-divider",5),u.wVc(25,"async"),u.I0R(26,"mat-slide-toggle",7),u.qCj("change",function(dt){return Ne.onToggleMeasureUnitsAuto(dt.checked)}),u.OEk(27),u.wVc(28,"translate"),u.C$Y()(),u.yuY(29,He,3,2,"ng-container",5),u.wVc(30,"async"),u.yuY(31,ht,1,0,"mat-divider",5),u.wVc(32,"async"),u.wVc(33,"async"),u.I0R(34,"div",8),u.yuY(35,rt,4,6,"button",9),u.wVc(36,"async"),u.wVc(37,"async"),u.yuY(38,xt,4,6,"button",10),u.wVc(39,"async"),u.wVc(40,"async"),u.C$Y(),u.wR5(41,"igo-entity-table",11,12),u.C$Y()),2&$e&&(u.yG2(2),u.E7m("value",Ne.activeMeasureType),u.yG2(),u.E7m("value",Ne.measureType.Length),u.yG2(),u.oRS(" ",u.kDX(5,24,"igo.geo.measure."+Ne.measureType.Length)," "),u.yG2(2),u.E7m("value",Ne.measureType.Area),u.yG2(),u.oRS(" ",u.kDX(8,26,"igo.geo.measure."+Ne.measureType.Area)," "),u.yG2(3),u.E7m("disabled",Ne.drawControlIsDisabled)("checked",Ne.drawControlIsActive)("labelPosition","before"),u.yG2(),u.oRS(" ",u.kDX(12,28,"igo.geo.measure.toggleActive")," "),u.yG2(2),u.E7m("ngIf",u.kDX(14,30,Ne.hasLine$)),u.yG2(2),u.E7m("ngIf",u.kDX(16,32,Ne.hasLine$)),u.yG2(2),u.E7m("ngIf",u.kDX(18,34,Ne.hasLine$)||u.kDX(19,36,Ne.hasArea$)),u.yG2(3),u.E7m("ngIf",u.kDX(21,38,Ne.hasArea$)),u.yG2(2),u.E7m("ngIf",u.kDX(23,40,Ne.hasArea$)),u.yG2(2),u.E7m("ngIf",u.kDX(25,42,Ne.hasArea$)),u.yG2(2),u.E7m("checked",Ne.measureUnitsAuto)("labelPosition","before"),u.yG2(),u.oRS(" ",u.kDX(28,44,"igo.geo.measure.toggleAutoUnits")," "),u.yG2(2),u.E7m("ngIf",u.kDX(30,46,Ne.measure$)),u.yG2(2),u.E7m("ngIf",u.kDX(32,48,Ne.hasLine$)||u.kDX(33,50,Ne.hasArea$)),u.yG2(4),u.E7m("ngIf",u.kDX(36,52,Ne.hasLine$)||u.kDX(37,54,Ne.hasArea$)),u.yG2(3),u.E7m("ngIf",u.kDX(39,56,Ne.hasLine$)||u.kDX(40,58,Ne.hasArea$)),u.yG2(3),u.E7m("store",Ne.store)("template",Ne.tableTemplate))},dependencies:[d.ue,d.gn,d.KU,o.GE,o.cP,y.u_,g.U,g.k,r,e.oJ,e.um,h.KO,h.a4,R.oB,R.qL,j.Eh,y.a,M.O0,M.sD],styles:["[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .measure-store-buttons[_ngcontent-%COMP%]{margin-left:-2px}[_nghost-%COMP%]   .measure-store-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-of-type{margin-left:14px}[_nghost-%COMP%]   .table-compact[_ngcontent-%COMP%]     .mat-mdc-header-cell.mat-column-selectionCheckbox{width:52px}[_nghost-%COMP%]   .igo-map-tooltip[_ngcontent-%COMP%]{position:relative;border-radius:4px;padding:4px 8px;white-space:nowrap}  .igo-map-tooltip-hidden, .igo-map-tooltip-measure-by-display[_ngcontent-%COMP%]{display:none}"],changeDetection:0})}return Ze})()},45076:(Ee,ce,s)=>{"use strict";s.d(ce,{K8:()=>y.K8,aK:()=>e.aK,cD:()=>e.cD,ie:()=>e.ie,ox:()=>e.ox,wP:()=>e.wP});var y=s(69904),e=s(8512)},69904:(Ee,ce,s)=>{"use strict";s.d(ce,{K8:()=>d,Ks:()=>g,Mh:()=>R,gn:()=>e,kK:()=>o});var e=function(h){return h.Length="length",h.Area="area",h}(e||{}),d=function(h){return h.Meters="meters",h.Kilometers="kilometers",h.Miles="miles",h.Feet="feet",h}(d||{});const g={[d.Meters]:"m",[d.Kilometers]:"km",[d.Miles]:"mi",[d.Feet]:"ft"};var R=function(h){return h.SquareMeters="squareMeters",h.SquareKilometers="squareKilometers",h.SquareMiles="squareMiles",h.SquareFeet="squareFeet",h.Hectares="hectares",h.Acres="acres",h}(R||{});const o={[R.SquareMeters]:"m\xb2",[R.SquareKilometers]:"km\xb2",[R.SquareMiles]:"mi\xb2",[R.SquareFeet]:"ft\xb2",[R.Hectares]:"ha",[R.Acres]:"ac"}},8512:(Ee,ce,s)=>{"use strict";s.d(ce,{AX:()=>A,Ej:()=>V,Gs:()=>W,IP:()=>ie,Og:()=>F,aK:()=>fe,aS:()=>S,cD:()=>u,iK:()=>X,ie:()=>I,ox:()=>P,wP:()=>z,wr:()=>_,yK:()=>q});var y=s(28276),e=s(94448),d=s(28668),g=s(62808),R=s(80848),o=s(36752),h=s(49412),j=s(54776),x=s(45212),w=s(88872),b=s(87544),E=s(69904);function T(ue){return.001*ue}function a(ue){return 3.2808*ue}function K(ue){return 621e-6*ue}function M(ue){return 1e-6*ue}function L(ue){return 3.861e-7*ue}function oe(ue){return 10.764*ue}function N(ue){return 1e-4*ue}function B(ue){return 24711e-8*ue}function X(ue,se){const Ie=new Map([[E.K8.Meters,Re=>Re],[E.K8.Kilometers,T],[E.K8.Miles,K],[E.K8.Feet,a]]).get(se);return Ie?Ie(ue):void 0}function V(ue,se){const Ie=new Map([[E.Mh.SquareMeters,Re=>Re],[E.Mh.SquareKilometers,M],[E.Mh.SquareMiles,L],[E.Mh.SquareFeet,oe],[E.Mh.Hectares,N],[E.Mh.Acres,B]]).get(se);return Ie?Ie(ue):void 0}function z(ue,se,ge){let Ie=se.decimal;(void 0===Ie||Ie<0)&&(Ie=1);const Re=[];return Re.push(void 0!==se.locale?ue.toLocaleString(se.locale,{minimumFractionDigits:Ie,maximumFractionDigits:Ie}):ue.toFixed(Ie).toString()),void 0!==se.unit&&!0===se.unitAbbr&&Re.push(ge?ge.translate.instant(E.Ks[se.unit]?"igo.geo.measure."+E.Ks[se.unit]:"igo.geo.measure."+E.kK[se.unit]):E.Ks[se.unit]||E.kK[se.unit]),Re.filter(He=>void 0!==He).join(" ")}function W(ue){let se=E.K8.Meters,ge=ue;const Ie=[E.K8.Kilometers];for(;ge>1e3&&Ie.length>0;)se=Ie.pop(),ge=X(ue,se);return se}function A(ue){let se=E.Mh.SquareMeters,ge=ue;const Ie=[E.Mh.SquareKilometers];for(;ge>1e6&&Ie.length>0;)se=Ie.pop(),ge=V(ue,se);return se}function q(){return new j.cp({stroke:new x.c({color:"#ffcc33",lineDash:[10,10],width:2}),fill:new w.c({color:"rgba(255, 255, 255, 0.2)"}),image:new b.c({radius:5,stroke:new x.c({color:"#ffcc33"}),fill:new w.c({color:"rgba(255, 255, 255, 0.2)"})})})}function _(){return new j.cp({stroke:new x.c({color:"#ffcc33",width:2}),fill:new w.c({color:"rgba(255, 255, 255, 0.2)"})})}function u(ue,se){if(!(ue instanceof R.c)&&0!==ue.getFlatCoordinates().length)return(0,h.S2)(ue,{projection:se})}function S(ue,se){if(!(ue instanceof R.c||ue instanceof g.c)&&0!==ue.getFlatCoordinates().length)return(0,h.kh)(ue,{projection:se})}function P(ue,se){const ge=u(ue,se),Ie=S(ue,se),Re=[],He=ue.getFlatCoordinates(),ht=He.length;for(let rt=0;rt<=ht-4;rt+=2){const xt=new g.c([[He[rt],He[rt+1]],[He[rt+2],He[rt+3]]]);Re.push(u(xt,se))}return{area:Ie,length:ge,lengths:Re}}function I(ue){let se;if(ue instanceof R.c){const ge=new R.c(ue.getFlatCoordinates());se=new Array(1),se[0]=ge}else{se=G(ue);const ge=ue.getFlatCoordinates(),Ie=se.length;for(let Re=0;Re<Ie;Re++){const He=2*Re,rt=new g.c([[ge[He],ge[He+1]],[ge[He+2],ge[He+3]]]).getCoordinateAt(.5),xt=se[Re];void 0!==xt?xt.setCoordinates(rt):se[Re]=new R.c(rt)}}return se}function G(ue){let se;se=ue instanceof d.c?0:Math.max(ue.getFlatCoordinates().length/2-1,0);let ge=ue.get("_midpoints");if(void 0===ge)return ge=new Array(ue instanceof R.c?1:se),ue.set("_midpoints",ge,!0),ge;if(0===se||se===ge.length)return ge;if(se>ge.length)return ge.push(...new Array(se-ge.length)),ge;for(let Ie=se;Ie<ge.length;Ie++){const Re=ge[se];void 0!==Re&&O(Re)}return ge.splice(se),ge}function O(ue){const se=ue.get("_tooltip");if(void 0!==se){const ge=se.getMap();void 0!==ge&&ge.removeOverlay(se)}}function F(ue){const se=I(ue);let ge="";return ue instanceof g.c?ge="line-":ue instanceof o.cp&&(ge="polygone-"),se.map(Re=>{let He=Re.get("_tooltip");return void 0===He?He=le(Re,!1,ge):He.setPosition(Re.getFlatCoordinates()),He})}function ie(ue){const se=function r(ue){let se=ue.get("_center");const ge=(0,e.Ks)(ue.getExtent());return void 0!==se?se.setCoordinates(ge):(se=new R.c(ge),ue.set("_center",se)),se}(ue);let ge=se.get("_tooltip");return void 0===ge?ge=le(se,!0):ge.setPosition(se.getFlatCoordinates()),ge}function fe(ue){const se=[].concat(function Q(ue){return G(ue).map(ge=>ge?ge.get("_tooltip"):void 0)}(ue)||[]),ge=function ae(ue){const se=ue.get("_center");return se?se.get("_tooltip"):void 0}(ue);return void 0!==ge&&se.push(ge),se}function le(ue,se=!1,ge=""){const Ie=new y.c({element:document.createElement("div"),offset:[-30,-10],className:(se?["igo-map-tooltip","igo-map-tooltip-measure","igo-map-tooltip-measure-area"]:["igo-map-tooltip","igo-map-tooltip-measure",`igo-map-tooltip-measure-${ge}segments`]).join(" "),stopEvent:!1});return Ie.setPosition(ue.getFlatCoordinates()),ue.set("_tooltip",Ie),Ie}},96659:(Ee,ce,s)=>{"use strict";s.d(ce,{G:()=>y});var y=function(e){return e.System="system",e.User="user",e}(y||{})},31112:(Ee,ce,s)=>{"use strict";s.d(ce,{U:()=>w});var y=s(64002),e=s(96832),d=s(61616),g=s(1296),R=s(83680),o=s(10211),h=s(40604),j=s(37496),x=s(34896);let w=(()=>{class b{ngxIndexedDBService;dbName="geoData";collisionsMap=new Map;_newData=0;compression=new y.C3;constructor(T){this.ngxIndexedDBService=T}update(T,a,K,M,L){if(!K)return;let oe=!1;const N=new d.E;let X,B=(0,g.of)(K);return K instanceof Blob&&(B=this.compression.compressBlob(K),oe=!0),B.pipe((0,R.K)(),(0,o.m)(V=>(X={url:T,regionID:a,object:V,compressed:oe,insertSource:M,insertEvent:L},this.ngxIndexedDBService.getByID(this.dbName,T))),(0,o.m)(V=>{if(V){const z=V.regionID;if(z!==a){const W=this.collisionsMap.get(z);void 0!==W?(W.push(V.url),this.collisionsMap.set(z,W)):this.collisionsMap.set(z,[V.url])}return this.customUpdate(X)}return this._newData++,this.ngxIndexedDBService.add(this.dbName,X)})).subscribe(V=>{N.next(V),N.complete()}),N}customUpdate(T){const a=new d.E;return this.ngxIndexedDBService.deleteByKey(this.dbName,T.url).pipe((0,o.m)(M=>M?this.ngxIndexedDBService.add(this.dbName,T):(0,g.of)(void 0))).subscribe(M=>{M&&a.next(M),a.complete()}),a}get(T){return this.ngxIndexedDBService.getByID(this.dbName,T).pipe((0,h.k)(a=>{if(a){const K=a.object;return a.compressed?this.compression.decompressBlob(K):K}}))}getByID(T){return this.ngxIndexedDBService.getByID(this.dbName,T)}deleteByKey(T){return this.ngxIndexedDBService.deleteByKey(this.dbName,T)}getRegionCountByID(T){const a=new d.E;return this.getRegionByID(T).subscribe(M=>{a.next(M.length),a.complete()}),a}getRegionByID(T){if(!T)return;const a=IDBKeyRange.only(T);return this.ngxIndexedDBService.getAllByIndex(this.dbName,"regionID",a)}deleteByRegionID(T){if(!T)return;const a=IDBKeyRange.only(T),K=this.ngxIndexedDBService.getAllByIndex(this.dbName,"regionID",a);return K.subscribe(M=>{M.forEach(L=>{this.ngxIndexedDBService.deleteByKey(this.dbName,L.url)})}),K}openCursor(T=IDBKeyRange.lowerBound(0),a=e.aI.readonly){return this.ngxIndexedDBService.openCursorByIndex(this.dbName,"regionID",T,a)}resetCounters(){this.resetCollisionsMap(),this._newData=0}resetCollisionsMap(){this.collisionsMap=new Map}revertCollisions(){for(const[T,a]of this.collisionsMap)for(const K of a)this.ngxIndexedDBService.getByKey(this.dbName,K).pipe((0,j.U)(1)).subscribe(M=>{M.regionID=T,this.customUpdate(M)})}get newData(){return this._newData}static \u0275fac=function(a){return new(a||b)(x.CoB(e.aQ))};static \u0275prov=x.wxM({token:b,factory:b.\u0275fac,providedIn:"root"})}return b})()},39532:(Ee,ce,s)=>{"use strict";s.d(ce,{U:()=>o});var y=s(39882),e=s(31112),d=s(34896),g=s(33712);let o=(()=>{class h{http;geoDBService;networkService;networkOnline=!0;constructor(x,w,b){this.http=x,this.geoDBService=w,this.networkService=b,this.networkService.currentState().subscribe(E=>{this.networkOnline=E.connection})}get(x,w){return window.navigator.onLine&&this.networkOnline?this.getOnline(x,w):this.getOffline(x)}getOnline(x,w){let b;switch(w.responseType){case"arraybuffer":b=this.http.get(x,{responseType:"arraybuffer",withCredentials:w.withCredentials});break;case"text":b=this.http.get(x,{responseType:"text",withCredentials:w.withCredentials});break;case"json":b=this.http.get(x,{responseType:"json",withCredentials:w.withCredentials});break;default:b=this.http.get(x,{responseType:"blob",withCredentials:w.withCredentials})}return b}getOffline(x){return this.geoDBService.get(x)}isOnline(){return this.networkOnline&&window.navigator.onLine}static \u0275fac=function(w){return new(w||h)(d.CoB(g.KK),d.CoB(e.U),d.CoB(y.u))};static \u0275prov=d.wxM({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})()},36404:(Ee,ce,s)=>{"use strict";s.d(ce,{m:()=>d});var y=s(76572),e=s(25607);class d{map;layer;get dataSource(){return this.layer.dataSource}constructor(R){this.layer=(0,e.c)(),this.setMap(R)}setMap(R){void 0===R?void 0!==this.map&&this.map.ol.removeLayer(this.layer.ol):R.ol.addLayer(this.layer.ol),this.map=R}setFeatures(R,o=y.Su.Default,h){if(h)for(const j of this.dataSource.ol.getFeatures())j.get("_sourceId")===h&&this.removeOlFeature(j);else this.clear();this.addFeatures(R,o)}addFeature(R,o=y.Su.Default){this.addFeatures([R],o)}addFeatures(R,o=y.Su.Default){const h=[];R.forEach(j=>{const x=(0,y.K6)(j,this.map.projection);null!==x.getGeometry()&&h.push(x)}),this.addOlFeatures(h,o)}addOlFeature(R,o=y.Su.Default){this.addOlFeatures([R],o)}addOlFeatures(R,o=y.Su.Default){this.dataSource.ol.addFeatures(R),(0,y.QX)(this.map.viewController,R,o)}removeFeature(R){this.removeFeatures([R])}removeFeatures(R){R.forEach(o=>{o.meta&&this.dataSource.ol.getFeatureById(o.meta.id)&&this.removeOlFeature(this.dataSource.ol.getFeatureById(o.meta.id))})}removeOlFeature(R){this.dataSource.ol.removeFeature(R)}clear(){this.dataSource.ol.clear()}}},25607:(Ee,ce,s)=>{"use strict";s.d(ce,{c:()=>g});var y=s(3544),e=s(2892),d=s(52756);function g(){const R=new y.EB;return new e.M({title:"Overlay",zIndex:300,source:R,style:(0,d.I)()})}},29272:(Ee,ce,s)=>{"use strict";s.d(ce,{K:()=>W});var y=s(35392),e=s(62228),d=s(23302),g=s(83600),R=s(24708),o=s(93020),h=s(64002),j=s(16772),x=s(96116),w=s.n(x),b=s(864),E=s(97104),T=s.n(E),a=s(61616),K=s(21296),M=s(44816),L=s(40604),N=s(59324);function B(A){const q=function(_,u){const S=_.join(" "),P=u[0],I=u[2],U=u[1],G=u[3],O=[G,P,U,P,U,I,G,I].join(" "),F=this.internal.newAdditionalObject(),Q=this.internal.newAdditionalObject(),r=this.internal.newAdditionalObject();r.content='<< /EPSG 3857 /Type /PROJCS /WKT (PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.017453292519943295]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",0.0],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]) >>',Q.content="<< /Bounds [ 0 1 0 0 1 0 1 1 ] /GCS "+r.objId+" 0 R /GPTS [ "+O+" ] /LPTS [ 0 1 0 0 1 0 1 1 ] /Subtype /GEO /Type /Measure >>",F.content="<< /BBox [ "+S+" ] /Measure "+Q.objId+" 0 R /Name (Layer) /Type /Viewport >>";const ie=this.internal.newAdditionalObject(),ae=(new Date).toLocaleDateString("en-CA");return ie.content="<< /Name IGO2 /Type /OCG /Date "+ae+" >>",F.objId};A.setGeoArea=function(_,u){this.internal.events.subscribe("putPage",function(){const S=q.call(this,_,u);this.internal.write("/VP [ "+S+" 0 R ]")})}}var X=s(47580),V=s(34896),z=s(33712);let W=(()=>{class A{http;messageService;activityService;languageService;configService;zipFile;nbFileToProcess;activityId;imgSizeAdded;mapPrintExtent;TEXTPDFFONT={titleFont:"Sans Serif",titleFontStyle:"bold",subtitleFont:"Sans Serif",subtitleFontStyle:"bold",commentFont:"Sans Serif",commentFontStyle:"normal",commentFontSize:12};constructor(_,u,S,P,I){this.http=_,this.messageService=u,this.activityService=S,this.languageService=P,this.configService=I}print(_,u){var S=this;const P=new a.E,I=u.paperFormat,U=+u.resolution,G=u.orientation,O=u.legendPosition;this.activityId=this.activityService.register(),B(b.default.API);const F=new b.default({orientation:G,format:I.toLowerCase(),unit:"mm"}),Q=[F.internal.pageSize.width,F.internal.pageSize.height],r=[10,10,10,10],ae=Q[1]-r[0]-r[2],fe=[Q[0]-r[3]-r[1],ae];let le,ue;(""!==u.title||""!==u.subtitle)&&(I===X.QH.A1||I===X.QH.A0)&&(r[0]+=10);const se=Math.round(2*(ae+145)*.05)/2;return void 0!==u.title&&""!==u.title&&(le=this.getTextPdfObjectSizeAndMarg(u.title,r,this.TEXTPDFFONT.titleFont,se,this.TEXTPDFFONT.titleFontStyle,F),this.addTextInPdfDoc(F,u.title,this.TEXTPDFFONT.titleFont,this.TEXTPDFFONT.titleFontStyle,le.fontSize,le.marginLeft+r[3],r[0]),r[0]=le.height+r[0]),void 0!==u.subtitle&&""!==u.subtitle&&(ue=this.getTextPdfObjectSizeAndMarg(u.subtitle,r,this.TEXTPDFFONT.subtitleFont,""!==u.title?.7*le.fontSize:.7*se,this.TEXTPDFFONT.subtitleFontStyle,F),this.addTextInPdfDoc(F,u.subtitle,this.TEXTPDFFONT.subtitleFont,this.TEXTPDFFONT.subtitleFontStyle,ue.fontSize,ue.marginLeft+r[3],r[0]),r[0]+=5),(!0===u.showProjection||!0===u.showScale)&&this.addProjScale(F,_,U,u.showProjection,u.showScale),void 0!==u.comment&&""!==u.comment&&this.addComment(F,u.comment),this.addMap(F,_,U,fe,r,O).subscribe(function(){var ge=(0,y.c)(function*(Ie){Ie===h.qM.Done&&(yield S.handleMeasureLayer(F,_,r),S.addGeoRef(F,S.imgSizeAdded[0],S.imgSizeAdded[1],r),"none"!==u.legendPosition?["topleft","topright","bottomleft","bottomright"].indexOf(u.legendPosition)>-1?yield S.addLegendSamePage(F,_,r,U,u.legendPosition):"newpage"===u.legendPosition&&(yield S.addLegend(F,_,r,U)):yield S.saveDoc(F)),(Ie===h.qM.Done||Ie===h.qM.Error)&&(S.activityService.unregister(S.activityId),P.next(h.qM.Done))});return function(Ie){return ge.apply(this,arguments)}}()),P}addGeoRef(_,u,S,P){const U=_.internal.pageSize.getHeight(),G=P[3],O=U-P[0]-S;let F=[G,O,G+u,O+S];for(let Q=0;Q<F.length;Q++)F[Q]=this.pdf_units2points(F[Q],"mm");_.setGeoArea(F,this.mapPrintExtent)}handleMeasureLayer(_,u,S){var P=this;return(0,y.c)(function*(){if(u.layers.find(I=>I.visible&&I.id.startsWith("igo-measures-"))){let I;const U=u.ol.getOverlayContainer();yield w()(U,{scale:1,backgroundColor:null}).then(G=>{I=G}),P.addCanvas(_,I,S)}})()}getLayersLegendHtml(_,u,S){return new K._(P=>{let I="";const U=function oe(A,q){const _=[];for(const u of A){const S=u.options.legendOptions;if(!1===u.visible)continue;const P=u.dataSource.getLegend(void 0,q)||[];for(const I of P)void 0!==I.url&&_.push({title:u.title||"",url:I.url,display:void 0===S?.display||S.display,isInResolutionsRange:u.isInResolutionsRange})}return _}(_.layers,{resolution:_.viewController.getResolution(),extent:_.viewController.getExtent(),projection:_.viewController.getOlProjection().getCode(),size:_.ol.getSize()});if(0===U.filter(O=>!0===O.display).length)return P.next(I),void P.complete();I+='<style media="screen" type="text/css">',I+=".html2canvas-container { width: "+u+"mm !important; height: 2000px !important; }",I+="table.tableLegend {table-layout: auto;}",I+="div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}",I+="</style>",I+='<font size="3" face="Times" >',I+='<div class="styleLegend">',I+='<table class="tableLegend" >';const G=U.filter(O=>O.display&&!0===O.isInResolutionsRange).map(O=>this.getDataImage(O.url).pipe((0,L.k)(F=>{let Q="<tr><td>"+O.title.toUpperCase()+"</td></tr>";return Q+='<tr><td><img src="'+F+'"></td></tr>',Q})));(0,M.y)(G).subscribe(O=>{I=O.reduce((F,Q)=>F+Q,I),I+="</table>",I+="</div>",P.next(I),P.complete()})})}getDataImage(_){return new e.kd(this.http,this.configService).transform(_)}getLayersLegendImage(_,u="png",S,P){var I=this;return(0,y.c)(function*(){const U=new a.E;let O=yield I.getLayersLegendHtml(_,200,P).toPromise();u=u.toLowerCase(),0===O.length&&(O='<font size="12" face="Courier New" >',O+='<div align="center"><b>NO LEGEND</b></div>');const F=window.document.createElement("div");F.style.position="absolute",F.style.top="0",F.style.zIndex="-1",window.document.body.appendChild(F),F.innerHTML=O,yield I.timeout(1);const Q=yield w()(F,{useCORS:!0}).catch(r=>{console.log(r)});if(I.removeHtmlElement(F),Q){let r=h.qM.Done;try{S?I.generateCanvaFileToZip(Q,"legendImage."+u):I.saveCanvasImageAsFile(Q,"legendImage",u)}catch{r=h.qM.Error}U.next(r)}return U})()}removeHtmlElement(_){_.parentNode.removeChild(_)}getTextPdfObjectSizeAndMarg(_,u,S,P,I,U){const F=U.internal.pageSize.getWidth()-u[1]-u[3];U.setFont(S,I),U.setFontSize(P);let r,Q=U.getTextDimensions(_);return Q.w>F?(r=0,U.setFontSize(P*=.7),Q=U.getTextDimensions(_)):r=(F-Q.w)/2,{fontSize:P,marginLeft:r,height:Q.h}}addComment(_,u){this.addTextInPdfDoc(_,u,this.TEXTPDFFONT.commentFont,this.TEXTPDFFONT.commentFontStyle,this.TEXTPDFFONT.commentFontSize,10,_.internal.pageSize.height-10,!0)}addTextInPdfDoc(_,u,S,P,I,U,G,O=!1){_.setFont(S,P),_.setFontSize(I),O&&(u=_.splitTextToSize(u,_.internal.pageSize.getWidth()-3*U)),_.text(u,U,G)}addProjScale(_,u,S,P,I){const U=this.languageService.translate,Q=_.internal.pageSize.height-15;let r="";if(!0===P&&(r+=U.instant("igo.geo.printForm.projection")+": "+u.projection),!0===I){!0===P&&(r+="   ");const ie=U.instant("igo.geo.printForm.scale"),ae=u.viewController.getScale(S);r+=ie+": ~ 1 / "+(0,N.rE)(ae)}_.setFont(this.TEXTPDFFONT.commentFont),_.setFontSize(12),_.text(r,10,Q)}addLegend(_,u,S,P){var I=this;return(0,y.c)(function*(){const U=_.internal.pageSize.width,G=yield I.getLayersLegendHtml(u,U,P).toPromise();if(""===G)return yield I.saveDoc(_),!0;const O=window.document.createElement("div");O.style.position="absolute",O.style.top="0",O.style.zIndex="-1",window.document.body.appendChild(O),O.innerHTML=G,yield I.timeout(1);const F=yield w()(O,{useCORS:!0}).catch(Q=>{console.log(Q)});if(I.removeHtmlElement(O),F){const r=[25.4*F.width*.85/P,25.4*F.height*.85/P];let ie;_.addPage(),ie=F.toDataURL("image/png"),_.addImage(ie,"PNG",10,10,r[0],r[1])}yield I.saveDoc(_)})()}addLegendSamePage(_,u,S,P,I){var U=this;return(0,y.c)(function*(){const G=_.internal.pageSize.width,O=yield U.getLayersLegendHtml(u,G,P).toPromise();if(""===O)return yield U.saveDoc(_),!0;const F=window.document.createElement("div");F.style.position="absolute",F.style.top="0",F.style.zIndex="-1",window.document.body.appendChild(F),F.innerHTML=O,yield U.timeout(1);const Q=yield w()(F,{useCORS:!0}).catch(ie=>{console.log(ie)});let r;if(U.removeHtmlElement(F),Q){const ae=[25.4*Q.width*.85/P,25.4*Q.height*.85/P];"bottomright"===I?r=[_.internal.pageSize.height-S[2]-ae[1],S[1],S[2],_.internal.pageSize.width-S[1]-ae[0]]:"topright"===I?r=[S[0],S[1],_.internal.pageSize.height-S[0]-ae[1],_.internal.pageSize.width-S[1]-ae[0]]:"bottomleft"===I?r=[_.internal.pageSize.height-S[2]-ae[1]-15,_.internal.pageSize.width-S[3]-ae[0],S[2]+15,S[3]]:"topleft"===I&&(r=[S[0],_.internal.pageSize.width-S[3]-ae[0],_.internal.pageSize.height-S[0]-ae[1],S[3]]),U.addCanvas(_,Q,r),yield U.saveDoc(_)}})()}defineNbFileToProcess(_){this.nbFileToProcess=_}timeout(_){return new Promise(u=>setTimeout(u,_))}addCanvas(_,u,S){let P;if(u&&(P=u.toDataURL("image/png")),void 0!==P){if(P.length<20)return void console.log("Warning: An image cannot be print in pdf file");const I=this.getImageSizeToFitPdf(_,u,S);_.addImage(P,"PNG",S[3],S[0],I[0],I[1]),_.rect(S[3],S[0],I[0],I[1]),this.imgSizeAdded=I}}addMap(_,u,S,P,I,U){var G=this;const O=u.ol.getSize(),F=u.ol.getView().getResolution(),Q=this.setMapResolution(u,P,S,F),r=new a.E;let ie;return u.ol.once("rendercomplete",function(){var ae=(0,y.c)(function*(fe){const le=fe.target.getViewport().getElementsByTagName("canvas"),ue=yield G.drawMap(Q,le);G.mapPrintExtent=u.viewController.getExtent("EPSG:3857"),G.resetOriginalMapSize(u,O,F),yield G.drawMapControls(u,ue,U);const se=u.status$.subscribe(ge=>{if(clearTimeout(ie),ge!==h.qM.Done)return;se.unsubscribe();let Ie=h.qM.Done;try{0!==ue.width&&G.addCanvas(_,ue,I)}catch{Ie=h.qM.Error,G.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}r.next(Ie)});ie=window.setTimeout(()=>{se.unsubscribe();let ge=h.qM.Done;try{0!==ue.width&&G.addCanvas(_,ue,I)}catch{ge=h.qM.Error,G.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}G.resetOriginalMapSize(u,O,F),r.next(ge)},200)});return function(fe){return ae.apply(this,arguments)}}()),r}setMapResolution(_,u,S,P){const I=_.ol.getSize(),U=Math.round(u[0]*S/25.4),G=Math.round(u[1]*S/25.4);_.ol.setSize([U,G]);const F=Math.min(U/I[0],G/I[1]);return _.ol.getView().setResolution(P/F),[U,G]}resetOriginalMapSize(_,u,S){_.ol.setSize(u),_.ol.getView().setResolution(S),_.ol.updateSize(),_.ol.renderSync()}drawMap(_,u){var S=this;return(0,y.c)(function*(){const P=document.createElement("canvas");P.width=_[0],P.height=_[1];for(let I=0;I<u.length;I++){const U=u[I];U.width>0&&S.handleCanvas(U,P)}return P})()}handleCanvas(_,u){const S=u.getContext("2d"),P=_.parentElement.style.opacity||_.style.opacity;S.globalAlpha=""===P?1:Number(P);const I=_.style.transform;let U;U=I?I.match(/^matrix\(([^\(]*)\)$/)[1].split(",").map(Number):[parseFloat(_.style.width)/_.width,0,0,parseFloat(_.style.height)/_.height,0,0],CanvasRenderingContext2D.prototype.setTransform.apply(S,U);const G=_.parentElement.style.backgroundColor;G&&(S.fillStyle=G,S.fillRect(0,0,_.width,_.height)),S.drawImage(_,0,0),S.globalAlpha=1,S.setTransform(1,0,0,1,0,0)}drawMapControls(_,u,S){var P=this;return(0,y.c)(function*(){const I=u.getContext("2d"),U=_.ol.getOverlayContainerStopEvent().cloneNode(!0);yield P.addNorthDirection(U,S),yield P.addAttribution(U),U.style.width=u.width+"px",U.style.height=u.height+"px",U.style.zIndex="-1",document.getElementsByClassName("ol-viewport")[0].appendChild(U);const G=yield w()(U,{scale:1,backgroundColor:null,allowTaint:!0,useCORS:!0});0!==G.width&&0!==G.height&&I.drawImage(G,0,0),U.remove()})()}addNorthDirection(_,u){return(0,y.c)(function*(){const S=document.getElementsByTagName("igo-rotation-button")[0].cloneNode(!0),P=S.getElementsByTagName("button")[0];if(!P)return null;"topright"===u&&(S.style.width="inherit",S.style.left="10px"),P.parentElement.style.background="transparent",P.style.color="#000",_.appendChild(S)})()}addAttribution(_){return(0,y.c)(function*(){const u=_.getElementsByClassName("ol-attribution")[0],S=u.getElementsByTagName("button")[0];if(!S)return null;S.setAttribute("data-html2canvas-ignore","true"),u.classList.contains("ol-collapsed")&&u.classList.remove("ol-collapsed")})()}downloadMapImage(_,u,S="png",P=!1,I=!1,U="",G="",O="",F=!0,Q){var r=this;const ie=new a.E;this.activityId=this.activityService.register();const ae=this.languageService.translate;S=S.toLowerCase();const fe=+u,le=_.ol.getSize(),ue=_.ol.getView().getResolution();return _.ol.once("rendercomplete",function(){var se=(0,y.c)(function*(ge){const Ie=_.ol.getSize(),Re=ge.target.getViewport().getElementsByTagName("canvas"),He=yield r.drawMap(Ie,Re);r.resetOriginalMapSize(_,le,ue),yield r.drawMapControls(_,He,Q),"none"!==Q&&(["topleft","topright","bottomleft","bottomright"].indexOf(Q)>-1?yield r.addLegendToImage(He,_,fe,Q,S):"newpage"===Q&&(yield r.getLayersLegendImage(_,S,F,fe)));const ht=document.createElement("canvas"),rt=ht.getContext("2d");let xt=0;const Rt=He.width;let Ze=He.height;rt.font="20px Calibri";const Kt=rt.measureText(O).width;Ze=""!==U?Ze+30:Ze,Ze=""!==G?Ze+30:Ze,Ze=!1!==P||!1!==I?Ze+30:Ze;const ve=Ze-10,$e=Math.ceil(Kt/Rt);Ze=""!==O?Ze+30*$e:Ze;let Ne=Ze-20*$e+5;if(ht.width=Rt,ht.height=Ze,["bmp","gif","jpeg","png","tiff"].indexOf(S)>-1&&("jpeg"===S||""!==U||""!==G||""!==O||!1!==P||!1!==I)&&(rt.fillStyle="#ffffff",rt.fillRect(0,0,Rt,Ze),rt.fillStyle="#000000"),""!==U&&(rt.font="26px Calibri",xt=30,rt.textAlign="center",rt.fillText(U,Rt/2,20,.9*Rt)),""!==G&&(rt.font="26px Calibri",xt=60,rt.textAlign="center",rt.fillText(G,Rt/2,50,.9*Rt)),rt.font="20px Calibri",!1!==P||!1!==I){let je="";if(!1!==P&&(je=ae.instant("igo.geo.printForm.projection")+": "+_.projection+"         "),!1!==I){const Ke=ae.instant("igo.geo.printForm.scale"),yt=_.viewController.getScale(fe);je+=Ke+": ~ 1 / "+(0,N.rE)(yt)}rt.textAlign="center",rt.fillText(je,Rt/2,ve,.9*Rt)}if(""!==O)if(rt.textAlign="center",1===$e)rt.fillText(O,Rt/2,Ne);else{const Ke=Math.floor(O.length/$e);let vt,yt="",Le=0;for(let Se=0;Se<$e;Se++)$e-1>Se?(yt=O.substr(Le,Ke),vt=yt.lastIndexOf(" "),rt.fillText(yt.substr(0,vt),Rt/2,Ne),Le+=vt,Ne+=20):rt.fillText(O.substr(Le),Rt/2,Ne)}rt.drawImage(He,0,xt);let Ae=h.qM.Done,dt="map."+S;"tiff"===S.toLowerCase()&&(dt="map"+_.projection.replace(":","_")+"."+S);try{F?(S.toLowerCase(),r.generateCanvaFileToZip(ht,dt)):r.saveCanvasImageAsFile(ht,dt,S)}catch{Ae=h.qM.Error}if(ie.next(Ae),"tiff"===S.toLowerCase()){const je=dt.substring(0,dt.toLowerCase().indexOf(".tiff"))+".tfw",Ke=r.getWorldFileInformation(_),yt=new Blob([Ke],{type:"text/plain;charset=utf-8"});F?r.addFileToZip(je,yt):((0,j.saveAs)(yt,je),r.saveFileProcessing())}});return function(ge){return se.apply(this,arguments)}}()),this.setMapImageResolution(_,le,fe,ue),ie}setMapImageResolution(_,u,S,P){const I=S/96,U=[Math.round(u[0]*I),Math.round(u[1]*I)];_.ol.setSize(U);const G=Math.min(U[0]/u[0],U[1]/u[1]);_.ol.getView().setResolution(P/G),_.ol.renderSync()}addLegendToImage(_,u,S,P,I){var U=this;return(0,y.c)(function*(){const G="map."+I,O=_.getContext("2d"),F=yield U.getLayersLegendHtml(u,_.width,S).toPromise();if(""===F)return yield U.saveCanvasImageAsFile(_,G,I),!0;const Q=window.document.createElement("div");Q.style.position="absolute",Q.style.top="0",Q.style.zIndex="-1",window.document.body.appendChild(Q),Q.innerHTML=F,yield U.timeout(1);const r=yield w()(Q,{useCORS:!0}).catch(ie=>{console.log(ie)});if(r){const ie=_.height,ae=_.width,fe=r.height,le=r.width,ue=.01*ie;let se,ge;return"bottomright"===P?(se=ae-le-ue,ge=ie-fe-ue):"topright"===P?(se=ae-le-ue,ge=ue):"bottomleft"===P?(se=ue,ge=ie-fe-ue-15):"topleft"===P&&(se=ue,ge=ue),O.drawImage(r,se,ge,le,fe),O.strokeRect(se,ge,le,fe),U.removeHtmlElement(Q),!0}})()}renderMap(_,u,S){_.ol.updateSize(),_.ol.renderSync()}saveDoc(_){return(0,y.c)(function*(){yield _.save("map_georef.pdf",{returnPromise:!0})})()}getImageSizeToFitPdf(_,u,S){const P=_.internal.pageSize.getHeight()-(S[0]+S[2]+10),I=_.internal.pageSize.getWidth()-(S[1]+S[3]),U=this.pdf_units2points(u.height,"mm"),G=this.pdf_units2points(u.width,"mm"),O=U/P,F=G/I,Q=O>F?O:F;return[Q>1?G/Q:G,Q>1?U/Q:U]}getWorldFileInformation(_){const u=_.viewController.getResolution(),S=_.viewController.getExtent();return[u,0,0,-u,S[0]+u/.5,S[3]-u/.5].join("\n")}saveCanvasImageAsFile(_,u,S){const P="image/"+S,I=this;try{_.toDataURL(),_.toBlob(U=>{(0,j.saveAs)(U,u),I.saveFileProcessing()},P)}catch{this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}}generateCanvaFileToZip(_,u){const P=this;(!this.hasOwnProperty("zipFile")||typeof this.zipFile>"u")&&(this.zipFile=new(T()));try{_.toDataURL(),navigator.msSaveBlob?this.addFileToZip(u,_.msToBlob()):_.toBlob(I=>{P.addFileToZip(u,I)},"image/jpeg")}catch{this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}}addFileToZip(_,u){this.zipFile.file(_,u),this.nbFileToProcess--,0===this.nbFileToProcess&&(this.getZipFile(),this.activityService.unregister(this.activityId))}saveFileProcessing(){this.nbFileToProcess--,0===this.nbFileToProcess&&this.activityService.unregister(this.activityId)}getZipFile(){const _=this;this.zipFile.generateAsync({type:"blob"}).then(u=>{(0,j.saveAs)(u,"map.zip"),delete _.zipFile})}pdf_units2points(_,u){let S=1;switch(u){case"pt":S=1;break;case"mm":S=72/25.4;break;case"cm":S=72/2.54;break;case"in":S=72;break;case"px":S=96/72;break;case"pc":case"em":S=12;break;case"ex":S=6;break;default:throw new Error("Invalid unit: "+u)}return _*S}static \u0275fac=function(u){return new(u||A)(V.CoB(z.KK),V.CoB(o.mi),V.CoB(d.U9),V.CoB(R.ov),V.CoB(g.aW))};static \u0275prov=V.wxM({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})()},47580:(Ee,ce,s)=>{"use strict";s.d(ce,{ID:()=>h,QH:()=>d,mw:()=>o,qp:()=>g,wR:()=>R,wf:()=>e});var y=s(64002);const e=(0,y.GC)(["Pdf","Image"]),d=(0,y.GC)(["A0","A1","A2","A3","A4","A5","Letter","Legal"]),g=(0,y.GC)(["landscape","portrait"]),R=["72","96","150","300"],o=(0,y.GC)(["Bmp","Gif","Jpeg","Png","Tiff"]),h=(0,y.GC)(["none","topright","topleft","bottomleft","bottomright","newpage"])},87048:(Ee,ce,s)=>{"use strict";s.d(ce,{s:()=>T});var y=s(34896),e=s(83552),d=s(24328),g=s(3360),R=s(1296),o=s(14672),h=s(18080),j=s(2892),x=s(9364),w=s(59324),b=s(93199),E=s(17400);let T=(()=>{class a{component;queryService;queries$$=[];mapClickListener;olDragSelectInteraction;olDragSelectInteractionEndKey;queryFeatures=!1;queryFeaturesHitTolerance=0;queryFeaturesCondition;waitForAllQueries=!0;query=new y._w7;get map(){return this.component.map}constructor(M,L){this.component=M,this.queryService=L}ngAfterViewInit(){this.listenToMapClick(),this.addDragBoxInteraction()}ngOnDestroy(){this.cancelOngoingQueries(),this.unlistenToMapClick(),this.removeDragBoxInteraction()}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",M=>this.onMapEvent(M))}unlistenToMapClick(){(0,e.S)(this.mapClickListener),this.mapClickListener=void 0}onMapEvent(M){if(this.cancelOngoingQueries(),!this.queryService.queryEnabled)return;const L=[];this.queryFeatures&&L.push(this.doQueryFeatures(M));const oe=this.map.ol.getView().getResolution(),N=this.map.layers.filter(E.wd);L.push(...this.queryService.query(N,{coordinates:M.coordinate,projection:this.map.projection,resolution:oe})),0!==L.length&&(this.waitForAllQueries?this.queries$$.push((0,g.E)(...L).subscribe(B=>{const X=[].concat(...B);this.query.emit({features:X,event:M})})):this.queries$$=L.map(B=>B.subscribe(X=>{this.query.emit({features:X,event:M})})))}doQueryFeatures(M){const L=[];if("singleclick"===M.type)this.map.ol.forEachFeatureAtPixel(M.pixel,(oe,N)=>{const B=this.map.getLayerById(N.values_._layer.id);if(!B.dataSource.options.queryFormatAsWms&&oe)if(oe.get("features"))for(const X of oe.get("features")){const V=(0,o.qK)(X,this.map.projection);V.meta={title:X.values_.nom,id:N.values_._layer.id+"."+X.id_,icon:X.values_._icon,sourceTitle:N.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(B)},L.push(V)}else if(oe instanceof d.cp){const X=(0,o.In)(oe,this.map.projection,N);X.meta={id:N.values_._layer.id+"."+X.meta.id,sourceTitle:N.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(B),title:this.queryService.getQueryTitle(X,B)||X.meta.title},L.push(X)}else{const X=(0,o.qK)(oe,this.map.projection,N);X.meta={id:N.values_._layer.id+"."+X.meta.id,sourceTitle:N.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(B),title:this.queryService.getQueryTitle(X,B)||X.meta.title},L.push(X)}},{hitTolerance:this.queryFeaturesHitTolerance||0,layerFilter:this.queryFeaturesCondition?this.queryFeaturesCondition:E.aA});else if("boxend"===M.type){const N=M.target.getGeometry().getExtent();this.map.layers.filter(E.wd).filter(B=>B instanceof j.M&&B.visible).map(B=>{B.dataSource.ol.forEachFeatureIntersectingExtent(N,V=>{const z=(0,o.qK)(V,this.map.projection,B.ol);z.meta={id:B.id+"."+V.getId(),icon:V.values_._icon,sourceTitle:B.title,alias:this.queryService.getAllowedFieldsAndAlias(B),title:this.queryService.getQueryTitle(z,B)||z.meta.title},L.push(z)})})}return(0,R.of)(L)}cancelOngoingQueries(){this.queries$$.forEach(M=>M.unsubscribe()),this.queries$$=[]}addDragBoxInteraction(){let M;const L=this.map.ol.getInteractions().getArray();for(const oe of L)if(oe instanceof h.E){M=oe;break}void 0===M&&(M=new h.E({condition:w.q}),this.map.ol.addInteraction(M),this.olDragSelectInteraction=M),this.olDragSelectInteractionEndKey=M.on("boxend",oe=>this.onMapEvent(oe))}removeDragBoxInteraction(){void 0!==this.olDragSelectInteractionEndKey&&(0,e.S)(this.olDragSelectInteractionEndKey),void 0!==this.olDragSelectInteraction&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=void 0}static \u0275fac=function(L){return new(L||a)(y.GI1(x.q,2),y.GI1(b.E))};static \u0275dir=y.Sc5({type:a,selectors:[["","igoQuery",""]],inputs:{queryFeatures:"queryFeatures",queryFeaturesHitTolerance:"queryFeaturesHitTolerance",queryFeaturesCondition:"queryFeaturesCondition",waitForAllQueries:"waitForAllQueries"},outputs:{query:"query"},standalone:!0})}return a})()},49704:(Ee,ce,s)=>{"use strict";s.d(ce,{Il:()=>d,cv:()=>e,s5:()=>y});var y=function(g){return g.GML2="gml2",g.GML3="gml3",g.JSON="json",g.GEOJSON="geojson",g.GEOJSON2="geojson2",g.ESRIJSON="esrijson",g.TEXT="text",g.HTML="html",g.HTMLGML2="htmlgml2",g}(y||{}),e=function(g){return g.GML2="application/vnd.ogc.gml",g.GML3="application/vnd.ogc.gml/3.1.1",g.JSON="application/json",g.GEOJSON="application/geojson",g.GEOJSON2="geojson",g.ESRIJSON="application/json",g.TEXT="text/plain",g.HTML="text/html",g.HTMLGML2="text/html",g}(e||{}),d=function(g){return g.IFRAME="iframe",g.BLANK="_blank",g}(d||{})},93199:(Ee,ce,s)=>{"use strict";s.d(ce,{E:()=>W});var y=s(93020),e=s(64002),d=s(94448),g=s(55784),R=s(10416),o=s(73592),h=s(95456),j=s(14984),x=s(30533),w=s(416),b=s(80848),E=s(62808),T=s(36752),a=s(1296),K=s(9240),M=s(40604),L=s(27164),oe=s.n(L),N=s(3544),B=s(68392),X=s(49704),V=s(34896),z=s(33712);let W=(()=>{class A{http;messageService;queryEnabled=!0;defaultFeatureCount=20;featureCount=20;previousMessageIds=[];constructor(_,u){this.http=_,this.messageService=u}query(_,u){this.previousMessageIds.length&&this.previousMessageIds.forEach(I=>{this.messageService.remove(I)});const S=_.filter(I=>I.visible&&I.isInResolutionsRange).map(I=>this.queryLayer(I,u));return[].concat.apply([],S)}queryLayer(_,u){const S=this.getQueryUrl(_.dataSource,u,!1,_.map.viewController.getExtent());if(!S)return(0,a.of)([]);const P=_.map.viewController.getResolution(),I=_.map.viewController.getScale();if(_.dataSource.options.queryFormat===X.s5.HTMLGML2){if("string"==typeof S){const O=this.getQueryUrl(_.dataSource,u,!0);return this.http.get(O,{responseType:"text"}).pipe((0,K.O)(F=>{const Q=this.mergeGML(F,S,_),r=Q[0],ie=Q[1];return this.http.get(S,{responseType:"text"}).pipe((0,M.k)(ae=>this.extractData(ae,_,u,S,r,ie)))}))}const U=this.getQueryUrl(_.dataSource,u,!0);let G=[];for(let O=0;O<U.length;O++){const F=U[O];this.checkScaleAndResolution(P,I,F)&&G.push(this.requestDataForHTMLGML2(F.url,S[O].url,_,u))}return G}{if("string"==typeof S)return this.http.get(S,{responseType:"text"}).pipe((0,M.k)(O=>this.extractData(O,_,u,S)));let U=[];for(let G=0;G<S.length;G++){const O=S[G];if(this.checkScaleAndResolution(P,I,O)){const F=this.http.get(O.url,{responseType:"text"});U.push(F.pipe((0,M.k)(Q=>this.extractData(Q,_,u,O.url))))}}return U}}requestDataForHTMLGML2(_,u,S,P){return this.http.get(_,{responseType:"text"}).pipe((0,K.O)(I=>{const U=this.mergeGML(I,u,S),G=U[0],O=U[1];return this.http.get(u,{responseType:"text"}).pipe((0,M.k)(F=>this.extractData(F,S,P,u,G,O)))}))}checkScaleAndResolution(_,u,S){let P,I;return!(S.minResolution||S.maxResolution||S.minScale||S.maxScale)||(S.minResolution&&S.maxResolution?_>=S.minResolution&&_<=S.maxResolution&&(I=!0):(S.minResolution&&_>=S.minResolution&&(I=!0),S.maxResolution&&_<=S.maxResolution&&(I=!0)),S.minScale&&S.maxScale?u>S.minScale&&u<S.maxScale&&(P=!0):(S.maxScale&&u<=S.maxScale&&(P=!0),S.minScale&&u>=S.minScale&&(P=!0)),!0===P&&!0===I||!0===I&&!P||!0===P&&!I)}mergeGML(_,u,S){let I=(new h.c).readFeatures(_);0===I.length&&(I=(new g.c).readFeatures(_));const U=new x.c([]);let G;const O=[];let Q,F=new w.c([]);const r=I.length,fe=this.getQueryParams(u.toLowerCase()).bbox.split(","),le=d.Gu();let se,ge,Ie,Re;if(d.SU(le,fe),S.options?.source?.options){const ht=S.options.source.options;ht.queryTitle&&(ge=ht.queryTitle)}switch(I.map(ht=>{if(ge){let Rt=ht.getProperties()[ge];Rt&&(se=se?`${se},${Rt}`:Rt)}const rt=ht.getGeometry().getCoordinates(),xt=ht.getGeometry().getType();switch(!Q&&(Q=xt),xt){case"Point":1===r?G=new b.c(rt,"XY"):O.push(rt);break;case"LineString":U.appendLineString(new E.c(rt,"XY"));break;case"Polygon":F.appendPolygon(new T.cp(rt,"XY"));break;case"MultiPolygon":F=new w.c(rt,"XY");break;default:return}}),Ie=0===O.length&&G?{type:G.getType(),coordinates:G.getCoordinates()}:{type:"Polygon",coordinates:[this.convexHull(O)]},Q){case"LineString":Re={type:U.getType(),coordinates:U.getCoordinates()};break;case"Point":Re=Ie;break;case"Polygon":case"MultiPolygon":Re={type:F.getType(),coordinates:F.getCoordinates()}}const He={};return ge&&(He[ge]=se),[Re,He]}cross(_,u,S){return(_[0]-S[0])*(u[1]-S[1])-(_[1]-S[1])*(u[0]-S[0])}convexHull(_){_.sort((P,I)=>P[0]===I[0]?P[1]-I[1]:P[0]-I[0]);const u=[];for(const P of _){for(;u.length>=2&&this.cross(u[u.length-2],u[u.length-1],P)<=0;)u.pop();u.push(P)}const S=[];for(let P=_.length-1;P>=0;P--){for(;S.length>=2&&this.cross(S[S.length-2],S[S.length-1],_[P])<=0;)S.pop();S.push(_[P])}return S.pop(),u.pop(),u.concat(S)}extractData(_,u,S,P,I,U){const G=u.dataSource,O=this.getAllowedFieldsAndAlias(u);let F=[];switch(G.options.queryFormat){case X.s5.GML3:F=this.extractGML3Data(_,u.zIndex,O);break;case X.s5.JSON:case X.s5.GEOJSON:case X.s5.GEOJSON2:F=this.extractGeoJSONData(_,u.zIndex,O);break;case X.s5.ESRIJSON:F=this.extractEsriJSONData(_,u.zIndex,O);break;case X.s5.TEXT:F=this.extractTextData(_);break;case X.s5.HTML:F=this.extractHtmlData(_,G.queryHtmlTarget,P);break;case X.s5.HTMLGML2:F=this.extractHtmlData(_,G.queryHtmlTarget,P,I,U);break;default:F=this.extractGML2Data(_,u,O)}if(F.length>0&&(null===F[0].geometry||!F[0].geometry)){const ie=this.createGeometryFromUrlClick(P);for(const ae of F)ae.geometry=ie}const Q=u.dataSource;if((Q.params?.FEATURE_COUNT?new RegExp("FEATURE_COUNT="+this.featureCount):new RegExp("FEATURE_COUNT="+this.defaultFeatureCount)).test(P)&&(Q.params?.FEATURE_COUNT&&this.featureCount>1&&F.length===this.featureCount||!Q.params?.FEATURE_COUNT&&F.length===this.defaultFeatureCount)){const ie=this.messageService.info("igo.geo.query.featureCountMax",void 0,void 0,{value:u.title});this.previousMessageIds.push(ie.toastId)}return F.map((ie,ae)=>{const fe=ie.properties[G.mapLabel];let le;if("wms"===u.options.sourceOptions?.type){const ge=u.options.sourceOptions;le=ge?ge.excludeAttribute:void 0}let ue=this.getQueryTitle(ie,u);!ue&&F.length>1?ue=`${u.title} (${ae+1})`:ue||(ue=u.title);const se=Object.assign({},ie.meta||{},{id:(0,e.uq)(),title:ue,mapTitle:fe,sourceTitle:u.title,order:1e3-u.zIndex,excludeAttribute:le});return Object.assign(ie,{meta:se,projection:"carto"===G.options.type?"EPSG:4326":S.projection})})}createGeometryFromUrlClick(_){const u=this.getQueryParams(_.toLowerCase()),S=u.bbox,P=parseInt(u.width,10),I=parseInt(u.height,10),U=parseInt(u.i||u.x,10),G=parseInt(u.j||u.y,10),O=S.split(",");let F=.05*(Math.abs(parseFloat(O[0]))-Math.abs(parseFloat(O[2])));Math.abs(parseFloat(O[0]))<180&&(F=.045);const Q=parseFloat(O[0])+Math.abs(parseFloat(O[0])-parseFloat(O[2]))*U/P-F,r=parseFloat(O[1])+Math.abs(parseFloat(O[1])-parseFloat(O[3]))*G/I-F,ie=Q+2*F,ae=r+2*F,fe="POLYGON(("+Q+" "+r+", "+Q+" "+ae+", "+ie+" "+ae+", "+ie+" "+r+", "+Q+" "+r+"))",se=(new R.c).readFeature(fe).getGeometry();return{type:se.getType(),coordinates:se.getCoordinates()}}extractGML2Data(_,u,S){let I=(new h.c).readFeatures(_);if(0===I.length){const U=new g.c;try{I=U.readFeatures(_)}catch{console.warn("query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.")}}return I.map(U=>this.featureToResult(U,u,S))}extractGML3Data(_,u,S){const P=new j.c;let I=[];try{I=P.readFeatures(_)}catch{console.warn("query.service: GML3 is not well supported")}return I.map(U=>this.featureToResult(U,u,S))}extractGeoJSONData(_,u,S){let P=[];try{P=JSON.parse(_.replace(/(\r|\n)/g," ")).features}catch{console.warn("query.service: Unable to parse geojson","\n",_)}return P.map(I=>I.meta={id:(0,e.uq)(),order:1e3-u,alias:S}),P}extractEsriJSONData(_,u,S){if(_)try{if(JSON.parse(_).error)return[]}catch{}return(new o.c).readFeatures(_).map(U=>this.featureToResult(U,u,S))}extractTextData(_){return[]}extractHtmlData(_,u,S,P,I){const U=this.getQueryParams(S.toLowerCase()),G=U.crs||U.srs||"EPSG:3857",O=this.createGeometryFromUrlClick(S);u!==X.Il.BLANK&&u!==X.Il.IFRAME&&(u=X.Il.IFRAME);const F=_.toLowerCase().indexOf("<body>"),Q=_.toLowerCase().lastIndexOf("</body>")+7;return""===oe()(_.slice(F,Q).replace(/(\r|\n|\s)/g,""))||""===_?[]:[{type:B.Y,projection:G,properties:Object.assign({target:u,body:_,url:S},I),geometry:P||O}]}getQueryParams(_){const u=_.split("?");if(!u[1])return;const S=u[1].split("&"),P={};return S.forEach(I=>{I=I.split("="),P[I[0]]=decodeURIComponent(I[1]||"")}),P}featureToResult(_,u,S){const P=_.getGeometry(),I=Object.assign({},_.getProperties());let U;return delete I.geometry,delete I.GEOMETRIE,delete I.boundedBy,delete I.shape,delete I.SHAPE,delete I.SHAPE_S,delete I.SHAPE_L,delete I.SHAPE_P,delete I.the_geom,delete I.geom,delete I.geom32198,P&&(U={type:P.getType(),coordinates:P.getCoordinates()}),{type:B.Y,projection:void 0,properties:I,geometry:U,meta:{id:(0,e.uq)(),order:1e3-u,alias:S}}}getQueryUrl(_,u,S=!1,P){let I;if(_.options.queryUrls)return this.getCustomQueryUrl(_,u,P);switch(_.constructor){case N.CK:const U=_,G={INFO_FORMAT:U.params.INFO_FORMAT||this.getMimeInfoFormat(_.options.queryFormat),QUERY_LAYERS:U.params.LAYERS,FEATURE_COUNT:U.params.FEATURE_COUNT||this.defaultFeatureCount};U.params.FEATURE_COUNT&&(this.featureCount=U.params.FEATURE_COUNT),S&&(G.INFO_FORMAT=this.getMimeInfoFormat(X.s5.GML2)),I=U.ol.getFeatureInfoUrl(u.coordinates,u.resolution,u.projection,G);break;case N.aI:I=`${"https://"+_.options.account+".carto.com/api/v2/sql?"}format=GeoJSON${"&q="+_.options.config.layers[0].options.sql} WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(${u.coordinates[0]+","+u.coordinates[1]+"),3857),"+(_.options.queryPrecision?_.options.queryPrecision:"1000")+"))"}`;break;case N.yA:case N.W4:const le=_,ue=Math.abs(P[0]-P[2]),se=Math.abs(P[1]-P[3]),Re=le.options.queryPrecision?le.options.queryPrecision:.005*(ue>se?ue:se),He=d.cz(d.cj([u.coordinates]),Re);I=`${le.options.url+"/"+le.options.layer+"/query/"}?${["f=json",`geometry=${encodeURIComponent('{"xmin":'+He[0]+',"ymin":'+He[1]+',"xmax":'+He[2]+',"ymax":'+He[3]+',"spatialReference":{"wkid":102100}}')}`,"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"].join("&")}`}return I}getMimeInfoFormat(_){let u="application/vnd.ogc.gml";const S=Object.keys(X.s5).find(P=>X.s5[P]===_);return S&&(u=X.cv[S]),u}getAllowedFieldsAndAlias(_){let u;return _.options?.source?.options?.sourceFields&&_.options.source.options.sourceFields.length>=1&&(u={},_.options.source.options.sourceFields.forEach(S=>{u[S.name]=S.alias?S.alias:S.name})),u}getQueryTitle(_,u){let S;if(u.options?.source?.options){const P=u.options.source.options;P.queryTitle&&(S=this.getLabelMatch(_,P.queryTitle))}return S}getLabelMatch(_,u){let S=u;const P=Array.from(u.matchAll(/\$\{([^\{\}]+)\}/g));return P.forEach(I=>{S=S.replace(I[0],_.properties[I[1]])}),0===P.length&&S===u&&(S=_.properties[u]||u),S}getCustomQueryUrl(_,u,S){const P=d.C2(u.coordinates,u.resolution,0,[101,101]);return _.options.queryUrls.map(I=>{let U={url:I.url.replace(/\{bbox\}/g,P.join(",")).replace(/\{x\}/g,u.coordinates[0].toString()).replace(/\{y\}/g,u.coordinates[1].toString()).replace(/\{resolution\}/g,u.resolution.toString()).replace(/\{srid\}/g,u.projection.replace("EPSG:",""))};return S&&U.url.replace(/\{xmin\}/g,S[0].toString()).replace(/\{ymin\}/g,S[1].toString()).replace(/\{xmax\}/g,S[2].toString()).replace(/\{ymax\}/g,S[3].toString()),I.maxResolution&&(U.maxResolution=I.maxResolution),I.minResolution&&(U.minResolution=I.minResolution),I.minScale&&(U.minScale=I.minScale),I.maxScale&&(U.maxScale=I.maxScale),U})}static \u0275fac=function(u){return new(u||A)(V.CoB(z.KK),V.CoB(y.mi))};static \u0275prov=V.wxM({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})()},17400:(Ee,ce,s)=>{"use strict";function y(R){return!0===R.dataSource.options.queryable}function g(R){const o=R.get("_layer");return void 0!==o&&y(o)&&function d(R){const o=R.dataSource;return void 0===o.options.queryLayerFeatures||!0===o.options.queryLayerFeatures}(o)}s.d(ce,{aA:()=>g,wd:()=>y})},8636:(Ee,ce,s)=>{"use strict";s.d(ce,{A:()=>P});var y=s(65056),e=s(34896),d=s(34672),g=s(75180),R=s(50244),o=s(32328),h=s(42536),j=s(27e3),w=(s(62228),s(83600)),b=s(72584),E=s(54844),T=s(69936),a=s(25376),K=s(11484),M=s(1560),L=s(50620),oe=s(29220),N=s(29216),B=s(83456);const X=["input"];function V(I,U){if(1&I&&(e.I0R(0,"mat-label"),e.OEk(1),e.C$Y()),2&I){const G=e.GaO();e.yG2(),e.cNF(G.label)}}function z(I,U){if(1&I){const G=e.KQA();e.I0R(0,"button",11),e.qCj("click",function(){e.usT(G);const F=e.GaO();return e.CGJ(F.onClearButtonClick())}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",12),e.C$Y()}if(2&I){const G=e.GaO();e.E7m("color",G.color)("matTooltip",e.kDX(1,2,"igo.geo.search.clearSearch"))}}function W(I,U){1&I&&e.wR5(0,"mat-divider",13),2&I&&e.E7m("vertical",!0)}function A(I,U){if(1&I&&(e.I0R(0,"button",14),e.wR5(1,"mat-icon",15),e.C$Y()),2&I){const G=e.GaO();e.E7m("color",G.color)}}function q(I,U){if(1&I){const G=e.KQA();e.I0R(0,"igo-search-selector",16),e.qCj("searchTypeChange",function(F){e.usT(G);const Q=e.GaO();return e.CGJ(Q.onSearchTypeChange(F))}),e.wVc(1,"async"),e.C$Y()}if(2&I){const G=e.GaO();e.E7m("searchTypes",G.searchTypes)("searchType",e.kDX(1,2,G.searchType$))}}function _(I,U){if(1&I){const G=e.KQA();e.I0R(0,"igo-search-settings",17),e.qCj("pointerSummaryStatus",function(F){e.usT(G);const Q=e.GaO();return e.CGJ(Q.pointerSummaryStatus.emit(F))})("searchResultsGeometryStatus",function(F){e.usT(G);const Q=e.GaO();return e.CGJ(Q.searchResultsGeometryStatus.emit(F))})("reverseSearchCoordsFormatStatus",function(F){e.usT(G);const Q=e.GaO();return e.CGJ(Q.reverseSearchCoordsFormatStatus.emit(F))})("searchSourceChange",function(){e.usT(G);const F=e.GaO();return e.CGJ(F.onSearchSettingsChange())}),e.C$Y()}if(2&I){const G=e.GaO();e.E7m("pointerSummaryEnabled",G.pointerSummaryEnabled)("searchResultsGeometryEnabled",G.searchResultsGeometryEnabled)("reverseSearchCoordsFormatEnabled",G.reverseSearchCoordsFormatEnabled)}}const u=I=>({empty:I}),S=I=>({hasSearchIcon:I});let P=(()=>{class I{configService;searchService;searchSourceService;static invalidKeys=["Control","Shift","Alt","ArrowDown","ArrowUp","ArrowRight","ArrowLeft"];placeholder$=new E.g("igo.geo.search.placeholder");empty$=new E.g(!0);term$$;stream$=new E.g("");stream$$;searchType$$;researches$$;showSearchButton=!1;searchTypes=oe.a;withDivider;set searchType(G){this.setSearchType(G)}get searchType(){return this.searchType$.value}searchType$=new E.g(void 0);pointerSummaryStatus=new e._w7;searchResultsGeometryStatus=new e._w7;reverseSearchCoordsFormatStatus=new e._w7;set term(G){this.setTerm(G)}get term(){return this.term$.value}term$=new E.g("");set disabled(G){this.disabled$.next(G)}get disabled(){return this.disabled$.value}disabled$=new E.g(!1);pointerSummaryEnabled=!1;searchResultsGeometryEnabled=!1;get reverseSearchCoordsFormatEnabled(){return this._reverseSearchCoordsFormatEnabled}set reverseSearchCoordsFormatEnabled(G){this._reverseSearchCoordsFormatEnabled=G,this.setTerm(this.term,!0)}_reverseSearchCoordsFormatEnabled=!1;floatLabel="auto";appearance="fill";placeholder;label;color="primary";termSplitter="|";debounce=200;minLength=2;searchSelector=!1;searchSettings=!1;forceNA=!1;store;searchTermChange=new e._w7;search=new e._w7;searchTypeChange=new e._w7;clearFeature=new e._w7;searchSettingsChange=new e._w7;input;get empty(){return 0===this.term.length}constructor(G,O,F){this.configService=G,this.searchService=O,this.searchSourceService=F}ngOnInit(){this.term$$=this.term$.subscribe(O=>{this.empty$.next(void 0===O||0===O.length)}),this.stream$$=this.stream$.pipe((0,a.C)(()=>(0,T.k)(this.debounce))).subscribe(O=>this.onSetTerm(O)),this.handlePlaceholder(),this.searchType$$=this.searchType$.pipe((0,K.a)()).subscribe(O=>this.onSetSearchType(O));const G=this.configService.getConfig("searchBar.showSearchButton");this.showSearchButton=void 0!==G&&G}ngOnDestroy(){this.term$$.unsubscribe(),this.stream$$.unsubscribe(),this.searchType$$.unsubscribe()}onKeyup(G){this.keyIsValid(G.key)&&this.setTerm(G.target.value)}onClearButtonClick(){this.clear(),this.clearFeature.emit()}onSearchTypeChange(G){this.setSearchType(G)}setSearchType(G){this.searchType$.next(G)}onSearchSettingsChange(){this.doSearch(this.term),this.searchSettingsChange.emit(),this.handlePlaceholder()}setTerm(G,O){if(this.disabled)return;(G=G||"")!==this.term&&!O&&this.term$.next(G);const F=G.replace(/(#[^\s]*)/g,"").trim();(F.length>=this.minLength||0===F.length)&&this.stream$.next(G)}clear(){this.term$.next(""),this.stream$.next(""),this.input.nativeElement.focus()}keyIsValid(G){return-1===I.invalidKeys.indexOf(G)}onSetTerm(G){this.searchTermChange.emit(G),this.doSearch(G)}handlePlaceholder(){const G=[...new Set(this.searchSourceService.getEnabledSources().filter(F=>!["map","coordinatesreverse"].includes(F.getId())).map(F=>F.getType()))];let O="igo.geo.search.placeholder";1===G.length?O=`igo.geo.search.${G[0].toLowerCase()}.placeholder`:0===G.length&&(O="igo.geo.search.emptyType.placeholder"),this.placeholder$.next(O)}onSetSearchType(G){if(null==G)return;this.searchTypeChange.emit(G);const O=`igo.geo.search.${G.toLowerCase()}.placeholder`;this.placeholder$.next(O),this.setTerm(this.term)}doSearch(G){let O;this.researches$$&&(this.researches$$.map(Q=>Q.unsubscribe()),this.researches$$=void 0),this.termSplitter&&G.match(new RegExp(this.termSplitter,"g"))?(O=G.split(this.termSplitter).filter(Q=>Q.length>=this.minLength),this.store&&this.store.clear()):O=[G];let F=[];O.map(Q=>{""!==(Q?Q.replace(/(#[^\s]*)/g,"").trim():"")?F=F.concat(this.searchService.search(Q,{forceNA:this.forceNA})):void 0!==this.store&&this.store.clear()}),this.researches$$=F.map(Q=>Q.request.subscribe(r=>{this.onResearchCompleted(Q,r)}))}onResearchCompleted(G,O){if(this.search.emit({research:G,results:O}),void 0!==this.store){const F=this.store.all().filter(Q=>Q.source!==G.source).concat(O);this.store.updateMany(F)}}static \u0275fac=function(O){return new(O||I)(e.GI1(w.aW),e.GI1(N._),e.GI1(B.i))};static \u0275cmp=e.In1({type:I,selectors:[["igo-search-bar"]],viewQuery:function(O,F){if(1&O&&e.CC$(X,7),2&O){let Q;e.wto(Q=e.Gqi())&&(F.input=Q.first)}},inputs:{searchTypes:"searchTypes",withDivider:"withDivider",searchType:"searchType",term:"term",disabled:"disabled",pointerSummaryEnabled:"pointerSummaryEnabled",searchResultsGeometryEnabled:"searchResultsGeometryEnabled",reverseSearchCoordsFormatEnabled:"reverseSearchCoordsFormatEnabled",floatLabel:"floatLabel",appearance:"appearance",placeholder:"placeholder",label:"label",color:"color",termSplitter:"termSplitter",debounce:"debounce",minLength:"minLength",searchSelector:"searchSelector",searchSettings:"searchSettings",forceNA:"forceNA",store:"store"},outputs:{pointerSummaryStatus:"pointerSummaryStatus",searchResultsGeometryStatus:"searchResultsGeometryStatus",reverseSearchCoordsFormatStatus:"reverseSearchCoordsFormatStatus",searchTermChange:"searchTermChange",search:"search",searchTypeChange:"searchTypeChange",clearFeature:"clearFeature",searchSettingsChange:"searchSettingsChange"},standalone:!0,features:[e.UHJ],decls:17,vars:29,consts:[[1,"igo-search-bar-container",3,"ngClass"],[3,"floatLabel","appearance"],[4,"ngIf"],["matInput","","autocomplete","off",3,"ngClass","disabled","placeholder","value","keyup"],["input",""],["mat-icon-button","","matSuffix","",3,"color","matTooltip","click",4,"ngIf"],[3,"vertical",4,"ngIf"],[1,"search-bar-buttons"],["mat-icon-button","",3,"color",4,"ngIf"],[3,"searchTypes","searchType","searchTypeChange",4,"ngIf"],[3,"pointerSummaryEnabled","searchResultsGeometryEnabled","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","searchSourceChange",4,"ngIf"],["mat-icon-button","","matSuffix","",3,"color","matTooltip","click"],["svgIcon","close"],[3,"vertical"],["mat-icon-button","",3,"color"],["svgIcon","magnify"],[3,"searchTypes","searchType","searchTypeChange"],[3,"pointerSummaryEnabled","searchResultsGeometryEnabled","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","searchSourceChange"]],template:function(O,F){1&O&&(e.I0R(0,"div",0),e.wVc(1,"async"),e.I0R(2,"mat-form-field",1),e.yuY(3,V,2,1,"mat-label",2),e.I0R(4,"input",3,4),e.qCj("keyup",function(r){return F.onKeyup(r)}),e.wVc(6,"async"),e.wVc(7,"async"),e.wVc(8,"translate"),e.wVc(9,"async"),e.C$Y(),e.yuY(10,z,3,4,"button",5),e.wVc(11,"async"),e.C$Y(),e.yuY(12,W,1,1,"mat-divider",6),e.I0R(13,"div",7),e.yuY(14,A,2,1,"button",8)(15,q,2,4,"igo-search-selector",9)(16,_,1,3,"igo-search-settings",10),e.C$Y()()),2&O&&(e.E7m("ngClass",e.S45(25,u,e.kDX(1,13,F.empty$))),e.yG2(2),e.E7m("floatLabel",F.floatLabel)("appearance",F.appearance),e.yG2(),e.E7m("ngIf",F.label),e.yG2(),e.E7m("ngClass",e.S45(27,S,F.showSearchButton))("disabled",e.kDX(6,15,F.disabled$))("placeholder",F.placeholder?F.placeholder:e.kDX(7,17,F.placeholder$)?e.kDX(8,19,F.placeholder$.value):void 0)("value",e.kDX(9,21,F.term$)),e.yG2(6),e.E7m("ngIf",!1===e.kDX(11,23,F.empty$)),e.yG2(2),e.E7m("ngIf",F.withDivider),e.yG2(2),e.E7m("ngIf",F.showSearchButton),e.yG2(),e.E7m("ngIf",F.searchSelector),e.yG2(),e.E7m("ngIf",F.searchSettings))},dependencies:[y.QF,R.wb,R.Up,R.w5,R.Gm,y.u_,h.cN,h.yi,d.oJ,d.um,j.KO,j.a4,o.oB,o.qL,g.U,g.k,M.s,L.Q,y.a,b.O0,b.sD],styles:['[_nghost-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}[_nghost-%COMP%]     .mat-mdc-text-field-wrapper{align-items:center;padding-right:0}[_nghost-%COMP%]     .mat-mdc-form-field-infix{align-self:center}@media (max-width: 599px){[_nghost-%COMP%]     .mat-mdc-form-field-infix{width:158px}}[_nghost-%COMP%]     mat-form-field .mdc-line-ripple{display:none}[_nghost-%COMP%]     mat-form-field input{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.igo-search-bar-container[_ngcontent-%COMP%]{position:relative;width:100%;display:flex}mat-form-field[_ngcontent-%COMP%]{flex:1}mat-divider[_ngcontent-%COMP%]{margin:8px 0}.search-bar-buttons[_ngcontent-%COMP%]{position:relative;display:inline-flex}.search-bar-buttons[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:nth-child(2):before{content:"";border-right:1px solid #ddd;height:28px}igo-search-selector[_ngcontent-%COMP%]{background-color:#fff;top:0;border-radius:0}igo-search-settings[_ngcontent-%COMP%]{background-color:#fff;top:0;border-radius:0}'],changeDetection:0})}return I})()},8408:(Ee,ce,s)=>{"use strict";s.d(ce,{q:()=>ie});var y=s(65056),e=s(50032),d=s(34672),g=s(32328),R=s(27e3),o=s(62228),h=s(9588),j=s(87544),x=s(88872),w=s(45212),b=s(54776),E=s(72584),T=s(54844),a=s(37496),K=s(61200),M=s(39844),L=s(8492),oe=s(7036),N=s(2892),X=(s(89500),s(49312)),V=s(71904),z=s(69400),W=s(46176),A=s(40600),q=s(50244),_=s(42536),u=s(63916),S=s(24708),P=s(31792),I=s(40604),U=s(66908),G=s(34896);function O(ae,fe){if(1&ae&&(G.I0R(0,"mat-option",14)(1,"p",15),G.OEk(2),G.C$Y()()),2&ae){const le=fe.$implicit;G.E7m("value",le),G.yG2(2),G.cNF(le.title)}}let F=(()=>{class ae{formBuilder;languageService;dialogRef;data;form;feature;layers=[];filteredLayers$;constructor(le,ue,se,ge){this.formBuilder=le,this.languageService=ue,this.dialogRef=se,this.data=ge,this.form=this.formBuilder.group({layerName:["",[V.AQ.required]]})}ngOnInit(){this.feature=this.data.feature,this.layers=this.data.layers,this.filteredLayers$=this.form.controls.layerName.valueChanges.pipe((0,P.W)(""),(0,I.k)(le=>this.filter(le)))}filter(le){if("string"==typeof le)return this.layers.map(ue=>ue).filter(ue=>ue?.title?.toLowerCase().includes(le.toLowerCase()))}displayFn(le){return le&&le.title?le.title:""}save(){this.dialogRef.close({layer:this.form.value.layerName,feature:this.feature})}cancel(){this.dialogRef.close()}static \u0275fac=function(ue){return new(ue||ae)(G.GI1(V.KE),G.GI1(S.ov),G.GI1(A.yI),G.GI1(A.sR,8))};static \u0275cmp=G.In1({type:ae,selectors:[["igo-save-feature-dialog"]],standalone:!0,features:[G.UHJ],decls:23,vars:22,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[1,"igo-form",3,"formGroup"],[3,"navigation","selection"],["igoListItem","","color","accent",3,"result","showIcons"],[1,"igo-input-container"],["type","text","matInput","","formControlName","layerName",3,"placeholder","matAutocomplete"],[3,"displayWith"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["mat-dialog-actions","",2,"justify-content","center"],[1,"igo-form-button-group","create-layer-button-top-padding"],["mat-raised-button","","type","button",3,"click"],["id","createLayerBtnDialog","mat-raised-button","","type","button","color","primary",3,"click"],[3,"value"],["matListItemTitle",""]],template:function(ue,se){if(1&ue&&(G.I0R(0,"h1",0),G.OEk(1),G.wVc(2,"translate"),G.C$Y(),G.I0R(3,"div",1)(4,"form",2)(5,"igo-list",3),G.wR5(6,"igo-search-results-item",4),G.C$Y(),G.I0R(7,"div",5)(8,"mat-form-field"),G.wR5(9,"input",6),G.wVc(10,"translate"),G.I0R(11,"mat-autocomplete",7,8),G.yuY(13,O,3,2,"mat-option",9),G.wVc(14,"async"),G.C$Y()()()()(),G.I0R(15,"div",10)(16,"div",11)(17,"button",12),G.qCj("click",function(){return se.cancel()}),G.OEk(18),G.wVc(19,"translate"),G.C$Y(),G.I0R(20,"button",13),G.qCj("click",function(){return se.save()}),G.OEk(21),G.wVc(22,"translate"),G.C$Y()()()),2&ue){const ge=G.Gew(12);G.yG2(),G.oRS(" ",G.kDX(2,12,"igo.geo.layer.saveFeatureInLayer"),"\n"),G.yG2(3),G.E7m("formGroup",se.form),G.yG2(),G.E7m("navigation",!1)("selection",!1),G.yG2(),G.E7m("result",se.feature)("showIcons",!0),G.yG2(3),G._6D("placeholder",G.kDX(10,14,"igo.geo.layer.chooseOrSet")),G.E7m("matAutocomplete",ge),G.yG2(2),G.E7m("displayWith",se.displayFn),G.yG2(2),G.E7m("ngForOf",G.kDX(14,16,se.filteredLayers$)),G.yG2(5),G.oRS(" ",G.kDX(19,18,"igo.geo.layer.cancelBtn")," "),G.yG2(3),G.oRS(" ",G.kDX(22,20,"igo.geo.layer.saveBtn")," ")}},dependencies:[A.WQ,A.iU,V.y,V.sz,V.ot,V.ue,V.u,V.sl,V.uW,V.Wo,o.yM,U.g,o.qU,q.wb,q.Up,_.cN,_.yi,z.U1,z.e,W.I5,z.cG,y.Iw,W.Ax,u.iI,u.UV,A.Yp,d.oJ,d.Gw,y.a,E.O0,E.sD],styles:["[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .create-layer-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   button#createLayerBtnDialog[disabled=true][_ngcontent-%COMP%]{cursor:default;background-color:#0000001f;color:#00000042}[_nghost-%COMP%]   .error[_ngcontent-%COMP%]{color:red}"]})}return ae})();function Q(ae,fe){if(1&ae){const le=G.KQA();G.I0R(0,"button",2),G.qCj("mouseenter",function(se){G.usT(le);const ge=G.GaO();return G.CGJ(ge.onMouseEvent(se))})("mouseleave",function(se){G.usT(le);const ge=G.GaO();return G.CGJ(ge.onMouseEvent(se))})("click",function(se){G.usT(le);const ge=G.GaO();return G.CGJ(ge.onToggleClick(se))}),G.wVc(1,"translate"),G.wVc(2,"async"),G.wR5(3,"mat-icon",3),G.wVc(4,"async"),G.wVc(5,"async"),G.wVc(6,"async"),G.wVc(7,"async"),G.wVc(8,"async"),G.wVc(9,"async"),G.wVc(10,"async"),G.C$Y()}if(2&ae){const le=G.GaO();G.E7m("matTooltip",G.kDX(1,7,le.computeTooltip()))("color",G.kDX(2,9,le.isPreview$)?"":le.added?"warn":""),G.yG2(3),G.E7m("igoMatBadgeIcon",le.getBadgeIcon())("igoMatBadgeInverseColor",!0)("matBadgeHidden",G.kDX(4,11,le.inRange$)&&!0===G.kDX(5,13,le.isVisible$)||G.kDX(6,15,le.inRange$)&&!le.added||G.kDX(7,17,le.inRange$)&&G.kDX(8,19,le.isPreview$))("matBadgeDisabled",!1===G.kDX(9,21,le.inRange$))("svgIcon",G.kDX(10,23,le.isPreview$)?"plus":le.added?"delete":"plus")}}function r(ae,fe){if(1&ae){const le=G.KQA();G.I0R(0,"button",4),G.qCj("click",function(){G.usT(le);const se=G.GaO();return G.CGJ(se.addFeatureToLayer())}),G.wVc(1,"translate"),G.wVc(2,"async"),G.wR5(3,"mat-icon",5),G.wVc(4,"async"),G.C$Y()}if(2&ae){const le=G.GaO();G.E7m("id",le.isMobile?"":"hide-save-search-result-btn")("matTooltip",G.kDX(1,5,G.kDX(2,7,le.addFeatureToLayerTooltip$))),G.yG2(3),G.E7m("igoMatBadgeInverseColor",!0)("matBadgeHidden",G.kDX(4,9,le.inRange$))("matBadgeDisabled",!0)}}let ie=(()=>{class ae{layerService;dialog;dataSourceService;mediaService;tooltip$=new T.g("igo.geo.catalog.layer.addToMap");addFeatureToLayerTooltip$=new T.g("igo.geo.search.addToLayer");resolution$$;layers$$;inRange$=new T.g(!0);isVisible$=new T.g(!1);isPreview$=new T.g(!1);layersSubcriptions=[];lastTimeoutRequest;mouseInsideAdd=!1;layer;store;added;map;saveSearchResultInLayer=!1;get color(){return this._color}set color(le){this._color=le}_color="primary";stores=[];get allLayers(){return this.map.layers.filter(le=>String(le.id).includes("igo-search-layer"))}mediaService$$;isMobile=!1;constructor(le,ue,se,ge){this.layerService=le,this.dialog=ue,this.dataSourceService=se,this.mediaService=ge}ngOnInit(){this.mediaService$$=this.mediaService.media$.subscribe(le=>{le===h.oZ.Mobile&&(this.isMobile=!0)}),"Layer"===this.layer.meta.dataType&&(this.added=-1!==this.map.layers.findIndex(le=>le.id===this.layer.data.sourceOptions.id)),this.layers$$=this.map.layers$.subscribe(()=>{this.isVisible()}),this.resolution$$=this.map.viewController.resolution$.subscribe(le=>{this.isInResolutionsRange(le),this.isVisible()})}ngOnDestroy(){this.resolution$$.unsubscribe(),this.layers$$.unsubscribe(),this.mediaService$$&&this.mediaService$$.unsubscribe()}onMouseEvent(le){this.onToggleClick(le)}onToggleClick(le){typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);const ue=le||{};if("mouseenter"!==ue.type||!this.mouseInsideAdd)switch(ue.type){case"click":this.isPreview$.value||(this.added?this.remove():this.add(ue)),this.isPreview$.next(!1);break;case"mouseenter":!this.isPreview$.value&&!this.added&&(this.lastTimeoutRequest=setTimeout(()=>{this.add(ue),this.isPreview$.next(!0)},500)),this.mouseInsideAdd=!0;break;case"mouseleave":this.isPreview$.value&&(this.remove(),this.isPreview$.next(!1)),this.mouseInsideAdd=!1}}add(le){this.added||(this.added=!0,this.addLayerToMap(le))}remove(){this.added&&(this.added=!1,this.removeLayerFromMap(),this.layersSubcriptions.map(le=>le.unsubscribe()),this.layersSubcriptions=[])}addLayerToMap(le){if(void 0===this.map||this.layer.meta.dataType!==L.i)return;const ue=this.layer.data;void 0===ue.sourceOptions.optionsFromApi&&(ue.sourceOptions.optionsFromApi=!0),this.layersSubcriptions.push(this.layerService.createAsyncLayer(ue).subscribe(se=>{"click"===le.type&&this.map.layersAddedByClick$.next([se]),this.map.addLayer(se)}))}removeLayerFromMap(){if(void 0===this.map||this.layer.meta.dataType!==L.i)return;const le=this.map.getLayerById(this.layer.data.sourceOptions.id);this.map.removeLayer(le)}isInResolutionsRange(le){this.inRange$.next(le>=(this.layer.data.minResolution||0)&&le<=(this.layer.data.maxResolution||1/0))}isVisible(){if(this.layer?.data?.sourceOptions?.id){const le=this.map.getLayerById(this.layer.data.sourceOptions.id);this.isVisible$.next(!!le&&le.visible)}}getBadgeIcon(){return this.inRange$.value&&this.isVisible$.value?"":"eye-off"}computeTooltip(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?this.isVisible$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapNotVisible":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"}addFeatureToLayer(){"Feature"===this.layer.meta.dataType&&this.dialog.open(F,{width:"700px",data:{feature:this.layer,layers:this.allLayers}}).afterClosed().subscribe(se=>{if(se)if(this.stores.length>0&&this.stores.map(ge=>(ge.state.updateAll({selected:!1}),ge?.layer&&(ge.layer.visible=!1),ge)),"string"==typeof se.layer)this.createLayer(se.layer,se.feature);else{const ge=this.stores.find(Ie=>Ie.layer.id===se.layer.id);ge.layer.visible=!0,ge.layer.opacity=1,this.addFeature(se.feature,ge)}})}createLayer(le,ue){const se=new M.ym([],{map:this.map}),ge=[new b.cp({image:new j.c({radius:5,stroke:new w.c({width:1,color:"rgba(143,7,7,1)"}),fill:new x.c({color:"rgba(143,7,7,1)"})})}),new b.cp({stroke:new w.c({width:1,color:"rgba(143,7,7,1)"}),fill:new x.c({color:"rgba(0, 0, 255, 0.1)"})})];let Ie=0;for(const Re of this.allLayers){let He=Number(Re.id.replace("igo-search-layer",""));Ie=Math.max(He,Ie)}this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,a.U)(1)).subscribe(Re=>{let He=new N.M({isIgoInternalLayer:!0,id:"igo-search-layer"+ ++Ie,title:le,source:Re,igoStyle:{editable:!1,igoStyleObject:{fill:{color:"rgba(255,255,255,0.4)"},stroke:{color:"rgba(143,7,7,1)",width:1},circle:{fill:{color:"rgba(255,255,255,0.4)"},stroke:{color:"rgba(143,7,7,1)",width:1},radius:5}}},style:ge,showInLayerList:!0,exportable:!0,workspace:{enabled:!0}});(0,M.mM)(se,He),(0,M.sf)(se,new M.E9({motion:M.Su.None})),(0,M.Uz)(se,new M.kj({map:this.map,motion:M.Su.None,many:!0})),se.layer.visible=!0,se.source.ol.on("removefeature",ht=>{const rt=ht.feature.getGeometry();this.clearLabelsOfOlGeometry(rt)}),this.addFeature(ue,se),this.stores.push(se)})}addFeature(le,ue){const se={type:le.data.type,geometry:{coordinates:le.data.geometry.coordinates,type:le.data.geometry.type},projection:le.data.projection,properties:le.data.properties,meta:{id:le.meta.id}};delete se.properties.Route,ue.update(se),ue.setLayerExtent(),ue.layer.ol.getSource().refresh()}clearLabelsOfOlGeometry(le){(0,X.aK)(le).forEach(ue=>{ue&&ue.getMap()&&this.map.ol.removeOverlay(ue)})}static \u0275fac=function(ue){return new(ue||ae)(G.GI1(oe.I),G.GI1(A.qW),G.GI1(K.O),G.GI1(h.QB))};static \u0275cmp=G.In1({type:ae,selectors:[["igo-search-add-button"]],inputs:{layer:"layer",store:"store",added:"added",map:"map",saveSearchResultInLayer:"saveSearchResultInLayer",color:"color",stores:"stores"},standalone:!0,features:[G.UHJ],decls:2,vars:2,consts:[["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click",4,"ngIf"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"id","matTooltip","click",4,"ngIf"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click"],["aria-hidden","false","matBadge","icon","igoMatBadgeColor","rgba(0,0,0,0.87)","igoMatBadgeBackgroundColor","none","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeIcon","igoMatBadgeInverseColor","matBadgeHidden","matBadgeDisabled","svgIcon"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"id","matTooltip","click"],["aria-hidden","false","matBadge","icon","igoMatBadgeIcon","eye-off","matBadgeSize","small","matBadgePosition","after","svgIcon","file-plus-outline",3,"igoMatBadgeInverseColor","matBadgeHidden","matBadgeDisabled"]],template:function(ue,se){1&ue&&G.yuY(0,Q,11,25,"button",0)(1,r,5,11,"button",1),2&ue&&(G.E7m("ngIf","Layer"===se.layer.meta.dataType),G.yG2(),G.E7m("ngIf","Feature"===se.layer.meta.dataType&&se.saveSearchResultInLayer))},dependencies:[y.u_,d.oJ,d.um,o.mw,R.KO,R.a4,g.oB,g.qL,e.g,e.S,o.qS,y.a,E.O0,E.sD],styles:["[_nghost-%COMP%]   #hide-save-search-result-btn[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   #show-save-search-result-btn[_ngcontent-%COMP%]{display:block}"],changeDetection:0})}return ae})()},66908:(Ee,ce,s)=>{"use strict";s.d(ce,{g:()=>oe});var y=s(65056),e=s(34896),d=s(34672),g=s(32328),R=s(63916),o=s(27e3),h=s(62228),j=s(12396),x=s(39844);function b(N,B){if(1&N&&e.wR5(0,"mat-icon",6),2&N){const X=e.GaO();e.E7m("svgIcon",X.showIcons?X.icon:"blank")}}function E(N,B){if(1&N&&e.wR5(0,"div",7),2&N){const X=e.GaO();e.E7m("innerHtml",X.titleHtml,e.E3n)("matTooltip",X.tooltipHtml)}}function T(N,B){if(1&N&&(e.I0R(0,"span",9),e.OEk(1),e.C$Y()),2&N){const X=e.GaO(2);e.E7m("matTooltip",X.title),e.yG2(),e.cNF(X.title)}}function a(N,B){if(1&N&&e.yuY(0,T,2,2,"span",8),2&N){const X=e.GaO();e.E7m("ngIf",!X.titleHtml)}}function K(N,B){if(1&N){const X=e.KQA();e.I0R(0,"button",10),e.qCj("click",function(){e.usT(X);const z=e.GaO();return e.CGJ(z.onZoomHandler())}),e.wR5(1,"mat-icon",11),e.C$Y()}}s(89500);const M=[[["","igoSearchItemToolbar",""]]],L=["[igoSearchItemToolbar]"];let oe=(()=>{class N{result;map;showIcons;withZoomButton=!1;zoomEvent=new e._w7;format=new j.c;get title(){return(0,h.YB)(this.result)}get titleHtml(){return(0,h.E$)(this.result)}get tooltipHtml(){return this.titleHtml.replace(/<small?[^>]+(>|$)/g,"\n").replace(/<\/?[^>]+(>|$)/g,"")}get icon(){return(0,h.sH)(this.result)}onZoomHandler(){const X=this.format.readFeature(this.result.data,{dataProjection:this.result.data.projection,featureProjection:this.map.projection});(0,x.QX)(this.map.viewController,[X],x.Su.Default)}onMouseEvent(X){const V=X.target;switch(X.type){case"mouseenter":const W=V.querySelector("#hide-save-search-result-btn");W&&W.setAttribute("id","show-save-search-result-btn");break;case"mouseleave":const A=V.querySelector("#show-save-search-result-btn");A&&A.setAttribute("id","hide-save-search-result-btn")}}static \u0275fac=function(V){return new(V||N)};static \u0275cmp=e.In1({type:N,selectors:[["igo-search-results-item"]],inputs:{result:"result",map:"map",showIcons:"showIcons",withZoomButton:"withZoomButton"},outputs:{zoomEvent:"zoomEvent"},standalone:!0,features:[e.UHJ],ngContentSelectors:L,decls:8,vars:4,consts:[[3,"mouseenter","mouseleave"],["matListItemIcon","",3,"svgIcon",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500","matTooltipClass","search-result-tooltip",3,"innerHtml","matTooltip",4,"ngIf","ngIfElse"],["normalTitle",""],["matListItemMeta",""],["igoStopPropagation","","mat-icon-button","",3,"click",4,"ngIf"],["matListItemIcon","",3,"svgIcon"],["matListItemTitle","","matTooltipShowDelay","500","matTooltipClass","search-result-tooltip",3,"innerHtml","matTooltip"],["matListItemTitle","","matTooltipShowDelay","500",3,"matTooltip",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"matTooltip"],["igoStopPropagation","","mat-icon-button","",3,"click"],["svgIcon","magnify"]],template:function(V,z){if(1&V&&(e.kPM(M),e.I0R(0,"mat-list-item",0),e.qCj("mouseenter",function(A){return z.onMouseEvent(A)})("mouseleave",function(A){return z.onMouseEvent(A)}),e.yuY(1,b,1,1,"mat-icon",1)(2,E,1,2,"div",2)(3,a,1,1,"ng-template",null,3,e.gJz),e.I0R(5,"div",4),e.yuY(6,K,2,0,"button",5),e._Xx(7),e.C$Y()()),2&V){const W=e.Gew(4);e.yG2(),e.E7m("ngIf",z.icon),e.yG2(),e.E7m("ngIf",z.titleHtml)("ngIfElse",W),e.yG2(4),e.E7m("ngIf",z.withZoomButton)}},dependencies:[R.iI,R.g9,R.Y1,R.UV,R.At,y.u_,g.oB,g.qL,o.KO,o.a4,d.oJ,d.um,h.mw],styles:["[_nghost-%COMP%]     small{color:#8c8c8c}[_nghost-%COMP%]   div[matlistitemmeta][_ngcontent-%COMP%]:empty{display:none}[_nghost-%COMP%]     .search-result-tooltip{white-space:pre-line}"],changeDetection:0})}return N})()},69800:(Ee,ce,s)=>{"use strict";s.d(ce,{T:()=>fe});var y=s(65056),e=s(34896),d=s(18268),g=s(62228),R=s(83600),o=s(72584),h=s(54844),j=s(54584),x=s(69936),w=s(25376),b=s(40604),T=(s(89500),s(29216)),a=s(66908);const K=["igoSearchItemToolbar"];function M(le,ue){1&le&&e.C_f(0)}const L=le=>({results:le});function oe(le,ue){if(1&le){const se=e.KQA();e.I0R(0,"igo-collapsible",7),e.qCj("toggle",function(Ie){e.usT(se);const Re=e.GaO().$implicit,He=e.GaO(2);return e.CGJ(He.collapsed[Re.source.title]=Ie)}),e.yuY(1,M,1,0,"ng-container",8),e.C$Y()}if(2&le){const se=e.GaO().$implicit,ge=e.Gew(4),Ie=e.GaO(2);e.m8U(se.source.getId()),e.E7m("title",Ie.computeGroupTitle(se))("collapsed",Ie.collapsed[se.source.title]),e.yG2(),e.E7m("ngTemplateOutlet",ge)("ngTemplateOutletContext",e.S45(6,L,se.results))}}function N(le,ue){1&le&&e.C_f(0)}function B(le,ue){if(1&le&&e.yuY(0,N,1,0,"ng-container",8),2&le){const se=e.GaO().$implicit,ge=e.Gew(4);e.E7m("ngTemplateOutlet",ge)("ngTemplateOutletContext",e.S45(2,L,se.results))}}const X=le=>({result:le});function V(le,ue){if(1&le){const se=e.KQA();e.I0R(0,"igo-search-results-item",10),e.qCj("focus",function(){const Re=e.usT(se).$implicit,He=e.GaO(4);return e.CGJ(He.resultFocus.emit(Re))})("unfocus",function(){const Re=e.usT(se).$implicit,He=e.GaO(4);return e.CGJ(He.resultUnfocus.emit(Re))})("select",function(){const Re=e.usT(se).$implicit,He=e.GaO(4);return e.CGJ(He.onResultSelect(Re))})("mouseenter",function(){const Re=e.usT(se).$implicit,He=e.GaO(4);return e.CGJ(He.resultFocus.emit(Re))})("mouseleave",function(){const Re=e.usT(se).$implicit,He=e.GaO(4);return e.CGJ(He.resultUnfocus.emit(Re))}),e.C_f(1,11),e.C$Y()}if(2&le){const se=ue.$implicit,ge=e.GaO(4);e.E7m("map",ge.map)("result",se)("showIcons",ge.showIcons)("withZoomButton",ge.withZoomButton)("focused",ge.store.state.get(se).focused)("selected",ge.store.state.get(se).selected),e.yG2(),e.E7m("ngTemplateOutlet",ge.templateSearchToolbar)("ngTemplateOutletContext",e.S45(8,X,se))}}function z(le,ue){if(1&le){const se=e.KQA();e.I0R(0,"span",12),e.qCj("click",function(){e.usT(se);const Ie=e.GaO(2).$implicit,Re=e.GaO(2);return e.CGJ(Re.displayMoreResults(Ie))}),e.I0R(1,"u"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()}2&le&&(e.yG2(2),e.cNF(e.kDX(3,1,"igo.geo.search.displayMoreResults")))}function W(le,ue){if(1&le&&e.yuY(0,V,2,10,"ng-template",2)(1,z,4,3,"span",9),2&le){const se=ue.results,ge=e.GaO().$implicit,Ie=e.GaO(2);e.E7m("ngForOf",se),e.yG2(),e.E7m("ngIf",Ie.isMoreResults(ge))}}function A(le,ue){if(1&le&&e.yuY(0,oe,2,8,"igo-collapsible",4)(1,B,1,4,"ng-template",null,5,e.gJz)(3,W,2,2,"ng-template",null,6,e.gJz),2&le){const se=e.Gew(2),ge=e.GaO(2);e.E7m("ngIf",ge.mode===ge.searchResultMode.Grouped)("ngIfElse",se)}}function q(le,ue){if(1&le&&(e.I0R(0,"igo-list",1),e.yuY(1,A,5,2,"ng-template",2,3,e.gJz),e.wVc(3,"async"),e.C$Y()),2&le){const se=e.GaO();e.E7m("navigation",!0),e.yG2(),e.E7m("ngForOf",e.kDX(3,2,se.results$))}}function _(le,ue){1&le&&e.C_f(0)}function u(le,ue){1&le&&e.C_f(0)}const S=le=>({group:le});function P(le,ue){if(1&le&&(e.I0R(0,"mat-tab",17),e.yuY(1,u,1,0,"ng-container",8),e.C$Y()),2&le){const se=ue.$implicit;e.GaO(2);const ge=e.Gew(7),Ie=e.GaO();e.E7m("label",Ie.computeGroupTitle(se)),e.yG2(),e.E7m("ngTemplateOutlet",ge)("ngTemplateOutletContext",e.S45(3,S,se))}}function I(le,ue){if(1&le&&(e.I0R(0,"mat-tab-group",15),e.yuY(1,P,2,5,"mat-tab",16),e.wVc(2,"async"),e.C$Y()),2&le){const se=e.GaO(2);e.yG2(),e.E7m("ngForOf",e.kDX(2,1,se.results$))}}function U(le,ue){1&le&&e.C_f(0)}function G(le,ue){if(1&le&&e.yuY(0,U,1,0,"ng-container",8),2&le){const se=ue.$implicit;e.GaO(2);const ge=e.Gew(7);e.E7m("ngTemplateOutlet",ge)("ngTemplateOutletContext",e.S45(2,S,se))}}function O(le,ue){if(1&le&&(e.yuY(0,G,1,4,"ng-template",2),e.wVc(1,"async")),2&le){const se=e.GaO(2);e.E7m("ngForOf",e.kDX(1,1,se.results$))}}function F(le,ue){if(1&le){const se=e.KQA();e.I0R(0,"igo-search-results-item",10),e.qCj("focus",function(){const Re=e.usT(se).$implicit,He=e.GaO(3);return e.CGJ(He.resultFocus.emit(Re))})("unfocus",function(){const Re=e.usT(se).$implicit,He=e.GaO(3);return e.CGJ(He.resultUnfocus.emit(Re))})("select",function(){const Re=e.usT(se).$implicit,He=e.GaO(3);return e.CGJ(He.onResultSelect(Re))})("mouseenter",function(){const Re=e.usT(se).$implicit,He=e.GaO(3);return e.CGJ(He.resultFocus.emit(Re))})("mouseleave",function(){const Re=e.usT(se).$implicit,He=e.GaO(3);return e.CGJ(He.resultUnfocus.emit(Re))}),e.C_f(1,11),e.C$Y()}if(2&le){const se=ue.$implicit,ge=e.GaO(3);e.E7m("map",ge.map)("result",se)("showIcons",ge.showIcons)("withZoomButton",ge.withZoomButton)("focused",ge.store.state.get(se).focused)("selected",ge.store.state.get(se).selected),e.yG2(),e.E7m("ngTemplateOutlet",ge.templateSearchToolbar)("ngTemplateOutletContext",e.S45(8,X,se))}}function Q(le,ue){if(1&le){const se=e.KQA();e.I0R(0,"span",12),e.qCj("click",function(){e.usT(se);const Ie=e.GaO().group,Re=e.GaO(2);return e.CGJ(Re.displayMoreResults(Ie))}),e.I0R(1,"u"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()}2&le&&(e.yG2(2),e.cNF(e.kDX(3,1,"igo.geo.search.displayMoreResults")))}function r(le,ue){if(1&le&&e.yuY(0,F,2,10,"ng-template",2)(1,Q,4,3,"span",9),2&le){const se=ue.group,ge=e.GaO(2);e.E7m("ngForOf",se.results),e.yG2(),e.E7m("ngIf",ge.isMoreResults(se))}}function ie(le,ue){if(1&le&&(e.I0R(0,"igo-list",1),e.yuY(1,_,1,0,"ng-container",13)(2,I,3,3,"ng-template",null,14,e.gJz)(4,O,2,3,"ng-template",null,5,e.gJz)(6,r,2,2,"ng-template",null,6,e.gJz),e.C$Y()),2&le){const se=e.Gew(3),ge=e.Gew(5),Ie=e.GaO();e.E7m("navigation",!0),e.yG2(),e.E7m("ngIf",Ie.mode===Ie.searchResultMode.Grouped)("ngIfThen",se)("ngIfElse",ge)}}var ae=function(le){return le.Grouped="grouped",le.Flat="flat",le}(ae||{});let fe=(()=>{class le{cdRef;searchService;configService;showResultsCount=!0;searchResultMode=ae;watcher;settingsChange$$;pageIterator=[];collapsed=[];map;store;showIcons;mode=ae.Grouped;withZoomButton=!1;tabsMode=!1;get term(){return this._term}set term(se){this._term=se,this.pageIterator=[]}_term;settingsChange$=new h.g(void 0);termSplitter="|";resultFocus=new e._w7;resultUnfocus=new e._w7;resultSelect=new e._w7;moreResults=new e._w7;resultMouseenter=new e._w7;resultMouseleave=new e._w7;templateSearchToolbar;get results$(){return void 0===this._results$&&(this._results$=this.liftResults()),this._results$}_results$;constructor(se,ge,Ie){this.cdRef=se,this.searchService=ge,this.configService=Ie}ngOnInit(){this.watcher=new g.YX(this.store,this.cdRef),this.settingsChange$$=this.settingsChange$.subscribe(()=>{this.pageIterator=[]}),!1===this.configService.getConfig("searchSources.showResultsCount")&&(this.showResultsCount=!1)}ngOnDestroy(){this.watcher.destroy(),this.settingsChange$$.unsubscribe()}computeGroupTitle(se){const ge=[se.source.title],Ie=se.results.length;return Ie>1&&this.showResultsCount&&ge.push(`(${Ie})`),ge.join(" ")}onResultSelect(se){this.store.state.get(se)&&!0===this.store.state.get(se).selected||(this.store.state.update(se,{focused:!0,selected:!0},!0),this.resultSelect.emit(se))}liftResults(){return this.store.stateView.all$().pipe((0,w.C)(se=>0===se.length?j.k:(0,x.k)(200)),(0,b.k)(se=>this.groupResults(se.map(ge=>ge.entity).sort(this.sortByOrder))))}sortByOrder(se,ge){return se.source.displayOrder-ge.source.displayOrder}groupResults(se){const ge=new Map;return se.forEach(Ie=>{const Re=Ie.source;let He=ge.get(Re);void 0===He&&(He=[],ge.set(Re,He)),He.push(Ie)}),Array.from(ge.keys()).map(Ie=>(void 0===this.pageIterator[Ie.getId()]&&(this.pageIterator[Ie.getId()]=1),{source:Ie,results:ge.get(Ie)}))}isMoreResults(se){return this.store.getStrategyOfType(g.qq)?.active?se.results?.length%+se.source.params.limit==0&&+se.source.params.page<30:se.results&&!0===se.results[se.results.length-1].meta.nextPage}displayMoreResults(se){const ge={sourceId:se.source.getId(),page:++this.pageIterator[se.source.getId()]};let Ie;Ie=this.termSplitter&&this.term.match(new RegExp(this.termSplitter,"g"))?this.term.split(this.termSplitter):[this.term];let Re=[];Ie.map(He=>{Re=Re.concat(this.searchService.search(He,ge))}),Re.map(He=>{He.request.subscribe(ht=>{const rt=se.results.concat(ht);ht.length||(rt[rt.length-1].meta.nextPage=!1),this.moreResults.emit({research:He,results:rt})})})}static \u0275fac=function(ge){return new(ge||le)(e.GI1(e.kD9),e.GI1(T._),e.GI1(R.aW))};static \u0275cmp=e.In1({type:le,selectors:[["igo-search-results"]],contentQueries:function(ge,Ie,Re){if(1&ge&&e.szK(Re,K,5),2&ge){let He;e.wto(He=e.Gqi())&&(Ie.templateSearchToolbar=He.first)}},inputs:{map:"map",store:"store",showIcons:"showIcons",mode:"mode",withZoomButton:"withZoomButton",tabsMode:"tabsMode",term:"term",settingsChange$:"settingsChange$",termSplitter:"termSplitter"},outputs:{resultFocus:"resultFocus",resultUnfocus:"resultUnfocus",resultSelect:"resultSelect",moreResults:"moreResults",resultMouseenter:"resultMouseenter",resultMouseleave:"resultMouseleave"},standalone:!0,features:[e.UHJ],decls:2,vars:2,consts:[[3,"navigation",4,"ngIf"],[3,"navigation"],["ngFor","",3,"ngForOf"],["groupTemplate",""],[3,"class","title","collapsed","toggle",4,"ngIf","ngIfElse"],["flatTemplate",""],["storeItemTemplate",""],[3,"title","collapsed","toggle"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","moreResults mat-typography",3,"click",4,"ngIf"],["igoListItem","","color","accent",3,"map","result","showIcons","withZoomButton","focused","selected","focus","unfocus","select","mouseenter","mouseleave"],["igoSearchItemToolbar","",3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"moreResults","mat-typography",3,"click"],[4,"ngIf","ngIfThen","ngIfElse"],["tabsTemplate",""],["dynamicHeight","",1,"custom-tabs-view"],[3,"label",4,"ngFor","ngForOf"],[3,"label"]],template:function(ge,Ie){1&ge&&e.yuY(0,q,4,4,"igo-list",0)(1,ie,8,4,"igo-list",0),2&ge&&(e.E7m("ngIf",!1===Ie.tabsMode),e.yG2(),e.E7m("ngIf",Ie.tabsMode))},dependencies:[y.u_,g.yM,y.Iw,g.ii,y.XV,a.g,g.qU,d.WG,d.aJ,d._q,y.a,o.O0,o.sD],styles:["[_nghost-%COMP%]   .moreResults[_ngcontent-%COMP%]{cursor:pointer;color:#00f;float:right;margin-right:10px;margin-top:5px}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]     mat-list{height:100%}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]     mat-list .custom-tabs-view .mat-mdc-tab-header-pagination{min-width:20px}"],changeDetection:0})}return le})()},1560:(Ee,ce,s)=>{"use strict";s.d(ce,{s:()=>a});var y=s(65056),e=s(34896),d=s(34672),g=s(32328),R=s(87848),o=s(21232),h=s(27e3),j=s(72584),x=s(54844),w=s(11484),b=s(29220),E=s(83456);function T(K,M){if(1&K&&(e.I0R(0,"mat-radio-button",7),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&K){const L=M.$implicit,oe=e.GaO();e.E7m("value",L),e.yG2(),e.oRS(" ",e.kDX(2,2,oe.getSearchTypeTitle(L))," ")}}let a=(()=>{class K{searchSourceService;searchType$=new x.g(void 0);searchType$$;searchTypes=b.a;set searchType(L){this.setSearchType(L)}get searchType(){return this.searchType$.value}searchTypeChange=new e._w7;constructor(L){this.searchSourceService=L}ngOnInit(){this.searchType$$=this.searchType$.pipe((0,w.a)()).subscribe(L=>this.onSetSearchType(L))}ngOnDestroy(){this.searchType$$.unsubscribe()}onSearchTypeChange(L){this.setSearchType(L)}getSearchTypeTitle(L){return`igo.geo.search.${L.toLowerCase()}.title`}setSearchType(L){this.searchType$.next(L)}onSetSearchType(L){null!=L&&(this.searchSourceService.enableSourcesByType(L),this.searchTypeChange.emit(L))}static \u0275fac=function(oe){return new(oe||K)(e.GI1(E.i))};static \u0275cmp=e.In1({type:K,selectors:[["igo-search-selector"]],inputs:{searchTypes:"searchTypes",searchType:"searchType"},outputs:{searchTypeChange:"searchTypeChange"},standalone:!0,features:[e.UHJ],decls:9,vars:8,consts:[[1,"igo-search-selector"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"igo-search-selector-button",3,"matTooltip","matMenuTriggerFor"],["svgIcon","menu-down"],["xPosition","before","yPosition","above",1,"no-border-radius"],["searchSelectorMenu","matMenu"],[1,"igo-search-selector-radio-group",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(oe,N){if(1&oe&&(e.I0R(0,"div",0)(1,"button",1),e.wVc(2,"translate"),e.wR5(3,"mat-icon",2),e.C$Y(),e.I0R(4,"mat-menu",3,4)(6,"mat-radio-group",5),e.qCj("change",function(X){return N.onSearchTypeChange(X.value)}),e.wVc(7,"async"),e.yuY(8,T,3,4,"mat-radio-button",6),e.C$Y()()()),2&oe){const B=e.Gew(5);e.yG2(),e.E7m("matTooltip",e.kDX(2,4,"igo.geo.search.menu.tooltip"))("matMenuTriggerFor",B),e.yG2(5),e.E7m("value",e.kDX(7,6,N.searchType$)),e.yG2(2),e.E7m("ngForOf",N.searchTypes)}},dependencies:[d.oJ,d.um,h.KO,h.a4,R._A,R.aM,R.yG,g.oB,g.qL,o.yk,o.cv,o.cT,y.Iw,y.a,j.O0,j.sD],styles:["[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]{border-radius:0}[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-search-selector-radio-group[_ngcontent-%COMP%]{display:inline-flex;flex-direction:column}[_nghost-%COMP%]   .igo-search-selector-radio-group[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin:5px}"],changeDetection:0})}return K})()},50620:(Ee,ce,s)=>{"use strict";s.d(ce,{Q:()=>_});var y=s(65056),e=s(34896),d=s(34672),g=s(58539),R=s(75180),o=s(32328),h=s(87848),j=s(21232),x=s(43424),w=s(27e3),b=s(9588),E=s(21720),T=s(72584),a=s(14452),K=s(83456);function M(u,S){if(1&u){const P=e.KQA();e.I0R(0,"div",11)(1,"button",12),e.qCj("click",function(U){e.usT(P);const G=e.GaO();return e.CGJ(G.checkUncheckAllSources(U))}),e.OEk(2),e.wVc(3,"translate"),e.wVc(4,"translate"),e.C$Y()()}if(2&u){const P=e.GaO();e.yG2(2),e.oRS(" ",P.searchSourcesAllEnabled?e.kDX(4,3,"igo.geo.search.searchSources.selectAll"):e.kDX(3,1,"igo.geo.search.searchSources.unselectAll")," ")}}function L(u,S){if(1&u&&(e.I0R(0,"button",18),e.OEk(1),e.C$Y()),2&u){const P=e.GaO().$implicit,I=e.Gew(6);e.E7m("matMenuTriggerFor",I),e.yG2(),e.oRS(" ",P.title," ")}}function oe(u,S){if(1&u&&(e.I0R(0,"button",8),e.OEk(1),e.C$Y()),2&u){const P=e.GaO().$implicit;e.yG2(),e.oRS(" ",P.title," ")}}function N(u,S){if(1&u){const P=e.KQA();e.I0R(0,"mat-radio-button",24),e.qCj("click",function(U){return U.stopPropagation()})("change",function(U){const O=e.usT(P).$implicit,F=e.GaO(2).$implicit,Q=e.GaO().$implicit,r=e.GaO();return e.CGJ(r.settingsValueCheckedRadioButton(U,Q,F,O))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&u){const P=S.$implicit,I=e.GaO(4);e.E7m("value",P)("matTooltip",I.getAvailableHashtagsValues(P))("checked",P.enabled),e.yG2(),e.oRS(" ",e.kDX(2,4,P.title)," ")}}function B(u,S){if(1&u&&(e.I0R(0,"span")(1,"mat-radio-group",22),e.yuY(2,N,3,6,"mat-radio-button",23),e.C$Y()()),2&u){const P=e.GaO().$implicit;e.yG2(),e.E7m("value",P),e.yG2(),e.E7m("ngForOf",P.values)}}function X(u,S){if(1&u){const P=e.KQA();e.I0R(0,"div",11)(1,"button",12),e.qCj("click",function(U){e.usT(P);const G=e.GaO(2).$implicit,O=e.GaO().$implicit,F=e.GaO();return e.CGJ(F.checkUncheckAll(U,O,G))}),e.OEk(2),e.wVc(3,"translate"),e.wVc(4,"translate"),e.C$Y()()}if(2&u){const P=e.GaO(2).$implicit;e.yG2(2),e.oRS(" ",P.allEnabled||void 0===P.allEnabled?e.kDX(3,1,"igo.geo.search.searchSources.settings.unselectAll"):e.kDX(4,3,"igo.geo.search.searchSources.settings.selectAll")," ")}}function V(u,S){if(1&u){const P=e.KQA();e.I0R(0,"div",26)(1,"mat-checkbox",27),e.qCj("click",function(U){return U.stopPropagation()})("change",function(U){const O=e.usT(P).$implicit,F=e.GaO(2).$implicit,Q=e.GaO().$implicit,r=e.GaO();return e.CGJ(r.settingsValueCheckedCheckbox(U,Q,F,O))}),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()}if(2&u){const P=S.$implicit,I=e.GaO(2).$implicit,U=e.GaO(2);e.yG2(),e.m4B("display",U.displayBlock),e.E7m("checked",P.enabled)("value",I)("matTooltip",U.getAvailableHashtagsValues(P)),e.yG2(),e.oRS(" ",e.kDX(3,6,P.title)," ")}}function z(u,S){if(1&u&&(e.I0R(0,"span"),e.yuY(1,X,5,5,"div",5)(2,V,4,8,"div",25),e.C$Y()),2&u){const P=e.GaO().$implicit,I=e.GaO(2);e.yG2(),e.E7m("ngIf",P.values.length>3),e.yG2(),e.E7m("ngForOf",I.getAvailableValues(P))}}function W(u,S){if(1&u&&(e.SAx(0),e.I0R(1,"button",18),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"mat-menu",19,20),e.yuY(6,B,3,2,"span",21)(7,z,3,2,"span",21),e.C$Y(),e.k70()),2&u){const P=S.$implicit,I=e.Gew(5);e.yG2(),e.E7m("matMenuTriggerFor",I),e.yG2(),e.oRS(" ",e.kDX(3,5,"igo.geo.search.searchSources.settings."+P.title)," "),e.yG2(2),e.E7m("ngSwitch",P.type),e.yG2(2),e.E7m("ngSwitchCase","radiobutton"),e.yG2(),e.E7m("ngSwitchCase","checkbox")}}function A(u,S){if(1&u){const P=e.KQA();e.SAx(0),e.I0R(1,"span",13)(2,"mat-checkbox",14),e.qCj("click",function(U){return U.stopPropagation()})("change",function(U){const O=e.usT(P).$implicit,F=e.GaO();return e.CGJ(F.onCheckSearchSource(U,O))}),e.C$Y(),e.yuY(3,L,2,2,"button",15)(4,oe,2,1,"button",16),e.C$Y(),e.I0R(5,"mat-menu",null,17),e.yuY(7,W,8,7,"ng-container",6),e.C$Y(),e.k70()}if(2&u){const P=S.$implicit;e.yG2(2),e.E7m("checked",P.enabled)("value",P),e.yG2(),e.E7m("ngIf",P.settings.length>0),e.yG2(),e.E7m("ngIf",0===P.settings.length),e.yG2(3),e.E7m("ngForOf",P.settings)}}function q(u,S){if(1&u){const P=e.KQA();e.I0R(0,"mat-slide-toggle",10),e.qCj("change",function(U){e.usT(P);const G=e.GaO();return e.CGJ(G.changePointerReverseSearch(U))})("click",function(U){return U.stopPropagation()}),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()}if(2&u){const P=e.GaO();e.E7m("matTooltip",e.kDX(1,3,"igo.geo.search.pointerSearchSummary.tooltip"))("checked",P.pointerSummaryEnabled),e.yG2(2),e.oRS(" ",e.kDX(3,5,"igo.geo.search.pointerSearchSummary.title")," ")}}let _=(()=>{class u{searchSourceService;mediaService;storageService;hasPointerReverseSearchSource=!1;searchSourcesAllEnabled=!1;buffer=[];lastKeyTime=Date.now();displayBlock="block";get isTouchScreen(){return this.mediaService.isTouchScreen()}pointerSummaryEnabled=!1;searchResultsGeometryEnabled=!1;reverseSearchCoordsFormatEnabled=!1;searchSourceChange=new e._w7;pointerSummaryStatus=new e._w7;searchResultsGeometryStatus=new e._w7;reverseSearchCoordsFormatStatus=new e._w7;handleKeyboardEvent(P){"F2"===P.key&&(this.pointerSummaryEnabled=!this.pointerSummaryEnabled,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled))}constructor(P,I,U){this.searchSourceService=P,this.mediaService=I,this.storageService=U}ngOnInit(){this.hasPointerReverseSearchSource=this.hasReverseSearchSourcesForPointerSummary()}getSearchSources(){const P=this.searchSourceService.getSources().filter(a.ay).filter(G=>G.available&&"map"!==G.getId()&&G.showInSettings),I=this.searchSourceService.getSources().filter(a.ae).filter(G=>G.available&&"map"!==G.getId()&&G.showInSettings),U=P.concat(I);return this.computeSourcesCheckAllBehavior(U),U}hasReverseSearchSourcesForPointerSummary(){return!!this.searchSourceService.getEnabledSources().filter(a.ig).length}settingsValueCheckedCheckbox(P,I,U,G){G.enabled=P.checked,I.setParamFromSetting(U),this.searchSourceChange.emit(I)}computeSettingCheckAllBehavior(P){P.allEnabled=void 0===P.allEnabled?!P.values.find(I=>I.enabled):!P.allEnabled}computeSourcesCheckAllBehavior(P){const I=P.filter(G=>G.enabled).length,U=P.filter(G=>!G.enabled).length;this.searchSourcesAllEnabled=!(I>=U)}checkUncheckAll(P,I,U){P.stopPropagation(),this.computeSettingCheckAllBehavior(U),U.values.forEach(G=>{G.enabled=U.allEnabled}),I.setParamFromSetting(U),this.searchSourceChange.emit(I)}checkUncheckAllSources(P){P.stopPropagation(),this.getSearchSources().map(I=>{I.enabled=this.searchSourcesAllEnabled,this.searchSourceChange.emit(I)})}settingsValueCheckedRadioButton(P,I,U,G){U.values.forEach(O=>{O.enabled=O.value!==G.value?!P.source.checked:P.source.checked}),I.setParamFromSetting(U),this.searchSourceChange.emit(I)}onCheckSearchSource(P,I){I.enabled=P.checked;const U=this.storageService.get(I.getId()+".options")||{};U.enabled=I.enabled,this.storageService.set(I.getId()+".options",U),this.searchSourceChange.emit(I)}getAvailableValues(P){return P.values.filter(I=>!1!==I.available)}getAvailableHashtagsValues(P){if(P.hashtags)return P.hashtags.map(I=>"#"+I).join(", ")}stopPropagation(P){P.stopPropagation()}changePointerReverseSearch(P){this.pointerSummaryEnabled=P.checked,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled)}changeSearchResultsGeometry(P){this.searchResultsGeometryEnabled=P.checked,this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled)}reverseSearchCoordsFormat(P){this.reverseSearchCoordsFormatEnabled=P.checked,this.reverseSearchCoordsFormatStatus.emit(this.reverseSearchCoordsFormatEnabled)}static \u0275fac=function(I){return new(I||u)(e.GI1(K.i),e.GI1(b.QB),e.GI1(E.yQ))};static \u0275cmp=e.In1({type:u,selectors:[["igo-search-settings"]],hostBindings:function(I,U){1&I&&e.qCj("keydown",function(O){return U.handleKeyboardEvent(O)},!1,e.wLc)},inputs:{pointerSummaryEnabled:"pointerSummaryEnabled",searchResultsGeometryEnabled:"searchResultsGeometryEnabled",reverseSearchCoordsFormatEnabled:"reverseSearchCoordsFormatEnabled"},outputs:{searchSourceChange:"searchSourceChange",pointerSummaryStatus:"pointerSummaryStatus",searchResultsGeometryStatus:"searchResultsGeometryStatus",reverseSearchCoordsFormatStatus:"reverseSearchCoordsFormatStatus"},standalone:!0,features:[e.UHJ],decls:23,vars:23,consts:[[1,"igo-search-settings"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"igo-search-settings-button",3,"matTooltip","matMenuTriggerFor"],["svgIcon","chevron-down"],[1,"no-border-radius"],["searchSettingsMenu","matMenu"],["class","checkAllButton",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"pointer-summary-slide-toggle-container"],["mat-menu-item",""],["class","search-option","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","checked","change","click",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500",1,"search-option",3,"matTooltip","checked","change","click"],[1,"checkAllButton"],["mat-raised-button","",3,"click"],[1,"igo-search-settings-search-source"],[1,"igo-search-settings-checkbox",3,"checked","value","click","change"],["mat-menu-item","",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",4,"ngIf"],["sub_menu","matMenu"],["mat-menu-item","",3,"matMenuTriggerFor"],["yPosition","above",3,"ngSwitch"],["test_sub_menu","matMenu"],[4,"ngSwitchCase"],[1,"igo-search-settings-radio-group",3,"value"],["class","mat-typography",3,"value","matTooltip","checked","click","change",4,"ngFor","ngForOf"],[1,"mat-typography",3,"value","matTooltip","checked","click","change"],["class","igo-search-settings-sub-menu","mat-menu-item","",4,"ngFor","ngForOf"],["mat-menu-item","",1,"igo-search-settings-sub-menu"],[3,"checked","value","matTooltip","click","change"]],template:function(I,U){if(1&I&&(e.I0R(0,"div",0)(1,"button",1),e.wVc(2,"translate"),e.wR5(3,"mat-icon",2),e.C$Y(),e.I0R(4,"mat-menu",3,4),e.yuY(6,M,5,5,"div",5)(7,A,8,5,"ng-container",6),e.wR5(8,"mat-divider"),e.I0R(9,"span",7)(10,"div",8),e.yuY(11,q,4,7,"mat-slide-toggle",9),e.C$Y(),e.I0R(12,"div",8)(13,"mat-slide-toggle",10),e.qCj("change",function(O){return U.changeSearchResultsGeometry(O)})("click",function(O){return O.stopPropagation()}),e.wVc(14,"translate"),e.OEk(15),e.wVc(16,"translate"),e.C$Y()(),e.I0R(17,"div",8)(18,"mat-slide-toggle",10),e.qCj("change",function(O){return U.reverseSearchCoordsFormat(O)})("click",function(O){return O.stopPropagation()}),e.wVc(19,"translate"),e.wVc(20,"translate"),e.OEk(21),e.wVc(22,"translate"),e.C$Y()()()()()),2&I){const G=e.Gew(5);e.yG2(),e.E7m("matTooltip",e.kDX(2,11,"igo.geo.search.menu.tooltip"))("matMenuTriggerFor",G),e.yG2(5),e.E7m("ngIf",U.getSearchSources().length>4),e.yG2(),e.E7m("ngForOf",U.getSearchSources()),e.yG2(4),e.E7m("ngIf",U.hasPointerReverseSearchSource&&!U.isTouchScreen),e.yG2(2),e.E7m("matTooltip",e.kDX(14,13,"igo.geo.search.searchResultsGeometry.tooltip"))("checked",U.searchResultsGeometryEnabled),e.yG2(2),e.oRS(" ",e.kDX(16,15,"igo.geo.search.searchResultsGeometry.title")," "),e.yG2(3),e.E7m("matTooltip",U.reverseSearchCoordsFormatEnabled?e.kDX(19,17,"igo.geo.search.reverseCoordFormat.tooltipLatLon"):e.kDX(20,19,"igo.geo.search.reverseCoordFormat.tooltipLonLat"))("checked",U.reverseSearchCoordsFormatEnabled),e.yG2(3),e.oRS(" ",e.kDX(22,21,"igo.geo.search.reverseCoordFormat.title")," ")}},dependencies:[d.oJ,d.Gw,d.um,w.KO,w.a4,h._A,h.aM,h.OQ,h.yG,o.oB,o.qL,y.u_,y.Iw,g.Vn,g.WK,y.Ko,y.Wm,j.yk,j.cv,j.cT,R.U,R.k,x.GE,x.cP,T.O0,T.sD],styles:["[_nghost-%COMP%]{display:flex;align-items:center}.checkAllButton[_ngcontent-%COMP%]{text-align:center;padding:0 5px}.igo-search-settings-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-right:16px}.igo-search-settings-checkbox[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{display:flex}.igo-search-settings-search-source[_ngcontent-%COMP%]{display:flex;width:100%}.igo-search-settings-search-source[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{display:flex;margin-left:5px;margin-right:5px}.search-option[_ngcontent-%COMP%]{display:block;margin-right:10px;margin-bottom:15px}.pointer-summary-slide-toggle-container[_ngcontent-%COMP%]{overflow-x:hidden}.pointer-summary-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{margin:10px 0}.igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], .igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}.igo-search-settings-sub-menu[_ngcontent-%COMP%]{min-height:34px}"],changeDetection:0})}return u})()},71320:(Ee,ce,s)=>{"use strict";s.d(ce,{k:()=>X});var y=s(62228),e=s(9588),d=s(64002),g=s(58264),R=s(83552),o=s(12396),h=s(80848),j=s(61252),x=s(83680),w=s(67732),b=s(70524),E=s(68392),T=s(40240),a=s(2892),K=s(9364),M=s(59800),L=s(29216),oe=s(14452),N=s(34896),B=s(83456);let X=(()=>{class V{component;searchService;searchSourceService;mediaService;store;lonLat;pointerSearchStore=new y.qc([]);lastTimeoutRequest;store$$;layers$$;reverseSearch$$=[];hasPointerReverseSearchSource=!1;pointerMoveListener;searchPointerSummaryFeatureId="searchPointerSummaryFeatureId";igoSearchPointerSummaryDelay=1e3;igoSearchPointerSummaryEnabled=!1;mouseleave(){clearTimeout(this.lastTimeoutRequest),this.clearLayer()}get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(W,A,q,_){this.component=W,this.searchService=A,this.searchSourceService=q,this.mediaService=_}ngOnInit(){this.listenToMapPointerMove(),this.map.status$.pipe((0,x.K)(W=>W===d.qM.Done)).subscribe(()=>{this.store=new T.y([],{map:this.map}),this.initStore(),this.subscribeToPointerStore()}),this.layers$$=this.map.layers$.subscribe(W=>{this.store&&!W.find(A=>"searchPointerSummaryId"===A.id)&&this.initStore()})}initStore(){const W=this.store,A=new a.M({isIgoInternalLayer:!0,id:"searchPointerSummaryId",title:"searchPointerSummary",zIndex:900,source:new w.E,showInLayerList:!1,exportable:!1,browsable:!1,style:M.uq});(0,b.m)(W,A)}ngAfterContentChecked(){this.hasPointerReverseSearchSource=!!this.searchSourceService.getEnabledSources().filter(oe.ig).length}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unsubscribeReverseSearch(),this.layers$$.unsubscribe()}subscribeToPointerStore(){this.store$$=this.pointerSearchStore.entities$.subscribe(W=>{this.entitiesToPointerOverlay(W)})}computeSummaryClosestFeature(W){const A={};return W.map(q=>{q.data.properties.type&&q.data.properties.distance>=0&&(A.hasOwnProperty(q.data.properties.type)?q.data.properties.distance<A[q.data.properties.type].distance&&(A[q.data.properties.type]={distance:q.data.properties.distance,title:q.meta.pointerSummaryTitle||q.meta.title}):A[q.data.properties.type]={distance:q.data.properties.distance,title:q.meta.pointerSummaryTitle||q.meta.title})}),A}entitiesToPointerOverlay(W){const A=this.computeSummaryClosestFeature(W),q=Object.keys(A),_=[],u=[];W.map(S=>{const P=q.indexOf(S.data.properties.type);-1!==P?(u.push(A[S.data.properties.type].title),q.splice(P,1),_.push(S.data.properties.type)):-1===_.indexOf(S.data.properties.type)&&u.push(S.meta.pointerSummaryTitle||S.meta.title)}),u.length&&this.addPointerOverlay(u.join("\n"))}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",W=>this.onMapEvent(W))}unsubscribeToPointerStore(){this.store$$.unsubscribe()}unsubscribeReverseSearch(){this.reverseSearch$$.map(W=>W.unsubscribe()),this.reverseSearch$$=[]}unlistenToMapPointerMove(){(0,R.S)(this.pointerMoveListener),this.pointerMoveListener=void 0}onMapEvent(W){!W.dragging&&this.igoSearchPointerSummaryEnabled&&this.hasPointerReverseSearchSource&&!this.mediaService.isTouchScreen()?(typeof this.lastTimeoutRequest<"u"&&(clearTimeout(this.lastTimeoutRequest),this.clearLayer(),this.unsubscribeReverseSearch()),this.lonLat=(0,j.AF)(W.coordinate,this.mapProjection,"EPSG:4326"),this.lastTimeoutRequest=setTimeout(()=>{this.onSearchCoordinate()},this.igoSearchPointerSummaryDelay)):this.clearLayer()}sortByOrder(W,A){return W.source.displayOrder-A.source.displayOrder}onSearchCoordinate(){this.pointerSearchStore.clear();const W=this.searchService.reverseSearch(this.lonLat,{params:{geometry:"false",icon:"false"}},!0);for(const A in W)W.length>0&&this.reverseSearch$$.push(W[A].request.subscribe(q=>{this.onSearch({research:W[A],results:q})}))}onSearch(W){const A=W.results,q=this.pointerSearchStore.all().filter(_=>_.source!==W.research.source).concat(A);this.pointerSearchStore.load(q.sort(this.sortByOrder))}addPointerOverlay(W){this.clearLayer();const A=new h.c((0,j.AF)(this.lonLat,"EPSG:4326",this.mapProjection)),q=new g.c({geometry:A}),_=(new o.c).writeGeometryObject(A,{featureProjection:this.mapProjection,dataProjection:this.mapProjection});this.store.setLayerFeatures([{type:E.Y,geometry:_,projection:this.mapProjection,properties:{id:this.searchPointerSummaryFeatureId,pointerSummary:W},meta:{id:this.searchPointerSummaryFeatureId},ol:q}],E.S.None)}clearLayer(){this.store&&this.store.clearLayer()}static \u0275fac=function(A){return new(A||V)(N.GI1(K.q,2),N.GI1(L._),N.GI1(B.i),N.GI1(e.QB))};static \u0275dir=N.Sc5({type:V,selectors:[["","igoSearchPointerSummary",""]],hostBindings:function(A,q){1&A&&N.qCj("mouseleave",function(){return q.mouseleave()})},inputs:{igoSearchPointerSummaryDelay:"igoSearchPointerSummaryDelay",igoSearchPointerSummaryEnabled:"igoSearchPointerSummaryEnabled"},standalone:!0})}return V})()},83456:(Ee,ce,s)=>{"use strict";s.d(ce,{i:()=>y});class y{sources;constructor(d){this.sources=d}getSources(){return this.sources}getEnabledSources(){return this.getSources().filter(d=>!0===d.enabled)}enableSourcesByType(d){this.getSources().forEach(g=>{g.enabled=g.constructor.type===d})}setParamFromSetting(d,g){d.setParamFromSetting(g)}setWorkspaces(d,g){d.setWorkspaces(g)}}},29220:(Ee,ce,s)=>{"use strict";s.d(ce,{a:()=>d});var y=s(68392),e=s(8492);const d=[y.Y,e.i]},29216:(Ee,ce,s)=>{"use strict";s.d(ce,{_:()=>h});var y=s(21720),e=s(59324),d=s(14452),g=s(34896),R=s(83456),o=s(12268);let h=(()=>{class j{searchSourceService;mapService;storageService;constructor(w,b,E){this.searchSourceService=w,this.mapService=b,this.storageService=E}search(w,b={}){if(!this.termIsValid(w))return[];const E=this.mapService.getMap()?.projection||"EPSG:3857",T=(0,e.Sc)(w,E,{forceNA:b.forceNA});if(T.lonLat)return this.reverseSearch(T.lonLat,{distance:T.radius,conf:T.conf});let a;return T.message&&console.log(T.message),b.extent=this.mapService.getMap()?.viewController.getExtent("EPSG:4326"),a=b.getEnabledOnly||void 0===b.getEnabledOnly?this.searchSourceService.getEnabledSources():this.searchSourceService.getSources(),b.sourceId?a=a.filter(K=>K.getId()===b.sourceId):b.searchType&&(a=a.filter(K=>K.getType()===b.searchType)),a=a.filter(d.ay),this.searchSources(a,w,b)}reverseSearch(w,b,E=!1){const T=E?d.ig:d.ae,a=this.searchSourceService.getEnabledSources().filter(T),K=this.storageService.get("reverseSearchCoordsFormatEnabled")||!1;return this.reverseSearchSources(a,w,b||{},K)}searchSources(w,b,E){return w.map(T=>({request:T.search(b,E),reverse:!1,source:T}))}reverseSearchSources(w,b,E,T){return w.map(a=>({request:a.reverseSearch(b,E,T),reverse:!0,source:a}))}termIsValid(w){return"string"==typeof w&&""!==w}static \u0275fac=function(b){return new(b||j)(g.CoB(R.i),g.CoB(o.u),g.CoB(y.yQ))};static \u0275prov=g.wxM({token:j,factory:j.\u0275fac,providedIn:"root"})}return j})()},14452:(Ee,ce,s)=>{"use strict";function e(j){return void 0!==j.search}function d(j){return void 0!==j.reverseSearch}function g(j){return void 0!==j.reverseSearch&&!0===j.showInPointerSummary}function o(j,x){let w="";return x.split("").forEach((b,E)=>{b!==j.charAt(E)&&(w+=b)}),w}function h(j,x,w=!1){if(!j||!x)return 0;const b=w?j:j.toString().toLowerCase(),E=w?x:x.toString().toLowerCase(),K=o(b,E)+o(E,b);let M=0;return K.length&&(M=K.length/b.length*100),100-Math.floor(M)}s.d(ce,{Un:()=>h,ae:()=>d,ay:()=>e,ig:()=>g}),s(68392)},78168:(Ee,ce,s)=>{"use strict";s.d(ce,{i:()=>e});var y=s(64002);let e=(()=>class d{storageService;static id="";static type="";options;getId(){throw new Error('You have to implement the method "getId".')}getType(){throw new Error('You have to implement the method "getType".')}getDefaultOptions(){throw new Error('You have to implement the method "getDefaultOptions".')}get title(){return this.options.title}get available(){return!1!==this.options.available}set enabled(R){this.options.enabled=R}get enabled(){return this.available&&!1!==this.options.enabled}get showInPointerSummary(){return this.options.showInPointerSummary||!1}get showInSettings(){const R=this.options.showInSettings;return void 0===R||R}get searchUrl(){return this.options.searchUrl}get params(){return this.options.params}get settings(){return void 0===this.options.settings?[]:this.options.settings}set featureStoresWithIndex(R){this._featureStoresWithIndex=R}get featureStoresWithIndex(){return this._featureStoresWithIndex}_featureStoresWithIndex;setWorkspaces(R){this.options.available=R.filter(j=>j.entityStore.searchDocument).length>=1;const o=[];this.featureStoresWithIndex=R.filter(j=>j.entityStore.searchDocument).map(j=>(o.push({title:j.title,value:j.title,enabled:!0}),j.entityStore));const h=this.options.settings.find(j=>"datasets"===j.title);h&&(h.values=o),this.setParamFromSetting(h)}setParamFromSetting(R,o=!0){switch(R.type){case"radiobutton":R.values.forEach(j=>{j.enabled&&(this.options.params=Object.assign(this.options.params||{},{[R.name]:j.value}))});break;case"checkbox":let h="";R.values.filter(j=>!1!==j.available).forEach(j=>{j.enabled&&(h+=j.value+",")}),h=h.slice(0,-1),this.options.params=Object.assign(this.options.params||{},{[R.name]:h})}o&&this.storageService&&this.storageService.set(this.getId()+".options",{params:this.options.params})}get displayOrder(){return void 0===this.options.order?99:this.options.order}constructor(R,o){if(this.storageService=o,this.options=R,this.storageService){const h=this.storageService.get(this.getId()+".options");h&&(this.options=y.Yv.mergeDeep(this.options,h))}this.options=y.Yv.mergeDeep(this.getDefaultOptions(),this.options),this.settings.forEach(h=>{this.setParamFromSetting(h,!1)})}getHashtagsValid(R,o){const h=R.match(/(#[A-Za-z\xc0-\xff-+]+)/g);if(!h)return;const j=this.getSettingsValues(o),x=[];return h.forEach(w=>{j.values.forEach(b=>{const E=w.substring(1);if("string"==typeof b.value){const T=b.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(","),a=T.indexOf(E.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""));-1!==a&&x.push(T[a])}b.hashtags&&-1!==b.hashtags.indexOf(E.toLowerCase())&&x.push(b.value)})}),x.filter((w,b)=>x.indexOf(w)===b)}getSettingsValues(R){return this.getDefaultOptions().settings.find(o=>o.name===R)}})()},88824:(Ee,ce,s)=>{"use strict";s.d(ce,{y:()=>x});var y=s(61252),e=s(54776),d=s(62632),g=s(88872),R=s(91088),o=s(45212),h=s(87544),j=s(71888);class x{_converters;_renderers;constructor(){this._converters={},this._converters.esriPMS=x._convertEsriPMS,this._converters.esriSFS=x._convertEsriSFS,this._converters.esriSLS=x._convertEsriSLS,this._converters.esriSMS=x._convertEsriSMS,this._converters.esriTS=x._convertEsriTS,this._renderers={},this._renderers.uniqueValue=this._renderUniqueValue,this._renderers.simple=this._renderSimple,this._renderers.classBreaks=this._renderClassBreaks}static _convertPointToPixel(b){return b/.75}static _transformColor(b){return[b[0],b[1],b[2],b[3]/255]}static _getResolutionForScale(b,E){const a=y.q[E];return parseFloat(b)/(39.3701*a*96)}static _convertEsriTS(b){const E=x._transformAngle(b.angle),T=void 0!==b.text?b.text:void 0;return new e.cp({text:new d.c({fill:new g.c({color:x._transformColor(b.color)}),font:b.font.style+" "+b.font.weight+" "+b.font.size+" px "+b.font.family,textBaseline:b.verticalAlignment,textAlign:b.horizontalAlignment,offsetX:x._convertPointToPixel(b.xoffset),offsetY:x._convertPointToPixel(b.yoffset),rotation:E,text:T})})}static _convertEsriPMS(b){const E="data:"+b.contentType+";base64, "+b.imageData,T=x._transformAngle(b.angle);return new e.cp({image:new R.c({src:E,rotation:T})})}static _convertEsriSFS(b){const E=new g.c({color:x._transformColor(b.color)}),T=b.outline?x._convertOutline(b.outline):void 0;return new e.cp({fill:E,stroke:T})}static _convertOutline(b){let E;const T=x._transformColor(b.color);return"esriSLSDash"===b.style?E=[5]:"esriSLSDashDot"===b.style?E=[5,5,1,2]:"esriSLSDashDotDot"===b.style?E=[5,5,1,2,1,2]:"esriSLSDot"===b.style?E=[1,2]:"esriSLSNull"===b.style&&(T[3]=0),new o.c({color:T,lineDash:E,width:x._convertPointToPixel(b.width)})}static _convertEsriSLS(b){return new e.cp({stroke:x._convertOutline(b)})}static _transformAngle(b){if(0===b||void 0===b)return;const T=-b*Math.PI/180+Math.PI/2;return T<0?2*Math.PI+T:T}static _convertEsriSMS(b){const E=new g.c({color:x._transformColor(b.color)}),T=b.outline?x._convertOutline(b.outline):void 0,a=x._convertPointToPixel(b.size)/2,K=x._transformAngle(b.angle);return"esriSMSCircle"===b.style?new e.cp({image:new h.c({radius:a,fill:E,stroke:T})}):"esriSMSCross"===b.style?new e.cp({image:new j.c({fill:E,stroke:T,points:4,radius:a,radius2:0,angle:0,rotation:K})}):"esriSMSDiamond"===b.style?new e.cp({image:new j.c({fill:E,stroke:T,points:4,radius:a,rotation:K})}):"esriSMSSquare"===b.style?new e.cp({image:new j.c({fill:E,stroke:T,points:4,radius:a,angle:Math.PI/4,rotation:K})}):"esriSMSX"===b.style?new e.cp({image:new j.c({fill:E,stroke:T,points:4,radius:a,radius2:0,angle:Math.PI/4,rotation:K})}):"esriSMSTriangle"===b.style?new e.cp({image:new j.c({fill:E,stroke:T,points:3,radius:a,angle:0,rotation:K})}):void 0}_convertLabelingInfo(b,E){const T=[];for(let a=0,K=b.length;a<K;++a){const M=b[a].labelExpression,L=M.substr(M.indexOf("[")+1,M.indexOf("]")-1),oe=b[a].symbol,N=b[a].maxScale,B=b[a].minScale;let X=null;0!==N&&(X=x._getResolutionForScale(N,E));let V=null;0!==B&&(V=x._getResolutionForScale(B,E));const z=this._converters[oe.type].call(this,oe);T.push(function(W,A){let q=!0;if(null!==this.minResolution&&null!==this.maxResolution?q=A<this.maxResolution&&A>=this.minResolution:null!==this.minResolution?q=A>=this.minResolution:null!==this.maxResolution&&(q=A<this.maxResolution),q){const _=W.get(this.field);return this.style.getText().setText(_),[this.style]}}.bind({minResolution:X,maxResolution:V,field:L,style:z}))}return T}_renderSimple(b){const E=this._converters[b.symbol.type].call(this,b.symbol);return()=>[E]}_renderClassBreaks(b){const E=b.defaultSymbol,T=this._converters[E.type].call(this,E),a=b.field,K=[];for(let M=0,L=b.classBreakInfos.length;M<L;++M){const oe=b.classBreakInfos[M];let N;N=null==oe.classMinValue?0===M?b.minValue:b.classBreakInfos[M-1].classMaxValue:oe.classMinValue;const B=oe.classMaxValue,X=oe.symbol,V=this._converters[X.type].call(this,X);K.push({min:N,max:B,style:V})}return M=>{const L=M.get(a);for(let oe=0,N=K.length;oe<N;++oe){let B;if(B=0===oe?L>=K[oe].min&&L<=K[oe].max:L>K[oe].min&&L<=K[oe].max,B)return[K[oe].style]}return[T]}}_renderUniqueValue(b){const E=b.defaultSymbol;let T=[];E&&(T=[this._converters[E.type].call(this,E)]);const a=b.field1,K=b.uniqueValueInfos,M=this;return(()=>{const L={};for(let oe=0,N=K.length;oe<N;++oe){const B=K[oe],X=B.symbol;L[B.value]=[M._converters[X.type].call(M,X)]}return oe=>L[oe.get(a)]||T})()}generateStyle(b,E){const T=b.drawingInfo;let a=[];const K=this._renderers[T.renderer.type].call(this,T.renderer);if(void 0!==K&&a.push(K),b.labelingInfo){const M=this._convertLabelingInfo(b.labelingInfo,E);a=a.concat(M)}return 1===a.length?a[0]:(M,L)=>{let oe=[];for(let N=0,B=a.length;N<B;++N){const X=a[N].call(null,M,L);X&&(oe=oe.concat(X))}return oe}}}},59800:(Ee,ce,s)=>{"use strict";s.d(ce,{Cy:()=>x,M4:()=>j,_o:()=>w,uq:()=>b});var y=s(45212),e=s(88872),d=s(54776),g=s(87544),R=s(62632),o=s(91088),h=s(82048);function j(){const E=Math.floor(255*Math.random()),T=Math.floor(255*Math.random()),a=Math.floor(255*Math.random()),K=new y.c({color:[E,T,a,1],width:2}),M=new e.c({color:[E,T,a,.4]});return(L,oe)=>{const N=L.get("_style");if(N){if(N.circle&&L.get("rad")&&L.get("longitude")&&L.get("latitude")){const V=[L.get("longitude"),L.get("latitude")],z=L.get("rad")/Math.cos(Math.PI/180*V[1])/oe;N.circle.radius=z}return(new h.U).createStyle(N,void 0,oe)}return new d.cp({stroke:K,fill:M,image:new g.c({radius:5,stroke:K,fill:M}),text:L.get("_mapTitle")?new R.c({text:L.get("_mapTitle").toString(),offsetX:5,offsetY:-5,font:"12px Calibri,sans-serif",fill:new e.c({color:"#000"}),stroke:new y.c({color:"#fff",width:3}),overflow:!0}):void 0})}}function x(){const E=Math.floor(255*Math.random()),T=Math.floor(255*Math.random()),a=Math.floor(255*Math.random()),K=new y.c({color:[E,T,a,1],width:2}),M=new e.c({color:[E,T,a,.4]});return new d.cp({stroke:K,fill:M,image:new g.c({radius:5,stroke:K,fill:M})})}function w(E,T){const K=[new d.cp({text:new R.c({text:E.get("hoverSummary"),textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:new e.c({color:"#000"}),backgroundFill:new e.c({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new y.c({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new y.c({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:20,padding:[2.5,2.5,2.5,2.5]})})];return"Point"===E.getGeometry().getType()?K.push(new d.cp({image:new g.c({radius:10,stroke:new y.c({color:"blue",width:3})})})):(K.push(new d.cp({stroke:new y.c({color:"white",width:5})})),K.push(new d.cp({stroke:new y.c({color:"blue",width:3})}))),K}function b(E,T){return new d.cp({image:new o.c({src:"./assets/igo2/geo/icons/cross_black_18px.svg"}),text:new R.c({text:E.get("pointerSummary"),textAlign:"left",textBaseline:"bottom",font:"12px Calibri,sans-serif",fill:new e.c({color:"#000"}),backgroundFill:new e.c({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new y.c({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new y.c({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:-10,padding:[2.5,2.5,2.5,2.5]})})}},47572:(Ee,ce,s)=>{"use strict";s.d(ce,{o:()=>h});var y=s(99980),e=s(54776),d=s(91088),g=s(62632),R=s(88872),o=s(45212);function h({text:j,opacity:x=1,markerColor:w=[0,161,222],markerOutlineColor:b=[255,255,255]}={}){let E,T,a,K;const M=(0,y.f4)(w).slice(0),L=(0,y.f4)(b).slice(0);return 4===M.length&&("string"!=typeof w||/^#[0-9A-F]{8}$/i.test(w))&&(x=M[3]),T=`"rgba(${M[0]},${M[1]},${M[2]},${x})"`,E=w,a=`"rgb(${L[0]},${L[1]},${L[2]})"`,K='data:image/svg+xml;utf8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" height="36" width="36" viewBox="0 0 36 36"><path fill='+T+" stroke="+a+' stroke-width="2" d="M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z"></path></svg>',new e.cp({image:new d.c({src:K,opacity:x,anchor:[.5,.92]}),text:new g.c({text:j,font:"12px Calibri,sans-serif",fill:new R.c({color:"#000"}),stroke:new o.c({color:"#fff",width:3}),overflow:!0})})}},52756:(Ee,ce,s)=>{"use strict";s.d(ce,{B:()=>w,I:()=>x});var y=s(99980),e=s(45212),d=s(88872),g=s(54776),R=s(87544),o=s(62632),h=s(82048),j=s(47572);function x(){const E=w(),T=(0,j.o)();let a;return(K,M)=>{if("bufferFeature"===K.getId())return a=function b(E=[0,161,222,1],T=2,a=[0,161,222,.15],K){const M=new e.c({width:T,color:E}),L=new d.c({color:a});return new g.cp({stroke:M,fill:L,image:new R.c({radius:5,stroke:M,fill:L}),text:new o.c({font:"12px Calibri,sans-serif",text:K,fill:new d.c({color:"#000"}),stroke:new e.c({color:"#fff",width:3}),overflow:!0})})}(K.get("bufferStroke"),2,K.get("bufferFill"),K.get("bufferText")),a;{const L=K.get("_style");return L?(new h.U).createStyle(L,K,M):(a="Point"===K.getGeometry().getType()?T:E,a.getText().setText(K.get("_mapTitle")),a)}}}function w({text:E,strokeWidth:T=2,fillColor:a=[0,161,222,.3],strokeColor:K=[0,161,222,.9]}={}){const M=(0,y.f4)(a).slice(0),L=(0,y.f4)(K).slice(0),oe=new e.c({width:T,color:L}),N=new d.c({color:M});return new g.cp({stroke:oe,fill:N,image:new R.c({radius:5,stroke:oe,fill:N}),text:new o.c({text:E,font:"12px Calibri,sans-serif",fill:new d.c({color:"#000"}),stroke:new e.c({color:"#fff",width:3}),overflow:!0})})}},82048:(Ee,ce,s)=>{"use strict";s.d(ce,{U:()=>T});var y=s(58264),e=s(54776),d=s(7444),g=s(71888),R=s(88872),o=s(45212),h=s(62632),j=s(91088),x=s(87544),w=s(59324),b=s(47572),E=s(34896);let T=(()=>{class a{style;createStyle(M,L,oe){if(!M)return(0,b.o)();if("function"==typeof M||M instanceof e.cp)return M;const N=this.parseStyle("style",M);if(N.getText()){let B=0,X=1/0;if(M.text){const V=M.text?.minScaleDenom?(0,w.bg)(Number(M.text.minScaleDenom)):void 0,z=M.text?.maxScaleDenom?(0,w.bg)(Number(M.text.maxScaleDenom)):void 0;B=V||(M.text?.minResolution?M.text.minResolution:0),X=z||(M.text?.maxResolution?M.text.maxResolution:1/0)}(M.text?.minScaleDenom||M.text?.maxScaleDenom||M.text?.minResolution||M.text?.maxResolution)&&(L&&oe>=B&&oe<=X?L&&M.text.attribute&&N.getText().setText(this.getLabel(L,M.text.attribute)):N.setText())}return N}parseStyle(M,L){const oe={},N=this.getOlCls(M);return N&&L instanceof Object?(Object.keys(L).forEach(B=>{const X=this.getOlKey(B);oe[X]=this.parseStyle(B,L[B])}),new N(oe)):L}getOlKey(M){let L;switch(M.toLowerCase()){case"circle":case"regularshape":case"icon":L="image"}return L||M}getOlCls(M){let L=d[M.charAt(0).toUpperCase()+M.slice(1)];return"regularshape"===M&&(L=g.c),"backgroundFill"===M&&(L=R.c),"backgroundStroke"===M&&(L=o.c),L}createStyleByAttribute(M,L,oe){let N;const B=L.type?L.type:this.guessTypeFeature(M),X=L.attribute,V=L.data,z=L.stroke,W=L.width,A=L.fill,q=L.anchor,_=L.radius,u=L.icon,S=L.scale,P=V?V.length:0,I=L.label?L.label.attribute:void 0,U=L.label?.minScaleDenom?(0,w.bg)(Number(L.label.minScaleDenom)):void 0,G=L.label?.maxScaleDenom?(0,w.bg)(Number(L.label.maxScaleDenom)):void 0,Q=U||(L.label?.minResolution?L.label.minResolution:0),r=G||(L.label?.maxResolution?L.label.maxResolution:1/0);let ie=L.label?.style?this.parseStyle("text",L.label.style):void 0;!ie&&I&&(ie=new h.c);const ae=L.baseStyle;if(ie&&ie.setText(oe>=Q&&oe<=r?this.getLabel(M,I):""),"circle"===B){for(let fe=0;fe<P;fe++){const le=typeof M.get(X)<"u"&&null!==M.get(X)?M.get(X):"";if(le===V[fe]||le.toString().match(new RegExp(V[fe],"gmi")))return u?(N=[new e.cp({image:new j.c({color:A?A[fe]:void 0,src:u[fe],scale:S?S[fe]:1,anchor:q?q[fe]:[.5,.5]}),text:ie instanceof h.c?ie:void 0})],N):(N=[new e.cp({image:new x.c({radius:_?_[fe]:4,stroke:new o.c({color:z?z[fe]:"black",width:W?W[fe]:1}),fill:new R.c({color:A?A[fe]:"black"})}),text:ie instanceof h.c?ie:void 0})],N)}if(!M.getStyle())return ae?(N=this.createStyle(ae,M,oe),ie&&N.setText(ie),N):(N=[new e.cp({image:new x.c({radius:4,stroke:new o.c({color:"black"}),fill:new R.c({color:"#bbbbf2"})})})],N)}else if("regular"===B){for(let fe=0;fe<P;fe++){const le=typeof M.get(X)<"u"&&null!==M.get(X)?M.get(X):"";if(le===V[fe]||le.toString().match(new RegExp(V[fe],"gmi")))return N=[new e.cp({stroke:new o.c({color:z?z[fe]:"black",width:W?W[fe]:1}),fill:new R.c({color:A?A[fe]:"rgba(255,255,255,0.4)"}),text:ie instanceof h.c?ie:void 0})],N}if(M instanceof y.c&&!M.getStyle())return ae?(N=this.createStyle(ae,M,oe),ie&&N.setText(ie),N):(N=[new e.cp({stroke:new o.c({color:"black"}),fill:new R.c({color:"#bbbbf2"})})],N)}}createClusterStyle(M,L,oe={},N){let B;const X=M.get("features").length;if(1!==X){if(oe.clusterRanges)for(const V of oe.clusterRanges)if((!V.minRadius||V.minRadius<=X)&&(!V.maxRadius||V.maxRadius>=X)){if(B=this.createStyle(V.style),V.showRange){const z=new h.c({text:X.toString(),fill:new R.c({color:"#fff"})});B.setText(z)}if(V.dynamicRadius){let z;const W=B.getRadius();z=5*Math.log(X),z<W&&(z=W),B.image_.setRadius(z)}break}if(!B){let V;oe.radiusCalc?V=oe.radiusCalc(X):(V=5*Math.log(X),V<6&&(V=6)),B=[new e.cp({image:new x.c({radius:V,stroke:new o.c({color:"black"}),fill:new R.c({color:"rgba(24, 134, 45, 0.5)"})}),text:new h.c({text:X.toString(),fill:new R.c({color:"#fff"})})})]}}else B=this.createStyle(N,M,L);return B}getLabel(M,L){let oe=L;if(!oe)return;const N=Array.from(L.matchAll(/\$\{([^\{\}]+)\}/g));return N.forEach(B=>{oe=oe.replace(B[0],M.get(B[1]))}),0===N.length&&oe===L&&(oe=M.get(L)||L),oe}guessTypeFeature(M){switch(M.getGeometry().getType()){case"Point":case"MultiPoint":case"Circle":return"circle";default:return"regular"}}static \u0275fac=function(L){return new(L||a)};static \u0275prov=E.wxM({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})()},47864:(Ee,ce,s)=>{"use strict";s.d(ce,{KC:()=>d,iL:()=>b});var y=s(64002),e=s(11772);function d(E){return({wms:g,wmts:R,xyz:o,feature:h,wfs:j,arcgisrest:x,imagearcgisrest:x,tilearcgisrest:x,osm:K=>"OSM",tiledebug:K=>"tiledebug"}[E.type]||w)(E)}function g(E){const T=E.params.LAYERS,K="wms"+b(E.url)+T;return e.Cy.hashStr(K)}function R(E){const T=E.layer,K="wmts"+b(E.url)+T;return e.Cy.hashStr(K)}function o(E){const a="xyz"+b(E.url);return e.Cy.hashStr(a)}function h(E){if(!E.url)return w();const a="feature"+b(E.url);return e.Cy.hashStr(a)}function j(E){if(!E.url||!E.params)return w();const a="wfs"+b(E.url)+E.params.featureTypes;return e.Cy.hashStr(a)}function x(E){const T=E.layer,a=b(E.url);return e.Cy.hashStr((E.type||"arcgis")+a+T)}function w(E){return(0,y.uq)()}function b(E){const a=("/"===E.charAt(0)?window.location.origin+E:E).split(/[?&]/);let K=a.shift();const M=a.filter(L=>0!==L.length&&"_"!==L.charAt(0));return M.length&&(K+="?"+M.join("&")),K}},49496:(Ee,ce,s)=>{"use strict";s.d(ce,{iOV:()=>Aa,kvX:()=>Ua,oxI:()=>Cd,aaH:()=>Ro.a,OEM:()=>Ur.O,YdQ:()=>xe,Se2:()=>Yl,gLH:()=>sl,O_6:()=>ca,YNI:()=>Cr,YfI:()=>at.Yf,EBb:()=>Ro.EB,wP$:()=>at.wP,Suj:()=>at.Su,ym_:()=>at.ym,E9g:()=>at.E9,kj0:()=>at.kj,Wwb:()=>rl,cdH:()=>Ut.cd,s9F:()=>I,eqy:()=>Ut.eq,aw9:()=>Bo,ach:()=>md,yGW:()=>Ut.yG,SET:()=>op,G_h:()=>rd,Oy$:()=>Se,OrO:()=>_a,Y1E:()=>Ut.Y1,ApN:()=>Za,wSE:()=>rs,Ult:()=>qa,m2U:()=>ls,g7B:()=>dr,IZ6:()=>so.IZ,q2F:()=>Ut.q2,u00:()=>Ut.u0,K88:()=>po.K8,yaV:()=>po.y,Idw:()=>cs,Ga$:()=>mr,w35:()=>Bt.w,Kwu:()=>Ra,__k:()=>zo,E9h:()=>nr,isy:()=>Hn,Iz2:()=>xp,knT:()=>Ut.kn,eAF:()=>vp,qME:()=>Ut.qM,s5H:()=>Ae.s5,IlJ:()=>Ae.Il,i6P:()=>Ut.i6,aWp:()=>xr.aW,AD2:()=>y.A,qE2:()=>g.q,kBh:()=>R.T,_wi:()=>K._,i6q:()=>b.i,uu$:()=>Hr,c97:()=>Te,kjd:()=>ut,_cQ:()=>qt,K4n:()=>Jr,qM$:()=>xr.qM,czr:()=>xr.cz,SYK:()=>xr.SY,cTh:()=>ts,iOO:()=>cd,UND:()=>cr.U,eM$:()=>Zr,gpx:()=>lr,eAs:()=>qr,gho:()=>fr,DCK:()=>$t.D,U3K:()=>$t.U,wL1:()=>so.wL,ktW:()=>xa,Mdo:()=>so.Md,w16:()=>Ut.w1,MrZ:()=>ys,WQ3:()=>Jp,qcl:()=>Ut.qc,q17:()=>at.q1,KGf:()=>Ut.KG,o5m:()=>ol.o,qKz:()=>at.qK,Cyp:()=>br.Cy,M4J:()=>br.M4,K6O:()=>at.K6,Ki0:()=>at.Ki,Yvl:()=>at.Yv,rEB:()=>Ut.rE,_aW:()=>Dr,IvV:()=>il,wvY:()=>Bp,cDV:()=>po.cD,QX5:()=>at.QX,UfW:()=>Up,yCe:()=>Q,iew:()=>Rt,A7Y:()=>Kt,kzx:()=>yt,QPw:()=>bp,qED:()=>a,oN0:()=>$p,uEw:()=>Ut.uE,ayN:()=>Ie.ay,ETi:()=>Ut.ET,KMH:()=>Ut.KM});var y=s(8636),e=s(34896);let d=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[y.A]})}return l})();var g=s(8408),R=s(69800);let o=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[R.T,g.q]})}return l})();var h=s(1560);let j=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[h.s]})}return l})();var x=s(50620);let w=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[x.Q]})}return l})();var b=s(83456),E=s(78168);function T(l){return new b.i(l)}function a(){return{provide:b.i,useFactory:T,deps:[E.i]}}var K=s(29216),M=s(83600),L=s(24708),oe=s(21720),B=(s(16660),s(21124)),X=s(12396),V=s(28668),z=s(36752),W=s(61252),A=s(54844),q=s(1296),_=s(21296),u=s(90916),S=s(68392),P=s(59324);class I{static getGoogleMapsCoordLink(m,t){return`https://www.google.com/maps/search/?api=1&query=${t}%2C${m}`}static getGoogleStreetViewLink(m,t){return`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${t}%2C${m}`}static getGoogleMapsNameLink(m){return`https://www.google.com/maps/search/?api=1&query=${encodeURI(m)}`}}class U{static getOpenStreetMapLink(m,t,i=17){return`https://www.openstreetmap.org/?mlat=${t}&mlon=${m}#map=${i}/${t}/${m}`}static getOpenStreetCamLink(m,t,i=17){return`https://openstreetcam.org/map/@${t},${m},${i}z`}}let G=(()=>{class l{languageService;constructor(t){this.languageService=t}formatResult(t){return t}static \u0275fac=function(i){return new(i||l)(e.CoB(L.ov))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();class O extends E.i{languageService;static id="coordinatesreverse";static type=S.Y;projections;title$=new A.g("");get title(){return this.title$.getValue()}constructor(m,t,i,n){super(m,i),this.languageService=t,this.projections=n,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return O.id}getType(){return O.type}getDefaultOptions(){return{title:"igo.geo.search.coordinates.name",order:1,showInSettings:!1}}reverseSearch(m,t,i){return(0,q.of)([this.dataToResult(m,t,i)])}dataToResult(m,t,i){const n=(0,P.G2)(m),v=(0,P.Re)(m,this.projections).reduce((Fe,et)=>(Fe[et.alias]=et.igo2CoordFormat,Fe),{}),k=i?(0,P.uE)(m,6).reverse().join(", "):(0,P.uE)(m,6).join(", "),de=i?n.reverse().join(", "):n.join(", ");let he={type:"Point",coordinates:[m[0],m[1]]};const Oe={};let be="";if(t.distance){Oe[this.languageService.translate.instant("igo.geo.search.coordinates.radius")]=t.distance,be="<br><small>Rayon: "+t.distance+" m</small>";const et=W.AF([m[0],m[1]],"EPSG:4326","EPSG:3857"),pt=new V.c(et,t.distance),Tt=(0,z.IH)(pt),Ht=new X.c;he=JSON.parse(Ht.writeGeometry(Tt.transform("EPSG:3857","EPSG:4326")))}return t.conf&&(Oe[this.languageService.translate.instant("igo.geo.search.coordinates.conf")]=t.conf,be+=""===be?"<br>":"<small> - </small>",be+="<small>Confiance: "+t.conf+"%</small>"),Oe[this.languageService.translate.instant(i?"igo.geo.search.coordinates.reversedCoord":"igo.geo.search.coordinates.coord")]=k,Oe[this.languageService.translate.instant(i?"igo.geo.search.coordinates.reversedCoordDMS":"igo.geo.search.coordinates.coordDMS")]=de,{source:this,data:{type:S.Y,projection:"EPSG:4326",geometry:he,extent:void 0,properties:Object.assign(Oe,v,{GoogleMaps:I.getGoogleMapsCoordLink(m[0],m[1]),GoogleStreetView:I.getGoogleStreetViewLink(m[0],m[1]),OpenStreetMap:U.getOpenStreetMapLink(m[0],m[1],14),Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"}),meta:{id:m[0].toString()+","+m[1].toString(),title:k}},meta:{dataType:S.Y,id:m[0].toString()+","+m[1].toString(),title:k,titleHtml:k+be,icon:"map-marker",score:100}}}static \u0275fac=function(t){return new(t||O)(e.CoB("options"),e.CoB(L.ov),e.CoB(oe.yQ),e.CoB("projections"))};static \u0275prov=e.wxM({token:O,factory:O.\u0275fac})}function F(l){return new G(l)}function Q(){return{provide:G,useFactory:F,deps:[L.ov]}}(0,B.UN)([(0,u.w)({maxCacheCount:20}),(0,B.YR)("design:type",Function),(0,B.YR)("design:paramtypes",[Array,Object,Boolean]),(0,B.YR)("design:returntype",_._)],O.prototype,"reverseSearch",null);var ae=s(33712),fe=s(21724),le=s(64002),ue=s(12472),se=s(40604),ge=s(51672),Ie=s(14452);let Re=(()=>{class l{languageService;constructor(t){this.languageService=t}formatResult(t){return t}static \u0275fac=function(i){return new(i||l)(e.CoB(L.ov))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();class He{encodeKey(m){return encodeURIComponent(m)}encodeValue(m){return encodeURIComponent(m)}decodeKey(m){return decodeURIComponent(m)}decodeValue(m){return decodeURIComponent(m)}}class ht extends E.i{http;languageService;formatter;static id="icherche";static type=S.Y;static propertiesBlacklist=[];title$=new A.g("");hashtagsLieuxToKeep=[];get title(){return this.title$.getValue()}constructor(m,t,i,n,p,v){super(n,i),this.http=m,this.languageService=t,this.formatter=p;const k=v.get(fe.oj);this.settings.length&&(k?k.authenticate$.subscribe(()=>{this.getAllowedTypes()}):this.getAllowedTypes()),this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return ht.id}getType(){return ht.type}getDefaultOptions(){const m=this.options.params&&this.options.params.limit?Number(this.options.params.limit):void 0,t=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):void 0,i=this.options.params?.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","codes-postaux","routes","intersections","municipalites","mrc","regadmin","lieux"],n=this.options.showAdvancedSettings;return{title:"igo.geo.search.icherche.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==i.indexOf("adresses"),hashtags:["adresse"]},{title:"igo.geo.search.icherche.type.oldAddress",value:"anciennes-adresses",enabled:-1!==i.indexOf("anciennes-adresses"),hashtags:["anciennes-adresses"]},{title:"igo.geo.search.icherche.type.oldCity",value:"anciennes-municipalites",enabled:-1!==i.indexOf("anciennes-municipalites"),hashtags:["anciennes-municipalites"]},{title:"igo.geo.search.icherche.type.cn",value:"bornes-cn",enabled:-1!==i.indexOf("bornes-cn"),hashtags:["borne","bornes","cn"]},{title:"igo.geo.search.icherche.type.sumi",value:"bornes-sumi",enabled:-1!==i.indexOf("bornes-sumi"),hashtags:["borne","bornes","sumi"]},{title:"igo.geo.search.icherche.type.cadastre",value:"cadastre",enabled:-1!==i.indexOf("cadastre"),hashtags:["cadastre"]},{title:"igo.geo.search.icherche.type.postalCode",value:"codes-postaux",enabled:-1!==i.indexOf("codes-postaux"),hashtags:["code-postal"]},{title:"igo.geo.search.icherche.type.entreprise",value:"entreprises",enabled:-1!==i.indexOf("entreprises"),available:!1,hashtags:["entreprise"]},{title:"igo.geo.search.icherche.type.cycleStop",value:"haltes_cyclables",enabled:-1!==i.indexOf("haltes_cyclables"),hashtags:["haltevelo","haltes_cyclables"]},{title:"igo.geo.search.icherche.type.restArea",value:"haltes_routieres",enabled:-1!==i.indexOf("haltes_routieres"),hashtags:["halteroute","haltes_routieres"]},{title:"igo.geo.search.icherche.type.hq",value:"hq",enabled:-1!==i.indexOf("hq"),hashtags:["hq"]},{title:"igo.geo.search.icherche.type.intersection",value:"intersections",enabled:-1!==i.indexOf("intersections"),hashtags:["intersection","+"]},{title:"igo.geo.search.icherche.type.place",value:"lieux",enabled:-1!==i.indexOf("lieux"),hashtags:["lieu"]},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==i.indexOf("mrc"),hashtags:["mrc"]},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==i.indexOf("municipalites"),hashtags:["municipalit\xe9","mun"]},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==i.indexOf("regadmin"),hashtags:["r\xe9gion-administrative","regadmin"]},{title:"igo.geo.search.icherche.type.gcc",value:"bornes-gcc",enabled:-1!==i.indexOf("bornes-gcc"),hashtags:["borne","bornes","rep\xe8re","gcc","ccg"]},{title:"igo.geo.search.icherche.type.km",value:"bornes-km",enabled:-1!==i.indexOf("bornes-km"),hashtags:["borne","bornes","rep\xe8re","km"]},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==i.indexOf("routes"),hashtags:["route"]},{title:"igo.geo.search.icherche.type.exit",value:"sorties-autoroute",enabled:-1!==i.indexOf("sorties-autoroute"),hashtags:["sortie","sorties","exit"]},{title:"igo.geo.search.icherche.type.cultpatri",value:"culture",enabled:-1!==i.indexOf("culture"),hashtags:["grille","culture"]},{title:"igo.geo.search.icherche.type.unites",value:"unites",enabled:-1!==i.indexOf("unites"),hashtags:["unites","adresse"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===m},{title:"5",value:5,enabled:5===m||!m},{title:"10",value:10,enabled:10===m},{title:"25",value:25,enabled:25===m},{title:"50",value:50,enabled:50===m}]},n&&{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:10===t},{title:"30 %",value:30,enabled:30===t||!t},{title:"50 %",value:50,enabled:50===t},{title:"75 %",value:75,enabled:75===t},{title:"100 %",value:100,enabled:100===t}]},{type:"radiobutton",title:"restrictExtent",name:"loc",values:[{title:"igo.geo.search.icherche.restrictExtent.map",value:"true",enabled:!1},{title:"igo.geo.search.icherche.restrictExtent.quebec",value:"false",enabled:!0}]}].filter(Boolean)}}search(m,t){const i=this.computeRequestParams(m,t||{});return i.get("type").length?(this.options.params.page=i.get("page")||"1",this.getSearch(m,i)):(0,q.of)([])}getSearch(m,t){return this.http.get(`${this.searchUrl}/geocode`,{params:t}).pipe((0,se.k)(i=>this.extractResults(i,m)),(0,ge.a)(i=>{throw i.error.toDisplay=!0,i.error.title=this.languageService.translate.instant(this.getDefaultOptions().title),i}))}getAllowedTypes(){return this.http.get(`${this.searchUrl}/types`).subscribe(m=>{const t=this.settings.find(i=>"type"===i.name);t.values.forEach(i=>{const n=new RegExp(`^${i.value}(\\.|$)`),p=m.filter(v=>n.test(v));i.available=p.length>0,"lieux"===i.value&&(this.hashtagsLieuxToKeep=[...new Set(p.map(v=>v.split(".")).reduce((v,k)=>v.concat(k)).filter(v=>"lieux"!==v))])}),this.setParamFromSetting(t,!1)})}computeRequestParams(m,t){const i=Object.assign({geometry:!0,bbox:!0,icon:!0,type:"adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi"},this.params,this.computeOptionsParam(m,t||{}).params,{q:this.computeTerm(m),page:t.page});if("true"===i.loc){const[n,p,v,k]=t.extent;i.loc=`${n},${p};${v},${p};${v},${k};${n},${k};${n},${p}`}else"false"===i.loc&&delete i.loc;return/#[A-Za-z]+/.test(i.q)&&(i.type="lieux"),new ae.i4({fromObject:le.Yv.removeUndefined(i),encoder:new He})}extractResults(m,t){return m.features.map(i=>this.formatter.formatResult(this.dataToResult(i,t,m)))}dataToResult(m,t,i){const n=this.computeProperties(m),p=[this.getId(),n.type,n.code].join(".");return{source:this,data:{type:S.Y,projection:"EPSG:4326",geometry:m.geometry,extent:m.bbox,properties:n,meta:{id:p,title:m.properties.nom}},meta:{dataType:S.Y,id:p,title:m.properties.nom,titleHtml:(m.highlight.title||m.properties.nom)+(m.highlight.title2?" <small> "+m.highlight.title2+"</small>":"")+(m.highlight.title3?"<br><small> "+m.highlight.title3+"</small>":""),icon:m.icon||"map-marker",score:m.score||(0,Ie.Un)(t.trim(),m.properties.nom),nextPage:i.features.length%+this.options.params.limit==0&&+this.options.params.page<10}}}computeProperties(m){const t=le.Yv.removeKeys(m.properties,ht.propertiesBlacklist);if(!m.geometry)return Object.assign({type:m.index},t);const i={GoogleMaps:""};let n,p;if("Point"===m.geometry.type)n=I.getGoogleMapsCoordLink(m.geometry.coordinates[0],m.geometry.coordinates[1]);else{const k=(0,ue.c)(m.geometry);n=I.getGoogleMapsCoordLink(k.geometry.coordinates[0],k.geometry.coordinates[1])}p=I.getGoogleMapsNameLink("routes"===m.index?m.properties.nom+", "+m.properties.municipalite:"municipalites"===m.index?m.properties.nom+", ville":"mrc"===m.index?"mrc+"+m.properties.nom:"regadmin"===m.index?m.properties.nom+",+QC":m.properties.nom||m.highlight.title),i.GoogleMaps="<a href="+n+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByCoord")+"</a> <br /> <a href="+p+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByName")+"</a>","Point"===m.geometry.type&&(i.GoogleStreetView=I.getGoogleStreetViewLink(m.geometry.coordinates[0],m.geometry.coordinates[1]));const v={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign({type:m.index},t,i,v)}computeTerm(m){let i=!1;return i=(m.match(/(#[A-Za-z]+)/g)||[]).some(n=>{const p=n.substring(1);return this.hashtagsLieuxToKeep.some(v=>v.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")===p.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""))}),i||(m=m.replace(/(#[A-Za-z]+)/g,"")),m.replace(/[^\w\xc0-\xff !\-\+\(\)\.\/\xbd\xbc\xbe,'#]+/g,"")}computeOptionsParam(m,t){const i=super.getHashtagsValid(m,"type");return i&&(t.params=Object.assign(t.params||{},{type:i.join(",")})),t}static \u0275fac=function(t){return new(t||ht)(e.CoB(ae.KK),e.CoB(L.ov),e.CoB(oe.yQ),e.CoB("options"),e.CoB(Re),e.CoB(e.zZn))};static \u0275prov=e.wxM({token:ht,factory:ht.\u0275fac})}(0,B.UN)([(0,u.w)({maxCacheCount:20,cacheHasher:le.EB}),(0,B.YR)("design:type",Function),(0,B.YR)("design:paramtypes",[String,ae.i4]),(0,B.YR)("design:returntype",_._)],ht.prototype,"getSearch",null);class rt extends E.i{http;languageService;static id="icherchereverse";static type=S.Y;static propertiesBlacklist=[];title$=new A.g("");get title(){return this.title$.getValue()}constructor(m,t,i,n,p){super(n,i),this.http=m,this.languageService=t,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))});const v=p.get(fe.oj);this.settings.length&&(v?v.authenticate$.subscribe(()=>{this.getAllowedTypes()}):this.getAllowedTypes())}getId(){return rt.id}getType(){return rt.type}getDefaultOptions(){const m=this.options.params&&this.options.params.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","municipalites","mrc","regadmin"];return{title:"igo.geo.search.ichercheReverse.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==m.indexOf("adresses")},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==m.indexOf("routes"),available:!1},{title:"igo.geo.search.icherche.type.district",value:"arrondissements",enabled:-1!==m.indexOf("arrondissements")},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==m.indexOf("municipalites")},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==m.indexOf("mrc")},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==m.indexOf("regadmin")},{title:"igo.geo.search.icherche.type.unites",value:"unites",enabled:-1!==m.indexOf("unites")}]},{type:"radiobutton",title:"radius",name:"bufferInput",values:[{title:"100 m",value:100,enabled:!this.options.distance||100===this.options.distance},{title:"500 m",value:500,enabled:500===this.options.distance},{title:"1 km",value:1e3,enabled:1e3===this.options.distance},{title:"2 km",value:2e3,enabled:2e3===this.options.distance},{title:"5 km",value:5e3,enabled:5e3===this.options.distance}]}]}}reverseSearch(m,t){const i=this.computeRequestParams(m,t||{});return i.get("type").length?this.getReverseSearch(i):(0,q.of)([])}getReverseSearch(m){return this.http.get(`${this.searchUrl}/locate`,{params:m}).pipe((0,se.k)(t=>this.extractResults(t)))}getAllowedTypes(){return this.http.get(`${this.searchUrl}/types`).subscribe(m=>{const t=this.settings.find(i=>"type"===i.name);t.values.forEach(i=>{i.available=m.indexOf(i.value)>-1}),this.setParamFromSetting(t,!1)})}computeRequestParams(m,t){return(t.distance||this.options.distance)&&(t.params=Object.assign(t.params||{},{bufferInput:t.distance||this.options.distance})),new ae.i4({fromObject:Object.assign({loc:m.join(","),sort:"distance",geometry:!0,icon:!0},t.params||{},this.params)})}extractResults(m){return m.features.map(t=>this.dataToResult(t))}getSubtitle(m){if(!this.settings.length)return"";let t="";if("arrondissements"===m.properties.type)t=m.properties.municipalite+" (Arrondissement)";else{const n=this.settings.find(p=>"type"===p.name).values.find(p=>p.value===m.properties.type);n&&(t=this.languageService.translate.instant(n.title))}return t}dataToResult(m){const t=this.computeProperties(m),i=this.computeExtent(m),n=[this.getId(),t.type,t.code].join("."),p=m.properties.nom,v=" <small> "+this.getSubtitle(m)+"</small>";return{source:this,data:{type:S.Y,projection:"EPSG:4326",geometry:m.geometry,extent:i,properties:t,meta:{id:n,title:m.properties.nom}},meta:{dataType:S.Y,id:n,title:m.properties.nom,titleHtml:p+v,icon:m.icon||"map-marker",pointerSummaryTitle:this.getSubtitle(m)+": "+m.properties.nom}}}computeProperties(m){const t=le.Yv.removeKeys(m.properties,rt.propertiesBlacklist),i={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign(t,i)}computeExtent(m){return m.bbox?[m.bbox[0],m.bbox[2],m.bbox[1],m.bbox[3]]:void 0}static \u0275fac=function(t){return new(t||rt)(e.CoB(ae.KK),e.CoB(L.ov),e.CoB(oe.yQ),e.CoB("options"),e.CoB(e.zZn))};static \u0275prov=e.wxM({token:rt,factory:rt.\u0275fac})}function xt(l){return new Re(l)}function Rt(){return{provide:Re,useFactory:xt,deps:[L.ov]}}function Ze(l,m,t,i,n,p){return new ht(l,m,t,i.getConfig(`searchSources.${ht.id}`),n,p)}function Kt(){return{provide:E.i,useFactory:Ze,multi:!0,deps:[ae.KK,L.ov,oe.yQ,M.aW,Re,e.zZn]}}(0,B.UN)([(0,u.w)({maxCacheCount:20,cacheHasher:le.EB}),(0,B.YR)("design:type",Function),(0,B.YR)("design:paramtypes",[ae.i4]),(0,B.YR)("design:returntype",_._)],rt.prototype,"getReverseSearch",null);var Ne=s(8492),Ae=s(49704);let dt=(()=>{class l{languageService;constructor(t){this.languageService=t}formatResult(t){const i=["title","abstract","groupTitle","metadataUrl","downloadUrl","urlInfo","name"],n=Object.entries(t.properties).filter(([v])=>-1!==i.indexOf(v)).reduce((v,k)=>{const[de,he]=k;let Oe;try{Oe=this.languageService.translate.instant("igo.geo.search.ilayer.properties."+de)}catch{Oe=de}return v[Oe]=he||"",v},{}),p=Object.assign({},t);return p.properties=n,p}static \u0275fac=function(i){return new(i||l)(e.CoB(L.ov))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();class je extends E.i{http;languageService;formatter;static id="ilayer";static type=Ne.i;title$=new A.g("");get title(){return this.title$.getValue()}constructor(m,t,i,n,p){super(n,i),this.http=m,this.languageService=t,this.formatter=p,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return je.id}getType(){return je.type}getDefaultOptions(){const m=this.options.params&&this.options.params.limit?Number(this.options.params.limit):void 0,t=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):void 0;return{title:"igo.geo.search.ilayer.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.ilayer.type.layer",value:"layer",enabled:!0,hashtags:["layer","layers","couche","couches"]},{title:"igo.geo.search.ilayer.type.groupLayer",value:"group",enabled:!1,hashtags:["gr-layer","gr-layers","gr-couche","gr-couches"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===m},{title:"5",value:5,enabled:5===m||!m},{title:"10",value:10,enabled:10===m},{title:"25",value:25,enabled:25===m},{title:"50",value:50,enabled:50===m}]},this.options.showAdvancedSettings&&{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:10===t},{title:"30 %",value:30,enabled:30===t},{title:"50 %",value:50,enabled:50===t||!t},{title:"75 %",value:75,enabled:75===t},{title:"100 %",value:100,enabled:100===t}]}].filter(Boolean)}}search(m,t){const i=this.computeSearchRequestParams(m,t||{});return i.get("q")&&i.get("type")?(this.options.params.page=i.get("page")||"1",this.getSearch(m,i)):(0,q.of)([])}getSearch(m,t){return this.http.get(this.searchUrl,{params:t}).pipe((0,se.k)(i=>this.extractResults(i,m)))}computeSearchRequestParams(m,t){return new ae.i4({fromObject:le.Yv.removeUndefined(Object.assign({q:this.computeTerm(m)},this.params,this.computeOptionsParam(m,t||{}).params,{page:t.page}))})}computeTerm(m){return m.replace(/(#[^\s]*)/g,"").replace(/[^\w\xc0-\xff !\-\(\),'#]+/g,"")}computeOptionsParam(m,t){const i=super.getHashtagsValid(m,"type");return i&&(t.params=Object.assign(t.params||{},{type:i.join(",")})),t}extractResults(m,t){return m.items.map(i=>this.dataToResult(i,t,m))}dataToResult(m,t,i){const n=this.computeLayerOptions(m),p=m.highlight.title||m.properties.title,v=m.highlight.groupTitle||m.properties.groupTitle,k=v?' <small style="color: #6f6969"> '+v+"</small>":"";return{source:this,meta:{dataType:Ne.i,id:[this.getId(),m.properties.id].join("."),title:m.properties.title,titleHtml:p+k,icon:"Layer"===m.properties.type?"layers":"map",score:m.score||(0,Ie.Un)(t.trim(),m.properties.name),nextPage:i.items.length%+this.options.params.limit==0&&+this.options.params.page<10},data:n}}computeLayerOptions(m){const t=m.properties.url,i=this.extractQueryParamsFromSourceUrl(t);return le.Yv.removeUndefined({sourceOptions:{id:m.properties.id,type:m.properties.format,url:t,queryFormat:i.queryFormat,queryHtmlTarget:i.queryHtmlTarget,params:"wms"===m.properties.format?{LAYERS:m.properties.name}:void 0,layer:"wms"===m.properties.format?void 0:m.properties.name,optionsFromCapabilities:!0,crossOrigin:"anonymous"},title:m.properties.title,maxResolution:(0,P.bg)(Number(m.properties.maxScaleDenom)),minResolution:(0,P.bg)(Number(m.properties.minScaleDenom)),metadata:{url:m.properties.metadataUrl,extern:!!m.properties.metadataUrl||void 0,abstract:m.properties.abstract||void 0},properties:this.formatter.formatResult(m).properties})}extractQueryParamsFromSourceUrl(m){let t,i;const n=this.options.queryFormat;if(n){for(const p of Object.keys(n)){const v=n[p];if("*"===v){t=Ae.s5[p.toUpperCase()];break}const k=v.urls;if(Array.isArray(k)){k.forEach(de=>{-1!==m.indexOf(de)&&(t=Ae.s5[p.toUpperCase()])});break}}(t===Ae.s5.HTML||t===Ae.s5.HTMLGML2)&&(i="iframe")}return{queryFormat:t,queryHtmlTarget:i}}static \u0275fac=function(t){return new(t||je)(e.CoB(ae.KK),e.CoB(L.ov),e.CoB(oe.yQ),e.CoB("options"),e.CoB(dt))};static \u0275prov=e.wxM({token:je,factory:je.\u0275fac})}function Ke(l){return new dt(l)}function yt(){return{provide:dt,useFactory:Ke,deps:[L.ov]}}(0,B.UN)([(0,u.w)({maxCacheCount:20,cacheHasher:le.EB}),(0,B.YR)("design:type",Function),(0,B.YR)("design:paramtypes",[String,ae.i4]),(0,B.YR)("design:returntype",_._)],je.prototype,"getSearch",null);let Se=(()=>{class l{static forRoot(){return{ngModule:l,providers:[K._,a(),Rt(),Q(),yt()]}}static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[d,j,o,w,d,j,o,w]})}return l})();var Be=s(69488),ze=s(8984),St=s(72184),Dt=s(62747),mo=s(74180);let Bo=(()=>{class l{static forRoot(){return{ngModule:l}}static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({providers:[(0,mo.c9)()],imports:[Se.forRoot(),Dt.U,ze.k,Be.k,St.c]})}return l})();var Xe=s(65056),ct=s(34672),tt=s(32328),st=s(27e3),it=s(72584),Qt=(s(55792),s(93020)),ao=s(54760);let mt=(()=>{class l{transform(t,i){let n;return"time"===i&&(n=t.filter(p=>{const v=p.dataSource;return this.isTimeFilterable(v)&&void 0!==v.options.timeFilter&&Object.keys(v.options.timeFilter).length})),"ogc"===i&&(n=t.filter(p=>this.isOgcFilterable(p.dataSource))),n}isTimeFilterable(t){return"wms"===t.options.type&&t.options.timeFilterable}isOgcFilterable(t){let i=!1;return t.options.ogcFilters&&t.options.ogcFilters.enabled&&t.options.ogcFilters.editable&&(i=!0),t.options.ogcFilters&&t.options.ogcFilters.enabled&&(t.options.ogcFilters.pushButtons||t.options.ogcFilters.checkboxes||t.options.ogcFilters.radioButtons||t.options.ogcFilters.select||t.options.ogcFilters.autocomplete)&&(i=!0),i}static \u0275fac=function(i){return new(i||l)};static \u0275pipe=e.UTH({name:"filterableDataSource",type:l,pure:!0,standalone:!0})}return l})();var $t=s(14191),Lo=s(92424),Uo=s(21808);let Si=(()=>{class l{constructor(){}filterByDate(t,i){let n,p,v,k;if(Array.isArray(i)){const he=[];i[0]&&(v=this.reformatDateTime(i[0]),he.push(i[0])),i[1]&&(k=this.reformatDateTime(i[1]),he.push(i[1])),2===he.length&&v!==k&&(n=t instanceof Lo.W?v+","+k:v+"/"+k),v===k&&(n=v)}else i&&(p=this.reformatDateTime(i),n=p);t.ol.updateParams({TIME:n}),t instanceof Uo.C&&t.setTimeFilter(t.timeFilter,!0)}filterByYear(t,i){let n,p,v;if(Array.isArray(i)){const de=[];i[0]&&(p=i[0],de.push(i[0])),i[1]&&(v=i[1],de.push(i[1])),2===de.length&&p!==v&&(n=t instanceof Lo.W?p+","+v:p+"/"+v),p===v&&(n=p)}else n=i;t.ol.updateParams({TIME:n}),t instanceof Uo.C&&t.setTimeFilter(t.timeFilter,!0)}reformatDateTime(t){const i=t.getFullYear();let n=t.getMonth()+1,p=t.getUTCDate(),v=t.getUTCHours(),k=t.getUTCMinutes();return Number(n)<10&&(n="0"+n),Number(p)<10&&(p="0"+p),Number(v)<10&&(v="0"+v),Number(k)<10&&(k="0"+k),i+"-"+n+"-"+p+"T"+v+":"+k+":00Z"}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();var Bt=s(5196),eo=s(40912);let uo=(()=>{class l{constructor(){}filterByOgc(t,i){const n=(new eo.S).formatProcessedOgcFilter(i,t.options.params.LAYERS);t.ol.updateParams({FILTER:n})}setOgcWFSFiltersOptions(t){const i=t.options,n=new eo.S;i.ogcFilters.enabled&&i.ogcFilters.filters&&(i.ogcFilters.filters=n.checkIgoFiltersProperties(i.ogcFilters.filters,i.paramsWFS.fieldNameGeometry,new ao.c({code:i.paramsWFS.srsName}),!0),i.ogcFilters.interfaceOgcFilters||(i.ogcFilters.interfaceOgcFilters=n.defineInterfaceFilterSequence(i.ogcFilters.filters,i.paramsWFS.fieldNameGeometry)))}setOgcWMSFiltersOptions(t){const i=t.options,n=new eo.S;i.ogcFilters.enabled&&i.ogcFilters.filters?(i.ogcFilters.filters=n.checkIgoFiltersProperties(i.ogcFilters.filters,i.fieldNameGeometry,void 0,!0),i.ogcFilters.interfaceOgcFilters||(i.ogcFilters.interfaceOgcFilters=n.defineInterfaceFilterSequence(i.ogcFilters.filters,i.fieldNameGeometry)),this.filterByOgc(t,n.buildFilter(i.ogcFilters.filters,void 0,void 0,void 0,t.options)),i.filtered=!0):(i.ogcFilters.filters=void 0,i.ogcFilters.interfaceOgcFilters=[],i.filtered=!1)}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();var qt=function(l){return l.Predefined="Predefined",l.Polygon="Polygon",l.Point="Point",l}(qt||{}),Te=function(l){return l.Address="Address",l.Thematics="Thematics",l}(Te||{});let ut=(()=>{class l{http;languageService;configService;baseUrl="https://geoegl.msp.gouv.qc.ca/apis/terrapi/";urlFilterList={AdmRegion:"regadmin",Arrond:"arrondissements",CircFed:"circ-fed",CircProv:"circ-prov",DirReg:"dir-reg",MRC:"mrc",Mun:"municipalites",RegTour:"tourisme",bornes:"bornes-sumi",hydro:"hydro",routes:"routes"};constructor(t,i,n){this.http=t,this.languageService=i,this.configService=n,this.baseUrl=this.configService.getConfig("spatialFilter.url")||this.baseUrl}getKeyByValue(t,i){return Object.keys(t).find(n=>t[n]===i)}loadFilterList(t){if(t)return this.http.get(this.baseUrl+this.urlFilterList[t]).pipe((0,se.k)(n=>n.features.map(p=>(p.meta={id:p.properties.code},p))))}loadThematicsList(){const i=[];return this.http.get(this.baseUrl+"types").pipe((0,se.k)(n=>(n.forEach(p=>{if(p.startsWith("lieux")){const v={name:void 0,source:p};let k=p.substring(6,p.length),de=k;if(k.includes(".")){const he=k.indexOf(".");de=k.substring(he+1,k.length),k=k.substring(0,he)}try{v.name=this.languageService.translate.instant("igo.geo.terrapi."+de)}catch{v.name=de.substring(0,1).toUpperCase()+de.substring(1,de.length-1)}try{v.group=this.languageService.translate.instant("igo.geo.spatialFilter.group."+k)}catch{v.group=k.substring(0,1).toUpperCase()+k.substring(1,de.length-1)}i.push(v)}else if(this.getKeyByValue(this.urlFilterList,p)){const v={name:void 0,source:p},k=this.getKeyByValue(this.urlFilterList,p);try{v.name=this.languageService.translate.instant("igo.geo.terrapi."+k)}catch{v.name=k.substring(0,1).toUpperCase()+k.substring(1,k.length-1)}v.source=p,i.push(v)}}),i)))}loadFilterItem(t,i,n,p,v){if(n){const de=this.baseUrl+this.urlFilterList[n];let he="";return i===Te.Address?(he="adresses",this.http.get(de+"/"+t.properties.code+"/"+he,{params:{geometry:"true",icon:"true",bufferInput:v.toString(),simplified:"100"}}).pipe((0,se.k)(Oe=>Oe.features.map(be=>(be.meta={id:be.properties.code,title:this.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:be.icon},be))))):(he=p.source,this.http.get(de+"/"+t.properties.code+"/"+he,{params:{geometry:"true",icon:"true",bufferInput:v.toString(),simplified:"100"}}).pipe((0,se.k)(Oe=>Oe.features.map(be=>(be.meta={id:be.properties.code,title:p.name,icon:be.icon},be)))))}{const k=this.baseUrl+"locate";return i===Te.Address?this.http.post(k+"?type=adresses",{geometry:"true",icon:"true",loc:JSON.stringify(t),bufferInput:v.toString(),simplified:"100"}).pipe((0,se.k)(he=>he.features.map(Oe=>(Oe.meta={id:Oe.properties.code,title:this.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:Oe.icon},Oe)))):this.http.post(k+"?type="+p.source,{geometry:"true",icon:"true",loc:JSON.stringify(t),bufferInput:v.toString(),simplified:"100"}).pipe((0,se.k)(he=>he.features.map(Oe=>(Oe.meta={id:Oe.properties.code,title:p.name,icon:Oe.icon},Oe))))}}loadItemById(t,i){const n=this.urlFilterList[i],p="/"+t.properties.code;if(n&&p)return this.http.get(this.baseUrl+n+p,{params:{geometry:"true"}}).pipe((0,se.k)(v=>(v.meta={id:v.properties.code,alias:v.properties.nom,title:v.properties.nom},v)))}loadBufferGeometry(t,i,n,p){if(i!==qt.Predefined)return this.http.post(this.baseUrl+"geospatial/buffer?",{buffer:n,loc:JSON.stringify(t)}).pipe((0,se.k)(v=>v));{const v=this.urlFilterList[p],k="/"+t.properties.code;if(v&&k)return this.http.get(this.baseUrl+v+k,{params:{geometry:"100",bufferOutput:n.toString()}}).pipe((0,se.k)(de=>(de.meta={id:de.properties.code,alias:de.properties.nom,title:de.properties.nom},de)))}}static \u0275fac=function(i){return new(i||l)(e.CoB(ae.KK),e.CoB(L.ov),e.CoB(M.aW))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),pe=(()=>{class l{messageService;constructor(t){this.messageService=t}open(t){this.messageService.success("igo.geo.download.start","igo.geo.download.title");const i=t.dataSource.options;if(Object.keys(i.download).length>0)if(i.download.dynamicUrl&&void 0===i.download.url){let n,p=new ao.c({code:t.map.projection});const v=t.dataSource.options.paramsWFS;v&&Object.keys(v).length>0?(p=v.srsName?new ao.c({code:v.srsName}):p,n=t.dataSource.options.paramsWFS):n=t.dataSource.options.params;const k=W.W0(t.map.viewController.getExtent(),new ao.c({code:t.map.projection}),p),de=void 0===n.outputFormatDownload?void 0===n.outputFormat?"":"outputformat="+n.outputFormat:"outputformat="+n.outputFormatDownload,he=i.download.dynamicUrl.replace(/&?outputformat=[^&]*/gi,"").replace(/&?filter=[^&]*/gi,"").replace(/&?bbox=[^&]*/gi,""),Oe=t.dataSource.options.ogcFilters;let be;be=(new eo.S).handleOgcFiltersAppliedValue(t.dataSource.options,Oe.geometryName,k,p),be=be?"filter="+encodeURIComponent(be):(new eo.S).buildFilter(void 0,k,p,Oe.geometryName),window.open(`${he}&${be}&${de}`,"_blank")}else i.download&&window.open(i.download.url,"_blank")}static \u0275fac=function(i){return new(i||l)(e.CoB(Qt.mi))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function ye(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",1),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.openDownload(n.layer))}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",2),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.download.action"))("color",t.color)}}let xe=(()=>{class l{downloadService;get layer(){return this._layer}set layer(t){this._layer=t}_layer;get color(){return this._color}set color(t){this._color=t}_color="primary";constructor(t){this.downloadService=t}openDownload(t){this.downloadService.open(t)}get options(){if(this.layer)return this.layer.dataSource.options}static \u0275fac=function(i){return new(i||l)(e.GI1(pe))};static \u0275cmp=e.In1({type:l,selectors:[["igo-download-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[e.UHJ],decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","download"]],template:function(i,n){1&i&&e.yuY(0,ye,3,4,"button",0),2&i&&e.E7m("ngIf",n.options&&n.options.download&&(n.options.download.dynamicUrl||n.options.download.url))},dependencies:[Xe.u_,ct.oJ,ct.um,st.KO,st.a4,tt.oB,tt.qL,it.O0,it.sD],changeDetection:0})}return l})();var qe=s(50032),Ue=s(62228),Ut=s(34080),Me=s(71904),Lt=s(58539),Zt=s(75180),_t=s(63916),Gt=s(46176),ft=s(50244),At=s(77872),Go=s(21780);const Gn=["renderedLegend"];function $n(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-list-item")(1,"mat-icon",7),e.qCj("toggle",function(n){e.usT(t);const p=e.GaO(2).$implicit,v=e.GaO(3);return e.CGJ(v.toggleLegendItem(n,p))}),e.C$Y(),e.I0R(2,"span",8),e.OEk(3),e.wVc(4,"async"),e.C$Y()()}if(2&l){e.GaO();const t=e.Gew(3),i=e.GaO().$implicit,n=e.GaO(3);e.yG2(),e.E7m("target",t)("collapsed",i.collapsed),e.yG2(2),e.oRS("",e.kDX(4,3,n.computeItemTitle(i))," ")}}function To(l,m){if(1&l&&(e.I0R(0,"mat-option",11),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.name),e.yG2(),e.cNF(t.title)}}function on(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div")(1,"mat-form-field")(2,"mat-select",9),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(5);return e.kNx(p.currentStyle,n)||(p.currentStyle=n),e.CGJ(n)}),e.qCj("selectionChange",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.onChangeStyle())}),e.wVc(3,"translate"),e.yuY(4,To,2,2,"mat-option",10),e.C$Y()()()}if(2&l){const t=e.GaO(5);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("ngModel",t.currentStyle),e.yG2(2),e.E7m("ngForOf",t.styles)}}function ai(l,m){if(1&l){const t=e.KQA();e.I0R(0,"img",14,15),e.qCj("load",function(){e.usT(t);const n=e.GaO(4).$implicit,p=e.GaO(3);return e.CGJ(p.onLoadImage(n.title))}),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO(4).$implicit;e._6D("id",t.title),e._6D("alt",e.kDX(2,4,"igo.geo.layer.legend.loadingLegendText")),e.E7m("hideError",!0)("src",t.imgGraphValue,e.K6U)}}function Li(l,m){1&l&&(e.I0R(0,"small"),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLegendScale")," "))}function bi(l,m){if(1&l&&(e.I0R(0,"div"),e.yuY(1,ai,3,6,"img",13)(2,Li,3,3,"small",0),e.C$Y()),2&l){const t=e.GaO(3).$implicit,i=e.GaO(3);e.yG2(),e.E7m("ngIf",t.imgGraphValue),e.yG2(),e.E7m("ngIf",i.imagesHeight[t.title]<16)}}function Qo(l,m){if(1&l&&(e.wR5(0,"div",16),e.wVc(1,"sanitizeHtml")),2&l){const t=e.GaO(3).$implicit;e.E7m("ngStyle",t.style)("innerHTML",e.kDX(1,2,t.html),e.E3n)}}function li(l,m){if(1&l&&(e.I0R(0,"div"),e.yuY(1,bi,3,2,"div",0)(2,Qo,2,4,"div",12),e.C$Y()),2&l){const t=e.GaO(2).$implicit;e.yG2(),e.E7m("ngIf",t.url),e.yG2(),e.E7m("ngIf",t.html)}}const Gi=l=>({"with-title":l});function $i(l,m){if(1&l&&(e.I0R(0,"div"),e.yuY(1,$n,5,5,"mat-list-item",0),e.I0R(2,"div",5,6),e.yuY(4,on,5,5,"div",0)(5,li,3,2,"div",0),e.C$Y()()),2&l){const t=e.GaO().$implicit,i=e.GaO(3);e.yG2(),e.E7m("ngIf",t.title),e.yG2(),e.E7m("ngClass",e.S45(4,Gi,t.title)),e.yG2(2),e.E7m("ngIf",void 0!==i.currentStyle),e.yG2(),e.E7m("ngIf",!t.collapsed)}}function Zo(l,m){if(1&l&&(e.SAx(0,null,4),e.yuY(2,$i,6,6,"div",1),e.k70()),2&l){e.GaO(2);const t=e.Gew(3),i=e.GaO();e.yG2(2),e.E7m("ngIf",i.getLegend)("ngIfElse",t)}}function ci(l,m){if(1&l&&(e.SAx(0),e.yuY(1,Zo,3,2,"ng-container",3),e.k70()),2&l){const t=e.GaO().ngIf;e.yG2(),e.E7m("ngForOf",t.slice().reverse())}}function Yo(l,m){1&l&&(e.I0R(0,"small"),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLegendText")," "))}function Vo(l,m){if(1&l&&(e.SAx(0),e.yuY(1,ci,2,1,"ng-container",1)(2,Yo,3,3,"ng-template",null,2,e.gJz),e.k70()),2&l){const t=m.ngIf,i=e.Gew(3);e.yG2(),e.E7m("ngIf",t.length)("ngIfElse",i)}}let Eo=(()=>{class l{capabilitiesService;languageService;configService;http;cdRef;updateLegendOnResolutionChange=!1;legendItems$=new A.g([]);state$$;styles;currentStyle;scale=void 0;view=void 0;renderedLegends;imagesHeight={};layer;getLegend=!0;constructor(t,i,n,p,v){this.capabilitiesService=t,this.languageService=i,this.configService=n,this.http=p,this.cdRef=v}ngOnInit(){let t=this.layer.legend;this.styles=this.listStyles();const i=this.layer.options.source.options;if(i&&i.params&&i.params.STYLES?this.currentStyle=this.styles.find(n=>n.name===i.params.STYLES).name:t?this.styles&&this.styles.length>1&&(this.currentStyle=t[0].currentStyle):this.styles&&this.styles.length>1&&(this.currentStyle=this.styles[0].name),t=typeof this.layer.options.legendOptions<"u"&&!1===this.layer.options.legendOptions.display?[]:this.layer.dataSource.getLegend(this.currentStyle,this.view),this.updateLegendOnResolutionChange||i.contentDependentLegend)this.state$$=this.layer.map.viewController.state$.subscribe(()=>this.onViewControllerStateChange());else if(t&&0!==t.length){this.legendItems$.next(t);for(const n of t)this.getLegendGraphic(n)}}ngOnDestroy(){void 0!==this.state$$&&this.state$$.unsubscribe()}getLegendGraphic(t){t.url&&new Ue.kd(this.http,this.configService).transform(t.url).pipe((0,ge.a)(n=>{if(n.error)return n.error.caught=!0,this.getLegend=!1,this.cdRef.detectChanges(),n})).subscribe(n=>{const p=this.legendItems$.value.findIndex(k=>k.title===t.title);this.legendItems$.value[p].imgGraphValue=n,this.cdRef.detectChanges()})}toggleLegendItem(t,i){i.collapsed=t}transfertToggleLegendItem(t){const i=t,n=this.layer.legend;for(let p=0;p<n.length;p++)i[p].collapsed=n[p].collapsed;return i}computeItemTitle(t){const i=this.layer.dataSource.options;if("wms"!==i.type)return(0,q.of)(t.title);const n=i.params.LAYERS.split(","),p=JSON.parse(JSON.stringify(i));return p.params.LAYERS=n.find(v=>v===t.title),this.capabilitiesService.getWMSOptions(p).pipe((0,se.k)(v=>v._layerOptionsFromSource.title))}onViewControllerStateChange(){this.view={resolution:this.layer.map.viewController.getResolution(),extent:this.layer.map.viewController.getExtent(),projection:this.layer.map.viewController.getOlProjection().getCode(),scale:this.layer.map.viewController.getScale(),size:this.layer.map.ol.getSize()},this.updateLegend()}updateLegend(){let t=this.layer.dataSource.getLegend(this.currentStyle,this.view);if(this.layer.legend&&this.layer.legend.length>1&&(t=this.transfertToggleLegendItem(t)),this.layer.legend=t,0!==t.length||0!==this.legendItems$.value.length){this.legendItems$.next(t);for(const i of this.legendItems$.value)this.getLegendGraphic(i)}}listStyles(){const t=this.layer.options;if(t&&t.legendOptions){let p=[{name:"",title:this.languageService.translate.instant("igo.geo.layer.legend.default")}];return t.legendOptions.stylesAvailable&&(p=p.concat(t.legendOptions.stylesAvailable.filter(v=>"default"!==v.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")&&"defaut"!==v.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")))),p.filter(v=>!v.title).map(v=>v.title=v.name),p.map(v=>v.title=v.title.charAt(0).toUpperCase()+v.title.slice(1).replace(/_/g," ")),p}}onChangeStyle(){this.updateLegend();let t="";this.layer.dataSource instanceof Uo.C&&(this.layer.dataSource.ol.getParams().LAYERS.split(",").map(i=>t+=this.currentStyle+","),t=t.slice(0,-1),this.layer.dataSource.ol.updateParams({STYLES:t}))}onLoadImage(t){let i;i=1===this.renderedLegends.length?this.renderedLegends.first.nativeElement:this.renderedLegends.find(n=>n.nativeElement.id===t).nativeElement,this.imagesHeight[t]=i.height}static \u0275fac=function(i){return new(i||l)(e.GI1(Go.S),e.GI1(L.ov),e.GI1(M.aW),e.GI1(ae.KK),e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-legend"]],viewQuery:function(i,n){if(1&i&&e.CC$(Gn,5),2&i){let p;e.wto(p=e.Gqi())&&(n.renderedLegends=p)}},inputs:{updateLegendOnResolutionChange:"updateLegendOnResolutionChange",layer:"layer"},standalone:!0,features:[e.UHJ],decls:2,vars:3,consts:[[4,"ngIf"],[4,"ngIf","ngIfElse"],["noItems",""],[4,"ngFor","ngForOf"],["renderedLegends",""],[1,"igo-layer-legend",3,"ngClass"],["legend",""],["id","legend-toggle","matListItemIcon","","igoCollapse","","svgIcon","chevron-up",1,"igo-chevron",3,"target","collapsed","toggle"],["matListItemTitle",""],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"ngStyle","innerHTML",4,"ngIf"],["igoImageError","",3,"hideError","id","src","alt","load",4,"ngIf"],["igoImageError","",3,"hideError","id","src","alt","load"],["renderedLegend",""],[3,"ngStyle","innerHTML"]],template:function(i,n){1&i&&(e.yuY(0,Vo,4,2,"ng-container",0),e.wVc(1,"async")),2&i&&e.E7m("ngIf",e.kDX(1,1,n.legendItems$))},dependencies:[Xe.u_,Xe.Iw,_t.iI,_t.g9,_t.Y1,_t.UV,tt.oB,tt.qL,Ue.mK,Xe.QF,ft.wb,ft.Up,At.d5,At.kX,Gt.I5,st.KO,st.a4,Me.y,Me.ue,Me._G,Gt.Ax,Ue.MJ,Xe.Qt,Xe.a,it.O0,it.sD,Ue.Ux],styles:['[_nghost-%COMP%]   .igo-layer-legend.with-title[_ngcontent-%COMP%]{padding-left:18px}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%}[_nghost-%COMP%]   img[_ngcontent-%COMP%]:after{content:" ";position:relative;height:17px;float:left;width:17px;top:-3px;right:19px;background-color:#fff;border:3px solid #f3f3f3;border-radius:50%;animation:2s linear infinite _ngcontent-%COMP%_spin}@-moz-document url-prefix(){-shadowcsshost-no-combinator img:after{margin-left:19px}}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}'],changeDetection:0})}return l})();var _o=s(69400),Yt=s(42536),Io=s(10416);let ui=(()=>{class l{constructor(){}wktToFeature(t,i,n){return(new Io.c).readFeature(t,{dataProjection:i,featureProjection:n})}extentToWkt(t,i,n){let p=W.W0(i,n,t);return p=this.roundCoordinateArray(p,t,0),{wktPoly:`POLYGON((\n      ${i[0]} ${i[1]},\n      ${i[0]} ${i[3]},\n      ${i[2]} ${i[3]},\n      ${i[2]} ${i[1]},\n      ${i[0]} ${i[1]}))`,wktLine:`LINESTRING(\n      ${i[0]} ${i[1]},\n      ${i[0]} ${i[3]},\n      ${i[2]} ${i[3]},\n      ${i[2]} ${i[1]},\n      ${i[0]} ${i[1]})`,wktMultiPoints:`MULTIPOINT(\n        ${i[0]} ${i[1]},\n        ${i[0]} ${i[3]},\n        ${i[2]} ${i[3]},\n        ${i[2]} ${i[1]})`}}roundCoordinateArray(t,i,n=0){const v=W._M(i).getUnits();return-1!==["ft","m","us-ft"].indexOf(v)&&(t=this.roundArray(t,n)),t}roundArray(t,i=0){let n=0;for(;n<t.length;)t[n]=t[n].toFixed(i),n++;return t}snrcToWkt(t,i){let n;t=t.toLowerCase();const p={1:{from:-56,to:-64},2:{from:-64,to:-72},3:{from:-72,to:-80},4:{from:-80,to:-88},5:{from:-88,to:-96},6:{from:-96,to:-104},7:{from:-104,to:-112},8:{from:-112,to:-120},9:{from:-120,to:-128},10:{from:-128,to:-136}},v={1:{from:44,to:48},2:{from:48,to:52},3:{from:52,to:56},4:{from:56,to:60},5:{from:60,to:64},6:{from:64,to:68},7:{from:68,to:72},8:{from:72,to:76},9:{from:76,to:-128}},k=[["m","n","o","p"],["l","k","j","i"],["e","f","g","h"],["d","c","b","a"]],de=[["13","14","15","16"],["12","11","10","09"],["05","06","07","08"],["04","03","02","01"]];let Pe=!1,Je=!1,Fe=!1;if(/\d{2,3}[a-p][0,1][0-9]/gi.test(t)?Fe=!0:/\d{2,3}[a-p]/gi.test(t)?Je=!0:/\d{2,3}/gi.test(t)&&(Pe=!0),Pe?t+="a01":Je&&(t+="01"),/\d{2,3}[a-p][0,1][0-9]/gi.test(t)){const pt=t.split(/(?=[a-p])/gi),Tt=pt[0],Ht=pt[1][0],Oo=pt[1].split(Ht)[1];let Xo=1;3===Tt.length&&(Xo=2);const Zn=Tt.substring(0,Xo),ll=Tt.substring(Xo),cl=8,Jo=4,vi=2,qn=1,ul=.5,dl=.25;let Cs=0,vs=0,pl=0,ml=0;k.forEach(Ln=>{-1!==Ln.indexOf(Ht)&&(vs=k.indexOf(Ln),Cs=Ln.indexOf(Ht))}),de.forEach(Ln=>{-1!==Ln.indexOf(Oo)&&(ml=de.indexOf(Ln),pl=Ln.indexOf(Oo))});let Ss=0,bs=0,ws=0,Os=0,Rr=cl,Lr=Jo;Je?(Ss=Cs*vi,bs=vs*qn,ws=0,Os=0,Rr=vi,Lr=qn):Fe&&(Ss=Cs*vi,bs=vs*qn,ws=pl*ul,Os=ml*dl,Rr=ul,Lr=dl);const Mt={ul:[p[Zn].to+Ss+ws,v[ll].to-bs-Os]};return Mt.lr=[Mt.ul[0]+Rr,Mt.ul[1]-Lr],Mt.ur=[Mt.ul[0],Mt.ul[1]-Lr],Mt.ll=[Mt.ul[0]+Rr,Mt.ul[1]],Mt.ul=W.AF([Mt.ul[0],Mt.ul[1]],"EPSG:4326",i),Mt.lr=W.AF([Mt.lr[0],Mt.lr[1]],"EPSG:4326",i),Mt.ur=W.AF([Mt.ur[0],Mt.ur[1]],"EPSG:4326",i),Mt.ll=W.AF([Mt.ll[0],Mt.ll[1]],"EPSG:4326",i),Mt.ul=this.roundCoordinateArray(Mt.ul,i,0),Mt.lr=this.roundCoordinateArray(Mt.lr,i,0),Mt.ur=this.roundCoordinateArray(Mt.ur,i,0),Mt.ll=this.roundCoordinateArray(Mt.ll,i,0),n="POLYGON(("+[Mt.ul.join(" "),Mt.ur.join(" "),Mt.lr.join(" "),Mt.ll.join(" "),Mt.ul.join(" ")].join(",")+"))",{wktPoly:n,wktLine:"LINESTRING("+[Mt.ul.join(" "),Mt.ur.join(" "),Mt.lr.join(" "),Mt.ll.join(" "),Mt.ul.join(" ")].join(",")+")",wktMultiPoints:"MULTIPOINT("+[Mt.ul.join(" "),Mt.ur.join(" "),Mt.lr.join(" "),Mt.ll.join(" ")].join(",")+")"}}}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var qo=s(61792),di=s(24392),Co=s(43424),Ai=s(30816),ot=s.n(Ai);let go=(()=>{class l{defaultStepMillisecond=6e4;constructor(){}step(t,i){return t.options.stepDate?t.options.stepDate:i.step}stepMillisecond(t,i){const n=ot().duration(this.step(t,i)).asMilliseconds();return 0===n?this.defaultStepMillisecond:n}stepIsYearDuration(t){const i=ot().duration(t);return 0!==i.years()&&0===i.months()&&0===i.weeks()&&0===i.days()&&0===i.hours()&&0===i.minutes()}stepIsMonthDuration(t){const i=ot().duration(t);return 0!==i.months()&&0===i.weeks()&&0===i.days()&&0===i.hours()&&0===i.minutes()}stepIsWeekDuration(t){const i=ot().duration(t);return 0!==i.weeks()&&7===i.days()&&0===i.hours()&&0===i.minutes()}stepIsDayDuration(t){const i=ot().duration(t);return 0!==i.days()&&0===i.hours()&&0===i.minutes()}stepIsHourDuration(t){const i=ot().duration(t);return 0!==i.hours()&&0===i.minutes()}stepIsMinuteDuration(t){return 0!==ot().duration(t).minutes()}dateToNumber(t){let i=new Date;return t&&(i=new Date(t)),i.getTime()}addStep(t,i){return ot()(t).add(i,"milliseconds").toDate()}subtractStep(t,i){return ot()(t).subtract(i,"milliseconds").toDate()}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();var to=s(79764);let jo=(()=>{class l{ogcFilterTimeService;currentFilter;begin;max;datasource;changeProperty=new e._w7;slider;interval;sliderValue=1;calculatedStep=0;_defaultDisplayFormat="DD/MM/YYYY HH:mm A";_defaultSliderInterval=2e3;playIcon="play-circle";resetIcon="replay";get sliderInterval(){return void 0===this.currentFilter.sliderInterval?this._defaultSliderInterval:this.currentFilter.sliderInterval}get displayFormat(){return this.currentFilter.sliderOptions?.displayFormat?this.currentFilter.sliderOptions.displayFormat:this.currentFilter.displayFormat?this.currentFilter.displayFormat:this._defaultDisplayFormat}get beginMillisecond(){return this.ogcFilterTimeService.dateToNumber(this.begin)}get maxMillisecond(){return this.ogcFilterTimeService.dateToNumber(this.max)}get stepMillisecond(){return this.ogcFilterTimeService.stepMillisecond(this.datasource,this.currentFilter)}constructor(t){this.ogcFilterTimeService=t,this.sliderDisplayWith=this.sliderDisplayWith.bind(this)}ngOnInit(){this.calculateStep(),this.handleSliderInput({value:1})}sliderDisplayWith(t){let i=new Date(this.beginMillisecond+(t-1)*this.stepMillisecond);if(this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const n=ot().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).years();i=ot()(this.beginMillisecond).add((t-1)*n,"year").toDate()}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const n=ot().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).months();i=ot()(this.beginMillisecond).add((t-1)*n,"month").toDate()}return ot()(i).format(this.displayFormat)}playFilter(t){this.interval?this.stopFilter():(this.playIcon="pause-circle",this.interval=setInterval(i=>{if(this.slider.step<this.calculatedStep){const p="_emitInputEvent";this.slider._increment(1),this.slider[p]()}else this.stopFilter()},this.sliderInterval,this))}stopFilter(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play-circle"}resetFilter(t){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play-circle",this.slider.step=1,this.slider._emitInputEvent()}handleSliderInput(t){if(t)if(this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const i=ot().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).years(),n=ot()(this.beginMillisecond).add((t.value-1)*i,"year").toDate(),p=ot()(n).add(i,"year").toDate();this.changeProperty.next({value:ot()(n).toDate().toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:ot()(p).toDate().toISOString(),pos:2,refreshFilter:!0})}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const i=ot().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).months(),n=ot()(this.beginMillisecond).add((t.value-1)*i,"month").toDate(),p=ot()(n).add(i,"month").toDate();this.changeProperty.next({value:ot()(n).startOf("month").toDate().toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:ot()(p).toDate().toISOString(),pos:2,refreshFilter:!0})}else if(this.ogcFilterTimeService.stepIsDayDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))||this.ogcFilterTimeService.stepIsHourDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))||this.ogcFilterTimeService.stepIsMinuteDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const i=new Date(this.beginMillisecond+this.stepMillisecond*(t.value-1));this.changeProperty.next({value:i.toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:new Date(this.ogcFilterTimeService.addStep(i.toISOString(),this.stepMillisecond)).toISOString(),pos:2,refreshFilter:!0})}}calculateStep(){for(let t=1;this.maxMillisecond-(this.beginMillisecond+t*this.stepMillisecond)>=-1;t++)this.calculatedStep=t}static \u0275fac=function(i){return new(i||l)(e.GI1(go))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter-time-slider"]],viewQuery:function(i,n){if(1&i&&e.CC$(to.Cg,5),2&i){let p;e.wto(p=e.Gqi())&&(n.slider=p.first)}},inputs:{currentFilter:"currentFilter",begin:"begin",max:"max",datasource:"datasource"},outputs:{changeProperty:"changeProperty"},standalone:!0,features:[e.M5G([go]),e.UHJ],decls:9,vars:7,consts:[[1,"slider-container"],["id","time-slider","thumbLabel","",3,"step","min","max","ngModel","displayWith","ngModelChange"],["ngSlider",""],["matSliderThumb","",3,"input"],["ngSliderThumb","matSliderThumb"],["mat-icon-button","","color","primary",3,"click"],[3,"svgIcon"]],template:function(i,n){if(1&i){const p=e.KQA();e.I0R(0,"div",0)(1,"mat-slider",1,2),e.iHE("ngModelChange",function(k){return e.kNx(n.sliderValue,k)||(n.sliderValue=k),k}),e.I0R(3,"input",3,4),e.qCj("input",function(){e.usT(p);const k=e.Gew(4),de=e.Gew(2);return e.CGJ(n.handleSliderInput({source:k,parent:de,value:k.value}))}),e.C$Y()(),e.I0R(5,"button",5),e.qCj("click",function(k){return n.playFilter(k)}),e.wR5(6,"mat-icon",6),e.C$Y(),e.I0R(7,"button",5),e.qCj("click",function(k){return n.resetFilter(k)}),e.wR5(8,"mat-icon",6),e.C$Y()()}2&i&&(e.yG2(),e.E7m("step",1)("min",1)("max",n.calculatedStep),e.OKB("ngModel",n.sliderValue),e.E7m("displayWith",n.sliderDisplayWith),e.yG2(5),e.E7m("svgIcon",n.playIcon),e.yG2(2),e._6D("svgIcon",n.resetIcon))},dependencies:[to.yO,to.Cg,to._s,Me.y,Me.ue,Me._G,ct.oJ,ct.um,tt.oB,tt.qL],styles:["[_nghost-%COMP%]     input{text-align:center!important;margin:auto 5px!important}[_nghost-%COMP%]   .datetime-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .slider-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .datetime-input[_ngcontent-%COMP%]{display:inline-block;margin:5px 25px}[_nghost-%COMP%]   .date-input[_ngcontent-%COMP%]{width:120px;margin-right:25px}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{display:inherit;margin-right:25px}[_nghost-%COMP%]   .hour-input[_ngcontent-%COMP%], [_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{width:40px}[_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{margin-left:10px}"]})}return l})();const An=["endDatepickerTime"],ki=["beginDatepickerTime"],xo=["beginTime"],ei=["endTime"];function Bi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",4),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO();return e.kNx(p.sliderMode,n)||(p.sliderMode=n),e.CGJ(n)}),e.qCj("change",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.modeChange(n))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.OKB("ngModel",t.sliderMode),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.filter.sliderModeTitle")," ")}}function nn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",5)(1,"igo-ogc-filter-time-slider",6),e.qCj("changeProperty",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changePropertyByPass(n))}),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("begin",t.beginValue)("max",t.restrictedToStep()?t.maxDate:t.endValue)("currentFilter",t.currentFilter)("datasource",t.datasource)}}function Ui(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",9)(1,"mat-form-field",10)(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"input",11),e.qCj("change",function(n){e.usT(t);const p=e.Gew(8),v=e.GaO(2);return e.CGJ(v.yearOnlyInputChange(n,p,"begin"))}),e.C$Y(),e.wR5(6,"mat-datepicker-toggle",12),e.I0R(7,"mat-datepicker",13,14),e.qCj("yearSelected",function(n){e.usT(t);const p=e.Gew(8),v=e.GaO(2);return e.CGJ(v.yearSelected(n,p,"begin"))}),e.C$Y(),e.wR5(9,"input",15,16),e.C$Y(),e.I0R(11,"mat-form-field",10)(12,"mat-label"),e.OEk(13),e.wVc(14,"translate"),e.C$Y(),e.I0R(15,"input",11),e.qCj("change",function(n){e.usT(t);const p=e.Gew(18),v=e.GaO(2);return e.CGJ(v.yearOnlyInputChange(n,p,"end"))}),e.C$Y(),e.wR5(16,"mat-datepicker-toggle",12),e.I0R(17,"mat-datepicker",13,17),e.qCj("yearSelected",function(n){e.usT(t);const p=e.Gew(18),v=e.GaO(2);return e.CGJ(v.yearSelected(n,p,"end"))}),e.C$Y(),e.wR5(19,"input",15,18),e.C$Y(),e.I0R(21,"div",19)(22,"button",20),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.resetFilter())}),e.wVc(23,"translate"),e.wR5(24,"mat-icon",21),e.C$Y(),e.I0R(25,"mat-slide-toggle",22),e.qCj("change",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.toggleFilterState())}),e.wVc(26,"translate"),e.C$Y()()()}if(2&l){const t=e.Gew(8),i=e.Gew(18),n=e.GaO(2);e.yG2(3),e.cNF(e.kDX(4,27,"igo.geo.timeFilter.startYear")),e.yG2(2),e._6D("value",n.onlyYearBegin),e.E7m("disabled",n.filterStateDisable),e.yG2(),e.E7m("for",t)("disabled",n.filterStateDisable),e.yG2(),e.E7m("startView",n.calendarView())("startAt",n.beginValue),e.yG2(2),e.E7m("matDatepicker",t)("value",n.beginValue?n.beginValue:n.handleDate(n.datasource.options.minDate))("min",n.handleDate(n.datasource.options.minDate))("max",n.endValue&&!n.restrictedToStep()?n.endValue:n.handleDate(n.datasource.options.maxDate)),e.yG2(4),e.cNF(e.kDX(14,29,"igo.geo.timeFilter.endYear")),e.yG2(2),e._6D("value",n.onlyYearEnd),e.E7m("disabled",n.filterStateDisable),e.yG2(),e.E7m("for",i)("disabled",n.filterStateDisable),e.yG2(),e.E7m("startView",n.calendarView())("startAt",n.endValue),e.yG2(2),e.E7m("matDatepicker",i)("value",n.endValue?n.endValue:n.handleDate(n.datasource.options.maxDate))("min",n.beginValue?n.beginValue:n.handleDate(n.datasource.options.minDate))("max",n.handleDate(n.datasource.options.maxDate)),e.yG2(3),e.E7m("matTooltip",e.kDX(23,31,"igo.geo.filter.resetFilters"))("disabled",n.filterStateDisable),e.yG2(2),e._6D("svgIcon",n.resetIcon),e.yG2(),e.E7m("matTooltip",e.kDX(26,33,"igo.geo.filter.toggleFilterState"))("checked",!n.filterStateDisable)}}function rn(l,m){if(1&l&&(e.I0R(0,"mat-option",37),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function So(l,m){if(1&l&&(e.I0R(0,"mat-option",37),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function Ko(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",32)(1,"mat-form-field",33)(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"mat-select",34),e.qCj("selectionChange",function(){e.usT(t),e.GaO();const n=e.Gew(5),p=e.GaO(2);return e.CGJ(p.changeTemporalProperty(n.value,1))}),e.yuY(6,rn,2,2,"mat-option",35),e.C$Y()(),e.I0R(7,"mat-form-field",36)(8,"mat-label"),e.OEk(9),e.wVc(10,"translate"),e.C$Y(),e.I0R(11,"mat-select",34),e.qCj("selectionChange",function(){e.usT(t),e.GaO();const n=e.Gew(5),p=e.GaO(2);return e.CGJ(p.changeTemporalProperty(n.value,1))}),e.yuY(12,So,2,2,"mat-option",35),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(3),e.cNF(e.kDX(4,8,"igo.geo.timeFilter.hour")),e.yG2(2),e.E7m("formControl",t.beginHourFormControl),e.e48("disabled",!t.currentFilter.active),e.yG2(),e.E7m("ngForOf",t.beginHours),e.yG2(3),e.cNF(e.kDX(10,10,"igo.geo.timeFilter.minute")),e.yG2(2),e.E7m("formControl",t.beginMinuteFormControl),e.e48("disabled",!t.currentFilter.active),e.yG2(),e.E7m("ngForOf",t.beginMinutes)}}function pi(l,m){if(1&l&&(e.I0R(0,"mat-option",37),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function Po(l,m){if(1&l&&(e.I0R(0,"mat-option",37),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function mi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",32)(1,"mat-form-field",33)(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"mat-select",34),e.qCj("selectionChange",function(){e.usT(t),e.GaO();const n=e.Gew(4),p=e.GaO(3);return e.CGJ(p.changeTemporalProperty(n.value,2))}),e.yuY(6,pi,2,2,"mat-option",35),e.C$Y()(),e.I0R(7,"mat-form-field",36)(8,"mat-label"),e.OEk(9),e.wVc(10,"translate"),e.C$Y(),e.I0R(11,"mat-select",34),e.qCj("selectionChange",function(){e.usT(t),e.GaO();const n=e.Gew(4),p=e.GaO(3);return e.CGJ(p.changeTemporalProperty(n.value,2))}),e.yuY(12,Po,2,2,"mat-option",35),e.C$Y()()()}if(2&l){const t=e.GaO(4);e.yG2(3),e.cNF(e.kDX(4,8,"igo.geo.timeFilter.hour")),e.yG2(2),e.E7m("formControl",t.endHourFormControl),e.e48("disabled",!t.currentFilter.active),e.yG2(),e.E7m("ngForOf",t.endHours),e.yG2(3),e.cNF(e.kDX(10,10,"igo.geo.timeFilter.minute")),e.yG2(2),e.E7m("formControl",t.endMinuteFormControl),e.e48("disabled",!t.currentFilter.active),e.yG2(),e.E7m("ngForOf",t.endMinutes)}}function Wo(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",24)(1,"mat-form-field",25),e.wR5(2,"mat-datepicker-toggle",12),e.I0R(3,"input",26,38),e.qCj("dateChange",function(){e.usT(t);const n=e.Gew(4),p=e.GaO(3);return e.CGJ(p.changeTemporalProperty(n.value,2))}),e.wVc(5,"translate"),e.C$Y(),e.wR5(6,"span",28),e.I0R(7,"mat-datepicker",29,17),e.qCj("yearSelected",function(n){e.usT(t);const p=e.Gew(8),v=e.GaO(3);return e.CGJ(v.yearSelected(n,p,"end"))})("monthSelected",function(n){e.usT(t);const p=e.Gew(8),v=e.GaO(3);return e.CGJ(v.monthSelected(n,p,"end"))}),e.C$Y()(),e.yuY(9,mi,13,12,"div",30),e.C$Y()}if(2&l){const t=e.Gew(8),i=e.GaO(3);e.yG2(2),e.E7m("for",t)("disabled",i.filterStateDisable),e.yG2(),e.E7m("matDatepicker",t)("placeholder",e.kDX(5,13,"igo.geo.timeFilter.endDate"))("matDatepickerFilter",i.filterEndFunction)("value",i.endValue?i.endValue:i.handleDate(i.datasource.options.maxDate))("min",i.beginValue?i.beginValue:i.handleDate(i.datasource.options.minDate))("max",i.handleDate(i.datasource.options.maxDate))("disabled",i.filterStateDisable),e.e48("disabled",!i.currentFilter.active),e.yG2(4),e.E7m("startView",i.calendarView())("startAt",i.endValue),e.yG2(2),e.E7m("ngIf","datetime"===i.calendarType())}}function ti(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",23)(1,"div",24)(2,"mat-form-field",25),e.wR5(3,"mat-datepicker-toggle",12),e.I0R(4,"input",26,27),e.qCj("dateChange",function(){e.usT(t);const n=e.Gew(5),p=e.GaO(2);return e.CGJ(p.changeTemporalProperty(n.value,1))}),e.wVc(6,"translate"),e.C$Y(),e.wR5(7,"span",28),e.I0R(8,"mat-datepicker",29,14),e.qCj("yearSelected",function(n){e.usT(t);const p=e.Gew(9),v=e.GaO(2);return e.CGJ(v.yearSelected(n,p,"begin"))})("monthSelected",function(n){e.usT(t);const p=e.Gew(9),v=e.GaO(2);return e.CGJ(v.monthSelected(n,p,"begin"))}),e.C$Y()(),e.yuY(10,Ko,13,12,"div",30),e.C$Y(),e.yuY(11,Wo,10,15,"div",31),e.I0R(12,"div",19)(13,"button",20),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.resetFilter())}),e.wVc(14,"translate"),e.wR5(15,"mat-icon",21),e.C$Y(),e.I0R(16,"mat-slide-toggle",22),e.qCj("change",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.toggleFilterState())}),e.wVc(17,"translate"),e.C$Y()()()}if(2&l){const t=e.Gew(9),i=e.GaO(2);e.yG2(3),e.E7m("for",t)("disabled",i.filterStateDisable),e.yG2(),e.E7m("matDatepicker",t)("placeholder",e.kDX(6,19,"igo.geo.timeFilter.startDate"))("matDatepickerFilter",i.filterBeginFunction)("value",i.beginValue?i.beginValue:i.handleDate(i.datasource.options.minDate))("min",i.handleDate(i.datasource.options.minDate))("max",i.endValue&&!i.restrictedToStep()?i.endValue:i.handleDate(i.datasource.options.maxDate))("disabled",i.filterStateDisable),e.e48("disabled",!i.currentFilter.active),e.yG2(4),e.E7m("startView",i.calendarView())("startAt",i.beginValue),e.yG2(2),e.E7m("ngIf","datetime"===i.calendarType()),e.yG2(),e.E7m("ngIf",!i.restrictedToStep()),e.yG2(2),e.E7m("matTooltip",e.kDX(14,21,"igo.geo.filter.resetFilters"))("disabled",i.filterStateDisable),e.yG2(2),e._6D("svgIcon",i.resetIcon),e.yG2(),e.E7m("matTooltip",e.kDX(17,23,"igo.geo.filter.toggleFilterState"))("checked",!i.filterStateDisable)}}function Yi(l,m){if(1&l&&(e.I0R(0,"div"),e.yuY(1,Ui,27,35,"div",7)(2,ti,18,25,"div",8),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",t.calendarTypeYear),e.yG2(),e.E7m("ngIf","year"!==t.calendarType())}}let gi=(()=>{class l{ogcFilterTimeService;datasource;currentFilter;changeProperty=new e._w7;beginHours;endHours;beginMinutes;endMinutes;beginHourFormControl=new Me.yM;beginMinuteFormControl=new Me.yM;endHourFormControl=new Me.yM;endMinuteFormControl=new Me.yM;_beginValue;_endValue;_defaultMin="1900-01-01";_defaultMax="2052-01-06";_defaultDisplayFormat="DD/MM/YYYY HH:mm A";_defaultSliderModeEnabled=!0;ogcFilterOperator=Bt.e;sliderMode=!1;defaultStepMillisecond=6e4;options;onlyYearBegin;onlyYearEnd;calendarTypeYear=!1;resetIcon="replay";filterStateDisable;endDatepickerTime;beginDatepickerTime;beginTime;endTime;get step(){return this.datasource.options.stepDate?this.datasource.options.stepDate:this.currentFilter.step}get stepMilliseconds(){const t=ot().duration(this.step).asMilliseconds();return 0===t?this.defaultStepMillisecond:t}set beginValue(t){this._beginValue=t}get beginValue(){return this._beginValue}set endValue(t){this._endValue=t}get endValue(){return this._endValue}get sliderInterval(){return void 0===this.currentFilter.sliderInterval?2e3:this.currentFilter.sliderInterval}get maxDate(){return this.datasource.options.maxDate?this.datasource.options.maxDate:this._defaultMax}get displayFormat(){return this.currentFilter.displayFormat?this.currentFilter.displayFormat:this._defaultDisplayFormat}filterBeginFunction;filterEndFunction;constructor(t){this.ogcFilterTimeService=t}ngOnInit(){this.currentFilter.sliderOptions&&(this.currentFilter.sliderOptions.enabled=void 0!==this.currentFilter.sliderOptions.enabled?this.currentFilter.sliderOptions.enabled:this._defaultSliderModeEnabled),this.beginValue=this.parseFilter(this.handleMin()),this.endValue=this.parseFilter(this.handleMax()),this.onlyYearBegin=this.beginValue.getUTCFullYear(),this.onlyYearEnd=this.endValue.getUTCFullYear(),this.calendarTypeYear=this.isCalendarYearMode(),this.setFilterStateDisable(),this.updateHoursMinutesArray(),this.updateValues(),this.dateFilter(this.filterBeginFunction,"begin"),this.dateFilter(this.filterEndFunction,"end")}parseFilter(t){if(!t)return new Date;if(isNaN(new Date(t).getTime())){if(t.search("now")>=0){const i=t.match(/years|months|weeks|days|hours|seconds/);if(t.match(/\+/)){const n=parseInt(t.substring(t.search("+")+1,i.index),10);return ot()().add(n,i[0]).toDate()}if(t.match(/\-/)){const n=parseInt(t.substring(t.search("-")+1,i.index),10);return ot()().subtract(n,i[0]).toDate()}return new Date}if(t.search("today")>=0){const i=ot()().endOf("day").toDate(),n=t.match(/years|months|weeks|days|hours|seconds/);if(t.match(/\+/)){const p=parseInt(t.substring(t.search("+")+1,n.index),10);return ot()(i).add(p,n[0]).toDate()}if(t.match(/\-/)){const p=parseInt(t.substring(t.search("-")+1,n.index),10);return ot()(i).subtract(p,n[0]).toDate()}return i}return new Date}return this.currentFilter.calendarModeYear?this.getDateFromStringWithoutTime(t):t?new Date(t):new Date}changeTemporalProperty(t,i,n=!0){if(!this.isValidDate(t))return;let p=this.getDateTime(t,i);if(this.isCalendarYearMode()){let v;return 1===i?(this.beginValue=t,this.onlyYearBegin=this.beginValue.getFullYear(),v=`${this.onlyYearBegin}-01-01`):(this.endValue=t,this.onlyYearEnd=this.endValue.getFullYear(),v=`${this.onlyYearEnd}-01-01`),void this.changeProperty.next({value:v,pos:i,refreshFilter:n})}2===i&&"date"===this.calendarType()&&!this.sliderMode&&(p=ot()(p).endOf("day").toDate()),1===i?(this.beginValue=p,this.restrictedToStep()&&this.changeTemporalProperty(this.ogcFilterTimeService.addStep(p,this.stepMilliseconds),2,n)):this.endValue=p,this.updateHoursMinutesArray(),this.changeProperty.next({value:p.toISOString(),pos:i,refreshFilter:n})}handleDate(t){if(t&&""!==t)return"string"==typeof t&&this.currentFilter.calendarModeYear?this.getDateFromStringWithoutTime(t):new Date(t)}calendarType(){return this.currentFilter.calendarModeYear?"year":this.stepMilliseconds<864e5?"datetime":"date"}isCalendarYearMode(){return"year"===this.calendarType()}yearOnlyInputChange(t,i,n){const v=this.getDateFromStringWithoutTime(t.target.value);this.yearSelected(v,i,n)}yearSelected(t,i,n,p=!0){this.ogcFilterTimeService.stepIsYearDuration(this.step)&&(i&&i.close(),"end"===n?t=ot()(t).endOf("year").toDate():"begin"===n&&this.restrictedToStep()&&!this.calendarTypeYear&&this.yearSelected(t,void 0,"end"),this.changeTemporalProperty(t,"begin"===n?1:2,p))}monthSelected(t,i,n,p=!0){this.ogcFilterTimeService.stepIsMonthDuration(this.step)&&(i&&i.close(),"end"===n?t=ot()(t).endOf("month").toDate():"begin"===n&&this.restrictedToStep()&&this.monthSelected(t,void 0,"end"),this.changeTemporalProperty(t,"begin"===n?1:2,p))}calendarView(){const t=this.stepMilliseconds,i=Math.abs(this.parseFilter(this.currentFilter.end).getTime()-this.parseFilter(this.currentFilter.begin).getTime());return this.ogcFilterTimeService.stepIsYearDuration(this.step)?"multi-year":this.ogcFilterTimeService.stepIsMonthDuration(this.step)?"year":t<864e5&&i<864e5?"clock":"month"}dateFilter(t,i){const n=new Date(i),p=n.getTime()-new Date(this.handleMin()).getTime();if(this.ogcFilterTimeService.stepIsYearDuration(this.step)){const v=ot()(n).diff(ot()(this.handleMin()),"years",!0);if("end"===t){const k=ot()(n).add(1,"d"),de=ot()(k).diff(ot()(this.handleMin()),"years",!0);return void(this.filterEndFunction=de%ot().duration(this.step).asYears()==0)}if("begin"===t)return void(this.filterBeginFunction=v%ot().duration(this.step).asYears()==0)}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.step)){const v=ot()(n).diff(ot()(this.handleMin()),"months",!0);if("end"===t){const k=ot()(n).add(1,"d"),de=ot()(k).diff(ot()(this.handleMin()),"months",!0);return void(this.filterEndFunction=de%ot().duration(this.step).asMonths()==0)}if("begin"===t)return void(this.filterBeginFunction=v%ot().duration(this.step).asMonths()==0)}else if(this.ogcFilterTimeService.stepIsWeekDuration(this.step)){const v=ot()(n).diff(ot()(this.handleMin()),"weeks",!0);if("end"===t){const k=ot()(n).add(1,"d"),de=ot()(k).diff(ot()(this.handleMin()),"weeks",!0);return void(this.filterEndFunction=de%ot().duration(this.step).asWeeks()==0)}if("begin"===t)return void(this.filterBeginFunction=v%ot().duration(this.step).asWeeks()==0)}else if(this.ogcFilterTimeService.stepIsDayDuration(this.step)){const v=ot()(n).diff(ot()(this.handleMin()),"days",!0);if("end"===t){const k=ot()(n).add(1,"d"),he=ot()(k).diff(ot()(this.handleMin()),"days",!0)%ot().duration(this.step).asDays();return void(this.filterEndFunction=he<1e-7&&he>-1e-7||0===he)}if("begin"===t){const k=v%ot().duration(this.step).asDays()+1;return void(this.filterBeginFunction=k<1e-7&&k>-1e-7&&0!==k||1===k)}}else if(this.ogcFilterTimeService.stepIsHourDuration(this.step)){if("end"===t){const v=ot()(n).diff(ot()(this.handleMin()),"hours",!0);return void(this.filterEndFunction=v%ot().duration(this.step).asHours()==0)}if("begin"===t){const v=ot()(n).diff(ot()(this.handleMin()),"hours",!0);return void(this.filterBeginFunction=v%ot().duration(this.step).asHours()==0)}}else if(this.ogcFilterTimeService.stepIsMinuteDuration(this.step)){if("end"===t)return void(this.filterEndFunction=!0);if("begin"===t)return void(this.filterBeginFunction=!0)}this.filterEndFunction=p%this.stepMilliseconds==0,this.filterBeginFunction=p%this.stepMilliseconds==0}getDateTime(t,i){const n=new Date(t);let p;if(!this.sliderMode)switch(i){case 1:if(this.currentFilter.calendarModeYear){p=n.setHours(0,0);break}p=n.setHours(this.beginHourFormControl.value,this.beginMinuteFormControl.value);break;case 2:if(this.currentFilter.calendarModeYear){p=n.setHours(0,0);break}p=n.setHours(this.endHourFormControl.value,this.endMinuteFormControl.value)}return new Date(p||n)}handleMinuteIncrement(){return this.ogcFilterTimeService.stepIsMinuteDuration(this.step)?this.stepMilliseconds<36e5?this.stepMilliseconds/1e3==60?1:this.stepMilliseconds/1e3:this.stepMilliseconds%36e5/60:this.ogcFilterTimeService.stepIsHourDuration(this.step)?60:1}handleHourIncrement(){return this.ogcFilterTimeService.stepIsHourDuration(this.step)?this.stepMilliseconds/1e3/60/60:1}fullBeginHoursArray(t){this.beginHours=Array.from(t?{length:(this.endHourFormControl.value-0)/this.handleHourIncrement()+1}:{length:23/this.handleHourIncrement()+1},(i,n)=>0+n*this.handleHourIncrement()),this.beginHourFormControl.setValue(this.beginValue.getHours())}fullEndHoursArray(t){this.endHours=t?Array.from({length:(23-this.beginHourFormControl.value)/this.handleHourIncrement()+1},(i,n)=>this.beginHourFormControl.value+n*this.handleHourIncrement()):Array.from({length:23/this.handleHourIncrement()+1},(i,n)=>0+n*this.handleHourIncrement()),this.endHourFormControl.setValue(this.endValue.getHours())}fullBeginMinutesArray(t){this.beginMinutes=Array.from(t?{length:(this.endMinuteFormControl.value-0)/this.handleMinuteIncrement()+1}:{length:59/this.handleMinuteIncrement()+1},(i,n)=>0+n*this.handleMinuteIncrement()),this.beginMinuteFormControl.setValue(this.beginValue.getMinutes())}fullEndMinutesArray(t){this.endMinutes=t?Array.from({length:(59-this.beginMinuteFormControl.value)/this.handleMinuteIncrement()+1},(i,n)=>this.beginMinuteFormControl.value+n*this.handleMinuteIncrement()):Array.from({length:59/this.handleMinuteIncrement()+1},(i,n)=>0+n*this.handleMinuteIncrement()),this.endMinuteFormControl.setValue(this.endValue.getMinutes())}updateHoursMinutesArray(){const t=new Date(this.beginValue),i=new Date(this.endValue);t.setHours(0,0)===i.setHours(0,0)?(this.fullBeginHoursArray(!0),this.fullEndHoursArray(!0),this.beginValue.getHours()===this.endValue.getHours()&&(this.fullBeginMinutesArray(!0),this.fullEndMinutesArray(!0))):(this.fullBeginHoursArray(),this.fullEndHoursArray(),this.fullBeginMinutesArray(),this.fullEndMinutesArray())}updateValues(){this.changeTemporalProperty(this.beginValue,1,!1),this.changeTemporalProperty(this.endValue,2,!0)}restrictedToStep(){return!!this.currentFilter.restrictToStep&&this.currentFilter.restrictToStep}handleMin(){return this.currentFilter.begin?this.currentFilter.begin:this.datasource.options.minDate?this.datasource.options.minDate:this._defaultMin}handleMax(){return this.currentFilter.end?this.currentFilter.end:this.datasource.options.maxDate?this.datasource.options.maxDate:this._defaultMax}changePropertyByPass(t){this.changeProperty.next(t)}modeChange(t){t.checked||this.updateValues()}setFilterStateDisable(){this.filterStateDisable=!!this.currentFilter&&!this.currentFilter.active,"datetime"===this.calendarType()&&(!0===this.filterStateDisable?(this.beginHourFormControl.disable(),this.beginMinuteFormControl.disable(),this.endHourFormControl.disable(),this.endMinuteFormControl.disable()):(this.beginHourFormControl.enable(),this.beginMinuteFormControl.enable(),this.endHourFormControl.enable(),this.endMinuteFormControl.enable()))}getDateFromStringWithoutTime(t){let i,n="01",p="01";if(10===t.length){const v=t.split("-");if(3!==v.length)throw new Error("Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY");i=v[0],n=v[1],p=v[2]}else{if(4!==t.length)return new Date(t);i=t}return new Date(`${i}-${n}-${p} 00:00:00`)}resetFilter(){let i,n,p,v,t=this.datasource.options.ogcFilters.filters;this.calendarTypeYear?(v="today"===t.end?`${(new Date).toLocaleDateString("en-CA").substring(0,4)}-01-01`:`${t.end.substring(0,4)}-01-01`,p=`${t.begin.substring(0,4)}-01-01`,i=this.getDateFromStringWithoutTime(p),n=this.getDateFromStringWithoutTime(v)):(i=this.parseFilter(t.begin),n=this.parseFilter(t.end),p=i.toISOString(),v=n.toISOString()),(this.currentFilter.begin!==p||this.currentFilter.end!==v)&&(this.beginValue=i,this.endValue=n,this.updateValues())}toggleFilterState(){this.currentFilter.active=!0!==this.currentFilter.active,this.setFilterStateDisable(),this.updateValues()}isValidDate(t){return t instanceof Date&&!isNaN(t.getTime())}static \u0275fac=function(i){return new(i||l)(e.GI1(go))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter-time"]],viewQuery:function(i,n){if(1&i&&(e.CC$(An,5),e.CC$(ki,5),e.CC$(xo,5),e.CC$(ei,5)),2&i){let p;e.wto(p=e.Gqi())&&(n.endDatepickerTime=p.first),e.wto(p=e.Gqi())&&(n.beginDatepickerTime=p.first),e.wto(p=e.Gqi())&&(n.beginTime=p.first),e.wto(p=e.Gqi())&&(n.endTime=p.first)}},inputs:{datasource:"datasource",currentFilter:"currentFilter"},outputs:{changeProperty:"changeProperty"},standalone:!0,features:[e.M5G([go,(0,qo.CA)()]),e.UHJ],decls:4,vars:3,consts:[[1,"datetime-container"],[3,"ngModel","ngModelChange","change",4,"ngIf"],["class","slider-container",4,"ngIf"],[4,"ngIf"],[3,"ngModel","ngModelChange","change"],[1,"slider-container"],[3,"begin","max","currentFilter","datasource","changeProperty"],["class","year-input-container",4,"ngIf"],["class","datetime-input-container",4,"ngIf"],[1,"year-input-container"],["subscriptSizing","dynamic",1,"year-input"],["matInput","",1,"year-input-only-year",3,"value","disabled","change"],["matSuffix","",3,"for","disabled"],["panelClass","datepicker-year",3,"startView","startAt","yearSelected"],["beginDatepicker",""],["matInput","","enabled","false","readonly","true",1,"year-input-hide",3,"matDatepicker","value","min","max"],["beginYear",""],["endDatepicker",""],["endYear",""],[1,"actions-container"],["mat-icon-button","","color","primary",1,"reset-button",3,"matTooltip","disabled","click"],[3,"svgIcon"],["tooltip-position","below","matTooltipShowDelay","500",1,"toggle-filter-state",3,"matTooltip","checked","change"],[1,"datetime-input-container"],[1,"datetime-input"],["subscriptSizing","dynamic",1,"date-input"],["matInput","",3,"matDatepicker","placeholder","matDatepickerFilter","value","min","max","disabled","dateChange"],["begin",""],[1,"filler"],[3,"startView","startAt","yearSelected","monthSelected"],["class","time-input",4,"ngIf"],["class","datetime-input",4,"ngIf"],[1,"time-input"],["subscriptSizing","dynamic",1,"hour-input"],[3,"formControl","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["subscriptSizing","dynamic",1,"minute-input"],[3,"value"],["end",""]],template:function(i,n){1&i&&(e.I0R(0,"div",0),e.yuY(1,Bi,3,4,"mat-slide-toggle",1)(2,nn,2,4,"div",2)(3,Yi,3,2,"div",3),e.C$Y()),2&i&&(e.yG2(),e.E7m("ngIf",null==n.currentFilter.sliderOptions?null:n.currentFilter.sliderOptions.enabled),e.yG2(),e.E7m("ngIf",n.sliderMode),e.yG2(),e.E7m("ngIf",!n.sliderMode))},dependencies:[Xe.u_,Co.GE,Co.cP,Me.y,Me.ue,Me._G,jo,ft.wb,ft.Up,ft.w5,ft.Gm,Yt.cN,Yt.yi,di.iU,di.SU,di.Ul,di.yu,ct.oJ,ct.um,st.KO,st.a4,tt.oB,tt.qL,At.d5,At.kX,Gt.I5,Me.sl,Me.ug,Xe.Iw,Gt.Ax,it.O0,it.sD],styles:["[_nghost-%COMP%]     input{text-align:center!important;margin:auto 5px!important}[_nghost-%COMP%]   .slider-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .datetime-input-container[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}[_nghost-%COMP%]   .datetime-input-container[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(:last-child){margin-right:8px}[_nghost-%COMP%]   .datetime-input[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .date-input[_ngcontent-%COMP%]{width:154px}[_nghost-%COMP%]   .actions-container[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{margin-top:16px}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(:last-child){margin-right:8px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{margin-top:4px}}[_nghost-%COMP%]   .hour-input[_ngcontent-%COMP%], [_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{width:100px}[_nghost-%COMP%]   .year-input-container[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .year-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]:not(:last-child){margin-right:4px}[_nghost-%COMP%]   .year-input-hide[_ngcontent-%COMP%]{width:120px;margin-right:25px;display:none}[_nghost-%COMP%]   .year-input-only-year[_ngcontent-%COMP%]{width:120px;margin-right:25px;text-align:left!important}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-arrow{display:none}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-period-button{pointer-events:none}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover{background-color:#0000001f;border-radius:999px}"]})}return l})();function sn(l,m){if(1&l&&(e.I0R(0,"mat-option",24),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.alias)("id",t.name)("matTooltip",t.alias),e.yG2(),e.oRS(" ",t.alias," ")}}function an(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",25),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.clearSelectedField())}),e.wR5(1,"mat-icon",26),e.C$Y()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active)}}function ln(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",18),e.qCj("mouseenter",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable="selectField")})("mouseleave",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable=void 0)}),e.I0R(1,"input",19),e.qCj("input",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.updateFieldsList(n.target.value))}),e.wVc(2,"translate"),e.wVc(3,"async"),e.wVc(4,"async"),e.wVc(5,"async"),e.wVc(6,"async"),e.wVc(7,"translate"),e.C$Y(),e.I0R(8,"mat-autocomplete",20,21),e.qCj("optionSelected",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeField(n.option.id))}),e.yuY(10,sn,2,4,"mat-option",22),e.wVc(11,"async"),e.C$Y(),e.yuY(12,an,2,1,"button",23),e.C$Y()}if(2&l){const t=e.Gew(9),i=e.GaO();e.E7m("floatLabel",i.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,8,"igo.geo.sourceFields.selectField"))("disabled",!i.currentFilter.active)("matAutocomplete",t)("value",e.kDX(3,10,i.selectedField$)?e.kDX(4,12,i.selectedField$).alias:"")("matTooltip",e.kDX(5,14,i.selectedField$)?e.kDX(6,16,i.selectedField$).alias:e.kDX(7,18,"igo.geo.sourceFields.selectField")),e.yG2(9),e.E7m("ngForOf",e.kDX(11,20,i.filteredFields$)),e.yG2(2),e.E7m("ngIf",i.currentFilter.propertyName&&"selectField"===i.inputClearable&&i.currentFilter.active)}}function Vi(l,m){if(1&l&&(e.I0R(0,"mat-option",4),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.key)("matTooltip",e.kDX(1,3,"igo.geo.operators.tooltip."+t.key)),e.yG2(2),e.oRS(" ",e.kDX(3,5,"igo.geo.operators."+t.key)," ")}}function oo(l,m){if(1&l&&(e.I0R(0,"mat-option",30),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.type),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.spatialSelector."+t.type)," ")}}function cn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",27)(1,"mat-select",28),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeSpatialSelector(n.value))}),e.yuY(2,oo,3,4,"mat-option",29),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("disabled",!t.currentFilter.active)("value",t.currentFilter.igoSpatialSelector),e.yG2(),e.E7m("ngForOf",t.igoSpatialSelectors)}}function un(l,m){if(1&l&&(e.I0R(0,"mat-option",34),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t)("matTooltip",t),e.yG2(),e.oRS(" ",t," ")}}function dn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",25),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.clearProperty())}),e.wR5(1,"mat-icon",26),e.C$Y()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active)}}function kn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",31),e.qCj("mouseenter",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable="selectProperty")})("mouseleave",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable=void 0)}),e.I0R(1,"input",19),e.qCj("input",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.updateValuesList(n.target.value))}),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"mat-autocomplete",20,32),e.qCj("optionSelected",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeProperty(n.option.value))}),e.yuY(5,un,2,3,"mat-option",33),e.wVc(6,"async"),e.C$Y(),e.yuY(7,dn,2,1,"button",23),e.C$Y()}if(2&l){const t=e.Gew(4),i=e.GaO();e.E7m("floatLabel",i.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,8,"igo.geo.filter.placeholder"))("disabled",!i.currentFilter.active)("matAutocomplete",t)("value","expression"===i.detectProperty()?i.currentFilter.expression:i.currentFilter.pattern)("matTooltip","expression"===i.detectProperty()?i.currentFilter.expression||"":i.currentFilter.pattern||""),e.yG2(4),e.E7m("ngForOf",e.kDX(6,10,i.filteredValues$)),e.yG2(2),e.E7m("ngIf",i.isClearable()&&"selectProperty"===i.inputClearable&&i.currentFilter.active)}}function hi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",25),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.currentFilter.igoSNRC="")}),e.wR5(1,"mat-icon",26),e.C$Y()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active&&"selectSNRC"===t.inputClearable&&t.currentFilter.active)}}function pn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",35),e.qCj("mouseenter",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable="selectSNRC")})("mouseleave",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable=void 0)}),e.I0R(1,"input",36),e.qCj("input",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeSNRC(n.target.value))}),e.wVc(2,"translate"),e.C$Y(),e.yuY(3,hi,2,1,"button",23),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("floatLabel",t.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,5,"igo.geo.filter.placeholderSnrc"))("value",t.currentFilter.igoSNRC)("matTooltip",t.currentFilter.igoSNRC?t.currentFilter.igoSNRC:""),e.yG2(2),e.E7m("ngIf",t.currentFilter.igoSNRC)}}function wi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",38),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.changeMapExtentGeometry())}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",39),e.C$Y()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active)("disabled",!t.currentFilter.active)("matTooltip",e.kDX(1,3,"igo.geo.spatialSelector.btnSetExtent"))}}function oi(l,m){if(1&l&&(e.SAx(0),e.yuY(1,wi,3,5,"button",37),e.k70()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf","fixedExtent"===t.currentFilter.igoSpatialSelector)}}function mn(l,m){if(1&l&&(e.I0R(0,"mat-option",34),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t)("matTooltip",t),e.yG2(),e.oRS(" ",t," ")}}function gn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",25),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.clearProperty(1))}),e.wR5(1,"mat-icon",26),e.C$Y()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active)}}function hn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",40),e.qCj("mouseenter",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable="selectProperty1")})("mouseleave",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable=void 0)}),e.I0R(1,"input",41),e.qCj("input",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.updateValuesList(n.target.value,1))}),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"mat-autocomplete",20,42),e.qCj("optionSelected",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeNumericProperty(n.option.value,1))}),e.yuY(5,mn,2,3,"mat-option",33),e.wVc(6,"async"),e.C$Y(),e.yuY(7,gn,2,1,"button",23),e.C$Y()}if(2&l){const t=e.Gew(4),i=e.GaO();e.E7m("floatLabel",i.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,7,"igo.geo.filter.placeholder"))("disabled",!i.currentFilter.active)("matAutocomplete",t)("value","lowerBoundary"===i.detectProperty(1)?i.currentFilter.lowerBoundary:i.currentFilter.begin),e.yG2(4),e.E7m("ngForOf",e.kDX(6,9,i.filteredValues$)),e.yG2(2),e.E7m("ngIf",i.isClearable(1)&&"selectProperty1"===i.inputClearable&&i.currentFilter.active)}}function fn(l,m){if(1&l&&(e.I0R(0,"mat-option",34),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t)("matTooltip",t),e.yG2(),e.oRS(" ",t," ")}}function yn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",25),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.clearProperty(2))}),e.wR5(1,"mat-icon",26),e.C$Y()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active)}}function _n(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",40),e.qCj("mouseenter",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable="selectProperty2")})("mouseleave",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable=void 0)}),e.I0R(1,"input",41),e.qCj("input",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.updateValuesList(n.target.value,2))}),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"mat-autocomplete",20,43),e.qCj("optionSelected",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeNumericProperty(n.option.value,2))}),e.yuY(5,fn,2,3,"mat-option",33),e.wVc(6,"async"),e.C$Y(),e.yuY(7,yn,2,1,"button",23),e.C$Y()}if(2&l){const t=e.Gew(4),i=e.GaO();e.E7m("floatLabel",i.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,7,"igo.geo.filter.placeholder"))("disabled",!i.currentFilter.active)("matAutocomplete",t)("value","upperBoundary"===i.detectProperty(2)?i.currentFilter.upperBoundary:i.currentFilter.end),e.yG2(4),e.E7m("ngForOf",e.kDX(6,9,i.filteredValues$)),e.yG2(2),e.E7m("ngIf",i.isClearable(2)&&"selectProperty2"===i.inputClearable&&i.currentFilter.active)}}function ji(l,m){if(1&l){const t=e.KQA();e.I0R(0,"igo-ogc-filter-time",44),e.qCj("changeProperty",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeProperty(n.value,n.pos))}),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("datasource",t.datasource)("currentFilter",t.currentFilter)}}const ii=(l,m)=>({logical:l,logicalHidden:m}),Cn=(l,m)=>({operator:l,dualInput:m}),Oi=()=>["expression","pattern"],Bn=()=>["lowerBoundary","begin"],Un=()=>["upperBoundary","end"];let Ii=(()=>{class l{wktService;ogcFilterOperator=Bt.e;filteredValues$;filteredFields$;allOgcFilterOperators;ogcFilterOperators$=new A.g(void 0);igoSpatialSelectors;value="";inputOperator;selectedField$=new A.g(void 0);fields$=new A.g([]);color="primary";disabled;currentFilterIsSpatial$=new A.g(!1);defaultStepMillisecond=6e3;inputClearable;refreshFilters;datasource;map;currentFilter;set snrc(t){(/^\d{2}$/gi.test(t)||/^\d{2}[a-p]$/gi.test(t)||/^\d{2}[a-l][0,1][0-9]$/gi.test(t))&&(this._snrc=t,this.currentFilter.igoSNRC=t)}get snrc(){return this._snrc}_snrc="";floatLabel;get activeFilters(){return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(t=>!0===t.active)}get allowedOperators(){return(new eo.S).computeAllowedOperators(this.fields$.value,this.currentFilter.propertyName,this.datasource.options.ogcFilters.allowedOperatorsType)}constructor(t){this.wktService=t,this.allOgcFilterOperators=(new eo.S).operators,this.ogcFilterOperators$.next(this.allOgcFilterOperators),this.igoSpatialSelectors=[{type:"fixedExtent"},{type:"snrc"}]}ngOnInit(){if(this.datasource.options.sourceFields){const t=this.datasource.options.sourceFields.filter(i=>void 0===i.excludeFromOgcFilters||!i.excludeFromOgcFilters);t.map(i=>{i.values&&i.values.sort()}),this.fields$.next(t)}this.updateFieldsList(),this.selectedField$.next(this.fields$.value.find(t=>t.name===this.currentFilter.propertyName)),this.updateValuesList(),this.selectedField$.subscribe(t=>{this.ogcFilterOperators$.next(this.allowedOperators),-1===Object.keys(this.allowedOperators).indexOf(this.currentFilter.operator)&&(this.currentFilter.operator=Object.keys(this.allowedOperators)[0],this.currentFilter.operator=Object.keys(this.allowedOperators)[0]),this.updateValuesList()}),this.currentFilterIsSpatial()}updateFieldsList(t){this.filteredFields$=t&&t.length>0?(0,q.of)(this._filterFields(t)):this.fields$,this.fields$.value.find(i=>i.name===t)&&this.changeField(t)}updateValuesList(t,i){this.filteredValues$=(0,q.of)(t&&t.length>0?this._filterValues(t):this.selectedField$.value?this.selectedField$.value.values:[]),t&&t.length>=1&&this.changeProperty(t,i)}_filterFields(t){const i=new RegExp(t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),"gi");return this.fields$.value.filter(n=>i.test(n.alias.normalize("NFD").replace(/[\u0300-\u036f]/g,"")))}_filterValues(t){const i=new RegExp(t.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,""),"gi");return this.selectedField$.value?.values?.filter(n=>n&&i.test(n.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"")))}clearSelectedField(){this.currentFilter.propertyName="",this.selectedField$.next(void 0),this.clearProperty()}isClearable(t){const i=this.detectProperty(t);if(i)return this.currentFilter[i]}clearProperty(t){const i=this.detectProperty(t);if(i)return this.currentFilter[i]=""}toggleFilterState(t){this.datasource.options.ogcFilters.interfaceOgcFilters.find(i=>i.filterid===this.currentFilter.filterid).active=t.checked,this.refreshFilters()}deleteFilter(){const t=this.datasource.options.ogcFilters;t.interfaceOgcFilters=t.interfaceOgcFilters.filter(i=>i.filterid!==this.currentFilter.filterid),this.refreshFilters()}changeLogical(t){this.currentFilter.parentLogical=t,this.refreshFilters()}changeOperator(t){this.currentFilter.operator=t,this.currentFilterIsSpatial(),this.currentFilterIsSpatial$.value&&0===this.currentFilter.wkt_geometry.length?this.changeSpatialSelector(this.currentFilter.igoSpatialSelector):this.refreshFilters()}changeField(t){this.currentFilter.propertyName=t,this.selectedField$.next(this.fields$.value.find(i=>i.name===this.currentFilter.propertyName)),this.refreshFilters()}changeCaseSensitive(t){this.currentFilter.matchCase=t.checked,this.refreshFilters()}changeProperty(t,i,n=!0){const p=this.detectProperty(i);p&&(this.datasource.options.ogcFilters.interfaceOgcFilters.find(v=>v.filterid===this.currentFilter.filterid)[p]=t,n&&this.refreshFilters())}changeNumericProperty(t,i){this.changeProperty(parseFloat(t),i)}changeSpatialSelector(t){this.currentFilter.igoSpatialSelector=t,"fixedExtent"===t&&this.changeMapExtentGeometry(!1),this.currentFilterIsSpatial(),this.refreshFilters()}changeSNRC(t){this.snrc=t,this.changeSNRCGeometry()}changeSNRCGeometry(){this.datasource.options.ogcFilters.interfaceOgcFilters.find(i=>i.filterid===this.currentFilter.filterid)&&(this.snrc&&"snrc"===this.currentFilter.igoSpatialSelector&&(this.currentFilter.wkt_geometry=this.wktService.snrcToWkt(this.snrc,this.map.projection).wktPoly),this.refreshFilters())}changeMapExtentGeometry(t=!0){this.datasource.options.ogcFilters.interfaceOgcFilters.find(n=>n.filterid===this.currentFilter.filterid)&&("fixedExtent"===this.currentFilter.igoSpatialSelector&&(this.currentFilter.wkt_geometry=this.wktService.extentToWkt(this.map.projection,this.map.viewController.getExtent(),this.map.projection).wktPoly),t&&this.refreshFilters())}detectProperty(t){switch(this.currentFilter.operator){case Bt.e.PropertyIsNotEqualTo:case Bt.e.PropertyIsEqualTo:case Bt.e.PropertyIsGreaterThan:case Bt.e.PropertyIsGreaterThanOrEqualTo:case Bt.e.PropertyIsLessThan:case Bt.e.PropertyIsLessThanOrEqualTo:return"expression";case Bt.e.PropertyIsLike:return"pattern";case Bt.e.PropertyIsBetween:return t&&1===t?"lowerBoundary":t&&2===t?"upperBoundary":void 0;case Bt.e.During:return t&&1===t?"begin":t&&2===t?"end":void 0;default:return}}currentFilterIsSpatial(){let t=!1;this.currentFilter&&(t=-1!==[Bt.e.Contains,Bt.e.Intersects,Bt.e.Within].indexOf(this.currentFilter.operator)),this.currentFilterIsSpatial$.next(t)}isTemporalOperator(){return this.currentFilter.operator.toLowerCase()===this.ogcFilterOperator.During.toLowerCase()}static \u0275fac=function(i){return new(i||l)(e.GI1(ui))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter-form"]],inputs:{refreshFilters:"refreshFilters",datasource:"datasource",map:"map",currentFilter:"currentFilter",floatLabel:"floatLabel"},standalone:!0,features:[e.UHJ],decls:43,vars:76,consts:[[1,"ogc-filter-form-container"],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","checked","click","change"],[3,"ngClass"],["tooltip-position","above","matTooltipShowDelay","500",3,"disabled","value","matTooltip","selectionChange"],["tooltip-position","above","matTooltipShowDelay","500",3,"value","matTooltip"],["class","field",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[3,"ngClass","floatLabel"],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","value","selectionChange"],["tooltip-position","above","matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["class","spatialSelector",4,"ngIf"],["class","singleInput",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[1,"igo-layer-button-group"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","delete"],["class","snrc",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[4,"ngIf"],["class","dualInput",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[3,"datasource","currentFilter","changeProperty",4,"ngIf"],[1,"field",3,"floatLabel","mouseenter","mouseleave"],["matInput","","tooltip-position","above","matTooltipShowDelay","500",3,"placeholder","disabled","matAutocomplete","value","matTooltip","input"],[3,"optionSelected"],["autoCompleteField","matAutocomplete"],["matTooltipShowDelay","500",3,"value","id","matTooltip",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"disabled","click",4,"ngIf"],["matTooltipShowDelay","500",3,"value","id","matTooltip"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"disabled","click"],["svgIcon","close"],[1,"spatialSelector"],[3,"disabled","value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"singleInput",3,"floatLabel","mouseenter","mouseleave"],["autoCompleteValues","matAutocomplete"],["matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["matTooltipShowDelay","500",3,"value","matTooltip"],[1,"snrc",3,"floatLabel","mouseenter","mouseleave"],["matInput","","tooltip-position","above","matTooltipShowDelay","500",3,"placeholder","value","matTooltip","input"],["matSuffix","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click",4,"ngIf"],["matSuffix","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click"],["svgIcon","arrow-expand-all"],[1,"dualInput",3,"floatLabel","mouseenter","mouseleave"],["matInput","","type","number",3,"placeholder","disabled","matAutocomplete","value","input"],["autoDualValueOperator1","matAutocomplete"],["autoDualValueOperator2","matAutocomplete"],[3,"datasource","currentFilter","changeProperty"]],template:function(i,n){1&i&&(e.I0R(0,"div",0)(1,"mat-checkbox",1),e.qCj("click",function(v){return v.stopPropagation()})("change",function(v){return n.toggleFilterState(v)}),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"mat-form-field",2)(4,"mat-select",3),e.qCj("selectionChange",function(v){return n.changeLogical(v.value)}),e.wVc(5,"translate"),e.I0R(6,"mat-option",4),e.wVc(7,"translate"),e.OEk(8),e.wVc(9,"translate"),e.C$Y(),e.I0R(10,"mat-option",4),e.wVc(11,"translate"),e.OEk(12),e.wVc(13,"translate"),e.C$Y()()(),e.yuY(14,ln,13,22,"mat-form-field",5),e.wVc(15,"async"),e.wVc(16,"async"),e.wVc(17,"async"),e.wVc(18,"async"),e.I0R(19,"mat-form-field",6),e.wVc(20,"async"),e.wVc(21,"async"),e.I0R(22,"mat-select",7),e.qCj("selectionChange",function(v){return n.changeOperator(v.value)}),e.wVc(23,"translate"),e.wVc(24,"translate"),e.yuY(25,Vi,4,7,"mat-option",8),e.wVc(26,"keyvalue"),e.wVc(27,"async"),e.C$Y()(),e.yuY(28,cn,3,3,"mat-form-field",9),e.wVc(29,"async"),e.yuY(30,kn,8,12,"mat-form-field",10),e.I0R(31,"div",11)(32,"button",12),e.qCj("click",function(){return n.deleteFilter()}),e.wVc(33,"translate"),e.wR5(34,"mat-icon",13),e.C$Y()(),e.yuY(35,pn,4,7,"mat-form-field",14),e.wVc(36,"async"),e.yuY(37,oi,2,1,"ng-container",15),e.wVc(38,"async"),e.C$Y(),e.I0R(39,"div",0),e.yuY(40,hn,8,11,"mat-form-field",16)(41,_n,8,11,"mat-form-field",16),e.C$Y(),e.yuY(42,ji,1,2,"igo-ogc-filter-time",17)),2&i&&(e.yG2(),e.E7m("matTooltip",e.kDX(2,27,"igo.geo.filter.toggleFilterState"))("checked",n.currentFilter.active),e.yG2(2),e.E7m("ngClass",e.IBC(67,ii,0!==n.activeFilters.indexOf(n.currentFilter)&&!0===n.currentFilter.active,0===n.activeFilters.indexOf(n.currentFilter)||!0!==n.currentFilter.active)),e.yG2(),e.E7m("disabled",!n.currentFilter.active)("value",n.currentFilter.parentLogical)("matTooltip",n.currentFilter.parentLogical?e.kDX(5,29,"igo.geo.operators.tooltip."+n.currentFilter.parentLogical):""),e.yG2(2),e.E7m("value",n.ogcFilterOperator.And)("matTooltip",e.kDX(7,31,"igo.geo.operators.tooltip.And")),e.yG2(2),e.oRS(" ",e.kDX(9,33,"igo.geo.operators.And")," "),e.yG2(2),e.E7m("value",n.ogcFilterOperator.Or)("matTooltip",e.kDX(11,35,"igo.geo.operators.tooltip.Or")),e.yG2(2),e.oRS(" ",e.kDX(13,37,"igo.geo.operators.Or")," "),e.yG2(2),e.E7m("ngIf",!1===e.kDX(15,39,n.currentFilterIsSpatial$)&&e.kDX(16,41,n.fields$)&&e.kDX(17,43,n.fields$).length>0&&""!==e.kDX(18,45,n.fields$)[0].name),e.yG2(5),e.E7m("ngClass",e.IBC(70,Cn,!1===e.kDX(20,47,n.currentFilterIsSpatial$),e.kDX(21,49,n.currentFilterIsSpatial$)))("floatLabel",n.floatLabel),e.yG2(3),e.E7m("matTooltip",n.currentFilter.operator?e.kDX(23,51,"igo.geo.operators.tooltip."+n.currentFilter.operator):e.kDX(24,53,"igo.geo.filter.selectOperator"))("disabled",!n.currentFilter.active)("value",n.currentFilter.operator),e.yG2(3),e.E7m("ngForOf",e.kDX(26,55,e.kDX(27,57,n.ogcFilterOperators$))),e.yG2(3),e.E7m("ngIf",e.kDX(29,59,n.currentFilterIsSpatial$)),e.yG2(2),e.E7m("ngIf",-1!==e.q4q(73,Oi).indexOf(n.detectProperty())),e.yG2(2),e.E7m("matTooltip",e.kDX(33,61,"igo.geo.filter.removeFilter")),e.yG2(3),e.E7m("ngIf",e.kDX(36,63,n.currentFilterIsSpatial$)&&"snrc"===n.currentFilter.igoSpatialSelector),e.yG2(2),e.E7m("ngIf",e.kDX(38,65,n.currentFilterIsSpatial$)&&"fixedExtent"===n.currentFilter.igoSpatialSelector),e.yG2(3),e.E7m("ngIf",!n.isTemporalOperator()&&-1!==e.q4q(74,Bn).indexOf(n.detectProperty(1))),e.yG2(),e.E7m("ngIf",!n.isTemporalOperator()&&-1!==e.q4q(75,Un).indexOf(n.detectProperty(2))),e.yG2(),e.E7m("ngIf",n.isTemporalOperator()))},dependencies:[Lt.Vn,Lt.WK,st.KO,st.a4,ft.wb,ft.Up,ft.Gm,Xe.QF,At.d5,At.kX,Gt.I5,Gt.Ax,Xe.u_,Yt.cN,Yt.yi,_o.U1,_o.e,_o.cG,Xe.Iw,ct.oJ,ct.um,tt.oB,tt.qL,gi,Xe.a,Xe.uq,it.O0,it.sD],styles:["[_nghost-%COMP%]{width:100%;padding:5px 10px}[_nghost-%COMP%]     .mat-mdc-form-field .mat-icon svg{width:1em;height:1em;color:#d3d3d3}[_nghost-%COMP%]   .ogc-filter-form-container[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-mdc-select-arrow[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   .logical[_ngcontent-%COMP%]{flex-flow:column nowrap;width:100%;max-width:60px;margin-right:5px}[_nghost-%COMP%]   .logicalHidden[_ngcontent-%COMP%]{width:0px;visibility:hidden;max-width:0px}[_nghost-%COMP%]     .logical .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]     .logicalHidden .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .field[_ngcontent-%COMP%]{width:150px;margin-right:5px}[_nghost-%COMP%]     .field .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .operator[_ngcontent-%COMP%]{width:150px;margin-right:5px;text-align:center}[_nghost-%COMP%]     .operator .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .spatialSelector[_ngcontent-%COMP%]{width:110px;margin-right:5px}[_nghost-%COMP%]     .spatialSelector .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .singleInput[_ngcontent-%COMP%]{width:150px;margin-right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .singleInput[_ngcontent-%COMP%]{width:27%}}[_nghost-%COMP%]   .snrc[_ngcontent-%COMP%]{width:110px;margin-right:5px}[_nghost-%COMP%]     .singleInput .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .dualInput[_ngcontent-%COMP%]{width:150px;margin-right:5px}[_nghost-%COMP%]     .dualInput .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]{display:flex;padding-top:5px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{display:flex}"]})}return l})();var Ki=s(35392),ro=s(24296),Mo=s(21232),vo=s(24112);const er=["selection"];function Yn(l,m){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS("",t.title," ")}}function fi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",10)(1,"mat-form-field")(2,"mat-select",11),e.iHE("valueChange",function(n){e.usT(t);const p=e.GaO(3);return e.kNx(p.currentPushButtonsGroup,n)||(p.currentPushButtonsGroup=n),e.CGJ(n)}),e.wVc(3,"translate"),e.yuY(4,Yn,2,2,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("value",t.currentPushButtonsGroup),e.yG2(2),e.E7m("ngForOf",t.getPushButtonsGroups())}}function yi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-button-toggle",16),e.qCj("change",function(){const p=e.usT(t).$implicit,v=e.GaO(3).$implicit,k=e.GaO();return e.CGJ(k.onSelectionChange(p,v.selectorType))}),e.OEk(1),e.C$Y()}if(2&l){const t=m.$implicit,i=e.GaO(4);e.E7m("matTooltip",i.getToolTip(t))("ngStyle",i.getButtonColor(t))("checked",t.enabled)("value",t),e.yG2(),e.oRS("",t.title," ")}}function Ti(l,m){if(1&l&&(e.SAx(0),e.I0R(1,"h3"),e.OEk(2),e.C$Y(),e.I0R(3,"mat-button-toggle-group",14),e.yuY(4,yi,2,5,"mat-button-toggle",15),e.C$Y(),e.k70()),2&l){const t=m.$implicit,i=e.GaO(3);e.yG2(2),e.cNF(t.title),e.yG2(),e._6D("vertical",i.bundleIsVertical(t)),e.yG2(),e.E7m("ngForOf",t.selectors)}}function vn(l,m){if(1&l&&(e.I0R(0,"div",8),e.wR5(1,"mat-divider"),e.yuY(2,fi,5,5,"div",9)(3,Ti,5,3,"ng-container",1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(2),e.E7m("ngIf",t.getPushButtonsGroups().length>1),e.yG2(),e.E7m("ngForOf",t.currentPushButtonsGroup.computedSelectors)}}function Wi(l,m){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS("",t.title," ")}}function Ei(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",10)(1,"mat-form-field")(2,"mat-select",18),e.iHE("valueChange",function(n){e.usT(t);const p=e.GaO(3);return e.kNx(p.currentCheckboxesGroup,n)||(p.currentCheckboxesGroup=n),e.CGJ(n)}),e.wVc(3,"translate"),e.yuY(4,Wi,2,2,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("value",t.currentCheckboxesGroup),e.yG2(2),e.E7m("ngForOf",t.getCheckboxesGroups())}}function Ni(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-checkbox",21),e.qCj("change",function(){const p=e.usT(t).$implicit,v=e.GaO(3).$implicit,k=e.GaO();return e.CGJ(k.onSelectionChange(p,v.selectorType))}),e.OEk(1),e.C$Y()}if(2&l){const t=m.$implicit,i=e.GaO(4);e.E7m("matTooltip",i.getToolTip(t))("checked",t.enabled)("value",t),e.yG2(),e.oRS("",t.title," ")}}function xi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"u",24),e.qCj("click",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.displayLessResults("checkbox"))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}2&l&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.geo.filter.displayLessResults")," "))}function Hi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"u",25),e.qCj("click",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.displayMoreResults("checkbox"))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}2&l&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.geo.filter.displayMoreResults")," "))}function Mi(l,m){if(1&l&&(e.I0R(0,"p"),e.yuY(1,xi,3,3,"u",22)(2,Hi,3,3,"u",23),e.C$Y()),2&l){const t=e.GaO().$implicit,i=e.GaO(3);e.yG2(),e.E7m("ngIf",i.isLessResults(t,"checkbox")),e.yG2(),e.E7m("ngIf",i.isMoreResults(t,"checkbox"))}}function tr(l,m){if(1&l&&(e.SAx(0),e.I0R(1,"h3"),e.OEk(2),e.C$Y(),e.I0R(3,"div",19),e.yuY(4,Ni,2,4,"mat-checkbox",20),e.C$Y(),e.yuY(5,Mi,3,2,"p",2),e.k70()),2&l){const t=m.$implicit,i=e.GaO(3);e.yG2(2),e.cNF(t.title),e.yG2(2),e.E7m("ngForOf",t.selectors),e.yG2(),e.E7m("ngIf",i.isLessResults(t,"checkbox")||i.isMoreResults(t,"checkbox"))}}function zi(l,m){if(1&l&&(e.I0R(0,"div",17),e.wR5(1,"mat-divider"),e.yuY(2,Ei,5,5,"div",9)(3,tr,6,3,"ng-container",1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(2),e.E7m("ngIf",t.getCheckboxesGroups().length>1),e.yG2(),e.E7m("ngForOf",t.currentCheckboxesGroup.computedSelectors)}}function Vn(l,m){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS("",t.title," ")}}function ne(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",10)(1,"mat-form-field")(2,"mat-select",27),e.iHE("valueChange",function(n){e.usT(t);const p=e.GaO(3);return e.kNx(p.currentRadioButtonsGroup,n)||(p.currentRadioButtonsGroup=n),e.CGJ(n)}),e.wVc(3,"translate"),e.yuY(4,Vn,2,2,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("value",t.currentRadioButtonsGroup),e.yG2(2),e.E7m("ngForOf",t.getRadioButtonsGroups())}}function Ye(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-radio-button",30),e.qCj("change",function(){e.usT(t);const n=e.GaO(4);return e.CGJ(n.emptyRadioButtons())}),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()}2&l&&(e.E7m("matTooltip",e.kDX(1,2,"igo.geo.filter.resetFilters")),e.yG2(2),e.oRS("",e.kDX(3,4,"igo.geo.filter.resetFilters")," "))}function f(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-radio-button",21),e.qCj("change",function(){const p=e.usT(t).$implicit,v=e.GaO(3).$implicit,k=e.GaO();return e.CGJ(k.onSelectionChange(p,v.selectorType))}),e.OEk(1),e.C$Y()}if(2&l){const t=m.$implicit,i=e.GaO(4);e.E7m("matTooltip",i.getToolTip(t))("checked",t.enabled)("value",t),e.yG2(),e.oRS("",t.title," ")}}function H(l,m){if(1&l){const t=e.KQA();e.I0R(0,"u",24),e.qCj("click",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.displayLessResults("radio"))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}2&l&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.geo.filter.displayLessResults")," "))}function Z(l,m){if(1&l){const t=e.KQA();e.I0R(0,"u",25),e.qCj("click",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.displayMoreResults("radio"))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}2&l&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.geo.filter.displayMoreResults")," "))}function _e(l,m){if(1&l&&(e.I0R(0,"p"),e.yuY(1,H,3,3,"u",22)(2,Z,3,3,"u",23),e.C$Y()),2&l){const t=e.GaO().$implicit,i=e.GaO(3);e.yG2(),e.E7m("ngIf",i.isLessResults(t,"radio")),e.yG2(),e.E7m("ngIf",i.isMoreResults(t,"radio"))}}function we(l,m){if(1&l&&(e.SAx(0),e.I0R(1,"h3"),e.OEk(2),e.C$Y(),e.I0R(3,"mat-radio-group",28),e.yuY(4,Ye,4,6,"mat-radio-button",29)(5,f,2,4,"mat-radio-button",20)(6,_e,3,2,"p",2),e.C$Y(),e.k70()),2&l){const t=m.$implicit,i=e.GaO(3);e.yG2(2),e.cNF(t.title),e.yG2(2),e.E7m("ngIf",t.unfiltered),e.yG2(),e.E7m("ngForOf",t.selectors),e.yG2(),e.E7m("ngIf",i.isLessResults(t,"radio")||i.isMoreResults(t,"radio"))}}function We(l,m){if(1&l&&(e.I0R(0,"div",26),e.wR5(1,"mat-divider"),e.yuY(2,ne,5,5,"div",9)(3,we,7,4,"ng-container",1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(2),e.E7m("ngIf",t.getRadioButtonsGroups().length>1),e.yG2(),e.E7m("ngForOf",t.currentRadioButtonsGroup.computedSelectors)}}function gt(l,m){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS("",t.title," ")}}function Ot(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",10)(1,"mat-form-field")(2,"mat-select",32),e.iHE("valueChange",function(n){e.usT(t);const p=e.GaO(3);return e.kNx(p.currentSelectGroup,n)||(p.currentSelectGroup=n),e.CGJ(n)}),e.wVc(3,"translate"),e.yuY(4,gt,2,2,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("value",t.currentSelectGroup),e.yG2(2),e.E7m("ngForOf",t.getSelectGroups())}}function lt(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-button",36),e.qCj("click",function(){e.usT(t);const n=e.GaO(4);return e.CGJ(n.emptySelect())}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",37),e.C$Y()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.filter.resetFilters"))}const kt=()=>({standalone:!0});function Pt(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-checkbox",42),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(5);return e.kNx(p.selectAllSelected,n)||(p.selectAllSelected=n),e.CGJ(n)}),e.qCj("change",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.toggleAllSelection())}),e.OEk(1,"Tous "),e.C$Y()}if(2&l){const t=e.GaO(5);e.OKB("ngModel",t.selectAllSelected),e.E7m("ngModelOptions",e.q4q(2,kt))}}function no(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-option",43),e.qCj("onSelectionChange",function(n){e.usT(t);const p=e.GaO(2).$implicit,v=e.GaO(3);return e.CGJ(v.selectOptionClick(n.source.value,p,n))}),e.OEk(1),e.C$Y()}if(2&l){const t=m.$implicit,i=e.GaO(5);e.E7m("matTooltip",i.getToolTip(t))("value",t),e.yG2(),e.oRS("",t.title," ")}}function Xt(l,m){if(1&l&&(e.I0R(0,"div")(1,"mat-select",38,39)(3,"div",19),e.yuY(4,Pt,2,3,"mat-checkbox",40),e.C$Y(),e.yuY(5,no,2,3,"mat-option",41),e.C$Y()()),2&l){const t=e.GaO().$implicit;e.yG2(),e.E7m("multiple",t.multiple)("placeholder",t.title),e.yG2(3),e.E7m("ngIf",t.multiple),e.yG2(),e.E7m("ngForOf",t.selectors)}}function Fo(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-option",43),e.qCj("onSelectionChange",function(n){e.usT(t);const p=e.GaO(2).$implicit,v=e.GaO(3);return e.CGJ(v.selectOptionClick(n.source.value,p))}),e.OEk(1),e.C$Y()}if(2&l){const t=m.$implicit,i=e.GaO(5);e.E7m("matTooltip",i.getToolTip(t))("value",t),e.yG2(),e.oRS("",t.title," ")}}function No(l,m){if(1&l&&(e.I0R(0,"mat-select",44),e.yuY(1,Fo,2,3,"mat-option",41),e.C$Y()),2&l){const t=e.GaO().$implicit;e.E7m("placeholder",t.title),e.yG2(),e.E7m("ngForOf",t.selectors)}}function Sn(l,m){if(1&l&&(e.SAx(0),e.I0R(1,"h3"),e.OEk(2),e.C$Y(),e.I0R(3,"div",10),e.yuY(4,lt,3,3,"mat-button",33),e.I0R(5,"mat-form-field"),e.yuY(6,Xt,6,4,"div",34)(7,No,2,2,"ng-template",null,35,e.gJz),e.C$Y()(),e.k70()),2&l){const t=m.$implicit,i=e.Gew(8);e.yG2(2),e.cNF(t.title),e.yG2(2),e.E7m("ngIf",t.unfiltered&&!t.multiple),e.yG2(),e.m4B("width",t.width?t.width:void 0,"%"),e.yG2(),e.E7m("ngIf",t.multiple)("ngIfElse",i)}}function _i(l,m){if(1&l&&(e.I0R(0,"div",31),e.wR5(1,"mat-divider"),e.yuY(2,Ot,5,5,"div",9)(3,Sn,9,6,"ng-container",1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(2),e.E7m("ngIf",t.getSelectGroups().length>1),e.yG2(),e.E7m("ngForOf",t.currentSelectGroup.computedSelectors)}}function bn(l,m){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS("",t.title," ")}}function jn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",10)(1,"mat-form-field")(2,"mat-select",46),e.iHE("valueChange",function(n){e.usT(t);const p=e.GaO(3);return e.kNx(p.currentAutocompleteGroup,n)||(p.currentAutocompleteGroup=n),e.CGJ(n)}),e.wVc(3,"translate"),e.yuY(4,bn,2,2,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("value",t.currentAutocompleteGroup),e.yG2(2),e.E7m("ngForOf",t.getAutocompleteGroups())}}function Kn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-button",36),e.qCj("click",function(){e.usT(t);const n=e.GaO(4);return e.CGJ(n.emptyAutocomplete())}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",37),e.C$Y()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.filter.resetFilters"))}function Di(l,m){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t.value," ")}}function wn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field"),e.wR5(1,"input",48,49),e.I0R(3,"mat-autocomplete",50,51),e.qCj("optionSelected",function(n){e.usT(t);const p=e.GaO(4);return e.CGJ(p.autocompleteOptionClick(n.option.value))}),e.yuY(6,Di,2,2,"mat-option",12),e.wVc(7,"async"),e.C$Y()()}if(2&l){const t=e.Gew(4),i=e.GaO().$implicit,n=e.GaO(3);e.m4B("width",i.width?i.width:void 0,"%"),e.yG2(),e.E7m("matAutocomplete",t)("placeholder",i.title),e.yG2(2),e.E7m("displayWith",n.displayFn),e.yG2(3),e.E7m("ngForOf",e.kDX(7,6,n.filteredOgcAutocomplete[i.id]))}}function Xi(l,m){if(1&l&&(e.SAx(0),e.I0R(1,"h3"),e.OEk(2),e.C$Y(),e.I0R(3,"div",10),e.yuY(4,Kn,3,3,"mat-button",33)(5,wn,8,8,"mat-form-field",47),e.C$Y(),e.k70()),2&l){const t=m.$implicit,i=e.GaO(3);e.yG2(2),e.cNF(t.title),e.yG2(2),e.E7m("ngIf",t.unfiltered),e.yG2(),e.E7m("ngIf",i.filteredOgcAutocomplete[t.id])}}function Wn(l,m){if(1&l&&(e.I0R(0,"div",45),e.wR5(1,"mat-divider"),e.yuY(2,jn,5,5,"div",9)(3,Xi,6,3,"ng-container",1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(2),e.E7m("ngIf",t.getAutocompleteGroups().length>1),e.yG2(),e.E7m("ngForOf",t.currentAutocompleteGroup.computedSelectors)}}function On(l,m){if(1&l&&(e.I0R(0,"div"),e.yuY(1,vn,4,2,"div",3)(2,zi,4,2,"div",4)(3,We,4,2,"div",5)(4,_i,4,2,"div",6)(5,Wn,4,2,"div",7),e.C$Y()),2&l){const t=m.$implicit;e.yG2(),e.E7m("ngIf","pushButton"===t.selectorType),e.yG2(),e.E7m("ngIf","checkbox"===t.selectorType),e.yG2(),e.E7m("ngIf","radioButton"===t.selectorType),e.yG2(),e.E7m("ngIf","select"===t.selectorType),e.yG2(),e.E7m("ngIf","autocomplete"===t.selectorType)}}function $o(l,m){1&l&&(e.I0R(0,"h3"),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.filter.reportingDate")," "))}function ho(l,m){if(1&l&&(e.I0R(0,"h3"),e.OEk(1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(),e.cNF(t.currentFilter.title)}}function lo(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div"),e.wR5(1,"mat-divider"),e.yuY(2,$o,3,3,"h3",2)(3,ho,2,1,"h3",2),e.I0R(4,"igo-ogc-filter-time",52),e.qCj("changeProperty",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeProperty(n.value,n.pos))}),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(2),e.E7m("ngIf",!t.currentFilter.title),e.yG2(),e.E7m("ngIf",t.currentFilter.title),e.yG2(),e.E7m("datasource",t.datasource)("currentFilter",t.currentFilter)}}let In=(()=>{class l{ogcFilterService;formBuilder;domService;configService;cdRef;sel;refreshFilters;datasource;map;checkboxesIndex=5;radioButtonsIndex=5;baseIndex=5;get currentFilter(){return this._currentFilter}set currentFilter(t){this._currentFilter=t,this._currentFilter?.sliderOptions&&(this._currentFilter.sliderOptions.enabled=!1)}_currentFilter;ogcFilterOperator=Bt.e;form;ogcFilterWriter;color="primary";selectAllSelected=!1;selectEnabled$=new A.g(void 0);selectEnableds$=new A.g([]);autocompleteEnabled$=new A.g(void 0);filteredOgcAutocomplete={};applyFiltersTimeout;get ogcFiltersSelectors(){const t=[];return this.datasource?.options?.ogcFilters?.pushButtons&&t.push(this.datasource?.options?.ogcFilters?.pushButtons),this.datasource?.options?.ogcFilters?.checkboxes&&t.push(this.datasource?.options?.ogcFilters?.checkboxes),this.datasource?.options?.ogcFilters?.radioButtons&&t.push(this.datasource?.options?.ogcFilters?.radioButtons),this.datasource?.options?.ogcFilters?.select&&t.push(this.datasource?.options?.ogcFilters?.select),this.datasource?.options?.ogcFilters?.autocomplete&&t.push(this.datasource?.options?.ogcFilters?.autocomplete),t.sort((i,n)=>i.order<n.order?-1:i.order>n.order?1:0),t}get currentPushButtonsGroup(){return this.form.get("pushButtonsGroup").value}set currentPushButtonsGroup(t){this.form.patchValue({pushButtonsGroup:t})}get currentCheckboxesGroup(){return this.form.get("checkboxesGroup").value}set currentCheckboxesGroup(t){this.form.patchValue({checkboxesGroup:t})}get currentRadioButtonsGroup(){return this.form.get("radioButtonsGroup").value}set currentRadioButtonsGroup(t){this.form.patchValue({radioButtonsGroup:t})}get currentSelectGroup(){return this.form.get("selectGroup").value}set currentSelectGroup(t){this.form.patchValue({selectGroup:t}),this.cdRef.detectChanges()}get currentAutocompleteGroup(){return this.form.get("autocompleteGroup").value}set currentAutocompleteGroup(t){this.form.patchValue({autocompleteGroup:t}),this.cdRef.detectChanges()}get selectEnabled(){return this.selectEnabled$.value}set selectEnabled(t){this.selectEnabled$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentSelectGroup.computedSelectors.forEach(i=>{i.selectors?.forEach(n=>{n.enabled=t===n})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}get selectEnableds(){return this.selectEnableds$.value}set selectEnableds(t){this.selectEnableds$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentSelectGroup.computedSelectors.forEach(i=>{i.selectors?.forEach(n=>{n.enabled=!!t.includes(n)})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}get autocompleteEnabled(){return this.autocompleteEnabled$.value}set autocompleteEnabled(t){this.autocompleteEnabled$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentAutocompleteGroup.computedSelectors.forEach(i=>{i.selectors?.forEach(n=>{n.enabled=t===n.title})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}constructor(t,i,n,p,v){this.ogcFilterService=t,this.formBuilder=i,this.domService=n,this.configService=p,this.cdRef=v,this.ogcFilterWriter=new eo.S,this.buildForm()}buildForm(){this.form=this.formBuilder.group({pushButtons:["",[Me.AQ.required]],radioButtons:["",[Me.AQ.required]],pushButtonsGroup:["",[Me.AQ.required]],checkboxesGroup:["",[Me.AQ.required]],radioButtonsGroup:["",[Me.AQ.required]],selectGroup:["",[Me.AQ.required]],select:["",[Me.AQ.required]],selectMulti:["",[Me.AQ.required]],autocompleteGroup:["",[Me.AQ.required]],autocomplete:["",[Me.AQ.required]]})}getPushButtonsGroups(){if(this.datasource?.options?.ogcFilters?.pushButtons)return this.datasource.options.ogcFilters.pushButtons.groups}getCheckboxesGroups(){if(this.datasource?.options?.ogcFilters?.checkboxes)return this.datasource.options.ogcFilters.checkboxes.groups}getRadioButtonsGroups(){if(this.datasource?.options?.ogcFilters?.radioButtons)return this.datasource.options.ogcFilters.radioButtons.groups}getSelectGroups(){if(this.datasource?.options?.ogcFilters?.select)return this.datasource.options.ogcFilters.select.groups}getAutocompleteGroups(){if(this.datasource?.options?.ogcFilters?.autocomplete)return this.datasource.options.ogcFilters.autocomplete.groups}ngOnInit(){var t=this;return(0,Ki.c)(function*(){t.datasource.options.ogcFilters&&(t.datasource.options.ogcFilters.pushButtons&&(t.currentPushButtonsGroup=t.datasource.options.ogcFilters.pushButtons.groups.find(i=>i.enabled)||t.datasource.options.ogcFilters.pushButtons.groups[0]),t.datasource.options.ogcFilters.checkboxes&&(t.currentCheckboxesGroup=t.datasource.options.ogcFilters.checkboxes.groups.find(i=>i.enabled)||t.datasource.options.ogcFilters.checkboxes.groups[0]),t.datasource.options.ogcFilters.radioButtons&&(t.currentRadioButtonsGroup=t.datasource.options.ogcFilters.radioButtons.groups.find(i=>i.enabled)||t.datasource.options.ogcFilters.radioButtons.groups[0]),t.datasource.options.ogcFilters.select&&(t.currentSelectGroup=t.datasource.options.ogcFilters.select.groups.find(i=>i.enabled)||t.datasource.options.ogcFilters.select.groups[0],t.getSelectEnabled(),yield t.getSelectDomValues()),t.datasource.options.ogcFilters.autocomplete&&(t.currentAutocompleteGroup=t.datasource.options.ogcFilters.autocomplete.groups.find(i=>i.enabled)||t.datasource.options.ogcFilters.autocomplete.groups[0],t.getAutocompleteEnabled(),yield t.getAutocompleteDomValues()),t.applyFilters()),t.form.get("pushButtonsGroup").valueChanges.pipe((0,vo.o)(750)).subscribe(()=>{t.onPushButtonsChangeGroup(),t.applyFilters()}),t.form.get("checkboxesGroup").valueChanges.pipe((0,vo.o)(750)).subscribe(()=>{t.onCheckboxesChangeGroup(),t.applyFilters()}),t.form.get("radioButtonsGroup").valueChanges.pipe((0,vo.o)(750)).subscribe(()=>{t.onRadioButtonsChangeGroup(),t.applyFilters()}),t.form.get("selectGroup").valueChanges.pipe((0,vo.o)(750)).subscribe(()=>{t.onSelectChangeGroup(),t.applyFilters()}),t.form.get("autocompleteGroup").valueChanges.pipe((0,vo.o)(750)).subscribe(()=>{t.onAutocompleteChangeGroup(),t.applyFilters()}),t.form.get("pushButtons").valueChanges.pipe((0,vo.o)(750)).subscribe(()=>{t.applyFilters()}),t.form.get("radioButtons").valueChanges.pipe((0,vo.o)(750)).subscribe(()=>{t.applyFilters()})})()}getSelectEnabled(){const t=[];let i;this.currentSelectGroup.computedSelectors.forEach(n=>{n.multiple?(n.selectors?.forEach(p=>{p.enabled&&t.push(p)}),this.selectEnableds=t,this.form.controls.selectMulti.setValue(t)):(n.selectors?.forEach(p=>{p.enabled&&(i=p)}),this.form.controls.select.reset(i),this.selectEnabled$.subscribe(p=>{this.form.controls.select.value!==p&&this.form.controls.select.setValue(p)}),this.selectEnabled=i)})}getAutocompleteEnabled(){let t;this.currentAutocompleteGroup.computedSelectors.forEach(i=>{i.selectors?.forEach(n=>{n.enabled&&(t=n.title,this.form.controls.autocomplete.setValue({id:n.filters.expression,value:n.title}))}),this.autocompleteEnabled=t})}getToolTip(t){let i;return t.tooltip&&(i=Array.isArray(t.tooltip)?t.tooltip.join("\n"):t.tooltip),i||""}getSelectDomValues(){var t=this;return(0,Ki.c)(function*(){for(const i of t.datasource.options.ogcFilters.select.bundles)if(i.domSelectors){let n;for(const p of i.domSelectors){let v;for(const k of t.configService.getConfig("dom"))(p.id===k.id||p.name===k.name)&&(v={id:k.id,url:k.url,name:k.name,values:k.values});if(n=v.url?yield t.domService.getDom(v):v.values,n){let de,k=i;k.selectors=[];for(const he of n){if(i.multiple){let Oe;Oe=!!t.selectEnableds?.find(be=>be.title===he.value),de={title:he.value,enabled:Oe,filters:{operator:p.operator,propertyName:p.propertyName,expression:he.id}}}else de={title:he.value,enabled:t.selectEnabled?.title===he.value,filters:{operator:p.operator,propertyName:p.propertyName,expression:he.id}};k.selectors.push(de)}t.getSelectGroups().find(he=>he.ids.includes(k.id)).computedSelectors.find(he=>he.title===k.title).selectors=k.selectors}}t.getSelectEnabled()}})()}getAutocompleteDomValues(){var t=this;return(0,Ki.c)(function*(){for(const i of t.datasource.options.ogcFilters.autocomplete.bundles)if(i.domSelectors){let n;for(const p of i.domSelectors){let v;for(const k of t.configService.getConfig("dom"))(p.id===k.id||p.name===k.name)&&(v={id:k.id,url:k.url,name:k.name,values:k.values});if(n=v.url?yield t.domService.getDom(v):v.values,n){let de,k=i;k.selectors=[];for(const he of n)de={title:he.value,enabled:!(!t.autocompleteEnabled||t.autocompleteEnabled!==he.value),filters:{operator:p.operator,propertyName:p.propertyName,expression:he.id}},k.selectors.push(de);t.getAutocompleteGroups().find(he=>he.ids.includes(k.id)).computedSelectors.find(he=>he.title===k.title).selectors=k.selectors}}t.filteredOgcAutocomplete[i.id]=new _._,t.cdRef.detectChanges(),t.filteredOgcAutocomplete[i.id]=t.form.controls.autocomplete.valueChanges.pipe((0,se.k)(p=>{if(p.length)return n?.filter(v=>{const k=p?p.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"";return v.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(k)})}))}})()}getButtonColor(t){let i;return t.color&&t.enabled&&(i={"background-color":`rgba(${t.color})`}),i}bundleIsVertical(t){return!!t.vertical&&t.vertical}onPushButtonsChangeGroup(){this.getPushButtonsGroups().map(t=>t.enabled=!1),this.getPushButtonsGroups().find(t=>t===this.currentPushButtonsGroup).enabled=!0}onCheckboxesChangeGroup(){this.getCheckboxesGroups().map(t=>t.enabled=!1),this.getCheckboxesGroups().find(t=>t===this.currentCheckboxesGroup).enabled=!0}onRadioButtonsChangeGroup(){this.getRadioButtonsGroups().map(t=>t.enabled=!1),this.getRadioButtonsGroups().find(t=>t===this.currentRadioButtonsGroup).enabled=!0}onSelectChangeGroup(){this.getSelectGroups().map(t=>t.enabled=!1),this.getSelectGroups().find(t=>t===this.currentSelectGroup).enabled=!0}onAutocompleteChangeGroup(){this.getAutocompleteGroups().map(t=>t.enabled=!1),this.getAutocompleteGroups().find(t=>t===this.currentAutocompleteGroup).enabled=!0}onSelectionChange(t,i){clearTimeout(this.applyFiltersTimeout),"radioButton"===i&&this.emptyRadioButtons(),t&&(t.enabled=!t.enabled),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}emptyRadioButtons(){this.currentRadioButtonsGroup.computedSelectors.forEach(t=>{t.selectors.map(i=>i.enabled=!1),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)})}emptySelect(){this.selectEnabled=void 0}emptyAutocomplete(){this.autocompleteEnabled=void 0,this.form.controls.autocomplete.setValue(""),this.form.controls.autocomplete.markAsUntouched()}toggleAllSelection(){if(this.selectAllSelected){const t=[];this.currentSelectGroup.computedSelectors.forEach(i=>{i.selectors?.forEach(n=>{t.push(n)})}),this.sel.options.forEach(i=>i.select()),this.selectEnableds=t}else this.sel.options.forEach(t=>t.deselect()),this.selectEnableds=[]}selectOptionClick(t,i,n){if(i.multiple){const p=this.selectEnableds;let v=!0;if(this.sel.options.forEach(k=>{k.selected||(v=!1)}),this.selectAllSelected=v,n.isUserInput)if(p.length){for(const k of p)if(k.title===t.title){if(k.enabled&&t.enabled){p.splice(p.indexOf(k),1),this.selectEnableds=p;break}}else if(p.indexOf(k)===p.length-1){p.push(t),this.selectEnableds=p;break}}else p.push(t),this.selectEnableds=p}else this.selectEnabled=t}autocompleteOptionClick(t){this.autocompleteEnabled=t.value}displayFn(t){return t?t.value:void 0}applyFilters(){let t="";const i=[],n=[this.currentPushButtonsGroup,this.currentCheckboxesGroup,this.currentRadioButtonsGroup,this.currentSelectGroup,this.currentAutocompleteGroup];for(const p of n)p.computedSelectors&&p.computedSelectors.map(v=>{const k=[];v.selectors?.filter(de=>!0===de.enabled).forEach(de=>k.push(de.filters)),k.length>=1&&i.push(1===k.length?k[0]:{logical:v.logical,filters:k})});this.isTemporalOperator()&&this._currentFilter.active&&i.push(this.datasource.options.ogcFilters.interfaceOgcFilters[0]),i.length>=1&&(t=this.ogcFilterWriter.buildFilter(1===i.length?i[0]:{logical:"And",filters:i})),"wms"===this.datasource.options.type&&this.ogcFilterService.filterByOgc(this.datasource,t),"wfs"===this.datasource.options.type&&this.datasource.ol.refresh(),this.datasource.setOgcFilters(this.datasource.options.ogcFilters,!0)}isMoreResults(t,i){let n=0;for(const v of t.selectors)n++;return n>("radio"===i?this.radioButtonsIndex:this.checkboxesIndex)}displayMoreResults(t){"radio"===t?this.radioButtonsIndex+=5:this.checkboxesIndex+=5}isLessResults(t,i){let n=0;for(const v of t.selectors)n++;return this.baseIndex!==("radio"===i?this.radioButtonsIndex:this.checkboxesIndex)&&n>this.baseIndex}displayLessResults(t){"radio"===t?this.radioButtonsIndex=this.baseIndex:this.checkboxesIndex=this.baseIndex}isTemporalOperator(){return this.currentFilter?.operator?.toLowerCase()===this.ogcFilterOperator.During.toLowerCase()}changeProperty(t,i,n=!0){const p=this.detectProperty(i);p&&(this.datasource.options.ogcFilters.interfaceOgcFilters.find(v=>v.filterid===this.currentFilter.filterid)[p]=t,n&&this.applyFilters())}detectProperty(t){switch(this.currentFilter.operator){case Bt.e.PropertyIsNotEqualTo:case Bt.e.PropertyIsEqualTo:case Bt.e.PropertyIsGreaterThan:case Bt.e.PropertyIsGreaterThanOrEqualTo:case Bt.e.PropertyIsLessThan:case Bt.e.PropertyIsLessThanOrEqualTo:return"expression";case Bt.e.PropertyIsLike:return"pattern";case Bt.e.PropertyIsBetween:return t&&1===t?"lowerBoundary":t&&2===t?"upperBoundary":void 0;case Bt.e.During:return t&&1===t?"begin":t&&2===t?"end":void 0;default:return}}static \u0275fac=function(i){return new(i||l)(e.GI1(uo),e.GI1(Me.KE),e.GI1(Ue.Mx),e.GI1(M.aW),e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter-selection"]],viewQuery:function(i,n){if(1&i&&e.CC$(er,5),2&i){let p;e.wto(p=e.Gqi())&&(n.sel=p.first)}},inputs:{refreshFilters:"refreshFilters",datasource:"datasource",map:"map",checkboxesIndex:"checkboxesIndex",radioButtonsIndex:"radioButtonsIndex",baseIndex:"baseIndex",currentFilter:"currentFilter"},standalone:!0,features:[e.M5G([Ue.Mx]),e.UHJ],decls:3,vars:3,consts:[[3,"formGroup"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","pushButtonGroups",4,"ngIf"],["class","checkboxGroups",4,"ngIf"],["class","radioButtonGroups",4,"ngIf"],["class","selectGroups",4,"ngIf"],["class","autocompleteGroups",4,"ngIf"],[1,"pushButtonGroups"],["class","groupsSelector",4,"ngIf"],[1,"groupsSelector"],["formControlName","pushButtonsGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","pushButtons","appearance","legacy","multiple","true",1,"mat-typography",3,"vertical"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","ngStyle","checked","value","change",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","ngStyle","checked","value","change"],[1,"checkboxGroups"],["formControlName","checkboxesGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[1,"checkboxes","mat-typography"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","checked","value","change",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","checked","value","change"],["class","lessResults mat-typography",3,"click",4,"ngIf"],["class","moreResults mat-typography",3,"click",4,"ngIf"],[1,"lessResults","mat-typography",3,"click"],[1,"moreResults","mat-typography",3,"click"],[1,"radioButtonGroups"],["formControlName","radioButtonsGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],["formControlName","radioButtons",1,"mat-typography"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","change",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","change"],[1,"selectGroups"],["formControlName","selectGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","click",4,"ngIf"],[4,"ngIf","ngIfElse"],["notMulti",""],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","click"],["svgIcon","filter-remove"],["formControlName","selectMulti",3,"multiple","placeholder"],["selection",""],[3,"ngModel","ngModelOptions","ngModelChange","change",4,"ngIf"],["tooltip-position","below","matTooltipDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","value","onSelectionChange",4,"ngFor","ngForOf"],[3,"ngModel","ngModelOptions","ngModelChange","change"],["tooltip-position","below","matTooltipDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","value","onSelectionChange"],["formControlName","select",3,"placeholder"],[1,"autocompleteGroups"],["formControlName","autocompleteGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[3,"width",4,"ngIf"],["matInput","","type","text","formControlName","autocomplete",1,"autocomplete",3,"matAutocomplete","placeholder"],["autocomplete",""],[3,"displayWith","optionSelected"],["auto","matAutocomplete","autocomplete",""],[3,"datasource","currentFilter","changeProperty"]],template:function(i,n){1&i&&(e.I0R(0,"form",0),e.yuY(1,On,6,5,"div",1),e.C$Y(),e.yuY(2,lo,5,4,"div",2)),2&i&&(e.E7m("formGroup",n.form),e.yG2(),e.E7m("ngForOf",n.ogcFiltersSelectors),e.yG2(),e.E7m("ngIf",n.isTemporalOperator()))},dependencies:[Me.y,Me.sz,Me.ot,Me.ue,Me.u,Me._G,Me.sl,Me.uW,Me.Wo,Xe.Iw,Xe.u_,Zt.U,Zt.k,ft.wb,ft.Up,At.d5,At.kX,Gt.I5,st.KO,st.a4,Gt.Ax,ro.ue,ro.gn,ro.KU,Xe.Qt,Lt.Vn,Lt.WK,Mo.yk,Mo.cv,Mo.cT,tt.oB,tt.qL,Yt.cN,Yt.yi,_o.U1,_o.e,_o.cG,gi,Xe.a,it.O0,it.sD],styles:["[_nghost-%COMP%]   .mat-button-toggle-group[_ngcontent-%COMP%]{margin:5px;flex-wrap:wrap;box-shadow:none!important;width:95%}[_nghost-%COMP%]   .checkboxes[_ngcontent-%COMP%]{flex-wrap:wrap;box-shadow:none}[_nghost-%COMP%]   .groupsSelector[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{display:inline-flex;border:1.5px solid black;border-radius:5px;margin:5px;white-space:normal;min-height:40px;height:auto;width:142px}[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]     .mat-button-toggle-label-content{line-height:unset;font-size:small;display:block}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:45%}}[_nghost-%COMP%]     .material-tooltip{white-space:pre-wrap}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%], [_nghost-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin:7px;width:95%;display:inline-flex;font-size:larger}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]     label, [_nghost-%COMP%]   mat-radio-button[_ngcontent-%COMP%]     label{white-space:normal}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{vertical-align:middle}[_nghost-%COMP%]   mat-button[_ngcontent-%COMP%]{padding-right:10px;cursor:pointer}[_nghost-%COMP%]   h3[_ngcontent-%COMP%]{margin:7px;text-align:left}[_nghost-%COMP%]   u[_ngcontent-%COMP%]{cursor:pointer;color:#00f;margin:5px}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{margin:unset}"]})}return l})();function or(l,m){if(1&l&&e.wR5(0,"igo-ogc-filter-selection",2),2&l){const t=e.GaO();e.E7m("refreshFilters",t.refreshFunc)("datasource",t.datasource)("map",t.map)("currentFilter",t.currentFilter)}}function ir(l,m){if(1&l&&e.wR5(0,"igo-ogc-filter-form",4),2&l){const t=m.$implicit,i=e.GaO(2);e.E7m("currentFilter",t)("refreshFilters",i.refreshFunc)("datasource",i.datasource)("map",i.map)}}function Nn(l,m){if(1&l&&e.yuY(0,ir,1,4,"ng-template",3),2&l){const t=e.GaO();e.E7m("ngForOf",t.datasource.options.ogcFilters.interfaceOgcFilters)}}let ee=(()=>{class l{datasource;map;refreshFilters;get refreshFunc(){return this.refreshFilters}get advancedOgcFilters(){if(this.datasource.options.ogcFilters)return this.datasource.options.ogcFilters.advancedOgcFilters}get currentFilter(){return this.datasource.options.ogcFilters.interfaceOgcFilters?this.datasource.options.ogcFilters.interfaceOgcFilters[0]:void 0}color="primary";constructor(){}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filterable-form"]],inputs:{datasource:"datasource",map:"map",refreshFilters:"refreshFilters"},standalone:!0,features:[e.M5G([{provide:At.kF,useValue:{overlayPanelClass:"igo-overlay-panel-width"}},{provide:_o.GE,useValue:{overlayPanelClass:"igo-overlay-panel-width"}}]),e.UHJ],decls:2,vars:2,consts:[["igoListItem","",3,"refreshFilters","datasource","map","currentFilter",4,"ngIf"],[4,"ngIf"],["igoListItem","",3,"refreshFilters","datasource","map","currentFilter"],["ngFor","",3,"ngForOf"],[3,"currentFilter","refreshFilters","datasource","map"]],template:function(i,n){1&i&&e.yuY(0,or,1,4,"igo-ogc-filter-selection",0)(1,Nn,1,1,null,1),2&i&&(e.E7m("ngIf",!n.advancedOgcFilters),e.yG2(),e.E7m("ngIf",n.advancedOgcFilters&&n.datasource.options.ogcFilters.editable))},dependencies:[Xe.u_,In,Ue.qU,Xe.Iw,Ii],styles:[".igo-overlay-panel-width{min-width:-moz-fit-content;min-width:fit-content}\n\n/*# sourceMappingURL=ogc-filterable-form.component.ts-angular-inline--1.css.map*/"]})}return l})();function De(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-icon",10),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleFiltersCollapsed())}),e.C$Y()}if(2&l){const t=e.GaO(),i=e.Gew(8);e.E7m("target",i)("collapsed",t.filtersCollapsed)}}const D=l=>({cursor:l});function te(l,m){if(1&l){const t=e.KQA();e.I0R(0,"span",11),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleLegendOnClick())}),e.OEk(1),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("ngStyle",e.S45(3,D,t.filtersCollapsed?"default":"pointer"))("matTooltip",t.layer.title),e.yG2(),e.oRS(" ",t.layer.title," ")}}function me(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",12),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.addFilterToSequence())}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",13),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("disabled",t.addFilterDisabled())("matTooltip",e.kDX(1,3,"igo.geo.filter.addFilter"))("color",t.color)}}const ke=l=>({disabled:l});function Qe(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",14),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.layer.visible=!n.layer.visible)}),e.wVc(1,"translate"),e.wVc(2,"translate"),e.wR5(3,"mat-icon",15),e.wVc(4,"async"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.kDX(1,4,"igo.geo.layer.hideLayer"):e.kDX(2,6,"igo.geo.layer.showLayer")),e.yG2(3),e.E7m("ngClass",e.S45(10,ke,!1===e.kDX(4,8,t.inResolutionRange$)))("svgIcon",t.layer.visible?"eye":"eye-off")}}function co(l,m){if(1&l&&e.wR5(0,"igo-layer-legend",19),2&l){const t=e.GaO(2);e.E7m("layer",t.layer)}}function ni(l,m){if(1&l&&(e.I0R(0,"div",16,17),e.yuY(2,co,1,1,"igo-layer-legend",18),e.wVc(3,"async"),e.C$Y()),2&l){const t=e.GaO();e.yG2(2),e.E7m("ngIf",e.kDX(3,1,t.showLegend$))}}function Ho(l,m){if(1&l){const t=e.KQA();e.I0R(0,"section",20),e.wR5(1,"mat-divider"),e.I0R(2,"mat-checkbox",21),e.qCj("change",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeOgcFilterType(n))}),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO();return e.kNx(p.datasource.options.ogcFilters.advancedOgcFilters,n)||(p.datasource.options.ogcFilters.advancedOgcFilters=n),e.CGJ(n)}),e.OEk(3),e.wVc(4,"translate"),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(2),e.OKB("ngModel",t.datasource.options.ogcFilters.advancedOgcFilters),e.yG2(),e.oRS(" ",e.kDX(4,2,"igo.geo.filter.advancedOgcFilters")," ")}}const Tn=l=>({"separate-item":l});let zo=(()=>{class l{ogcFilterService;color="primary";lastRunOgcFilter;defaultLogicalParent=Bt.e.And;hasActiveSpatialFilter=!1;filtersAreEditable=!0;filtersCollapsed=!0;hasSelector=!1;showLegend$=new A.g(!1);inResolutionRange$=new A.g(!0);resolution$$;ogcFilterWriter;layer;map;header=!0;get refreshFunc(){return this.refreshFilters.bind(this)}get datasource(){return this.layer.dataSource}constructor(t){this.ogcFilterService=t,this.ogcFilterWriter=new eo.S}ngOnInit(){this.layer.visible&&(this.filtersCollapsed=!1);const t=this.datasource.options.ogcFilters;switch((t.pushButtons&&t.pushButtons.bundles.length>0||t.checkboxes&&t.checkboxes.bundles.length>0||t.radioButtons&&t.radioButtons.bundles.length>0||t.select&&t.select.bundles.length>0||t.autocomplete&&t.autocomplete.bundles.length>0)&&(void 0===t.advancedOgcFilters&&(t.advancedOgcFilters=!1),this.hasSelector=!0),this.datasource.options.type){case"wms":this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);break;case"wfs":this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource)}t&&(t.interfaceOgcFilters&&(this.lastRunOgcFilter=JSON.parse(JSON.stringify(t.interfaceOgcFilters)),t.interfaceOgcFilters.filter(n=>n.wkt_geometry).length>=1&&(this.hasActiveSpatialFilter=!0)),this.filtersAreEditable=!!t.editable&&t.editable),this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.inResolutionRange$.next(this.layer.isInResolutionsRange)})}ngOnDestroy(){this.resolution$$.unsubscribe()}addFilterToSequence(){this.filtersCollapsed=!1;const i=this.datasource.options.ogcFilters.interfaceOgcFilters||[],n=0===i.length?0:i[i.length-1].level;let p="";const v=this.datasource.options.sourceFields.filter(be=>!be.excludeFromOgcFilters);let k;v.length>0&&(p=void 0===v[0].name?"":v[0].name);const de=this.datasource.options;de.fieldNameGeometry?k=de.fieldNameGeometry:this.datasource.options.paramsWFS&&this.datasource.options.paramsWFS.fieldNameGeometry&&(k=this.datasource.options.paramsWFS.fieldNameGeometry);const he=this.ogcFilterWriter.computeAllowedOperators(this.datasource.options.sourceFields,p,this.datasource.options.ogcFilters.allowedOperatorsType),Oe=Object.keys(he)[0];i.push(this.ogcFilterWriter.addInterfaceFilter({propertyName:p,operator:Oe,active:!0,igoSpatialSelector:"fixedExtent",srsName:this.map.projection},k,n,this.defaultLogicalParent)),this.datasource.options.ogcFilters.interfaceOgcFilters=i}refreshFilters(t){!0===t&&(this.lastRunOgcFilter=void 0);const i=this.datasource.options.ogcFilters,n=i.interfaceOgcFilters?i.interfaceOgcFilters.filter(p=>!0===p.active):[];if(0===n.length&&(i.filters=void 0,i.filtered=!1),n.length>1&&(n[0].parentLogical=n[1].parentLogical),this.hasActiveSpatialFilter=0!==n.filter(p=>-1!==["Contains","Intersects","Within"].indexOf(p.operator)).length,JSON.stringify(this.lastRunOgcFilter)!==JSON.stringify(n)){if("wfs"===this.layer.dataSource.options.type)this.layer.dataSource.options.ogcFilters.filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(n),this.layer.dataSource.ol.refresh();else if("wms"===this.layer.dataSource.options.type&&i.enabled){let p="";if(n.length>=1){const v=this.layer.dataSource,k=v.options.ogcFilters;k.filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(n),p=this.ogcFilterWriter.buildFilter(k.filters,void 0,void 0,this.layer.dataSource.options.fieldNameGeometry,v.options)}this.ogcFilterService.filterByOgc(this.datasource,p),this.datasource.options.ogcFilters.filtered=0!==n.length}this.lastRunOgcFilter=JSON.parse(JSON.stringify(n))}this.layer.dataSource.setOgcFilters(i,!0)}setVisible(){this.layer.visible=!0}isAdvancedOgcFilters(){return this.datasource.options.ogcFilters.advancedOgcFilters}addFilterDisabled(){return!this.datasource.options.sourceFields||0===this.datasource.options.sourceFields.length}changeOgcFiltersAdvancedOgcFilters(t){this.datasource.options.ogcFilters.advancedOgcFilters=t}changeOgcFilterType(t){this.changeOgcFiltersAdvancedOgcFilters(t.checked),t.checked&&this.refreshFilters(!0)}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)}toggleFiltersCollapsed(){this.filtersCollapsed=!this.filtersCollapsed}static \u0275fac=function(i){return new(i||l)(e.GI1(uo))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filterable-item"]],inputs:{layer:"layer",map:"map",header:"header"},standalone:!0,features:[e.M5G([uo]),e.UHJ],decls:12,vars:12,consts:[[3,"ngClass"],["class","igo-chevron","matListItemIcon","","igoCollapse","","svgIcon","chevron-up",3,"target","collapsed","click",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"ngStyle","matTooltip","click",4,"ngIf"],["matListItemMeta",""],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","color","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["ogcFilters",""],["class","igo-layer-legend-container",4,"ngIf"],[3,"datasource","map","refreshFilters"],["class","mat-typography advancedOgcFilters",4,"ngIf"],["matListItemIcon","","igoCollapse","","svgIcon","chevron-up",1,"igo-chevron",3,"target","collapsed","click"],["matListItemTitle","","matTooltipShowDelay","500",3,"ngStyle","matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","color","click"],["svgIcon","plus"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],[3,"ngClass","svgIcon"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],[3,"layer"],[1,"mat-typography","advancedOgcFilters"],[3,"ngModel","change","ngModelChange"]],template:function(i,n){1&i&&(e.I0R(0,"div",0)(1,"mat-list-item"),e.yuY(2,De,1,2,"mat-icon",1)(3,te,2,5,"span",2),e.I0R(4,"div",3),e.yuY(5,me,3,5,"button",4)(6,Qe,5,12,"button",5),e.C$Y()(),e.I0R(7,"div",null,6),e.yuY(9,ni,4,3,"div",7),e.wR5(10,"igo-ogc-filterable-form",8),e.yuY(11,Ho,5,4,"section",9),e.C$Y()()),2&i&&(e.E7m("ngClass",e.S45(10,Tn,!0===n.header)),e.yG2(2),e.E7m("ngIf",n.header),e.yG2(),e.E7m("ngIf",n.header),e.yG2(2),e.E7m("ngIf",n.isAdvancedOgcFilters()&&n.filtersAreEditable),e.yG2(),e.E7m("ngIf",n.header),e.yG2(3),e.E7m("ngIf",n.header),e.yG2(),e.E7m("datasource",n.datasource)("map",n.map)("refreshFilters",n.refreshFunc),e.yG2(),e.E7m("ngIf",n.hasSelector&&n.filtersAreEditable))},dependencies:[Xe.QF,_t.iI,_t.g9,_t.Y1,Zt.k,_t.UV,_t.At,Xe.u_,tt.oB,tt.qL,Ue.mK,Xe.Qt,st.KO,st.a4,ct.oJ,ct.um,Eo,ee,Zt.U,Lt.Vn,Lt.WK,Me.y,Me.ue,Me._G,Xe.a,it.O0,it.sD],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .advancedOgcFilters[_ngcontent-%COMP%]{text-align:center;width:100%;display:inline-block}[_nghost-%COMP%]   .mat-mdc-list-item[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:1.125em;width:calc(100% - 18px)}[_nghost-%COMP%]   mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}[_nghost-%COMP%]   .separate-item[_ngcontent-%COMP%]{border-bottom:4px solid darkgrey}[_nghost-%COMP%]     .mdc-list-item__start, [_nghost-%COMP%]     .mdc-list-item__end, [_nghost-%COMP%]     .mdc-list-item__content{pointer-events:auto}"]})}return l})();function Gr(l,m){if(1&l&&(e.I0R(0,"button",2),e.wVc(1,"translate"),e.wR5(2,"mat-icon",3),e.C$Y()),2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,3,"igo.geo.filter.filterBy"))("color",t.color),e.yG2(2),e.E7m("matBadge",t.badge)}}function oa(l,m){if(1&l&&e.wR5(0,"igo-ogc-filterable-item",7),2&l){const t=e.GaO(2);e.E7m("header",!1)("map",t.layer.map)("layer",t.layer)}}function ia(l,m){if(1&l&&(e.I0R(0,"div",4,5),e.yuY(2,oa,1,3,"igo-ogc-filterable-item",6),e.C$Y()),2&l){const t=e.GaO();e.yG2(2),e.E7m("ngIf",t.ogcFilterCollapse&&t.options.ogcFilters.enabled)}}let mr=(()=>{class l{options;get badge(){const t=this.options.ogcFilters;let i=0;if(t&&!t.advancedOgcFilters){if(t.pushButtons){const p=t.pushButtons.groups.find(k=>k.enabled);let v=0;p&&p.computedSelectors?.map(k=>v+=k.selectors?.filter(de=>de.enabled).length),i+=v}if(t.checkboxes){const p=t.checkboxes.groups.find(k=>k.enabled);let v=0;p&&p.computedSelectors?.map(k=>v+=k.selectors?.filter(de=>de.enabled).length),i+=v}if(t.radioButtons){const p=t.radioButtons.groups.find(k=>k.enabled);let v=0;p&&p.computedSelectors?.map(k=>v+=k.selectors?.filter(de=>de.enabled).length),i+=v}if(t.select){const p=t.select.groups.find(k=>k.enabled);let v=0;p&&p.computedSelectors?.map(k=>v+=k.selectors?.filter(de=>de.enabled).length),i+=v}if(t.autocomplete){const p=t.autocomplete.groups.find(k=>k.enabled);let v=0;p&&p.computedSelectors?.map(k=>v+=k.selectors?.filter(de=>de.enabled).length),i+=v}}else{if(t&&t.filters&&!t.filters.filters)return 1;if(t&&t.filters&&t.filters.filters)return t.filters.filters.length}if(t.filters&&"During"===t.filters.operator&&t.filters.active&&t.interfaceOgcFilters&&t.interfaceOgcFilters[0].active){const n=t.interfaceOgcFilters[0];t.filters.calendarModeYear?(n.begin.substring(0,4)!==this.options.minDate.substring(0,4)||n.end.substring(0,4)!==this.options.maxDate.substring(0,4))&&(i+=1):(n.begin!==this.options.minDate||n.end!==this.options.maxDate)&&(i+=1)}return i>0?i:void 0}get layer(){return this._layer}set layer(t){this._layer=t,t&&(this.options=this.layer.dataSource.options)}_layer;map;color="primary";header;ogcFilterCollapse=!1;constructor(){}ngOnInit(){this.options=this.layer.dataSource.options}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter-button"]],inputs:{layer:"layer",map:"map",color:"color",header:"header"},standalone:!0,features:[e.UHJ],decls:2,vars:2,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["class","igo-layer-actions-container",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium","svgIcon","filter",3,"matBadge"],[1,"igo-layer-actions-container"],["ogcFilter",""],["igoListItem","",3,"header","map","layer",4,"ngIf"],["igoListItem","",3,"header","map","layer"]],template:function(i,n){1&i&&e.yuY(0,Gr,3,5,"button",0)(1,ia,3,1,"div",1),2&i&&(e.E7m("ngIf",n.header&&n.options.ogcFilters&&n.options.ogcFilters.enabled&&(n.options.ogcFilters.pushButtons||n.options.ogcFilters.checkboxes||n.options.ogcFilters.radioButtons||n.options.ogcFilters.select||n.options.ogcFilters.autocomplete||n.options.ogcFilters.editable)),e.yG2(),e.E7m("ngIf",n.options.ogcFilters&&n.options.ogcFilters.enabled&&(n.options.ogcFilters.pushButtons||n.options.ogcFilters.checkboxes||n.options.ogcFilters.radioButtons||n.options.ogcFilters.select||n.options.ogcFilters.autocomplete||n.options.ogcFilters.editable)))},dependencies:[Xe.u_,ct.oJ,ct.um,st.KO,st.a4,tt.oB,tt.qL,qe.g,qe.S,zo,Ue.qU,it.O0,it.sD],changeDetection:0})}return l})();function $r(l,m){1&l&&(e.I0R(0,"div",3),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.filter.noFilterableLayer")," "))}function Ar(l,m){if(1&l&&e.wR5(0,"igo-ogc-filterable-item",4),2&l){const t=m.$implicit;e.E7m("header",!0)("layer",t)("map",t.map)}}let Hn=(()=>{class l{layers;map;constructor(){}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filterable-list"]],inputs:{layers:"layers",map:"map"},standalone:!0,features:[e.UHJ],decls:5,vars:10,consts:[[3,"navigation","selection"],["id","no-layer-message",4,"ngIf"],["ngFor","",3,"ngForOf"],["id","no-layer-message"],["igoListItem","",3,"header","layer","map"]],template:function(i,n){1&i&&(e.I0R(0,"igo-list",0),e.yuY(1,$r,3,3,"div",1),e.wVc(2,"filterableDataSource"),e.yuY(3,Ar,1,3,"ng-template",2),e.wVc(4,"filterableDataSource"),e.C$Y()),2&i&&(e.E7m("navigation",!1)("selection",!1),e.yG2(),e.E7m("ngIf",0===e.g7$(2,4,n.layers,"ogc").length),e.yG2(2),e.E7m("ngForOf",e.g7$(4,7,n.layers,"ogc")))},dependencies:[Ue.yM,Xe.u_,Xe.Iw,zo,Ue.qU,it.O0,it.sD,mt],styles:["#no-layer-message[_ngcontent-%COMP%]{padding:7%;text-align:center;font-size:medium;font-weight:700}"],changeDetection:0})}return l})();var zn=s(12268);let nr=(()=>{class l{mapService;component;layers$$;constructor(t,i){this.mapService=i,this.component=t}ngOnInit(){this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(t=>{this.component.layers=t.filter(i=>i.showInLayerList)})}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(i){return new(i||l)(e.GI1(Hn,2),e.GI1(zn.u))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoOgcFilterableListBinding",""]],standalone:!0})}return l})();var kr=s(17469),Br=s(14899),ri=s(80956),Ci=s(72032),Ao=s(54776),Pi=s(87544),bo=s(45212),wo=s(88872),Ro=s(3544),Ur=s(61200),rr=s(28660),Jt=function(l){return l.Point="Point",l.LineString="LineString",l.Polygon="Polygon",l.Circle="Circle",l}(Jt||{}),Ct=function(l){return l.Coordinates="Coordinates",l.Length="Length",l.Area="Area",l.Predefined="Predefined",l.Custom="Custom",l}(Ct||{}),Ji=function(l){return l.DecimalDegree="DD",l.DegreesMinutesSeconds="DMS",l}(Ji||{});let Vr=(()=>{class l{config;icons;constructor(t){this.config=t,this.getIconsList()}getIcons(){return this.icons}getPath(){return this.config.getConfig("drawingTool.icons")||[]}getIconsList(){this.icons=this.getPath()}static \u0275fac=function(i){return new(i||l)(e.CoB(M.aW))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var Do=s(8512);function sr(l,m,t,i){return new Ao.cp({stroke:new bo.c({color:m||"rgba(143,7,7,1)",width:t||1}),fill:new wo.c({color:l||"rgba(255,255,255,0.4)"}),image:new Pi.c({radius:5,stroke:new bo.c({color:m||"rgba(143,7,7,1)",width:t||1}),fill:new wo.c({color:l||"rgba(255,255,255,0.4)"})})})}function gr(l,m){let i=new Map([[Ji.DecimalDegree,n=>{if("number"==typeof n[0])return(0,P.mC)(n,5);{const p=[Number(n[0]),Number(n[1])];return(0,P.mC)(p,5)}}],[Ji.DegreesMinutesSeconds,n=>(0,P.G2)(n,2)]]).get(m);return i?i(l):void 0}var J=s(53291),Y=s(58264),c=s(80848),C=s(28772),$=s(49412),re=s(95128),Ce=s(83680),Ve=s(68013),nt=s(67732),at=s(39844),wt=s(70524),Wt=s(17115),Et=s(2892),Ft=(s(89500),s(69904)),fo=function(l){return l.Arial="Arial",l.ArialBlack="Arial Black",l.Verdana="Verdana",l.Tahoma="Tahoma",l.TrebuchetMS="Trebuchet MS",l.Impact="Impact",l.TimesNewRoman="Times New Roman",l.Georgia="Georgia",l.AmericanTypewriter="American Typewriter",l.Courier="Courier",l.LucidaConsole="Lucida Console",l.BrushScriptMT="Brush Script MT",l.ComicSansMS="Comic Sans MS",l}(fo||{}),bt=s(40600),ko=s(62632),Qi=s(91088);let En=(()=>{class l{fillColor="rgba(255,255,255,0.4)";strokeColor="rgba(143,7,7,1)";strokeWidth=1;labelsAreShown=!0;icon;fontSize="15";fontStyle=fo.Arial.toString();offsetX=0;offsetY=0;constructor(){}getFillColor(){return this.fillColor}setFillColor(t){this.fillColor=t}getStrokeColor(){return this.strokeColor}setStrokeColor(t){this.strokeColor=t}getStrokeWidth(){return this.strokeWidth}getLabelsAreShown(){return this.labelsAreShown}toggleLabelsAreShown(){this.labelsAreShown=!this.labelsAreShown}setIcon(t){this.icon=t}getIcon(){return this.icon}getFontSize(){return this.fontSize}setFontSize(t){this.fontSize=t}getFontStyle(){return this.fontStyle}setFontStyle(t){this.fontStyle=t}getOffsetX(){return this.offsetX}setOffsetX(t){this.offsetX=t}getOffsetY(){return this.offsetY}setOffsetY(t){this.offsetY=t}createIndividualElementStyle(t,i,n,p,v,k,de,he,Oe,be){let Pe,Je=!1;t.getGeometry()instanceof c.c&&(Je=!Je);const et=n?t.get("draw"):"";t.set("_mapTitle",et);const pt={text:et,stroke:{color:"white",width:.75},fill:{color:"black"},font:p,overflow:!0,offsetX:de,offsetY:he};let Tt;if(t.get("rad")){const Ht=(0,W.AF)(t.getGeometry().flatCoordinates,Oe,"EPSG:4326"),Oo=t.get("rad")/Math.cos(Math.PI/180*Ht[1])/i;return Tt={text:pt,circle:{radius:Oo,stroke:{color:k||this.strokeColor,width:this.strokeWidth},fill:{color:v}}},t.set("_style",Tt),Pe=new Ao.cp({text:new ko.c({text:et,stroke:new bo.c({color:"white",width:.75}),fill:new wo.c({color:"black"}),font:p,overflow:!0,offsetX:de,offsetY:he}),image:new Pi.c({radius:Oo,stroke:new bo.c({color:k||this.strokeColor,width:this.strokeWidth}),fill:new wo.c({color:v})})}),Pe}return be?(this.offsetY=-26,pt.offsetY=this.offsetY,t.set("_style",{text:pt,stroke:{color:k,width:this.strokeWidth},fill:{color:v},icon:{src:be}}),Pe=new Ao.cp({text:new ko.c({text:n?t.get("draw"):"",stroke:new bo.c({color:"white",width:.75}),fill:new wo.c({color:"black"}),font:p,overflow:!0,offsetX:de,offsetY:he}),stroke:new bo.c({color:k,width:this.strokeWidth}),fill:new wo.c({color:v}),image:new Qi.c({src:be})}),Pe):(this.offsetY=Je?-15:0,pt.offsetY=this.offsetY,t.set("_style",{text:pt,stroke:{color:k,width:this.strokeWidth},fill:{color:v},circle:{radius:5,stroke:{color:k,width:this.strokeWidth},fill:{color:v}}}),Pe=new Ao.cp({text:new ko.c({text:n?t.get("draw"):"",stroke:new bo.c({color:"white",width:.75}),fill:new wo.c({color:"black"}),font:p,overflow:!0,offsetX:de,offsetY:he}),stroke:new bo.c({color:k,width:this.strokeWidth}),fill:new wo.c({color:v}),image:new Pi.c({radius:5,stroke:new bo.c({color:k,width:this.strokeWidth}),fill:new wo.c({color:v})})}),Pe)}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function ar(l,m){1&l&&(e.SAx(0),e.I0R(1,"span"),e.wR5(2,"mat-icon",21),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.wR5(5,"igo-color-picker-form-field",22),e.k70()),2&l&&(e.yG2(3),e.oRS(" ",e.kDX(4,1,"igo.geo.style.fill")," "))}function Kr(l,m){if(1&l&&(e.I0R(0,"mat-option",23),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t," ")}}let gl=(()=>{class l{dialogRef;formBuilder;drawStyleService;data;confirmFlag=!1;form;styleModalData;linestringOnly;constructor(t,i,n,p){this.dialogRef=t,this.formBuilder=i,this.drawStyleService=n,this.data=p}ngOnInit(){this.linestringOnly=!0;for(const t of this.data.features)"LineString"!==t.geometry.type&&(this.linestringOnly=!1);this.buildStyleData(),this.buildForm()}buildForm(){this.form=this.formBuilder.group({fill:[this.getFeatureFillColor()],stroke:[this.getFeatureStrokeColor()]})}buildStyleData(){this.styleModalData={fillColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)",strokeColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)",fontSize:this.data.features.length>0?this.data.features[0].properties.fontStyle.split(" ")[0].replace("px",""):"20",fontStyle:this.data.features.length>0?this.data.features[0].properties.fontStyle.substring(this.data.features[0].properties.fontStyle.indexOf(" ")+1):fo.Arial,offsetX:this.data.features.length>0?this.data.features[0].properties.offsetX:this.drawStyleService.getOffsetX(),offsetY:this.data.features.length>0?this.data.features[0].properties.offsetY:this.drawStyleService.getOffsetY()}}get allFontStyles(){return Object.values(fo)}getFeatureFontSize(){return this.styleModalData.fontSize?this.styleModalData.fontSize:this.data.features.length>0?this.data.features[0].properties.fontStyle.split(" ")[0].replace("px",""):"20"}getFeatureFontStyle(){return this.styleModalData.fontStyle?this.styleModalData.fontStyle:this.data.features.length>0?this.data.features[0].properties.fontStyle.substring(this.data.features[0].properties.fontStyle.indexOf(" ")+1):fo.Arial}getFeatureFillColor(){return this.styleModalData.fillColor?this.styleModalData.fillColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)"}getFeatureStrokeColor(){return this.styleModalData.strokeColor?this.styleModalData.strokeColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)"}getFeatureOffsetX(){return this.styleModalData.offsetX?this.styleModalData.offsetX:this.data.features.length>0?this.data.features[0].properties.offsetX:this.drawStyleService.getOffsetX()}getFeatureOffsetY(){return this.styleModalData.offsetY?this.styleModalData.offsetY:this.data.features.length>0?this.data.features[0].properties.offsetY:this.drawStyleService.getOffsetY()}cancelDrawing(){this.dialogRef.close()}confirm(){this.confirmFlag=!0,this.form.get("fill").value&&(this.styleModalData.fillColor=this.form.get("fill").value),this.form.get("stroke").value&&(this.styleModalData.strokeColor=this.form.get("stroke").value),this.dialogRef.close(this.styleModalData)}openPicker(){this.dialogRef.disableClose=!0}closePicker(){this.dialogRef.disableClose=!1}static \u0275fac=function(i){return new(i||l)(e.GI1(bt.yI),e.GI1(Me.KE),e.GI1(En),e.GI1(bt.sR))};static \u0275cmp=e.In1({type:l,selectors:[["igo-style-modal-drawing"]],inputs:{confirmFlag:"confirmFlag"},standalone:!0,features:[e.UHJ],decls:46,vars:29,consts:[["mat-dialog-title",""],["mat-dialog-content","",1,"edition-drawing",3,"hidden"],[1,"igo-form",3,"formGroup"],[1,"color-picker"],[4,"ngIf"],["svgIcon","square-outline",1,"stroke-palette-icon"],["formControlName","stroke"],[1,"igo-input-container"],["subscriptSizing","dynamic",1,"igo-form-input-box"],["matInput","","type","number","placeholder","10","min","10","onkeydown","return event.keyCode !== 69",3,"value","input"],["testFontSize",""],["matTextSuffix",""],[3,"value","selectionChange"],["testFontStyle",""],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","onkeydown","return event.keyCode !== 69",3,"value","input"],["offsetXInput",""],["offsetYInput",""],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["svgIcon","square",1,"stroke-palette-icon"],["formControlName","fill"],[3,"value"]],template:function(i,n){1&i&&(e.I0R(0,"h2",0),e.OEk(1),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"div",1)(4,"form",2)(5,"div",3),e.yuY(6,ar,6,3,"ng-container",4),e.I0R(7,"span"),e.wR5(8,"mat-icon",5),e.OEk(9),e.wVc(10,"translate"),e.C$Y(),e.wR5(11,"igo-color-picker-form-field",6),e.C$Y(),e.I0R(12,"div",7)(13,"mat-form-field",8)(14,"mat-label"),e.OEk(15),e.wVc(16,"translate"),e.C$Y(),e.I0R(17,"input",9,10),e.qCj("input",function(v){return n.styleModalData.fontSize=v.target.value}),e.C$Y(),e.I0R(19,"span",11),e.OEk(20,"px"),e.C$Y()(),e.I0R(21,"mat-form-field",8)(22,"mat-label"),e.OEk(23),e.wVc(24,"translate"),e.C$Y(),e.I0R(25,"mat-select",12,13),e.qCj("selectionChange",function(v){return n.styleModalData.fontStyle=v.value}),e.yuY(27,Kr,2,2,"mat-option",14),e.C$Y()(),e.I0R(28,"mat-form-field",8)(29,"mat-label"),e.OEk(30),e.wVc(31,"translate"),e.C$Y(),e.I0R(32,"input",15,16),e.qCj("input",function(v){return n.styleModalData.offsetX=v.target.value}),e.C$Y()(),e.I0R(34,"mat-form-field",8)(35,"mat-label"),e.OEk(36),e.wVc(37,"translate"),e.C$Y(),e.I0R(38,"input",15,17),e.qCj("input",function(v){return n.styleModalData.offsetY=v.target.value}),e.C$Y()()()()(),e.I0R(40,"div",18)(41,"button",19),e.qCj("click",function(){return n.cancelDrawing()}),e.OEk(42),e.wVc(43,"translate"),e.C$Y(),e.I0R(44,"button",20),e.qCj("click",function(){return n.confirm()}),e.OEk(45,"OK"),e.C$Y()()),2&i&&(e.yG2(),e.oRS(" ",e.kDX(2,15,"igo.geo.style.styleModal"),"\n"),e.yG2(2),e.E7m("hidden",0===n.data.features.length),e.yG2(),e.E7m("formGroup",n.form),e.yG2(2),e.E7m("ngIf",!0!==n.linestringOnly),e.yG2(3),e.oRS(" ",e.kDX(10,17,"igo.geo.style.stroke")," "),e.yG2(6),e.cNF(e.kDX(16,19,"igo.geo.style.fontSize")),e.yG2(2),e.E7m("value",n.getFeatureFontSize()),e.yG2(6),e.cNF(e.kDX(24,21,"igo.geo.style.fontStyle")),e.yG2(2),e.E7m("value",n.getFeatureFontStyle()),e.yG2(2),e.E7m("ngForOf",n.allFontStyles),e.yG2(3),e.cNF(e.kDX(31,23,"igo.geo.style.offsetX")),e.yG2(2),e.E7m("value",n.getFeatureOffsetX()),e.yG2(4),e.cNF(e.kDX(37,25,"igo.geo.style.offsetY")),e.yG2(2),e.E7m("value",n.getFeatureOffsetY()),e.yG2(4),e.oRS(" ",e.kDX(43,27,"igo.geo.style.cancel")," "))},dependencies:[bt.WQ,bt.iU,Me.y,Me.sz,Me.ue,Me.u,Me.sl,Me.uW,Me.Wo,Xe.u_,tt.oB,tt.qL,Ue.Q9,ft.wb,ft.Up,ft.w5,ft.Gm,Yt.cN,Yt.yi,At.d5,At.kX,Gt.I5,Xe.Iw,Gt.Ax,bt.Yp,ct.oJ,ct.Gw,it.O0,it.sD],styles:["[_nghost-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{padding-top:16px}[_nghost-%COMP%]   .fill-field[_ngcontent-%COMP%], [_nghost-%COMP%]   .stroke-field[_ngcontent-%COMP%]{width:140px}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;align-items:center;grid-gap:16px;margin-bottom:16px}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}[_nghost-%COMP%]   .box[_ngcontent-%COMP%]{width:25px;height:25px}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-gap:16px}[_nghost-%COMP%]   .igo-form-input-box[_ngcontent-%COMP%]{width:150px}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}"]})}return l})(),hl=(()=>{class l{dialogRef;confirmFlag=!1;constructor(t){this.dialogRef=t}cancelDrawing(){this.dialogRef.close()}confirm(t){this.confirmFlag=!0,this.dialogRef.close(t)}static \u0275fac=function(i){return new(i||l)(e.GI1(bt.yI))};static \u0275cmp=e.In1({type:l,selectors:[["igo-draw-popup-component"]],inputs:{confirmFlag:"confirmFlag"},standalone:!0,features:[e.UHJ],decls:14,vars:9,consts:[["mat-dialog-content",""],[1,"mat-typography"],[1,"example-full-width"],["matInput","",3,"placeholder"],["input",""],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(i,n){if(1&i){const p=e.KQA();e.I0R(0,"div",0)(1,"p",1),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"mat-form-field",2),e.wR5(5,"input",3,4),e.wVc(7,"translate"),e.C$Y()(),e.I0R(8,"div",5)(9,"button",6),e.qCj("click",function(){return n.cancelDrawing()}),e.OEk(10),e.wVc(11,"translate"),e.C$Y(),e.I0R(12,"button",7),e.qCj("click",function(){e.usT(p);const k=e.Gew(6);return e.CGJ(n.confirm(k.value))}),e.OEk(13," OK "),e.C$Y()()}2&i&&(e.yG2(2),e.oRS(" ",e.kDX(3,3,"igo.geo.draw.layer.layerDialogInstruction")," "),e.yG2(3),e._6D("placeholder",e.kDX(7,5,"igo.geo.draw.layer.title")),e.yG2(5),e.oRS(" ",e.kDX(11,7,"igo.geo.draw.cancel")," "))},dependencies:[bt.iU,ft.wb,ft.Up,Yt.cN,Yt.yi,bt.Yp,ct.oJ,ct.Gw,it.O0,it.sD],styles:["[_nghost-%COMP%]   .fields-container[_ngcontent-%COMP%]{display:flex}"]})}return l})();var Wr=s(51512);function fl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-radio-button",11),e.qCj("change",function(n){e.usT(t);const p=e.GaO(3);return e.CGJ(p.onLabelTypeChange(n.value))}),e.OEk(1),e.C$Y()}if(2&l){const t=m.$implicit,i=e.GaO(3);e.E7m("value",t.value)("disabled",i.optionAvailable(t.value))("checked",t.checked),e.yG2(),e.oRS(" ",i.getProperLengthLabel(t.value)," ")}}function yl(l,m){if(1&l&&(e.I0R(0,"mat-radio-group"),e.yuY(1,fl,2,4,"mat-radio-button",10),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(),e.E7m("ngForOf",t.arrayBuiltInType)}}function _l(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-checkbox",13),e.qCj("change",function(n){e.usT(t);const p=e.GaO(3);return e.CGJ(p.onLabelTypeChange(n.source.value,n.checked))}),e.OEk(1),e.C$Y()}if(2&l){const t=m.$implicit,i=e.GaO(3);e.E7m("value",t.value)("disabled",i.optionAvailable(t.value))("checked",t.checked),e.yG2(),e.oRS(" ",i.getProperLengthLabel(t.value)," ")}}function Cl(l,m){if(1&l&&(e.SAx(0),e.yuY(1,_l,2,4,"mat-checkbox",12),e.k70()),2&l){const t=e.GaO(2);e.yG2(),e.E7m("ngForOf",t.arrayBuiltInType)}}function vl(l,m){if(1&l&&(e.I0R(0,"mat-option",5),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t," ")}}function Sl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",14)(1,"mat-form-field",15)(2,"mat-label"),e.OEk(3,"(Latitude, Longitude)"),e.C$Y(),e.wR5(4,"input",16,17),e.C$Y(),e.I0R(6,"mat-form-field",18)(7,"mat-select",19),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.onChangeCoordinateUnit(n.value))}),e.yuY(8,vl,2,2,"mat-option",20),e.C$Y()()()}if(2&l){const t=e.GaO(2);e.yG2(4),e._6D("value",t.currentCoordinates),e.yG2(3),e.E7m("value",t.coordinatesMeasureUnit),e.yG2(),e.E7m("ngForOf",t.allCoordinatesUnits)}}function bl(l,m){if(1&l&&(e.I0R(0,"mat-option",5),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit,i=e.GaO(3);e.E7m("value",t),e.yG2(),e.oRS(" ",i.getLengthUnitEnum(t)," ")}}function wl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",14)(1,"mat-form-field",15)(2,"mat-label"),e.OEk(3),e.C$Y(),e.wR5(4,"input",21,17),e.C$Y(),e.I0R(6,"mat-form-field",18)(7,"mat-select",19),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.onChangeLengthUnit(n.value))}),e.yuY(8,bl,2,2,"mat-option",20),e.C$Y()()()}if(2&l){const t=e.GaO(2);e.yG2(3),e.cNF(t.lengthLabelT),e.yG2(),e._6D("placeholder",t.lengthLabelT),e._6D("value",t.currentLength),e.yG2(3),e.E7m("value",t.lengthMeasureUnit),e.yG2(),e.E7m("ngForOf",t.allLengthUnits)}}function Ol(l,m){if(1&l&&(e.I0R(0,"mat-option",5),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit,i=e.GaO(3);e.E7m("value",t),e.yG2(),e.oRS(" ",i.getAreaUnitEnum(t)," ")}}function Il(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",14)(1,"mat-form-field",15)(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.wR5(5,"input",21,17),e.wVc(7,"translate"),e.C$Y(),e.I0R(8,"mat-form-field",18)(9,"mat-select",19),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.onChangeAreaUnit(n.value))}),e.yuY(10,Ol,2,2,"mat-option",20),e.C$Y()()()}if(2&l){const t=e.GaO(2);e.yG2(3),e.cNF(e.kDX(4,5,"igo.geo.draw.labelType.Area")),e.yG2(2),e._6D("placeholder",e.kDX(7,7,"igo.geo.draw.labelType.Area")),e._6D("value",t.currentArea),e.yG2(4),e.E7m("value",t.areaMeasureUnit),e.yG2(),e.E7m("ngForOf",t.allAreaUnits)}}function Tl(l,m){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"div",2)(2,"div",3)(3,"mat-button-toggle-group",4),e.qCj("change",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onLabelTypeChange(n.value))}),e.I0R(4,"mat-button-toggle",5),e.OEk(5),e.wVc(6,"translate"),e.C$Y(),e.I0R(7,"mat-button-toggle",5),e.OEk(8),e.wVc(9,"translate"),e.C$Y()()(),e.I0R(10,"div")(11,"p"),e.OEk(12),e.wVc(13,"translate"),e.C$Y(),e.yuY(14,yl,2,1,"mat-radio-group",1)(15,Cl,2,1,"ng-container",1)(16,Sl,9,3,"div",6)(17,wl,9,5,"div",6)(18,Il,11,9,"div",6),e.C$Y()(),e.I0R(19,"div",7)(20,"button",8),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.cancelDrawing())}),e.OEk(21),e.wVc(22,"translate"),e.C$Y(),e.I0R(23,"button",9),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.confirm())}),e.OEk(24),e.C$Y()(),e.k70()}if(2&l){const t=e.GaO();e.yG2(3),e.E7m("value",t.customOrPredefined),e.yG2(),e.E7m("value",t.labelType.Custom),e.yG2(),e.oRS(" ",e.kDX(6,13,"igo.geo.draw.labelType.custom")," "),e.yG2(2),e.E7m("value",t.labelType.Predefined),e.yG2(),e.oRS(" ",e.kDX(9,15,"igo.geo.draw.labelType.predefined")," "),e.yG2(4),e.oRS(" ",e.kDX(13,17,"igo.geo.draw.builtInInstructions")," "),e.yG2(2),e.E7m("ngIf","Polygon"!==t.olGeometryType),e.yG2(),e.E7m("ngIf","Polygon"===t.olGeometryType),e.yG2(),e.E7m("ngIf",t.labelFlag===t.labelType.Coordinates),e.yG2(),e.E7m("ngIf",t.labelFlag===t.labelType.Length||2===t.polygonCheck),e.yG2(),e.E7m("ngIf",t.labelFlag===t.labelType.Area||2===t.polygonCheck),e.yG2(3),e.oRS(" ",e.kDX(22,19,"igo.geo.draw.cancel")," "),e.yG2(3),e.oRS(" ",t.noLabelButton()," ")}}function El(l,m){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"div",2)(2,"div",3)(3,"mat-button-toggle-group",4),e.qCj("change",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onLabelTypeChange(n.value))}),e.I0R(4,"mat-button-toggle",5),e.OEk(5),e.wVc(6,"translate"),e.C$Y(),e.I0R(7,"mat-button-toggle",5),e.OEk(8),e.wVc(9,"translate"),e.C$Y()()(),e.I0R(10,"p"),e.OEk(11),e.wVc(12,"translate"),e.C$Y(),e.I0R(13,"mat-form-field",22)(14,"mat-label"),e.OEk(15),e.wVc(16,"translate"),e.C$Y(),e.I0R(17,"input",23,17),e.qCj("select",function(){return!0})("input",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.getLabelLength(n.target.value))}),e.wVc(19,"translate"),e.C$Y()()(),e.I0R(20,"div",7)(21,"button",8),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.cancelDrawing())}),e.OEk(22),e.wVc(23,"translate"),e.C$Y(),e.I0R(24,"button",9),e.qCj("click",function(){e.usT(t);const n=e.Gew(18),p=e.GaO();return e.CGJ(p.confirm(n.value))}),e.OEk(25),e.C$Y()(),e.k70()}if(2&l){const t=e.GaO();e.yG2(3),e.E7m("value",t.customOrPredefined),e.yG2(),e.E7m("value",t.labelType.Custom),e.yG2(),e.oRS(" ",e.kDX(6,11,"igo.geo.draw.labelType.custom")," "),e.yG2(2),e.E7m("value",t.labelType.Predefined),e.yG2(),e.oRS(" ",e.kDX(9,13,"igo.geo.draw.labelType.predefined")," "),e.yG2(3),e.oRS(" ",e.kDX(12,15,"igo.geo.draw.dialogInstruction")," "),e.yG2(4),e.cNF(e.kDX(16,17,"igo.geo.draw.dialogTitle")),e.yG2(2),e._6D("placeholder",e.kDX(19,19,"igo.geo.draw.dialogTitle")),e._6D("value",t.currentLabel),e.yG2(5),e.oRS(" ",e.kDX(23,21,"igo.geo.draw.cancel")," "),e.yG2(3),e.oRS(" ",t.noLabelButton()," ")}}let xl=(()=>{class l{languageService;dialogRef;data;confirmFlag=!1;labelFlag=Ct.Custom;coordinatesMeasureUnit;lengthMeasureUnit;areaMeasureUnit;geometryType=Jt;labelType=Ct;arrayBuiltInType=[];currentLabel;currentCoordinates;currentArea;currentLength;olGeometryType=void 0;lengthInMeters;areaInMetersSquare;coordinatesInDD;currentCoordinatesUnit;longlatDD;labelLength;polygonCheck=0;constructor(t,i,n){let p;this.languageService=t,this.dialogRef=i,this.data=n,this.currentLabel=this.data.olGeometry.get("draw"),this.labelLength=this.currentLabel?this.currentLabel.length:0;const v=this.data.map.ol.getView().getProjection();if(this.data.olGeometry instanceof Y.c)if(this.data.olGeometry.get("rad")){const k=[this.data.olGeometry.get("longitude"),this.data.olGeometry.get("latitude")];this.olGeometryType=Jt.Circle,p=new V.c(k,this.data.olGeometry.get("rad"))}else this.olGeometryType=this.data.olGeometry.getGeometry().getType(),p=this.data.olGeometry.get("geometry");else this.olGeometryType=this.data.olGeometry.getType(),p=this.data.olGeometry;if(this.olGeometryType===Jt.Point||this.olGeometryType===Jt.Circle){if(this.data.olGeometry instanceof Y.c){let k=this.data.olGeometry.get("longitude"),de=this.data.olGeometry.get("latitude");this.longlatDD=(0,Wr.uE)([k,de],5),this.coordinatesInDD="("+de+", "+k+")"}else{let k=(0,W.AF)(this.data.olGeometry.getFlatCoordinates(),v,"EPSG:4326");this.longlatDD=(0,Wr.uE)([k[0],k[1]],5),this.coordinatesInDD="("+this.longlatDD[1]+", "+this.longlatDD[0]+")"}this.currentCoordinates=this.coordinatesInDD}if(this.olGeometryType===Jt.LineString)this.lengthInMeters=(0,Do.cD)(p,v.getCode()).toFixed(2),this.currentLength=this.lengthInMeters;else if(this.olGeometryType===Jt.Polygon)this.lengthInMeters=(0,Do.cD)(p,v.getCode()).toFixed(2),this.currentLength=this.lengthInMeters,this.areaInMetersSquare=(0,Do.aS)(p,v.getCode()).toFixed(2),this.currentArea=this.areaInMetersSquare;else if(this.olGeometryType===Jt.Circle){let k=(0,z.IH)(p,1e4);const de=this.getRadius(k);this.lengthInMeters=de.toFixed(2),this.currentLength=this.lengthInMeters,this.areaInMetersSquare=(0,Do.aS)(k,v.getCode()).toFixed(2),this.currentArea=this.areaInMetersSquare}n.olGeometry.get("labelType")===Ct.Coordinates?(this.onLabelTypeChange(Ct.Predefined),this.onLabelTypeChange(Ct.Coordinates,!0),this.coordinatesMeasureUnit=n.olGeometry.get("measureUnit")):n.olGeometry.get("labelType")===Ct.Length?(this.onLabelTypeChange(Ct.Predefined),this.onLabelTypeChange(Ct.Length,!0),this.lengthMeasureUnit=n.olGeometry.get("measureUnit")):n.olGeometry.get("labelType")===Ct.Area?(this.onLabelTypeChange(Ct.Predefined),this.onLabelTypeChange(Ct.Area,!0),this.areaMeasureUnit=n.olGeometry.get("measureUnit")):2===n.olGeometry.get("labelType")?.length&&(this.onLabelTypeChange(Ct.Predefined),this.onLabelTypeChange(Ct.Length,!0),this.onLabelTypeChange(Ct.Area,!0),this.lengthMeasureUnit=n.olGeometry.get("measureUnit")[0],this.areaMeasureUnit=n.olGeometry.get("measureUnit")[1]),this.buildArrayType()}cancelDrawing(){this.dialogRef.close()}confirm(t){this.confirmFlag=!0,this.labelFlag===Ct.Predefined?this.dialogRef.close():this.labelFlag===Ct.Custom?this.dialogRef.close({label:t}):this.labelFlag===Ct.Coordinates?this.dialogRef.close({label:this.currentCoordinates,measureUnit:this.coordinatesMeasureUnit}):this.olGeometryType===Jt.Polygon?2===this.polygonCheck?(this.labelFlag=[Ct.Length,Ct.Area],this.dialogRef.close({label:"P: "+this.currentLength+" "+Ft.Ks[Ft.K8.Meters]+"\n"+this.languageService.translate.instant("igo.geo.draw.labelType.A")+this.currentArea+" "+Ft.kK[Ft.Mh.SquareMeters],measureUnit:[this.lengthMeasureUnit,this.areaMeasureUnit]})):this.dialogRef.close(this.labelFlag===Ct.Length?{label:"P: "+this.currentLength+" "+Ft.Ks[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}:{label:this.currentArea+" "+Ft.kK[this.areaMeasureUnit],measureUnit:this.areaMeasureUnit}):this.labelFlag===Ct.Length?this.olGeometryType===Jt.Circle?this.dialogRef.close({label:"R: "+this.currentLength+" "+Ft.Ks[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}):this.olGeometryType===Jt.LineString&&this.dialogRef.close({label:this.currentLength+" "+Ft.Ks[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}):this.labelFlag===Ct.Area&&this.dialogRef.close({label:this.currentArea+" "+Ft.kK[this.areaMeasureUnit],measureUnit:this.areaMeasureUnit})}onLabelTypeChange(t,i){t!==Ct.Predefined&&t!==Ct.Custom&&this.olGeometryType===Jt.Polygon?(this.arrayBuiltInType.find(p=>p.value===t)?this.arrayBuiltInType.find(p=>p.value===t).checked=i:this.labelFlag=void 0,this.labelFlag=i?t:this.arrayBuiltInType.find(p=>p.checked)?.value):this.labelFlag=t,t===Ct.Predefined?this.olGeometryType===Jt.Point?(this.labelFlag=Ct.Coordinates,this.currentCoordinates=this.coordinatesInDD,this.coordinatesMeasureUnit=Ji.DecimalDegree):this.olGeometryType===Jt.LineString&&(this.labelFlag=Ct.Length,this.currentLength=this.lengthInMeters,this.lengthMeasureUnit=Ft.K8.Meters):t===Ct.Area?(this.currentArea=this.areaInMetersSquare,this.areaMeasureUnit=Ft.Mh.SquareMeters):t===Ct.Length?(this.currentLength=this.lengthInMeters,this.lengthMeasureUnit=Ft.K8.Meters):this.labelFlag===Ct.Coordinates&&(this.currentCoordinates=this.coordinatesInDD,this.coordinatesMeasureUnit=Ji.DecimalDegree),this.olGeometryType===Jt.Polygon&&[this.labelType.Length,this.labelType.Area].includes(t)?i?this.polygonCheck+=1:this.polygonCheck-=1:this.polygonCheck=0}onChangeLengthUnit(t){this.lengthMeasureUnit=t,this.currentLength=(0,Do.iK)(Number(this.lengthInMeters),t).toFixed(2)}onChangeAreaUnit(t){this.areaMeasureUnit=t,this.currentArea=(0,Do.Ej)(Number(this.areaInMetersSquare),t).toFixed(2)}onChangeCoordinateUnit(t){this.coordinatesMeasureUnit=t;let i=gr(this.longlatDD,t);this.currentCoordinates="("+i[1]+", "+i[0]+")"}buildArrayType(){for(const t of Object.values(Ct))t!==Ct.Custom&&t!==Ct.Predefined&&this.arrayBuiltInType.push({value:t,checked:this.selectOptions(t)||this.labelFlag===t||2===this.polygonCheck&&t!==Ct.Coordinates})}noLabelButton(){return this.labelFlag===Ct.Predefined||this.labelFlag===Ct.Custom&&0===this.labelLength?this.languageService.translate.instant("igo.geo.draw.noLabel"):"OK"}get customOrPredefined(){return this.labelFlag===Ct.Custom?Ct.Custom:Ct.Predefined}optionAvailable(t){switch(this.olGeometryType){case Jt.Point:return t!==Ct.Coordinates;case Jt.LineString:return t!==Ct.Length;case Jt.Polygon:return t===Ct.Coordinates;default:return!1}}get allLengthUnits(){return Object.values(Ft.K8)}getLengthUnitEnum(t){return Ft.Ks[t]}get allAreaUnits(){return Object.values(Ft.Mh)}get allCoordinatesUnits(){return Object.values(Ji)}getAreaUnitEnum(t){return Ft.kK[t]}getRadius(t){const i=(0,$.S2)(t);return Number(i/(2*Math.PI))}get lengthLabelT(){return this.languageService.translate.instant(this.olGeometryType===Jt.Polygon?"igo.geo.measure.perimeter":this.olGeometryType===Jt.Circle?"igo.geo.search.coordinates.radius":"igo.geo.draw.labelType.Length")}getLabelLength(t){this.labelLength=t.length}selectOptions(t){return this.olGeometryType===Jt.Point?t===Ct.Coordinates:this.olGeometryType===Jt.LineString?t===Ct.Length:void 0}getProperLengthLabel(t){return this.languageService.translate.instant(t===Ct.Length?this.olGeometryType===Jt.Polygon?"igo.geo.measure.perimeter":this.olGeometryType===Jt.Circle?"igo.geo.search.coordinates.radius":"igo.geo.draw.labelType.Length":"igo.geo.draw.labelType."+t)}static \u0275fac=function(i){return new(i||l)(e.GI1(L.ov),e.GI1(bt.yI),e.GI1(bt.sR))};static \u0275cmp=e.In1({type:l,selectors:[["igo-draw-popup-component"]],inputs:{confirmFlag:"confirmFlag",labelFlag:"labelFlag",coordinatesMeasureUnit:"coordinatesMeasureUnit",lengthMeasureUnit:"lengthMeasureUnit",areaMeasureUnit:"areaMeasureUnit"},standalone:!0,features:[e.UHJ],decls:5,vars:5,consts:[["mat-dialog-title",""],[4,"ngIf"],["mat-dialog-content","",1,"geometry-type-toggle"],[1,"button-toggle-container"],[3,"value","change"],[3,"value"],["class","fields-container",4,"ngIf"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[3,"value","disabled","checked","change",4,"ngFor","ngForOf"],[3,"value","disabled","checked","change"],["class","mat-typography",3,"value","disabled","checked","change",4,"ngFor","ngForOf"],[1,"mat-typography",3,"value","disabled","checked","change"],[1,"fields-container"],[1,"readOnly-Input"],["matInput","","placeholder","(Latitude, Longitude)","readonly","",3,"value"],["input",""],[1,"unit-field"],[3,"value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","readonly","",3,"placeholder","value"],[1,"input"],["matInput","","cdkFocusInitial","",3,"placeholder","value","select","input"]],template:function(i,n){1&i&&(e.I0R(0,"h2",0),e.OEk(1),e.wVc(2,"translate"),e.C$Y(),e.yuY(3,Tl,25,21,"ng-container",1)(4,El,26,23,"ng-container",1)),2&i&&(e.yG2(),e.oRS(" ",e.kDX(2,3,"igo.geo.draw.popupTitle"),"\n"),e.yG2(2),e.E7m("ngIf",n.labelFlag!==n.labelType.Custom),e.yG2(),e.E7m("ngIf",n.labelFlag===n.labelType.Custom))},dependencies:[bt.WQ,Xe.u_,bt.iU,ro.ue,ro.gn,ro.KU,Mo.yk,Mo.cv,Mo.cT,Xe.Iw,Lt.Vn,Lt.WK,ft.wb,ft.Up,ft.w5,Yt.cN,Yt.yi,At.d5,At.kX,Gt.I5,Gt.Ax,bt.Yp,ct.oJ,ct.Gw,it.O0,it.sD],styles:["[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%] ~ .mat-radio-button[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .readOnly-Input[_ngcontent-%COMP%]{width:200px!important}[_nghost-%COMP%]   .button-toggle-container[_ngcontent-%COMP%]{margin-bottom:12px}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]     .mat-mdc-form-field-infix{width:-moz-fit-content;width:fit-content}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]     .mat-mdc-select-min-line{padding-right:24px}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{position:sticky!important}[_nghost-%COMP%]   .coordinatesInputView[_ngcontent-%COMP%]{top:5em!important}[_nghost-%COMP%]   .mat-mdc-dialog-actions[_ngcontent-%COMP%]{display:flex!important;justify-content:flex-end}[_nghost-%COMP%]   .input[_ngcontent-%COMP%]{width:auto!important}[_nghost-%COMP%]   .mat-button-toggle-group[_ngcontent-%COMP%], [_nghost-%COMP%]   .mat-button-toggle[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin-right:10px}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}"]})}return l})(),Ml=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-draw-shorcuts"]],standalone:!0,features:[e.UHJ],decls:24,vars:12,consts:[[1,"shortcut","mat-typography"],["svgIcon","keyboard-return",1,"shortcut-icon"],["svgIcon","backspace-outline",1,"shortcut-icon"],["svgIcon","keyboard-esc",1,"shortcut-icon"],["svgIcon","keyboard-space",1,"shortcut-icon"],[1,"shortcuts-close"],["mat-raised-button","","mat-dialog-close","","color","primary"]],template:function(i,n){1&i&&(e.I0R(0,"mat-dialog-content")(1,"div")(2,"span",0),e.wR5(3,"mat-icon",1),e.OEk(4),e.wVc(5,"translate"),e.C$Y()(),e.I0R(6,"div")(7,"span",0),e.wR5(8,"mat-icon",2),e.OEk(9),e.wVc(10,"translate"),e.C$Y()(),e.I0R(11,"div")(12,"span",0),e.wR5(13,"mat-icon",3),e.OEk(14),e.wVc(15,"translate"),e.C$Y()(),e.I0R(16,"div")(17,"span",0),e.wR5(18,"mat-icon",4),e.OEk(19),e.wVc(20,"translate"),e.C$Y()()(),e.I0R(21,"mat-dialog-actions",5)(22,"button",6),e.OEk(23,"OK"),e.C$Y()()),2&i&&(e.yG2(4),e.cNF(e.kDX(5,4,"igo.geo.draw.finish")),e.yG2(5),e.cNF(e.kDX(10,6,"igo.geo.draw.undo")),e.yG2(5),e.cNF(e.kDX(15,8,"igo.geo.draw.abort")),e.yG2(5),e.cNF(e.kDX(20,10,"igo.geo.draw.move")))},dependencies:[bt.iU,tt.oB,tt.qL,bt.Yp,ct.oJ,ct.Gw,bt.qq,it.O0,it.sD],styles:[".shortcut[_ngcontent-%COMP%]{display:flex;align-items:center}.shortcut-icon[_ngcontent-%COMP%]{margin-right:10px}.shortcuts-close[_ngcontent-%COMP%]{display:flex;justify-content:center}"]})}return l})();const Dl=["selectedLayer"];function Pl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",5),e.qCj("change",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onToggleFreehandMode(n))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("checked",t.freehandMode)("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(2,3,"igo.geo.draw.freehandMode")," ")}}function Fl(l,m){if(1&l&&(e.I0R(0,"mat-option",2),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.measure."+t)," ")}}function Rl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",24)(1,"mat-form-field",25),e.wR5(2,"input",26),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"mat-form-field",27)(5,"mat-select",10),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onMeasureUnitChange(n.value))}),e.yuY(6,Fl,3,4,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO();e.yG2(2),e._6D("placeholder",e.kDX(3,5,"igo.geo.spatialFilter.radius")),e.E7m("formControl",t.radiusFormControl)("readonly",t.freehandMode),e.yG2(3),e.E7m("value",t.measureUnit),e.yG2(),e.E7m("ngForOf",t.measureUnits)}}function Ll(l,m){if(1&l&&(e.I0R(0,"mat-option",2),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t.title," ")}}function Gl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",28),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.activeDrawingLayer.visible=!n.activeDrawingLayer.visible)}),e.wVc(1,"translate"),e.wVc(2,"translate"),e.wR5(3,"mat-icon",29),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("color",t.activeDrawingLayer.visible?"primary":"default")("matTooltip",t.activeDrawingLayer.visible?e.kDX(1,3,"igo.geo.layer.hideLayer"):e.kDX(2,5,"igo.geo.layer.showLayer")),e.yG2(3),e.E7m("svgIcon",t.activeDrawingLayer.visible?"eye":"eye-off")}}function $l(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",30),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.deleteDrawings())}),e.wVc(1,"translate"),e.wVc(2,"async"),e.wR5(3,"mat-icon",31),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.draw.delete"))("disabled",0===e.kDX(2,4,t.selectedFeatures$).length)}}function Al(l,m){if(1&l&&(e.I0R(0,"div",35),e.wR5(1,"img",36),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(),e._6D("src",t.icon,e.K6U)}}function kl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-option",37),e.qCj("click",function(){const p=e.usT(t).$implicit,v=e.GaO(2);return e.CGJ(v.onIconChange(p))}),e.I0R(1,"div",35),e.wR5(2,"img",36),e.C$Y()()}if(2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(2),e._6D("src",t,e.K6U)}}function Bl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field")(1,"mat-label"),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"mat-select")(5,"mat-select-trigger"),e.yuY(6,Al,2,1,"div",32),e.C$Y(),e.I0R(7,"mat-option",33),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.onIconChange())}),e.OEk(8),e.wVc(9,"translate"),e.C$Y(),e.yuY(10,kl,3,2,"mat-option",34),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(2),e.cNF(e.kDX(3,4,"igo.geo.draw.icon")),e.yG2(4),e.E7m("ngIf",t.icon),e.yG2(2),e.cNF(e.kDX(9,6,"igo.geo.draw.noIcon")),e.yG2(2),e.E7m("ngForOf",t.icons)}}function Ul(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",38),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.openStyleModalDialog())}),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.wR5(4,"mat-icon",39),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,3,"igo.geo.style.styleModalTooltipSelected")),e.yG2(2),e.oRS(" ",e.kDX(3,5,"igo.geo.style.styleModal")," "),e.yG2(2),e.E7m("matBadge",t.selectedFeatures$.value.length)}}let Yl=(()=>{class l{languageService;formBuilder;drawStyleService;dialog;drawIconService;tableTemplate;geometryType=Jt;map;get stores(){return this._stores}set stores(t){this._stores=t}_stores=[];get drawControls(){return this._drawControls}set drawControls(t){this._drawControls=t}_drawControls=[];get activeDrawingLayer(){return this._activeDrawingLayer}set activeDrawingLayer(t){this._activeDrawingLayer=t}_activeDrawingLayer;activeLayerChange=new e._w7;drawControlsEvent=new e._w7;layersIDEvent=new e._w7;fillColor;strokeColor;strokeWidth;fontSize;fontStyle;activeStore;layerCounterID=0;draw$=new A.g({});activeDrawingLayerSource=new C.c;activeDrawControl;drawEnd$$;drawSelect$$;selectedFeatures$=new A.g([]);fillForm;strokeForm;drawControlIsDisabled=!0;drawControlIsActive=!1;labelsAreShown;freehandMode=!1;subscriptions$$=[];position="bottom";form;icons;icon;radiusFormControl=new Me.yM(1e3);measureUnit=Ft.K8.Meters;radiusFormControlChange$$=new re.wH;predefinedRadius$=new A.g(void 0);radiusDrawEnd$=new A.g(void 0);get measureUnits(){return[Ft.K8.Meters,Ft.K8.Kilometers]}numberOfDrawings;isCreatingNewLayer=!1;currGeometryType=this.geometryType.Point;select;constructor(t,i,n,p,v){this.languageService=t,this.formBuilder=i,this.drawStyleService=n,this.dialog=p,this.drawIconService=v,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,fixedHeader:!0,tableHeight:"auto",columns:[{name:"Drawing",title:this.languageService.translate.instant("igo.geo.draw.labels"),valueAccessor:k=>k.properties.draw},{name:"Edition",title:"",sort:!1,valueAccessor:k=>[{editMode:!1,icon:"pencil",color:"primary",click:()=>{this.editLabelDrawing(k)},style:"mat-icon-button"}],renderer:Ue.G8.ButtonGroup}]},this.buildForm(),this.fillColor=this.drawStyleService.getFillColor(),this.strokeColor=this.drawStyleService.getStrokeColor(),this.strokeWidth=this.drawStyleService.getStrokeWidth(),this.labelsAreShown=this.drawStyleService.getLabelsAreShown(),this.icons=this.drawIconService.getIcons(),this.icon=this.drawStyleService.getIcon(),this.fontSize=this.drawStyleService.getFontSize(),this.fontStyle=this.drawStyleService.getFontStyle()}ngOnInit(){this.stores.length?(this.activeStore=this.stores.find(t=>t.layer.id===this.activeDrawingLayer.id),this.activeDrawControl=this.drawControls.find(t=>t[0]===this.activeDrawingLayer.id)[1],this.deactivateDrawControl(),this.allLayers.forEach(t=>{t.id!==this.activeDrawingLayer.id&&(t.opacity=0);let i=this.stores.find(n=>n.layer.id===t.id);this.subscriptions$$.push(i.stateView.manyBy$(n=>!0===n.state.selected).pipe((0,Ce.K)()).subscribe(n=>{n.forEach(p=>{p.state.selected=!1})})),this.subscriptions$$.push(i.stateView.manyBy$(n=>!0===n.state.selected).pipe((0,Ve.s)(1)).subscribe(n=>{this.selectedFeatures$.next(n.map(p=>p.entity))})),this.subscriptions$$.push(i.count$.subscribe(n=>{this.activeStore.layer.options.showInLayerList=n>=1}))}),this.onLayerChange(this.activeDrawingLayer)):(this.activeStore=new at.ym([],{map:this.map}),this.initStore(),this.activeDrawControl=this.createDrawControl(this.fillColor,this.strokeColor,this.strokeWidth),this.activeDrawControl.setGeometryType(this.geometryType.Point),this.toggleDrawControl(),this.stores.push(this.activeStore),this.drawControls.push([this.activeDrawingLayer.id,this.activeDrawControl]),this.drawControlsEvent.emit(this.drawControls),this.layersIDEvent.emit(this.activeDrawingLayer.id),this.onLayerChange(this.activeDrawingLayer)),this.radiusFormControlChange$$=this.radiusFormControl.valueChanges.subscribe(t=>{this.activeDrawControl.ispredefinedRadius$.getValue()&&this.changeRadius(t)})}ngOnDestroy(){this.allLayers.forEach(t=>t.opacity=1),this.activeStore.state.updateAll({selected:!1}),this.deactivateDrawControl(),this.subscriptions$$.map(t=>t.unsubscribe()),this.radiusFormControlChange$$.unsubscribe()}createDrawControl(t,i,n){return new Wt.i({geometryType:void 0,drawingLayerSource:this.activeDrawingLayerSource,drawingLayerStyle:new Ao.cp({}),interactionStyle:sr(t,i,n)})}initStore(t,i){this.createLayer(t,i),this.subscriptions$$.push(this.activeStore.stateView.manyBy$(n=>!0===n.state.selected).pipe((0,Ve.s)(1)).subscribe(n=>{this.selectedFeatures$.next(n.map(p=>p.entity))})),this.subscriptions$$.push(this.activeStore.count$.subscribe(n=>{this.activeStore.layer.options.showInLayerList=n>=1}))}openStyleModalDialog(){setTimeout(()=>{const t=this.dialog.open(gl,{disableClose:!1,data:{features:this.selectedFeatures$.getValue(),icons:this.icons,icon:this.icon},autoFocus:!1});t.afterClosed().subscribe(i=>{t.componentInstance.confirmFlag&&(this.onFontChange(this.labelsAreShown,i.fontSize,i.fontStyle),this.onColorChange(this.labelsAreShown,!!this.icon,i.fillColor,i.strokeColor),this.onOffsetLabelChange(this.labelsAreShown,i.offsetX,i.offsetY))})},250)}openDrawDialog(t,i){setTimeout(()=>{const n=this.dialog.open(xl,{disableClose:!1,data:{olGeometry:t,map:this.map}});n.afterClosed().subscribe(p=>{n.componentInstance.confirmFlag?(this.updateLabelOfOlGeometry(t,p.label),this.updateLabelType(t,n.componentInstance.labelFlag),this.updateMeasureUnit(t,p.measureUnit),t instanceof Y.c||(this.updateFontSizeAndStyle(t,"15",fo.Arial),this.updateFillAndStrokeColor(t,"rgba(255,255,255,0.4)","rgba(143,7,7,1)"),this.updateOffset(t,0,t instanceof c.c?-15:0)),i?this.onDrawEnd(t):this.onSelectDraw(t,p.label,[n.componentInstance.labelFlag,p.measureUnit]),this.updateHeightTable()):this.activeDrawingLayerSource.getFeatures().forEach(v=>{const k=v.getGeometry();t===k&&this.activeDrawingLayerSource.removeFeature(v)})})},250)}onDrawEnd(t,i){this.addFeatureToStore(t,i),this.clearLabelsOfOlGeometry(t),this.activeStore.layer.ol.getSource().refresh()}onModifyDraw(t){this.activeStore.all().forEach(n=>{if(n.properties.id===t.ol_uid){if(n.properties.labelType===Ct.Coordinates){let k=gr([n.properties.longitude,n.properties.latitude],n.properties.measureUnit);this.updateLabelOfOlGeometry(t,"("+k[1]+", "+k[0]+")")}else if(n.properties.labelType===Ct.Length)if(t instanceof V.c){let k=(0,z.IH)(t,1e4);const de=(0,Do.iK)(this.getRadius(k),n.properties.measureUnit),he=Ft.Ks[n.properties.measureUnit],Oe="R: "+de.toFixed(2).toString()+" "+he;this.updateLabelOfOlGeometry(t,Oe)}else{let de,k=(0,Do.cD)(t,this.map.ol.getView().getProjection().getCode());de=Ft.Ks[n.properties.measureUnit],k=(0,Do.iK)(k,n.properties.measureUnit);let Oe=t instanceof z.cp?"P: "+k.toFixed(2).toString()+" "+de:k.toFixed(2).toString()+" "+de;this.updateLabelOfOlGeometry(t,Oe)}else if(n.properties.labelType===Ct.Area)if(t instanceof V.c){let k=(0,z.IH)(t,1e4),de=(0,Do.aS)(k,this.map.ol.getView().getProjection().getCode());const he=Ft.kK[n.properties.measureUnit];de=(0,Do.Ej)(de,n.properties.measureUnit);const be=de.toFixed(2).toString()+" "+he;this.updateLabelOfOlGeometry(t,be)}else{let de,k=(0,Do.aS)(t,this.map.ol.getView().getProjection().getCode());de=Ft.kK[n.properties.measureUnit],k=(0,Do.Ej)(k,n.properties.measureUnit);const Oe=k.toFixed(2).toString()+" "+de;this.updateLabelOfOlGeometry(t,Oe)}else this.updateLabelOfOlGeometry(t,n.properties.draw);this.updateLabelType(t,n.properties.labelType),this.updateMeasureUnit(t,n.properties.measureUnit),this.updateFontSizeAndStyle(t,n.properties.fontStyle.split(" ")[0].replace("px",""),n.properties.fontStyle.substring(n.properties.fontStyle.indexOf(" ")+1)),this.updateFillAndStrokeColor(t,n.properties.drawingStyle.fill,n.properties.drawingStyle.stroke),this.updateOffset(t,n.properties.offsetX,n.properties.offsetY),this.replaceFeatureInStore(n,t)}})}onSelectDraw(t,i,n){const p=this.activeStore.all(),v=t.getGeometry();v.ol_uid=t.get("id");const k=JSON.stringify(v.getCoordinates()[0]);p.forEach(de=>{const he=JSON.stringify(de.geometry.coordinates[0]);if(k===he){const Oe=t.get("fontStyle").split(" ")[0].replace("px",""),be=t.get("fontStyle").substring(t.get("fontStyle").indexOf(" ")+1),Pe=t.get("drawingStyle").fill,Je=t.get("drawingStyle").stroke,Fe=t.get("offsetX"),et=t.get("offsetY"),pt=de.properties.rad?de.properties.rad:void 0;this.updateLabelOfOlGeometry(v,i),this.updateFontSizeAndStyle(v,Oe,be),this.updateFillAndStrokeColor(v,Pe,Je),this.updateOffset(v,Fe,et),this.updateLabelType(v,n[0]),this.updateMeasureUnit(v,n[1]),this.replaceFeatureInStore(de,v,pt)}})}addFeatureToStore(t,i,n){let p,v,k,de,he;const Oe=n?n.properties.id:t.ol_uid,be=this.map.ol.getView().getProjection(),Pe=(new X.c).writeGeometryObject(t,{featureProjection:be,dataProjection:be});if(t instanceof V.c||i)if(i)p=i;else{Pe.type="Point",Pe.coordinates=t.getCenter();const Je=(0,W.AF)([t.getFlatCoordinates()[2],t.getFlatCoordinates()[3]],be,"EPSG:4326");v=(0,W.AF)([t.getFlatCoordinates()[0],t.getFlatCoordinates()[1]],be,"EPSG:4326"),de=v[0],he=v[1],p=(0,$.c$)(v,Je),this.radiusFormControl.setValue(Math.round(p))}this.activeDrawControl.radiusDrawEnd$.getValue()&&(p=this.activeDrawControl.radiusDrawEnd$.getValue()),t instanceof c.c&&(k=(0,W.AF)(t.getFlatCoordinates(),be,"EPSG:4326"),de=k[0],he=k[1]),this.activeStore.update({type:at.Yf,geometry:Pe,projection:be.getCode(),properties:{id:Oe,draw:t.get("_label"),longitude:de||null,latitude:he||null,rad:p||null,fontStyle:t.get("fontStyle_"),drawingStyle:{fill:t.get("fillColor_"),stroke:t.get("strokeColor_")},offsetX:t.get("offsetX_"),offsetY:t.get("offsetY_"),labelType:t.get("labelType_"),measureUnit:t.get("measureUnit_")},meta:{id:Oe}}),this.activeStore.setLayerExtent(),this.activeDrawControl.predefinedRadius$.next(void 0),this.activeDrawControl.radiusDrawEnd$.next(void 0)}buildForm(){this.form=this.formBuilder.group({fill:[""],stroke:[""]})}setupLayer(t){setTimeout(()=>{const i=this.dialog.open(hl,{disableClose:!1});i.afterClosed().subscribe(n=>{i.componentInstance.confirmFlag?(this.activeStore.state.updateAll({selected:!1}),this.activeStore=new at.ym([],{map:this.map}),this.activeDrawingLayerSource=new C.c,this.activeDrawingLayer.opacity=0,this.deactivateDrawControl(),this.initStore(n,t),this.activeDrawControl=this.createDrawControl(this.fillColor,this.strokeColor,this.strokeWidth),this.activeDrawControl.setGeometryType(this.currGeometryType),this.toggleDrawControl(),this.stores.push(this.activeStore),this.drawControls.push([this.activeDrawingLayer.id,this.activeDrawControl]),this.drawControlsEvent.emit(this.drawControls),this.layersIDEvent.emit(this.activeDrawingLayer.id),this.isCreatingNewLayer=!1,this.labelsAreShown||this.onToggleLabels(),this.activeLayerChange.emit(this.activeDrawingLayer)):(this.select.value=this.activeDrawingLayer,this.select.selectionChange.emit(this.activeDrawingLayer))})},250)}editLabelDrawing(t){const i=(0,at.K6)(t,this.map.ol.getView().getProjection().getCode());this.openDrawDialog(i,!1)}openShorcutsDialog(){this.dialog.open(Ml)}deleteDrawings(){this.activeStore.deleteMany(this.selectedFeatures$.value),this.selectedFeatures$.value.forEach(t=>{this.activeDrawingLayerSource.getFeatures().forEach(i=>{const n=i.getGeometry();t.properties.id===n.ol_uid&&this.activeDrawingLayerSource.removeFeature(i)})}),this.updateHeightTable(),this.activeStore.setLayerExtent()}onToggleLabels(){this.drawStyleService.toggleLabelsAreShown(),this.labelsAreShown=!this.labelsAreShown,this.elementStyle(this.labelsAreShown,!!this.icon),this.createDrawControl()}onToggleDrawControl(t){t?this.toggleDrawControl():this.deactivateDrawControl()}onToggleFreehandMode(t){this.isCircle()&&!t.checked?(this.activeDrawControl.ispredefinedRadius$.next(!0),this.changeRadius(this.radiusFormControl.value)):(this.activeDrawControl.setOlInteractionStyle(sr(this.fillColor,this.strokeColor,this.strokeWidth)),this.activeDrawControl.ispredefinedRadius$.next(!1)),this.freehandMode=t.checked,this.activeDrawControl.freehand$.next(t.checked),this.toggleDrawControl()}onLayerChange(t){t?(this.activeStore.state.updateAll({selected:!1}),this.isCreatingNewLayer=!1,this.activeDrawingLayer.opacity=0,this.activeDrawingLayer=t,this.activeDrawingLayer.opacity=1,this.deactivateDrawControl(),this.labelsAreShown||this.onToggleLabels(),this.activeStore=this.stores.find(i=>i.layer.id===this.activeDrawingLayer.id),this.activeDrawControl=this.drawControls.find(i=>i[0]===this.activeDrawingLayer.id)[1],this.activeDrawingLayerSource=this.activeDrawControl.olDrawingLayerSource,this.activeDrawControl.setGeometryType(this.currGeometryType),this.toggleDrawControl()):this.setupLayer(!0),this.activeLayerChange.emit(this.activeDrawingLayer)}createLayer(t,i){for(const n of this.allLayers){let p=Number(n.id.replace("igo-draw-layer",""));this.layerCounterID=Math.max(p,this.layerCounterID)}this.activeDrawingLayer=new Et.M({isIgoInternalLayer:!0,id:"igo-draw-layer"+ ++this.layerCounterID,title:i?t:this.languageService.translate.instant("igo.geo.draw.drawing"),zIndex:200,source:new nt.E,style:(n,p)=>this.drawStyleService.createIndividualElementStyle(n,p,this.labelsAreShown,n.get("fontStyle"),n.get("drawingStyle").fill,n.get("drawingStyle").stroke,n.get("offsetX"),n.get("offsetY"),this.map.projection,this.icon),showInLayerList:!0,exportable:!0,browsable:!1,workspace:{enabled:!1}}),(0,wt.m)(this.activeStore,this.activeDrawingLayer),(0,at.sf)(this.activeStore,new at.E9({motion:at.Su.None})),(0,at.Uz)(this.activeStore,new at.kj({map:this.map,motion:at.Su.None,many:!0})),this.activeStore.layer.visible=!0,this.activeStore.source.ol.on("removefeature",n=>{const p=n.feature.getGeometry();this.clearLabelsOfOlGeometry(p)})}onColorChange(t,i,n,p){this.selectedFeatures$.value.length>0&&!i&&this.selectedFeatures$.value.forEach(v=>{let k=(0,at.K6)(v,this.map.ol.getView().getProjection().getCode());this.updateFillAndStrokeColor(k,n,p);const de=this.activeStore.all().find(he=>he.meta.id===k.getId());de.properties.drawingStyle.fill=k.get("fillColor_"),de.properties.drawingStyle.stroke=k.get("strokeColor_"),this.activeStore.update(de)}),this.elementStyle(t,i),this.createDrawControl()}onFontChange(t,i,n){this.selectedFeatures$.value.length>0&&(this.selectedFeatures$.value.forEach(p=>{let v=(0,at.K6)(p,this.map.ol.getView().getProjection().getCode());this.updateFontSizeAndStyle(v,i,n);const k=this.activeStore.all().find(de=>de.meta.id===v.getId());k.properties.fontStyle=v.get("fontStyle_"),this.activeStore.update(k),v=this.activeStore.layer.ol.getSource().getFeatures().find(de=>de.getId()===k.meta.id),v.setProperties({fontStyle:k.properties.fontStyle}),v.changed()}),this.fontSize=i,this.fontStyle=n,this.drawStyleService.setFontSize(i),this.drawStyleService.setFontStyle(n),this.elementStyle(t))}onOffsetLabelChange(t,i,n){this.selectedFeatures$.value.length>0&&(this.selectedFeatures$.value.forEach(p=>{let v=(0,at.K6)(p,this.map.ol.getView().getProjection().getCode());this.updateOffset(v,i,n);const k=this.activeStore.all().find(de=>de.meta.id===v.getId());k.properties.offsetX=v.get("offsetX_"),k.properties.offsetY=v.get("offsetY_"),this.activeStore.update(k),v=this.activeStore.layer.ol.getSource().getFeatures().find(de=>de.getId()===k.meta.id),v.setProperties({offsetX:k.properties.offsetX,offsetY:k.properties.offsetY}),v.changed()}),this.elementStyle(t))}onIconChange(t){this.icon=t,this.drawStyleService.setIcon(this.icon),this.elementStyle(!0,this.icon)}onGeometryTypeChange(t){this.currGeometryType=t,this.activeDrawControl.setGeometryType(t),this.onToggleFreehandMode(this.freehandMode?{checked:!0}:{checked:!1}),this.toggleDrawControl()}updateLabelOfOlGeometry(t,i){t.setProperties({_label:i},!0)}updateFontSizeAndStyle(t,i,n){t.setProperties({fontStyle_:`${i}px ${n}`},!0)}updateFillAndStrokeColor(t,i,n){t.setProperties({fillColor_:i,strokeColor_:n},!0)}updateOffset(t,i,n){t.setProperties({offsetX_:i,offsetY_:n},!0)}updateLabelType(t,i){t.setProperties({labelType_:i},!0)}updateMeasureUnit(t,i){t.setProperties({measureUnit_:i},!0)}getFeatureFontSize(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.fontStyle.split(" ")[0].replace("px",""):"15"}getFeatureFontStyle(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.fontStyle.substring(this.selectedFeatures$.value[0].properties.fontStyle.indexOf(" ")+1):fo.Arial}getFeatureFillColor(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)"}getFeatureStrokeColor(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)"}getFeatureOffsetX(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.offsetX:this.drawStyleService.getOffsetX()}getFeatureOffsetY(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.offsetY:"0"}get allFontStyles(){return Object.values(fo)}get allLayers(){return this.map.layers.filter(t=>String(t.id).includes("igo-draw-layer"))}updateHeightTable(){this.numberOfDrawings=this.activeStore.count$.getValue(),this.tableTemplate.tableHeight=this.numberOfDrawings>10?"35vh":"auto"}updateActiveLayer(){return this.allLayers.find(i=>i.title===this.activeDrawingLayer.title)||this.allLayers[0]}toggleDrawControl(){this.deactivateDrawControl(),this.activateDrawControl()}clearLabelsOfOlGeometry(t){(0,Do.aK)(t).forEach(i=>{i&&i.getMap()&&this.map.ol.removeOverlay(i)})}replaceFeatureInStore(t,i,n){this.activeStore.delete(t),this.onDrawEnd(i,n)}deactivateDrawControl(){this.activeDrawControl&&(this.drawEnd$$&&this.drawEnd$$.unsubscribe(),this.activeDrawControl.setOlMap(void 0),this.drawControlIsActive=!1)}activateDrawControl(){this.drawControlIsDisabled=!1,this.drawControlIsActive=!0,this.drawEnd$$=this.activeDrawControl.end$.subscribe(t=>{this.openDrawDialog(t,!0)}),this.activeDrawControl.modify$.subscribe(t=>{this.onModifyDraw(t)}),this.drawSelect$$||(this.drawSelect$$=this.activeDrawControl.select$.subscribe(t=>{this.openDrawDialog(t,!1)})),this.activeDrawControl.setOlMap(this.map.ol,!0)}isPoint(){return this.activeDrawControl.getGeometryType()===this.geometryType.Point}isLineString(){return this.activeDrawControl.getGeometryType()===this.geometryType.LineString}isPolygon(){return this.activeDrawControl.getGeometryType()===this.geometryType.Polygon}isCircle(){return this.activeDrawControl.getGeometryType()===this.geometryType.Circle}changeRadius(t){let i;i=t?this.measureUnit===Ft.K8.Meters?t:1e3*t:void 0,this.activeDrawControl.setOlInteractionStyle((p,v)=>{const k=p.getGeometry(),de=W.AF(k.getCoordinates(),this.map.projection,"EPSG:4326"),he=i/Math.cos(Math.PI/180*de[1])/v;return this.activeDrawControl.predefinedRadius$.next(i),new Ao.cp({image:new Pi.c({radius:he,stroke:new bo.c({width:1,color:"rgba(143,7,7,1)"}),fill:new wo.c({color:"rgba(255,255,255,0.4)"})})})}),this.toggleDrawControl()}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.radiusFormControl.setValue(this.measureUnit===Ft.K8.Meters?1e3*this.radiusFormControl.value:this.radiusFormControl.value/1e3))}elementStyle(t,i){this.activeStore.layer.ol.setStyle(i?(n,p)=>this.drawStyleService.createIndividualElementStyle(n,p,t,n.get("fontStyle"),n.get("drawingStyle").fill,n.get("drawingStyle").stroke,n.get("offsetX"),n.get("offsetY"),this.map.projection,this.icon):(n,p)=>this.drawStyleService.createIndividualElementStyle(n,p,t,n.get("fontStyle"),n.get("drawingStyle").fill,n.get("drawingStyle").stroke,n.get("offsetX"),n.get("offsetY"),this.map.projection))}getRadius(t){const i=(0,$.S2)(t);return Number(i/(2*Math.PI))}static \u0275fac=function(i){return new(i||l)(e.GI1(L.ov),e.GI1(Me.KE),e.GI1(En),e.GI1(bt.qW),e.GI1(Vr))};static \u0275cmp=e.In1({type:l,selectors:[["igo-draw"]],viewQuery:function(i,n){if(1&i&&e.CC$(Dl,5),2&i){let p;e.wto(p=e.Gqi())&&(n.select=p.first)}},inputs:{map:"map",stores:"stores",drawControls:"drawControls",activeDrawingLayer:"activeDrawingLayer"},outputs:{activeLayerChange:"activeLayerChange",drawControlsEvent:"drawControlsEvent",layersIDEvent:"layersIDEvent",fillColor:"fillColor",strokeColor:"strokeColor",strokeWidth:"strokeWidth",fontSize:"fontSize",fontStyle:"fontStyle"},standalone:!0,features:[e.UHJ],decls:50,vars:47,consts:[[1,"geometry-type-toggle","mat-typography"],[3,"value","change"],[3,"value"],[1,"draw-options","mat-typography"],[3,"disabled","checked","labelPosition","change"],[3,"checked","labelPosition","change"],[3,"checked","labelPosition","change",4,"ngIf"],["class","radius-unit",4,"ngIf"],[1,"layer-select-container"],["subscriptSizing","dynamic",1,"layer-select"],[3,"value","selectionChange"],["selectedLayer",""],[3,"value",4,"ngFor","ngForOf"],["id","createNewLayer"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","deleteBtn","mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","click",4,"ngIf"],[1,"table-compact",3,"store","template"],["table",""],[1,"icon-options"],[4,"ngIf"],[1,"actions-container"],["mat-icon-button","","color","accent","disableRipple","true",3,"click"],["svgIcon","keyboard-outline","tooltip-position","below","matTooltipShowDelay","500",1,"shortcuts-icon",3,"matTooltip"],["mat-raised-button","","color","primary",3,"matTooltip","click",4,"ngIf"],[1,"radius-unit"],[1,"radius"],["matInput","","type","number","min","0",3,"placeholder","formControl","readonly"],[1,"unit-field"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],[3,"svgIcon"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"deleteBtn",3,"matTooltip","disabled","click"],["svgIcon","delete"],["class","box",4,"ngIf"],["value","",3,"click"],[3,"value","click",4,"ngFor","ngForOf"],[1,"box"],[3,"src"],[3,"value","click"],["mat-raised-button","","color","primary",3,"matTooltip","click"],["aria-hidden","false","iconPositionEnd","","svgIcon","palette","matBadgeColor","warn","matBadgeSize","medium",1,"style-icon",3,"matBadge"]],template:function(i,n){if(1&i){const p=e.KQA();e.I0R(0,"div")(1,"div",0)(2,"mat-button-toggle-group",1),e.qCj("change",function(k){return n.onGeometryTypeChange(k.value)}),e.I0R(3,"mat-button-toggle",2),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.I0R(6,"mat-button-toggle",2),e.OEk(7),e.wVc(8,"translate"),e.C$Y(),e.I0R(9,"mat-button-toggle",2),e.OEk(10),e.wVc(11,"translate"),e.C$Y(),e.I0R(12,"mat-button-toggle",2),e.OEk(13),e.wVc(14,"translate"),e.C$Y()()(),e.I0R(15,"div",3)(16,"mat-slide-toggle",4),e.qCj("change",function(k){return n.onToggleDrawControl(k.checked)}),e.OEk(17),e.wVc(18,"translate"),e.C$Y(),e.I0R(19,"mat-slide-toggle",5),e.qCj("change",function(){return n.onToggleLabels()}),e.OEk(20),e.wVc(21,"translate"),e.C$Y(),e.yuY(22,Pl,3,5,"mat-slide-toggle",6)(23,Rl,7,7,"div",7),e.C$Y(),e.wR5(24,"mat-divider"),e.I0R(25,"div",8)(26,"mat-form-field",9)(27,"mat-label"),e.OEk(28),e.wVc(29,"translate"),e.C$Y(),e.I0R(30,"mat-select",10,11),e.qCj("selectionChange",function(){e.usT(p);const k=e.Gew(31);return e.CGJ(n.onLayerChange(k.value))}),e.yuY(32,Ll,2,2,"mat-option",12),e.I0R(33,"mat-option",13),e.OEk(34),e.wVc(35,"translate"),e.C$Y()()(),e.yuY(36,Gl,4,7,"button",14),e.C$Y(),e.wR5(37,"mat-divider"),e.I0R(38,"div"),e.yuY(39,$l,4,6,"button",15),e.I0R(40,"div"),e.wR5(41,"igo-entity-table",16,17),e.C$Y()(),e.I0R(43,"div",18),e.yuY(44,Bl,11,8,"mat-form-field",19),e.C$Y(),e.I0R(45,"div",20)(46,"button",21),e.qCj("click",function(){return n.openShorcutsDialog()}),e.wR5(47,"mat-icon",22),e.wVc(48,"translate"),e.C$Y(),e.yuY(49,Ul,5,7,"button",23),e.C$Y()()}2&i&&(e.yG2(2),e.E7m("value",n.geometryType.Point),e.yG2(),e.E7m("value",n.geometryType.Point),e.yG2(),e.oRS(" ",e.kDX(5,29,"igo.geo.draw."+n.geometryType.Point)," "),e.yG2(2),e.E7m("value",n.geometryType.LineString),e.yG2(),e.oRS(" ",e.kDX(8,31,"igo.geo.draw."+n.geometryType.LineString)," "),e.yG2(2),e.E7m("value",n.geometryType.Polygon),e.yG2(),e.oRS(" ",e.kDX(11,33,"igo.geo.draw."+n.geometryType.Polygon)," "),e.yG2(2),e.E7m("value",n.geometryType.Circle),e.yG2(),e.oRS(" ",e.kDX(14,35,"igo.geo.draw."+n.geometryType.Circle)," "),e.yG2(3),e.E7m("disabled",n.drawControlIsDisabled)("checked",n.drawControlIsActive)("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(18,37,"igo.geo.draw.drawControl")," "),e.yG2(2),e.E7m("checked",n.labelsAreShown)("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(21,39,"igo.geo.draw.toggleMapTooltips")," "),e.yG2(2),e.E7m("ngIf",!n.isPoint()),e.yG2(),e.E7m("ngIf",n.isCircle()),e.yG2(5),e.cNF(e.kDX(29,41,"igo.geo.draw.layer.title")),e.yG2(2),e.E7m("value",n.updateActiveLayer()),e.yG2(2),e.E7m("ngForOf",n.allLayers),e.yG2(2),e.oRS(" ",e.kDX(35,43,"igo.geo.draw.layer.createNewLayer")," "),e.yG2(2),e.E7m("ngIf",n.activeDrawingLayer),e.yG2(3),e.E7m("ngIf",n.activeStore.count$.getValue()>0),e.yG2(2),e.E7m("store",n.activeStore)("template",n.tableTemplate),e.yG2(3),e.E7m("ngIf",n.icons.length>=1),e.yG2(3),e.E7m("matTooltip",e.kDX(48,45,"igo.geo.draw.shortcuts")),e.yG2(2),e.E7m("ngIf",n.selectedFeatures$.value.length))},dependencies:[ro.ue,ro.gn,ro.KU,Co.GE,Co.cP,Xe.u_,ft.wb,ft.Up,ft.w5,Yt.cN,Yt.yi,Me.y,Me.ot,Me.O4,Me.ue,Me.Gu,Me.sl,Me.ug,At.d5,At.kX,At.gl,Gt.I5,Xe.Iw,Gt.Ax,Zt.U,Zt.k,ct.oJ,ct.Gw,ct.um,st.KO,st.a4,tt.oB,tt.qL,Ue.Eh,qe.g,qe.S,Xe.a,it.O0,it.sD],styles:["[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:25%}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .icon-options[_ngcontent-%COMP%]{margin:5px 5px 0}[_nghost-%COMP%]   .deleteBtn[_ngcontent-%COMP%]{margin-left:16px}[_nghost-%COMP%]   .edition-drawing[_ngcontent-%COMP%]{padding:10px 0}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .deleteBtn[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .storeTable[_ngcontent-%COMP%]{height:auto!important}[_nghost-%COMP%]   .layer-select[_ngcontent-%COMP%]{flex:1;margin-right:8px}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]{padding:10px}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:25%}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{left:8px;bottom:10px}[_nghost-%COMP%]   .radius[_ngcontent-%COMP%]{flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{flex:1;margin-left:8px}[_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:100%;padding:4px 8px}[_nghost-%COMP%]     igo-entity-table td:last-child{text-align:right!important}[_nghost-%COMP%]     igo-entity-table td:last-child button{margin:0%!important}[_nghost-%COMP%]   .layer-select-container[_ngcontent-%COMP%]{margin:16px 8px}[_nghost-%COMP%]   .actions-container[_ngcontent-%COMP%], [_nghost-%COMP%]   .layer-select-container[_ngcontent-%COMP%]{display:flex;align-items:center}"],data:{animation:[(0,J.gV)("openClose",[(0,J.K2)("open",(0,J.wb)({opacity:1})),(0,J.K2)("closed",(0,J.wb)({opacity:0})),(0,J.aK)("open => closed",[(0,J.Cs)("600ms ease")]),(0,J.aK)("closed => open",[(0,J.Cs)("800ms ease")])])]},changeDetection:0})}return l})();var Vl=s(28276),jl=s(53156),po=s(49312),aa=s(48908),la=s(36124);function Kl(l,m){}let Nr=(()=>{class l{cdRef;ngControl;olOverlayLayer;olGeoJSON=new X.c;ready=!1;drawControl;modifyControl;defaultDrawStyleRadius;olGeometryEnds$$;olGeometryChanges$$;olTooltip=this.createMeasureTooltip();activeControl;map;set geometryType(t){this._geometryType=t,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())}get geometryType(){return this._geometryType}_geometryType;drawGuide=null;measure=!1;get drawControlIsActive(){return this._drawControlIsActive}set drawControlIsActive(t){if(this._drawControlIsActive=t,!1!==this.ready){if(this.deactivateControl(),!this._drawControlIsActive)return;this.toggleControl()}}_drawControlIsActive=!0;get freehandDrawIsActive(){return this._freehandDrawIsActive}set freehandDrawIsActive(t){this._freehandDrawIsActive=t,this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),!1!==this.ready&&this.drawControlIsActive&&this.toggleControl()}_freehandDrawIsActive;get predefinedRadius(){return this._predefinedRadius}set predefinedRadius(t){this._predefinedRadius=t,this.drawControl.ispredefinedRadius$.next(t)}_predefinedRadius;controlOptions={};set drawStyle(t){void 0===t&&(t=(0,la.gD)()),this._drawStyle=t;const i=this.getGuideStyleFromDrawStyle(t);this.defaultDrawStyleRadius=void 0!==i?i.getRadius():null,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())}get drawStyle(){return this._drawStyle}_drawStyle;set overlayStyle(t){this._overlayStyle=t}get overlayStyle(){return this._overlayStyle}_overlayStyle;set value(t){this._value=t,!1!==this.ready&&(t?this.addGeoJSONToOverlay(t):this.olOverlaySource.clear(!0),this.onChange(t),this.toggleControl(),this.cdRef.detectChanges())}get value(){return this._value}_value;get olOverlaySource(){return this.olOverlayLayer.getSource()}set radius(t){if(!1!==this.ready&&(this.modifyControl.getSource()&&this.modifyControl.getSource().refresh(),this.freehandDrawIsActive)){let i;setTimeout(()=>{i=this.modifyControl.olModifyInteraction,i&&i.features_&&(i.features_.clear(),this.addGeoJSONToOverlay(this.value))},0)}}constructor(t,i){this.cdRef=t,this.ngControl=i,void 0!==this.ngControl&&(this.ngControl.valueAccessor=this)}ngOnInit(){void 0===this.drawStyle&&(this.drawStyle=(0,la.gD)()),void 0===this.overlayStyle&&(this.overlayStyle=this.drawStyle),this.addOlOverlayLayer(),this.createDrawControl(),this.createModifyControl(),this.value&&this.addGeoJSONToOverlay(this.value),this.toggleControl(),this.ready=!0}ngOnDestroy(){this.ready=!1,this.deactivateControl(),this.olOverlaySource.clear(),this.map.ol.removeLayer(this.olOverlayLayer)}registerOnChange(t){this.onChange=t}onChange=()=>{};registerOnTouched(t){this.onTouched=t}onTouched=()=>{};writeValue(t){this.value=t}addOlOverlayLayer(){this.olOverlayLayer=new jl.c({source:new C.c,zIndex:500,style:null}),this.map.ol.addLayer(this.olOverlayLayer)}createDrawControl(){const t=Object.assign({},this.controlOptions,{geometryType:this.geometryType||"Point",drawingLayer:this.olOverlayLayer,interactionStyle:"function"==typeof this.drawStyle?this.drawStyle:(i,n)=>{const p=this.drawStyle;return this.updateDrawStyleWithDrawGuide(p,n),p}});this.drawControl=new aa.i4(t)}createModifyControl(){const t=Object.assign({},this.controlOptions,{layer:this.olOverlayLayer,drawStyle:"function"==typeof this.drawStyle?this.drawStyle:(i,n)=>{const p=this.drawStyle;return this.updateDrawStyleWithDrawGuide(p,n),p}});this.modifyControl=new aa.Up(t)}toggleControl(){let t;t=!this.value&&this.geometryType?this.drawControl:this.modifyControl,t!==this.activeControl&&(this.deactivateControl(),this.activateControl(t))}activateControl(t){this.activeControl=t,this.olGeometryEnds$$=t.end$.subscribe(i=>this.onOlGeometryEnds(i)),!0===this.measure&&t===this.drawControl&&(this.olGeometryChanges$$=t.changes$.subscribe(i=>this.onOlGeometryChanges(i))),t.setOlMap(this.map.ol,!1)}deactivateControl(){this.removeMeasureTooltip(),void 0!==this.activeControl&&this.activeControl.setOlMap(void 0),void 0!==this.olGeometryEnds$$&&this.olGeometryEnds$$.unsubscribe(),void 0!==this.olGeometryChanges$$&&this.olGeometryChanges$$.unsubscribe(),this.activeControl=void 0}onOlGeometryEnds(t){this.removeMeasureTooltip(),this.setOlGeometry(t)}onOlGeometryChanges(t){"Point"!==t.getType()&&this.updateMeasureTooltip(t)}setOlGeometry(t){let i;void 0!==t&&("Circle"===t.getType()&&(t=this.circleToPoint(t)),i=this.olGeoJSON.writeGeometryObject(t,{featureProjection:this.map.projection,dataProjection:"EPSG:4326"}),t.get("radius")&&(i.radius=t.get("radius"),t.set("radius",i.radius)),this.writeValue(i))}circleToPoint(t){const i=t.getCenter(),n=W.AF(i,this.map.projection,"EPSG:4326"),p=Math.round(t.getRadius()*Math.cos(Math.PI/180*n[1]));return(t=new c.c(i)).set("radius",p,!0),t}addGeoJSONToOverlay(t){const i=this.olGeoJSON.readGeometry(t,{dataProjection:"EPSG:4326",featureProjection:this.map.projection}),n=new Y.c({geometry:i});n.setStyle(this.overlayStyle),this.olOverlaySource.clear(),this.olOverlaySource.addFeature(n)}createMeasureTooltip(){return new Vl.c({element:document.createElement("div"),offset:[-30,-10],className:["igo-map-tooltip","igo-map-tooltip-measure"].join(" "),stopEvent:!1})}updateMeasureTooltip(t){const n=(0,po.ox)(t,this.map.projection).lengths,p="Polygon"===t.getType()?n.length-2:n.length-1,v=n[p],k=(0,po.ie)(t),de=k[p];if(0===k.length||void 0===de)return void this.removeMeasureTooltip();this.olTooltip.setPosition(de.getFlatCoordinates());const he=(0,po.wP)(v,{decimal:1,unit:po.K8.Meters,unitAbbr:!0,locale:"fr"});this.olTooltip.getElement().innerHTML=he,void 0===this.olTooltip.getMap()&&this.map.ol.addOverlay(this.olTooltip)}removeMeasureTooltip(){this.olTooltip.getMap&&void 0!==this.olTooltip.getMap()&&(this.map.ol.removeOverlay(this.olTooltip),this.olTooltip.setMap(void 0))}updateDrawStyleWithDrawGuide(t,i){const n=this.getGuideStyleFromDrawStyle(t);if(void 0===n)return;const p=this.drawGuide;let v;v=!p||p<0?this.defaultDrawStyleRadius:p>0?p/i:p,n.setRadius(v)}getGuideStyleFromDrawStyle(t){let i,n;return i=Array.isArray(t)?t[0]:t,"function"==typeof i.getImage&&(i=i.getImage()),"function"==typeof i.setRadius&&(n=i),n}static \u0275fac=function(i){return new(i||l)(e.GI1(e.kD9),e.GI1(Me.eq,10))};static \u0275cmp=e.In1({type:l,selectors:[["igo-geometry-form-field-input"]],inputs:{map:"map",geometryType:"geometryType",drawGuide:"drawGuide",measure:"measure",drawControlIsActive:"drawControlIsActive",freehandDrawIsActive:"freehandDrawIsActive",predefinedRadius:"predefinedRadius",controlOptions:"controlOptions",drawStyle:"drawStyle",overlayStyle:"overlayStyle",value:"value",radius:"radius"},standalone:!0,features:[e.UHJ],decls:1,vars:0,template:function(i,n){1&i&&e.yuY(0,Kl,0,0,"ng-template")},encapsulation:2,changeDetection:0})}return l})();var so=s(99228);function Wl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",17),e.qCj("change",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.onDrawControlChange())}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("checked",t.drawControlIsActive)("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(2,3,"igo.geo.spatialFilter.drawControl")," ")}}function Nl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",17),e.qCj("change",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.onfreehandControlChange())}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("checked",t.freehandDrawIsActive)("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(2,3,"igo.geo.spatialFilter.freehandControl")," ")}}function Hl(l,m){if(1&l&&(e.I0R(0,"mat-option",6),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.measure."+t)," ")}}function zl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",18)(1,"mat-form-field",19),e.wR5(2,"input",20),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"mat-form-field",21)(5,"mat-select",22),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onMeasureUnitChange(n.value))}),e.yuY(6,Hl,3,4,"mat-option",23),e.C$Y()()()}if(2&l){const t=e.GaO();e.yG2(2),e._6D("placeholder",e.kDX(3,6,"igo.geo.spatialFilter.buffer")),e.E7m("formControl",t.bufferFormControl)("value",0)("readonly",null===t.formControl.value),e.yG2(3),e.E7m("value",t.measureUnit),e.yG2(),e.E7m("ngForOf",t.measureUnits)}}function Xl(l,m){if(1&l&&(e.I0R(0,"mat-option",6),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.measure."+t)," ")}}function Jl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",24)(1,"mat-form-field",25)(2,"input",26),e.qCj("input",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.getRadius())}),e.wVc(3,"translate"),e.C$Y()(),e.I0R(4,"mat-form-field",21)(5,"mat-select",22),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onMeasureUnitChange(n.value))}),e.yuY(6,Xl,3,4,"mat-option",23),e.C$Y()()()}if(2&l){const t=e.GaO();e.yG2(2),e._6D("placeholder",e.kDX(3,6,"igo.geo.spatialFilter.radius")),e.E7m("formControl",t.radiusFormControl)("value",1e3)("readonly",t.freehandDrawIsActive&&null===t.formControl.value),e.yG2(3),e.E7m("value",t.measureUnit),e.yG2(),e.E7m("ngForOf",t.measureUnits)}}function Ql(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-radio-button",27),e.qCj("change",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onItemTypeChange(n))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.spatialFilter."+t)," ")}}function Zl(l,m){1&l&&(e.I0R(0,"mat-header-cell",38),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.cNF(e.kDX(2,1,"igo.geo.spatialFilter.Thematics")))}function ql(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-header-cell",39)(1,"mat-checkbox",40),e.qCj("change",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(n?p.masterToggle():null)}),e.C$Y()()}if(2&l){const t=e.GaO(2);e.yG2(),e.E7m("checked",t.isAllSelected())("indeterminate",t.selectedThematics.hasValue()&&!t.isAllSelected())}}function ec(l,m){1&l&&e.wR5(0,"mat-header-row")}function tc(l,m){1&l&&e.wR5(0,"mat-row")}function oc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-tree-node",41)(1,"li",42),e.wR5(2,"button",43),e.OEk(3),e.I0R(4,"mat-checkbox",44),e.qCj("click",function(n){return n.stopPropagation()})("change",function(n){const v=e.usT(t).$implicit,k=e.GaO(2);return e.CGJ(n?k.onToggleChange(v):null)}),e.C$Y()()()}if(2&l){const t=m.$implicit,i=e.GaO(2);e.yG2(3),e.oRS(" ",t.name," "),e.yG2(),e.E7m("checked",i.selectedThematics.isSelected(t))}}function ic(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-nested-tree-node")(1,"div",42)(2,"button",45),e.qCj("click",function(){const p=e.usT(t).$implicit,v=e.GaO(2);return e.CGJ(v.onToggleClick(p))}),e.wR5(3,"mat-icon",46),e.C$Y(),e.OEk(4),e.I0R(5,"mat-checkbox",47),e.qCj("change",function(n){const v=e.usT(t).$implicit,k=e.GaO(2);return e.CGJ(n?k.childrensToggle(v):null)}),e.C$Y()(),e.I0R(6,"ul",48),e.C_f(7,49),e.C$Y()()}if(2&l){const t=m.$implicit,i=e.GaO(2);e.yG2(3),e.E7m("svgIcon",i.treeControl.isExpanded(t)?"chevron-down":"chevron-right"),e.yG2(),e.oRS(" ",t.name," "),e.yG2(),e.E7m("checked",i.isAllSelected(t))("indeterminate",i.hasChildrenSelected(t)&&!i.isAllSelected(t)),e.yG2(),e.eAK("example-tree-invisible",!i.treeControl.isExpanded(t))}}function nc(l,m){if(1&l&&(e.I0R(0,"div",28)(1,"mat-table"),e.SAx(2,29),e.yuY(3,Zl,3,3,"mat-header-cell",30),e.k70(),e.SAx(4,31),e.yuY(5,ql,2,2,"mat-header-cell",32),e.k70(),e.yuY(6,ec,1,0,"mat-header-row",33)(7,tc,1,0,"mat-row",34),e.C$Y(),e.I0R(8,"mat-tree",35),e.yuY(9,oc,5,2,"mat-tree-node",36)(10,ic,8,6,"mat-nested-tree-node",37),e.C$Y()()),2&l){const t=e.GaO();e.yG2(6),e.E7m("matHeaderRowDef",t.displayedColumns),e.yG2(),e.E7m("matRowDefColumns",t.displayedColumns),e.yG2(),e.E7m("dataSource",t.dataSource)("treeControl",t.treeControl),e.yG2(2),e.E7m("matTreeNodeDefWhen",t.hasChild)}}function rc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",50),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.clearSearch())}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("disabled",t.disabledClearSearch()),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.spatialFilter.clearSearch")," ")}}function sc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",51),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.clearDrawZone())}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("disabled",null===t.formControl.value),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.spatialFilter.clearForm")," ")}}function ac(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",52),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleVisibleList())}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",53),e.C$Y()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.spatialFilter.showSearchResults"))}function lc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",57),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.toggleVisibleList())}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",58),e.C$Y()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.spatialFilter.hideSearchResults"))}function cc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",54),e.yuY(1,lc,3,3,"button",55),e.I0R(2,"igo-entity-table",56),e.qCj("entitySelectChange",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.entityChange.emit(n))}),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",t.listIsVisible),e.yG2(),e.E7m("template",t.tableTemplate)("store",t.store)}}let Hr=(()=>{class l{cdRef;spatialFilterService;messageService;languageService;map;get type(){return this._type}set type(t){this._type=t;const i=this.geometryTypes.findIndex(n=>n===this.type);if(this.geometryType=this.geometryTypes[i],this.formControl.reset(),this.radius=void 0,this.drawGuide$.next(null),this.drawStyle$.next(void 0),this.type===qt.Predefined&&this.formControl.setValue({type:"Point",coordinates:""}),this.type===qt.Point)this.radius=1e3,this.radiusFormControl.setValue(this.radius),this.PointStyle=(n,p)=>{const v=n.getGeometry(),k=W.AF(v.getCoordinates(),this.map.projection,"EPSG:4326");return new Ao.cp({image:new Pi.c({radius:this.radius/Math.cos(Math.PI/180*k[1])/p,stroke:new bo.c({width:2,color:"rgba(0, 153, 255)"}),fill:new wo.c({color:"rgba(0, 153, 255, 0.2)"})})})},this.overlayStyle=this.PointStyle,this.drawStyle$.next(this.overlayStyle);else{this.radius=void 0,this.PolyStyle=()=>new Ao.cp({stroke:new bo.c({width:2,color:"rgba(0, 153, 255)"}),fill:new wo.c({color:"rgba(0, 153, 255, 0.2)"})});const n=[0,153,255],p=()=>new Ao.cp({image:new Pi.c({radius:8,stroke:new bo.c({width:2,color:"rgba(0, 153, 255)"}),fill:new wo.c({color:"rgba(0, 153, 255, 0.2)"})}),stroke:new bo.c({color:n.concat([1]),width:2}),fill:new wo.c({color:n.concat([.2])})});this.overlayStyle=this.PolyStyle,this.drawStyle$.next(p)}this.overlayStyle$.next(this.overlayStyle)}_type;queryType;zone;loading;get store(){return this._store}set store(t){this._store=t,this._store.entities$.subscribe(()=>{this.cdRef.detectChanges()})}_store;get measureUnits(){return[po.K8.Meters,po.K8.Kilometers]}layers=[];allLayers=[];get thematicLength(){return this._thematicLength}set thematicLength(t){this._thematicLength=t}_thematicLength;toggleSearch=new e._w7;itemTypeChange=new e._w7;thematicChange=new e._w7;drawZoneEvent=new e._w7;bufferEvent=new e._w7;zoneWithBufferChange=new e._w7;measureUnitChange=new e._w7;radiusEvent=new e._w7;freehandControl=new e._w7;predefinedRadius=new e._w7;clearButtonEvent=new e._w7;clearSearchEvent=new e._w7;export=new e._w7;openWorkspace=new e._w7;entityChange=new e._w7;itemType=[Te.Address,Te.Thematics];selectedItemType=Te.Address;selectedSourceAddress;treeControl=new Br.Mb(t=>t.children);displayedColumns=["name","select"];childrens=[];groups=[];thematics=[];dataSource=new Ci.wD;selectedThematics=new kr.e2(!0,[]);value$=new A.g(void 0);drawGuide$=new A.g(null);overlayStyle$=new A.g(void 0);drawStyle$=new A.g(void 0);value$$;radiusChanges$$;bufferChanges$$;formControl=new Me.yM;geometryType;geometryTypeField=!1;geometryTypes=[Jt.Point,Jt.Polygon];drawGuideField=!1;drawGuide=null;drawGuidePlaceholder="";measure=!1;drawControlIsActive=!0;freehandDrawIsActive=!1;drawStyle;drawZone;overlayStyle;PointStyle;PolyStyle;radius;buffer=0;radiusFormControl=new Me.yM;bufferFormControl=new Me.yM;measureUnit=po.K8.Meters;zoneWithBuffer;listIsVisible=!0;tableTemplate;constructor(t,i,n,p){this.cdRef=t,this.spatialFilterService=i,this.messageService=n,this.languageService=p}ngOnInit(){this.spatialFilterService.loadThematicsList().subscribe(n=>{for(const v of n)this.childrens.push(v),this.childrens.sort((k,de)=>k.name.localeCompare(de.name));this.groups.push(this.languageService.translate.instant("igo.geo.terrapi.limites"));const p={name:this.groups[0],children:[]};this.thematics.push(p),this.childrens.forEach(v=>{v.group&&-1===this.groups.indexOf(v.group)&&(this.groups.push(v.group),this.thematics.push({name:v.group,children:[]})),v.group||(v.name===this.languageService.translate.instant("igo.geo.terrapi.AdmRegion")||v.name===this.languageService.translate.instant("igo.geo.terrapi.Mun")||v.name===this.languageService.translate.instant("igo.geo.terrapi.Arrond")||v.name===this.languageService.translate.instant("igo.geo.terrapi.CircFed")||v.name===this.languageService.translate.instant("igo.geo.terrapi.CircProv")||v.name===this.languageService.translate.instant("igo.geo.terrapi.DirReg")||v.name===this.languageService.translate.instant("igo.geo.terrapi.MRC")||v.name===this.languageService.translate.instant("igo.geo.terrapi.RegTour")?v.group=p.name:v.name===this.languageService.translate.instant("igo.geo.terrapi.routes")?v.group=this.languageService.translate.instant("igo.geo.spatialFilter.group.transport"):this.thematics.push({name:v.name,children:[],source:v.source})),this.thematics.sort((k,de)=>k.name.localeCompare(de.name))}),this.thematics.forEach(v=>{for(const k of this.childrens)k.group===v.name&&v.children.push(k)})}),this.dataSource.data=this.thematics,this.drawGuide$.next(null),this.value$.next(this.formControl.value?this.formControl.value:void 0),this.value$$=this.formControl.valueChanges.subscribe(n=>{n?(this.value$.next(n),this.drawZone=this.formControl.value,0!==this.buffer&&(this.drawZoneEvent.emit(this.drawZone),this.bufferFormControl.setValue(this.buffer))):(this.value$.next(void 0),this.drawZone=void 0)}),this.value$.subscribe(()=>{this.getRadius(),this.cdRef.detectChanges()}),this.radiusChanges$$=this.radiusFormControl.valueChanges.subscribe(()=>{this.getRadius(),this.cdRef.detectChanges()}),this.bufferChanges$$=this.bufferFormControl.valueChanges.pipe((0,vo.o)(500)).subscribe(n=>{this.measureUnit===po.K8.Meters&&n>0&&n<=1e5?(this.buffer=n,this.bufferEvent.emit(n),this.spatialFilterService.loadBufferGeometry(this.drawZone,qt.Polygon,n).subscribe(p=>{this.zoneWithBuffer=p,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):this.measureUnit===po.K8.Kilometers&&n>0&&n<=100?(this.buffer=n,this.bufferEvent.emit(n),this.spatialFilterService.loadBufferGeometry(this.drawZone,qt.Polygon,1e3*n).subscribe(p=>{this.zoneWithBuffer=p,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):0===n?(this.buffer=n,this.bufferEvent.emit(n),this.drawZoneEvent.emit(this.drawZone)):(n<0||this.measureUnit===po.K8.Meters&&n>1e5||this.measureUnit===po.K8.Kilometers&&n>100)&&(this.bufferFormControl.setValue(0),this.buffer=0,this.messageService.alert("igo.geo.spatialFilter.bufferAlert","igo.geo.spatialFilter.warning"))});const t=new Ue.xx({}),i=new at.kj({layer:new so.Md({zIndex:300,source:new Ro.EB,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1}),map:this.map,hitTolerance:15,motion:at.Su.Default,many:!0,dragBox:!0});this.store.addStrategy(i,!0),this.store.addStrategy(t,!1)}ngOnDestroy(){this.value$$.unsubscribe(),this.radiusChanges$$.unsubscribe(),this.bufferChanges$$.unsubscribe(),this.cdRef.detach(),this.radiusChanges$$&&this.radiusChanges$$.unsubscribe(),this.value$$&&this.value$$.unsubscribe()}onItemTypeChange(t){this.selectedItemType=t.value,this.itemTypeChange.emit(this.selectedItemType)}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.measureUnitChange.emit(this.measureUnit),this.isPolygon()?this.bufferFormControl.setValue(this.measureUnit===po.K8.Meters?1e3*this.bufferFormControl.value:this.bufferFormControl.value/1e3):this.isPoint()&&this.radiusFormControl.setValue(this.measureUnit===po.K8.Meters?1e3*this.radiusFormControl.value:this.radiusFormControl.value/1e3))}isPredefined(){return this.type===qt.Predefined}isPolygon(){return this.type===qt.Polygon}isPoint(){return this.type===qt.Point}hasChild(t,i){return!!i.children&&i.children.length}onToggleClick(t){this.treeControl.isExpanded(t)?this.treeControl.collapse(t):this.treeControl.expand(t)}isAllSelected(t){let i,n=0;return t?(i=t.children.length,t.children.forEach(p=>{this.selectedThematics.selected.find(v=>v===p)&&n++})):(i=this.selectedThematics.selected.length,this.thematics.forEach(p=>{-1===this.groups.indexOf(p.name)&&n++}),this.childrens.forEach(p=>{this.thematics.find(v=>v.source===p.source)||n++})),n>=1&&i===n}hasChildrenSelected(t){let i=!1;return t.children.forEach(n=>{this.selectedThematics.selected.find(p=>p.source===n.source)&&(i=!0)}),i}masterToggle(){this.isAllSelected()?this.selectedThematics.clear():this.selectAll();const t=[];for(const i of this.selectedThematics.selected)t.push(i);this.isAllSelected()?this.thematics.forEach(i=>{this.hasChild(0,i)&&this.treeControl.expand(i)}):this.thematics.forEach(i=>{this.hasChild(0,i)&&this.treeControl.collapse(i)}),this.thematicChange.emit(t)}selectAll(t){t?this.hasChild(0,t)&&t.children.forEach(i=>this.selectedThematics.select(i)):(this.thematics.forEach(i=>{-1===this.groups.indexOf(i.name)&&this.selectedThematics.select(i)}),this.childrens.forEach(i=>{this.selectedThematics.selected.find(n=>n.source===i.source)||this.selectedThematics.select(i)}))}childrensToggle(t){this.isAllSelected(t)?t.children.forEach(n=>this.selectedThematics.deselect(n)):this.selectAll(t);const i=[];for(const n of this.selectedThematics.selected)i.push(n);this.treeControl.expand(t),this.thematicChange.emit(i)}onToggleChange(t){let i=!1;void 0!==this.selectedThematics.selected.find(p=>p.source===t.source)&&(i=!0),this.childrens.forEach(p=>{p===t&&!1===i&&this.selectedThematics.select(p),p===t&&!0===i&&this.selectedThematics.deselect(p)}),this.thematics.forEach(p=>{p===t&&!1===i&&this.selectedThematics.select(p),p===t&&!0===i&&this.selectedThematics.deselect(p)});const n=[];for(const p of this.selectedThematics.selected)n.push(p);this.thematicChange.emit(n)}onDrawControlChange(){this.drawControlIsActive=!this.drawControlIsActive}onfreehandControlChange(){this.freehandDrawIsActive=!this.freehandDrawIsActive,this.freehandControl.emit(this.freehandDrawIsActive),this.isPoint()?(this.predefinedRadius.emit(!this.freehandDrawIsActive),this.freehandDrawIsActive&&(this.overlayStyle$.next(void 0),this.drawStyle$.next(void 0))):this.predefinedRadius.emit(!1)}toggleSearchButton(){this.isPredefined()||(this.buffer>0?(this.zoneWithBuffer.meta={id:void 0,title:"Zone"},this.zoneWithBuffer.properties={nom:"Zone",type:this.type},this.drawZoneEvent.emit(this.zoneWithBuffer)):(this.drawZone.meta={id:void 0,title:"Zone"},this.drawZone.properties={nom:"Zone",type:this.type},this.drawZoneEvent.emit(this.drawZone))),this.isPoint()?this.radiusEvent.emit(this.radius):this.isPolygon()&&this.bufferEvent.emit(this.buffer),this.toggleSearch.emit(),this.store.entities$.pipe((0,vo.o)(500)).subscribe(t=>{t.length&&this.layers.length===this.thematicLength+1&&(this.openWorkspace.emit(),this.createTableTemplate())})}clearButton(){this.loading=!0,this.store&&this.store.clear(),(this.isPoint()||this.isPolygon())&&(this.drawZone=void 0,this.formControl.reset()),this.bufferFormControl.setValue(0),this.buffer=0,this.bufferEvent.emit(0),this.clearButtonEvent.emit(),this.loading=!1,this.tableTemplate=void 0}clearDrawZone(){this.formControl.reset(),this.bufferFormControl.setValue(0),this.buffer=0}clearSearch(){this.selectedThematics.clear(),this.bufferFormControl.setValue(0),this.buffer=0,this.bufferEvent.emit(0),this.thematicChange.emit([]),this.clearSearchEvent.emit()}disableSearchButton(){if(this.type===qt.Predefined){if(this.selectedItemType===Te.Address&&void 0!==this.queryType&&void 0!==this.zone)return this.loading;if(this.selectedItemType===Te.Thematics&&void 0!==this.queryType&&void 0!==this.zone&&this.selectedThematics.selected.length>0)return this.loading}if(this.type===qt.Polygon||this.type===qt.Point){if(this.selectedItemType===Te.Address&&null!==this.formControl.value)return this.loading;if(this.selectedItemType===Te.Thematics&&this.selectedThematics.selected.length>0&&null!==this.formControl.value)return this.loading}return!0}disabledClearSearch(){let t=!0;return t=this.selectedItemType===Te.Address?void 0===this.queryType:void 0===this.queryType&&0===this.selectedThematics.selected.length,t}getRadius(){let t;if(t=null!==this.formControl.value?this.measureUnit===po.K8.Meters?this.formControl.value.radius:this.formControl.value.radius/1e3:void 0,this.type===qt.Point){if(this.freehandDrawIsActive){if(t){if(t>=1e5)return this.messageService.alert("igo.geo.spatialFilter.radiusAlert","igo.geo.spatialFilter.warning"),void this.formControl.reset();if(t!==this.radiusFormControl.value)return void this.radiusFormControl.setValue(t)}}else if(this.radiusFormControl.value<0||this.measureUnit===po.K8.Meters&&this.radiusFormControl.value>=1e5||this.measureUnit===po.K8.Kilometers&&this.radiusFormControl.value>=100)return this.messageService.alert("igo.geo.spatialFilter.radiusAlert","igo.geo.spatialFilter.warning"),this.radius=1e3,this.radiusFormControl.setValue(this.measureUnit===po.K8.Meters?this.radius:this.radius/1e3),void this.drawGuide$.next(this.radius);this.measureUnit===po.K8.Meters?(this.radius=this.radiusFormControl.value,this.drawGuide$.next(this.radius)):(this.radius=1e3*this.radiusFormControl.value,this.drawGuide$.next(1e3*this.radius)),this.overlayStyle$.next(this.PointStyle),this.drawStyle$.next(this.PointStyle)}}toggleVisibleList(){this.listIsVisible=!this.listIsVisible}createTableTemplate(){const t={name:"meta.title",title:this.languageService.translate.instant("igo.geo.spatialFilter.type"),renderer:Ue.G8.UnsanitizedHTML},i={name:"properties.nom",title:this.languageService.translate.instant("igo.geo.spatialFilter.searchResults"),renderer:Ue.G8.UnsanitizedHTML};this.tableTemplate={selection:!0,sort:!0,columns:[t,i]}}static \u0275fac=function(i){return new(i||l)(e.GI1(e.kD9),e.GI1(ut),e.GI1(Qt.mi),e.GI1(L.ov))};static \u0275cmp=e.In1({type:l,selectors:[["igo-spatial-filter-item"]],inputs:{map:"map",type:"type",queryType:"queryType",zone:"zone",loading:"loading",store:"store",layers:"layers",allLayers:"allLayers",thematicLength:"thematicLength"},outputs:{toggleSearch:"toggleSearch",itemTypeChange:"itemTypeChange",thematicChange:"thematicChange",drawZoneEvent:"drawZoneEvent",bufferEvent:"bufferEvent",zoneWithBufferChange:"zoneWithBufferChange",measureUnitChange:"measureUnitChange",radiusEvent:"radiusEvent",freehandControl:"freehandControl",predefinedRadius:"predefinedRadius",clearButtonEvent:"clearButtonEvent",clearSearchEvent:"clearSearchEvent",export:"export",openWorkspace:"openWorkspace",entityChange:"entityChange"},standalone:!0,features:[e.UHJ],decls:29,vars:43,consts:[[3,"formControl","map","geometryType","drawGuide","measure","drawControlIsActive","freehandDrawIsActive","drawStyle","overlayStyle","radius","predefinedRadius"],[1,"header"],[3,"checked","labelPosition","change",4,"ngIf"],["class","buffer-unit",4,"ngIf"],["class","radius-unit",4,"ngIf"],[1,"title","mat-typography"],[3,"value"],[3,"value","change",4,"ngFor","ngForOf"],["class","thematics",4,"ngIf"],[1,"buttons"],["mat-raised-button","","class","clear-search-button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","class","clear-form-button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary",1,"search-button",3,"disabled","click"],["mat-raised-button","",1,"remove-button",3,"disabled","click"],["mat-raised-button","",1,"export-button",3,"disabled","click"],["class","chevron-down","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["class","results",4,"ngIf"],[3,"checked","labelPosition","change"],[1,"buffer-unit"],[1,"buffer"],["type","number","matInput","",3,"placeholder","formControl","value","readonly"],[1,"unit-field"],[3,"value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"radius-unit"],[1,"radius"],["type","number","matInput","",3,"placeholder","formControl","value","readonly","input"],[3,"value","change"],[1,"thematics"],["matColumnDef","name"],["class","thematics-header",4,"matHeaderCellDef"],["matColumnDef","select"],["class","checks-header",4,"matHeaderCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[3,"dataSource","treeControl"],["matTreeNodeToggle","",4,"matTreeNodeDef"],[4,"matTreeNodeDef","matTreeNodeDefWhen"],[1,"thematics-header"],[1,"checks-header"],[3,"checked","indeterminate","change"],["matTreeNodeToggle",""],[1,"mat-tree-node"],["mat-icon-button","","disabled",""],[1,"tree-check",3,"checked","click","change"],["mat-icon-button","",3,"click"],[3,"svgIcon"],[1,"tree-check-2",3,"checked","indeterminate","change"],[1,"tree-ul"],["matTreeNodeOutlet",""],["mat-raised-button","",1,"clear-search-button",3,"disabled","click"],["mat-raised-button","",1,"clear-form-button",3,"disabled","click"],["mat-icon-button","","matTooltipShowDelay","500",1,"chevron-down",3,"matTooltip","click"],["svgIcon","chevron-down"],[1,"results"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],[1,"results-list",3,"template","store","entitySelectChange"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click"],["svgIcon","chevron-up"]],template:function(i,n){1&i&&(e.wR5(0,"igo-geometry-form-field-input",0),e.wVc(1,"async"),e.wVc(2,"async"),e.wVc(3,"async"),e.I0R(4,"div",1),e.yuY(5,Wl,3,5,"mat-slide-toggle",2)(6,Nl,3,5,"mat-slide-toggle",2),e.C$Y(),e.yuY(7,zl,7,8,"div",3)(8,Jl,7,8,"div",4),e.I0R(9,"mat-label",5),e.OEk(10),e.wVc(11,"translate"),e.C$Y(),e.I0R(12,"mat-radio-group",6),e.yuY(13,Ql,3,4,"mat-radio-button",7),e.C$Y(),e.yuY(14,nc,11,5,"div",8),e.I0R(15,"div",9),e.yuY(16,rc,3,4,"button",10)(17,sc,3,4,"button",11),e.I0R(18,"button",12),e.qCj("click",function(){return n.toggleSearchButton()}),e.OEk(19),e.wVc(20,"translate"),e.C$Y(),e.I0R(21,"button",13),e.qCj("click",function(){return n.clearButton()}),e.OEk(22),e.wVc(23,"translate"),e.C$Y(),e.I0R(24,"button",14),e.qCj("click",function(){return n.export.emit()}),e.OEk(25),e.wVc(26,"translate"),e.C$Y()(),e.yuY(27,ac,3,3,"button",15)(28,cc,3,3,"div",16)),2&i&&(e.E7m("formControl",n.formControl)("map",n.map)("geometryType",n.geometryType)("drawGuide",e.kDX(1,29,n.drawGuide$))("measure",n.measure)("drawControlIsActive",n.drawControlIsActive)("freehandDrawIsActive",n.freehandDrawIsActive)("drawStyle",e.kDX(2,31,n.drawStyle$))("overlayStyle",e.kDX(3,33,n.overlayStyle$))("radius",n.radius)("predefinedRadius",n.predefinedRadius),e.yG2(5),e.E7m("ngIf",!n.isPredefined()),e.yG2(),e.E7m("ngIf",!n.isPredefined()),e.yG2(),e.E7m("ngIf",n.isPolygon()),e.yG2(),e.E7m("ngIf",n.isPoint()),e.yG2(2),e.oRS("",e.kDX(11,35,"igo.geo.spatialFilter.search")," :\n"),e.yG2(2),e.E7m("value",n.selectedItemType),e.yG2(),e.E7m("ngForOf",n.itemType),e.yG2(),e.E7m("ngIf","Thematics"===n.selectedItemType&&!n.tableTemplate||"Thematics"===n.selectedItemType&&n.tableTemplate&&!n.listIsVisible),e.yG2(2),e.E7m("ngIf",n.isPredefined()),e.yG2(),e.E7m("ngIf",n.isPolygon()||n.isPoint()),e.yG2(),e.E7m("disabled",n.disableSearchButton()),e.yG2(),e.oRS(" ",e.kDX(20,37,"igo.geo.spatialFilter.goSearch")," "),e.yG2(2),e.E7m("disabled",0===n.allLayers.length),e.yG2(),e.oRS(" ",e.kDX(23,39,"igo.geo.spatialFilter.removeLayer")," "),e.yG2(2),e.E7m("disabled",!n.store.entities$.getValue().length),e.yG2(),e.oRS(" ",e.kDX(26,41,"igo.geo.spatialFilter.exportLayer")," "),e.yG2(2),e.E7m("ngIf",n.store.all().length&&n.tableTemplate&&!n.listIsVisible),e.yG2(),e.E7m("ngIf",n.store.all().length&&n.tableTemplate&&n.listIsVisible))},dependencies:[Nr,Me.y,Me.ot,Me.O4,Me.ue,Me.sl,Me.ug,Xe.u_,Co.GE,Co.cP,ft.wb,ft.Up,ft.w5,Yt.cN,Yt.yi,At.d5,At.kX,Gt.I5,Xe.Iw,Gt.Ax,Mo.yk,Mo.cv,Mo.cT,ri.If,ri.wL,ri.ie,ri.aG,ri.Af,ri.gx,ri.qC,ri.yC,ri._I,Lt.Vn,Lt.WK,Ci.qC,Ci.kJ,Ci.S_,Ci.BN,Ci.BD,Ci.kB,Ci.Mx,ct.oJ,ct.Gw,ct.um,tt.oB,tt.qL,st.KO,st.a4,Ue.Eh,Xe.a,it.O0,it.sD],styles:["[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{margin-top:5px;width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{padding:5px;width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{margin-left:5px;font-size:initial}[_nghost-%COMP%]   .mat-mdc-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%]{display:inline-flex;position:relative;margin-left:12px}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{margin-top:5px}[_nghost-%COMP%]   .mat-column-select[_ngcontent-%COMP%]{overflow:auto}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin:16px 0}[_nghost-%COMP%]   .thematics[_ngcontent-%COMP%]{max-height:35%;overflow:auto;margin-top:5px;width:98%}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]{overflow:auto;max-height:250px;width:98%}[_nghost-%COMP%]   .mat-column-typeResults[_ngcontent-%COMP%]{max-width:100px;margin-right:5px}[_nghost-%COMP%]   .buffer-unit[_ngcontent-%COMP%], [_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:100%;padding:5px;box-sizing:border-box}[_nghost-%COMP%]   .radius[_ngcontent-%COMP%], [_nghost-%COMP%]   .buffer[_ngcontent-%COMP%]{flex-flow:column nowrap;flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{flex:1;margin-left:8px}[_nghost-%COMP%]   .example-tree-invisible[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .tree-ul[_ngcontent-%COMP%]{margin:0;padding:0 0 0 20px;list-style-type:none}[_nghost-%COMP%]   .tree-check[_ngcontent-%COMP%], [_nghost-%COMP%]   .tree-check-2[_ngcontent-%COMP%]{position:relative;margin-left:auto;margin-right:5px}[_nghost-%COMP%]   .thematics-header[_ngcontent-%COMP%]{max-width:250px}[_nghost-%COMP%]   .checks-header[_ngcontent-%COMP%]{padding:none;max-width:calc(100% - 316px);overflow:hidden}[_nghost-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{padding:5px}[_nghost-%COMP%]   .mat-tree-node[_ngcontent-%COMP%]{position:relative;min-height:42px;width:280px}[_nghost-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{height:56px}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]{max-height:45%;width:98%}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]   igo-entity-table[_ngcontent-%COMP%]     div.table-container{overflow:unset}"],changeDetection:0})}return l})();var uc=s(11484),Zi=s(45076);function dc(l,m){if(1&l&&(e.I0R(0,"mat-option",12),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t.properties.nom," ")}}function pc(l,m){if(1&l&&(e.I0R(0,"mat-option",12),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.measure."+t)," ")}}let zr=(()=>{class l{spatialFilterService;messageService;get store(){return this._store}set store(t){this._store=t}_store;get queryType(){return this._queryType}set queryType(t){this.formControl.setValue(""),this._queryType=t}_queryType;get zone(){return this._zone}set zone(t){this._zone=t,t||(this.zoneWithBuffer=void 0,this.bufferFormControl.setValue(0))}_zone;layers=[];zoneWithBuffer;selectedZone;measureUnit=Zi.K8.Meters;formControl=new Me.yM;bufferFormControl=new Me.yM;get measureUnits(){return[Zi.K8.Meters,Zi.K8.Kilometers]}zoneChange=new e._w7;zoneWithBufferChange=new e._w7;bufferChange=new e._w7;measureUnitChange=new e._w7;formValueChanges$$;bufferValueChanges$$;constructor(t,i){this.spatialFilterService=t,this.messageService=i}ngOnInit(){this.formValueChanges$$=this.formControl.valueChanges.subscribe(t=>{t.length&&this.store.view.filter(i=>{const n=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return i.properties.nom.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(n)})}),this.bufferValueChanges$$=this.bufferFormControl.valueChanges.pipe((0,vo.o)(500),(0,uc.a)()).subscribe(t=>{this.measureUnit===Zi.K8.Meters&&t>0&&t<=1e5?(this.bufferChange.emit(t),this.spatialFilterService.loadBufferGeometry(this.selectedZone,qt.Predefined,t,this.queryType).subscribe(i=>{this.zoneWithBuffer=i,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):this.measureUnit===Zi.K8.Kilometers&&t>0&&t<=100?(this.bufferChange.emit(t),this.spatialFilterService.loadBufferGeometry(this.selectedZone,qt.Predefined,1e3*t,this.queryType).subscribe(i=>{this.zoneWithBuffer=i,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):0===t&&this.layers.length>0?(this.bufferChange.emit(t),this.zoneWithBufferChange.emit(this.selectedZone)):(t<0||this.measureUnit===Zi.K8.Meters&&t>1e5||this.measureUnit===Zi.K8.Kilometers&&t>100)&&(this.bufferFormControl.setValue(0),this.messageService.alert("igo.geo.spatialFilter.bufferAlert","igo.geo.spatialFilter.warning"))})}ngOnDestroy(){this.formValueChanges$$.unsubscribe()}displayFn(t){return t?t.properties.nom:void 0}onZoneChange(t){t&&this.queryType&&this.spatialFilterService.loadItemById(t,this.queryType).subscribe(i=>{this.selectedZone=i,this.zoneChange.emit(i)})}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.measureUnitChange.emit(this.measureUnit),this.bufferFormControl.setValue(this.measureUnit===Zi.K8.Meters?1e3*this.bufferFormControl.value:this.bufferFormControl.value/1e3))}static \u0275fac=function(i){return new(i||l)(e.GI1(ut),e.GI1(Qt.mi))};static \u0275cmp=e.In1({type:l,selectors:[["igo-spatial-filter-list"]],inputs:{store:"store",queryType:"queryType",zone:"zone",layers:"layers"},outputs:{zoneChange:"zoneChange",zoneWithBufferChange:"zoneWithBufferChange",bufferChange:"bufferChange",measureUnitChange:"measureUnitChange"},standalone:!0,features:[e.UHJ],decls:23,vars:23,consts:[[1,"form-list"],[1,"zone-list"],["type","text","matInput","",3,"placeholder","formControl","matAutocomplete"],["input",""],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"buffer-div"],[1,"buffer"],["type","number","matInput","",3,"placeholder","formControl","value","readonly"],[1,"unit-field"],[3,"value","selectionChange"],[3,"value"]],template:function(i,n){if(1&i&&(e.I0R(0,"div",0)(1,"mat-form-field",1)(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.wR5(5,"input",2,3),e.wVc(7,"translate"),e.I0R(8,"mat-autocomplete",4,5),e.qCj("optionSelected",function(v){return n.onZoneChange(v.option.value)}),e.yuY(10,dc,2,2,"mat-option",6),e.wVc(11,"async"),e.C$Y()(),e.I0R(12,"div")(13,"div",7)(14,"mat-form-field",8)(15,"mat-label"),e.OEk(16),e.wVc(17,"translate"),e.C$Y(),e.wR5(18,"input",9),e.wVc(19,"translate"),e.C$Y(),e.I0R(20,"mat-form-field",10)(21,"mat-select",11),e.qCj("selectionChange",function(v){return n.onMeasureUnitChange(v.value)}),e.yuY(22,pc,3,4,"mat-option",6),e.C$Y()()()()()),2&i){const p=e.Gew(9);e.yG2(3),e.cNF(e.kDX(4,13,"igo.geo.spatialFilter.listLabel")),e.yG2(2),e._6D("placeholder",e.kDX(7,15,"igo.geo.spatialFilter.listLabel")),e.E7m("formControl",n.formControl)("matAutocomplete",p),e.yG2(3),e.E7m("displayWith",n.displayFn),e.yG2(2),e.E7m("ngForOf",e.kDX(11,17,n.store.view.all$())),e.yG2(6),e.cNF(e.kDX(17,19,"igo.geo.spatialFilter.buffer")),e.yG2(2),e._6D("placeholder",e.kDX(19,21,"igo.geo.spatialFilter.buffer")),e.E7m("formControl",n.bufferFormControl)("value",0)("readonly",!n.zone),e.yG2(3),e.E7m("value",n.measureUnit),e.yG2(),e.E7m("ngForOf",n.measureUnits)}},dependencies:[ft.wb,ft.Up,ft.w5,Yt.cN,Yt.yi,Me.y,Me.ot,Me.O4,Me.ue,_o.U1,_o.e,Gt.I5,_o.cG,Me.sl,Me.ug,Xe.Iw,Gt.Ax,At.d5,At.kX,Xe.a,it.O0,it.sD],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   .buffer-div[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .zone-list[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .buffer[_ngcontent-%COMP%]{flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{flex:1;margin-left:8px}"],changeDetection:0})}return l})();var Xr=s(18268);function mc(l,m){if(1&l&&(e.I0R(0,"mat-option",10),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.terrapi."+t)," ")}}let Jr=(()=>{class l{get store(){return this._store}set store(t){this._store=t}_store;queryType=["Arrond","CircFed","CircProv","DirReg","Mun","MRC","AdmRegion","RegTour"];selectedTypeIndex=new Me.yM(0);spatialType=qt;activeDrawType=this.spatialType.Polygon;selectedQueryType;zone;layers=[];type;eventType=new e._w7;eventQueryType=new e._w7;zoneChange=new e._w7;zoneWithBufferChange=new e._w7;bufferChange=new e._w7;measureUnitChange=new e._w7;constructor(){}ngOnInit(){0===this.selectedTypeIndex.value&&(this.type=this.spatialType.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)}onTypeChange(t){0===this.selectedTypeIndex.value&&(this.type=qt.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)}onDrawTypeChange(t){this.activeDrawType=t,this.eventType.emit(this.activeDrawType)}onSelectionChange(){this.eventQueryType.emit(this.selectedQueryType),this.zoneChange.emit(void 0)}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-spatial-filter-type"]],inputs:{store:"store",selectedQueryType:"selectedQueryType",zone:"zone",layers:"layers"},outputs:{eventType:"eventType",eventQueryType:"eventQueryType",zoneChange:"zoneChange",zoneWithBufferChange:"zoneWithBufferChange",bufferChange:"bufferChange",measureUnitChange:"measureUnitChange"},standalone:!0,features:[e.UHJ],decls:20,vars:25,consts:[[3,"selectedIndex","selectedIndexChange","selectedTabChange"],[3,"label"],[3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"store","queryType","zone","layers","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange"],[1,"spatial-type-toggle"],[3,"value","change"],[3,"value","matTooltip"],["svgIcon","pentagon-outline"],["svgIcon","record-circle-outline"],[3,"value"]],template:function(i,n){1&i&&(e.I0R(0,"mat-tab-group",0),e.qCj("selectedIndexChange",function(v){return n.selectedTypeIndex.setValue(v)})("selectedTabChange",function(v){return n.onTypeChange(v)}),e.I0R(1,"mat-tab",1),e.wVc(2,"translate"),e.I0R(3,"mat-form-field")(4,"mat-label"),e.OEk(5),e.wVc(6,"translate"),e.C$Y(),e.I0R(7,"mat-select",2),e.qCj("selectionChange",function(){return n.onSelectionChange()}),e.iHE("valueChange",function(v){return e.kNx(n.selectedQueryType,v)||(n.selectedQueryType=v),v}),e.yuY(8,mc,3,4,"mat-option",3),e.C$Y()(),e.I0R(9,"igo-spatial-filter-list",4),e.qCj("zoneChange",function(v){return n.zoneChange.emit(v)})("zoneWithBufferChange",function(v){return n.zoneWithBufferChange.emit(v)})("bufferChange",function(v){return n.bufferChange.emit(v)})("measureUnitChange",function(v){return n.measureUnitChange.emit(v)}),e.C$Y()(),e.I0R(10,"mat-tab",1),e.wVc(11,"translate"),e.I0R(12,"div",5)(13,"mat-button-toggle-group",6),e.qCj("change",function(v){return n.onDrawTypeChange(v.value)}),e.I0R(14,"mat-button-toggle",7),e.wVc(15,"translate"),e.wR5(16,"mat-icon",8),e.C$Y(),e.I0R(17,"mat-button-toggle",7),e.wVc(18,"translate"),e.wR5(19,"mat-icon",9),e.C$Y()()()()()),2&i&&(e.E7m("selectedIndex",n.selectedTypeIndex.value),e.yG2(),e.E7m("label",e.kDX(2,15,"igo.geo.spatialFilter.predefined")),e.yG2(4),e.cNF(e.kDX(6,17,"igo.geo.spatialFilter.searchLabel")),e.yG2(2),e.OKB("value",n.selectedQueryType),e.yG2(),e.E7m("ngForOf",n.queryType),e.yG2(),e.E7m("store",n.store)("queryType",n.selectedQueryType)("zone",n.zone)("layers",n.layers),e.yG2(),e.E7m("label",e.kDX(11,19,"igo.geo.spatialFilter.draw")),e.yG2(3),e.E7m("value",n.activeDrawType),e.yG2(),e.E7m("value",n.spatialType.Polygon)("matTooltip",e.kDX(15,21,"igo.geo.spatialFilter.drawPolygon")),e.yG2(3),e.E7m("value",n.spatialType.Point)("matTooltip",e.kDX(18,23,"igo.geo.spatialFilter.drawCircle")))},dependencies:[Xr.WG,Xr.aJ,Xr._q,ft.wb,ft.Up,ft.w5,At.d5,At.kX,Gt.I5,Xe.Iw,Gt.Ax,zr,ro.ue,ro.gn,ro.KU,st.KO,st.a4,tt.oB,tt.qL,it.O0,it.sD],styles:["[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-label{padding:10px}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-body-wrapper{margin-top:5px}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}"],changeDetection:0})}return l})();var hr=s(6056);function gc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",3)(1,"mat-form-field"),e.wR5(2,"mat-datetimepicker-toggle",4)(3,"mat-datetimepicker",5,6),e.I0R(5,"input",7),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(2);return e.kNx(p.date,n)||(p.date=n),e.CGJ(n)}),e.qCj("dateChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.handleDateChange(n))}),e.wVc(6,"translate"),e.C$Y()()()}if(2&l){const t=e.Gew(4),i=e.GaO(2);e.yG2(2),e.E7m("for",t),e.yG2(),e.E7m("type",i.type)("openOnFocus",!0)("timeInterval",5),e.yG2(2),e._6D("placeholder",e.kDX(6,9,"igo.geo.timeFilter.date")),e.E7m("matDatetimepicker",t),e.OKB("ngModel",i.date),e.E7m("min",i.min)("max",i.max)}}function hc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div")(1,"div",8)(2,"mat-form-field"),e.wR5(3,"mat-datetimepicker-toggle",4)(4,"mat-datetimepicker",5,9),e.I0R(6,"input",10),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(2);return e.kNx(p.startDate,n)||(p.startDate=n),e.CGJ(n)}),e.qCj("input",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.startDate)})("dateChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.handleDateChange(n))}),e.wVc(7,"translate"),e.C$Y()()(),e.I0R(8,"div",8)(9,"mat-form-field"),e.wR5(10,"mat-datetimepicker-toggle",4)(11,"mat-datetimepicker",5,11),e.I0R(13,"input",7),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(2);return e.kNx(p.endDate,n)||(p.endDate=n),e.CGJ(n)}),e.qCj("dateChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.handleDateChange(n))}),e.wVc(14,"translate"),e.C$Y()()()()}if(2&l){const t=e.Gew(5),i=e.Gew(12),n=e.GaO(2);e.yG2(3),e.E7m("for",t),e.yG2(),e.E7m("type",n.type)("openOnFocus",!0)("timeInterval",5),e.yG2(2),e._6D("placeholder",e.kDX(7,18,"igo.geo.timeFilter.startDate")),e.E7m("matDatetimepicker",t),e.OKB("ngModel",n.startDate),e.E7m("min",n.min)("max",n.getRangeMaxDate()),e.yG2(4),e.E7m("for",i),e.yG2(),e.E7m("type",n.type)("openOnFocus",!0)("timeInterval",5),e.yG2(2),e._6D("placeholder",e.kDX(14,20,"igo.geo.timeFilter.endDate")),e.E7m("matDatetimepicker",i),e.OKB("ngModel",n.endDate),e.E7m("min",n.getRangeMinDate())("max",n.max)}}function fc(l,m){if(1&l&&(e.I0R(0,"div"),e.yuY(1,gc,7,11,"div",2)(2,hc,15,22,"div",0),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",!t.isRange),e.yG2(),e.E7m("ngIf",t.isRange)}}function yc(l,m){if(1&l&&(e.I0R(0,"mat-option",14),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function _c(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",3)(1,"mat-form-field")(2,"mat-select",12),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(2);return e.kNx(p.year,n)||(p.year=n),e.CGJ(n)}),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.handleYearChange(n))}),e.wVc(3,"translate"),e.yuY(4,yc,2,2,"mat-option",13),e.C$Y()()()}if(2&l){const t=e.GaO(2);e.yG2(2),e._6D("placeholder",e.kDX(3,3,"igo.geo.timeFilter.date")),e.OKB("ngModel",t.year),e.yG2(2),e.E7m("ngForOf",t.listYears)}}function Cc(l,m){if(1&l&&(e.I0R(0,"mat-option",14),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function vc(l,m){if(1&l&&(e.I0R(0,"mat-option",14),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function Sc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div")(1,"div",8)(2,"mat-form-field")(3,"mat-select",12),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(2);return e.kNx(p.startYear,n)||(p.startYear=n),e.CGJ(n)}),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.handleYearChange(n))}),e.wVc(4,"translate"),e.yuY(5,Cc,2,2,"mat-option",13),e.C$Y()()(),e.I0R(6,"div",8)(7,"mat-form-field")(8,"mat-select",12),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(2);return e.kNx(p.endYear,n)||(p.endYear=n),e.CGJ(n)}),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.handleYearChange(n))}),e.wVc(9,"translate"),e.yuY(10,vc,2,2,"mat-option",13),e.C$Y()()()()}if(2&l){const t=e.GaO(2);e.yG2(3),e._6D("placeholder",e.kDX(4,6,"igo.geo.timeFilter.startDate")),e.OKB("ngModel",t.startYear),e.yG2(2),e.E7m("ngForOf",t.startListYears),e.yG2(3),e._6D("placeholder",e.kDX(9,8,"igo.geo.timeFilter.endDate")),e.OKB("ngModel",t.endYear),e.yG2(2),e.E7m("ngForOf",t.endListYears)}}function bc(l,m){if(1&l&&(e.I0R(0,"div"),e.yuY(1,_c,5,5,"div",2)(2,Sc,11,10,"div",0),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",!t.isRange),e.yG2(),e.E7m("ngIf",t.isRange)}}function wc(l,m){if(1&l&&(e.I0R(0,"p",26),e.OEk(1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(),e.cNF(t.year)}}function Oc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",15)(1,"span"),e.OEk(2),e.C$Y(),e.I0R(3,"mat-slider",16,17)(5,"input",18,19),e.qCj("input",function(){e.usT(t);const n=e.Gew(6),p=e.Gew(4),v=e.GaO();return e.CGJ(v.handleSliderYearChange({source:n,parent:p,value:n.value}))})("change",function(){e.usT(t);const n=e.Gew(6),p=e.Gew(4),v=e.GaO();return e.CGJ(v.handleSliderYearChange({source:n,parent:p,value:n.value}))}),e.C$Y()(),e.I0R(7,"span"),e.OEk(8),e.C$Y(),e.yuY(9,wc,2,1,"p",20),e.I0R(10,"div",21,22)(12,"mat-slide-toggle",23),e.qCj("change",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleFilterState())}),e.wVc(13,"translate"),e.C$Y(),e.I0R(14,"button",24),e.qCj("click",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.playYear(n))}),e.wR5(15,"mat-icon",25),e.C$Y(),e.I0R(16,"button",24),e.qCj("click",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.resetFilter(n))}),e.wR5(17,"mat-icon",25),e.C$Y()()()}if(2&l){const t=e.GaO();e.yG2(2),e.cNF(t.startYear),e.yG2(),e._6D("step",t.step),e.E7m("min",t.startYear)("max",t.endYear)("color",t.color)("disabled",!t.options.enabled||!t.layer.visible),e.yG2(2),e.E7m("value",t.handleSliderValue()),e.yG2(3),e.cNF(t.endYear),e.yG2(),e.E7m("ngIf",t.options.enabled),e.yG2(3),e.E7m("matTooltip",e.kDX(13,17,"igo.geo.filter.toggleFilterState"))("color",t.color)("checked",t.options.enabled)("disabled",!t.layer.visible),e.yG2(2),e.E7m("disabled",!t.options.enabled||!t.layer.visible),e.yG2(),e._6D("svgIcon",t.playIcon),e.yG2(),e.E7m("disabled",!t.options.enabled||!t.layer.visible),e.yG2(),e._6D("svgIcon",t.resetIcon)}}function Ic(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",3)(1,"mat-slider",27,17),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.handleSliderDateChange(n))}),e.I0R(3,"input",28,19),e.qCj("input",function(){e.usT(t);const n=e.Gew(4),p=e.Gew(2),v=e.GaO();return e.CGJ(v.handleSliderDateChange({source:n,parent:p,value:n.value}))}),e.C$Y()(),e.I0R(5,"p",26),e.OEk(6),e.C$Y(),e.I0R(7,"button",29),e.qCj("click",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.playFilter(n))}),e.wR5(8,"mat-icon",25),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e._6D("step",t.step),e.E7m("min",t.dateToNumber(t.min))("max",t.dateToNumber(t.max)),e.yG2(2),e.E7m("value",t.handleSliderValue()),e.yG2(3),e.cNF(t.handleSliderTooltip()),e.yG2(2),e._6D("svgIcon",t.playIcon)}}let Qr=(()=>{class l{dateAdapter;layer;options;color="primary";date;startDate;endDate;year;startYear;endYear;initStartYear;initEndYear;listYears=[];startListYears=[];endListYears=[];set currentValue(t){if(t&&this.type!==$t.U.YEAR){const i=t.split("/");if(i.length>0){const n=new Date(i[0]),p=new Date(i[1]);isNaN(n.valueOf())||(this.startDate=n),isNaN(p.valueOf())||(this.endDate=p)}}}interval;playIcon="play-circle";resetIcon="replay";change=new e._w7;yearChange=new e._w7;mySlider;get type(){return void 0===this.options.type?$t.U.DATE:this.options.type}get isRange(){return void 0!==this.options.range&&this.options.style!==$t.D.SLIDER&&this.options.range}get style(){return void 0===this.options.style?$t.D.SLIDER:this.options.style}get step(){let t=108e5;if(void 0===this.options.step)switch(this.type){case $t.U.DATE:case $t.U.DATETIME:t=108e5;break;case $t.U.TIME:t=36e5;break;case $t.U.YEAR:t=31536e6;break;default:t=108e5}else t=this.getStepDefinition(this.options.step);return t}get timeInterval(){return void 0===this.options.timeInterval?2e3:this.options.timeInterval}get min(){if(this.options.min){const t=new Date(this.options.min);return new Date(t.getTime()+6e4*t.getTimezoneOffset())}}get max(){if(this.options.max){const t=new Date(this.options.max);return new Date(t.getTime()+6e4*t.getTimezoneOffset())}}get is(){return void 0!==this.options.range&&this.options.range}constructor(t){this.dateAdapter=t,this.dateAdapter.setLocale("fr")}ngOnInit(){if(void 0===this.startDate&&(this.startDate=new Date(this.min)),void 0===this.endDate&&(this.endDate=new Date(this.max)),void 0===this.startYear&&(this.startYear=new Date(this.startDate).getFullYear(),this.initStartYear=this.startYear),void 0===this.endYear&&(this.endYear=new Date(this.endDate).getFullYear(),this.initEndYear=this.endYear),this.isRange){for(let t=this.startYear;t<this.endYear;t++)this.startListYears.push(t);for(let t=this.startYear+1;t<=this.endYear;t++)this.endListYears.push(t)}else for(let t=this.startYear;t<=this.endYear+1;t++)this.listYears.push(t);this.options.enabled=void 0===this.options.enabled||this.options.enabled,this.checkFilterValue(),this.options.enabled?!this.isRange&&"slider"===this.style&&"year"===this.type&&this.yearChange.emit(this.year):(this.storeCurrentFilterValue(),this.yearChange.emit(void 0))}storeCurrentFilterValue(){!this.isRange&&this.style===$t.D.SLIDER&&this.type===$t.U.YEAR&&(this.options.value=this.year.toString())}checkFilterValue(){const i=this.layer.dataSource.ol.getParams().TIME;if(this.isRange||this.style!==$t.D.SLIDER||this.type!==$t.U.YEAR){if(this.isRange&&this.style===$t.D.CALENDAR&&this.type===$t.U.YEAR&&i){this.startYear=parseInt(i.substr(0,4),10),this.endYear=parseInt(i.substr(5,4),10);const n=[],p=[];for(let v=this.initStartYear;v<this.endYear;v++)n.push(v);for(let v=this.startYear+1;v<=this.initEndYear;v++)p.push(v);this.startListYears=n,this.endListYears=p}}else this.year=i?new Date(i.toString()).getFullYear()+1:this.options.value?new Date(this.options.value.toString()).getFullYear()+1:new Date(this.min).getFullYear()+1}handleDateChange(t){this.setupDateOutput(),this.applyTypeChange(),this.change.emit(this.isRange?[this.startDate,this.endDate]:this.startDate)}handleYearChange(t){if(this.isRange){this.endListYears=[];for(let i=this.startYear+1;i<=this.initEndYear;i++)this.endListYears.push(i);this.startListYears=[];for(let i=this.initStartYear+1;i<this.endYear;i++)this.startListYears.push(i);this.yearChange.emit([this.startYear,this.endYear])}else this.yearChange.emit(this.year)}handleListYearChange(t){this.handleYearChange([this.startYear,this.endYear])}handleListYearStartChange(t){this.change.emit([this.startDate,this.endDate])}dateToNumber(t){let i;return i=t?new Date(t):new Date(this.min),i.getTime()}setSliderThumbLabel(t){const i=this.findThumbLabel(this.mySlider._elementRef.nativeElement.childNodes);i&&(i.textContent=t)}findThumbLabel(t){let i;return t.forEach(n=>{"mat-slider-thumb-label-text"===n.className&&(i=n),n.children.length>0&&!i&&(i=this.findThumbLabel(n.childNodes))},this),i}toggleFilterState(){this.options.enabled=!this.options.enabled,this.options.enabled?!this.isRange&&$t.D.SLIDER&&this.type===$t.U.YEAR&&this.yearChange.emit(this.year):(this.stopFilter(),this.storeCurrentFilterValue(),this.change.emit(void 0))}resetFilter(t){this.date=new Date(this.min),this.year=this.date.getFullYear(),!this.isRange&&$t.D.SLIDER&&this.type===$t.U.YEAR?this.yearChange.emit(this.year):(this.setupDateOutput(),this.change.emit(void 0))}playFilter(t){this.interval?this.stopFilter():(this.playIcon="pause-circle",this.interval=setInterval(i=>{let n;const p=new Date(i.max);n=void 0===i.date?i.min.getTime():i.date.getTime(),n+=i.mySlider.step,i.date=new Date(n),n>p.getTime()&&i.stopFilter(),i.handleDateChange({value:i.date,date:i.date})},this.timeInterval,this))}playYear(t){this.year+this.mySlider.step>this.max.getFullYear()+this.mySlider.step&&(this.stopFilter(),this.resetFilter(t)),this.interval?this.stopFilter():(this.playIcon="pause-circle",this.interval=setInterval(()=>{this.year+this.mySlider.step>this.max.getFullYear()?this.stopFilter():this.year=this.year+this.mySlider.step,this.yearChange.emit(this.year)},this.timeInterval,this))}stopFilter(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play-circle"}handleSliderDateChange(t){this.date=new Date(t.value),this.setSliderThumbLabel(this.handleSliderTooltip()),this.handleDateChange(t)}handleSliderYearChange(t){this.year=t.value,this.yearChange.emit(this.year)}handleSliderValue(){return!0!==this.options.current&&this.min||(this.date=this.getRoundedDate(new Date)),this.type===$t.U.YEAR?this.year:void 0===this.date?this.min.getTime():this.date.getTime()}handleSliderTooltip(){let t;switch(this.type){case $t.U.DATE:t=void 0===this.date?this.min.toDateString():this.date.toDateString();break;case $t.U.TIME:t=void 0===this.date?this.min.toTimeString():this.date.toTimeString();break;default:t=void 0===this.date?this.min.toUTCString():this.date.toUTCString()}return t}setupDateOutput(){this.style===$t.D.SLIDER?(this.startDate=new Date(this.date),this.startDate.setSeconds(-this.step/1e3),this.endDate=new Date(this.startDate),this.endDate.setSeconds(this.step/1e3)):!this.isRange&&this.date?(this.endDate=new Date(this.date),this.startDate=new Date(this.date)):(!this.isRange||!this.date&&this.date)&&this.date||(this.startDate=void 0===this.startDate?new Date(this.min):this.startDate,this.endDate=void 0===this.endDate?new Date(this.max):this.endDate)}applyTypeChange(){switch(this.type){case $t.U.DATE:(void 0!==this.startDate||void 0!==this.endDate)&&(this.startDate.setHours(0),this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setHours(23),this.endDate.setMinutes(59),this.endDate.setSeconds(59));break;case $t.U.TIME:if(this.style===$t.D.CALENDAR){if(this.startDate.getDay()!==this.min.getDay()){const t=this.startDate.getHours(),i=this.startDate.getMinutes();this.startDate=this.min,this.startDate.setHours(t),this.startDate.setMinutes(i)}if(this.endDate.getDay()!==this.min.getDay()){const t=this.endDate.getHours(),i=this.endDate.getMinutes();this.endDate=this.min,this.endDate.setHours(t),this.endDate.setMinutes(i)}}!this.isRange&&this.step>36e5&&(this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setMinutes(59),this.endDate.setSeconds(59))}}getRangeMinDate(){return void 0===this.startDate?this.min:this.startDate}getRangeMaxDate(){return void 0===this.endDate?this.max:this.endDate}getRoundedDate(t,i=10){const n=6e4*i;return new Date(Math.round(t.getTime()/n)*n)}getStepDefinition(t){return ot().duration(t).asMilliseconds()}static \u0275fac=function(i){return new(i||l)(e.GI1(Gt.Wu))};static \u0275cmp=e.In1({type:l,selectors:[["igo-time-filter-form"]],viewQuery:function(i,n){if(1&i&&e.CC$(to.Cg,5),2&i){let p;e.wto(p=e.Gqi())&&(n.mySlider=p.first)}},inputs:{layer:"layer",options:"options",currentValue:"currentValue"},outputs:{change:"change",yearChange:"yearChange"},standalone:!0,features:[e.UHJ],decls:5,vars:4,consts:[[4,"ngIf"],["class","igo-col igo-col-100 igo-col-100-m mat-typography",4,"ngIf"],["class","igo-col igo-col-100 igo-col-100-m",4,"ngIf"],[1,"igo-col","igo-col-100","igo-col-100-m"],["matSuffix","",1,"time-filter-mat-datetimepicker-toggle",3,"for"],[3,"type","openOnFocus","timeInterval"],["datetimePicker",""],["matInput","","autocomplete","false","readonly","readonly",3,"placeholder","matDatetimepicker","ngModel","min","max","ngModelChange","dateChange"],[1,"igo-col","igo-col-100"],["minDatetimePicker",""],["matInput","","autocomplete","false","readonly","readonly",3,"placeholder","matDatetimepicker","ngModel","min","max","ngModelChange","input","dateChange"],["maxDatetimePicker",""],[3,"placeholder","ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"igo-col","igo-col-100","igo-col-100-m","mat-typography"],["id","time-slider","thumbLabel","",3,"step","min","max","color","disabled"],["ngSlider",""],["matSliderThumb","",3,"value","input","change"],["ngSliderThumb","matSliderThumb"],["class","date-below",4,"ngIf"],[1,"igo-layer-actions-container"],["actions",""],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","checked","disabled","change"],["mat-icon-button","","color","primary",3,"disabled","click"],[3,"svgIcon"],[1,"date-below"],["id","time-slider","thumbLabel","",3,"step","min","max","selectionChange"],["matSliderThumb","",3,"value","input"],["mat-icon-button","","color","primary",3,"click"]],template:function(i,n){1&i&&(e.yuY(0,fc,3,2,"div",0)(1,bc,3,2,"div",0),e.wR5(2,"br"),e.yuY(3,Oc,18,19,"div",1)(4,Ic,9,6,"div",2)),2&i&&(e.E7m("ngIf","calendar"===n.style&&"year"!==n.type),e.yG2(),e.E7m("ngIf","calendar"===n.style&&"year"===n.type),e.yG2(2),e.E7m("ngIf",!n.isRange&&"slider"===n.style&&"year"===n.type),e.yG2(),e.E7m("ngIf","slider"===n.style&&"year"!==n.type))},dependencies:[Xe.u_,ft.wb,ft.Up,ft.Gm,hr._W,hr.yA,hr.eO,hr.MH,Gt.Ko,Yt.cN,Yt.yi,Me.y,Me.ot,Me.ue,Me._G,At.d5,At.kX,Gt.I5,Xe.Iw,Gt.Ax,to.yO,to.Cg,to._s,Co.GE,Co.cP,st.KO,st.a4,ct.oJ,ct.um,tt.oB,tt.qL,it.O0,it.sD],styles:["[_nghost-%COMP%]   .igo-layer-filters-container[_ngcontent-%COMP%]{padding-left:5px}[_nghost-%COMP%]   #time-slider[_ngcontent-%COMP%]{width:70%}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   #time-slider[_ngcontent-%COMP%]{width:60%}}[_nghost-%COMP%]   .date-below[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .igo-layer-actions-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}"]})}return l})();const Tc=l=>({disabled:l});function Ec(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",10),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.layer.visible=!n.layer.visible)}),e.wVc(1,"translate"),e.wVc(2,"translate"),e.wR5(3,"mat-icon",11),e.wVc(4,"async"),e.C$Y()}if(2&l){const t=e.GaO(2);e.E7m("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.kDX(1,4,"igo.geo.layer.hideLayer"):e.kDX(2,6,"igo.geo.layer.showLayer")),e.yG2(3),e.E7m("ngClass",e.S45(10,Tc,!1===e.kDX(4,8,t.inResolutionRange$)))("svgIcon",t.layer.visible?"eye":"eye-off")}}const xc=l=>({cursor:l});function Mc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-list-item")(1,"mat-icon",7),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleFiltersCollapsed())}),e.C$Y(),e.I0R(2,"span",8),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleLegendOnClick())}),e.OEk(3),e.C$Y(),e.yuY(4,Ec,5,12,"button",9),e.C$Y()}if(2&l){const t=e.GaO(),i=e.Gew(2);e.yG2(),e.E7m("target",i)("collapsed",t.filtersCollapsed),e.yG2(),e.E7m("ngStyle",e.S45(5,xc,t.filtersCollapsed?"default":"pointer")),e.yG2(),e.cNF(t.layer.title),e.yG2(),e.E7m("ngIf",t.header)}}function Dc(l,m){if(1&l&&e.wR5(0,"igo-layer-legend",12),2&l){const t=e.GaO();e.E7m("layer",t.layer)}}let lr=(()=>{class l{timeFilterService;color="primary";showLegend$=new A.g(!1);inResolutionRange$=new A.g(!0);resolution$$;filtersCollapsed=!1;header=!0;layer;get datasource(){return this.layer.dataSource}constructor(t){this.timeFilterService=t}ngOnInit(){this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.inResolutionRange$.next(this.layer.isInResolutionsRange)})}ngOnDestroy(){this.resolution$$.unsubscribe()}handleYearChange(t){this.timeFilterService.filterByYear(this.datasource,t)}handleDateChange(t){this.timeFilterService.filterByDate(this.datasource,t)}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)}setVisible(){this.layer.visible=!0}toggleFiltersCollapsed(){this.filtersCollapsed=!this.filtersCollapsed}static \u0275fac=function(i){return new(i||l)(e.GI1(Si))};static \u0275cmp=e.In1({type:l,selectors:[["igo-time-filter-item"]],inputs:{header:"header",layer:"layer"},standalone:!0,features:[e.M5G([Si]),e.UHJ],decls:8,vars:7,consts:[[4,"ngIf"],[1,"igo-datasource-filters-container"],["filters",""],[1,"igo-layer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],[3,"layer","options","currentValue","change","yearChange"],["matListItemIcon","","igoCollapse","","svgIcon","chevron-up",1,"igo-chevron",3,"target","collapsed","click"],["matListItemTitle","",3,"ngStyle","click"],["mat-icon-button","","matListItemMeta","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["mat-icon-button","","matListItemMeta","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],[3,"ngClass","svgIcon"],[3,"layer"]],template:function(i,n){1&i&&(e.yuY(0,Mc,5,7,"mat-list-item",0),e.I0R(1,"div",1,2)(3,"div",3,4),e.yuY(5,Dc,1,1,"igo-layer-legend",5),e.wVc(6,"async"),e.C$Y(),e.I0R(7,"igo-time-filter-form",6),e.qCj("change",function(v){return n.handleDateChange(v)})("yearChange",function(v){return n.handleYearChange(v)}),e.C$Y()()),2&i&&(e.E7m("ngIf",n.header),e.yG2(5),e.E7m("ngIf",e.kDX(6,5,n.showLegend$)),e.yG2(2),e.E7m("layer",n.layer)("options",n.datasource.options.timeFilter)("currentValue",n.datasource.options.params.TIME))},dependencies:[Xe.u_,_t.iI,_t.g9,_t.Y1,_t.UV,_t.At,tt.oB,tt.qL,Ue.mK,Xe.Qt,ct.oJ,ct.um,st.KO,st.a4,Xe.QF,Eo,Qr,Xe.a,it.O0,it.sD],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-datasource-filters-container[_ngcontent-%COMP%]{text-align:center;width:100%;display:inline-block;padding-top:5px}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:1.125em;width:calc(100% - 18px)}"]})}return l})();function Pc(l,m){if(1&l&&(e.I0R(0,"button",2),e.wVc(1,"translate"),e.wR5(2,"mat-icon",3),e.C$Y()),2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,3,"igo.geo.filter.filterBy"))("color",t.color),e.yG2(2),e.E7m("matBadge",t.badge)}}function Fc(l,m){if(1&l&&e.wR5(0,"igo-time-filter-item",7),2&l){const t=e.GaO(2);e.E7m("header",!1)("layer",t.layer)}}function Rc(l,m){if(1&l&&(e.I0R(0,"div",4,5),e.yuY(2,Fc,1,2,"igo-time-filter-item",6),e.C$Y()),2&l){const t=e.GaO();e.yG2(2),e.E7m("ngIf",t.timeFilterCollapse&&t.options.timeFilter)}}let Zr=(()=>{class l{options;get badge(){const t=this.options.timeFilter;if(t&&t.enabled)return 1}get layer(){return this._layer}set layer(t){this._layer=t,t&&(this.options=this.layer.dataSource.options)}_layer;map;color="primary";header=!0;timeFilterCollapse=!1;constructor(){}ngOnInit(){this.options=this.layer.dataSource.options}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-time-filter-button"]],inputs:{layer:"layer",map:"map",color:"color",header:"header"},standalone:!0,features:[e.UHJ],decls:2,vars:2,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["class","igo-layer-actions-container",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium","svgIcon","history",3,"matBadge"],[1,"igo-layer-actions-container"],["ogcFilter",""],["igoListItem","",3,"header","layer",4,"ngIf"],["igoListItem","",3,"header","layer"]],template:function(i,n){1&i&&e.yuY(0,Pc,3,5,"button",0)(1,Rc,3,1,"div",1),2&i&&(e.E7m("ngIf",n.header&&n.options.timeFilterable&&n.options.timeFilter),e.yG2(),e.E7m("ngIf",n.header&&n.options.timeFilterable&&n.options.timeFilter))},dependencies:[Xe.u_,ct.oJ,ct.um,st.KO,st.a4,tt.oB,tt.qL,qe.g,qe.S,lr,Ue.qU,it.O0,it.sD],changeDetection:0})}return l})();function Lc(l,m){if(1&l&&e.wR5(0,"igo-time-filter-item",2),2&l){const t=m.$implicit;e.E7m("header",!0)("layer",t)}}let fr=(()=>{class l{cdRef;get layers(){return this._layers}set layers(t){this._layers=t,this.cdRef.detectChanges()}_layers=[];constructor(t){this.cdRef=t}static \u0275fac=function(i){return new(i||l)(e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-time-filter-list"]],inputs:{layers:"layers"},standalone:!0,features:[e.UHJ],decls:3,vars:6,consts:[[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["igoListItem","",3,"header","layer"]],template:function(i,n){1&i&&(e.I0R(0,"igo-list",0),e.yuY(1,Lc,1,2,"ng-template",1),e.wVc(2,"filterableDataSource"),e.C$Y()),2&i&&(e.E7m("navigation",!1)("selection",!1),e.yG2(),e.E7m("ngForOf",e.g7$(2,3,n.layers,"time")))},dependencies:[Ue.yM,Xe.Iw,lr,Ue.qU,mt],encapsulation:2,changeDetection:0})}return l})(),qr=(()=>{class l{mapService;component;layers$$;constructor(t,i){this.mapService=i,this.component=t}ngOnInit(){this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(t=>{this.component.layers=t})}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(i){return new(i||l)(e.GI1(fr,2),e.GI1(zn.u))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoTimeFilterListBinding",""]],standalone:!0})}return l})();function Gc(l,m){if(1&l&&(e.I0R(0,"button",1),e.wVc(1,"translate"),e.wR5(2,"mat-icon",2),e.C$Y()),2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.download.action"))("color",t.color)}}let ca=(()=>{class l{get layer(){return this._layer}set layer(t){this._layer=t}_layer;get color(){return this._color}set color(t){this._color=t}_color="primary";constructor(){}get options(){if(this.layer)return this.layer.dataSource.options}layerIsExportable(){return!!(this.layer instanceof so.Md&&!0===this.layer.exportable||this.layer.dataSource.options.download&&this.layer.dataSource.options.download.url||this.layer.options.workspace?.enabled&&this.layer.options.workspace?.workspaceId!==this.layer.id)}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-export-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[e.UHJ],decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["svgIcon","file-export"]],template:function(i,n){1&i&&e.yuY(0,Gc,3,4,"button",0),2&i&&e.E7m("ngIf",n.layerIsExportable())},dependencies:[Xe.u_,ct.oJ,ct.um,st.KO,st.a4,tt.oB,tt.qL,it.O0,it.sD],changeDetection:0})}return l})();var xn=s(53404),es=s(93176),yr=s(7036),ua=s(39732);let ts=(()=>{class l{styleList={};httpClient;constructor(t){this.httpClient=new ae.KK(t)}getStyleList(t){return le.Yv.resolve(this.styleList,t)}load(t){const i=t.default||{};return t.path?new Promise((n,p)=>{this.httpClient.get(t.path).pipe((0,ge.a)(v=>(console.log(`StyleList file ${t.path} could not be read`),n(!0),(0,ua.c)(v.error||"Server error")))).subscribe(v=>{this.styleList=le.Yv.mergeDeep(i,v),n(!0)})}):(this.styleList=i,!0)}static \u0275fac=function(i){return new(i||l)(e.CoB(ae.m))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var cr=s(82048),$c=s(83900),Ac=s(52280);class da extends Error{}class os extends da{constructor(){super("Invalid file"),Object.setPrototypeOf(this,os.prototype)}}class _r extends da{constructor(){super("Nothing to export"),Object.setPrototypeOf(this,_r.prototype)}}const It=(0,le.GC)(["URL","GeoJSON","GML","GPX","KML","Shapefile","CSVcomma","CSVsemicolon"]),si=(0,le.GC)(["UTF8","LATIN1"]);let Cr=(()=>{class l{config;static ogreFormats={GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"ESRI Shapefile",CSVcomma:"CSVcomma",CSVsemicolon:"CSVsemicolon"};static noOgreFallbacks=["GML","GPX","KML"];ogreUrl;aggregateInComment=!0;constructor(t){this.config=t,this.ogreUrl=this.config.getConfig("importExport.url");const i=this.config.getConfig("importExport.gpxAggregateInComment");void 0!==i&&(this.aggregateInComment=i)}export(t,i,n,p,v="EPSG:4326",k="EPSG:4326"){const de=this.generateFeature(t,i,"_featureStore");return this.exportAsync(de,i,n,p,v,k)}generateFeature(t,i,n="_"){return i===It.GPX&&this.aggregateInComment?this.generateAggregatedFeature(t):t.map(p=>{const k=p.getKeys().filter(de=>!de.startsWith(n)).reduce((de,he)=>(de[he]=p.get(he),de),{geometry:p.getGeometry()});return new Y.c(k)})}generateAggregatedFeature(t){return t.map(i=>{const n=i.getKeys().filter(de=>!de.startsWith("_"));let p="";const v=n.reduce((de,he)=>(he&&"geometry"!==he&&("id"===he&&i.get("draw")?p+=he+":"+i.get("draw")+"   \r\n":p+=he+":"+i.get(he)+"   \r\n"),de[he]=i.get(he),de),{geometry:i.getGeometry()}),k=new Y.c(v);return k.set("name",i.getId()),k.set("cmt",p),k})}exportAsync(t,i,n,p,v,k){return new _._(he=>{if(this.nothingToExport(t,i))he.error(new _r);else if(Object.keys(l.ogreFormats).indexOf(i)>=0){if(!this.ogreUrl)return void(l.noOgreFallbacks.indexOf(i)>=0?this.exportToFile(t,he,i,n,v,k):he.error(new os));this.exportWithOgre(t,he,i,n,p,v,k)}else this.exportToFile(t,he,i,n,v,k)})}exportToFile(t,i,n,p,v,k){const he=(new $c[n]).writeFeatures(t,{dataProjection:k,featureProjection:v,featureType:"feature",featureNS:"http://example.com/feature"}),Oe=`${p}.${n.toLowerCase()}`;(0,le.We)(he,"attachment/plain;charset=utf-8",Oe),i.complete()}exportWithOgre(t,i,n,p,v,k,de){let he=(new X.c).writeFeatures(t,{dataProjection:de,featureProjection:k});const Oe=`${this.ogreUrl}/convertJson`,be=document.createElement("form");if(be.style.display="none",document.body.appendChild(be),be.setAttribute("method","post"),be.setAttribute("target","_blank"),be.setAttribute("action",Oe),v===si.UTF8)be.acceptCharset="UTF-8",be.enctype="application/x-www-form-urlencoded; charset=utf-8;";else if(v===si.LATIN1){const Tt="ISO-8859-1",Ht=JSON.parse(he);Ht.features.map(Xo=>{const Zn=String.fromCharCode.apply(null,(0,Ac.OW)(JSON.stringify(Xo.properties),{mode:"replacement"}));Xo.properties=JSON.parse(Zn)}),he=JSON.stringify(Ht);const Oo=document.createElement("input");Oo.setAttribute("type","hidden"),Oo.setAttribute("name","encoding"),Oo.setAttribute("value",Tt),be.appendChild(Oo)}if("CSVsemicolon"===n){const Tt=document.createElement("input");Tt.setAttribute("type","hidden"),Tt.setAttribute("name","lco"),Tt.setAttribute("value","SEPARATOR=SEMICOLON"),be.appendChild(Tt)}const Pe=document.createElement("input");Pe.setAttribute("type","hidden"),Pe.setAttribute("name","json"),Pe.setAttribute("value",he),be.appendChild(Pe);const Je=document.createElement("input");let Fe="Shapefile"===n?`${p}.zip`:`${p}.${n.toLowerCase()}`;("CSVcomma"===n||"CSVsemicolon"===n)&&(Fe=`${p}.csv`),Fe=Fe.replace(" ","_"),Fe=Fe.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\u2019/g,"'"),Je.setAttribute("type","hidden"),Je.setAttribute("name","outputName"),Je.setAttribute("value",Fe),be.appendChild(Je);let et=l.ogreFormats[n];("CSVcomma"===n||"CSVsemicolon"===n)&&(et="CSV");const pt=document.createElement("input");pt.setAttribute("type","hidden"),pt.setAttribute("name","format"),pt.setAttribute("value",et),be.appendChild(pt),be.submit(),document.body.removeChild(be),i.complete()}nothingToExport(t,i){return 0===t.length||"GPX"===i&&void 0===t.find(p=>["Point","LineString","MultiLineString"].indexOf(p.getGeometry().getType())>=0)}static \u0275fac=function(i){return new(i||l)(e.CoB(M.aW))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var pa=s(17439),ma=s(51176),ga=s(79084);class Xn extends Error{}class vr extends Xn{constructor(){super("Invalid file"),Object.setPrototypeOf(this,vr.prototype)}}class Mn extends Xn{constructor(){super("Failed to read file"),Object.setPrototypeOf(this,Mn.prototype)}}class Sr extends Xn{constructor(){super("Nothing to import"),Object.setPrototypeOf(this,Sr.prototype)}}class Yc extends Xn{constructor(){super("File is too large"),Object.setPrototypeOf(this,Sr.prototype)}}class Vc extends Xn{constructor(){super("Invalid SRS definition"),Object.setPrototypeOf(this,Sr.prototype)}}class is extends Xn{constructor(){super("Error 500 with OGRE"),Object.setPrototypeOf(this,is.prototype)}}var ur=s(14672),br=s(59800);function wr(l){return l.toString().padStart(2,"0")}function Or(l,m,t,i,n,p,v,k,de){if(0===m.length)return void function zc(l,m){m.error("igo.geo.dropGeoFile.empty.text","igo.geo.dropGeoFile.empty.title",void 0,{value:l.name,mimeType:l.type})}(l,n);let he=ns(l);(v?v.open("igo.geo.import.promptStoreToIdb"):(0,q.of)(!1)).pipe((0,Ce.K)()).subscribe(be=>{const Pe=new Date,Je=[Pe.getFullYear(),wr(Pe.getMonth()+1),wr(Pe.getDate())].join("/")+" "+[wr(Pe.getHours()),wr(Pe.getMinutes())].join(":");he=be?`${he} (${Je})`:he,k?function Kc(l,m,t,i,n,p,v,k,de=!0){const he=l.map(Fe=>(0,ur.K6)(Fe,m.projection));let Oe,be,Pe;if(i.getStyleList(t.toString()+".styleByAttribute")){const Fe=i.getStyleList(t.toString()+".styleByAttribute");Oe=(et,pt)=>n.createStyleByAttribute(et,Fe,pt)}else if(i.getStyleList(t.toString()+".clusterStyle")){const Fe=i.getStyleList(t.toString()+".clusterParam");be=i.getStyleList(t.toString()+".distance"),Oe=(et,pt)=>{const Tt=n.createStyle(i.getStyleList(t.toString()+".clusterStyle"),et,pt);return n.createClusterStyle(et,pt,Fe,Tt)}}else if(i.getStyleList(t.toString()+".style"))Oe=(Fe,et)=>n.createStyle(i.getStyleList(t.toString()+".style"),Fe,et);else if(i.getStyleList("default.clusterStyle")&&"Point"===l[0].geometry.type){const Fe=i.getStyleList("default.clusterParam");be=i.getStyleList("default.distance"),Oe=(et,pt)=>{const Tt=n.createStyle(i.getStyleList("default.clusterStyle"),et,pt);return n.createClusterStyle(et,pt,Fe,Tt)}}else Oe=(Fe,et)=>n.createStyle(i.getStyleList("default.style"),Fe,et);i.getStyleList(t.toString()+".clusterStyle")?(Pe=new es.a(Object.assign({distance:be,type:"cluster",queryable:!0},v)),Pe.ol.source.addFeatures(he)):i.getStyleList(t.toString())?(Pe=new nt.E(Object.assign({type:"vector",queryable:!0},v)),Pe.ol.addFeatures(he)):i.getStyleList("default.clusterStyle")&&"Point"===l[0].geometry.type?(Pe=new es.a(Object.assign({distance:be,type:"cluster",queryable:!0},v)),Pe.ol.source.addFeatures(he)):(Pe=new nt.E(Object.assign({type:"vector",queryable:!0},v)),Pe.ol.addFeatures(he));const Je=new Et.M(Object.assign({title:t,id:p||(0,le.uq)(),isIgoInternalLayer:!0,source:Pe,style:Oe},k));m.addLayer(Je),de&&(0,ur.QX)(m.viewController,he)}(m,t,he,k,de):function jc(l,m,t,i,n,p=!1){const v=l.map(Je=>(0,ur.K6)(Je,m.projection)),k=(0,le.uq)(),he=new nt.E({id:k,type:"vector",queryable:!0});he.ol.addFeatures(v);let Oe,be=!1;v[0].getKeys().includes("_style")||v[0].getKeys().includes("_mapTitle")?Oe=(0,br.M4)():(Oe=(0,br.Cy)(),be=!0);const Pe=n.createLayer({id:k,title:i,workspace:{enabled:!0,searchIndexEnabled:!0},isIgoInternalLayer:!0,source:he,igoStyle:{editable:be},idbInfo:{firstLoad:!0,storeToIdb:p,contextUri:t||"*"},style:Oe});Pe.setExtent((0,ur.q1)(v,m.viewProjection)),m.addLayer(Pe),(0,ur.QX)(m.viewController,v)}(m,t,i,he,p,be),n.success("igo.geo.dropGeoFile.success.text","igo.geo.dropGeoFile.success.title",void 0,{value:he})})}function Wc(l,m,t){t.error("igo.geo.dropGeoFile.invalid.text","igo.geo.dropGeoFile.invalid.title",void 0,{value:l.name,mimeType:l.type})}function Nc(l,m,t){t.error("igo.geo.dropGeoFile.unreadable.text","igo.geo.dropGeoFile.unreadable.title",void 0,{value:l.name})}function Hc(l,m,t,i){t.error("igo.geo.dropGeoFile.tooLarge.text","igo.geo.dropGeoFile.tooLarge.title",void 0,{value:l.name,size:i})}function Xc(l,m){m.error("igo.geo.dropGeoFile.invalidSRS.text","igo.geo.dropGeoFile.invalidSRS.title",void 0,{value:l.name,mimeType:l.type})}function Jc(l,m,t){t.error("igo.geo.dropGeoFile.ogreServer.text","igo.geo.dropGeoFile.ogreServer.title")}function fa(l){return l.name.split(".").pop().toLowerCase()}function ns(l){return l.name.substr(0,l.name.lastIndexOf("."))}let ya=(()=>{class l{http;config;static formatExtensionAssociation={GeoJSON:"geojson",GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"zip"};static allowedMimeTypes=["application/gml+xml","application/vnd.google-earth.kml+xml","application/gpx+xml","application/json"];static allowedZipMimeTypes=["application/zip","application/x-zip-compressed","application/x-zip"];static allowedExtensions=["geojson","kml","gpx","json","gml","zip"];ogreUrl;clientSideFileSizeMax;constructor(t,i){this.http=t,this.config=i;const n=this.config.getConfig("importExport");this.ogreUrl=n.url,this.clientSideFileSizeMax=(n.clientSideFileSizeMaxMb||30)*Math.pow(1024,2),n.formats&&(l.allowedExtensions=n.formats.map(v=>l.formatExtensionAssociation[v]).filter(v=>v),l.allowedExtensions.includes("geojson")&&l.allowedExtensions.push("json"))}import(t,i="EPSG:4326",n="EPSG:4326"){return this.importAsync(t,i,n)}getFileImporter(t){const i=fa(t),n=l.allowedExtensions;let p=[];n.includes("zip")&&(p=l.allowedZipMimeTypes);const v=t.type;if(!([...l.allowedMimeTypes,...p].indexOf(v)<0&&n.indexOf(i)<0)){if("application/json"===v||["json","geojson","kml","gpx"].indexOf(i)>=0)return this.importFile;if(void 0!==this.ogreUrl)return this.importFileWithOgre}}importAsync(t,i,n){return new _._(v=>{if(t.size>=this.clientSideFileSizeMax)return void v.error(new Yc);const k=this.getFileImporter(t);void 0!==k?k.call(this,t,v,i,n):v.error(new vr)})}importFile(t,i,n,p){const v=new FileReader;v.onload=k=>{try{const de=this.parseFeaturesFromFile(t,k.target.result,n,p);i.next(de)}catch{i.error(new Mn)}i.complete()},v.onerror=k=>{i.error(new Mn)},v.readAsText(t,"UTF-8")}importFileWithOgre(t,i,n,p){const v=`${this.ogreUrl}/convert`,k=new FormData;k.append("upload",t),k.append("sourceSrs",n),k.append("targetSrs",p),k.append("formatOutput","GEOJSON"),k.append("skipFailures",""),this.http.post(v,k,{headers:new ae.UD}).subscribe(de=>{if(null!==de)if((de.errors||[]).length>0)i.error(new Mn);else{const Oe=this.parseFeaturesFromGeoJSON(t,de,p);i.next(Oe),i.complete()}else i.error(new Mn)},de=>{de.error.caught=!0;const he=de.error.msg||"";"No valid files found"===he?i.error(new vr):he&&he.startWith("ERROR 1: Failed to process SRS definition")?i.error(new Vc):i.error(500===de.status?new is:new Mn)})}parseFeaturesFromFile(t,i,n,p){const v=fa(t),k=t.type,de=new X.c;let he;if("application/vnd.google-earth.kml+xml"===k)he=new pa.cp;else if("application/gml+xml"===k)he=new ma.c;else if("application/gpx+xml"===k)he=new ga.c;else switch(v){case"kml":he=new pa.cp;break;case"gpx":he=new ga.c;break;case"gml":he=new ma.c;break;default:he=de}return he.readFeatures(i,{dataProjection:n,featureProjection:p}).map(Pe=>Object.assign(de.writeFeatureObject(Pe),{projection:p,meta:{id:(0,le.uq)(),title:ns(t)}}))}parseFeaturesFromGeoJSON(t,i,n){const p=new X.c;return p.readFeatures(i).map(de=>Object.assign(p.writeFeatureObject(de),{projection:n,meta:{id:(0,le.uq)(),title:ns(t)}}))}static \u0275fac=function(i){return new(i||l)(e.CoB(ae.KK),e.CoB(M.aW))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function Qc(l,m){if(1&l&&(e.I0R(0,"p",16),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=e.GaO().$implicit;e.yG2(),e.oRS(" ",e.g7$(2,1,"igo.geo.importExportForm.projections."+t.translateKey,t)," ")}}function Zc(l,m){if(1&l&&(e.I0R(0,"p",16),e.OEk(1),e.C$Y()),2&l){const t=e.GaO().$implicit;e.yG2(),e.oRS(" ",t.alias," ")}}function qc(l,m){if(1&l&&(e.I0R(0,"mat-option",14),e.qCj("click",function(i){return i.stopPropagation()}),e.yuY(1,Qc,3,4,"p",15)(2,Zc,2,1,"p",15),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.E7m("ngIf",t.translateKey),e.yG2(),e.E7m("ngIf",!t.translateKey)}}function eu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"form",5)(1,"div",6)(2,"mat-form-field")(3,"mat-label"),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.I0R(6,"mat-select",7),e.iHE("valueChange",function(n){e.usT(t);const p=e.GaO();return e.kNx(p.inputProj,n)||(p.inputProj=n),e.CGJ(n)}),e.yuY(7,qc,3,3,"mat-option",8),e.wVc(8,"async"),e.C$Y()()(),e.I0R(9,"div",9),e.wVc(10,"translate"),e.wVc(11,"translate"),e.I0R(12,"button",10),e.qCj("click",function(){e.usT(t);const n=e.Gew(19);return e.CGJ(n.click())}),e.wVc(13,"async"),e.OEk(14),e.wVc(15,"translate"),e.C$Y(),e.wR5(16,"igo-spinner",11),e.wVc(17,"async"),e.I0R(18,"input",12,13),e.qCj("click",function(){e.usT(t);const n=e.Gew(19);return e.CGJ(n.value=null)})("change",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.importFiles(n.target.files))}),e.C$Y()()()}if(2&l){const t=e.GaO();e.E7m("formGroup",t.importForm),e.yG2(4),e.cNF(e.kDX(5,10,"igo.geo.importExportForm.importProjPlaceholder")),e.yG2(2),e.OKB("value",t.inputProj),e.yG2(),e.E7m("ngForOf",e.kDX(8,12,t.projections$)),e.yG2(2),e.E7m("matTooltip",t.importForm.invalid?e.kDX(10,14,"igo.geo.importExportForm.projections.choose"):e.kDX(11,16,"igo.geo.importExportForm.importButton")),e.yG2(3),e.E7m("disabled",t.importForm.invalid||e.kDX(13,18,t.loading$)),e.yG2(2),e.oRS(" ",e.kDX(15,20,"igo.geo.importExportForm.importButton")," "),e.yG2(2),e.E7m("shown",e.kDX(17,22,t.loading$)),e.yG2(2),e.m4B("display","none")}}const tu=l=>({size:l});function ou(l,m){if(1&l&&(e.I0R(0,"div")(1,"h4"),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"ul")(5,"li"),e.OEk(6),e.wVc(7,"translate"),e.C$Y(),e.I0R(8,"li"),e.OEk(9),e.wVc(10,"translate"),e.C$Y(),e.I0R(11,"li"),e.OEk(12),e.wVc(13,"translate"),e.C$Y()()()),2&l){const t=e.GaO(2);e.yG2(2),e.cNF(e.kDX(3,4,"igo.geo.importExportForm.importClarifications")),e.yG2(4),e.oRS(" ",e.g7$(7,6,"igo.geo.importExportForm.importSizeMax",e.S45(13,tu,t.fileSizeMb))," "),e.yG2(3),e.oRS(" ",e.kDX(10,9,"igo.geo.importExportForm.importFormatAuthorized")," "),e.yG2(3),e.cNF(e.kDX(13,11,"igo.geo.importExportForm.importShpZip"))}}function iu(l,m){if(1&l&&e.wR5(0,"igo-custom-html",20),2&l){const t=e.GaO(2);e.E7m("html",t.importHtmlClarifications)}}function nu(l,m){if(1&l&&(e.I0R(0,"section",17),e.yuY(1,ou,14,15,"div",18)(2,iu,1,1,"igo-custom-html",19),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",""===t.importHtmlClarifications),e.yG2(),e.E7m("ngIf",""!==t.importHtmlClarifications)}}function ru(l,m){1&l&&(e.I0R(0,"section",17)(1,"h4"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()),2&l&&(e.yG2(2),e.cNF(e.kDX(3,1,"igo.geo.importExportForm.exportNoLayersExportable")))}function su(l,m){if(1&l&&(e.I0R(0,"span",31),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(),e.CAO(" (+",t.layers.length-1," ",e.kDX(2,2,2===(null==t.layers?null:t.layers.length)?"igo.geo.importExportForm.other":"igo.geo.importExportForm.others"),") ")}}function au(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",34),e.qCj("click",function(n){e.usT(t);const p=e.GaO().$implicit,v=e.GaO(2);return e.CGJ(v.onlySelectedClick(n,p.id))})("checked",function(){e.usT(t);const n=e.GaO().$implicit,p=e.GaO(2);return e.CGJ(p.inLayersIdToExportSelectionOnly(n))})("change",function(n){e.usT(t);const p=e.GaO().$implicit,v=e.GaO(2);return e.CGJ(v.onlySelected(n,p.id))}),e.I0R(1,"small"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()}2&l&&(e.yG2(2),e.cNF(e.kDX(3,1,"igo.geo.importExportForm.exportSelectedFeature")))}const lu=l=>({"igo-export-layer-mat-option":l});function cu(l,m){if(1&l&&(e.I0R(0,"mat-option",32),e.qCj("click",function(i){return i.stopPropagation()}),e.I0R(1,"p",16),e.OEk(2),e.C$Y(),e.I0R(3,"p",16),e.yuY(4,au,4,3,"mat-slide-toggle",33),e.C$Y()()),2&l){const t=m.$implicit,i=e.GaO(2);e.E7m("ngClass",e.S45(4,lu,i.layerHasSelectedFeatures(t)))("value",t.id),e.yG2(2),e.cNF(t.title),e.yG2(2),e.E7m("ngIf",i.layerHasSelectedFeatures(t))}}function uu(l,m){if(1&l&&(e.I0R(0,"mat-option",2),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.export.format."+t.value)," ")}}function du(l,m){if(1&l&&(e.SAx(0),e.yuY(1,uu,3,4,"mat-option",35),e.wVc(2,"keyvalue"),e.wVc(3,"async"),e.k70()),2&l){const t=e.GaO(2);e.yG2(),e.E7m("ngForOf",e.kDX(2,1,e.kDX(3,3,t.formats$)))}}function pu(l,m){1&l&&(e.I0R(0,"mat-option",36),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.export.noFormat.title")," "))}function mu(l,m){1&l&&(e.I0R(0,"div",6)(1,"mat-form-field"),e.wR5(2,"input",37),e.wVc(3,"translate"),e.C$Y()()),2&l&&(e.yG2(2),e._6D("placeholder",e.kDX(3,1,"igo.geo.importExportForm.exportFileNamePlaceholder")))}function gu(l,m){if(1&l&&(e.I0R(0,"mat-option",2),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.export.encoding."+t.value)," ")}}function hu(l,m){if(1&l&&(e.SAx(0),e.yuY(1,gu,3,4,"mat-option",35),e.wVc(2,"keyvalue"),e.wVc(3,"async"),e.k70()),2&l){const t=e.GaO(3);e.yG2(),e.E7m("ngForOf",e.kDX(2,1,e.kDX(3,3,t.encodings$)))}}function fu(l,m){if(1&l&&(e.I0R(0,"div",6)(1,"mat-form-field")(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"mat-select",38),e.yuY(6,hu,4,5,"ng-container",18),e.wVc(7,"async"),e.C$Y()()()),2&l){const t=e.GaO(2);e.yG2(3),e.cNF(e.kDX(4,2,"igo.geo.importExportForm.encodingPlaceholder")),e.yG2(3),e.E7m("ngIf",0!==e.kDX(7,4,t.encodings$).length)}}function yu(l,m){1&l&&(e.I0R(0,"div",39)(1,"mat-slide-toggle",40),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()),2&l&&(e.yG2(),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(3,2,"igo.geo.importExportForm.exportCombineResults")," "))}function _u(l,m){1&l&&(e.I0R(0,"div",41)(1,"mat-slide-toggle",42),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()),2&l&&(e.yG2(),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(3,2,"igo.geo.importExportForm.exportSeparator")," "))}function Cu(l,m){1&l&&(e.I0R(0,"div",43)(1,"mat-slide-toggle",44),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()),2&l&&(e.yG2(),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(3,2,"igo.geo.importExportForm.exportFeatureInExtent")," "))}function vu(l,m){if(1&l&&e.wR5(0,"igo-custom-html",20),2&l){const t=e.GaO(2);e.E7m("html",t.exportHtmlClarifications)}}function Su(l,m){if(1&l){const t=e.KQA();e.I0R(0,"form",5)(1,"div",6)(2,"mat-form-field")(3,"mat-label"),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.I0R(6,"mat-select",21),e.iHE("valueChange",function(n){e.usT(t);const p=e.GaO();return e.kNx(p.layers,n)||(p.layers=n),e.CGJ(n)}),e.I0R(7,"mat-select-trigger"),e.OEk(8),e.yuY(9,su,3,4,"span",22),e.C$Y(),e.yuY(10,cu,5,6,"mat-option",23),e.wVc(11,"async"),e.C$Y()()(),e.I0R(12,"div",6)(13,"mat-form-field")(14,"mat-label"),e.OEk(15),e.wVc(16,"translate"),e.C$Y(),e.I0R(17,"mat-select",24),e.yuY(18,du,4,5,"ng-container",18),e.wVc(19,"async"),e.yuY(20,pu,3,3,"mat-option",25),e.wVc(21,"async"),e.C$Y()()(),e.yuY(22,mu,4,3,"div",26)(23,fu,8,6,"div",26)(24,yu,4,4,"div",27)(25,_u,4,4,"div",28)(26,Cu,4,4,"div",29),e.I0R(27,"div",30)(28,"button",10),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.handleExportFormSubmit(n.form.value))}),e.wVc(29,"async"),e.OEk(30),e.wVc(31,"translate"),e.wVc(32,"translate"),e.wVc(33,"translate"),e.C$Y(),e.wR5(34,"igo-spinner",11),e.wVc(35,"async"),e.C$Y(),e.yuY(36,vu,1,1,"igo-custom-html",19),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("formGroup",t.form),e.yG2(4),e.cNF(e.kDX(5,18,"igo.geo.importExportForm.exportLayerPlaceholder")),e.yG2(2),e.OKB("value",t.layers),e.yG2(2),e.oRS(" ",t.layers.length?t.getLayerTitleById(t.layers[0]):""," "),e.yG2(),e.E7m("ngIf",t.layers.length>1),e.yG2(),e.E7m("ngForOf",e.kDX(11,20,t.exportableLayers$)),e.yG2(5),e.cNF(e.kDX(16,22,"igo.geo.importExportForm.exportFormatPlaceholder")),e.yG2(3),e.E7m("ngIf",0!==e.kDX(19,24,t.formats$).length),e.yG2(2),e.E7m("ngIf",0===e.kDX(21,26,t.formats$).length),e.yG2(2),e.E7m("ngIf",t.forceNaming&&"URL"!==t.form.value.format),e.yG2(),e.E7m("ngIf","CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format),e.yG2(),e.E7m("ngIf",t.layers.length>1&&("CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format)),e.yG2(),e.E7m("ngIf",t.layers.length>1&&("CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format)&&t.form.value.combineLayers),e.yG2(),e.E7m("ngIf","URL"!==t.form.value.format),e.yG2(2),e.E7m("disabled",!t.form.valid||e.kDX(29,28,t.loading$)),e.yG2(2),e.oRS(" ","URL"!==t.form.value.format?e.kDX(31,30,"igo.geo.importExportForm.exportButton"):t.form.value.layers.length>1?e.kDX(32,32,"igo.geo.importExportForm.exportButtonLinks"):e.kDX(33,34,"igo.geo.importExportForm.exportButtonLink")," "),e.yG2(4),e.E7m("shown",e.kDX(35,36,t.loading$)),e.yG2(2),e.E7m("ngIf",""!==t.exportHtmlClarifications)}}let _a=(()=>{class l{importService;exportService;languageService;messageService;styleListService;styleService;formBuilder;config;cdRef;storageService;downloadService;layerService;confirmDialogService;form;importForm;formats$=new A.g(void 0);encodings$=new A.g(void 0);exportableLayers$=new A.g([]);loading$=new A.g(!1);forceNaming=!1;controlFormat="format";layers$$;exportableLayers$$;formats$$;encodings$$;formLayer$$;exportOptions$$;importHtmlClarifications;exportHtmlClarifications;espgCodeRegex=new RegExp("^\\d{4,6}");clientSideFileSizeMax;fileSizeMb;projections$=new A.g([]);projectionsConstraints;popupChecked=!1;previousLayerSpecs$=new A.g(void 0);selectFirstProj=!1;map;contextUri;_projectionsLimitations={};set projectionsLimitations(t){this._projectionsLimitations=t,this.computeProjections()}get projectionsLimitations(){return this._projectionsLimitations||{}}store;selectedMode="import";selectMode=new e._w7;exportOptions$=new A.g(void 0);exportOptionsChange=new e._w7;get layers(){return this.form.get("layers").value}set layers(t){this.form.patchValue({layers:t})}get inputProj(){return this.importForm.get("inputProj").value}set inputProj(t){this.importForm.patchValue({inputProj:t})}get popupAllowed(){return this.storageService.get("importExportPopupAllowed")||!1}set popupAllowed(t){this.storageService.set("importExportPopupAllowed",t)}constructor(t,i,n,p,v,k,de,he,Oe,be,Pe,Je,Fe){this.importService=t,this.exportService=i,this.languageService=n,this.messageService=p,this.styleListService=v,this.styleService=k,this.formBuilder=de,this.config=he,this.cdRef=Oe,this.storageService=be,this.downloadService=Pe,this.layerService=Je,this.confirmDialogService=Fe,this.loadConfig(),this.buildForm(),this.computeProjections(),this.importHtmlClarifications=this.languageService.translate.instant("igo.geo.importExportForm.importHtmlClarifications"),this.exportHtmlClarifications=this.languageService.translate.instant("igo.geo.importExportForm.exportHtmlClarifications")}ngOnInit(){this.layers$$=this.map.layers$.subscribe(i=>{this.exportableLayers$.next(i.filter(n=>n instanceof Et.M&&!0===n.exportable||n.dataSource.options.download&&n.dataSource.options.download.url))});const t=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(t||30)*Math.pow(1024,2),this.fileSizeMb=this.clientSideFileSizeMax/Math.pow(1024,2),this.exportOptions$$=this.exportOptions$.pipe((0,xn.O)(i=>!i)).subscribe(i=>{this.form.patchValue(i,{emitEvent:!0}),i.layers&&this.computeFormats(i.layers.map(n=>this.map.getLayerById(n)))}),this.formLayer$$=this.form.get("format").valueChanges.subscribe(i=>{const n=Object.keys(Cr.ogreFormats);!this.popupChecked&&this.form.get("layers").value?.length>1&&(n.indexOf(i)>=0||i===It.URL)&&(this.handlePopup(!0)||this.form.patchValue({format:void 0},{emitEvent:!1}))}),this.formLayer$$=this.form.get("layers").valueChanges.subscribe(i=>{this.handlePreviousLayerSpecs();const n=i instanceof Array?i:[i];this.form.patchValue({layers:n},{emitEvent:!1});const p=n.map(k=>this.map.getLayerById(k));this.computeFormats(p),-1===Object.keys(this.formats$.value).indexOf(this.form.value.format)&&this.form.patchValue({format:void 0}),this.loading$.next(!0);const v=[];p.forEach(k=>{k instanceof Et.M&&0===k.dataSource.ol.getFeatures().length&&(v.push({id:k.id,visible:k.visible,opacity:k.opacity,queryable:k.queryable}),k.opacity=0,k.visible=!0)}),this.previousLayerSpecs$.next(v),setTimeout(()=>{this.loading$.next(!1)},500)}),this.formats$$=this.formats$.pipe((0,xn.O)(i=>!i)).subscribe(i=>{1===Object.keys(i).length&&this.form.patchValue({format:i[Object.keys(i)[0]]})}),this.encodings$$=this.encodings$.pipe((0,xn.O)(i=>!i)).subscribe(i=>{1===Object.keys(i).length&&this.form.patchValue({encoding:i[Object.keys(i)[0]]})}),this.exportableLayers$$=this.exportableLayers$.pipe((0,xn.O)(i=>!i)).subscribe(i=>{1===i.length&&this.form.patchValue({layers:i[0].id})}),this.form.controls[this.controlFormat].valueChanges.subscribe(i=>{this.form.patchValue(i===It.CSVcomma||i===It.CSVsemicolon?{encoding:si.LATIN1}:{encoding:si.UTF8}),this.cdRef.detectChanges()}),this.importForm.patchValue(this.selectFirstProj?0===this.projections$.value.length?{inputProj:{translateKey:"nad83",alias:"NAD83",code:"EPSG:4326",zone:""}}:{inputProj:this.projections$.value[0]}:{inputProj:void 0})}computeProjections(){this.projectionsConstraints=(0,Wr.KG)(this.projectionsLimitations);const t=[];if(this.projectionsConstraints.nad83&&t.push({translateKey:"nad83",alias:"NAD83",code:"EPSG:4269",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.wgs84&&t.push({translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.webMercator&&t.push({translateKey:"webMercator",alias:"Web Mercator",code:"EPSG:3857",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.mtm){const p=this.projectionsConstraints.mtmZone.maxZone;for(let v=this.projectionsConstraints.mtmZone.minZone;v<=p;v++)t.push({translateKey:"mtm",alias:`MTM ${v}`,code:v<10?`EPSG:3218${v}`:`EPSG:321${80+v}`,zone:`${v}`,extent:void 0,def:void 0})}if(this.projectionsConstraints.utm){const p=this.projectionsConstraints.utmZone.maxZone;for(let v=this.projectionsConstraints.utmZone.minZone;v<=p;v++)t.push({translateKey:"utm",alias:`UTM ${v}`,code:v<10?`EPSG:3260${v}`:`EPSG:326${v}`,zone:`${v}`,extent:void 0,def:void 0})}let i=[];this.projectionsConstraints.projFromConfig&&(i=this.config.getConfig("projections")||[]),this.projections$.next(i.concat(t))}getWorkspaceByLayerId(t){const i=this.store.all().find(n=>n.layer.id===t);if(i)return i}getLayerTitleById(t){return this.map.getLayerById(t)?.title}layerHasSelectedFeatures(t){const i=this.getWorkspaceByLayerId(t.id);if(i)return!!i.entityStore.stateView.firstBy(p=>!0===p.state.selected)}onlySelected(t,i){let n=this.form.value.layersWithSelection;t.checked?n.push(i):n=n.filter(p=>p!==i),this.form.patchValue({layersWithSelection:n})}onlySelectedClick(t,i){this.form.value.layers.find(n=>n===i)&&t.stopPropagation()}inLayersIdToExportSelectionOnly(t){return!!this.form.value.layersWithSelection.find(i=>i===t.id)}ngOnDestroy(){this.layers$$.unsubscribe(),this.exportableLayers$$.unsubscribe(),this.formats$$.unsubscribe(),this.encodings$$.unsubscribe(),this.formLayer$$.unsubscribe(),this.exportOptions$$&&this.exportOptions$$.unsubscribe(),this.exportOptionsChange.emit(this.form.value),this.handlePreviousLayerSpecs()}handlePreviousLayerSpecs(){const t=this.previousLayerSpecs$.value;t&&t.length&&t.forEach(i=>{const n=this.map.getLayerById(i.id);n.visible=i.visible,n.opacity=i.opacity,n.queryable=i.queryable}),this.previousLayerSpecs$.next(void 0)}importFiles(t){let i=this.inputProj.code;this.espgCodeRegex.test(i)&&(i=`EPSG:${i}`),this.loading$.next(!0);for(const n of t)this.importService.import(n,i).subscribe(p=>this.onFileImportSuccess(n,p),p=>this.onFileImportError(n,p),()=>{this.loading$.next(!1)})}handlePopup(t=!0){window.open("","popup","width=1, height=1").close();const n=window.open("","popup","width=1, height=1");return!n||n.closed||typeof n.closed>"u"||null===n?(this.onPopupBlockedError(t),this.popupAllowed=!1):(n.close(),this.popupAllowed=!0,this.popupChecked=!0),this.popupAllowed}handleExportFormSubmit(t){this.loading$.next(!0);const i=Object.keys(Cr.ogreFormats);!this.popupChecked&&t.layers.length>1&&(i.indexOf(t.format)>=0||t.format===It.URL)&&!this.popupAllowed&&this.handlePopup();let n=[],p=[],v="";for(const[k,de]of t.layers.entries()){const he=this.map.getLayerById(de);t.format!==It.CSVsemicolon&&t.format!==It.CSVcomma||!t.combineLayers||1===t.layers.length?(v=he.title,t.name&&(v=t.name)):v=this.languageService.translate.instant("igo.geo.export.combinedLayers");const Oe=he.dataSource.options;if(t.format===It.URL&&Oe.download&&(Oe.download.url||Oe.download.dynamicUrl))return void setTimeout(()=>{const Fe=Oe.download.url||Oe.download.dynamicUrl;Fe.match(/service=wfs/gi)?this.downloadService.open(he):window.open(Fe,"_blank"),this.loading$.next(!1)},500);const be=this.getWorkspaceByLayerId(de);let Pe;if(be&&be.entityStore&&be.entityStore.stateView.all().length)Pe=-1!==t.layersWithSelection.indexOf(de)&&t.featureInMapExtent?be.entityStore.stateView.all().filter(Fe=>Fe.state.inMapExtent&&Fe.state.selected).map(Fe=>Fe.entity.ol):-1===t.layersWithSelection.indexOf(de)||t.featureInMapExtent?t.featureInMapExtent?be.entityStore.stateView.all().filter(Fe=>Fe.state.inMapExtent).map(Fe=>Fe.entity.ol):be.entityStore.stateView.all().map(Fe=>Fe.entity.ol):be.entityStore.stateView.all().filter(Fe=>Fe.state.selected).map(Fe=>Fe.entity.ol);else{const Fe=he.dataSource.ol;Pe=t.featureInMapExtent?Fe.getFeaturesInExtent(he.map.viewController.getExtent()):Fe.getFeatures(),he.dataSource instanceof es.a&&(Pe=Pe.flatMap(et=>et.get("features")))}let Je=[];if(t.format===It.Shapefile||t.format===It.GPX?Pe.forEach(Fe=>{const et=Fe.getGeometry().getType(),pt=Je.find(Tt=>Tt.geometryType===et);pt?pt.features.push(Fe):Je.push({geometryType:et,features:[Fe]})}):Je=[{geometryType:"",features:Pe}],Je.forEach(Fe=>{Fe.features.forEach(et=>{const pt=et.get("rad");if(pt){const Tt=[et.get("longitude"),et.get("latitude")],Ht=(0,z.e8)(Tt,pt,500);Ht.transform("EPSG:4326",et.get("_projection")),et.setGeometry(Ht)}})}),t.format===It.GPX){const Fe=Je.length;Je=Je.filter(pt=>["LineString","Point"].includes(pt.geometryType)),Fe>Je.length&&this.messageService.error("igo.geo.export.gpx.error.poly.text","igo.geo.export.gpx.error.poly.title",{timeOut:2e4})}else if((t.format===It.CSVsemicolon||t.format===It.CSVcomma)&&t.combineLayers){if(Je.forEach(Fe=>n.push(Fe)),k!==t.layers.length-1)continue;{let Fe;n.forEach(et=>{et.features.forEach(pt=>{if(t.separator)if(Fe){if(pt.get("_featureStore").layer.options.title!==Fe.get("_featureStore").layer.options.title){const Tt=this.createTitleEmptyRows(Fe,pt);p.push(Tt[2]),p.push(Tt[0]),p.push(Tt[1])}}else{const Tt=this.createTitleEmptyRows(pt,pt);p.push(Tt[0])}p.push(pt),Fe=pt})})}}0===Je.length?(this.loading$.next(!1),this.messageService.error("igo.geo.export.nothing.text","igo.geo.export.nothing.title",{timeOut:2e4})):(t.format!==It.CSVsemicolon&&t.format!==It.CSVcomma||!t.combineLayers)&&Je.map(Fe=>this.exportService.export(Fe.features,t.format,v+Fe.geometryType,t.encoding,this.map.projection).subscribe(()=>{},et=>this.onFileExportError(et),()=>{this.onFileExportSuccess(),Fe.features.forEach(et=>{this.circleToPoint(et)}),this.loading$.next(!1)}))}(t.format===It.CSVsemicolon||t.format===It.CSVcomma)&&t.combineLayers&&this.exportService.export(p,t.format,v,t.encoding,this.map.projection).subscribe(()=>{},k=>this.onFileExportError(k),()=>{this.onFileExportSuccess(),p.forEach(k=>{this.circleToPoint(k)}),this.loading$.next(!1)})}createTitleEmptyRows(t,i){const n=i.clone(),p=i.clone(),v=i.clone(),k=t.getKeys();let de="";for(const Fe in k)if("geometry"!==k[Fe]){de=k[Fe];break}const he=i.getKeys();let Oe="";for(const Fe in he)if("geometry"!==he[Fe]){Oe=he[Fe];break}const be=i.getKeys();k.forEach(Fe=>{be.includes(Fe)&&Fe!==de&&be.push(Fe)}),be.unshift(de);let Pe="";for(const Fe in be)if("geometry"!==be[Fe]){Pe=be[Fe];break}return be.forEach(Fe=>{const et=k.length===he.length&&k.every((pt,Tt)=>pt===he[Tt]);Fe!==Pe||et?Fe===Pe&&et||Fe===Oe?(n.set(Fe,i.get("_featureStore").layer.options.title,!0),p.set(Fe,Fe,!0),v.unset(Fe,!0)):"geometry"!==Fe?(n.unset(Fe,!0),p.set(Fe,Fe,!0),v.unset(Fe,!0)):(n.unset(Fe,!0),v.unset(Fe,!0)):(n.set(Fe,i.get("_featureStore").layer.options.title+" ===============>",!0),p.set(Fe,Fe,!0),v.unset(Fe,!0)),he.includes(Fe)||p.unset(Fe,!0)}),[n,p,v]}circleToPoint(t){if(t.get("rad")){const n=new c.c([t.get("longitude"),t.get("latitude")]);n.transform("EPSG:4326",t.get("_projection")),t.setGeometry(n)}}buildForm(){this.importForm=this.formBuilder.group({inputProj:["",[Me.AQ.required]]}),this.form=this.formBuilder.group(this.forceNaming?{format:["",[Me.AQ.required]],layers:[[],[Me.AQ.required]],layersWithSelection:[[]],encoding:[si.UTF8,[Me.AQ.required]],combineLayers:[!0,[Me.AQ.required]],separator:[!1,[Me.AQ.required]],featureInMapExtent:[!1,[Me.AQ.required]],name:["",[Me.AQ.required]]}:{format:["",[Me.AQ.required]],layers:[[],[Me.AQ.required]],layersWithSelection:[[]],encoding:[si.UTF8,[Me.AQ.required]],combineLayers:[!0,[Me.AQ.required]],separator:[!1,[Me.AQ.required]],featureInMapExtent:[!1,[Me.AQ.required]]})}onFileImportSuccess(t,i){const n=this.config.getConfig("importExport"),p=n?.allowToStoreLayer?this.confirmDialogService:void 0;n?.importWithStyle?Or(t,i,this.map,this.contextUri,this.messageService,this.layerService,p,this.styleListService,this.styleService):Or(t,i,this.map,this.contextUri,this.messageService,this.layerService,p)}onFileImportError(t,i){this.loading$.next(!1),function ha(l,m,t,i){({"Invalid file":Wc,"File is too large":Hc,"Failed to read file":Nc,"Invalid SRS definition":Xc,"Error 500 with OGRE":Jc})[m.message](l,m,t,i=i||30)}(t,i,this.messageService,this.fileSizeMb)}onPopupBlockedError(t=!0){this.loading$.next(!1),this.messageService.error("igo.geo.export.popupBlocked.text","igo.geo.export.popupBlocked.title",{timeOut:2e4},{extraMessage:t?"igo.geo.export.popupBlocked.selectAgain":"igo.geo.export.popupBlocked.retry"})}onFileExportError(t){this.loading$.next(!1),function kc(l,m){l instanceof _r?function Uc(l){l.error("igo.geo.export.nothing.text","igo.geo.export.nothing.title")}(m):m.error("igo.geo.export.failed.text","igo.geo.export.failed.title")}(t,this.messageService)}loadConfig(){const t=this.config.getConfig("importExport.forceNaming");this.forceNaming=void 0!==t&&t,this.computeFormats(),this.loadEncodings()}encodingDefaultValue(t){return t===It.CSVcomma||t===It.CSVsemicolon?(this.form.patchValue({encoding:si.LATIN1}),si.LATIN1):(this.form.patchValue({encoding:si.UTF8}),si.UTF8)}loadEncodings(){this.encodings$.next(si)}computeFormats(t){let i=Object.keys(It);const n={onlyUrl:!1,onlyVector:!1,vectorAndUrl:!1,customList:!1},p=[];if(t&&t.length)if(t.forEach(k=>{k&&(k.dataSource.options.download?.allowedFormats?(n.customList=!0,p.push({layer:k.title,formats:this.validateListFormat(k.dataSource.options.download.allowedFormats)})):k instanceof Et.M||!k.dataSource.options.download||!k.dataSource.options.download.url?k.dataSource.options.download&&(k.dataSource.options.download.url||k.dataSource.options.download.dynamicUrl)?n.vectorAndUrl=!0:k instanceof Et.M&&(n.onlyVector=!0):n.onlyUrl=!0)}),!0===n.onlyUrl&&!1===n.onlyVector)i=["URL"];else if(!0===n.onlyVector&&!1===n.onlyUrl)this.computeFormats(),It.URL in this.formats$.value&&(i=Object.keys(this.formats$.value).filter(de=>"URL"!==de));else if(!0===n.vectorAndUrl&&!1===n.onlyUrl&&!1===n.onlyVector&&(this.computeFormats(),!(It.URL in this.formats$.value))){const k=Object.keys(this.formats$.value);k.push("URL"),i=k}const v=this.config.getConfig("importExport.formats");if(v){const k=this.validateListFormat(v);i=i.filter(de=>k.includes(de))}if(n.customList){let k;const de=[];let he=p[0].formats;p.map(be=>{de.push(be.layer),k=be.formats.filter(Pe=>he.includes(Pe)),he=be.formats});const Oe=k.filter(be=>i.includes(be));Oe.length>0?(this.formats$.next((0,le.GC)(Oe)),t&&t.length&&t.length>1&&this.messageService.alert("igo.geo.export.customList.text","igo.geo.export.customList.title",void 0,{value:de.join()})):(this.formats$.next([]),this.messageService.alert("igo.geo.export.noFormat.text","igo.geo.export.noFormat.title"))}else this.formats$.next((0,le.GC)(i))}validateListFormat(t){return t.filter(i=>{if(i.toUpperCase()===It.CSVcomma.toUpperCase()||i.toUpperCase()===It.CSVsemicolon.toUpperCase()||i.toUpperCase()===It.GML.toUpperCase()||i.toUpperCase()===It.GPX.toUpperCase()||i.toUpperCase()===It.GeoJSON.toUpperCase()||i.toUpperCase()===It.KML.toUpperCase()||i.toUpperCase()===It.Shapefile.toUpperCase()||i.toUpperCase()===It.URL.toUpperCase())return i}).map(i=>i.toUpperCase()===It.CSVcomma.toUpperCase()?i=It.CSVcomma:i.toUpperCase()===It.CSVsemicolon.toUpperCase()?i=It.CSVsemicolon:i.toUpperCase()===It.GML.toUpperCase()?i=It.GML:i.toUpperCase()===It.GPX.toUpperCase()?i=It.GPX:i.toUpperCase()===It.GeoJSON.toUpperCase()?i=It.GeoJSON:i.toUpperCase()===It.KML.toUpperCase()?i=It.KML:i.toUpperCase()===It.Shapefile.toUpperCase()?i=It.Shapefile:i.toUpperCase()===It.URL.toUpperCase()?i=It.URL:void 0)}modeChanged(t){this.selectMode.emit(t)}onFileExportSuccess(){!function Bc(l){l.success("igo.geo.export.success.text","igo.geo.export.success.title")}(this.messageService)}onImportExportChange(t){this.selectedMode=t.value}static \u0275fac=function(i){return new(i||l)(e.GI1(ya),e.GI1(Cr),e.GI1(L.ov),e.GI1(Qt.mi),e.GI1(ts),e.GI1(cr.U),e.GI1(Me.KE),e.GI1(M.aW),e.GI1(e.kD9),e.GI1(oe.yQ),e.GI1(pe),e.GI1(yr.I),e.GI1(Ue.Ex))};static \u0275cmp=e.In1({type:l,selectors:[["igo-import-export"]],inputs:{selectFirstProj:"selectFirstProj",map:"map",contextUri:"contextUri",projectionsLimitations:"projectionsLimitations",store:"store",selectedMode:"selectedMode",exportOptions$:"exportOptions$"},outputs:{selectMode:"selectMode",exportOptionsChange:"exportOptionsChange"},standalone:!0,features:[e.M5G([Ue.Ex]),e.UHJ],decls:14,vars:17,consts:[[1,"import-export-toggle","mat-typography"],[3,"value","change"],[3,"value"],["class","igo-form",3,"formGroup",4,"ngIf"],["class","mat-typography",4,"ngIf"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],[3,"value","valueChange"],[3,"value","click",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500",1,"igo-form-button-group",3,"matTooltip"],["mat-raised-button","","type","button",3,"disabled","click"],[3,"shown"],["hidden","","type","file",3,"click","change"],["fileInput",""],[3,"value","click"],["matListItemTitle","",4,"ngIf"],["matListItemTitle",""],[1,"mat-typography"],[4,"ngIf"],["class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"],["multiple","",3,"value","valueChange"],["class","export-select-trigger",4,"ngIf"],[3,"ngClass","value","click",4,"ngFor","ngForOf"],["formControlName","format"],["disabled","true",4,"ngIf"],["class","igo-input-container",4,"ngIf"],["class","export-combine-layers mat-typography",4,"ngIf"],["class","export-separator mat-typography",4,"ngIf"],["class","export-options mat-typography",4,"ngIf"],[1,"igo-form-button-group"],[1,"export-select-trigger"],[3,"ngClass","value","click"],[3,"click","checked","change",4,"ngIf"],[3,"click","checked","change"],[3,"value",4,"ngFor","ngForOf"],["disabled","true"],["matInput","","formControlName","name",3,"placeholder"],["formControlName","encoding"],[1,"export-combine-layers","mat-typography"],["formControlName","combineLayers",3,"labelPosition"],[1,"export-separator","mat-typography"],["formControlName","separator",3,"labelPosition"],[1,"export-options","mat-typography"],["formControlName","featureInMapExtent",3,"labelPosition"]],template:function(i,n){1&i&&(e.I0R(0,"div",0)(1,"mat-button-toggle-group",1),e.qCj("change",function(v){return n.onImportExportChange(v)}),e.I0R(2,"mat-button-toggle",2),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"mat-button-toggle",2),e.OEk(6),e.wVc(7,"translate"),e.C$Y()()(),e.yuY(8,eu,20,24,"form",3)(9,nu,3,2,"section",4)(10,ru,4,3,"section",4),e.wVc(11,"async"),e.yuY(12,Su,37,38,"form",3),e.wVc(13,"async")),2&i&&(e.yG2(),e.E7m("value",n.selectedMode),e.yG2(),e.E7m("value","import"),e.yG2(),e.oRS(" ",e.kDX(4,9,"igo.geo.importExportForm.importTabTitle")," "),e.yG2(2),e.E7m("value","export"),e.yG2(),e.oRS(" ",e.kDX(7,11,"igo.geo.importExportForm.exportTabTitle")," "),e.yG2(2),e.E7m("ngIf","import"===n.selectedMode),e.yG2(),e.E7m("ngIf","import"===n.selectedMode),e.yG2(),e.E7m("ngIf",0===e.kDX(11,13,n.exportableLayers$).length&&"export"===n.selectedMode),e.yG2(2),e.E7m("ngIf",e.kDX(13,15,n.exportableLayers$).length>0&&"export"===n.selectedMode))},dependencies:[ro.ue,ro.gn,ro.KU,Xe.u_,Me.y,Me.sz,Me.ot,Me.ue,Me.u,Me.sl,Me.uW,Me.Wo,ft.wb,ft.Up,ft.w5,At.d5,At.kX,At.gl,Gt.I5,Xe.Iw,Gt.Ax,st.KO,st.a4,ct.oJ,ct.Gw,Ue.is,Ue.YM,Xe.QF,Co.GE,Co.cP,Yt.cN,Yt.yi,Xe.a,Xe.uq,it.O0,it.sD],styles:["[_nghost-%COMP%]   mat-option.igo-export-layer-mat-option[_ngcontent-%COMP%]{height:5em;line-height:1em}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   h4[_ngcontent-%COMP%]{padding:0 5px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:15px 5px}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}[_nghost-%COMP%]   igo-spinner[_ngcontent-%COMP%]{position:absolute;padding-left:10px}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%], [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%], [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field, [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field, [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label, [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label, [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .export-select-trigger[_ngcontent-%COMP%]{opacity:.75;font-size:.75em}"]})}return l})();var Ca=s(39882),bu=s(17400),Fi=s(68252);function wu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-checkbox",10),e.qCj("change",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.check())}),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("checked",t.layerCheck)}}const va=l=>({disabled:l});function Ou(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",11),e.qCj("click",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.toggleVisibility(n))}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",12),e.wVc(3,"async"),e.wVc(4,"async"),e.wVc(5,"async"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("color",t.layer.visible?"primary":"default")("matTooltip",e.kDX(1,5,t.eyeTooltip)),e.yG2(2),e.E7m("matBadgeHidden",e.kDX(3,7,t.queryBadgeHidden$))("ngClass",e.S45(13,va,!1===e.kDX(4,9,t.inResolutionRange$)))("svgIcon",e.kDX(5,11,t.layer.visible$)?"eye":"eye-off")}}function Iu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",13),e.qCj("click",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.toggleVisibility(n))}),e.wVc(1,"translate"),e.wVc(2,"translate"),e.wR5(3,"mat-icon",12),e.wVc(4,"async"),e.wVc(5,"async"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.kDX(1,5,"igo.geo.layer.hideLayer"):e.kDX(2,7,"igo.geo.layer.showLayer")),e.yG2(3),e.E7m("matBadgeHidden",e.kDX(4,9,t.queryBadgeHidden$))("ngClass",e.S45(13,va,!1===e.kDX(5,11,t.inResolutionRange$)))("svgIcon",t.layer.visible?"eye":"eye-off")}}function Tu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",14),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleLayerTool())}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",15),e.C$Y()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.layer.moreOptions"))}function Eu(l,m){if(1&l&&e.wR5(0,"igo-layer-legend",16),2&l){const t=e.GaO();e.E7m("layer",t.layer)("updateLegendOnResolutionChange",t.updateLegendOnResolutionChange)}}let Sa=(()=>{class l{networkService;renderer;elRef;cdRef;focusedCls="igo-layer-item-focused";get activeLayer(){return this._activeLayer}set activeLayer(t){t&&this.layer&&t.id===this.layer.id&&!this.selectionMode?(this.layerTool$.next(!0),this.renderer.addClass(this.elRef.nativeElement,this.focusedCls)):this.renderer.removeClass(this.elRef.nativeElement,this.focusedCls)}_activeLayer;layerTool$=new A.g(!1);showLegend$=new A.g(!0);inResolutionRange$=new A.g(!0);queryBadgeHidden$=new A.g(!0);tooltipText;state;get selectAll(){return this._selectAll}set selectAll(t){this._selectAll=t,!0===t&&(this.layerCheck=!0)}_selectAll=!1;layerCheck;resolution$$;network$$;layers$$;layers$=new A.g(void 0);get layer(){return this._layer}set layer(t){this._layer=t,this.layers$.next(t)}_layer;toggleLegendOnVisibilityChange=!1;expandLegendIfVisible=!1;updateLegendOnResolutionChange=!1;orderable=!0;lowerDisabled=!1;raiseDisabled=!1;queryBadge=!1;selectionMode;changeDetection;get opacity(){return 100*this.layer.opacity}set opacity(t){this.layer.opacity=t/100}get eyeTooltip(){return!1===this.inResolutionRange$.getValue()?"igo.geo.layer.notInResolution":this.layer.visible?"igo.geo.layer.hideLayer":"igo.geo.layer.showLayer"}action=new e._w7(void 0);checkbox=new e._w7;constructor(t,i,n,p){this.networkService=t,this.renderer=i,this.elRef=n,this.cdRef=p}ngOnInit(){this.layer.visible&&this.expandLegendIfVisible&&!0===this.layer.firstLoadComponent&&(this.layer.firstLoadComponent=!1,this.layer.legendCollapsed=!1),this.toggleLegend(this.layer.legendCollapsed),this.updateQueryBadge(),this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.network$$=this.networkService.currentState().subscribe(i=>{this.state=i,this.onResolutionChange()}),this.layers$$=this.layers$.subscribe(()=>{this.layer&&this.layer.options.active&&(this.layerTool$.next(!0),this.renderer.addClass(this.elRef.nativeElement,this.focusedCls))}),this.changeDetection&&this.changeDetection.subscribe(()=>this.cdRef.detectChanges())}ngOnDestroy(){this.resolution$$.unsubscribe(),this.network$$.unsubscribe(),this.layers$$.unsubscribe()}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.toggleLegend(this.showLegend$.value)}toggleVisibility(t){t.stopPropagation(),this.layer.visible=!this.layer.visible,this.toggleLegendOnVisibilityChange&&this.toggleLegend(!this.layer.visible),this.updateQueryBadge()}computeTooltip(){const t=this.layer.options;if(!t.tooltip)return this.layer.title;const i=t.tooltip,n=t.metadata;switch(t.tooltip.type){case Fi.w.TITLE:return this.layer.title;case Fi.w.ABSTRACT:return n&&n.abstract?n.abstract:this.layer.title;case Fi.w.CUSTOM:return i&&i.text?i.text:this.layer.title;default:return this.layer.title}}onResolutionChange(){const t=this.layer.isInResolutionsRange;!1===t&&!0===this.updateLegendOnResolutionChange&&this.toggleLegend(!0),this.inResolutionRange$.next(t)}updateQueryBadge(){const t=!1===this.queryBadge||!1===this.layer.visible||!(0,bu.wd)(this.layer);this.queryBadgeHidden$.next(t)}toggleLayerTool(){this.layerTool$.next(!this.layerTool$.getValue()),!0===this.layerTool$.getValue()?this.renderer.addClass(this.elRef.nativeElement,this.focusedCls):this.renderer.removeClass(this.elRef.nativeElement,this.focusedCls),this.action.emit(this.layer)}check(){this.layerCheck=!this.layerCheck,this.checkbox.emit({layer:this.layer,check:this.layerCheck})}static \u0275fac=function(i){return new(i||l)(e.GI1(Ca.u),e.GI1(e.q87),e.GI1(e.GMv),e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-item"]],inputs:{activeLayer:"activeLayer",selectAll:"selectAll",layerCheck:"layerCheck",layer:"layer",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendIfVisible:"expandLegendIfVisible",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",orderable:"orderable",lowerDisabled:"lowerDisabled",raiseDisabled:"raiseDisabled",queryBadge:"queryBadge",selectionMode:"selectionMode",changeDetection:"changeDetection"},outputs:{action:"action",checkbox:"checkbox"},standalone:!0,features:[e.UHJ],decls:12,vars:9,consts:[[1,"igo-layer-list-item"],["class","layerCheck","matListItemIcon","",3,"checked","change",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-layer-title",3,"matTooltip","click"],["matListItemMeta",""],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","selection-eye","mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","actions-button","tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",3,"matTooltip","click",4,"ngIf"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer","updateLegendOnResolutionChange",4,"ngIf"],["matListItemIcon","",1,"layerCheck",3,"checked","change"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],["aria-hidden","false","matBadge","?","matBadgeColor","accent","matBadgeSize","small","matBadgePosition","after",3,"matBadgeHidden","ngClass","svgIcon"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",1,"selection-eye",3,"color","matTooltip","click"],["tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",1,"actions-button",3,"matTooltip","click"],["svgIcon","dots-horizontal"],[3,"layer","updateLegendOnResolutionChange"]],template:function(i,n){1&i&&(e.I0R(0,"mat-list-item",0),e.yuY(1,wu,1,1,"mat-checkbox",1),e.I0R(2,"span",2),e.qCj("click",function(){return n.toggleLegendOnClick()}),e.OEk(3),e.C$Y(),e.I0R(4,"div",3),e.yuY(5,Ou,6,15,"button",4)(6,Iu,6,15,"button",5)(7,Tu,3,3,"button",6),e.C$Y()(),e.I0R(8,"div",7,8),e.yuY(10,Eu,1,2,"igo-layer-legend",9),e.wVc(11,"async"),e.C$Y()),2&i&&(e.yG2(),e.E7m("ngIf",n.selectionMode),e.yG2(),e.E7m("matTooltip",n.tooltipText),e.yG2(),e.oRS(" ",n.layer.title," "),e.yG2(2),e.E7m("ngIf",!n.selectionMode),e.yG2(),e.E7m("ngIf",n.selectionMode),e.yG2(),e.E7m("ngIf",!n.selectionMode),e.yG2(3),e.E7m("ngIf",e.kDX(11,7,n.showLegend$)))},dependencies:[_t.iI,_t.g9,_t.Y1,_t.UV,_t.At,Xe.u_,Lt.Vn,Lt.WK,st.KO,st.a4,ct.oJ,ct.um,tt.oB,tt.qL,qe.g,qe.S,Xe.QF,Eo,Xe.a,it.O0,it.sD],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]     .igo-layer-title{display:block;width:100%;cursor:pointer}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px)}[_nghost-%COMP%]   mat-icon[matBadge][_ngcontent-%COMP%]     .mat-badge-content{font-size:12px}[_nghost-%COMP%]   .layerCheck[_ngcontent-%COMP%]{align-self:baseline;width:16px;padding-right:0}"],changeDetection:0})}return l})(),ba=(()=>{class l{networkService;inResolutionRange$=new A.g(!0);tooltipText;state;resolution$$;network$$;layer;updateLegendOnResolutionChange=!1;constructor(t){this.networkService=t}ngOnInit(){this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.network$$=this.networkService.currentState().subscribe(i=>{this.state=i,this.onResolutionChange()})}ngOnDestroy(){this.resolution$$.unsubscribe(),this.network$$.unsubscribe()}computeTooltip(){const t=this.layer.options;if(!t.tooltip)return this.layer.title;const i=t.tooltip,n=t.metadata;switch(t.tooltip.type){case Fi.w.TITLE:return this.layer.title;case Fi.w.ABSTRACT:return n&&n.abstract?n.abstract:this.layer.title;case Fi.w.CUSTOM:return i&&i.text?i.text:this.layer.title;default:return this.layer.title}}onResolutionChange(){this.inResolutionRange$.next(this.layer.isInResolutionsRange)}static \u0275fac=function(i){return new(i||l)(e.GI1(Ca.u))};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-legend-item"]],inputs:{layer:"layer",updateLegendOnResolutionChange:"updateLegendOnResolutionChange"},standalone:!0,features:[e.UHJ],decls:6,vars:4,consts:[[1,"igo-layer-list-item"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-layer-title",3,"matTooltip"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer","updateLegendOnResolutionChange"]],template:function(i,n){1&i&&(e.I0R(0,"mat-list-item",0)(1,"span",1),e.OEk(2),e.C$Y()(),e.I0R(3,"div",2,3),e.wR5(5,"igo-layer-legend",4),e.C$Y()),2&i&&(e.yG2(),e.E7m("matTooltip",n.tooltipText),e.yG2(),e.cNF(n.layer.title),e.yG2(3),e.E7m("layer",n.layer)("updateLegendOnResolutionChange",n.updateLegendOnResolutionChange))},dependencies:[_t.iI,_t.g9,_t.UV,st.KO,st.a4,Eo],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-layer-list-item[_ngcontent-%COMP%]{height:48px;clear:both}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px)}"],changeDetection:0})}return l})();var wa=s(23680),Ir=s(54584),Oa=s(69936),Ia=s(25376);function xu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",6),e.qCj("change",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.toggleShowAllLegends(n.checked))}),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,4,"igo.geo.layer.legend.showAll"))("checked",t.showAllLegendsValue)("labelPosition","before"),e.yG2(2),e.oRS(" ",e.kDX(3,6,"igo.geo.layer.legend.showAll")," ")}}function Mu(l,m){1&l&&e.wR5(0,"mat-divider")}function Du(l,m){if(1&l&&e.wR5(0,"igo-layer-legend-item",8),2&l){const t=e.GaO().$implicit,i=e.GaO();e.E7m("layer",t)("updateLegendOnResolutionChange",i.updateLegendOnResolutionChange)}}function Pu(l,m){if(1&l&&e.yuY(0,Du,1,2,"igo-layer-legend-item",7),2&l){const t=m.$implicit,i=e.GaO();e.E7m("ngIf",!(i.excludeBaseLayers&&t.baseLayer))}}function Fu(l,m){1&l&&(e.I0R(0,"p",9),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLayersVisibleWithShowAllButton")," "))}function Ru(l,m){1&l&&(e.I0R(0,"p",9),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom")," "))}function Lu(l,m){1&l&&(e.I0R(0,"p",9),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLayersVisible")," "))}function Gu(l,m){1&l&&(e.I0R(0,"p",9),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLayersVisibleButZoom")," "))}let rs=(()=>{class l{orderable=!0;hasVisibleOrInRangeLayers$=new A.g(!0);hasVisibleAndNotInRangeLayers$=new A.g(!0);layersInUi$=new A.g([]);layers$=new A.g([]);showAllLegend=!1;change$=new wa.o(1);change$$;set layers(t){this._layers=t,this.next()}get layers(){return this._layers}_layers;excludeBaseLayers=!1;updateLegendOnResolutionChange=!1;allowShowAllLegends=!1;showAllLegendsValue=!1;allLegendsShown=new e._w7(!1);constructor(){}ngOnInit(){this.change$$=this.change$.pipe((0,Ia.C)(()=>0===this.layers.length?Ir.k:(0,Oa.k)(50))).subscribe(()=>{const t=this.computeShownLayers(this.layers.slice(0));this.layers$.next(t),this.hasVisibleOrInRangeLayers$.next(this.layers.slice(0).filter(i=>!0!==i.baseLayer).filter(i=>i.visible$.value&&i.isInResolutionsRange$.value).length>0),this.hasVisibleAndNotInRangeLayers$.next(this.layers.slice(0).filter(i=>!0!==i.baseLayer).filter(i=>i.visible$.value&&!i.isInResolutionsRange$.value).length>0),this.layersInUi$.next(this.layers.slice(0).filter(i=>!(!1===i.showInLayerList||this.excludeBaseLayers&&i.baseLayer)))})}ngOnDestroy(){this.change$$.unsubscribe()}next(){this.change$.next()}computeShownLayers(t){let i=t.filter(n=>n.visible&&n.isInResolutionsRange);return this.showAllLegendsValue&&(i=t),this.sortLayersByZindex(i)}sortLayersByZindex(t){return t.sort((i,n)=>n.zIndex-i.zIndex)}toggleShowAllLegends(t){this.showAllLegendsValue=t,this.next(),this.allLegendsShown.emit(t)}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-legend-list"]],inputs:{layers:"layers",excludeBaseLayers:"excludeBaseLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue"},outputs:{allLegendsShown:"allLegendsShown"},standalone:!0,features:[e.UHJ],decls:24,vars:39,consts:[[1,"layer-legend-list-container"],["tooltip-position","above","matTooltipShowDelay","500","class","mat-typography",3,"matTooltip","checked","labelPosition","change",4,"ngIf"],[4,"ngIf"],[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["class","layers-empty mat-typography",4,"ngIf"],["tooltip-position","above","matTooltipShowDelay","500",1,"mat-typography",3,"matTooltip","checked","labelPosition","change"],["igoListItem","",3,"layer","updateLegendOnResolutionChange",4,"ngIf"],["igoListItem","",3,"layer","updateLegendOnResolutionChange"],[1,"layers-empty","mat-typography"]],template:function(i,n){1&i&&(e.I0R(0,"div",0),e.yuY(1,xu,4,8,"mat-slide-toggle",1),e.wVc(2,"async"),e.yuY(3,Mu,1,0,"mat-divider",2),e.wVc(4,"async"),e.I0R(5,"igo-list",3),e.yuY(6,Pu,1,1,"ng-template",4),e.wVc(7,"async"),e.C$Y(),e.yuY(8,Fu,3,3,"p",5),e.wVc(9,"async"),e.wVc(10,"async"),e.wVc(11,"async"),e.yuY(12,Ru,3,3,"p",5),e.wVc(13,"async"),e.wVc(14,"async"),e.wVc(15,"async"),e.yuY(16,Lu,3,3,"p",5),e.wVc(17,"async"),e.wVc(18,"async"),e.wVc(19,"async"),e.yuY(20,Gu,3,3,"p",5),e.wVc(21,"async"),e.wVc(22,"async"),e.wVc(23,"async"),e.C$Y()),2&i&&(e.yG2(),e.E7m("ngIf",e.kDX(2,9,n.layersInUi$).length&&n.allowShowAllLegends),e.yG2(2),e.E7m("ngIf",e.kDX(4,11,n.layersInUi$).length&&n.allowShowAllLegends),e.yG2(2),e.E7m("navigation",!1)("selection",!1),e.yG2(),e.E7m("ngForOf",e.kDX(7,13,n.layers$)),e.yG2(2),e.E7m("ngIf",!n.showAllLegendsValue&&e.kDX(9,15,n.layersInUi$).length&&!1===e.kDX(10,17,n.hasVisibleOrInRangeLayers$)&&!1===e.kDX(11,19,n.hasVisibleAndNotInRangeLayers$)&&n.allowShowAllLegends),e.yG2(4),e.E7m("ngIf",!n.showAllLegendsValue&&e.kDX(13,21,n.layersInUi$).length&&!1===e.kDX(14,23,n.hasVisibleOrInRangeLayers$)&&e.kDX(15,25,n.hasVisibleAndNotInRangeLayers$)&&n.allowShowAllLegends),e.yG2(4),e.E7m("ngIf",e.kDX(17,27,n.layersInUi$).length&&!1===e.kDX(18,29,n.hasVisibleOrInRangeLayers$)&&!1===e.kDX(19,31,n.hasVisibleAndNotInRangeLayers$)&&!n.allowShowAllLegends),e.yG2(4),e.E7m("ngIf",e.kDX(21,33,n.layersInUi$).length&&!1===e.kDX(22,35,n.hasVisibleOrInRangeLayers$)&&e.kDX(23,37,n.hasVisibleAndNotInRangeLayers$)&&!n.allowShowAllLegends))},dependencies:[Xe.u_,Co.GE,Co.cP,st.KO,st.a4,Zt.U,Zt.k,Ue.yM,Xe.Iw,ba,Ue.qU,Xe.a,it.O0,it.sD],styles:["[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{display:contents}[_nghost-%COMP%]   .layers-empty[_ngcontent-%COMP%]{text-align:justify;margin:10px}[_nghost-%COMP%]   .layer-legend-list-container[_ngcontent-%COMP%]{max-height:100%;overflow:auto}"],changeDetection:0})}return l})();function $u(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",9),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.clearTerm())}),e.wR5(1,"mat-icon",10),e.C$Y()}}let Ta=(()=>{class l{onlyVisible$=new A.g(!1);sortAlpha$=new A.g(!1);term$=new A.g(void 0);onlyVisible$$;sortAlpha$$;term$$;layersAreAllVisible=!0;floatLabel="auto";set onlyVisible(t){this.onlyVisible$.next(t)}get onlyVisible(){return this.onlyVisible$.value}set sortAlpha(t){this.sortAlpha$.next(t)}get sortAlpha(){return this.sortAlpha$.value}set term(t){this.term$.next(t)}get term(){return this.term$.value}selectionMode=!1;appliedFilterAndSort=new e._w7;selection=new e._w7;ngOnInit(){this.term$$=this.term$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:t,onlyVisible:this.onlyVisible,sortAlpha:this.sortAlpha})}),this.onlyVisible$$=this.onlyVisible$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:this.term,onlyVisible:t,sortAlpha:this.sortAlpha})}),this.sortAlpha$$=this.sortAlpha$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:this.term,onlyVisible:this.onlyVisible,sortAlpha:t})})}ngOnDestroy(){this.onlyVisible$$.unsubscribe(),this.sortAlpha$$.unsubscribe(),this.term$$.unsubscribe()}clearTerm(){this.term=void 0}toggleSortAlpha(){this.sortAlpha=!this.sortAlpha}toggleOnlyVisible(){this.onlyVisible=!this.onlyVisible}toggleSelectionMode(){this.selectionMode=!this.selectionMode,this.selection.emit(this.selectionMode)}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-list-tool"]],inputs:{layersAreAllVisible:"layersAreAllVisible",floatLabel:"floatLabel",onlyVisible:"onlyVisible",sortAlpha:"sortAlpha",term:"term"},outputs:{appliedFilterAndSort:"appliedFilterAndSort",selection:"selection"},standalone:!0,features:[e.UHJ],decls:18,vars:32,consts:[[1,"inputFilter",3,"floatLabel"],["matInput","","matTooltipShowDelay","500","type","text",3,"placeholder","matTooltip","ngModel","ngModelChange"],["matSuffix","","mat-icon-button","","aria-label","Clear","color","warn",3,"click",4,"ngIf"],[1,"actions-container"],["mat-icon-button","","matTooltipShowDelay","500",1,"sort-alpha",3,"color","matTooltip","click"],[3,"svgIcon"],["mat-icon-button","","matTooltipShowDelay","500",1,"only-visible",3,"disabled","color","matTooltip","click"],["aria-hidden","false","matBadge","icon","igoMatBadgeIcon","eye",3,"igoMatBadgeInverseColor","igoMatBadgeInheritColor","svgIcon"],["mat-icon-button","","color","primary","matTooltipShowDelay","500",1,"selection-mode",3,"matTooltip","click"],["matSuffix","","mat-icon-button","","aria-label","Clear","color","warn",3,"click"],["svgIcon","close"]],template:function(i,n){1&i&&(e.I0R(0,"mat-form-field",0)(1,"input",1),e.iHE("ngModelChange",function(v){return e.kNx(n.term,v)||(n.term=v),v}),e.wVc(2,"translate"),e.wVc(3,"translate"),e.C$Y(),e.yuY(4,$u,2,0,"button",2),e.C$Y(),e.I0R(5,"div",3)(6,"button",4),e.qCj("click",function(){return n.toggleSortAlpha()}),e.wVc(7,"translate"),e.wVc(8,"translate"),e.wR5(9,"mat-icon",5),e.C$Y(),e.I0R(10,"button",6),e.qCj("click",function(){return n.toggleOnlyVisible()}),e.wVc(11,"translate"),e.wVc(12,"translate"),e.wR5(13,"mat-icon",7),e.C$Y(),e.I0R(14,"button",8),e.qCj("click",function(){return n.toggleSelectionMode()}),e.wVc(15,"translate"),e.wVc(16,"translate"),e.wR5(17,"mat-icon",5),e.C$Y()()),2&i&&(e.E7m("floatLabel",n.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,16,"igo.geo.layer.filterPlaceholder"))("matTooltip",e.kDX(3,18,"igo.geo.layer.subsetLayersListKeyword")),e.OKB("ngModel",n.term),e.yG2(3),e.E7m("ngIf",n.term),e.yG2(2),e.E7m("color",n.sortAlpha?"warn":"primary")("matTooltip",n.sortAlpha?e.kDX(7,20,"igo.geo.layer.sortMapOrder"):e.kDX(8,22,"igo.geo.layer.sortAlphabetically")),e.yG2(3),e.E7m("svgIcon",n.sortAlpha?"sort-ascending":"sort-alphabetical-ascending"),e.yG2(),e.E7m("disabled",n.layersAreAllVisible&&!n.onlyVisible)("color",n.onlyVisible?"warn":"primary")("matTooltip",n.onlyVisible?e.kDX(11,24,"igo.geo.layer.resetLayersList"):e.kDX(12,26,"igo.geo.layer.subsetLayersListOnlyVisible")),e.yG2(3),e.E7m("igoMatBadgeInverseColor",!0)("igoMatBadgeInheritColor",!0)("svgIcon",n.onlyVisible?"filter-remove":"filter"),e.yG2(),e.E7m("matTooltip",n.selectionMode?e.kDX(15,28,"igo.geo.layer.deactivateSelectionMode"):e.kDX(16,30,"igo.geo.layer.activateSelectionMode")),e.yG2(3),e.E7m("svgIcon",n.selectionMode?"checkbox-multiple-marked-outline":"checkbox-multiple-blank-outline"))},dependencies:[ft.wb,ft.Up,ft.Gm,Yt.cN,Yt.yi,Me.y,Me.ot,Me.ue,Me._G,st.KO,st.a4,Xe.u_,ct.oJ,ct.um,tt.oB,tt.qL,qe.g,qe.S,Ue.qS,it.O0,it.sD],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px 12px}[_nghost-%COMP%]   .inputFilter[_ngcontent-%COMP%]{width:calc(100% - 100px);max-width:200px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .inputFilter[_ngcontent-%COMP%]{width:50%}}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}"],changeDetection:0})}return l})();var ss=s(87848),Dn=s(94448),Ea=s(89888),as=s(19724),dr=function(l){return l.always="always",l.never="never",l.default="default",l}(dr||{}),Jn=function(l){return l.ALL_VISIBLE="ALL_VISIBLE",l.ALL_HIDDEN="ALL_HIDDEN",l.MIXED="MIXED",l.NULL="NULL",l}(Jn||{}),Tr=function(l){return l.Raise="raise",l.Lower="lower",l}(Tr||{});const Au=["igoLayerItemToolbar"];function ku(l,m){if(1&l){const t=e.KQA();e.I0R(0,"igo-layer-list-tool",6),e.qCj("appliedFilterAndSort",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onAppliedFilterAndSortChange(n))})("selection",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.toggleSelectionMode(n))}),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("layersAreAllVisible",t.layersAreAllVisible)("term",t.layerFilterAndSortOptions.keyword)("onlyVisible",t.layerFilterAndSortOptions.onlyVisible)("sortAlpha",t.layerFilterAndSortOptions.sortAlpha)}}function Bu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",7)(1,"mat-checkbox",8),e.qCj("change",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.selectAll())}),e.OEk(2),e.wVc(3,"translate"),e.wVc(4,"translate"),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("color",!t.selectAllCheck&&t.layersChecked.length>0?"accent":"primary")("checked",t.selectAllCheck)("indeterminate",!t.selectAllCheck&&t.layersChecked.length>0),e.yG2(),e.oRS(" ",t.selectAllCheck?e.kDX(3,4,"igo.geo.layer.deselectAll"):e.kDX(4,6,"igo.geo.layer.selectAll")," ")}}function Uu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"igo-layer-item",10),e.qCj("action",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.toggleLayerTool(n))})("checkbox",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.layersCheck(n))}),e.C$Y()}if(2&l){const t=e.GaO().$implicit,i=e.GaO();e.E7m("layer",t)("activeLayer",i.activeLayer)("orderable",i.orderable&&!t.baseLayer)("lowerDisabled",i.getLowerLayer().id===t.id)("raiseDisabled",i.getUpperLayer().id===t.id)("queryBadge",i.queryBadge)("expandLegendIfVisible",i.expandLegendOfVisibleLayers)("updateLegendOnResolutionChange",i.updateLegendOnResolutionChange)("toggleLegendOnVisibilityChange",i.toggleLegendOnVisibilityChange)("selectionMode",i.selection)("selectAll",i.selectAllCheck)("layerCheck",t.options.check)("changeDetection",i.layerItemChangeDetection$)}}function Yu(l,m){if(1&l&&e.yuY(0,Uu,1,13,"igo-layer-item",9),2&l){const t=m.$implicit,i=e.GaO();e.E7m("ngIf",!(i.excludeBaseLayers&&t.baseLayer))}}function Vu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",28),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.removeLayers())}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",29),e.C$Y()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.layer.removeLayer"))}function ju(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",30),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.zoomLayerExtents(n.activeLayer))}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",31),e.C$Y()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.layer.zoomLayer"))}const Ku=l=>({layer:l});function Wu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"igo-panel",11)(1,"div",12),e.yuY(2,Vu,3,3,"button",13),e.I0R(3,"button",14),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.moveActiveLayer(n.activeLayer,n.layerListDisplacement.Lower,!0))}),e.wVc(4,"translate"),e.wVc(5,"translate"),e.wR5(6,"mat-icon",15),e.C$Y(),e.I0R(7,"button",16),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.moveActiveLayer(n.activeLayer,n.layerListDisplacement.Raise,!0))}),e.wVc(8,"translate"),e.wVc(9,"translate"),e.wR5(10,"mat-icon",17),e.C$Y(),e.I0R(11,"button",18),e.wVc(12,"translate"),e.wR5(13,"mat-icon",19),e.C$Y(),e.I0R(14,"mat-menu",20,21)(16,"mat-slider",22,23),e.qCj("click",function(n){return n.stopPropagation()}),e.wVc(18,"translate"),e.I0R(19,"input",24,25),e.qCj("input",function(){e.usT(t);const n=e.Gew(20),p=e.Gew(17),v=e.GaO();return e.CGJ(v.changeOpacity({source:n,parent:p,value:n.value}))}),e.C$Y()()(),e.yuY(21,ju,3,3,"button",26),e.C_f(22,27),e._Xx(23),e.C$Y()()}if(2&l){const t=e.Gew(15),i=e.GaO();e.E7m("title",i.activeLayer.title),e.yG2(2),e.E7m("ngIf",i.isLayerRemovable(i.activeLayer)),e.yG2(),e.E7m("matTooltip",i.sortAlpha||i.onlyVisible||i.keyword?e.kDX(4,20,"igo.geo.layer.filterLowerLayer"):e.kDX(5,22,"igo.geo.layer.lowerLayer"))("disabled",i.lowerDisabled),e.yG2(3),e.E7m("matBadge",i.sortAlpha||i.onlyVisible||i.keyword?"!":"")("matBadgeHidden",i.lowerDisabled),e.yG2(),e.E7m("matTooltip",i.sortAlpha||i.onlyVisible||i.keyword?e.kDX(8,24,"igo.geo.layer.filterRaiseLayer"):e.kDX(9,26,"igo.geo.layer.raiseLayer"))("disabled",i.raiseDisabled),e.yG2(3),e.E7m("matBadge",i.sortAlpha||i.onlyVisible||i.keyword?"!":"")("matBadgeHidden",i.raiseDisabled),e.yG2(),e.E7m("matMenuTriggerFor",t)("matTooltip",e.kDX(12,28,"igo.geo.layer.opacity")),e.yG2(2),e.E7m("matBadge",i.badgeOpacity),e.yG2(3),e.E7m("min",0)("max",100)("matTooltip",e.kDX(18,30,"igo.geo.layer.opacity")),e.yG2(3),e.E7m("value",i.opacity),e.yG2(2),e.E7m("ngIf",i.activeLayerExtentIsValid(i.activeLayer)),e.yG2(),e.E7m("ngTemplateOutlet",i.templateLayerToolbar)("ngTemplateOutletContext",e.S45(32,Ku,i.activeLayer))}}function Nu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-slider",42),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(2);return e.kNx(p.checkOpacity,n)||(p.checkOpacity=n),e.CGJ(n)}),e.qCj("click",function(n){return n.stopPropagation()}),e.wVc(1,"translate"),e.wR5(2,"input",43),e.C$Y()}if(2&l){const t=e.GaO(2);e.E7m("min",0)("max",100),e.OKB("ngModel",t.checkOpacity),e.E7m("matTooltip",e.kDX(1,4,"igo.geo.layer.opacity"))}}function Hu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",30),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.zoomLayersExtents(n.layersChecked))}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",44),e.C$Y()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.layer.zoomLayers"))}function zu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"igo-panel",11),e.wVc(1,"translate"),e.I0R(2,"div",32)(3,"button",33),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.removeLayers(n.layersChecked))}),e.wVc(4,"translate"),e.wVc(5,"translate"),e.wR5(6,"mat-icon",34),e.C$Y(),e.I0R(7,"button",35),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleVisibility(n.layersChecked))}),e.wVc(8,"translate"),e.wVc(9,"translate"),e.wR5(10,"mat-icon",36),e.C$Y(),e.I0R(11,"button",14),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.lowerLayers(n.layersChecked))}),e.wVc(12,"translate"),e.wVc(13,"translate"),e.wR5(14,"mat-icon",15),e.C$Y(),e.I0R(15,"button",16),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.raiseLayers(n.layersChecked))}),e.wVc(16,"translate"),e.wVc(17,"translate"),e.wR5(18,"mat-icon",17),e.C$Y(),e.I0R(19,"button",37),e.wVc(20,"translate"),e.wR5(21,"mat-icon",38),e.C$Y(),e.I0R(22,"mat-menu",39,21)(24,"div",40),e.yuY(25,Nu,3,6,"mat-slider",41),e.C$Y()(),e.yuY(26,Hu,3,3,"button",26),e.C$Y()()}if(2&l){const t=e.Gew(23),i=e.GaO();e.E7m("title",e.kDX(1,21,"igo.geo.layer.tools")),e.yG2(3),e.E7m("disabled",0===i.layersChecked.length)("matTooltip",i.isAllLayersRemovable(i.layersChecked)?e.kDX(4,23,"igo.geo.layer.removeSelectedLayers"):e.kDX(5,25,"igo.geo.layer.removeSelectedLayersRestriction")),e.yG2(3),e.E7m("matBadge","!")("matBadgeHidden",i.isAllLayersRemovable(i.layersChecked)),e.yG2(),e.E7m("disabled",0===i.layersChecked.length)("matTooltip","ALL_HIDDEN"===i.statusSelectedLayersCheck?e.kDX(8,27,"igo.geo.layer.showSelectedLayers"):e.kDX(9,29,"igo.geo.layer.hideSelectedLayers")),e.yG2(3),e.E7m("svgIcon","ALL_HIDDEN"===i.statusSelectedLayersCheck?"eye-off":"eye"),e.yG2(),e.E7m("matTooltip",i.sortAlpha||i.onlyVisible||i.keyword?e.kDX(12,31,"igo.geo.layer.filterLowerLayer"):e.kDX(13,33,"igo.geo.layer.lowerLayer"))("disabled",i.lowerDisabledSelection),e.yG2(3),e.E7m("matBadge",i.sortAlpha||i.onlyVisible||i.keyword?"!":"")("matBadgeHidden",i.lowerDisabledSelection),e.yG2(),e.E7m("matTooltip",i.sortAlpha||i.onlyVisible||i.keyword?e.kDX(16,35,"igo.geo.layer.filterRaiseLayer"):e.kDX(17,37,"igo.geo.layer.raiseLayer"))("disabled",i.raiseDisabledSelection),e.yG2(3),e.E7m("matBadge",i.sortAlpha||i.onlyVisible||i.keyword?"!":"")("matBadgeHidden",i.raiseDisabledSelection),e.yG2(),e.E7m("disabled",0===i.layersChecked.length)("matMenuTriggerFor",t)("matTooltip",e.kDX(20,39,"igo.geo.layer.opacity")),e.yG2(6),e.E7m("ngIf",i.layersChecked.length),e.yG2(),e.E7m("ngIf",0!==i.layersChecked.length&&i.activeLayersExtentAreValid(i.layersChecked))}}const Xu=[[["","igoLayerItemToolbar",""]]],Ju=["[igoLayerItemToolbar]"];let ls=(()=>{class l{elRef;orderable=!0;thresholdToFilterAndSort=5;layers$=new A.g([]);change$=new wa.o(1);showToolbar$=new A.g(!1);layerTool;hideSelectedLayers=!0;activeLayer$=new A.g(void 0);layersChecked=[];selection;change$$;layers$$;layerItemChangeDetection$=new A.g(void 0);templateLayerToolbar;layersAreAllVisible=!0;ogcButton=!0;timeButton=!0;get map(){return this._map}set map(t){this._map=t}_map;set layers(t){this._layers=this.removeProblemLayerInList(t),this.next()}get layers(){return this._layers}_layers;set activeLayer(t){this._activeLayer=t,this.activeLayer$.next(t)}get activeLayer(){return this._activeLayer}_activeLayer;floatLabel="auto";layerFilterAndSortOptions={};excludeBaseLayers=!1;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;queryBadge=!1;appliedFilterAndSort=new e._w7;get keyword(){return this._keyword}set keyword(t){this._keyword=t,this.next()}_keyword=void 0;get onlyVisible(){return this._onlyVisible}set onlyVisible(t){this._onlyVisible=t,this.next()}_onlyVisible=!1;get sortAlpha(){return this._sortedAlpha}set sortAlpha(t){this._sortedAlpha=t,this.next()}_sortedAlpha=!1;get opacity(){return Math.round(100*this.activeLayer$.getValue().opacity)}set opacity(t){this.activeLayer$.getValue().opacity=t/100}get badgeOpacity(){if(100!==this.opacity)return this.opacity}get raiseDisabled(){return!(this.orderable&&!this.activeLayer.baseLayer&&this.getUpperLayer().id!==this.activeLayer.id&&!this.isUpperBaselayer(this.activeLayer))}get lowerDisabled(){return!(this.orderable&&!this.activeLayer.baseLayer&&this.getLowerLayer().id!==this.activeLayer.id&&!this.isLowerBaselayer(this.activeLayer))}get raiseDisabledSelection(){return 0===this.layersChecked.length||!this.orderable||!this.raisableLayers(this.layersChecked)||!0===this.selectAllCheck}get lowerDisabledSelection(){return 0===this.layersChecked.length||!this.orderable||!this.lowerableLayers(this.layersChecked)||!0===this.selectAllCheck}get checkOpacity(){return 100*this.layersCheckedOpacity()}set checkOpacity(t){for(const i of this.layersChecked)i.opacity=t/100}get layerListDisplacement(){return Tr}toggleOpacity=!1;selectAllCheck;selectAllCheck$=new A.g(void 0);selectAllCheck$$;constructor(t){this.elRef=t}ngOnInit(){this.change$$=this.change$.pipe((0,Ia.C)(()=>0===this.layers.length?Ir.k:(0,Oa.k)(50))).subscribe(()=>{this.showToolbar$.next(this.computeShowToolbar()),this.layers$.next(this.computeLayers(this.layers.slice(0))),this.appliedFilterAndSort.emit({keyword:this.keyword,sortAlpha:this.sortAlpha,onlyVisible:this.onlyVisible})}),this.selectAllCheck$$=this.selectAllCheck$.subscribe(t=>{this.selectAllCheck=t}),this.layers$$=this.layers$.subscribe(()=>{if(this.layers){let t=0;for(const i of this.layers)i.status$.subscribe(n=>{0===n&&this.map.removeLayer(i)}),i.options.active&&(this.activeLayer=i,this.layerTool=!0),i.options.check&&(t+=1);this.selectAllCheck=this.excludeBaseLayers?t===this.layers.filter(i=>!0!==i.baseLayer&&i.showInLayerList).length:t===this.layers.filter(i=>i.showInLayerList).length}})}ngOnDestroy(){this.change$$.unsubscribe(),this.selectAllCheck$$.unsubscribe(),this.layers$$.unsubscribe()}activeLayerExtentIsValid(t){let i=!1;if(!1===t.options.showButtonZoomToExtent)return!1;const n=t.options.extent,p=this.map.viewController.maxLayerZoomExtent;return n&&(i=!p||Dn.cP(p,n)),i}activeLayersExtentAreValid(t){let i=!1;const n=Dn.Gu(),p=this.map.viewController.maxLayerZoomExtent;for(const v of t){const k=v.options.extent;k&&!k.includes(1/0)&&Dn.SU(n,k)}return Dn.t7(n)||(i=!p||Dn.cP(p,n)),i}zoomLayerExtents(t){this.map.viewController.zoomToExtent(t.options.extent)}zoomLayersExtents(t){const i=Dn.Gu();for(const n of t){const p=n.options.extent;p&&Dn.SU(i,p)}this.map.viewController.zoomToExtent(i)}changeOpacity(t){this.opacity=t.value}clearKeyword(){this.keyword=void 0}getLowerLayer(){return this.layers.filter(t=>!t.baseLayer).reduce((t,i)=>t.zIndex<i.zIndex?t:i,{zIndex:void 0,id:void 0})}isLowerBaselayer(t){const i=this.layers.findIndex(n=>t.id===n.id);return!(!this.layers||!this.layers[i+1]||!0!==this.layers[i+1].baseLayer)}getUpperLayer(){return this.layers.filter(t=>!t.baseLayer).reduce((t,i)=>t.zIndex>i.zIndex?t:i,{zIndex:void 0,id:void 0})}isUpperBaselayer(t){const i=this.layers.findIndex(n=>t.id===n.id);return!(!this.layers||!this.layers[i-1]||!0!==this.layers[i-1].baseLayer)}moveActiveLayer(t,i,n=!1){const p=[];(0,as.UR)(this.map,t,Fi.a.ZINDEX);let v=(0,as.UR)(this.map,t,Fi.a.ZINDEX);v||(v=t);const k=[v];(0,as.m)(this.map,v,k,Fi.a.ZINDEX),this.layers.map(de=>{-1!==k.indexOf(de)&&p.push(de)}),i===Tr.Raise?this.raiseLayers(p,n):i===Tr.Lower&&this.lowerLayers(p,n)}raisableLayers(t){let i=!1,n=0;for(const p of t){const v=this.layers.findIndex(he=>p.id===he.id),k=this.layers[v];k.baseLayer&&(n+=1);const de=this.layers[v-1];de&&!0!==de.baseLayer&&!t.find(he=>de.id===he.id)&&!0!==k.baseLayer&&(i=!0)}return(1===this.layersChecked.length&&this.layersChecked[0].baseLayer||n===this.layersChecked.length)&&(i=!1),i}raisableLayer(t){return!(t<1)&&(!this.layers[t-1].options.check||this.raisableLayer(t-1))}raiseLayers(t,i=!0){const n=[];for(const p of t){const v=this.layers.findIndex(k=>k.id===p.id);this.raisableLayer(v)&&n.push(p)}this.map.raiseLayers(n),i&&setTimeout(()=>{const p=this.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked"),v=this.elRef.nativeElement.getElementsByClassName("igo-layer-item-focused");let k;p.length&&(k=p[0]),v.length&&(k=v[0]),k&&(0,Ea.c)(k,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})},100)}lowerableLayers(t){let i=!1,n=0;for(const p of t){const v=this.layers.findIndex(he=>p.id===he.id);this.layers[v].baseLayer&&(n+=1);const de=this.layers[v+1];de&&!0!==de.baseLayer&&!t.find(he=>de.id===he.id)&&(i=!0)}return(1===this.layersChecked.length&&this.layersChecked[0].baseLayer||n===this.layersChecked.length)&&(i=!1),i}lowerableLayer(t){return!(t>this.layers.filter(i=>!0!==i.baseLayer).length-2)&&(!this.layers[t+1].options.check||this.lowerableLayer(t+1))}lowerLayers(t,i=!0){const n=[];for(const p of t){const v=this.layers.findIndex(k=>k.id===p.id);this.lowerableLayer(v)&&n.push(p)}this.map.lowerLayers(n),i&&setTimeout(()=>{const p=this.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked"),v=this.elRef.nativeElement.getElementsByClassName("igo-layer-item-focused");let k;p.length&&(k=p[p.length-1]),v.length&&(k=v[0]),k&&(0,Ea.c)(k,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})},100)}next(){this.change$.next()}computeLayers(t){let i=this.filterLayers(t);return i=this.sortAlpha?this.sortLayersByTitle(i):this.sortLayersByZindex(i),i}onKeywordChange(t){this.keyword=t}onAppliedFilterAndSortChange(t){this.keyword=t.keyword,this.onlyVisible=t.onlyVisible,this.sortAlpha=t.sortAlpha}filterLayers(t){if(this.layerFilterAndSortOptions.showToolbar===dr.never||!this.keyword&&!this.onlyVisible)return t;const i=t.map(n=>n.id);return t.forEach(n=>{const v=n.dataSource.options||{},he=(((n.options||{}).metadata||{}).keywordList||[]).map(Oe=>Oe.normalize("NFD").replace(/[\u0300-\u036f]/g,""));if(this.keyword&&n.title){const Oe=this.keyword.normalize("NFD").replace(/[\u0300-\u036f]/g,""),be=n.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),Pe=v.type||"",Je=new RegExp(Oe,"gi"),Fe=void 0!==he.find(et=>Je.test(et));if(!Je.test(be)&&this.keyword.toLowerCase()!==Pe.toLowerCase()&&!Fe){const et=i.indexOf(n.id);et>-1&&i.splice(et,1)}}if(this.onlyVisible&&!1===n.visible){const Oe=i.indexOf(n.id);Oe>-1&&i.splice(Oe,1)}}),t.filter(n=>-1!==i.indexOf(n.id))}sortLayersByZindex(t){return t.sort((i,n)=>n.zIndex-i.zIndex)}sortLayersByTitle(t){return t.sort((i,n)=>this.normalize(i.title)<this.normalize(n.title)?-1:this.normalize(i.title)>this.normalize(n.title)?1:0)}normalize(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}computeShowToolbar(){switch(this.layerFilterAndSortOptions.showToolbar){case dr.always:return!0;case dr.never:return!1;default:return!!(this.layers.length>=this.thresholdToFilterAndSort||this.keyword||this.onlyVisible)}}toggleLayerTool(t){this.toggleOpacity=!1,this.layerTool=!this.layerTool||t!==this.activeLayer;for(const i of this.layers)i.options.active=!1;t.options.active=!0,this.activeLayer=t}removeLayers(t){if(t&&t.length>0){this.layersChecked=[];for(const i of t)!1!==i.options.removable?i.map.removeLayer(i):this.layersChecked.push(i)}else!t&&!1!==this.activeLayer.options.removable&&(this.activeLayer.map.removeLayer(this.activeLayer),this.layerTool=!1)}toggleVisibility(t){if(t&&t.length>0)for(const i of t)i.visible=this.hideSelectedLayers;this.layerItemChangeDetection$.next(!0)}isLayerRemovable(t){return!1!==t.options.removable}isAllLayersRemovable(t){return t.every(i=>this.isLayerRemovable(i))}get statusSelectedLayersCheck(){let t=Jn.NULL,i=!1,n=!1;if(0===this.layersChecked.length)t=Jn.NULL;else{t=Jn.MIXED,this.hideSelectedLayers=!1;for(const p of this.layersChecked)!0===p.visible&&(i=!0),!1===p.visible&&(n=!0);!0===i&&!1===n&&(t=Jn.ALL_VISIBLE),!1===i&&!0===n&&(t=Jn.ALL_HIDDEN,this.hideSelectedLayers=!0)}return t}layersCheck(t){if(t.layer.options.check=t.check,!0===t.check){const i=this.layers.findIndex(n=>t.layer.id===n.id);for(const n of this.layersChecked)if(i<this.layers.findIndex(v=>n.id===v.id))return this.layersChecked.splice(this.layersChecked.findIndex(v=>n.id===v.id),0,t.layer),void(this.excludeBaseLayers?this.selectAllCheck=this.layersChecked.length===this.layers.filter(v=>!0!==v.baseLayer&&v.showInLayerList).length:this.excludeBaseLayers||(this.selectAllCheck=this.layersChecked.length===this.layers.filter(v=>v.showInLayerList).length));this.layersChecked.push(t.layer)}else{const i=this.layersChecked.findIndex(n=>t.layer.id===n.id);this.layersChecked.splice(i,1)}this.excludeBaseLayers?this.selectAllCheck=this.layersChecked.length===this.layers.filter(i=>!0!==i.baseLayer&&i.showInLayerList).length:this.excludeBaseLayers||(this.selectAllCheck=this.layersChecked.length===this.layers.filter(i=>i.showInLayerList).length)}toggleSelectionMode(t){if(this.selection=t,this.activeLayer=void 0,!0===t){this.layerTool=!1;for(const i of this.layers)i.options.check&&this.layersChecked.push(i)}}layersCheckedOpacity(){if(this.layersChecked.length>1)return 1;{const t=[];for(const i of this.layersChecked)t.push(i.opacity);return t}}selectAll(){if(this.selectAllCheck){for(const t of this.layers)t.options.check=!1;this.layersChecked=[],this.selectAllCheck$.next(!1)}else{for(const t of this.layers)(this.excludeBaseLayers&&!0!==t.baseLayer&&t.showInLayerList||!this.excludeBaseLayers&&t.showInLayerList)&&(t.options.check=!0,this.layersChecked.push(t));this.selectAllCheck$.next(!0)}}isScrolledIntoView(t,i){const n=t.scrollTop,v=i.offsetTop;return v+i.clientHeight<=n+t.clientHeight&&v>=n}removeProblemLayerInList(t){for(const i of t)!0===i.olLoadingProblem&&this.map.removeLayer(i);return t}static \u0275fac=function(i){return new(i||l)(e.GI1(e.GMv))};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-list"]],contentQueries:function(i,n,p){if(1&i&&e.szK(p,Au,5),2&i){let v;e.wto(v=e.Gqi())&&(n.templateLayerToolbar=v.first)}},inputs:{layersAreAllVisible:"layersAreAllVisible",ogcButton:"ogcButton",timeButton:"timeButton",map:"map",layers:"layers",floatLabel:"floatLabel",layerFilterAndSortOptions:"layerFilterAndSortOptions",excludeBaseLayers:"excludeBaseLayers",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",queryBadge:"queryBadge"},outputs:{appliedFilterAndSort:"appliedFilterAndSort"},standalone:!0,features:[e.UHJ],ngContentSelectors:Ju,decls:10,vars:11,consts:[["floatLabel","auto",3,"layersAreAllVisible","term","onlyVisible","sortAlpha","appliedFilterAndSort","selection",4,"ngIf"],["class","select-all",4,"ngIf"],[3,"navigation","selection"],["igoList",""],["ngFor","",3,"ngForOf"],["class","igo-layer-actions-container",3,"title",4,"ngIf"],["floatLabel","auto",3,"layersAreAllVisible","term","onlyVisible","sortAlpha","appliedFilterAndSort","selection"],[1,"select-all"],[1,"select-all-checkbox",3,"color","checked","indeterminate","change"],["igoListItem","",3,"layer","activeLayer","orderable","lowerDisabled","raiseDisabled","queryBadge","expandLegendIfVisible","updateLegendOnResolutionChange","toggleLegendOnVisibilityChange","selectionMode","selectAll","layerCheck","changeDetection","action","checkbox",4,"ngIf"],["igoListItem","",3,"layer","activeLayer","orderable","lowerDisabled","raiseDisabled","queryBadge","expandLegendIfVisible","updateLegendOnResolutionChange","toggleLegendOnVisibilityChange","selectionMode","selectAll","layerCheck","changeDetection","action","checkbox"],[1,"igo-layer-actions-container",3,"title"],[1,"igo-layer-button-group"],["class","delete-button","mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"down-button",3,"matTooltip","disabled","click"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium","svgIcon","arrow-down",3,"matBadge","matBadgeHidden"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"up-button",3,"matTooltip","disabled","click"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium","svgIcon","arrow-up",3,"matBadge","matBadgeHidden"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"opacity-button",3,"matMenuTriggerFor","matTooltip"],["aria-hidden","false","matBadgeColor","primary","matBadgeSize","medium","svgIcon","opacity",3,"matBadge"],[1,"panel-opacity-menu"],["opacityMenu","matMenu"],["id","opacity-slider","color","primary","discrete","","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","matTooltip","click"],["ngSlider",""],["matSliderThumb","",3,"value","input"],["ngSliderThumb","matSliderThumb"],["class","zoomLayer-button","color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["igoLayerItemToolbar","",3,"ngTemplateOutlet","ngTemplateOutletContext"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"delete-button",3,"matTooltip","click"],["svgIcon","delete"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"zoomLayer-button",3,"matTooltip","click"],["matBadgeColor","primary","matBadgeSize","medium","svgIcon","magnify-scan"],[1,"actions-buttons-multi"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"delete-button",3,"disabled","matTooltip","click"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium","svgIcon","delete",3,"matBadge","matBadgeHidden"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"eye-button",3,"disabled","matTooltip","click"],[3,"svgIcon"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"opacity-button",3,"disabled","matMenuTriggerFor","matTooltip"],["svgIcon","opacity"],[1,"mat-menu-opacity-slider"],["id","opacity-menu"],["id","opacity-slider","color","primary","thumbLabel","","showTickMarks","","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","ngModel","matTooltip","ngModelChange","click",4,"ngIf"],["id","opacity-slider","color","primary","thumbLabel","","showTickMarks","","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","ngModel","matTooltip","ngModelChange","click"],["matSliderThumb",""],["svgIcon","magnify-scan"]],template:function(i,n){1&i&&(e.kPM(Xu),e.yuY(0,ku,1,4,"igo-layer-list-tool",0),e.wVc(1,"async"),e.yuY(2,Bu,5,8,"div",1),e.wR5(3,"mat-divider"),e.I0R(4,"igo-list",2,3),e.yuY(6,Yu,1,1,"ng-template",4),e.wVc(7,"async"),e.C$Y(),e.yuY(8,Wu,24,34,"igo-panel",5)(9,zu,27,41,"igo-panel",5)),2&i&&(e.E7m("ngIf",e.kDX(1,7,n.showToolbar$)),e.yG2(2),e.E7m("ngIf",n.selection),e.yG2(2),e.E7m("navigation",!1)("selection",!1),e.yG2(2),e.E7m("ngForOf",e.kDX(7,9,n.layers$)),e.yG2(2),e.E7m("ngIf",!n.selection&&n.layerTool&&n.activeLayer),e.yG2(),e.E7m("ngIf",n.selection&&n.layers.length>0))},dependencies:[Xe.u_,Ta,Lt.Vn,Lt.WK,Zt.U,Zt.k,Ue.yM,Xe.Iw,Sa,Ue.qU,Ue.cP,ct.oJ,ct.um,st.KO,st.a4,tt.oB,tt.qL,qe.g,qe.S,ss._A,ss.aM,ss.yG,to.yO,to.Cg,to._s,Xe.XV,Me.y,Me.ue,Me._G,Xe.a,it.O0,it.sD],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{flex:1;padding-top:8px}[_nghost-%COMP%]   mat-form-field.inputFilter[_ngcontent-%COMP%]{width:calc(100% - 100px);max-width:200px}[_nghost-%COMP%]   .igo-layer-actions-container[_ngcontent-%COMP%]{padding:0 6px 0 4px}[_nghost-%COMP%]   .igo-layer-actions-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__content{margin-bottom:10px}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%], [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row-reverse;overflow-x:auto;overflow-y:hidden}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar{height:4px}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-track, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]{padding-top:5px}[_nghost-%COMP%]   igo-panel[_ngcontent-%COMP%]{height:unset}[_nghost-%COMP%]   .select-all[_ngcontent-%COMP%]{display:flex;align-items:center;height:48px;padding:0 16px}  .panel-opacity-menu{overflow:visible!important}  .panel-opacity-menu #opacity-slider{margin:0 16px}"],changeDetection:0})}return l})();function Qu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",1),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleTrackFeature())}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",2),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.layer.trackFeature"))("color",t.color)}}let xa=(()=>{class l{layer;trackFeature=!1;get options(){if(this.layer)return this.layer.options}color="primary";constructor(){}ngOnInit(){this.color=this.trackFeature?"primary":"basic"}toggleTrackFeature(){this.trackFeature?(this.layer.disableTrackFeature(this.layer.options.trackFeature),this.color="basic"):(this.layer.enableTrackFeature(this.layer.options.trackFeature),this.color="primary"),this.trackFeature=!this.trackFeature}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-track-feature-button"]],inputs:{layer:"layer",trackFeature:"trackFeature"},standalone:!0,features:[e.UHJ],decls:1,vars:1,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","crosshairs-gps"]],template:function(i,n){1&i&&e.yuY(0,Qu,3,4,"button",0),2&i&&e.E7m("ngIf",n.options.trackFeature)},dependencies:[Xe.u_,ct.oJ,ct.um,st.KO,st.a4,tt.oB,tt.qL,it.O0,it.sD],changeDetection:0})}return l})(),Zu=(()=>{class l{constructor(){}open(t){t.extern&&window.open(t.url,"_blank")}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function qu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",1),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.openMetadata(n.options.metadata))}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",2),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.metadata.show"))("color",t.color)}}function ed(l,m){if(1&l&&(e.I0R(0,"mat-dialog-content",3)(1,"h3"),e.OEk(2),e.C$Y()()),2&l){const t=e.GaO();e.yG2(2),e.cNF(t.data.abstract)}}function td(l,m){if(1&l&&(e.I0R(0,"mat-dialog-content",3),e.wR5(1,"h3",4),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("innerHTML",t.data.abstract,e.E3n)}}let cs=(()=>{class l{metadataService;dialog;get layer(){return this._layer}set layer(t){this._layer=t}_layer;get color(){return this._color}set color(t){this._color=t}_color="primary";constructor(t,i){this.metadataService=t,this.dialog=i}openMetadata(t){t.extern?!t.url&&t.abstract?this.dialog.open(us,{data:{layerTitle:this.layer.title,abstract:t.abstract,type:t.type}}):t.url&&this.metadataService.open(t):!t.extern&&t.abstract&&this.dialog.open(us,{data:{layerTitle:this.layer.title,abstract:t.abstract,type:t.type}})}get options(){if(this.layer)return this.layer.options}static \u0275fac=function(i){return new(i||l)(e.GI1(Zu),e.GI1(bt.qW))};static \u0275cmp=e.In1({type:l,selectors:[["igo-metadata-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[e.UHJ],decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","information-outline"]],template:function(i,n){1&i&&e.yuY(0,qu,3,4,"button",0),2&i&&e.E7m("ngIf",n.options&&n.options.metadata&&n.options.metadata.url||n.options&&n.options.metadata&&n.options.metadata.abstract)},dependencies:[Xe.u_,ct.oJ,ct.um,st.KO,st.a4,tt.oB,tt.qL,it.O0,it.sD,bt.sr],changeDetection:0})}return l})(),us=(()=>{class l{data;constructor(t){this.data=t}static \u0275fac=function(i){return new(i||l)(e.GI1(bt.sR))};static \u0275cmp=e.In1({type:l,selectors:[["igo-metadata-abstract"]],standalone:!0,features:[e.UHJ],decls:6,vars:3,consts:[["mat-dialog-title",""],["mat-button","","mat-dialog-close","",1,"close-button"],["class","mat-typography",4,"ngIf"],[1,"mat-typography"],[3,"innerHTML"]],template:function(i,n){1&i&&(e.I0R(0,"h2",0),e.OEk(1),e.C$Y(),e.I0R(2,"button",1),e.OEk(3,"X"),e.C$Y(),e.yuY(4,ed,3,1,"mat-dialog-content",2)(5,td,2,1,"mat-dialog-content",2)),2&i&&(e.yG2(),e.cNF(n.data.layerTitle),e.yG2(3),e.E7m("ngIf","arcgisrest"!==n.data.type),e.yG2(),e.E7m("ngIf","arcgisrest"===n.data.type))},dependencies:[bt.WQ,ct.oJ,ct.Gw,bt.qq,Xe.u_,bt.iU],styles:[":host{position:relative;display:block}:host .close-button{top:5px;right:5px;padding:7px;line-height:10px;position:absolute!important;min-width:auto}\n"],encapsulation:2})}return l})(),Ma=(()=>{class l extends E.i{static id="map";static type=S.Y;constructor(t){super(t)}getId(){return l.id}getType(){return l.type}getDefaultOptions(){return{title:"Carte"}}static \u0275fac=function(i){return new(i||l)(e.CoB("options"))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();function od(l){return new Ma(l.getConfig(`searchSources.${Ma.id}`)||{})}var nd=s(93199);let rd=(()=>{class l{static forRoot(){return{ngModule:l,providers:[{provide:E.i,useFactory:od,multi:!0,deps:[M.aW]}]}}static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({providers:[nd.E],imports:[Xe.MD,Qt.UD]})}return l})();new e.UbH("styleListOptions");var pr=s(99980);function ad(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",11)(1,"span"),e.wR5(2,"mat-icon",12),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"igo-color-picker-form-field",13),e.qCj("colorChange",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.setLayerFillColor(n))}),e.C$Y()()}2&l&&(e.yG2(3),e.oRS(" ",e.kDX(4,1,"igo.geo.style.fill")," "))}let ld=(()=>{class l{dialogRef;formBuilder;data;confirmFlag=!1;form;styleModalData;linestringOnly;initialValues;defaultValues={fillColor:"rgba(255,255,255,0.4)",strokeColor:"rgba(143,7,7,1)"};get layerOlStyle(){const t=this.data.layer.ol.getStyle();return t instanceof Function?void 0:t.clone()}constructor(t,i,n){this.dialogRef=t,this.formBuilder=i,this.data=n}ngOnInit(){this.linestringOnly=!0;for(const t of this.data.layer.ol.getSource().getFeatures())"LineString"!==t.getGeometry()?.getType()&&(this.linestringOnly=!1);this.buildStyleData(),this.buildForm()}buildForm(){this.form=this.formBuilder.group({fill:[this.getLayerFillColor()],stroke:[this.getLayerStrokeColor()]})}buildStyleData(){this.styleModalData={fillColor:this.getLayerFillColor(),strokeColor:this.getLayerStrokeColor()},this.initialValues={fillColor:this.getLayerFillColor(),strokeColor:this.getLayerStrokeColor()}}getLayerFillColor(){let t=this.defaultValues.fillColor;const i=this.layerOlStyle;if(i?.getFill()?.getColor()){const n=i.getFill().getColor();t=`rgba(${n[0]},${n[1]},${n[2]},${n[3]||.4})`}return t}getLayerStrokeColor(){let t=this.defaultValues.strokeColor;const i=this.layerOlStyle;if(i?.getStroke()?.getColor()){const n=i.getStroke().getColor();t=`rgba(${n[0]},${n[1]},${n[2]},${n[3]||1})`}return t}setLayerFillColor(t){const i=(0,pr.f4)(t),n=this.layerOlStyle.clone();n.getImage().getFill().setColor(i),n.getFill().setColor(i),this.data.layer.ol.setStyle(n),this.styleModalData.fillColor=t}setLayerStrokeColor(t){const i=(0,pr.f4)(t),n=this.layerOlStyle.clone();n.getImage().getStroke().setColor(i),n.getStroke().setColor(i),this.data.layer.ol.setStyle(n),this.styleModalData.strokeColor=t}cancel(){this.dialogRef.close(),this.setLayerFillColor(this.initialValues.fillColor),this.setLayerStrokeColor(this.initialValues.strokeColor)}confirm(){this.confirmFlag=!0,this.form.get("fill").value&&(this.styleModalData.fillColor=this.form.get("fill").value),this.form.get("stroke").value&&(this.styleModalData.strokeColor=this.form.get("stroke").value),this.dialogRef.close(this.styleModalData)}openPicker(){this.dialogRef.disableClose=!0}closePicker(){this.dialogRef.disableClose=!1}static \u0275fac=function(i){return new(i||l)(e.GI1(bt.yI),e.GI1(Me.KE),e.GI1(bt.sR))};static \u0275cmp=e.In1({type:l,selectors:[["igo-style-modal-layer"]],inputs:{confirmFlag:"confirmFlag"},standalone:!0,features:[e.UHJ],decls:19,vars:11,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content",""],[1,"edition-drawing","mat-typography"],[1,"igo-form",3,"formGroup"],["class","fill-color-picker mat-typography",4,"ngIf"],[1,"stroke-color-picker","mat-typography"],["svgIcon","square-outline",1,"stroke-palette-icon"],["formControlName","stroke",3,"colorChange"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"fill-color-picker","mat-typography"],["svgIcon","square",1,"stroke-palette-icon"],["formControlName","fill",3,"colorChange"]],template:function(i,n){1&i&&(e.I0R(0,"h2",0),e.OEk(1),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"div",1)(4,"div",2)(5,"form",3),e.yuY(6,ad,6,3,"div",4),e.I0R(7,"div",5)(8,"span"),e.wR5(9,"mat-icon",6),e.OEk(10),e.wVc(11,"translate"),e.C$Y(),e.I0R(12,"igo-color-picker-form-field",7),e.qCj("colorChange",function(v){return n.setLayerStrokeColor(v)}),e.C$Y()()()()(),e.I0R(13,"div",8)(14,"button",9),e.qCj("click",function(){return n.cancel()}),e.OEk(15),e.wVc(16,"translate"),e.C$Y(),e.I0R(17,"button",10),e.qCj("click",function(){return n.confirm()}),e.OEk(18,"OK"),e.C$Y()()),2&i&&(e.yG2(),e.oRS(" ",e.kDX(2,5,"igo.geo.style.styleModal"),"\n"),e.yG2(4),e.E7m("formGroup",n.form),e.yG2(),e.E7m("ngIf",!0!==n.linestringOnly),e.yG2(4),e.oRS(" ",e.kDX(11,7,"igo.geo.style.stroke")," "),e.yG2(5),e.oRS(" ",e.kDX(16,9,"igo.geo.style.cancel")," "))},dependencies:[bt.WQ,bt.iU,Me.y,Me.sz,Me.ue,Me.u,Me.sl,Me.uW,Me.Wo,Xe.u_,tt.oB,tt.qL,Ue.Q9,bt.Yp,ct.oJ,ct.Gw,it.O0,it.sD],styles:["h2[_ngcontent-%COMP%]{font-weight:700;font-size:large}.igo-form[_ngcontent-%COMP%]{padding:10px}.fill-field[_ngcontent-%COMP%], .stroke-field[_ngcontent-%COMP%]{width:130px}.fill-color-picker[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:relative;top:7px}.fill-color-picker[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{left:8px}.stroke-color-picker[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:relative;top:7px}.stroke-color-picker[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{left:35px}.box[_ngcontent-%COMP%]{width:25px;height:25px}.edition-drawing[_ngcontent-%COMP%]{padding:10px 0}.igo-input-container[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%] + .mat-form-field[_ngcontent-%COMP%]{margin-left:8px}.igo-form-input-box[_ngcontent-%COMP%]{width:150px}button[_ngcontent-%COMP%]{margin-right:5px}"]})}return l})(),cd=(()=>{class l{dialog;layer;constructor(t){this.dialog=t}openStyleModalDialog(){setTimeout(()=>{this.dialog.open(ld,{disableClose:!1,data:{layer:this.layer},autoFocus:!1})},250)}static \u0275fac=function(i){return new(i||l)(e.GI1(bt.qW))};static \u0275cmp=e.In1({type:l,selectors:[["igo-style-modal-layer-button"]],inputs:{layer:"layer"},standalone:!0,features:[e.UHJ],decls:3,vars:3,consts:[["mat-icon-button","","color","primary",3,"matTooltip","click"],["svgIcon","palette",1,"style-icon"]],template:function(i,n){1&i&&(e.I0R(0,"button",0),e.qCj("click",function(){return n.openStyleModalDialog()}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",1),e.C$Y()),2&i&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.style.styleModalTooltipLayer"))},dependencies:[ct.oJ,ct.um,st.KO,st.a4,tt.oB,tt.qL,it.O0,it.sD],changeDetection:0})}return l})();s(28616);let Pa=(()=>{class l{cdRef;layer;map;complete=new e._w7;cancel=new e._w7;constructor(t){this.cdRef=t}onUpdateInputs(){this.cdRef.detectChanges()}onClose(){this.cancel.emit()}static \u0275fac=function(i){return new(i||l)(e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter"]],inputs:{layer:"layer",map:"map"},outputs:{complete:"complete",cancel:"cancel"},standalone:!0,features:[e.UHJ],decls:1,vars:3,consts:[["igoListItem","",3,"layer","header","map"]],template:function(i,n){1&i&&e.wR5(0,"igo-ogc-filterable-item",0),2&i&&e.E7m("layer",n.layer)("header",!1)("map",n.map)},dependencies:[zo],changeDetection:0})}return l})(),Fa=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[Pa]})}return l})();const Ra=new e.UbH("OgcFilterWidget");function ud(l){return l.create(Pa)}function dd(){return{provide:Ra,useFactory:ud,deps:[Ue.cx]}}let pd=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({})}return l})(),md=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({providers:[dd()],imports:[Ue.Se,Fa,pd,bt.sr,Fa]})}return l})();var ds=s(3360),Pn=s(47864),yo=function(l){return l.Layer="layer",l.Group="group",l}(yo||{}),Nt=function(l){return l[l.wms=0]="wms",l[l.wmts=1]="wmts",l[l.baselayers=2]="baselayers",l[l.arcgisrest=3]="arcgisrest",l[l.tilearcgisrest=4]="tilearcgisrest",l[l.imagearcgisrest=5]="imagearcgisrest",l[l.composite=6]="composite",l}(Nt||{});class Qn{id;title;url;removable;externalProvider;abstract;forcedProperties;items;type;version;matrixSet;requestEncoding;regFilters;groupImpose;groupSeparator;timeFilter;queryFormat;queryHtmlTarget;queryParams;sourceOptions;count;tooltipType;sortDirection;setCrossOriginAnonymous;showLegend;profils;constructor(m){Object.assign(this,m)}}class gd extends Qn{_collectCatlogItems;constructor(m,t){super(m),this._collectCatlogItems=t,this.type=Nt[Nt[Nt.wms]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class hd extends Qn{_collectCatlogItems;constructor(m,t){super(m),this._collectCatlogItems=t,this.type=Nt[Nt[Nt.wmts]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class fd extends Qn{_collectCatlogItems;constructor(m,t){super(m),this._collectCatlogItems=t,this.type=Nt[Nt[Nt.baselayers]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class yd extends Qn{_collectCatlogItems;constructor(m,t){super(m),this._collectCatlogItems=t,this.type=Nt[Nt[Nt.arcgisrest]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class La extends Qn{_collectCatlogItems;constructor(m,t,i){super(m),this._collectCatlogItems=t,this.type=Nt[Nt[i]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class _d extends Qn{_collectCatlogItems;constructor(m,t){super(m),this._collectCatlogItems=t,this.type=Nt[Nt[Nt.composite]],this.url=null}collectCatalogItems(){return this._collectCatlogItems(this)}}let Cd=(()=>{class l{http;config;languageService;messageService;capabilitiesService;constructor(t,i,n,p,v){this.http=t,this.config=i,this.languageService=n,this.messageService=p,this.capabilitiesService=v}loadCatalogs(){const t=this.config.getConfig("context")||{},i=this.config.getConfig("catalog")||{},n=i.url||t.url,p=i.sources||[],v=[];if(n){if(i.baselayers){const Oe=[{id:"catalog.baselayers",title:this.languageService.translate.instant("igo.geo.catalog.baseLayers"),url:`${n}/baselayers`,type:"baselayers"}];v.push((0,q.of)(Oe))}const k=this.http.get(`${n}/catalogs`).pipe((0,se.k)(de=>de.map(he=>Object.assign(he,he.options))),(0,ge.a)(de=>Ir.k));v.push(k)}return p.length>0&&v.push((0,q.of)(p).pipe((0,se.k)(k=>k.map(de=>(de.id||(de.id=(0,le.uq)()),de))))),(0,ds.E)(...v).pipe((0,se.k)(k=>[].concat.apply([],k)))}loadCatalogItems(t){let i;return i=Ga.createInstanceCatalog(t,this),i.collectCatalogItems()}loadCatalogBaseLayerItems(t){return this.getCatalogBaseLayersOptions(t).pipe((0,se.k)(i=>{const n=i.map(p=>({id:(0,Pn.KC)(p.sourceOptions),title:p.title,type:yo.Layer,externalProvider:t.externalProvider,options:p}));return[{id:"catalog.group.baselayers",type:yo.Group,externalProvider:t.externalProvider,title:t.title,items:n}]}))}getCatalogBaseLayersOptions(t){return this.http.get(t.url)}loadCatalogWMSLayerItems(t){return this.getCatalogCapabilities(t).pipe((0,se.k)(i=>{const n=[];if(!i)return n;i.Service&&i.Service.Abstract&&i.Service.Abstract.length&&(t.abstract=i.Service.Abstract);const p=[];this.flattenWmsCapabilities(i.Capability.Layer,0,p,t.groupSeparator);const v=Object.assign({},i.Capability.Layer);return v.Layer=p.filter(k=>0!==k.Layer.length),this.includeRecursiveItems(t,v,n),n}),(0,ge.a)(()=>(this.messageService.error("igo.geo.catalog.unavailable","igo.geo.catalog.unavailableTitle",void 0,{value:t.title}),Ir.k)))}flattenWmsCapabilities(t,i=0,n,p=" / "){if(!n.includes(t.Title)){const v=Object.assign({},t);v.Layer=[],n.push(v)}for(const v of t.Layer){const k=Object.assign({},v);i>0&&(k.Title=t.Title+p+v.Title),v.Layer?this.flattenWmsCapabilities(k,i+1,n,p):n.find(de=>de.Title===t.Title).Layer.push(v)}}loadCatalogWMTSLayerItems(t){return this.getCatalogCapabilities(t).pipe((0,se.k)(i=>this.getWMTSItems(t,i)))}loadCatalogArcGISRestItems(t){return this.getCatalogCapabilities(t).pipe((0,se.k)(i=>this.getArcGISRESTItems(t,i)))}loadCatalogCompositeLayerItems(t){const i=t.composite,n=[];i.map(Pe=>{Pe.sortDirection=t.sortDirection,n.push(Ga.createInstanceCatalog(Pe,this))});const p=[];n.map(Pe=>p.push(Pe.collectCatalogItems()));let v=[];function k(Pe){return Pe.reduce((Je,Fe)=>Je.concat(Fe.type===yo.Group?k(Fe.items):Fe),[])}if(Object.keys(i).find(Pe=>i[Pe].groupImpose)){const Pe=(Je,Fe)=>{const et=n[Fe],pt=Object.assign({},et.groupImpose);pt.address=et.id,pt.type=yo.Group,pt.externalProvider=et.externalProvider,void 0===pt.sortDirection&&(pt.sortDirection=et.sortDirection),pt.items=[];const Tt=k(Je);return Tt.map(Ht=>Ht.address=`${pt.address}.${pt.id}`),pt.items=Tt,pt};v=p.map((Je,Fe)=>Je.pipe((0,se.k)(et=>i[Fe].groupImpose?Pe(et,Fe):et)))}else v=p;const de=(0,ds.E)(...v).pipe((0,se.k)(Pe=>[].concat(...Pe))),Oe=(Pe,Je)=>Pe.reduce((Fe,et,pt,Tt)=>{const Ht=Je(et),Oo=Object.assign({},et);if(et.type===yo.Layer){const Xo=[],Zn=[];if(Tt.filter((Jo,vi)=>{let qn=!1;return Jo.title===Ht&&Jo.type===yo.Layer&&(vi!==pt&&Jo.address!==et.address&&(qn=!0),Xo.push(vi)),qn}).length>0){let Jo=Xo.findIndex(vi=>vi===pt)+1;Oo.title=`${et.title} (${Jo})`,Jo=Zn.findIndex(vi=>vi===pt)+1,Oo.newMetadataUrl=`${et.newMetadataUrl} (${Jo})`}Fe.find(Jo=>Jo.title===Oo.title&&Jo.type===yo.Layer)||(Fe[Fe.length]=Oo)}else et.type===yo.Group&&(Oo.items=Oe(et.items,Xo=>Xo.title),Fe[Fe.length]=Oo);return Fe},[]);return de.pipe((0,se.k)(Pe=>((Pe,Je)=>Pe.reduce((Fe,et)=>{const pt=(Je=>Je.id)(et),Tt=Fe.find(Ht=>Ht.id===pt);if(Tt){const Ht=Fe.indexOf(Tt);-1===Fe[Ht].address.split("|").indexOf(et.address)&&(Fe[Ht].address=`${Fe[Ht].address}|${et.address}`),Fe[Ht].items.push(...et.items)}else Fe[Fe.length]=et;return Fe},[]))(Pe)),(0,se.k)(Pe=>[].concat(...Pe)),(0,se.k)(Pe=>Oe(Pe,Je=>Je.title)))}getCatalogCapabilities(t){return this.capabilitiesService.getCapabilities(Nt[t.type],t.url,t.version).pipe((0,ge.a)(n=>(this.messageService.error(t.title?"igo.geo.catalog.unavailable":"igo.geo.catalog.someUnavailable","igo.geo.catalog.unavailableTitle",void 0,t.title?{value:t.title}:void 0),console.error(n),(0,q.of)(void 0))))}computeForcedProperties(t,i){if(!i||0===i.length)return;const n={layerName:t,title:void 0,metadataUrl:void 0,metadataAbstract:void 0,metadataAbstractAll:void 0,metadataUrlAll:void 0},p=i.find(v=>"*"===v.layerName);return p&&(p.metadataAbstractAll&&(n.metadataAbstractAll=p.metadataAbstractAll),p.metadataUrlAll&&(n.metadataUrlAll=p.metadataUrlAll)),i.map(v=>{t===v.layerName&&(v.title&&(n.title=v.title),v.metadataUrl&&(n.metadataUrl=v.metadataUrl),v.metadataAbstract&&(n.metadataAbstract=v.metadataAbstract))}),n}prepareCatalogItemLayer(t,i,n,p){const v=this.retrieveLayerInfoFormat(t.Name,n),k=p.showLegend&&t.Style?this.capabilitiesService.getStyle(t.Style):void 0,de=Object.assign({},p.queryParams,{LAYERS:t.Name,VERSION:p.version}),he={type:"wms",url:p.url,crossOrigin:p.setCrossOriginAnonymous?"anonymous":void 0,queryFormat:v,queryHtmlTarget:v===Ae.s5.HTML||v===Ae.s5.HTMLGML2?"iframe":void 0,optionsFromCapabilities:!0},Oe=Object.assign({},he,p.sourceOptions,{params:de}),be=this.computeForcedProperties(t.Name,p.forcedProperties);let Pe,Je=!0;t.Abstract?Pe=t.Abstract:!t.Abstract&&p.abstract&&(Pe=p.abstract);const Fe=t?.DataURL&&t?.DataURL.length>0?t?.DataURL[0].OnlineResource:void 0;let et=be?.metadataUrl||be?.metadataUrlAll||Fe,pt=be?.metadataAbstract||be?.metadataAbstractAll||Pe;!be?.metadataUrl&&!be?.metadataUrlAll&&(be?.metadataAbstract||be?.metadataAbstractAll)&&(Je=!1),be?.metadataAbstract&&be?.metadataUrlAll&&(Je=!1);const Tt={id:(0,Pn.KC)(Oe),type:yo.Layer,title:be?.title?be.title:t.Title,address:i,externalProvider:p.externalProvider||!1,options:{maxResolution:(0,P.bg)(t.MaxScaleDenominator),minResolution:(0,P.bg)(t.MinScaleDenominator),metadata:{url:et,extern:Je,abstract:pt,type:he.type},legendOptions:k,tooltip:{type:p.tooltipType},sourceOptions:Oe}};return le.Yv.removeUndefined(Tt)}prepareCatalogItemGroup(t,i,n,p,v){return{id:n,type:yo.Group,title:t.Title,address:v.id,externalProvider:v.externalProvider||!1,sortDirection:v.sortDirection,items:t.Layer.reduce((de,he)=>{if(void 0!==he.Layer){const be=this.prepareCatalogItemGroup(he,i,n+`.group.${he.Name||he.Layer[0].Name}`,p,v);de.push(be)}else{if(!1===this.testLayerRegexes(he.Name,i))return de;const Oe=this.prepareCatalogItemLayer(he,n,p,v);de.push(Oe)}return de},[])}}includeRecursiveItems(t,i,n,p=0){const v=(t.regFilters||[]).map(k=>new RegExp(k));if(i.Layer)for(const k of i.Layer){if(void 0!==k.Layer){this.includeRecursiveItems(t,k,n,p+1);continue}const de=this.findCatalogInfoFormat(t);if(0!==p){const Oe=this.prepareCatalogItemGroup(i,v,`catalog.group.${i.Name||k.Name}`,de,t);0!==Oe.items.length&&n.push(Oe);break}if(!1!==this.testLayerRegexes(k.Name,v)){const he=this.prepareCatalogItemLayer(k,t.id,de,t);n.push(he)}}}getWMTSItems(t,i){if(!i)return[];const n=i.Contents.Layer,p=(t.regFilters||[]).map(v=>new RegExp(v));return i.ServiceIdentification&&i.ServiceIdentification.Abstract&&i.ServiceIdentification.Abstract.length&&(t.abstract=i.ServiceIdentification.Abstract),n.map(v=>{const k=this.computeForcedProperties(v.Title,t.forcedProperties);let de=!0,he=k?.metadataUrl||k?.metadataUrlAll,Oe=k?.metadataAbstract||k?.metadataAbstractAll||t.abstract;if(!k?.metadataUrl&&!k?.metadataUrlAll&&(k?.metadataAbstract||k?.metadataAbstractAll)&&(de=!1),k?.metadataAbstract&&k?.metadataUrlAll&&(de=!1),!1===this.testLayerRegexes(v.Identifier,p))return;const be=Object.assign({},t.queryParams,{version:"1.0.0"}),Pe={type:"wmts",url:t.url,crossOrigin:t.setCrossOriginAnonymous?"anonymous":void 0,layer:v.Identifier,matrixSet:t.matrixSet,optionsFromCapabilities:!0,requestEncoding:t.requestEncoding||"KVP",style:"default"},Je=Object.assign({},Pe,t.sourceOptions,{params:be});return le.Yv.removeUndefined({id:(0,Pn.KC)(Je),type:yo.Layer,title:k?.title?k.title:v.Title,address:t.id,externalProvider:t.externalProvider,options:{sourceOptions:Je,metadata:{url:he,extern:de,abstract:Oe,type:Pe.type}}})}).filter(v=>void 0!==v)}getArcGISRESTItems(t,i){if(!i||!i.layers)return this.messageService.error("igo.geo.catalog.someUnavailable","igo.geo.catalog.unavailableTitle"),[];const n=i.layers?i.layers.filter(be=>be.subLayerIds):[],p=i.layers?i.layers.filter(be=>!be.type||be.type===rr.I.FeatureLayer||be.type===rr.I.RasterLayer):[],v=(t.regFilters||[]).map(be=>new RegExp(be));let k;i.serviceDescription&&i.serviceDescription.length&&(k=i.serviceDescription.replace(/(<([^>]+)>)/gi,""));const de=p.map(be=>{const Pe=this.computeForcedProperties(be.name,t.forcedProperties);let Je=t.abstract,Fe=!0,et=Pe?.metadataUrl||Pe?.metadataUrlAll,pt=Pe?.metadataAbstract||Pe?.metadataAbstractAll||Je;if(!Pe?.metadataUrl&&!Pe?.metadataUrlAll&&(Pe?.metadataAbstract||Pe?.metadataAbstractAll)&&(Fe=!1),Pe?.metadataAbstract&&Pe?.metadataUrlAll&&(Fe=!1),!1===this.testLayerRegexes(be.id.toString(),v))return;const Tt={type:Nt[t.type],url:t.url,layer:be.id.toString(),queryable:!0,queryFormat:Ae.s5.ESRIJSON,optionsFromCapabilities:!0},Ht=Object.assign({},Tt,t.sourceOptions);return le.Yv.removeUndefined({id:(0,Pn.KC)(Ht),type:yo.Layer,title:Pe?.title?Pe.title:be.name,externalProvider:t.externalProvider,options:{sourceOptions:Ht,minResolution:(0,P.bg)(be.maxScale),maxResolution:(0,P.bg)(be.minScale),metadata:{url:et,extern:Fe,abstract:pt,type:t.type}}})}).filter(be=>void 0!==be),he=[],Oe=n.map(be=>({options:void 0,address:`catalog.group.${be.name}`,id:`catalog.group.${be.name}`,type:yo.Group,externalProvider:t.externalProvider,sortDirection:t.sortDirection,title:be.name,items:de.filter(Pe=>be.subLayerIds.map(Fe=>Fe.toString()).includes(Pe.options.sourceOptions.layer)).map(Pe=>(he.push(Pe.id),Object.assign({},Pe,{address:`catalog.group.${be.name}`})))})).filter(be=>be.items.length);if(n){const be=t.title||t.id,Pe=de.filter(Je=>!he.includes(Je.id)).map(Je=>Object.assign({},Je,{address:`catalog.group.${be}`}));Pe.length&&Oe.push({options:void 0,address:`catalog.group.${be}`,id:`catalog.group.${be}`,type:yo.Group,externalProvider:t.externalProvider,sortDirection:t.sortDirection,title:be,items:Pe})}return n?Oe:de}testLayerRegexes(t,i){return 0===i.length||void 0!==i.find(n=>n.test(t))}retrieveLayerInfoFormat(t,i){const n=i.find(k=>k.layer===t),p=i.find(k=>"*"===k.layer);let v;return n?v=n.queryFormat:p&&(v=p.queryFormat),v}findCatalogInfoFormat(t){const i=[];return t.queryFormat&&Object.keys(t.queryFormat).forEach(n=>{t.queryFormat[n]instanceof Array?t.queryFormat[n].forEach(p=>{i.find(v=>v.layer===p)||i.push({layer:p,queryFormat:n})}):i.find(p=>p.layer===t.queryFormat[n])||i.push({layer:t.queryFormat[n],queryFormat:n})}),i}static \u0275fac=function(i){return new(i||l)(e.CoB(ae.KK),e.CoB(M.aW),e.CoB(L.ov),e.CoB(Qt.mi),e.CoB(Go.S))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();class Ga{static createInstanceCatalog(m,t){let i;return i=m.hasOwnProperty("composite")?new _d(m,n=>t.loadCatalogCompositeLayerItems(n)):m.type===Nt[Nt.baselayers]?new fd(m,n=>t.loadCatalogBaseLayerItems(n)):m.type===Nt[Nt.arcgisrest]?new yd(m,n=>t.loadCatalogArcGISRestItems(n)):m.type===Nt[Nt.tilearcgisrest]?new La(m,n=>t.loadCatalogArcGISRestItems(n),Nt.tilearcgisrest):m.type===Nt[Nt.imagearcgisrest]?new La(m,n=>t.loadCatalogArcGISRestItems(n),Nt.imagearcgisrest):m.type===Nt[Nt.wmts]?new hd(m,n=>t.loadCatalogWMTSLayerItems(n)):new gd(m,n=>t.loadCatalogWMSLayerItems(n)),i}}var ps=s(56708);function vd(l,m){1&l&&e.wR5(0,"mat-icon",10)}function Sd(l,m){1&l&&(e.I0R(0,"button",11)(1,"mat-icon",12),e.qCj("click",function(i){return i.stopPropagation()}),e.wVc(2,"translate"),e.C$Y()()),2&l&&(e.yG2(),e.E7m("matTooltip",e.kDX(2,1,"igo.geo.catalog.externalProvider.layer")))}function bd(l,m){if(1&l&&(e.wR5(0,"igo-layer-legend",4),e.wVc(1,"async")),2&l){const t=e.GaO();e.E7m("layer",e.kDX(1,1,t.igoLayer$))}}let $a=(()=>{class l{layerService;inRange$=new A.g(!0);isPreview$=new A.g(!1);isVisible$=new A.g(!1);isPreview$$;resolution$$;layers$$;lastTimeoutRequest;layerLegendShown$=new A.g(!1);igoLayer$=new A.g(void 0);mouseInsideAdd=!1;resolution;catalogAllowLegend=!1;layer;map;added=!1;addedChange=new e._w7;addedLayerIsPreview=new e._w7;get title(){return(0,Ue.YB)(this.layer)}get icon(){return(0,Ue.sH)(this.layer)||"layers"}constructor(t){this.layerService=t}ngOnInit(){this.isPreview$$=this.isPreview$.subscribe(t=>this.addedLayerIsPreview.emit(t)),this.layers$$=this.map.layers$.subscribe(()=>{this.isVisible()}),this.resolution$$=this.map.viewController.resolution$.subscribe(t=>{this.isInResolutionsRange(t),this.isVisible()})}ngOnDestroy(){this.isPreview$$.unsubscribe(),this.resolution$$.unsubscribe(),this.layers$$.unsubscribe()}computeTitleTooltip(){const t=this.layer.options;if(!t.tooltip)return(0,Ue.YB)(this.layer);const i=t.tooltip,n=t.metadata;switch(t.tooltip.type){case ps.wL.TITLE:return this.layer.title;case ps.wL.ABSTRACT:return n&&n.abstract?n.abstract:this.layer.title;case ps.wL.CUSTOM:return i&&i.text?i.text:this.layer.title;default:return this.layer.title}}onMouseEvent(t){this.onToggleClick(t)}askForLegend(t){this.layerLegendShown$.next(!this.layerLegendShown$.value),this.layerService.createAsyncLayer(this.layer.options).pipe((0,Ce.K)()).subscribe(i=>this.igoLayer$.next(i))}onToggleClick(t){if(typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest),"mouseenter"!==t.type||!this.mouseInsideAdd)switch(t.type){case"click":this.isPreview$.value||(this.added?this.remove(t):this.add(t)),this.isPreview$.next(!1);break;case"mouseenter":!this.isPreview$.value&&!this.added&&(this.lastTimeoutRequest=setTimeout(()=>{this.add(t),this.isPreview$.next(!0)},500)),this.mouseInsideAdd=!0;break;case"mouseleave":this.isPreview$.value&&(this.remove(t),this.isPreview$.next(!1)),this.mouseInsideAdd=!1}}add(t){this.added||(this.added=!0,this.addedChange.emit({added:!0,layer:this.layer,event:t}))}remove(t){this.added&&(this.added=!1,this.addedChange.emit({added:!1,layer:this.layer,event:t}))}haveGroup(){return!(!this.layer.address||1===this.layer.address.split(".").length)}isInResolutionsRange(t){const i=!this.layer.options.minResolution||Number.isNaN(this.layer.options.minResolution)?0:this.layer.options.minResolution,n=!this.layer.options.maxResolution||Number.isNaN(this.layer.options.maxResolution)?1/0:this.layer.options.maxResolution;this.inRange$.next(t>=i&&t<=n)}isVisible(){if(this.layer?.id){const t=this.map.getLayerById(this.layer?.id);this.isVisible$.next(!!t&&t.visible)}}getBadgeIcon(){return this.inRange$.getValue()&&this.isVisible$.getValue()?"":"eye-off"}computeTooltip(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?this.isVisible$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapNotVisible":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"}static \u0275fac=function(i){return new(i||l)(e.GI1(yr.I))};static \u0275cmp=e.In1({type:l,selectors:[["igo-catalog-browser-layer"]],inputs:{resolution:"resolution",catalogAllowLegend:"catalogAllowLegend",layer:"layer",map:"map",added:"added"},outputs:{addedChange:"addedChange",addedLayerIsPreview:"addedLayerIsPreview"},standalone:!0,features:[e.UHJ],decls:23,vars:36,consts:[["class","catalog-browser-layer-carret","matListItemIcon","","svgIcon","blank",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"ngClass","matTooltip","click"],["matListItemMeta",""],["disabled","true","mat-icon-button","",4,"ngIf"],[3,"layer"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click"],["aria-hidden","false","matBadge","icon","igoMatBadgeColor","rgba(0,0,0,0.87)","igoMatBadgeBackgroundColor","none","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeIcon","igoMatBadgeInverseColor","matBadgeHidden","matBadgeDisabled","svgIcon"],[1,"igo-cataloglayer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],["matListItemIcon","","svgIcon","blank",1,"catalog-browser-layer-carret"],["disabled","true","mat-icon-button",""],["tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",1,"igo-cataloglayer-external-icon",3,"matTooltip","click"]],template:function(i,n){1&i&&(e.I0R(0,"mat-list-item"),e.yuY(1,vd,1,0,"mat-icon",0),e.I0R(2,"span",1),e.qCj("click",function(v){return n.askForLegend(v)}),e.OEk(3),e.C$Y(),e.I0R(4,"div",2),e.yuY(5,Sd,3,3,"button",3),e.wR5(6,"igo-metadata-button",4),e.I0R(7,"button",5),e.qCj("mouseenter",function(v){return n.onMouseEvent(v)})("mouseleave",function(v){return n.onMouseEvent(v)})("click",function(v){return n.onToggleClick(v)}),e.wVc(8,"translate"),e.wVc(9,"async"),e.wR5(10,"mat-icon",6),e.wVc(11,"async"),e.wVc(12,"async"),e.wVc(13,"async"),e.wVc(14,"async"),e.wVc(15,"async"),e.wVc(16,"async"),e.wVc(17,"async"),e.C$Y()()(),e.I0R(18,"div",7,8),e.yuY(20,bd,2,3,"igo-layer-legend",9),e.wVc(21,"async"),e.wVc(22,"async"),e.C$Y()),2&i&&(e.yG2(),e.E7m("ngIf",n.haveGroup()),e.yG2(),e.E7m("ngClass",n.catalogAllowLegend?"igo-cataloglayer-title":"")("matTooltip",n.computeTitleTooltip()),e.yG2(),e.oRS(" ",n.title," "),e.yG2(2),e.E7m("ngIf",n.layer.externalProvider),e.yG2(),e.E7m("layer",n.layer),e.yG2(),e.E7m("matTooltip",e.kDX(8,14,n.computeTooltip()))("color",e.kDX(9,16,n.isPreview$)?"":n.added?"warn":""),e.yG2(3),e.E7m("igoMatBadgeIcon",n.getBadgeIcon())("igoMatBadgeInverseColor",!0)("matBadgeHidden",e.kDX(11,18,n.inRange$)&&!0===e.kDX(12,20,n.isVisible$)||e.kDX(13,22,n.inRange$)&&!n.added||e.kDX(14,24,n.inRange$)&&e.kDX(15,26,n.isPreview$))("matBadgeDisabled",!1===e.kDX(16,28,n.inRange$))("svgIcon",e.kDX(17,30,n.isPreview$)?"plus":n.added?"delete":"plus"),e.yG2(10),e.E7m("ngIf",e.kDX(21,32,n.layerLegendShown$)&&e.kDX(22,34,n.igoLayer$)&&n.catalogAllowLegend))},dependencies:[_t.iI,_t.g9,_t.Y1,_t.UV,_t.At,Xe.u_,tt.oB,tt.qL,Xe.QF,st.KO,st.a4,ct.oJ,ct.um,cs,qe.g,qe.S,Ue.qS,Eo,Xe.a,it.O0,it.sD],styles:[".igo-cataloglayer-title[_ngcontent-%COMP%]{cursor:pointer}.catalog-browser-layer-carret[_ngcontent-%COMP%]{margin-right:16px}.igo-cataloglayer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px);margin-left:40px}.igo-cataloglayer-external-icon[_ngcontent-%COMP%]{cursor:help}[_nghost-%COMP%]   .mdc-list-item__end[_ngcontent-%COMP%], [_nghost-%COMP%]   .mdc-list-item__start[_ngcontent-%COMP%]{color:#000}"],changeDetection:0})}return l})();function wd(l,m){1&l&&(e.I0R(0,"mat-icon",10),e.qCj("click",function(i){return i.stopPropagation()}),e.wVc(1,"translate"),e.C$Y()),2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.catalog.externalProvider.group"))}function Od(l,m){if(1&l&&(e.I0R(0,"button",8),e.yuY(1,wd,2,3,"mat-icon",9),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",t.group.externalProvider)}}function Id(l,m){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"button",11),e.qCj("click",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onToggleClick(n))}),e.wVc(2,"translate"),e.wVc(3,"async"),e.wR5(4,"mat-icon",12),e.C$Y(),e.k70()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("matTooltip",e.kDX(2,2,"igo.geo.catalog.group.removeFromMap"))("disabled",e.kDX(3,4,t.disabled$))}}function Td(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",13),e.qCj("click",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onToggleClick(n))}),e.wVc(1,"translate"),e.wVc(2,"async"),e.wR5(3,"mat-icon",14),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.catalog.group.addToMap"))("disabled",e.kDX(2,4,t.disabled$))}}function Ed(l,m){1&l&&e.C_f(0)}function xd(l,m){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"igo-catalog-browser-layer",16),e.qCj("addedLayerIsPreview",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.onLayerPreview(n))})("addedChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.onLayerAddedChange(n))}),e.C$Y(),e.k70()}if(2&l){const t=e.GaO().$implicit,i=e.GaO();e.yG2(),e.E7m("layer",t)("resolution",i.resolution)("map",i.map)("catalogAllowLegend",i.catalogAllowLegend)("added",i.state.get(t).added)}}function Md(l,m){if(1&l&&e.yuY(0,Ed,1,0,"ng-container",15)(1,xd,2,5,"ng-container",15),2&l){const t=m.$implicit,i=e.GaO();e.E7m("ngIf",i.isGroup(t)),e.yG2(),e.E7m("ngIf",i.isLayer(t))}}let Dd=(()=>{class l{store=new Ue.qc([]);added$=new A.g(!1);preview$=new A.g(!1);disabled$=new A.g(!1);catalog;group;map;collapsed=!0;resolution;catalogAllowLegend=!1;toggleCollapsed=!0;state;addedChange=new e._w7;layerAddedChange=new e._w7;get title(){return this.group.title}ngOnInit(){this.store.load(this.group.items),this.evaluateAdded(),this.evaluateDisabled(this.collapsed),void 0!==this.group.sortDirection&&this.store.view.sort({direction:this.group.sortDirection,valueAccessor:t=>t.title})}ngOnDestroy(){this.store.destroy()}isGroup(t){return t.type===yo.Group}isLayer(t){return t.type===yo.Layer}onToggleClick(t){this.added$.value?this.remove(t):this.add(t)}onToggleCollapsed(t){this.evaluateDisabled(t)}onLayerAddedChange(t){this.layerAddedChange.emit(t),this.tryToggleGroup(t)}add(t){this.added$.next(!0),this.addedChange.emit({added:!0,group:this.group,event:t})}remove(t){this.added$.next(!1),this.addedChange.emit({added:!1,group:this.group,event:t})}onLayerPreview(t){this.preview$.next(t)}tryToggleGroup(t){const i=t.added,n=t.layer;this.store.view.all().filter(v=>v.id!==n.id).map(v=>this.state.get(v).added||!1).every(v=>v===i)?i?this.add(t.event):this.remove(t.event):!0===this.added$.value&&this.added$.next(!1)}evaluateAdded(){const t=this.store.all().every(i=>!0===(this.state.get(i).added||!1));this.added$.next(t)}evaluateDisabled(t){let i=!1;!1===this.toggleCollapsed&&(i=t),this.disabled$.next(i)}onTitleClick(){this.collapsed=!this.collapsed}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-catalog-browser-group"]],inputs:{catalog:"catalog",group:"group",map:"map",collapsed:"collapsed",resolution:"resolution",catalogAllowLegend:"catalogAllowLegend",toggleCollapsed:"toggleCollapsed",state:"state"},outputs:{addedChange:"addedChange",layerAddedChange:"layerAddedChange"},standalone:!0,features:[e.UHJ],decls:15,vars:14,consts:[["matListItemIcon","","svgIcon","chevron-up","igoCollapse","",1,"igo-chevron","catalog-browser-group-carret",3,"target","collapsed","toggle"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-catalog-group-title",3,"matTooltip","click"],["matListItemMeta",""],["disabled","true","mat-icon-button","",4,"ngIf"],[4,"ngIf","ngIfElse"],["notadded",""],["items",""],["ngFor","",3,"ngForOf"],["disabled","true","mat-icon-button",""],["class","igo-cataloggroup-external-icon","tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",3,"matTooltip","click",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",1,"igo-cataloggroup-external-icon",3,"matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","disabled","click"],["svgIcon","delete"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","click"],["svgIcon","plus"],[4,"ngIf"],["igoListItem","",3,"layer","resolution","map","catalogAllowLegend","added","addedLayerIsPreview","addedChange"]],template:function(i,n){if(1&i&&(e.I0R(0,"mat-list-item")(1,"mat-icon",0),e.qCj("toggle",function(v){return n.onToggleCollapsed(v)}),e.C$Y(),e.I0R(2,"span",1),e.qCj("click",function(){return n.onTitleClick()}),e.OEk(3),e.C$Y(),e.I0R(4,"div",2),e.yuY(5,Od,2,1,"button",3)(6,Id,5,6,"ng-container",4),e.wVc(7,"async"),e.wVc(8,"async"),e.yuY(9,Td,4,6,"ng-template",null,5,e.gJz),e.C$Y()(),e.I0R(11,"div",null,6),e.yuY(13,Md,2,2,"ng-template",7),e.wVc(14,"async"),e.C$Y()),2&i){const p=e.Gew(10),v=e.Gew(12);e.yG2(),e.E7m("target",v)("collapsed",n.collapsed),e.yG2(),e.E7m("matTooltip",n.title),e.yG2(),e.cNF(n.title),e.yG2(2),e.E7m("ngIf",n.group.externalProvider),e.yG2(),e.E7m("ngIf",e.kDX(7,8,n.added$)&&!1===e.kDX(8,10,n.preview$))("ngIfElse",p),e.yG2(7),e.E7m("ngForOf",e.kDX(14,12,n.store.view.all$()))}},dependencies:[_t.iI,_t.g9,_t.Y1,_t.UV,_t.At,tt.oB,tt.qL,Ue.mK,st.KO,st.a4,Xe.u_,ct.oJ,ct.um,Xe.Iw,$a,Ue.qU,Xe.a,it.O0,it.sD],styles:[".igo-catalog-group-title[_ngcontent-%COMP%]{cursor:pointer}.igo-cataloggroup-external-icon[_ngcontent-%COMP%]{cursor:help}.catalog-browser-group-carret[_ngcontent-%COMP%]{margin-right:16px}.igo-catalog-group-title[_ngcontent-%COMP%]{font-weight:500}[_nghost-%COMP%]   .mdc-list-item__end[_ngcontent-%COMP%], [_nghost-%COMP%]   .mdc-list-item__start[_ngcontent-%COMP%]{color:#000}"],changeDetection:0})}return l})();function Pd(l,m){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"igo-catalog-browser-group",3),e.qCj("addedChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.onGroupAddedChange(n))})("layerAddedChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.onLayerAddedChange(n))}),e.wVc(2,"async"),e.C$Y(),e.k70()}if(2&l){const t=e.GaO().$implicit,i=e.GaO();e.yG2(),e.E7m("catalog",i.catalog)("group",t)("map",i.map)("state",i.store.state)("resolution",e.kDX(2,8,i.resolution$))("catalogAllowLegend",i.catalogAllowLegend)("collapsed",1!==i.store.count)("toggleCollapsed",i.toggleCollapsedGroup)}}function Fd(l,m){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"igo-catalog-browser-layer",4),e.qCj("addedChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.onLayerAddedChange(n))}),e.wVc(2,"async"),e.C$Y(),e.k70()}if(2&l){const t=e.GaO().$implicit,i=e.GaO();e.yG2(),e.E7m("layer",t)("map",i.map)("resolution",e.kDX(2,5,i.resolution$))("catalogAllowLegend",i.catalogAllowLegend)("added",i.store.state.get(t).added)}}function Rd(l,m){if(1&l&&e.yuY(0,Pd,3,10,"ng-container",2)(1,Fd,3,7,"ng-container",2),2&l){const t=m.$implicit,i=e.GaO();e.E7m("ngIf",i.isGroup(t)),e.yG2(),e.E7m("ngIf",i.isLayer(t))}}let Aa=(()=>{class l{layerService;cdRef;watcher;get resolution$(){return this.map.viewController.resolution$}catalogAllowLegend=!1;catalog;store;map;toggleCollapsedGroup=!0;constructor(t,i){this.layerService=t,this.cdRef=i}ngOnInit(){const t=this.map.layers.map(n=>({id:n.options.source.id,title:n.title,type:yo.Layer}));this.store.state.updateMany(t,{added:!0},!0),this.catalog&&void 0!==this.catalog.sortDirection&&this.store.view.sort({direction:this.catalog.sortDirection,valueAccessor:n=>n.title}),this.catalogAllowLegend=!!this.catalog&&this.catalog.showLegend||this.catalogAllowLegend,this.watcher=new Ue.YX(this.store,this.cdRef)}ngOnDestroy(){this.watcher.destroy()}isGroup(t){return t.type===yo.Group}isLayer(t){return t.type===yo.Layer}onLayerAddedChange(t){const i=t.layer;this.store.state.update(i,{added:t.added},!1),t.added?this.addLayerToMap(i,t):this.removeLayerFromMap(i)}onGroupAddedChange(t){const i=t.group;this.store.state.update(i,{added:t.added},!1),t.added?this.addGroupToMap(i,t):this.removeGroupFromMap(i)}addLayerToMap(t,i){this.addLayersToMap([t],i)}removeLayerFromMap(t){this.removeLayersFromMap([t])}addLayersToMap(t,i){const n=t.map(p=>(p.options.sourceOptions.optionsFromApi||(p.options.sourceOptions.optionsFromApi=!0),this.catalog.profils?.length&&(p.options.security={profils:this.catalog.profils}),this.layerService.createAsyncLayer(p.options)));(0,ds.E)(...n).subscribe(p=>{"click"===i.event.type&&i.added&&this.map.layersAddedByClick$.next(p),this.store.state.updateMany(p,{added:!0}),this.map.addLayers(p)})}removeLayersFromMap(t){t.forEach(i=>{if(this.store.state.update(i,{added:!1}),!0===i.options.baseLayer){const n=this.map.getLayerById(i.options.id);void 0!==n&&this.map.removeLayer(n)}else{const n=this.map.getLayerById(i.id);void 0!==n&&this.map.removeLayer(n)}})}sortCatalogItemsByTitle(t,i){const n=t.sort((p,v)=>{const k=p.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),de=v.title.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return k<de?-1:k>de?1:0});switch(i){case"asc":return n;case"desc":return n.reverse();default:return t}}addGroupToMap(t,i){let n=t.items.filter(p=>{const v=this.store.state.get(p).added||!1;return this.isLayer(p)&&!1===v});void 0!==t.sortDirection&&(n=this.sortCatalogItemsByTitle(n,t.sortDirection)),this.addLayersToMap(n.reverse(),i)}removeGroupFromMap(t){const i=t.items.filter(n=>{const p=this.store.state.get(n).added||!1;return this.isLayer(n)&&!0===p});this.removeLayersFromMap(i)}static \u0275fac=function(i){return new(i||l)(e.GI1(yr.I),e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-catalog-browser"]],inputs:{catalogAllowLegend:"catalogAllowLegend",catalog:"catalog",store:"store",map:"map",toggleCollapsedGroup:"toggleCollapsedGroup"},standalone:!0,features:[e.UHJ],decls:3,vars:5,consts:[[3,"navigation","selection"],["ngFor","",3,"ngForOf"],[4,"ngIf"],[3,"catalog","group","map","state","resolution","catalogAllowLegend","collapsed","toggleCollapsed","addedChange","layerAddedChange"],["igoListItem","",3,"layer","map","resolution","catalogAllowLegend","added","addedChange"]],template:function(i,n){1&i&&(e.I0R(0,"igo-list",0),e.yuY(1,Rd,2,2,"ng-template",1),e.wVc(2,"async"),e.C$Y()),2&i&&(e.E7m("navigation",!1)("selection",!1),e.yG2(),e.E7m("ngForOf",e.kDX(2,3,n.store.view.all$())))},dependencies:[Ue.yM,Xe.Iw,Xe.u_,Dd,$a,Ue.qU,Xe.a],encapsulation:2,changeDetection:0})}return l})();function Ld(l,m){if(1&l&&(e.I0R(0,"mat-option",17),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("matTooltip",t.title)("value",t),e.yG2(),e.oRS(" ",t.title," ")}}function Gd(l,m){if(1&l&&(e.I0R(0,"mat-option",17),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("matTooltip",t.url)("value",t),e.yG2(),e.oRS(" ",t.url," ")}}function $d(l,m){if(1&l&&(e.I0R(0,"mat-option",18),e.qCj("click",function(i){return i.stopPropagation()}),e.I0R(1,"p",19),e.OEk(2),e.C$Y()()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(2),e.cNF(t)}}const Ad=(l,m)=>({value:l,email:m});function kd(l,m){if(1&l&&(e.I0R(0,"span")(1,"p",20),e.OEk(2),e.C$Y()()),2&l){const t=e.GaO();e.yG2(2),e.oRS(" ",t.languageService.translate.instant("igo.geo.catalog.externalProvider.unavailableWithEmail",e.IBC(1,Ad,t.addedCatalog.url,t.emailAddress))," ")}}const Bd=l=>({value:l});function Ud(l,m){if(1&l&&(e.I0R(0,"span")(1,"p",20),e.OEk(2),e.C$Y()()),2&l){const t=e.GaO();e.yG2(2),e.oRS(" ",t.languageService.translate.instant("igo.geo.catalog.unavailable",e.S45(1,Bd,t.addedCatalog.url))," ")}}let ka=(()=>{class l{formBuilder;languageService;configService;dialogRef;data;form;defaultAddedCatalogType="wms";addedCatalogType$$;predefinedCatalogsList$=new A.g([]);typeCapabilities;predefinedCatalogs=[];store;error=!1;addedCatalog;emailAddress;storeViewAll$$;constructor(t,i,n,p,v){this.formBuilder=t,this.languageService=i,this.configService=n,this.dialogRef=p,this.data=v,this.store=v.store,this.predefinedCatalogs=v.predefinedCatalogs,this.error=v.error,this.addedCatalog=v.addedCatalog,this.form=this.formBuilder.group({id:["",[]],title:["",[]],url:["",[Me.AQ.required]],type:[this.defaultAddedCatalogType,[Me.AQ.required]]})}ngOnInit(){this.store.state.clear(),this.typeCapabilities=Object.keys(rr.S),this.addedCatalogType$$=this.form.get("type").valueChanges.subscribe(t=>{"wmts"===t?this.form.get("title").setValidators(Me.AQ.required):this.form.get("title").setValidators([]),this.form.get("title").updateValueAndValidity()}),this.computePredefinedCatalogList(),this.storeViewAll$$=this.store.view.all$().subscribe(()=>this.computePredefinedCatalogList()),this.emailAddress=this.configService.getConfig("emailAddress")}ngOnDestroy(){this.addedCatalogType$$.unsubscribe(),this.storeViewAll$$.unsubscribe()}changeUrlOrTitle(t){this.form.patchValue(t),this.error=!1,this.computePredefinedCatalogList()}computePredefinedCatalogList(){this.predefinedCatalogsList$.next(this.predefinedCatalogs.filter(t=>!this.store.get(t.id)))}addCatalog(t){this.error=!1,this.dialogRef.close(t)}cancel(){this.error=!1,this.dialogRef.close()}static \u0275fac=function(i){return new(i||l)(e.GI1(Me.KE),e.GI1(L.ov),e.GI1(M.aW),e.GI1(bt.yI),e.GI1(bt.sR,8))};static \u0275cmp=e.In1({type:l,selectors:[["igo-add-catalog-dialog"]],standalone:!0,features:[e.UHJ],decls:34,vars:25,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],["type","text","formControlName","title","matInput","",3,"placeholder","matAutocomplete"],[3,"optionSelected"],["auto2","matAutocomplete"],["matTooltipShowDelay","500",3,"matTooltip","value",4,"ngFor","ngForOf"],["type","text","formControlName","url","placeholder","URL","matInput","",3,"matAutocomplete"],["auto","matAutocomplete"],["formControlName","type","placeholder","Type"],[3,"value","click",4,"ngFor","ngForOf"],[4,"ngIf"],["mat-dialog-actions","",2,"justify-content","center"],[1,"igo-form-button-group","add-catalog-button-top-padding"],["mat-raised-button","","type","button",3,"click"],["id","addCatalogBtnDialog","mat-raised-button","","type","button","color","primary",3,"disabled","click"],["matTooltipShowDelay","500",3,"matTooltip","value"],[3,"value","click"],["matListItemTitle",""],[1,"error"]],template:function(i,n){if(1&i&&(e.I0R(0,"h1",0),e.OEk(1),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"div",1)(4,"form",2)(5,"div",3)(6,"mat-form-field"),e.wR5(7,"input",4),e.wVc(8,"translate"),e.I0R(9,"mat-autocomplete",5,6),e.qCj("optionSelected",function(v){return n.changeUrlOrTitle(v.option.value)}),e.yuY(11,Ld,2,3,"mat-option",7),e.wVc(12,"async"),e.C$Y()()(),e.I0R(13,"div",3)(14,"mat-form-field"),e.wR5(15,"input",8),e.I0R(16,"mat-autocomplete",5,9),e.qCj("optionSelected",function(v){return n.changeUrlOrTitle(v.option.value)}),e.yuY(18,Gd,2,3,"mat-option",7),e.wVc(19,"async"),e.C$Y()()(),e.I0R(20,"div",3)(21,"mat-form-field")(22,"mat-select",10),e.yuY(23,$d,3,2,"mat-option",11),e.C$Y()()()(),e.yuY(24,kd,3,4,"span",12)(25,Ud,3,3,"span",12),e.C$Y(),e.I0R(26,"div",13)(27,"div",14)(28,"button",15),e.qCj("click",function(){return n.cancel()}),e.OEk(29),e.wVc(30,"translate"),e.C$Y(),e.I0R(31,"button",16),e.qCj("click",function(){return n.addCatalog(n.form.value)}),e.OEk(32),e.wVc(33,"translate"),e.C$Y()()()),2&i){const p=e.Gew(10),v=e.Gew(17);e.yG2(),e.oRS(" ",e.kDX(2,13,"igo.geo.catalog.library.addTitle"),"\n"),e.yG2(3),e.E7m("formGroup",n.form),e.yG2(3),e._6D("placeholder",e.kDX(8,15,"igo.geo.printForm.title")),e.E7m("matAutocomplete",p),e.yG2(4),e.E7m("ngForOf",e.kDX(12,17,n.predefinedCatalogsList$)),e.yG2(4),e.E7m("matAutocomplete",v),e.yG2(3),e.E7m("ngForOf",e.kDX(19,19,n.predefinedCatalogsList$)),e.yG2(5),e.E7m("ngForOf",n.typeCapabilities),e.yG2(),e.E7m("ngIf",n.error&&n.addedCatalog&&n.emailAddress),e.yG2(),e.E7m("ngIf",n.error&&n.addedCatalog&&!n.emailAddress),e.yG2(4),e.oRS(" ",e.kDX(30,21,"igo.geo.catalog.library.cancel")," "),e.yG2(2),e.E7m("disabled",!n.form.valid),e.yG2(),e.oRS(" ",e.kDX(33,23,"igo.geo.catalog.library.add")," ")}},dependencies:[bt.WQ,bt.iU,Me.y,Me.sz,Me.ot,Me.ue,Me.u,Me.sl,Me.uW,Me.Wo,ft.wb,ft.Up,Yt.cN,Yt.yi,_o.U1,_o.e,Gt.I5,_o.cG,Xe.Iw,Gt.Ax,st.KO,st.a4,At.d5,At.kX,_t.iI,_t.UV,Xe.u_,bt.Yp,ct.oJ,ct.Gw,Xe.a,it.O0,it.sD],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}.add-catalog-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}.igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center}button[_ngcontent-%COMP%]{cursor:pointer}button#addCatalogBtnDialog[disabled=true][_ngcontent-%COMP%]{cursor:default;background-color:#0000001f;color:#00000042}.error[_ngcontent-%COMP%]{color:red}"]})}return l})();var Ba=s(11772);function Yd(l,m){1&l&&(e.I0R(0,"mat-icon",5),e.qCj("click",function(i){return i.stopPropagation()}),e.wVc(1,"translate"),e.C$Y()),2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.catalog.externalProvider.catalog"))}function Vd(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",6),e.qCj("click",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.removeCatalogFromLibrary(n))}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",7),e.C$Y()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.catalog.library.remove"))}function jd(l,m){1&l&&(e.I0R(0,"button",8),e.wR5(1,"mat-icon",9),e.C$Y())}let Kd=(()=>{class l{catalog;map;catalogRemove=new e._w7;get title(){return(0,Ue.YB)(this.catalog)}removeCatalogFromLibrary(t){t.stopPropagation(),this.catalogRemove.emit()}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-catalog-library-item"]],inputs:{catalog:"catalog",map:"map"},outputs:{catalogRemove:"catalogRemove"},standalone:!0,features:[e.UHJ],decls:7,vars:4,consts:[["matListItemTitle",""],["matListItemMeta",""],["matListItemIcon","","class","igo-external-provider","tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["class","igo-blank","disabled","true","mat-icon-button","",4,"ngIf"],["matListItemIcon","","tooltip-position","below","matTooltipShowDelay","500","color","primary","svgIcon","earth-arrow-right",1,"igo-external-provider",3,"matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["svgIcon","delete"],["disabled","true","mat-icon-button","",1,"igo-blank"],["svgIcon","blank"]],template:function(i,n){1&i&&(e.I0R(0,"mat-list-item")(1,"span",0),e.OEk(2),e.C$Y(),e.I0R(3,"div",1),e.yuY(4,Yd,2,3,"mat-icon",2)(5,Vd,3,3,"button",3)(6,jd,2,0,"button",4),e.C$Y()()),2&i&&(e.yG2(2),e.oRS(" ",n.title," "),e.yG2(2),e.E7m("ngIf",n.catalog.externalProvider),e.yG2(),e.E7m("ngIf",n.catalog.removable),e.yG2(),e.E7m("ngIf",!n.catalog.removable))},dependencies:[_t.iI,_t.g9,_t.Y1,_t.UV,_t.At,Xe.u_,tt.oB,tt.qL,st.KO,st.a4,ct.oJ,ct.um,it.O0,it.sD],styles:[".igo-blank[_ngcontent-%COMP%]{cursor:pointer}.igo-external-provider[_ngcontent-%COMP%]{cursor:help}"],changeDetection:0})}return l})();function Wd(l,m){if(1&l){const t=e.KQA();e.I0R(0,"igo-catalog-library-item",3),e.qCj("catalogRemove",function(){const p=e.usT(t).$implicit,v=e.GaO();return e.CGJ(v.onCatalogRemove(p))})("select",function(){const p=e.usT(t).$implicit,v=e.GaO();return e.CGJ(v.onCatalogSelect(p))}),e.C$Y()}if(2&l){const t=m.$implicit,i=e.GaO();e.E7m("map",i.map)("catalog",t)}}function Nd(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",4)(1,"button",5),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.addCatalogDialog())}),e.wVc(2,"translate"),e.OEk(3),e.wVc(4,"translate"),e.wR5(5,"mat-icon",6),e.C$Y()()}2&l&&(e.yG2(),e.E7m("matTooltip",e.kDX(2,2,"igo.geo.catalog.library.addBtn")),e.yG2(2),e.oRS(" ",e.kDX(4,4,"igo.geo.catalog.library.addBtn")," "))}let Ua=(()=>{class l{capabilitiesService;messageService;storageService;dialog;store;map;addCatalogAllowed=!1;predefinedCatalogs=[];catalogSelectChange=new e._w7;submitDisabled=!0;addingCatalog$$;get addedCatalogs(){return this.storageService.get("addedCatalogs")||[]}set addedCatalogs(t){this.storageService.set("addedCatalogs",t)}constructor(t,i,n,p){this.capabilitiesService=t,this.messageService=i,this.storageService=n,this.dialog=p}ngOnInit(){this.store.state.clear(),this.predefinedCatalogs=this.predefinedCatalogs.map(t=>(t.id=Ba.Cy.hashStr((t.type||"wms")+(0,Pn.iL)(t.url)),t.title=""!==t.title&&t.title?t.title:t.url,t))}getCatalogs(){return this.store.view.all$()}onCatalogSelect(t){this.store.state.update(t,{selected:!0,focused:!0},!0),this.catalogSelectChange.emit({selected:!0,catalog:t})}unsubscribeAddingCatalog(){this.addingCatalog$$&&this.addingCatalog$$.unsubscribe()}addCatalog(t){if(!t)return;let i=Ba.Cy.hashStr(t.type+(0,Pn.iL)(t.url));const n=this.predefinedCatalogs.find(p=>p.id===t.id);n&&(t.version=n.version,t.externalProvider=n.externalProvider,i=n.id),this.store.get(i)?this.messageService.alert("igo.geo.catalog.library.inlist.message","igo.geo.catalog.library.inlist.title"):(this.unsubscribeAddingCatalog(),this.addingCatalog$$=this.capabilitiesService.getCapabilities(t.type,t.url,t.version).pipe((0,ge.a)(p=>{if(p.error)return this.addCatalogDialog(!0,t),p.error.caught=!0,p;throw this.messageService.error("igo.geo.catalog.unavailable","igo.geo.catalog.unavailableTitle",void 0,{value:t.url}),p})).subscribe(p=>{let v,k;switch(t.type){case"wms":v=t.title||p.Service.Title,k=t.version||p.version;break;case"arcgisrest":case"imagearcgisrest":case"tilearcgisrest":v=t.title||p.mapName;break;case"wmts":v=t.title||p.ServiceIdentification.ServiceType;break;default:v=t.title}const de=le.Yv.removeUndefined(Object.assign({},n,le.Yv.removeUndefined({id:i,title:v,url:t.url,type:t.type||"wms",externalProvider:t.externalProvider||!1,removable:!0,version:k})));this.store.insert(de);const he=this.addedCatalogs.slice(0);he.push(de),this.addedCatalogs=he,this.unsubscribeAddingCatalog()}))}ngOnDestroy(){this.unsubscribeAddingCatalog()}onCatalogRemove(t){this.store.delete(t),this.addedCatalogs=this.addedCatalogs.slice(0).filter(i=>i.id!==t.id)}addCatalogDialog(t,i){this.dialog.open(ka,{width:"700px",data:{predefinedCatalogs:this.predefinedCatalogs,store:this.store,error:t,addedCatalog:i}}).afterClosed().subscribe(p=>{this.addCatalog(p)})}static \u0275fac=function(i){return new(i||l)(e.GI1(Go.S),e.GI1(Qt.mi),e.GI1(oe.yQ),e.GI1(bt.qW))};static \u0275cmp=e.In1({type:l,selectors:[["igo-catalog-library"]],inputs:{store:"store",map:"map",addCatalogAllowed:"addCatalogAllowed",predefinedCatalogs:"predefinedCatalogs"},outputs:{catalogSelectChange:"catalogSelectChange"},standalone:!0,features:[e.UHJ],decls:4,vars:5,consts:[[3,"navigation"],["ngFor","",3,"ngForOf"],["class","btnAddCatalog",4,"ngIf"],["igoListItem","","color","accent",3,"map","catalog","catalogRemove","select"],[1,"btnAddCatalog"],["mat-raised-button","","matTooltipPosition","above","color","primary",3,"matTooltip","click"],["svgIcon","earth-plus"]],template:function(i,n){1&i&&(e.I0R(0,"igo-list",0),e.yuY(1,Wd,1,2,"ng-template",1),e.wVc(2,"async"),e.C$Y(),e.yuY(3,Nd,6,6,"div",2)),2&i&&(e.E7m("navigation",!1),e.yG2(),e.E7m("ngForOf",e.kDX(2,3,n.getCatalogs())),e.yG2(2),e.E7m("ngIf",n.addCatalogAllowed))},dependencies:[Ue.yM,Xe.Iw,Kd,Ue.qU,Xe.u_,ct.oJ,ct.Gw,st.KO,st.a4,tt.oB,tt.qL,Xe.a,it.O0,it.sD],styles:["[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .btnAddCatalog[_ngcontent-%COMP%]{justify-content:center;display:flex;margin:30px 0}"],changeDetection:0})}return l})();function Hd(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",3)(1,"mat-button-toggle-group",4),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO();return e.kNx(p.geometryType,n)||(p.geometryType=n),e.CGJ(n)}),e.wVc(2,"async"),e.I0R(3,"mat-button-toggle",5),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.I0R(6,"mat-button-toggle",6),e.OEk(7),e.wVc(8,"translate"),e.C$Y(),e.I0R(9,"mat-button-toggle",7),e.OEk(10),e.wVc(11,"translate"),e.C$Y()()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("disabled",void 0!==e.kDX(2,8,t.value$)),e.OKB("ngModel",t.geometryType),e.yG2(2),e.E7m("disabled",t.geometryTypes.indexOf("Point")<0),e.yG2(),e.oRS(" ",e.kDX(5,10,"igo.geo.geometry.point")," "),e.yG2(2),e.E7m("disabled",t.geometryTypes.indexOf("LineString")<0),e.yG2(),e.oRS(" ",e.kDX(8,12,"igo.geo.geometry.line")," "),e.yG2(2),e.E7m("disabled",t.geometryTypes.indexOf("Polygon")<0),e.yG2(),e.oRS(" ",e.kDX(11,14,"igo.geo.geometry.polygon")," ")}}function zd(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",8)(1,"input",9),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO();return e.kNx(p.drawGuide,n)||(p.drawGuide=n),e.CGJ(n)}),e.C$Y(),e.wR5(2,"mat-icon",10),e.I0R(3,"span",11),e.OEk(4),e.wVc(5,"translate"),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("placeholder",t.drawGuidePlaceholder),e.OKB("ngModel",t.drawGuide),e.yG2(),e.E7m("color","primary"),e.yG2(2),e.cNF(e.kDX(5,4,"igo.geo.measure.meters"))}}s(86464),s(72432);let ms=class xs{cdRef;value$=new A.g(void 0);value$$;set drawControlIsActive(m){this._drawControlIsActive=m,this.cdRef.detectChanges()}get drawControlIsActive(){return this._drawControlIsActive}_drawControlIsActive=!0;set freehandDrawIsActive(m){this._freehandDrawIsActive=m,this.cdRef.detectChanges()}get freehandDrawIsActive(){return this._freehandDrawIsActive}_freehandDrawIsActive=!1;formControl;map;set geometryType(m){this.geometryType$.next(m)}get geometryType(){return this.geometryType$.value}geometryType$=new A.g(void 0);geometryTypeField=!1;geometryTypes=["Point","LineString","Polygon"];drawGuideField=!1;set drawGuide(m){this.drawGuide$.next(m)}get drawGuide(){return this.drawGuide$.value}drawGuide$=new A.g(0);drawGuidePlaceholder="";measure=!1;controlOptions={};drawStyle;overlayStyle;constructor(m){this.cdRef=m}ngOnInit(){this.value$.next(this.formControl.value?this.formControl.value:void 0),this.value$$=this.formControl.valueChanges.subscribe(m=>{this.value$.next(m||void 0)})}ngOnDestroy(){this.value$$.unsubscribe()}static \u0275fac=function(t){return new(t||xs)(e.GI1(e.kD9))};static \u0275cmp=e.In1({type:xs,selectors:[["igo-geometry-form-field"]],inputs:{formControl:"formControl",map:"map",geometryType:"geometryType",geometryTypeField:"geometryTypeField",geometryTypes:"geometryTypes",drawGuideField:"drawGuideField",drawGuide:"drawGuide",drawGuidePlaceholder:"drawGuidePlaceholder",measure:"measure",controlOptions:"controlOptions",drawStyle:"drawStyle",overlayStyle:"overlayStyle"},standalone:!0,features:[e.UHJ],decls:5,vars:16,consts:[[3,"formControl","map","geometryType","drawGuide","measure","drawControlIsActive","freehandDrawIsActive","controlOptions","drawStyle","overlayStyle"],["class","geometry-type-toggle",4,"ngIf"],["class","draw-guide-field",4,"ngIf"],[1,"geometry-type-toggle"],[3,"disabled","ngModel","ngModelChange"],["value","Point",3,"disabled"],["value","LineString",3,"disabled"],["value","Polygon",3,"disabled"],[1,"draw-guide-field"],["matInput","","type","number",3,"placeholder","ngModel","ngModelChange"],["matPrefix","","svgIcon","adjust",3,"color"],["matSuffix","",1,"draw-guide-units"]],template:function(t,i){1&t&&(e.wR5(0,"igo-geometry-form-field-input",0),e.wVc(1,"async"),e.wVc(2,"async"),e.yuY(3,Hd,12,16,"div",1)(4,zd,6,6,"mat-form-field",2)),2&t&&(e.E7m("formControl",i.formControl)("map",i.map)("geometryType",e.kDX(1,12,i.geometryType$))("drawGuide",e.kDX(2,14,i.drawGuide$))("measure",i.measure)("drawControlIsActive",i.drawControlIsActive)("freehandDrawIsActive",i.freehandDrawIsActive)("controlOptions",i.controlOptions)("drawStyle",i.drawStyle)("overlayStyle",i.overlayStyle),e.yG2(3),e.E7m("ngIf",i.geometryTypeField),e.yG2(),e.E7m("ngIf",i.drawGuideField))},dependencies:[Nr,Me.y,Me.ot,Me.O4,Me.ue,Me._G,Me.sl,Me.ug,Xe.u_,ro.ue,ro.gn,ro.KU,ft.wb,ft.Up,ft.is,ft.Gm,Yt.cN,Yt.yi,tt.oB,tt.qL,Xe.a,it.O0,it.sD],styles:["[_nghost-%COMP%]{display:block;width:100%}.geometry-type-toggle[_ngcontent-%COMP%], .draw-guide-field[_ngcontent-%COMP%]{width:100%}.geometry-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.draw-guide-field[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin:0 10px}.draw-guide-units[_ngcontent-%COMP%]{padding:10px}"],changeDetection:0})};ms=(0,B.UN)([(0,Ue.wr)("geometry"),(0,B.YR)("design:paramtypes",[e.kD9])],ms);var Ya=s(48920),Va=(s(60192),s(42860)),ja=s(34419),gs=(s(94440),s(9364)),Ka=(s(55452),s(78416)),Wa=s(65972),Na=s(76332),Ha=(s(87159),s(50056),s(55760),s(72124),s(50208)),za=s(75872);let op=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[za.q,Va.c,ja.e,Na.i,Ya.Q,Wa.I,Ha.w,Ka.a]})}return l})();s(79280);var ip=s(9588),io=s(47580);const np=l=>({column:l,value:130});function rp(l,m){1&l&&(e.I0R(0,"mat-error"),e.OEk(1),e.wVc(2,"translate"),e.wVc(3,"translate"),e.C$Y()),2&l&&(e.yG2(),e.cNF(e.g7$(2,1,"igo.geo.formValidation.maxLength",e.S45(6,np,e.kDX(3,4,"igo.geo.printForm.title")))))}const sp=l=>({column:l,value:120});function ap(l,m){1&l&&(e.I0R(0,"mat-error"),e.OEk(1),e.wVc(2,"translate"),e.wVc(3,"translate"),e.C$Y()),2&l&&(e.yG2(),e.cNF(e.g7$(2,1,"igo.geo.formValidation.maxLength",e.S45(6,sp,e.kDX(3,4,"igo.geo.printForm.subtitle")))))}const lp=(l,m)=>({column:l,value:m});function cp(l,m){if(1&l&&(e.I0R(0,"mat-error"),e.OEk(1),e.wVc(2,"translate"),e.wVc(3,"translate"),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.cNF(e.g7$(2,1,"igo.geo.formValidation.maxLength",e.IBC(6,lp,e.kDX(3,4,"igo.geo.printForm.comment"),t.maxLength)))}}function up(l,m){if(1&l&&(e.SAx(0),e.OEk(1),e.wVc(2,"translate"),e.k70()),2&l){const t=e.GaO().$implicit;e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.printForm.legendPositions."+t.value)," ")}}function dp(l,m){if(1&l&&(e.SAx(0),e.OEk(1),e.wVc(2,"translate"),e.k70()),2&l){const t=e.GaO(2);e.yG2(),e.oRS(" ",e.kDX(2,1,"Pdf"===t.outputFormat?"igo.geo.printForm.legendPositions.newpage":"igo.geo.printForm.legendPositions.newimage")," ")}}const Xa=()=>["newpage","newimage"];function pp(l,m){if(1&l&&(e.I0R(0,"mat-option",20),e.yuY(1,up,3,3,"ng-container",3)(2,dp,3,3,"ng-container",3),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.key),e.yG2(),e.E7m("ngIf",!e.q4q(3,Xa).includes(t.value)),e.yG2(),e.E7m("ngIf",e.q4q(4,Xa).includes(t.value))}}function mp(l,m){if(1&l&&(e.I0R(0,"mat-option",20),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",t.value," ")}}function gp(l,m){if(1&l&&(e.I0R(0,"mat-option",20),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.printForm.paperFormats."+t.value)," ")}}function hp(l,m){if(1&l&&(e.I0R(0,"mat-option",20),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",t.value," ")}}function fp(l,m){if(1&l&&(e.I0R(0,"mat-option",20),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t," ")}}function yp(l,m){if(1&l&&(e.I0R(0,"mat-option",20),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.printForm."+t.value)," ")}}let _p=(()=>{class l{formBuilder;mediaService;form;outputFormats=io.wf;paperFormats=io.QH;orientations=io.qp;resolutions=[...io.wR];imageFormats=io.mw;legendPositions=io.ID;isPrintService=!0;disabled$;get imageFormat(){return this.imageFormatField.value}set imageFormat(t){this.imageFormatField.setValue(t||io.mw.Jpeg,{onlySelf:!0})}get outputFormat(){return this.outputFormatField.value}set outputFormat(t){this.outputFormatField.setValue(t||io.wf.Pdf,{onlySelf:!0})}get paperFormat(){return this.paperFormatField.value}set paperFormat(t){this.paperFormatField.setValue(t||io.QH.Letter,{onlySelf:!0})}get orientation(){return this.orientationField.value}set orientation(t){this.orientationField.setValue(t||io.qp.landscape,{onlySelf:!0})}get resolution(){return this.resolutionField.value}set resolution(t){this.resolutionField.setValue(t||"96",{onlySelf:!0})}get legendPosition(){return this.legendPositionField.value}set legendPosition(t){this.legendPositionField.setValue(t||io.ID.none,{onlySelf:!0})}get title(){return this.titleField.value}set title(t){this.titleField.setValue(t,{onlySelf:!0})}get subtitle(){return this.subtitleField.value}set subtitle(t){this.subtitleField.setValue(t,{onlySelf:!0})}get comment(){return this.commentField.value}set comment(t){this.commentField.setValue(t,{onlySelf:!0})}get showProjection(){return this.showProjectionField.value}set showProjection(t){this.showProjectionField.setValue(t,{onlySelf:!0})}get showScale(){return this.showScaleField.value}set showScale(t){this.showScaleField.setValue(t,{onlySelf:!0})}get showLegend(){return this.showLegendField.value}set showLegend(t){this.showLegendField.setValue(t,{onlySelf:!0})}get doZipFile(){return this.doZipFileField.value}set doZipFile(t){this.doZipFileField.setValue(t,{onlySelf:!0})}get outputFormatField(){return this.form.controls.outputFormat}get paperFormatField(){return this.form.controls.paperFormat}get imageFormatField(){return this.form.controls.imageFormat}get orientationField(){return this.form.controls.orientation}get resolutionField(){return this.form.controls.resolution}get commentField(){return this.form.controls.comment}get showProjectionField(){return this.form.controls.showProjection}get showScaleField(){return this.form.controls.showScale}get showLegendField(){return this.form.controls.showLegend}get doZipFileField(){return this.form.controls.doZipFile}get titleField(){return this.form.controls.title}get subtitleField(){return this.form.controls.subtitle}get legendPositionField(){return this.form.controls.legendPosition}submit=new e._w7;maxLength=180;constructor(t,i){this.formBuilder=t,this.mediaService=i,this.form=this.formBuilder.group({title:["",[Me.AQ.minLength(0),Me.AQ.maxLength(130)]],subtitle:["",[Me.AQ.minLength(0),Me.AQ.maxLength(120)]],comment:["",[Me.AQ.minLength(0),Me.AQ.maxLength(this.maxLength)]],outputFormat:["",[Me.AQ.required]],paperFormat:["",[Me.AQ.required]],imageFormat:["",[Me.AQ.required]],resolution:["",[Me.AQ.required]],orientation:["",[Me.AQ.required]],legendPosition:["",[Me.AQ.required]],showProjection:!1,showScale:!1,showLegend:!1,doZipFile:[{hidden:this.isPrintService}]})}ngOnInit(){this.doZipFileField.setValue(!1),this.mediaService.isMobile()&&(this.resolutions=this.resolutions.filter(t=>"300"!==t))}handleFormSubmit(t,i){t.isPrintService=this.isPrintService,i&&this.submit.emit(t)}toggleImageSaveProp(){"Image"===this.outputFormatField.value?(this.isPrintService=!1,this.commentField.clearValidators(),this.commentField.updateValueAndValidity()):this.isPrintService=!0}changeCommentLength(){switch(this.paperFormat){case io.QH.A0:this.maxLength=this.orientation===io.qp.landscape?900:600;break;case io.QH.A1:this.maxLength=this.orientation===io.qp.landscape?600:400;break;case io.QH.A2:this.maxLength=this.orientation===io.qp.landscape?400:300;break;case io.QH.A3:this.maxLength=this.orientation===io.qp.landscape?300:200;break;case io.QH.A4:this.maxLength=this.orientation===io.qp.landscape?200:100;break;case io.QH.A5:this.maxLength=this.orientation===io.qp.landscape?120:80;break;case io.QH.Letter:this.maxLength=this.orientation===io.qp.landscape?180:140;break;default:this.maxLength=this.orientation===io.qp.landscape?200:140}this.commentField.setValidators([Me.AQ.maxLength(this.maxLength)]),this.commentField.updateValueAndValidity()}static \u0275fac=function(i){return new(i||l)(e.GI1(Me.KE),e.GI1(ip.QB))};static \u0275cmp=e.In1({type:l,selectors:[["igo-print-form"]],inputs:{disabled$:"disabled$",imageFormat:"imageFormat",outputFormat:"outputFormat",paperFormat:"paperFormat",orientation:"orientation",resolution:"resolution",legendPosition:"legendPosition",title:"title",subtitle:"subtitle",comment:"comment",showProjection:"showProjection",showScale:"showScale",showLegend:"showLegend",doZipFile:"doZipFile"},outputs:{submit:"submit"},standalone:!0,features:[e.UHJ],decls:95,vars:103,consts:[[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],["matInput","","formControlName","title",3,"placeholder"],[4,"ngIf"],["matInput","","formControlName","subtitle",3,"placeholder"],["matInput","","formControlName","comment",3,"placeholder"],[1,"igo-input-container","slide-toggle-container"],[1,"print-slide-toggle-container"],["formControlName","showProjection",1,"print-option",3,"labelPosition"],["formControlName","showScale",1,"print-option",3,"labelPosition"],["formControlName","doZipFile",1,"print-option",3,"labelPosition"],["formControlName","legendPosition",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["formControlName","outputFormat",3,"placeholder","selectionChange"],["formControlName","paperFormat",3,"placeholder","selectionChange"],["formControlName","imageFormat",3,"placeholder"],["formControlName","resolution",3,"placeholder"],["formControlName","orientation",3,"placeholder","selectionChange"],[1,"igo-form-button-group","print-button-top-padding"],["mat-raised-button","","type","button",3,"disabled","click"],[3,"value"]],template:function(i,n){1&i&&(e.I0R(0,"form",0)(1,"div",1)(2,"mat-form-field")(3,"mat-label"),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.wR5(6,"input",2),e.wVc(7,"translate"),e.yuY(8,rp,4,8,"mat-error",3),e.C$Y()(),e.I0R(9,"div",1)(10,"mat-form-field")(11,"mat-label"),e.OEk(12),e.wVc(13,"translate"),e.C$Y(),e.wR5(14,"input",4),e.wVc(15,"translate"),e.yuY(16,ap,4,8,"mat-error",3),e.C$Y()(),e.I0R(17,"div",1)(18,"mat-form-field")(19,"mat-label"),e.OEk(20),e.wVc(21,"translate"),e.C$Y(),e.wR5(22,"input",5),e.wVc(23,"translate"),e.yuY(24,cp,4,9,"mat-error",3),e.C$Y()(),e.I0R(25,"div",6)(26,"div",7)(27,"mat-slide-toggle",8),e.OEk(28),e.wVc(29,"translate"),e.C$Y(),e.I0R(30,"mat-slide-toggle",9),e.OEk(31),e.wVc(32,"translate"),e.C$Y(),e.I0R(33,"mat-slide-toggle",10),e.OEk(34),e.wVc(35,"translate"),e.C$Y()()(),e.I0R(36,"div",1)(37,"mat-form-field")(38,"mat-label"),e.OEk(39),e.wVc(40,"translate"),e.C$Y(),e.I0R(41,"mat-select",11),e.wVc(42,"translate"),e.yuY(43,pp,3,5,"mat-option",12),e.wVc(44,"keyvalue"),e.C$Y()()(),e.I0R(45,"div",1)(46,"mat-form-field")(47,"mat-label"),e.OEk(48),e.wVc(49,"translate"),e.C$Y(),e.I0R(50,"mat-select",13),e.qCj("selectionChange",function(){return n.toggleImageSaveProp()}),e.wVc(51,"translate"),e.yuY(52,mp,2,2,"mat-option",12),e.wVc(53,"keyvalue"),e.C$Y()()(),e.I0R(54,"div",1)(55,"mat-form-field")(56,"mat-label"),e.OEk(57),e.wVc(58,"translate"),e.C$Y(),e.I0R(59,"mat-select",14),e.qCj("selectionChange",function(){return n.changeCommentLength()}),e.wVc(60,"translate"),e.yuY(61,gp,3,4,"mat-option",12),e.wVc(62,"keyvalue"),e.C$Y()()(),e.I0R(63,"div",1)(64,"mat-form-field")(65,"mat-label"),e.OEk(66),e.wVc(67,"translate"),e.C$Y(),e.I0R(68,"mat-select",15),e.wVc(69,"translate"),e.yuY(70,hp,2,2,"mat-option",12),e.wVc(71,"keyvalue"),e.C$Y()()(),e.I0R(72,"div",1)(73,"mat-form-field")(74,"mat-label"),e.OEk(75),e.wVc(76,"translate"),e.wVc(77,"translate"),e.C$Y(),e.I0R(78,"mat-select",16),e.wVc(79,"translate"),e.yuY(80,fp,2,2,"mat-option",12),e.C$Y()()(),e.I0R(81,"div",1)(82,"mat-form-field")(83,"mat-label"),e.OEk(84),e.wVc(85,"translate"),e.C$Y(),e.I0R(86,"mat-select",17),e.qCj("selectionChange",function(){return n.changeCommentLength()}),e.wVc(87,"translate"),e.yuY(88,yp,3,4,"mat-option",12),e.wVc(89,"keyvalue"),e.C$Y()()(),e.I0R(90,"div",18)(91,"button",19),e.qCj("click",function(){return n.handleFormSubmit(n.form.value,n.form.valid)}),e.wVc(92,"async"),e.OEk(93),e.wVc(94,"translate"),e.C$Y()()()),2&i&&(e.E7m("formGroup",n.form),e.yG2(4),e.cNF(e.kDX(5,45,"igo.geo.printForm.title")),e.yG2(2),e._6D("placeholder",e.kDX(7,47,"igo.geo.printForm.title")),e.yG2(2),e.E7m("ngIf",null==n.titleField.errors?null:n.titleField.errors.maxlength),e.yG2(4),e.cNF(e.kDX(13,49,"igo.geo.printForm.subtitle")),e.yG2(2),e._6D("placeholder",e.kDX(15,51,"igo.geo.printForm.subtitle")),e.yG2(2),e.E7m("ngIf",null==n.subtitleField.errors?null:n.subtitleField.errors.maxlength),e.yG2(4),e.cNF(e.kDX(21,53,"igo.geo.printForm.comment")),e.yG2(2),e._6D("placeholder",e.kDX(23,55,"igo.geo.printForm.comment")),e.yG2(2),e.E7m("ngIf",null==n.commentField.errors?null:n.commentField.errors.maxlength),e.yG2(3),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(29,57,"igo.geo.printForm.showProjection")," "),e.yG2(2),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(32,59,"igo.geo.printForm.showScale")," "),e.yG2(2),e.m4B("display",n.isPrintService?"none":""),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(35,61,"igo.geo.printForm.doZipFile")," "),e.yG2(5),e.cNF(e.kDX(40,63,"igo.geo.printForm.legendPosition")),e.yG2(2),e._6D("placeholder",e.kDX(42,65,"igo.geo.printForm.legendPosition")),e.yG2(2),e.E7m("ngForOf",e.kDX(44,67,n.legendPositions)),e.yG2(5),e.cNF(e.kDX(49,69,"igo.geo.printForm.outputFormat")),e.yG2(2),e._6D("placeholder",e.kDX(51,71,"igo.geo.printForm.outputFormat")),e.yG2(2),e.E7m("ngForOf",e.kDX(53,73,n.outputFormats)),e.yG2(2),e.m4B("display",n.isPrintService?"block":"none"),e.yG2(3),e.cNF(e.kDX(58,75,"igo.geo.printForm.paperFormat")),e.yG2(2),e._6D("placeholder",e.kDX(60,77,"igo.geo.printForm.paperFormat")),e.yG2(2),e.E7m("ngForOf",e.kDX(62,79,n.paperFormats)),e.yG2(2),e.m4B("display",n.isPrintService?"none":"block"),e.yG2(3),e.cNF(e.kDX(67,81,"igo.geo.printForm.imageFormat")),e.yG2(2),e._6D("placeholder",e.kDX(69,83,"igo.geo.printForm.imageFormat")),e.yG2(2),e.E7m("ngForOf",e.kDX(71,85,n.imageFormats)),e.yG2(5),e.CAO("",e.kDX(76,87,"igo.geo.printForm.resolution")," (",e.kDX(77,89,"igo.geo.printForm.resolutionUnit"),")"),e.yG2(3),e._6D("placeholder",e.kDX(79,91,"igo.geo.printForm.resolution")),e.yG2(2),e.E7m("ngForOf",n.resolutions),e.yG2(),e.m4B("display",n.isPrintService?"block":"none"),e.yG2(3),e.cNF(e.kDX(85,93,"igo.geo.printForm.orientation")),e.yG2(2),e._6D("placeholder",e.kDX(87,95,"igo.geo.printForm.orientation")),e.yG2(2),e.E7m("ngForOf",e.kDX(89,97,n.orientations)),e.yG2(3),e.E7m("disabled",!n.form.valid||e.kDX(92,99,n.disabled$)),e.yG2(2),e.oRS(" ",e.kDX(94,101,"igo.geo.printForm.saveBtn")," "))},dependencies:[Me.y,Me.sz,Me.ot,Me.ue,Me.u,Me.sl,Me.uW,Me.Wo,ft.wb,ft.Up,ft.w5,ft.wJ,Yt.cN,Yt.yi,Xe.u_,Co.GE,Co.cP,At.d5,At.kX,Gt.I5,Xe.Iw,Gt.Ax,ct.oJ,ct.Gw,Xe.a,Xe.uq,it.O0,it.sD],styles:["[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .slide-toggle-container[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:0 8px}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .print-option[_ngcontent-%COMP%]{display:block;margin-bottom:12px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center}"]})}return l})();var Er=s(37496),Cp=s(29272);let vp=(()=>{class l{printService;disabled$=new A.g(!1);get map(){return this._map}set map(t){this._map=t}_map;get outputFormat(){return this._outputFormat}set outputFormat(t){this._outputFormat=t}_outputFormat;get paperFormat(){return this._paperFormat}set paperFormat(t){this._paperFormat=t}_paperFormat;get orientation(){return this._orientation}set orientation(t){this._orientation=t}_orientation;get imageFormat(){return this._imageFormat}set imageFormat(t){this._imageFormat=t}_imageFormat;get legendPosition(){return this._legendPosition}set legendPosition(t){this._legendPosition=t}_legendPosition;get resolution(){return this._resolution}set resolution(t){this._resolution=t}_resolution;constructor(t){this.printService=t}handleFormSubmit(t){if(this.disabled$.next(!0),!0===t.isPrintService)this.printService.print(this.map,t).pipe((0,Er.U)(1)).subscribe(()=>{this.disabled$.next(!1)});else{let i=1;t.showLegend&&i++,"tiff"===t.imageFormat.toLowerCase()&&i++,"newpage"===t.legendPosition&&i++,this.printService.defineNbFileToProcess(i),this.printService.downloadMapImage(this.map,t.resolution,t.imageFormat,t.showProjection,t.showScale,t.title,t.subtitle,t.comment,t.doZipFile,t.legendPosition).pipe((0,Er.U)(1)).subscribe(()=>{this.disabled$.next(!1)})}}static \u0275fac=function(i){return new(i||l)(e.GI1(Cp.K))};static \u0275cmp=e.In1({type:l,selectors:[["igo-print"]],inputs:{map:"map",outputFormat:"outputFormat",paperFormat:"paperFormat",orientation:"orientation",imageFormat:"imageFormat",legendPosition:"legendPosition",resolution:"resolution"},standalone:!0,features:[e.UHJ],decls:1,vars:7,consts:[[3,"outputFormat","paperFormat","orientation","imageFormat","resolution","legendPosition","disabled$","submit"]],template:function(i,n){1&i&&(e.I0R(0,"igo-print-form",0),e.qCj("submit",function(v){return n.handleFormSubmit(v)}),e.C$Y()),2&i&&e.E7m("outputFormat",n.outputFormat)("paperFormat",n.paperFormat)("orientation",n.orientation)("imageFormat",n.imageFormat)("resolution",n.resolution)("legendPosition",n.legendPosition)("disabled$",n.disabled$)},dependencies:[_p],encapsulation:2})}return l})();s(43940);var xr=s(72156),Ja=s(9452),Qa=s(96580);class qi extends Qa.U{http;config;get enabled(){return!1!==this.options.enabled}set enabled(m){this.options.enabled=m}static _name="OSRM Qu\xe9bec";directionsUrl="https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/";options;constructor(m,t){super(),this.http=m,this.config=t,this.options=this.config.getConfig("directionsSources.osrm")||{},this.directionsUrl=this.options.url||this.directionsUrl}getName(){return qi._name}route(m,t={}){const i=this.getRouteParams(t);return this.getRoute(m,i)}getRoute(m,t){return this.http.get(this.directionsUrl+m.join(";"),{params:t}).pipe((0,se.k)(i=>this.extractRoutesData(i)))}extractRoutesData(m){const t=[];return m.routes.forEach(i=>{t.push(this.formatRoute(i,m.waypoints))}),t}getRouteParams(m={}){return m.alternatives=void 0===m.alternatives||m.alternatives,m.steps=void 0===m.steps||m.steps,m.geometries=void 0!==m.geometries?m.geometries:"geojson",m.overview=void 0!==m.overview&&m.overview,m.continue_straight=void 0!==m.continue_straight&&m.continue_straight,new ae.i4({fromObject:{alternatives:m.alternatives?"true":"false",overview:m.overview?"simplified":"full",steps:m.steps?"true":"false",geometries:m.geometries?m.geometries:"geojson",continue_straight:m.continue_straight?"true":"false"}})}formatRoute(m,t){const i=[];return m.legs.forEach(n=>{n.steps.forEach(p=>{i.push(p)})}),{id:(0,le.uq)(),title:m.legs[0].summary,source:qi._name,sourceType:Ja.g1.Route,order:1,format:Ja.Yn.GeoJSON,icon:"directions",projection:"EPSG:4326",waypoints:t,distance:m.distance,duration:m.duration,geometry:m.geometry,legs:m.legs,steps:i,weight:m.weight,weight_name:m.weight_name}}static \u0275fac=function(t){return new(t||qi)(e.CoB(ae.KK),e.CoB(M.aW))};static \u0275prov=e.wxM({token:qi,factory:qi.\u0275fac})}function Sp(l,m){return new qi(l,m)}function bp(){return{provide:Qa.U,useFactory:Sp,multi:!0,deps:[ae.KK,M.aW]}}(0,B.UN)([(0,u.w)({maxCacheCount:20,cacheHasher:le.EB}),(0,B.YR)("design:type",Function),(0,B.YR)("design:paramtypes",[Array,ae.i4]),(0,B.YR)("design:returntype",_._)],qi.prototype,"getRoute",null);var wp=s(41912);s(10211);var Mr=s(35876);let Za=(()=>{class l{mapService;component;layersOrResolutionChange$$;layersVisibility$$;constructor(t,i){this.mapService=i,this.component=t}ngOnInit(){this.component.layers=[],this.layersOrResolutionChange$$=(0,Mr.E)([this.mapService.getMap().layers$,this.mapService.getMap().viewController.resolution$]).pipe((0,vo.o)(10)).subscribe(t=>{const i=t[0].filter(n=>!0===n.showInLayerList);this.component.layers=i,this.layersVisibility$$=(0,Mr.E)(i.map(n=>n.visible$)).subscribe(n=>{this.component.change$.next()})})}ngOnDestroy(){this.layersOrResolutionChange$$.unsubscribe(),void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0)}static \u0275fac=function(i){return new(i||l)(e.GI1(rs,2),e.GI1(zn.u))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoLayerLegendListBinding",""]],standalone:!0})}return l})();var Ip=s(84112);let qa=(()=>{class l{mapService;route;component;layersOrResolutionChange$$;layersVisibility$$;constructor(t,i,n){this.mapService=i,this.route=n,this.component=t}ngOnInit(){this.layersOrResolutionChange$$=(0,Mr.E)([this.mapService.getMap().layers$,this.mapService.getMap().viewController.resolution$]).pipe((0,vo.o)(10)).subscribe(t=>{const i=t[0].filter(n=>!0===n.showInLayerList);this.component.layers=i,this.setLayersVisibilityStatus(i,this.component.excludeBaseLayers)})}setLayersVisibilityStatus(t,i){void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0),this.layersVisibility$$=(0,Mr.E)(t.filter(n=>n.baseLayer!==i).map(n=>n.visible$)).pipe((0,se.k)(n=>n.every(Boolean))).subscribe(n=>this.component.layersAreAllVisible=n)}ngOnDestroy(){this.layersOrResolutionChange$$.unsubscribe(),void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0)}static \u0275fac=function(i){return new(i||l)(e.GI1(ls,2),e.GI1(zn.u),e.GI1(Ip.k$,8))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoLayerListBinding",""]],standalone:!0})}return l})();s(29632),s(48004),s(84052),s(96659),s(31112),s(97104),s(39532),s(36404);var hs=function(l){return l[l.None=0]="None",l[l.Move=1]="Move",l[l.Zoom=2]="Zoom",l[l.ZoomIfOutMapExtent=3]="ZoomIfOutMapExtent",l}(hs||{});let Ep=(()=>{class l{features$=new A.g([[],void 0]);constructor(){}setFeatures(t,i=hs.None){this.features$.next([t,i])}clear(){this.features$.next([[],hs.None])}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),xp=(()=>{class l{component;overlayService;features$$;format=new X.c;get map(){return this.component.map}constructor(t,i){this.component=t,this.overlayService=i}ngOnInit(){this.features$$=this.overlayService.features$.subscribe(t=>this.handleFeatures(t[0],t[1]))}ngOnDestroy(){this.features$$.unsubscribe()}handleFeatures(t,i){}static \u0275fac=function(i){return new(i||l)(e.GI1(gs.q,2),e.GI1(Ep))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoOverlay",""]],standalone:!0})}return l})();s(25607),s(87048);s(29220);s(71320);class Fn extends E.i{http;languageService;static id="cadastre";static type=S.Y;constructor(m,t,i,n){super(n,i),this.http=m,this.languageService=t}getId(){return Fn.id}getType(){return Fn.type}getDefaultOptions(){return{title:"Cadastre (Qu\xe9bec)",searchUrl:"https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?"}}search(m,t){m=(m=(m=(m=m.replace(/ /g,"")).replace(/,+/g,",")).endsWith(",")?m.slice(0,-1):m).startsWith(",")?m.substr(1):m;const i=this.computeSearchRequestParams(m,t||{});return i.get("numero")&&i.get("numero").match(/^[0-9,]+$/g)?this.getCadastre(m,i):(0,q.of)([])}getCadastre(m,t){return this.http.get(this.searchUrl,{params:t,responseType:"text"}).pipe((0,se.k)(i=>this.extractResults(i,m)))}computeSearchRequestParams(m,t){return new ae.i4({fromObject:Object.assign({numero:m,epsg:"4326"},this.params,t.params||{})})}extractResults(m,t){return m.split("<br />").filter(i=>i.length>0).map(i=>this.dataToResult(i,t))}dataToResult(m,t){const i=m.split(";"),n=i[0],v=this.computeGeometry(i[7]),k={NoLot:n,Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"},de=[this.getId(),"cadastre",n].join(".");return{source:this,meta:{dataType:S.Y,id:de,title:n,score:(0,Ie.Un)(t.trim(),n),icon:"map-marker"},data:{type:S.Y,projection:"EPSG:4326",geometry:v,properties:k,meta:{id:de,title:n}}}}computeGeometry(m){const t=(new Io.c).readFeature(m,{dataProjection:"EPSG:4326",featureProjection:"EPSG:4326"});return{type:t.getGeometry().getType(),coordinates:t.getGeometry().getCoordinates()}}static \u0275fac=function(t){return new(t||Fn)(e.CoB(ae.KK),e.CoB(L.ov),e.CoB(oe.yQ),e.CoB("options"))};static \u0275prov=e.wxM({token:Fn,factory:Fn.\u0275fac})}(0,B.UN)([(0,u.w)({maxCacheCount:20,cacheHasher:le.EB}),(0,B.YR)("design:type",Function),(0,B.YR)("design:paramtypes",[String,ae.i4]),(0,B.YR)("design:returntype",_._)],Fn.prototype,"getCadastre",null);class Rn extends E.i{http;static id="nominatim";static type=S.Y;constructor(m,t,i){super(t,i),this.http=m}getId(){return Rn.id}getType(){return Rn.type}getDefaultOptions(){return{title:"Nominatim (OSM)",searchUrl:"https://nominatim.openstreetmap.org/search",settings:[{type:"checkbox",title:"results type",name:"amenity",values:[{title:"igo.geo.search.nominatim.type.food",value:"bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant",enabled:!1},{title:"igo.geo.search.nominatim.type.health",value:"baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary",enabled:!1},{title:"igo.geo.search.nominatim.type.entertainment",value:"arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium                           ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe",enabled:!1},{title:"igo.geo.search.nominatim.type.finance",value:"atm,bank,bureau_de_change",enabled:!1}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"10",value:10,enabled:!0},{title:"20",value:20,enabled:!1},{title:"50",value:50,enabled:!1}]},{type:"radiobutton",title:"restrictExtent",name:"countrycodes",values:[{title:"igo.geo.search.nominatim.country.canada",value:"CA",enabled:!0},{title:"igo.geo.search.nominatim.country.all",value:null,enabled:!1}]},{type:"radiobutton",title:"multiple object",name:"dedupe",values:[{title:"igo.geo.search.searchSources.settings.true",value:0,enabled:!1},{title:"igo.geo.search.searchSources.settings.false",value:1,enabled:!0}]}]}}search(m,t){const i=this.computeSearchRequestParams(m,t||{});return i.get("q")?this.getSearch(m,i):(0,q.of)([])}getSearch(m,t){return this.http.get(this.searchUrl,{params:t}).pipe((0,se.k)(i=>this.extractResults(i,m)))}computeSearchRequestParams(m,t){return new ae.i4({fromObject:Object.assign({q:this.computeTerm(m),format:"json"},this.params,t.params||{})})}extractResults(m,t){return m.map(i=>this.dataToResult(i,t))}dataToResult(m,t){const i=this.computeProperties(m),n=this.computeGeometry(m),p=this.computeExtent(m),v=[this.getId(),"place",m.place_id].join(".");return{source:this,meta:{dataType:S.Y,id:v,title:m.display_name,icon:"map-marker",score:(0,Ie.Un)(t.trim(),m.display_name)},data:{type:S.Y,projection:"EPSG:4326",geometry:n,extent:p,properties:i,meta:{id:v,title:m.display_name}}}}computeProperties(m){return{display_name:m.display_name,place_id:m.place_id,osm_type:m.osm_type,class:m.class,type:m.type}}computeGeometry(m){return{type:"Point",coordinates:[parseFloat(m.lon),parseFloat(m.lat)]}}computeExtent(m){return[parseFloat(m.boundingbox[2]),parseFloat(m.boundingbox[0]),parseFloat(m.boundingbox[3]),parseFloat(m.boundingbox[1])]}computeTerm(m){return this.computeTermTags(m)}computeTermTags(m){const t=super.getHashtagsValid(m,"amenity");return t?t.length?(m=m.replace(/(#[^\s]*)/g,""),t.forEach(i=>{m+="+["+i+"]"}),m):null:this.computeTermSettings(m)}computeTermSettings(m){return this.options.settings.forEach(t=>{"amenity"===t.name&&t.values.forEach(i=>{i.enabled&&"string"==typeof i.value&&i.value.split(",").forEach(p=>{m+="+["+p+"]"})})}),m}static \u0275fac=function(t){return new(t||Rn)(e.CoB(ae.KK),e.CoB("options"),e.CoB(oe.yQ))};static \u0275prov=e.wxM({token:Rn,factory:Rn.\u0275fac})}(0,B.UN)([(0,u.w)({maxCacheCount:20,cacheHasher:le.EB}),(0,B.YR)("design:type",Function),(0,B.YR)("design:paramtypes",[String,ae.i4]),(0,B.YR)("design:returntype",_._)],Rn.prototype,"getSearch",null);var el=s(11544);class en extends E.i{http;languageService;static id="storedqueries";static type=S.Y;static propertiesBlacklist=["boundedBy","id","coord_x","coord_y"];resultTitle;storedQueriesOptions;multipleFieldsQuery;constructor(m,t,i,n){if(super(n,i),this.http=m,this.languageService=t,this.storedQueriesOptions=n,!this.storedQueriesOptions||this.storedQueriesOptions.available){if(this.storedQueriesOptions||(console.log(" No configuration for this search source (storedqueries). You will use the default values"),this.storedQueriesOptions={storedquery_id:"rtss",fields:[{name:"rtss",defaultValue:"-99"},{name:"chainage",defaultValue:"0",splitPrefix:"\\+"}],outputformat:"text/xml; subtype=gml/3.1.1",srsname:"EPSG:4326",resultTitle:"title"},this.resultTitle="title",console.log("Default values",this.storedQueriesOptions)),!this.storedQueriesOptions.storedquery_id)throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"');if(!this.storedQueriesOptions.fields)throw new Error('Stored Queries :You have to set "fields" into options. ex: fields: {"name": "rtss", "defaultValue": "-99"}');if(this.storedQueriesOptions.outputformat=this.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",this.storedQueriesOptions.srsname=this.storedQueriesOptions.srsname||"EPSG:4326",this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")&&this.storedQueriesOptions.outputformat.toLowerCase().includes("getfeaturebyid")){let be="You must set a geojson format for your stored query. This is due to an openlayers issue)";throw be+=" (wfs 1.1.0 & gml 3.1.1 limitation)",new Error(be)}this.storedQueriesOptions.fields instanceof Array||(this.storedQueriesOptions.fields=[this.storedQueriesOptions.fields]),this.multipleFieldsQuery=this.storedQueriesOptions.fields.length>1,this.storedQueriesOptions.fields.forEach((be,Pe)=>{if(this.multipleFieldsQuery&&!be.splitPrefix&&0!==Pe)throw new Error("Stored Queries :You must set a field spliter into your field definition (optional for the first one!)");if(!be.defaultValue)throw new Error("Stored Queries :You must set a field default value into your field definition")}),this.storedQueriesOptions.resultTitle=this.storedQueriesOptions.resultTitle||this.resultTitle}}getId(){return en.id}getType(){return en.type}getDefaultOptions(){return{title:"Stored Queries",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}}search(m,t){const i=this.termSplitter(m,this.storedQueriesOptions.fields),n=this.computeRequestParams(t||{},i);return this.options.params=this.options.params?this.options.params:{},this.options.params.page=t.page?String(t.page):"1",this.getSearch(m,n)}getSearch(m,t){return new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:t,responseType:"text"}).pipe((0,se.k)(i=>{let n=this.extractResults(this.extractWFSData(i),m);if(n.sort((p,v)=>p.meta.score>v.meta.score||p.meta.score===v.meta.score&&p.meta.titleHtml<v.meta.titleHtml?1:-1),n.reverse(),n.length>Number(this.options.params.limit)){const p=Number(this.options.params.limit)*Number(this.options.params.page),v=n.length;n=n.slice(0,p),n[n.length-1].meta.nextPage=p<v}return n})):this.http.get(this.searchUrl,{params:t}).pipe((0,se.k)(i=>this.extractResults(this.extractWFSData(i),m)))}getFormatFromOptions(){let m;const t=this.storedQueriesOptions.outputformat,i=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(m=X.c),i.test(t)&&(m=el.c),new m}extractWFSData(m){const t=this.getFormatFromOptions(),i=X.c,n=t.readFeatures(m);return JSON.parse((new i).writeFeatures(n))}termSplitter(m,t){const i={};let n=m,p=0;return t.forEach(k=>{i[k.name]=k.defaultValue;const de=new RegExp(k.splitPrefix+"(.+)","i");de.test(n)&&(p=k.splitPrefix?p+=1:p,n=n.split(de)[1])}),0===p?(i[t[0].name]=m,i):(n=m,[...t].reverse().forEach(k=>{const de=new RegExp(k.splitPrefix||"(.+)","i");if(n||""!==n){const he=n.split(de);n=he[0],he[1]&&(i[k.name]=he[1].trim())}}),i)}computeRequestParams(m,t){const i=this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")?"2.0.0":"1.1.0";return new ae.i4({fromObject:Object.assign({service:"wfs",version:i,request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},t,this.params,m.params||{})})}extractResults(m,t){return m.features.map(i=>this.dataToResult(i,t))}dataToResult(m,t){const i=this.computeProperties(m),n=[this.getId(),i.type,m.id].join("."),p=m.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:S.Y,projection:"EPSG:4326",geometry:m.geometry,properties:i,meta:{id:n,title:m.properties[p]}},meta:{dataType:S.Y,id:n,title:m.properties.title,titleHtml:m.properties[p],icon:"map-marker",score:(0,Ie.Un)(t.trim(),m.properties.title?m.properties.title:m.properties[p])}}}computeProperties(m){return Object.assign({},le.Yv.removeKeys(m.properties,en.propertiesBlacklist),{Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"})}static \u0275fac=function(t){return new(t||en)(e.CoB(ae.KK),e.CoB(L.ov),e.CoB(oe.yQ),e.CoB("options"))};static \u0275prov=e.wxM({token:en,factory:en.\u0275fac})}(0,B.UN)([(0,u.w)({maxCacheCount:20,cacheHasher:le.EB}),(0,B.YR)("design:type",Function),(0,B.YR)("design:paramtypes",[String,ae.i4]),(0,B.YR)("design:returntype",_._)],en.prototype,"getSearch",null);class tn extends E.i{http;languageService;static id="storedqueriesreverse";static type=S.Y;static propertiesBlacklist=[];resultTitle;storedQueriesOptions;multipleFieldsQuery;constructor(m,t,i,n){if(super(n,i),this.http=m,this.languageService=t,this.storedQueriesOptions=n,this.storedQueriesOptions&&(!this.storedQueriesOptions||this.storedQueriesOptions.available)){if(!this.storedQueriesOptions.storedquery_id)throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"');if(!this.storedQueriesOptions.longField)throw new Error('Stored Queries :You have to set "longField" to map the longitude coordinate to the query params.');if(!this.storedQueriesOptions.latField)throw new Error('Stored Queries :You have to set "latField" to map the latitude coordinate to the query params.');this.storedQueriesOptions.outputformat=this.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",this.storedQueriesOptions.srsname=this.storedQueriesOptions.srsname||"EPSG:4326",this.storedQueriesOptions.resultTitle=this.storedQueriesOptions.resultTitle||this.resultTitle}}getId(){return tn.id}getType(){return tn.type}getDefaultOptions(){return{title:"Stored Queries (reverse)",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}}reverseSearch(m,t){const i=this.computeRequestParams(m,t||{});return this.getReverseSearch(i)}getReverseSearch(m){return(new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:m,responseType:"text"}):this.http.get(this.searchUrl,{params:m})).pipe((0,se.k)(n=>this.extractResults(this.extractWFSData(n))))}getFormatFromOptions(){let m;const t=this.storedQueriesOptions.outputformat,i=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(m=X.c),i.test(t)&&(m=el.c),new m}extractWFSData(m){const t=this.getFormatFromOptions(),i=X.c,n=t.readFeatures(m);return JSON.parse((new i).writeFeatures(n))}computeRequestParams(m,t){const i={};return i[this.storedQueriesOptions.longField]=m[0],i[this.storedQueriesOptions.latField]=m[1],new ae.i4({fromObject:Object.assign({service:"WFS",version:"1.1.0",request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},i,this.params,t.params||{})})}extractResults(m){return m.features.map(t=>this.dataToResult(t))}dataToResult(m){const t=this.computeProperties(m),i=[this.getId(),t.type,m.id].join("."),n=m.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:S.Y,projection:"EPSG:4326",geometry:m.geometry,properties:t,meta:{id:i,title:m.properties[n]}},meta:{dataType:S.Y,id:i,title:m.properties[n],icon:"map-marker"}}}computeProperties(m){const t=le.Yv.removeKeys(m.properties,tn.propertiesBlacklist),i={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign(t,{type:m.properties.doc_type},i)}static \u0275fac=function(t){return new(t||tn)(e.CoB(ae.KK),e.CoB(L.ov),e.CoB(oe.yQ),e.CoB("options"))};static \u0275prov=e.wxM({token:tn,factory:tn.\u0275fac})}(0,B.UN)([(0,u.w)({maxCacheCount:20,cacheHasher:le.EB}),(0,B.YR)("design:type",Function),(0,B.YR)("design:paramtypes",[ae.i4]),(0,B.YR)("design:returntype",_._)],tn.prototype,"getReverseSearch",null);let tl=(()=>{class l extends E.i{languageService;static id="workspace";static type=S.Y;title$=new A.g("");get title(){return this.title$.getValue()}constructor(t,i,n){super(n,i),this.languageService=t,this.languageService.translate.get(this.options.title).subscribe(p=>this.title$.next(p))}getId(){return l.id}getType(){return l.type}getDefaultOptions(){return{title:"igo.geo.search.workspace.name",searchUrl:void 0,settings:[{type:"checkbox",title:"datasets",name:"datasets",values:[]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:!1},{title:"5",value:5,enabled:!0},{title:"10",value:10,enabled:!1},{title:"25",value:25,enabled:!1},{title:"50",value:50,enabled:!1}]}]}}search(t,i){const p=this.settings.find(be=>"limit"===be.name).values.find(be=>be.enabled).value||5;this.options.params.limit=p.toLocaleString();const v=[];this.options.params.page=(i.page||1).toLocaleString();const k=i.page||1,de=this.options.params.datasets.split(",");this.featureStoresWithIndex.filter(be=>be.searchDocument&&de.includes(be.layer.title)).map(be=>{const Pe=t;be.searchDocument.search(Pe,{limit:k*p}).map(Je=>{const Fe=Je.field;Je.result.map(et=>{const pt=be.index.get(et),Tt=(0,Ie.Un)(Pe.trim(),pt.properties[Fe]);v.push({index:et,feature:pt,layer:be.layer,field:Fe,score:Tt})})})}),v.sort((be,Pe)=>be.score>Pe.score?-1:1);const he=[],Oe=[];return v.map(be=>{he.includes(be.index)||(he.push(be.index),Oe.push(be))}),(0,q.of)(this.extractResults(Oe.sort((be,Pe)=>be.score>Pe.score?-1:1).slice(0,k*p)))}extractResults(t){return t.map(i=>this.dataToResult(i,t.length))}dataToResult(t,i){const n=this.computeProperties(t),p=[this.getId(),n.type,t.index].join("."),v=t.feature.properties[t.field],k="<br><small> "+t.layer.title+"</small>";return{source:this,data:{type:S.Y,projection:"EPSG:4326",geometry:t.feature.geometry,extent:t.feature.extent,properties:n,meta:{id:p,title:t.feature.properties[t.field],alias:this.getAllowedFieldsAndAlias(t.layer)}},meta:{dataType:S.Y,id:p,title:t.feature.meta.title,titleHtml:v+k,icon:"map-marker",score:t.score,nextPage:i%+this.options.params.limit==0&&+this.options.params.page<10}}}getAllowedFieldsAndAlias(t){let i;return t.options?.source?.options?.sourceFields&&t.options.source.options.sourceFields.length>=1&&(i={},t.options.source.options.sourceFields.forEach(n=>{i[n.name]=n.alias?n.alias:n.name})),i}computeProperties(t){if(!t.feature.geometry)return Object.assign({type:t.layer.title+"."+t.field},t.feature.properties);const i={GoogleMaps:""};let n;if("Point"===t.feature.geometry.type)n=I.getGoogleMapsCoordLink(t.feature.geometry.coordinates[0],t.feature.geometry.coordinates[1]);else{const v=(0,ue.c)(t.feature.geometry);n=I.getGoogleMapsCoordLink(v.geometry.coordinates[0],v.geometry.coordinates[1])}i.GoogleMaps="<a href="+n+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByCoord")+"</a>","Point"===t.feature.geometry.type&&(i.GoogleStreetView=I.getGoogleStreetViewLink(t.feature.geometry.coordinates[0],t.feature.geometry.coordinates[1]));const p={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign({type:t.feature.sourceId},t.feature.properties,i,p)}static \u0275fac=function(i){return new(i||l)(e.CoB(L.ov),e.CoB(oe.yQ),e.CoB("options"))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();function Gp(l,m,t){return new tl(l,m,t.getConfig(`searchSources.${tl.id}`))}function $p(){return{provide:E.i,useFactory:Gp,multi:!0,deps:[L.ov,oe.yQ,M.aW]}}s(88824);var ol=s(47572),Ap=s(52756);function Dr({feature:l,markerColor:m=[0,161,222],markerOpacity:t=1,markerOutlineColor:i=[0,255,255],fillColor:n,fillOpacity:p=.15,strokeColor:v=[0,255,255],strokeOpacity:k=.5,strokeWidth:de=4}){return il({feature:l,markerColor:m,markerOpacity:t,markerOutlineColor:i,fillColor:n,fillOpacity:p,strokeColor:v,strokeOpacity:k,strokeWidth:de})}function il({feature:l,markerColor:m=[0,161,222],markerOpacity:t=.5,markerOutlineColor:i,fillColor:n=[0,161,222],fillOpacity:p=.15,strokeColor:v=[0,161,222],strokeOpacity:k=.5,strokeWidth:de=2}){const he=l instanceof Y.c;let Oe,be;he?Oe=l.getGeometry():(Oe=l.geometry,be=l.meta.mapTitle);const Pe=he?Oe.getType():Oe.type;if(Oe&&"Point"!==Pe){const Je=(0,pr.f4)(n).slice(0),Fe=(0,pr.f4)(v).slice(0);return 4===Je.length&&("string"!=typeof n||/^#[0-9A-F]{8}$/i.test(n))||(Je[3]=p),4===Fe.length&&("string"!=typeof v||/^#[0-9A-F]{8}$/i.test(v))||(Fe[3]=k),(0,Ap.B)({text:be,strokeWidth:de,strokeColor:Fe,fillColor:Je})}{const Je=(0,pr.f4)(m).slice(0),Fe=Je.slice(0,3);return 4===Je.length&&("string"!=typeof m||/^#[0-9A-F]{8}$/i.test(m))&&(t=Je[3]),(0,ol.o)({text:be,opacity:t,markerOutlineColor:i,markerColor:Fe})}}let kp=(()=>{class l{config;options;constructor(t){this.config=t,this.options=this.config.getConfig("regex")}getAll(){return this.options}get(t){if(this.options)return this.options[t]}static \u0275fac=function(i){return new(i||l)(e.CoB(M.aW))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),fs=(()=>{class l{regexService;geoServiceRegexes=[];constructor(t){this.regexService=t,this.geoServiceRegexes=this.getGeoServiceRegexes()}getPropertyType(t){return typeof t}isUrl(t){return/^https?:\/\//.test(t.toString())}isGeoService(t){let i=!1;if(this.isUrl){for(const n of this.geoServiceRegexes)if(new RegExp(n.url).test(t)){i=!0;break}return i}}getGeoService(t,i){if(!this.isGeoService(t))return;let n;for(const p of this.geoServiceRegexes)if(new RegExp(p.url).test(t)&&(n=i.filter(de=>p.propertiesForLayerName.includes(de))?p:void 0,n))break;return n}getGeoServiceRegexes(){return this.regexService.get("geoservice")||[]}static \u0275fac=function(i){return new(i||l)(e.CoB(kp))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();class ys extends Ue.ec{options;inResolutionRange$=new A.g(!0);get layer(){return this.options.layer}get map(){return this.options.map}constructor(m){super(m),this.options=m,this.map.viewController.resolution$.subscribe(t=>{this.inResolutionRange$.next(t>this.layer.minResolution&&t<this.layer.maxResolution)})}getLayerWksOptionTabQuery(){return void 0===this.layer.options.workspace.queryOptions?.tabQuery||this.layer.options.workspace.queryOptions.tabQuery}getLayerWksOptionMapQuery(){return void 0===this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab||this.layer.options.workspace.queryOptions.mapQueryOnOpenTab}getInResolutionRange(){return this.inResolutionRange$.value}}var jt=s(76572);function Bp(l){return l.entityStore.getStrategyOfType(Ue.qq).active$.pipe((0,se.k)(m=>m?"igo.geo.workspace.inMapExtent.active.tooltip":"igo.geo.workspace.inMapExtent.inactive.tooltip"))}function Up(l){return l.entityStore.stateView.manyBy$(m=>!0===m.state.selected).pipe((0,se.k)(m=>m.length>=1))}function nl(l,m,t,i,n,p){const v=le.Yv.removeUndefined({sourceOptions:{type:i,url:t,optionsFromCapabilities:!0,optionsFromApi:!0,params:{LAYERS:"wms"===i?n:void 0,LAYER:"wms"===i?void 0:n}}});if("add"===l)p.createAsyncLayer(v).subscribe(k=>{m.layersAddedByClick$.next([k]),m.addLayer(k)});else if("remove"===l){const k=(0,Pn.KC)(v.sourceOptions);m.removeLayer(m.layers.find(de=>de.id===k))}}function _s(l,m,t,i){const n=function Yp(l,m){return[{name:"geoServiceAction",title:void 0,tooltip:"",renderer:Ue.G8.ButtonGroup,valueAccessor:(i,n)=>{let p=n.state.geoService;return p&&p.haveGeoServiceProperties&&p.url&&p.layerName?p.added?[{icon:"delete",color:"warn",click:(v,k)=>{nl("remove",l.map,k.state.geoService.url,k.state.geoService.type,k.state.geoService.layerName,m),p.added=!1}}]:[{icon:"plus",color:"primary",click:(v,k)=>{nl("add",l.map,k.state.geoService.url,k.state.geoService.type,k.state.geoService.layerName,m),p.added=!0}}]:[]}}]}(l,t),p=m.dataSource.options.sourceFields||[],v=m.dataSource.options.relations||[];if(0===p.length)return void l.entityStore.entities$.pipe((0,xn.O)(he=>0===he.length),(0,Er.U)(1)).subscribe(he=>{const Oe=he[0].ol,be=Oe.getKeys().filter(Pe=>!Pe.startsWith("_")&&"geometry"!==Pe&&Pe!==Oe.getGeometryName()&&!Pe.match(/boundedby/gi)).map(Pe=>({name:`properties.${Pe}`,title:Pe,renderer:Ue.G8.UnsanitizedHTML}));be.unshift(...n),l.meta.tableTemplate={selection:!0,sort:!0,columns:be,tableHeight:"100%"}});const k=p.map(he=>({name:`properties.${he.name}`,title:he.alias?he.alias:he.name,renderer:Ue.G8.UnsanitizedHTML,tooltip:he.tooltip,cellClassFunc:()=>{const Oe={};if(he.type)return Oe[`class_${he.type}`]=!0,Oe}})),de=v.map(he=>({name:`properties.${he.name}`,title:he.alias?he.alias:he.name,renderer:Ue.G8.Icon,icon:he.icon,parent:he.parent,type:"relation",tooltip:he.tooltip,onClick:()=>{i.next(he.title)},cellClassFunc:()=>({class_icon:!0})}));k.push(...de),k.unshift(...n),l.meta.tableTemplate={selection:!0,sort:!0,columns:k,tableHeight:"100%"}}function Pr(){return new Ue.qq({filterClauseFunc:m=>!0===m.state.inMapExtent&&!0===m.state.inMapResolution})}let Vp=(()=>{class l{storageService;configService;layerService;propertyTypeDetectorService;capabilitiesService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new A.g(void 0);constructor(t,i,n,p,v){this.storageService=t,this.configService=i,this.layerService=n,this.propertyTypeDetectorService=p,this.capabilitiesService=v}createWorkspace(t,i){if(!1===t.options.workspace?.enabled||t.dataSource.options.edition)return;t.options.workspace=Object.assign({},t.options.workspace,{srcId:t.id,workspaceId:t.id,enabled:!0});const n=new ys({id:t.id,title:t.title,layer:t,map:i,entityStore:this.createFeatureStore(t,i),actionStore:new Ue.MF([]),meta:{tableTemplate:void 0}});return _s(n,t,this.layerService,this.ws$),n}createFeatureStore(t,i){const n=new jt.ym([],{map:i});n.bindLayer(t);const p=new jt._c({}),v=new jt.IV({}),k=new jt.eu({map:i},this.propertyTypeDetectorService,this.capabilitiesService),de=new jt.CE({}),he=new Ue.xx({}),Oe=this.configService.getConfig("queryOverlayStyle"),be=new jt.kj({layer:new so.Md({zIndex:300,source:new Ro.EB,style:Pe=>Dr(Object.assign({},{feature:Pe},Oe?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:i,hitTolerance:15,motion:this.zoomAuto?jt.Su.Default:jt.Su.None,many:!0,dragBox:!0});return n.addStrategy(p,!0),n.addStrategy(v,!0),n.addStrategy(k,!0),n.addStrategy(de,!0),n.addStrategy(be,!0),n.addStrategy(he,!1),n.addStrategy(Pr(),!0),n}static \u0275fac=function(i){return new(i||l)(e.CoB(oe.yQ),e.CoB(M.aW),e.CoB(so.IZ),e.CoB(fs),e.CoB(Go.S))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();class rl extends Ue.ec{options;inResolutionRange$=new A.g(!0);get layer(){return this.options.layer}get map(){return this.options.map}constructor(m){super(m),this.options=m,this.map.viewController.resolution$.subscribe(t=>{this.inResolutionRange$.next(t>this.layer.minResolution&&t<this.layer.maxResolution)})}getLayerWksOptionTabQuery(){return void 0===this.layer.options.workspace.queryOptions?.tabQuery||this.layer.options.workspace.queryOptions.tabQuery}getLayerWksOptionMapQuery(){return void 0===this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab||this.layer.options.workspace.queryOptions.mapQueryOnOpenTab}getInResolutionRange(){return this.inResolutionRange$.value}}let jp=(()=>{class l{storageService;configService;layerService;propertyTypeDetectorService;capabilitiesService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new A.g(void 0);constructor(t,i,n,p,v){this.storageService=t,this.configService=i,this.layerService=n,this.propertyTypeDetectorService=p,this.capabilitiesService=v}createWorkspace(t,i){if(!1===t.options.workspace?.enabled||t.dataSource.options.edition)return;t.options.workspace=Object.assign({},t.options.workspace,{srcId:t.id,workspaceId:t.id,enabled:!0});const n=new rl({id:t.id,title:t.title,layer:t,map:i,entityStore:this.createFeatureStore(t,i),actionStore:new Ue.MF([]),meta:{tableTemplate:void 0}});return _s(n,t,this.layerService,this.ws$),n}createFeatureStore(t,i){const n=new jt.ym([],{map:i});n.bindLayer(t);const p=new jt._c({}),v=new jt.oJ({percentDistinctValueRatio:2,sourceFields:t.dataSource.options.sourceFields}),k=new jt.IV({}),de=new jt.eu({map:i},this.propertyTypeDetectorService,this.capabilitiesService),he=new jt.CE({}),Oe=new Ue.xx({}),be=this.configService.getConfig("queryOverlayStyle"),Pe=new jt.kj({layer:new so.Md({zIndex:300,source:new Ro.EB,style:Je=>Dr(Object.assign({},{feature:Je},be?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:i,hitTolerance:15,motion:this.zoomAuto?jt.Su.Default:jt.Su.None,many:!0,dragBox:!0});return t.options.workspace?.searchIndexEnabled&&n.addStrategy(v,!0),n.addStrategy(p,!0),n.addStrategy(k,!0),n.addStrategy(de,!0),n.addStrategy(he,!0),n.addStrategy(Pe,!0),n.addStrategy(Oe,!1),n.addStrategy(Pr(),!0),n}static \u0275fac=function(i){return new(i||l)(e.CoB(oe.yQ),e.CoB(M.aW),e.CoB(so.IZ),e.CoB(fs),e.CoB(Go.S))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var Kp=s(14512),Wp=s(99376);let Np=(()=>{class l{dialogRef;languageService;data;constructor(t,i,n){this.dialogRef=t,this.languageService=i,this.data=n}cancelAction(){this.data.cancel=!0,this.dialogRef.close(this.data.cancel)}confirmedAction(){this.data.cancel=!1,this.dialogRef.close(this.data.cancel)}static \u0275fac=function(i){return new(i||l)(e.GI1(bt.yI),e.GI1(L.ov),e.GI1(bt.sR))};static \u0275cmp=e.In1({type:l,selectors:[["igo-confirmation-popup-component"]],standalone:!0,features:[e.UHJ],decls:8,vars:2,consts:[["mat-dialog-content",""],[1,"mat-typography"],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"]],template:function(i,n){1&i&&(e.I0R(0,"div",0)(1,"p",1),e.OEk(2),e.C$Y()(),e.I0R(3,"div",2)(4,"button",3),e.qCj("click",function(){return n.confirmedAction()}),e.OEk(5," Ok "),e.C$Y(),e.I0R(6,"button",4),e.qCj("click",function(){return n.cancelAction()}),e.OEk(7),e.C$Y()()),2&i&&(e.yG2(2),e.oRS(" ",n.languageService.translate.instant("add"===n.data.type?"igo.geo.workspace.addConfirmation":"igo.geo.workspace.deleteConfirmation")," "),e.yG2(5),e.oRS(" ",n.languageService.translate.instant("igo.geo.workspace.cancel")," "))},dependencies:[bt.iU,bt.Yp,ct.oJ,ct.Gw],styles:["div.mat-mdc-dialog-actions[_ngcontent-%COMP%]{justify-content:center}"]})}return l})();class sl extends Ue.ec{dialog;configService;adding$;getDomainValues;options;inResolutionRange$=new A.g(!0);get layer(){return this.options.layer}get map(){return this.options.map}drawControl;drawEnd$$;olDrawingLayerSource=new C.c;olDrawingLayer;geometryType=Jt;modify;modifyStyle=new Ao.cp({stroke:new bo.c({color:"rgba(255,255,255,1)",width:1}),fill:new wo.c({color:"rgba(0,161,222,1)"}),image:new Pi.c({radius:7,stroke:new bo.c({color:"rgba(255,255,255,1)",width:1}),fill:new wo.c({color:"rgba(0,161,222,1)"})})});newFeaturefilterClauseFunc=m=>!0===m.state.newFeature;editFeaturefilterClauseFunc=m=>!0===m.state.edit;fillColor;strokeColor;strokeWidth;constructor(m,t,i,n,p){super(p),this.dialog=m,this.configService=t,this.adding$=i,this.getDomainValues=n,this.options=p,this.map.viewController.resolution$.subscribe(v=>{this.inResolutionRange$.next(v>this.layer.minResolution&&v<this.layer.maxResolution)}),this.drawControl=this.createDrawControl(),this.drawControl.setGeometryType(this.geometryType.Point),this.map.removeLayer(this.olDrawingLayer),this.olDrawingLayer=new so.Md({id:"igo-draw-layer",title:"edition",zIndex:300,source:new Ro.EB,showInLayerList:!1,exportable:!1,browsable:!1,workspace:{enabled:!1}})}deleteFeature(m,t){setTimeout(()=>{this.dialog.open(Np,{disableClose:!1,data:{type:"delete"}}).afterClosed().subscribe(n=>{if(!1===n){let p,v;const k=t.layer.dataSource.options.edition.baseUrl,de=t.layer.dataSource.options.edition.deleteUrl;v=k.length?this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+k+"?"+de:k+"?"+de:this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+de:de;for(const he of t.meta.tableTemplate.columns)for(const Oe in m.properties){let be=he.name;be.includes("properties.")&&(be=be.split(".")[1]),be===Oe&&!0===he.primary&&(p=m.properties[Oe])}v&&(v+=p,this.deleteFeature(t,v))}})},250)}editFeature(m,t){m.edition=!0;let i,n=!1;const p=t.layer.dataSource.options.edition;for(const v of t.meta.tableTemplate.columns)if(("list"===v.type||"autocomplete"===v.type)&&this.getDomainValues(v.relation).subscribe(k=>{v.domainValues=k}),!1===n)for(const k in m.properties){let de=v.name;if(de.includes("properties.")&&(de=de.split(".")[1]),de===k&&!0===v.primary){i=m.properties[k],n=!0;break}}i?(m.original_properties=JSON.parse(JSON.stringify(m.properties)),m.original_geometry=m.geometry,m.idkey=i,t.entityStore.state.updateAll({edit:!1}),t.entityStore.stateView.filter(this.editFeaturefilterClauseFunc),this.addFeatureToStore(m,t)):!m.newFeature&&p.geomType&&(m.newFeature=!0,this.adding$.next(!0),t.entityStore.state.updateAll({newFeature:!1}),t.entityStore.stateView.filter(this.newFeaturefilterClauseFunc),p.addWithDraw?this.onGeometryTypeChange(p.geomType,m,t):(t.entityStore.insert(m),t.entityStore.state.update(m,{newFeature:!0},!0)))}createDrawControl(m,t,i){return new wp.i4({geometryType:void 0,drawingLayerSource:this.olDrawingLayerSource,drawingLayerStyle:new Ao.cp({}),interactionStyle:sr(m,t,i)})}onGeometryTypeChange(m,t,i){this.drawControl.setGeometryType(m),this.toggleDrawControl(t,i)}toggleDrawControl(m,t){this.deactivateDrawControl(),this.activateDrawControl(m,t)}deactivateDrawControl(){this.drawControl&&(this.drawEnd$$&&this.drawEnd$$.unsubscribe(),this.drawControl.setOlMap(void 0))}activateDrawControl(m,t){this.drawEnd$$=this.drawControl.end$.subscribe(i=>{this.addFeatureToStore(m,t,i)}),this.drawControl.setOlMap(this.map.ol,!0)}addFeatureToStore(m,t,i){const n=this.map.ol.getView().getProjection();let p=m.geometry;i?(t.entityStore.insert(m),t.entityStore.state.update(m,{newFeature:!0},!0),p=(new X.c).writeGeometryObject(i,{featureProjection:n,dataProjection:"EPSG:4326"}),m.geometry=p):t.entityStore.state.update(m,{edit:!0},!0),m.projection="EPSG:4326";const v=(0,jt.K6)(m,n.getCode());this.olDrawingLayer.dataSource.ol.clear(),this.olDrawingLayer.dataSource.ol.addFeature(v),this.map.addLayer(this.olDrawingLayer),this.deactivateDrawControl(),this.createModifyInteraction(v,m,t)}deleteDrawings(){this.map.removeLayer(this.olDrawingLayer),this.olDrawingLayerSource.clear(),this.map.ol.removeInteraction(this.modify)}createModifyInteraction(m,t,i){this.map.ol.removeInteraction(this.modify);const n=new Kp.c([m],{unique:!0});this.modify=new Wp.c({features:n}),this.map.ol.addInteraction(this.modify),n.forEach(p=>{p.setStyle(this.modifyStyle)}),this.modify.on("modifyend",p=>{const v=p.features.getArray()[0]?.getGeometry();v&&this.addFeatureToStore(t,i,v)})}}let Hp=(()=>{class l{layerService;storageService;configService;messageService;http;dialog;styleService;authInterceptor;ws$=new A.g(void 0);adding$=new A.g(!1);relationLayers$=new A.g(void 0);rowsInMapExtentCheckCondition$=new A.g(!0);loading=!1;wktFormat=new Io.c;geoJsonFormat=new X.c;get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(t,i,n,p,v,k,de,he){this.layerService=t,this.storageService=i,this.configService=n,this.messageService=p,this.http=v,this.dialog=k,this.styleService=de,this.authInterceptor=he}createWorkspace(t,i){if(!0!==t.options.workspace?.enabled||!0!==t.dataSource.options.edition.enabled)return;let n;n=t.options.workspace?t.options.workspace:{},n.srcId=t.id,n.workspaceId=t.id,n.enabled=!0,n.pageSize=t.options.workspace?.pageSize,n.pageSizeOptions=t.options.workspace?.pageSizeOptions;const p=t.dataSource,v=t.id+".WmsWorkspaceTableSrc",k=t.id+".WfsWorkspaceTableDest";t.options.linkedLayers||(t.options.linkedLayers={linkId:v,links:[]});const de={syncedDelete:!0,linkedIds:[k],properties:[so.aG.ZINDEX,so.aG.VISIBLE]};t.options.workspace?.minResolution||de.properties.push(so.aG.MINRESOLUTION);let he=!1;p.options.ogcFilters?.enabled&&(de.properties.push(so.aG.OGCFILTERS),he=!0),t.options.workspace?.maxResolution||de.properties.push(so.aG.MAXRESOLUTION);let be,Oe=[];return t.options.linkedLayers.links&&(Oe=JSON.parse(JSON.stringify(t.options.linkedLayers.links))),Oe.push(de),t.options.linkedLayers.linkId=t.options.linkedLayers.linkId?t.options.linkedLayers.linkId:v,t.options.linkedLayers.links=Oe,this.layerService.createAsyncLayer({id:k,linkedLayers:{linkId:k},workspace:{srcId:t.id,workspaceId:void 0,enabled:!1,queryOptions:{mapQueryOnOpenTab:t.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:!1},pageSize:t.options.workspace?.pageSize,pageSizeOptions:t.options.workspace?.pageSizeOptions},showInLayerList:!1,opacity:0,title:t.title,minResolution:t.options.workspace?.minResolution||t.minResolution||0,maxResolution:t.options.workspace?.maxResolution||t.maxResolution||1/0,style:this.styleService.createStyle({fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},circle:{fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},radius:5}}),sourceOptions:{download:p.options.download,type:"wfs",url:p.options.urlWfs||p.options.url,queryable:!0,relations:p.options.relations,queryTitle:p.options.queryTitle,params:p.options.paramsWFS,ogcFilters:Object.assign({},p.ogcFilters,{enabled:he}),sourceFields:p.options.sourceFields||void 0,edition:p.options.edition}}).subscribe(Pe=>(i.addLayer(Pe),t.ol.setProperties({linkedLayers:{linkId:t.options.linkedLayers.linkId,links:Oe}},!1),Pe.dataSource.ol.refresh(),be=new sl(this.dialog,this.configService,this.adding$,Je=>this.getDomainValues(Je),{id:t.id,title:t.title,layer:Pe,map:i,entityStore:this.createFeatureStore(Pe,i),actionStore:new Ue.MF([]),meta:{tableTemplate:void 0}}),this.createTableTemplate(be,Pe),Pe.options.workspace.workspaceId=Pe.id,t.options.workspace=Object.assign({},t.options.workspace,{wksConfig:n}),delete p.options.download,be)),be}createFeatureStore(t,i){const n=new jt.ym([],{map:i});n.bindLayer(t);const p=new jt._c({}),v=new jt.IV({}),k=new jt.CE({}),de=new Ue.xx({}),he=new jt.kj({layer:new so.Md({zIndex:300,source:new nt.E,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1}),map:i,hitTolerance:15,motion:this.zoomAuto?jt.Su.Default:jt.Su.None,many:!0,dragBox:!0});return n.addStrategy(p,!0),n.addStrategy(v,!0),n.addStrategy(k,!0),n.addStrategy(he,!0),n.addStrategy(de,!1),n.addStrategy(Pr(),!0),n}createTableTemplate(t,i){const n=i.dataSource.options.sourceFields||[],p=i.dataSource.options.relations||[];let v=Ue.G8.UnsanitizedHTML,k=[],de=[],he=[];k=[{name:"edition",title:void 0,renderer:Ue.G8.ButtonGroup,primary:!1,valueAccessor:()=>[{editMode:!1,icon:"pencil",color:"primary",disabled:!1===i.dataSource.options.edition.modifyButton,click:Oe=>{t.editFeature(Oe,t)}},{editMode:!1,icon:"delete",color:"warn",disabled:!1===i.dataSource.options.edition.deleteButton,click:Oe=>{t.deleteFeature(Oe,t)}},{editMode:!0,icon:"check",color:"primary",disabled:this.loading,click:Oe=>{this.saveFeature(Oe,t)}},{editMode:!0,icon:"alpha-x",color:"primary",disabled:this.loading,click:Oe=>{this.cancelEdit(t,Oe)}}]}],0!==n.length?(de=n.map(Oe=>{let be={name:`properties.${Oe.name}`,title:Oe.alias?Oe.alias:Oe.name,renderer:v,valueAccessor:void 0,cellClassFunc:()=>{const Pe={};if(Oe.type)return Pe[`class_${Oe.type}`]=!0,Pe},primary:!0===Oe.primary,visible:Oe.visible,validation:Oe.validation,linkColumnForce:Oe.linkColumnForce,type:Oe.type,domainValues:void 0,relation:void 0,multiple:Oe.multiple,step:Oe.step,tooltip:Oe.tooltip};return("list"===Oe.type||"autocomplete"===Oe.type)&&this.getDomainValues(Oe.relation).subscribe(Pe=>{be.domainValues=Pe,be.relation=Oe.relation}),be}),he=p.map(Oe=>({name:`properties.${Oe.name}`,title:Oe.alias?Oe.alias:Oe.name,renderer:Ue.G8.Icon,icon:Oe.icon,parent:Oe.parent,type:"relation",tooltip:Oe.tooltip,onClick:()=>{!1===this.adding$.getValue()&&this.ws$.next(Oe.title)},cellClassFunc:()=>({class_icon:!0})})),de.push(...he),de.push(...k),t.meta.tableTemplate={selection:!1,sort:!0,columns:de}):t.entityStore.entities$.pipe((0,xn.O)(Oe=>0===Oe.length),(0,Er.U)(1)).subscribe(Oe=>{const be=Oe[0].ol,Pe=be.getKeys().filter(Je=>!Je.startsWith("_")&&"geometry"!==Je&&Je!==be.getGeometryName()&&!Je.match(/boundedby/gi)).map(Je=>({name:`properties.${Je}`,title:Je,renderer:v}));t.meta.tableTemplate={selection:!1,sort:!0,columns:Pe}})}saveFeature(t,i){if(!this.validateFeature(t,i))return!1;this.sanitizeParameter(t,i);const n=i.layer.dataSource.options.edition.baseUrl;let p=this.configService.getConfig("edition.url");if(p?p+=n||"":p=n,t.newFeature){p+=i.layer.dataSource.options.edition.addUrl;const k=new ae.UD(i.layer.dataSource.options.edition.addHeaders);this.addFeature(t,i,p,k)}else{p+="post"!==i.layer.dataSource.options.edition.modifyProtocol?"?"+i.layer.dataSource.options.edition.modifyUrl+t.idkey:i.layer.dataSource.options.edition.modifyUrl;const v=i.layer.dataSource.options.edition.modifyProtocol,de=new ae.UD(i.layer.dataSource.options.edition.modifyHeaders);this.modifyFeature(t,i,p,de,v)}}addFeature(t,i,n,p){if(i.layer.dataSource.options.edition.hasGeometry){const v=i.layer.options.sourceOptions.edition.geomDatabaseProj;t.properties[i.layer.dataSource.options.params.fieldNameGeometry]="SRID="+v.replace("EPSG:","")+";"+this.wktFormat.writeGeometry(this.geoJsonFormat.readFeature(t.geometry).getGeometry().transform("EPSG:4326",v),{dataProjection:v})}for(const v in t.properties)for(const k of i.layer.dataSource.options.sourceFields)(k.name===v&&k.validation?.readonly||k.name===v&&!1===k.validation?.send)&&delete t.properties[v];this.loading=!0,this.http.post(`${n}`,t.properties,{headers:p}).subscribe(()=>{this.loading=!1,i.entityStore.stateView.clear(),i.deleteDrawings(),i.entityStore.delete(t),this.messageService.success("igo.geo.workspace.addSuccess"),this.refreshMap(i.layer,i.layer.map),this.adding$.next(!1),this.rowsInMapExtentCheckCondition$.next(!0)},v=>{this.loading=!1,v.error.caught=!0;const k=i.layer.dataSource.options.edition.messages;if(k){let de;k.forEach(he=>{const Oe=Object.keys(he)[0];v.error.message.includes(Oe)&&(de=he[Oe],this.messageService.error(de))}),de||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}deleteFeature(t,i){this.loading=!0,this.http.delete(`${i}`,{}).subscribe(()=>{this.loading=!1,this.messageService.success("igo.geo.workspace.deleteSuccess"),this.refreshMap(t.layer,t.layer.map);for(const n of t.layer.options.sourceOptions.relations)t.map.layers.forEach(p=>{p.title===n.title&&p.dataSource.ol.refresh()})},n=>{this.loading=!1,n.error.caught=!0;const p=t.layer.dataSource.options.edition.messages;if(p){let v;p.forEach(k=>{const de=Object.keys(k)[0];n.error.message.includes(de)&&(v=k[de],this.messageService.error(v))}),v||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}modifyFeature(t,i,n,p,v="patch"){if(i.layer.dataSource.options.edition.hasGeometry){const k=i.layer.options.sourceOptions.edition.geomDatabaseProj;t.geometry.coordinates=al(t.geometry.coordinates),t.properties[i.layer.dataSource.options.params.fieldNameGeometry]="SRID="+k.replace("EPSG:","")+";"+this.wktFormat.writeGeometry(this.geoJsonFormat.readFeature(t.geometry).getGeometry().transform("EPSG:4326",k),{dataProjection:k})}for(const k in t.properties)for(const de of i.layer.dataSource.options.sourceFields)(de.name===k&&de.validation?.readonly||de.name===k&&!1===de.validation?.send||"boundedBy"===k)&&delete t.properties[k];this.loading=!0,this.http[v](`${n}`,t.properties,{headers:p}).subscribe(()=>{this.loading=!1,this.cancelEdit(i,t,!0),this.messageService.success("igo.geo.workspace.modifySuccess"),this.refreshMap(i.layer,i.layer.map);let k=[];for(const de of i.layer.options.sourceOptions.relations)i.map.layers.forEach(he=>{he.title===de.title&&(k.push(he),he.dataSource.ol.refresh())});this.relationLayers$.next(k)},k=>{this.loading=!1,k.error.caught=!0;const de=i.layer.dataSource.options.edition.messages;if(de){let he;de.forEach(Oe=>{const be=Object.keys(Oe)[0];k.error.message.includes(be)&&(he=Oe[be],this.messageService.error(he))}),he||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}cancelEdit(t,i,n=!1){i.edition=!1,this.adding$.next(!1),t.deleteDrawings(),t.entityStore.stateView.clear(),i.newFeature?(t.entityStore.delete(i),t.deactivateDrawControl(),this.rowsInMapExtentCheckCondition$.next(!0)):(n||(i.properties=i.original_properties,i.geometry=i.original_geometry),delete i.original_properties,delete i.original_geometry)}getDomainValues(t){let i=t.url;return i||(i=this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+t.table:t.table),this.http.get(i).pipe((0,se.k)(n=>n),(0,ge.a)(n=>(n.error.caught=!0,(0,ua.c)(n))))}refreshMap(t,i){const n=t.dataSource.ol;n.setLoader((v,k,de,he,Oe)=>{t.customWFSLoader(t.ol.getSource(),t.options.sourceOptions,this.authInterceptor,v,k,de,he,Oe,!0)}),n.refresh();for(const v of i.layers)if(v.id!==t.id&&v.options.linkedLayers?.linkId.includes(t.id.substr(0,t.id.indexOf(".")-1))&&v.options.linkedLayers?.linkId.includes("WmsWorkspaceTableSrc")){const k=v.dataSource.ol;let de=k.getParams();de._t=(new Date).getTime(),k.updateParams(de)}}validateFeature(t,i){let p,v=!0;return i.meta.tableTemplate.columns.forEach(k=>{k.hasOwnProperty("validation")&&k.validation&&(p=Fr(k.name),Object.keys(k.validation).forEach(de=>{switch(de){case"mandatory":k.validation[de]&&(!t.properties.hasOwnProperty(p)||!t.properties[p])&&(v=!1,this.messageService.error("igo.geo.formValidation.mandatory",void 0,void 0,{column:k.title}));break;case"minValue":t.properties.hasOwnProperty(p)&&t.properties[p]&&t.properties[p]<k.validation[de]&&(v=!1,this.messageService.error("igo.geo.formValidation.minValue",void 0,void 0,{column:k.title,value:k.validation[de]}));break;case"maxValue":t.properties.hasOwnProperty(p)&&t.properties[p]&&t.properties[p]>k.validation[de]&&(v=!1,this.messageService.error("igo.geo.formValidation.maxValue",void 0,void 0,{column:k.title,value:k.validation[de]}));break;case"minLength":t.properties.hasOwnProperty(p)&&t.properties[p]&&t.properties[p].length<k.validation[de]&&(v=!1,this.messageService.error("igo.geo.formValidation.minLength",void 0,void 0,{column:k.title,value:k.validation[de]}));break;case"maxLength":t.properties.hasOwnProperty(p)&&t.properties[p]&&t.properties[p].length>k.validation[de]&&(v=!1,this.messageService.error("igo.geo.formValidation.maxLength",void 0,void 0,{column:k.title,value:k.validation[de]}))}}))}),v}sanitizeParameter(t,i){i.meta.tableTemplate.columns.forEach(n=>{"list"===n.type&&t.properties[Fr(n.name)]&&(t.properties[Fr(n.name)]=t.properties[Fr(n.name)].toString())})}static \u0275fac=function(i){return new(i||l)(e.CoB(so.IZ),e.CoB(oe.yQ),e.CoB(M.aW),e.CoB(Qt.mi),e.CoB(ae.KK),e.CoB(bt.qW),e.CoB(cr.U),e.CoB(fe.kT))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function Fr(l){return l.includes("properties.")?l.split(".")[1]:l}function al(l){return 0===l.length?l:"number"==typeof l[0]?l.slice(0,2):l.map(al)}var zp=s(33436);let Xp=(()=>{class l{layerService;storageService;capabilitiesService;styleService;configService;propertyTypeDetectorService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new A.g(void 0);constructor(t,i,n,p,v,k){this.layerService=t,this.storageService=i,this.capabilitiesService=n,this.styleService=p,this.configService=v,this.propertyTypeDetectorService=k}createWorkspace(t,i){if(!t.options.workspace||i.layers.find(Pe=>Pe.id===t.id+".WfsWorkspaceTableDest")||t.dataSource.options.edition)return;const n=t.dataSource,p=t.id+".WmsWorkspaceTableSrc",v=t.id+".WfsWorkspaceTableDest";t.options.linkedLayers||(t.options.linkedLayers={linkId:p,links:[]});const k={syncedDelete:!0,linkedIds:[v],properties:[so.aG.ZINDEX,so.aG.VISIBLE]};t.options.workspace?.minResolution||k.properties.push(so.aG.MINRESOLUTION);let de=!1;n.options.ogcFilters?.enabled&&(k.properties.push(so.aG.OGCFILTERS),de=!0),t.options.workspace?.maxResolution||k.properties.push(so.aG.MAXRESOLUTION);let Oe,he=[];return t.options.linkedLayers.links&&(he=JSON.parse(JSON.stringify(t.options.linkedLayers.links))),he.push(k),t.options.linkedLayers.linkId=t.options.linkedLayers.linkId?t.options.linkedLayers.linkId:p,t.options.linkedLayers.links=he,this.layerService.createAsyncLayer({isIgoInternalLayer:!0,id:v,linkedLayers:{linkId:v},workspace:{printable:t.options.workspace?.printable,srcId:t.id,workspaceId:void 0,enabled:!1,queryOptions:{mapQueryOnOpenTab:t.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:t.options.workspace?.queryOptions?.tabQuery},pageSize:t.options.workspace?.pageSize,pageSizeOptions:t.options.workspace?.pageSizeOptions},showInLayerList:!1,opacity:0,title:t.title,minResolution:t.options.workspace?.minResolution||t.minResolution||0,maxResolution:t.options.workspace?.maxResolution||t.maxResolution||1/0,style:this.styleService.createStyle({fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},circle:{fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},radius:5}}),sourceOptions:{download:n.options.download,type:"wfs",url:n.options.urlWfs||n.options.url,queryable:!0,relations:n.options.relations,queryTitle:n.options.queryTitle,queryFormatAsWms:!t.options.workspace?.enabled||n.options.queryFormatAsWms,params:n.options.paramsWFS,ogcFilters:Object.assign({},n.ogcFilters,{enabled:de}),sourceFields:n.options.sourceFields||void 0}}).subscribe(Pe=>{if(i.addLayer(Pe),t.ol.setProperties({linkedLayers:{linkId:t.options.linkedLayers.linkId,links:he}},!1),Pe.dataSource.ol.refresh(),t.options.workspace?.enabled)return Oe=new ys({id:t.id,title:t.title,layer:Pe,map:i,entityStore:this.createFeatureStore(Pe,i),actionStore:new Ue.MF([]),meta:{tableTemplate:void 0}}),_s(Oe,Pe,this.layerService,this.ws$),Pe.options.workspace.workspaceId=Pe.id,t.options.workspace=Object.assign({},t.options.workspace,{enabled:!0,srcId:t.id,workspaceId:Pe.id,queryOptions:{mapQueryOnOpenTab:t.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:t.options.workspace?.queryOptions?.tabQuery},pageSize:t.options.workspace?.pageSize,pageSizeOptions:t.options.workspace?.pageSizeOptions}),delete n.options.download,Oe}),Oe}createFeatureStore(t,i){const n=new jt.ym([],{map:i});n.bindLayer(t);const p=new jt._c({}),v=new jt.IV({}),k=new jt.eu({map:i},this.propertyTypeDetectorService,this.capabilitiesService),de=new jt.CE({}),he=new Ue.xx({}),Oe=this.configService.getConfig("queryOverlayStyle"),be=new jt.kj({layer:new so.Md({zIndex:300,source:new nt.E,style:Pe=>Dr(Object.assign({},{feature:Pe},Oe?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:i,hitTolerance:15,motion:this.zoomAuto?jt.Su.Default:jt.Su.None,many:!0,dragBox:!0});return n.addStrategy(p,!0),n.addStrategy(v,!0),n.addStrategy(k,!0),n.addStrategy(de,!0),n.addStrategy(be,!0),n.addStrategy(he,!1),n.addStrategy(Pr(),!0),n}static \u0275fac=function(i){return new(i||l)(e.CoB(so.IZ),e.CoB(oe.yQ),e.CoB(Go.S),e.CoB(cr.U),e.CoB(M.aW),e.CoB(fs))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),Jp=(()=>{class l{component;wfsWorkspaceService;wmsWorkspaceService;editionWorkspaceService;featureWorkspaceService;layers$$;entities$$=[];map;changeWorkspace=new e._w7;disableSwitch=new e._w7;relationLayers=new e._w7;rowsInMapExtentCheckCondition=new e._w7;get workspaceStore(){return this.component.store}constructor(t,i,n,p,v){this.component=t,this.wfsWorkspaceService=i,this.wmsWorkspaceService=n,this.editionWorkspaceService=p,this.featureWorkspaceService=v}ngOnInit(){this.layers$$=this.map.layers$.pipe((0,vo.o)(50)).subscribe(t=>this.onLayersChange(t)),this.featureWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.wmsWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.wfsWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.editionWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.editionWorkspaceService.adding$.subscribe(t=>{this.disableSwitch.emit(t)}),this.editionWorkspaceService.relationLayers$.subscribe(t=>{this.relationLayers.emit(t)}),this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe(t=>{this.rowsInMapExtentCheckCondition.emit(t)})}ngOnDestroy(){this.layers$$.unsubscribe(),this.entities$$.map(t=>t.unsubscribe())}onLayersChange(t){const i=t.filter(k=>this.layerIsEditable(k)),n=i.map(k=>k.id),p=i.map(k=>this.getOrCreateWorkspace(k)).filter(k=>void 0!==k),v=this.workspaceStore.all().filter(k=>n.indexOf(k.id)<0);v.length>0&&(v.forEach(k=>{k.entityStore.deactivateStrategyOfType(zp.I),k.deactivate()}),this.workspaceStore.state.updateMany(v,{active:!1,selected:!1}),this.workspaceStore.deleteMany(v)),p.length>0&&this.workspaceStore.insertMany(p)}getOrCreateWorkspace(t){if(void 0===this.workspaceStore.get(t.id)){if(t.dataSource instanceof Ro.ak&&!0!==t.dataSource.options.edition?.enabled)return this.wfsWorkspaceService.createWorkspace(t,this.map);if(t.dataSource instanceof Ro.CK&&!0!==t.dataSource.options.edition?.enabled){if(!t.dataSource.options.paramsWFS)return;const n=this.wmsWorkspaceService.createWorkspace(t,this.map);return n?.inResolutionRange$.subscribe(p=>{t.dataSource.options.queryable=!p,n.layer.dataSource.options.queryable=p}),n}if(t.dataSource instanceof Ro.EB&&!0===t.exportable&&!0!==t.dataSource.options.edition?.enabled)return this.featureWorkspaceService.createWorkspace(t,this.map);if(t.dataSource instanceof Ro.CK&&!0===t.dataSource.options.edition?.enabled)return this.editionWorkspaceService.createWorkspace(t,this.map)}}layerIsEditable(t){const i=t.dataSource;return i instanceof Ro.ak||i instanceof Ro.EB||i instanceof Ro.CK&&((i.options||{}).ogcFilters?.enabled||void 0!==i.options.paramsWFS?.featureTypes)}static \u0275fac=function(i){return new(i||l)(e.GI1(Ue.uF),e.GI1(Vp),e.GI1(Xp),e.GI1(Hp),e.GI1(jp))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoWorkspaceSelector",""]],inputs:{map:"map"},outputs:{changeWorkspace:"changeWorkspace",disableSwitch:"disableSwitch",relationLayers:"relationLayers",rowsInMapExtentCheckCondition:"rowsInMapExtentCheckCondition"},standalone:!0})}return l})()},64002:(Ee,ce,s)=>{"use strict";s.d(ce,{Q1:()=>e,OI:()=>T,_D:()=>h,C3:()=>w,U3:()=>L,UD:()=>X,Yv:()=>B,eU:()=>E,qM:()=>I,WO:()=>U,EB:()=>g,U1:()=>M,We:()=>oe,ym:()=>A,GC:()=>V,sX:()=>o,uq:()=>u});let e=(()=>class G{static PADCHAR="=";static ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";static getByte(F,Q){return F.charCodeAt(Q)}static getByte64(F,Q){return this.ALPHA.indexOf(F.charAt(Q))}static decode(F){let r,ie,Q=0,ae=F.length,fe=[];if(F=String(F),0===ae)return F;for(F.charAt(ae-1)===this.PADCHAR&&(Q=1,F.charAt(ae-2)===this.PADCHAR&&(Q=2),ae-=4),r=0;r<ae;r+=4)ie=this.getByte64(F,r)<<18|this.getByte64(F,r+1)<<12|this.getByte64(F,r+2)<<6|this.getByte64(F,r+3),fe.push(String.fromCharCode(ie>>16,ie>>8&255,255&ie));switch(Q){case 1:ie=this.getByte64(F,r)<<18|this.getByte64(F,r+1)<<12|this.getByte64(F,r+2)<<6,fe.push(String.fromCharCode(ie>>16,ie>>8&255));break;case 2:ie=this.getByte64(F,r)<<18|this.getByte64(F,r+1)<<12,fe.push(String.fromCharCode(ie>>16))}return fe.join("")}static encode(F){let Q,r,ie=[],ae=(F=String(F)).length-F.length%3;if(0===F.length)return F;for(Q=0;Q<ae;Q+=3)r=this.getByte(F,Q)<<16|this.getByte(F,Q+1)<<8|this.getByte(F,Q+2),ie.push(this.ALPHA.charAt(r>>18)),ie.push(this.ALPHA.charAt(r>>12&63)),ie.push(this.ALPHA.charAt(r>>6&63)),ie.push(this.ALPHA.charAt(63&r));switch(F.length-ae){case 1:r=this.getByte(F,Q)<<16,ie.push(this.ALPHA.charAt(r>>18)+this.ALPHA.charAt(r>>12&63)+this.PADCHAR+this.PADCHAR);break;case 2:r=this.getByte(F,Q)<<16|this.getByte(F,Q+1)<<8,ie.push(this.ALPHA.charAt(r>>18)+this.ALPHA.charAt(r>>12&63)+this.ALPHA.charAt(r>>6&63)+this.PADCHAR)}return ie.join("")}})();var d=s(33712);function g(G){return G.map(O=>O instanceof d.i4?O.toString():void 0!==O?JSON.parse(JSON.stringify(O)):O)}const o=s(68916).getParser(window.navigator.userAgent);class h{static copy(O){let F=!1;if("string"==typeof O){const Q=h.createTextArea(O);h.selectText(Q),F=h.copyTextToClipboard(),h.destroyTextArea(Q)}else h.selectText(O),F=h.copyTextToClipboard();return F}static createTextArea(O){const F=document.createElement("textArea");return F.value=O,document.body.appendChild(F),F}static destroyTextArea(O){document.body.removeChild(O)}static selectText(O){if("iOS"===o.getOSName()){const F=O.contentEditable,Q=O.readOnly,r=document.createRange(),ie=window.getSelection();O.contenteditable=!0,O.readonly=!1,r.selectNodeContents(O),ie.removeAllRanges(),ie.addRange(r),O.setSelectionRange(0,999999),O.contentEditable=F,O.readOnly=Q}else O.select()}static copyTextToClipboard(){return("iOS"!==o.getOSName()||!o.compareVersion("<10"))&&document.execCommand("copy")}}var j=s(21296);function x(G,O,F){return G>>O&(1<<F)-1}class w{base64Index=new Map;indexBase64=new Map;constructor(){this.generateBase64Index()}generateBase64Index(){for(let O=0;O<26;O++)this.base64Index.set(String.fromCharCode(65+O),O),this.indexBase64.set(O,String.fromCharCode(65+O));for(let O=0;O<26;O++)this.base64Index.set(String.fromCharCode(97+O),O+26),this.indexBase64.set(O+26,String.fromCharCode(97+O));for(let O=0;O<10;O++)this.base64Index.set(String.fromCharCode(48+O),O+52),this.indexBase64.set(O+52,String.fromCharCode(48+O));this.base64Index.set("+",62),this.base64Index.set("/",63),this.indexBase64.set(62,"+"),this.indexBase64.set(63,"/")}compressBlob(O){return O?new j._(Q=>{const r=new FileReader;r.readAsDataURL(O),r.onload=()=>{const ie=r.result.valueOf(),ae=ie.substr(ie.indexOf(",")+1),fe=this.compressStringBase64(ae);Q.next({length:ae.length,type:O.type,object:fe})}}):void 0}decompressBlob(O){const r=this.decompressStringBase64(O.object,O.length),ie=atob(r),ae=new Array(ie.length);for(let ue=0;ue<ie.length;ue++)ae[ue]=ie.charCodeAt(ue);const fe=new Uint8Array(ae);return new Blob([fe],{type:O.type})}compressStringBase64(O){let F="",Q=16,r=0,ie=0;for(const ae of O){const fe=this.base64Index.get(ae);Q>6?(Q-=6,r+=fe<<Q):(ie=6-Q,r+=fe>>ie,F+=String.fromCharCode(r),r=fe<<16-ie,Q=16-ie)}return O.length%8!=0&&(F+=String.fromCharCode(r)),"\u2603"+F}decompressStringBase64(O,F){if(!O)return;if(9731!==O.charCodeAt(0))return O;let Q=0,r=0,ie=16,ae="",fe=1,le=O.charCodeAt(fe);for(let ue=0;ue<F;ue++)ie>6?(ie-=6,Q=x(le,ie,6),ae+=this.indexBase64.get(Q)):(r=6-ie,Q=x(le,0,ie)<<r,le=O.charCodeAt(++fe),Q+=x(le,16-r,r),ae+=this.indexBase64.get(Q),ie=16-r);return ae}}var b=function(G){return G.ADDED="added",G.DELETED="deleted",G.MODIFIED="modified",G}(b||{});class E{static diff(O,F,Q=4){if(!O&&!F)return"";if(!O)return'<span class="inserted">'+F+"</span>";if(!F)return'<span class="deleted">'+O+"</span>";O=O.toString(),F=F.toString();const r=E.getChanges(O,F,"",Q),ie=F.slice(r.mtc.length+r.ins.length+r.sbs.length),ae=O.slice(r.mtc.length+r.del.length+r.sbs.length);let fe="";return r.del.length>0&&(r.del='<span class="deleted">'+r.del+"</span>"),r.ins.length>0&&(r.ins='<span class="inserted">'+r.ins+"</span>"),fe=r.mtc+r.del+r.ins+r.sbs,fe+=""!==ae||""!==ie?E.diff(ae,ie,Q):"",fe}static getMatchingSubstring(O,F,Q){let r=0,ie=!1;const ae=O.length,fe={fis:ae,mtc:Q,sbs:""};for(;r<ae;)F[r]===O[r]?ie?fe.sbs+=O[r]:(ie=!0,fe.fis=r,fe.sbs=O[r]):ie&&(r=ae),++r;return fe}static getChanges(O,F,Q,r){const ie=O.length>=O.length;let[ae,fe]=ie?[O,F]:[F,O],le=0;for(;fe[le]===ae[le]&&le<fe.length;)++le;ae=ae.split("").slice(le),fe=fe.slice(le);const ue=ae.length;let se={fis:fe.length,fil:ue,sbs:"",mtc:Q+F.slice(0,le)},ge={sbs:""};if(""!==fe)for(let Ie=0;Ie<ue&&ge.sbs.length<r;Ie++)ge=E.getMatchingSubstring(fe,E.rotateArray(ae,Ie),se.mtc),ge.fil=Ie<ue-ge.fis?ge.fis+Ie:ge.fis-ue+Ie,ge.sbs.length>se.sbs.length&&(se=ge);return[se.del,se.ins]=ie?[ae.slice(0,se.fil).join(""),fe.slice(0,se.fis)]:[fe.slice(0,se.fis),ae.slice(0,se.fil).join("")],-1===se.del.indexOf(" ")||-1===se.ins.indexOf(" ")||""===se.del||""===se.ins||""===se.sbs?se:E.getChanges(se.del,se.ins,se.mtc,r)}static rotateArray(O,F){const Q=O.length,r=new Array(O.length);if(F%Q==0)return O.slice();for(let ie=0;ie<Q;ie++)r[ie]=O[(ie+(Q+F%Q))%Q];return r}static isValidNumber(O){return!isNaN(Number(O))}static isOctalNumber(O){return E.isValidNumber(O)&&O.startsWith("0")&&O.length>1}}class T{static findChanges(O,F,Q=[]){const r={added:[],deleted:[],modified:[]};if(!O||!F)return r;const ie=[...O],ae=[...F];for(const fe of ie){const le=ae.findIndex(Re=>Re.id===fe.id);if(-1===le){r.deleted.push({change:{type:b.DELETED},value:fe});continue}const ue=ae.splice(le,1)[0],se=JSON.parse(JSON.stringify(fe)),ge=JSON.parse(JSON.stringify(ue)),Ie=T.compareObject(se,ge,void 0,Q);Ie.length&&r.modified.push({change:{type:b.MODIFIED,keysChanged:Ie},value:se,oldValue:fe,newValue:ue})}return r.added=ae.map(fe=>({change:{type:b.ADDED},value:fe})),r}static compareObject(O,F,Q,r=[]){const ie=JSON.parse(JSON.stringify(O)),ae=JSON.parse(JSON.stringify(F)),fe=new Set([...Object.keys(O),...Object.keys(F)]);let le=[];return fe.forEach(ue=>{const se=Q?`${Q}.${ue}`:ue;-1===r.indexOf(se)&&(Array.isArray(O[ue])&&(O[ue]=O[ue].join(",<br>")),Array.isArray(F[ue])&&(F[ue]=F[ue].join(",<br>")),"object"==typeof O[ue]&&"object"==typeof F[ue]&&null!==O[ue]&&null!==F[ue]?le=le.concat(this.compareObject(O[ue],F[ue],se)):O[ue]!==F[ue]&&(le.push({key:se,oldValue:ie[ue],newValue:ae[ue]}),O[ue]=E.diff(O[ue],F[ue])))}),le}}var a=s(30816),K=s.n(a);function M(G,O){return K()(G).format(O)}class L{static create(O,F,Q){const r=O.createElement(F);for(const ie in Q)r[ie]=Q[ie];return r}static remove(O){O.parentNode&&O.parentNode.removeChild(O)}}function oe(G,O,F){!function N(G,O){const F=document.createElement("a");F.setAttribute("href",G),F.setAttribute("download",O),F.style.display="none",document.body.appendChild(F),F.click(),document.body.removeChild(F)}(`data:${O},${encodeURIComponent(G)}`,F)}class B{static resolve(O,F){const Q=F.replace(/\[/g,".").replace(/\]/g,"").split(".");let r=O;for(;Q.length;){if("object"!=typeof r)return;r=r[Q.shift()]}return r}static isObject(O){return O&&"object"==typeof O&&!Array.isArray(O)&&null!==O&&!(O instanceof Date)}static mergeDeep(O,F,Q=!1){const r=Object.assign({},O);return B.isObject(O)&&B.isObject(F)&&Object.keys(F).filter(ie=>!Q||void 0!==F[ie]).forEach(ie=>{B.isObject(F[ie])?ie in O?r[ie]=B.mergeDeep(O[ie],F[ie],Q):Object.assign(r,{[ie]:F[ie]}):Object.assign(r,{[ie]:F[ie]})}),r}static copyDeep(O){const F=Array.isArray(O)?[]:{};for(const Q in O)if(O.hasOwnProperty(Q)){const r=O[Q];F[Q]=r&&"object"==typeof r?this.copyDeep(r):r}return F}static removeDuplicateCaseInsensitive(O){const F={},Q={},r=[];for(const ie in O)if(O.hasOwnProperty(ie)){const ae=ie.toUpperCase();F.hasOwnProperty(ae)?F[ae].push({[ie]:O[ie]}):F[ae]=[{[ie]:O[ie]}],r.push({key:ie,count:ie.replace(/[^A-Z]/g,"").length})}for(const ie in F)if(F.hasOwnProperty(ie)&&F.hasOwnProperty(ie)){const ae=F[ie];if(1===ae.length){const fe=ae[0];Q[ie]=fe[Object.keys(fe)[0]]}else if(ae.length>1){const fe=r.filter(le=>le.key.toLowerCase()===ie.toLowerCase()).reduce((le,ue)=>le.y<ue.y?le:ue);Q[fe.key.toUpperCase()]=O[fe.key]}}for(const ie in O)O.hasOwnProperty(ie)&&delete O[ie];for(const ie in Q)Q.hasOwnProperty(ie)&&(O[ie]=Q[ie])}static removeUndefined(O){const F={};return B.isObject(O)?(Object.keys(O).filter(Q=>void 0!==O[Q]).forEach(Q=>{F[Q]=B.isObject(O[Q])||Array.isArray(O[Q])?B.removeUndefined(O[Q]):O[Q]}),F):Array.isArray(O)?O.map(Q=>B.removeUndefined(Q)):O}static removeNull(O){const F={};return B.isObject(O)?(Object.keys(O).filter(Q=>null!==O[Q]).forEach(Q=>{F[Q]=B.isObject(O[Q])||Array.isArray(O[Q])?B.removeNull(O[Q]):O[Q]}),F):Array.isArray(O)?O.map(Q=>B.removeNull(Q)):O}static naturalCompare(O,F,Q="asc",r){if("desc"===Q&&(F=[O,O=F][0]),null===O||""===O||void 0===O||null===F||""===F||void 0===F){const fe=O===F?0:void 0===O?3:void 0===F?-3:null===O?2:null===F?-2:""===O?1:-1;return"desc"===Q?!1!==r?fe:-1*fe:!0===r?-1*fe:fe}const ie=[],ae=[];for(F=""+F,(O=""+O).replace(/(\d+)|(\D+)/g,(fe,le,ue)=>{ie.push([le||1/0,ue||""])}),F.replace(/(\d+)|(\D+)/g,(fe,le,ue)=>{ae.push([le||1/0,ue||""])});ie.length&&ae.length;){const fe=ie.shift(),le=ae.shift(),ue=fe[0]-le[0]||fe[1].localeCompare(le[1]);if(ue)return ue}return ie.length-ae.length}static objectsAreEquivalent(O,F){if(O===F)return!0;const Q=Object.getOwnPropertyNames(O),r=Object.getOwnPropertyNames(F);if(Q.length!==r.length)return!1;for(const ie of Q)if(O[ie]!==F[ie])return!1;return!0}static removeKeys(O,F){return Object.keys(O).filter(r=>F.indexOf(r)<0).reduce((r,ie)=>(r[ie]=O[ie],r),{})}static isEmpty(O){return 0===Object.keys(O).length}}class X{static roundToNDecimal(O,F=3){const Q=Math.pow(10,F);return Math.round(O*Q)/Q}}function V(G){return G.reduce((O,F)=>(O[F]=F,O),Object.create(null))}const z="assets/igo2/core/theming/prebuilt-themes",W="theme-styles";function A(G,O,F=z){const Q=`${F}/${O}.css`,r=G.getElementsByTagName("head")[0];let ie=G.getElementById(W);ie?ie.href=Q:function q(G,O,F){const Q=L.create(G,"link",{id:W,rel:"stylesheet",href:O});F.appendChild(Q)}(G,Q,r)}function _(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function u(){return`${_()}${_()}-${_()}-${_()}-${_()}-${_()}${_()}${_()}`.toLowerCase()}var S=s(61616),P=s(11484),I=function(G){return G[G.Error=0]="Error",G[G.Done=1]="Done",G[G.Working=2]="Working",G[G.Waiting=3]="Waiting",G}(I||{});class U{status$=new S.E;status$$;get status(){return this._status}set status(O){this._status=O,this.status$.next(O)}_status;subscribe(O,F){this.watch(),this.status$$=this.status$.pipe((0,P.a)()).subscribe(Q=>{this.handleStatusChange(Q),O.call(F,this)})}unsubscribe(){this.unwatch(),void 0!==this.status$$&&(this.status$$.unsubscribe(),this.status$$=void 0),this.status=I.Waiting}handleStatusChange(O){}}},40464:(Ee,ce,s)=>{"use strict";s.r(ce),s.d(ce,{routes:()=>yt});var y=s(21724),e=s(83600),d=s(21720),g=s(34896),R=s(33712);let o=(()=>{class Le extends d.kR{http;authService;tokenService;constructor(Se,Be,ze,St){super(Se),this.http=Be,this.authService=ze,this.tokenService=St,this.authService.authenticate$.subscribe(Dt=>{Dt&&this.options.url&&this.http.get(this.options.url).subscribe(mo=>{if(mo&&mo.preference)for(const Bo of Object.keys(mo.preference))super.set(Bo,mo.preference[Bo])})})}set(Se,Be,ze=d.Ab.LOCAL){if(ze===d.Ab.LOCAL&&this.authService.authenticated&&this.options.url){const St={};St[Se]=Be,this.http.patch(this.options.url,{preference:St}).subscribe()}super.set(Se,Be,ze)}remove(Se,Be=d.Ab.LOCAL){if(Be===d.Ab.LOCAL&&this.authService.authenticated&&this.options.url){const ze={};ze[Se]=void 0,this.http.patch(this.options.url,{preference:ze}).subscribe()}super.remove(Se,Be)}clear(Se=d.Ab.LOCAL){let Be;Se===d.Ab.LOCAL&&this.authService.authenticated&&this.options.url&&this.http.patch(this.options.url,{preference:{}},{params:{mergePreference:"false"}}).subscribe(),Se===d.Ab.LOCAL&&(Be=this.tokenService.get()),super.clear(Se),Be&&this.tokenService.set(Be),Se===d.Ab.LOCAL&&this.authService.authenticated&&this.options.url&&this.http.get(this.options.url).subscribe(ze=>{if(ze&&ze.preference)for(const St of Object.keys(ze.preference))super.set(St,ze.preference[St])})}static \u0275fac=function(Be){return new(Be||Le)(g.CoB(e.aW),g.CoB(R.KK),g.CoB(y.oj),g.CoB(y.mK))};static \u0275prov=g.wxM({token:Le,factory:Le.\u0275fac,providedIn:"root"})}return Le})();var h=s(65056),j=s(71904),x=s(34672),w=s(50244),b=s(32328),E=s(42536),T=s(94204),a=s(24708),K=s(72584);function M(Le,vt){if(1&Le){const Se=g.KQA();g.I0R(0,"button",8),g.qCj("click",function(){g.usT(Se);const ze=g.GaO();return g.CGJ(ze.loginAnonymous())}),g.OEk(1),g.wVc(2,"translate"),g.C$Y()}2&Le&&(g.yG2(),g.oRS(" ",g.kDX(2,1,"igo.auth.accessAnonymous")," "))}function L(Le,vt){if(1&Le&&(g.I0R(0,"div"),g.wR5(1,"br"),g.I0R(2,"font",9),g.OEk(3),g.C$Y()()),2&Le){const Se=g.GaO();g.yG2(3),g.cNF(Se.error)}}function oe(Le,vt){1&Le&&(g.I0R(0,"div",10),g.wR5(1,"mat-spinner",11),g.C$Y()),2&Le&&(g.yG2(),g.E7m("diameter",40))}let N=(()=>{class Le{auth;languageService;get allowAnonymous(){return this._allowAnonymous}set allowAnonymous(Se){this._allowAnonymous=Se}_allowAnonymous=!0;error="";form;loading=!1;login=new g._w7;constructor(Se,Be,ze){this.auth=Se,this.languageService=Be,this.form=ze.group({username:["",j.AQ.required],password:["",j.AQ.required]})}loginUser(Se){return this.loading=!0,this.auth.login(Se.username,Se.password).subscribe(()=>{this.login.emit(!0),this.loading=!1},Be=>{try{this.languageService.translate.get("igo.auth.error."+Be.error.message).subscribe(ze=>this.error=ze)}catch{this.error=Be.error.message}this.loading=!1}),!1}loginAnonymous(){this.auth.loginAnonymous().subscribe(()=>{this.login.emit(!0)})}static \u0275fac=function(Be){return new(Be||Le)(g.GI1(y.oj),g.GI1(a.ov),g.GI1(j.KE))};static \u0275cmp=g.In1({type:Le,selectors:[["igo-auth-intern"]],inputs:{allowAnonymous:"allowAnonymous"},outputs:{login:"login"},standalone:!0,features:[g.UHJ],decls:21,vars:19,consts:[["role","form",3,"formGroup","ngSubmit"],[1,"full-width"],["matInput","","required","","formControlName","username",3,"placeholder"],["matInput","","required","","type","password","formControlName","password",3,"placeholder"],["mat-raised-button","","type","submit"],["mat-raised-button","","class","anonymous","type","button",3,"click",4,"ngIf"],[4,"ngIf"],["class","loading-container",4,"ngIf"],["mat-raised-button","","type","button",1,"anonymous",3,"click"],["size","3","color","red"],[1,"loading-container"],[3,"diameter"]],template:function(Be,ze){1&Be&&(g.I0R(0,"form",0),g.qCj("ngSubmit",function(){return ze.loginUser(ze.form.value)}),g.I0R(1,"div")(2,"mat-form-field",1)(3,"mat-label"),g.OEk(4),g.wVc(5,"translate"),g.C$Y(),g.wR5(6,"input",2),g.wVc(7,"translate"),g.C$Y()(),g.I0R(8,"div")(9,"mat-form-field",1)(10,"mat-label"),g.OEk(11),g.wVc(12,"translate"),g.C$Y(),g.wR5(13,"input",3),g.wVc(14,"translate"),g.C$Y()(),g.I0R(15,"button",4),g.OEk(16),g.wVc(17,"translate"),g.C$Y(),g.yuY(18,M,3,3,"button",5)(19,L,4,1,"div",6),g.C$Y(),g.yuY(20,oe,2,1,"div",7)),2&Be&&(g.E7m("formGroup",ze.form),g.yG2(4),g.cNF(g.kDX(5,9,"igo.auth.user")),g.yG2(2),g._6D("placeholder",g.kDX(7,11,"igo.auth.user")),g.yG2(5),g.cNF(g.kDX(12,13,"igo.auth.password")),g.yG2(2),g._6D("placeholder",g.kDX(14,15,"igo.auth.password")),g.yG2(3),g.oRS(" ",g.kDX(17,17,"igo.auth.login")," "),g.yG2(2),g.E7m("ngIf",ze.allowAnonymous),g.yG2(),g.E7m("ngIf",ze.error),g.yG2(),g.E7m("ngIf",ze.loading))},dependencies:[j.y,j.sz,j.ot,j.ue,j.u,j.eJ,j.sl,j.uW,j.Wo,w.wb,w.Up,w.w5,E.cN,E.yi,x.oJ,x.Gw,T.cm,h.u_,K.O0,K.sD],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.anonymous[_ngcontent-%COMP%]{margin-left:10px}.loading-container[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:1000;top:0;left:0;padding:24px;box-sizing:border-box}"]})}return Le})();var B=s(38460),X=s(28452),V=s(85696),z=s(35392),W=s(98988),A=s(61616),q=s(6560),_=s(94364);let u=(()=>{class Le{authService;config;appRef;msalService;msalGuardConfig;options;_destroying$=new A.E;login=new g._w7;broadcastService;constructor(Se,Be,ze,St,Dt){this.authService=Se,this.config=Be,this.appRef=ze,this.msalService=St,this.msalGuardConfig=Dt,this.options=this.config.getConfig("auth.microsoft"),this.msalService.instance=new X.u({auth:this.options,cache:{cacheLocation:"sessionStorage"}}),this.broadcastService=new B.K2(this.msalService.instance,this.msalService),this.options?.clientId?this.broadcastService.inProgress$.pipe((0,q.I)(mo=>mo===V.Yz.None),(0,_.a)(this._destroying$)).subscribe(()=>{this.checkAccount()}):console.warn('Microsoft authentification needs "clientId" option')}loginMicrosoft(){this.msalService.loginPopup({...this.getConf().authRequest}).subscribe(Se=>{this.msalService.instance.setActiveAccount(Se.account),this.checkAccount()})}checkAccount(){var Se=this;this.msalService.instance.acquireTokenSilent(this.getConf().authRequest).then(Be=>{this.authService.loginWithToken(Be.accessToken,"microsoft",{tokenId:Be.idToken}).subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}).catch(function(){var Be=(0,z.c)(function*(ze){if(ze instanceof W.uw)return Se.msalService.acquireTokenPopup(Se.getConf().authRequest);console.log(ze)});return function(ze){return Be.apply(this,arguments)}}()).catch(Be=>{console.log("Silent token fails")})}getConf(){return this.msalGuardConfig.filter(Se=>"add"===Se.type)[0]}static \u0275fac=function(Be){return new(Be||Le)(g.GI1(y.oj),g.GI1(e.aW),g.GI1(g.Swk),g.GI1(B.xX),g.GI1(B.mg))};static \u0275cmp=g.In1({type:Le,selectors:[["igo-auth-microsoft"]],outputs:{login:"login"},standalone:!0,features:[g.UHJ],decls:4,vars:3,consts:[["mat-raised-button","",1,"microsoft-login-button",3,"click"],["svgIcon","microsoft"]],template:function(Be,ze){1&Be&&(g.I0R(0,"button",0),g.qCj("click",function(){return ze.loginMicrosoft()}),g.wR5(1,"mat-icon",1),g.OEk(2),g.wVc(3,"translate"),g.C$Y()),2&Be&&(g.yG2(2),g.oRS(" ",g.kDX(3,1,"igo.auth.microsoft.login"),"\n"))},dependencies:[x.oJ,x.Gw,b.oB,b.qL,K.O0,K.sD],styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-15px}[_nghost-%COMP%] > button[_ngcontent-%COMP%]{font-size:15px;height:40px;width:265px}mat-icon[_ngcontent-%COMP%]{margin-right:10px}"],changeDetection:0})}return Le})();var S=s(31752),P=s(54844),I=s(7080);let U=(()=>{class Le{instance;location;redirectHash;logger;name="@azure/msal-angular";version="2.0.0-beta.2";constructor(Se,Be){this.instance=Se,this.location=Be;const ze=this.location.path(!0).split("#").pop();ze&&(this.redirectHash=`#${ze}`),this.instance.initializeWrapperLibrary(V.Lm.Angular,this.version)}initialize(){return(0,I.Q)(this.instance.initialize())}acquireTokenPopup(Se){return(0,I.Q)(this.instance.acquireTokenPopup(Se))}acquireTokenRedirect(Se){return(0,I.Q)(this.instance.acquireTokenRedirect(Se))}acquireTokenSilent(Se){return(0,I.Q)(this.instance.acquireTokenSilent(Se))}handleRedirectObservable(Se){return(0,I.Q)(this.instance.handleRedirectPromise(Se||this.redirectHash))}loginPopup(Se){return(0,I.Q)(this.instance.loginPopup(Se))}loginRedirect(Se){return(0,I.Q)(this.instance.loginRedirect(Se))}logout(Se){return(0,I.Q)(this.instance.logout(Se))}logoutRedirect(Se){return(0,I.Q)(this.instance.logoutRedirect(Se))}logoutPopup(Se){return(0,I.Q)(this.instance.logoutPopup(Se))}ssoSilent(Se){return(0,I.Q)(this.instance.ssoSilent(Se))}getLogger(){return this.logger||(this.logger=this.instance.getLogger().clone(this.name,this.version)),this.logger}setLogger(Se){this.logger=Se.clone(this.name,this.version),this.instance.setLogger(Se)}static \u0275fac=function(Be){return new(Be||Le)(g.CoB(B.IN),g.CoB(h.oB))};static \u0275prov=g.wxM({token:Le,factory:Le.\u0275fac})}return Le})(),G=(()=>{class Le{msalInstance;authService;_msalSubject;msalSubject$;_inProgress;inProgress$;constructor(Se,Be){this.msalInstance=Se,this.authService=Be,this._msalSubject=new A.E,this.msalSubject$=this._msalSubject.asObservable(),this._inProgress=new P.g(V.Yz.Startup),this.inProgress$=this._inProgress.asObservable(),this.msalInstance.addEventCallback(ze=>{this._msalSubject.next(ze);const St=S.M.getInteractionStatusFromEvent(ze);null!==St&&(this.authService.getLogger().verbose(`BroadcastService - ${ze.eventType} results in setting inProgress to ${St}`),this._inProgress.next(St))})}static \u0275fac=function(Be){return new(Be||Le)(g.CoB(B.IN),g.CoB(U))};static \u0275prov=g.wxM({token:Le,factory:Le.\u0275fac})}return Le})(),O=(()=>{class Le{authService;config;appRef;msalService;msalGuardConfig;options;_destroying$=new A.E;login=new g._w7;broadcastService;constructor(Se,Be,ze,St,Dt){this.authService=Se,this.config=Be,this.appRef=ze,this.msalService=St,this.msalGuardConfig=Dt,this.options=this.config.getConfig("auth.microsoftb2c")||{},this.msalService.instance=new X.u({auth:this.options.browserAuthOptions,cache:{cacheLocation:"sessionStorage"}}),this.broadcastService=new G(this.msalService.instance,this.msalService),this.options.browserAuthOptions.clientId?this.broadcastService.inProgress$.pipe((0,q.I)(mo=>mo===V.Yz.None),(0,_.a)(this._destroying$)).subscribe(()=>{this.checkAccount()}):console.warn('Microsoft authentification needs "clientId" option')}loginMicrosoftb2c(){this.msalService.loginPopup({...this.getConf().authRequest}).subscribe(Se=>{this.msalService.instance.setActiveAccount(Se.account),this.checkAccount()})}checkAccount(){var Se=this;this.msalService.instance.acquireTokenSilent(this.getConf().authRequest).then(Be=>{this.authService.loginWithToken(Be.idToken,"microsoftb2c").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}).catch(function(){var Be=(0,z.c)(function*(ze){if(ze instanceof W.uw)return Se.msalService.acquireTokenPopup(Se.getConf().authRequest)});return function(ze){return Be.apply(this,arguments)}}()).catch(Be=>{console.log("Silent token fails")})}getConf(){return this.msalGuardConfig.filter(Se=>"b2c"===Se.type)[0]}static \u0275fac=function(Be){return new(Be||Le)(g.GI1(y.oj),g.GI1(e.aW),g.GI1(g.Swk),g.GI1(U),g.GI1(B.mg))};static \u0275cmp=g.In1({type:Le,selectors:[["igo-auth-microsoftb2c"]],outputs:{login:"login"},standalone:!0,features:[g.M5G([U]),g.UHJ],decls:4,vars:3,consts:[["mat-raised-button","",1,"microsoft-login-button",3,"click"],["svgIcon","microsoft"]],template:function(Be,ze){1&Be&&(g.I0R(0,"button",0),g.qCj("click",function(){return ze.loginMicrosoftb2c()}),g.wR5(1,"mat-icon",1),g.OEk(2),g.wVc(3,"translate"),g.C$Y()),2&Be&&(g.yG2(2),g.oRS(" ",g.kDX(3,1,"igo.auth.microsoftb2c.login"),"\n"))},dependencies:[x.oJ,x.Gw,b.oB,b.qL,K.O0,K.sD],styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-15px}[_nghost-%COMP%] > button[_ngcontent-%COMP%]{font-size:15px;height:40px;width:265px}mat-icon[_ngcontent-%COMP%]{margin-right:10px}"],changeDetection:0})}return Le})();function Q(Le){const vt=Le.getConfig("auth.microsoft");return vt.redirectUri=vt?.redirectUri||window.location.href,vt.authority=vt?.authority||"https://login.microsoftonline.com/organizations",new X.u({auth:vt,cache:{cacheLocation:"sessionStorage"}})}function r(Le){const vt=Le.getConfig("auth.microsoftb2c.browserAuthOptions");return vt.redirectUri=vt?.redirectUri||window.location.href,vt.authority=vt?.authority||"https://login.microsoftonline.com/organizations",new X.u({auth:vt,cache:{cacheLocation:"sessionStorage"}})}function ie(Le){return Le.getConfig("auth.microsoft"),{interactionType:V.wV.Popup,authRequest:{scopes:["user.read"],loginHint:"todo"},type:"add"}}function ae(Le){const vt=Le.getConfig("auth.microsoftb2c.browserAuthOptions");return{interactionType:V.wV.Popup,authRequest:{scopes:[vt?.clientId]},type:"b2c"}}function fe(Le){return"b2c"===Le?[{provide:B.IN,useFactory:r,deps:[e.aW]},{provide:B.mg,useFactory:ae,deps:[e.aW],multi:!0},U]:[{provide:B.IN,useFactory:Q,deps:[e.aW]},{provide:B.mg,useFactory:ie,deps:[e.aW],multi:!0},B.xX]}var le=s(57880);let ue=(()=>{class Le{authService;config;appRef;options;login=new g._w7;constructor(Se,Be,ze){this.authService=Se,this.config=Be,this.appRef=ze,this.options=this.config.getConfig("auth.facebook"),this.options?.appId?this.loadSDKFacebook():console.warn('Facebook authentification needs "appId" option')}subscribeEvents(){window.FB.Event.subscribe("auth.statusChange",Se=>{this.statusChangeCallback(Se)})}statusChangeCallback(Se){"connected"===Se.status&&this.loginFacebook(Se.authResponse.accessToken)}loginFacebook(Se){this.authService.loginWithToken(Se,"facebook").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}loadSDKFacebook(){if(document.getElementById("facebook-jssdk"))return;const Be=document.getElementsByTagName("script")[0],ze=document.createElement("script");ze.id="facebook-jssdk",ze.src=`https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9&appId=${this.options?.appId}`,ze.onload=()=>{this.subscribeEvents()},Be.parentNode.insertBefore(ze,Be)}static \u0275fac=function(Be){return new(Be||Le)(g.GI1(y.oj),g.GI1(e.aW),g.GI1(g.Swk))};static \u0275cmp=g.In1({type:Le,selectors:[["igo-auth-facebook"]],outputs:{login:"login"},standalone:!0,features:[g.UHJ],decls:1,vars:0,consts:[["scope","public_profile,email","data-max-rows","1","data-size","large","data-button-type","login_with","data-show-faces","false","data-auto-logout-link","false","data-use-continue-as","false",1,"fb-login-button"]],template:function(Be,ze){1&Be&&g.wR5(0,"div",0)},styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-3px}"],changeDetection:0})}return Le})(),se=(()=>{class Le{authService;config;languageService;appRef;options;login=new g._w7;constructor(Se,Be,ze,St){this.authService=Se,this.config=Be,this.languageService=ze,this.appRef=St,this.options=this.config.getConfig("auth.google"),this.options?.apiKey&&this.options?.clientId?(this.loadSDKGoogle(),this.loadPlatform()):console.warn('Google authentification needs "apiKey" and "clientId" options')}handleSignInClick(){window.gapi.auth2.getAuthInstance().signIn()}handleSignOutClick(){window.gapi.auth2.getAuthInstance().signOut()}handleClientLoad(){window.gapi.load("client:auth2",()=>this.initClient())}initClient(){window.gapi.client.init({apiKey:this.options?.apiKey,clientId:this.options?.clientId,discoveryDocs:["https://people.googleapis.com/$discovery/rest?version=v1"],scope:"profile"}).then(()=>{this.handleSignOutClick(),this.updateTextButton(),window.gapi.auth2.getAuthInstance().isSignedIn.listen(Se=>{this.updateSigninStatus(Se)})})}updateSigninStatus(Se){this.updateTextButton(),Se&&this.loginGoogle(window.gapi.client.getToken().access_token)}updateTextButton(){const Se=document.querySelector('span[id^="not_signed_"]');Se&&"en"!==this.languageService.getLanguage()&&("Sign in with Google"===Se.innerHTML?Se.innerHTML=this.languageService.translate.instant("igo.auth.google.login"):"Signed in with Google"===Se.innerHTML&&(Se.innerHTML=this.languageService.translate.instant("igo.auth.google.logged")))}loginGoogle(Se){this.authService.loginWithToken(Se,"google").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}loadSDKGoogle(){const Se=document.getElementsByTagName("script")[0],Be=document.createElement("script");Be.id="google-jssdk",Be.src="https://apis.google.com/js/api.js",Be.onload=()=>{this.handleClientLoad()},Se.parentNode.insertBefore(Be,Se)}loadPlatform(){const Se=document.getElementsByTagName("script")[0],Be=document.createElement("script");Be.id="google-platform",Be.src="https://apis.google.com/js/platform.js",Se.parentNode.insertBefore(Be,Se)}static \u0275fac=function(Be){return new(Be||Le)(g.GI1(y.oj),g.GI1(e.aW),g.GI1(a.ov),g.GI1(g.Swk))};static \u0275cmp=g.In1({type:Le,selectors:[["igo-auth-google"]],outputs:{login:"login"},standalone:!0,features:[g.UHJ],decls:1,vars:0,consts:[["data-height","40","data-width","265","data-longtitle","true",1,"g-signin2","google-login-button"]],template:function(Be,ze){1&Be&&g.wR5(0,"div",0)},styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block}.google-login-button[_ngcontent-%COMP%]     .abcRioButton{color:#000000de}"],changeDetection:0})}return Le})();function ge(Le,vt){1&Le&&g.wR5(0,"div",3)}function Ie(Le,vt){if(1&Le){const Se=g.KQA();g.I0R(0,"igo-auth-google",7),g.qCj("login",function(){g.usT(Se);const ze=g.GaO(3);return g.CGJ(ze.onLogin())}),g.C$Y()}}function Re(Le,vt){if(1&Le){const Se=g.KQA();g.I0R(0,"igo-auth-microsoft",7),g.qCj("login",function(){g.usT(Se);const ze=g.GaO(3);return g.CGJ(ze.onLogin())}),g.C$Y()}}function He(Le,vt){if(1&Le){const Se=g.KQA();g.I0R(0,"igo-auth-microsoftb2c",7),g.qCj("login",function(){g.usT(Se);const ze=g.GaO(3);return g.CGJ(ze.onLogin())}),g.C$Y()}}function ht(Le,vt){if(1&Le){const Se=g.KQA();g.I0R(0,"igo-auth-facebook",7),g.qCj("login",function(){g.usT(Se);const ze=g.GaO(3);return g.CGJ(ze.onLogin())}),g.C$Y()}}function rt(Le,vt){if(1&Le){const Se=g.KQA();g.I0R(0,"igo-auth-intern",8),g.qCj("login",function(){g.usT(Se);const ze=g.GaO(3);return g.CGJ(ze.onLogin())}),g.C$Y()}if(2&Le){const Se=g.GaO(3);g.E7m("allowAnonymous",Se.options.allowAnonymous)}}function xt(Le,vt){if(1&Le&&(g.I0R(0,"div",4)(1,"h1"),g.OEk(2),g.wVc(3,"translate"),g.C$Y(),g.yuY(4,Ie,1,0,"igo-auth-google",5)(5,Re,1,0,"igo-auth-microsoft",5)(6,He,1,0,"igo-auth-microsoftb2c",5)(7,ht,1,0,"igo-auth-facebook",5)(8,rt,1,1,"igo-auth-intern",6),g.C$Y()),2&Le){const Se=g.GaO(2);g.yG2(2),g.cNF(g.kDX(3,6,"igo.auth.connection")),g.yG2(2),g.E7m("ngIf",Se.options.google&&!1!==Se.options.google.enabled),g.yG2(),g.E7m("ngIf",Se.options.microsoft&&!1!==Se.options.microsoft.enabled),g.yG2(),g.E7m("ngIf",Se.options.microsoftb2c&&!1!==Se.options.microsoftb2c.enabled),g.yG2(),g.E7m("ngIf",Se.options.facebook&&!1!==Se.options.facebook.enabled),g.yG2(),g.E7m("ngIf",!Se.options.intern||!1!==Se.options.intern.enabled)}}function Rt(Le,vt){if(1&Le){const Se=g.KQA();g.I0R(0,"div",4)(1,"p"),g.OEk(2),g.wVc(3,"translate"),g.C$Y(),g.I0R(4,"button",9),g.qCj("click",function(){g.usT(Se);const ze=g.GaO(2);return g.CGJ(ze.logout())}),g.OEk(5),g.wVc(6,"translate"),g.C$Y()()}if(2&Le){const Se=g.GaO(2);g.yG2(2),g.cNF(g.g7$(3,2,"igo.auth.welcome",Se.user)),g.yG2(3),g.oRS(" ",g.kDX(6,5,"igo.auth.signOut")," ")}}function Ze(Le,vt){if(1&Le){const Se=g.KQA();g.I0R(0,"button",9),g.qCj("click",function(){g.usT(Se);const ze=g.GaO(3);return g.CGJ(ze.home())}),g.OEk(1),g.wVc(2,"translate"),g.C$Y()}2&Le&&(g.yG2(),g.oRS(" ",g.kDX(2,1,"igo.auth.home")," "))}function Kt(Le,vt){if(1&Le&&(g.I0R(0,"div",4)(1,"p"),g.OEk(2),g.wVc(3,"translate"),g.C$Y(),g.yuY(4,Ze,3,3,"button",10),g.C$Y()),2&Le){const Se=g.GaO(2);g.yG2(2),g.cNF(g.kDX(3,2,"igo.auth.deconnection")),g.yG2(2),g.E7m("ngIf",Se.options.homeRoute)}}function ve(Le,vt){if(1&Le&&(g.I0R(0,"div"),g.yuY(1,ge,1,0,"div",1)(2,xt,9,8,"div",2)(3,Rt,7,7,"div",2)(4,Kt,5,4,"div",2),g.C$Y()),2&Le){const Se=g.GaO();g.yG2(),g.E7m("ngIf",!Se.auth.logged&&Se.backgroundDisable),g.yG2(),g.E7m("ngIf",!Se.auth.logged&&Se.showLoginDiv),g.yG2(),g.E7m("ngIf",Se.auth.logged&&Se.showAlreadyConnectedDiv),g.yG2(),g.E7m("ngIf",Se.showLogoutDiv)}}let $e=(()=>{class Le{auth;config;router;get backgroundDisable(){return!this.isLogoutRoute&&!this.isLogoutRoute&&this._backgroundDisable}set backgroundDisable(Se){this._backgroundDisable="true"===Se.toString()}_backgroundDisable=!0;get hasAlreadyConnectedDiv(){return this._hasAlreadyConnectedDiv}set hasAlreadyConnectedDiv(Se){this._hasAlreadyConnectedDiv="true"===Se.toString()}_hasAlreadyConnectedDiv=!0;get hasLogoutDiv(){return this._hasLogoutDiv}set hasLogoutDiv(Se){this._hasLogoutDiv="true"===Se.toString()}_hasLogoutDiv=!0;get showAlreadyConnectedDiv(){return this.isLogoutRoute?this.hasAlreadyConnectedDiv:this._showAlreadyConnectedDiv}set showAlreadyConnectedDiv(Se){this._showAlreadyConnectedDiv="true"===Se.toString()}_showAlreadyConnectedDiv=!1;get showLogoutDiv(){return this.isLogoutRoute?this.hasLogoutDiv:this._showLogoutDiv}set showLogoutDiv(Se){this._showLogoutDiv="true"===Se.toString()}_showLogoutDiv=!1;get showLoginDiv(){if(!this.isLogoutRoute)return!0}login=new g._w7;options;user;visible=!0;isLogoutRoute;constructor(Se,Be,ze){this.auth=Se,this.config=Be,this.router=ze,this.options=this.config.getConfig("auth"),this.visible=0!==Object.getOwnPropertyNames(this.options).length}ngOnInit(){this.analyzeRoute(),this.getName()}onLogin(){this.auth.goToRedirectUrl(),this.getName(),this.login.emit(!0)}logout(){this.auth.logout().subscribe(()=>{this.user=void 0,this.router&&(this.options?.logoutRoute?this.router.navigate([this.options?.logoutRoute]):this.options?.homeRoute&&this.router.navigate([this.options?.homeRoute]))})}home(){this.router&&this.options?.homeRoute&&this.router.navigate([this.options?.homeRoute])}getName(){const Se=this.auth.decodeToken();Se&&(this.user={name:Se.user.firstName||Se.user.sourceId})}analyzeRoute(){this.router&&this.router.events.pipe((0,q.I)(Se=>Se instanceof le.Qx)).subscribe(Se=>{if(Se.url){const Be=Se.url,ze=this.options?.logoutRoute;this.isLogoutRoute=Be===ze,this.isLogoutRoute&&this.auth.logout()}})}static \u0275fac=function(Be){return new(Be||Le)(g.GI1(y.oj),g.GI1(e.aW),g.GI1(le.E5,8))};static \u0275cmp=g.In1({type:Le,selectors:[["igo-auth-form"]],inputs:{backgroundDisable:"backgroundDisable",hasAlreadyConnectedDiv:"hasAlreadyConnectedDiv",hasLogoutDiv:"hasLogoutDiv",showAlreadyConnectedDiv:"showAlreadyConnectedDiv",showLogoutDiv:"showLogoutDiv"},outputs:{login:"login"},standalone:!0,features:[g.UHJ],decls:1,vars:1,consts:[[4,"ngIf"],["class","backgroundDisable",4,"ngIf"],["class","login center-block",4,"ngIf"],[1,"backgroundDisable"],[1,"login","center-block"],[3,"login",4,"ngIf"],[3,"allowAnonymous","login",4,"ngIf"],[3,"login"],[3,"allowAnonymous","login"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button",3,"click",4,"ngIf"]],template:function(Be,ze){1&Be&&g.yuY(0,ve,5,4,"div",0),2&Be&&g.E7m("ngIf",ze.visible)},dependencies:[h.u_,se,u,O,ue,N,x.oJ,x.Gw,K.O0,K.sD],styles:["[_nghost-%COMP%]{z-index:999}div.login[_ngcontent-%COMP%]{z-index:200;width:90%;min-width:360px;max-width:600px;padding:25px 50px;border:1px solid;background-color:#fff;border-color:#888}.center-block[_ngcontent-%COMP%]{position:fixed;top:20%;left:50%;transform:translate(-50%)}.backgroundDisable[_ngcontent-%COMP%]{position:fixed;top:0;left:0;background:#000;opacity:.8;z-index:100;height:100%;width:100%}"]})}return Le})(),Ne=(()=>{class Le{static forRoot(){return{ngModule:Le,providers:[{provide:R.So,useClass:y.kT,multi:!0},{provide:d.yQ,useClass:o},...fe("add"),...fe("b2c")]}}static \u0275fac=function(Be){return new(Be||Le)};static \u0275mod=g.a4G({type:Le});static \u0275inj=g.s3X({imports:[h.MD,j.sl,w.wb,E.cN,b.oB,T.kB,x.oJ,a._s,B.IL,$e,N,u,O]})}return Le})();var Ae=s(32688),dt=s(51100);const je=()=>["ConfigService","LanguageService"],yt=[{path:"",redirectTo:"form",pathMatch:"full"},{title:"Authentification",path:"form",component:(()=>{class Le{constructor(){}static \u0275fac=function(Be){return new(Be||Le)};static \u0275cmp=g.In1({type:Le,selectors:[["app-auth-form"]],standalone:!0,features:[g.UHJ],decls:4,vars:2,consts:[["title","Authentification","subtitle","Auth",3,"dependencies"],["codeFolder","auth/auth-form","configFolder","environments"]],template:function(Be,ze){1&Be&&(g.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1),g.OEk(2," The dialog opens automatically if you are not logged in "),g.C$Y()(),g.wR5(3,"igo-auth-form")),2&Be&&g.E7m("dependencies",g.q4q(1,je))},dependencies:[Ae.u,dt.I,Ne,$e],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return Le})()}]},97180:(Ee,ce,s)=>{"use strict";s.r(ce),s.d(ce,{routes:()=>O});var y=s(62228),e=s(9588),d=s(54844),g=s(32688),R=s(51100),o=s(34896),h=s(23416);let j=(()=>{class F{overlay;mediaService;store=new y.MF([]);added$=new d.g(!1);get actionbarMode(){return this.mediaService.media$.value===e.oZ.Desktop&&this.mediaService.orientation$.value===e.cz.Landscape?y.m0.Dock:y.m0.Overlay}constructor(r,ie){this.overlay=r,this.mediaService=ie}ngOnInit(){this.store.load([{id:"add",title:"Add",icon:"plus",tooltip:"Add Tooltip",handler:()=>{alert("Add!"),this.added$.next(!0)}},{id:"edit",title:"Edit",icon:"pencil",tooltip:"Edit Tooltip",args:["1"],handler:r=>{alert(`Edit item ${r}!`)},availability:()=>this.added$},{id:"delete",title:"Delete",tooltip:"Delete Tooltip",icon:"delete",handler:()=>{alert("Delete!"),this.added$.next(!1)},availability:()=>this.added$}])}ngOnDestroy(){this.store.destroy()}static \u0275fac=function(ie){return new(ie||F)(o.GI1(h.mc),o.GI1(e.QB))};static \u0275cmp=o.In1({type:F,selectors:[["app-action"]],standalone:!0,features:[o.UHJ],decls:3,vars:5,consts:[["title","Action","subtitle","Common"],["title","Action Bar","codeFolder","common/action"],[3,"store","withIcon","withTitle","horizontal","mode"]],template:function(ie,ae){1&ie&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1),o.wR5(2,"igo-actionbar",2),o.C$Y()()),2&ie&&(o.yG2(2),o.E7m("store",ae.store)("withIcon",!0)("withTitle","overlay"===ae.actionbarMode)("horizontal",!0)("mode",ae.actionbarMode))},dependencies:[g.u,R.I,y.AI],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return F})();var x=s(71904),w=s(34672),b=s(75180),E=s(64080);let T=(()=>{class F{confirmDialogService;selectValueDialogService;jsonDialogService;formDialogService;constructor(r,ie,ae,fe){this.confirmDialogService=r,this.selectValueDialogService=ie,this.jsonDialogService=ae,this.formDialogService=fe}confirm(){this.confirmDialogService.open("Do you want to continue?").subscribe(r=>{alert(`Your choice is: ${r}`)})}yesno(){this.confirmDialogService.open("Is the sky blue today? ",{modeYesNo:!0}).subscribe(r=>{alert(`Your choice is: ${r}`)})}select(r){this.selectValueDialogService.open([{value:"1",title:"Chocolate"},{value:"2",title:"Candy"},{value:3,title:"Cake"}],{type:r}).subscribe(ae=>{ae?.choices&&(ae.choices.length>1?alert(`Your choice(s) are: ${ae.choices}`):alert(`Your choice is: ${ae.choices}`))})}check(){this.select(E.H.Checkbox)}radio(){this.select(E.H.Radio)}json(){this.jsonDialogService.open("A JSON viewer",{isbn:"123-456-222",author:{lastname:"Doe",firstname:"Jane"},editor:{lastname:"Smith",firstname:"Jane"},title:"The Ultimate Database Study Guide",category:["Non-Fiction","Technology"]},["category"])}form(){this.formDialogService.open({formFieldConfigs:[{name:"country",title:"Country",options:{cols:1}}],formGroupsConfigs:[{name:"country",formFieldConfigs:[{name:"city",title:"City",options:{cols:1}}]},{name:"city",formFieldConfigs:[{name:"id",title:"ID",options:{cols:1,validator:x.AQ.required}},{name:"name",title:"Name",options:{cols:1,validator:x.AQ.required}},{name:"status",title:"Status",type:"select",options:{cols:2},inputs:{choices:[{value:1,title:"Single"},{value:2,title:"Married"}]}}]}]},{minWidth:"50vh"}).subscribe(le=>{le&&alert(JSON.stringify(le))})}email(){const r=[{name:"email",title:"Email",options:{cols:2,validator:x.AQ.compose([x.AQ.required,x.AQ.email])}},{name:"password",title:"Password",options:{cols:2,validator:x.AQ.required},inputs:{isPassword:!0}}];this.formDialogService.open({formFieldConfigs:r}).subscribe(ie=>{ie&&(ie.password="\xb0\xb0\xb0\xb0\xb0\xb0\xb0\xb0\xb0\xb0",alert(JSON.stringify(ie)))})}static \u0275fac=function(ie){return new(ie||F)(o.GI1(y.Ex),o.GI1(y.hj),o.GI1(y.gl),o.GI1(y.AB))};static \u0275cmp=o.In1({type:F,selectors:[["app-dialog"]],standalone:!0,features:[o.UHJ],decls:35,vars:0,consts:[["title","Various dialogs","subtitle","Common"],["codeFolder","common/dialog"],[1,"example-label"],[1,"example-button-row"],["mat-flat-button","","type","button","color","primary",3,"click"]],template:function(ie,ae){1&ie&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"section")(3,"div",2),o.OEk(4,"Confirmation"),o.C$Y(),o.I0R(5,"div",3)(6,"button",4),o.qCj("click",function(){return ae.confirm()}),o.OEk(7," Base dialog "),o.C$Y(),o.I0R(8,"button",4),o.qCj("click",function(){return ae.yesno()}),o.OEk(9," Yes/no confirm dialog "),o.C$Y()()(),o.wR5(10,"mat-divider"),o.I0R(11,"section")(12,"div",2),o.OEk(13,"Custom selectors"),o.C$Y(),o.I0R(14,"div",3)(15,"button",4),o.qCj("click",function(){return ae.check()}),o.OEk(16," Open a dialog to select values by checkboxes "),o.C$Y(),o.I0R(17,"button",4),o.qCj("click",function(){return ae.radio()}),o.OEk(18," Open a dialog to select values by radio buttons "),o.C$Y()()(),o.wR5(19,"mat-divider"),o.I0R(20,"section")(21,"div",2),o.OEk(22,"Form based"),o.C$Y(),o.I0R(23,"div",3)(24,"button",4),o.qCj("click",function(){return ae.form()}),o.OEk(25," Basic form "),o.C$Y(),o.I0R(26,"button",4),o.qCj("click",function(){return ae.email()}),o.OEk(27," Email "),o.C$Y()()(),o.wR5(28,"mat-divider"),o.I0R(29,"section")(30,"div",2),o.OEk(31,"Renderer"),o.C$Y(),o.I0R(32,"div",3)(33,"button",4),o.qCj("click",function(){return ae.json()}),o.OEk(34," Open a dialog to open a json "),o.C$Y()()()()())},dependencies:[g.u,R.I,y.uK,y.Gq,y.OE,y.YN,w.oJ,w.Gw,b.U,b.k],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}.example-label[_ngcontent-%COMP%]{display:table-cell;font-size:14px;margin-left:8px;min-width:120px}.example-button-row[_ngcontent-%COMP%]{display:table-cell;max-width:600px}.example-button-row[_ngcontent-%COMP%]   .mat-mdc-button-base[_ngcontent-%COMP%]{margin:8px 8px 8px 0}"]})}return F})(),a=(()=>{class F{cdRef;name;constructor(r){this.cdRef=r}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(ie){return new(ie||F)(o.GI1(o.kD9))};static \u0275cmp=o.In1({type:F,selectors:[["app-salutation-component"]],inputs:{name:"name"},standalone:!0,features:[o.UHJ],decls:2,vars:1,template:function(ie,ae){1&ie&&(o.I0R(0,"p"),o.OEk(1),o.C$Y()),2&ie&&(o.yG2(),o.oRS("Hello, my name is ",ae.name,"."))},encapsulation:2,changeDetection:0})}return F})(),K=(()=>{class F{cdRef;constructor(r){this.cdRef=r}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(ie){return new(ie||F)(o.GI1(o.kD9))};static \u0275cmp=o.In1({type:F,selectors:[["app-explanation-component"]],standalone:!0,features:[o.UHJ],decls:2,vars:0,template:function(ie,ae){1&ie&&(o.I0R(0,"p"),o.OEk(1,"I am a dynamic component, rendered into an IgoDynamicOutlet."),o.C$Y())},encapsulation:2,changeDetection:0})}return F})(),M=(()=>{class F{component=a;inputs={name:"Bob"};toggleComponent(){this.component=this.component===a?K:a}static \u0275fac=function(ie){return new(ie||F)};static \u0275cmp=o.In1({type:F,selectors:[["app-dynamic-component"]],standalone:!0,features:[o.UHJ],decls:5,vars:2,consts:[["title","Dynamic Component","subtitle","Common"],["codeFolder","common/dynamic-component"],[3,"component","inputs"],["mat-flat-button","","color","primary",3,"click"]],template:function(ie,ae){1&ie&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1),o.wR5(2,"igo-dynamic-outlet",2),o.I0R(3,"button",3),o.qCj("click",function(){return ae.toggleComponent()}),o.OEk(4," Toggle Component "),o.C$Y()()()),2&ie&&(o.yG2(2),o.E7m("component",ae.component)("inputs",ae.inputs))},dependencies:[g.u,R.I,y.qm,w.oJ,w.Gw],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return F})();var L=s(65056);function oe(F,Q){if(1&F&&(o.I0R(0,"div")(1,"p"),o.OEk(2),o.wVc(3,"async"),o.C$Y(),o.I0R(4,"p"),o.OEk(5),o.wVc(6,"async"),o.C$Y(),o.I0R(7,"p"),o.OEk(8,"Description: "),o.wR5(9,"span",4),o.wVc(10,"async"),o.C$Y()()),2&F){const r=o.GaO();o.yG2(2),o.oRS("ID: ",o.kDX(3,3,r.selectedEntity$).id,""),o.yG2(3),o.oRS("Name: ",o.kDX(6,5,r.selectedEntity$).name,""),o.yG2(4),o.E7m("innerHtml",o.kDX(10,7,r.selectedEntity$).description,o.E3n)}}let N=(()=>{class F{store=new y.qc([]);selectedEntity$=new d.g(void 0);entityIsSelected;constructor(){}ngOnInit(){this.store.load([{id:"2",name:"Name 2",description:"<b>Description 2</b>"},{id:"1",name:"Name 1",description:"<b>Description 1</b>"},{id:"3",name:"Name 3",description:"<b>Description 3</b>"}])}ngOnDestroy(){this.store.destroy()}getTitle(r){return r.name}onSelectedChange(r){this.entityIsSelected=!!r.value.id,this.selectedEntity$.next(r.value)}static \u0275fac=function(ie){return new(ie||F)};static \u0275cmp=o.In1({type:F,selectors:[["app-entity-selector"]],standalone:!0,features:[o.UHJ],decls:4,vars:5,consts:[["title","Entity Selector","subtitle","Common"],["codeFolder","common/entity-selector"],[3,"store","titleAccessor","emptyText","placeholder","selectedChange"],[4,"ngIf"],[3,"innerHtml"]],template:function(ie,ae){1&ie&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-entity-selector",2),o.qCj("selectedChange",function(le){return ae.onSelectedChange(le)}),o.C$Y(),o.yuY(3,oe,11,9,"div",3),o.C$Y()()),2&ie&&(o.yG2(2),o.E7m("store",ae.store)("titleAccessor",ae.getTitle)("emptyText","")("placeholder","Select an entity"),o.yG2(),o.E7m("ngIf",ae.entityIsSelected))},dependencies:[g.u,R.I,y.sh,L.u_,L.a],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return F})(),B=(()=>{class F{store=new y.qc([]);paginator;entitySortChange$=new d.g(!1);paginatorOptions={pageSize:10};template={selection:!0,selectionCheckbox:!0,selectMany:!0,sort:!0,valueAccessor:(r,ie)=>(0,y.u6)(r,ie),columns:[{name:"selected",title:"Selected",valueAccessor:r=>this.store.state.get(r).selected?"radiobox-marked":"radiobox-blank",renderer:y.G8.Icon},{name:"id",title:"ID"},{name:"name",title:"Name"},{name:"description",title:"Description",renderer:y.G8.HTML},{name:"date",title:"Date",type:"date"},{name:"url",title:"Hyperlink"},{name:"image",title:"Image"},{name:"action",title:"",valueAccessor:()=>[{icon:"home",color:"warn",click:r=>{console.log(r)}}],renderer:y.G8.ButtonGroup}]};constructor(){}ngOnInit(){const ie=[2,1,3,4,5,6,7,8,9,10,11,12,13].map(ae=>3===ae?{id:ae,name:`Name ${ae}`,description:`<b>Description ${ae}</b>`,date:new Date,url:"https://igouverte.org",image:"https://www.igouverte.org/assets/img/NONEXISTINGIMAGE.png"}:{id:ae,name:`Name ${ae}`,description:`<b>Description ${ae}</b>`,date:new Date,url:"https://igouverte.org",image:"https://www.igouverte.org/assets/img/Igo_logoavec.png"});this.store.load(ie)}entitySortChange(){this.entitySortChange$.next(!0)}paginatorChange(r){this.paginator=r}ngOnDestroy(){this.store.destroy()}static \u0275fac=function(ie){return new(ie||F)};static \u0275cmp=o.In1({type:F,selectors:[["app-entity-table"]],standalone:!0,features:[o.UHJ],decls:3,vars:4,consts:[["title","Entity Table","subtitle","Common"],["codeFolder","common/entity-table"],[3,"store","withPaginator","paginatorOptions","template","entitySortChange"]],template:function(ie,ae){1&ie&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-entity-table",2),o.qCj("entitySortChange",function(){return ae.entitySortChange()}),o.C$Y()()()),2&ie&&(o.yG2(2),o.E7m("store",ae.store)("withPaginator",!0)("paginatorOptions",ae.paginatorOptions)("template",ae.template))},dependencies:[g.u,R.I,y.Eh],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return F})();function X(F,Q){if(1&F){const r=o.KQA();o.I0R(0,"igo-form",3),o.qCj("submitForm",function(ae){o.usT(r);const fe=o.GaO();return o.CGJ(fe.onSubmit(ae))}),o.wVc(1,"async"),o.wR5(2,"igo-form-group",4),o.I0R(3,"div",5)(4,"button",6),o.qCj("click",function(){o.usT(r);const ae=o.GaO();return o.CGJ(ae.fillForm())}),o.OEk(5," Fill Form "),o.C$Y(),o.I0R(6,"button",6),o.qCj("click",function(){o.usT(r);const ae=o.GaO();return o.CGJ(ae.clearForm())}),o.OEk(7," Clear Form "),o.C$Y(),o.I0R(8,"button",7),o.OEk(9," Submit "),o.C$Y()()()}if(2&F){const r=Q.ngIf,ie=o.GaO();o.E7m("form",r)("formData",o.kDX(1,4,ie.data$)),o.yG2(2),o.E7m("group",r.groups[0]),o.yG2(6),o.E7m("disabled",ie.submitDisabled)}}let V=(()=>{class F{formService;form$=new d.g(void 0);data$=new d.g(void 0);submitDisabled=!0;valueChanges$$;constructor(r){this.formService=r}ngOnInit(){const ie=[{name:"id",title:"ID",options:{cols:1,validator:x.AQ.required}},{name:"name",title:"Name",options:{cols:1,validator:x.AQ.required}},{name:"status",title:"Status",type:"select",options:{cols:2},inputs:{choices:[{value:1,title:"Single"},{value:2,title:"Married"}]}}].map(fe=>this.formService.field(fe)),ae=this.formService.form([],[this.formService.group({name:"info"},ie)]);this.valueChanges$$=ae.control.valueChanges.subscribe(()=>{this.submitDisabled=!ae.control.valid}),this.form$.next(ae)}ngOnDestroy(){this.valueChanges$$.unsubscribe()}fillForm(){this.data$.next({id:1,name:"Bob",status:2})}clearForm(){this.form$.value.control.reset()}onSubmit(r){alert(JSON.stringify(r))}static \u0275fac=function(ie){return new(ie||F)(o.GI1(y.eO))};static \u0275cmp=o.In1({type:F,selectors:[["app-form"]],standalone:!0,features:[o.UHJ],decls:4,vars:3,consts:[["title","Form","subtitle","Common"],["codeFolder","common/form"],[3,"form","formData","submitForm",4,"ngIf"],[3,"form","formData","submitForm"],[3,"group"],["formButtons","",1,"actions-container"],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"]],template:function(ie,ae){1&ie&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1),o.yuY(2,X,10,6,"igo-form",2),o.wVc(3,"async"),o.C$Y()()),2&ie&&(o.yG2(2),o.E7m("ngIf",o.kDX(3,1,ae.form$)))},dependencies:[g.u,R.I,L.u_,y.Yl,y.O8,w.oJ,w.Gw,L.a],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}[_nghost-%COMP%]   igo-form[_ngcontent-%COMP%]{max-width:500px}"]})}return F})(),z=(()=>{class F{database;model={columns:[{name:"id",title:"ID",sortable:!1,filterable:!0},{name:"name",title:"Name",sortable:!0,filterable:!0},{name:"description",title:"Description",sortable:!0,filterable:!0}],actions:[{icon:"file-document",color:y.ys.primary,click:r=>this.showName(r.name)}],selectionCheckbox:!0};constructor(){}ngOnInit(){this.database=new y.Iv([{id:"2",name:"Name 2",description:"Hello 2"},{id:"1",name:"Name 1",description:"Bonjour 1"},{id:"3",name:"Name 3",description:"Hola 3"}])}showName(r){alert(r)}handleSelect(r){console.log(r)}static \u0275fac=function(ie){return new(ie||F)};static \u0275cmp=o.In1({type:F,selectors:[["app-table"]],standalone:!0,features:[o.UHJ],decls:3,vars:3,consts:[["title","Table","subtitle","Common"],["codeFolder","common/table"],[3,"database","model","hasFilterInput","select"]],template:function(ie,ae){1&ie&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-table",2),o.qCj("select",function(le){return ae.handleSelect(le)}),o.C$Y()()()),2&ie&&(o.yG2(2),o.E7m("database",ae.database)("model",ae.model)("hasFilterInput",!0))},dependencies:[g.u,R.I,y.oz],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return F})();var W=s(21124),A=s(32328);function q(F,Q){if(1&F){const r=o.KQA();o.I0R(0,"button",7),o.qCj("click",function(){o.usT(r);const ae=o.GaO();return o.CGJ(ae.toolbox.activatePreviousTool())}),o.wR5(1,"mat-icon",8),o.C$Y()}}function _(F,Q){if(1&F){const r=o.KQA();o.I0R(0,"button",9),o.qCj("click",function(){o.usT(r);const ae=o.GaO();return o.CGJ(ae.toolbox.deactivateTool())}),o.wR5(1,"mat-icon",10),o.C$Y()}}let u=class Ms{cdRef;name;constructor(Q){this.cdRef=Q}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(r){return new(r||Ms)(o.GI1(o.kD9))};static \u0275cmp=o.In1({type:Ms,selectors:[["app-salutation-tool"]],inputs:{name:"name"},standalone:!0,features:[o.UHJ],decls:2,vars:1,template:function(r,ie){1&r&&(o.I0R(0,"p"),o.OEk(1),o.C$Y()),2&r&&(o.yG2(),o.oRS("Hello, my name is ",ie.name,"."))},encapsulation:2,changeDetection:0})};u=(0,W.UN)([(0,y.aA)({name:"demo-salutation",title:"Salutation",icon:"account",options:{name:"Jack"}}),(0,W.YR)("design:paramtypes",[o.kD9])],u);let S=class Ds{static \u0275fac=function(r){return new(r||Ds)};static \u0275cmp=o.In1({type:Ds,selectors:[["app-about-tool"]],standalone:!0,features:[o.UHJ],decls:2,vars:0,template:function(r,ie){1&r&&(o.I0R(0,"p"),o.OEk(1,"I'm a tool inside a toolbox."),o.C$Y())},encapsulation:2,changeDetection:0})};S=(0,W.UN)([(0,y.aA)({name:"demo-about",title:"About",icon:"information"})],S);let P=(()=>{class F{toolService;toolbox=new y.Eb;get activeTool$(){return this.toolbox.activeTool$}get panelTitle(){return this.activeTool$.value?this.activeTool$.value.title:"Toolbox"}constructor(r){this.toolService=r}ngOnInit(){this.toolbox.setToolbar(["demo-salutation","demo-about"]),this.toolbox.setTools(this.toolService.getTools())}ngOnDestroy(){this.toolbox.destroy()}activateSalutationTool(){this.toolbox.activateTool("demo-salutation",{name:"Bob"})}static \u0275fac=function(ie){return new(ie||F)(o.GI1(y.IF))};static \u0275cmp=o.In1({type:F,selectors:[["app-tool"]],standalone:!0,features:[o.UHJ],decls:10,vars:9,consts:[["title","Tool","subtitle","Common"],["codeFolder","common/tool"],[3,"title"],["mat-icon-button","","panelLeftButton","",3,"click",4,"ngIf"],["mat-icon-button","","panelRightButton","",3,"click",4,"ngIf"],["color","primary",3,"toolbox","animate"],["mat-flat-button","","type","button","color","primary",3,"click"],["mat-icon-button","","panelLeftButton","",3,"click"],["svgIcon","arrow-back"],["mat-icon-button","","panelRightButton","",3,"click"],["svgIcon","menu"]],template:function(ie,ae){1&ie&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-panel",2),o.yuY(3,q,2,0,"button",3),o.wVc(4,"async"),o.yuY(5,_,2,0,"button",4),o.wVc(6,"async"),o.wR5(7,"igo-toolbox",5),o.C$Y(),o.I0R(8,"button",6),o.qCj("click",function(){return ae.activateSalutationTool()}),o.OEk(9," Activate Salutation Tool "),o.C$Y()()()),2&ie&&(o.yG2(2),o.E7m("title",ae.panelTitle),o.yG2(),o.E7m("ngIf",o.kDX(4,5,ae.activeTool$)),o.yG2(2),o.E7m("ngIf",o.kDX(6,7,ae.activeTool$)),o.yG2(2),o.E7m("toolbox",ae.toolbox)("animate",!0))},dependencies:[g.u,R.I,y.cP,L.u_,w.oJ,w.Gw,w.um,A.oB,A.qL,y.cT,L.a],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return F})();var I=s(26431);let U=(()=>{class F{cdRef;name;complete=new o._w7;cancel=new o._w7;constructor(r){this.cdRef=r}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(ie){return new(ie||F)(o.GI1(o.kD9))};static \u0275cmp=o.In1({type:F,selectors:[["app-salutation-widget"]],inputs:{name:"name"},outputs:{complete:"complete",cancel:"cancel"},standalone:!0,features:[o.UHJ],decls:6,vars:1,consts:[["mat-flat-button","",3,"click"]],template:function(ie,ae){1&ie&&(o.I0R(0,"p"),o.OEk(1),o.C$Y(),o.I0R(2,"button",0),o.qCj("click",function(){return ae.complete.emit(ae.name)}),o.OEk(3," Nice to meet you "),o.C$Y(),o.I0R(4,"button",0),o.qCj("click",function(){return ae.cancel.emit(ae.name)}),o.OEk(5,"Dismiss"),o.C$Y()),2&ie&&(o.yG2(),o.oRS("Hello, my name is ",ae.name,"."))},dependencies:[w.oJ,w.Gw],encapsulation:2,changeDetection:0})}return F})();const O=[{path:"",redirectTo:"action",pathMatch:"full"},{title:"Action",path:"action",component:j},{title:"Dialogs",path:"dialog",component:T},{title:"Dynamic Component",path:"dynamic-component",component:M},{title:"Entity Table",path:"entity-table",component:B},{title:"Entity Selector",path:"entity-selector",component:N},{title:"form",path:"Form",component:V},{title:"Table",path:"table",component:z},{title:"Tool",path:"tool",component:P},{title:"Widget",path:"widget",component:(()=>{class F{widgetService;widget;inputs={name:"Bob"};constructor(r){this.widgetService=r,this.widget=this.widgetService.create(U)}onWidgetComplete(r){alert(`${r} emitted event 'complete' then got automatically destroyed.`)}onWidgetCancel(){alert("Widget emitted event 'cancel' then got automatically destroyed.")}static \u0275fac=function(ie){return new(ie||F)(o.GI1(y.cx))};static \u0275cmp=o.In1({type:F,selectors:[["app-widget"]],standalone:!0,features:[o.UHJ],decls:3,vars:2,consts:[["title","Widget","subtitle","Common"],["codeFolder","common/widget"],[3,"widget","inputs","complete","cancel"]],template:function(ie,ae){1&ie&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-widget-outlet",2),o.qCj("complete",function(le){return ae.onWidgetComplete(le)})("cancel",function(){return ae.onWidgetCancel()}),o.C$Y()()()),2&ie&&(o.yG2(2),o.E7m("widget",ae.widget)("inputs",ae.inputs))},dependencies:[g.u,R.I,y.iA,I.A],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return F})()}]},32688:(Ee,ce,s)=>{"use strict";s.d(ce,{u:()=>o});var y=s(65056),e=s(34896);function d(h,j){if(1&h&&(e.I0R(0,"li"),e.OEk(1),e.C$Y()),2&h){const x=j.$implicit;e.yG2(),e.cNF(x)}}function g(h,j){if(1&h&&(e.SAx(0),e.I0R(1,"label",3),e.OEk(2,"Dependencies:"),e.C$Y(),e.I0R(3,"ul"),e.yuY(4,d,2,1,"li",4),e.C$Y(),e.k70()),2&h){const x=e.GaO();e.yG2(4),e.E7m("ngForOf",x.dependencies)}}const R=["*"];let o=(()=>{class h{title;subtitle;dependencies;static \u0275fac=function(w){return new(w||h)};static \u0275cmp=e.In1({type:h,selectors:[["app-doc-viewer"]],inputs:{title:"title",subtitle:"subtitle",dependencies:"dependencies"},standalone:!0,features:[e.UHJ],ngContentSelectors:R,decls:7,vars:3,consts:[[1,"mat-subtitle-2","m-b-0"],[1,"mat-body-1"],[4,"ngIf"],["for",""],[4,"ngFor","ngForOf"]],template:function(w,b){1&w&&(e.kPM(),e.I0R(0,"h6",0),e.OEk(1),e.C$Y(),e.I0R(2,"h2"),e.OEk(3),e.C$Y(),e.I0R(4,"div",1),e.yuY(5,g,5,1,"ng-container",2),e._Xx(6),e.C$Y()),2&w&&(e.yG2(),e.cNF(b.subtitle),e.yG2(2),e.cNF(b.title),e.yG2(2),e.E7m("ngIf",null==b.dependencies?null:b.dependencies.length))},dependencies:[y.u_,y.Iw],styles:["[_nghost-%COMP%]{display:block;padding:16px 48px}@media (max-width: 599px){[_nghost-%COMP%]{padding:16px}}[_nghost-%COMP%]     pre{background:#00000003;border:.5px solid rgba(0,0,0,.2);border-radius:5px;display:block;margin:16px auto;overflow-x:auto;padding:20px;white-space:pre-wrap}[_nghost-%COMP%]     pre code{background:transparent}[_nghost-%COMP%]     code{background:#00000008;padding:3px;font-size:90%}"]})}return h})()},51100:(Ee,ce,s)=>{"use strict";s.d(ce,{I:()=>E});var y=s(65056),e=s(34672),d=s(48512),g=s(75180),R=s(32328),o=s(27e3),h=s(34896);function j(T,a){if(1&T&&(h.I0R(0,"a",6),h.wR5(1,"mat-icon",7),h.C$Y()),2&T){const K=h.GaO();h.E7m("href",K.codeUrl,h.K6U)}}function x(T,a){if(1&T&&(h.I0R(0,"a",8),h.wR5(1,"mat-icon",9),h.C$Y()),2&T){const K=h.GaO();h.E7m("href",K.configUrl,h.K6U)}}const w=["*"],b="https://github.com/infra-geo-ouverte/igo2-lib/tree/master/projects/demo/src";let E=(()=>{class T{title;codeFolder;configFolder;get codeUrl(){return`${b}/app/${this.codeFolder}`}get configUrl(){return`${b}/${this.configFolder}`}static \u0275fac=function(M){return new(M||T)};static \u0275cmp=h.In1({type:T,selectors:[["app-example-viewer"]],inputs:{title:"title",codeFolder:"codeFolder",configFolder:"configFolder"},standalone:!0,features:[h.UHJ],ngContentSelectors:w,decls:10,vars:3,consts:[["appearance","outlined"],[1,"actions"],["mat-icon-button","","target","_blank","matTooltip","View code example",3,"href",4,"ngIf"],["mat-icon-button","","target","_blank","matTooltip","View config example",3,"href",4,"ngIf"],[1,"m-b-16"],[1,"mat-body-1"],["mat-icon-button","","target","_blank","matTooltip","View code example",3,"href"],["svgIcon","code-tags"],["mat-icon-button","","target","_blank","matTooltip","View config example",3,"href"],["svgIcon","cog"]],template:function(M,L){1&M&&(h.kPM(),h.I0R(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-subtitle"),h.OEk(3),h.C$Y(),h.I0R(4,"div",1),h.yuY(5,j,2,1,"a",2)(6,x,2,1,"a",3),h.C$Y()(),h.wR5(7,"mat-divider",4),h.I0R(8,"mat-card-content",5),h._Xx(9),h.C$Y()()),2&M&&(h.yG2(3),h.oRS(" ",L.title," "),h.yG2(2),h.E7m("ngIf",L.codeFolder),h.yG2(),h.E7m("ngIf",L.configFolder))},dependencies:[d.NR,d.SM,d.WK,d.Uc,d.uK,y.u_,e.oJ,e.cP,o.KO,o.a4,R.oB,R.qL,g.U,g.k],styles:["[_nghost-%COMP%]{display:block;margin-top:24px}[_nghost-%COMP%]   mat-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 8px 0 16px;margin-bottom:0}[_nghost-%COMP%]     .mat-mdc-card-header-text{display:flex;align-items:center}[_nghost-%COMP%]   mat-card-subtitle[_ngcontent-%COMP%]{font-size:16px}"]})}return T})()},87124:(Ee,ce,s)=>{"use strict";s.r(ce),s.d(ce,{routes:()=>b});var y=s(52072),e=s(62228),d=s(37240),g=s(49496),R=s(32688),o=s(51100),h=s(34896);function j(E,T){1&E&&h.wR5(0,"igo-metadata-button",18),2&E&&h.E7m("layer",T.layer)}const x=()=>["HttpClientModule"],b=[{path:"",redirectTo:"context",pathMatch:"full"},{title:"Context",path:"context",component:(()=>{class E{mapService;contextService;map=new g.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};constructor(a,K){this.mapService=a,this.contextService=K,this.mapService.setMap(this.map),this.contextService.loadDefaultContext(),this.contextService.loadContexts()}static \u0275fac=function(K){return new(K||E)(h.GI1(g.u00),h.GI1(d.M9))};static \u0275cmp=h.In1({type:E,selectors:[["app-context"]],standalone:!0,features:[h.UHJ],decls:22,vars:12,consts:[["title","Context","subtitle","Context",3,"dependencies"],["codeFolder","context/context","configFolder","contexts"],["cols","2","rowHeight","500px","gutterSize","16px"],["igoMapContext","","igoLayerContext","",3,"map","view"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"],[1,"flex","flex-col","align-start","h-100","w-100"],["title","Contexts list",1,"h-100","w-100"],["igoContextListBinding","",3,"map"],["title","Layers",1,"h-100","w-100"],["igoLayerListBinding","",3,"map"],["igoLayerItemToolbar",""],["title","Import/Export context","codeFolder","context/context","configFolder","contexts"],[3,"map"],[3,"layer"]],template:function(K,M){1&K&&(h.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),h.wR5(6,"div",5)(7,"igo-rotation-button",6),h.C$Y(),h.I0R(8,"div",7),h.wR5(9,"igo-home-extent-button",8)(10,"igo-geolocate-button",8)(11,"igo-zoom-button",9),h.C$Y()()(),h.I0R(12,"mat-grid-tile")(13,"div",10)(14,"igo-panel",11),h.wR5(15,"igo-context-list",12),h.C$Y(),h.I0R(16,"igo-panel",13)(17,"igo-layer-list",14),h.yuY(18,j,1,1,"ng-template",null,15,h.gJz),h.C$Y()()()()()(),h.I0R(20,"app-example-viewer",16),h.wR5(21,"igo-context-import-export",17),h.C$Y()()),2&K&&(h.E7m("dependencies",h.q4q(11,x)),h.yG2(4),h.E7m("map",M.map)("view",M.view),h.yG2(3),h.E7m("showIfNoRotation",!0)("map",M.map),h.yG2(2),h.E7m("map",M.map),h.yG2(),h.E7m("map",M.map),h.yG2(),h.E7m("map",M.map),h.yG2(4),h.E7m("map",M.map),h.yG2(2),h.E7m("map",M.map),h.yG2(4),h.E7m("map",M.map))},dependencies:[R.u,o.I,y.CQ,y.ae,y.cn,g.cdH,g.eqy,g.q2F,g.i6P,g.qcl,d.W2,d.AX,d.k5,d.Mb,e.cP,g.m2U,g.Ult,g.Idw,d.kP]})}return E})()}]},98340:(Ee,ce,s)=>{"use strict";s.r(ce),s.d(ce,{routes:()=>I});var y=s(34672),e=s(62228),d=s(23302),g=s(32688),R=s(51100),o=s(34896);let h=(()=>{class U{activityService;idsActivity=[];constructor(O){this.activityService=O}register(){this.idsActivity.push(this.activityService.register())}unregister(){this.activityService.unregister(this.idsActivity.pop())}get counter(){return this.activityService.counter$.value}static \u0275fac=function(F){return new(F||U)(o.GI1(d.U9))};static \u0275cmp=o.In1({type:U,selectors:[["app-activity"]],standalone:!0,features:[o.UHJ],decls:23,vars:1,consts:[["title","Activity","subtitle","Core"],["codeFolder","core/activity"],[1,"d-flex","actions-container"],["mat-raised-button","",3,"click"],[1,"mat-body-1","sub-content"],["igoSpinnerActivity",""]],template:function(F,Q){1&F&&(o.I0R(0,"app-doc-viewer",0)(1,"p"),o.OEk(2,"Register activities in service. Use to display a loading icon"),o.C$Y(),o.I0R(3,"li"),o.OEk(4," Import "),o.I0R(5,"code"),o.OEk(6,"IgoActivityModule"),o.C$Y(),o.OEk(7," only if you want register HTTP calls "),o.C$Y(),o.I0R(8,"li"),o.OEk(9,"Import "),o.I0R(10,"code"),o.OEk(11,"IgoActivityModule"),o.C$Y(),o.OEk(12," only once"),o.C$Y(),o.I0R(13,"app-example-viewer",1)(14,"div",2)(15,"button",3),o.qCj("click",function(){return Q.register()}),o.OEk(16,"Register"),o.C$Y(),o.I0R(17,"button",3),o.qCj("click",function(){return Q.unregister()}),o.OEk(18,"Unregister"),o.C$Y()(),o.I0R(19,"div",4)(20,"p"),o.OEk(21),o.C$Y(),o.wR5(22,"igo-spinner",5),o.C$Y()()()),2&F&&(o.yG2(21),o.oRS("Counter: ",Q.counter,""))},dependencies:[g.u,R.I,e.is,y.oJ,y.Gw],styles:["[_nghost-%COMP%]   .sub-content[_ngcontent-%COMP%]{margin-top:12px}"]})}return U})();var j=s(65056),x=s(83600);let w=(()=>{class U{configService;configLanguage;constructor(O){this.configService=O,this.configLanguage=this.configService.getConfig("language")}static \u0275fac=function(F){return new(F||U)(o.GI1(x.aW))};static \u0275cmp=o.In1({type:U,selectors:[["app-config"]],standalone:!0,features:[o.UHJ],decls:12,vars:3,consts:[["title","Config","subtitle","Core"],["title","Simple config","codeFolder","core/config","configFolder","environments"],[1,"mat-body-1"]],template:function(F,Q){1&F&&(o.I0R(0,"app-doc-viewer",0)(1,"p"),o.OEk(2,"Load config in your angular application"),o.C$Y(),o.I0R(3,"li"),o.OEk(4,"Import "),o.I0R(5,"code"),o.OEk(6,"IgoConfigModule"),o.C$Y(),o.OEk(7," only once"),o.C$Y(),o.I0R(8,"app-example-viewer",1)(9,"p",2),o.OEk(10),o.wVc(11,"json"),o.C$Y()()()),2&F&&(o.yG2(10),o.oRS("Config language: ",o.kDX(11,1,Q.configLanguage),""))},dependencies:[g.u,R.I,j.ED]})}return U})();var b=s(24708),E=s(72584);let T=(()=>{class U{languageService;app={title:"IGO"};constructor(O){this.languageService=O}changeLanguage(O){this.languageService.setLanguage(O),console.log(this.languageService)}static \u0275fac=function(F){return new(F||U)(o.GI1(b.ov))};static \u0275cmp=o.In1({type:U,selectors:[["app-language"]],standalone:!0,features:[o.UHJ],decls:21,vars:4,consts:[["title","Language","subtitle","Core"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/projects/demo/src/locale"],["codeFolder","core/language"],[1,"d-flex","actions-container"],["mat-raised-button","",3,"click"],[1,"m-t-12"]],template:function(F,Q){1&F&&(o.I0R(0,"app-doc-viewer",0)(1,"p"),o.OEk(2,"Translate your angular application"),o.C$Y(),o.I0R(3,"li"),o.OEk(4,"Import "),o.I0R(5,"code"),o.OEk(6,"IgoLanguageModule"),o.C$Y(),o.OEk(7," only once"),o.C$Y(),o.I0R(8,"li"),o.OEk(9," Configure the "),o.I0R(10,"a",1),o.OEk(11,"locale files"),o.C$Y()(),o.I0R(12,"app-example-viewer",2)(13,"div",3)(14,"button",4),o.qCj("click",function(){return Q.changeLanguage("en")}),o.OEk(15,"English"),o.C$Y(),o.I0R(16,"button",4),o.qCj("click",function(){return Q.changeLanguage("fr")}),o.OEk(17,"Fran\xe7ais"),o.C$Y()(),o.I0R(18,"div",5),o.OEk(19),o.wVc(20,"translate"),o.C$Y()()()),2&F&&(o.yG2(19),o.oRS(" ",o.g7$(20,1,"welcome",Q.app)," "))},dependencies:[g.u,R.I,y.oJ,y.Gw,b._s,E.sD]})}return U})();var a=s(9588);let K=(()=>{class U{mediaService;constructor(O){this.mediaService=O}get media(){return this.mediaService.getMedia()}get orientation(){return this.mediaService.getOrientation()}get isTouchScreen(){return this.mediaService.isTouchScreen()}static \u0275fac=function(F){return new(F||U)(o.GI1(a.QB))};static \u0275cmp=o.In1({type:U,selectors:[["app-media"]],standalone:!0,features:[o.UHJ],decls:10,vars:3,consts:[["title","Media","subtitle","Core"],["codeFolder","core/media"]],template:function(F,Q){1&F&&(o.I0R(0,"app-doc-viewer",0)(1,"p"),o.OEk(2,"Detect type of media (mobile, tablet, desktop)"),o.C$Y(),o.I0R(3,"app-example-viewer",1)(4,"p"),o.OEk(5),o.C$Y(),o.I0R(6,"p"),o.OEk(7),o.C$Y(),o.I0R(8,"p"),o.OEk(9),o.C$Y()()()),2&F&&(o.yG2(5),o.oRS("Current media: ",Q.media,""),o.yG2(2),o.oRS("Current orientation: ",Q.orientation,""),o.yG2(2),o.oRS(" Device mode: ",Q.isTouchScreen?"Touch device":"Not a touch device "," "))},dependencies:[g.u,R.I]})}return U})();var M=s(93020);let L=(()=>{class U{messageService;constructor(O){this.messageService=O}success(){this.messageService.success("Congratulations","Success")}info(){this.messageService.info("Welcome to IGO","Info")}alert(){this.messageService.alert("Warning","Alert")}error(){this.messageService.error("There is a bug","Error")}static \u0275fac=function(F){return new(F||U)(o.GI1(M.mi))};static \u0275cmp=o.In1({type:U,selectors:[["app-message"]],standalone:!0,features:[o.UHJ],decls:20,vars:0,consts:[["title","Message","subtitle","Core"],["codeFolder","core/message"],[1,"d-flex","m-t-16","actions-container"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(F,Q){1&F&&(o.I0R(0,"app-doc-viewer",0)(1,"p"),o.OEk(2,"Show message to user."),o.C$Y(),o.I0R(3,"li"),o.OEk(4,"Import "),o.I0R(5,"code"),o.OEk(6,"IgoMessageModule"),o.C$Y(),o.OEk(7," only once"),o.C$Y(),o.I0R(8,"li"),o.OEk(9,"Dependencies: BrowserAnimationsModule"),o.C$Y(),o.I0R(10,"app-example-viewer",1)(11,"div",2)(12,"button",3),o.qCj("click",function(){return Q.success()}),o.OEk(13,"Success message"),o.C$Y(),o.I0R(14,"button",4),o.qCj("click",function(){return Q.info()}),o.OEk(15," Info message "),o.C$Y(),o.I0R(16,"button",5),o.qCj("click",function(){return Q.alert()}),o.OEk(17," Alert message "),o.C$Y(),o.I0R(18,"button",6),o.qCj("click",function(){return Q.error()}),o.OEk(19," Error message "),o.C$Y()()()())},dependencies:[g.u,R.I,y.oJ,y.Gw]})}return U})();var oe=s(21724),N=s(70772),B=s(12445);let X=(()=>{class U{options;json;exampleModuleCode=V;constructor(O,F){this.options=O,this.json=F}throwTestError(){throw new Error("Sentry Test Error")}getBasicConfigExample(){const O=`{"igo": {"monitoring": ${JSON.stringify(this.options,null,2)}}}`;return this.json.transform(JSON.parse(O))}static \u0275fac=function(F){return new(F||U)(o.GI1(N.ct),o.GI1(j.ED))};static \u0275cmp=o.In1({type:U,selectors:[["app-monitoring"]],standalone:!0,features:[o.M5G([j.ED,...(0,N.ms)(B.O.igo.monitoring),...(0,oe.u_)(B.O.igo.monitoring)]),o.UHJ],decls:56,vars:2,consts:[["title","Monitoring","subtitle","Core"],["href","https://docs.sentry.io/platforms/javascript/configuration/options","target","_blank"],["href","https://docs.sentry.io/platforms/javascript/guides/angular/sourcemaps/","target","_blank"],[3,"innerHTML"],["title","Sentry","codeFolder","core/monitoring","configFolder","environments"],[1,"mat-body-1"],["mat-raised-button","","color","warn",3,"click"]],template:function(F,Q){1&F&&(o.I0R(0,"app-doc-viewer",0)(1,"p"),o.OEk(2," The "),o.I0R(3,"code"),o.OEk(4,"monitoring"),o.C$Y(),o.OEk(5," package provides a set of configuration for manging application monitoring "),o.C$Y(),o.I0R(6,"ul")(7,"li"),o.OEk(8,"Error montioring, report application exception"),o.C$Y(),o.I0R(9,"li"),o.OEk(10,"Custom event reporting, like tracking use of code deprecation"),o.C$Y()(),o.I0R(11,"h3"),o.OEk(12,"Getting started"),o.C$Y(),o.I0R(13,"p"),o.OEk(14," Start by configure the monitoring options in your "),o.I0R(15,"code"),o.OEk(16,"environnment.ts"),o.C$Y(),o.OEk(17," file. You can complement this configuration with your provider options. To get the basic options, for Sentry consult the "),o.I0R(18,"a",1),o.OEk(19,"documentation"),o.C$Y()(),o.I0R(20,"pre")(21,"code"),o.OEk(22),o.C$Y()(),o.I0R(23,"h3"),o.OEk(24,"Identify user information with the event"),o.C$Y(),o.I0R(25,"p"),o.OEk(26," If you yant to identify the user with the monitoring event, you need to configure "),o.I0R(27,"code"),o.OEk(28,"identifyUser"),o.C$Y(),o.OEk(29," to true in the monitoring options. Then import the "),o.I0R(30,"code"),o.OEk(31,"AuthModule"),o.C$Y(),o.OEk(32," and it will provide the "),o.I0R(33,"code"),o.OEk(34,"provideAuthUserMonitoring"),o.C$Y(),o.OEk(35," providers. "),o.C$Y(),o.I0R(36,"h3"),o.OEk(37,"Add Readable Stack Traces to Errors for your application"),o.C$Y(),o.I0R(38,"p"),o.OEk(39," Follow the instruction "),o.I0R(40,"a",2),o.OEk(41,"Sentry - Source Maps"),o.C$Y()(),o.I0R(42,"h3"),o.OEk(43,"Initialize monitoring"),o.C$Y(),o.I0R(44,"p"),o.OEk(45," Then import the "),o.I0R(46,"code"),o.OEk(47,"provideMonitoring"),o.C$Y(),o.OEk(48," providers into the AppModule "),o.C$Y(),o.I0R(49,"pre"),o.wR5(50,"code",3),o.C$Y(),o.I0R(51,"app-example-viewer",4)(52,"p",5),o.OEk(53," Trigger a test error somewhere in your Angular app, for example in your main app component. Once triggered, an error event should be sent on your Sentry application "),o.C$Y(),o.I0R(54,"button",6),o.qCj("click",function(){return Q.throwTestError()}),o.OEk(55," Throw Test Error "),o.C$Y()()()),2&F&&(o.yG2(22),o.cNF(Q.getBasicConfigExample()),o.yG2(28),o.E7m("innerHTML",Q.exampleModuleCode,o.E3n))},dependencies:[g.u,R.I,y.oJ,y.Gw]})}return U})();const V="@NgModule({\n  declarations: [...],\n  imports: [...],\n  providers: [\n    ...provideMonitoring(environment.igo.monitoring),\n\n    // Provide the authentication user monitoring if you want to identify your user (id, fullname, email) in the error logging \n    ...provideAuthUserMonitoring(environment.igo.monitoring)\n  ]\n})\n";var z=s(33712);let W=(()=>{class U{http;languageService;constructor(O,F){this.http=O,this.languageService=F}callHttp(){this.http.get("https://geoegl.msp.gouv.qc.ca/apis/icherche/info").subscribe(F=>{console.log(F)})}callHttpError(){this.http.get("404").subscribe(F=>{console.log(F)})}static \u0275fac=function(F){return new(F||U)(o.GI1(z.KK),o.GI1(b.ov))};static \u0275cmp=o.In1({type:U,selectors:[["app-request"]],standalone:!0,features:[o.UHJ],decls:21,vars:0,consts:[["title","Request","subtitle","Core"],["codeFolder","core/core"],[1,"actions-container"],["mat-raised-button","",3,"click"]],template:function(F,Q){1&F&&(o.I0R(0,"app-doc-viewer",0)(1,"p"),o.OEk(2,"Register http calls in console"),o.C$Y(),o.I0R(3,"li"),o.OEk(4," Import "),o.I0R(5,"code"),o.OEk(6,"IgoLoggingModule"),o.C$Y(),o.OEk(7," only if you want register HTTP calls in console "),o.C$Y(),o.I0R(8,"li"),o.OEk(9," Import "),o.I0R(10,"code"),o.OEk(11,"IgoErrorModule"),o.C$Y(),o.OEk(12," only if you want register errors from HTTP calls in console "),o.C$Y(),o.I0R(13,"li"),o.OEk(14,"Import modules only once"),o.C$Y(),o.I0R(15,"app-example-viewer",1)(16,"div",2)(17,"button",3),o.qCj("click",function(){return Q.callHttp()}),o.OEk(18,"Log"),o.C$Y(),o.I0R(19,"button",3),o.qCj("click",function(){return Q.callHttpError()}),o.OEk(20,"Error"),o.C$Y()()()())},dependencies:[g.u,R.I,y.oJ,y.Gw]})}return U})();var A=s(46176),q=s(50244),_=s(77872),u=s(64002);function S(U,G){if(1&U&&(o.I0R(0,"mat-option",6),o.OEk(1),o.C$Y()),2&U){const O=G.$implicit;o.E7m("value",O.value),o.yG2(),o.oRS(" ",O.title," ")}}const I=[{path:"",redirectTo:"activity",pathMatch:"full"},{title:"Activity",path:"activity",component:h},{title:"Config",path:"config",component:w},{title:"Language",path:"language",component:T},{title:"Media",path:"media",component:K},{title:"Message",path:"message",component:L},{title:"Monitoring",path:"monitoring",component:X},{title:"Request",path:"request",component:W},{title:"Themes",path:"theme",component:(()=>{class U{languageService;renderer;isDark;themes=[{value:"blue",title:"Blue"},{value:"bluedark",title:"Blue-dark"},{value:"bluedq",title:"Donn\xe9es Qu\xe9bec"},{value:"bluegrey",title:"Blue grey"},{value:"dark",title:"Dark"},{value:"deeppurple",title:"Purple"},{value:"indigo",title:"Indigo"},{value:"orange",title:"Orange"},{value:"teal",title:"Teal"}];constructor(O,F){this.languageService=O,this.renderer=F}loadTheme(O){if("dark-demo-test"===O.value)return this.isDark=!0,void this.renderer.addClass(document.body,"dark-theme");this.isDark&&this.renderer.removeClass(document.body,"dark-theme"),(0,u.ym)(window.document,O.value+"-theme")}static \u0275fac=function(F){return new(F||U)(o.GI1(b.ov),o.GI1(o.q87))};static \u0275cmp=o.In1({type:U,selectors:[["app-theme"]],standalone:!0,features:[o.UHJ],decls:10,vars:1,consts:[["title","Theme","subtitle","Core"],["codeFolder","core/theme"],[1,"actions-container"],["placeholder","Select a theme",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["value","dark-demo-test"],[3,"value"]],template:function(F,Q){1&F&&(o.I0R(0,"app-doc-viewer",0)(1,"p"),o.OEk(2,"Change the app theme"),o.C$Y(),o.I0R(3,"app-example-viewer",1)(4,"div",2)(5,"mat-form-field")(6,"mat-select",3),o.qCj("selectionChange",function(ie){return Q.loadTheme(ie)}),o.yuY(7,S,2,2,"mat-option",4),o.I0R(8,"mat-option",5),o.OEk(9," Dark theme "),o.C$Y()()()()()()),2&F&&(o.yG2(7),o.E7m("ngForOf",Q.themes))},dependencies:[g.u,R.I,q.wb,q.Up,_.d5,_.kX,A.I5,j.Iw,A.Ax]})}return U})()}]},10128:(Ee,ce,s)=>{"use strict";s.r(ce),s.d(ce,{routes:()=>gr});var y=s(62228),e=s(21720),d=s(49496),g=s(32688),R=s(51100),o=s(34896);const h=()=>["ConfigService","LanguageService"];let j=(()=>{class J{layerService;catalogService;storageService;mapService;catalog;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};catalogStore=new y.qc([]);catalogItemStore=new y.qc([]);constructor(c,C,$,re){this.layerService=c,this.catalogService=C,this.storageService=$,this.mapService=re}ngOnInit(){this.layerService.createAsyncLayer({title:"OSM",baseLayer:!0,visible:!0,sourceOptions:{type:"osm"}}).subscribe(c=>this.map.addLayer(c)),this.loadCatalogs(),this.mapService.setMap(this.map),this.catalogStore.stateView.firstBy$(c=>!0===c.state.selected).subscribe(c=>{c&&c.entity&&(this.catalog=c.entity)})}onCatalogSelectChange(c){this.loadCatalogItems(c.catalog)}loadCatalogs(){this.catalogService.loadCatalogs().subscribe(c=>{this.catalogStore.clear(),this.catalogStore.load(c.concat(this.storageService.get("addedCatalogs")||[]))})}loadCatalogItems(c){this.catalogService.loadCatalogItems(c).subscribe(C=>{this.catalogItemStore.clear(),this.catalogItemStore.load(C)})}static \u0275fac=function(C){return new(C||J)(o.GI1(d.IZ6),o.GI1(d.oxI),o.GI1(e.yQ),o.GI1(d.u00))};static \u0275cmp=o.In1({type:J,selectors:[["app-catalog"]],standalone:!0,features:[o.UHJ],decls:9,vars:9,consts:[["title","Catalog","subtitle","Geo",3,"dependencies"],["codeFolder","geo/catalog"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["title","Catalog Library"],[3,"store","catalogSelectChange"],["title","Catalog Browser"],[3,"catalog","store","map"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.I0R(5,"igo-panel",5)(6,"igo-catalog-library",6),o.qCj("catalogSelectChange",function(Ce){return $.onCatalogSelectChange(Ce)}),o.C$Y()(),o.I0R(7,"igo-panel",7),o.wR5(8,"igo-catalog-browser",8),o.C$Y()()()),2&C&&(o.E7m("dependencies",o.q4q(8,h)),o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(2),o.E7m("store",$.catalogStore),o.yG2(2),o.E7m("catalog",$.catalog)("store",$.catalogItemStore)("map",$.map))},dependencies:[g.u,R.I,d.q2F,d.qcl,y.cP,d.kvX,d.iOV],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]})}return J})();var x=s(52072),w=s(61616),b=s(62747);const E=()=>["LanguageService"];let T=(()=>{class J{layerService;mapService;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:9,geolocate:!1};stopsStore=new d.SYK([]);stopsFeatureStore=new d.czr([],{map:this.map});stepFeatureStore=new d.qM$([],{map:this.map});routesFeatureStore=new d.aWp([],{map:this.map});zoomToActiveRoute$=new w.E;constructor(c,C){this.layerService=c,this.mapService=C,this.mapService.setMap(this.map),this.layerService.createAsyncLayer({title:"OSM",baseLayer:!0,visible:!0,sourceOptions:{type:"osm"}}).subscribe($=>this.map.addLayer($))}static \u0275fac=function(C){return new(C||J)(o.GI1(d.IZ6),o.GI1(d.u00))};static \u0275cmp=o.In1({type:J,selectors:[["app-directions"]],standalone:!0,features:[o.UHJ],decls:15,vars:14,consts:[["title","Directions","subtitle","Geo",3,"dependencies"],["codeFolder","geo/directions"],["cols","2","rowHeight","600px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100","overflow-y-auto"],[1,"w-100",3,"stopsStore","stopsFeatureStore","stepFeatureStore","routesFeatureStore","zoomToActiveRoute$"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"div",5)(7,"igo-rotation-button",6),o.C$Y(),o.I0R(8,"div",7),o.wR5(9,"igo-home-extent-button",8)(10,"igo-geolocate-button",8)(11,"igo-zoom-button",9),o.C$Y()()(),o.I0R(12,"mat-grid-tile")(13,"div",10),o.wR5(14,"igo-directions",11),o.C$Y()()()()()),2&C&&(o.E7m("dependencies",o.q4q(13,E)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(3),o.E7m("showIfNoRotation",!0)("map",$.map),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(3),o.E7m("stopsStore",$.stopsStore)("stopsFeatureStore",$.stopsFeatureStore)("stepFeatureStore",$.stepFeatureStore)("routesFeatureStore",$.routesFeatureStore)("zoomToActiveRoute$",$.zoomToActiveRoute$))},dependencies:[g.u,R.I,x.CQ,x.ae,x.cn,d.cdH,d.eqy,d.q2F,d.i6P,d.qcl,d.aw9,b.U,d.Oy$]})}return J})();const a=()=>["LanguageService"];let K=(()=>{class J{dataSourceService;layerService;mapService;map=new d.yGW({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:6,projection:"EPSG:3857"};stores=[];constructor(c,C,$){this.dataSourceService=c,this.layerService=C,this.mapService=$,this.mapService.setMap(this.map),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(re=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:re,baseLayer:!0,visible:!0}))})}static \u0275fac=function(C){return new(C||J)(o.GI1(d.OEM),o.GI1(d.IZ6),o.GI1(d.u00))};static \u0275cmp=o.In1({type:J,selectors:[["app-draw"]],standalone:!0,features:[o.UHJ],decls:6,vars:7,consts:[["title","Draw","subtitle","Geo",3,"dependencies"],["codeFolder","geo/draw"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[3,"stores","map"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.wR5(5,"igo-draw",5),o.C$Y()()),2&C&&(o.E7m("dependencies",o.q4q(6,a)),o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("stores",$.stores)("map",$.map))},dependencies:[d.q2F,d.qcl,d.Se2,g.u,R.I],styles:["[_nghost-%COMP%]   igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]})}return J})(),M=(()=>{class J{dataSourceService;layerService;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};tableTemplate={selection:!0,selectMany:!0,sort:!0,columns:[{name:"properties.id",title:"ID"},{name:"properties.name",title:"Name"},{name:"properties.description",title:"Description"}]};store=new d.ym_([],{map:this.map});constructor(c,C){this.dataSourceService=c,this.layerService=C}ngOnInit(){const c=new d.E9g({});this.store.addStrategy(c);const C=new d.kj0({map:this.map,motion:d.Suj.Default});this.store.addStrategy(C),this.store.load([{meta:{id:1},type:"Feature",geometry:{type:"Point",coordinates:[-72,47.8]},projection:"EPSG:4326",properties:{id:1,name:"Name 1",description:"Description 1"}},{meta:{id:4},type:"Feature",geometry:{type:"Point",coordinates:[-71,46.8]},projection:"EPSG:4326",properties:{id:4,name:"Name 4",description:"Description 4"}},{meta:{id:5},type:"Feature",geometry:{type:"Point",coordinates:[-73,45.8]},projection:"EPSG:4326",properties:{id:5,name:"Name 5",description:"Description 5"}},{meta:{id:2},type:"Feature",geometry:{type:"LineString",coordinates:[[-72,47.8],[-73.5,47.4],[-72.4,48.6]]},projection:"EPSG:4326",properties:{id:2,name:"Name 2",description:"Description 2"}},{meta:{id:3},type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71,46.8],[-73,47],[-71.2,46.6]]]},projection:"EPSG:4326",properties:{id:3,name:"Name 3",description:"Description 3"}}]),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",baseLayer:!0,visible:!0,source:$}))}),this.dataSourceService.createAsyncDataSource({type:"vector"}).subscribe($=>{const re=this.layerService.createLayer({title:"Vector Layer",source:$,animation:{duration:2e3},igoStyle:{mapboxStyle:{url:"assets/mapboxStyleExample-feature.json",source:"source_nameX"}}});this.map.addLayer(re),this.store.bindLayer(re),c.activate(),C.activate()})}ngOnDestroy(){this.store.destroy()}static \u0275fac=function(C){return new(C||J)(o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-feature"]],standalone:!0,features:[o.UHJ],decls:6,vars:5,consts:[["title","Feature","subtitle","Geo"],["codeFolder","geo/feature"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[3,"store","template"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.wR5(5,"igo-entity-table",5),o.C$Y()()),2&C&&(o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("store",$.store)("template",$.tableTemplate))},dependencies:[g.u,R.I,d.q2F,d.qcl,y.Eh],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]})}return J})();var L=s(65056),oe=s(71904),N=s(34672),B=s(54776),X=s(45212),V=s(88872),z=s(87544),W=s(54844);function A(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"igo-form",7),o.qCj("submitForm",function($){o.usT(c);const re=o.GaO();return o.CGJ(re.onSubmit($))}),o.wVc(1,"async"),o.wR5(2,"igo-form-group",8),o.I0R(3,"div",9)(4,"button",10),o.qCj("click",function(){o.usT(c);const $=o.GaO();return o.CGJ($.fillForm())}),o.OEk(5," Fill Form "),o.C$Y(),o.I0R(6,"button",10),o.qCj("click",function(){o.usT(c);const $=o.GaO();return o.CGJ($.clearForm())}),o.OEk(7," Clear Form "),o.C$Y(),o.I0R(8,"button",11),o.OEk(9," Submit "),o.C$Y()()()}if(2&J){const c=Y.ngIf,C=o.GaO();o.E7m("form",c)("formData",o.kDX(1,4,C.data$)),o.yG2(2),o.E7m("group",c.groups[0]),o.yG2(6),o.E7m("disabled",C.submitDisabled)}}let q=(()=>{class J{formService;dataSourceService;layerService;map=new d.yGW({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:15};form$=new W.g(void 0);data$=new W.g(void 0);submitDisabled=!0;valueChanges$$;constructor(c,C,$){this.formService=c,this.dataSourceService=C,this.layerService=$}ngOnInit(){this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(re=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:re,baseLayer:!0,visible:!0}))});const C=[{name:"geometry",title:"Geometry",options:{validator:oe.AQ.required},type:"geometry",inputs:{map:this.map,geometryTypeField:!0,geometryType:"Polygon",drawGuideField:!0,drawGuide:50,drawGuidePlaceholder:"Draw Guide",drawStyle:new B.cp({stroke:new X.c({color:[255,0,0,1],width:2}),fill:new V.c({color:[255,0,0,.2]}),image:new z.c({radius:8,stroke:new X.c({color:[255,0,0,1]}),fill:new V.c({color:[255,0,0,.2]})})})}},{name:"name",title:"Name",options:{validator:oe.AQ.required}}].map(re=>this.formService.field(re)),$=this.formService.form([],[this.formService.group({name:"info"},C)]);this.valueChanges$$=$.control.valueChanges.subscribe(()=>{this.submitDisabled=!$.control.valid}),this.form$.next($)}ngOnDestroy(){this.valueChanges$$.unsubscribe()}fillForm(){this.data$.next({name:"Place",geometry:JSON.stringify({type:"Polygon",coordinates:[[[-106,42],[-107,31],[-81,32],[-82,42],[-106,42]]]})})}clearForm(){this.form$.value.control.reset()}onSubmit(c){alert(JSON.stringify(c))}static \u0275fac=function(C){return new(C||J)(o.GI1(y.eO),o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-geometry"]],standalone:!0,features:[o.UHJ],decls:8,vars:6,consts:[["title","Geometry Form","subtitle","Geo"],["codeFolder","geo/geometry"],[1,"container"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[3,"form","formData","submitForm",4,"ngIf"],[3,"form","formData","submitForm"],[3,"group"],["formButtons","",1,"actions-container"],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"div",2)(3,"igo-map-browser",3)(4,"div",4),o.wR5(5,"igo-zoom-button",5),o.C$Y()(),o.yuY(6,A,10,6,"igo-form",6),o.wVc(7,"async"),o.C$Y()()()),2&C&&(o.yG2(3),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("ngIf",o.kDX(7,4,$.form$)))},dependencies:[g.u,R.I,d.q2F,d.qcl,L.u_,y.Yl,y.O8,N.oJ,N.Gw,L.a],styles:["[_nghost-%COMP%]   pre[_ngcontent-%COMP%], [_nghost-%COMP%]   code[_ngcontent-%COMP%]{font-family:monospace,monospace}[_nghost-%COMP%]   pre[_ngcontent-%COMP%]{overflow:auto}[_nghost-%COMP%]   pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}[_nghost-%COMP%]   igo-map-browser[_ngcontent-%COMP%]{flex:1;height:500px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{display:flex;gap:16px}"]})}return J})();var _=s(9588),u=s(9364),S=s(75872),P=s(42860),I=s(34419),U=s(76332),G=s(87159);const O=()=>["LanguageService"];let F=(()=>{class J{dataSourceService;layerService;mediaService;pointerCoordDelay=0;pointerHoverFeatureDelay=0;map=new d.yGW({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:8,projection:"EPSG:3857"};get media(){return this.mediaService.getMedia()}get isTouchScreen(){return this.mediaService.isTouchScreen()}constructor(c,C,$){this.dataSourceService=c,this.layerService=C,this.mediaService=$,this.layerService.createAsyncLayer({title:"Quebec Base Map",baseLayer:!0,visible:!0,sourceOptions:{type:"xyz",url:"https://geoegl.msp.gouv.qc.ca/carto/tms/1.0.0/carte_gouv_qc_public@EPSG_3857/{z}/{x}/{-y}.png"}}).subscribe(Ce=>this.map.addLayer(Ce)),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",params:{featureTypes:"MSP_CASERNE_PUBLIC",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"shp"}}).subscribe(Ce=>{this.map.addLayer(this.layerService.createLayer({title:"Casernes",visible:!0,source:Ce,igoStyle:{styleByAttribute:{attribute:"en_caserne",data:["true","false"],stroke:["red","blue"],fill:["#ffffff","#ffffff"],radius:[7,7],width:[2,2]},hoverStyle:{label:{attribute:"Caserne: ${no_caserne}\xa0\nMun: ${nom_ssi}",style:{textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:{color:"#000"},backgroundFill:{color:"rgba(255, 255, 255, 0.5)"},backgroundStroke:{color:"rgba(200, 200, 200, 0.75)",width:2},stroke:{color:"#fff",width:3},overflow:!0,offsetX:20,offsetY:10,padding:[2.5,2.5,2.5,2.5]}},baseStyle:{circle:{stroke:{color:"orange",width:5},radius:15}}}}}))})}static \u0275fac=function(C){return new(C||J)(o.GI1(d.OEM),o.GI1(d.IZ6),o.GI1(_.QB))};static \u0275cmp=o.In1({type:J,selectors:[["app-hover"]],standalone:!0,features:[o.UHJ],decls:10,vars:11,consts:[["title","Hover","subtitle","Geo",3,"dependencies"],["codeFolder","geo/hover"],["igoHoverFeature","",3,"map","view","igoHoverFeatureDelay","igoHoverFeatureEnabled"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"div",4)(5,"igo-rotation-button",5),o.C$Y(),o.I0R(6,"div",6),o.wR5(7,"igo-home-extent-button",7)(8,"igo-geolocate-button",7)(9,"igo-zoom-button",8),o.C$Y()()()()),2&C&&(o.E7m("dependencies",o.q4q(10,O)),o.yG2(2),o.E7m("map",$.map)("view",$.view)("igoHoverFeatureDelay",$.pointerHoverFeatureDelay)("igoHoverFeatureEnabled",!0),o.yG2(3),o.E7m("showIfNoRotation",!0)("map",$.map),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map))},dependencies:[g.u,R.I,d.SET,u.q,S.q,P.c,I.e,U.i,G.C],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:500px}"]})}return J})();const Q=()=>["LanguageService"];let r=(()=>{class J{layerService;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:9};store=new y.cr([]);constructor(c){this.layerService=c,this.layerService.createAsyncLayer({title:"OSM",baseLayer:!0,visible:!0,sourceOptions:{type:"osm"}}).subscribe(C=>this.map.addLayer(C))}static \u0275fac=function(C){return new(C||J)(o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-import-export"]],standalone:!0,features:[o.UHJ],decls:10,vars:7,consts:[["title","Import / Export","subtitle","Geo",3,"dependencies"],["codeFolder","geo/import-export"],["cols","2","rowHeight","500px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100"],[1,"w-100",3,"store","map"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"igo-zoom-button",5),o.C$Y()()(),o.I0R(7,"mat-grid-tile")(8,"div",6),o.wR5(9,"igo-import-export",7),o.C$Y()()()()()),2&C&&(o.E7m("dependencies",o.q4q(6,Q)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(3),o.E7m("store",$.store)("map",$.map))},dependencies:[g.u,R.I,x.CQ,x.ae,x.cn,d.q2F,d.qcl,d.OrO]})}return J})();function ie(J,Y){if(1&J&&o.wR5(0,"igo-metadata-button",10)(1,"igo-download-button",10)(2,"igo-ogc-filter-button",11)(3,"igo-time-filter-button",11)(4,"igo-track-feature-button",12),2&J){const c=Y.layer;o.E7m("layer",c),o.yG2(),o.E7m("layer",c),o.yG2(),o.E7m("header",!0)("layer",c),o.yG2(),o.E7m("header",!0)("layer",c),o.yG2(),o.E7m("layer",c)("trackFeature",!0)}}const ae=()=>["LanguageService"];let fe=(()=>{class J{dataSourceService;layerService;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],maxLayerZoomExtent:[-11e6,45e5,-45e5,1e7],zoom:7};constructor(c,C){this.dataSourceService=c,this.layerService=C,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(Ce=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",baseLayer:!0,visible:!0,source:Ce}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:"geojson",srsName:"EPSG:32198",outputFormatDownload:"shp"},ogcFilters:{enabled:!0,editable:!1,filters:{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"12072"}},formatOptions:{dataProjection:"EPSG:32198"}}).subscribe(Ce=>{this.map.addLayer(this.layerService.createLayer({title:"WFS (Custom EPSG)",visible:!0,source:Ce,removable:!1}))}),this.layerService.createAsyncLayer({title:"Parcs routiers",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"parc_routier",VERSION:"1.3.0"}}}).subscribe(Ce=>this.map.addLayer(Ce)),this.layerService.createAsyncLayer({title:"R\xe9seau routier",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"bgr_v_sous_route_res_sup_act",VERSION:"1.3.0"}}}).subscribe(Ce=>this.map.addLayer(Ce)),this.layerService.createAsyncLayer({title:"Lieux habit\xe9s",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"lieuhabite",VERSION:"1.3.0"}}}).subscribe(Ce=>this.map.addLayer(Ce)),this.layerService.createAsyncLayer({title:"Direction du vent",visible:!1,legendOptions:{stylesAvailable:[{name:"WDIR6-LINEAR",title:"WDIR6-LINEAR"},{name:"WDIR6",title:"WDIR6"},{name:"WDIR3-LINEAR",title:"WDIR3-LINEAR"},{name:"WDIR3",title:"WDIR3"}]},sourceOptions:{type:"wms",url:"https://geo.weather.gc.ca/geomet?lang=fr",params:{LAYERS:"HRDPS.CONTINENTAL_WD",VERSION:"1.3.0"}}}).subscribe(Ce=>this.map.addLayer(Ce)),this.layerService.createAsyncLayer({title:"District \xe9cologique",visible:!1,sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",params:{LAYERS:"sh_dis_eco",VERSION:"1.3.0"}}}).subscribe(Ce=>this.map.addLayer(Ce)),this.layerService.createAsyncLayer({title:"Avertissements routiers",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"evenements",VERSION:"1.3.0"}}}).subscribe(Ce=>this.map.addLayer(Ce)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",refreshIntervalSec:15,params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"}}).subscribe(Ce=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles",source:Ce,metadata:{url:"https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp",extern:!0}}))})}static \u0275fac=function(C){return new(C||J)(o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-layer"]],standalone:!0,features:[o.UHJ],decls:13,vars:10,consts:[["title","Layer","subtitle","Geo",3,"dependencies"],["codeFolder","geo/layer"],["cols","2","rowHeight","600px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100"],["title","Layers",1,"w-100"],[3,"map","layers","expandLegendOfVisibleLayers","queryBadge","excludeBaseLayers"],["igoLayerItemToolbar",""],[3,"layer"],[3,"header","layer"],[3,"layer","trackFeature"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"igo-zoom-button",5),o.C$Y()()(),o.I0R(7,"mat-grid-tile")(8,"div",6)(9,"igo-panel",7)(10,"igo-layer-list",8),o.yuY(11,ie,5,8,"ng-template",null,9,o.gJz),o.C$Y()()()()()()()),2&C&&(o.E7m("dependencies",o.q4q(9,ae)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(4),o.E7m("map",$.map)("layers",$.map.layers)("expandLegendOfVisibleLayers",!1)("queryBadge",!0)("excludeBaseLayers",!0))},dependencies:[g.u,R.I,x.CQ,x.ae,x.cn,d.q2F,d.qcl,y.cP,d.m2U,d.ktW,d.Idw,d.YdQ,d.eM$,d.Ga$]})}return J})();const le=()=>["LanguageService"];let ue=(()=>{class J{dataSourceService;layerService;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};constructor(c,C){this.dataSourceService=c,this.layerService=C,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(re=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",visible:!0,baseLayer:!0,source:re}))}),this.layerService.createAsyncLayer({title:"Legend with display: false",legendOptions:{display:!1},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",params:{LAYERS:"sh_dis_eco",VERSION:"1.3.0"}}}).subscribe(re=>this.map.addLayer(re)),this.layerService.createAsyncLayer({title:"Legend with html param",legendOptions:{html:'<h2 style="background-color: blue;">HTML legend</h2>'},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",params:{LAYERS:"sh_sreg_eco",VERSION:"1.3.0"}}}).subscribe(re=>this.map.addLayer(re)),this.layerService.createAsyncLayer({title:"Legend with url param",legendOptions:{url:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxASEhUQEBISFRUVFRAQFRUQFRUVFRAPFRUWFhUVFRUYHSggGBolGxUVITEiJSkrLi4uFx8zODMsNygtLisBCgoKDg0OGhAQGy0dHyUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tKy0tLS0tLS0tLf/AABEIAKgBLAMBIgACEQEDEQH/xAAbAAABBQEBAAAAAAAAAAAAAAACAQMEBQYAB//EADwQAAIBAwEGAwYFAgUEAwAAAAECAAMEESEFEjFBUWETInEGFDKBkaFCscHR8FJyFSNTYoIzQ5LxFqLh/8QAGQEAAwEBAQAAAAAAAAAAAAAAAAECAwQF/8QAJREBAQACAgEFAAEFAAAAAAAAAAECERIhAwQTMUFRYRQiI3Gh/9oADAMBAAIRAxEAPwB0QhAEMTFQhCEEQhACEIQRFEYEIQgiEIAU6IIsAWLEnQAp0KmBqSdFBY+g5D1OBGD4nxYBHQafQzLPzTDLVbYeHLObh2LARwwyD+4PQiFNJZZuMrLLqlnRJ0ZFiTp0A6KEOM4OITuF8q4L8ydVp9sc2+0atrlw/hVGLBw2MnO66gsMdBpjHeYZeoxmXGOjH0+Vx5UsSLEm7ndEM6IYAhgmEYJgCGCYRgmIBMEwjAJgAmAYRgkwAGjTxxjGniBipGo5UjcAthCEAGEIwMQhAEIGAHFEERcxgYiiBmEDADzFgAxcwA50HMXMANh5H/tA+rrJhXy8JDXJDAcSpx6jB/SE18u6uuhGnqeU4vPP8m7+PR9N34tT9V20FZD4ifMcmHSSra5V1DKdD9Qeh7yLd1d4HAOJm7W9q27NlWKE55cOozzleLLTPz4b7bPM7MrbXbC1AFRQGb4d84OemP17Rk7YYsUREJUn8XxhfjI7gzp5xyXGrjMj3l5uYVfjYeX/AGrzb15D5mRau0N0Bt3e3uAVhoO56ympms1Z6lTtgaaDHAdgBiZZ+Tc1G3i8fe60FsN0AZ1iLUzXpDTRifqpHGVh2ioGMP8AIQtm3G9WUdmbX+04nNw3Y7+Wsb/peRJ0Qz0HkOMQzokQcTBM4xCYBxgGKTBJgCEwTFJgEwBCYBMUmCTABaMvHGMacxGZeNw3jUCWwMIGNAwgYwdBhAxoGEDAHAYQMbBigwBzMIGNAwgYA4DFzGwYWYwPMXMbzCBgD1PjxxylRUuEpv4J0PDXPx9BLNDrI17bMtd2PmVgrNngHwNdZzeeTqur02dm4RquAWK4A111yOxme2tXZicaAcuZGf3/ADl7UrFtRwA68x69jM/eVGffZcBkyxA0bdAGZHjna/Jl0pKdJmuFUN8A3ufyA+UGz3jVABIOWBOez5z05fWSrxs0qV2g1DbrY/pJAx35H6yMoxWDjhq2Ou8Dp/5GdDmBYsy7yF87rnGpx/NZfWd4yrg65JGeJHM6SjpjcthUK+apUI7glifyMnUKhV9zPH4vpjT7yMpteF0tL6qwAK6j0zr6x72YY1HLlQNwNnHMnQfrIyVAujHThx0lt7MhQKqjj5W/46iRjO42zyvG6XGYhMSJmdLjdmITOJgkwBSYJMQmITAOJgkziYJMA4mATOJgEwDiYBM4mATAOYxpzCJjTGIG3MbzFcwMwCzBhAxpQekPdPSPVLcOAwgYzgxd6GjPAwsxkNFDQB7MUNGhnpDCGPVLcOAxQY3unpFzA9nQYoMaBhAxBO2bS3qijvk+g1kXbFVqlY0qWAB56jHn0EnbPfw1ZzngeExu3L2qRu0iVNVtWGclQPyyZz+T+7LTfx9Y7XdfaNvRQh2ydFAXBJY6AADhrjjMlW2jRSqCyVFLb2vlO8uobKjQj9oT2lMUmpHILbp8TGSHU6b2OIzIVwtVt1moFmUEK9IhlI7a9esMJB5Ll9L1dnqLUCk29TJJ05KSfuAT9BK/w/PpodBwGdOGny9NInsrfstSpQq+UMDuqdd0jj+hkg4Fbf5Zzj7Qm5bKq9yWHLq1QUEeqd1UffAxx5LpzPDSU9G/pl2dKTnd0YlgCfly4R72huHqV6dKjhgi4wdBvEfY6SOthUGfFZKYbG8KZLVHA5Y5SsZNdoz3vpate0agXdyuQG3X4gH85P8AZ2p4dfdfmCgP+08P0lNcW3jDK090IMIc6jHAd47sWuxanv8AEFR8wZOuul7beoMEiBmFVyTnrGjmdHbmKTBJiZnYgCExCYpWAYg4mAWiEwC0AItAJiFoBaAKTAJiFoJMA5jGnMJjG2gDTmDmKwMHBhomsFsI4trLJLaP07aepxjjtqmNn2jbWA6TRi1gNbCK4Y0TLJnvch0hrZdpc+COkcShJ4YnyyVVOzjwtO0tVoiOCkJWoXalNnANl2l74U4UIaxPtRe59oq2faXvgTnTAJ0+gkZSKm2M9pK2F8NSQeOnT9pQJbFqbVq9ZRpujGm4O2ect/amoynLZ3dfh00PUzMW9AK2uMH4S3mHbAPOeLbvderJrUO+IHXcRqjqOBekx9QGUg4+RjKW1VGyhK9cAjP/ABM0lihGFqPT64Ua/wD1kza9gXVGViMHOFpv59eBMmZ96O4xjaNBxVNTdw7ndXPEA8TIj3JBPE68wdZtKeyvGTB31ZSSrqGTB5EZOT85namyqu97rk+Lx8TAx4e98Weu7p1zNMcti46VtrSZnFRR5hkH04D6ayStlU1YAknJydSPU/WaB9jigoCbxYnLMys28Txzidsy2KKcsxzyKFQO2WzFzK4M8XXIR9/e0KsWA83TdXQQrOo6VlBXy7+8OfHiJZ7QsS2rboA1UhRnI4a6SHswO9dd4g6jkVOnYiPG7icpp6LTtwVB7RDajpBt78DRvvH/AH1ZvPPYxvilR/dlne7iSPGUwHdYf1U/C9j+TDWwgGzzHGrATkuR1mmPqML8xN8GU+Ki1LDtGv8ADzLujWUyQKAM6Zhhe3PblOmaNlBNjNT7oOkZqW4j9vEuVZr3CC1oJoDbxipZw4Q+VULUBGzb9polsIZsBF7cHJmPdD0ie5zTe4RPcu0qeKJudaJbacaMaW9ne9TH3m3tnRTMUWxMKjWllQIMfvUe3FctnFNsZdLTE40BF7lPhFL7tE92ls9CR3oGL3aOEREoR8W8NaZEdEPdo4REa2kPaFLdQky33pA2yM0mHaTl5bqqmE2yF8ErJgg4xxI4ntnjMc9N0yppgINTUYjyjkWc8PQYlvR2luVGSrndUgZ6k8FH3k7aNrTqqoqaLxWmuSSepxr+vpPPn8uxmLFwrb9Niyg6u5O4D0A+Jzrw9Jq7C/p1BuFjjucHeHHOD3GnLnrpMnteg4ICEBVyCyjSmnMKvXlnnnAwDqxb3wUhcYxhDg5wF1K/fB6lm7StS9lu/bf+5Mo8gU548vrxMpG2NW8fxd8cMbpXQjP1kKx2zcAZVsjjg8DrJr+0tXnTXPDOsXU+D+Vi1uxH+YFUDnnOR+kp9pbVpou4nDUZ46+n8/SQ7zaNWpjeY45gcBKa+vV1GBk/U6/nz/8AcJjunbqHql+w1NUlTwHEHtrofQiFb3qrh38nJQOHqU5fKV1FN3LvjH9J4N0P84QqVJqzg/g7jgOhmmmdu2pvr1t1cZ1Gc/hP04SGu2WQ7rR2nWVk3AVwowN7OCZn9s13yKemBqMYixm+itaVdtA8DJ9ttANznm4uWXnLSy2lgZzDLx/gmbZ3lbTIMrqN6d7GZWU9rqeJkb3vLgrFMP1VybaxdidJorJmHGUGwwzAEiX7XAAwY/H5ssPhOfjmS0R1Mbq0hK1nIGQY5bXe8NTOvH1Eyc98OkoUYnu8RLgR9amZtM2dxAtvOahJIEBjK5xPFEqUwJBeprJt3UAEzdzdeY6zPLzaOePbcps9e0L/AA4dJW09o1BxWSKe1+oM5OUdXE89liAodYX+KrOF6hj5wcTyXhHGODaYkZipgG3Uw5jinC/U84a3APOVhsl6wDa9GMXKjiuBVWGMGUPgVOTSXRFQcY5kNLTwRIm0LfyH0MEXbDiI1dbSBUiPotMNtawR8OOKZO7nAL/zny5a6jF3l/cU3L587ZHDRKY00HLJ4dh3mr2lvhjVpkFMtvr1A79ZE8ajcDBAD8xzHQZ+k5rdNpNswdsOiDxBlm1HLGuhx24/MSDUuVxvU9NBkdcgZ/naX+1dj7zDGCNEHYAfw/OUd7sKoDoDz4fQSsbiLMg0L9eRZTofLwJ5nEsVvSQMEHn007zPvs6qOXI4wOcdt7e4A3TqOGvDMu4xPKrK8r1GGE0zrK0lE1Ygtr9ZEqUq+8QoYZ5dPST9mbHz56p0HIx6khbtqRs62asByAz5Tkj+cZZ3VZKaGjTxvt9usgXF+f8Ap0RjGBnkO8C2UJlmbLccnv0zJ190966iws3VFwQGxqe31lZcMu8TjGekds7nVmYZz5cc4l5bEciM8MjEufKag3FvkZWQDvLLClX3TumSXtlaVtOlNTZidJodhW53gWjFCgqydZVSGzIzvS8Me29s75KaY5yBd7Wzw+0qQ5PGMuxBnJa6pjFqu1anDlJFLaeBrKRq2kAVsysUZRa0/aDdfBOk0uydso/AzynajkHIh7P2g9MhgSJ1Y7nbmuq9sN0McZWXe1FHEiZq22m1ZNG+kS22O1U5ZjD3h7azvdrKRoZlbi5JYnM1dD2YTmWPzjh2BRGm4PpJ7vdPUnw0NGgx+IYhtbCW7UpFqWy88iGhtULa68ZKS1XtHfcFJyHM6tZNyePUG3NZ9DGXsao+FozVsq/4XEVLW6/1F+kWv4Dmo3A6GMV2uRwUH5yZv3K8d0wm2qy/HSPy1ho0K2vao+ND8pY09rrzBHqIFLbFBtOB7x2rbpUGVIilB9b6mw4iQ7w02U4xwMYr7PbGglXWsXXJ1Eq5CRQ1qLGk3hnO4xGP9szW6lQgklH+IngSM66GW3+IFC6qMgtu4P4uWgme2xc+bygZGpI7Hh9dJGrs9xOb3mm3HfGOXEAc+8JNsgndIKnkCMcOEpBt5kwTjQa4568B9oR21Tc+dRoQo7aZOvpF7d+4rnPqr1LpSQB3PXGRgfpGGZs4ABGn01IP86SppIh1QkajTPLOknWTMjEE59f6c4+uknjpUy2kJqx0Hy5aZlZtO6GoB04a8AeklOzZYKJQ3jK2jNjtLwxRlkb97J8qDA4EnnOe4Pwrr8v3nF6IGCfl1hU95x/lKFX+o8Zqz2KgAmrnXiB0mh9/NWhlk0XTMzFeg40G8x68pK2O1Viafhs2RoADmFn2UokUE4IkqpSKiC9AqcEFSDqDxEnOuV1itVIrLepvHEuLeljUyBQoYOZNNWZZ1rhE4NOqtI9N51SpMuDbloDVI2z44Rlt5jhQT/aM/lJFLZF2w0oVPmMfnNJGWWSDdJvSFd6LiXjez17/AKLfMr+8hXexrofFRf5YP5TWVjew+z+0igmq2f7UAYXHGU+xvZhviqndHTnLC62Va6qr+YDkRmZZZY29LmOWu24ttpBlGCIFVWJ4mZT2c2dVQ5Z/T0mqLGLnvo+Om4DwWAPKMLCDTfbLTmtUPLEaOzRyJj2/6wg8Ogrq+yHPwuZCqbGuR8NQ/OX+8YYc9fyhqBl22Rd/6sae0vV/Eh9QZqKtZxwUn+3EHxcjJRvprFYcrJVEqf8AdoBu6a/Yxmnof8moyH+ipn9ZsPBzqAV9RKu+2dVbiiOv0Mjirki2ntCVIS4XHLe5H5y2uHpumQRqJm721qoMeE7pzUgkj+085SJfvRPlLGm3JshkPTBi3Z8nqX4RtpWtKmlR6jYPiNu4x5RMlV2Z4qnwgxUebI54zgA8M/vNPV2OtxVFWuc0qYyFzoWJzrJVrWp1AapA8FDu00XgzD8Rx3hy0VxYil7NVCm8FJAIAAGdSAePPlIdXZaqPMCOJJweWh/Oenrf1ar+HTUIAN9ieRI8oA689eEZuEWoDSuAjZ47vlA7b2fN8oTy/o4fjzZaCqcjTHCPVr8annqPUHj+8l7Z2HUouSgLodQVGcfIcJR1mA0PPryM11Kjek6zqkNkNnXnKe8phqrdznEstnWdWq2KSlsfTHrNLsj2URH8W4IJ4hAeJ7mFymI1az+yNg75B0A5F8y7q0UoEK64HBWOCra6AGLta7u97IUIg0AQ4wO3IwrfaAqLuVNQ2hBBAJ7f0kdpF3e1TU6NeDSqkKh3W6/hbtkcD2jaq1u281XXBwFVgQegbGD9Yxf7JqU8VKJ38fhPxYGvz/PSS6hS5okjRlBOD8SkcQecc/4VDWvKdUZyS3VskyOwPIymt3K1N09cazTWNMtooLHoNZVx0UyRKNJzyku12RVqHyAn0ms2T7Lu2GqkAdBrNTQtqNEYAGn84CRdLlrIbO9i3YDxHx2XUy+tfY61p6shc/7tf/yWr7RxooP/AIn8sSK+0UY+YVVPZTg/XSLo7s74NOmMU6aL6LGffQ3lzg+kYN1RByXYf8WB9eOPtHqN5bVPxjPDJGDJCsudpVkbcYadeokG6vqg83FTx04TV07ZOJdHXln9JL8OnjAVT2wBCSj4YY12chcZzoMSds72NtUqeNVyznXU6D5cJqVorn/poMcMYMSuBzXP7R446K3Y1taOBhRpwkKvbrn4BCNUE+Rs9uYjqk8xH0O04Oen3hmQaVxHQ8pKauOs7HeRd4wlJ6wCSSP/AFBL9MxsRcmAPo/Uzt8dzGgIYWMONbtAas3yhPpIdZzHsaSTV7/eMXNJXGHVWHRgD+cbWqOAEcCdY52FTfbCouhRVZAcE+G3T1z9pSXexqlNadOnh0Vt473kxrkZHMCbMiRquDpJuMPahegtOmFGMsxZyPxdsyjvL2lTfKrvMRrnXHp0mpvLEOMA4lDtL2WqMd5GGnUcfpMbhdtJlNKOl7TVN4gBR2lXdWdC8rA1PIx0O7oGMXbOzqlFt90I5EjUGVlglZ6quadUIuSCqnX7TTDH7ic7GztLBLVXRMKgAJJ1Zmmd2rdMy75JGuF5GOUPfXfd3SygkgucEjlkTrzYl61QOyAqOQPOTwvLsTKadTu2NMipwA4HnGNneEy7yjUHjnOnTEtP/itzVQhmCZ+ZxFs/YitSXcVxgnU45RzHorlNoV9cimA3MlcfvHqQtCQ7O9NyDnChlIP9XD85p7T2ctwAKi75HNjmHfez1vU0A3ca+XT6yuPSeW2HX2cUtvU7iiykg+clGHyOn3m02PbW9BQDUTqSGBLH5cpW3fskRqnm7DQ/aV52Qy6MHHqTC205I2F17UUlG7SBbvwEz9z7Q12/Hx5KMYjVts4D8DH6mFb7IqbxCocciREfR+32rWHmZyf1k239oXPHQyPU2DXOuAOgzGDs9wQCsCae020rDDYj1SiG1plfRgCJkLi2qLjcU9TLjZVZ9CYocy0sjQdf+zSz/tHGLb+Lzor8s/vJi3MJLnJ0jvRy7O0Cw/CAPU/vHDUx3iUzn4sQXccBHpBqqik7w0PUfr1jxRzqpGO/WNEQPFxwMVitomHzHkqHrEnQkI5TrmOi4nTpRDW5jouDOnRmIV2jq3ESdFQJ68YJJnToASkLqZFr7S1wonTobBErMRrG3M6dEAKxkynV0nTowi3Qpt8QBi0FpcAonToEbr2VPO9gQhTUjAnTpROWniGyTp0ZK+uwBgb/AEE6dIqofpEwy4X4hn1nToqccbxQMhRH7a7zyAnToYlXVq0ZVA3ETp0mnB1LVcaxilQXOAIk6HxSSjSAEra+8moiTppZuJnRy3vAeJklWXOQZ06R8KO+IesBlnTo7Q//2Q=="},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",params:{LAYERS:"sh_reg_eco",VERSION:"1.3.0"}}}).subscribe(re=>this.map.addLayer(re)),this.layerService.createAsyncLayer({title:"Commissions scolaires anglophones",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",params:{LAYERS:"WMS_MEQ_CS_ANGLO",VERSION:"1.3.0"}}}).subscribe(re=>this.map.addLayer(re)),this.layerService.createAsyncLayer({title:"R\xe9seau routier",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"bgr_v_sous_route_res_sup_act",VERSION:"1.3.0"}}}).subscribe(re=>this.map.addLayer(re)),this.layerService.createAsyncLayer({title:"Lieux habit\xe9s",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"lieuhabite",VERSION:"1.3.0"}}}).subscribe(re=>this.map.addLayer(re)),this.layerService.createAsyncLayer({title:"Avertissements routiers",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"evenements",VERSION:"1.3.0"}}}).subscribe(re=>this.map.addLayer(re)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",refreshIntervalSec:15,params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"}}).subscribe(re=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles",source:re,metadata:{url:"https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp",extern:!0}}))})}static \u0275fac=function(C){return new(C||J)(o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-legend"]],standalone:!0,features:[o.UHJ],decls:7,vars:10,consts:[["title","Simple Map with a legend list","subtitle","Geo",3,"dependencies"],["codeFolder","geo/legend"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["title","Legends"],[3,"layers","excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.I0R(5,"igo-panel",5),o.wR5(6,"igo-layer-legend-list",6),o.C$Y()()()),2&C&&(o.E7m("dependencies",o.q4q(9,le)),o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(2),o.E7m("layers",$.map.layers)("excludeBaseLayers",!0)("allowShowAllLegends",!0)("updateLegendOnResolutionChange",!1)("showAllLegendsValue",!1))},dependencies:[g.u,R.I,d.q2F,d.qcl,y.cP,d.wSE],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]})}return J})();const se=()=>["LanguageService"];let ge=(()=>{class J{dataSourceService;layerService;map=new d.yGW({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:6,projection:"EPSG:3857"};store=new d.ym_([],{map:this.map});constructor(c,C){this.dataSourceService=c,this.layerService=C,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:$,baseLayer:!0,visible:!0}))})}static \u0275fac=function(C){return new(C||J)(o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-measure"]],standalone:!0,features:[o.UHJ],decls:6,vars:7,consts:[["title","Measure","subtitle","Geo",3,"dependencies"],["codeFolder","geo/measure"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[3,"store","map"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.wR5(5,"igo-measurer",5),o.C$Y()()),2&C&&(o.E7m("dependencies",o.q4q(6,se)),o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("store",$.store)("map",$.map))},dependencies:[g.u,R.I,d.q2F,d.qcl,d.yaV],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-measurer[_ngcontent-%COMP%]     mat-divider{position:inherit!important;left:inherit!important;width:160px!important}"]})}return J})();const Ie=()=>["LanguageService"];let Re=(()=>{class J{dataSourceService;layerService;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};constructor(c,C){this.dataSourceService=c,this.layerService=C,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(Vt=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:Vt,baseLayer:!0,visible:!0}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"code_municipalite",alias:"# de la municipalit\xe9e"},{name:"date_observation",excludeFromOgcFilters:!0},{name:"urgence",values:["imm\xe9diate","inconnue"]}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:d.w35.All,filters:{logical:"Or",filters:[{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"10043"},{operator:"Intersects",geometryName:"the_geom",wkt_geometry:"MULTIPOLYGON(((\n              -8379441.158019895 5844447.897707146,\n              -8379441.158019895 5936172.331649357,\n              -8134842.66750733 5936172.331649357,\n              -8134842.66750733 5844447.897707146,\n              -8379441.158019895 5844447.897707146\n            ), (\n              -8015003 5942074,\n              -8015003 5780349,\n              -7792364 5780349,\n              -7792364 5942074,\n              -8015003 5942074\n            )))"}]}}}).subscribe(Vt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (PropertyIsEqualTo OR Intersects polygon)",source:Vt,style:new B.cp({image:new z.c({radius:5,fill:new V.c({color:"white"}),stroke:new X.c({color:"orange",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:d.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-21T00:00:00-05:00",end:"2016-01-26T00:00:00-05:00"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2016-02-10T00:00:00-05:00",stepDate:"P2D"}).subscribe(Vt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Step: P2D)",id:"1",source:Vt,style:new B.cp({image:new z.c({radius:5,fill:new V.c({color:"white"}),stroke:new X.c({color:"red",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:d.w35.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:d.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01T04:00:00-05:00",end:"2016-01-12T16:00:00-05:00"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2016-02-14T20:00:00-05:00",stepDate:"PT4H"}).subscribe(Vt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Step: PT4H)",id:"2",source:Vt,style:new B.cp({image:new z.c({radius:5,fill:new V.c({color:"white"}),stroke:new X.c({color:"blue",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:d.w35.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:d.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01T00:00:00-05:00",end:"2016-03-31T00:00:00-05:00",displayFormat:"MMMM"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2018-12-31T00:00:00-05:00",stepDate:"P1M"}).subscribe(Vt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Step: P1M)",id:"3",source:Vt,style:new B.cp({image:new z.c({radius:5,fill:new V.c({color:"white"}),stroke:new X.c({color:"yellow",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:d.w35.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:d.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"2014-01-01T00:00:00-05:00",end:"2019-12-31T00:00:00-05:00",displayFormat:"YYYY"}},minDate:"2014-01-01T00:00:00-05:00",maxDate:"2019-12-31T00:00:00-05:00",stepDate:"P1Y"}).subscribe(Vt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Step: P1Y)",id:"4",source:Vt,style:new B.cp({image:new z.c({radius:5,fill:new V.c({color:"white"}),stroke:new X.c({color:"green",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:d.w35.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:d.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"today - 2 days",end:"today"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2025-12-31T00:00:00-05:00",stepDate:"P1D"}).subscribe(Vt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Interval from Now, Step: P1D)",id:"5",source:Vt,style:new B.cp({image:new z.c({radius:5,fill:new V.c({color:"white"}),stroke:new X.c({color:"black",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:d.w35.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:d.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"2019-01-01 00:00:00",restrictToStep:!0}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2025-12-31T00:00:00-05:00",stepDate:"P1M"}).subscribe(Vt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, RestrictToStep, Step: P1M)",id:"6",source:Vt,style:new B.cp({image:new z.c({radius:5,fill:new V.c({color:"black"}),stroke:new X.c({color:"red",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",optionsFromCapabilities:!1,params:{LAYERS:"vg_observation_v_autre_wmst",VERSION:"1.3.0"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:d.w35.Time}],ogcFilters:{enabled:!0,editable:!0,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01 00:00:00",end:"2020-01-01 00:00:00"},allowedOperatorsType:d.w35.Time}}).subscribe(Vt=>{this.map.addLayer(this.layerService.createLayer({title:"Inondations (During)",source:Vt}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",urlWfs:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"radars_photos",VERSION:"1.3.0"},ogcFilters:{enabled:!0,editable:!0,pushButtons:{selectorType:"pushButton",order:2,groups:[{title:"Nom du group1 - push",name:"1 - push",ids:["id1"]}],bundles:[{id:"id1",title:"R\xe9gions",logical:"Or",vertical:!0,selectors:[{title:"Montr\xe9al & Laval",enabled:!1,tooltip:"Here a tooltip explaining ...",filters:{logical:"Or",filters:[{operator:"PropertyIsEqualTo",propertyName:"region",expression:"Montr\xe9al"},{operator:"PropertyIsEqualTo",propertyName:"region",expression:"Laval"}]}},{title:"Outside Montr\xe9al & Laval",enabled:!1,tooltip:"Here a tooltip explaining ...",filters:{logical:"And",filters:[{operator:"PropertyIsNotEqualTo",propertyName:"region",expression:"Montr\xe9al"},{operator:"PropertyIsNotEqualTo",propertyName:"region",expression:"Laval"}]}}]}]},checkboxes:{selectorType:"checkbox",order:1,groups:[{title:"Nom du group1 - checkbox",name:"1 - checkbox",ids:["id1"]}],bundles:[{id:"id1",title:"Type de radar photo",logical:"Or",selectors:[{title:"Radar photo fixe",enabled:!0,tooltip:"Here a tooltip explaining ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo fixe"}},{title:"Radar photo mobile",enabled:!1,tooltip:"Here a tooltip explaining ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo mobile"}},{title:"Radar photo fixe + feu rouge",enabled:!1,color:"0,200,0",tooltip:"Here a tooltip explaining ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo fixe et surveillance au feu rouge"}},{title:"Radar feu rouge",enabled:!1,color:"255,0,0",tooltip:"Here a tooltip explaining ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Appareil de surveillance au feu rouge"}}]}]},allowedOperatorsType:d.w35.Basic},paramsWFS:{featureTypes:"radars_photos",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"1.1.0",outputFormat:"geojson",outputFormatDownload:"shp"}}).subscribe(Vt=>{this.map.addLayer(this.layerService.createLayer({title:"Filterable WMS layers with predefined filters (push buttons)",source:Vt}))})}static \u0275fac=function(C){return new(C||J)(o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-ogc-filter"]],standalone:!0,features:[o.UHJ],decls:11,vars:7,consts:[["title","Ogc filter","subtitle","Geo",3,"dependencies"],["codeFolder","geo/ogc-filter"],["cols","2","rowHeight","600px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100","overflow-y-auto"],["title","Layers"],[3,"map","layers"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"igo-zoom-button",5),o.C$Y()()(),o.I0R(7,"mat-grid-tile")(8,"div",6)(9,"igo-panel",7),o.wR5(10,"igo-ogc-filterable-list",8),o.C$Y()()()()()()),2&C&&(o.E7m("dependencies",o.q4q(6,Ie)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(4),o.E7m("map",$.map)("layers",$.map.layers))},dependencies:[g.u,R.I,x.CQ,x.ae,x.cn,d.q2F,d.qcl,y.cP,d.isy]})}return J})(),He=(()=>{class J{dataSourceService;layerService;map=new d.yGW({overlay:!0,controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};constructor(c,C){this.dataSourceService=c,this.layerService=C}ngOnInit(){this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(c=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:c,baseLayer:!0,visible:!0}))})}ngAfterViewInit(){this.map.overlay.setFeatures([{type:d.YfI,projection:"EPSG:4326",meta:{id:1},properties:{},geometry:{type:"Point",coordinates:[-73,46.6]}},{type:d.YfI,projection:"EPSG:4326",meta:{id:2},properties:{},geometry:{type:"LineString",coordinates:[[-72,47.8],[-73.5,47.4],[-72.4,48.6]]}},{type:d.YfI,projection:"EPSG:4326",meta:{id:3},properties:{},geometry:{type:"Polygon",coordinates:[[[-71,46.8],[-73,47],[-71.2,46.6]]]}}],d.Suj.None)}static \u0275fac=function(C){return new(C||J)(o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-overlay"]],standalone:!0,features:[o.UHJ],decls:5,vars:3,consts:[["title","Overlay","subtitle","Geo"],["codeFolder","geo/overlay"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()()()()),2&C&&(o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map))},dependencies:[g.u,R.I,d.q2F,d.qcl],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]})}return J})();const ht=()=>["LanguageService"];let rt=(()=>{class J{layerService;map=new d.yGW({controls:{attribution:{collapsed:!1}}});view={center:[-73,47.2],zoom:9};constructor(c){this.layerService=c,this.layerService.createAsyncLayer({title:"Quebec Base Map",baseLayer:!0,visible:!0,sourceOptions:{type:"xyz",url:"https://geoegl.msp.gouv.qc.ca/carto/tms/1.0.0/carte_gouv_qc_public@EPSG_3857/{z}/{x}/{-y}.png",crossOrigin:"anonymous"}}).subscribe(C=>this.map.addLayer(C)),this.layerService.createAsyncLayer({title:"Emb\xe2cles",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(C=>this.map.addLayer(C)),this.layerService.createAsyncLayer({title:"Radar m\xe9t\xe9o",sourceOptions:{type:"wms",url:"https://geo.meteo.gc.ca/geomet?lang=fr",params:{LAYERS:"RADAR_1KM_RRAI",VERSION:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(C=>this.map.addLayer(C)),this.layerService.createAsyncLayer({title:"A\xe9roports",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq?",params:{layers:"aeroport",version:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(C=>this.map.addLayer(C))}static \u0275fac=function(C){return new(C||J)(o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-print"]],standalone:!0,features:[o.UHJ],decls:14,vars:10,consts:[["title","Print","subtitle","Geo",3,"dependencies"],["codeFolder","geo/print"],["cols","2","rowHeight","800px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"],[3,"map"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"div",5)(7,"igo-rotation-button",6),o.C$Y(),o.I0R(8,"div",7),o.wR5(9,"igo-home-extent-button",8)(10,"igo-geolocate-button",8)(11,"igo-zoom-button",9),o.C$Y()()(),o.I0R(12,"mat-grid-tile"),o.wR5(13,"igo-print",10),o.C$Y()()()()),2&C&&(o.E7m("dependencies",o.q4q(9,ht)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(3),o.E7m("showIfNoRotation",!0)("map",$.map),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(2),o.E7m("map",$.map))},dependencies:[g.u,R.I,x.CQ,x.ae,x.cn,d.cdH,d.eqy,d.q2F,d.i6P,d.qcl,d.eAF],styles:["[_nghost-%COMP%]   igo-print[_ngcontent-%COMP%]{overflow-y:auto;width:100%;height:100%}"]})}return J})();var xt=s(58264),Rt=s(62808),Ze=s(80848),Kt=s(36752),ve=s(61252),$e=s(87048);function Ne(J,Y){if(1&J&&(o.I0R(0,"div")(1,"h1"),o.OEk(2," Query Title : "),o.I0R(3,"span",8),o.OEk(4),o.C$Y()(),o.wR5(5,"igo-feature-details",9),o.C$Y()),2&J){const c=Y.$implicit,C=o.GaO(2);o.yG2(4),o.cNF(C.getTitle(c)),o.yG2(),o.E7m("feature",c)}}function Ae(J,Y){if(1&J&&(o.SAx(0),o.yuY(1,Ne,6,2,"div",7),o.k70()),2&J){const c=Y.ngIf;o.yG2(),o.E7m("ngForOf",c)}}const dt=()=>[];let je=(()=>{class J{dataSourceService;layerService;features$=new W.g([]);map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};constructor(c,C){this.dataSourceService=c,this.layerService=C,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:$,baseLayer:!0,visible:!0}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryable:!0,params:{layers:"bgr_v_sous_route_res_sup_act",version:"1.3.0"}}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"WMS",source:$}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryable:!0,queryFormat:d.s5H.HTMLGML2,queryHtmlTarget:d.IlJ.IFRAME,params:{layers:"aeroport",version:"1.3.0"}}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"WMS html with a pre call in GML",source:$}))}),this.layerService.createAsyncLayer({title:"WMS with different query url",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",queryable:!0,queryFormat:d.s5H.HTMLGML2,queryHtmlTarget:d.IlJ.IFRAME,queryUrls:[{url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&BBOX={bbox}&CRS=EPSG%3A3857&WIDTH=900&HEIGHT=632&LAYERS=SDA_REGION_S_20K&STYLES=&FORMAT=image%2Fpng&QUERY_LAYERS=SDA_REGION_S_20K&INFO_FORMAT=text%2Fhtml&I=467&J=493"}],queryLayerFeatures:!1,params:{layers:"SDA_MUNIC_S_20K",version:"1.3.0"}}}).subscribe($=>this.map.addLayer($)),this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0,sourceFields:[{name:"name",alias:"Alias name"},{name:"description",alias:"Alias description"}]}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"Vector layer",source:$})),this.addFeatures($)}),this.layerService.createAsyncLayer({title:"Vector tile with different query url",sourceOptions:{type:"mvt",url:"https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf",queryable:!0,queryFormat:d.s5H.HTMLGML2,queryHtmlTarget:d.IlJ.IFRAME,queryUrls:[{url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&BBOX={bbox}&CRS=EPSG%3A3857&WIDTH=900&HEIGHT=632&LAYERS=SDA_REGION_S_20K&STYLES=&FORMAT=image%2Fpng&QUERY_LAYERS=SDA_REGION_S_20K&INFO_FORMAT=text%2Fhtml&I=467&J=493"}],queryLayerFeatures:!1},mapboxStyle:{url:"assets/mapboxStyleExample-vectortile.json",source:"ahocevar"}}).subscribe($=>this.map.addLayer($))}addFeatures(c){const C=new xt.c({name:"feature1",geometry:new Rt.c([ve.AF([-72,47.8],"EPSG:4326","EPSG:3857"),ve.AF([-73.5,47.4],"EPSG:4326","EPSG:3857"),ve.AF([-72.4,48.6],"EPSG:4326","EPSG:3857")])}),$=new xt.c({name:"feature2",geometry:new Ze.c(ve.AF([-73,46.6],"EPSG:4326","EPSG:3857"))}),re=new xt.c({name:"feature3",geometry:new Kt.cp([[ve.AF([-71,46.8],"EPSG:4326","EPSG:3857"),ve.AF([-73,47],"EPSG:4326","EPSG:3857"),ve.AF([-71.2,46.6],"EPSG:4326","EPSG:3857")]])});c.ol.addFeatures([C,$,re])}handleQueryResults(c){const C=c.features;C.length&&C[0]&&(this.features$.next(C),this.map.queryResultsOverlay.setFeatures(C,d.Suj.None))}getTitle(c){return(0,y.YB)(c)}static \u0275fac=function(C){return new(C||J)(o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-query"]],standalone:!0,features:[o.UHJ],decls:8,vars:9,consts:[["title","Query","subtitle","Geo",3,"dependencies"],["codeFolder","geo/query"],["igoOverlay","","igoQuery","",3,"map","view","queryFeatures","query"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["title","Details"],[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"background-color","#e0e0e0"],[3,"feature"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),o.qCj("query",function(Ce){return $.handleQueryResults(Ce)}),o.I0R(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.I0R(5,"igo-panel",5),o.yuY(6,Ae,2,1,"ng-container",6),o.wVc(7,"async"),o.C$Y()()()),2&C&&(o.E7m("dependencies",o.q4q(8,dt)),o.yG2(2),o.E7m("map",$.map)("view",$.view)("queryFeatures",!0),o.yG2(2),o.E7m("map",$.map),o.yG2(2),o.E7m("ngIf",o.kDX(7,6,$.features$)))},dependencies:[g.u,R.I,d.q2F,d.qcl,d.Iz2,d.G_h,$e.s,y.cP,L.u_,L.Iw,d.wP$,L.a],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]})}return J})();var Ke=s(21124),yt=s(33712),Le=s(32328),vt=s(87848),Se=s(27e3),Be=s(21724),ze=s(83600),St=s(24708),Dt=s(72584),mo=s(1296);function Bo(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"button",7),o.qCj("click",function(){o.usT(c);const $=o.GaO();return o.CGJ($.openGuide())}),o.wVc(1,"translate"),o.I0R(2,"span"),o.OEk(3),o.wVc(4,"translate"),o.C$Y(),o.wR5(5,"mat-icon",8),o.C$Y()}if(2&J){const c=o.GaO();o.E7m("disabled",c.loading)("matTooltip",o.kDX(1,3,"igo.integration.aboutTool.trainingGuideTooltip")),o.yG2(3),o.cNF(o.kDX(4,5,"igo.integration.aboutTool.trainingGuide"))}}function Xe(J,Y){if(1&J&&(o.I0R(0,"button",9),o.wVc(1,"translate"),o.I0R(2,"span"),o.OEk(3),o.wVc(4,"translate"),o.C$Y(),o.wR5(5,"mat-icon",8),o.C$Y()),2&J){const c=o.GaO(),C=o.Gew(5);o.E7m("disabled",c.loading)("matTooltip",o.kDX(1,4,"igo.integration.aboutTool.trainingGuideTooltip"))("matMenuTriggerFor",C),o.yG2(3),o.cNF(o.kDX(4,6,"igo.integration.aboutTool.trainingGuide"))}}function ct(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"button",10),o.qCj("click",function(){const re=o.usT(c).$implicit,Ce=o.GaO();return o.CGJ(Ce.openGuide(re))}),o.OEk(1),o.C$Y()}if(2&J){const c=Y.$implicit,C=o.GaO();o.yG2(),o.oRS(" ",C.formatFileName(c)," ")}}function tt(J,Y){if(1&J&&(o.wR5(0,"igo-custom-html",6),o.wVc(1,"translate")),2&J){const c=o.GaO();o.E7m("html",o.kDX(1,1,c.headerHtml))}}const st=J=>({version:J});let it=class Ps{configService;auth;http;cdRef;languageService;configOptions;get headerHtml(){return this._headerHtml}set headerHtml(Y){this._headerHtml=Array.isArray(Y)?Y.join("\n"):Y}get html(){return this._html}set html(Y){this._html=Array.isArray(Y)?Y.join("\n"):Y}_discoverTitleInLocale="IGO";discoverTitleInLocale$=(0,mo.of)(this._discoverTitleInLocale);get discoverTitleInLocale(){return this._discoverTitleInLocale}set discoverTitleInLocale(Y){this._discoverTitleInLocale=Y,this.discoverTitleInLocale$=(0,mo.of)(Y)}trainingGuideURLs;effectiveVersion;_html="igo.integration.aboutTool.html";_headerHtml;baseUrlProfil;baseUrlGuide;loading=!1;constructor(Y,c,C,$,re){this.configService=Y,this.auth=c,this.http=C,this.cdRef=$,this.languageService=re,this.headerHtml=this.languageService.translate.instant("igo.integration.aboutTool.headerHtml"),this.configOptions=this.configService.getConfigs();const Ce=this.configOptions.version;this.effectiveVersion=Ce?.app||Ce?.lib||ze.WU.lib,this.baseUrlProfil=this.configOptions.storage?.url,this.baseUrlGuide=this.configOptions.depot?.url+this.configOptions.depot?.guideUrl}ngOnInit(){this.auth.authenticated&&this.configOptions.context?.url?this.http.get(this.baseUrlProfil).subscribe(Y=>{this.trainingGuideURLs=Y.guides,this.cdRef.detectChanges()}):this.auth.authenticated&&!this.configOptions.context?.url&&this.configOptions.depot?.trainingGuides&&(this.trainingGuideURLs=this.configOptions.depot?.trainingGuides)}openGuide(Y){this.loading=!0;const c=Y?this.baseUrlGuide+Y+"?":this.baseUrlGuide+this.trainingGuideURLs[0]+"?";this.http.get(c,{responseType:"blob"}).subscribe(()=>{this.loading=!1,window.open(c,"_blank"),this.cdRef.detectChanges()})}formatFileName(Y){const c=(Y=Y.split("_").join(" ")).indexOf(".");return Y.slice(0,c)}static \u0275fac=function(c){return new(c||Ps)(o.GI1(ze.aW),o.GI1(Be.oj),o.GI1(yt.KK),o.GI1(o.kD9),o.GI1(St.ov))};static \u0275cmp=o.In1({type:Ps,selectors:[["igo-about-tool"]],inputs:{headerHtml:"headerHtml",html:"html",discoverTitleInLocale:"discoverTitleInLocale",trainingGuideURLs:"trainingGuideURLs"},standalone:!0,features:[o.UHJ],decls:10,vars:11,consts:[["mat-raised-button","","tourToStart","global","menuIsOpen","true","styleButton","raised",3,"discoverTitleInLocale$"],["class","training-guide-button","mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click",4,"ngIf"],["class","training-guide-button","mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"],["mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",1,"training-guide-button",3,"disabled","matTooltip","click"],["svgIcon","file-document"],["mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",1,"training-guide-button",3,"disabled","matTooltip","matMenuTriggerFor"],["mat-menu-item","",3,"click"]],template:function(c,C){1&c&&(o.wR5(0,"p")(1,"igo-interactive-tour",0),o.yuY(2,Bo,6,7,"button",1)(3,Xe,6,8,"button",2),o.I0R(4,"mat-menu",null,3),o.yuY(6,ct,2,1,"button",4),o.C$Y(),o.yuY(7,tt,2,3,"igo-custom-html",5),o.wR5(8,"igo-custom-html",6),o.wVc(9,"translate")),2&c&&(o.yG2(),o.E7m("discoverTitleInLocale$",C.discoverTitleInLocale$),o.yG2(),o.E7m("ngIf",C.auth.authenticated&&C.trainingGuideURLs&&1===C.trainingGuideURLs.length),o.yG2(),o.E7m("ngIf",C.auth.authenticated&&C.trainingGuideURLs&&C.trainingGuideURLs.length>1),o.yG2(3),o.E7m("ngForOf",C.trainingGuideURLs),o.yG2(),o.E7m("ngIf",""!==C.headerHtml),o.yG2(),o.E7m("html",o.g7$(9,6,C.html,o.S45(9,st,C.effectiveVersion))))},dependencies:[y.Er,L.u_,N.oJ,N.Gw,Se.KO,Se.a4,Le.oB,Le.qL,vt._A,vt.aM,vt.OQ,vt.yG,L.Iw,y.YM,Dt.O0,Dt.sD],styles:["igo-interactive-tour[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:20px}.training-guide-button[_ngcontent-%COMP%]{margin-left:5px;background-color:#1976d2;color:#fff;padding:0 12px}"]})};it=(0,Ke.UN)([(0,y.aA)({name:"about",title:"igo.integration.tools.about",icon:"help-circle"}),(0,Ke.YR)("design:paramtypes",[ze.aW,Be.oj,yt.KK,o.kD9,St.ov])],it);var Qt=s(35876),ao=s(37496);let mt=(()=>{class J{mapService;projectionService;storageService;configService;get showAllLegendsValue(){return this._legendToolShowAll}set showAllLegendsValue(c){this._legendToolShowAll=c}_legendToolShowAll;get map(){return this._map}_map;constructor(c,C,$,re){this.mapService=c,this.projectionService=C,this.storageService=$,this.configService=re,this._map=new d.yGW({controls:{scaleLine:!0,attribution:{collapsed:!0}}},this.storageService,this.configService),this.mapService.setMap(this.map)}static \u0275fac=function(C){return new(C||J)(o.CoB(d.u00),o.CoB(d.qME),o.CoB(e.yQ),o.CoB(ze.aW))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),$t=(()=>{class J{get catalogStore(){return this._catalogStore}_catalogStore;catalogItemsStores=new Map;constructor(c){this._catalogStore=new y.qc([]),c.authenticate$.subscribe(()=>{this.clearCatalogItemsStores()})}getCatalogItemsStore(c){return this.catalogItemsStores.get(c.id)}setCatalogItemsStore(c,C){this.catalogItemsStores.set(c.id,C)}clearCatalogItemsStores(){this.catalogItemsStores.clear()}static \u0275fac=function(C){return new(C||J)(o.CoB(Be.oj))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();function Lo(J,Y){if(1&J&&o.wR5(0,"igo-catalog-browser",1),2&J){const c=Y.ngIf,C=o.GaO();o.E7m("catalog",C.catalog)("store",c)("map",C.map)("toggleCollapsedGroup",C.toggleCollapsedGroup)}}let Uo=class Fs{catalogService;catalogState;mapState;authService;catalog;store$=new W.g(void 0);catalog$$;toggleCollapsedGroup=!0;get map(){return this.mapState.map}constructor(Y,c,C,$){this.catalogService=Y,this.catalogState=c,this.mapState=C,this.authService=$}ngOnInit(){const c=this.catalogState.catalogStore.stateView.firstBy$($=>!0===$.state.selected);this.catalog$$=(0,Qt.E)([c,this.authService.authenticate$]).subscribe(([$,re])=>{this.catalog=$.entity,this.loadCatalogItems(this.catalog)})}ngOnDestroy(){this.catalog$$.unsubscribe()}loadCatalogItems(Y){let c=this.catalogState.getCatalogItemsStore(Y);void 0===c?(c=new y.qc([]),this.catalogState.setCatalogItemsStore(Y,c),this.catalogService.loadCatalogItems(Y).pipe((0,ao.U)(1)).subscribe(C=>{c.load(C),this.store$.next(c)})):this.store$.next(c)}static \u0275fac=function(c){return new(c||Fs)(o.GI1(d.oxI),o.GI1($t),o.GI1(mt),o.GI1(Be.oj))};static \u0275cmp=o.In1({type:Fs,selectors:[["igo-catalog-browser-tool"]],inputs:{toggleCollapsedGroup:"toggleCollapsedGroup"},standalone:!0,features:[o.UHJ],decls:2,vars:3,consts:[[3,"catalog","store","map","toggleCollapsedGroup",4,"ngIf"],[3,"catalog","store","map","toggleCollapsedGroup"]],template:function(c,C){1&c&&(o.yuY(0,Lo,1,4,"igo-catalog-browser",0),o.wVc(1,"async")),2&c&&o.E7m("ngIf",o.kDX(1,1,C.store$))},dependencies:[L.u_,d.iOV,L.a],encapsulation:2,changeDetection:0})};Uo=(0,Ke.UN)([(0,y.aA)({name:"catalogBrowser",title:"igo.integration.tools.catalog",icon:"photo-browser",parent:"catalog"}),(0,Ke.YR)("design:paramtypes",[d.oxI,$t,mt,Be.oj])],Uo);var Bt=function(J){return J.layer="layer",J.context="context",J}(Bt||{}),eo=function(J){return J.import="import",J.export="export",J}(eo||{});let uo=(()=>{class J{importExportType$=new W.g(Bt.layer);selectedMode$=new W.g(eo.import);exportOptions$=new W.g(void 0);setImportExportType(c){this.importExportType$.next(c)}setMode(c){this.selectedMode$.next(c)}setsExportOptions(c){this.exportOptions$.next(c)}static \u0275fac=function(C){return new(C||J)};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),zt=(()=>{class J{toolService;importExportState;get toolbox(){return this.toolService.toolbox}openSidenav$=new W.g(void 0);constructor(c,C){this.toolService=c,this.importExportState=C}toolToActivateFromOptions(c){if(c){if("importExport"===c.tool){let C=this.importExportState.exportOptions$.value;C?(C.layers=c.options.layers,C.featureInMapExtent=c.options.featureInMapExtent):C={layers:c.options.layers,featureInMapExtent:c.options.featureInMapExtent},this.importExportState.setsExportOptions(C),this.importExportState.setMode(eo.export)}this.toolbox.getTool(c.tool)&&(this.toolbox.activateTool(c.tool),this.openSidenav$.next(!0))}}static \u0275fac=function(C){return new(C||J)(o.CoB(y.IF),o.CoB(uo))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),qt=class Rs{catalogService;catalogState;toolState;storageService;get store(){return this.catalogState.catalogStore}addCatalogAllowed=!1;predefinedCatalogs=[];constructor(Y,c,C,$){this.catalogService=Y,this.catalogState=c,this.toolState=C,this.storageService=$}ngOnInit(){0===this.store.count&&this.loadCatalogs()}onCatalogSelectChange(Y){!1!==Y.selected&&this.toolState.toolbox.activateTool("catalogBrowser")}loadCatalogs(){this.catalogService.loadCatalogs().pipe((0,ao.U)(1)).subscribe(Y=>{this.store.clear(),this.store.load(Y.concat(this.storageService.get("addedCatalogs")||[]))})}static \u0275fac=function(c){return new(c||Rs)(o.GI1(d.oxI),o.GI1($t),o.GI1(zt),o.GI1(e.yQ))};static \u0275cmp=o.In1({type:Rs,selectors:[["igo-catalog-library-tool"]],inputs:{addCatalogAllowed:"addCatalogAllowed",predefinedCatalogs:"predefinedCatalogs"},standalone:!0,features:[o.UHJ],decls:1,vars:3,consts:[[3,"predefinedCatalogs","addCatalogAllowed","store","catalogSelectChange"]],template:function(c,C){1&c&&(o.I0R(0,"igo-catalog-library",0),o.qCj("catalogSelectChange",function(re){return C.onCatalogSelectChange(re)}),o.C$Y()),2&c&&o.E7m("predefinedCatalogs",C.predefinedCatalogs)("addCatalogAllowed",C.addCatalogAllowed)("store",C.store)},dependencies:[d.kvX],encapsulation:2,changeDetection:0})};qt=(0,Ke.UN)([(0,y.aA)({name:"catalog",title:"igo.integration.tools.catalog",icon:"layers-plus"}),(0,Ke.YR)("design:paramtypes",[d.oxI,$t,zt,e.yQ])],qt);var pe=s(37240);let ye=class Ls{toolState;constructor(Y){this.toolState=Y}submitSuccessed(){this.toolState.toolbox.activatePreviousTool()}static \u0275fac=function(c){return new(c||Ls)(o.GI1(zt))};static \u0275cmp=o.In1({type:Ls,selectors:[["igo-context-editor-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:0,consts:[["igoContextEditBinding","",3,"submitSuccessed"]],template:function(c,C){1&c&&(o.I0R(0,"igo-context-edit",0),o.qCj("submitSuccessed",function(){return C.submitSuccessed()}),o.C$Y())},dependencies:[pe.cl,pe.SS],encapsulation:2})};ye=(0,Ke.UN)([(0,y.aA)({name:"contextEditor",title:"igo.integration.tools.contexts",icon:"star",parent:"contextManager"}),(0,Ke.YR)("design:paramtypes",[zt])],ye);let xe=class Gs{toolState;mapState;toolToOpenOnContextChange="mapTools";get map(){return this.mapState.map}constructor(Y,c){this.toolState=Y,this.mapState=c}editContext(){this.toolState.toolbox.activateTool("contextEditor")}managePermissions(){this.toolState.toolbox.activateTool("contextPermissionManager")}static \u0275fac=function(c){return new(c||Gs)(o.GI1(zt),o.GI1(mt))};static \u0275cmp=o.In1({type:Gs,selectors:[["igo-context-manager-tool"]],inputs:{toolToOpenOnContextChange:"toolToOpenOnContextChange"},standalone:!0,features:[o.UHJ],decls:1,vars:1,consts:[["igoContextListBinding","",3,"map","edit","managePermissions"]],template:function(c,C){1&c&&(o.I0R(0,"igo-context-list",0),o.qCj("edit",function(){return C.editContext()})("managePermissions",function(){return C.managePermissions()}),o.C$Y()),2&c&&o.E7m("map",C.map)},dependencies:[pe.W2,pe.AX],encapsulation:2})};xe=(0,Ke.UN)([(0,y.aA)({name:"contextManager",title:"igo.integration.tools.contexts",icon:"star"}),(0,Ke.YR)("design:paramtypes",[zt,mt])],xe);let Ge=class $s{static \u0275fac=function(c){return new(c||$s)};static \u0275cmp=o.In1({type:$s,selectors:[["igo-context-permission-manager-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:0,consts:[["igoContextPermissionsBinding",""]],template:function(c,C){1&c&&o.wR5(0,"igo-context-permissions",0)},dependencies:[pe.KS,pe.Sm],encapsulation:2})};Ge=(0,Ke.UN)([(0,y.aA)({name:"contextPermissionManager",title:"igo.integration.tools.contexts",icon:"star",parent:"contextManager"})],Ge);let qe=(()=>{class J{keyword$=new W.g("");sortAlpha$=new W.g(void 0);onlyVisible$=new W.g(void 0);selectedTab$=new W.g(void 0);setKeyword(c){this.keyword$.next(c)}setSortAlpha(c){this.sortAlpha$.next(c)}setOnlyVisible(c){this.onlyVisible$.next(c)}setSelectedTab(c){this.selectedTab$.next(c)}getLayerListControls(){return{keyword:this.keyword$.value,onlyVisible:this.onlyVisible$.value,sortAlpha:this.sortAlpha$.value}}static \u0275fac=function(C){return new(C||J)};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),Ue=class As{mapState;layerListToolState;get map(){return this.mapState.map}get layerListControls(){return this.layerListToolState.getLayerListControls()}constructor(Y,c){this.mapState=Y,this.layerListToolState=c}static \u0275fac=function(c){return new(c||As)(o.GI1(mt),o.GI1(qe))};static \u0275cmp=o.In1({type:As,selectors:[["igo-context-share-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:1,consts:[[3,"map"]],template:function(c,C){1&c&&o.wR5(0,"igo-share-map",0),2&c&&o.E7m("map",C.map)},dependencies:[pe.mE],encapsulation:2})};Ue=(0,Ke.UN)([(0,y.aA)({name:"shareMap",title:"igo.integration.tools.shareMap",icon:"share-variant"}),(0,Ke.YR)("design:paramtypes",[mt,qe])],Ue);let Ut=(()=>{class J{contextService;toolService;toolState;languageService;context$=new W.g(void 0);constructor(c,C,$,re){this.contextService=c,this.toolService=C,this.toolState=$,this.languageService=re,this.contextService.context$.subscribe(Ce=>{this.onContextChange(Ce)}),this.contextService.toolsChanged$.subscribe(Ce=>{this.updateTools(Ce)})}setContext(c){this.updateTools(c),this.context$.next(c)}updateTools(c){const C=this.toolState.toolbox,$=[];(c.tools||[]).forEach(Ce=>{const Ve=this.toolService.getTool(Ce.name);if(void 0===Ve)return;const nt=Object.assign({},Ve.options||{},Ce.options||{}),at=Object.assign({},Ve,Ce,{options:nt});$.push(at)}),$.forEach(Ce=>{if(Ce.parent){const Ve=$.findIndex(nt=>nt.name===Ce.parent);-1!==Ve&&($[Ve].children=[],$[Ve].children.push(Ce.name))}}),C.setTools($),C.setToolbar(c.toolbar||[]),this.contextService.setTools([].concat($)),this.contextService.setToolbar(c.toolbar||[])}onContextChange(c){void 0!==c&&this.setContext(c)}static \u0275fac=function(C){return new(C||J)(o.CoB(pe.M9),o.CoB(y.IF),o.CoB(zt),o.CoB(St.ov))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();var Zt=s(93020);let _t=(()=>{class J{mapState;zoomToActiveRoute$=new w.E;stopsStore=new d.SYK([]);stopsFeatureStore;routesFeatureStore;stepFeatureStore;debounceTime=200;constructor(c){this.mapState=c,this.stopsFeatureStore=new d.czr([],{map:this.mapState.map}),this.routesFeatureStore=new d.aWp([],{map:this.mapState.map}),this.stepFeatureStore=new d.qM$([],{map:this.mapState.map}),this.mapState.map.ol.once("rendercomplete",()=>{this.stopsFeatureStore.empty$.subscribe(C=>{this.stopsFeatureStore.layer?.options&&(this.stopsFeatureStore.layer.options.showInLayerList=!C)}),this.routesFeatureStore.empty$.subscribe(C=>{this.routesFeatureStore.layer?.options&&(this.routesFeatureStore.layer.options.showInLayerList=!C)})}),this.mapState.map.layers$.subscribe(()=>{this.mapState.map.getLayerById("igo-direction-stops-layer")||(this.stopsStore.deleteMany(this.stopsStore.all()),this.stopsFeatureStore.deleteMany(this.stopsFeatureStore.all())),this.mapState.map.getLayerById("igo-direction-route-layer")||this.routesFeatureStore.deleteMany(this.routesFeatureStore.all())})}static \u0275fac=function(C){return new(C||J)(o.CoB(mt))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),Gt=class ks{directionState;mapState;languageService;messageService;storageService;contextState;authService;currentContextUri;get stopsStore(){return this.directionState.stopsStore}get debounceTime(){return this.directionState.debounceTime}get stopsFeatureStore(){return this.directionState.stopsFeatureStore}get routesFeatureStore(){return this.directionState.routesFeatureStore}get stepFeatureStore(){return this.directionState.stepFeatureStore}get zoomToActiveRoute$(){return this.directionState.zoomToActiveRoute$}get map(){return this.mapState.map}constructor(Y,c,C,$,re,Ce,Ve){this.directionState=Y,this.mapState=c,this.languageService=C,this.messageService=$,this.storageService=re,this.contextState=Ce,this.authService=Ve}ngOnInit(){this.storageService.get("direction.warning.shown")||(this.messageService.info("igo.integration.directions.warning.message","igo.integration.directions.warning.title",{timeOut:2e4}),this.storageService.set("direction.warning.shown",!0,e.Ab.SESSION)),this.contextState.context$.subscribe(c=>{this.authService.authenticated||(this.currentContextUri=c.uri)})}static \u0275fac=function(c){return new(c||ks)(o.GI1(_t),o.GI1(mt),o.GI1(St.ov),o.GI1(Zt.mi),o.GI1(e.yQ),o.GI1(Ut),o.GI1(Be.oj))};static \u0275cmp=o.In1({type:ks,selectors:[["igo-directions-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:7,consts:[[3,"contextUri","debounce","stopsStore","stopsFeatureStore","stepFeatureStore","routesFeatureStore","zoomToActiveRoute$"]],template:function(c,C){1&c&&o.wR5(0,"igo-directions",0),2&c&&o.E7m("contextUri",C.currentContextUri)("debounce",C.debounceTime)("stopsStore",C.stopsStore)("stopsFeatureStore",C.stopsFeatureStore)("stepFeatureStore",C.stepFeatureStore)("routesFeatureStore",C.routesFeatureStore)("zoomToActiveRoute$",C.zoomToActiveRoute$)},dependencies:[d.aw9,b.U],encapsulation:2})};Gt=(0,Ke.UN)([(0,y.aA)({name:"directions",title:"igo.integration.tools.directions",icon:"directions"}),(0,Ke.YR)("design:paramtypes",[_t,mt,St.ov,Zt.mi,e.yQ,Ut,Be.oj])],Gt);let At=(()=>{class J{mapState;stores=[];layersID=[];drawControls=[];activeDrawingLayer;constructor(c){this.mapState=c,this.mapState.map.layers$.subscribe(()=>{this.layersID.forEach(C=>{if(!this.mapState.map.getLayerById(C)){let $=this.stores.find(Ce=>Ce.layer.id===C);$.deleteMany($.all()),this.stores.splice(this.stores.indexOf($,0),1),this.layersID.splice(this.layersID.indexOf(C,0),1);let re=this.drawControls.findIndex(Ce=>Ce[0]===C);this.drawControls.splice(re,1)}})});for(let C of this.stores)C=new d.ym_([],{map:this.mapState.map})}static \u0275fac=function(C){return new(C||J)(o.CoB(mt))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),Go=class Bs{drawState;mapState;get stores(){return this.drawState.stores}get map(){return this.mapState.map}get layersID(){return this.drawState.layersID}get drawControls(){return this.drawState.drawControls}set drawControls(Y){this.drawState.drawControls=Y}get activeDrawingLayer(){return this.drawState.activeDrawingLayer}set activeDrawingLayer(Y){this.drawState.activeDrawingLayer=Y}addLayersID(Y){this.layersID.push(Y)}addDrawControls(Y){this.drawControls=Y}constructor(Y,c){this.drawState=Y,this.mapState=c}static \u0275fac=function(c){return new(c||Bs)(o.GI1(At),o.GI1(mt))};static \u0275cmp=o.In1({type:Bs,selectors:[["igo-drawing-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:4,consts:[[3,"stores","map","activeDrawingLayer","drawControls","layersIDEvent","drawControlsEvent","activeLayerChange"]],template:function(c,C){1&c&&(o.I0R(0,"igo-draw",0),o.qCj("layersIDEvent",function(re){return C.addLayersID(re)})("drawControlsEvent",function(re){return C.addDrawControls(re)})("activeLayerChange",function(re){return C.activeDrawingLayer=re}),o.C$Y()),2&c&&o.E7m("stores",C.stores)("map",C.map)("activeDrawingLayer",C.activeDrawingLayer)("drawControls",C.drawControls)},dependencies:[d.Se2],encapsulation:2,changeDetection:0})};Go=(0,Ke.UN)([(0,y.aA)({name:"draw",title:"igo.integration.tools.draw",icon:"draw"}),(0,Ke.YR)("design:paramtypes",[At,mt])],Go);var To=s(53291);function on(J="300ms",Y="ease-in-out"){return(0,To.gV)("toolSlideInOut",[(0,To.K2)("enter",(0,To.wb)({transform:"translateX(100%)"})),(0,To.aK)("void => enter",(0,To.Cs)(J+" "+Y))])}let ai=class Us{mapState;get map(){return this.mapState.map}get layer(){for(const Y of this.map.layers)if(!0===Y.options.active)return Y}animate="enter";constructor(Y){this.mapState=Y}static \u0275fac=function(c){return new(c||Us)(o.GI1(mt))};static \u0275cmp=o.In1({type:Us,selectors:[["igo-active-ogc-filter-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:4,consts:[[3,"map","layer","header"]],template:function(c,C){1&c&&o.wR5(0,"igo-ogc-filterable-item",0),2&c&&o.E7m("map",C.map)("layer",C.layer)("header",!1)("@toolSlideInOut",C.animate)},dependencies:[d.__k],encapsulation:2,data:{animation:[on()]}})};function Li(J="300ms",Y="ease-in-out"){return(0,To.gV)("toolSlideInOut",[(0,To.K2)("enter",(0,To.wb)({transform:"translateX(100%)"})),(0,To.aK)("void => enter",(0,To.Cs)(J+" "+Y))])}ai=(0,Ke.UN)([(0,y.aA)({name:"activeOgcFilter",title:"igo.integration.tools.ogcFilter",icon:"filter",parent:"mapTools"}),(0,Ke.YR)("design:paramtypes",[mt])],ai);let bi=class Ys{mapState;get map(){return this.mapState.map}get layer(){for(const Y of this.map.layers)if(!0===Y.options.active)return Y}animate="enter";constructor(Y){this.mapState=Y}static \u0275fac=function(c){return new(c||Ys)(o.GI1(mt))};static \u0275cmp=o.In1({type:Ys,selectors:[["igo-active-time-filter-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:3,consts:[[3,"layer","header"]],template:function(c,C){1&c&&o.wR5(0,"igo-time-filter-item",0),2&c&&o.E7m("layer",C.layer)("header",!1)("@toolSlideInOut",C.animate)},dependencies:[d.gpx],encapsulation:2,data:{animation:[Li()]}})};bi=(0,Ke.UN)([(0,y.aA)({name:"activeTimeFilter",title:"igo.integration.tools.timeFilter",icon:"history",parent:"mapTools"}),(0,Ke.YR)("design:paramtypes",[mt])],bi);let Qo=class Vs{constructor(){}static \u0275fac=function(c){return new(c||Vs)};static \u0275cmp=o.In1({type:Vs,selectors:[["igo-ogc-filter-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:0,consts:[["igoOgcFilterableListBinding",""]],template:function(c,C){1&c&&o.wR5(0,"igo-ogc-filterable-list",0)},dependencies:[d.isy,d.E9h],encapsulation:2})};Qo=(0,Ke.UN)([(0,y.aA)({name:"ogcFilter",title:"igo.integration.tools.ogcFilter",icon:"filter"}),(0,Ke.YR)("design:paramtypes",[])],Qo);var li=s(12396),Gi=s(91088),$i=s(44816),Zo=s(94364),ci=s(78600),Yo=s(53404);let Vo=(()=>{class J{igoStorageService;get storageService(){return this.igoStorageService}constructor(c){this.igoStorageService=c}static \u0275fac=function(C){return new(C||J)(o.CoB(e.yQ))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();var Eo=s(64002),_o=s(864),Io=(s(32256),s(40604));function ui(J,Y){J.entityStore.getStrategyOfType(d.kj0).setMotion(Y.get("zoomAuto")?d.Suj.Default:d.Suj.None)}function qo(J,Y,c,C,$,re,Ce,Ve,nt,at){const wt=[{id:"zoomAuto",checkbox:!0,title:"igo.integration.workspace.zoomAuto.title",tooltip:"igo.integration.workspace.zoomAuto.tooltip",checkCondition:$,handler:()=>{ui(J,Ce),Ce.set("zoomAuto",!Ce.get("zoomAuto"))}},{id:"filterInMapExtent",checkbox:!0,title:"igo.integration.workspace.inMapExtent.title",tooltip:(0,d.wvY)(J),checkCondition:Y,handler:()=>Y.next(!Y.value)},{id:"selectedOnly",checkbox:!0,title:"igo.integration.workspace.selected.title",tooltip:"igo.integration.workspace.selected.tooltip",checkCondition:c,handler:()=>c.next(!c.value)},{id:"clearselection",icon:"select-off",title:"igo.integration.workspace.clearSelection.title",tooltip:"igo.integration.workspace.clearSelection.tooltip",handler:Et=>{Et.entityStore.state.updateMany(Et.entityStore.view.all(),{selected:!1})},args:[J],availability:Et=>(0,d.UfW)(Et)},{id:"featureDownload",icon:"file-export",title:"igo.integration.workspace.download.title",tooltip:"igo.integration.workspace.download.tooltip",handler:Et=>{const Vt=Et.entityStore.getStrategyOfType(y.qq),fo=Et.entityStore.getStrategyOfType(y.xx).active?[Et.layer.id]:[];at.toolToActivateFromOptions({tool:"importExport",options:{layers:[Et.layer.id],featureInMapExtent:Vt.active,layersWithSelection:fo}})},args:[J]},{id:"ogcFilter",icon:"filter",title:"igo.integration.workspace.ogcFilter.title",tooltip:"igo.integration.workspace.ogcFilter.tooltip",handler:(Et,Vt)=>{Vt.activateWidget(Et,{map:Vt.map,layer:Vt.layer})},args:[C,J]},{id:"maximize",title:Ve.translate.instant("igo.integration.workspace.maximize"),tooltip:Ve.translate.instant("igo.integration.workspace.maximizeTooltip"),icon:"resize",display:()=>re.pipe((0,Io.k)(Et=>!Et&&!nt.isMobile())),handler:()=>{nt.isMobile()||re.next(!0)}},{id:"standardExtent",title:Ve.translate.instant("igo.integration.workspace.standardExtent"),tooltip:Ve.translate.instant("igo.integration.workspace.standardExtentTooltip"),icon:"resize",display:()=>re.pipe((0,Io.k)(Et=>Et&&!nt.isMobile())),handler:()=>{re.next(!1)}},{id:"print",icon:"printer",title:"igo.integration.workspace.print.title",tooltip:"igo.integration.workspace.print.tooltip",handler:Et=>{const Vt=`${Et.layer.title} (${(0,Eo.U1)(new Date,"YYYY-MM-DD-HH_mm")})`,Ft=new _o.default("landscape"),fo="{total_pages_count_string}";Ft.text(Vt,14,20),Ft.autoTable({startY:25,tableWidth:"wrap",html:"#currentWorkspaceTable",horizontalPageBreak:!0,styles:{cellPadding:.5,minCellWidth:20,fontSize:6},didDrawPage:bt=>{let ko="Page "+Ft.internal.getNumberOfPages();"function"==typeof Ft.putTotalPages&&(ko=ko+" / "+fo),Ft.setFontSize(6);const Qi=Ft.internal.pageSize,En=Qi.height?Qi.height:Qi.getHeight();Ft.text(ko,bt.settings.margin.left,En-10)}}),"function"==typeof Ft.putTotalPages&&Ft.putTotalPages(fo),Ft.save(`${Vt}.pdf`)},args:[J]}];let Wt=J.layer.dataSource.options.ogcFilters?.enabled?wt:wt.filter(Et=>"ogcFilter"!==Et.id);return Wt=!1!==J.layer.options.workspace.printable?wt:wt.filter(Et=>"print"!==Et.id),Wt}let di=(()=>{class J{ogcFilterWidget;storageState;languageService;mediaService;toolState;maximize$;zoomAuto$=new W.g(!1);storageChange$$;get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(c,C,$,re,Ce){this.ogcFilterWidget=c,this.storageState=C,this.languageService=$,this.mediaService=re,this.toolState=Ce,this.maximize$=new W.g(this.storageService.get("workspaceMaximize"))}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(c,C,$){const re=this.buildActions(c,C,$);c.actionStore.load(re)}buildActions(c,C,$){return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Yo.O)(re=>"zoomAuto"!==re?.key||re?.event===e.Om.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),ui(c,this.storageService)}),qo(c,C,$,this.ogcFilterWidget,this.zoomAuto$,this.maximize$,this.storageService,this.languageService,this.mediaService,this.toolState)}static \u0275fac=function(C){return new(C||J)(o.CoB(d.Kwu),o.CoB(Vo),o.CoB(St.ov),o.CoB(_.QB),o.CoB(zt))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),Co=(()=>{class J{storageState;languageService;toolState;mediaService;maximize$;zoomAuto$=new W.g(!1);storageChange$$;get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(c,C,$,re){this.storageState=c,this.languageService=C,this.toolState=$,this.mediaService=re,this.maximize$=new W.g(this.storageService.get("workspaceMaximize"))}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(c,C,$){const re=this.buildActions(c,C,$);c.actionStore.load(re)}buildActions(c,C,$){return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Yo.O)(re=>"zoomAuto"!==re?.key||re?.event===e.Om.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),ui(c,this.storageService)}),qo(c,C,$,void 0,this.zoomAuto$,this.maximize$,this.storageService,this.languageService,this.mediaService,this.toolState)}static \u0275fac=function(C){return new(C||J)(o.CoB(Vo),o.CoB(St.ov),o.CoB(zt),o.CoB(_.QB))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),Ai=(()=>{class J{ogcFilterWidget;storageState;languageService;mediaService;toolState;maximize$;selectOnlyCheckCondition$=new W.g(!1);zoomAuto$=new W.g(!1);storageChange$$;get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(c,C,$,re,Ce){this.ogcFilterWidget=c,this.storageState=C,this.languageService=$,this.mediaService=re,this.toolState=Ce,this.maximize$=new W.g(this.storageService.get("workspaceMaximize"))}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(c,C,$){const re=this.buildActions(c,C,$);c.actionStore.load(re)}buildActions(c,C,$){return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Yo.O)(re=>"zoomAuto"!==re?.key||re?.event===e.Om.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),ui(c,this.storageService)}),qo(c,C,$,this.ogcFilterWidget,this.zoomAuto$,this.maximize$,this.storageService,this.languageService,this.mediaService,this.toolState)}static \u0275fac=function(C){return new(C||J)(o.CoB(d.Kwu),o.CoB(Vo),o.CoB(St.ov),o.CoB(_.QB),o.CoB(zt))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),ot=(()=>{class J{featureActionsService;wfsActionsService;editionActionsService;storageService;workspacePanelExpanded=!1;workspaceEnabled$=new W.g(!1);rowsInMapExtentCheckCondition$=new W.g(!0);selectOnlyCheckCondition$=new W.g(!1);workspaceMaximize$;actionMaximize$$=[];rowsInMapExtentCheckCondition$$;selectOnlyCheckCondition$$;activeWorkspace$$;activeWorkspaceWidget$$;activeWorkspaceWidget$=new W.g(void 0);workspace$=new W.g(void 0);get store(){return this._store}_store;get workspaceSelection(){return this.workspace$.value?this.workspace$.value?.entityStore.stateView.manyBy(c=>!0===c.state.selected):[]}get workspaceSelection$(){return this.workspace$.value?this.workspace$.value?.entityStore?.stateView.manyBy$(c=>!0===c.state.selected):(0,mo.of)([])}constructor(c,C,$,re){this.featureActionsService=c,this.wfsActionsService=C,this.editionActionsService=$,this.storageService=re,this.workspaceMaximize$=new W.g(this.storageService.get("workspaceMaximize")),this.initWorkspaces()}initWorkspaces(){this._store=new y.cr([]),this._store.stateView.firstBy$(c=>!0===c.state.active).subscribe(c=>{this.workspace$.next(c?c.entity:void 0)}),this._store.stateView.all$().subscribe(c=>{c.map(C=>{C.entity.actionStore.empty&&(C.entity instanceof d.MrZ?this.wfsActionsService.loadActions(C.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$):C.entity instanceof d.Wwb?this.featureActionsService.loadActions(C.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$):C.entity instanceof d.gLH&&this.editionActionsService.loadActions(C.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$))})}),this.actionMaximize$$.push(this.featureActionsService.maximize$.subscribe(c=>{this.setWorkspaceIsMaximized(c)})),this.actionMaximize$$.push(this.wfsActionsService.maximize$.subscribe(c=>{this.setWorkspaceIsMaximized(c)})),this.actionMaximize$$.push(this.editionActionsService.maximize$.subscribe(c=>{this.setWorkspaceIsMaximized(c)})),this.activeWorkspace$$=this.workspace$.subscribe(c=>{void 0!==this.activeWorkspaceWidget$$&&(this.activeWorkspaceWidget$$.unsubscribe(),this.activeWorkspaceWidget$$=void 0),void 0!==c&&(this.activeWorkspaceWidget$$=c.widget$.subscribe(C=>this.activeWorkspaceWidget$.next(C)))}),this.rowsInMapExtentCheckCondition$$=this.rowsInMapExtentCheckCondition$.subscribe(c=>{this._store.stateView.all().map(C=>{if(!C.entity.actionStore.empty){const $=C.entity.entityStore.getStrategyOfType(y.qq);$&&(c?$.activate():$.deactivate())}})}),this.selectOnlyCheckCondition$$=this.selectOnlyCheckCondition$.subscribe(c=>{this._store.stateView.all().map(C=>{if(!C.entity.actionStore.empty){const $=C.entity.entityStore.getStrategyOfType(y.xx);$&&(c?$.activate():$.deactivate())}})})}setWorkspaceIsMaximized(c){this.storageService.set("workspaceMaximize",c),this.workspaceMaximize$.next(c)}setActiveWorkspaceById(c){const C=this.store.all().find($=>$.id===c);C&&this.store.activateWorkspace(C)}setActiveWorkspaceByTitle(c){const C=this.store.all().find($=>$.title===c);C&&this.store.activateWorkspace(C)}ngOnDestroy(){this.teardownWorkspaces(),this.actionMaximize$$.map(c=>c.unsubscribe()),this.rowsInMapExtentCheckCondition$$&&this.selectOnlyCheckCondition$$.unsubscribe(),this.selectOnlyCheckCondition$$&&this.selectOnlyCheckCondition$$.unsubscribe()}teardownWorkspaces(){this.store.clear(),void 0!==this.activeWorkspaceWidget$$&&this.activeWorkspaceWidget$$.unsubscribe(),void 0!==this.activeWorkspace$$&&this.activeWorkspace$$.unsubscribe()}static \u0275fac=function(C){return new(C||J)(o.CoB(Co),o.CoB(Ai),o.CoB(di),o.CoB(e.yQ))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();function go(J,Y){if(1&J&&(o.SAx(0),o.wR5(1,"igo-feature-details",3),o.k70()),2&J){const c=Y.ngIf;o.yG2(),o.E7m("feature",c)}}let to=class js{matIconRegistry;spatialFilterService;dataSourceService;layerService;mapState;messageService;languageService;importExportState;toolState;workspaceState;cdRef;get map(){return this.mapState.map}type;itemType=d.c97.Address;freehandDrawIsActive;layers=[];activeLayers=[];queryType;thematics;zone;zoneWithBuffer;buffer=0;iterator=1;selectedFeature$=new W.g(void 0);format=new li.c;store=new y.qc([]);spatialListStore=new y.qc([]);loading=!1;thematicLength=0;measureUnit=d.K88.Meters;unsubscribe$=new w.E;moveendKey;defaultStyle;constructor(Y,c,C,$,re,Ce,Ve,nt,at,wt,Wt){this.matIconRegistry=Y,this.spatialFilterService=c,this.dataSourceService=C,this.layerService=$,this.mapState=re,this.messageService=Ce,this.languageService=Ve,this.importExportState=nt,this.toolState=at,this.workspaceState=wt,this.cdRef=Wt}ngOnInit(){for(const Y of this.map.layers)Y.title&&Y.title.includes(this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"))&&this.layers.push(Y)}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}getOutputType(Y){this.type=Y,this.queryType=void 0}getOutputQueryType(Y){this.queryType=Y,this.queryType&&this.loadFilterList()}activateExportTool(){const Y=[],c=new RegExp("^Zone \\d+");for(const C of this.layers)C.title.match(c)||Y.push(C.id);this.importExportState.setMode(eo.export),this.importExportState.setsExportOptions({layers:Y}),this.toolState.toolbox.activateTool("importExport")}activateWorkspace(Y){let c;this.workspaceState.store.entities$.pipe((0,Zo.a)(this.unsubscribe$)).subscribe(()=>{if(!Y&&this.activeLayers.length&&this.workspaceState.store.all().length>1){if(this.itemType===d.c97.Thematics){for(const C of this.thematics)if(!C.zeroResults){c=this.activeLayers.find($=>$.title.includes(C.name+" "+this.iterator.toString()));break}}else{const C="Adresses "+this.iterator.toString();this.activeLayers.forEach($=>{$.title.includes(C)&&(c=$)})}c&&(this.workspaceState.workspacePanelExpanded=!0,this.workspaceState.setActiveWorkspaceById(c.id))}else Y&&this.activeLayers.length&&this.workspaceState.store.all().length>1&&(this.selectWorkspaceEntity(Y),this.moveendKey=this.map.ol.on("moveend",()=>{this.selectWorkspaceEntity(Y)}))})}selectWorkspaceEntity(Y){this.workspaceState.store.all().forEach(c=>{c.entityStore.state.updateAll({selected:!1}),c.title.includes(Y.added[0].meta.title)&&(this.workspaceState.setActiveWorkspaceById(c.id),c.entityStore.state.updateMany(Y.added,{selected:!0}))})}loadFilterList(){this.spatialFilterService.loadFilterList(this.queryType).pipe((0,Zo.a)(this.unsubscribe$)).subscribe(Y=>{Y.sort((c,C)=>c.properties.nom<C.properties.nom?-1:c.properties.nom>C.properties.nom?1:0),this.spatialListStore.clear(),this.spatialListStore.load(Y)})}getOutputToggleSearch(){this.loadThematics()}getOutputClearSearch(){this.zone=void 0,this.queryType=void 0}clearMap(){this.map.removeLayers(this.layers),this.layers=[],this.activeLayers=[],this.thematicLength=0,this.iterator=1,this.type===d._cQ.Predefined&&(this.zone=void 0,this.queryType=void 0)}loadThematics(){this.loading=!0;let c,Y=!0;(0===this.buffer||this.type===d._cQ.Point)&&this.tryAddFeaturesToMap([this.zone]),c=this.itemType!==d.c97.Thematics?[{name:""}]:this.thematics,this.measureUnit===d.K88.Kilometers&&this.type!==d._cQ.Point&&(this.buffer=1e3*this.buffer),this.type===d._cQ.Polygon&&(this.buffer=0);const C=[];c.forEach($=>{C.push(this.spatialFilterService.loadFilterItem(this.zone,this.itemType,this.queryType,$,this.buffer).pipe((0,ci.y)(re=>{this.store.insertMany(re);const Ce=[],Ve=[];let nt,at;re.forEach(wt=>{"Point"===wt.geometry.type?(wt.properties.longitude=wt.geometry.coordinates[0],wt.properties.latitude=wt.geometry.coordinates[1],Ce.push(wt),nt=wt.meta.id):(Ve.push(wt),at=wt.meta.id)}),this.tryAddPointToMap(Ce,nt),this.tryAddLayerToMap(Ve,at),re.length?(Y=!1,this.thematicLength+=1,$.zeroResults=!1,this.cdRef.detectChanges()):$.zeroResults=!0,re.length>=1e4&&this.messageService.alert("igo.geo.spatialFilter.maxSizeAlert","igo.geo.spatialFilter.warning",{timeOut:1e4})})))}),(0,$i.y)(C).pipe((0,Zo.a)(this.unsubscribe$)).subscribe(()=>{this.loading=!1,Y&&this.messageService.alert("igo.geo.spatialFilter.zeroResults","igo.geo.spatialFilter.warning",{timeOut:1e4})})}onZoneChange(Y,c){this.zone=Y,Y&&(c?this.tryAddFeaturesToMap([Y],!0):this.tryAddFeaturesToMap([Y]),this.zoomToFeatureExtent(Y))}tryAddFeaturesToMap(Y,c){let C=1;for(const $ of Y){if(this.type===d._cQ.Predefined)for(const re of this.layers){if(re.options._internal&&re.options._internal.code===$.properties.code&&!c){if(!re.title?.startsWith("Zone")){const Ce=this.layers.indexOf(re);this.layers.splice(Ce,1)}return}if(re.title?.startsWith("Zone")){this.activeLayers=[];const Ce=this.layers.indexOf(re);this.layers.splice(Ce,1),this.map.removeLayer(re)}}else{if(c)for(const re of this.activeLayers)if(1===this.activeLayers.length&&re.title?.startsWith("Zone")){const Ce=this.layers.indexOf(re);this.layers.splice(Ce,1),this.map.removeLayer(re)}this.activeLayers=[]}for(const re of this.layers)re.title?.startsWith("Zone")&&C++;this.defaultStyle=(re,Ce)=>{const Ve=Y[0].coordinates;return new B.cp({image:new z.c({radius:Ve?this.buffer/Math.cos(Math.PI/180*Ve[1])/Ce:void 0,fill:new V.c({color:"rgba(200, 200, 20, 0.2)"}),stroke:new X.c({width:1,color:"orange"})}),stroke:new X.c({width:1,color:"orange"}),fill:new V.c({color:"rgba(200, 200, 20, 0.2)"})})},this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,ao.U)(1)).subscribe(re=>{const Ce=this.layerService.createLayer({isIgoInternalLayer:!0,title:"Zone "+C+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),workspace:{enabled:!0},_internal:{code:this.type===d._cQ.Predefined?$.properties.code:void 0},source:re,visible:!0}),Ve=Y.map(at=>(0,d.K6O)(at,this.map.projection));if(this.type!==d._cQ.Predefined){const at=this.type===d._cQ.Point?"Cercle":"Polygone";Ve[0].set("nom","Zone",!0),Ve[0].set("type",at,!0)}re.ol.addFeatures(Ve),Ce.ol.setStyle(this.defaultStyle),this.map.addLayer(Ce),this.layers.push(Ce),this.activeLayers.push(Ce),this.cdRef.detectChanges()})}}tryAddPointToMap(Y,c){let C=1;if(Y.length){if(void 0===this.map)return;for(const $ of this.layers)$.title?.startsWith(Y[0].meta.title)&&C++;this.dataSourceService.createAsyncDataSource({type:"cluster",id:c,queryable:!0,distance:120,meta:{title:"Cluster"}}).pipe((0,ao.U)(1)).subscribe($=>{const re=Y[0].meta.icon;let Ce;Ce=re&&this.createSvgIcon(re)||(0,d.o5m)();const Ve=this.layerService.createLayer({isIgoInternalLayer:!0,title:Y[0].meta.title+" "+C+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:$,visible:!0,style:Ce}),nt=Y.map(wt=>(0,d.K6O)(wt,this.map.projection));$.ol.getSource().addFeatures(nt),this.layers.find(wt=>wt.id===Ve.id)&&(this.map.removeLayer(this.layers.find(wt=>wt.id===Ve.id)),C-=1,Ve.title=Y[0].meta.title+" "+C+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),Ve.options.title=Ve.title),this.iterator=C,this.map.addLayer(Ve),this.layers.push(Ve),this.pushLayer(Ve),this.cdRef.detectChanges()})}}createSvgIcon(Y){let c;return this.matIconRegistry.getNamedSvgIcon(Y).subscribe(C=>{const $=new XMLSerializer;C.setAttribute("width","30"),C.setAttribute("height","30"),C.setAttribute("fill","rgba(0, 128, 255)"),C.setAttribute("stroke","white");const re=$.serializeToString(C);c=new B.cp({image:new Gi.c({src:"data:image/svg+xml;utf8,"+re})})}),c}tryAddLayerToMap(Y,c){let C=1;if(Y.length){if(void 0===this.map)return;for(const $ of this.layers)$.title?.startsWith(Y[0].meta.title)&&C++;this.dataSourceService.createAsyncDataSource({type:"vector",id:c,queryable:!0}).pipe((0,ao.U)(1)).subscribe($=>{const re=this.layerService.createLayer({isIgoInternalLayer:!0,title:Y[0].meta.title+" "+C+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:$,visible:!0}),Ce=Y.map(nt=>(0,d.K6O)(nt,this.map.projection));$.ol.addFeatures(Ce),this.layers.find(nt=>nt.id===re.id)&&(this.map.removeLayer(this.layers.find(nt=>nt.id===re.id)),C-=1,re.title=Y[0].meta.title+" "+C+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),re.options.title=re.title),this.map.addLayer(re),this.layers.push(re),this.pushLayer(re),this.cdRef.detectChanges()})}}zoomToFeatureExtent(Y){if(Y){const c=this.format.readFeature(Y,{dataProjection:Y.projection,featureProjection:this.map.projection});(0,d.QX5)(this.map.viewController,[c],d.Suj.Zoom)}}pushLayer(Y){for(const c of this.activeLayers)if(c.id===Y.id)return;this.activeLayers.push(Y)}static \u0275fac=function(c){return new(c||js)(o.GI1(Le.iK),o.GI1(d.kjd),o.GI1(d.OEM),o.GI1(d.IZ6),o.GI1(mt),o.GI1(Zt.mi),o.GI1(St.ov),o.GI1(uo),o.GI1(zt),o.GI1(ot),o.GI1(o.kD9))};static \u0275cmp=o.In1({type:js,selectors:[["igo-spatial-filter-tool"]],inputs:{type:"type",itemType:"itemType",freehandDrawIsActive:"freehandDrawIsActive"},standalone:!0,features:[o.UHJ],decls:4,vars:16,consts:[[3,"store","selectedQueryType","zone","layers","eventType","eventQueryType","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange"],[3,"type","queryType","map","zone","loading","store","layers","allLayers","thematicLength","radiusEvent","bufferEvent","measureUnitChange","freehandControl","drawZoneEvent","zoneWithBufferChange","itemTypeChange","thematicChange","toggleSearch","clearButtonEvent","clearSearchEvent","export","openWorkspace","entityChange"],[4,"ngIf"],[3,"feature"]],template:function(c,C){1&c&&(o.I0R(0,"igo-spatial-filter-type",0),o.qCj("eventType",function(re){return C.getOutputType(re)})("eventQueryType",function(re){return C.getOutputQueryType(re)})("zoneChange",function(re){return C.onZoneChange(re)})("zoneWithBufferChange",function(re){return C.onZoneChange(re,!0)})("bufferChange",function(re){return C.buffer=re})("measureUnitChange",function(re){return C.measureUnit=re}),o.C$Y(),o.I0R(1,"igo-spatial-filter-item",1),o.qCj("radiusEvent",function(re){return C.buffer=re})("bufferEvent",function(re){return C.buffer=re})("measureUnitChange",function(re){return C.measureUnit=re})("freehandControl",function(re){return C.freehandDrawIsActive=re})("drawZoneEvent",function(re){return C.zone=re})("zoneWithBufferChange",function(re){return C.onZoneChange(re,!0)})("itemTypeChange",function(re){return C.itemType=re})("thematicChange",function(re){return C.thematics=re})("toggleSearch",function(){return C.getOutputToggleSearch()})("clearButtonEvent",function(){return C.clearMap()})("clearSearchEvent",function(){return C.getOutputClearSearch()})("export",function(){return C.activateExportTool()})("openWorkspace",function(){return C.activateWorkspace()})("entityChange",function(re){return C.activateWorkspace(re)}),o.C$Y(),o.yuY(2,go,2,1,"ng-container",2),o.wVc(3,"async")),2&c&&(o.E7m("store",C.spatialListStore)("selectedQueryType",C.queryType)("zone",C.zone)("layers",C.activeLayers),o.yG2(),o.E7m("type",C.type)("queryType",C.queryType)("map",C.map)("zone",C.zone)("loading",C.loading)("store",C.store)("layers",C.activeLayers)("allLayers",C.layers)("thematicLength",C.thematicLength),o.yG2(),o.E7m("ngIf",o.kDX(3,14,C.selectedFeature$)))},dependencies:[d.K4n,d.uu$,d.wP$,L.u_,L.a],styles:["[_nghost-%COMP%]   igo-spatial-filter-item[_ngcontent-%COMP%]{display:block;padding:0 12px}[_nghost-%COMP%]     .mat-mdc-tab-body-wrapper{margin-top:12px;padding:0 12px}"],changeDetection:0})};to=(0,Ke.UN)([(0,y.aA)({name:"spatialFilter",title:"igo.integration.tools.spatialFilter",icon:"selection-marker"}),(0,Ke.YR)("design:paramtypes",[Le.iK,d.kjd,d.OEM,d.IZ6,mt,Zt.mi,St.ov,uo,zt,ot,o.kD9])],to);let jo=class Ks{constructor(){}static \u0275fac=function(c){return new(c||Ks)};static \u0275cmp=o.In1({type:Ks,selectors:[["igo-time-filter-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:0,consts:[["igoTimeFilterListBinding",""]],template:function(c,C){1&c&&o.wR5(0,"igo-time-filter-list",0)},dependencies:[d.gho,d.eAs],encapsulation:2})};jo=(0,Ke.UN)([(0,y.aA)({name:"timeFilter",title:"igo.integration.tools.timeFilter",icon:"history"}),(0,Ke.YR)("design:paramtypes",[])],jo);var xo=s(18268);function ei(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"mat-tab-group")(1,"mat-tab",3),o.wVc(2,"translate"),o.I0R(3,"igo-import-export",4),o.qCj("selectMode",function($){o.usT(c);const re=o.GaO();return o.CGJ(re.modeChanged($))})("exportOptionsChange",function($){o.usT(c);const re=o.GaO();return o.CGJ(re.exportOptionsChange($))}),o.wVc(4,"async"),o.wVc(5,"async"),o.C$Y()(),o.I0R(6,"mat-tab",3),o.wVc(7,"translate"),o.wR5(8,"igo-context-import-export",5),o.C$Y()()}if(2&J){const c=o.GaO();o.yG2(),o.E7m("label",o.kDX(2,10,"igo.integration.importExportTool.importExportData")),o.yG2(2),o.E7m("contextUri",o.kDX(4,12,c.contextState.context$).uri)("map",c.map)("selectFirstProj",c.selectFirstProj)("projectionsLimitations",c.projectionsLimitations)("store",c.workspaceStore)("selectedMode",o.kDX(5,14,c.importExportState.selectedMode$))("exportOptions$",c.importExportState.exportOptions$),o.yG2(3),o.E7m("label",o.kDX(7,16,"igo.integration.importExportTool.importExportContext")),o.yG2(2),o.E7m("map",c.map)}}function Bi(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"igo-import-export",6),o.qCj("selectMode",function($){o.usT(c);const re=o.GaO();return o.CGJ(re.modeChanged($))})("exportOptionsChange",function($){o.usT(c);const re=o.GaO();return o.CGJ(re.exportOptionsChange($))}),o.wVc(1,"async"),o.wVc(2,"async"),o.C$Y()}if(2&J){const c=o.GaO();o.E7m("contextUri",o.kDX(1,5,c.contextState.context$).uri)("map",c.map)("store",c.workspaceStore)("selectedMode",o.kDX(2,7,c.importExportState.selectedMode$))("exportOptions$",c.importExportState.exportOptions$)}}function nn(J,Y){if(1&J&&o.wR5(0,"igo-context-import-export",5),2&J){const c=o.GaO();o.E7m("map",c.map)}}let Ui=class Ws{mapState;importExportState;workspaceState;contextState;projectionsLimitations;selectFirstProj=!1;get map(){return this.mapState.map}get workspaceStore(){return this.workspaceState.store}importExportType=Bt.layer;importExportShowBothType=!0;constructor(Y,c,C,$){this.mapState=Y,this.importExportState=c,this.workspaceState=C,this.contextState=$}ngOnInit(){this.selectType(),this.selectMode()}selectType(){this.importExportType&&this.importExportState.importExportType$.next(this.importExportType);const Y=this.importExportState.importExportType$.value;this.importExportState.setImportExportType(void 0!==Y?Y:Bt.layer)}selectMode(){const Y=this.importExportState.selectedMode$.value;this.importExportState.setMode(void 0!==Y?Y:eo.import)}modeChanged(Y){this.importExportState.setMode(Y)}exportOptionsChange(Y){this.importExportState.setsExportOptions(Y)}importExportTypeChange(Y){this.importExportType=Y.value}static \u0275fac=function(c){return new(c||Ws)(o.GI1(mt),o.GI1(uo),o.GI1(ot),o.GI1(Ut))};static \u0275cmp=o.In1({type:Ws,selectors:[["igo-import-export-tool"]],inputs:{projectionsLimitations:"projectionsLimitations",selectFirstProj:"selectFirstProj",importExportType:"importExportType",importExportShowBothType:"importExportShowBothType"},standalone:!0,features:[o.UHJ],decls:3,vars:3,consts:[[4,"ngIf"],[3,"contextUri","map","store","selectedMode","exportOptions$","selectMode","exportOptionsChange",4,"ngIf"],[3,"map",4,"ngIf"],[3,"label"],[3,"contextUri","map","selectFirstProj","projectionsLimitations","store","selectedMode","exportOptions$","selectMode","exportOptionsChange"],[3,"map"],[3,"contextUri","map","store","selectedMode","exportOptions$","selectMode","exportOptionsChange"]],template:function(c,C){1&c&&o.yuY(0,ei,9,18,"mat-tab-group",0)(1,Bi,3,9,"igo-import-export",1)(2,nn,1,1,"igo-context-import-export",2),2&c&&(o.E7m("ngIf",C.importExportShowBothType),o.yG2(),o.E7m("ngIf",!C.importExportShowBothType&&"layer"===C.importExportType),o.yG2(),o.E7m("ngIf",!C.importExportShowBothType&&"context"===C.importExportType))},dependencies:[L.u_,xo.WG,xo.aJ,xo._q,d.OrO,pe.kP,L.a,Dt.O0,Dt.sD],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"],changeDetection:0})};Ui=(0,Ke.UN)([(0,y.aA)({name:"importExport",title:"igo.integration.tools.importExport",icon:"file-move"}),(0,Ke.YR)("design:paramtypes",[mt,uo,ot,Ut])],Ui);var So=s(75180),Ko=s(43424),pi=s(46176),Po=s(50244),mi=s(42536),Wo=s(77872),ti=s(24112);function Yi(J,Y){if(1&J&&(o.I0R(0,"mat-form-field",13)(1,"mat-label"),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.wR5(4,"textarea",14,15),o.wVc(6,"translate"),o.C$Y()),2&J){const c=o.GaO();o.yG2(2),o.cNF(o.kDX(3,3,"igo.integration.advanced-map-tool.advanced-coordinates.lon")),o.yG2(2),o.E7m("placeholder",o.kDX(6,5,"igo.integration.advanced-map-tool.advanced-coordinates.lon"))("value",c.coordinates[0])}}function gi(J,Y){if(1&J&&(o.I0R(0,"mat-form-field",13),o.wR5(1,"textarea",14,15),o.wVc(3,"translate"),o.C$Y()),2&J){const c=o.GaO();o.yG2(),o.E7m("placeholder",o.kDX(3,2,"igo.integration.advanced-map-tool.advanced-coordinates.est"))("value",c.coordinates[0])}}function sn(J,Y){if(1&J&&(o.I0R(0,"mat-form-field",13)(1,"mat-label"),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.wR5(4,"textarea",14,15),o.wVc(6,"translate"),o.C$Y()),2&J){const c=o.GaO();o.yG2(2),o.cNF(o.kDX(3,3,"igo.integration.advanced-map-tool.advanced-coordinates.lat")),o.yG2(2),o.E7m("placeholder",o.kDX(6,5,"igo.integration.advanced-map-tool.advanced-coordinates.lat"))("value",c.coordinates[1])}}function an(J,Y){if(1&J&&(o.I0R(0,"mat-form-field",13),o.wR5(1,"textarea",14,15),o.wVc(3,"translate"),o.C$Y()),2&J){const c=o.GaO();o.yG2(),o.E7m("placeholder",o.kDX(3,2,"igo.integration.advanced-map-tool.advanced-coordinates.nord"))("value",c.coordinates[1])}}function ln(J,Y){if(1&J&&(o.I0R(0,"mat-option",16),o.qCj("click",function(C){return C.stopPropagation()}),o.OEk(1),o.C$Y()),2&J){const c=Y.$implicit;o.E7m("value",c),o.yG2(),o.oRS(" ",c.translatedValue||c.alias," ")}}let Vi=(()=>{class J{mapState;languageService;messageService;cdRef;storageService;config;formBuilder;formattedScale$=new W.g("");projections$=new W.g([]);form;coordinates;currentCenterDefaultProj;center;inMtmZone=!0;inLambert2={32198:!0,3798:!0};mapState$$;_projectionsLimitations={};projectionsConstraints;defaultProj;currentZones={utm:void 0,mtm:void 0};units=!0;get map(){return this.mapState.map}get inputProj(){return this.form.get("inputProj").value}set inputProj(c){this.form.patchValue({inputProj:c})}get projectionsLimitations(){return this._projectionsLimitations||{}}set projectionsLimitations(c){this._projectionsLimitations=c}constructor(c,C,$,re,Ce,Ve,nt){this.mapState=c,this.languageService=C,this.messageService=$,this.cdRef=re,this.storageService=Ce,this.config=Ve,this.formBuilder=nt,this.defaultProj={translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.wgs84",{code:"EPSG:4326"}),translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:"",def:void 0,extent:void 0},this.center=this.storageService.get("centerToggle"),this.computeProjections(),this.buildForm()}ngOnInit(){this.mapState$$=this.map.viewController.state$.pipe((0,ti.o)(50)).subscribe(()=>{this.setScaleValue(this.map),this.currentCenterDefaultProj=this.map.viewController.getCenter(this.defaultProj.code);const C=(0,d.ETi)(this.currentCenterDefaultProj[0]),$=(0,d.KMH)(this.currentCenterDefaultProj[0]);!this.inMtmZone&&C!==this.currentZones.mtm&&this.back2quebec();let re=!1;C!==this.currentZones.mtm&&(this.currentZones.mtm=C,re=!0),$!==this.currentZones.utm&&(this.currentZones.utm=$,re=!0),re&&this.updateProjectionsZoneChange(),this.checkLambert(this.currentCenterDefaultProj),this.coordinates=this.getCoordinates(),this.cdRef.detectChanges(),this.storageService.set("currentProjection",this.inputProj,e.Ab.SESSION)});const c=this.storageService.get("currentProjection");if(this.inputProj=this.projections$.value[0],null!==c){const C=this.positionInList(c);this.inputProj=this.projections$.value[C],this.updateZoneMtmUtm()}this.map.mapCenter$.next(this.center),this.coordinates=this.getCoordinates(),this.currentCenterDefaultProj=this.map.viewController.getCenter(this.defaultProj.code)}ngOnDestroy(){this.map.mapCenter$.next(!1),this.mapState$$.unsubscribe()}setScaleValue(c){this.formattedScale$.next(": ~ 1 / "+(0,d.rEB)(c.viewController.getScale()))}getCoordinates(){let c;this.currentZones.mtm=(0,d.ETi)(this.currentCenterDefaultProj[0]),this.currentZones.utm=(0,d.KMH)(this.currentCenterDefaultProj[0]);const C=this.inputProj.code;let $=2;return(C.includes("EPSG:4326")||C.includes("EPSG:4269"))&&($=5),this.units="EPSG:4326"===C||"EPSG:4269"===C,c=this.map.viewController.getCenter(C).map(re=>re.toFixed($)),c}copyTextToClipboard(){Eo._D.copy(this.coordinates.toString())&&this.messageService.success("igo.integration.advanced-map-tool.advanced-coordinates.copyMsg","igo.integration.advanced-map-tool.advanced-coordinates.copyTitle")}displayCenter(c){this.center=c,this.map.mapCenter$.next(c),this.storageService.set("centerToggle",c,e.Ab.SESSION)}buildForm(){this.form=this.formBuilder.group({inputProj:["",[oe.AQ.required]]})}updateProjectionsZoneChange(){let c=this.projections$.value;const C=this.languageService.translate;c.map($=>{if("mtm"===$.translateKey){const re=(0,d.ETi)(this.currentCenterDefaultProj[0]);if(re){const Ce=re<10?`EPSG:3218${re}`:`EPSG:321${80+re}`;$.alias=`MTM ${re}`,$.code=Ce,$.zone=`${re}`,$.translatedValue=C.instant("igo.geo.importExportForm.projections.mtm",$)}else $.alias="",this.inMtmZone=!1,"mtm"===this.inputProj.translateKey&&(this.inputProj=this.projections$.value[0])}if("utm"===$.translateKey){const re=(0,d.KMH)(this.currentCenterDefaultProj[0]),Ce=`EPSG:326${re}`;$.alias=`UTM ${re}`,$.code=Ce,$.zone=`${re}`,$.translatedValue=C.instant("igo.geo.importExportForm.projections.utm",$)}}),c=c.filter($=>""!==$.alias),this.projections$.next(c)}computeProjections(){this.projectionsConstraints=(0,d.KGf)(this.projectionsLimitations);const c=[];this.currentCenterDefaultProj||(this.currentCenterDefaultProj=this.map.viewController.getCenter(this.defaultProj.code));const C=this.languageService.translate;if(this.projectionsConstraints.wgs84&&c.push({translatedValue:C.instant("igo.geo.importExportForm.projections.wgs84",{code:"EPSG:4326"}),translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:"",def:void 0,extent:void 0}),this.projectionsConstraints.nad83&&c.push({translatedValue:C.instant("igo.geo.importExportForm.projections.nad83",{code:"EPSG:4269"}),translateKey:"nad83",alias:"NAD83",code:"EPSG:4269",zone:"",def:void 0,extent:void 0}),this.projectionsConstraints.webMercator&&c.push({translatedValue:C.instant("igo.geo.importExportForm.projections.webMercator",{code:"EPSG:3857"}),translateKey:"webMercator",alias:"Web Mercator",code:"EPSG:3857",zone:"",def:void 0,extent:void 0}),this.projectionsConstraints.mtm){const re=(0,d.ETi)(this.currentCenterDefaultProj[0]);if(re){this.inMtmZone=!0;const Ce=re<10?`EPSG:3218${re}`:`EPSG:321${80+re}`;c.splice(3,0,{translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.mtm",{code:Ce,zone:re}),translateKey:"mtm",alias:`MTM ${re}`,code:Ce,zone:`${re}`,def:void 0,extent:void 0})}else this.inMtmZone=!1}if(this.projectionsConstraints.utm){const re=this.inMtmZone?4:3,Ce=(0,d.KMH)(this.currentCenterDefaultProj[0]),Ve=Ce<10?`EPSG:3260${Ce}`:`EPSG:326${Ce}`;c.splice(re,0,{translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.utm",{code:Ve,zone:Ce}),translateKey:"utm",alias:`UTM ${Ce}`,code:Ve,zone:`${Ce}`,def:void 0,extent:void 0})}let $=[];this.projectionsConstraints.projFromConfig&&($=this.config.getConfig("projections")||[]),this.projections$.next($.concat(c))}pushMtm(c){if(this.projectionsConstraints.mtm){const C=(0,d.ETi)(this.currentCenterDefaultProj[0]),$=C<10?`EPSG:3218${C}`:`EPSG:321${80+C}`;c.splice(3,0,{translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.mtm",{code:$,zone:C}),translateKey:"mtm",alias:`MTM ${C}`,code:$,zone:`${C}`,def:void 0,extent:void 0})}}back2quebec(){this.pushMtm(this.projections$.value),this.inMtmZone=!0}updateZoneMtmUtm(){if("mtm"===this.inputProj.translateKey){const c=(0,d.ETi)(this.currentCenterDefaultProj[0]);this.inputProj.alias=`MTM ${c}`;const C=c<10?`EPSG:3218${c}`:`EPSG:321${80+c}`;this.inputProj.code=C,this.inputProj.zone=`${c}`,this.inputProj.translatedValue=this.languageService.translate.instant("igo.geo.importExportForm.projections.mtm",{code:C,zone:c})}if("utm"===this.inputProj.translateKey){const c=(0,d.KMH)(this.currentCenterDefaultProj[0]);this.inputProj.alias=`UTM ${c}`;const C=c<10?`EPSG:3260${c}`:`EPSG:326${c}`;this.inputProj.code=C,this.inputProj.zone=`${c}`,this.inputProj.translatedValue=this.languageService.translate.instant("igo.geo.importExportForm.projections.utm",{code:C,zone:c})}}positionInList(c){const C=c.translateKey,$=c.alias;let re,Ce=0;return this.projections$.value.map(Ve=>{C?C===Ve.translateKey&&(re=Ce):$===Ve.alias&&(re=Ce),Ce++}),re=re||0,re}checkLambert(c){(this.config.getConfig("projections")||[]).forEach($=>{let re=this.projections$.value;const Ce=$.extent,Ve=$.code.match(/\d+/),nt=ve.W0(Ce,$.code,this.defaultProj.code);c[0]<nt[0]||c[0]>nt[2]||c[1]<nt[1]||c[1]>nt[3]?(this.inLambert2[Ve]=!1,this.inputProj.alias===$.alias&&(this.inputProj=this.projections$.value[0]),re=re.filter(at=>at.alias!==$.alias),this.projections$.next(re)):this.inLambert2[Ve]||(this.projections$.next(re.concat($)),this.inLambert2[Ve]=!0)})}static \u0275fac=function(C){return new(C||J)(o.GI1(mt),o.GI1(St.ov),o.GI1(Zt.mi),o.GI1(o.kD9),o.GI1(e.yQ),o.GI1(ze.aW),o.GI1(oe.KE))};static \u0275cmp=o.In1({type:J,selectors:[["igo-advanced-coordinates"]],inputs:{projectionsLimitations:"projectionsLimitations"},standalone:!0,features:[o.UHJ],decls:35,vars:37,consts:[[1,"advanced-coordinates__coordinates-container"],[1,"advanced-coordinates__coordinates-container__inner"],["subscriptSizing","dynamic",4,"ngIf","ngIfElse"],["elseBlock",""],["elseBlock2",""],["mat-icon-button","",1,"igo-form-button-group","advanced-coordinates__copy-coordinates",3,"click"],["svgIcon","content-copy"],[1,"igo-form","advanced-coordinates__form",3,"formGroup"],["subscriptSizing","dynamic",1,"igo-input-container"],[3,"value","valueChange"],["matTooltipShowDelay","500",3,"value","click",4,"ngFor","ngForOf"],[1,"center-toggle","mat-typography",3,"checked","labelPosition","change"],[1,"igo-zoom","mat-typography"],["subscriptSizing","dynamic"],["matInput","","readonly","","rows","1",3,"placeholder","value"],["textArea",""],["matTooltipShowDelay","500",3,"value","click"]],template:function(C,$){if(1&C&&(o.I0R(0,"div",0)(1,"div",1),o.yuY(2,Yi,7,7,"mat-form-field",2)(3,gi,4,4,"ng-template",null,3,o.gJz)(5,sn,7,7,"mat-form-field",2)(6,an,4,4,"ng-template",null,4,o.gJz),o.I0R(8,"button",5),o.qCj("click",function(){return $.copyTextToClipboard()}),o.wVc(9,"translate"),o.wR5(10,"mat-icon",6),o.C$Y()(),o.I0R(11,"form",7)(12,"div",1)(13,"mat-form-field",8)(14,"mat-label"),o.OEk(15),o.wVc(16,"translate"),o.C$Y(),o.I0R(17,"mat-select",9),o.iHE("valueChange",function(Ce){return o.kNx($.inputProj,Ce)||($.inputProj=Ce),Ce}),o.yuY(18,ln,2,2,"mat-option",10),o.wVc(19,"async"),o.C$Y()()(),o.I0R(20,"div",1)(21,"mat-slide-toggle",11),o.qCj("change",function(Ce){return $.displayCenter(Ce.checked)}),o.OEk(22),o.wVc(23,"translate"),o.C$Y()()(),o.I0R(24,"p",12),o.OEk(25),o.wVc(26,"translate"),o.C$Y(),o.I0R(27,"p",12),o.OEk(28),o.wVc(29,"translate"),o.wVc(30,"async"),o.C$Y(),o.I0R(31,"p",12),o.OEk(32),o.wVc(33,"translate"),o.wVc(34,"number"),o.C$Y()()),2&C){const re=o.Gew(4),Ce=o.Gew(7);o.yG2(2),o.E7m("ngIf",$.units)("ngIfElse",re),o.yG2(3),o.E7m("ngIf",$.units)("ngIfElse",Ce),o.yG2(3),o.e48("aria-label",o.kDX(9,18,"igo.integration.advanced-map-tool.advanced-coordinates.copy")),o.yG2(3),o.E7m("formGroup",$.form),o.yG2(4),o.cNF(o.kDX(16,20,"igo.integration.advanced-map-tool.advanced-coordinates.coordSystem")),o.yG2(2),o.OKB("value",$.inputProj),o.yG2(),o.E7m("ngForOf",o.kDX(19,22,$.projections$)),o.yG2(3),o.E7m("checked",$.center)("labelPosition","before"),o.yG2(),o.oRS(" ",o.kDX(23,24,"igo.integration.advanced-map-tool.advanced-coordinates.center")," "),o.yG2(3),o.CAO(" ",o.kDX(26,26,"igo.integration.advanced-map-tool.advanced-coordinates.zoom")," ",$.map.viewController.getZoom()," "),o.yG2(3),o.CAO(" ",o.kDX(29,28,"igo.integration.advanced-map-tool.advanced-coordinates.scale")," ",o.kDX(30,30,$.formattedScale$)," "),o.yG2(4),o.CAO(" ",o.kDX(33,32,"igo.integration.advanced-map-tool.advanced-coordinates.resolution")," ",o.g7$(34,34,$.map.viewController.getResolution(),"1.0-0")," ")}},dependencies:[L.u_,Po.wb,Po.Up,Po.w5,mi.cN,mi.yi,N.oJ,N.um,Le.oB,Le.qL,oe.y,oe.sz,oe.u,oe.sl,oe.uW,Wo.d5,Wo.kX,pi.I5,L.Iw,pi.Ax,Ko.GE,Ko.cP,L.a,L.hl,Dt.O0,Dt.sD],styles:["[_nghost-%COMP%]{padding:12px 0}textarea[_ngcontent-%COMP%]{resize:none}.advanced-coordinates__coordinates-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;padding:12px 0}.advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:16px}.advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]:not(:first-child), .advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(:first-child){margin-left:8px}.advanced-coordinates__form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.advanced-coordinates__form[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{flex:1}.advanced-coordinates__form[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{display:flex;justify-content:space-between}.advanced-coordinates__form[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{flex:1}"]})}return J})();var oo=s(63916);function cn(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"mat-option",5),o.qCj("click",function(){o.usT(c),o.GaO();const $=o.Gew(8),re=o.GaO();return o.CGJ(re.applyNewLayers($))}),o.OEk(1),o.C$Y()}if(2&J){const c=Y.$implicit;o.E7m("value",c),o.yG2(),o.cNF(c.title)}}function un(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"div",2)(1,"form",3)(2,"mat-form-field")(3,"mat-label"),o.OEk(4),o.wVc(5,"translate"),o.C$Y(),o.I0R(6,"mat-select",4)(7,"mat-option",5,6),o.qCj("click",function(){o.usT(c);const $=o.Gew(8),re=o.GaO();return o.CGJ(re.selectAll($))}),o.OEk(9),o.wVc(10,"translate"),o.C$Y(),o.wR5(11,"mat-divider"),o.yuY(12,cn,2,2,"mat-option",7),o.C$Y()(),o.I0R(13,"mat-slide-toggle",8),o.qCj("change",function($){o.usT(c);const re=o.GaO();return o.CGJ(re.startSwipe($.checked))}),o.OEk(14),o.wVc(15,"translate"),o.C$Y()()()}if(2&J){const c=o.GaO();o.yG2(),o.E7m("formGroup",c.form),o.yG2(3),o.cNF(o.kDX(5,8,"igo.integration.advanced-map-tool.advanced-swipe.swipe-select")),o.yG2(3),o.E7m("value",1),o.yG2(2),o.oRS(" ",o.kDX(10,10,"igo.integration.advanced-map-tool.advanced-swipe.selectAll")," "),o.yG2(3),o.E7m("ngForOf",c.userControlledLayerList),o.yG2(),o.E7m("checked",c.swipe)("labelPosition","before"),o.yG2(),o.oRS(" ",o.kDX(15,12,"igo.integration.advanced-map-tool.advanced-swipe.swipe")," ")}}function dn(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"mat-list")(1,"p",9),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.I0R(4,"p",9),o.OEk(5),o.wVc(6,"translate"),o.C$Y(),o.I0R(7,"mat-list-item"),o.wR5(8,"mat-icon",10),o.I0R(9,"span",11),o.qCj("click",function(){o.usT(c);const $=o.GaO();return o.CGJ($.searchEmit())}),o.OEk(10),o.wVc(11,"translate"),o.C$Y()(),o.I0R(12,"mat-list-item"),o.wR5(13,"mat-icon",12),o.I0R(14,"span",13),o.qCj("click",function(){o.usT(c);const $=o.GaO();return o.CGJ($.catalogEmit())}),o.OEk(15),o.wVc(16,"translate"),o.C$Y()(),o.I0R(17,"mat-list-item"),o.wR5(18,"mat-icon",14),o.I0R(19,"span",15),o.qCj("click",function(){o.usT(c);const $=o.GaO();return o.CGJ($.contextEmit())}),o.OEk(20),o.wVc(21,"translate"),o.C$Y()()()}2&J&&(o.yG2(2),o.oRS(" ",o.kDX(3,5,"igo.integration.advanced-map-tool.advanced-swipe.empty")," "),o.yG2(3),o.oRS(" ",o.kDX(6,7,"igo.integration.advanced-map-tool.advanced-swipe.customize")," "),o.yG2(5),o.oRS(" ",o.kDX(11,9,"igo.integration.advanced-map-tool.advanced-swipe.search-tool")," "),o.yG2(5),o.oRS(" ",o.kDX(16,11,"igo.integration.advanced-map-tool.advanced-swipe.catalog-tool")," "),o.yG2(5),o.oRS(" ",o.kDX(21,13,"igo.integration.advanced-map-tool.advanced-swipe.context-tool")," "))}let kn=(()=>{class J{mapState;contextService;formBuilder;toolState;swipe=!1;layerList;userControlledLayerList;form;layers;res;listForSwipe;get map(){return this.mapState.map}constructor(c,C,$,re){this.mapState=c,this.contextService=C,this.formBuilder=$,this.toolState=re,this.buildForm()}ngOnInit(){this.map.layers$.subscribe(c=>this.userControlledLayerList=c.filter(C=>!C.baseLayer&&C.showInLayerList&&C.displayed))}ngOnDestroy(){this.swipe=!1,this.map.swipeEnabled$.next(this.swipe)}buildForm(){this.form=this.formBuilder.group({layers:["",[oe.AQ.required]]})}startSwipe(c){this.swipe=c,this.map.swipeEnabled$.next(c),this.listForSwipe=[];for(const C of this.form.value.layers)this.listForSwipe.push(C);this.map.selectedFeatures$.next(this.listForSwipe)}applyNewLayers(c){this.startSwipe(!1),this.startSwipe(!0),c._selected&&(c._selected=!1),this.form.controls.layers.value.length===this.userControlledLayerList.length&&(c._selected=!0)}selectAll(c){c._selected?(this.form.controls.layers.setValue(this.userControlledLayerList),c._selected=!0):this.form.controls.layers.setValue([]),this.startSwipe(!1),this.startSwipe(!0)}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}static \u0275fac=function(C){return new(C||J)(o.GI1(mt),o.GI1(pe.M9),o.GI1(oe.KE),o.GI1(zt))};static \u0275cmp=o.In1({type:J,selectors:[["igo-advanced-swipe"]],standalone:!0,features:[o.UHJ],decls:3,vars:2,consts:[["class","igo-swipe-select-container",4,"ngIf","ngIfElse"],["noLayersBlock",""],[1,"igo-swipe-select-container"],[1,"igo-form",3,"formGroup"],["formControlName","layers","multiple",""],[3,"value","click"],["e",""],[3,"value","click",4,"ngFor","ngForOf"],[1,"swipe-toggle","mat-typography",3,"checked","labelPosition","change"],[1,"map-empty","mat-typography"],["matListItemIcon","","svgIcon","magnify"],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["matListItemIcon","","svgIcon","layers-plus"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["matListItemIcon","","svgIcon","star"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(C,$){if(1&C&&o.yuY(0,un,16,14,"div",0)(1,dn,22,15,"ng-template",null,1,o.gJz),2&C){const re=o.Gew(2);o.E7m("ngIf",$.userControlledLayerList.length)("ngIfElse",re)}},dependencies:[L.u_,oe.y,oe.sz,oe.ue,oe.u,oe.sl,oe.uW,oe.Wo,Po.wb,Po.Up,Po.w5,Wo.d5,Wo.kX,pi.I5,pi.Ax,So.U,So.k,L.Iw,Ko.GE,Ko.cP,oo.iI,oo.oL,oo.g9,oo.Y1,oo.UV,Le.oB,Le.qL,Dt.O0,Dt.sD],styles:["[_nghost-%COMP%]{padding:12px 0}[_nghost-%COMP%]   .igo-swipe-select-container[_ngcontent-%COMP%]{padding:12px 0}[_nghost-%COMP%]   .igo-swipe-select-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{display:flex;justify-content:space-between}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{flex:1}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:4px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{padding:12px 0;text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   .advanced-tool-line[_ngcontent-%COMP%]{height:2px;background-color:gray}"]})}return J})(),hi=class Ns{mapState;get tracking$(){return this.mapState.map.geolocationController.tracking$}get followPosition$(){return this.mapState.map.geolocationController.followPosition$}constructor(Y){this.mapState=Y}toggleTracking(Y){this.mapState.map.geolocationController.tracking=Y}toggleFollow(Y){this.mapState.map.geolocationController.followPosition=Y}static \u0275fac=function(c){return new(c||Ns)(o.GI1(mt))};static \u0275cmp=o.In1({type:Ns,selectors:[["igo-advanced-map-tool"]],standalone:!0,features:[o.UHJ],decls:24,vars:26,consts:[[1,"nameOfTool"],[1,"advanced-tool-line"],[1,"igo-input-container"],[1,"geolocation-slide-toggle-container"],[1,"geolocation-option",3,"checked","labelPosition","change"],[1,"geolocation-option",3,"disabled","labelPosition","checked","change"]],template:function(c,C){1&c&&(o.I0R(0,"h4",0),o.OEk(1),o.wVc(2,"translate"),o.C$Y(),o.wR5(3,"igo-advanced-swipe")(4,"mat-divider",1),o.I0R(5,"h4",0),o.OEk(6),o.wVc(7,"translate"),o.C$Y(),o.wR5(8,"igo-advanced-coordinates")(9,"mat-divider",1),o.I0R(10,"h4",0),o.OEk(11),o.wVc(12,"translate"),o.C$Y(),o.I0R(13,"div",2)(14,"div",3)(15,"mat-slide-toggle",4),o.qCj("change",function(re){return C.toggleTracking(re.checked)}),o.wVc(16,"async"),o.OEk(17),o.wVc(18,"translate"),o.C$Y(),o.I0R(19,"mat-slide-toggle",5),o.qCj("change",function(re){return C.toggleFollow(re.checked)}),o.wVc(20,"async"),o.wVc(21,"async"),o.OEk(22),o.wVc(23,"translate"),o.C$Y()()()),2&c&&(o.yG2(),o.oRS(" ",o.kDX(2,10,"igo.integration.advanced-map-tool.advanced-swipe.swipe-tool"),"\n"),o.yG2(5),o.oRS(" ",o.kDX(7,12,"igo.integration.advanced-map-tool.advanced-coordinates.coordinates"),"\n"),o.yG2(5),o.oRS(" ",o.kDX(12,14,"igo.integration.advanced-map-tool.geolocation.title"),"\n"),o.yG2(4),o.E7m("checked",o.kDX(16,16,C.tracking$))("labelPosition","before"),o.yG2(2),o.oRS(" ",o.kDX(18,18,"igo.integration.advanced-map-tool.geolocation.tracking")," "),o.yG2(2),o.E7m("disabled",!0!==o.kDX(20,20,C.tracking$))("labelPosition","before")("checked",o.kDX(21,22,C.followPosition$)),o.yG2(3),o.oRS(" ",o.kDX(23,24,"igo.integration.advanced-map-tool.geolocation.follow")," "))},dependencies:[kn,So.U,So.k,Vi,Ko.GE,Ko.cP,L.a,Dt.O0,Dt.sD],styles:["[_nghost-%COMP%]{display:block;padding:0 16px 12px}.nameOfTool[_ngcontent-%COMP%]{text-align:center;font-weight:700;font-size:small;margin:12px 0 8px}.advanced-tool-line[_ngcontent-%COMP%]{height:2px;background-color:gray}.geolocation-slide-toggle-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:12px 0}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{flex:1}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]:not(:last-child){margin-bottom:16px}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{display:flex;justify-content:space-between}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{flex:1}mat-divider[_ngcontent-%COMP%]{margin:0 -16px}"]})};function pn(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"button",1),o.qCj("click",function(){o.usT(c);const $=o.GaO();return o.CGJ($.activateWorkspace())}),o.wVc(1,"translate"),o.wR5(2,"mat-icon",2),o.C$Y()}if(2&J){const c=o.GaO();o.E7m("matTooltip",o.kDX(1,2,"igo.integration.workspace.toggleWorkspace"))("color",c.color)}}hi=(0,Ke.UN)([(0,y.aA)({name:"advancedMap",title:"igo.integration.tools.advancedMap",icon:"toolbox"}),(0,Ke.YR)("design:paramtypes",[mt])],hi);let wi=(()=>{class J{workspaceState;hasWorkspace$=new W.g(!1);hasWorkspace$$;_layer;layer$=new W.g(void 0);set layer(c){this._layer=c,this.layer$.next(this._layer)}get layer(){return this._layer}color="primary";constructor(c){this.workspaceState=c}ngOnInit(){this.hasWorkspace$$=(0,Qt.E)([this.workspaceState.workspaceEnabled$,this.layer$]).subscribe(c=>this.hasWorkspace$.next(c[0]&&c[1]?.options.workspace?.enabled))}ngOnDestroy(){this.hasWorkspace$$.unsubscribe()}activateWorkspace(){this.workspaceState.workspace$.value&&this.workspaceState.workspace$.value.layer.id===this.layer.id&&this.workspaceState.workspacePanelExpanded?this.workspaceState.workspacePanelExpanded=!1:(this.workspaceState.workspacePanelExpanded=!0,this.workspaceState.setActiveWorkspaceById(this.layer.id))}static \u0275fac=function(C){return new(C||J)(o.GI1(ot))};static \u0275cmp=o.In1({type:J,selectors:[["igo-workspace-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[o.UHJ],decls:2,vars:3,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"],["svgIcon","table"]],template:function(C,$){1&C&&(o.yuY(0,pn,3,4,"button",0),o.wVc(1,"async")),2&C&&o.E7m("ngIf",o.kDX(1,1,$.hasWorkspace$))},dependencies:[L.u_,N.oJ,N.um,Se.KO,Se.a4,Le.oB,Le.qL,L.a,Dt.O0,Dt.sD],changeDetection:0})}return J})();function oi(J,Y){if(1&J){const c=o.KQA();o.wR5(0,"igo-workspace-button",4),o.I0R(1,"igo-export-button",5),o.qCj("click",function(){const re=o.usT(c).layer,Ce=o.GaO(2);return o.CGJ(Ce.activateExport(re))}),o.C$Y(),o.wR5(2,"igo-ogc-filter-button",6)(3,"igo-time-filter-button",6)(4,"igo-track-feature-button",7)(5,"igo-metadata-button",4)}if(2&J){const c=Y.layer,C=o.GaO(2);o.E7m("layer",c),o.yG2(),o.E7m("layer",c),o.yG2(),o.E7m("header",C.ogcButton)("layer",c),o.yG2(),o.E7m("header",C.timeButton)("layer",c),o.yG2(),o.E7m("trackFeature",!0)("layer",c),o.yG2(),o.E7m("layer",c)}}function mn(J,Y){if(1&J&&(o.I0R(0,"igo-layer-list",2),o.yuY(1,oi,6,9,"ng-template",null,3,o.gJz),o.C$Y()),2&J){const c=o.GaO();o.E7m("map",c.map)("excludeBaseLayers",c.excludeBaseLayers)("layerFilterAndSortOptions",c.layerFilterAndSortOptions)("expandLegendOfVisibleLayers",c.expandLegendOfVisibleLayers)("toggleLegendOnVisibilityChange",c.toggleLegendOnVisibilityChange)("updateLegendOnResolutionChange",c.updateLegendOnResolutionChange)("queryBadge",c.queryBadge)}}function gn(J,Y){1&J&&(o.I0R(0,"p",9),o.OEk(1),o.wVc(2,"translate"),o.C$Y()),2&J&&(o.yG2(),o.oRS(" ",o.kDX(2,1,"igo.integration.mapTool.customize")," "))}function hn(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",11),o.S2Z(),o.I0R(2,"svg",12),o.wR5(3,"path",13),o.C$Y()(),o.gRP(),o.I0R(4,"span",14),o.qCj("click",function(){o.usT(c);const $=o.GaO(3);return o.CGJ($.searchEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.search-tool")," "))}function fn(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",11),o.S2Z(),o.I0R(2,"svg",12),o.wR5(3,"path",15),o.C$Y()(),o.gRP(),o.I0R(4,"span",16),o.qCj("click",function(){o.usT(c);const $=o.GaO(3);return o.CGJ($.catalogEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.catalog-tool")," "))}function yn(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",11),o.S2Z(),o.I0R(2,"svg",12),o.wR5(3,"path",17),o.C$Y()(),o.gRP(),o.I0R(4,"span",18),o.qCj("click",function(){o.usT(c);const $=o.GaO(3);return o.CGJ($.contextEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.context-tool")," "))}function _n(J,Y){if(1&J&&(o.I0R(0,"mat-list")(1,"p",9),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.yuY(4,gn,3,3,"p",10)(5,hn,7,3,"mat-list-item",8)(6,fn,7,3,"mat-list-item",8)(7,yn,7,3,"mat-list-item",8),o.C$Y()),2&J){const c=o.GaO(2);o.yG2(2),o.oRS(" ",o.kDX(3,5,"igo.integration.mapTool.empty")," "),o.yG2(2),o.E7m("ngIf",c.layerAdditionAllowed&&(c.searchToolInToolbar||c.catalogToolInToolbar||c.contextToolInToolbar)),o.yG2(),o.E7m("ngIf",c.layerAdditionAllowed&&c.searchToolInToolbar),o.yG2(),o.E7m("ngIf",c.layerAdditionAllowed&&c.catalogToolInToolbar),o.yG2(),o.E7m("ngIf",c.layerAdditionAllowed&&c.contextToolInToolbar)}}function ji(J,Y){if(1&J&&o.yuY(0,_n,8,7,"mat-list",8),2&J){const c=o.GaO();o.E7m("ngIf",c.delayedShowEmptyMapContent)}}let ii=class Hs{mapState;toolState;searchSourceService;cdRef;importExportState;delayedShowEmptyMapContent=!1;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;ogcButton=!0;timeButton=!0;layerListControls={};queryBadge=!1;layerAdditionAllowed=!0;get map(){return this.mapState.map}get layers$(){return this.map.layers$.pipe((0,Io.k)(Y=>Y.filter(c=>!(!1===c.showInLayerList||this.excludeBaseLayers&&c.baseLayer))))}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get layerFilterAndSortOptions(){const Y=Object.assign({showToolbar:d.g7B.default},this.layerListControls);switch(this.layerListControls.showToolbar){case d.g7B.always:Y.showToolbar=d.g7B.always;break;case d.g7B.never:Y.showToolbar=d.g7B.never}return Y}get searchToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("searchResults")&&this.searchSourceService.getSources().filter(d.ayN).filter(Y=>Y.available&&"Layer"===Y.getType()).length>0}get catalogToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("catalog")}get contextToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("contextManager")}constructor(Y,c,C,$,re){this.mapState=Y,this.toolState=c,this.searchSourceService=C,this.cdRef=$,this.importExportState=re}ngOnInit(){setTimeout(()=>{this.delayedShowEmptyMapContent=!0,this.cdRef.detectChanges()},250)}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}activateExport(Y){let c=Y.id;Y.options.workspace?.workspaceId&&(c=Y.options.workspace.workspaceId!==Y.id?Y.options.workspace.workspaceId:Y.id),this.importExportState.setsExportOptions({layers:[c]}),this.importExportState.setMode(eo.export),this.toolState.toolbox.activateTool("importExport")}static \u0275fac=function(c){return new(c||Hs)(o.GI1(mt),o.GI1(zt),o.GI1(d.i6q),o.GI1(o.kD9),o.GI1(uo))};static \u0275cmp=o.In1({type:Hs,selectors:[["igo-map-details-tool"]],inputs:{toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",ogcButton:"ogcButton",timeButton:"timeButton",layerListControls:"layerListControls",queryBadge:"queryBadge",layerAdditionAllowed:"layerAdditionAllowed"},standalone:!0,features:[o.UHJ],decls:4,vars:4,consts:[["class","mapDetailsList","igoLayerListBinding","",3,"map","excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge",4,"ngIf","ngIfElse"],["empty",""],["igoLayerListBinding","",1,"mapDetailsList",3,"map","excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge"],["igoLayerItemToolbar",""],[3,"layer"],[3,"layer","click"],[3,"header","layer"],[3,"trackFeature","layer"],[4,"ngIf"],[1,"map-empty","mat-typography"],["class","map-empty mat-typography",4,"ngIf"],["matListItemIcon",""],["viewBox","0 0 24 24","fit","","height","100%","width","100%","preserveAspectRatio","xMidYMid meet","focusable","false"],["d","M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["d","M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["d","M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(c,C){if(1&c&&(o.yuY(0,mn,3,7,"igo-layer-list",0),o.wVc(1,"async"),o.yuY(2,ji,1,1,"ng-template",null,1,o.gJz)),2&c){const $=o.Gew(3);o.E7m("ngIf",o.kDX(1,2,C.layers$).length)("ngIfElse",$)}},dependencies:[L.u_,d.m2U,d.Ult,wi,d.O_6,d.Ga$,d.eM$,d.ktW,d.Idw,oo.iI,oo.oL,oo.g9,oo.Y1,oo.UV,Le.oB,Le.qL,L.a,Dt.O0,Dt.sD],styles:["[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   mat-list.mat-mdc-list-base[_ngcontent-%COMP%]   mat-list-item.mat-mdc-list-item[_ngcontent-%COMP%]     div.mdc-list-item__content div.mdc-list-item__primary-text{padding-left:5px}[_nghost-%COMP%]   .mapDetailsList[_ngcontent-%COMP%]{overflow:hidden}"]})};ii=(0,Ke.UN)([(0,y.aA)({name:"mapDetails",title:"igo.integration.tools.map",icon:"map"}),(0,Ke.YR)("design:paramtypes",[mt,zt,d.i6q,o.kD9,uo])],ii);var Cn=s(23680);function Oi(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"igo-layer-legend-list",4),o.qCj("allLegendsShown",function($){o.usT(c);const re=o.GaO();return o.CGJ(re.onShowAllLegends($))}),o.wVc(1,"async"),o.C$Y()}if(2&J){const c=o.GaO();o.E7m("excludeBaseLayers",c.excludeBaseLayers)("allowShowAllLegends",c.allowShowAllLegends)("updateLegendOnResolutionChange",c.updateLegendOnResolutionChange)("showAllLegendsValue",o.kDX(1,4,c.showAllLegendsValue$))}}function Bn(J,Y){}function Un(J,Y){1&J&&o.yuY(0,Bn,0,0,"ng-template")}function Ii(J,Y){if(1&J&&(o.I0R(0,"p",5),o.OEk(1),o.wVc(2,"async"),o.wVc(3,"translate"),o.wVc(4,"translate"),o.C$Y()),2&J){const c=o.GaO();o.yG2(),o.oRS(" ",o.kDX(2,1,c.visibleLayers$).length?o.kDX(3,3,"igo.integration.mapTool.noLayersInRange"):o.kDX(4,5,"igo.integration.mapTool.noLayersVisible"),"\n")}}function Ki(J,Y){1&J&&(o.I0R(0,"p",5),o.OEk(1),o.wVc(2,"translate"),o.C$Y()),2&J&&(o.yG2(),o.oRS(" ",o.kDX(2,1,"igo.integration.mapTool.customize")," "))}function ro(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",7),o.S2Z(),o.I0R(2,"svg",8),o.wR5(3,"path",9),o.C$Y()(),o.gRP(),o.I0R(4,"span",10),o.qCj("click",function(){o.usT(c);const $=o.GaO(3);return o.CGJ($.searchEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.search-tool")," "))}function Mo(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",7),o.S2Z(),o.I0R(2,"svg",8),o.wR5(3,"path",11),o.C$Y()(),o.gRP(),o.I0R(4,"span",12),o.qCj("click",function(){o.usT(c);const $=o.GaO(3);return o.CGJ($.catalogEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.catalog-tool")," "))}function vo(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",7),o.S2Z(),o.I0R(2,"svg",8),o.wR5(3,"path",13),o.C$Y()(),o.gRP(),o.I0R(4,"span",14),o.qCj("click",function(){o.usT(c);const $=o.GaO(3);return o.CGJ($.contextEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.context-tool")," "))}function er(J,Y){if(1&J&&(o.I0R(0,"mat-list")(1,"p",5),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.yuY(4,Ki,3,3,"p",2)(5,ro,7,3,"mat-list-item",6)(6,Mo,7,3,"mat-list-item",6)(7,vo,7,3,"mat-list-item",6),o.C$Y()),2&J){const c=o.GaO(2);o.yG2(2),o.oRS(" ",o.kDX(3,5,"igo.integration.mapTool.empty")," "),o.yG2(2),o.E7m("ngIf",c.layerAdditionAllowed&&(c.searchToolInToolbar||c.catalogToolInToolbar||c.contextToolInToolbar)),o.yG2(),o.E7m("ngIf",c.layerAdditionAllowed&&c.searchToolInToolbar),o.yG2(),o.E7m("ngIf",c.layerAdditionAllowed&&c.catalogToolInToolbar),o.yG2(),o.E7m("ngIf",c.layerAdditionAllowed&&c.contextToolInToolbar)}}function Yn(J,Y){if(1&J&&o.yuY(0,er,8,7,"mat-list",6),2&J){const c=o.GaO();o.E7m("ngIf",c.delayedShowEmptyMapContent)}}let fi=class zs{mapState;toolState;searchSourceService;cdRef;delayedShowEmptyMapContent=!1;layers$=new W.g([]);showAllLegendsValue$=new W.g(!1);change$=new Cn.o(1);resolution$$;visibleOrInRangeLayers$$;updateLegendOnResolutionChange=!1;layerAdditionAllowed=!0;allowShowAllLegends=!1;showAllLegendsValue=!1;layerListControls={};get map(){return this.mapState.map}get visibleOrInRangeLayers$(){return this.layers$.pipe((0,Io.k)(Y=>Y.filter(c=>c.visible$.value&&c.isInResolutionsRange$.value)))}get visibleLayers$(){return this.layers$.pipe((0,Io.k)(Y=>Y.filter(c=>c.visible$.value)))}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get searchToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("searchResults")&&this.searchSourceService.getSources().filter(d.ayN).filter(Y=>Y.available&&"Layer"===Y.getType()).length>0}get catalogToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("catalog")}get contextToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("contextManager")}constructor(Y,c,C,$){this.mapState=Y,this.toolState=c,this.searchSourceService=C,this.cdRef=$}ngOnInit(){this.resolution$$=(0,Qt.E)([this.map.layers$,this.map.viewController.resolution$]).pipe((0,ti.o)(10)).subscribe(Y=>{this.layers$.next(Y[0].filter(c=>!(!1===c.showInLayerList||this.excludeBaseLayers&&c.baseLayer)))}),this.allowShowAllLegends?(this.mapState.showAllLegendsValue=void 0!==this.mapState.showAllLegendsValue?this.mapState.showAllLegendsValue:this.showAllLegendsValue||!1,this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue)):this.showAllLegendsValue$.next(!1),setTimeout(()=>{this.delayedShowEmptyMapContent=!0,this.cdRef.detectChanges()},250)}onShowAllLegends(Y){this.mapState.showAllLegendsValue=Y,this.showAllLegendsValue$.next(Y)}showAllLegend(){if(0===this.layers$.getValue().length)return!1;if(0!==this.layers$.getValue().length&&!1===this.allowShowAllLegends){let Y;if(this.visibleOrInRangeLayers$$=this.visibleOrInRangeLayers$.subscribe(c=>{Y=0!==c.length}),!1===Y)return!1}return!0}ngOnDestroy(){this.resolution$$.unsubscribe(),this.visibleOrInRangeLayers$$&&this.visibleOrInRangeLayers$$.unsubscribe()}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}static \u0275fac=function(c){return new(c||zs)(o.GI1(mt),o.GI1(zt),o.GI1(d.i6q),o.GI1(o.kD9))};static \u0275cmp=o.In1({type:zs,selectors:[["igo-map-legend-tool"]],inputs:{updateLegendOnResolutionChange:"updateLegendOnResolutionChange",layerAdditionAllowed:"layerAdditionAllowed",allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue",layerListControls:"layerListControls"},standalone:!0,features:[o.UHJ],decls:8,vars:10,consts:[["igoLayerLegendListBinding","",3,"excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue","allLegendsShown",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","map-empty mat-typography",4,"ngIf"],["emptyLayers",""],["igoLayerLegendListBinding","",3,"excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue","allLegendsShown"],[1,"map-empty","mat-typography"],[4,"ngIf"],["matListItemIcon",""],["viewBox","0 0 24 24","fit","","height","100%","width","100%","preserveAspectRatio","xMidYMid meet","focusable","false"],["d","M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["d","M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["d","M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(c,C){if(1&c&&(o.yuY(0,Oi,2,6,"igo-layer-legend-list",0)(1,Un,1,0,null,1),o.wVc(2,"async"),o.yuY(3,Ii,5,7,"p",2),o.wVc(4,"async"),o.wVc(5,"async"),o.yuY(6,Yn,1,1,"ng-template",null,3,o.gJz)),2&c){const $=o.Gew(7);o.E7m("ngIf",C.showAllLegend()),o.yG2(),o.E7m("ngIf",0!==o.kDX(2,4,C.layers$).length)("ngIfElse",$),o.yG2(2),o.E7m("ngIf",!C.allowShowAllLegends&&0!==o.kDX(4,6,C.layers$).length&&0===o.kDX(5,8,C.visibleOrInRangeLayers$).length)}},dependencies:[L.u_,d.wSE,d.ApN,oo.iI,oo.oL,oo.g9,oo.Y1,oo.UV,Le.oB,Le.qL,L.a,Dt.O0,Dt.sD],styles:["[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   mat-list.mat-mdc-list-base[_ngcontent-%COMP%]   mat-list-item.mat-mdc-list-item[_ngcontent-%COMP%]     div.mdc-list-item__content div.mdc-list-item__primary-text{padding-left:5px}"]})};fi=(0,Ke.UN)([(0,y.aA)({name:"mapLegend",title:"igo.integration.tools.legend",icon:"format-list-bulleted-type"}),(0,Ke.YR)("design:paramtypes",[mt,zt,d.i6q,o.kD9])],fi);var yi=s(21232),Ti=s(53156),vn=s(51712);let Wi=(()=>{class J{mapState;storageService;defaultProximityRadiusValue=30;enabled$=new W.g(!1);proximityRadiusValue$;proximitylocationType$=new W.g("geolocation");proximityFeatureStore;subs$$=[];currentPositionCoordinate$=new W.g(void 0);get map(){return this.mapState.map}constructor(c,C){this.mapState=c,this.storageService=C,this.proximityFeatureStore=new d.ym_([],{map:this.mapState.map}),this.proximityRadiusValue$=new W.g(this.storageService.get("mapProximityRadius")||this.defaultProximityRadiusValue),this.mapState.map.ol.once("rendercomplete",()=>{this.subscribeProximityMonitor()})}subscribeProximityMonitor(){this.subs$$.push((0,Qt.E)([this.enabled$,this.proximitylocationType$,this.proximityRadiusValue$,(0,vn.I)(5e3),this.map.geolocationController.position$]).pipe((0,ti.o)(750)).subscribe(c=>{this.proximityFeatureStore.clear();const C=c[0],$=this.map.layers,re=this.map.geolocationController.position$.value,Ce=c[1],Ve=c[2];if(this.storageService.set("mapProximityRadius",Ve||this.defaultProximityRadiusValue),!C)return;let nt;if("geolocation"===Ce){if(!re||!re.position)return;nt=ve.AF(re.position,re.projection,this.map.projection),this.map.mapCenter$.next(!1)}else nt=this.map.viewController.getCenter(),this.map.mapCenter$.next(!0);const at=ve.AF(nt,this.map.projection,"EPSG:4269"),wt=(0,d.uEw)(at,6);this.currentPositionCoordinate$.next(wt),$.filter(Et=>Et.ol instanceof Ti.c&&Et.dataSource.options.queryable&&Et.visible&&Et.isInResolutionsRange).map(Et=>{const Vt=Et.ol.getSource(),Ft=Vt.getFeaturesAtCoordinate(nt);if(Ft&&Ft.length)Ft.map(fo=>{const bt=(0,d.qKz)(fo,this.map.projection);let ko=this.getQueryTitle(bt,Et);this.addFeatureToStore(Et,nt,bt,ko,0)});else{const fo=Vt.getClosestFeatureToCoordinate(nt);if(fo){const bt=fo.getGeometry(),ko=(0,d.qKz)(fo,this.map.projection),Qi=bt.getClosestPoint(nt),En=new Rt.c([nt,Qi]),ar=(0,d.cDV)(En,"EPSG:3857");if(ar<=Ve){let Kr=this.getQueryTitle(ko,Et);this.addFeatureToStore(Et,nt,ko,Kr,ar)}}}})}))}addFeatureToStore(c,C,$,re,Ce){const Ve=(0,Eo.uq)(),nt=this.map.ol.getView().getProjection(),at=$.ol.getGeometry(),wt=(new li.c).writeGeometryObject(at,{featureProjection:nt,dataProjection:nt});this.proximityFeatureStore.update({type:d.YfI,geometry:wt,projection:nt.getCode(),properties:{...$.properties,id:Ve,element:re,distance:Ce,coordFromCalculatedDistance:C,layerSrcId:c.id,layerSrcTitle:c.title},meta:{id:Ve}})}getQueryTitle(c,C){let $;if(C.options?.source?.options){const re=C.options.source.options;re.queryTitle&&($=this.getLabelMatch(c,re.queryTitle))}return $}getLabelMatch(c,C){let $=C;const re=Array.from(C.matchAll(/\$\{([^\{\}]+)\}/g));return re.forEach(Ce=>{$=$.replace(Ce[0],c.properties[Ce[1]])}),0===re.length&&$===C&&($=c.properties[C]||C),$}static \u0275fac=function(C){return new(C||J)(o.CoB(mt),o.CoB(e.yQ))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();const Ei=["table"];function Ni(J,Y){if(1&J&&(o.I0R(0,"mat-form-field",14),o.wR5(1,"textarea",15,16),o.wVc(3,"translate"),o.C$Y()),2&J){const c=Y.ngIf;o.yG2(),o.E7m("placeholder",o.kDX(3,2,"igo.integration.map-proximity-tool.lon"))("value",c[0])}}function xi(J,Y){if(1&J&&(o.I0R(0,"mat-form-field",17),o.wR5(1,"textarea",15,16),o.wVc(3,"translate"),o.C$Y()),2&J){const c=Y.ngIf;o.yG2(),o.E7m("placeholder",o.kDX(3,2,"igo.integration.map-proximity-tool.lat"))("value",c[1])}}function Hi(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"button",18),o.qCj("click",function(){o.usT(c);const $=o.GaO();return o.CGJ($.copyTextToClipboard())}),o.wR5(1,"mat-icon",19),o.C$Y()}}let Mi=class Xs{mapState;mapProximityState;languageService;messageService;subs$$=[];table;get maxDistance(){return this.mapProximityState.proximityRadiusValue$.value}set maxDistance(Y){this.mapProximityState.proximityRadiusValue$.next(Y)}get map(){return this.mapState.map}userDefinedMapCenter;userDefinedFollowPosition;tableTemplate;constructor(Y,c,C,$){this.mapState=Y,this.mapProximityState=c,this.languageService=C,this.messageService=$,this.tableTemplate={selection:!0,selectMany:!1,selectionCheckbox:!1,sort:!0,columns:[{name:"element",title:this.languageService.translate.instant("igo.integration.map-proximity-tool.feature"),valueAccessor:re=>re.properties.element},{name:"distance",title:this.languageService.translate.instant("igo.integration.map-proximity-tool.distance"),valueAccessor:re=>`${Eo.UD.roundToNDecimal(re.properties.distance,1)}m`}]}}ngOnInit(){this.mapProximityState.enabled$.next(!0),this.userDefinedFollowPosition=!0===this.map.geolocationController.followPosition,this.userDefinedMapCenter=!0===this.map.mapCenter$.value,this.subs$$.push(this.mapProximityState.proximitylocationType$.subscribe(Y=>{this.map.mapCenter$.next("geolocation"!==Y),this.map.geolocationController.followPosition="geolocation"===Y}))}ngOnDestroy(){this.mapProximityState.enabled$.next(!1),this.map.mapCenter$.next(this.userDefinedMapCenter),this.subs$$.map(Y=>Y.unsubscribe()),this.map.geolocationController.followPosition=this.userDefinedFollowPosition}onLocationTypeChange(Y){this.mapProximityState.proximitylocationType$.next(Y.value)}copyTextToClipboard(){Eo._D.copy(this.mapProximityState.currentPositionCoordinate$?.value.toString())&&this.messageService.success("igo.integration.map-proximity-tool.copyMsg","igo.integration.map-proximity-tool.copyTitle")}static \u0275fac=function(c){return new(c||Xs)(o.GI1(mt),o.GI1(Wi),o.GI1(St.ov),o.GI1(Zt.mi))};static \u0275cmp=o.In1({type:Xs,selectors:[["igo-map-proximity-tool"]],viewQuery:function(c,C){if(1&c&&o.CC$(Ei,7),2&c){let $;o.wto($=o.Gqi())&&(C.table=$.first)}},standalone:!0,features:[o.UHJ],decls:31,vars:35,consts:[[1,"table-compact",3,"store","template"],["table",""],["class","coordinates",4,"ngIf"],["class","coordinates2",4,"ngIf"],["mat-icon-button","",3,"click",4,"ngIf"],[1,"title-container"],[1,"title","mat-typography"],[1,"igo-input-container","mat-typography"],[3,"change"],["value","geolocation",3,"checked"],["value","mapCenter",3,"checked"],[1,"radius-unit"],["floatLabel","always",1,"radius-field"],["type","number","pattern","[0-9]*","matInput","",3,"ngModel","placeholder","ngModelChange"],[1,"coordinates"],["matInput","","readonly","","rows","1",3,"placeholder","value"],["textArea",""],[1,"coordinates2"],["mat-icon-button","",3,"click"],["svgIcon","content-copy"]],template:function(c,C){1&c&&(o.wR5(0,"igo-entity-table",0,1)(2,"br"),o.yuY(3,Ni,4,4,"mat-form-field",2),o.wVc(4,"async"),o.yuY(5,xi,4,4,"mat-form-field",3),o.wVc(6,"async"),o.yuY(7,Hi,2,0,"button",4),o.wVc(8,"async"),o.wVc(9,"async"),o.I0R(10,"div",5)(11,"mat-label",6),o.OEk(12),o.wVc(13,"translate"),o.C$Y()(),o.I0R(14,"div",7)(15,"mat-radio-group",8),o.qCj("change",function(re){return C.onLocationTypeChange(re)}),o.I0R(16,"mat-radio-button",9),o.wVc(17,"async"),o.OEk(18),o.wVc(19,"translate"),o.C$Y(),o.I0R(20,"mat-radio-button",10),o.wVc(21,"async"),o.OEk(22),o.wVc(23,"translate"),o.C$Y()()(),o.I0R(24,"div",11)(25,"mat-form-field",12)(26,"mat-label"),o.OEk(27),o.wVc(28,"translate"),o.C$Y(),o.I0R(29,"input",13),o.iHE("ngModelChange",function(re){return o.kNx(C.maxDistance,re)||(C.maxDistance=re),re}),o.wVc(30,"translate"),o.C$Y()()()),2&c&&(o.E7m("store",C.mapProximityState.proximityFeatureStore)("template",C.tableTemplate),o.yG2(3),o.E7m("ngIf",o.kDX(4,13,C.mapProximityState.currentPositionCoordinate$)),o.yG2(2),o.E7m("ngIf",o.kDX(6,15,C.mapProximityState.currentPositionCoordinate$)),o.yG2(2),o.E7m("ngIf",o.kDX(8,17,C.mapProximityState.currentPositionCoordinate$)&&o.kDX(9,19,C.mapProximityState.currentPositionCoordinate$).length),o.yG2(5),o.cNF(o.kDX(13,21,"igo.integration.map-proximity-tool.method")),o.yG2(4),o.E7m("checked","geolocation"===o.kDX(17,23,C.mapProximityState.proximitylocationType$)),o.yG2(2),o.cNF(o.kDX(19,25,"igo.integration.map-proximity-tool.geolocation")),o.yG2(2),o.E7m("checked","mapCenter"===o.kDX(21,27,C.mapProximityState.proximitylocationType$)),o.yG2(2),o.cNF(o.kDX(23,29,"igo.integration.map-proximity-tool.mapCenter")),o.yG2(5),o.cNF(o.kDX(28,31,"igo.integration.map-proximity-tool.radiusM")),o.yG2(2),o._6D("placeholder",o.kDX(30,33,"igo.integration.map-proximity-tool.radiusM")),o.OKB("ngModel",C.maxDistance))},dependencies:[y.Eh,L.u_,Po.wb,Po.Up,Po.w5,mi.cN,mi.yi,N.oJ,N.um,Le.oB,Le.qL,yi.yk,yi.cv,yi.cT,oe.y,oe.ot,oe.O4,oe.ue,oe.E1,oe._G,L.a,Dt.O0,Dt.sD],styles:["[_nghost-%COMP%]   .table-compact[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .table-compact[_ngcontent-%COMP%]     .mat-mdc-header-cell.mat-column-selectionCheckbox{width:52px}[_nghost-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none}[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{padding:10px 15px}[_nghost-%COMP%]   mat-form-field.coordinates[_ngcontent-%COMP%]{width:110px}[_nghost-%COMP%]   mat-form-field.coordinates2[_ngcontent-%COMP%]{width:100px;padding:0 10px 0 3px}[_nghost-%COMP%]   mat-form-field.igo-input-container[_ngcontent-%COMP%]{width:60%;padding:0 15px}[_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:90%;margin-left:2px;padding:5px}[_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]   mat-form-field.radius-field[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;width:100%}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]{padding:10px}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{margin-left:5px;font-size:initial}[_nghost-%COMP%]   .mat-mdc-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%]{display:inline-flex;position:relative;margin-left:12px}"]})};function tr(J,Y){if(1&J){const c=o.KQA();o.wR5(0,"igo-workspace-button",4),o.I0R(1,"igo-export-button",5),o.qCj("click",function(){const re=o.usT(c).layer,Ce=o.GaO();return o.CGJ(Ce.activateExport(re))}),o.C$Y(),o.wR5(2,"igo-ogc-filter-button",6)(3,"igo-time-filter-button",6)(4,"igo-track-feature-button",7)(5,"igo-metadata-button",4)}if(2&J){const c=Y.layer,C=o.GaO();o.E7m("layer",c),o.yG2(),o.E7m("layer",c),o.yG2(),o.E7m("header",C.ogcButton)("layer",c),o.yG2(),o.E7m("header",C.timeButton)("layer",c),o.yG2(),o.E7m("trackFeature",!0)("layer",c),o.yG2(),o.E7m("layer",c)}}Mi=(0,Ke.UN)([(0,y.aA)({name:"map-proximity",title:"igo.integration.tools.closestFeature",icon:"radius"}),(0,Ke.YR)("design:paramtypes",[mt,Wi,St.ov,Zt.mi])],Mi);let zi=class Js{mapState;toolState;importExportState;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;ogcButton=!0;timeButton=!0;layerListControls={};queryBadge=!1;get map(){return this.mapState.map}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get layerFilterAndSortOptions(){const Y=Object.assign({showToolbar:d.g7B.default},this.layerListControls);switch(this.layerListControls.showToolbar){case d.g7B.always:Y.showToolbar=d.g7B.always;break;case d.g7B.never:Y.showToolbar=d.g7B.never}return Y}constructor(Y,c,C){this.mapState=Y,this.toolState=c,this.importExportState=C}activateExport(Y){let c=Y.id;Y.options.workspace?.workspaceId&&(c=Y.options.workspace.workspaceId!==Y.id?Y.options.workspace.workspaceId:Y.id),this.importExportState.setsExportOptions({layers:[c]}),this.importExportState.setMode(eo.export),this.toolState.toolbox.activateTool("importExport")}static \u0275fac=function(c){return new(c||Js)(o.GI1(mt),o.GI1(zt),o.GI1(uo))};static \u0275cmp=o.In1({type:Js,selectors:[["igo-map-tool"]],inputs:{toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",ogcButton:"ogcButton",timeButton:"timeButton",layerListControls:"layerListControls",queryBadge:"queryBadge"},standalone:!0,features:[o.UHJ],decls:9,vars:13,consts:[[3,"label"],["igoLayerListBinding","",3,"map","excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge"],["igoLayerItemToolbar",""],["igoContextListBinding",""],[3,"layer"],[3,"layer","click"],[3,"header","layer"],[3,"trackFeature","layer"]],template:function(c,C){1&c&&(o.I0R(0,"mat-tab-group")(1,"mat-tab",0),o.wVc(2,"translate"),o.I0R(3,"igo-layer-list",1),o.yuY(4,tr,6,9,"ng-template",null,2,o.gJz),o.C$Y()(),o.I0R(6,"mat-tab",0),o.wVc(7,"translate"),o.wR5(8,"igo-context-list",3),o.C$Y()()),2&c&&(o.yG2(),o.E7m("label",o.kDX(2,9,"igo.integration.tools.map")),o.yG2(2),o.E7m("map",C.map)("excludeBaseLayers",C.excludeBaseLayers)("layerFilterAndSortOptions",C.layerFilterAndSortOptions)("expandLegendOfVisibleLayers",C.expandLegendOfVisibleLayers)("toggleLegendOnVisibilityChange",C.toggleLegendOnVisibilityChange)("updateLegendOnResolutionChange",C.updateLegendOnResolutionChange)("queryBadge",C.queryBadge),o.yG2(3),o.E7m("label",o.kDX(7,11,"igo.integration.tools.contexts")))},dependencies:[xo.WG,xo.aJ,xo._q,d.m2U,d.Ult,wi,d.O_6,d.Ga$,d.eM$,d.ktW,d.Idw,pe.W2,pe.AX,Dt.O0,Dt.sD],styles:["[_nghost-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden}"],changeDetection:0})};zi=(0,Ke.UN)([(0,y.aA)({name:"map",title:"igo.integration.tools.map",icon:"map"}),(0,Ke.YR)("design:paramtypes",[mt,zt,uo])],zi);const Vn=["tabGroup"];function ne(J,Y){if(1&J&&o.wR5(0,"igo-style-modal-layer-button",11),2&J){const c=o.GaO().layer;o.E7m("layer",c)}}function Ye(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"igo-time-filter-button",15),o.qCj("click",function(){o.usT(c);const $=o.GaO(3);return o.CGJ($.activateTimeFilter())}),o.C$Y()}if(2&J){const c=o.GaO().layer,C=o.GaO(2);o.E7m("header",C.timeButton)("layer",c)}}function f(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"igo-ogc-filter-button",15),o.qCj("click",function(){o.usT(c);const $=o.GaO(3);return o.CGJ($.activateOgcFilter())}),o.C$Y()}if(2&J){const c=o.GaO().layer,C=o.GaO(2);o.E7m("header",C.ogcButton)("layer",c)}}function H(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"igo-export-button",16),o.qCj("click",function(){o.usT(c);const $=o.GaO().layer,re=o.GaO(2);return o.CGJ(re.activateExport($))}),o.C$Y()}if(2&J){const c=o.GaO().layer;o.E7m("layer",c)}}function Z(J,Y){if(1&J&&(o.yuY(0,ne,1,1,"igo-style-modal-layer-button",10),o.wR5(1,"igo-metadata-button",11)(2,"igo-track-feature-button",12),o.yuY(3,Ye,1,2,"igo-time-filter-button",13)(4,f,1,2,"igo-ogc-filter-button",13)(5,H,1,1,"igo-export-button",14),o.wR5(6,"igo-workspace-button",11)),2&J){const c=Y.layer,C=o.GaO(2);o.E7m("ngIf",C.isStyleEditButton(c)),o.yG2(),o.E7m("layer",c),o.yG2(),o.E7m("trackFeature",!0)("layer",c),o.yG2(),o.E7m("ngIf",C.isTimeFilterButton(c)),o.yG2(),o.E7m("ngIf",C.isOGCFilterButton(c)),o.yG2(),o.E7m("ngIf",C.isExportButton(c)),o.yG2(),o.E7m("layer",c)}}function _e(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"igo-layer-list",8),o.qCj("appliedFilterAndSort",function($){o.usT(c);const re=o.GaO();return o.CGJ(re.onLayerListChange($))}),o.yuY(1,Z,7,8,"ng-template",null,9,o.gJz),o.C$Y()}if(2&J){const c=o.GaO();o.E7m("excludeBaseLayers",c.excludeBaseLayers)("layerFilterAndSortOptions",c.layerFilterAndSortOptions)("expandLegendOfVisibleLayers",c.expandLegendOfVisibleLayers)("toggleLegendOnVisibilityChange",c.toggleLegendOnVisibilityChange)("updateLegendOnResolutionChange",c.updateLegendOnResolutionChange)("queryBadge",c.queryBadge)("map",c.map)}}function we(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"igo-layer-legend-list",17),o.qCj("allLegendsShown",function($){o.usT(c);const re=o.GaO();return o.CGJ(re.onShowAllLegends($))}),o.wVc(1,"async"),o.C$Y()}if(2&J){const c=o.GaO();o.E7m("allowShowAllLegends",c.allowShowAllLegends)("showAllLegendsValue",o.kDX(1,4,c.showAllLegendsValue$))("excludeBaseLayers",c.excludeBaseLayers)("updateLegendOnResolutionChange",c.updateLegendOnResolutionChange)}}function We(J,Y){}function gt(J,Y){1&J&&o.yuY(0,We,0,0,"ng-template")}function Ot(J,Y){if(1&J&&(o.I0R(0,"p",18),o.OEk(1),o.wVc(2,"async"),o.wVc(3,"translate"),o.wVc(4,"translate"),o.C$Y()),2&J){const c=o.GaO();o.yG2(),o.oRS(" ",o.kDX(2,1,c.visibleLayers$).length?o.kDX(3,3,"igo.integration.mapTool.noLayersInRange"):o.kDX(4,5,"igo.integration.mapTool.noLayersVisible")," ")}}function lt(J,Y){1&J&&(o.I0R(0,"p",18),o.OEk(1),o.wVc(2,"translate"),o.C$Y()),2&J&&(o.yG2(),o.oRS(" ",o.kDX(2,1,"igo.integration.mapTool.customize")," "))}function kt(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",20),o.S2Z(),o.I0R(2,"svg",21),o.wR5(3,"path",22),o.C$Y()(),o.gRP(),o.I0R(4,"span",23),o.qCj("click",function(){o.usT(c);const $=o.GaO(3);return o.CGJ($.searchEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.search-tool")," "))}function Pt(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",20),o.S2Z(),o.I0R(2,"svg",21),o.wR5(3,"path",24),o.C$Y()(),o.gRP(),o.I0R(4,"span",25),o.qCj("click",function(){o.usT(c);const $=o.GaO(3);return o.CGJ($.catalogEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.catalog-tool")," "))}function no(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",20),o.S2Z(),o.I0R(2,"svg",21),o.wR5(3,"path",26),o.C$Y()(),o.gRP(),o.I0R(4,"span",27),o.qCj("click",function(){o.usT(c);const $=o.GaO(3);return o.CGJ($.contextEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.context-tool")," "))}function Xt(J,Y){if(1&J&&(o.I0R(0,"mat-list")(1,"p",18),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.yuY(4,lt,3,3,"p",6)(5,kt,7,3,"mat-list-item",19)(6,Pt,7,3,"mat-list-item",19)(7,no,7,3,"mat-list-item",19),o.C$Y()),2&J){const c=o.GaO(2);o.yG2(2),o.oRS(" ",o.kDX(3,5,"igo.integration.mapTool.empty")," "),o.yG2(2),o.E7m("ngIf",c.layerAdditionAllowed&&(c.searchToolInToolbar||c.catalogToolInToolbar||c.contextToolInToolbar)),o.yG2(),o.E7m("ngIf",c.layerAdditionAllowed&&c.searchToolInToolbar),o.yG2(),o.E7m("ngIf",c.layerAdditionAllowed&&c.catalogToolInToolbar),o.yG2(),o.E7m("ngIf",c.layerAdditionAllowed&&c.contextToolInToolbar)}}function Fo(J,Y){if(1&J&&o.yuY(0,Xt,8,7,"mat-list",19),2&J){const c=o.GaO();o.E7m("ngIf",c.delayedShowEmptyMapContent)}}let No=class Qs{layerListToolState;toolState;mapState;searchSourceService;importExportState;layers$=new W.g([]);showAllLegendsValue$=new W.g(!1);resolution$$;visibleOrInRangeLayers$$;delayedShowEmptyMapContent=!1;allowShowAllLegends=!1;showAllLegendsValue=!1;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;selectedTabAtOpening;ogcButton=!0;timeButton=!0;layerAdditionAllowed=!0;get layerListControls(){return this._layerListControls}set layerListControls(Y){const c=this.layerListToolState.getLayerListControls(),C=c.keyword,$=c.onlyVisible,re=c.sortAlpha;Y.keyword=""!==C?C:Y.keyword,Y.onlyVisible=void 0!==$?$:Y.onlyVisible,Y.sortAlpha=void 0!==re?re:Y.sortAlpha,Y.onlyVisible=void 0!==Y.onlyVisible&&Y.onlyVisible,Y.sortAlpha=void 0!==Y.sortAlpha&&Y.sortAlpha,this._layerListControls=Y}_layerListControls={};get map(){return this.mapState.map}queryBadge=!1;get visibleOrInRangeLayers$(){return this.layers$.pipe((0,Io.k)(Y=>Y.filter(c=>c.visible$.value&&c.isInResolutionsRange$.value)))}get visibleLayers$(){return this.layers$.pipe((0,Io.k)(Y=>Y.filter(c=>c.visible$.value)))}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get layerFilterAndSortOptions(){const Y=Object.assign({showToolbar:d.g7B.default},this.layerListControls);switch(this.layerListControls.showToolbar){case d.g7B.always:Y.showToolbar=d.g7B.always;break;case d.g7B.never:Y.showToolbar=d.g7B.never}return Y}tabGroup;get searchToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("searchResults")&&this.searchSourceService.getSources().filter(d.ayN).filter(Y=>Y.available&&"Layer"===Y.getType()).length>0}get catalogToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("catalog")}get contextToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("contextManager")}constructor(Y,c,C,$,re){this.layerListToolState=Y,this.toolState=c,this.mapState=C,this.searchSourceService=$,this.importExportState=re}ngOnInit(){this.selectedTab(),this.resolution$$=(0,Qt.E)([this.map.layers$,this.map.viewController.resolution$]).pipe((0,ti.o)(10)).subscribe(Y=>{this.layers$.next(Y[0].filter(c=>!(!1===c.showInLayerList||this.excludeBaseLayers&&c.baseLayer)))}),this.allowShowAllLegends?(this.mapState.showAllLegendsValue=void 0!==this.mapState.showAllLegendsValue?this.mapState.showAllLegendsValue:this.showAllLegendsValue||!1,this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue)):this.showAllLegendsValue$.next(!1),setTimeout(()=>this.delayedShowEmptyMapContent=!0,250)}ngOnDestroy(){this.resolution$$.unsubscribe(),this.visibleOrInRangeLayers$$&&this.visibleOrInRangeLayers$$.unsubscribe()}onShowAllLegends(Y){this.mapState.showAllLegendsValue=Y,this.showAllLegendsValue$.next(Y)}selectedTab(){const Y=this.layerListToolState.selectedTab$.value;this.layerListToolState.setSelectedTab(void 0!==Y?Y:"legend"===this.selectedTabAtOpening?1:0)}tabChanged(Y){this.layerListToolState.setSelectedTab(Y.index),this.layers$.next(this.map.layers.filter(c=>!(!1===c.showInLayerList||this.excludeBaseLayers&&c.baseLayer)))}onLayerListChange(Y){this.layerListToolState.setKeyword(Y.keyword),this.layerListToolState.setSortAlpha(Y.sortAlpha),this.layerListToolState.setOnlyVisible(Y.onlyVisible)}showAllLegend(){if(0===this.layers$.getValue().length)return!1;if(0!==this.layers$.getValue().length&&!1===this.allowShowAllLegends){let Y;if(this.visibleOrInRangeLayers$$=this.visibleOrInRangeLayers$.subscribe(c=>{Y=0!==c.length}),!1===Y)return!1}return!0}activateExport(Y){let c=Y.id;Y.options.workspace?.workspaceId&&(c=Y.options.workspace.workspaceId!==Y.id?Y.options.workspace.workspaceId:Y.id),this.importExportState.setsExportOptions({layers:[c]}),this.importExportState.setMode(eo.export),this.toolState.toolbox.activateTool("importExport")}activateTimeFilter(){this.toolState.toolbox.activateTool("activeTimeFilter")}activateOgcFilter(){this.toolState.toolbox.activateTool("activeOgcFilter")}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}isTimeFilterButton(Y){const c=Y.dataSource.options;return this.timeButton&&c.timeFilterable&&c.timeFilter}isOGCFilterButton(Y){const c=Y.dataSource.options;return this.ogcButton&&c.ogcFilters&&c.ogcFilters.enabled&&(c.ogcFilters.pushButtons||c.ogcFilters.checkboxes||c.ogcFilters.radioButtons||c.ogcFilters.select||c.ogcFilters.autocomplete||c.ogcFilters.editable)}isExportButton(Y){return!!(Y instanceof d.Mdo&&!0===Y.exportable||Y.dataSource.options.download&&Y.dataSource.options.download.url||Y.options.workspace?.enabled&&Y.options.workspace?.workspaceId!==Y.id)}isStyleEditButton(Y){return!!(Y instanceof d.Mdo&&Y.options?.igoStyle?.editable)}static \u0275fac=function(c){return new(c||Qs)(o.GI1(qe),o.GI1(zt),o.GI1(mt),o.GI1(d.i6q),o.GI1(uo))};static \u0275cmp=o.In1({type:Qs,selectors:[["igo-map-tools"]],viewQuery:function(c,C){if(1&c&&o.CC$(Vn,7),2&c){let $;o.wto($=o.Gqi())&&(C.tabGroup=$.first)}},inputs:{allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",selectedTabAtOpening:"selectedTabAtOpening",ogcButton:"ogcButton",timeButton:"timeButton",layerAdditionAllowed:"layerAdditionAllowed",layerListControls:"layerListControls",queryBadge:"queryBadge"},standalone:!0,features:[o.UHJ],decls:17,vars:23,consts:[[3,"selectedIndex","selectedTabChange"],["tabGroup",""],[3,"label"],["igoLayerListBinding","",3,"excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge","map","appliedFilterAndSort",4,"ngIf","ngIfElse"],["igoLayerLegendListBinding","",3,"allowShowAllLegends","showAllLegendsValue","excludeBaseLayers","updateLegendOnResolutionChange","allLegendsShown",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","map-empty mat-typography",4,"ngIf"],["emptyLayers",""],["igoLayerListBinding","",3,"excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge","map","appliedFilterAndSort"],["igoLayerItemToolbar",""],[3,"layer",4,"ngIf"],[3,"layer"],[3,"trackFeature","layer"],[3,"header","layer","click",4,"ngIf"],[3,"layer","click",4,"ngIf"],[3,"header","layer","click"],[3,"layer","click"],["igoLayerLegendListBinding","",3,"allowShowAllLegends","showAllLegendsValue","excludeBaseLayers","updateLegendOnResolutionChange","allLegendsShown"],[1,"map-empty","mat-typography"],[4,"ngIf"],["matListItemIcon",""],["viewBox","0 0 24 24","fit","","height","100%","width","100%","preserveAspectRatio","xMidYMid meet","focusable","false"],["d","M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["d","M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["d","M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(c,C){if(1&c&&(o.I0R(0,"mat-tab-group",0,1),o.qCj("selectedTabChange",function(re){return C.tabChanged(re)}),o.wVc(2,"async"),o.I0R(3,"mat-tab",2),o.wVc(4,"translate"),o.yuY(5,_e,3,7,"igo-layer-list",3),o.wVc(6,"async"),o.C$Y(),o.I0R(7,"mat-tab",2),o.wVc(8,"translate"),o.yuY(9,we,2,6,"igo-layer-legend-list",4)(10,gt,1,0,null,5),o.wVc(11,"async"),o.yuY(12,Ot,5,7,"p",6),o.wVc(13,"async"),o.wVc(14,"async"),o.C$Y(),o.yuY(15,Fo,1,1,"ng-template",null,7,o.gJz),o.C$Y()),2&c){const $=o.Gew(16);o.E7m("selectedIndex",o.kDX(2,9,C.layerListToolState.selectedTab$)),o.yG2(3),o.E7m("label",o.kDX(4,11,"igo.integration.tools.layers")),o.yG2(2),o.E7m("ngIf",0!==o.kDX(6,13,C.layers$).length)("ngIfElse",$),o.yG2(2),o.E7m("label",o.kDX(8,15,"igo.integration.tools.legend")),o.yG2(2),o.E7m("ngIf",C.showAllLegend()),o.yG2(),o.E7m("ngIf",0!==o.kDX(11,17,C.layers$).length)("ngIfElse",$),o.yG2(2),o.E7m("ngIf",!C.allowShowAllLegends&&0!==o.kDX(13,19,C.layers$).length&&0===o.kDX(14,21,C.visibleOrInRangeLayers$).length)}},dependencies:[xo.WG,xo.aJ,xo._q,L.u_,d.m2U,d.Ult,d.iOO,d.Idw,d.ktW,d.eM$,d.Ga$,d.O_6,wi,d.wSE,d.ApN,oo.iI,oo.oL,oo.g9,oo.Y1,oo.UV,Le.oB,Le.qL,L.a,Dt.O0,Dt.sD],styles:["[_nghost-%COMP%]   mat-tab-group[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]     .mat-mdc-tab-body-wrapper{flex:1}[_nghost-%COMP%]     .mat-tab-body{margin-top:8px}[_nghost-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   mat-list.mat-mdc-list-base[_ngcontent-%COMP%]   mat-list-item.mat-mdc-list-item[_ngcontent-%COMP%]     div.mdc-list-item__content div.mdc-list-item__primary-text{padding-left:5px}"],changeDetection:0})};No=(0,Ke.UN)([(0,y.aA)({name:"mapTools",title:"igo.integration.tools.map",icon:"map"}),(0,Ke.YR)("design:paramtypes",[qe,zt,mt,d.i6q,uo])],No);let _i=(()=>{class J{mapState;store;constructor(c){this.mapState=c,this.store=new d.ym_([],{map:this.mapState.map}),this.mapState.map.layers$.subscribe(C=>{0===C.filter($=>$.id?.startsWith("igo-measures-")).length&&(this.store.deleteMany(this.store.all()),this.mapState.map.ol.getOverlays().getArray().filter($=>$.options.className.includes("igo-map-tooltip")).map($=>this.mapState.map.ol.removeOverlay($)))})}static \u0275fac=function(C){return new(C||J)(o.CoB(mt))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),bn=class Zs{measureState;mapState;get store(){return this.measureState.store}get map(){return this.mapState.map}constructor(Y,c){this.measureState=Y,this.mapState=c}static \u0275fac=function(c){return new(c||Zs)(o.GI1(_i),o.GI1(mt))};static \u0275cmp=o.In1({type:Zs,selectors:[["igo-measurer-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:2,consts:[[3,"store","map"]],template:function(c,C){1&c&&o.wR5(0,"igo-measurer",0),2&c&&o.E7m("store",C.store)("map",C.map)},dependencies:[d.yaV],encapsulation:2,changeDetection:0})};bn=(0,Ke.UN)([(0,y.aA)({name:"measurer",title:"igo.integration.tools.measurer",icon:"ruler"}),(0,Ke.YR)("design:paramtypes",[_i,mt])],bn);let Di=class qs{mapState;get map(){return this.mapState.map}constructor(Y){this.mapState=Y}static \u0275fac=function(c){return new(c||qs)(o.GI1(mt))};static \u0275cmp=o.In1({type:qs,selectors:[["igo-print-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:1,consts:[[3,"map"]],template:function(c,C){1&c&&o.wR5(0,"igo-print",0),2&c&&o.E7m("map",C.map)},dependencies:[d.eAF],encapsulation:2})};Di=(0,Ke.UN)([(0,y.aA)({name:"print",title:"igo.integration.tools.print",icon:"printer"}),(0,Ke.YR)("design:paramtypes",[mt])],Di);var Xi=s(50032),Wn=s(12472);let $o=(()=>{class J{searchSourceService;storageService;workspaceState;configService;mapState;searchLayerStores=[];searchOverlayStyle={};searchOverlayStyleSelection={};searchOverlayStyleFocus={};focusedOrResolution$$;selectedOrResolution$$;featureMotion={selected:d.Suj.Default,focus:d.Suj.None};searchTermSplitter$=new W.g("|");searchTerm$=new W.g(void 0);searchType$=new W.g(void 0);searchDisabled$=new W.g(!1);searchResultsGeometryEnabled$=new W.g(!1);searchSettingsChange$=new W.g(void 0);selectedResult$=new W.g(void 0);store=new y.qc([]);get searchTypes(){return this.searchSourceService.getEnabledSources().map(c=>c.constructor.type)}constructor(c,C,$,re,Ce){this.searchSourceService=c,this.storageService=C,this.workspaceState=$,this.configService=re,this.mapState=Ce;const Ve=this.configService.getConfig("searchOverlayStyle");Ve&&(this.searchOverlayStyle=Ve.base,this.searchOverlayStyleSelection=Ve.selection,this.searchOverlayStyleFocus=Ve.focus);const nt=this.storageService.get("searchResultsGeometryEnabled");nt&&this.searchResultsGeometryEnabled$.next(nt),this.store.addStrategy(this.createCustomFilterTermStrategy(),!1);const at=this.searchSourceService.getSources().find(wt=>"workspace"===wt.getId());this.workspaceState.store.entities$.subscribe(wt=>{const Wt=wt.filter(Et=>Et instanceof d.Wwb&&Et.layer.options.workspace.searchIndexEnabled);this.searchSourceService.setWorkspaces(at,Wt)}),this.monitorLayerDeletion()}monitorLayerDeletion(){this.mapState.map.layers$.subscribe(c=>{this.searchLayerStores.forEach(C=>{if(!c.find(re=>re.id===C.layer.id)){const re=this.searchLayerStores.indexOf(C);this.searchLayerStores.splice(re,1)}})})}createCustomFilterTermStrategy(){return new y.qq({filterClauseFunc:C=>100===C.entity.meta.score})}activateCustomFilterTermStrategy(){const c=this.store.getStrategyOfType(y.qq);void 0!==c&&c.activate()}deactivateCustomFilterTermStrategy(){const c=this.store.getStrategyOfType(y.qq);void 0!==c&&c.deactivate()}enableSearch(){this.searchDisabled$.next(!1)}disableSearch(){this.searchDisabled$.next(!0)}setSearchTerm(c){this.searchTerm$.next(c)}setSearchType(c){this.searchSourceService.enableSourcesByType(c),this.searchType$.next(c)}setSearchSettingsChange(){this.searchSettingsChange$.next(!0)}setSelectedResult(c){this.selectedResult$.next(c)}setSearchResultsGeometryStatus(c){this.storageService.set("searchResultsGeometryEnabled",c),this.searchResultsGeometryEnabled$.next(c)}static \u0275fac=function(C){return new(C||J)(o.CoB(d.i6q),o.CoB(e.yQ),o.CoB(ot),o.CoB(ze.aW),o.CoB(mt))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();function ho(J,Y){1&J&&(o.I0R(0,"div",2)(1,"section",3)(2,"h4")(3,"strong"),o.OEk(4),o.wVc(5,"translate"),o.C$Y()(),o.I0R(6,"p")(7,"strong"),o.OEk(8),o.wVc(9,"translate"),o.C$Y()(),o.wR5(10,"div",4),o.wVc(11,"sanitizeHtml"),o.wVc(12,"translate"),o.C$Y()()),2&J&&(o.yG2(4),o.cNF(o.kDX(5,3,"igo.integration.searchResultsTool.noResults")),o.yG2(4),o.cNF(o.kDX(9,5,"igo.integration.searchResultsTool.doSearch")),o.yG2(2),o.E7m("innerHTML",o.kDX(11,7,o.kDX(12,9,"igo.integration.searchResultsTool.examples")),o.E3n))}function lo(J,Y){if(1&J&&o.wR5(0,"igo-search-add-button",12),2&J){const c=Y.result,C=o.GaO(2);o.E7m("map",C.map)("store",C.store)("stores",C.stores)("layer",c)("saveSearchResultInLayer",C.saveSearchResultInLayer)}}function In(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"button",18),o.qCj("click",function(){o.usT(c);const $=o.GaO(3);return o.CGJ($.zoomToFeatureExtent())}),o.wVc(1,"translate"),o.wVc(2,"async"),o.wR5(3,"mat-icon",19),o.wVc(4,"async"),o.wVc(5,"async"),o.C$Y()}if(2&J){const c=o.GaO(3);o.E7m("matTooltip",o.kDX(1,3,o.kDX(2,5,c.isSelectedResultOutOfView$)?"igo.integration.searchResultsTool.zoomOnFeatureTooltipOutOfView":"igo.integration.searchResultsTool.zoomOnFeatureTooltip")),o.yG2(3),o.E7m("matBadge",o.kDX(4,7,c.isSelectedResultOutOfView$)?"!":"")("matBadgeHidden",!1===o.kDX(5,9,c.isSelectedResultOutOfView$))}}function or(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"igo-panel",13),o.qCj("click",function($){o.usT(c);const re=o.GaO(2);return o.CGJ(re.toggleTopPanel($))}),o.I0R(1,"button",14),o.qCj("click",function(){o.usT(c);const $=o.GaO(2);return o.CGJ($.toggleTopPanel())}),o.wR5(2,"mat-icon",15),o.wVc(3,"async"),o.C$Y(),o.yuY(4,In,6,11,"button",16),o.I0R(5,"igo-feature-details",17),o.qCj("routingEvent",function(){o.usT(c);const $=o.GaO(2);return o.CGJ($.getRoute())}),o.wVc(6,"async"),o.C$Y()()}if(2&J){const c=o.GaO(2);o.E7m("title",c.featureTitle)("cursorPointer",!0),o.yG2(2),o.E7m("svgIcon","collapsed"===o.kDX(3,7,c.topPanelState$)?"arrow-up":"arrow-down"),o.yG2(2),o.E7m("ngIf",c.feature.geometry),o.yG2(),o.E7m("feature",o.kDX(6,9,c.feature$))("map",c.map)("toolbox",c.toolState.toolbox)}}function ir(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"igo-flexible",5,6),o.wVc(2,"async"),o.I0R(3,"div",7)(4,"igo-search-results",8),o.qCj("resultFocus",function($){o.usT(c);const re=o.GaO();return o.CGJ(re.onResultFocus($))})("resultSelect",function($){o.usT(c);const re=o.GaO();return o.CGJ(re.onResultSelect($))})("resultUnfocus",function($){o.usT(c);const re=o.GaO();return o.CGJ(re.onResultUnfocus($))})("resultMouseenter",function($){o.usT(c);const re=o.GaO();return o.CGJ(re.onResultFocus($))})("resultMouseleave",function($){o.usT(c);const re=o.GaO();return o.CGJ(re.onResultUnfocus($))})("moreResults",function($){o.usT(c);const re=o.GaO();return o.CGJ(re.onSearch($))}),o.yuY(5,lo,1,5,"ng-template",null,9,o.gJz),o.C$Y()(),o.I0R(7,"div",10),o.yuY(8,or,7,11,"igo-panel",11),o.wVc(9,"async"),o.C$Y()()}if(2&J){const c=o.GaO();o.E7m("state",o.kDX(2,8,c.feature$)?c.topPanelState:"initial"),o.yG2(4),o.E7m("store",c.store)("showIcons",c.showIcons)("term",c.term)("termSplitter",c.termSplitter)("settingsChange$",c.settingsChange$)("map",c.map),o.yG2(4),o.E7m("ngIf",o.kDX(9,10,c.feature$))}}let Nn=class ea{mapState;searchState;elRef;toolState;directionState;showIcons=!0;topPanelStateDefault="expanded";hasFeatureEmphasisOnSelection=!1;saveSearchResultInLayer=!1;showResultsGeometries$$;getRoute$$;shownResultsGeometries=[];shownResultsEmphasisGeometries=[];focusedResult$=new W.g(void 0);isSelectedResultOutOfView$=new W.g(!1);isSelectedResultOutOfView$$;abstractFocusedResult;abstractSelectedResult;debouncedEmpty$=new W.g(!0);debouncedEmpty$$;get store(){return this.searchState.store}get map(){return this.mapState.map}get featureTitle(){return this.feature?(0,y.YB)(this.feature):void 0}get feature$(){return this.store.stateView.firstBy$(Y=>Y.state.focused).pipe((0,Io.k)(Y=>this.feature=Y?Y.entity.data:void 0))}feature;term="";searchTerm$$;settingsChange$=new W.g(void 0);topPanelState$=new W.g("initial");topPanelState$$;set topPanelState(Y){this.topPanelState$.next(Y)}get topPanelState(){return this.topPanelState$.value}get termSplitter(){return this.searchState.searchTermSplitter$.value}format=new li.c;get stores(){return this.searchState.searchLayerStores}constructor(Y,c,C,$,re,Ce){this.mapState=Y,this.searchState=c,this.elRef=C,this.toolState=$,this.directionState=re,this.hasFeatureEmphasisOnSelection=Ce.getConfig("hasFeatureEmphasisOnSelection"),this.saveSearchResultInLayer=Ce.getConfig("saveSearchResultInLayer")}ngOnInit(){this.searchTerm$$=this.searchState.searchTerm$.subscribe(Y=>{null!=Y&&""!==Y?(this.term=Y,this.debouncedEmpty$.next(!1)):""===Y&&this.debouncedEmpty$.next(!0)});for(const Y of this.store.stateView.all$().value)!0===this.store.state.get(Y.entity).selected&&(this.topPanelState="expanded");this.searchState.searchSettingsChange$.subscribe(()=>{this.settingsChange$.next(!0)}),this.topPanelState$$=this.topPanelState$.subscribe(()=>{const Y=this.computeElementRef()[0],c=this.computeElementRef()[1];c&&setTimeout(()=>{this.isScrolledIntoView(Y,c)||this.adjustTopPanel(Y,c)},y.Kg.transitionTime+50)}),this.hasFeatureEmphasisOnSelection&&(this.searchState.focusedOrResolution$$||(this.searchState.focusedOrResolution$$=(0,Qt.E)([this.focusedResult$,this.map.viewController.resolution$]).subscribe(Y=>this.buildResultEmphasis(Y[0],"focused"))),this.searchState.selectedOrResolution$$||(this.searchState.selectedOrResolution$$=(0,Qt.E)([this.searchState.selectedResult$,this.map.viewController.resolution$]).subscribe(Y=>this.buildResultEmphasis(Y[0],"selected")))),this.monitorResultOutOfView(),this.showResultsGeometries$$=(0,Qt.E)([this.searchState.searchResultsGeometryEnabled$,this.store.stateView.all$(),this.focusedResult$,this.searchState.selectedResult$,this.searchState.searchTerm$,this.map.viewController.resolution$]).subscribe(Y=>{const c=Y[0],C=Y[1];this.hasFeatureEmphasisOnSelection&&this.clearFeatureEmphasis("shown"),this.shownResultsGeometries.map(re=>this.map.queryResultsOverlay.removeFeature(re)),C.filter(re=>re.entity.meta.dataType===d.YfI&&re.entity.data.geometry&&!re.state.selected&&!re.state.focused).map(re=>{c&&(re.entity.data.meta.style=(0,d.IvV)(Object.assign({},{feature:re.entity.data},this.searchState.searchOverlayStyle,re.entity.style?.base?re.entity.style.base:{})),this.shownResultsGeometries.push(re.entity.data),this.map.queryResultsOverlay.addFeature(re.entity.data,d.Suj.None),this.hasFeatureEmphasisOnSelection&&this.buildResultEmphasis(re.entity,"shown"))})}),this.debouncedEmpty$$=this.store.stateView.empty$.pipe((0,ti.o)(1500)).subscribe(Y=>this.debouncedEmpty$.next(Y))}monitorResultOutOfView(){this.isSelectedResultOutOfView$$=(0,Qt.E)([this.map.viewController.state$,this.searchState.selectedResult$]).pipe((0,ti.o)(100)).subscribe(Y=>{const c=Y[1];if(c){if(c.data.geometry){const C=(0,d.K6O)(c.data,this.map.projection),$=(0,d.q17)([C],this.map.viewController.getOlProjection());this.isSelectedResultOutOfView$.next((0,d.Ki0)(this.map.getExtent(),$))}}else this.isSelectedResultOutOfView$.next(!1)})}buildResultEmphasis(Y,c){if("shown"!==c&&this.clearFeatureEmphasis(c),!Y||!Y.data.geometry)return;const $=(0,d.K6O)(Y.data,this.map.projection).getGeometry();if((0,d.Yvl)(this.map.viewController,$.getExtent(),.0025)){const re=$.getExtent(),nt=new xt.c({name:`${c}AbstractResult'`,geometry:new Ze.c([re[0]+(re[2]-re[0])/2,re[1]+(re[3]-re[1])/2])}),at=(0,d.qKz)(nt,this.map.projection);let wt,Wt=0;switch(c){case"focused":wt=(0,d._aW)(Object.assign({},{feature:at},this.searchState.searchOverlayStyleFocus,Y.style?.focus?Y.style.focus:{})),Wt=2;break;case"shown":wt=(0,d.IvV)(Object.assign({},{feature:at},this.searchState.searchOverlayStyle,Y.style?.base?Y.style.base:{}));break;case"selected":wt=(0,d._aW)(Object.assign({},{feature:at},this.searchState.searchOverlayStyleSelection,Y.style?.selection?Y.style.selection:{})),Wt=1}at.meta.style=wt,at.meta.style.setZIndex(2e3+Wt),this.map.searchResultsOverlay.addFeature(at,this.searchState.featureMotion.focus),"focused"===c&&(this.abstractFocusedResult=at),"selected"===c&&(this.abstractSelectedResult=at),"shown"===c&&this.shownResultsEmphasisGeometries.push(at)}else this.clearFeatureEmphasis(c)}clearFeatureEmphasis(Y){"focused"===Y&&this.abstractFocusedResult&&(this.map.searchResultsOverlay.removeFeature(this.abstractFocusedResult),this.abstractFocusedResult=void 0),"selected"===Y&&this.abstractSelectedResult&&(this.map.searchResultsOverlay.removeFeature(this.abstractSelectedResult),this.abstractSelectedResult=void 0),"shown"===Y&&(this.shownResultsEmphasisGeometries.map(c=>this.map.searchResultsOverlay.removeFeature(c)),this.shownResultsEmphasisGeometries=[])}ngOnDestroy(){this.topPanelState$$.unsubscribe(),this.searchTerm$$.unsubscribe(),this.isSelectedResultOutOfView$$&&this.isSelectedResultOutOfView$$.unsubscribe(),this.showResultsGeometries$$&&this.showResultsGeometries$$.unsubscribe(),this.getRoute$$&&this.getRoute$$.unsubscribe(),this.debouncedEmpty$$&&this.debouncedEmpty$$.unsubscribe()}onResultFocus(Y){if(this.focusedResult$.next(Y),Y.meta.dataType===d.YfI&&Y.data.geometry){Y.data.meta.style=(0,d._aW)(Object.assign({},{feature:Y.data},this.searchState.searchOverlayStyleFocus,Y.style?.focus?Y.style.focus:{}));const c=this.map.searchResultsOverlay.dataSource.ol.getFeatureById(Y.meta.id);if(c)return void c.setStyle(Y.data.meta.style);this.map.searchResultsOverlay.addFeature(Y.data,this.searchState.featureMotion.focus)}}onResultUnfocus(Y){if(this.focusedResult$.next(void 0),Y.meta.dataType===d.YfI){if(!0===this.store.state.get(Y).selected){const c=this.map.searchResultsOverlay.dataSource.ol.getFeatureById(Y.meta.id);if(c){const C=(0,d._aW)(Object.assign({},{feature:Y.data},this.searchState.searchOverlayStyleFocus,Y.style?.focus?Y.style.focus:{}));c.setStyle(C)}return}this.map.searchResultsOverlay.removeFeature(Y.data)}}onResultSelect(Y){if(this.map.searchResultsOverlay.dataSource.ol.clear(),this.tryAddFeatureToMap(Y,this.searchState.featureMotion.selected),this.searchState.setSelectedResult(Y),"initial"===this.topPanelState&&(this.topPanelState="collapsed"!==this.topPanelStateDefault?"expanded":"collapsed"),"expanded"===this.topPanelState){const c=this.computeElementRef()[0],C=this.computeElementRef()[1];this.isScrolledIntoView(c,C)||this.adjustTopPanel(c,C)}}onSearch(Y){const c=Y.results,C=this.store.entities$.value.filter($=>$.source!==Y.research.source).concat(c);this.store.load(C);for(const $ of this.store.all())!0===this.store.state.get($).focused&&!0!==this.store.state.get($).selected&&this.store.state.update($,{focused:!1},!0);setTimeout(()=>{const $=this.elRef.nativeElement.querySelector("igo-list");let re;Y.research.request.subscribe(Ce=>{re=Ce[0]&&Ce[0].source?"icherche"===Ce[0].source.getId()?$.querySelector(".icherche .moreResults"):"ilayer"===Ce[0].source.getId()?$.querySelector(".ilayer .moreResults"):"nominatim"===Ce[0].source.getId()?$.querySelector(".nominatim .moreResults"):$.querySelector("."+Ce[0].source.getId()+" .moreResults"):null,null!==re&&!this.isScrolledIntoView($,re)&&($.scrollTop=re.offsetTop+re.offsetHeight-$.clientHeight)})},250)}computeElementRef(){const Y=document.getElementsByTagName("igo-search-results-item"),c=this.elRef.nativeElement.getElementsByTagName("igo-list")[0];let C;for(let $=0;$<Y.length;$++)Y[$].className.includes("igo-list-item-selected")&&(C=Y[$]);return[c,C]}adjustTopPanel(Y,c){this.isScrolledIntoView(Y,c)||(Y.scrollTop=c.offsetTop+c.children[0].offsetHeight-Y.clientHeight)}toggleTopPanel(Y){Y&&"igo-panel-title"!==Y.target?.className||(this.topPanelState="expanded"===this.topPanelState?"collapsed":"expanded")}zoomToFeatureExtent(){if(this.feature.geometry){const Y=this.format.readFeature(this.feature,{dataProjection:this.feature.projection,featureProjection:this.map.projectionCode});(0,d.QX5)(this.map.viewController,[Y],d.Suj.Zoom)}}tryAddFeatureToMap(Y,c=d.Suj.Default){if(Y.meta.dataType!==d.YfI)return;const C=Y.data;C.geometry&&(C.meta.style=(0,d._aW)(Object.assign({},{feature:C},this.searchState.searchOverlayStyleSelection,Y.style?.selection?Y.style.selection:{})),this.map.searchResultsOverlay.addFeature(C,c))}isScrolledIntoView(Y,c){const $=Y.scrollTop,Ce=c.offsetTop;return Ce+c.clientHeight+6<=$+Y.clientHeight&&Ce>=$}getRoute(){this.toolState.toolbox.activateTool("directions"),this.directionState.stopsStore.clearStops(),setTimeout(()=>{let Y=!1;this.getRoute$$&&this.getRoute$$.unsubscribe(),this.getRoute$$=this.directionState.stopsStore.storeInitialized$.subscribe(c=>{if(this.directionState.stopsStore.storeInitialized$.value&&!Y){Y=!0;const C=this.directionState.stopsStore.all().find(re=>1===re.position);let $;if(this.feature.geometry)if("Point"===this.feature.geometry.type)$=[this.feature.geometry.coordinates[0],this.feature.geometry.coordinates[1]];else{const re=(0,Wn.c)(this.feature.geometry);$=[re.geometry.coordinates[0],re.geometry.coordinates[1]]}if(C.text=this.featureTitle,C.coordinates=$,this.directionState.stopsStore.update(C),this.map.geolocationController.position$.value){const re=this.map.geolocationController.position$.value,Ce=this.directionState.stopsStore.all().find(at=>0===at.position),Ve=ve.AF(re.position,re.projection,"EPSG:4326"),nt=(0,d.uEw)([Ve[0],Ve[1]],6);Ce.text=nt.join(","),Ce.coordinates=nt,this.directionState.stopsStore.update(Ce)}}})},250)}static \u0275fac=function(c){return new(c||ea)(o.GI1(mt),o.GI1($o),o.GI1(o.GMv),o.GI1(zt),o.GI1(_t),o.GI1(ze.aW))};static \u0275cmp=o.In1({type:ea,selectors:[["igo-search-results-tool"]],inputs:{showIcons:"showIcons",topPanelStateDefault:"topPanelStateDefault",topPanelState:"topPanelState"},standalone:!0,features:[o.UHJ],decls:4,vars:6,consts:[["style","margin: 10px",4,"ngIf"],["initial","100%","initialMobile","100%","collapsed","calc(100% - 58px)","collapsedMobile","calc(100% - 58px)","expanded","60%","expandedMobile","60%",3,"state",4,"ngIf"],[2,"margin","10px"],[1,"mat-typography"],[3,"innerHTML"],["initial","100%","initialMobile","100%","collapsed","calc(100% - 58px)","collapsedMobile","calc(100% - 58px)","expanded","60%","expandedMobile","60%",3,"state"],["topPanel",""],[1,"igo-content"],["placeholder","false",3,"store","showIcons","term","termSplitter","settingsChange$","map","resultFocus","resultSelect","resultUnfocus","resultMouseenter","resultMouseleave","moreResults"],["igoSearchItemToolbar",""],["igoFlexibleFill","",1,"igo-content"],[3,"title","cursorPointer","click",4,"ngIf"],[3,"map","store","stores","layer","saveSearchResultInLayer"],[3,"title","cursorPointer","click"],["mat-icon-button","","panelLeftButton","",1,"igo-icon-button",3,"click"],[3,"svgIcon"],["mat-icon-button","","panelRightButton","","class","igo-icon-button","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["igoFeatureDetailsDirective","",3,"feature","map","toolbox","routingEvent"],["mat-icon-button","","panelRightButton","","matTooltipShowDelay","500",1,"igo-icon-button",3,"matTooltip","click"],["aria-hidden","false","matBadgeColor","accent","matBadgeSize","small","svgIcon","magnify-plus-outline",3,"matBadge","matBadgeHidden"]],template:function(c,C){1&c&&(o.yuY(0,ho,13,11,"div",0),o.wVc(1,"async"),o.yuY(2,ir,10,12,"igo-flexible",1),o.wVc(3,"async")),2&c&&(o.E7m("ngIf",(!C.store||C.store.stateView.empty)&&o.kDX(1,2,C.debouncedEmpty$)),o.yG2(2),o.E7m("ngIf",!1===o.kDX(3,4,C.debouncedEmpty$)))},dependencies:[L.u_,y.Kg,d.kBh,d.qE2,y.cP,N.oJ,N.um,Le.oB,Le.qL,Se.KO,Se.a4,Xi.g,Xi.S,d.wP$,L.a,Dt.O0,Dt.sD,y.Ux],encapsulation:2,changeDetection:0})};Nn=(0,Ke.UN)([(0,y.aA)({name:"searchResults",title:"igo.integration.tools.searchResults",icon:"magnify"}),(0,Ke.YR)("design:paramtypes",[mt,$o,o.GMv,zt,_t,ze.aW])],Nn);var te=s(58136),me=s(87004);function ke(J,Y){1&J&&o.wR5(0,"igo-form-field",8),2&J&&o.E7m("field",Y.$implicit)}function Qe(J,Y){if(1&J&&(o.I0R(0,"div",6),o.yuY(1,ke,1,1,"igo-form-field",7),o.C$Y()),2&J){const c=o.GaO().ngIf;o.yG2(),o.E7m("ngForOf",c.fields)}}function co(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"igo-form",1),o.qCj("submitForm",function($){o.usT(c);const re=o.GaO();return o.CGJ(re.onSubmit($))}),o.wVc(1,"async"),o.yuY(2,Qe,2,1,"div",2),o.I0R(3,"div",3)(4,"button",4),o.qCj("click",function(){o.usT(c);const $=o.GaO();return o.CGJ($.clearForm())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y(),o.I0R(7,"button",5),o.OEk(8),o.wVc(9,"translate"),o.C$Y()()()}if(2&J){const c=Y.ngIf,C=o.GaO();o.E7m("form",c)("formData",o.kDX(1,6,C.data$)),o.yG2(2),o.E7m("ngIf",c.fields.length),o.yG2(3),o.oRS(" ",o.kDX(6,8,"igo.integration.dataIssueReporterTool.reset.button")," "),o.yG2(2),o.E7m("disabled",C.submitDisabled),o.yG2(),o.oRS(" ",o.kDX(9,10,"igo.integration.dataIssueReporterTool.submit.button")," ")}}let ni=class ta{mapState;formService;languageService;messageService;httpClient;url;get map(){return this.mapState.map}form$=new W.g(void 0);data$=new W.g(void 0);submitDisabled=!0;valueChanges$$;constructor(Y,c,C,$,re){this.mapState=Y,this.formService=c,this.languageService=C,this.messageService=$,this.httpClient=re}ngOnInit(){(0,Qt.E)([this.languageService.language$,this.map.layers$]).subscribe(([Y,c])=>{const C=c.filter(Ve=>Ve.baseLayer||Ve.showInLayerList).map(Ve=>({value:`${Ve.title}-${Ve.id}`,title:Ve.title})),re=[{name:"geometry",title:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.geometry"),type:"geometry",inputs:{map:this.map,geometryTypeField:!0,geometryType:"Polygon",drawGuideField:!1,drawGuide:0,drawGuidePlaceholder:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.drawGuidePlaceholder"),drawStyle:new B.cp({stroke:new X.c({color:[255,0,0,1],width:2}),fill:new V.c({color:[255,0,0,.2]}),image:new z.c({radius:8,stroke:new X.c({color:[255,0,0,1]}),fill:new V.c({color:[255,0,0,.2]})})}),overlayStyle:new B.cp({stroke:new X.c({color:[0,255,0,1],width:2}),fill:new V.c({color:[0,255,0,.2]}),image:new z.c({radius:8,stroke:new X.c({color:[0,255,0,1]}),fill:new V.c({color:[0,255,0,.2]})})})}},{name:"layer",title:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.layer"),type:"select",options:{cols:2},inputs:{choices:C}},{name:"desc",title:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.description"),type:"textarea",options:{validator:oe.AQ.required}},{name:"email",title:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.email"),options:{validator:oe.AQ.email}}].map(Ve=>this.formService.field(Ve)),Ce=this.formService.form(re,[]);this.valueChanges$$=Ce.control.valueChanges.subscribe(()=>{this.submitDisabled=!Ce.control.valid}),this.form$.next(Ce)})}ngOnDestroy(){this.valueChanges$$.unsubscribe()}clearForm(){this.form$.value.control.reset()}onSubmit(Y){const c="igo.integration.dataIssueReporterTool.submit.title";this.url?(this.httpClient.post(this.url,Y).subscribe(()=>{this.messageService.success("igo.integration.dataIssueReporterTool.submit.message",c)}),this.clearForm()):(this.messageService.alert("igo.integration.dataIssueReporterTool.submit.setupMessage",c),alert(JSON.stringify(Y)))}static \u0275fac=function(c){return new(c||ta)(o.GI1(mt),o.GI1(y.eO),o.GI1(St.ov),o.GI1(Zt.mi),o.GI1(yt.KK))};static \u0275cmp=o.In1({type:ta,selectors:[["igo-issue-reporter-tool"]],inputs:{url:"url"},decls:2,vars:3,consts:[[3,"form","formData","submitForm",4,"ngIf"],[3,"form","formData","submitForm"],["class","form-container",4,"ngIf"],["formButtons","",1,"actions-container"],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"],[1,"form-container"],[3,"field",4,"ngFor","ngForOf"],[3,"field"]],template:function(c,C){1&c&&(o.yuY(0,co,10,12,"igo-form",0),o.wVc(1,"async")),2&c&&o.E7m("ngIf",o.kDX(1,1,C.form$))},dependencies:[L.ay,L.u_,N.Gw,te._,me.Y,L.a,Dt.sD],styles:["[_nghost-%COMP%]   .actions-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(:last-child){margin-right:8px}[_nghost-%COMP%]   .form-container[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .form-container[_ngcontent-%COMP%]   igo-form-field[_ngcontent-%COMP%]{display:block;height:auto}"]})};ni=(0,Ke.UN)([(0,y.aA)({name:"dataIssueReporter",title:"igo.integration.tools.dataIssueReporter",icon:"message-alert"}),(0,Ke.YR)("design:paramtypes",[mt,y.eO,St.ov,Zt.mi,yt.KK])],ni);var $r=s(8636),Ar=s(69800),Hn=s(8408),zn=s(71320);const nr=["mapBrowser"];function kr(J,Y){if(1&J&&(o.I0R(0,"span",12),o.OEk(1),o.C$Y()),2&J){const c=o.GaO();o.yG2(),o.oRS(" Pointer activated: ",c.igoSearchPointerSummaryEnabled," (F2 activate/deactivate the pointer location). ")}}function Br(J,Y){if(1&J&&o.wR5(0,"igo-search-add-button",13),2&J){const c=Y.result,C=o.GaO();o.E7m("map",C.map)("layer",c)}}function ri(J,Y){if(1&J&&(o.I0R(0,"igo-panel",12),o.wR5(1,"igo-feature-details",14),o.C$Y()),2&J){const c=o.GaO();o.yG2(),o.E7m("feature",c.selectedFeature)}}function Ci(J,Y){if(1&J&&o.wR5(0,"igo-actionbar",15),2&J){const c=o.GaO();o.E7m("store",c.store)("withIcon",!1)("horizontal",!0)("mode",c.actionBarMode)}}const Ao=()=>["ConfigService","LanguageService"];let Pi=(()=>{class J{mapService;layerService;searchState;mediaService;storageService;store=new y.MF([]);actionBarMode=y.m0.Context;igoSearchPointerSummaryEnabled=!1;termSplitter="|";map=new d.yGW({overlay:!0,controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};mapBrowser;lonlat;mapProjection;term;settingsChange$=new W.g(void 0);get searchStore(){return this.searchState.store}get isTouchScreen(){return this.mediaService.isTouchScreen()}selectedFeature;igoReverseSearchCoordsFormatEnabled;constructor(c,C,$,re,Ce){this.mapService=c,this.layerService=C,this.searchState=$,this.mediaService=re,this.storageService=Ce,this.mapService.setMap(this.map),this.layerService.createAsyncLayer({title:"OSM",baseLayer:!0,visible:!0,sourceOptions:{type:"osm"}}).subscribe(Ve=>this.map.addLayer(Ve)),this.igoReverseSearchCoordsFormatEnabled=!!this.storageService.get("reverseSearchCoordsFormatEnabled")||!1}onPointerSummaryStatusChange(c){this.igoSearchPointerSummaryEnabled=c}onSearchTermChange(c){this.term=c,this.searchState.setSearchTerm(c),c.replace(/(#[^\s]*)/g,"").trim().length<2&&(this.searchStore.clear(),this.selectedFeature=void 0)}onSearch(c){const C=c.results;this.searchStore.state.updateAll({focused:!1,selected:!1});const $=this.searchStore.entities$.value.filter(re=>re.source!==c.research.source).concat(C);this.searchStore.updateMany($)}onReverseCoordsFormatStatusChange(c){this.storageService.set("reverseSearchCoordsFormatEnabled",c),this.igoReverseSearchCoordsFormatEnabled=c}onSearchSettingsChange(){this.settingsChange$.next(!0)}onResultFocus(c){this.tryAddFeatureToMap(c,this.searchState.featureMotion.focus),this.selectedFeature=c.data}onResultSelect(c){this.tryAddFeatureToMap(c,this.searchState.featureMotion.selected),this.selectedFeature=c.data}tryAddFeatureToMap(c,C=d.Suj.Default){c.meta.dataType===d.YfI&&void 0!==c.data.geometry&&this.map.searchResultsOverlay.setFeatures([c.data],C)}ngOnInit(){this.store.load([{id:"coordinates",title:"coordinates",handler:()=>this.searchCoordinate(this.lonlat)},{id:"googleMaps",title:"googleMap",handler:()=>this.openGoogleMaps(this.lonlat)},{id:"googleStreetView",title:"googleStreetView",handler:()=>this.openGoogleStreetView(this.lonlat)}])}ngOnDestroy(){this.store.destroy()}removeFeatureFromMap(){this.map.searchResultsOverlay.clear()}onContextMenuOpen(c){const C=this.mapPosition(c),$=this.mapService.getMap().ol.getCoordinateFromPixel(C);this.mapProjection=this.mapService.getMap().projectionCode,this.lonlat=ve.AF($,this.mapProjection,"EPSG:4326")}mapPosition(c){const C=c;return C.y=C.y-this.mapBrowser.nativeElement.getBoundingClientRect().top+window.scrollY,C.x=C.x-this.mapBrowser.nativeElement.getBoundingClientRect().left+window.scrollX,[C.x,C.y]}searchCoordinate(c){this.searchStore.clear(),this.term=this.igoReverseSearchCoordsFormatEnabled?c.reverse().map(C=>C.toFixed(6)).join(", "):c.map(C=>C.toFixed(6)).join(", ")}openGoogleMaps(c){window.open(d.s9F.getGoogleMapsCoordLink(c[0],c[1]))}openGoogleStreetView(c){window.open(d.s9F.getGoogleStreetViewLink(c[0],c[1]))}static \u0275fac=function(C){return new(C||J)(o.GI1(d.u00),o.GI1(d.IZ6),o.GI1($o),o.GI1(_.QB),o.GI1(e.yQ))};static \u0275cmp=o.In1({type:J,selectors:[["app-search"]],viewQuery:function(C,$){if(1&C&&o.CC$(nr,7,o.GMv),2&C){let re;o.wto(re=o.Gqi())&&($.mapBrowser=re.first)}},standalone:!0,features:[o.M5G([d._wi,(0,d.qED)(),(0,d.iew)(),(0,d.yCe)(),(0,d.kzx)()]),o.UHJ],decls:15,vars:19,consts:[["title","Search","subtitle","Geo",3,"dependencies"],["codeFolder","geo/search","configFolder","environments"],["title","Details",4,"ngIf"],["igoOverlay","","igoLongPress","","igoSearchPointerSummary","",3,"map","view","igoContextMenu","igoSearchPointerSummaryDelay","igoSearchPointerSummaryEnabled","menuPosition"],["mapBrowser",""],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["title","Search"],[3,"term","searchSettings","store","termSplitter","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchTermChange","search","clearFeature","searchSettingsChange","reverseSearchCoordsFormatStatus"],["placeholder","false",3,"store","term","termSplitter","settingsChange$","resultFocus","resultSelect","moreResults"],["igoSearchItemToolbar",""],["actionbarMenu",""],["title","Details"],[3,"map","layer"],[3,"feature"],[3,"store","withIcon","horizontal","mode"]],template:function(C,$){if(1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1),o.yuY(2,kr,2,1,"span",2),o.I0R(3,"igo-map-browser",3,4),o.qCj("menuPosition",function(Ce){return $.onContextMenuOpen(Ce)}),o.I0R(5,"div",5),o.wR5(6,"igo-zoom-button",6),o.C$Y()(),o.I0R(7,"igo-panel",7)(8,"igo-search-bar",8),o.qCj("pointerSummaryStatus",function(Ce){return $.onPointerSummaryStatusChange(Ce)})("searchTermChange",function(Ce){return $.onSearchTermChange(Ce)})("search",function(Ce){return $.onSearch(Ce)})("clearFeature",function(){return $.removeFeatureFromMap()})("searchSettingsChange",function(){return $.onSearchSettingsChange()})("reverseSearchCoordsFormatStatus",function(Ce){return $.onReverseCoordsFormatStatusChange(Ce)}),o.C$Y(),o.I0R(9,"igo-search-results",9),o.qCj("resultFocus",function(Ce){return $.onResultFocus(Ce)})("resultSelect",function(Ce){return $.onResultSelect(Ce)})("moreResults",function(Ce){return $.onSearch(Ce)}),o.yuY(10,Br,1,2,"ng-template",null,10,o.gJz),o.C$Y()(),o.yuY(12,ri,2,1,"igo-panel",2)(13,Ci,1,4,"ng-template",null,11,o.gJz),o.C$Y()()),2&C){const re=o.Gew(14);o.E7m("dependencies",o.q4q(18,Ao)),o.yG2(2),o.E7m("ngIf",!$.isTouchScreen),o.yG2(),o.E7m("map",$.map)("view",$.view)("igoContextMenu",re)("igoSearchPointerSummaryDelay",500)("igoSearchPointerSummaryEnabled",$.igoSearchPointerSummaryEnabled),o.yG2(3),o.E7m("map",$.map),o.yG2(2),o.E7m("term",$.term)("searchSettings",!0)("store",$.searchStore)("termSplitter",$.termSplitter)("reverseSearchCoordsFormatEnabled",$.igoReverseSearchCoordsFormatEnabled),o.yG2(),o.E7m("store",$.searchStore)("term",$.term)("termSplitter",$.termSplitter)("settingsChange$",$.settingsChange$),o.yG2(3),o.E7m("ngIf",$.selectedFeature)}},dependencies:[g.u,R.I,L.u_,d.q2F,d.qcl,y.L0,y.SM,d.Oy$,$r.A,Ar.T,Hn.q,zn.k,y.cP,y.AI,d.wP$],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{height:100%;width:100%;padding-top:10px}"]})}return J})();function bo(J,Y){if(1&J&&(o.I0R(0,"p"),o.OEk(1),o.C$Y()),2&J){const c=o.GaO();o.yG2(),o.cNF(c.pointerCoord)}}const wo=()=>["LanguageService"];let Ro=(()=>{class J{dataSourceService;layerService;mediaService;pointerCoord;pointerCoordDelay=0;map=new d.yGW({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:6,rotation:.75};get media(){return this.mediaService.getMedia()}get isTouchScreen(){return this.mediaService.isTouchScreen()}constructor(c,C,$){this.dataSourceService=c,this.layerService=C,this.mediaService=$,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(re=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:re,visible:!0,baseLayer:!0}))})}onPointerMove(c){this.pointerCoord=c}static \u0275fac=function(C){return new(C||J)(o.GI1(d.OEM),o.GI1(d.IZ6),o.GI1(_.QB))};static \u0275cmp=o.In1({type:J,selectors:[["app-simple-map"]],standalone:!0,features:[o.UHJ],decls:13,vars:12,consts:[["title","Simple Map","subtitle","Geo",3,"dependencies"],["codeFolder","geo/simple-map"],["igoPointerPosition","",3,"map","view","pointerPositionDelay","pointerPositionCoord"],[3,"infoContent"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"],[4,"ngIf"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),o.qCj("pointerPositionCoord",function(Ce){return $.onPointerMove(Ce)}),o.wR5(3,"igo-info-section",3),o.I0R(4,"div",4),o.wR5(5,"div",5)(6,"igo-rotation-button",6),o.C$Y(),o.I0R(7,"div",7),o.wR5(8,"igo-home-extent-button",8)(9,"igo-wake-lock-button")(10,"igo-geolocate-button",8)(11,"igo-zoom-button",9),o.C$Y()(),o.yuY(12,bo,2,1,"p",10),o.C$Y()()),2&C&&(o.E7m("dependencies",o.q4q(11,wo)),o.yG2(2),o.E7m("map",$.map)("view",$.view)("pointerPositionDelay",$.pointerCoordDelay),o.yG2(),o.E7m("infoContent",null==$.pointerCoord?null:$.pointerCoord.toString()),o.yG2(3),o.E7m("showIfNoRotation",!0)("map",$.map),o.yG2(2),o.E7m("map",$.map),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(),o.E7m("ngIf",!$.isTouchScreen))},dependencies:[g.u,R.I,d.cdH,d.eqy,d.Y1E,d.q2F,d.knT,d.i6P,d.w16,d.qcl,L.u_],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:350px}"]})}return J})();function Ur(J,Y){if(1&J&&(o.SAx(0),o.wR5(1,"igo-feature-details",11),o.k70()),2&J){const c=Y.ngIf;o.yG2(),o.E7m("feature",c)}}const rr=()=>["LanguageService"];let Yr=(()=>{class J{matIconRegistry;spatialFilterService;dataSourceService;layerService;messageService;languageService;cdRef;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};type;itemType=d.c97.Address;freehandDrawIsActive;layers=[];activeLayers=[];queryType;thematics;zone;zoneWithBuffer;buffer=0;iterator=1;selectedFeature$=new W.g(void 0);format=new li.c;store=new y.qc([]);spatialListStore=new y.qc([]);loading=!1;thematicLength=0;measureUnit=d.K88.Meters;unsubscribe$=new w.E;defaultStyle;constructor(c,C,$,re,Ce,Ve,nt){this.matIconRegistry=c,this.spatialFilterService=C,this.dataSourceService=$,this.layerService=re,this.messageService=Ce,this.languageService=Ve,this.cdRef=nt,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(at=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:at,baseLayer:!0,visible:!0}))})}ngOnInit(){for(const c of this.map.layers)c.title&&c.title.includes(this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"))&&this.layers.push(c)}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}getOutputType(c){this.type=c,this.queryType=void 0}getOutputQueryType(c){this.queryType=c,this.queryType&&this.loadFilterList()}loadFilterList(){this.spatialFilterService.loadFilterList(this.queryType).pipe((0,Zo.a)(this.unsubscribe$)).subscribe(c=>{c.sort((C,$)=>C.properties.nom<$.properties.nom?-1:C.properties.nom>$.properties.nom?1:0),this.spatialListStore.clear(),this.spatialListStore.load(c)})}getOutputToggleSearch(){this.loadThematics()}getOutputClearSearch(){this.zone=void 0,this.queryType=void 0}clearMap(){this.map.removeLayers(this.layers),this.layers=[],this.activeLayers=[],this.thematicLength=0,this.iterator=1,this.type===d._cQ.Predefined&&(this.zone=void 0,this.queryType=void 0)}loadThematics(){this.loading=!0;let C,c=!0;(0===this.buffer||this.type===d._cQ.Point)&&this.tryAddFeaturesToMap([this.zone]),C=this.itemType!==d.c97.Thematics?[{name:""}]:this.thematics,this.measureUnit===d.K88.Kilometers&&this.type!==d._cQ.Point&&(this.buffer=1e3*this.buffer),this.type===d._cQ.Polygon&&(this.buffer=0);const $=[];C.forEach(re=>{$.push(this.spatialFilterService.loadFilterItem(this.zone,this.itemType,this.queryType,re,this.buffer).pipe((0,ci.y)(Ce=>{this.store.insertMany(Ce);const Ve=[],nt=[];let at,wt;Ce.forEach(Wt=>{Wt.geometry.type===d._cQ.Point?(Wt.properties.longitude=Wt.geometry.coordinates[0],Wt.properties.latitude=Wt.geometry.coordinates[1],Ve.push(Wt),at=Wt.meta.id):(nt.push(Wt),wt=Wt.meta.id)}),this.tryAddPointToMap(Ve,at),this.tryAddLayerToMap(nt,wt),Ce.length?(c=!1,this.thematicLength+=1,re.zeroResults=!1,this.cdRef.detectChanges()):re.zeroResults=!0,Ce.length>=1e4&&this.messageService.alert("igo.geo.spatialFilter.maxSizeAlert","igo.geo.spatialFilter.warning",{timeOut:1e4})})))}),(0,$i.y)($).pipe((0,Zo.a)(this.unsubscribe$)).subscribe(()=>{this.loading=!1,c&&this.messageService.alert("igo.geo.spatialFilter.zeroResults","igo.geo.spatialFilter.warning",{timeOut:1e4})})}onZoneChange(c,C){this.zone=c,c&&(C?this.tryAddFeaturesToMap([c],!0):this.tryAddFeaturesToMap([c]),this.zoomToFeatureExtent(c))}tryAddFeaturesToMap(c,C){let $=1;for(const re of c){if(this.type===d._cQ.Predefined)for(const Ce of this.layers){if(Ce.options._internal&&Ce.options._internal.code===re.properties.code&&!C){if(!Ce.title?.startsWith("Zone")){const Ve=this.layers.indexOf(Ce);this.layers.splice(Ve,1)}return}if(Ce.title?.startsWith("Zone")){this.activeLayers=[];const Ve=this.layers.indexOf(Ce);this.layers.splice(Ve,1),this.map.removeLayer(Ce)}}else{if(C)for(const Ce of this.activeLayers)if(1===this.activeLayers.length&&Ce.title?.startsWith("Zone")){const Ve=this.layers.indexOf(Ce);this.layers.splice(Ve,1),this.map.removeLayer(Ce)}this.activeLayers=[]}for(const Ce of this.layers)Ce.title?.startsWith("Zone")&&$++;this.defaultStyle=(Ce,Ve)=>{const nt=c[0].geometry.coordinates;return new B.cp({image:new z.c({radius:nt?this.buffer/Math.cos(Math.PI/180*nt[1])/Ve:void 0,fill:new V.c({color:"rgba(200, 200, 20, 0.2)"}),stroke:new X.c({width:1,color:"orange"})}),stroke:new X.c({width:1,color:"orange"}),fill:new V.c({color:"rgba(200, 200, 20, 0.2)"})})},this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,ao.U)(1)).subscribe(Ce=>{const Ve=this.layerService.createLayer({isIgoInternalLayer:!0,title:"Zone "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),workspace:{enabled:!0},_internal:{code:this.type===d._cQ.Predefined?re.properties.code:void 0},source:Ce,visible:!0}),nt=c.map(wt=>(0,d.K6O)(wt,this.map.projectionCode));if(this.type!==d._cQ.Predefined){const wt=this.type===d._cQ.Point?"Cercle":"Polygone";nt[0].set("nom","Zone",!0),nt[0].set("type",wt,!0)}Ce.ol.addFeatures(nt),Ve.ol.setStyle(this.defaultStyle),this.map.addLayer(Ve),this.layers.push(Ve),this.activeLayers.push(Ve),this.cdRef.detectChanges()})}}tryAddPointToMap(c,C){let $=1;if(c.length){if(void 0===this.map)return;for(const re of this.layers)re.title?.startsWith(c[0].meta.title)&&$++;this.dataSourceService.createAsyncDataSource({type:"cluster",id:C,queryable:!0,distance:120,meta:{title:"Cluster"}}).pipe((0,ao.U)(1)).subscribe(re=>{const Ce=c[0].meta.icon;let Ve;Ve=Ce&&this.createSvgIcon(Ce)||(0,d.o5m)();const nt=this.layerService.createLayer({isIgoInternalLayer:!0,title:c[0].meta.title+" "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:re,visible:!0,style:Ve}),at=c.map(Wt=>(0,d.K6O)(Wt,this.map.projectionCode));re.ol.getSource().addFeatures(at),this.layers.find(Wt=>Wt.id===nt.id)&&(this.map.removeLayer(this.layers.find(Wt=>Wt.id===nt.id)),$-=1,nt.title=c[0].meta.title+" "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),nt.options.title=nt.title),this.iterator=$,this.map.addLayer(nt),this.layers.push(nt),this.pushLayer(nt),this.cdRef.detectChanges()})}}createSvgIcon(c){let C;return this.matIconRegistry.getNamedSvgIcon(c).subscribe($=>{const re=new XMLSerializer;$.setAttribute("width","30"),$.setAttribute("height","30"),$.setAttribute("fill","rgba(0, 128, 255)"),$.setAttribute("stroke","white");const Ce=re.serializeToString($);C=new B.cp({image:new Gi.c({src:"data:image/svg+xml;utf8,"+Ce})})}),C}tryAddLayerToMap(c,C){let $=1;if(c.length){if(void 0===this.map)return;for(const re of this.layers)re.title?.startsWith(c[0].meta.title)&&$++;this.dataSourceService.createAsyncDataSource({type:"vector",id:C,queryable:!0}).pipe((0,ao.U)(1)).subscribe(re=>{const Ce=this.layerService.createLayer({isIgoInternalLayer:!0,title:c[0].meta.title+" "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:re,visible:!0}),Ve=c.map(at=>(0,d.K6O)(at,this.map.projectionCode));re.ol.addFeatures(Ve),this.layers.find(at=>at.id===Ce.id)&&(this.map.removeLayer(this.layers.find(at=>at.id===Ce.id)),$-=1,Ce.title=c[0].meta.title+" "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),Ce.options.title=Ce.title),this.map.addLayer(Ce),this.layers.push(Ce),this.pushLayer(Ce),this.cdRef.detectChanges()})}}zoomToFeatureExtent(c){if(c){const C=this.format.readFeature(c,{dataProjection:c.projection,featureProjection:this.map.projectionCode});(0,d.QX5)(this.map.viewController,[C],d.Suj.Zoom)}}pushLayer(c){for(const C of this.activeLayers)if(C.id===c.id)return;this.activeLayers.push(c)}static \u0275fac=function(C){return new(C||J)(o.GI1(Le.iK),o.GI1(d.kjd),o.GI1(d.OEM),o.GI1(d.IZ6),o.GI1(Zt.mi),o.GI1(St.ov),o.GI1(o.kD9))};static \u0275cmp=o.In1({type:J,selectors:[["app-spatial-filter"]],inputs:{type:"type",itemType:"itemType",freehandDrawIsActive:"freehandDrawIsActive"},standalone:!0,features:[o.UHJ],decls:15,vars:22,consts:[["title","Spatial Filter","subtitle","Geo",3,"dependencies"],["codeFolder","geo/spatial-filter"],["cols","2","rowHeight","500px","gutterSize","16px"],["igoOverlay","","igoQuery","",3,"map","view","queryFeatures"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","flex-col","align-start","h-100","w-100","overflow-y-auto"],[1,"w-100"],[3,"store","selectedQueryType","zone","layers","eventType","eventQueryType","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange"],[3,"type","queryType","map","zone","loading","store","layers","allLayers","thematicLength","radiusEvent","bufferEvent","measureUnitChange","freehandControl","drawZoneEvent","zoneWithBufferChange","itemTypeChange","thematicChange","toggleSearch","clearButtonEvent","clearSearchEvent"],[4,"ngIf"],[3,"feature"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"igo-zoom-button",5),o.C$Y()()(),o.I0R(7,"mat-grid-tile")(8,"div",6)(9,"igo-panel",7)(10,"igo-spatial-filter-type",8),o.qCj("eventType",function(Ce){return $.getOutputType(Ce)})("eventQueryType",function(Ce){return $.getOutputQueryType(Ce)})("zoneChange",function(Ce){return $.onZoneChange(Ce)})("zoneWithBufferChange",function(Ce){return $.onZoneChange(Ce,!0)})("bufferChange",function(Ce){return $.buffer=Ce})("measureUnitChange",function(Ce){return $.measureUnit=Ce}),o.C$Y(),o.I0R(11,"igo-spatial-filter-item",9),o.qCj("radiusEvent",function(Ce){return $.buffer=Ce})("bufferEvent",function(Ce){return $.buffer=Ce})("measureUnitChange",function(Ce){return $.measureUnit=Ce})("freehandControl",function(Ce){return $.freehandDrawIsActive=Ce})("drawZoneEvent",function(Ce){return $.zone=Ce})("zoneWithBufferChange",function(Ce){return $.onZoneChange(Ce,!0)})("itemTypeChange",function(Ce){return $.itemType=Ce})("thematicChange",function(Ce){return $.thematics=Ce})("toggleSearch",function(){return $.getOutputToggleSearch()})("clearButtonEvent",function(){return $.clearMap()})("clearSearchEvent",function(){return $.getOutputClearSearch()}),o.C$Y()(),o.I0R(12,"igo-panel",7),o.yuY(13,Ur,2,1,"ng-container",10),o.wVc(14,"async"),o.C$Y()()()()()()),2&C&&(o.E7m("dependencies",o.q4q(21,rr)),o.yG2(4),o.E7m("map",$.map)("view",$.view)("queryFeatures",!0),o.yG2(2),o.E7m("map",$.map),o.yG2(4),o.E7m("store",$.spatialListStore)("selectedQueryType",$.queryType)("zone",$.zone)("layers",$.activeLayers),o.yG2(),o.E7m("type",$.type)("queryType",$.queryType)("map",$.map)("zone",$.zone)("loading",$.loading)("store",$.store)("layers",$.activeLayers)("allLayers",$.layers)("thematicLength",$.thematicLength),o.yG2(2),o.E7m("ngIf",o.kDX(14,19,$.selectedFeature$)))},dependencies:[g.u,R.I,x.CQ,x.ae,x.cn,d.q2F,d.qcl,d.G_h,$e.s,y.cP,d.K4n,d.uu$,L.u_,d.wP$,L.a],styles:["[_nghost-%COMP%]   igo-form[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   igo-spatial-filter-item[_ngcontent-%COMP%]     .thematics-header{max-width:225px}"],changeDetection:0})}return J})();const na=()=>["LanguageService"];let Jt=(()=>{class J{dataSourceService;layerService;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};constructor(c,C){this.dataSourceService=c,this.layerService=C,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(re=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",baseLayer:!0,visible:!0,source:re}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi",params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"},timeFilterable:!0,timeFilter:{min:"2013",max:"2019",range:!1,type:d.U3K.YEAR,style:d.DCK.SLIDER,step:1}}).subscribe(re=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles",source:re}))})}static \u0275fac=function(C){return new(C||J)(o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-time-filter"]],standalone:!0,features:[o.UHJ],decls:11,vars:6,consts:[["title","Time filter","subtitle","Geo",3,"dependencies"],["codeFolder","geo/time-filter"],["cols","2","rowHeight","500px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100"],["title","Layers",1,"w-100"],[3,"layers"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"igo-zoom-button",5),o.C$Y()()(),o.I0R(7,"mat-grid-tile")(8,"div",6)(9,"igo-panel",7),o.wR5(10,"igo-time-filter-list",8),o.C$Y()()()()()()),2&C&&(o.E7m("dependencies",o.q4q(5,na)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(4),o.E7m("layers",$.map.layers))},dependencies:[g.u,R.I,x.CQ,x.ae,x.cn,d.q2F,d.qcl,y.cP,d.gho]})}return J})();var Ct=s(48512);function Ji(J,Y){if(1&J){const c=o.KQA();o.I0R(0,"igo-entity-table-paginator",8),o.qCj("paginatorChange",function($){o.usT(c);const re=o.GaO(2);return o.CGJ(re.paginatorChange($))}),o.C$Y()}if(2&J){const c=o.GaO().ngIf,C=o.GaO();o.E7m("store",c.entityStore)("paginatorOptions",C.paginatorOptions)("entitySortChange$",C.entitySortChange$)}}function Vr(J,Y){if(1&J&&(o.SAx(0),o.yuY(1,Ji,1,3,"igo-entity-table-paginator",7),o.wVc(2,"async"),o.k70()),2&J){const c=Y.ngIf;o.yG2(),o.E7m("ngIf",o.kDX(2,1,c.inResolutionRange$))}}function Do(J,Y){if(1&J&&o.wR5(0,"igo-actionbar",12),2&J){const c=o.GaO().ngIf,C=o.GaO();o.E7m("store",c.actionStore)("horizontal",!0)("withToggleButton",!0)("withTitle",!0)("mode",C.actionbarMode)}}function sr(J,Y){if(1&J&&o.wR5(0,"igo-entity-table",13),2&J){const c=o.GaO().ngIf,C=o.GaO();o.E7m("paginator",C.workspacePaginator)("scrollBehavior",C.scrollBehavior)("store",c.entityStore)("template",c.meta.tableTemplate)}}function ra(J,Y){1&J&&(o.I0R(0,"mat-card-content"),o.OEk(1," No data available at this scale. Please zoom in. "),o.C$Y())}function sa(J,Y){if(1&J&&(o.SAx(0),o.yuY(1,Do,1,5,"igo-actionbar",9)(2,sr,1,4,"igo-entity-table",10),o.wVc(3,"async"),o.yuY(4,ra,2,0,"mat-card-content",6),o.wVc(5,"async"),o.wR5(6,"igo-workspace-widget-outlet",11),o.k70()),2&J){const c=Y.ngIf;o.yG2(),o.E7m("ngIf",c.actionStore),o.yG2(),o.E7m("ngIf",c.entityStore&&c.meta&&c.meta.tableTemplate&&o.kDX(3,4,c.inResolutionRange$)),o.yG2(2),o.E7m("ngIf",!1===o.kDX(5,6,c.inResolutionRange$)),o.yG2(2),o.E7m("workspace",c)}}const gr=[{path:"",redirectTo:"activity",pathMatch:"full"},{title:"Simple map",path:"simple-map",component:Ro},{title:"Layer",path:"layer",component:fe},{title:"Legend",path:"legend",component:ue},{title:"Overlay",path:"overlay",component:He},{title:"Geometry",path:"geometry",component:q},{title:"Feature",path:"feature",component:M},{title:"Hover",path:"hover",component:F},{title:"Measure",path:"measure",component:ge},{title:"Draw",path:"draw",component:K},{title:"Query",path:"query",component:je},{title:"Catalog",path:"catalog",component:j},{title:"Search",path:"search",component:Pi},{title:"Print",path:"print",component:rt},{title:"Import/Export",path:"import-export",component:r},{title:"Directions",path:"directions",component:T},{title:"Time Filter",path:"time-filter",component:Jt},{title:"OGC Filter",path:"ogc-filter",component:Re},{title:"Spatial Filter",path:"spatial-filter",component:Yr},{title:"Workspace",path:"workspace",component:(()=>{class J{dataSourceService;layerService;workspaceState;workspacePaginator;entitySortChange$=new W.g(!1);paginatorOptions={pageSize:5,pageSizeOptions:[1,5,10,15,30,50,100],showFirstLastButtons:!0};map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-72,47.2],zoom:5};get workspaceStore(){return this.workspaceState.store}selectedWorkspace$;actionbarMode=y.m0.Overlay;scrollBehavior=y.qK.Instant;constructor(c,C,$){this.dataSourceService=c,this.layerService=C,this.workspaceState=$}ngOnInit(){this.selectedWorkspace$=this.workspaceStore.stateView.firstBy$(C=>!0===C.state.selected).pipe((0,Io.k)(C=>{const $=void 0===C?void 0:C.entity;return $&&$.actionStore.view.filter(re=>"wfsDownload"!==re.id),$})),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(C=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:C,baseLayer:!0,visible:!0}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{featureTypes:"etablissement_mtq",fieldNameGeometry:"geometry",version:"2.0.0",outputFormat:"geojson"},sourceFields:[{name:"idetablis",alias:"ID"},{name:"nometablis",alias:"Name"},{name:"typetablis",alias:"Type"}]}).subscribe(C=>{this.map.addLayer(this.layerService.createLayer({title:"Simple WFS ",maxResolution:3e3,visible:!0,source:C}))})}paginatorChange(c){this.workspacePaginator=c}static \u0275fac=function(C){return new(C||J)(o.GI1(d.OEM),o.GI1(d.IZ6),o.GI1(ot))};static \u0275cmp=o.In1({type:J,selectors:[["app-workspace"]],standalone:!0,features:[o.UHJ],decls:10,vars:11,consts:[["title","Workspace","subtitle","Geo"],["codeFolder","geo/workspace"],[1,"m-b-16",3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["igoWorkspaceSelector","",3,"store","map"],[4,"ngIf"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange",4,"ngIf"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange"],[3,"store","horizontal","withToggleButton","withTitle","mode",4,"ngIf"],["class","table-compact table-centered",3,"paginator","scrollBehavior","store","template",4,"ngIf"],[3,"workspace"],[3,"store","horizontal","withToggleButton","withTitle","mode"],[1,"table-compact","table-centered",3,"paginator","scrollBehavior","store","template"]],template:function(C,$){1&C&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.wR5(5,"igo-workspace-selector",5),o.yuY(6,Vr,3,3,"ng-container",6),o.wVc(7,"async"),o.yuY(8,sa,7,8,"ng-container",6),o.wVc(9,"async"),o.C$Y()()),2&C&&(o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("store",$.workspaceStore)("map",$.map),o.yG2(),o.E7m("ngIf",o.kDX(7,7,$.selectedWorkspace$)),o.yG2(2),o.E7m("ngIf",o.kDX(9,9,$.selectedWorkspace$)))},dependencies:[L.a,g.u,R.I,y.Eh,y.AI,y.I7,d.ach,d.q2F,d.qcl,y.uF,d.WQ3,y.Qv,Ct.NR,Ct.WK,L.u_],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}igo-entity-table[_ngcontent-%COMP%]{height:400px}igo-actionbar[_ngcontent-%COMP%]{height:48px}"]})}return J})()}]},12445:(Ee,ce,s)=>{"use strict";s.d(ce,{O:()=>e});const e={production:!0,igo:{projections:[{code:"EPSG:32198",alias:"Quebec Lambert",def:"+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs",extent:[-886251.0296,180252.9126,897177.3418,2106143.8139]}],auth:{tokenKey:"testIgo2Lib",intern:{enabled:!0},allowAnonymous:!0},interactiveTour:{tourInMobile:!0,activateInteractiveTour:!0},importExport:{url:"https://geoegl.msp.gouv.qc.ca/apis/ogre"},language:{prefix:"./locale/"},catalog:{sources:[{id:"Gououvert",title:"Gouvouvert",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi"},{id:"DefiningInfoFormat",title:"Defining info_format",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryFormat:{html:"*",json:["stations_meteoroutieres","histo_stations_meteoroutieres"]},queryHtmlTarget:"iframe",count:30},{id:"catalogwithregex",title:"Filtered catalog by regex",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",regFilters:["zpegt"]},{id:"catalogwithtooltipcontrol",title:"Controling tooltip format",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",tooltipType:s(49496).wL1.ABSTRACT}]},monitoring:{provider:"sentry",dsn:"https://examplePublicKey@o0.ingest.sentry.io/0",identifyUser:!0},searchSources:{storedqueriesreverse:{enabled:!1},nominatim:{enabled:!1},icherche:{searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",order:2,enabled:!0,params:{limit:"8"},showAdvancedSettings:!0},coordinatesreverse:{showInPointerSummary:!0},icherchereverse:{showInPointerSummary:!0,searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",order:3,enabled:!0},ilayer:{searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",order:4,enabled:!0,params:{limit:"5"}}}}}},74092:(Ee,ce,s)=>{"use strict";var y=s(33712),e=s(34896),d=s(34672),g=s(50244),R=s(32328),o=s(63916),h=s(18200),j=s(4872),x=s(27e3),w=s(50168),b=s(4786),E=s(57880),T=s(65056),a=s(23302),K=s(83600),M=s(24708),L=s(93020),oe=s(39732),N=s(51672),B=s(20968);let X=(()=>{class Ae{messageService;constructor(je){this.messageService=je}intercept(je,Ke){const yt=je.headers.get("interceptError"),Le=je.clone({headers:je.headers.delete("interceptError")});if("false"===yt)return Ke.handle(Le);const vt={httpError:void 0};return Ke.handle(Le).pipe((0,N.a)(Se=>this.handleError(Se,vt)),(0,B.U)(()=>{const Se=vt.httpError;Se&&(Se.error.toDisplay?this.handleCaughtError(Se):Se.error.caught||this.handleUncaughtError(Se))}))}handleError(je,Ke){if(je instanceof y.gj){const yt="object"===je.error?je.error:{};yt.message=je.error?.message||je.statusText,yt.caught=!1,je=new y.gj({error:yt,headers:je.headers,status:je.status,statusText:je.statusText,url:je.url})}return Ke.httpError=je,(0,oe.c)(je)}handleCaughtError(je){je.error.caught=!0,this.messageService.error(je.error.message,je.error.title,{progressBar:!1})}handleUncaughtError(je){je.error.caught=!0,this.messageService.error("igo.core.errors.uncaught.message","igo.core.errors.uncaught.title",{progressBar:!1})}static \u0275fac=function(Ke){return new(Ke||Ae)(e.CoB(L.mi))};static \u0275prov=e.wxM({token:Ae,factory:Ae.\u0275fac,providedIn:"root"})}return Ae})(),V=(()=>{class Ae{static forRoot(){return{ngModule:Ae,providers:[{provide:y.So,useClass:X,multi:!0}]}}constructor(je){if(je)throw new Error("IgoErrorModule is already loaded. Import it in the AppModule only")}static \u0275fac=function(Ke){return new(Ke||Ae)(e.CoB(Ae,12))};static \u0275mod=e.a4G({type:Ae});static \u0275inj=e.s3X({})}return Ae})();var z=s(96832);s(12044),s(81424);const q={name:"igo2DB",version:2,objectStoresMeta:[{store:"geoData",storeConfig:{keyPath:"url",autoIncrement:!1},storeSchema:[{name:"regionID",keypath:"regionID",options:{unique:!1}}]},{store:"layerData",storeConfig:{keyPath:"layerId",autoIncrement:!1},storeSchema:[{name:"layerOptions",keypath:"layerOptions",options:{unique:!1}},{name:"sourceOptions",keypath:"sourceOptions",options:{unique:!1}}]}]};let _=(()=>{class Ae{static forRoot(){return{ngModule:Ae,providers:[]}}constructor(je,Ke){je.addSvgIconSet(Ke.bypassSecurityTrustResourceUrl("./assets/igo2/core/icons/mdi.svg"))}static \u0275fac=function(Ke){return new(Ke||Ae)(e.CoB(R.iK),e.CoB(w.mI))};static \u0275mod=e.a4G({type:Ae});static \u0275inj=e.s3X({providers:[(0,M.QW)()],imports:[T.MD,y.SU,a.YP.forRoot(),K.mK.forRoot(),V.forRoot(),L.UD,z.Qr.forRoot(q),a.YP,K.mK,V,M._s,L.UD]})}return Ae})();var u=s(49496),S=s(83680),P=s(10211),I=s(6016),U=s(64002),G=s(2924),O=s(40464),F=s(97180),Q=s(87124),r=s(98340),ie=s(10128),ae=s(62228),fe=s(32688),le=s(880);const se=[{title:"Home",path:"home",component:(()=>{class Ae{interactiveTourService;constructor(je){this.interactiveTourService=je}startTour(){this.interactiveTourService.startTour("global")}static \u0275fac=function(Ke){return new(Ke||Ae)(e.GI1(ae.In))};static \u0275cmp=e.In1({type:Ae,selectors:[["app-home"]],standalone:!0,features:[e.UHJ],decls:58,vars:0,consts:[[2,"text-align","center"],["id","igo-title"],["width","180","src","assets/igo2/core/logo.png",1,"igo-logo"],["tourToStart","global","menuIsOpen","true","styleButton","raised"],[1,"mat-body-1"],["target","_blank","rel","noopener","href","https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation"],["target","_blank","rel","noopener","href","https://angular.io/docs"]],template:function(Ke,yt){1&Ke&&(e.I0R(0,"app-doc-viewer")(1,"div",0)(2,"h1",1),e.OEk(3,"Welcome to IGO"),e.C$Y(),e.wR5(4,"img",2),e.C$Y(),e.I0R(5,"p"),e.wR5(6,"igo-interactive-tour",3),e.C$Y(),e.I0R(7,"p",4),e.OEk(8," IGO2 library contains many components and services that may benefit any web application. "),e.wR5(9,"br"),e.OEk(10," IGO2 library is open source project using Angular, Angular Material and OpenLayers. "),e.C$Y(),e.I0R(11,"h3"),e.OEk(12,"IGO2 library is divided into several elements:"),e.C$Y(),e.I0R(13,"ul",4)(14,"li")(15,"b"),e.OEk(16,"@igo2/utils"),e.C$Y(),e.OEk(17," : Basic utilies without dependency (ex: base64, clipboard, uuid) "),e.C$Y(),e.I0R(18,"li")(19,"b"),e.OEk(20,"@igo2/core"),e.C$Y(),e.OEk(21," : Element affecting the core of the application (ex: config, language, message, media, request) "),e.C$Y(),e.I0R(22,"li")(23,"b"),e.OEk(24,"@igo2/common"),e.C$Y(),e.OEk(25," : Library containing reusable components (ex: clickout, drag-drop, list, panel, spinner, table) "),e.C$Y(),e.I0R(26,"li")(27,"b"),e.OEk(28,"@igo2/auth"),e.C$Y(),e.OEk(29," : Library grouping the authentication and security module "),e.C$Y(),e.I0R(30,"li")(31,"b"),e.OEk(32,"@igo2/geo"),e.C$Y(),e.OEk(33," : Library containing the geomatic components. Depends on Openlayers. "),e.C$Y(),e.I0R(34,"li")(35,"b"),e.OEk(36,"@igo2/context"),e.C$Y(),e.OEk(37," : Library of components uniting @igo2/geo and @igo2/auth "),e.C$Y(),e.I0R(38,"li")(39,"b"),e.OEk(40,"@igo2/integration"),e.C$Y(),e.OEk(41," : Library integrate basic components"),e.C$Y()(),e.I0R(42,"h2"),e.OEk(43,"Here are some links to help you start:"),e.C$Y(),e.I0R(44,"ul")(45,"li")(46,"h2")(47,"a",5),e.OEk(48,"Installation"),e.C$Y()()(),e.I0R(49,"li")(50,"h2")(51,"a",6),e.OEk(52,"Angular Documentation"),e.C$Y()()()(),e.I0R(53,"span",4),e.OEk(54,"*** Modules in "),e.I0R(55,"code"),e.OEk(56,"@igo2/core"),e.C$Y(),e.OEk(57," must be imported only once"),e.C$Y()())},dependencies:[fe.u,ae.bQ,le.E]})}return Ae})()},{title:"Auth",path:"auth",loadChildren:()=>Promise.resolve().then(s.bind(s,40464)).then(Ae=>Ae.routes)},{title:"Common",path:"common",loadChildren:()=>Promise.resolve().then(s.bind(s,97180)).then(Ae=>Ae.routes)},{title:"Context",path:"context",loadChildren:()=>Promise.resolve().then(s.bind(s,87124)).then(Ae=>Ae.routes)},{title:"Core",path:"core",loadChildren:()=>Promise.resolve().then(s.bind(s,98340)).then(Ae=>Ae.routes)},{title:"Geo",path:"geo",loadChildren:()=>Promise.resolve().then(s.bind(s,10128)).then(Ae=>Ae.routes)},{path:"**",redirectTo:"/home"}],ge=[{title:"Home",path:"home",redirectTo:"/home",pathMatch:"full"},{title:"Core",path:"core",children:Ie(r.routes)},{title:"Auth",path:"auth",children:Ie(O.routes)},{title:"Common",path:"common",children:Ie(F.routes)},{title:"Geo",path:"geo",children:Ie(ie.routes)},{title:"Context",path:"context",children:Ie(Q.routes)}];function Ie(Ae){return Ae.filter(dt=>dt.title).sort((dt,je)=>dt.title.localeCompare(je.title))}var Re=s(73192),He=s(75180);const ht=()=>({exact:!0});function rt(Ae,dt){if(1&Ae&&(e.SAx(0),e.I0R(1,"mat-nav-list")(2,"a",12),e.OEk(3),e.C$Y()(),e.wR5(4,"mat-divider"),e.k70()),2&Ae){const je=e.GaO().$implicit;e.yG2(2),e.E7m("routerLink",je.path)("routerLinkActiveOptions",e.q4q(3,ht)),e.yG2(),e.cNF(je.title)}}function xt(Ae,dt){if(1&Ae&&(e.I0R(0,"a",15),e.OEk(1),e.C$Y()),2&Ae){const je=dt.$implicit,Ke=e.GaO(2).$implicit;e.E7m("routerLink",Ke.path+"/"+je.path),e.yG2(),e.cNF(je.title)}}function Rt(Ae,dt){if(1&Ae&&(e.I0R(0,"mat-expansion-panel",13)(1,"mat-expansion-panel-header")(2,"mat-panel-title"),e.OEk(3),e.C$Y()(),e.I0R(4,"mat-nav-list"),e.yuY(5,xt,2,2,"a",14),e.C$Y()(),e.wR5(6,"mat-divider")),2&Ae){const je=e.GaO().$implicit;e.yG2(3),e.oRS(" ",je.title," "),e.yG2(2),e.E7m("ngForOf",je.children)}}function Ze(Ae,dt){if(1&Ae&&(e.SAx(0),e.yuY(1,rt,5,4,"ng-container",10)(2,Rt,7,2,"ng-template",null,11,e.gJz),e.k70()),2&Ae){const je=dt.$implicit,Ke=e.Gew(3);e.yG2(),e.E7m("ngIf",!je.children)("ngIfElse",Ke)}}let Kt=(()=>{class Ae{document;changeDetectorRef;media;router;mobileQuery;routesConfig=ge;title="IGO";version=K.WU;_mobileQueryListener;constructor(je,Ke,yt,Le){this.document=je,this.changeDetectorRef=Ke,this.media=yt,this.router=Le,this.mobileQuery=this.media.matchMedia("(max-width: 600px)"),this._mobileQueryListener=()=>this.changeDetectorRef.detectChanges(),this.mobileQuery.addEventListener("change",this._mobileQueryListener),this.detectOldBrowser()}ngOnInit(){this.handleSplashScreen()}handleSplashScreen(){this.router.events.pipe((0,S.K)(je=>je instanceof E.MT),(0,G.o)(300)).subscribe(()=>{this._removeSplashScreen()})}_removeSplashScreen(){const je=this.document.getElementById("splash-screen");if(!je)return;je.classList.add("is-destroying");const yt=this.document.getElementById("splash-screen-stylesheet");setTimeout(()=>{U.U3.remove(je),U.U3.remove(yt)},300)}ngOnDestroy(){this.mobileQuery.removeEventListener("change",this._mobileQueryListener)}detectOldBrowser(){U.sX.satisfies({ie:"<=11",chrome:"<64",firefox:"<60"})&&console.log("Very old browser ! ",U.sX.getBrowser())}static \u0275fac=function(Ke){return new(Ke||Ae)(e.GI1(T.Ud),e.GI1(e.kD9),e.GI1(Re.iG),e.GI1(E.E5))};static \u0275cmp=e.In1({type:Ae,selectors:[["app-root"]],standalone:!0,features:[e.UHJ],decls:15,vars:9,consts:[[1,"example-container"],["color","primary",1,"example-toolbar","mat-elevation-z6"],["mat-icon-button","",3,"click"],["svgIcon","menu"],[1,"mat-subtitle-1","m-b-0"],[1,"example-sidenav-container"],["opened","true","fixedTopGap","48",3,"mode","fixedInViewport"],["snav",""],["displayMode","flat","multi",""],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["routeWithChildren",""],["mat-list-item","","routerLinkActive","active-link",1,"p-h-24","m-t-8",3,"routerLink","routerLinkActiveOptions"],["expanded",""],["mat-list-item","","routerLinkActive","active-link",3,"routerLink",4,"ngFor","ngForOf"],["mat-list-item","","routerLinkActive","active-link",3,"routerLink"]],template:function(Ke,yt){if(1&Ke){const Le=e.KQA();e.I0R(0,"div",0)(1,"mat-toolbar",1)(2,"button",2),e.qCj("click",function(){e.usT(Le);const Se=e.Gew(10);return e.CGJ(Se.toggle())}),e.wR5(3,"mat-icon",3),e.C$Y(),e.I0R(4,"h1"),e.OEk(5),e.C$Y(),e.I0R(6,"h5",4),e.OEk(7),e.C$Y()(),e.I0R(8,"mat-sidenav-container",5)(9,"mat-sidenav",6,7)(11,"mat-accordion",8),e.yuY(12,Ze,4,2,"ng-container",9),e.C$Y()(),e.I0R(13,"mat-sidenav-content"),e.wR5(14,"router-outlet"),e.C$Y()()()}2&Ke&&(e.eAK("example-is-mobile",yt.mobileQuery.matches),e.yG2(5),e.cNF(yt.title),e.yG2(2),e.cNF(yt.version.lib),e.yG2(),e.m4B("margin-top",yt.mobileQuery.matches?48:0,"px"),e.yG2(),e.E7m("mode",yt.mobileQuery.matches?"over":"side")("fixedInViewport",yt.mobileQuery.matches),e.yG2(3),e.E7m("ngForOf",yt.routesConfig))},dependencies:[T.Iw,T.u_,I.CU,I._2,I._s,I.nm,I.CM,j.Gm,j.EZ,d.oJ,d.um,R.oB,R.qL,h.sb,h.Ar,h.WS,h.Uq,o.iI,o.G2,o.g9,He.k,E.ER,E.LC,E.cP],styles:[".example-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:absolute;inset:0}.example-toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;z-index:2}.example-toolbar[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0}mat-panel-title[_ngcontent-%COMP%]{font-size:14px}mat-nav-list[_ngcontent-%COMP%]{padding:0}mat-expansion-panel[_ngcontent-%COMP%]{box-shadow:unset!important}mat-expansion-panel[_ngcontent-%COMP%]     .mat-expansion-panel-body{padding:0 8px 16px}.active-link[_ngcontent-%COMP%]     span{font-weight:700}.example-is-mobile[_ngcontent-%COMP%]   .example-toolbar[_ngcontent-%COMP%]{position:fixed;z-index:2}.example-sidenav-container[_ngcontent-%COMP%]{flex:1}.example-is-mobile[_ngcontent-%COMP%]   .example-sidenav-container[_ngcontent-%COMP%]{flex:1 0 auto}.example-is-mobile[_ngcontent-%COMP%]   mat-sidenav[_ngcontent-%COMP%]{background-color:#fff}mat-sidenav-content[_ngcontent-%COMP%]{box-sizing:border-box}"]})}return Ae})();var ve=s(12445);ve.O.production&&(0,e.agy)(),(0,w._g)(Kt,{providers:[(0,e.ai8)(_,w.iE,w.rQ,d.oJ,R.oB,o.iI,h.sb,j.Gm,u.ach,u.aw9),(0,y.UP)((0,y.i8)()),(0,K.W0)({default:ve.O.igo}),(0,E.kn)(se,(0,E.wj)(E.eu)),{provide:g.uY,useValue:{appearance:"outline"}},{provide:e.kZF,useFactory:function Ne(Ae,dt){return()=>new Promise(je=>{Ae.isStable.pipe((0,S.K)(Ke=>!0===Ke),(0,P.m)(()=>{const Ke=dt.getLanguage();return dt.translate.getTranslation(Ke)})).subscribe(Ke=>{const yt=dt.getLanguage();dt.translate.setTranslation(yt,Ke),je()})})},deps:[e.Swk,M.ov],multi:!0},{provide:x.gY,useValue:{showDelay:500,hideDelay:0,touchendHideDelay:0,disableTooltipInteractivity:!0}},(0,b.OE)(),(0,u.QPw)(),(0,u.A7Y)(),(0,u.oN0)()]}).catch(Ae=>console.log(Ae))},92348:(Ee,ce,s)=>{var y={"./af":22408,"./af.js":22408,"./ar":83632,"./ar-dz":20944,"./ar-dz.js":20944,"./ar-kw":59628,"./ar-kw.js":59628,"./ar-ly":60764,"./ar-ly.js":60764,"./ar-ma":8087,"./ar-ma.js":8087,"./ar-ps":84152,"./ar-ps.js":84152,"./ar-sa":36932,"./ar-sa.js":36932,"./ar-tn":97064,"./ar-tn.js":97064,"./ar.js":83632,"./az":78216,"./az.js":78216,"./be":90432,"./be.js":90432,"./bg":54440,"./bg.js":54440,"./bm":45340,"./bm.js":45340,"./bn":91936,"./bn-bd":43392,"./bn-bd.js":43392,"./bn.js":91936,"./bo":11440,"./bo.js":11440,"./br":51592,"./br.js":51592,"./bs":15056,"./bs.js":15056,"./ca":25992,"./ca.js":25992,"./cs":15944,"./cs.js":15944,"./cv":60928,"./cv.js":60928,"./cy":86160,"./cy.js":86160,"./da":22112,"./da.js":22112,"./de":6456,"./de-at":44712,"./de-at.js":44712,"./de-ch":29100,"./de-ch.js":29100,"./de.js":6456,"./dv":28776,"./dv.js":28776,"./el":91928,"./el.js":91928,"./en-au":67528,"./en-au.js":67528,"./en-ca":20736,"./en-ca.js":20736,"./en-gb":13976,"./en-gb.js":13976,"./en-ie":41600,"./en-ie.js":41600,"./en-il":53344,"./en-il.js":53344,"./en-in":24072,"./en-in.js":24072,"./en-nz":46264,"./en-nz.js":46264,"./en-sg":7816,"./en-sg.js":7816,"./eo":51920,"./eo.js":51920,"./es":82808,"./es-do":2772,"./es-do.js":2772,"./es-mx":83368,"./es-mx.js":83368,"./es-us":48288,"./es-us.js":48288,"./es.js":82808,"./et":33892,"./et.js":33892,"./eu":35736,"./eu.js":35736,"./fa":68544,"./fa.js":68544,"./fi":83640,"./fi.js":83640,"./fil":24616,"./fil.js":24616,"./fo":27128,"./fo.js":27128,"./fr":50552,"./fr-ca":59120,"./fr-ca.js":59120,"./fr-ch":17980,"./fr-ch.js":17980,"./fr.js":50552,"./fy":7912,"./fy.js":7912,"./ga":34464,"./ga.js":34464,"./gd":98864,"./gd.js":98864,"./gl":32056,"./gl.js":32056,"./gom-deva":75804,"./gom-deva.js":75804,"./gom-latn":98648,"./gom-latn.js":98648,"./gu":76036,"./gu.js":76036,"./he":14e3,"./he.js":14e3,"./hi":48800,"./hi.js":48800,"./hr":55176,"./hr.js":55176,"./hu":192,"./hu.js":192,"./hy-am":94840,"./hy-am.js":94840,"./id":78240,"./id.js":78240,"./is":23608,"./is.js":23608,"./it":56816,"./it-ch":25136,"./it-ch.js":25136,"./it.js":56816,"./ja":17272,"./ja.js":17272,"./jv":83248,"./jv.js":83248,"./ka":4768,"./ka.js":4768,"./kk":93624,"./kk.js":93624,"./km":48168,"./km.js":48168,"./kn":69372,"./kn.js":69372,"./ko":37088,"./ko.js":37088,"./ku":63357,"./ku-kmr":54068,"./ku-kmr.js":54068,"./ku.js":63357,"./ky":3672,"./ky.js":3672,"./lb":43592,"./lb.js":43592,"./lo":16096,"./lo.js":16096,"./lt":92672,"./lt.js":92672,"./lv":69056,"./lv.js":69056,"./me":63280,"./me.js":63280,"./mi":95037,"./mi.js":95037,"./mk":48600,"./mk.js":48600,"./ml":93795,"./ml.js":93795,"./mn":19288,"./mn.js":19288,"./mr":63656,"./mr.js":63656,"./ms":71744,"./ms-my":92804,"./ms-my.js":92804,"./ms.js":71744,"./mt":28536,"./mt.js":28536,"./my":21764,"./my.js":21764,"./nb":64752,"./nb.js":64752,"./ne":82948,"./ne.js":82948,"./nl":49572,"./nl-be":5900,"./nl-be.js":5900,"./nl.js":49572,"./nn":14904,"./nn.js":14904,"./oc-lnc":57328,"./oc-lnc.js":57328,"./pa-in":81496,"./pa-in.js":81496,"./pl":25928,"./pl.js":25928,"./pt":85764,"./pt-br":91248,"./pt-br.js":91248,"./pt.js":85764,"./ro":37168,"./ro.js":37168,"./ru":97904,"./ru.js":97904,"./sd":68448,"./sd.js":68448,"./se":29244,"./se.js":29244,"./si":65696,"./si.js":65696,"./sk":77120,"./sk.js":77120,"./sl":83544,"./sl.js":83544,"./sq":71544,"./sq.js":71544,"./sr":53696,"./sr-cyrl":33444,"./sr-cyrl.js":33444,"./sr.js":53696,"./ss":32504,"./ss.js":32504,"./sv":39011,"./sv.js":39011,"./sw":74144,"./sw.js":74144,"./ta":81280,"./ta.js":81280,"./te":90504,"./te.js":90504,"./tet":36472,"./tet.js":36472,"./tg":77024,"./tg.js":77024,"./th":69872,"./th.js":69872,"./tk":63364,"./tk.js":63364,"./tl-ph":25164,"./tl-ph.js":25164,"./tlh":60048,"./tlh.js":60048,"./tr":86976,"./tr.js":86976,"./tzl":4224,"./tzl.js":4224,"./tzm":64316,"./tzm-latn":72264,"./tzm-latn.js":72264,"./tzm.js":64316,"./ug-cn":18984,"./ug-cn.js":18984,"./uk":25152,"./uk.js":25152,"./ur":57068,"./ur.js":57068,"./uz":47880,"./uz-latn":7400,"./uz-latn.js":7400,"./uz.js":47880,"./vi":35368,"./vi.js":35368,"./x-pseudo":71252,"./x-pseudo.js":71252,"./yo":98595,"./yo.js":98595,"./zh-cn":23036,"./zh-cn.js":23036,"./zh-hk":59944,"./zh-hk.js":59944,"./zh-mo":94952,"./zh-mo.js":94952,"./zh-tw":8240,"./zh-tw.js":8240};function e(g){var R=d(g);return s(R)}function d(g){if(!s.o(y,g)){var R=new Error("Cannot find module '"+g+"'");throw R.code="MODULE_NOT_FOUND",R}return y[g]}e.keys=function(){return Object.keys(y)},e.resolve=d,Ee.exports=e,e.id=92348}},Ee=>{Ee.O(0,[968],()=>Ee(Ee.s=74092)),Ee.O()}]);
//# sourceMappingURL=main.e08e2db78aa8ce35.js.map