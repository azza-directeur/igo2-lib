(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[590],{58752:(Fe,ce,r)=>{"use strict";r.d(ce,{kT:()=>te,oj:()=>A,qi:()=>B});var C=r(33712),e=r(34896),d=r(21720),L=r(9204),P=r(13680);let o=(()=>{class z{injector;options;tokenKey;constructor(I){this.injector=I;const b=this.injector.get(L.aW);this.options=b.getConfig("auth"),this.tokenKey=this.options?.tokenKey}set(I){localStorage.setItem(this.tokenKey,I)}remove(){localStorage.removeItem(this.tokenKey)}get(){return localStorage.getItem(this.tokenKey)}decode(){const I=this.get();if(I)return(0,P.i)(I)}isExpired(){const I=this.decode(),b=(new Date).getTime()/1e3;return!(I&&b<I.exp)}static \u0275fac=function(b){return new(b||z)(e.CoB(e.zZn))};static \u0275prov=e.wxM({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})();var f=r(24708),h=r(93020),R=r(43168),y=r(54844),O=r(1296),x=r(78600),T=r(51672),a=r(90916),F=r(57880);let A=(()=>{class z{http;tokenService;config;languageService;messageService;router;authenticate$=new y.g(void 0);logged$=new y.g(void 0);redirectUrl;languageForce=!1;anonymous=!1;authOptions;get hasAuthService(){return void 0!==this.authOptions?.url}get user(){const I=this.decodeToken();return I?.user?I.user:null}constructor(I,b,G,D,g,U){this.http=I,this.tokenService=b,this.config=G,this.languageService=D,this.messageService=g,this.router=U,this.authOptions=this.config.getConfig("auth"),this.authenticate$.next(this.authenticated),this.authenticate$.subscribe(M=>{this.logged$.next(M),a.y.next()})}login(I,b){const G=new C.UD({"Content-Type":"application/json"}),D={username:I,password:this.encodePassword(b)};return this.loginCall(D,G)}loginWithToken(I,b,G){const D=new C.UD({"Content-Type":"application/json"});return this.loginCall({token:I,typeConnection:b,infosUser:G},D)}loginAnonymous(){return this.anonymous=!0,this.logged$.next(!0),(0,O.of)(!0)}refresh(){return this.http.post(`${this.authOptions?.url}/refresh`,{}).pipe((0,x.y)(I=>{this.tokenService.set(I.token)}),(0,T.a)(I=>{throw I.error.caught=!0,I}))}logout(){return this.anonymous=!1,this.tokenService.remove(),this.authenticate$.next(!1),(0,O.of)(!0)}isAuthenticated(){return!this.tokenService.isExpired()}getToken(){return this.tokenService.get()}decodeToken(){if(this.isAuthenticated())return this.tokenService.decode()}goToRedirectUrl(){if(!this.router)return;const I=this.redirectUrl||this.router.url;I===this.authOptions.loginRoute?this.router.navigateByUrl(this.authOptions.homeRoute||"/"):I&&this.router.navigateByUrl(I)}getUserInfo(){return this.http.get(this.authOptions?.url+"/info")}getProfils(){return this.http.get(`${this.authOptions?.url}/profils`)}updateUser(I){return this.http.patch(this.authOptions?.url,I)}encodePassword(I){return R.Q1.encode(I)}get logged(){return this.authenticated||this.isAnonymous}get isAnonymous(){return this.anonymous}get authenticated(){return this.isAuthenticated()}get isAdmin(){return!!this.decodeToken()?.user?.isAdmin}loginCall(I,b){return this.http.post(`${this.authOptions?.url}/login`,I,{headers:b}).pipe((0,x.y)(G=>{this.tokenService.set(G.token);const D=this.decodeToken();D?.user&&(D.user.locale&&!this.languageForce&&this.languageService.setLanguage(D.user.locale),D.user.isExpired&&this.messageService.alert("igo.auth.error.Password expired")),this.authenticate$.next(!0)}),(0,T.a)(G=>{throw G.error.caught=!0,G}))}static \u0275fac=function(b){return new(b||z)(e.CoB(C.KK),e.CoB(o),e.CoB(L.aW),e.CoB(f.ov),e.CoB(h.mi),e.CoB(F.E5,8))};static \u0275prov=e.wxM({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})(),k=(()=>{class z extends d.kR{http;authService;tokenService;constructor(I,b,G,D){super(I),this.http=b,this.authService=G,this.tokenService=D,this.authService.authenticate$.subscribe(g=>{g&&this.options.url&&this.http.get(this.options.url).subscribe(U=>{if(U&&U.preference)for(const M of Object.keys(U.preference))super.set(M,U.preference[M])})})}set(I,b,G=d.Ab.LOCAL){if(G===d.Ab.LOCAL&&this.authService.authenticated&&this.options.url){const D={};D[I]=b,this.http.patch(this.options.url,{preference:D}).subscribe()}super.set(I,b,G)}remove(I,b=d.Ab.LOCAL){if(b===d.Ab.LOCAL&&this.authService.authenticated&&this.options.url){const G={};G[I]=void 0,this.http.patch(this.options.url,{preference:G}).subscribe()}super.remove(I,b)}clear(I=d.Ab.LOCAL){let b;I===d.Ab.LOCAL&&this.authService.authenticated&&this.options.url&&this.http.patch(this.options.url,{preference:{}},{params:{mergePreference:"false"}}).subscribe(),I===d.Ab.LOCAL&&(b=this.tokenService.get()),super.clear(I),b&&this.tokenService.set(b),I===d.Ab.LOCAL&&this.authService.authenticated&&this.options.url&&this.http.get(this.options.url).subscribe(G=>{if(G&&G.preference)for(const D of Object.keys(G.preference))super.set(D,G.preference[D])})}static \u0275fac=function(b){return new(b||z)(e.CoB(L.aW),e.CoB(C.KK),e.CoB(A),e.CoB(o))};static \u0275prov=e.wxM({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})();var w=r(11772);let te=(()=>{class z{config;tokenService;http;authOptions;refreshInProgress=!1;trustHosts;hostsWithCredentials;hostsWithAuthByKey;constructor(I,b,G){this.config=I,this.tokenService=b,this.http=G,this.authOptions=this.config.getConfig("auth"),this.trustHosts=this.authOptions?.trustHosts||[],this.trustHosts.push(window.location.hostname),this.hostsWithCredentials=this.authOptions?.hostsWithCredentials||[],this.hostsWithAuthByKey=this.authOptions?.hostsByKey||[]}intercept(I,b){const G=this.handleHostsWithCredentials(I.url);let D=I.clone();const g=this.handleHostsAuthByKey(I.url);if(g&&(D=D.clone({params:D.params.set(g.key,g.value)})),G)return D=I.clone({withCredentials:G}),b.handle(D);this.refreshToken();const U=this.tokenService.get(),M=document.createElement("a");if(M.href=D.url,""===M.host&&(M.href=M.href),!U||-1===this.trustHosts.indexOf(M.hostname))return b.handle(D);let s=D.clone({headers:D.headers.set("Authorization",`Bearer ${U}`)});const ie=this.tokenService.decode();if("true"===s.params.get("_i")&&ie?.user?.sourceId){const de=w.Cy.hashStr(ie.user.sourceId);s=s.clone({params:s.params.set("_i",de)})}else"true"===s.params.get("_i")&&(s=s.clone({params:s.params.delete("_i")}));return b.handle(s)}interceptXhr(I,b){const G=this.handleHostsWithCredentials(b);if(G)return I.withCredentials=G,!0;this.refreshToken();const D=document.createElement("a");D.href=b;const g=this.tokenService.get();return!(!g||-1===this.trustHosts.indexOf(D.hostname)||(I.setRequestHeader("Authorization","Bearer "+g),0))}alterUrlWithKeyAuth(I){const b=this.handleHostsAuthByKey(I);if(b){const D=I.split(/[?&]/);let g=D.shift();const U=D.filter(M=>0!==M.length);return U.push(`${b.key}=${b.value}`),U.length&&(g+="?"+U.join("&")),g}}handleHostsWithCredentials(I){let b=!1;for(const G of this.hostsWithCredentials)if(new RegExp(G.domainRegFilters).test(I)){b=void 0!==G.withCredentials?G.withCredentials:void 0;break}return b}handleHostsAuthByKey(I){let b;for(const g of this.hostsWithAuthByKey)if(new RegExp(g.domainRegFilters).test(I)&&!new RegExp(`${g.keyProperty}=${g.keyValue}`,"gm").test(I)){b={key:g.keyProperty,value:g.keyValue};break}return b}refreshToken(){const I=this.tokenService.decode(),b=(new Date).getTime()/1e3;if(!this.refreshInProgress&&I&&b<I.exp&&b>I.exp-1800){this.refreshInProgress=!0;const G=this.authOptions?.url;return this.http.post(`${G}/refresh`,{}).subscribe(D=>{this.tokenService.set(D.token),this.refreshInProgress=!1},D=>(D.error.caught=!0,D))}}static \u0275fac=function(b){return new(b||z)(e.CoB(L.aW),e.CoB(o),e.CoB(C.KK))};static \u0275prov=e.wxM({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})();function B(...z){const c=[{provide:C.So,useClass:te,multi:!0},{provide:d.yQ,useClass:k}];for(const I of z)c.push(...I.providers);return(0,e.AFj)(c)}},97092:(Fe,ce,r)=>{"use strict";r.d(ce,{U:()=>d});var C=r(34896),e=r(50168);let d=(()=>{class L{_sanitizer;constructor(o){this._sanitizer=o}transform(o){return this._sanitizer.bypassSecurityTrustHtml(o)}static \u0275fac=function(f){return new(f||L)(C.GI1(e.mI,16))};static \u0275pipe=C.UTH({name:"sanitizeHtml",type:L,pure:!0,standalone:!0})}return L})()},6316:(Fe,ce,r)=>{"use strict";r.d(ce,{q:()=>f});var C=r(34896),e=r(43168),d=r(65044),L=r(88908);const P=["target"];function o(h,R){}let f=(()=>{class h{dynamicComponentService;cdRef;component;inputs={};subscribers={};dynamicComponent;target;constructor(y,O){this.dynamicComponentService=y,this.cdRef=O}ngOnChanges(y){const O=y.component,x=y.inputs,T=y.subscribers,a=e.Yv.objectsAreEquivalent;if(O&&O.currentValue){if(O.currentValue!==O.previousValue)this.createComponent(O.currentValue);else{const F=x&&a(x.currentValue||{},x.previousValue||{}),A=T&&a(T.currentValue||{},T.previousValue||{});!1===F&&this.updateInputs(),!1===A&&this.updateSubscribers()}this.cdRef.detectChanges()}}ngOnDestroy(){this.dynamicComponent&&this.dynamicComponent.destroy()}createComponent(y){void 0!==this.dynamicComponent&&this.dynamicComponent.destroy(),this.dynamicComponent=y instanceof d.A?y:this.dynamicComponentService.create(y),this.renderComponent()}renderComponent(){this.updateInputs(),this.updateSubscribers(),this.dynamicComponent.setTarget(this.target)}updateInputs(){this.dynamicComponent.updateInputs(this.inputs)}updateSubscribers(){this.dynamicComponent.updateSubscribers(this.subscribers)}static \u0275fac=function(O){return new(O||h)(C.GI1(L.O),C.GI1(C.kD9))};static \u0275cmp=C.In1({type:h,selectors:[["igo-dynamic-outlet"]],viewQuery:function(O,x){if(1&O&&C.CC$(P,7,C.y8U),2&O){let T;C.wto(T=C.Gqi())&&(x.target=T.first)}},inputs:{component:"component",inputs:"inputs",subscribers:"subscribers"},standalone:!0,features:[C.SYr,C.UHJ],decls:2,vars:0,consts:[["target",""]],template:function(O,x){1&O&&C.yuY(0,o,0,0,"ng-template",null,0,C.gJz)},styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}"],changeDetection:0})}return h})()},77020:(Fe,ce,r)=>{"use strict";r.d(ce,{qm:()=>C.q});var C=r(6316)},88908:(Fe,ce,r)=>{"use strict";r.d(ce,{O:()=>d});var C=r(65044),e=r(34896);let d=(()=>{class L{resolver;constructor(o){this.resolver=o}create(o){const f=this.resolver.resolveComponentFactory(o);return new C.A(f)}static \u0275fac=function(f){return new(f||L)(e.CoB(e.ce5))};static \u0275prov=e.wxM({token:L,factory:L.\u0275fac,providedIn:"root"})}return L})()},65044:(Fe,ce,r)=>{"use strict";r.d(ce,{A:()=>e});var C=r(21296);class e{componentFactory;componentRef;subscriptions=[];target;inputs={};inputs$$={};subscribers={};constructor(L){this.componentFactory=L}setTarget(L){this.target=L,this.componentRef=L.createComponent(this.componentFactory),this.updateInputs(this.inputs),this.updateSubscribers(this.subscribers)}destroy(){void 0!==this.target&&this.target.clear(),void 0!==this.componentRef&&(this.componentRef.destroy(),this.componentRef=void 0),this.unobserveAllInputs(),this.unsubscribeAll()}updateInputs(L){if(this.inputs=L,void 0===this.componentRef)return;const P=this.componentRef.instance;this.componentFactory.inputs.forEach(f=>{const h=f.propName;this.unobserveInput(h);const R=L[h];L.hasOwnProperty(h)&&(R instanceof C._?this.observeInput(h,R):this.setInputValue(P,h,R))}),"function"==typeof P.onUpdateInputs&&P.onUpdateInputs()}setInputValue(L,P,o){if(o===L[P])return;const h=Object.getPrototypeOf(L),R=Object.getOwnPropertyDescriptor(h,P);void 0!==R&&void 0!==R.set?R.set.call(L,o):L[P]=o}updateSubscribers(L){if(this.subscribers=L,void 0===this.componentRef)return;const P=this.componentRef.instance;this.componentFactory.outputs.forEach(f=>{const h=f.propName;if(L.hasOwnProperty(h)){const R=P[h],y=L[h];Array.isArray(y)?y.forEach(O=>{this.subscriptions.push(R.subscribe(O))}):this.subscriptions.push(R.subscribe(y))}})}observeInput(L,P){this.inputs$$[L]=P.subscribe(o=>{const f=this.componentRef.instance;this.setInputValue(f,L,o),"function"==typeof f.onUpdateInputs&&f.onUpdateInputs()})}unobserveInput(L){void 0!==this.inputs$$[L]&&(this.inputs$$[L].unsubscribe(),this.inputs$$[L]=void 0)}unobserveAllInputs(){Object.values(this.inputs$$).forEach(L=>{void 0!==L&&L.unsubscribe()}),this.inputs$$={}}unsubscribeAll(){this.subscriptions.forEach(L=>L.unsubscribe()),this.subscriptions=[]}}},66165:(Fe,ce,r)=>{"use strict";r.d(ce,{s:()=>T});var C=r(65056),e=r(34896),d=r(46176),L=r(50244),P=r(77872),o=r(54844),f=r(22788),R=(r(63892),r(87556));function y(a,F){if(1&a&&(e.I0R(0,"mat-option",4),e.OEk(1),e.C$Y()),2&a){const A=e.GaO();e.E7m("value",A.emptyValue),e.yG2(),e.cNF(A.emptyText)}}function O(a,F){if(1&a&&(e.I0R(0,"mat-option",4),e.OEk(1),e.wVc(2,"async"),e.C$Y()),2&a){const A=e.GaO();e.E7m("value",A.multiSelectValue),e.yG2(),e.cNF(e.kDX(2,2,A.multiText$))}}function x(a,F){if(1&a&&(e.I0R(0,"mat-option",4),e.OEk(1),e.C$Y()),2&a){const A=F.$implicit,k=e.GaO();e.E7m("value",A.entity),e.yG2(),e.oRS(" ",k.titleAccessor(A.entity)," ")}}let T=(()=>{class a{cdRef;selected$=new o.g(void 0);multiText$=new o.g(void 0);multiSelectValue={id:"IGO_MULTI_SELECT"};emptyValue={id:"IGO_EMPTY_SELECT"};selected$$;watcher;store;titleAccessor=f.YB;emptyText=void 0;multi=!1;multiAllText="All";multiNoneText="None";placeholder;disabled=!1;selectedChange=new e._w7;constructor(A){this.cdRef=A}ngOnInit(){this.watcher=new R.Y(this.store,this.cdRef),this.selected$$=this.store.stateView.manyBy$(A=>!0===A.state.selected).subscribe(A=>{const k=A.map(W=>W.entity);this.onSelectFromStore(k)})}ngOnDestroy(){this.watcher.destroy(),this.selected$$.unsubscribe()}onSelectionChange(A){const k=A.value instanceof Array?A.value:[A.value],W=k.find(Z=>Z===this.multiSelectValue);let w=k.filter(Z=>Z!==this.multiSelectValue);void 0!==W&&(w.length===this.store.count?w=[]:w.length<this.store.count&&(w=this.store.all())),w=w.filter(Z=>Z!==this.emptyValue),0===w.length?this.store.state.updateAll({selected:!1}):this.store.state.updateMany(w,{selected:!0},!0),this.selectedChange.emit({selected:!0,value:this.multi?w:A.value})}onSelectFromStore(A){this.selected$.next(!0===this.multi?A:A.length>0?A[0]:void 0),this.updateMultiToggleWithEntities(A)}updateMultiToggleWithEntities(A){A.length===this.store.count&&this.multiText$.value!==this.multiNoneText?this.multiText$.next(this.multiNoneText):A.length<this.store.count&&this.multiText$.value!==this.multiAllText&&this.multiText$.next(this.multiAllText)}static \u0275fac=function(k){return new(k||a)(e.GI1(e.kD9))};static \u0275cmp=e.In1({type:a,selectors:[["igo-entity-selector"]],inputs:{store:"store",titleAccessor:"titleAccessor",emptyText:"emptyText",multi:"multi",multiAllText:"multiAllText",multiNoneText:"multiNoneText",placeholder:"placeholder",disabled:"disabled"},outputs:{selectedChange:"selectedChange"},standalone:!0,features:[e.UHJ],decls:7,vars:11,consts:[["subscriptSizing","dynamic",1,"igo-entity-selector"],[3,"disabled","value","multiple","placeholder","selectionChange"],[3,"value",4,"ngIf"],["ngFor","",3,"ngForOf"],[3,"value"]],template:function(k,W){1&k&&(e.I0R(0,"mat-form-field",0)(1,"mat-select",1),e.qCj("selectionChange",function(te){return W.onSelectionChange(te)}),e.wVc(2,"async"),e.yuY(3,y,2,2,"mat-option",2)(4,O,3,4,"mat-option",2)(5,x,2,2,"ng-template",3),e.wVc(6,"async"),e.C$Y()()),2&k&&(e.yG2(),e.E7m("disabled",W.disabled)("value",e.kDX(2,7,W.selected$))("multiple",W.multi)("placeholder",W.placeholder),e.yG2(2),e.E7m("ngIf",void 0!==W.emptyText&&!1===W.multi),e.yG2(),e.E7m("ngIf",!0===W.multi),e.yG2(),e.E7m("ngForOf",e.kDX(6,9,W.store.stateView.all$())))},dependencies:[L.wb,L.Up,P.d5,P.kX,d.I5,C.u_,d.Ax,C.Iw,C.a],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"],changeDetection:0})}return a})()},800:(Fe,ce,r)=>{"use strict";r.d(ce,{I:()=>f});var C=r(34896),e=r(54872),d=r(24708),L=r(9588),P=r(54844);r(80544);let f=(()=>{class h{languageService;mediaService;disabled=!1;hidePageSize=!1;pageIndex=0;pageSize=50;pageSizeOptions=[5,10,20,50,100,200];showFirstLastButtons=!0;count$$;entitySortChange$$;paginationLabelTranslation$$=[];entitySortChange$=new P.g(!1);store;paginatorOptions;page;length=0;paginatorChange=new C._w7;constructor(y,O){this.languageService=y,this.mediaService=O}paginator;ngOnChanges(){this.unsubscribeAll(),this.count$$=this.store.stateView.count$.subscribe(y=>{this.length=y,this.emitPaginator()}),this.entitySortChange$$=this.entitySortChange$.subscribe(()=>{this.paginator&&this.paginator.firstPage()}),this.initPaginatorOptions(),this.translateLabels()}initPaginatorOptions(){this.disabled=this.paginatorOptions?.disabled||this.disabled,this.pageIndex=this.paginatorOptions?.pageIndex||this.pageIndex,this.pageSize=this.paginatorOptions?.pageSize||this.pageSize,this.pageSizeOptions=this.paginatorOptions?.pageSizeOptions||this.pageSizeOptions,this.mediaService.isMobile()?(this.showFirstLastButtons=!1,this.hidePageSize=!0):(this.showFirstLastButtons=this.paginatorOptions?.showFirstLastButtons||this.showFirstLastButtons,this.hidePageSize=this.paginatorOptions?.hidePageSize||this.hidePageSize)}translateLabels(){this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.firstPageLabel").subscribe(y=>{this.paginator._intl.firstPageLabel=y})),this.paginator._intl.getRangeLabel=this.rangeLabel,this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.itemsPerPageLabel").subscribe(y=>{this.paginator._intl.itemsPerPageLabel=y})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.lastPageLabel").subscribe(y=>{this.paginator._intl.lastPageLabel=y})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.nextPageLabel").subscribe(y=>{this.paginator._intl.nextPageLabel=y})),this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.previousPageLabel").subscribe(y=>{this.paginator._intl.previousPageLabel=y}))}rangeLabel=(y,O,x)=>{const T=new P.g("");if(this.paginationLabelTranslation$$.push(this.languageService.translate.get("igo.common.paginator.of").subscribe(A=>{T.next(A)})),0===x||0===O)return`0 ${T.value} ${x}`;const a=y*O;return`${a+1} - ${a<(x=Math.max(x,0))?Math.min(a+O,x):a+O} ${T.value} ${x}`};unsubscribeAll(){this.paginationLabelTranslation$$.map(y=>y.unsubscribe()),this.count$$&&this.count$$.unsubscribe(),this.entitySortChange$$&&this.entitySortChange$$.unsubscribe()}ngOnDestroy(){this.unsubscribeAll()}emitPaginator(){this.paginatorChange.emit(this.paginator)}static \u0275fac=function(O){return new(O||h)(C.GI1(d.ov),C.GI1(L.QB))};static \u0275cmp=C.In1({type:h,selectors:[["igo-entity-table-paginator"]],viewQuery:function(O,x){if(1&O&&C.CC$(e.Qb,7),2&O){let T;C.wto(T=C.Gqi())&&(x.paginator=T.first)}},inputs:{entitySortChange$:"entitySortChange$",store:"store",paginatorOptions:"paginatorOptions"},outputs:{page:"page",paginatorChange:"paginatorChange"},standalone:!0,features:[C.SYr,C.UHJ],decls:1,vars:7,consts:[[3,"disabled","hidePageSize","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons","page"]],template:function(O,x){1&O&&(C.I0R(0,"mat-paginator",0),C.qCj("page",function(){return x.emitPaginator()}),C.C$Y()),2&O&&C.E7m("disabled",x.disabled)("hidePageSize",x.hidePageSize)("length",x.length)("pageIndex",x.pageIndex)("pageSize",x.pageSize)("pageSizeOptions",x.pageSizeOptions)("showFirstLastButtons",x.showFirstLastButtons)},dependencies:[e.w5,e.Qb],styles:["[_nghost-%COMP%]     .mat-mdc-paginator-container{min-height:unset}"],changeDetection:0})}return h})()},14944:(Fe,ce,r)=>{"use strict";r.d(ce,{E:()=>Xt});var C=r(65056),e=r(34896),d=r(71904),L=r(61792),P=r(69400),o=r(34672),f=r(58539),h=r(46176),R=r(24392),y=r(50244),O=r(32328),x=r(42536),T=r(77872),a=r(76768),F=r(80956),A=r(27e3),k=r(24708),W=r(43168),w=r(30816),te=r.n(w),Z=r(54844),K=r(21296),X=r(24112),V=r(40604),B=r(97092),z=r(19644),c=r(696),I=r(24100),b=r(800),G=r(80544),D=r(89888),g=r(72672);let U=(()=>{class De{renderer;el;static selectedCls="igo-entity-table-row-selected";static highlightedCls="igo-entity-table-row-highlighted";selection=!1;selectOnClick=!0;highlightSelection=!0;set selected(he){!1!==this.selection&&he!==this._selected&&(this.toggleSelected(he),this.scroll())}get selected(){return this._selected}_selected=!1;scrollBehavior=g.qK.Auto;select=new e._w7;onClick(){!1===this.selection||!1===this.selectOnClick||(this.toggleSelected(!0),this.select.emit(this))}constructor(he,pe){this.renderer=he,this.el=pe}toggleSelected(he){this._selected=he,!0===he?(this.addCls(De.selectedCls),!0===this.highlightSelection&&this.addCls(De.highlightedCls)):(this.removeCls(De.selectedCls),this.removeCls(De.highlightedCls))}scroll(){!0===this._selected&&(0,D.c)(this.el.nativeElement,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})}addCls(he){this.renderer.addClass(this.el.nativeElement,he)}removeCls(he){this.renderer.removeClass(this.el.nativeElement,he)}static \u0275fac=function(pe){return new(pe||De)(e.GI1(e.q87),e.GI1(e.GMv))};static \u0275dir=e.Sc5({type:De,selectors:[["","igoEntityTableRow",""]],hostBindings:function(pe,Pe){1&pe&&e.qCj("click",function(){return Pe.onClick()})},inputs:{selection:"selection",selectOnClick:"selectOnClick",highlightSelection:"highlightSelection",selected:"selected",scrollBehavior:"scrollBehavior"},outputs:{select:"select"},standalone:!0})}return De})();var M=r(42664),H=r(72584);function s(De,et){if(1&De){const he=e.KQA();e.SAx(0),e.I0R(1,"mat-checkbox",11),e.qCj("change",function(Pe){e.usT(he);const $e=e.GaO(3);return e.CGJ($e.onToggleRows(Pe.checked))}),e.C$Y(),e.k70()}if(2&De){const he=et.ngIf,pe=e.GaO(3);e.yG2(),e.E7m("checked",he===pe.entityTableSelectionState.All)("indeterminate",he===pe.entityTableSelectionState.Some)}}function ie(De,et){if(1&De&&(e.SAx(0),e.yuY(1,s,2,2,"ng-container",10),e.wVc(2,"async"),e.k70()),2&De){const he=e.GaO(2);e.yG2(),e.E7m("ngIf",e.kDX(2,1,he.selectionState$))}}function de(De,et){if(1&De&&(e.I0R(0,"th",9),e.yuY(1,ie,3,3,"ng-container",10),e.C$Y()),2&De){const he=e.GaO();e.yG2(),e.E7m("ngIf",he.selectMany)}}function fe(De,et){if(1&De){const he=e.KQA();e.I0R(0,"td",12)(1,"mat-checkbox",13),e.qCj("mousedown",function(Pe){return Pe.shiftKey?Pe.preventDefault():null})("click",function(Pe){const ut=e.usT(he).$implicit,st=e.GaO();return e.CGJ(Pe.shiftKey?st.onShiftToggleRow(!st.rowIsSelected(ut.record),ut.record,Pe):Pe.stopPropagation())})("change",function(Pe){const ut=e.usT(he).$implicit,st=e.GaO();return e.CGJ(st.onToggleRow(Pe.checked,ut.record))}),e.C$Y()()}if(2&De){const he=et.$implicit,pe=e.GaO();e.yG2(),e.E7m("checked",pe.rowIsSelected(he.record))}}function Se(De,et){if(1&De&&(e.I0R(0,"th",16),e.OEk(1),e.C$Y()),2&De){const he=e.GaO(2).$implicit;e.E7m("matTooltip",he.tooltip?he.tooltip:void 0),e.yG2(),e.oRS(" ",he.title," ")}}function ae(De,et){1&De&&(e.SAx(0),e.yuY(1,Se,2,2,"th",15),e.k70())}function le(De,et){if(1&De&&(e.I0R(0,"th",18),e.OEk(1),e.C$Y()),2&De){const he=e.GaO(2).$implicit;e.E7m("matTooltip",he.tooltip?he.tooltip:void 0),e.yG2(),e.oRS(" ",he.title," ")}}function oe(De,et){1&De&&(e.SAx(0),e.yuY(1,le,2,2,"th",17),e.k70())}function se(De,et){if(1&De&&(e.I0R(0,"td",22),e.OEk(1),e.C$Y()),2&De){const he=e.GaO().$implicit,pe=e.GaO(3).$implicit;e.E7m("ngClass",he.cellData[pe.name].class),e.yG2(),e.oRS(" ",he.cellData[pe.name].value," ")}}function me(De,et){if(1&De&&(e.wR5(0,"img",26),e.wVc(1,"async"),e.wVc(2,"secureImage")),2&De){const he=e.GaO(2).$implicit,pe=e.GaO(3).$implicit;e._6D("src",e.kDX(1,1,e.kDX(2,3,he.cellData[pe.name].value)),e.K6U)}}function be(De,et){1&De&&(e.I0R(0,"span"),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&De&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.common.entity-table.targetHtmlUrl")," "))}function ke(De,et){if(1&De&&(e.I0R(0,"td",22)(1,"a",23),e.qCj("click",function(pe){return pe.stopPropagation()}),e.yuY(2,me,3,5,"img",24)(3,be,3,3,"ng-template",null,25,e.gJz),e.C$Y()()),2&De){const he=e.Gew(4),pe=e.GaO().$implicit,Pe=e.GaO(3).$implicit;e.E7m("ngClass",pe.cellData[Pe.name].class),e.yG2(),e._6D("href",pe.cellData[Pe.name].value,e.K6U),e.yG2(),e.E7m("ngIf",pe.cellData[Pe.name].isImg)("ngIfElse",he)}}function qe(De,et){if(1&De&&(e.SAx(0),e.yuY(1,se,2,2,"td",20)(2,ke,5,4,"ng-template",null,21,e.gJz),e.k70()),2&De){const he=et.$implicit,pe=e.Gew(3),Pe=e.GaO(3).$implicit;e.yG2(),e.E7m("ngIf",!he.cellData[Pe.name].isUrl)("ngIfElse",pe)}}function nt(De,et){1&De&&(e.SAx(0),e.yuY(1,qe,4,2,"ng-container",19),e.k70())}function Ue(De,et){if(1&De&&e.wR5(0,"td",29),2&De){const he=e.GaO().$implicit,pe=e.GaO(3).$implicit;e.E7m("ngClass",he.cellData[pe.name].class)("innerHTML",he.cellData[pe.name].value,e.E3n)}}function St(De,et){if(1&De&&(e.wR5(0,"img",26),e.wVc(1,"async"),e.wVc(2,"secureImage")),2&De){const he=e.GaO(2).$implicit,pe=e.GaO(3).$implicit;e._6D("src",e.kDX(1,1,e.kDX(2,3,he.cellData[pe.name].value)),e.K6U)}}function Ae(De,et){1&De&&(e.I0R(0,"span"),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&De&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.geo.targetHtmlUrl")," "))}function Qe(De,et){if(1&De&&(e.I0R(0,"td",22)(1,"a",23),e.qCj("click",function(pe){return pe.stopPropagation()}),e.yuY(2,St,3,5,"img",24)(3,Ae,3,3,"ng-template",null,25,e.gJz),e.C$Y()()),2&De){const he=e.Gew(4),pe=e.GaO().$implicit,Pe=e.GaO(3).$implicit;e.E7m("ngClass",pe.cellData[Pe.name].class),e.yG2(),e._6D("href",pe.cellData[Pe.name].value,e.K6U),e.yG2(),e.E7m("ngIf",pe.cellData[Pe.name].isImg)("ngIfElse",he)}}function _e(De,et){if(1&De&&(e.SAx(0),e.yuY(1,Ue,1,2,"td",27)(2,Qe,5,4,"ng-template",null,28,e.gJz),e.k70()),2&De){const he=et.$implicit,pe=e.Gew(3),Pe=e.GaO(3).$implicit;e.yG2(),e.E7m("ngIf",!he.cellData[Pe.name].isUrl)("ngIfElse",pe)}}function Ie(De,et){1&De&&(e.SAx(0),e.yuY(1,_e,4,2,"ng-container",19),e.k70())}function je(De,et){if(1&De){const he=e.KQA();e.I0R(0,"div",43),e.wR5(1,"mat-datepicker-toggle",44),e.I0R(2,"input",45),e.qCj("dateChange",function(Pe){e.usT(he);const $e=e.GaO(2).$implicit,ut=e.GaO(3).$implicit,st=e.GaO();return e.CGJ(st.onDateChange(ut.name,$e.record,Pe))}),e.C$Y(),e.wR5(3,"mat-datepicker",null,46),e.C$Y()}if(2&De){const he=e.Gew(4),pe=e.GaO(2).$implicit,Pe=e.GaO(3).$implicit;e.yG2(),e.E7m("for",he),e.yG2(),e._6D("value",pe.cellData[Pe.name].value),e.E7m("matDatepicker",he)("formControlName",Pe.name)}}function Ve(De,et){if(1&De){const he=e.KQA();e.I0R(0,"input",47),e.qCj("focus",function(Pe){e.usT(he);const $e=e.GaO(5).$implicit;return e.CGJ($e.onFocus(Pe))})("keypress",function(Pe){e.usT(he);const $e=e.GaO(5).$implicit;return e.CGJ($e.onChange(Pe))})("blur",function(Pe){e.usT(he);const $e=e.GaO(5).$implicit;return e.CGJ($e.onBlur(Pe))}),e.C$Y()}if(2&De){const he=e.GaO(5).$implicit;e.E7m("formControlName",he.name)}}function ot(De,et){if(1&De){const he=e.KQA();e.I0R(0,"input",48),e.qCj("input",function(Pe){e.usT(he);const $e=e.GaO(2).$implicit,ut=e.GaO(3).$implicit,st=e.GaO();return e.CGJ(st.onValueChange(ut.name,$e.record,Pe))}),e.C$Y()}if(2&De){const he=e.GaO(2).$implicit,pe=e.GaO(3).$implicit,Pe=e.GaO();e._6D("step",pe.step),e._6D("value",he.cellData[pe.name].value),e._6D("readonly",Pe.getValidationAttributeValue(pe,"readonly")),e._6D("required",Pe.getValidationAttributeValue(pe,"mandatory")),e._6D("min",Pe.getValidationAttributeValue(pe,"minValue")),e._6D("max",Pe.getValidationAttributeValue(pe,"maxValue")),e.E7m("formControlName",pe.name)}}function lt(De,et){if(1&De){const he=e.KQA();e.I0R(0,"input",49),e.qCj("input",function(Pe){e.usT(he);const $e=e.GaO(2).$implicit,ut=e.GaO(3).$implicit,st=e.GaO();return e.CGJ(st.onValueChange(ut.name,$e.record,Pe))}),e.C$Y()}if(2&De){const he=e.GaO(2).$implicit,pe=e.GaO(3).$implicit,Pe=e.GaO();e._6D("value",he.cellData[pe.name].value),e._6D("readonly",Pe.getValidationAttributeValue(pe,"readonly")),e._6D("required",Pe.getValidationAttributeValue(pe,"mandatory")),e.E7m("formControlName",pe.name)}}function Me(De,et){if(1&De){const he=e.KQA();e.I0R(0,"mat-checkbox",50),e.qCj("change",function(Pe){e.usT(he);const $e=e.GaO(2).$implicit,ut=e.GaO(3).$implicit,st=e.GaO();return e.CGJ(st.onBooleanValueChange(ut.name,$e.record,Pe))}),e.C$Y()}if(2&De){const he=e.GaO(2).$implicit,pe=e.GaO(3).$implicit;e.E7m("formControlName",pe.name)("checked",he.cellData[pe.name].value)}}function ct(De,et){if(1&De&&(e.I0R(0,"mat-option",53),e.OEk(1),e.C$Y()),2&De){const he=et.$implicit;e.E7m("value",he.id)("disabled",he.disabled),e.yG2(),e.oRS(" ",he.value," ")}}function Oe(De,et){if(1&De){const he=e.KQA();e.I0R(0,"mat-select",51),e.qCj("selectionChange",function(Pe){e.usT(he);const $e=e.GaO(2).$implicit,ut=e.GaO(3).$implicit,st=e.GaO();return e.CGJ(st.onSelectValueChange(ut.name,$e.record,Pe))}),e.yuY(1,ct,2,3,"mat-option",52),e.C$Y()}if(2&De){const he=e.GaO(2).$implicit,pe=e.GaO(3).$implicit,Pe=e.GaO();e._6D("required",Pe.getValidationAttributeValue(pe,"mandatory")),e.E7m("formControlName",pe.name)("multiple",pe.multiple)("value",he.cellData[pe.name].value),e.yG2(),e.E7m("ngForOf",pe.domainValues)}}function He(De,et){if(1&De&&e.wR5(0,"input",54),2&De){e.GaO();const he=e.Gew(9),pe=e.GaO().$implicit,Pe=e.GaO(3).$implicit,$e=e.GaO();e._6D("required",$e.getValidationAttributeValue(Pe,"mandatory")),e._6D("value",pe.cellData[Pe.name].value),e._6D("readonly",$e.getValidationAttributeValue(Pe,"readonly")),e.E7m("formControlName",Pe.name)("matAutocomplete",he)}}function ze(De,et){if(1&De&&(e.I0R(0,"mat-option",55),e.OEk(1),e.C$Y()),2&De){const he=et.$implicit;e.E7m("value",he.id),e.yG2(),e.oRS(" ",he.value," ")}}function Rt(De,et){if(1&De){const he=e.KQA();e.I0R(0,"td",32),e.yuY(1,je,5,4,"div",33)(2,Ve,1,1,"input",34)(3,ot,1,7,"input",35)(4,lt,1,4,"input",36)(5,Me,1,2,"mat-checkbox",37)(6,Oe,2,5,"mat-select",38)(7,He,1,5,"input",39),e.I0R(8,"mat-autocomplete",40,41),e.qCj("optionSelected",function(Pe){e.usT(he);const $e=e.GaO().$implicit,ut=e.GaO(3).$implicit,st=e.GaO();return e.CGJ(st.onAutocompleteValueChange(ut,$e.record,Pe))}),e.yuY(10,ze,2,2,"mat-option",42),e.wVc(11,"async"),e.C$Y()()}if(2&De){const he=e.GaO().$implicit,pe=e.GaO(3).$implicit,Pe=e.GaO();e.E7m("formGroup",Pe.formGroup)("ngClass",he.cellData[pe.name].class),e.yG2(),e.E7m("ngIf","date"===pe.type),e.yG2(),e.E7m("ngIf","time"===pe.type),e.yG2(),e.E7m("ngIf","number"===pe.type),e.yG2(),e.E7m("ngIf",!pe.type||"string"===pe.type),e.yG2(),e.E7m("ngIf","boolean"===pe.type),e.yG2(),e.E7m("ngIf","list"===pe.type),e.yG2(),e.E7m("ngIf","autocomplete"===pe.type),e.yG2(3),e.E7m("ngForOf",e.kDX(11,10,Pe.filteredOptions[pe.name]))}}function Ft(De,et){if(1&De&&(e.wR5(0,"td",29),e.wVc(1,"sanitizeHtml")),2&De){const he=e.GaO(2).$implicit,pe=e.GaO(3).$implicit;e.E7m("ngClass",he.cellData[pe.name].class)("innerHTML",e.kDX(1,2,he.cellData[pe.name].value),e.E3n)}}function Et(De,et){if(1&De&&(e.wR5(0,"img",26),e.wVc(1,"async"),e.wVc(2,"secureImage")),2&De){const he=e.GaO(3).$implicit,pe=e.GaO(3).$implicit;e._6D("src",e.kDX(1,1,e.kDX(2,3,he.cellData[pe.name].value)),e.K6U)}}function ko(De,et){1&De&&(e.I0R(0,"span"),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&De&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.geo.targetHtmlUrl")," "))}function so(De,et){if(1&De&&(e.I0R(0,"td",22)(1,"a",23),e.qCj("click",function(pe){return pe.stopPropagation()}),e.yuY(2,Et,3,5,"img",24)(3,ko,3,3,"ng-template",null,25,e.gJz),e.C$Y()()),2&De){const he=e.Gew(4),pe=e.GaO(2).$implicit,Pe=e.GaO(3).$implicit;e.E7m("ngClass",pe.cellData[Pe.name].class),e.yG2(),e._6D("href",pe.cellData[Pe.name].value,e.K6U),e.yG2(),e.E7m("ngIf",pe.cellData[Pe.name].isImg)("ngIfElse",he)}}function Si(De,et){if(1&De&&e.yuY(0,Ft,2,4,"td",27)(1,so,5,4,"ng-template",null,56,e.gJz),2&De){const he=e.Gew(2),pe=e.GaO().$implicit,Pe=e.GaO(3).$implicit;e.E7m("ngIf",!pe.cellData[Pe.name].isUrl)("ngIfElse",he)}}function bi(De,et){if(1&De&&(e.SAx(0),e.yuY(1,Rt,12,12,"td",30)(2,Si,3,2,"ng-template",null,31,e.gJz),e.k70()),2&De){const he=et.$implicit,pe=e.Gew(3),Pe=e.GaO(4);e.yG2(),e.E7m("ngIf",Pe.isEdition(he.record))("ngIfElse",pe)}}function Bi(De,et){1&De&&(e.SAx(0),e.yuY(1,bi,4,2,"ng-container",19),e.k70())}function Ke(De,et){if(1&De){const he=e.KQA();e.I0R(0,"mat-icon",59),e.qCj("click",function(Pe){e.usT(he);const $e=e.GaO(4).$implicit;return e.CGJ($e.onClick(Pe))}),e.OEk(1),e.C$Y()}if(2&De){const he=e.GaO().$implicit,pe=e.GaO(3).$implicit;e.yG2(),e.cNF(he.cellData[pe.name].value||pe.icon)}}function Ze(De,et){if(1&De&&(e.I0R(0,"mat-icon"),e.OEk(1),e.C$Y()),2&De){const he=e.GaO().$implicit,pe=e.GaO(3).$implicit;e.yG2(),e.cNF(he.cellData[pe.name].value||pe.icon)}}function dt(De,et){if(1&De&&(e.I0R(0,"td",22),e.yuY(1,Ke,2,1,"mat-icon",58)(2,Ze,2,1,"mat-icon",10),e.C$Y()),2&De){const he=et.$implicit,pe=e.GaO(3).$implicit;e.E7m("ngClass",he.cellData[pe.name].class),e.yG2(),e.E7m("ngIf",pe.onClick),e.yG2(),e.E7m("ngIf",!pe.onClick)}}function ht(De,et){1&De&&(e.SAx(0),e.yuY(1,dt,3,3,"td",57),e.k70())}function lo(De,et){if(1&De){const he=e.KQA();e.I0R(0,"button",63),e.qCj("mousedown",function(){e.usT(he);const Pe=e.GaO(2).$implicit,$e=e.GaO().$implicit,ut=e.GaO(4);return e.CGJ(ut.onButtonClick(Pe.click,$e.record))}),e.I0R(1,"mat-icon"),e.OEk(2),e.C$Y()()}if(2&De){const he=e.GaO(2).$implicit;e.E7m("color",he.color)("disabled",he.disabled),e.yG2(2),e.cNF(he.icon)}}function Ht(De,et){if(1&De){const he=e.KQA();e.I0R(0,"button",64),e.qCj("mousedown",function(){e.usT(he);const Pe=e.GaO(2).$implicit,$e=e.GaO().$implicit,ut=e.GaO(4);return e.CGJ(ut.onButtonClick(Pe.click,$e.record))}),e.I0R(1,"mat-icon"),e.OEk(2),e.C$Y()()}if(2&De){const he=e.GaO(2).$implicit;e.E7m("color",he.color)("disabled",he.disabled),e.yG2(2),e.cNF(he.icon)}}function mt(De,et){if(1&De&&(e.SAx(0),e.yuY(1,lo,3,3,"button",61)(2,Ht,3,3,"button",62),e.k70()),2&De){const he=e.GaO().$implicit;e.yG2(),e.E7m("ngIf","mat-icon-button"===he.style),e.yG2(),e.E7m("ngIf","mat-icon-button"!==he.style)}}function Eo(De,et){if(1&De&&(e.I0R(0,"span"),e.yuY(1,mt,3,2,"ng-container",10),e.C$Y()),2&De){const he=et.$implicit,pe=e.GaO().$implicit,Pe=e.GaO(4);e.yG2(),e.E7m("ngIf",Pe.isEdition(pe.record)===he.editMode||void 0===he.editMode)}}function Lt(De,et){if(1&De&&(e.SAx(0),e.I0R(1,"td",22),e.yuY(2,Eo,2,1,"span",60),e.C$Y(),e.k70()),2&De){const he=et.$implicit,pe=e.GaO(3).$implicit;e.yG2(),e.E7m("ngClass",he.cellData[pe.name].class),e.yG2(),e.E7m("ngForOf",he.cellData[pe.name].value)}}function Ho(De,et){1&De&&(e.SAx(0),e.yuY(1,Lt,3,2,"ng-container",19),e.k70())}function qo(De,et){if(1&De&&(e.SAx(0),e.yuY(1,nt,2,0,"ng-container",10)(2,Ie,2,0,"ng-container",10)(3,Bi,2,0,"ng-container",10)(4,ht,2,0,"ng-container",10)(5,Ho,2,0,"ng-container",10),e.k70()),2&De){const he=et.ngIf,pe=e.GaO(2);e.yG2(),e.E7m("ngIf",he===pe.entityTableColumnRenderer.Default),e.yG2(),e.E7m("ngIf",he===pe.entityTableColumnRenderer.HTML),e.yG2(),e.E7m("ngIf",he===pe.entityTableColumnRenderer.UnsanitizedHTML),e.yG2(),e.E7m("ngIf",he===pe.entityTableColumnRenderer.Icon),e.yG2(),e.E7m("ngIf",he===pe.entityTableColumnRenderer.ButtonGroup)}}function Ro(De,et){if(1&De&&(e.SAx(0,14),e.yuY(1,ae,2,0,"ng-container",10)(2,oe,2,0,"ng-container",10)(3,qo,6,5,"ng-container",10),e.k70()),2&De){const he=et.$implicit,pe=e.GaO();e.E7m("matColumnDef",he.name),e.yG2(),e.E7m("ngIf",pe.columnIsSortable(he)),e.yG2(),e.E7m("ngIf",!pe.columnIsSortable(he)),e.yG2(),e.E7m("ngIf",pe.getColumnRenderer(he))}}function xt(De,et){if(1&De&&e.wR5(0,"tr",65),2&De){const he=e.GaO();e.E7m("ngClass",he.getHeaderClass())}}function zt(De,et){if(1&De){const he=e.KQA();e.I0R(0,"tr",66),e.qCj("select",function(){const $e=e.usT(he).$implicit,ut=e.GaO();return e.CGJ(ut.onRowSelect($e.record))})("click",function(){const $e=e.usT(he).$implicit,ut=e.GaO();return e.CGJ(ut.onRowClick($e.record))}),e.C$Y()}if(2&De){const he=et.$implicit,pe=e.GaO();e.E7m("scrollBehavior",pe.scrollBehavior)("ngClass",pe.getRowClass(he.record))("selection",pe.selection)("selected",pe.rowIsSelected(he.record))}}function Ut(De,et){if(1&De){const he=e.KQA();e.I0R(0,"igo-entity-table-paginator",67),e.qCj("paginatorChange",function(Pe){e.usT(he);const $e=e.GaO();return e.CGJ($e.paginatorChange(Pe))}),e.C$Y()}if(2&De){const he=e.GaO();e.E7m("store",he.store)("paginatorOptions",he.paginatorOptions)("entitySortChange$",he.entitySortChange$)}}const ei=De=>({height:De});let Xt=(()=>{class De{cdRef;formBuilder;_focusMonitor;_elementRef;ngControl;_parentForm;_controlName;_defaultErrorStateMatcher;dateAdapter;entitySortChange$=new Z.g(!1);formGroup=new d.k1({});filteredOptions={};entityTableColumnRenderer=G.G8;entityTableSelectionState=G.mi;selectionState$=new Z.g(void 0);selection$$;dataSource$$;lastRecordCheckedKey;store;set paginator(he){this._paginator=he,this.dataSource.paginator=he}get paginator(){return this._paginator}_paginator;template;scrollBehavior=G.qK.Auto;sortNullsFirst=!1;withPaginator=!1;paginatorOptions;entityClick=new e._w7;entitySelectChange=new e._w7;entitySortChange=new e._w7(void 0);get headers(){let he=this.template.columns.filter(pe=>!1!==pe.visible).map(pe=>pe.name);return!0===this.selectionCheckbox&&(he=["selectionCheckbox"].concat(he)),he}dataSource=new F._c;get selection(){return this.template.selection||!1}get selectionCheckbox(){return this.template.selectionCheckbox||!1}get selectMany(){return this.template.selectMany||!1}get fixedHeader(){return void 0===this.template.fixedHeader||this.template.fixedHeader}get tableHeight(){return this.template.tableHeight?this.template.tableHeight:"auto"}constructor(he,pe,Pe,$e,ut,st,Wt,xe,$t){this.cdRef=he,this.formBuilder=pe,this._focusMonitor=Pe,this._elementRef=$e,this.ngControl=ut,this._parentForm=st,this._controlName=Wt,this._defaultErrorStateMatcher=xe,this.dateAdapter=$t,this.dateAdapter.setLocale("fr-CA")}ngOnInit(){this.handleDatasource(),this.dataSource.paginator=this.paginator,this.store.state.change$.pipe((0,X.o)(100)).subscribe(()=>{this.handleDatasource(),this.refresh()})}ngOnChanges(he){const pe=he.store;pe&&pe.currentValue!==pe.previousValue&&this.handleDatasource()}onValueChange(he,pe,Pe){const $e=this.getColumnKeyWithoutPropertiesTag(he);pe.entity.properties[$e]=Pe.target.value}onBooleanValueChange(he,pe,Pe){const $e=this.getColumnKeyWithoutPropertiesTag(he);pe.entity.properties[$e]=Pe.checked}onSelectValueChange(he,pe,Pe){const $e=this.getColumnKeyWithoutPropertiesTag(he);pe.entity.properties[$e]=Pe.value}onAutocompleteValueChange(he,pe,Pe){this.formGroup.controls[he.name].setValue(Pe.option.viewValue);const $e=this.getColumnKeyWithoutPropertiesTag(he.name);pe.entity.properties[$e]=Pe.option.value}onDateChange(he,pe,Pe){const ut=te()(Pe.value).format("YYYY-MM-DD"),st=this.getColumnKeyWithoutPropertiesTag(he);pe.entity.properties[st]=ut}enableEdit(he){const pe=he.entity.properties||he.entity;this.template.columns.forEach(Pe=>{Pe.title=Pe.validation?.mandatory&&!Pe.title.includes("*")?Pe.title+" *":Pe.title;const $e=this.getColumnKeyWithoutPropertiesTag(Pe.name);if("boolean"===Pe.type)pe[$e]&&null!==pe[$e]?"string"==typeof pe[$e]&&(pe[$e]=JSON.parse(pe[$e].toLowerCase())):pe[$e]=!1,this.formGroup.setControl(Pe.name,this.formBuilder.control(pe[$e]));else if("list"===Pe.type)Pe.multiple?this.formGroup.setControl(Pe.name,this.formBuilder.control([pe[$e]])):(this.formGroup.setControl(Pe.name,this.formBuilder.control(pe[$e])),this.formGroup.controls[Pe.name].setValue("string"==typeof pe[$e]?parseInt(pe[$e]):pe[$e]));else if("autocomplete"===Pe.type){this.formGroup.setControl(Pe.name,this.formBuilder.control(pe[$e])),this.filteredOptions[Pe.name]=new K._,this.filteredOptions[Pe.name]=this.formGroup.controls[Pe.name].valueChanges.pipe((0,V.k)(st=>{if(st?.length)return Pe.domainValues?.filter(Wt=>{const xe=st?st.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"";return Wt.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(xe)})}));let ut=pe[$e];if(Pe.domainValues.forEach(st=>{"string"==typeof ut&&W.eU.isValidNumber(ut)&&!W.eU.isOctalNumber(ut)&&(ut=parseInt(ut)),(st.value===ut||st.id===ut)&&(ut=st.value)}),this.formGroup.controls[Pe.name].setValue(ut),this.isEdition(he)&&Pe.linkColumnForce){const st=he.entity;this.formGroup.controls[Pe.name].setValue(st?.properties[this.getColumnKeyWithoutPropertiesTag(Pe.linkColumnForce)])}}else if("date"===Pe.type){if(!1!==Pe.visible)if(pe[$e]){let ut=te()(pe[$e]);pe[$e]=ut.utc().format("YYYY-MM-DD"),this.formGroup.setControl(Pe.name,this.formBuilder.control(pe[$e]))}else{const ut=this.getColumnKeyWithoutPropertiesTag(Pe.name);he.entity.properties[ut]=null,this.formGroup.setControl(Pe.name,this.formBuilder.control(null))}}else this.formGroup.setControl(Pe.name,this.formBuilder.control(pe[$e]));this.formGroup.controls[Pe.name]&&this.getValidationAttributeValue(Pe,"readonly")&&this.formGroup.controls[Pe.name].disable()})}handleDatasource(){this.unsubscribeStore(),this.selection$$=this.store.stateView.manyBy$(he=>!0===he.state.selected).subscribe(he=>{const pe=he[0],Pe=this.store.stateView.all().indexOf(pe),$e=this.paginator?this.paginator.pageSize*(this.paginator.pageIndex+1):0;if(this.paginator&&(Pe<(this.paginator?$e-this.paginator.pageSize:0)||Pe>=$e)){const st=Math.floor(Pe/this.paginator.pageSize);this.dataSource.paginator.pageIndex=st}this.selectionState$.next(this.computeSelectionState(he))}),this.dataSource$$=this.store.stateView.all$().subscribe(he=>{he[0]&&this.enableEdit(he[0]),this.dataSource.data=he.map(pe=>({record:pe,cellData:this.template.columns.reduce((Pe,$e)=>{const ut=this.getValue(pe,$e);return Pe[$e.name]={class:this.getCellClass(pe,$e),value:ut,isUrl:this.isUrl(ut),isImg:this.isImg(ut)},Pe},{})}))})}ngOnDestroy(){this.unsubscribeStore()}unsubscribeStore(){this.selection$$&&this.selection$$.unsubscribe(),this.dataSource$$&&this.dataSource$$.unsubscribe()}getTrackByFunction(){return(he,pe)=>pe.record.ref}refresh(){this.cdRef.detectChanges()}paginatorChange(he){this.paginator=he}onSort(he){const pe=he.direction,Pe=this.template.columns.find($e=>$e.name===he.active);"asc"===pe||"desc"===pe?(this.store.stateView.sort({valueAccessor:$e=>this.getValue($e,Pe),direction:pe,nullsFirst:this.sortNullsFirst}),this.entitySortChange.emit({column:Pe,direction:pe}),this.entitySortChange$.next(!0)):this.store.stateView.sort(void 0)}onRowClick(he){this.lastRecordCheckedKey=this.store.stateView.getKey(he),this.entityClick.emit(he.entity)}onRowSelect(he){if(!1===this.selection)return;const pe=he.entity;this.store.state.update(pe,{selected:!0},!0),this.entitySelectChange.emit({added:[pe]})}onToggleRows(he){if(!1===this.selection)return;const pe=this.store.view.all();this.entitySelectChange.emit({added:[pe]}),this.store.state.updateMany(pe,{selected:he})}onToggleRow(he,pe){if(!1===this.selection)return;const Pe=pe.entity;this.store.state.update(Pe,{selected:he},!0===he&&!this.selectMany),!0===he&&this.entitySelectChange.emit({added:[Pe]}),this.lastRecordCheckedKey=this.store.stateView.getKey(pe)}onShiftToggleRow(he,pe,Pe){if(!1===this.selection)return;if(!1===this.selectMany||void 0===this.lastRecordCheckedKey)return void this.onToggleRow(he,pe);const $e=window.document.createRange();$e.selectNode(Pe.target),window.getSelection().removeAllRanges(),window.getSelection().addRange($e),Pe.stopImmediatePropagation();const ut=this.store.stateView.all(),st=ut.indexOf(pe),Wt=this.store.stateView.get(this.lastRecordCheckedKey),$t=[st,ut.indexOf(Wt)],Ot=ut.slice(Math.min(...$t),Math.max(...$t)+1).map(kt=>kt.entity);this.store.state.updateMany(Ot,{selected:he}),!0===he&&this.entitySelectChange.emit({added:Ot}),this.lastRecordCheckedKey=this.store.stateView.getKey(pe)}computeSelectionState(he){const pe=G.mi,Pe=he.length;return 0===Pe?pe.None:Pe===this.store.stateView.count?pe.All:pe.Some}columnIsSortable(he){let pe=he.sort;return void 0===pe&&(pe=void 0!==this.template.sort&&this.template.sort),pe}rowIsSelected(he){const pe=he.state;return!!pe.selected&&pe.selected}isImg(he){return!!this.isUrl(he)&&-1!==["jpg","png","gif"].indexOf(he.split(".").pop().toLowerCase())}isUrl(he){return"string"==typeof he&&("https://"===he.slice(0,8)||"http://"===he.slice(0,7))}getValue(he,pe){const Pe=he.entity;let $e;if(void 0!==pe.valueAccessor)return pe.valueAccessor(Pe,he);if(void 0!==this.template.valueAccessor)return this.template.valueAccessor(Pe,pe.name,he);if($e=this.store.getProperty(Pe,pe.name),"boolean"===pe.type)null==$e||""===$e?$e=!1:"boolean"!=typeof $e&&void 0!==$e&&($e="number"==typeof $e?!!$e:JSON.parse($e.toLowerCase())),this.isEdition(he)||($e=$e?"&#10003;":"");else if("list"===pe.type&&$e&&pe.domainValues){const ut=he.entity;if(pe.multiple){let st;st="string"==typeof $e?$e.match(/[\w.-]+/g).map(Number):$e;let Wt=[];pe.domainValues.forEach(xe=>{st.includes(xe.id)&&Wt.push(he.edition?xe.id:xe.value)}),$e=this.isEdition(he)?st:Wt}else!this.isEdition(he)&&pe.linkColumnForce?$e=ut?.properties[this.getColumnKeyWithoutPropertiesTag(pe.linkColumnForce)]:pe.domainValues.forEach(st=>{"string"==typeof $e&&W.eU.isValidNumber($e)&&!W.eU.isOctalNumber($e)&&($e=parseInt($e)),(st.value===$e||st.id===$e)&&($e=this.isEdition(he)?st.id:st.value)})}else if("autocomplete"===pe.type&&$e&&pe.domainValues){const ut=he.entity;!this.isEdition(he)&&pe.linkColumnForce?$e=ut?.properties[this.getColumnKeyWithoutPropertiesTag(pe.linkColumnForce)]:pe.domainValues.forEach(st=>{"string"==typeof $e&&W.eU.isValidNumber($e)&&!W.eU.isOctalNumber($e)&&($e=parseInt($e)),(st.value===$e||st.id===$e)&&($e=st.value)})}else"date"===pe.type&&(this.isEdition(he)?$e&&($e=te()($e).format(),this.formGroup.controls[pe.name].setValue($e)):!this.isEdition(he)&&null===$e&&($e=""));return void 0===$e&&($e=""),$e}getValidationAttributeValue(he,pe){return void 0!==he.validation&&void 0!==he.validation[pe]&&he.validation[pe]}isEdition(he){return!!he.entity.edition}getColumnRenderer(he){return void 0!==he.renderer?he.renderer:G.G8.Default}getTableClass(){return{"igo-entity-table-with-selection":this.selection}}getHeaderClass(){const he=this.template.headerClassFunc;return he instanceof Function?he():{}}getRowClass(he){const Pe=this.template.rowClassFunc;return Pe instanceof Function?Pe(he.entity,he):{}}getCellClass(he,pe){const Pe=he.entity,$e={},ut=this.template.cellClassFunc;ut instanceof Function&&Object.assign($e,ut(Pe,pe,he));const st=pe.cellClassFunc;return st instanceof Function&&Object.assign($e,st(Pe,he)),$e}onButtonClick(he,pe){this.enableEdit(pe),"function"==typeof he&&he(pe.entity,pe)}getColumnKeyWithoutPropertiesTag(he){return he.includes("properties.")?he.split(".")[1]:he}static \u0275fac=function(pe){return new(pe||De)(e.GI1(e.kD9),e.GI1(d.KE),e.GI1(M.Kk),e.GI1(e.GMv),e.GI1(d.eq,10),e.GI1(d.SC,8),e.GI1(d.Wo,8),e.GI1(h.u9),e.GI1(h.Wu))};static \u0275cmp=e.In1({type:De,selectors:[["igo-entity-table"]],inputs:{store:"store",paginator:"paginator",template:"template",scrollBehavior:"scrollBehavior",sortNullsFirst:"sortNullsFirst",withPaginator:"withPaginator",paginatorOptions:"paginatorOptions"},outputs:{entityClick:"entityClick",entitySelectChange:"entitySelectChange",entitySortChange:"entitySortChange"},standalone:!0,features:[e.M5G([{provide:y.u0,useExisting:De},(0,L.CA)()]),e.SYr,e.UHJ],decls:9,vars:11,consts:[[1,"table-container",3,"ngStyle"],["id","currentWorkspaceTable","mat-table","","matSort","",3,"ngClass","dataSource","trackBy","matSortChange"],["matColumnDef","selectionCheckbox",1,"mat-cell-checkbox"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",3,"ngClass",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","igoEntityTableRow","",3,"scrollBehavior","ngClass","selection","selected","select","click",4,"matRowDef","matRowDefColumns"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange",4,"ngIf"],["mat-header-cell",""],[4,"ngIf"],[3,"checked","indeterminate","change"],["mat-cell",""],[3,"checked","mousedown","click","change"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",3,"matTooltip",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header","",3,"matTooltip"],["mat-header-cell","",3,"matTooltip",4,"matHeaderCellDef"],["mat-header-cell","",3,"matTooltip"],[4,"matCellDef"],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"ngIf","ngIfElse"],["isAnUrlDefault",""],["mat-cell","",1,"mat-cell-text",3,"ngClass"],["target","_blank","rel","noopener noreferrer",3,"href","click"],["igoImageError","","width","50","heigth","auto",3,"src",4,"ngIf","ngIfElse"],["notImg",""],["igoImageError","","width","50","heigth","auto",3,"src"],["mat-cell","","class","mat-cell-text",3,"ngClass","innerHTML",4,"ngIf","ngIfElse"],["isAnUrlHTML",""],["mat-cell","",1,"mat-cell-text",3,"ngClass","innerHTML"],["mat-cell","","class","mat-cell-text edition",3,"formGroup","ngClass",4,"ngIf","ngIfElse"],["isUnsanitizedHTML",""],["mat-cell","",1,"mat-cell-text","edition",3,"formGroup","ngClass"],["class","date-picker",4,"ngIf"],["matInput","","type","time","step","900",3,"formControlName","focus","keypress","blur",4,"ngIf"],["matInput","","type","number","class","class_number_edition",3,"formControlName","step","value","readonly","required","min","max","input",4,"ngIf"],["matInput","","type","text",3,"formControlName","value","readonly","required","input",4,"ngIf"],[3,"formControlName","checked","change",4,"ngIf"],[3,"required","formControlName","multiple","value","selectionChange",4,"ngIf"],["matInput","","type","text",3,"formControlName","matAutocomplete","required","value","readonly",4,"ngIf"],["panelWidth","430px",3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"date-picker"],["matSuffix","",3,"for"],["matInput","",3,"matDatepicker","formControlName","value","dateChange"],["picker",""],["matInput","","type","time","step","900",3,"formControlName","focus","keypress","blur"],["matInput","","type","number",1,"class_number_edition",3,"formControlName","step","value","readonly","required","min","max","input"],["matInput","","type","text",3,"formControlName","value","readonly","required","input"],[3,"formControlName","checked","change"],[3,"required","formControlName","multiple","value","selectionChange"],[3,"value","disabled",4,"ngFor","ngForOf"],[3,"value","disabled"],["matInput","","type","text",3,"formControlName","matAutocomplete","required","value","readonly"],[3,"value"],["isAnUrlUnsanitizedHTML",""],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"matCellDef"],[3,"click",4,"ngIf"],[3,"click"],[4,"ngFor","ngForOf"],["igoStopPropagation","","mat-icon-button","",3,"color","disabled","mousedown",4,"ngIf"],["igoStopPropagation","","mat-mini-fab","",3,"color","disabled","mousedown",4,"ngIf"],["igoStopPropagation","","mat-icon-button","",3,"color","disabled","mousedown"],["igoStopPropagation","","mat-mini-fab","",3,"color","disabled","mousedown"],["mat-header-row","",3,"ngClass"],["mat-row","","igoEntityTableRow","",3,"scrollBehavior","ngClass","selection","selected","select","click"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange"]],template:function(pe,Pe){1&pe&&(e.I0R(0,"div",0)(1,"table",1),e.qCj("matSortChange",function(ut){return Pe.onSort(ut)}),e.SAx(2,2),e.yuY(3,de,2,1,"th",3)(4,fe,2,1,"td",4),e.k70(),e.yuY(5,Ro,4,4,"ng-container",5)(6,xt,1,1,"tr",6)(7,zt,1,4,"tr",7),e.C$Y(),e.yuY(8,Ut,1,3,"igo-entity-table-paginator",8),e.C$Y()),2&pe&&(e.E7m("ngStyle",e.S45(9,ei,Pe.tableHeight)),e.yG2(),e.E7m("ngClass",Pe.getTableClass())("dataSource",Pe.dataSource)("trackBy",Pe.getTrackByFunction()),e.yG2(4),e.E7m("ngForOf",Pe.template.columns),e.yG2(),e.E7m("matHeaderRowDef",Pe.headers)("matHeaderRowDefSticky",Pe.fixedHeader),e.yG2(),e.E7m("matRowDefColumns",Pe.headers),e.yG2(),e.E7m("ngIf",Pe.withPaginator))},dependencies:[C.a,b.I,U,d.y,d.ot,d.O4,d.ue,d.u,d.eJ,d.Gu,d._t,z.M,P.U1,P.e,h.I5,P.cG,o.oJ,o.um,o.CI,f.Vn,f.WK,R.iU,R.SU,R.Ul,R.yu,y.wb,y.Gm,O.oB,O.qL,x.cN,x.yi,h.Ko,h.Ax,T.d5,T.kX,a.Su,a.E9,a.e6,F.If,F.wL,F.ie,F.aG,F.Af,F.uc,F.gx,F.qC,F.cX,F.yC,F._I,A.KO,A.a4,C.QF,C.Iw,C.u_,C.Qt,d.sl,d.uW,d.Wo,B.U,c.k,I.m,k._s,H.sD],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}.table-compact[_nghost-%COMP%]   tr.mat-mdc-header-row[_ngcontent-%COMP%], .table-compact[_nghost-%COMP%]     mat-checkbox .mat-ripple{height:36px}.table-compact[_nghost-%COMP%]   tr.mat-mdc-row[_ngcontent-%COMP%], .table-compact[_nghost-%COMP%]     mat-checkbox .mat-ripple{height:28px}[_nghost-%COMP%]   .table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto;flex:1 1 auto}[_nghost-%COMP%]   .mat-cell-text[_ngcontent-%COMP%]{overflow:hidden;word-wrap:break-word}[_nghost-%COMP%]   entity-table[_ngcontent-%COMP%]   table.igo-entity-table-with-selection[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{-o-box-shadow:2px 0px 2px 0px #dddddd;box-shadow:2px 0 2px #ddd;cursor:pointer}[_nghost-%COMP%]   table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:7px}[_nghost-%COMP%]   .class_hidden[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]   .class_display_none[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .class_boolean[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_number[_ngcontent-%COMP%]{text-align:center;padding-right:35px!important}[_nghost-%COMP%]   .class_string[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_text[_ngcontent-%COMP%], [_nghost-%COMP%]   .class_number_edition[_ngcontent-%COMP%]{text-align:left}[_nghost-%COMP%]   td.edition[_ngcontent-%COMP%]{background:#a6a6a633}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{border-bottom:1px solid darkgrey}"],changeDetection:0})}return De})()},68488:(Fe,ce,r)=>{"use strict";r.d(ce,{sh:()=>C.s,qc:()=>L.qc,qq:()=>L.qq,xx:()=>L.xx,uk:()=>L.uk,YX:()=>L.YX,G8:()=>L.G8,Eh:()=>d.E,I7:()=>e.I,qK:()=>L.qK,sH:()=>L.sH,_I:()=>L._I,u6:()=>L.u6,mU:()=>L.mU,YB:()=>L.YB,E$:()=>L.E$});var C=r(66165),e=r(800),d=r(14944),L=r(80544)},72672:(Fe,ce,r)=>{"use strict";r.d(ce,{G8:()=>e,mi:()=>L,qK:()=>d});var e=function(P){return P.Default="Default",P.HTML="HTML",P.UnsanitizedHTML="UnsanitizedHTML",P.Editable="Editable",P.Icon="Icon",P.ButtonGroup="ButtonGroup",P}(e||{}),d=function(P){return P.Auto="auto",P.Instant="instant",P.Smooth="smooth",P}(d||{}),L=function(P){return P.None="None",P.All="All",P.Some="Some",P}(L||{})},22788:(Fe,ce,r)=>{"use strict";r.d(ce,{E$:()=>P,YB:()=>L,_I:()=>d,mU:()=>f,sH:()=>o,u6:()=>e});var C=r(63596);function e(h,R){return(0,C.t)(h,R).safeObject}function d(h){const R=h.meta||{};return R.id?R.id:e(h,R.idProperty||"id")}function L(h){const R=h.meta||{};return R.title?R.title:e(h,R.titleProperty||"title")}function P(h){const R=h.meta||{};return R.titleHtml?R.titleHtml:e(h,R.titleHtmlProperty||"titleHtml")}function o(h){const R=h.meta||{};return R.icon?R.icon:e(h,R.iconProperty||"icon")}function f(h){return(h.meta||{}).revision||0}},80544:(Fe,ce,r)=>{"use strict";r.d(ce,{qc:()=>d.q,qq:()=>y,xx:()=>O,uk:()=>R,YX:()=>P.Y,G8:()=>C.G8,qK:()=>C.qK,mi:()=>C.mi,sH:()=>e.sH,_I:()=>e._I,u6:()=>e.u6,mU:()=>e.mU,YB:()=>e.YB,E$:()=>e.E$});var C=r(72672),e=r(22788),d=r(63892),P=(r(64868),r(87556));r(27060);var h=r(54844);class R{options;stores=[];get active(){return this.active$.value}active$=new h.g(!1);constructor(T={}){this.options=T,this.options=T}activate(){!0===this.active&&this.doDeactivate(),this.active$.next(!0),this.doActivate()}deactivate(){this.active$.next(!1),this.doDeactivate()}bindStore(T){this.stores.indexOf(T)<0&&this.stores.push(T)}unbindStore(T){const a=this.stores.indexOf(T);a>=0&&this.stores.splice(a,1)}doActivate(){}doDeactivate(){}}class y extends R{options;constructor(T){super(T),this.options=T}filters=new Map;bindStore(T){super.bindStore(T),!0===this.active&&this.filterStore(T)}unbindStore(T){super.unbindStore(T),!0===this.active&&this.unfilterStore(T)}doActivate(){this.filterAll()}doDeactivate(){this.unfilterAll()}filterAll(){this.stores.forEach(T=>this.filterStore(T))}unfilterAll(){this.stores.forEach(T=>this.unfilterStore(T))}filterStore(T){this.filters.set(T,T.stateView.addFilter(this.options.filterClauseFunc))}unfilterStore(T){const a=this.filters.get(T);void 0!==a&&(T.stateView.removeFilter(a),this.filters.delete(T))}}class O extends R{filters=new Map;bindStore(T){super.bindStore(T),!0===this.active&&this.filterStore(T)}unbindStore(T){super.unbindStore(T),!0===this.active&&this.unfilterStore(T)}doActivate(){this.filterAll()}doDeactivate(){this.unfilterAll()}filterAll(){this.stores.forEach(T=>this.filterStore(T))}unfilterAll(){this.stores.forEach(T=>this.unfilterStore(T))}filterStore(T){this.filters.has(T)||this.filters.set(T,T.stateView.addFilter(F=>!0===F.state.selected))}unfilterStore(T){const a=this.filters.get(T);void 0!==a&&(T.stateView.removeFilter(a),this.filters.delete(T))}}},64868:(Fe,ce,r)=>{"use strict";r.d(ce,{E:()=>d});var C=r(23680),e=r(22788);class d{options;index=new Map;change$=new C.o(1);getKey;constructor(P={}){this.options=P,this.getKey=P.getKey?P.getKey:e._I,this.next()}clear(){this.index.size>0&&(this.index.clear(),this.next())}get(P){return this.index.get(this.getKey(P))||{}}set(P,o){this.setMany([P],o)}setMany(P,o){P.forEach(f=>{this.index.set(this.getKey(f),Object.assign({},o))}),this.next()}setAll(P){Array.from(this.index.keys()).forEach(o=>{this.index.set(o,Object.assign({},P))}),this.next()}update(P,o,f=!1){this.updateMany([P],o,f)}updateMany(P,o,f=!1){if(!0===f)return this.updateManyExclusive(P,o);P.forEach(h=>{const R=Object.assign({},this.get(h),o);this.index.set(this.getKey(h),R)}),this.next()}reverse(P,o){this.reverseMany([P],o)}reverseMany(P,o){P.forEach(f=>{const h=this.get(f),R=o.reduce((x,T)=>(x[T]=h[T]||!1,x),{}),y=this.reverseChanges(R),O=Object.assign({},h,y);this.index.set(this.getKey(f),O)}),this.next()}updateAll(P){const o=this.getAllKeys();Array.from(o).forEach(f=>{const h=Object.assign({},this.index.get(f),P);this.index.set(f,h)}),this.next()}updateManyExclusive(P,o){const f=this.reverseChanges(o),h=P.map(y=>this.getKey(y));new Set(h.concat(Array.from(this.getAllKeys()))).forEach(y=>{const O=this.index.get(y)||{};h.indexOf(y)>=0?this.index.set(y,Object.assign({},O,o)):!0===Object.keys(f).some(T=>void 0!==O[T]&&O[T]!==f[T])&&this.index.set(y,Object.assign({},O,f))}),this.next()}reverseChanges(P){return Object.entries(P).reduce((o,f)=>{const[h,R]=f;return"boolean"==typeof R&&(o[h]=!R),o},{})}getAllKeys(){const P=Array.from(this.options?.index?.keys()??[]);return new Set(Array.from(this.index.keys()).concat(P))}next(){this.change$.next()}}},63892:(Fe,ce,r)=>{"use strict";r.d(ce,{q:()=>P});var C=r(54844),e=r(22788),d=r(64868),L=r(27060);class P{entities$=new C.g([]);count$=new C.g(0);get count(){return this.count$.value}empty$=new C.g(!0);get empty(){return this.empty$.value}state;view;stateView;getKey;getProperty;get index(){return this._index}_index;get pristine(){return this._pristine}_pristine=!0;strategies=[];constructor(f,h={}){this.getKey=h.getKey?h.getKey:e._I,this.getProperty=h.getProperty?h.getProperty:e.u6,this.state=this.createStateManager(),this.view=this.createDataView(),this.stateView=this.createStateView(),this.view.lift(),this.stateView.lift(),f.length>0?this.load(f):this._index=this.generateIndex(f)}get(f){return this.index.get(f)}all(){return this.entities$.value}load(f,h=!0){this._index=this.generateIndex(f),this._pristine=h,this.next()}softClear(){this.index&&this.index.size>0?(this.index.clear(),this._pristine=!0,this.next()):this.index&&this.updateCount()}clear(){this.stateView.clear(),this.view.clear(),this.state.clear(),this.softClear()}destroy(){this.stateView.destroy(),this.view.destroy(),this.clear()}insert(f){this.insertMany([f])}insertMany(f){f.forEach(h=>this.index.set(this.getKey(h),h)),this._pristine=!1,this.next()}update(f){this.updateMany([f])}updateMany(f){f.forEach(h=>this.index.set(this.getKey(h),h)),this._pristine=!1,this.next()}addStrategy(f,h=!1){if(void 0!==this.strategies.find(y=>f.constructor===y.constructor))throw new Error("A strategy of this type already exists on that EntityStore.");return this.strategies.push(f),f.bindStore(this),!0===h&&f.activate(),this}removeStrategy(f){const h=this.strategies.indexOf(f);return h>=0&&(this.strategies.splice(h,1),f.unbindStore(this)),this}getStrategyOfType(f){return this.strategies.find(h=>h instanceof f)}activateStrategyOfType(f){const h=this.getStrategyOfType(f);void 0!==h&&h.activate()}deactivateStrategyOfType(f){const h=this.getStrategyOfType(f);void 0!==h&&h.deactivate()}delete(f){this.deleteMany([f])}deleteMany(f){f.forEach(h=>this.index.delete(this.getKey(h))),this._pristine=!1,this.next()}generateIndex(f){const h=f.map(R=>[this.getKey(R),R]);return new Map(h)}next(){this.entities$.next(Array.from(this.index.values())),this.updateCount()}updateCount(){const f=this.index.size,h=0===f;this.count$.next(f),this.empty$.next(h)}createStateManager(){return new d.E({getKey:this.getKey,index:this.index})}createDataView(){return new L.u(this.entities$)}createStateView(){return new L.u(this.view.all$()).join({source:this.state.change$,reduce:f=>{const h=this.getKey(f),R=this.state.get(f),y=this.stateView.get(h);if(void 0!==y&&y.entity===f&&this.statesAreTheSame(y.state,R))return y;const O=y?y.revision+1:1;return{entity:f,state:R,revision:O,ref:`${h}-${O}`}}}).createIndex(f=>this.getKey(f.entity))}statesAreTheSame(f,h){if(f===h)return!0;const R=0===Object.keys(f).length,y=0===Object.keys(h).length;return R&&y}}},27060:(Fe,ce,r)=>{"use strict";r.d(ce,{u:()=>f});var C=r(43168),e=r(54844),d=r(35876),L=r(40604),P=r(68013),o=r(24112);class f{source$;values$=new e.g([]);values$$;lifted=!1;joins=[];filter$=new e.g(void 0);filters$=new e.g([]);filterIndex=new Map;sort$=new e.g(void 0);get getKey(){return this.getKey$.value}getKey$=new e.g(void 0);count$=new e.g(0);get count(){return this.count$.value}empty$=new e.g(!0);get empty(){return this.empty$.value}get index(){return this._index}_index;constructor(R){this.source$=R}get(R){if(void 0===this._index)throw new Error("This view has no index, therefore, this method is unavailable.");return this.index.get(R)}all(){return this.values$.value}all$(){return this.values$}firstBy(R){return this.values$.value.find(R)}firstBy$(R){return this.values$.pipe((0,L.k)(y=>y.find(R)))}manyBy(R){return this.values$.value.filter(R)}manyBy$(R){return this.values$.pipe((0,L.k)(y=>y.filter(R)))}clear(){this.filter(void 0),this.sort(void 0)}destroy(){void 0!==this.values$$&&this.values$$.unsubscribe(),this.clear()}createIndex(R){return this._index=new Map,this.getKey$.next(R),this}join(R){if(!0===this.lifted)throw new Error("This view has already been lifted, therefore, no join is allowed.");return this.joins.push(R),this}filter(R){return this.filter$.next(R),this}addFilter(R){const y=(0,C.uq)();return this.filterIndex.set(y,R),this.filters$.next(Array.from(this.filterIndex.values())),y}removeFilter(R){this.filterIndex.delete(R),this.filters$.next(Array.from(this.filterIndex.values()))}sort(R){return this.sort$.next(R),this}lift(){this.lifted=!0;const y=[this.joins.length>0?this.liftJoinedSource():this.liftSource(),this.filters$,this.filter$,this.sort$,this.getKey$];this.values$$=(0,d.E)(y).pipe((0,P.s)(1),(0,o.o)(5)).subscribe(O=>{const[x,T,a,F,A]=O,k=this.processValues(x,T,a,F);this.setValues(k,void 0!==A)})}liftSource(){return this.source$}liftJoinedSource(){const R=[this.source$,(0,d.E)(this.joins.map(y=>y.source))];return(0,d.E)(R).pipe((0,L.k)(y=>{const[O,x]=y;return O.reduce((T,a)=>{const F=this.computeJoinedValue(a,x);return void 0!==F&&T.push(F),T},[])}))}computeJoinedValue(R,y){let O=R,x=0;for(;void 0!==O&&x<this.joins.length;)O=this.joins[x].reduce(O,y[x]),x+=1;return O}processValues(R,y,O,x){return R=R.slice(0),R=this.filterValues(R,y.concat([O])),this.sortValues(R,x)}filterValues(R,y){return 0===y.length?R:R.filter(O=>y.filter(x=>void 0!==x).every(x=>x(O)))}sortValues(R,y){return void 0===y?R:R.sort((O,x)=>C.Yv.naturalCompare(y.valueAccessor(O),y.valueAccessor(x),y.direction,y.nullsFirst))}setValues(R,y){!0===y&&(this._index=this.generateIndex(R)),this.values$.next(R);const O=R.length,x=0===O;this.count$.next(O),this.empty$.next(x)}generateIndex(R){const y=R.map(O=>[this.getKey(O),O]);return new Map(y)}}},87556:(Fe,ce,r)=>{"use strict";r.d(ce,{Y:()=>d});var C=r(43168),e=r(68013);class d{cdRef;store;innerStateIndex=new Map;entities$$;state$$;constructor(P,o){this.setChangeDetector(o),this.setStore(P)}destroy(){this.setChangeDetector(void 0),this.setStore(void 0)}setStore(P){if(void 0===P)return this.teardownObservers(),this.innerStateIndex.clear(),void(this.store=void 0);this.setStore(void 0),this.store=P,this.setupObservers(),this.detectChanges()}setChangeDetector(P){this.cdRef=P}setupObservers(){this.teardownObservers(),this.entities$$=this.store.entities$.subscribe(P=>this.onEntitiesChange(P)),this.state$$=this.store.state.change$.pipe((0,e.s)(1)).subscribe(()=>this.onStateChange())}teardownObservers(){void 0!==this.entities$$&&this.entities$$.unsubscribe(),void 0!==this.state$$&&this.state$$.unsubscribe(),this.entities$$=void 0,this.state$$=void 0}onEntitiesChange(P){this.detectChanges()}onStateChange(){let P=!1;const o=this.store.state.index,f=this.innerStateIndex;o.size!==f.size&&(P=this.detectChanges());const h=Array.from(o.keys());for(const R of h){const y=o.get(R),O=f.get(R);!1===P&&(void 0===O?P=this.detectChanges():C.Yv.objectsAreEquivalent(y,O)||(P=this.detectChanges())),this.innerStateIndex.set(R,Object.assign({},y))}}detectChanges(){return void 0!==this.cdRef&&this.cdRef.detectChanges(),!0}}},58136:(Fe,ce,r)=>{"use strict";r.d(ce,{_:()=>f});var C=r(65056),e=r(6316),d=r(25812),L=r(34896),P=r(69368);function o(h,R){if(1&h&&(L.SAx(0),L.wR5(1,"igo-dynamic-outlet",1),L.k70()),2&h){const y=L.GaO();L.yG2(),L.E7m("component",y.getFieldComponent())("inputs",y.getFieldInputs())("subscribers",y.getFieldSubscribers())}}let f=(()=>{class h{formFieldService;field;fieldInputs=void 0;fieldSubscribers=void 0;get fieldOptions(){return this.field.options||{}}constructor(y){this.formFieldService=y}getFieldComponent(){return this.formFieldService.getFieldByType(this.field.type||"text")}getFieldInputs(){if(void 0!==this.fieldInputs)return this.fieldInputs;const y=this.fieldOptions.errors||{};return this.fieldInputs=Object.assign({placeholder:this.field.title,disableSwitch:this.fieldOptions.disableSwitch||!1},Object.assign({},this.field.inputs||{}),{formControl:this.field.control,errors:Object.assign({},(0,d.uu)(),y)}),this.fieldInputs}getFieldSubscribers(){return void 0!==this.fieldSubscribers||(this.fieldSubscribers=Object.assign({},this.field.subscribers||{})),this.fieldSubscribers}static \u0275fac=function(O){return new(O||h)(L.GI1(P.Q))};static \u0275cmp=L.In1({type:h,selectors:[["igo-form-field"]],inputs:{field:"field"},standalone:!0,features:[L.UHJ],decls:1,vars:1,consts:[[4,"ngIf"],[3,"component","inputs","subscribers"]],template:function(O,x){1&O&&L.yuY(0,o,2,3,"ng-container",0),2&O&&L.E7m("ngIf",void 0!==x.field)},dependencies:[C.u_,e.q],styles:["mat-form-field{width:100%}  .igo-form-disable-switch{margin-right:8px}"],changeDetection:0})}return h})()},87004:(Fe,ce,r)=>{"use strict";r.d(ce,{Y:()=>y});var C=r(65056),e=r(34896),d=r(71904),L=r(63596),P=r(25812);const o=["buttons"],f=["*",[["","formButtons",""]]],h=O=>({"igo-form-body-with-buttons":O}),R=["*","[formButtons]"];let y=(()=>{class O{form;formData;autocomplete="off";submitForm=new e._w7;buttons;get hasButtons(){return 0!==this.buttons.nativeElement.children.length}constructor(){}ngOnChanges(T){const a=T.formData;a&&a.currentValue!==a.previousValue&&(void 0===a.currentValue?this.clear():this.setData(a.currentValue))}onSubmit(){this.submitForm.emit(this.getData())}getData(){const T={};return(0,P.aC)(this.form).forEach(a=>{this.updateDataWithFormField(T,a)}),T}setData(T){this.form.fields.forEach(a=>{a.control.setValue((0,L.t)(T,a.name).safeObject)}),this.form.groups.forEach(a=>{a.fields.forEach(F=>{F.control.setValue((0,L.t)(T,F.name).safeObject)})})}updateDataWithFormField(T,a){const F=a.control;F.disabled||(T[a.name]=F.value)}clear(){this.form.control.reset()}static \u0275fac=function(a){return new(a||O)};static \u0275cmp=e.In1({type:O,selectors:[["igo-form"]],viewQuery:function(a,F){if(1&a&&e.CC$(o,7),2&a){let A;e.wto(A=e.Gqi())&&(F.buttons=A.first)}},inputs:{form:"form",formData:"formData",autocomplete:"autocomplete"},outputs:{submitForm:"submitForm"},standalone:!0,features:[e.SYr,e.UHJ],ngContentSelectors:R,decls:7,vars:5,consts:[[3,"autocomplete","formGroup","ngSubmit"],[1,"igo-form-body",3,"ngClass"],[1,"igo-form-content"],[1,"igo-form-buttons"],["buttons",""]],template:function(a,F){1&a&&(e.kPM(f),e.I0R(0,"form",0),e.qCj("ngSubmit",function(){return F.onSubmit()}),e.I0R(1,"div",1)(2,"div",2),e._Xx(3),e.C$Y(),e.I0R(4,"div",3,4),e._Xx(6,1),e.C$Y()()()),2&a&&(e.E7m("autocomplete",F.autocomplete)("formGroup",F.form.control),e.yG2(),e.E7m("ngClass",e.S45(3,h,F.hasButtons)))},dependencies:[d.y,d.sz,d.u,d.sl,d.uW,C.QF],styles:["[_nghost-%COMP%]{display:block}form[_ngcontent-%COMP%]{width:100%;height:100%}.igo-form-body[_ngcontent-%COMP%], .igo-form-content[_ngcontent-%COMP%]{height:100%}.igo-form-body-with-buttons[_ngcontent-%COMP%]   .igo-form-content[_ngcontent-%COMP%]{height:calc(100% - 56px)}.igo-form-content[_ngcontent-%COMP%]{display:flex}"],changeDetection:0})}return O})()},69368:(Fe,ce,r)=>{"use strict";r.d(ce,{Q:()=>e});var C=r(34896);let e=(()=>{class d{static fields={};static register(P,o){d.fields[P]=o}constructor(){}getFieldByType(P){return d.fields[P]}static \u0275fac=function(o){return new(o||d)};static \u0275prov=C.wxM({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})()},25812:(Fe,ce,r)=>{"use strict";function C(o){if(o.validator){const f=o.validator({});if(f&&f.required)return!0}return!!o.controls&&void 0!==Object.keys(o.controls).find(h=>C(o.controls[h]))}function e(){return{required:"igo.common.form.errors.required",email:"igo.common.form.errors.email"}}function d(o,f){const y=Object.keys(o.errors||{}).map(O=>f[O]).filter(O=>void 0!==O);return y.length>0?y[0]:""}function L(o){return o.groups.reduce((f,h)=>f.concat(h.fields),[].concat(o.fields))}r.d(ce,{KW:()=>d,aC:()=>L,qs:()=>C,uu:()=>e})},64092:(Fe,ce,r)=>{"use strict";r.d(ce,{ol:()=>L,IL:()=>O,S:()=>F,Cg:()=>d,er:()=>f,qW:()=>C,Ue:()=>e,Md:()=>o,yC:()=>P,I9:()=>x});const C={name:"magnify-scan",svg:'\n  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>magnify-scan</title><path d="M17 22V20H20V17H22V20.5C22 20.89 21.84 21.24 21.54 21.54C21.24 21.84 20.89 22 20.5 22H17M7 22H3.5C3.11 22 2.76 21.84 2.46 21.54C2.16 21.24 2 20.89 2 20.5V17H4V20H7V22M17 2H20.5C20.89 2 21.24 2.16 21.54 2.46C21.84 2.76 22 3.11 22 3.5V7H20V4H17V2M7 2V4H4V7H2V3.5C2 3.11 2.16 2.76 2.46 2.46C2.76 2.16 3.11 2 3.5 2H7M10.5 6C13 6 15 8 15 10.5C15 11.38 14.75 12.2 14.31 12.9L17.57 16.16L16.16 17.57L12.9 14.31C12.2 14.75 11.38 15 10.5 15C8 15 6 13 6 10.5C6 8 8 6 10.5 6M10.5 8C9.12 8 8 9.12 8 10.5C8 11.88 9.12 13 10.5 13C11.88 13 13 11.88 13 10.5C13 9.12 11.88 8 10.5 8Z" /></svg>\n'},e={name:"microsoft",svg:'\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>microsoft</title><path d="M2,3H11V12H2V3M11,22H2V13H11V22M21,3V12H12V3H21M21,22H12V13H21V22Z" /></svg>\n'},d={name:"keyboard-esc",svg:'\n  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>keyboard-esc</title><path d="M1 7H7V9H3V11H7V13H3V15H7V17H1V7M11 7H15V9H11V11H13C14.11 11 15 11.9 15 13V15C15 16.11 14.11 17 13 17H9V15H13V13H11C9.9 13 9 12.11 9 11V9C9 7.9 9.9 7 11 7M19 7H21C22.11 7 23 7.9 23 9V10H21V9H19V15H21V14H23V15C23 16.11 22.11 17 21 17H19C17.9 17 17 16.11 17 15V9C17 7.9 17.9 7 19 7Z" /></svg>\n'},L={name:"engine",svg:'\n  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>engine</title><path d="M7,4V6H10V8H7L5,10V13H3V10H1V18H3V15H5V18H8L10,20H18V16H20V19H23V9H20V12H18V8H12V6H15V4H7Z" /></svg>\n'},P={name:"selection-marker",svg:'\n  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>selection-marker</title><path d="M2 4C2 2.89 2.9 2 4 2H7V4H4V7H2V4M22 4V7H20V4H17V2H20C21.1 2 22 2.89 22 4M2 20V17H4V20H7V22H4C2.9 22 2 21.11 2 20M10 2H14V4H10V2M10 20H14V22H10V20M2 10H4V14H2V10M18.5 13C20.4 13 22 14.6 22 16.5C22 19.1 18.5 23 18.5 23C18.5 23 15 19.1 15 16.5C15 14.6 16.6 13 18.5 13M18.5 17.8C19.2 17.8 19.8 17.2 19.7 16.6C19.7 16 19.1 15.4 18.5 15.4C17.9 15.4 17.3 15.9 17.3 16.6C17.3 17.2 17.8 17.8 18.5 17.8M20 10H22V12.34C21.42 11.84 20.74 11.45 20 11.23V10Z" /></svg>\n'},o={name:"presentation-play",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>presentation-play</title><path d="M2,3H10A2,2 0 0,1 12,1A2,2 0 0,1 14,3H22V5H21V16H15.25L17,22H15L13.25,16H10.75L9,22H7L8.75,16H3V5H2V3M5,5V14H19V5H5M11.85,11.85C11.76,11.94 11.64,12 11.5,12A0.5,0.5 0 0,1 11,11.5V7.5A0.5,0.5 0 0,1 11.5,7C11.64,7 11.76,7.06 11.85,7.15L13.25,8.54C13.57,8.86 13.89,9.18 13.89,9.5C13.89,9.82 13.57,10.14 13.25,10.46L11.85,11.85Z" /></svg>'},f={name:"layers-plus",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>layers-plus</title><path d="M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z" /></svg>'};var h=r(34896),R=r(32328),y=r(50168);let O=(()=>{class A{iconRegistry;sanitizer;constructor(W,w){this.iconRegistry=W,this.sanitizer=w}registerSvg(W){this.iconRegistry.addSvgIconLiteral(W.name,this.sanitizer.bypassSecurityTrustHtml(W.svg))}static \u0275fac=function(w){return new(w||A)(h.CoB(R.iK),h.CoB(y.mI))};static \u0275prov=h.wxM({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})();function x(A="outlined"){return(0,h.AFj)([R.oB,{provide:h.kZF,useFactory:k=>()=>k.setDefaultFontSetClass(`material-symbols-${A}`),deps:[R.iK],multi:!0}])}function T(A,k){if(1&A&&h.wR5(0,"mat-icon",0),2&A){const W=h.GaO();h.E7m("svgIcon",W.icon.name)}}function a(A,k){if(1&A&&(h.I0R(0,"mat-icon"),h.OEk(1),h.C$Y()),2&A){const W=h.GaO();h.yG2(),h.cNF(W.icon)}}let F=(()=>{class A{iconService;set icon(W){this.isSvg(W)&&this.registerSvg(W),this._icon=W}get icon(){return this._icon}_icon;constructor(W){this.iconService=W}registerSvg(W){this.iconService.registerSvg(W)}isSvg(W){return"string"!=typeof W}static \u0275fac=function(w){return new(w||A)(h.GI1(O))};static \u0275cmp=h.In1({type:A,selectors:[["igo-icon"]],inputs:{icon:"icon"},standalone:!0,features:[h.UHJ],decls:2,vars:1,consts:[[3,"svgIcon"]],template:function(w,te){1&w&&h.yuY(0,T,1,1,"mat-icon",0)(1,a,2,1),2&w&&h.C0Y(0,te.isSvg(te.icon)?0:1)},dependencies:[R.oB,R.qL],encapsulation:2})}return A})()},19644:(Fe,ce,r)=>{"use strict";r.d(ce,{M:()=>e});var C=r(34896);let e=(()=>{class d{el;errorImageUrl="./assets/igo2/common/images/na.png";hideError=!1;constructor(P){this.el=P}onError(P){this.hideError?this.el.nativeElement.style.display="none":P.target.src=this.errorImageUrl}static \u0275fac=function(o){return new(o||d)(C.GI1(C.GMv))};static \u0275dir=C.Sc5({type:d,selectors:[["","igoImageError",""]],hostBindings:function(o,f){1&o&&C.qCj("error",function(R){return f.onError(R)})},inputs:{errorImageUrl:"errorImageUrl",hideError:"hideError"},standalone:!0})}return d})()},696:(Fe,ce,r)=>{"use strict";r.d(ce,{k:()=>R});var C=r(21124),e=r(33712),d=r(9204),L=r(21296),P=r(51672),o=r(19432),f=r(90916),h=r(34896);class R{http;configService;constructor(O,x){this.http=O,this.configService=x}transform(O){const x=new e.UD({"Content-Type":"text/plain",activityInterceptor:"false",interceptError:"false"}),T=new RegExp(this.configService?.getConfig("depot.url")+'.*?(?="|$)');return T.test(O)&&(O=O.match(T)[0]),this.http.get(O,{headers:x,responseType:"blob"}).pipe((0,P.a)(a=>{throw a.error.caught=!0,a.error.toDisplay=!1,a}),(0,o.G)(a=>new L._(F=>{const A=new FileReader;A.readAsDataURL(a),A.onloadend=()=>{F.next(A.result),F.complete()}})))}static \u0275fac=function(x){return new(x||R)(h.GI1(e.KK,16),h.GI1(d.aW,16))};static \u0275pipe=h.UTH({name:"secureImage",type:R,pure:!0,standalone:!0})}(0,C.UN)([(0,f.w)({maxCacheCount:20}),(0,C.YR)("design:type",Function),(0,C.YR)("design:paramtypes",[String]),(0,C.YR)("design:returntype",L._)],R.prototype,"transform",null)},880:(Fe,ce,r)=>{"use strict";r.d(ce,{E:()=>F});var C=r(65056),e=r(34672),d=r(32328),L=r(27e3),P=r(24708),o=r(1296),f=r(64092),h=r(97780),R=r(26496),y=r(34896),O=r(72584);function x(A,k){if(1&A){const W=y.KQA();y.I0R(0,"button",3),y.qCj("click",function(){y.usT(W);const te=y.GaO(2);return y.CGJ(te.startInteractiveTour())}),y.wVc(1,"translate"),y.wVc(2,"translate"),y.wR5(3,"igo-icon",4),y.C$Y()}if(2&A){const W=y.GaO(2);y.E7m("ngClass",W.getClass())("matTooltip",W.disabledTourButton?y.kDX(1,4,"igo.common.interactiveTour.disaledTooltipTourToolButton"):y.kDX(2,6,"igo.common.interactiveTour.tooltipTourToolButton"))("disabled",W.disabledTourButton),y.yG2(3),y.E7m("icon",W.presentationIcon)}}function T(A,k){if(1&A){const W=y.KQA();y.I0R(0,"button",5),y.qCj("click",function(){y.usT(W);const te=y.GaO(2);return y.CGJ(te.startInteractiveTour())}),y.OEk(1),y.wVc(2,"translate"),y.wVc(3,"translate"),y.wVc(4,"async"),y.wR5(5,"mat-icon",6),y.wVc(6,"translate"),y.wVc(7,"translate"),y.C$Y()}if(2&A){const W=y.GaO(2);y.E7m("ngClass",W.getClass())("disabled",W.disabledTourButton),y.yG2(),y.CAO(" ",y.kDX(2,6,"igo.common.interactiveTour.buttonTitle")," ",y.kDX(3,8,y.kDX(4,10,W.discoverTitleInLocale$))," "),y.yG2(4),y.E7m("svgIcon",W.presentationIcon.name)("matTooltip",W.disabledTourButton?y.kDX(6,12,"igo.common.interactiveTour.disaledTooltipTourToolButton"):y.kDX(7,14,"igo.common.interactiveTour.tooltipTourToolButton"))}}function a(A,k){if(1&A&&(y.SAx(0),y.yuY(1,x,4,8,"button",1)(2,T,8,16,"ng-template",null,2,y.gJz),y.k70()),2&A){const W=y.Gew(3),w=y.GaO();y.yG2(),y.E7m("ngIf","icon"===w.styleButton)("ngIfElse",W)}}let F=(()=>{class A{interactiveTourService;toolService;iconService;presentationIcon=f.Md;tourToStart="";styleButton;discoverTitleInLocale$=(0,o.of)("IGO");getClass(){return{"tour-button-tool-icon":"icon"===this.styleButton,"tour-button-tool":"raised"===this.styleButton}}get toolbox(){return this.toolService.toolbox}getTourToStart(){return this.tourToStart?this.tourToStart:this.activeToolName}get activeToolName(){if(this.toolbox)return this.isActiveTool?this.toolbox.activeTool$.getValue().name:"global"}get isActiveTool(){if(this.toolbox)return void 0!==this.toolbox.activeTool$.getValue()}get isToolHaveTour(){return!("about"===this.activeToolName&&!this.tourToStart)&&this.interactiveTourService.isToolHaveTourConfig(this.getTourToStart())}get showTourButton(){let W,w;return W=this.isToolHaveTour,!1!==W&&!(this.interactiveTourService.isMobile()&&(w=this.isTourDisplayInMobile,!1===w))}get isTourDisplayInMobile(){return this.interactiveTourService.isTourDisplayInMobile()}get disabledTourButton(){return this.interactiveTourService.disabledTourButton(this.activeToolName)}constructor(W,w,te){this.interactiveTourService=W,this.toolService=w,this.iconService=te,this.iconService.registerSvg(this.presentationIcon)}startInteractiveTour(){const W=this.getTourToStart();W&&this.interactiveTourService.startTour(W)}static \u0275fac=function(w){return new(w||A)(y.GI1(R.I),y.GI1(h.I),y.GI1(f.IL))};static \u0275cmp=y.In1({type:A,selectors:[["igo-interactive-tour"]],inputs:{tourToStart:"tourToStart",styleButton:"styleButton",discoverTitleInLocale$:"discoverTitleInLocale$"},standalone:!0,features:[y.UHJ],decls:1,vars:1,consts:[[4,"ngIf"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","matTooltip","disabled","click",4,"ngIf","ngIfElse"],["raisedButton",""],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","matTooltip","disabled","click"],["iconPositionEnd","",3,"icon"],["color","primary","mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","disabled","click"],["iconPositionEnd","",3,"svgIcon","matTooltip"]],template:function(w,te){1&w&&y.yuY(0,a,4,2,"ng-container",0),2&w&&y.E7m("ngIf",te.showTourButton)},dependencies:[C.u_,e.oJ,e.Gw,e.um,C.QF,L.KO,L.a4,d.oB,d.qL,C.a,P._s,O.sD,f.S],styles:["igo-interactive-tour>button.mat-mdc-raised-button.tour-button-tool-icon{box-shadow:none}.shepherd-has-title .shepherd-content .shepherd-header{padding:.5em .75em}.shepherd-title{margin:0!important;font-weight:revert!important}.shepherd-progress{margin-right:15px;color:#737373}.shepherd-text{font-size:14px!important}.shepherd-element{border:1px solid;border-color:#474747;box-shadow:4px 5px #65656599}\n"],encapsulation:2})}return A})()},15e3:(Fe,ce,r)=>{"use strict";r.d(ce,{C:()=>P});var C=r(9204),e=r(51672),d=r(34896),L=r(33712);let P=(()=>{class o{http;configService;jsonURL;allToursOptions;constructor(h,R){this.http=h,this.configService=R,this.jsonURL=this.getPathToConfigFile()}loadConfigTour(){this.getJSON().subscribe(h=>{this.allToursOptions=h},h=>{throw new Error("Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.")})}getPathToConfigFile(){return this.configService.getConfig("interactiveTour.pathToConfigFile")||"./config/interactiveTour.json"}getJSON(){return this.http.get(this.jsonURL).pipe((0,e.a)(h=>{throw h.error.caught=!0,h}))}getTourOptionData(h){if(void 0===this.allToursOptions)return;let R=h;return R=R.replace(/\s/g,""),this.allToursOptions[R]}static \u0275fac=function(R){return new(R||o)(d.CoB(L.KK),d.CoB(C.aW))};static \u0275prov=d.wxM({token:o,factory:o.\u0275fac})}return o})()},26496:(Fe,ce,r)=>{"use strict";r.d(ce,{I:()=>R});var C=r(9204),e=r(24708),d=r(9588),L=r(16548),P=r(91112),o=r(15e3),f=r(34896),h=r(44668);let R=(()=>{class y{configService;mediaService;languageService;interactiveTourLoader;shepherdService;previousStep;nextIndex=1;constructor(x,T,a,F,A){this.configService=x,this.mediaService=T,this.languageService=a,this.interactiveTourLoader=F,this.shepherdService=A,this.isAppHaveTour()&&this.interactiveTourLoader.loadConfigTour()}isAppHaveTour(){const x=this.configService.getConfig("interactiveTour.activateInteractiveTour");return void 0===x||x}isToolHaveTourConfig(x){return void 0!==this.interactiveTourLoader.getTourOptionData(x)}disabledTourButton(x){const T=this.interactiveTourLoader.getTourOptionData(x);if(T?.conditions)for(const a of T?.conditions)if(null===document.querySelector(a))return!0;return!1}isMobile(){return this.mediaService.isMobile()}isTourDisplayInMobile(){const x=this.configService.getConfig("interactiveTour.tourInMobile");return void 0===x||x}getButtons(x){return"noBackButton"===x?[{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]:"first"===x?[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.exitButton"),type:"cancel"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]:"last"===x?[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.backButton"),type:"back"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.exitButton"),type:"cancel"}]:[{classes:"shepherd-button-secondary",text:this.languageService.translate.instant("igo.common.interactiveTour.backButton"),type:"back"},{classes:"shepherd-button-primary",text:this.languageService.translate.instant("igo.common.interactiveTour.nextButton"),type:"next"}]}getAction(x){return{click:"click"}[x.toLowerCase()]}addProgress(){const x=this;let T=0;const F=setInterval(()=>{if(x.getCurrentStep()){if(x.getCurrentStep().options.attachTo.element&&!document.querySelector(x.getCurrentStep().options.attachTo.element))return x.cancel(),void clearInterval(F);{const A=x.getCurrentStep().getElement();A&&A.querySelectorAll(".shepherd-content, .shepherd-text").forEach(w=>{w.classList.add("mat-typography")});const k=A?A.querySelector(".shepherd-header"):void 0;if(T++,(k||T>21)&&clearInterval(F),k){const W=x.steps,w=document.createElement("span");w.className="shepherd-progress",w.innerText=`${W.indexOf(x.getCurrentStep())+1}/${W.length}`,k.insertBefore(w,A.querySelector(".shepherd-cancel-icon"))}}}},100)}checkNext(x,T,a){if(T.getCurrentStep()){if(T.getCurrentStep().options.attachTo.element&&document.querySelector(T.getCurrentStep().options.attachTo.element))return void T.complete();if(x.index===T.steps.length-1)return void T.complete();T.steps.splice(x.index,1);const F=T.steps[x.index];F.options.attachTo.element&&!document.querySelector(F.options.attachTo.element)?a.checkNext(x,T,a):(T._setupModal(),T.show(F.id))}}executeAction(x,T){if(!T||T.condition&&("!"===T.condition.charAt(0)&&document.querySelector(T.condition.slice(1))||"!"!==T.condition.charAt(0)&&!document.querySelector(T.condition)))return;const a=document.querySelector(T.element||x.element),F=this.getAction(T.action);a&&F&&a[F]()}executeActionPromise(x,T){return new Promise(a=>{if(this.executeAction(x,T),!T||!T.waitFor)return void a();let F=0;const A=T.maxWait?T.maxWait/100:20,k=setInterval(()=>{F++,(F>A||document.querySelector(T.waitFor))&&(clearInterval(k),a())},100)})}getShepherdSteps(x){const T=[];let a=0;for(const F of x.steps){const A=F.position??x.position;T.push({attachTo:{element:F.element,on:A},floatingUIOptions:{middleware:["auto"===A&&(0,L.EX)(),(0,P.E3)({mainAxis:15})].filter(Boolean)},beforeShowPromise:()=>Promise.all([this.executeActionPromise(this.previousStep,this.previousStep?this.previousStep.beforeChange:void 0),this.executeActionPromise(F,F.beforeShow)]),buttons:this.getButtons(0===a?"first":a+1===x.steps.length?"last":x.steps[a].noBackButton?"noBackButton":void 0),classes:F.class,highlightClass:F.highlightClass,scrollTo:F.scrollToElement||x.scrollToElement||!0,canClickTarget:F.disableInteraction?!F.disableInteraction:void 0,title:this.languageService.translate.instant(F.title||x.title),text:[this.languageService.translate.instant(F.text)],when:{show:()=>{this.executeAction(F,F.onShow)},hide:()=>{this.previousStep=F,this.executeAction(F,F.onHide)}}}),a++}return T}startTour(x){const T=this.interactiveTourLoader.getTourOptionData(x);this.shepherdService.defaultStepOptions={classes:T.class,highlightClass:T.highlightClass,canClickTarget:!T.disableInteraction||!T.disableInteraction,cancelIcon:{enabled:!0}};const a=this.getShepherdSteps(T);this.shepherdService.modal=!0,this.shepherdService.confirmCancel=!1,this.shepherdService.addSteps(a),this.shepherdService.tourObject.on("show",this.addProgress),this.shepherdService.tourObject.on("cancel",F=>{this.checkNext(F,this.shepherdService.tourObject,this)}),this.shepherdService.start()}static \u0275fac=function(T){return new(T||y)(f.CoB(C.aW),f.CoB(d.QB),f.CoB(e.ov),f.CoB(o.C),f.CoB(h.c))};static \u0275prov=f.wxM({token:y,factory:y.\u0275fac,providedIn:"root"})}return y})()},64080:(Fe,ce,r)=>{"use strict";r.d(ce,{H:()=>C});var C=function(e){return e.Radio="radio",e.Checkbox="checkbox",e}(C||{})},24100:(Fe,ce,r)=>{"use strict";r.d(ce,{m:()=>e});var C=r(34896);let e=(()=>{class d{onClick(P){P.stopPropagation()}static \u0275fac=function(o){return new(o||d)};static \u0275dir=C.Sc5({type:d,selectors:[["","igoStopPropagation",""]],hostBindings:function(o,f){1&o&&C.qCj("click",function(R){return f.onClick(R)})},standalone:!0})}return d})()},97780:(Fe,ce,r)=>{"use strict";r.d(ce,{I:()=>d});var C=r(10988),e=r(34896);let d=(()=>{class L{static tools={};toolbox=new C.E;static register(o){L.tools[o.name]=o}constructor(){this.toolbox.setTools(this.getTools())}getTool(o){return L.tools[o]}getTools(){return Object.values(L.tools)}static \u0275fac=function(f){return new(f||L)};static \u0275prov=e.wxM({token:L,factory:L.\u0275fac,providedIn:"root"})}return L})()},10988:(Fe,ce,r)=>{"use strict";r.d(ce,{E:()=>d});var C=r(54844),e=r(68488);class d{options;activeTool$=new C.g(void 0);toolbar$=new C.g([]);activeTool$$;activeToolHistory=[];store=new e.qc([],{getKey:P=>P.name});get tools$(){return this.store.entities$}constructor(P={}){this.options=P,this.setToolbar(P.toolbar),this.initStore()}destroy(){this.activeTool$$.unsubscribe(),this.store.destroy()}getTool(P){return this.store.get(P)}getTools(){return this.store.all()}setTools(P){this.store.load(P)}getToolbar(){return this.toolbar$.getValue()}setToolbar(P){this.toolbar$.next(P||[])}activateTool(P,o={}){const f=this.getTool(P);void 0!==f&&this.store.state.update(f,{active:!0,options:o},!0)}activatePreviousTool(){if(this.activeToolHistory.length<=1)return void this.deactivateTool();const[P,o]=this.activeToolHistory.splice(-2,2);this.activateTool(P)}deactivateTool(){this.clearActiveToolHistory(),this.store.state.updateAll({active:!1})}initStore(){this.store=new e.qc([],{getKey:P=>P.name}),this.activeTool$$=this.store.stateView.firstBy$(P=>!0===P.state.active).subscribe(P=>{if(void 0===P)return void this.setActiveTool(void 0);const o=P.entity,f=Object.assign({},o.options||{},P.state.options||{});this.setActiveTool(Object.assign({},o,{options:f}))})}setActiveTool(P){this.activeTool$.next(P),void 0===P?this.clearActiveToolHistory():this.activeToolHistory=this.activeToolHistory.filter(o=>o!==P.name).concat([P.name])}clearActiveToolHistory(){this.activeToolHistory=[]}}},26431:(Fe,ce,r)=>{"use strict";r.d(ce,{A:()=>o});var C=r(65056),e=r(34896),L=(r(77020),r(6316));function P(f,h){if(1&f&&e.wR5(0,"igo-dynamic-outlet",1),2&f){const R=e.GaO();e.E7m("component",R.widget)("inputs",R.inputs)("subscribers",R.getEffectiveSubscribers())}}let o=(()=>{class f{baseSubscribers={cancel:R=>this.onCancel(R),complete:R=>this.onComplete(R)};widget;inputs;subscribers={};complete=new e._w7;cancel=new e._w7;constructor(){}ngOnDestroy(){this.destroyWidget()}getEffectiveSubscribers(){const R=Object.assign({},this.subscribers);return Object.keys(this.baseSubscribers).forEach(y=>{const O=R[y],x=this.baseSubscribers[y];R[y]=void 0!==O?T=>{O(T),x(T)}:x}),R}onCancel(R){this.cancel.emit(R),this.destroyWidget()}onComplete(R){this.complete.emit(R),this.destroyWidget()}destroyWidget(){void 0!==this.widget&&this.widget.destroy(),this.widget=void 0}static \u0275fac=function(y){return new(y||f)};static \u0275cmp=e.In1({type:f,selectors:[["igo-widget-outlet"]],inputs:{widget:"widget",inputs:"inputs",subscribers:"subscribers"},outputs:{complete:"complete",cancel:"cancel"},standalone:!0,features:[e.UHJ],decls:1,vars:1,consts:[[3,"component","inputs","subscribers",4,"ngIf"],[3,"component","inputs","subscribers"]],template:function(y,O){1&y&&e.yuY(0,P,1,3,"igo-dynamic-outlet",0),2&y&&e.E7m("ngIf",O.widget)},dependencies:[C.u_,L.q],styles:["[_nghost-%COMP%]   igo-dynamic-outlet[_ngcontent-%COMP%]{height:100%}"],changeDetection:0})}return f})()},53e3:(Fe,ce,r)=>{"use strict";r.d(ce,{MF:()=>T,AI:()=>s,m0:()=>x,mK:()=>Ri,ii:()=>mi,Q9:()=>me,Ex:()=>nt,L0:()=>Tn,YM:()=>lt,Mx:()=>Te,Qo:()=>Ne,qm:()=>gt.qm,ol:()=>k.ol,sh:()=>O.sh,qc:()=>O.qc,qq:()=>O.qq,xx:()=>O.xx,uk:()=>O.uk,YX:()=>O.YX,G8:()=>O.G8,Eh:()=>O.Eh,I7:()=>O.I7,qK:()=>O.qK,Kg:()=>Dt,Yl:()=>Et.Y,AB:()=>dt,O8:()=>Ft,eO:()=>ko,IL:()=>k.IL,qS:()=>Xi,uK:()=>Ue,OE:()=>ht,wr:()=>Lt,S:()=>k.S,bQ:()=>Ot,YN:()=>ii,Gq:()=>mo,Se:()=>Sn,iA:()=>Ni,MJ:()=>wo.M,Er:()=>xe.E,In:()=>to.I,gl:()=>oi,Cg:()=>k.Cg,er:()=>k.er,yM:()=>Ji,qU:()=>hi,SM:()=>En,qW:()=>k.qW,Ue:()=>k.Ue,cP:()=>uo,yC:()=>k.yC,Ux:()=>ot.U,kd:()=>Jo.k,hj:()=>Ao,is:()=>Bo,mw:()=>nr.m,ys:()=>Ei,oz:()=>hn,Iv:()=>Rn,aA:()=>rr,IF:()=>Ki.I,Eb:()=>fn.E,cT:()=>Cn,cx:()=>zi,ec:()=>ar,uF:()=>Pi,cr:()=>di,Qv:()=>Fi,sH:()=>O.sH,_I:()=>O._I,u6:()=>O.u6,mU:()=>O.mU,YB:()=>O.YB,E$:()=>O.E$,I9:()=>k.I9});var C=r(65056),e=r(34672),d=r(48512),L=r(32328),P=r(63916),o=r(87848),f=r(27e3),h=r(24708),R=r(9588),y=r(54844),O=r(68488),x=function(q){return q.Dock="dock",q.Overlay="overlay",q.Context="context",q}(x||{});class T extends O.qc{}var a=r(34896),F=r(58539),A=r(88404),k=r(64092),W=r(72584);function w(q,Re){if(1&q&&(a.I0R(0,"button",5),a.wVc(1,"async"),a.wR5(2,"igo-icon",6),a.wVc(3,"async"),a.C$Y()),2&q){const E=a.GaO(2);a.E7m("color",E.color)("disabled",a.kDX(1,4,E.disabled$))("disableRipple",!0),a.yG2(2),a.E7m("icon",E.isObservable(E.action.icon)?a.kDX(3,6,E.action.icon):E.action.icon)}}function te(q,Re){if(1&q&&(a.I0R(0,"span",7),a.OEk(1),a.wVc(2,"translate"),a.C$Y()),2&q){const E=a.GaO(2);a.yG2(),a.cNF(a.kDX(2,1,E.title))}}function Z(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"mat-list-item",2),a.qCj("click",function(){a.usT(E);const ge=a.GaO();return a.CGJ(ge.onClick())}),a.wVc(1,"translate"),a.wVc(2,"async"),a.wVc(3,"async"),a.yuY(4,w,4,8,"button",3)(5,te,3,3,"span",4),a.C$Y()}if(2&q){const E=a.GaO();a.E7m("matTooltip",E.withTooltip?a.kDX(1,4,a.kDX(2,6,E.tooltip$)||E.title):"")("ngClass",a.kDX(3,8,E.ngClass$)),a.yG2(4),a.E7m("ngIf",E.withIcon),a.yG2(),a.E7m("ngIf",E.withTitle)}}function K(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"mat-checkbox",10),a.qCj("change",function(){a.usT(E);const ge=a.GaO(2);return a.CGJ(ge.action.handler())}),a.wVc(1,"async"),a.OEk(2),a.wVc(3,"translate"),a.C$Y()}if(2&q){const E=a.GaO(2);a.E7m("checked",a.kDX(1,2,E.checkCondition$)),a.yG2(2),a.oRS(" ",a.kDX(3,4,E.title)," ")}}function X(q,Re){if(1&q&&(a.I0R(0,"mat-list-item",8),a.wVc(1,"translate"),a.wVc(2,"async"),a.wVc(3,"async"),a.yuY(4,K,4,6,"mat-checkbox",9),a.C$Y()),2&q){const E=a.GaO();a.E7m("matTooltip",E.withTooltip?a.kDX(1,3,a.kDX(2,5,E.tooltip$)||E.title):"")("ngClass",a.kDX(3,7,E.ngClass$)),a.yG2(4),a.E7m("ngIf",E.withTitle)}}let V=(()=>{class q{disabled$=new y.g(!1);checkCondition$=new y.g(void 0);tooltip$=new y.g(void 0);noDisplay$=new y.g(!1);ngClass$=new y.g({});ngClass$$;disabled$$;availability$$;checkCondition$$;tooltip$$;noDisplay$$;display$$;isObservable=A.X;action;color="default";withTitle=!0;withIcon=!0;withTooltip=!0;set disabled(E){this.disabled$.next(E)}get disabled(){return this.disabled$.value}set noDisplay(E){this.noDisplay$.next(E)}get noDisplay(){return this.noDisplay$.value}trigger=new a._w7;get title(){return this.action.title}ngOnInit(){const E=this.action.args||[];void 0!==this.action.ngClass&&(this.ngClass$$=this.action.ngClass(...E).subscribe(ee=>this.updateNgClass(ee))),(0,A.X)(this.action.checkCondition)?this.checkCondition$$=this.action.checkCondition.subscribe(ee=>this.updateCheckCondition(ee)):this.updateCheckCondition(this.action.checkCondition),(0,A.X)(this.action.tooltip)?this.tooltip$$=this.action.tooltip.subscribe(ee=>this.updateTooltip(ee)):this.updateTooltip(this.action.tooltip),void 0!==this.action.availability&&(this.availability$$=this.action.availability(...E).subscribe(ee=>this.disabled=!ee)),this.disabled$$=this.disabled$.subscribe(ee=>this.updateNgClass({"igo-actionbar-item-disabled":ee})),void 0!==this.action.display&&(this.display$$=this.action.display(...E).subscribe(ee=>this.noDisplay=!ee)),this.noDisplay$$=this.noDisplay$.subscribe(ee=>this.updateNgClass({"igo-actionbar-item-no-display":ee}))}ngOnDestroy(){void 0!==this.ngClass$$&&(this.ngClass$$.unsubscribe(),this.ngClass$$=void 0),void 0!==this.availability$$&&(this.availability$$.unsubscribe(),this.availability$$=void 0),void 0!==this.display$$&&(this.display$$.unsubscribe(),this.display$$=void 0),void 0!==this.checkCondition$$&&(this.checkCondition$$.unsubscribe(),this.checkCondition$$=void 0),void 0!==this.tooltip$$&&(this.tooltip$$.unsubscribe(),this.tooltip$$=void 0),this.disabled$$.unsubscribe(),this.noDisplay$$.unsubscribe()}onClick(){!0!==this.disabled&&this.trigger.emit(this.action)}updateNgClass(E){this.ngClass$.next(Object.assign({},this.ngClass$.value,E))}updateTooltip(E){this.tooltip$.next(E)}updateCheckCondition(E){this.checkCondition$.next(E)}static \u0275fac=function(ee){return new(ee||q)};static \u0275cmp=a.In1({type:q,selectors:[["igo-actionbar-item"]],inputs:{action:"action",color:"color",withTitle:"withTitle",withIcon:"withIcon",withTooltip:"withTooltip",disabled:"disabled",noDisplay:"noDisplay"},outputs:{trigger:"trigger"},standalone:!0,features:[a.UHJ],decls:2,vars:2,consts:[["class","actionbar-item","matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",3,"matTooltip","ngClass","click",4,"ngIf"],["class","item-checkbox","matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",3,"matTooltip","ngClass",4,"ngIf"],["matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",1,"actionbar-item",3,"matTooltip","ngClass","click"],["matListItemAvatar","","mat-icon-button","",3,"color","disabled","disableRipple",4,"ngIf"],["matLine","",4,"ngIf"],["matListItemAvatar","","mat-icon-button","",3,"color","disabled","disableRipple"],[3,"icon"],["matLine",""],["matTooltipClass","actionbarItemTooltip","matTooltipShowDelay","500",1,"item-checkbox",3,"matTooltip","ngClass"],[3,"checked","change",4,"ngIf"],[3,"checked","change"]],template:function(ee,ge){1&ee&&a.yuY(0,Z,6,10,"mat-list-item",0)(1,X,5,9,"mat-list-item",1),2&ee&&(a.E7m("ngIf",!ge.action.checkbox),a.yG2(),a.E7m("ngIf",ge.action.checkbox))},dependencies:[C.u_,P.iI,P.g9,P.EV,f.KO,f.a4,C.QF,e.oJ,e.um,L.oB,F.Vn,F.WK,C.a,h._s,W.sD,k.S],styles:["[_nghost-%COMP%]     mat-list-item:hover{cursor:pointer}[_nghost-%COMP%]   mat-list-item.igo-actionbar-item-disabled[_ngcontent-%COMP%]{color:#00000042;cursor:default!important}[_nghost-%COMP%]   mat-list-item.igo-actionbar-item-no-display[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     button[matlistitemavatar]{margin-left:4px}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     button .mat-mdc-button-persistent-ripple{display:none}[_nghost-%COMP%]   .item-checkbox[_ngcontent-%COMP%]     mat-checkbox label{margin-left:28px}[_nghost-%COMP%]   .actionbar-item[_ngcontent-%COMP%]   [matline][_ngcontent-%COMP%]{padding-left:16px}"],changeDetection:0})}return q})();var B=r(23416);function z(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"div",5)(1,"button",6),a.qCj("click",function(){a.usT(E);const ge=a.GaO();return a.CGJ(ge.scrollUp())}),a.wVc(2,"translate"),a.I0R(3,"mat-icon"),a.OEk(4,"expand_less"),a.C$Y()()()}2&q&&(a.yG2(),a.E7m("matTooltip",a.kDX(2,1,"igo.common.actionbar.scrollUp")))}function c(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"igo-actionbar-item",9),a.qCj("trigger",function(){a.usT(E);const ge=a.GaO(2);return a.CGJ(ge.onTriggerAction(ge.toggleCollapseAction))}),a.C$Y()}if(2&q){const E=a.GaO(2);a.E7m("withTitle",!1)("withIcon",!0)("color",E.color)("disabled",E.store.view.empty)("action",E.toggleCollapseAction)}}function I(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"igo-actionbar-item",12),a.qCj("trigger",function(){const Ye=a.usT(E).$implicit,Je=a.GaO(3);return a.CGJ(Je.onTriggerAction(Ye))}),a.C$Y()}if(2&q){const E=Re.$implicit,ee=a.GaO(3);a.E7m("withTitle",ee.withTitle)("withIcon",ee.withIcon)("withTooltip",ee.withTooltip)("color",ee.color)("disabled",ee.store.state.get(E).disabled)("action",E)}}function b(q,Re){if(1&q&&(a.yuY(0,I,1,6,"ng-template",10,11,a.gJz),a.wVc(2,"async")),2&q){const E=a.GaO(2);a.E7m("ngForOf",a.kDX(2,1,E.store.view.all$()))}}function G(q,Re){if(1&q&&(a.I0R(0,"mat-list",7),a.yuY(1,c,1,5,"igo-actionbar-item",8)(2,b,3,3,null,3),a.C$Y()),2&q){const E=a.GaO();a.yG2(),a.E7m("ngIf",E.withToggleButton),a.yG2(),a.E7m("ngIf",!E.collapsed)}}function D(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"div",13)(1,"button",6),a.qCj("click",function(){a.usT(E);const ge=a.GaO();return a.CGJ(ge.scrollDown())}),a.wVc(2,"translate"),a.I0R(3,"mat-icon"),a.OEk(4,"expand_more"),a.C$Y()()()}2&q&&(a.yG2(),a.E7m("matTooltip",a.kDX(2,1,"igo.common.actionbar.scrollDown")))}function g(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"igo-actionbar-item",17),a.qCj("trigger",function(){const Ye=a.usT(E).$implicit,Je=a.GaO(2);return a.CGJ(Je.onTriggerAction(Ye))}),a.C$Y()}if(2&q){const E=Re.$implicit,ee=a.GaO(2);a.E7m("withTitle",ee.withTitle)("withIcon",ee.withIcon)("color",ee.color)("action",E)}}function U(q,Re){if(1&q&&(a.I0R(0,"div")(1,"button",14),a.wVc(2,"translate"),a.I0R(3,"mat-icon"),a.OEk(4),a.C$Y()(),a.I0R(5,"mat-menu",15,16)(7,"mat-list"),a.yuY(8,g,1,4,"ng-template",10),a.wVc(9,"async"),a.C$Y()()()),2&q){const E=a.Gew(6),ee=a.GaO();a.yG2(),a.E7m("matTooltip",a.kDX(2,10,"igo.common.actionbar.icon"))("matMenuTriggerFor",E)("disabled",ee.store.view.empty)("color",ee.iconColor),a.yG2(3),a.cNF(ee.icon),a.yG2(),a.m8U(ee.overlayClass),a.E7m("xPosition",ee.xPosition)("yPosition",ee.yPosition),a.yG2(3),a.E7m("ngForOf",a.kDX(9,12,ee.store.view.all$()))}}function M(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"igo-actionbar-item",17),a.qCj("trigger",function(){const Ye=a.usT(E).$implicit,Je=a.GaO(2);return a.CGJ(Je.onTriggerAction(Ye))}),a.C$Y(),a.wR5(1,"br")}if(2&q){const E=Re.$implicit,ee=a.GaO(2);a.E7m("withTitle",ee.withTitle)("withIcon",ee.withIcon)("color",ee.color)("action",E)}}function H(q,Re){if(1&q&&(a.I0R(0,"mat-card",18)(1,"mat-list"),a.yuY(2,M,2,4,"ng-template",10),a.wVc(3,"async"),a.C$Y()()),2&q){const E=a.GaO();a.yG2(2),a.E7m("ngForOf",a.kDX(3,1,E.store.view.all$()))}}let s=(()=>{class q{overlay;elRef;cdRef;mediaService;actionbarMode=x;collapsed=!1;toggleCollapseAction={id:"actionbar_toggle",icon:"more_vert",handler:()=>{this.collapsed=!this.collapsed}};watcher;heightCondition$=new y.g(!1);positionConditionTop$=new y.g(!0);positionConditionLow$=new y.g(!0);store;mode=x.Dock;withToggleButton=!1;horizontal=!1;color="default";iconColor="default";withTitle=!0;withTooltip=!0;scrollActive=!0;withIcon=!0;icon="more_horiz";xPosition="before";yPosition="above";set overlayClass(E){this._overlayClass=E}get overlayClass(){return[this._overlayClass,"igo-actionbar-overlay"].join(" ")}_overlayClass="";isCollapsed=this.collapsed;get withTitleClass(){return this.withTitle}get withIconClass(){return this.withIcon}get horizontalClass(){return this.horizontal}get heightCondition(){const E=this.elRef.nativeElement;return!1===this.scrollActive&&E.clientHeight<E.scrollHeight}get positionConditionTop(){return 0!==this.elRef.nativeElement.scrollTop}get positionConditionLow(){const E=this.elRef.nativeElement;return!(E.scrollTop>=E.scrollHeight-E.clientHeight)}get isDesktop(){return this.mediaService.getMedia()===R.oZ.Desktop}constructor(E,ee,ge,Ye){this.overlay=E,this.elRef=ee,this.cdRef=ge,this.mediaService=Ye}ngOnChanges(E){const ee=E.store;ee&&ee.currentValue!==ee.previousValue&&(void 0!==this.watcher&&this.watcher.destroy(),this.watcher=new O.YX(this.store,this.cdRef))}ngOnDestroy(){this.watcher.destroy()}onTriggerAction(E){E.handler(...E.args||[])}scrollDown(){this.elRef.nativeElement.scrollBy(0,52)}scrollUp(){this.elRef.nativeElement.scrollBy(0,-52)}static \u0275fac=function(ee){return new(ee||q)(a.GI1(B.mc),a.GI1(a.GMv),a.GI1(a.kD9),a.GI1(R.QB))};static \u0275cmp=a.In1({type:q,selectors:[["igo-actionbar"]],hostVars:8,hostBindings:function(ee,ge){2&ee&&a.eAK("is-collapsed",ge.isCollapsed)("with-title",ge.withTitleClass)("with-icon",ge.withIconClass)("horizontal",ge.horizontalClass)},inputs:{store:"store",mode:"mode",withToggleButton:"withToggleButton",horizontal:"horizontal",color:"color",iconColor:"iconColor",withTitle:"withTitle",withTooltip:"withTooltip",scrollActive:"scrollActive",withIcon:"withIcon",icon:"icon",xPosition:"xPosition",yPosition:"yPosition",overlayClass:"overlayClass"},standalone:!0,features:[a.SYr,a.UHJ],decls:5,vars:5,consts:[["id","topChevron",4,"ngIf"],["matListItemIcon","",4,"ngIf"],["id","lowChevron",4,"ngIf"],[4,"ngIf"],["class","context-menu-card mat-elevation-z4",4,"ngIf"],["id","topChevron"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click"],["matListItemIcon",""],["color","accent",3,"withTitle","withIcon","color","disabled","action","trigger",4,"ngIf"],["color","accent",3,"withTitle","withIcon","color","disabled","action","trigger"],["ngFor","",3,"ngForOf"],["buttonContent",""],["color","accent",3,"withTitle","withIcon","withTooltip","color","disabled","action","trigger"],["id","lowChevron"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"buttonOverlay",3,"matTooltip","matMenuTriggerFor","disabled","color"],["overlapTrigger","true",1,"igo-compact-menu","igo-no-min-width-menu",3,"xPosition","yPosition"],["actionbarMenu","matMenu"],["color","accent",3,"withTitle","withIcon","color","action","trigger"],[1,"context-menu-card","mat-elevation-z4"]],template:function(ee,ge){1&ee&&a.yuY(0,z,5,3,"div",0)(1,G,3,2,"mat-list",1)(2,D,5,3,"div",2)(3,U,10,14,"div",3)(4,H,4,3,"mat-card",4),2&ee&&(a.E7m("ngIf",ge.heightCondition&&ge.positionConditionTop&&ge.isDesktop),a.yG2(),a.E7m("ngIf",ge.mode===ge.actionbarMode.Dock),a.yG2(),a.E7m("ngIf",ge.heightCondition&&ge.positionConditionLow&&ge.isDesktop),a.yG2(),a.E7m("ngIf",ge.mode===ge.actionbarMode.Overlay),a.yG2(),a.E7m("ngIf",ge.mode===ge.actionbarMode.Context))},dependencies:[C.u_,e.oJ,e.um,f.KO,f.a4,L.oB,L.qL,P.iI,P.oL,P.Y1,V,C.Iw,o._A,o.aM,o.yG,d.NR,d.SM,C.a,h._s,W.sD],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto;position:relative}.horizontal[_nghost-%COMP%]{max-width:100%;overflow:unset}.horizontal[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{width:auto;white-space:nowrap}.horizontal[_nghost-%COMP%]   igo-actionbar-item[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]   .buttonOverlay[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .context-menu-card[_ngcontent-%COMP%]{padding:8px 3px;margin:10px}[_nghost-%COMP%]   #topChevron[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff;z-index:3;display:flex;justify-content:center}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){[_nghost-%COMP%]   #topChevron[_ngcontent-%COMP%]{position:fixed;top:unset}}@supports (-ms-accelerator: true){[_nghost-%COMP%]   #topChevron[_ngcontent-%COMP%]{position:fixed;top:unset}}[_nghost-%COMP%]   #lowChevron[_ngcontent-%COMP%]{position:sticky;bottom:0;background-color:#fff;z-index:3;display:flex;justify-content:center}[_nghost-%COMP%]   .igo-actionbar-overlay[_ngcontent-%COMP%]{min-width:inherit!important;padding-top:0;padding-bottom:0}[_nghost-%COMP%]   .igo-actionbar-overlay[_ngcontent-%COMP%]   .mat-mdc-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]   .igo-actionbar-overlay[_ngcontent-%COMP%]   .mat-mdc-menu-content[_ngcontent-%COMP%]:not(:empty){padding-top:0;padding-bottom:0}[_nghost-%COMP%]     .mdc-list-item__primary-text{white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;line-height:18px;-webkit-box-orient:vertical;-webkit-line-clamp:2}"],changeDetection:0})}return q})();var fe=r(71904),Se=r(50244),ae=r(42536),le=r(47080),oe=r(50068);function se(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"div",4)(1,"color-chrome",5),a.qCj("onChange",function(ge){a.usT(E);const Ye=a.GaO();return a.CGJ(Ye.handleChange(ge))}),a.C$Y(),a.I0R(2,"div",6)(3,"button",7),a.qCj("click",function(ge){a.usT(E);const Ye=a.GaO();return a.CGJ(Ye.handleClick(ge))}),a.OEk(4),a.wVc(5,"translate"),a.C$Y()()()}if(2&q){const E=a.GaO();a.yG2(),a.E7m("color",E.colorPicker),a.yG2(3),a.oRS(" ",a.kDX(5,2,"igo.common.confirmDialog.applyBtn")," ")}}let me=(()=>{class q{isOpen=!1;set value(E){this._value=this.formatColor(E??"#000"),this.colorPicker=this._value,this.onChange(this.value),this.onTouch(this.value)}get value(){return this._value}_value;outputFormat="rgba";colorChange=new a._w7;colorPicker;onChange=()=>{};onTouch=()=>{};writeValue(E){this.value=E}registerOnChange(E){this.onChange=E}registerOnTouched(E){this.onTouch=E}handleClick(E){E.preventDefault(),E.stopPropagation(),this.isOpen=!1,this.value=this.colorPicker}handleChange(E){this.colorPicker=this.formatColor(E.color.rgb,"rgba"),this.colorChange.emit(this.formatColor(this.colorPicker))}formatColor(E,ee=this.outputFormat){switch(ee){case"hex":E=(0,oe.c)(E).toHexString();break;case"rgba":default:E=(0,oe.c)(E).toRgbString();break;case"hsla":E=(0,oe.c)(E).toHsvString()}return E}static \u0275fac=function(ee){return new(ee||q)};static \u0275cmp=a.In1({type:q,selectors:[["igo-color-picker-form-field"]],inputs:{outputFormat:"outputFormat"},outputs:{colorChange:"colorChange"},standalone:!0,features:[a.M5G([{provide:fe.Y6,useExisting:(0,a.wd)(()=>q),multi:!0}]),a.UHJ],decls:6,vars:7,consts:[["floatLabel","always","tooltip-position","below","matTooltipShowDelay","500","subscriptSizing","dynamic","cdkOverlayOrigin","",1,"fill-field",3,"click"],["trigger","cdkOverlayOrigin"],["type","text","matInput","",3,"readonly"],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"picker"],[3,"color","onChange"],[1,"buttons"],["mat-flat-button","","color","primary",3,"click"]],template:function(ee,ge){if(1&ee&&(a.I0R(0,"mat-form-field",0,1),a.qCj("click",function(){return ge.isOpen=!ge.isOpen}),a.I0R(2,"mat-label"),a.OEk(3),a.C$Y(),a.wR5(4,"input",2),a.C$Y(),a.yuY(5,se,6,4,"ng-template",3),a.qCj("backdropClick",function(){return ge.isOpen=!1})),2&ee){const Ye=a.Gew(1);a.yG2(3),a.cNF(ge.colorPicker),a.yG2(),a.m4B("background",ge.colorPicker),a.E7m("readonly",!0),a.yG2(),a.E7m("cdkConnectedOverlayOrigin",Ye)("cdkConnectedOverlayOpen",ge.isOpen)("cdkConnectedOverlayHasBackdrop",!0)}},dependencies:[Se.wb,Se.Up,Se.w5,B.wW,ae.cN,ae.yi,B.eC,le.on,le.OY,e.oJ,e.Gw,h._s,W.sD],styles:[".picker[_ngcontent-%COMP%]{left:100%;position:absolute;top:100%;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 3px 1px -2px #0003,0 2px 2px #00000024,0 1px 5px #0000001f}.picker[_ngcontent-%COMP%]     .chrome-picker{box-shadow:none}.picker[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{padding:4px 12px 8px;display:flex;justify-content:flex-end}"]})}return q})();var ke=r(40600);let qe=(()=>{class q{dialogRef;confirmMessage;titleKey="igo.common.confirmDialog.title";proccessKey="igo.common.confirmDialog.confirmBtn";cancelKey="igo.common.confirmDialog.cancelBtn";constructor(E){this.dialogRef=E}static \u0275fac=function(ee){return new(ee||q)(a.GI1(ke.yI))};static \u0275cmp=a.In1({type:q,selectors:[["igo-confirm-dialog"]],standalone:!0,features:[a.UHJ],decls:13,vars:12,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"click"],["mat-flat-button","",3,"click"]],template:function(ee,ge){1&ee&&(a.I0R(0,"h2",0),a.OEk(1),a.wVc(2,"translate"),a.C$Y(),a.I0R(3,"div",1),a.OEk(4),a.wVc(5,"translate"),a.C$Y(),a.I0R(6,"div",2)(7,"button",3),a.qCj("click",function(){return ge.dialogRef.close(!0)}),a.OEk(8),a.wVc(9,"translate"),a.C$Y(),a.I0R(10,"button",4),a.qCj("click",function(){return ge.dialogRef.close(!1)}),a.OEk(11),a.wVc(12,"translate"),a.C$Y()()),2&ee&&(a.yG2(),a.oRS(" ",a.kDX(2,4,ge.titleKey),"\n"),a.yG2(3),a.oRS(" ",a.kDX(5,6,ge.confirmMessage),"\n"),a.yG2(4),a.oRS(" ",a.kDX(9,8,ge.proccessKey)," "),a.yG2(3),a.oRS(" ",a.kDX(12,10,ge.cancelKey)," "))},dependencies:[ke.WQ,ke.iU,ke.Yp,e.oJ,e.Gw,h._s,W.sD],styles:["h2[_ngcontent-%COMP%]{margin:5px 0 10px}div[mat-dialog-content][_ngcontent-%COMP%]{max-width:200px}div[mat-dialog-actions][_ngcontent-%COMP%]{margin:10px 0 0}"]})}return q})(),nt=(()=>{class q{dialog;constructor(E){this.dialog=E}open(E,ee){const ge={title:"igo.common.confirmDialog.title",modeYesNo:!1,...ee},Ye=this.dialog.open(qe,{disableClose:!1});return Ye.componentInstance.confirmMessage=E,Ye.componentInstance.titleKey=ge.title,ge.modeYesNo&&(Ye.componentInstance.proccessKey="igo.common.confirmDialog.yes",Ye.componentInstance.cancelKey="igo.common.confirmDialog.no"),Ye.afterClosed()}static \u0275fac=function(ee){return new(ee||q)(a.CoB(ke.qW))};static \u0275prov=a.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})(),Ue=(()=>{class q{static forRoot(){return{ngModule:q,providers:[]}}static \u0275fac=function(ee){return new(ee||q)};static \u0275mod=a.a4G({type:q});static \u0275inj=a.s3X({providers:[nt],imports:[qe]})}return q})();var St=r(66165);r(800),r(14944);var ot=r(97092);let lt=(()=>{class q{get html(){return this._html}set html(E){this._html=E}_html="";constructor(){}static \u0275fac=function(ee){return new(ee||q)};static \u0275cmp=a.In1({type:q,selectors:[["igo-custom-html"]],inputs:{html:"html"},standalone:!0,features:[a.UHJ],decls:2,vars:3,consts:[[1,"custom-html",3,"innerHTML"]],template:function(ee,ge){1&ee&&(a.wR5(0,"div",0),a.wVc(1,"sanitizeHtml")),2&ee&&a.E7m("innerHTML",a.kDX(1,1,ge.html),a.E3n)},dependencies:[ot.U],styles:["[_nghost-%COMP%]   .custom-html[_ngcontent-%COMP%]{padding:20px}"]})}return q})();var Me=r(58136),ct=r(25812);function Oe(q,Re){if(1&q&&(a.I0R(0,"div",5),a.wR5(1,"igo-form-field",6),a.C$Y()),2&q){const E=Re.$implicit,ee=a.GaO(2);a.E7m("ngClass",ee.getFieldNgClass(E)),a.yG2(),a.E7m("field",E)}}function He(q,Re){if(1&q&&(a.I0R(0,"div",3),a.yuY(1,Oe,2,2,"div",4),a.C$Y()),2&q){const E=a.GaO();a.yG2(),a.E7m("ngForOf",E.group.fields)}}function ze(q,Re){if(1&q&&(a.I0R(0,"mat-error"),a.OEk(1),a.wVc(2,"translate"),a.C$Y()),2&q){const E=a.GaO();a.yG2(),a.cNF(a.kDX(2,1,E.getErrorMessage()))}}const Rt=["*"];let Ft=(()=>{class q{group;errors;get formControl(){return this.group.control}constructor(){}getFieldColSpan(E){let ee=2;const ge=E.options||{};return ge.cols&&ge.cols>0&&(ee=Math.min(ge.cols,2)),ee}getFieldNgClass(E){return{[`igo-form-field-colspan-${this.getFieldColSpan(E)}`]:!0}}getErrorMessage(){return(0,ct.KW)(this.formControl,(this.group.options||{}).errors||{})}static \u0275fac=function(ee){return new(ee||q)};static \u0275cmp=a.In1({type:q,selectors:[["igo-form-group"]],inputs:{group:"group",errors:"errors"},standalone:!0,features:[a.UHJ],ngContentSelectors:Rt,decls:4,vars:2,consts:[["class","igo-form-group-fields",4,"ngIf"],[1,"igo-form-group-extra-content"],[4,"ngIf"],[1,"igo-form-group-fields"],["class","igo-form-field-wrapper",3,"ngClass",4,"ngFor","ngForOf"],[1,"igo-form-field-wrapper",3,"ngClass"],[3,"field"]],template:function(ee,ge){1&ee&&(a.kPM(),a.yuY(0,He,2,1,"div",0),a.I0R(1,"div",1),a._Xx(2),a.C$Y(),a.yuY(3,ze,3,3,"mat-error",2)),2&ee&&(a.E7m("ngIf",ge.group&&ge.group.fields.length>0),a.yG2(3),a.E7m("ngIf",ge.formControl.errors))},dependencies:[C.u_,C.Iw,C.QF,Me._,Se.wb,Se.wJ,h._s,W.sD],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block;overflow:auto;padding:10px 5px;box-sizing:border-box}[_nghost-%COMP%]   .igo-form-field-colspan-2[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .igo-form-field-colspan-1[_ngcontent-%COMP%]{width:50%}"],changeDetection:0})}return q})();var Et=r(87004);let ko=(()=>{class q{formBuilder;constructor(E){this.formBuilder=E}form(E,ee){const ge=this.formBuilder.group({});return E.forEach(Ye=>{ge.addControl(Ye.name,Ye.control)}),ee.forEach(Ye=>{ge.addControl(Ye.name,Ye.control)}),{fields:E,groups:ee,control:ge}}group(E,ee){const ge=E.options||{},Ye=this.formBuilder.group({});if(ee.forEach(Je=>{Ye.addControl(Je.name,Je.control)}),ge.validator){const Je=this.getValidators(ge.validator);Ye.setValidators(Je)}return Object.assign({},E,{fields:ee,control:Ye})}field(E){const ee=E.options||{},Ye=this.formBuilder.control({value:"",disabled:ee.disabled});if(ee.validator){const Je=this.getValidators(ee.validator);Ye.setValidators(Je)}return Object.assign({type:"text"},E,{control:Ye})}extendFieldConfig(E,ee){const ge=Object.assign({},E.options||{},ee.options||{}),Ye=Object.assign({},E.inputs||{},ee.inputs||{}),Je=Object.assign({},E.subscribers||{},ee.subscribers||{});return Object.assign({},E,{options:ge,inputs:Ye,subscribers:Je})}getValidators(E){return Array.isArray(E)?E.map(ee=>this.getValidator(ee)):this.getValidator(E)}getValidator(E){if("string"!=typeof E)return E;const ge=E.match(/^([a-zA-Z]{3,15})\((.{0,20})\)$/);return ge?fe.AQ[ge[1]](ge[2]):fe.AQ[E]}static \u0275fac=function(ee){return new(ee||q)(a.CoB(fe.KE))};static \u0275prov=a.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})();function so(q,Re){1&q&&a.wR5(0,"igo-form-field",11),2&q&&a.E7m("field",Re.$implicit)}function Si(q,Re){1&q&&a.wR5(0,"igo-form-group",12),2&q&&a.E7m("group",Re.$implicit)}function bi(q,Re){if(1&q&&(a.I0R(0,"div",8),a.yuY(1,so,1,1,"igo-form-field",9)(2,Si,1,1,"igo-form-group",10),a.C$Y()),2&q){const E=a.GaO().ngIf;a.yG2(),a.E7m("ngForOf",E.fields),a.yG2(),a.E7m("ngForOf",E.groups)}}function Bi(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"igo-form",3),a.qCj("submitForm",function(ge){a.usT(E);const Ye=a.GaO();return a.CGJ(Ye.onSubmit(ge))}),a.wVc(1,"async"),a.yuY(2,bi,3,2,"div",4),a.I0R(3,"div",5)(4,"button",6),a.qCj("click",function(){a.usT(E);const ge=a.GaO();return a.CGJ(ge.cancel())}),a.OEk(5),a.wVc(6,"translate"),a.C$Y(),a.I0R(7,"button",7),a.OEk(8),a.wVc(9,"translate"),a.C$Y()()()}if(2&q){const E=Re.ngIf,ee=a.GaO();a.E7m("form",E)("formData",a.kDX(1,5,ee.data$)),a.yG2(2),a.E7m("ngIf",E.fields.length),a.yG2(3),a.oRS(" ",a.kDX(6,7,ee.data.cancelButtonText)," "),a.yG2(3),a.oRS(" ",a.kDX(9,9,ee.data.processButtonText)," ")}}function Ke(q,Re){if(1&q&&a.wR5(0,"igo-custom-html",13),2&q){const E=a.GaO();a.E7m("html",E.data.notice)}}let Ze=(()=>{class q{languageService;dialogRef;formService;data;form$=new y.g(void 0);data$=new y.g(void 0);constructor(E,ee,ge,Ye){this.languageService=E,this.dialogRef=ee,this.formService=ge,this.data=Ye,this.data.processButtonText=this.data.processButtonText??"igo.common.formDialog.processButtonText",this.data.cancelButtonText=this.data.cancelButtonText??"igo.common.formDialog.cancelButtonText",this.data.title=this.data.title??"igo.common.formDialog.title",this.data$=this.data.data$;let Je=[],ro=[];this.data.formFieldConfigs?.map(Fo=>Je.push(this.formService.field(Fo))),this.data.formGroupsConfigs?.map(Fo=>{const jo=Fo.formFieldConfigs?.map(Ln=>this.formService.field(Ln));ro.push(this.formService.group({name:Fo.name},jo))});const yi=this.formService.form(Je,ro);this.form$.next(yi)}onSubmit(E){const ee=this.form$.getValue();ee.control.valid?this.dialogRef.close(E):ee.groups?.length?ee.groups.map(ge=>{Object.keys(ge.control.controls).map(Ye=>{ge.control.controls[Ye].markAsTouched(),ge.control.controls[Ye].updateValueAndValidity()})}):ee.fields.map(ge=>{ge.control.markAsTouched(),ge.control.updateValueAndValidity()})}cancel(){this.dialogRef.close()}static \u0275fac=function(ee){return new(ee||q)(a.GI1(h.ov),a.GI1(ke.yI),a.GI1(ko),a.GI1(ke.sR))};static \u0275cmp=a.In1({type:q,selectors:[["igo-form-dialog"]],standalone:!0,features:[a.UHJ],decls:7,vars:7,consts:[["mat-dialog-title",""],[3,"form","formData","submitForm",4,"ngIf"],[3,"html",4,"ngIf"],[3,"form","formData","submitForm"],["class","form-dialog-container",4,"ngIf"],["formButtons","","mat-dialog-actions",""],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary"],[1,"form-dialog-container"],[3,"field",4,"ngFor","ngForOf"],[3,"group",4,"ngFor","ngForOf"],[3,"field"],[3,"group"],[3,"html"]],template:function(ee,ge){1&ee&&(a.I0R(0,"h1",0),a.OEk(1),a.wVc(2,"translate"),a.C$Y(),a.yuY(3,Bi,10,11,"igo-form",1),a.wVc(4,"async"),a.I0R(5,"div"),a.yuY(6,Ke,1,1,"igo-custom-html",2),a.C$Y()),2&ee&&(a.yG2(),a.cNF(a.kDX(2,3,ge.data.title)),a.yG2(2),a.E7m("ngIf",a.kDX(4,5,ge.form$)),a.yG2(3),a.E7m("ngIf",ge.data.notice&&""!==ge.data.notice))},dependencies:[ke.WQ,C.u_,Et.Y,C.Iw,Me._,Ft,ke.Yp,e.oJ,e.Gw,lt,C.a,h._s,W.sD],styles:["[_nghost-%COMP%]   div[mat-dialog-actions][_ngcontent-%COMP%]{margin:10px 0 0}[_nghost-%COMP%]   .form-dialog-container[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .form-dialog-container[_ngcontent-%COMP%]   igo-form-field[_ngcontent-%COMP%], [_nghost-%COMP%]   .form-dialog-container[_ngcontent-%COMP%]   igo-form-group[_ngcontent-%COMP%]{display:block;height:auto}"]})}return q})(),dt=(()=>{class q{dialog;constructor(E){this.dialog=E}open(E,ee){const ge={formFieldConfigs:E.formFieldConfigs,formGroupsConfigs:E.formGroupsConfigs,...ee};return this.dialog.open(Ze,{disableClose:!1,data:ge,...ee}).afterClosed()}static \u0275fac=function(ee){return new(ee||q)(a.CoB(ke.qW))};static \u0275prov=a.wxM({token:q,factory:q.\u0275fac})}return q})(),ht=(()=>{class q{static forRoot(){return{ngModule:q,providers:[]}}static \u0275fac=function(ee){return new(ee||q)};static \u0275mod=a.a4G({type:q});static \u0275inj=a.s3X({providers:[dt],imports:[ke.sr,Ze]})}return q})();var lo=r(21124),Ht=r(46176),mt=r(77872),Eo=r(69368);function Lt(q){return Re=>{Eo.Q.register(q,Re)}}function Ho(q,Re){if(1&q&&(a.I0R(0,"mat-option",4),a.OEk(1),a.C$Y()),2&q){const E=Re.$implicit;a.E7m("value",E.value),a.yG2(),a.oRS(" ",E.title," ")}}function qo(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"mat-icon",5),a.qCj("click",function(){a.usT(E);const ge=a.GaO();return a.CGJ(ge.onDisableSwitchClick())}),a.OEk(1),a.wVc(2,"async"),a.C$Y()}if(2&q){const E=a.GaO();a.yG2(),a.oRS("",!0===a.kDX(2,1,E.disabled$)?"check_box_outline_blank":"check_box"," ")}}function Ro(q,Re){if(1&q&&(a.I0R(0,"mat-error"),a.OEk(1),a.wVc(2,"translate"),a.C$Y()),2&q){const E=a.GaO();a.yG2(),a.cNF(a.kDX(2,1,E.getErrorMessage()))}}let xt=class Es{disabled$=new y.g(!1);set choices(Re){this.choices$.next(Re)}get choices(){return this.choices$.value}choices$=new y.g([]);multiple=!1;formControl;placeholder;errors;disableSwitch=!1;get required(){return(0,ct.qs)(this.formControl)}ngOnInit(){this.disabled$.next(this.formControl.disabled)}getErrorMessage(){return(0,ct.KW)(this.formControl,this.errors)}onDisableSwitchClick(){this.toggleDisabled()}toggleDisabled(){const Re=!this.disabled$.value;!0===Re?this.formControl.disable():this.formControl.enable(),this.disabled$.next(Re)}static \u0275fac=function(E){return new(E||Es)};static \u0275cmp=a.In1({type:Es,selectors:[["igo-form-field-select"]],inputs:{choices:"choices",multiple:"multiple",formControl:"formControl",placeholder:"placeholder",errors:"errors",disableSwitch:"disableSwitch"},standalone:!0,features:[a.UHJ],decls:6,vars:9,consts:[[3,"multiple","required","placeholder","formControl"],[3,"value",4,"ngFor","ngForOf"],["class","igo-form-disable-switch","matPrefix","",3,"click",4,"ngIf"],[4,"ngIf"],[3,"value"],["matPrefix","",1,"igo-form-disable-switch",3,"click"]],template:function(E,ee){1&E&&(a.I0R(0,"mat-form-field")(1,"mat-select",0),a.yuY(2,Ho,2,2,"mat-option",1),a.wVc(3,"async"),a.C$Y(),a.yuY(4,qo,3,3,"mat-icon",2)(5,Ro,3,3,"mat-error",3),a.C$Y()),2&E&&(a.yG2(),a.E7m("multiple",ee.multiple)("required",ee.required)("placeholder",ee.placeholder)("formControl",ee.formControl),a.yG2(),a.E7m("ngForOf",a.kDX(3,7,ee.choices$)),a.yG2(2),a.E7m("ngIf",!0===ee.disableSwitch),a.yG2(),a.E7m("ngIf",ee.formControl.errors))},dependencies:[Se.wb,Se.Up,Se.wJ,Se.is,mt.d5,mt.kX,Ht.I5,fe.y,fe.ue,fe.eJ,fe.sl,fe.ug,C.Iw,Ht.Ax,C.u_,L.oB,L.qL,C.a,h._s,W.sD],encapsulation:2,changeDetection:0})};function zt(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"mat-icon",4),a.qCj("click",function(){a.usT(E);const ge=a.GaO();return a.CGJ(ge.onDisableSwitchClick())}),a.OEk(1),a.wVc(2,"async"),a.C$Y()}if(2&q){const E=a.GaO();a.yG2(),a.oRS("",!0===a.kDX(2,1,E.disabled$)?"check_box_outline_blank":"check_box"," ")}}function Ut(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"button",5),a.qCj("click",function(){a.usT(E);const ge=a.GaO();return a.CGJ(ge.togglePassword())}),a.I0R(1,"mat-icon",6),a.OEk(2),a.C$Y()()}if(2&q){const E=a.GaO();a.yG2(2),a.cNF(E.hide?"visibility_off":"visibility")}}function ei(q,Re){if(1&q&&(a.I0R(0,"mat-error"),a.OEk(1),a.wVc(2,"translate"),a.C$Y()),2&q){const E=a.GaO();a.yG2(),a.cNF(a.kDX(2,1,E.getErrorMessage()))}}xt=(0,lo.UN)([Lt("select")],xt);let Xt=class xs{cdRef;disabled$=new y.g(!1);hide=!0;lastTimeoutRequest;formControl;placeholder;isPassword;errors;disableSwitch=!1;get required(){return(0,ct.qs)(this.formControl)}constructor(Re){this.cdRef=Re}ngOnInit(){this.disabled$.next(this.formControl.disabled)}getErrorMessage(){return(0,ct.KW)(this.formControl,this.errors)}onDisableSwitchClick(){this.toggleDisabled()}toggleDisabled(){const Re=!this.disabled$.value;!0===Re?this.formControl.disable():this.formControl.enable(),this.disabled$.next(Re)}togglePassword(){this.hide=!this.hide,this.delayedHide()}delayedHide(Re=1e4){this.isPassword&&!this.hide&&(this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest),this.lastTimeoutRequest=setTimeout(()=>{this.hide=!0,this.cdRef.detectChanges()},Re))}static \u0275fac=function(E){return new(E||xs)(a.GI1(a.kD9))};static \u0275cmp=a.In1({type:xs,selectors:[["igo-form-field-text"]],inputs:{formControl:"formControl",placeholder:"placeholder",isPassword:"isPassword",errors:"errors",disableSwitch:"disableSwitch"},standalone:!0,features:[a.UHJ],decls:5,vars:7,consts:[["matInput","",3,"type","required","placeholder","formControl","blur","change"],["class","igo-form-disable-switch","matPrefix","",3,"click",4,"ngIf"],["type","button","matSuffix","","mat-icon-button","",3,"click",4,"ngIf"],[4,"ngIf"],["matPrefix","",1,"igo-form-disable-switch",3,"click"],["type","button","matSuffix","","mat-icon-button","",3,"click"],["color","primary"]],template:function(E,ee){1&E&&(a.I0R(0,"mat-form-field")(1,"input",0),a.qCj("blur",function(){return ee.delayedHide(0)})("change",function(){return ee.delayedHide()}),a.C$Y(),a.yuY(2,zt,3,3,"mat-icon",1)(3,Ut,3,1,"button",2)(4,ei,3,3,"mat-error",3),a.C$Y()),2&E&&(a.yG2(),a.E7m("type",ee.isPassword&&ee.hide?"password":"text")("required",ee.isPassword?"true":ee.required)("placeholder",ee.placeholder)("formControl",ee.formControl),a.yG2(),a.E7m("ngIf",!0===ee.disableSwitch),a.yG2(),a.E7m("ngIf",ee.isPassword),a.yG2(),a.E7m("ngIf",ee.formControl.errors))},dependencies:[Se.wb,Se.Up,Se.wJ,Se.is,Se.Gm,ae.cN,ae.yi,fe.y,fe.ot,fe.ue,fe.eJ,fe.sl,fe.ug,C.u_,L.oB,L.qL,e.oJ,e.um,C.a,h._s,W.sD],encapsulation:2,changeDetection:0})};function De(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"mat-icon",3),a.qCj("click",function(){a.usT(E);const ge=a.GaO();return a.CGJ(ge.onDisableSwitchClick())}),a.OEk(1),a.wVc(2,"async"),a.C$Y()}if(2&q){const E=a.GaO();a.yG2(),a.oRS("",!0===a.kDX(2,1,E.disabled$)?"check_box_outline_blank":"check_box"," ")}}function et(q,Re){if(1&q&&(a.I0R(0,"mat-error"),a.OEk(1),a.wVc(2,"translate"),a.C$Y()),2&q){const E=a.GaO();a.yG2(),a.cNF(a.kDX(2,1,E.getErrorMessage()))}}Xt=(0,lo.UN)([Lt("text"),(0,lo.YR)("design:paramtypes",[a.kD9])],Xt);let he=class Ms{disabled$=new y.g(!1);formControl;placeholder;errors;disableSwitch=!1;get required(){return(0,ct.qs)(this.formControl)}ngOnInit(){this.disabled$.next(this.formControl.disabled)}getErrorMessage(){return(0,ct.KW)(this.formControl,this.errors)}onDisableSwitchClick(){this.toggleDisabled()}toggleDisabled(){const Re=!this.disabled$.value;!0===Re?this.formControl.disable():this.formControl.enable(),this.disabled$.next(Re)}static \u0275fac=function(E){return new(E||Ms)};static \u0275cmp=a.In1({type:Ms,selectors:[["igo-form-field-textarea"]],inputs:{formControl:"formControl",placeholder:"placeholder",errors:"errors",disableSwitch:"disableSwitch"},standalone:!0,features:[a.UHJ],decls:5,vars:5,consts:[["matInput","",3,"required","placeholder","formControl"],["class","igo-form-disable-switch","matPrefix","",3,"click",4,"ngIf"],[4,"ngIf"],["matPrefix","",1,"igo-form-disable-switch",3,"click"]],template:function(E,ee){1&E&&(a.I0R(0,"mat-form-field")(1,"textarea",0),a.OEk(2,"  "),a.C$Y(),a.yuY(3,De,3,3,"mat-icon",1)(4,et,3,3,"mat-error",2),a.C$Y()),2&E&&(a.yG2(),a.E7m("required",ee.required)("placeholder",ee.placeholder)("formControl",ee.formControl),a.yG2(2),a.E7m("ngIf",!0===ee.disableSwitch),a.yG2(),a.E7m("ngIf",ee.formControl.errors))},dependencies:[Se.wb,Se.Up,Se.wJ,Se.is,ae.cN,ae.yi,fe.y,fe.ot,fe.ue,fe.eJ,fe.sl,fe.ug,C.u_,L.oB,L.qL,C.a,h._s,W.sD],encapsulation:2,changeDetection:0})};he=(0,lo.UN)([Lt("textarea")],he);var xe=r(880),$t=r(15e3),to=r(26496);let Ot=(()=>{class q{static \u0275fac=function(ee){return new(ee||q)};static \u0275mod=a.a4G({type:q});static \u0275inj=a.s3X({providers:[to.I,$t.C],imports:[xe.E]})}return q})();function kt(q,Re){1&q&&a.C_f(0)}function yt(q,Re){1&q&&a.C_f(0)}const Gt=(q,Re)=>({obj:q,baseKey:Re});function zo(q,Re){if(1&q&&(a.SAx(0),a.yuY(1,yt,1,0,"ng-container",2),a.k70()),2&q){const E=a.GaO(2).$implicit,ee=a.GaO().baseKey,ge=a.GaO(),Ye=a.Gew(5);a.yG2(),a.E7m("ngTemplateOutlet",Ye)("ngTemplateOutletContext",a.IBC(2,Gt,E.value,ge.getKey(ee,E.key)))}}function Vn(q,Re){if(1&q&&(a.I0R(0,"p")(1,"span")(2,"b"),a.OEk(3),a.C$Y(),a.OEk(4," : "),a.C$Y(),a.wR5(5,"span",10),a.C$Y()),2&q){const E=a.GaO(2).$implicit,ee=a.GaO().baseKey,ge=a.GaO();a.yG2(3),a.cNF(ge.getKey(ee,E.key)),a.yG2(2),a.E7m("innerHtml",E.value,a.E3n)}}function vo(q,Re){if(1&q&&(a.SAx(0),a.yuY(1,zo,2,5,"ng-container",8)(2,Vn,6,2,"ng-template",null,9,a.gJz),a.k70()),2&q){const E=a.Gew(3),ee=a.GaO().$implicit,ge=a.GaO(2);a.yG2(),a.E7m("ngIf",ge.isObject(ee.value))("ngIfElse",E)}}function sn(q,Re){if(1&q&&(a.SAx(0),a.yuY(1,vo,4,2,"ng-container",7),a.k70()),2&q){const E=Re.$implicit,ee=a.GaO().baseKey,ge=a.GaO();a.yG2(),a.E7m("ngIf",-1===ge.ignoreKeys.indexOf(ge.getKey(ee,E.key)))}}function Oi(q,Re){1&q&&(a.yuY(0,sn,2,1,"ng-container",6),a.wVc(1,"keyvalue")),2&q&&a.E7m("ngForOf",a.kDX(1,1,Re.obj))}const an=q=>({obj:q});let ti=(()=>{class q{dialogRef;title;data;ignoreKeys;constructor(E){this.dialogRef=E}isObject(E){return"object"==typeof E&&!Array.isArray(E)}getKey(E,ee){return(E?E+".":"")+ee}static \u0275fac=function(ee){return new(ee||q)(a.GI1(ke.yI))};static \u0275cmp=a.In1({type:q,selectors:[["igo-json-dialog"]],standalone:!0,features:[a.UHJ],decls:9,vars:5,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["loopObject",""],["mat-dialog-actions",""],["mat-button","","color","primary",3,"click"],[4,"ngFor","ngForOf"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["notObject",""],[1,"propertyValue",3,"innerHtml"]],template:function(ee,ge){if(1&ee&&(a.I0R(0,"h1",0),a.OEk(1),a.C$Y(),a.I0R(2,"div",1),a.yuY(3,kt,1,0,"ng-container",2)(4,Oi,2,3,"ng-template",null,3,a.gJz),a.C$Y(),a.I0R(6,"div",4)(7,"button",5),a.qCj("click",function(){return ge.dialogRef.close(!1)}),a.OEk(8," OK "),a.C$Y()()),2&ee){const Ye=a.Gew(5);a.yG2(),a.cNF(ge.title),a.yG2(2),a.E7m("ngTemplateOutlet",Ye)("ngTemplateOutletContext",a.S45(3,an,ge.data))}},dependencies:[ke.WQ,ke.iU,C.XV,C.Iw,C.u_,ke.Yp,e.oJ,e.Gw,C.uq],encapsulation:2})}return q})(),oi=(()=>{class q{dialog;constructor(E){this.dialog=E}open(E,ee,ge){const Ye=this.dialog.open(ti,{disableClose:!1});return Ye.componentInstance.data=ee,Ye.componentInstance.title=E,Ye.componentInstance.ignoreKeys=ge??[],Ye.afterClosed()}static \u0275fac=function(ee){return new(ee||q)(a.CoB(ke.qW))};static \u0275prov=a.wxM({token:q,factory:q.\u0275fac})}return q})(),ii=(()=>{class q{static forRoot(){return{ngModule:q}}static \u0275fac=function(ee){return new(ee||q)};static \u0275mod=a.a4G({type:q});static \u0275inj=a.s3X({providers:[oi],imports:[ti]})}return q})();var ni=r(21232),ri=r(64080);function Lo(q,Re){if(1&q&&(a.I0R(0,"mat-checkbox",10),a.OEk(1),a.C$Y()),2&q){const E=Re.$implicit;a._6D("formControlName",E.value),a.yG2(),a.cNF(E.title||E.value)}}function si(q,Re){if(1&q&&a.yuY(0,Lo,2,2,"ng-template",9),2&q){const E=a.GaO();a.E7m("ngForOf",E.data.choices)}}function Ii(q,Re){if(1&q&&(a.I0R(0,"mat-radio-button",13),a.OEk(1),a.C$Y()),2&q){const E=Re.$implicit;a.E7m("value",E.value),a.yG2(),a.oRS(" ",E.title||E.value," ")}}function wi(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"mat-radio-group",11),a.qCj("change",function(ge){a.usT(E);const Ye=a.GaO();return a.CGJ(Ye.onChange(ge))}),a.yuY(1,Ii,2,2,"mat-radio-button",12),a.C$Y()}if(2&q){const E=a.GaO();a.yG2(),a.E7m("ngForOf",E.data.choices)}}let Ui=(()=>{class q{formBuilder;languageService;dialogRef;data;formGroup;isDisabled$=new y.g(!0);constructor(E,ee,ge,Ye){this.formBuilder=E,this.languageService=ee,this.dialogRef=ge,this.data=Ye,this.formGroup=this.formBuilder.group(this.getFg()),this.data.selectFieldText=this.data.selectFieldText??"igo.common.selectValueDialog.selectFieldText",this.data.processButtonText=this.data.processButtonText??"igo.common.selectValueDialog.processButtonText",this.data.cancelButtonText=this.data.cancelButtonText??"igo.common.selectValueDialog.cancelButtonText",this.data.title=this.data.title??"igo.common.selectValueDialog.multipleTitle",this.data.type===ri.H.Radio&&(this.data.title="igo.common.selectValueDialog.title")}ngOnInit(){this.formGroup.valueChanges.subscribe(()=>this.canProcess())}getFg(){const E={};return this.data.choices.map(ee=>E[ee.value]=!1),E}canProcess(){const E=this.data.choices.map(ge=>ge.value),ee=[];E.map(ge=>this.formGroup.value[ge]?ee.push(ge):void 0),this.isDisabled$.next(!ee.length)}save(){const E=this.data.choices.map(ge=>ge.value),ee=[];E.map(ge=>this.formGroup.value[ge]?ee.push(ge):void 0),this.dialogRef.close({choices:ee})}cancel(){this.dialogRef.close()}onChange(E){const ee={};this.data.choices.map(ge=>ee[ge.value]=!1),ee[E.value]=!0,this.formGroup.setValue(ee)}static \u0275fac=function(ee){return new(ee||q)(a.GI1(fe.KE),a.GI1(h.ov),a.GI1(ke.yI),a.GI1(ke.sR,8))};static \u0275cmp=a.In1({type:q,selectors:[["igo-select-value-check-radio-dialog"]],standalone:!0,features:[a.UHJ],decls:16,vars:15,consts:[["mat-dialog-title",""],[1,"igo-form",3,"formGroup"],[1,"choices-section"],[4,"ngIf"],[3,"change",4,"ngIf"],["mat-dialog-actions",""],[1,"button-group"],["mat-raised-button","","type","button",3,"click"],["id","processBtnDialog","mat-raised-button","","type","button","color","primary",3,"disabled","click"],["ngFor","",3,"ngForOf"],[3,"formControlName"],[3,"change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(ee,ge){1&ee&&(a.I0R(0,"h1",0),a.OEk(1),a.wVc(2,"translate"),a.C$Y(),a.I0R(3,"form",1)(4,"section",2),a.yuY(5,si,1,1,null,3)(6,wi,2,1,"mat-radio-group",4),a.C$Y(),a.I0R(7,"div",5)(8,"div",6)(9,"button",7),a.qCj("click",function(){return ge.cancel()}),a.OEk(10),a.wVc(11,"translate"),a.C$Y(),a.I0R(12,"button",8),a.qCj("click",function(){return ge.save()}),a.wVc(13,"async"),a.OEk(14),a.wVc(15,"translate"),a.C$Y()()()()),2&ee&&(a.yG2(),a.cNF(a.kDX(2,7,ge.data.title)),a.yG2(2),a.E7m("formGroup",ge.formGroup),a.yG2(2),a.E7m("ngIf","checkbox"===ge.data.type),a.yG2(),a.E7m("ngIf","radio"===ge.data.type),a.yG2(4),a.oRS(" ",a.kDX(11,9,ge.data.cancelButtonText)," "),a.yG2(2),a.E7m("disabled",a.kDX(13,11,ge.isDisabled$)),a.yG2(2),a.oRS(" ",a.kDX(15,13,ge.data.processButtonText)," "))},dependencies:[ke.WQ,fe.y,fe.sz,fe.ue,fe.u,fe.sl,fe.uW,fe.Wo,C.u_,C.Iw,F.Vn,F.WK,ni.yk,ni.cv,ni.cT,ke.Yp,e.oJ,e.Gw,C.a,h._s,W.sD],styles:["[_nghost-%COMP%]  div[mat-dialog-actions]{margin:10px 0 0}[_nghost-%COMP%]  section.choices-section{max-width:auto;display:grid;grid-template-columns:auto auto;grid-gap:0px;padding:5px}"]})}return q})(),Ao=(()=>{class q{dialog;constructor(E){this.dialog=E}open(E,ee){const ge={choices:E,...ee};return this.dialog.open(Ui,{disableClose:!1,data:ge,...ee}).afterClosed()}static \u0275fac=function(ee){return new(ee||q)(a.CoB(ke.qW))};static \u0275prov=a.wxM({token:q,factory:q.\u0275fac})}return q})(),mo=(()=>{class q{static forRoot(){return{ngModule:q,providers:[]}}static \u0275fac=function(ee){return new(ee||q)};static \u0275mod=a.a4G({type:q});static \u0275inj=a.s3X({providers:[Ao],imports:[Ui]})}return q})();r(23302);var ho=r(24112),ai=r(94204);const Ti=q=>({"igo-spinner-container":!0,"igo-spinner-shown":q});let Bo=(()=>{class q{shown$=new y.g(!1);set shown(E){this.shown$.next(E)}get shown(){return this.shown$.value}constructor(){}show(){this.shown=!0}hide(){this.shown=!1}static \u0275fac=function(ee){return new(ee||q)};static \u0275cmp=a.In1({type:q,selectors:[["igo-spinner"]],inputs:{shown:"shown"},standalone:!0,features:[a.UHJ],decls:4,vars:5,consts:[[3,"ngClass"],[1,"igo-spinner-background"],["diameter","40","mode","indeterminate"]],template:function(ee,ge){1&ee&&(a.I0R(0,"div",0),a.wVc(1,"async"),a.wR5(2,"div",1)(3,"mat-progress-spinner",2),a.C$Y()),2&ee&&a.E7m("ngClass",a.S45(3,Ti,a.kDX(1,1,ge.shown$)))},dependencies:[C.QF,ai.cm,C.a],styles:["[_nghost-%COMP%]   .igo-spinner-container[_ngcontent-%COMP%]{display:none;position:relative;pointer-events:none}[_nghost-%COMP%]   .igo-spinner-container.igo-spinner-shown[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]{height:40px;width:40px;border-radius:50%}[_nghost-%COMP%]   .igo-spinner-background[_ngcontent-%COMP%]{height:36px;width:36px;border-radius:50%;border:4px solid #ffffff;position:absolute;top:2px;left:2px}"]})}return q})();var at=r(17469),go=r(76768),Jt=r(80956),So=r(43168),Xo=r(93244),jn=r(11484),Ei=function(q){return q[q.primary=0]="primary",q[q.accent=1]="accent",q[q.warn=2]="warn",q}(Ei||{}),bo=r(728),Uo=r(40604);class Oo extends at.Cc{_database;_model;_sort;get filter(){return this._filterChange.value}set filter(Re){this._filterChange.next(Re)}_filterChange=new y.g("");constructor(Re,E,ee){super(),this._database=Re,this._model=E,this._sort=ee}connect(){return this._database?(0,bo.U)(this._database.dataChange,this._filterChange,this._sort.sortChange).pipe((0,Uo.k)(()=>this.getFilteredData(this._database.data)),(0,Uo.k)(E=>this.getSortedData(E))):(0,bo.U)([])}disconnect(){}getFilteredData(Re){return this.filter?Re.slice().filter(E=>-1!==this._model.columns.filter(ge=>ge.filterable).map(ge=>So.Yv.resolve(E,ge.name)).join(" ").toLowerCase().indexOf(this.filter.toLowerCase())):Re}getSortedData(Re){return this._sort.active&&""!==this._sort.direction?Re.sort((E,ee)=>{const ge=So.Yv.resolve(E,this._sort.active),Ye=So.Yv.resolve(ee,this._sort.active);return So.Yv.naturalCompare(Ye,ge,this._sort.direction)}):Re}}const ln=["filter"];function Vi(q,Re){1&q&&(a.I0R(0,"div",12)(1,"mat-form-field",13),a.wR5(2,"input",14,15),a.wVc(4,"translate"),a.C$Y()()),2&q&&(a.yG2(2),a.E7m("placeholder",a.kDX(4,1,"igo.common.table.filter")))}function Kn(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"th",16)(1,"mat-checkbox",17),a.qCj("change",function(ge){a.usT(E);const Ye=a.GaO();return a.CGJ(ge?Ye.masterToggle():null)}),a.C$Y()()}if(2&q){const E=a.GaO();a.yG2(),a.E7m("checked",E.selection.hasValue()&&E.isAllSelected())("indeterminate",E.selection.hasValue()&&!E.isAllSelected())}}function li(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"td",18)(1,"mat-checkbox",19),a.qCj("click",function(ge){return ge.stopPropagation()})("change",function(ge){const Je=a.usT(E).$implicit,ro=a.GaO();return a.CGJ(ge?ro.selection.toggle(Je):null)}),a.C$Y()()}if(2&q){const E=Re.$implicit,ee=a.GaO();a.yG2(),a.E7m("checked",ee.selection.isSelected(E))}}function Yo(q,Re){if(1&q&&(a.I0R(0,"th",25),a.OEk(1),a.C$Y()),2&q){const E=a.GaO(2).$implicit;a.yG2(),a.oRS(" ",E.title," ")}}function xi(q,Re){1&q&&(a.SAx(0),a.yuY(1,Yo,2,1,"th",24),a.k70())}function Io(q,Re){if(1&q&&(a.I0R(0,"th",16),a.OEk(1),a.C$Y()),2&q){const E=a.GaO(2).$implicit;a.yG2(),a.cNF(E.title)}}function ci(q,Re){1&q&&(a.SAx(0),a.yuY(1,Io,2,1,"th",6),a.k70())}const Vo=()=>({});function ui(q,Re){if(1&q&&(a.I0R(0,"td",27),a.OEk(1),a.C$Y()),2&q){const E=Re.$implicit,ee=a.GaO(2).$implicit,ge=a.GaO();a.E7m("ngClass",ge.model.cellClassFunc?ge.model.cellClassFunc(E,ee):a.q4q(2,Vo)),a.yG2(),a.oRS(" ",ge.getValue(E,ee.name)," ")}}function xo(q,Re){1&q&&(a.SAx(0),a.yuY(1,ui,2,3,"td",26),a.k70())}function ji(q,Re){if(1&q&&a.wR5(0,"td",29),2&q){const E=Re.$implicit,ee=a.GaO(2).$implicit,ge=a.GaO();a.E7m("ngClass",ge.model.cellClassFunc?ge.model.cellClassFunc(E,ee):a.q4q(2,Vo))("innerHTML",ge.getValue(E,ee.name),a.E3n)}}function cn(q,Re){1&q&&a.yuY(0,ji,1,3,"td",28)}function un(q,Re){if(1&q&&(a.SAx(0,20),a.yuY(1,xi,2,0,"ng-container",21)(2,ci,2,0,"ng-container",21)(3,xo,2,0,"ng-container",22)(4,cn,1,0,"ng-template",null,23,a.gJz),a.k70()),2&q){const E=Re.$implicit,ee=a.Gew(5);a.E7m("matColumnDef",E.name),a.yG2(),a.E7m("ngIf",E.sortable),a.yG2(),a.E7m("ngIf",!E.sortable),a.yG2(),a.E7m("ngIf",!E.html)("ngIfElse",ee)}}function dn(q,Re){1&q&&a.wR5(0,"th",16)}function pn(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"button",31),a.qCj("click",function(ge){const Je=a.usT(E).$implicit,ro=a.GaO().$implicit,yi=a.GaO();return a.CGJ(yi.handleClickAction(ge,Je,ro))}),a.I0R(1,"mat-icon"),a.OEk(2),a.C$Y()()}if(2&q){const E=Re.$implicit,ee=a.GaO(2);a.E7m("color",ee.getActionColor(E.color)),a.yG2(2),a.cNF(E.icon)}}function mn(q,Re){if(1&q&&(a.I0R(0,"td",18),a.yuY(1,pn,3,2,"button",30),a.C$Y()),2&q){const E=a.GaO();a.yG2(),a.E7m("ngForOf",E.model.actions)}}function Zt(q,Re){1&q&&a.wR5(0,"tr",32)}function gn(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"tr",33),a.qCj("click",function(){const Ye=a.usT(E).$implicit,Je=a.GaO();return a.CGJ(Je.selection.toggle(Ye))}),a.C$Y()}if(2&q){const E=Re.$implicit,ee=a.GaO();a.E7m("ngClass",ee.model.rowClassFunc?ee.model.rowClassFunc(E):a.q4q(1,Vo))}}let hn=(()=>{class q{get database(){return this._database}set database(E){this._database=E}_database;get model(){return this._model}set model(E){this._model=E}_model;get hasFilterInput(){return this._hasFIlterInput}set hasFilterInput(E){this._hasFIlterInput=E}_hasFIlterInput=!0;displayedColumns;dataSource;selection=new at.e2(!0,[]);select=new a._w7;filter;sort;ngOnInit(){this.dataSource=new Oo(this.database,this.model,this.sort),this.model&&(this.displayedColumns=this.model.columns.filter(E=>!1!==E.displayed).map(E=>E.name),this.model.selectionCheckbox&&this.displayedColumns.unshift("selectionCheckbox"),this.model.actions&&this.model.actions.length&&this.displayedColumns.push("action")),this.selection.changed.subscribe(E=>this.select.emit(E))}ngAfterViewInit(){this.filter&&(0,Xo.w)(this.filter.nativeElement,"keyup").pipe((0,ho.o)(150),(0,jn.a)()).subscribe(()=>{this.dataSource&&(this.dataSource.filter=this.filter.nativeElement.value)})}ngOnChanges(E){E.database&&(this.dataSource=new Oo(this.database,this.model,this.sort),this.selection.clear())}getActionColor(E){return Ei[E]}getValue(E,ee){return So.Yv.resolve(E,ee)}isAllSelected(){return this.selection.selected.length===this.database.data.length}masterToggle(){this.isAllSelected()?this.selection.clear():this.database.data.forEach(E=>this.selection.select(E))}handleClickAction(E,ee,ge){E.stopPropagation(),ee.click(ge)}static \u0275fac=function(ee){return new(ee||q)};static \u0275cmp=a.In1({type:q,selectors:[["igo-table"]],viewQuery:function(ee,ge){if(1&ee&&(a.CC$(ln,5),a.CC$(go.E9,7)),2&ee){let Ye;a.wto(Ye=a.Gqi())&&(ge.filter=Ye.first),a.wto(Ye=a.Gqi())&&(ge.sort=Ye.first)}},inputs:{database:"database",model:"model",hasFilterInput:"hasFilterInput"},outputs:{select:"select"},standalone:!0,features:[a.SYr,a.UHJ],decls:14,vars:5,consts:[[1,"table-box"],["class","table-header",4,"ngIf"],[1,"table-container"],["mat-table","","matSort","",3,"dataSource"],["table",""],["matColumnDef","selectionCheckbox"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"ngClass","click",4,"matRowDef","matRowDefColumns"],[1,"table-header"],["floatPlaceholder","never"],["matInput","",3,"placeholder"],["filter",""],["mat-header-cell",""],[3,"checked","indeterminate","change"],["mat-cell",""],[3,"checked","click","change"],[3,"matColumnDef"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["cellHTML",""],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell","","class","mat-cell-text",3,"ngClass",4,"matCellDef"],["mat-cell","",1,"mat-cell-text",3,"ngClass"],["mat-cell","","class","mat-cell-text",3,"ngClass","innerHTML",4,"matCellDef"],["mat-cell","",1,"mat-cell-text",3,"ngClass","innerHTML"],["mat-mini-fab","",3,"color","click",4,"ngFor","ngForOf"],["mat-mini-fab","",3,"color","click"],["mat-header-row",""],["mat-row","",3,"ngClass","click"]],template:function(ee,ge){1&ee&&(a.I0R(0,"div",0),a.yuY(1,Vi,5,3,"div",1),a.I0R(2,"div",2)(3,"table",3,4),a.SAx(5,5),a.yuY(6,Kn,2,2,"th",6)(7,li,2,1,"td",7),a.k70(),a.yuY(8,un,6,5,"ng-container",8),a.SAx(9,9),a.yuY(10,dn,1,0,"th",6)(11,mn,2,1,"td",7),a.k70(),a.yuY(12,Zt,1,0,"tr",10)(13,gn,1,2,"tr",11),a.C$Y()()()),2&ee&&(a.yG2(),a.E7m("ngIf",ge.hasFilterInput),a.yG2(2),a.E7m("dataSource",ge.dataSource),a.yG2(5),a.E7m("ngForOf",ge.model.columns),a.yG2(4),a.E7m("matHeaderRowDef",ge.displayedColumns),a.yG2(),a.E7m("matRowDefColumns",ge.displayedColumns))},dependencies:[C.u_,Se.wb,Se.Up,ae.cN,ae.yi,Jt.If,Jt.wL,Jt.ie,Jt.aG,Jt.Af,Jt.uc,Jt.gx,Jt.qC,Jt.cX,Jt.yC,Jt._I,go.Su,go.E9,go.e6,F.Vn,F.WK,C.Iw,C.QF,e.oJ,e.CI,L.oB,L.qL,h._s,W.sD],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}.table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:auto;flex:1 1 auto}.table-box[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.table-header[_ngcontent-%COMP%]{min-height:64px;max-width:500px;display:flex;flex:0 1 auto;align-items:baseline;padding:8px 24px 0;font-size:20px;justify-content:space-between}tr[mat-header-row][_ngcontent-%COMP%], tr[mat-row][_ngcontent-%COMP%]{height:60px}.mat-cell-text[_ngcontent-%COMP%]{overflow:hidden;word-wrap:break-word}td[mat-cell][_ngcontent-%COMP%]{padding-right:15px}th.mat-mdc-header-cell[_ngcontent-%COMP%]{padding-right:5px}button[_ngcontent-%COMP%]{margin-right:10px}"]})}return q})();var Ki=r(97780),Mi=r(6316),fn=r(10988),Go=r(53291);function yn(q="300ms",Re="ease-in-out"){return(0,Go.gV)("toolSlideInOut",[(0,Go.K2)("enter",(0,Go.wb)({transform:"translate3d(0, 0, 0)"})),(0,Go.aK)("void => enter",(0,Go.Cs)(q+" "+Re))])}function Wi(q,Re){if(1&q&&(a.wR5(0,"igo-actionbar",2),a.wVc(1,"async"),a.wVc(2,"async"),a.wVc(3,"async")),2&q){const E=a.GaO();a.E7m("store",E.actionStore)("withIcon",!0)("withTitle",a.kDX(1,6,E.toolbarWithTitle$))("withTooltip",!1===a.kDX(2,8,E.toolbarWithTitle$))("scrollActive",a.kDX(3,10,E.toolbarWithTitle$))("horizontal",!1)}}const Di=(q,Re)=>({"igo-tool-container-with-toolbar":q,"igo-tool-container-with-animation":Re});function _n(q,Re){if(1&q){const E=a.KQA();a.I0R(0,"div",3),a.qCj("@toolSlideInOut.start",function(){a.usT(E);const ge=a.GaO();return a.CGJ(ge.onAnimationStart())})("@toolSlideInOut.done",function(){a.usT(E);const ge=a.GaO();return a.CGJ(ge.onAnimationComplete())}),a.wVc(1,"async"),a.wR5(2,"igo-dynamic-outlet",4),a.C$Y()}if(2&q){const E=Re.ngIf,ee=a.GaO();a.E7m("ngClass",a.IBC(6,Di,!ee.actionStore.empty,ee.animate))("@toolSlideInOut",a.kDX(1,4,ee.animation$)),a.yG2(2),a.E7m("component",E.component)("inputs",ee.getToolInputs(E))}}let Cn=(()=>{class q{activeTool$=new y.g(void 0);get isActive(){return!!this.activeTool$.value}actionStore=new T([]);animation$=new y.g("none");toolbar$=new y.g([]);toolbarWithTitle$=this.activeTool$.pipe((0,Uo.k)(E=>void 0===E));activeTool$$;toolbar$$;animating$=new y.g(!1);animating$$;toolbox;animate=!1;color="white";get classColorGrey(){return"grey"===this.color}get classColorPrimary(){return"primary"===this.color}ngOnInit(){this.toolbar$$=this.toolbox.toolbar$.subscribe(E=>this.onToolbarChange(E)),this.activeTool$$=this.toolbox.activeTool$.subscribe(E=>this.onActiveToolChange(E))}ngOnDestroy(){this.toolbar$$.unsubscribe(),this.activeTool$$.unsubscribe(),this.actionStore.destroy()}onAnimationStart(){this.animating$.next(!0)}onAnimationComplete(){this.animating$.next(!1)}getToolInputs(E){return E.options||{}}onToolbarChange(E){this.setToolbar(E)}onActiveToolChange(E){this.animate?this.onAnimate(()=>this.setActiveTool(E)):this.setActiveTool(E)}setActiveTool(E){if(void 0===E)this.actionStore.state.updateAll({active:!1});else{const ee=this.actionStore.get(E.name);void 0!==ee&&this.actionStore.state.update(ee,{active:!0},!0)}this.activeTool$.next(E),this.animate&&this.animation$.next("enter")}setToolbar(E){const ee=E.reduce((ge,Ye)=>{const Je=this.toolbox.getTool(Ye);return void 0===Je||ge.push({id:Je.name,title:Je.title,icon:Je.icon,tooltip:Je.tooltip,args:[Je,this.toolbox],handler:(ro,yi)=>{yi.activateTool(ro.name)},ngClass:(ro,yi)=>this.toolbox.activeTool$.pipe((0,Uo.k)(Fo=>{let jo=!1;void 0!==Fo&&ro.name===Fo.name&&(jo=!0);let Ln=!1;return void 0!==Fo&&ro.name===Fo.parent&&(Ln=!0),{"tool-activated":jo,"children-tool-activated":Ln}}))}),ge},[]);this.actionStore.load(ee),this.toolbar$.next(E)}onAnimate(E){this.unAnimate(),this.animating$$=this.animating$.subscribe(ee=>{ee||(E.call(this),this.unAnimate())})}unAnimate(){this.animating$$&&this.animating$$.unsubscribe()}static \u0275fac=function(ee){return new(ee||q)};static \u0275cmp=a.In1({type:q,selectors:[["igo-toolbox"]],hostVars:4,hostBindings:function(ee,ge){2&ee&&a.eAK("color-grey",ge.classColorGrey)("color-primary",ge.classColorPrimary)},inputs:{toolbox:"toolbox",animate:"animate",color:"color"},standalone:!0,features:[a.UHJ],decls:4,vars:6,consts:[[3,"store","withIcon","withTitle","withTooltip","scrollActive","horizontal",4,"ngIf"],["class","igo-tool-container mat-body-1",3,"ngClass",4,"ngIf"],[3,"store","withIcon","withTitle","withTooltip","scrollActive","horizontal"],[1,"igo-tool-container","mat-body-1",3,"ngClass"],[3,"component","inputs"]],template:function(ee,ge){1&ee&&(a.yuY(0,Wi,4,12,"igo-actionbar",0),a.wVc(1,"async"),a.yuY(2,_n,3,9,"div",1),a.wVc(3,"async")),2&ee&&(a.E7m("ngIf",a.kDX(1,2,ge.toolbar$).length>0),a.yG2(2),a.E7m("ngIf",a.kDX(3,4,ge.activeTool$)))},dependencies:[C.u_,s,C.QF,Mi.q,C.a],styles:["[_nghost-%COMP%]{display:block;position:relative;overflow:hidden;width:100%;height:100%}[_nghost-%COMP%]     .mdc-list-item--with-leading-avatar .mdc-list-item__start{margin:0}[_nghost-%COMP%]   .igo-tool-container[_ngcontent-%COMP%]{position:absolute;inset:0;margin-bottom:0}[_nghost-%COMP%]   .igo-tool-container-with-animation[_ngcontent-%COMP%]{transform:translate3d(100%,0,0)}[_nghost-%COMP%]   .igo-tool-container-with-toolbar[_ngcontent-%COMP%]{left:50px}[_nghost-%COMP%]   igo-actionbar[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]   igo-actionbar.with-title[_ngcontent-%COMP%]{width:100%;overflow:auto}[_nghost-%COMP%]   igo-actionbar[_ngcontent-%COMP%]:not(.with-title){width:48px;overflow:hidden;-o-box-shadow:2px 0px 2px 0px #dddddd;box-shadow:2px 0 2px #ddd}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   igo-actionbar[_ngcontent-%COMP%]:not(.with-title){overflow:auto}}[_nghost-%COMP%]   igo-dynamic-outlet[_ngcontent-%COMP%]{overflow:auto}"],data:{animation:[yn()]},changeDetection:0})}return q})(),Ni=(()=>{class q{static \u0275fac=function(ee){return new(ee||q)};static \u0275mod=a.a4G({type:q});static \u0275inj=a.s3X({})}return q})();var Hi=r(88908);let zi=(()=>{class q{dynamicComponentService;constructor(E){this.dynamicComponentService=E}create(E){return this.dynamicComponentService.create(E)}static \u0275fac=function(ee){return new(ee||q)(a.CoB(Hi.O))};static \u0275prov=a.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})(),Sn=(()=>{class q{static \u0275fac=function(ee){return new(ee||q)};static \u0275mod=a.a4G({type:q});static \u0275inj=a.s3X({providers:[zi],imports:[Ni,Ni]})}return q})();class di extends O.qc{activeWorkspace$=new y.g(void 0);activateWorkspace(Re){const E=this.activeWorkspace$.value;void 0!==E&&E.deactivate(),this.deactivateWorkspace(),void 0!==Re&&(this.state.update(Re,{active:!0,selected:!0},!0),this.activeWorkspace$.next(Re),Re.activate())}deactivateWorkspace(){const Re=this.activeWorkspace$.value;void 0!==Re&&(Re.deactivate(),this.activeWorkspace$.next(void 0))}}let Pi=(()=>{class q{store;disabled;selectedChange=new a._w7;getWorkspaceTitle(E){return(0,O.YB)(E)}onSelectedChange(E){const ee=E.value;this.store.activateWorkspace(ee),this.selectedChange.emit({selected:!0,value:ee})}static \u0275fac=function(ee){return new(ee||q)};static \u0275cmp=a.In1({type:q,selectors:[["igo-workspace-selector"]],inputs:{store:"store",disabled:"disabled"},outputs:{selectedChange:"selectedChange"},standalone:!0,features:[a.UHJ],decls:1,vars:4,consts:[[3,"store","multi","titleAccessor","disabled","selectedChange"]],template:function(ee,ge){1&ee&&(a.I0R(0,"igo-entity-selector",0),a.qCj("selectedChange",function(Je){return ge.onSelectedChange(Je)}),a.C$Y()),2&ee&&a.E7m("store",ge.store)("multi",!1)("titleAccessor",ge.getWorkspaceTitle)("disabled",ge.disabled)},dependencies:[St.s],changeDetection:0})}return q})();var Po=r(26431);function fo(q,Re){if(1&q){const E=a.KQA();a.SAx(0),a.I0R(1,"igo-widget-outlet",1),a.qCj("cancel",function(){const Ye=a.usT(E).ngIf,Je=a.GaO();return a.CGJ(Je.onWidgetCancel(Ye))})("complete",function(){const Ye=a.usT(E).ngIf,Je=a.GaO();return a.CGJ(Je.onWidgetComplete(Ye))}),a.wVc(2,"async"),a.wVc(3,"async"),a.C$Y(),a.k70()}if(2&q){const E=Re.ngIf,ee=a.GaO();a.yG2(),a.E7m("widget",E)("inputs",a.kDX(2,3,ee.widgetInputs$))("subscribers",a.kDX(3,5,ee.widgetSubscribers$))}}let Fi=(()=>{class q{workspace;deactivateWidget=new a._w7;get widget$(){return this.workspace.widget$}get widgetInputs$(){return this.workspace.widgetInputs$}get widgetSubscribers$(){return this.workspace.widgetSubscribers$}constructor(){}onWidgetCancel(E){this.workspace.deactivateWidget(),this.deactivateWidget.emit(E)}onWidgetComplete(E){this.workspace.deactivateWidget(),this.deactivateWidget.emit(E)}static \u0275fac=function(ee){return new(ee||q)};static \u0275cmp=a.In1({type:q,selectors:[["igo-workspace-widget-outlet"]],inputs:{workspace:"workspace"},outputs:{deactivateWidget:"deactivateWidget"},standalone:!0,features:[a.UHJ],decls:2,vars:3,consts:[[4,"ngIf"],[3,"widget","inputs","subscribers","cancel","complete"]],template:function(ee,ge){1&ee&&(a.yuY(0,fo,4,7,"ng-container",0),a.wVc(1,"async")),2&ee&&a.E7m("ngIf",a.kDX(1,1,ge.widget$))},dependencies:[C.u_,Po.A,C.a],styles:["igo-widget-outlet[_ngcontent-%COMP%]{height:100%}"],changeDetection:0})}return q})(),Xi=(()=>{class q{el;set igoMatBadgeIcon(E){this.html=`\n      <mat-icon class="mat-icon material-symbols-outlined" style="height: 16px; width: 16px; font-size: 16px;">${E}</mat-icon>\n    `,this.updateHtml()}html;set matBadgeHidden(E){this.hidden=E,this.updateHidden()}hidden=!1;set matBadgeDisabled(E){this.disabled=E,this.updateDisabled()}disabled=!1;set igoMatBadgeInverseColor(E){this.inverseColor=E,this.updateColor()}inverseColor=!1;set igoMatBadgeInheritColor(E){this.inheritColor=E,this.updateColor()}inheritColor=!1;set igoMatBadgeColor(E){this.color=E,this.updateColor()}color;set igoMatBadgeBackgroundColor(E){this.backgroundColor=E,this.updateColor()}backgroundColor;get badge(){return this.el.nativeElement.querySelector(".mat-badge-content")}originalColor;constructor(E){this.el=E}ngOnInit(){this.badge.style.alignItems="center",this.badge.style.justifyContent="center",this.updateHidden(),this.updateColor(),this.updateHtml()}updateHtml(){this.badge&&(this.badge.innerHTML="",this.html&&(this.badge.innerHTML=this.html))}updateColor(){this.badge&&(this.color||this.backgroundColor?(this.badge.style.color=this.color?this.color:"",this.badge.style.background=this.backgroundColor?this.backgroundColor:""):this.inheritColor?this.inverseColor?(this.badge.style.color="currentColor",this.badge.style.background="none"):(this.badge.style.color="",this.badge.style.background="currentColor"):this.inheritColor||(this.inverseColor?(this.badge.style.color=window.getComputedStyle(this.badge,null).getPropertyValue("background-color"),this.badge.style.background="none"):(this.badge.style.color="",this.badge.style.background="")),this.originalColor=this.badge.style.color,this.updateDisabled())}updateHidden(){this.badge&&(this.badge.style.display=this.hidden?"none":"flex")}updateDisabled(){!this.badge||!this.inverseColor||(this.disabled?(this.originalColor=this.badge.style.color,this.badge.style.color="#b9b9b9"):this.badge.style.color=this.originalColor)}static \u0275fac=function(ee){return new(ee||q)(a.GI1(a.GMv))};static \u0275dir=a.Sc5({type:q,selectors:[["","igoMatBadgeIcon",""]],inputs:{igoMatBadgeIcon:"igoMatBadgeIcon",matBadgeHidden:"matBadgeHidden",matBadgeDisabled:"matBadgeDisabled",igoMatBadgeInverseColor:"igoMatBadgeInverseColor",igoMatBadgeInheritColor:"igoMatBadgeInheritColor",igoMatBadgeColor:"igoMatBadgeColor",igoMatBadgeBackgroundColor:"igoMatBadgeBackgroundColor"},standalone:!0,features:[a.M5G([L.oB])]})}return q})(),Ri=(()=>{class q{renderer;el;get target(){return this._target}set target(E){this._target=E}_target;get collapsed(){return this._collapsed}set collapsed(E){E?this.collapseTarget():this.expandTarget(),this._collapsed=E,this.toggle.emit(E)}_collapsed=!1;toggle=new a._w7;click(){this.collapsed=!this.collapsed}constructor(E,ee){this.renderer=E,this.el=ee}collapseTarget(){this.renderer.addClass(this.target,"igo-collapsed"),this.renderer.addClass(this.el.nativeElement,"collapsed")}expandTarget(){this.renderer.removeClass(this.target,"igo-collapsed"),this.renderer.removeClass(this.el.nativeElement,"collapsed")}static \u0275fac=function(ee){return new(ee||q)(a.GI1(a.q87),a.GI1(a.GMv))};static \u0275dir=a.Sc5({type:q,selectors:[["","igoCollapse",""]],hostBindings:function(ee,ge){1&ee&&a.qCj("click",function(){return ge.click()})},inputs:{target:"target",collapsed:"collapsed"},outputs:{toggle:"toggle"},standalone:!0})}return q})();const pi=["*"];let mi=(()=>{class q{get title(){return this._title}set title(E){this._title=E}_title="";get collapsed(){return this._collapsed}set collapsed(E){this._collapsed=E,this.toggle.emit(E)}_collapsed=!1;toggle=new a._w7;static \u0275fac=function(ee){return new(ee||q)};static \u0275cmp=a.In1({type:q,selectors:[["igo-collapsible"]],inputs:{title:"title",collapsed:"collapsed"},outputs:{toggle:"toggle"},standalone:!0,features:[a.UHJ],ngContentSelectors:pi,decls:8,vars:3,consts:[["matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"target","collapsed","toggle"],["matListItemTitle",""],["content",""]],template:function(ee,ge){if(1&ee&&(a.kPM(),a.I0R(0,"mat-list-item")(1,"mat-icon",0),a.qCj("toggle",function(Je){return ge.collapsed=Je}),a.OEk(2," expand_less "),a.C$Y(),a.I0R(3,"span",1),a.OEk(4),a.C$Y()(),a.I0R(5,"div",null,2),a._Xx(7),a.C$Y()),2&ee){const Ye=a.Gew(6);a.yG2(),a.E7m("target",Ye)("collapsed",ge.collapsed),a.yG2(3),a.cNF(ge.title)}},dependencies:[P.iI,P.g9,P.Y1,P.UV,L.oB,L.qL,Ri],styles:["[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item.mat-mdc-list-item-avatar{height:auto;width:auto;padding:0}mat-list-item[_ngcontent-%COMP%]{overflow:hidden}"]})}return q})();var In=r(60336),gi=r(6560),wn=r(37496);let Tn=(()=>{class q{overlay;viewContainerRef;elementRef;overlayRef;sub;menuContext;menuPosition=new a._w7;constructor(E,ee,ge){this.overlay=E,this.viewContainerRef=ee,this.elementRef=ge}onContextMenu(E){let ee,ge;if(E instanceof MouseEvent?(ee=E.x,ge=E.y):E instanceof TouchEvent&&(ee=E.touches[0].pageX,ge=E.touches[0].pageY),!ee||!ge)return;this.close(),E.preventDefault(),this.menuPosition.emit({x:ee,y:ge}),this.overlayRef=null;const Ye=this.overlay.position().flexibleConnectedTo({x:ee,y:ge}).withPositions([{originX:"end",originY:"bottom",overlayX:"start",overlayY:"top"}]);this.overlayRef=this.overlay.create({positionStrategy:Ye,scrollStrategy:this.overlay.scrollStrategies.close()}),this.overlayRef.attach(new In.CC(this.menuContext,this.viewContainerRef,{$implicit:void 0})),this.sub=(0,Xo.w)(document,"click").pipe((0,gi.I)(Je=>{const ro=Je.target;return this.close(),!!this.overlayRef&&!this.overlayRef.overlayElement.contains(ro)}),(0,wn.U)(1)).subscribe(()=>this.close()),this.sub=(0,Xo.w)(document,"contextmenu").pipe((0,gi.I)(Je=>{const ro=Je.target;if(ro&&!this.elementRef.nativeElement.contains(ro)&&!this.overlayRef.overlayElement.contains(ro))return!0;Je.preventDefault()}),(0,wn.U)(1)).subscribe(()=>this.close())}close(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=null),this.sub&&this.sub.unsubscribe()}static \u0275fac=function(ee){return new(ee||q)(a.GI1(B.mc),a.GI1(a.y8U),a.GI1(a.GMv))};static \u0275dir=a.Sc5({type:q,selectors:[["","igoContextMenu",""]],hostBindings:function(ee,ge){1&ee&&a.qCj("longpress",function(Je){return ge.onContextMenu(Je)})("contextmenu",function(Je){return ge.onContextMenu(Je)})},inputs:{menuContext:[a.Wk5.None,"igoContextMenu","menuContext"]},outputs:{menuPosition:"menuPosition"},standalone:!0})}return q})(),En=(()=>{class q{touchTimeout;touchDuration=400;onlyIOS=!0;longpress=new a._w7;constructor(){}touchstart(E){E.touches.length>1?this.touchEnd():this.touchTimeout=setTimeout(()=>{this.onlyIOS?"iOS"===So.sX.getOSName()&&this.longpress.emit(E):this.longpress.emit(E)},this.touchDuration)}touchend(){this.touchEnd()}touchEnd(){clearTimeout(this.touchTimeout)}static \u0275fac=function(ee){return new(ee||q)};static \u0275dir=a.Sc5({type:q,selectors:[["","igoLongPress",""]],hostBindings:function(ee,ge){1&ee&&a.qCj("touchstart",function(Je){return ge.touchstart(Je)})("touchmove",function(){return ge.touchend()})("touchcancel",function(){return ge.touchend()})("touchend",function(){return ge.touchend()})},inputs:{touchDuration:"touchDuration",onlyIOS:"onlyIOS"},outputs:{longpress:"longpress"},standalone:!0})}return q})();var _=r(35392),N=r(39732),Q=r(51672),Ce=r(33712);let Te=(()=>{class q{http;constructor(E){this.http=E}getDom(E){var ee=this;return(0,_.c)(function*(){const ge=E.url;let Ye;return yield ee.http.get(ge).pipe((0,Uo.k)(Je=>(Ye=Je,Je)),(0,Q.a)(Je=>(0,N.c)(Je))).toPromise(),Ye})()}static \u0275fac=function(ee){return new(ee||q)(a.CoB(Ce.KK))};static \u0275prov=a.wxM({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})(),Ne=(()=>{class q{allowedExtensions=[];filesDropped=new a._w7;filesInvalid=new a._w7;background="inherit";onDragOver(E){E.preventDefault(),E.stopPropagation(),this.background="#999"}onDragLeave(E){E.preventDefault(),E.stopPropagation(),this.background="inherit"}onDrop(E){if(E.preventDefault(),E.stopPropagation(),E.alreadyFired)return;E.alreadyFired=!0,this.background="inherit";const ee=this.validExtensions(E);ee.valid.length&&this.filesDropped.emit(ee.valid),ee.invalid.length&&this.filesInvalid.emit(ee.invalid)}validExtensions(E){const ee=E.dataTransfer.files,ge={valid:[],invalid:[]};if(ee.length>0)for(const Ye of ee){const Je=Ye.name.split(".")[Ye.name.split(".").length-1];0===this.allowedExtensions.length||-1!==this.allowedExtensions.lastIndexOf(Je)&&0!==Ye.size?ge.valid.push(Ye):ge.invalid.push(Ye)}return ge}static \u0275fac=function(ee){return new(ee||q)};static \u0275dir=a.Sc5({type:q,selectors:[["","igoDragAndDrop",""]],hostVars:2,hostBindings:function(ee,ge){1&ee&&a.qCj("dragover",function(Je){return ge.onDragOver(Je)})("dragleave",function(Je){return ge.onDragLeave(Je)})("drop",function(Je){return ge.onDrop(Je)}),2&ee&&a.m4B("background",ge.background)},inputs:{allowedExtensions:"allowedExtensions"},outputs:{filesDropped:"filesDropped",filesInvalid:"filesInvalid"},standalone:!0})}return q})();var gt=r(77020);const It=["flexibleMain"],it=["*",[["","igoFlexibleFill",""]]],At=["*","[igoFlexibleFill]"];let Dt=(()=>{class q{el;mediaService;static transitionTime=250;main;get initial(){return this._initial}set initial(E){this._initial=E}_initial="0";get collapsed(){return this._collapsed}set collapsed(E){this._collapsed=E}_collapsed="0";get expanded(){return this._expanded}set expanded(E){this._expanded=E}_expanded="100%";get initialMobile(){return this._initialMobile}set initialMobile(E){this._initialMobile=E}_initialMobile=this.expanded;get collapsedMobile(){return this._collapsedMobile}set collapsedMobile(E){this._collapsedMobile=E}_collapsedMobile=this.collapsed;get expandedMobile(){return this._expandedMobile}set expandedMobile(E){this._expandedMobile=E}_expandedMobile=this.expanded;get direction(){return this._direction}set direction(E){this._direction=E}_direction="column";get state(){return this._state}set state(E){const ee={initial:this.initial,collapsed:this.collapsed,expanded:this.expanded};this.mediaService.isMobile()&&Object.assign(ee,{initial:this.initialMobile,collapsed:this.collapsedMobile,expanded:this.expandedMobile});const ge=ee[E];void 0!==ge&&(this.setSize(ge),setTimeout(()=>{this._state=E},q.transitionTime))}_state="initial";mediaService$$;constructor(E,ee){this.el=E,this.mediaService=ee}ngOnInit(){this.el.nativeElement.className+=this.direction,this.mediaService$$=this.mediaService.media$.subscribe(E=>this.state=this.state)}ngOnDestroy(){this.mediaService$$&&this.mediaService$$.unsubscribe()}setSize(E){this._state="transition","column"===this.direction?this.main.nativeElement.style.height=E:"row"===this.direction&&(this.main.nativeElement.style.width=E)}static \u0275fac=function(ee){return new(ee||q)(a.GI1(a.GMv),a.GI1(R.QB))};static \u0275cmp=a.In1({type:q,selectors:[["igo-flexible"]],viewQuery:function(ee,ge){if(1&ee&&a.CC$(It,7),2&ee){let Ye;a.wto(Ye=a.Gqi())&&(ge.main=Ye.first)}},inputs:{initial:"initial",collapsed:"collapsed",expanded:"expanded",initialMobile:"initialMobile",collapsedMobile:"collapsedMobile",expandedMobile:"expandedMobile",direction:"direction",state:"state"},standalone:!0,features:[a.UHJ],ngContentSelectors:At,decls:8,vars:4,consts:[["flexibleMain",""],[1,"igo-container"],[1,"igo-flexible-fill"]],template:function(ee,ge){1&ee&&(a.kPM(it),a.I0R(0,"div",null,0)(2,"div",1),a._Xx(3),a.C$Y()(),a.I0R(4,"div",2)(5,"div")(6,"div",1),a._Xx(7,1),a.C$Y()()()),2&ee&&a.qim("igo-flexible-main ",ge.state," ",ge.direction,"")},styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}.column[_nghost-%COMP%]{flex-direction:column}.row[_nghost-%COMP%]{flex-direction:row}[_nghost-%COMP%]   .igo-flexible-main[_ngcontent-%COMP%]{flex:0 0 auto;overflow:hidden}[_nghost-%COMP%]   .igo-flexible-main.column[_ngcontent-%COMP%]{transition:height .25s ease-in}[_nghost-%COMP%]   .igo-flexible-main.row[_ngcontent-%COMP%]{transition:width .25s ease-in}[_nghost-%COMP%]   .igo-flexible-fill[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:absolute;inset:0}[_nghost-%COMP%]   .igo-container[_ngcontent-%COMP%]{height:100%;overflow:hidden;position:relative}[_nghost-%COMP%]     .igo-flexible-fill{flex:1 1 auto;overflow:hidden;position:relative}[_nghost-%COMP%]     .igo-content{height:100%;width:100%;overflow:auto}[_nghost-%COMP%]     igo-panel{height:100%}"]})}return q})();var wo=r(19644),Jo=r(696);let hi=(()=>{class q{renderer;el;static focusedCls="igo-list-item-focused";static selectedCls="igo-list-item-selected";static disabledCls="igo-list-item-disabled";get color(){return this._color}set color(E){this._color=E}_color="primary";get focused(){return this._focused}set focused(E){E!==this._focused&&(this.disabled||(E?this.beforeFocus.emit(this):this.beforeUnfocus.emit(this),this._focused=E,!0!==this.selected&&this.toggleFocusedClass(),E?this.focus.emit(this):this.unfocus.emit(this)))}_focused=!1;get selected(){return this._selected}set selected(E){E!==this._selected&&(this.disabled||(E?this.beforeSelect.emit(this):this.beforeUnselect.emit(this),this._selected=E,this._focused=E,this.toggleSelectedClass(),E?this.select.emit(this):this.unselect.emit(this)))}_selected=!1;get disabled(){return this._disabled}set disabled(E){E!==this._disabled&&(!0===E&&(this.selected=!1),E?this.beforeDisable.emit(this):this.beforeEnable.emit(this),this._disabled=E,this.toggleDisabledClass(),E?this.disable.emit(this):this.enable.emit(this))}_disabled=!1;beforeSelect=new a._w7;beforeFocus=new a._w7;beforeUnselect=new a._w7;beforeUnfocus=new a._w7;beforeDisable=new a._w7;beforeEnable=new a._w7;focus=new a._w7;unfocus=new a._w7;select=new a._w7;unselect=new a._w7;disable=new a._w7;enable=new a._w7;onClick(){this.selected=!0}constructor(E,ee){this.renderer=E,this.el=ee}getOffsetTop(){return this.el.nativeElement.offsetTop-5}toggleFocusedClass(){this.focused?this.addCls(q.focusedCls):this.removeCls(q.focusedCls)}toggleSelectedClass(){this.selected?(this.addCls(q.selectedCls),this.removeCls(q.focusedCls)):this.removeCls(q.selectedCls)}toggleDisabledClass(){this.disabled?this.addCls(q.disabledCls):this.removeCls(q.disabledCls)}addCls(E){this.renderer.addClass(this.el.nativeElement,E)}removeCls(E){this.renderer.removeClass(this.el.nativeElement,E)}static \u0275fac=function(ee){return new(ee||q)(a.GI1(a.q87),a.GI1(a.GMv))};static \u0275dir=a.Sc5({type:q,selectors:[["","igoListItem",""]],hostBindings:function(ee,ge){1&ee&&a.qCj("click",function(){return ge.onClick()})},inputs:{color:"color",focused:"focused",selected:"selected",disabled:"disabled"},outputs:{beforeSelect:"beforeSelect",beforeFocus:"beforeFocus",beforeUnselect:"beforeUnselect",beforeUnfocus:"beforeUnfocus",beforeDisable:"beforeDisable",beforeEnable:"beforeEnable",focus:"focus",unfocus:"unfocus",select:"select",unselect:"unselect",disable:"disable",enable:"enable"},standalone:!0})}return q})(),Mn=(()=>{class q{el;clickout=new a._w7;handleMouseClick(E,ee){ee&&(this.el.nativeElement.contains(ee)||this.clickout.emit(E))}constructor(E){this.el=E}static \u0275fac=function(ee){return new(ee||q)(a.GI1(a.GMv))};static \u0275dir=a.Sc5({type:q,selectors:[["","igoClickout",""]],hostBindings:function(ee,ge){1&ee&&a.qCj("click",function(Je){return ge.handleMouseClick(Je,Je.target)},!1,a.wLc)},outputs:{clickout:"clickout"},standalone:!0})}return q})();const Dn=q=>({selectable:q}),Li=["*"];let Ji=(()=>{class q{el;get navigation(){return this._navigation}set navigation(E){this._navigation=E}_navigation=!0;get selection(){return this._selection}set selection(E){this._selection=E}_selection=!0;get selectedItem(){return this._selectedItem}set selectedItem(E){this.focusedItem=E,this._selectedItem=E}_selectedItem;get focusedItem(){return this._focusedItem}set focusedItem(E){this._focusedItem=E}_focusedItem;navigationEnabled;listItems$$;subscriptions=[];listItems;handleKeyboardEvent(E){this.navigationEnabled&&("ArrowUp"===E.key||"ArrowDown"===E.key?(E.preventDefault(),this.navigate(E.key)):"Enter"===E.key&&this.select(this.focusedItem))}constructor(E){this.el=E}ngOnInit(){this.enableNavigation()}ngAfterViewInit(){this.listItems.length&&this.init(),this.listItems$$=this.listItems.changes.subscribe(E=>this.init())}ngOnDestroy(){this.listItems$$.unsubscribe()}focus(E){this.selection&&(this.unfocus(),void 0!==E&&(E.focused=!0))}unfocus(){void 0!==this.focusedItem&&(this.focusedItem.focused=!1),this.focusedItem=void 0}focusNext(){const E=this.listItems.toArray();let ee;const ge=this.el.nativeElement;let Ye=!0,Je=this.getFocusedIndex();for(void 0===Je&&(Je=-1);Ye&&Je<E.length-1;)Je+=1,ee=E[Je],Ye=ee.disabled;void 0!==ee&&this.focus(ee),E[Je+1]?void 0!==ee&&!this.isScrolledIntoView(ee.el.nativeElement)&&(ge.scrollTop=ee.el.nativeElement.offsetTop+ee.el.nativeElement.children[0].offsetHeight-ge.clientHeight):ge.scrollTop=ge.scrollHeight-ge.clientHeight}focusPrevious(){const E=this.listItems.toArray();let ee;const ge=this.el.nativeElement;let Ye=!0,Je=this.getFocusedIndex();for(;Ye&&Je>0;)Je-=1,ee=E[Je],Ye=ee.disabled;void 0!==ee&&this.focus(ee),E[Je-1]?void 0!==ee&&!this.isScrolledIntoView(ee.el.nativeElement)&&(ge.scrollTop=ee.el.nativeElement.offsetTop-3):ge.scrollTop=0}select(E){this.selection&&(this.unselect(),void 0!==E&&(E.selected=!0))}unselect(){this.unfocus(),void 0!==this.selectedItem&&(this.selectedItem.selected=!1),this.selectedItem=void 0}enableNavigation(){this.navigation&&(this.navigationEnabled=!0)}disableNavigation(){this.navigationEnabled=!1}scrollToItem(E){this.el.nativeElement.scrollTop=E.getOffsetTop()}isScrolledIntoView(E){const ee=this.el.nativeElement.scrollTop+this.el.nativeElement.offsetTop,Ye=E.offsetTop;return Ye+E.children[0].offsetHeight<=ee+this.el.nativeElement.clientHeight&&Ye>=ee}init(){this.subscribe(),this.selectedItem=this.findSelectedItem(),this.focusedItem=this.findFocusedItem(),this.enableNavigation()}subscribe(){this.unsubscribe(),this.listItems.toArray().forEach(E=>{this.subscriptions.push(E.beforeSelect.subscribe(ee=>this.handleItemBeforeSelect(ee))),this.subscriptions.push(E.select.subscribe(ee=>this.handleItemSelect(ee))),this.subscriptions.push(E.beforeFocus.subscribe(ee=>this.handleItemBeforeFocus(ee))),this.subscriptions.push(E.focus.subscribe(ee=>this.handleItemFocus(ee)))},this)}unsubscribe(){this.subscriptions.forEach(E=>E.unsubscribe()),this.subscriptions=[]}handleItemBeforeFocus(E){E!==this.focusedItem&&this.unfocus()}handleItemFocus(E){this.focusedItem=E}handleItemBeforeSelect(E){E!==this.focusedItem&&this.unselect()}handleItemSelect(E){this.selectedItem=E}findSelectedItem(){return this.listItems.toArray().find(E=>E.selected)}findFocusedItem(){return this.listItems.toArray().find(E=>E.focused)}getFocusedIndex(){return this.listItems.toArray().findIndex(E=>E===this.focusedItem)}navigate(E){switch(E){case"ArrowUp":this.focusPrevious();break;case"ArrowDown":this.focusNext()}}static \u0275fac=function(ee){return new(ee||q)(a.GI1(a.GMv))};static \u0275cmp=a.In1({type:q,selectors:[["igo-list"]],contentQueries:function(ee,ge,Ye){if(1&ee&&a.szK(Ye,hi,5),2&ee){let Je;a.wto(Je=a.Gqi())&&(ge.listItems=Je)}},hostBindings:function(ee,ge){1&ee&&a.qCj("keydown",function(Je){return ge.handleKeyboardEvent(Je)},!1,a.wLc)("enter",function(Je){return ge.handleKeyboardEvent(Je)},!1,a.wLc)},inputs:{navigation:"navigation",selection:"selection"},standalone:!0,features:[a.UHJ],ngContentSelectors:Li,decls:2,vars:3,consts:[["igoClickout","",3,"ngClass","clickout","click"]],template:function(ee,ge){1&ee&&(a.kPM(),a.I0R(0,"mat-list",0),a.qCj("clickout",function(){return ge.disableNavigation()})("click",function(){return ge.enableNavigation()}),a._Xx(1),a.C$Y()),2&ee&&a.E7m("ngClass",a.S45(1,Dn,ge.selection))},dependencies:[P.iI,P.oL,Mn,C.QF],styles:["[_nghost-%COMP%]{display:block;height:100%;overflow:auto;position:relative}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item .mdc-list-item__primary-text{white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;max-height:36px;line-height:18px;-webkit-box-orient:vertical;-webkit-line-clamp:2}[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item.mdc-list-item--with-leading-icon{height:48px}[_nghost-%COMP%]     .mat-mdc-list   igo-collapsible>.mat-mdc-list-item>.mdc-list-item__primary-text>.mat-mdc-list-item{font-weight:700;opacity:.9}[_nghost-%COMP%]   mat-list.selectable[_ngcontent-%COMP%]     [igolistitem]:not(.igo-list-item-disabled) mat-list-item:hover{cursor:pointer}[_nghost-%COMP%]     [igolistitem]:focus{outline:none}"]})}return q})();const Zi=q=>({"igo-cursor-pointer":q});function Nn(q,Re){if(1&q&&(a.I0R(0,"div",2)(1,"div",3),a._Xx(2,1),a.C$Y(),a.I0R(3,"h3",4),a.OEk(4),a._Xx(5,2),a.C$Y(),a.I0R(6,"div",5),a._Xx(7,3),a.C$Y()()),2&q){const E=a.GaO();a.E7m("ngClass",a.S45(2,Zi,!0===E.cursorPointer)),a.yG2(4),a.oRS(" ",E.title," ")}}const Pn=["*",[["","panelLeftButton",""]],[["","panelHeader",""]],[["","panelRightButton",""]]],fi=["*","[panelLeftButton]","[panelHeader]","[panelRightButton]"];let uo=(()=>{class q{title;get withHeader(){return this._withHeader}set withHeader(E){this._withHeader=E}_withHeader=!0;cursorPointer=!1;static \u0275fac=function(ee){return new(ee||q)};static \u0275cmp=a.In1({type:q,selectors:[["igo-panel"]],hostVars:2,hostBindings:function(ee,ge){2&ee&&a.eAK("igo-panel-with-header",ge.withHeader)},inputs:{title:"title",withHeader:"withHeader",cursorPointer:"cursorPointer"},standalone:!0,features:[a.UHJ],ngContentSelectors:fi,decls:3,vars:1,consts:[["class","igo-panel-header","title","",3,"ngClass",4,"ngIf"],["title","",1,"igo-panel-content"],["title","",1,"igo-panel-header",3,"ngClass"],[1,"panel-left"],[1,"igo-panel-title"],[1,"panel-right"]],template:function(ee,ge){1&ee&&(a.kPM(Pn),a.yuY(0,Nn,8,4,"div",0),a.I0R(1,"div",1),a._Xx(2),a.C$Y()),2&ee&&a.E7m("ngIf",ge.withHeader)},dependencies:[C.u_,C.QF],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;overflow:hidden}[_nghost-%COMP%]   igo-interactive-tour[_ngcontent-%COMP%]{position:absolute;top:0;right:0}[_nghost-%COMP%]   .igo-panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;height:48px;text-align:center}[_nghost-%COMP%]   .igo-panel-title[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;margin:0;font-weight:600;flex:1}[_nghost-%COMP%]   .igo-panel-content[_ngcontent-%COMP%]{flex:1;overflow:auto}[_nghost-%COMP%]   .igo-cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .panel-left[_ngcontent-%COMP%], [_nghost-%COMP%]   .panel-right[_ngcontent-%COMP%]{display:flex;min-width:40px}[_nghost-%COMP%]   .panel-right[_ngcontent-%COMP%]:not(:empty){padding-right:4px}"],changeDetection:0})}return q})();var nr=r(24100);class Rn{dataChange=new y.g([]);get data(){return this.dataChange.value}constructor(Re){Re&&this.dataChange.next(Re)}set(Re){this.dataChange.next(Re)}add(Re){const E=this.data.slice();E.push(Re),this.set(E)}remove(Re){const E=this.data.slice(),ee=E.indexOf(Re);E.splice(ee,1),this.set(E)}}function rr(q){return Re=>{Ki.I.register(Object.assign({},q,{component:Re}))}}var sr=r(61616);class ar{options;widget$=new y.g(void 0);widgetInputs$=new y.g({});widgetSubscribers$=new y.g({});entities$$;change=new sr.E;change$;get id(){return this.options.id}get title(){return this.options.title}get meta(){return this.options.meta||{}}get entityStore(){return this.options.entityStore}get actionStore(){return this.options.actionStore}get widget(){return this.widget$.value}get hasWidget(){return void 0!==this.widget}constructor(Re){this.options=Re}get active(){return this.active$.value}active$=new y.g(!1);activate(){!0===this.active&&this.deactivate(),this.active$.next(!0),void 0!==this.entityStore&&(this.entities$$=this.entityStore.stateView.all$().subscribe(()=>this.onStateChange())),this.change.next()}deactivate(){this.active$.next(!1),this.deactivateWidget(),void 0!==this.entities$$&&this.entities$$.unsubscribe(),void 0!==this.change$&&this.change$.unsubscribe()}activateWidget(Re,E={},ee={}){this.widget$.next(Re),this.widgetInputs$.next(E),this.widgetSubscribers$.next(ee),this.change.next()}deactivateWidget(){this.widget$.next(void 0),this.change.next()}onStateChange(){this.change.next()}}},37240:(Fe,ce,r)=>{"use strict";r.d(ce,{SS:()=>Fi,cl:()=>Ht,kP:()=>bi,AX:()=>bn,W2:()=>ri,Sm:()=>Xi,KS:()=>Yi,M9:()=>de,Mb:()=>On,k5:()=>gi,mE:()=>vn});var C=r(65056),e=r(71904),d=r(34672),L=r(24296),P=r(46176),o=r(75180),f=r(50244),h=r(42536),R=r(77872),y=r(53e3),O=r(9204),x=r(24708),T=r(93020),a=r(54844),F=r(37496),A=r(58752),k=r(84112),W=r(21720),w=r(58776),te=r(43168),Z=r(12396),K=r(80848),X=r(3784),V=r(28772),B=r(61616),z=r(1296),c=r(68013),I=r(83680),b=r(51672),G=r(78600),D=r(40604),g=r(9240),U=r(24112),M=function(ne){return ne[ne.null=0]="null",ne[ne.read=1]="read",ne[ne.write=2]="write",ne}(M||{}),s=r(34896),ie=r(33712);let de=(()=>{class ne{http;authService;languageService;config;messageService;storageService;exportService;route;context$=new a.g(void 0);contexts$=new a.g({ours:[]});defaultContextId$=new a.g(void 0);editedContext$=new a.g(void 0);importedContext=[];toolsChanged$=new B.E;mapViewFromRoute={};options;baseUrl;tools;toolbar;get defaultContextUri(){return this.storageService.get("favorite.context.uri")||this._defaultContextUri||this.options.defaultContextUri}set defaultContextUri(_){this._defaultContextUri=_}_defaultContextUri;constructor(_,N,Q,Ce,Te,Ne,gt,It){this.http=_,this.authService=N,this.languageService=Q,this.config=Ce,this.messageService=Te,this.storageService=Ne,this.exportService=gt,this.route=It,this.options=Object.assign({basePath:"contexts",contextListFile:"_contexts.json",defaultContextUri:"_default"},this.config.getConfig("context")),this.baseUrl=this.options.url??"",this.readParamsFromRoute(),this.authService.hasAuthService?this.authService.logged$.subscribe(it=>{it&&(this.contexts$.pipe((0,c.s)(1),(0,I.K)()).subscribe(At=>{this.handleContextsChange()}),this.loadContexts())}):(this.loadContexts(),this.handleContextsChange(!1))}get(_,N){let Q=this.baseUrl+"/contexts";return _&&this.authService.authenticated&&(Q+="?permission="+_.join(),N&&(Q+="&hidden=true")),this.http.get(Q)}getById(_){return this.http.get(this.baseUrl+"/contexts/"+_)}getDetails(_){return this.http.get(`${this.baseUrl}/contexts/${_}/details`).pipe((0,b.a)(Q=>{throw this.handleError(Q,_),Q}))}getDefault(){if(this.authService.authenticated)return this.http.get(this.baseUrl+"/contexts/default").pipe((0,G.y)(N=>{this.defaultContextId$.next(N.id)}));{const _=this.storageService.get("favorite.context.uri");return this.defaultContextId$.next(_),this.getContextByUri(_)}}getProfilByUser(){return this.baseUrl?this.http.get(this.baseUrl+"/profils?"):(0,z.of)([])}setDefault(_){return this.authService.authenticated?this.http.post(this.baseUrl+"/contexts/default",{defaultContextId:_}):(this.storageService.set("favorite.context.uri",_),(0,z.of)(void 0))}hideContext(_){return this.http.post(this.baseUrl+"/contexts/"+_+"/hide",{})}showContext(_){return this.http.post(this.baseUrl+"/contexts/"+_+"/show",{})}delete(_,N=!1){const Q={ours:[]};return Object.keys(this.contexts$.value).forEach(Te=>Q[Te]=this.contexts$.value[Te].filter(Ne=>Ne.id!==_)),N?(this.importedContext=this.importedContext.filter(Te=>Te.id!==_),(0,z.of)(this.contexts$.next(Q))):this.http.delete(this.baseUrl+"/contexts/"+_).pipe((0,G.y)(Te=>{this.contexts$.next(Q)}))}create(_){return this.http.post(this.baseUrl+"/contexts",_).pipe((0,D.k)(Q=>(Q.permission=this.authService.authenticated?M[M.write]:M[M.read],this.contexts$.value.ours.unshift(Q),this.contexts$.next(this.contexts$.value),Q)))}clone(_,N={}){return this.http.post(this.baseUrl+"/contexts/"+_+"/clone",N).pipe((0,D.k)(Ce=>(Ce.permission=M[M.write],this.contexts$.value.ours.unshift(Ce),this.contexts$.next(this.contexts$.value),Ce)))}update(_,N){return this.http.patch(this.baseUrl+"/contexts/"+_,N)}addToolAssociation(_,N){return this.http.post(`${this.baseUrl}/contexts/${_}/tools`,{toolId:N})}deleteToolAssociation(_,N){return this.http.delete(`${this.baseUrl}/contexts/${_}/tools/${N}`)}getPermissions(_){return this.http.get(this.baseUrl+"/contexts/"+_+"/permissions")}addPermissionAssociation(_,N,Q){return this.http.post(`${this.baseUrl}/contexts/${_}/permissions`,{profil:N,typePermission:Q}).pipe((0,b.a)(Ne=>{throw this.handleError(Ne,void 0,!0),[Ne]}))}deletePermissionAssociation(_,N){return this.http.delete(`${this.baseUrl}/contexts/${_}/permissions/${N}`)}getLocalContexts(){const _=this.getPath(this.options.contextListFile);return this.http.get(_).pipe((0,D.k)(N=>({ours:N})))}getLocalContext(_){const N=this.getPath(`${_}.json`);return this.http.get(N).pipe((0,g.O)(Q=>{if(!Q.base)return(0,z.of)(Q);const Ce=this.getPath(`${Q.base}.json`);return this.http.get(Ce).pipe((0,D.k)(Te=>{const Ne=Q;return Ne.map=te.Yv.mergeDeep(Te.map,Q.map),Ne.layers=(Te.layers||[]).concat(Q.layers||[]).reverse().filter((gt,It,it)=>!gt.id||it.findIndex(At=>At.id===gt.id)===It).reverse(),Ne.toolbar=Q.toolbar||Te.toolbar,Ne.message=Q.message||Te.message,Ne.messages=Q.messages||Te.messages,Ne.tools=(Q.tools||[]).concat(Te.tools||[]).filter((gt,It,it)=>it.findIndex(At=>At.name===gt.name)===It),Ne}),(0,b.a)(Te=>{throw this.handleError(Te,_),Te}))}),(0,b.a)(Q=>{throw this.handleError(Q,_),Q}))}loadContexts(_,N){let Q;Q=this.baseUrl?this.get(_,N):this.getLocalContexts(),Q.subscribe(Ce=>{Ce.ours=this.importedContext.concat(Ce.ours),this.contexts$.next(Ce)})}loadDefaultContext(){const _=(N=!1)=>{!N&&this.baseUrl&&this.authService.authenticated?this.getDefault().subscribe(Q=>{this.defaultContextUri=Q.uri,this.addContextToList(Q),this.setContext(Q)},()=>{this.defaultContextId$.next(void 0),this.loadContext(this.defaultContextUri)}):this.loadContext(this.defaultContextUri)};this.route&&this.route.options.contextKey?this.route.queryParams.pipe((0,U.o)(100)).subscribe(N=>{const Q=N[this.route.options.contextKey];let Ce=!1;Q&&(this.defaultContextUri=Q,Ce=!0),_(Ce)}):_()}loadContext(_){const N=this.context$.value;N&&N.uri===_||this.getContextByUri(_).pipe((0,I.K)()).subscribe(Q=>{this.addContextToList(Q),this.setContext(Q)},Q=>{_!==this.options.defaultContextUri&&this.loadContext(this.options.defaultContextUri)})}setContext(_){this.handleContextMessage(_);const N=this.context$.value;if(N&&_&&_.id===N.id)return void 0===_.map.view.keepCurrentView&&(_.map.view.keepCurrentView=!0),void this.context$.next(_);_.map||(_.map={view:{}}),Object.assign(_.map.view,this.mapViewFromRoute),this.context$.next(_)}loadEditedContext(_){this.getContextByUri(_).subscribe(N=>{this.setEditedContext(N)})}setEditedContext(_){this.editedContext$.next(_)}getContextFromMap(_,N){const Q=_.ol.getView(),Ce=Q.getProjection().getCode(),Te=new K.c(Q.getCenter()).transform(Ce,"EPSG:4326"),Ne={uri:(0,te.uq)(),title:"",scope:"private",map:{view:{center:Te.getCoordinates(),zoom:Q.getZoom(),projection:Ce,maxZoomOnExtent:_.viewController.maxZoomOnExtent}},layers:[],tools:[]};let gt=[];gt=!0===N?_.layers$.getValue().filter(it=>!0===it.baseLayer||"searchPointerSummaryId"===it.options.id).sort((it,At)=>it.zIndex-At.zIndex):_.layers$.getValue().filter(it=>!it.id.includes("WfsWorkspaceTableDest")).sort((it,At)=>it.zIndex-At.zIndex);let It=0;for(const it of gt){const At={title:it.options.title,zIndex:++It,visible:it.visible,security:it.options.security,opacity:it.opacity},Dt={id:it.options.id?String(it.options.id):void 0,layerOptions:At,sourceOptions:{type:it.dataSource.options.type,params:it.dataSource.options.params,url:it.dataSource.options.url,queryable:it.queryable}};Dt.sourceOptions.type&&Ne.layers.push(Dt)}return Ne.tools=this.tools.map(it=>({id:String(it.id),global:it.global})),Ne}getContextFromLayers(_,N,Q,Ce){const Te=this.context$.getValue(),Ne=_.ol.getView(),gt=Ne.getProjection().getCode(),it={uri:Q,title:Q,map:{view:{center:new K.c(Ne.getCenter()).transform(gt,"EPSG:4326").getCoordinates(),zoom:Ne.getZoom(),projection:gt,keepCurrentView:Ce}},layers:[],toolbar:[],tools:[],extraFeatures:[]},At=_.layers$.getValue();return it.layers=At.filter(Dt=>Dt.baseLayer).map(Dt=>({baseLayer:!0,sourceOptions:Dt.options.sourceOptions,title:Dt.options.title,visible:Dt.visible})),N.forEach(Dt=>{const eo=Te.layers.find(Qt=>{const wo=Qt.source;return wo&&Dt.id===wo.id&&!Qt.baseLayer});if(eo){let Qt=eo,wo=Qt.style;Qt.igoStyle?.styleByAttribute?wo=void 0:Qt.igoStyle?.clusterBaseStyle&&(wo=void 0,delete eo.sourceOptions.source,delete eo.sourceOptions.format),it.layers.push({baseLayer:eo.baseLayer,title:Dt.options.title,zIndex:Dt.zIndex,igoStyle:{styleByAttribute:Qt.igoStyle?.styleByAttribute,clusterBaseStyle:Qt.igoStyle?.clusterBaseStyle},style:wo,clusterParam:eo.clusterParam,visible:Dt.visible,opacity:Dt.opacity,sourceOptions:eo.sourceOptions})}else if(Dt.ol.getSource()instanceof V.c){const Qt=this.getExtraFeatures(Dt);Qt.name=Dt.options.title,Qt.opacity=Dt.opacity,Qt.visible=Dt.visible,it.extraFeatures.push(Qt)}else{const Qt=Dt.options;Qt.zIndex=Dt.zIndex,Qt.visible=Dt.visible,Qt.opacity=Dt.opacity,delete Qt.source,it.layers.push(Qt)}}),it.toolbar=this.toolbar,it.tools=this.tools,it}getExtraFeatures(_){const N=new Z.c;let Q;_.ol.getSource()instanceof X.c?(Q=_.ol.getSource().getFeatures(),Q=Q.flatMap(gt=>gt.get("features"))):Q=_.ol.getSource().getFeatures();const Ce=this.exportService.generateFeature(Q,"GeoJSON","_featureStore"),Te=N.writeFeatures(Ce,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});return JSON.parse(Te)}setTools(_){this.tools=_}setToolbar(_){this.toolbar=_}handleContextMessage(_){this.context$.value&&_.uri&&this.context$.value.uri!==_.uri&&this.messageService.removeAllAreNotError(),_.messages=_.messages?_.messages:[],_.messages.push(_.message),_.messages.map(N=>{N&&this.messageService.message(N)})}getContextByUri(_){if(this.baseUrl){let Q;for(const Te of Object.keys(this.contexts$.value))if(Q=this.contexts$.value[Te].find(Ne=>Ne.uri===_),Q)break;return Q&&Q.imported?(0,z.of)(Q):this.getDetails(Q?Q.id:_)}const N=this.contexts$.value.ours.find(Q=>Q.uri===_&&!0===Q.imported);return N?(0,z.of)(N):this.getLocalContext(_)}getContextLayers(_){const N=[];return _.layers$.getValue().forEach(Ce=>{!Ce.baseLayer&&"searchPointerSummaryId"!==Ce.options.id&&N.push(Ce)}),N}readParamsFromRoute(){this.route&&this.route.queryParams.subscribe(_=>{const N=this.route.options.centerKey;N&&_[N]&&(this.mapViewFromRoute.center=_[N].split(",").map(Number));const Q=this.route.options.projectionKey;Q&&_[Q]&&(this.mapViewFromRoute.projection=_[Q]);const Ce=this.route.options.zoomKey;Ce&&_[Ce]&&(this.mapViewFromRoute.zoom=Number(_[Ce]))})}getPath(_){return`${this.options.basePath.replace(/\/$/,"")}/${_}`}handleError(_,N,Q){const Ce=this.contexts$.value.ours.find(Ne=>Ne.uri===N),Te=Ce?Ce.title:N;_.error.title=this.languageService.translate.instant("igo.context.contextManager.invalid.title"),_.error.message=this.languageService.translate.instant("igo.context.contextManager.invalid.text",{value:Te}),_.error.toDisplay=!0,Q&&(_.error.title=this.languageService.translate.instant("igo.context.contextManager.errors.addPermissionTitle"),_.error.message=this.languageService.translate.instant("igo.context.contextManager.errors.addPermission")),this.messageService.error("igo.context.contextManager.errors.addPermission","igo.context.contextManager.errors.addPermissionTitle")}handleContextsChange(_=!0){const N=this.context$.value,Q=this.editedContext$.value;(!N||N.uri===this.options.defaultContextUri)&&(_=!1),_&&this.findContext(N)?(this.getContextByUri(N.uri).pipe((0,I.K)()).subscribe(Te=>{this.toolsChanged$.next(Te)}),this.baseUrl&&this.authService.authenticated&&this.getDefault().subscribe()):(this.defaultContextUri=void 0,this.loadDefaultContext());const Ce=this.findContext(Q);(!Ce||"write"!==Ce.permission)&&this.setEditedContext(void 0)}addContextToList(_){this.findContext(_)||this.contexts$.value&&this.contexts$.value.public&&(this.contexts$.value.public.push({id:_.id,uri:_.uri,title:_.title,scope:_.scope,permission:M[M.read]}),this.contexts$.next(this.contexts$.value))}findContext(_){if(!_)return!1;const N=this.contexts$.value;let Q;for(const Ce of Object.keys(N))if(Q=N[Ce].find(Ne=>_.id&&Ne.id===_.id||_.uri&&Ne.uri===_.uri),Q)break;return Q}static \u0275fac=function(N){return new(N||ne)(s.CoB(ie.KK),s.CoB(A.oj),s.CoB(x.ov),s.CoB(O.aW),s.CoB(T.mi),s.CoB(W.yQ),s.CoB(w.YNI),s.CoB(k.k$,8))};static \u0275prov=s.wxM({token:ne,factory:ne.\u0275fac,providedIn:"root"})}return ne})();var fe=r(21296);class Se extends Error{}class le extends Se{constructor(){super("Nothing to export"),Object.setPrototypeOf(this,le.prototype)}}let oe=(()=>{class ne{export(_){return this.exportAsync(_)}exportAsync(_){return new fe._(Q=>{if(!0===this.nothingToExport(_))return void Q.error(new le);const Te=JSON.stringify(_);(0,te.We)(Te,"text/json;charset=utf-8",`${_.uri}.json`),Q.complete()})}nothingToExport(_){return void 0===_.map}static \u0275fac=function(N){return new(N||ne)};static \u0275prov=s.wxM({token:ne,factory:ne.\u0275fac,providedIn:"root"})}return ne})();class ke extends Error{}class qe extends ke{constructor(){super("Invalid file"),Object.setPrototypeOf(this,qe.prototype)}}class nt extends ke{constructor(){super("Failed to read file"),Object.setPrototypeOf(this,nt.prototype)}}class Ue extends ke{constructor(){super("Nothing to import"),Object.setPrototypeOf(this,Ue.prototype)}}class St extends ke{constructor(){super("File is too large"),Object.setPrototypeOf(this,Ue.prototype)}}function Ie(ne,We,_){_.error("igo.context.contextImportExport.import.invalid.text","igo.context.contextImportExport.import.invalid.title",void 0,{value:ne.name,mimeType:ne.type})}function je(ne,We,_,N){_.error("igo.context.contextImportExport.import.tooLarge.text","igo.context.contextImportExport.import.tooLarge.title",void 0,{value:ne.name,size:N})}function Ve(ne,We,_){_.error("igo.context.contextImportExport.import.unreadable.text","igo.context.contextImportExport.import.unreadable.title",void 0,{value:ne.name})}function ze(ne){return(new Z.c).readFeatures(ne,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})}let Rt=(()=>{class ne{config;static allowedMimeTypes=["application/json"];static allowedExtensions="json";clientSideFileSizeMax;constructor(_){this.config=_;const N=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(N||30)*Math.pow(1024,2)}import(_){return this.importAsync(_)}getFileImporter(_){const N=function Me(ne){return ne.name.split(".").pop().toLowerCase()}(_),Q=_.type,Ce=[...ne.allowedMimeTypes],Te=ne.allowedExtensions;if(!(Ce.indexOf(Q)<0&&Te.indexOf(N)<0||"application/json"!==Q&&N!==ne.allowedExtensions))return this.importFile}importAsync(_){return new fe._(Q=>{if(_.size>=this.clientSideFileSizeMax)return void Q.error(new St);const Ce=this.getFileImporter(_);void 0!==Ce?Ce.call(this,_,Q):Q.error(new qe)})}importFile(_,N){const Q=new FileReader;Q.onload=Ce=>{try{const Te=this.parseContextFromFile(_,Ce.target.result);N.next(Te)}catch{N.error(new nt)}N.complete()},Q.onerror=Ce=>{N.error(new nt)},Q.readAsText(_,"UTF-8")}parseContextFromFile(_,N){return JSON.parse(N)}static \u0275fac=function(N){return new(N||ne)(s.CoB(O.aW))};static \u0275prov=s.wxM({token:ne,factory:ne.\u0275fac,providedIn:"root"})}return ne})();var Ft=r(72584);const Et=ne=>({size:ne});function ko(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"div")(1,"form",5)(2,"div",6)(3,"button",7),s.qCj("click",function(){s.usT(_);const Q=s.Gew(10);return s.CGJ(Q.click())}),s.wVc(4,"async"),s.OEk(5),s.wVc(6,"translate"),s.C$Y(),s.wR5(7,"igo-spinner",8),s.wVc(8,"async"),s.I0R(9,"input",9,10),s.qCj("click",function(){s.usT(_);const Q=s.Gew(10);return s.CGJ(Q.value=null)})("change",function(Q){s.usT(_);const Ce=s.GaO();return s.CGJ(Ce.importFiles(Q.target.files))}),s.C$Y()()(),s.I0R(11,"section",11)(12,"h4"),s.OEk(13),s.wVc(14,"translate"),s.C$Y(),s.I0R(15,"ul")(16,"li"),s.OEk(17),s.wVc(18,"translate"),s.C$Y()()()()}if(2&ne){const _=s.GaO();s.yG2(3),s.E7m("disabled",s.kDX(4,7,_.loading$)),s.yG2(2),s.oRS(" ",s.kDX(6,9,"igo.geo.importExportForm.importButton")," "),s.yG2(2),s.E7m("shown",s.kDX(8,11,_.loading$)),s.yG2(2),s.m4B("display","none"),s.yG2(4),s.cNF(s.kDX(14,13,"igo.geo.importExportForm.importClarifications")),s.yG2(4),s.oRS(" ",s.g7$(18,15,"igo.geo.importExportForm.importSizeMax",s.S45(18,Et,_.fileSizeMb))," ")}}function so(ne,We){if(1&ne&&(s.I0R(0,"mat-option",2),s.OEk(1),s.C$Y()),2&ne){const _=We.$implicit;s.E7m("value",_),s.yG2(),s.cNF(_.title)}}function Si(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"form",12)(1,"div",13)(2,"mat-form-field",14)(3,"mat-label"),s.OEk(4),s.wVc(5,"translate"),s.C$Y(),s.wR5(6,"input",15),s.C$Y()(),s.I0R(7,"div",13)(8,"mat-form-field")(9,"mat-label"),s.OEk(10),s.wVc(11,"translate"),s.C$Y(),s.I0R(12,"mat-select",16)(13,"mat-option",17,18),s.qCj("click",function(){s.usT(_);const Q=s.Gew(14),Ce=s.GaO();return s.CGJ(Ce.selectAll(Q))}),s.OEk(15),s.wVc(16,"translate"),s.C$Y(),s.wR5(17,"mat-divider"),s.yuY(18,so,2,2,"mat-option",19),s.C$Y()()(),s.I0R(19,"div",6)(20,"button",7),s.qCj("click",function(){s.usT(_);const Q=s.GaO();return s.CGJ(Q.handleExportFormSubmit(Q.form.value))}),s.wVc(21,"async"),s.OEk(22),s.wVc(23,"translate"),s.C$Y(),s.wR5(24,"igo-spinner",8),s.wVc(25,"async"),s.C$Y()()}if(2&ne){const _=s.GaO();s.E7m("formGroup",_.form),s.yG2(4),s.cNF(s.kDX(5,9,"igo.context.contextImportExport.export.exportContextName")),s.yG2(6),s.cNF(s.kDX(11,11,"igo.context.contextImportExport.export.exportPlaceHolder")),s.yG2(3),s.E7m("value",1),s.yG2(2),s.oRS(" ",s.kDX(16,13,"igo.context.contextImportExport.export.exportSelectAll")," "),s.yG2(3),s.E7m("ngForOf",_.userControlledLayerList),s.yG2(2),s.E7m("disabled",!_.form.valid||s.kDX(21,15,_.loading$)),s.yG2(2),s.oRS(" ",s.kDX(23,17,"igo.geo.importExportForm.exportButton")," "),s.yG2(2),s.E7m("shown",s.kDX(25,19,_.loading$))}}let bi=(()=>{class ne{contextImportService;contextExportService;messageService;formBuilder;config;contextService;form;layers;inputProj="EPSG:4326";loading$=new a.g(!1);forceNaming=!1;layerList;userControlledLayerList;res;clientSideFileSizeMax;fileSizeMb;activeImportExport="import";layers$$;map;constructor(_,N,Q,Ce,Te,Ne){this.contextImportService=_,this.contextExportService=N,this.messageService=Q,this.formBuilder=Ce,this.config=Te,this.contextService=Ne,this.buildForm()}ngOnInit(){const _=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(_||30)*Math.pow(1024,2),this.fileSizeMb=this.clientSideFileSizeMax/Math.pow(1024,2),this.layers$$=this.map.layers$.subscribe(()=>{this.layerList=this.contextService.getContextLayers(this.map),this.userControlledLayerList=this.layerList.filter(N=>N.showInLayerList)})}importFiles(_){this.loading$.next(!0);for(const N of _)this.contextImportService.import(N).pipe((0,F.U)(1)).subscribe(Q=>this.onFileImportSuccess(N,Q),Q=>this.onFileImportError(N,Q),()=>{this.loading$.next(!1)})}handleExportFormSubmit(_){this.loading$.next(!0),this.res=this.contextService.getContextFromLayers(this.map,_.layers,_.name,!1),this.res.imported=!0,this.contextExportService.export(this.res).pipe((0,F.U)(1)).subscribe(()=>{},N=>this.onFileExportError(N),()=>{this.onFileExportSuccess(),this.loading$.next(!1)})}buildForm(){this.form=this.formBuilder.group({layers:["",[e.AQ.required]],name:["",[e.AQ.required]]})}onFileImportSuccess(_,N){!function Qe(ne,We,_,N){if(Object.keys(We).length<=0)return void function ot(ne,We){We.error("igo.context.contextImportExport.import.empty.text","igo.context.contextImportExport.import.empty.title",void 0,{value:ne.name})}(ne,_);const Q=function ct(ne){return ne.name.substr(0,ne.name.lastIndexOf("."))}(ne);(function lt(ne,We,_){ne.title=We,ne.imported=!0,_.contexts$.value.ours.unshift(ne),_.contexts$.next(_.contexts$.value),_.importedContext.unshift(ne),_.loadContext(ne.uri)})(We,Q,N),_.success("igo.context.contextImportExport.import.success.text","igo.context.contextImportExport.import.success.title",void 0,{value:Q})}(_,N,this.messageService,this.contextService)}onFileImportError(_,N){this.loading$.next(!1),function _e(ne,We,_,N){({"Invalid file":Ie,"File is too large":je,"Failed to read file":Ve})[We.message](ne,We,_,N=N||30)}(_,N,this.messageService,this.fileSizeMb)}onFileExportError(_){this.loading$.next(!1),function se(ne,We){ne instanceof le?this.handleNothingToExportError(We):We.error("igo.context.contextImportExport.export.failed.text","igo.context.contextImportExport.export.failed.title")}(_,this.messageService)}onFileExportSuccess(){!function me(ne){ne.success("igo.context.contextImportExport.export.success.text","igo.context.contextImportExport.export.success.title")}(this.messageService)}selectAll(_){_._selected&&(this.form.controls.layers.setValue(this.userControlledLayerList),_._selected=!0),!1===_._selected&&this.form.controls.layers.setValue([])}onImportExportChange(_){this.activeImportExport=_.value}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(N){return new(N||ne)(s.GI1(Rt),s.GI1(oe),s.GI1(T.mi),s.GI1(e.KE),s.GI1(O.aW),s.GI1(de))};static \u0275cmp=s.In1({type:ne,selectors:[["igo-context-import-export"]],inputs:{map:"map"},standalone:!0,features:[s.UHJ],decls:10,vars:11,consts:[[1,"import-export-toggle","mat-typography"],[3,"value","change"],[3,"value"],[4,"ngIf"],["class","igo-form",3,"formGroup",4,"ngIf"],[1,"igo-form"],[1,"igo-form-button-group"],["mat-raised-button","","type","button",3,"disabled","click"],[3,"shown"],["type","file",3,"click","change"],["fileInput",""],[1,"mat-typography"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],[1,"example-full-width"],["formControlName","name","matInput","",3,"value"],["formControlName","layers","multiple",""],[3,"value","click"],["e",""],[3,"value",4,"ngFor","ngForOf"]],template:function(N,Q){1&N&&(s.I0R(0,"div",0)(1,"mat-button-toggle-group",1),s.qCj("change",function(Te){return Q.onImportExportChange(Te)}),s.I0R(2,"mat-button-toggle",2),s.OEk(3),s.wVc(4,"translate"),s.C$Y(),s.I0R(5,"mat-button-toggle",2),s.OEk(6),s.wVc(7,"translate"),s.C$Y()()(),s.yuY(8,ko,19,20,"div",3)(9,Si,26,21,"form",4)),2&N&&(s.yG2(),s.E7m("value",Q.activeImportExport),s.yG2(),s.E7m("value","import"),s.yG2(),s.oRS(" ",s.kDX(4,7,"igo.geo.importExportForm.importTabTitle")," "),s.yG2(2),s.E7m("value","export"),s.yG2(),s.oRS(" ",s.kDX(7,9,"igo.geo.importExportForm.exportTabTitle")," "),s.yG2(2),s.E7m("ngIf","import"===Q.activeImportExport),s.yG2(),s.E7m("ngIf","export"===Q.activeImportExport))},dependencies:[L.ue,L.gn,L.KU,C.u_,e.y,e.sz,e.ot,e.ue,e.u,e.SC,d.oJ,d.Gw,y.is,e.sl,e.uW,e.Wo,f.wb,f.Up,f.w5,h.cN,h.yi,R.d5,R.kX,P.I5,P.Ax,o.U,o.k,C.Iw,C.a,x._s,Ft.sD],styles:[".import-export-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}.import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}.igo-input-container[_ngcontent-%COMP%]{padding:10px}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}h4[_ngcontent-%COMP%]{padding:0 5px}.igo-form[_ngcontent-%COMP%]{padding:15px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}igo-spinner[_ngcontent-%COMP%]{position:absolute;padding-left:10px}"]})}return ne})();var Ke=r(32328),Ze=r(27e3);function dt(ne,We){if(1&ne&&(s.I0R(0,"span",10),s.OEk(1),s.C$Y()),2&ne){const _=s.GaO();s.yG2(),s.oRS("",_.prefix,"-")}}let ht=(()=>{class ne{formBuilder;messageService;form;prefix;get btnSubmitText(){return this._btnSubmitText}set btnSubmitText(_){this._btnSubmitText=_}_btnSubmitText;get context(){return this._context}set context(_){this._context=_,this.buildForm()}_context;get disabled(){return this._disabled}set disabled(_){this._disabled=_}_disabled=!1;submitForm=new s._w7;clone=new s._w7;delete=new s._w7;constructor(_,N){this.formBuilder=_,this.messageService=N}ngOnInit(){this.buildForm()}handleFormSubmit(_){let N=Object.assign({},_);N=te.Yv.removeNull(N),N.uri=N.uri.replace(" ",""),N.uri=N.uri?this.prefix+"-"+N.uri:this.prefix,this.submitForm.emit(N)}copyTextToClipboard(){const _=this.prefix+"-"+this.form.value.uri.replace(" ","");te._D.copy(_)&&this.messageService.success("igo.context.contextManager.dialog.copyMsg","igo.context.contextManager.dialog.copyTitle")}buildForm(){const _=this.context||{},N=_.uri.split("-");this.prefix=N.shift();const Q=N.join("-");this.form=this.formBuilder.group({title:[_.title],uri:[Q||" "]})}static \u0275fac=function(N){return new(N||ne)(s.GI1(e.KE),s.GI1(T.mi))};static \u0275cmp=s.In1({type:ne,selectors:[["igo-context-form"]],inputs:{btnSubmitText:"btnSubmitText",context:"context",disabled:"disabled"},outputs:{submitForm:"submitForm",clone:"clone",delete:"delete"},standalone:!0,features:[s.UHJ],decls:20,vars:18,consts:[[1,"igo-form",3,"formGroup","ngSubmit"],[1,"full-width"],["matInput","","required","","maxlength","128","formControlName","title",3,"placeholder"],["id","uriInput",1,"full-width"],["class","prefix",4,"ngIf"],[1,"fieldWrapper"],["matInput","","maxlength","64","floatLabel","always","formControlName","uri",3,"placeholder"],["id","copyButton","type","button","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click"],[1,"igo-form-button-group"],["mat-raised-button","","type","submit",3,"disabled"],[1,"prefix"]],template:function(N,Q){1&N&&(s.I0R(0,"form",0),s.qCj("ngSubmit",function(){return Q.handleFormSubmit(Q.form.value)}),s.I0R(1,"mat-form-field",1),s.wR5(2,"input",2),s.wVc(3,"translate"),s.I0R(4,"mat-error"),s.OEk(5),s.wVc(6,"translate"),s.C$Y()(),s.I0R(7,"mat-form-field",3),s.yuY(8,dt,2,1,"span",4),s.I0R(9,"span",5),s.wR5(10,"input",6),s.wVc(11,"translate"),s.C$Y()(),s.I0R(12,"button",7),s.qCj("click",function(){return Q.copyTextToClipboard()}),s.wVc(13,"translate"),s.I0R(14,"mat-icon"),s.OEk(15,"content_copy"),s.C$Y()(),s.I0R(16,"div",8)(17,"button",9),s.OEk(18),s.wVc(19,"translate"),s.C$Y()()()),2&N&&(s.E7m("formGroup",Q.form),s.yG2(2),s.E7m("placeholder",s.kDX(3,8,"igo.context.contextManager.form.title")),s.yG2(3),s.oRS(" ",s.kDX(6,10,"igo.context.contextManager.form.titleRequired")," "),s.yG2(3),s.E7m("ngIf",Q.prefix),s.yG2(2),s.E7m("placeholder",s.kDX(11,12,"igo.context.contextManager.form.uri")),s.yG2(2),s.E7m("matTooltip",s.kDX(13,14,"igo.context.contextManager.form.copy")),s.yG2(5),s.E7m("disabled",!Q.form.valid||Q.disabled),s.yG2(),s.oRS(" ",s.kDX(19,16,"igo.context.contextManager.form.edit")," "))},dependencies:[e.y,e.sz,e.ot,e.ue,e.u,e.eJ,e.Mj,e.sl,e.uW,e.Wo,f.wb,f.Up,f.wJ,h.cN,h.yi,C.u_,d.oJ,d.Gw,d.um,Ze.KO,Ze.a4,Ke.oB,Ke.qL,x._s,Ft.sD],styles:["form[_ngcontent-%COMP%]{margin:10px}.full-width[_ngcontent-%COMP%]{width:100%}#uriInput[_ngcontent-%COMP%]   .fieldWrapper[_ngcontent-%COMP%]{display:block;overflow:hidden}#uriInput[_ngcontent-%COMP%]   .prefix[_ngcontent-%COMP%]{float:left}#copyButton[_ngcontent-%COMP%]{width:24px;float:right;position:relative;top:-58px;left:5px}"]})}return ne})();function lo(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"igo-context-form",1),s.qCj("submitForm",function(Q){s.usT(_);const Ce=s.GaO();return s.CGJ(Ce.submitForm.emit(Q))}),s.wVc(1,"translate"),s.C$Y()}if(2&ne){const _=s.GaO();s.E7m("btnSubmitText",s.kDX(1,2,"igo.context.contextManager.save"))("context",_.context)}}let Ht=(()=>{class ne{cd;get context(){return this._context}set context(_){this._context=_,this.refresh()}_context;submitForm=new s._w7;constructor(_){this.cd=_}refresh(){this.cd.detectChanges()}static \u0275fac=function(N){return new(N||ne)(s.GI1(s.kD9))};static \u0275cmp=s.In1({type:ne,selectors:[["igo-context-edit"]],inputs:{context:"context"},outputs:{submitForm:"submitForm"},standalone:!0,features:[s.UHJ],decls:1,vars:1,consts:[[3,"btnSubmitText","context","submitForm",4,"ngIf"],[3,"btnSubmitText","context","submitForm"]],template:function(N,Q){1&N&&s.yuY(0,lo,2,4,"igo-context-form",0),2&N&&s.E7m("ngIf",Q.context)},dependencies:[C.u_,ht,x._s,Ft.sD],encapsulation:2})}return ne})();var mt=r(63916);function Eo(ne,We){if(1&ne&&(s.I0R(0,"mat-icon"),s.OEk(1),s.C$Y()),2&ne){const _=s.GaO(2);s.yG2(),s.cNF(_.context.icon?_.context.icon:"public"===_.context.scope?"public":"star")}}function Lt(ne,We){if(1&ne&&s.wR5(0,"img",7),2&ne){const _=s.GaO(2);s.E7m("src",_.context.iconImage,s.K6U)}}function Ho(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"button",4),s.qCj("click",function(){s.usT(_);const Q=s.GaO();return s.CGJ(Q.favoriteClick(Q.context))}),s.wVc(1,"translate"),s.yuY(2,Eo,2,1,"mat-icon",5)(3,Lt,1,1,"img",6),s.C$Y()}if(2&ne){const _=s.GaO();s.E7m("matTooltip",_.auth.authenticated?s.kDX(1,4,"igo.context.contextManager.favorite"):"")("color",_.default?"primary":"default"),s.yG2(2),s.E7m("ngIf",!_.context.iconImage),s.yG2(),s.E7m("ngIf",_.context.iconImage)}}function qo(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"button",4),s.qCj("click",function(){s.usT(_);const Q=s.GaO();return s.CGJ(Q.favoriteClick(Q.context))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"star"),s.C$Y()()}if(2&ne){const _=s.GaO();s.E7m("matTooltip",s.kDX(1,2,"igo.context.contextManager.favorite"))("color",_.default?"primary":"default")}}function Ro(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"button",18),s.qCj("click",function(){s.usT(_);const Q=s.GaO(2);return s.CGJ(Q.save.emit(Q.context))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"save"),s.C$Y()()}if(2&ne){const _=s.GaO(2);s.E7m("matTooltip",s.kDX(1,2,"igo.context.contextManager.save"))("color",_.color)}}function xt(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"button",19),s.qCj("click",function(){s.usT(_);const Q=s.GaO(2);return s.CGJ(Q.managePermissions.emit(Q.context))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"manage_accounts"),s.C$Y()()}if(2&ne){const _=s.GaO(2);s.E7m("matTooltip",s.kDX(1,2,"igo.context.contextManager.managePermissions"))("color",_.color)}}function zt(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"button",20),s.qCj("click",function(){s.usT(_);const Q=s.GaO(2);return s.CGJ(Q.clone.emit(Q.context))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"content_copy"),s.C$Y()()}if(2&ne){const _=s.GaO(2);s.E7m("matTooltip",s.kDX(1,2,"igo.context.contextManager.clone"))("color",_.color)}}function Ut(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"button",21),s.qCj("click",function(){s.usT(_);const Q=s.GaO(2);return s.CGJ(Q.edit.emit(Q.context))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"edit"),s.C$Y()()}if(2&ne){const _=s.GaO(2);s.E7m("color",_.color)("matTooltip",s.kDX(1,2,"igo.context.contextManager.edit"))}}function ei(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"button",22),s.qCj("click",function(){s.usT(_);const Q=s.GaO(2);return s.CGJ(Q.hide.emit(Q.context))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"visibility"),s.C$Y()()}if(2&ne){const _=s.GaO(2);s.E7m("color",_.color)("matTooltip",s.kDX(1,2,"igo.context.contextManager.hide"))}}function Xt(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"button",22),s.qCj("click",function(){s.usT(_);const Q=s.GaO(2);return s.CGJ(Q.show.emit(Q.context))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"visibility_off"),s.C$Y()()}if(2&ne){const _=s.GaO(2);s.E7m("color",_.color)("matTooltip",s.kDX(1,2,"igo.context.contextManager.show"))}}function De(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"button",23),s.qCj("click",function(){s.usT(_);const Q=s.GaO(2);return s.CGJ(Q.delete.emit(Q.context))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"delete"),s.C$Y()()}2&ne&&s.E7m("matTooltip",s.kDX(1,1,"igo.context.contextManager.delete"))}function et(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"div",8),s.yuY(1,Ro,4,4,"button",9),s.I0R(2,"div",10,11),s.yuY(4,xt,4,4,"button",12)(5,zt,4,4,"button",13)(6,Ut,4,4,"button",14)(7,ei,4,4,"button",15)(8,Xt,4,4,"button",15)(9,De,4,3,"button",16),s.C$Y(),s.I0R(10,"button",17),s.qCj("click",function(){s.usT(_);const Q=s.GaO();return s.CGJ(Q.collapsed=!Q.collapsed)}),s.I0R(11,"mat-icon"),s.OEk(12,"more_horiz"),s.C$Y()()()}if(2&ne){const _=s.Gew(3),N=s.GaO();s.yG2(),s.E7m("ngIf",N.collapsed&&N.selected&&(N.context.permission===N.typePermission[N.typePermission.write]||N.context.imported)),s.yG2(3),s.E7m("ngIf",N.canShare&&!N.context.imported),s.yG2(),s.E7m("ngIf",!N.context.imported),s.yG2(),s.E7m("ngIf",N.context.permission===N.typePermission[N.typePermission.write]&&!N.context.imported),s.yG2(),s.E7m("ngIf",!N.context.hidden&&!N.context.imported),s.yG2(),s.E7m("ngIf",N.context.hidden&&!N.context.imported),s.yG2(),s.E7m("ngIf",N.context.permission===N.typePermission[N.typePermission.write]||N.context.imported),s.yG2(),s.E7m("color",N.color)("target",_)("collapsed",N.collapsed)}}const he=ne=>({"mat-list-item-light":ne});let pe=(()=>{class ne{auth;storageService;typePermission=M;color="primary";collapsed=!0;showFavorite=!0;context;default;selected;edit=new s._w7;delete=new s._w7;save=new s._w7;clone=new s._w7;hide=new s._w7;show=new s._w7;favorite=new s._w7;managePermissions=new s._w7;manageTools=new s._w7;get hidden(){return this.context.hidden}get canShare(){return!0===this.storageService.get("canShare")}constructor(_,N){this.auth=_,this.storageService=N}favoriteClick(_){this.favorite.emit(_)}static \u0275fac=function(N){return new(N||ne)(s.GI1(A.oj),s.GI1(W.yQ))};static \u0275cmp=s.In1({type:ne,selectors:[["igo-context-item"]],inputs:{showFavorite:"showFavorite",context:"context",default:"default",selected:"selected"},outputs:{edit:"edit",delete:"delete",save:"save",clone:"clone",hide:"hide",show:"show",favorite:"favorite",managePermissions:"managePermissions",manageTools:"manageTools"},standalone:!0,features:[s.UHJ],decls:6,vars:7,consts:[[1,"mat-list-item",3,"ngClass"],["matListItemAvatar","","mat-icon-button","","igoStopPropagation","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["matListItemTitle",""],["matListItemMeta","","igoStopPropagation","","class","igo-actions-container",4,"ngIf"],["matListItemAvatar","","mat-icon-button","","igoStopPropagation","","matTooltipShowDelay","500",3,"matTooltip","color","click"],[4,"ngIf"],[3,"src",4,"ngIf"],[3,"src"],["matListItemMeta","","igoStopPropagation","",1,"igo-actions-container"],["class","save-button","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],[1,"igo-actions-expand-container"],["actions",""],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["class","clone-button","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["class","edit-button","mat-icon-button","","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","hide-button","mat-icon-button","","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","delete-button","mat-icon-button","","color","warn","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","igoCollapse","",1,"actions-button",3,"color","target","collapsed","click"],["mat-icon-button","","matTooltipShowDelay","500",1,"save-button",3,"matTooltip","color","click"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","color","click"],["mat-icon-button","","matTooltipShowDelay","500",1,"clone-button",3,"matTooltip","color","click"],["mat-icon-button","","matTooltipShowDelay","500",1,"edit-button",3,"color","matTooltip","click"],["mat-icon-button","","matTooltipShowDelay","500",1,"hide-button",3,"color","matTooltip","click"],["mat-icon-button","","color","warn","matTooltipShowDelay","500",1,"delete-button",3,"matTooltip","click"]],template:function(N,Q){1&N&&(s.I0R(0,"mat-list-item",0),s.yuY(1,Ho,4,6,"button",1)(2,qo,4,4,"button",1),s.I0R(3,"span",2),s.OEk(4),s.C$Y(),s.yuY(5,et,13,10,"div",3),s.C$Y()),2&N&&(s.E7m("ngClass",s.S45(5,he,Q.hidden)),s.yG2(),s.E7m("ngIf",Q.auth.authenticated),s.yG2(),s.E7m("ngIf",!Q.auth.authenticated&&Q.showFavorite),s.yG2(2),s.cNF(Q.context.title),s.yG2(),s.E7m("ngIf",Q.auth.authenticated))},dependencies:[mt.iI,mt.g9,mt.EV,mt.UV,mt.At,C.QF,C.u_,d.oJ,d.um,y.mw,Ze.KO,Ze.a4,Ke.oB,Ke.qL,y.mK,x._s,Ft.sD],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-actions-container[_ngcontent-%COMP%]{flex-shrink:0}[_nghost-%COMP%]   .igo-actions-expand-container[_ngcontent-%COMP%]{display:inline-flex}[_nghost-%COMP%]   mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}[_nghost-%COMP%]   button[matlistitemavatar][_ngcontent-%COMP%]{margin-right:8px}"],changeDetection:0})}return ne})();var Pe=r(58539),$e=r(87848),ut=r(23680),st=r(43451),Wt=r(25376),xe=r(40600);let $t=(()=>{class ne{dialogRef;title;constructor(_){this.dialogRef=_}static \u0275fac=function(N){return new(N||ne)(s.GI1(xe.yI))};static \u0275cmp=s.In1({type:ne,selectors:[["igo-bookmark-dialog"]],standalone:!0,features:[s.UHJ],decls:14,vars:14,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],["matInput","","required","","autocomplete","off","maxlength","128",3,"placeholder","ngModel","ngModelChange"],["mat-dialog-actions",""],["mat-button","","color","primary",3,"disabled","click"],["mat-button","",3,"click"]],template:function(N,Q){1&N&&(s.I0R(0,"h1",0),s.OEk(1),s.wVc(2,"translate"),s.C$Y(),s.I0R(3,"div",1)(4,"mat-form-field")(5,"input",2),s.iHE("ngModelChange",function(Te){return s.kNx(Q.title,Te)||(Q.title=Te),Te}),s.wVc(6,"translate"),s.C$Y()()(),s.I0R(7,"div",3)(8,"button",4),s.qCj("click",function(){return Q.dialogRef.close(Q.title)}),s.OEk(9),s.wVc(10,"translate"),s.C$Y(),s.I0R(11,"button",5),s.qCj("click",function(){return Q.dialogRef.close(!1)}),s.OEk(12),s.wVc(13,"translate"),s.C$Y()()),2&N&&(s.yG2(),s.oRS(" ",s.kDX(2,6,"igo.context.bookmarkButton.dialog.title"),"\n"),s.yG2(4),s.E7m("placeholder",s.kDX(6,8,"igo.context.bookmarkButton.dialog.placeholder")),s.OKB("ngModel",Q.title),s.yG2(3),s.E7m("disabled",!Q.title),s.yG2(),s.oRS(" ",s.kDX(10,10,"igo.common.confirmDialog.confirmBtn")," "),s.yG2(3),s.oRS(" ",s.kDX(13,12,"igo.common.confirmDialog.cancelBtn")," "))},dependencies:[xe.WQ,xe.iU,f.wb,f.Up,h.cN,h.yi,e.y,e.ot,e.ue,e.eJ,e.Mj,e._G,xe.Yp,d.oJ,d.Gw,x._s,Ft.sD],encapsulation:2})}return ne})();var to=function(ne){return ne.always="always",ne.never="never",ne.default="default",ne}(to||{});function Ot(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"button",17),s.qCj("click",function(){s.usT(_);const Q=s.GaO(2);return s.CGJ(Q.clearFilter())}),s.I0R(1,"mat-icon"),s.OEk(2,"close"),s.C$Y()()}}function kt(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"mat-form-field",14)(1,"mat-label"),s.OEk(2),s.wVc(3,"translate"),s.C$Y(),s.I0R(4,"input",15),s.iHE("ngModelChange",function(Q){s.usT(_);const Ce=s.GaO();return s.kNx(Ce.term,Q)||(Ce.term=Q),s.CGJ(Q)}),s.wVc(5,"translate"),s.C$Y(),s.yuY(6,Ot,3,0,"button",16),s.C$Y()}if(2&ne){const _=s.GaO();s.yG2(2),s.cNF(s.kDX(3,4,"igo.context.contextManager.filterPlaceHolder")),s.yG2(2),s.E7m("placeholder",s.kDX(5,6,"igo.context.contextManager.filterPlaceHolder")),s.OKB("ngModel",_.term),s.yG2(2),s.E7m("ngIf",_.term.length)}}function yt(ne,We){if(1&ne&&s.wR5(0,"igo-actionbar",18),2&ne){const _=s.GaO();s.E7m("iconColor",_.color)("store",_.actionStore)("withIcon",!0)("withTitle","overlay"===_.actionbarMode)("horizontal",!1)("mode",_.actionbarMode)}}function Gt(ne,We){if(1&ne&&(s.I0R(0,"button",19),s.wVc(1,"translate"),s.I0R(2,"mat-icon",5),s.OEk(3,"fitler_alt"),s.C$Y()()),2&ne){s.GaO();const _=s.Gew(11);s.E7m("matTooltip",s.kDX(1,2,"igo.context.contextManager.filterUser"))("matMenuTriggerFor",_)}}function zo(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"button",10)(1,"mat-checkbox",22),s.qCj("click",function(Q){return Q.stopPropagation()})("change",function(){s.usT(_);const Q=s.GaO().$implicit,Ce=s.GaO();return s.CGJ(Ce.handleToggleCategory(Q))}),s.C$Y(),s.I0R(2,"span"),s.OEk(3),s.C$Y()()}if(2&ne){const _=s.GaO().$implicit,N=s.GaO();s.yG2(),s.E7m("checked",N.getPermission(_).checked)("indeterminate",N.getPermission(_).indeterminate),s.yG2(2),s.cNF(_.title)}}function Vn(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"button",10)(1,"mat-checkbox",11),s.qCj("click",function(Q){return Q.stopPropagation()})("change",function(){const Ce=s.usT(_).$implicit,Te=s.GaO(2).$implicit,Ne=s.GaO();return s.CGJ(Ne.handleToggleCategory(Ce,Te))}),s.OEk(2),s.C$Y()()}if(2&ne){const _=We.$implicit,N=s.GaO(3);s.yG2(),s.E7m("checked",N.getPermission(_).checked),s.yG2(),s.oRS(" ",_.title," ")}}function vo(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"button",23)(1,"mat-checkbox",22),s.qCj("click",function(Q){return Q.stopPropagation()})("change",function(){s.usT(_);const Q=s.GaO().$implicit,Ce=s.GaO();return s.CGJ(Ce.handleToggleCategory(Q))}),s.C$Y(),s.I0R(2,"span"),s.OEk(3),s.C$Y()(),s.I0R(4,"mat-menu",null,24),s.yuY(6,Vn,3,2,"button",25),s.C$Y()}if(2&ne){const _=s.Gew(5),N=s.GaO().$implicit,Q=s.GaO();s.E7m("matMenuTriggerFor",_),s.yG2(),s.E7m("checked",Q.getPermission(N).checked)("indeterminate",Q.getPermission(N).indeterminate),s.yG2(2),s.cNF(N.title),s.yG2(3),s.E7m("ngForOf",N.childs)}}function sn(ne,We){if(1&ne&&(s.SAx(0),s.yuY(1,zo,4,3,"button",20)(2,vo,7,5,"ng-template",null,21,s.gJz),s.k70()),2&ne){const _=We.$implicit,N=s.Gew(3);s.yG2(),s.E7m("ngIf",!_.childs)("ngIfElse",N)}}function Oi(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"igo-context-item",29),s.qCj("edit",function(){const Ce=s.usT(_).$implicit,Te=s.GaO(3);return s.CGJ(Te.edit.emit(Ce))})("delete",function(){const Ce=s.usT(_).$implicit,Te=s.GaO(3);return s.CGJ(Te.delete.emit(Ce))})("clone",function(){const Ce=s.usT(_).$implicit,Te=s.GaO(3);return s.CGJ(Te.clone.emit(Ce))})("save",function(){const Ce=s.usT(_).$implicit,Te=s.GaO(3);return s.CGJ(Te.save.emit(Ce))})("hide",function(){const Ce=s.usT(_).$implicit,Te=s.GaO(3);return s.CGJ(Te.hideContext(Ce))})("show",function(){const Ce=s.usT(_).$implicit,Te=s.GaO(3);return s.CGJ(Te.showContext(Ce))})("favorite",function(){const Ce=s.usT(_).$implicit,Te=s.GaO(3);return s.CGJ(Te.favorite.emit(Ce))})("manageTools",function(){const Ce=s.usT(_).$implicit,Te=s.GaO(3);return s.CGJ(Te.manageTools.emit(Ce))})("managePermissions",function(){const Ce=s.usT(_).$implicit,Te=s.GaO(3);return s.CGJ(Te.managePermissions.emit(Ce))})("select",function(){const Ce=s.usT(_).$implicit,Te=s.GaO(3);return s.CGJ(Te.select.emit(Ce))})("unselect",function(){const Ce=s.usT(_).$implicit,Te=s.GaO(3);return s.CGJ(Te.unselect.emit(Ce))}),s.C$Y()}if(2&ne){const _=We.$implicit,N=s.GaO(3);s.E7m("selected",N.selectedContext&&N.selectedContext.uri===_.uri)("context",_)("default",_.id&&N.defaultContextId&&N.defaultContextId===_.id)}}function an(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"igo-collapsible",28),s.qCj("toggle",function(Q){s.usT(_);const Ce=s.GaO().$implicit,Te=s.GaO();return s.CGJ(Te.collapsed[Te.titleMapping[Ce.key]]=Q)}),s.wVc(1,"translate"),s.yuY(2,Oi,1,3,"ng-template",12),s.C$Y()}if(2&ne){const _=s.GaO().$implicit,N=s.GaO();s.E7m("title",s.kDX(1,3,N.titleMapping[_.key]))("collapsed",N.collapsed[N.titleMapping[_.key]]),s.yG2(2),s.E7m("ngForOf",_.value)}}function ti(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"igo-context-item",30),s.qCj("favorite",function(){const Ce=s.usT(_).$implicit,Te=s.GaO(3);return s.CGJ(Te.favorite.emit(Ce))})("select",function(){const Ce=s.usT(_).$implicit,Te=s.GaO(3);return s.CGJ(Te.select.emit(Ce))})("unselect",function(){const Ce=s.usT(_).$implicit,Te=s.GaO(3);return s.CGJ(Te.unselect.emit(Ce))}),s.C$Y()}if(2&ne){const _=We.$implicit,N=s.GaO(3);s.E7m("showFavorite",N.configService.getConfig("favoriteContext4NonAuthenticated"))("selected",N.selectedContext&&N.selectedContext.uri===_.uri)("context",_)("default",N.contextConfigs?N.defaultContextId===_.id:N.defaultContextId===_.uri)}}function oi(ne,We){if(1&ne&&s.yuY(0,ti,1,4,"ng-template",12),2&ne){const _=s.GaO().$implicit;s.E7m("ngForOf",_.value)}}function ii(ne,We){if(1&ne&&s.yuY(0,an,3,5,"igo-collapsible",26)(1,oi,1,1,null,27),2&ne){const _=We.$implicit,N=s.GaO();s.E7m("ngIf",_.value.length&&N.auth.authenticated),s.yG2(),s.E7m("ngIf",_.value.length&&!N.auth.authenticated)}}function ni(ne,We){1&ne&&(s.I0R(0,"div",31),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&ne&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.contextManager.noResult")," "))}let ri=(()=>{class ne{cdRef;configService;auth;dialog;languageService;storageService;contextConfigs;contextsInitial={ours:[]};contexts$=new a.g(this.contextsInitial);change$=new ut.o(1);change$$;get contexts(){return this._contexts}set contexts(_){this._contexts=_,this.next()}_contexts={ours:[]};selectedContext;map;get defaultContextId(){return this.contextConfigs?this._defaultContextId:this.storageService.get("favorite.context.uri")||this._defaultContextId}set defaultContextId(_){this._defaultContextId=_}_defaultContextId;collapsed=[];select=new s._w7;unselect=new s._w7;edit=new s._w7;delete=new s._w7;save=new s._w7;clone=new s._w7;create=new s._w7;hide=new s._w7;show=new s._w7;showHiddenContexts=new s._w7;favorite=new s._w7;managePermissions=new s._w7;manageTools=new s._w7;filterPermissionsChanged=new s._w7;titleMapping={ours:"igo.context.contextManager.ourContexts",shared:"igo.context.contextManager.sharedContexts",public:"igo.context.contextManager.publicContexts"};users;permissions=[];actionStore=new y.MF([]);actionbarMode=y.m0.Overlay;color="primary";showHidden=!1;set term(_){this._term=_,this.next()}get term(){return this._term}_term="";get sortedAlpha(){return this._sortedAlpha}set sortedAlpha(_){this._sortedAlpha=_,this.next()}_sortedAlpha=void 0;showContextFilter=to.always;thresholdToFilter=5;get isEmpty(){return!this.contexts.ours.length&&!this.contexts.public?.length&&!this.contexts.shared?.length}constructor(_,N,Q,Ce,Te,Ne){this.cdRef=_,this.configService=N,this.auth=Q,this.dialog=Ce,this.languageService=Te,this.storageService=Ne,this.contextConfigs=this.configService.getConfig("context")}ngOnInit(){this.change$$=this.change$.pipe((0,Wt.C)(()=>(0,st.k)(50))).subscribe(()=>{this.contexts$.next(this.filterContextsList(this.contexts))}),this.actionStore.load([{id:"emptyContext",title:this.languageService.translate.instant("igo.context.contextManager.emptyContext"),icon:"star",tooltip:this.languageService.translate.instant("igo.context.contextManager.emptyContextTooltip"),handler:()=>{this.createContext(!0)}},{id:"contextFromMap",title:this.languageService.translate.instant("igo.context.contextManager.contextMap"),icon:"map",tooltip:this.languageService.translate.instant("igo.context.contextManager.contextMapTooltip"),handler:()=>{this.createContext(!1)}}])}next(){this.change$.next()}filterContextsList(_){if(""===this.term)return this.sortedAlpha&&(_=this.sortContextsList(_)),_;{let Q={ours:_.ours.filter(Ce=>{const Te=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return Ce.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(Te)})};if(this.contexts.public){const Ce=_.public.filter(Te=>{const Ne=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return Te.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(Ne)});Q.public=Ce}if(this.contexts.shared){const Ce=_.shared.filter(Te=>{const Ne=this.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return Te.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(Ne)});Q.shared=Ce}return this.sortedAlpha&&(Q=this.sortContextsList(Q)),Q}}ngOnDestroy(){this.change$$.unsubscribe()}showFilter(){switch(this.showContextFilter){case to.always:return!0;case to.never:return!1;default:let _=this.contexts.ours.length;return _+=this.contexts.public?this.contexts.public.length:0,_+=this.contexts.shared?this.contexts.shared.length:0,_>=this.thresholdToFilter}}sortContextsList(_){if(_){const N=JSON.parse(JSON.stringify(_));return N.ours.sort((Q,Ce)=>this.normalize(Q.title)<this.normalize(Ce.title)?-1:this.normalize(Q.title)>this.normalize(Ce.title)?1:0),N.shared?N.shared.sort((Q,Ce)=>this.normalize(Q.title)<this.normalize(Ce.title)?-1:this.normalize(Q.title)>this.normalize(Ce.title)?1:0):N.public&&N.public.sort((Q,Ce)=>this.normalize(Q.title)<this.normalize(Ce.title)?-1:this.normalize(Q.title)>this.normalize(Ce.title)?1:0),N}}normalize(_){return _.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}toggleSort(){this.sortedAlpha=!this.sortedAlpha}clearFilter(){this.term=""}createContext(_){this.dialog.open($t,{disableClose:!1}).afterClosed().pipe((0,F.U)(1)).subscribe(N=>{N&&this.create.emit({title:N,empty:_})})}getPermission(_){if(_)return this.permissions.find(Q=>Q.name===_.name)}handleToggleCategory(_,N){const Q=this.getPermission(_);if(Q&&(Q.checked=!Q.checked,this.storageService.set("contexts.permissions."+Q.name,Q.checked),Q.indeterminate=!1),N){let Ce=!1;for(const Ne of N.childs)if(this.getPermission(Ne).checked!==Q.checked){Ce=!0;break}const Te=this.getPermission(N);Te&&(Te.checked=Q.checked,this.storageService.set("contexts.permissions."+Te.name,Q.checked),Te.indeterminate=Ce)}if(_.childs)for(const Ce of _.childs){const Te=this.getPermission(Ce);Te&&Te.checked!==Q.checked&&(Te.checked=Q.checked,this.storageService.set("contexts.permissions."+Te.name,Q.checked))}this.filterPermissionsChanged.emit(this.permissions)}hideContext(_){if(_.hidden=!0,!this.showHidden){const N={ours:[],shared:[],public:[]};N.ours=this.contexts.ours.filter(Q=>Q.id!==_.id),N.shared=this.contexts.shared.filter(Q=>Q.id!==_.id),N.public=this.contexts.public.filter(Q=>Q.id!==_.id),this.contexts=N}this.hide.emit(_)}showContext(_){_.hidden=!1,this.show.emit(_)}static \u0275fac=function(N){return new(N||ne)(s.GI1(s.kD9),s.GI1(O.aW),s.GI1(A.oj),s.GI1(xe.qW),s.GI1(x.ov),s.GI1(W.yQ))};static \u0275cmp=s.In1({type:ne,selectors:[["igo-context-list"]],inputs:{contexts:"contexts",selectedContext:"selectedContext",map:"map",defaultContextId:"defaultContextId",term:"term"},outputs:{select:"select",unselect:"unselect",edit:"edit",delete:"delete",save:"save",clone:"clone",create:"create",hide:"hide",show:"show",showHiddenContexts:"showHiddenContexts",favorite:"favorite",managePermissions:"managePermissions",manageTools:"manageTools",filterPermissionsChanged:"filterPermissionsChanged"},standalone:!0,features:[s.UHJ],decls:22,vars:20,consts:[[3,"navigation"],[1,"context-filter-container"],["floatLabel","always",4,"ngIf"],[1,"actions-container"],["mat-icon-button","","matTooltipShowDelay","500",1,"sort-alpha",3,"matTooltip","click"],["color","primary"],["class","add-context-button","icon","add",3,"iconColor","store","withIcon","withTitle","horizontal","mode",4,"ngIf"],["class","users-filter","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","matMenuTriggerFor",4,"ngIf"],["accountMenu","matMenu"],[4,"ngFor","ngForOf"],["mat-menu-item","",1,"profil-menu"],[3,"checked","click","change"],["ngFor","",3,"ngForOf"],["class","no-result",4,"ngIf"],["floatLabel","always"],["matInput","","type","text",3,"placeholder","ngModel","ngModelChange"],["mat-icon-button","","matSuffix","","class","clear-button","aria-label","Clear","color","warn",3,"click",4,"ngIf"],["mat-icon-button","","matSuffix","","aria-label","Clear","color","warn",1,"clear-button",3,"click"],["icon","add",1,"add-context-button",3,"iconColor","store","withIcon","withTitle","horizontal","mode"],["mat-icon-button","","matTooltipShowDelay","500",1,"users-filter",3,"matTooltip","matMenuTriggerFor"],["mat-menu-item","","class","profil-menu",4,"ngIf","ngIfElse"],["withSubMenu",""],[3,"checked","indeterminate","click","change"],["mat-menu-item","",1,"profil-menu",3,"matMenuTriggerFor"],["subAccountMenu","matMenu"],["mat-menu-item","","class","profil-menu",4,"ngFor","ngForOf"],[3,"title","collapsed","toggle",4,"ngIf"],[4,"ngIf"],[3,"title","collapsed","toggle"],["igoListItem","","color","accent",3,"selected","context","default","edit","delete","clone","save","hide","show","favorite","manageTools","managePermissions","select","unselect"],["igoListItem","","color","accent",3,"showFavorite","selected","context","default","favorite","select","unselect"],[1,"no-result"]],template:function(N,Q){1&N&&(s.I0R(0,"igo-list",0)(1,"div",1),s.yuY(2,kt,7,8,"mat-form-field",2),s.I0R(3,"div",3)(4,"button",4),s.qCj("click",function(){return Q.toggleSort()}),s.wVc(5,"translate"),s.I0R(6,"mat-icon",5),s.OEk(7,"sort_by_alpha"),s.C$Y()(),s.yuY(8,yt,1,6,"igo-actionbar",6)(9,Gt,4,4,"button",7),s.I0R(10,"mat-menu",null,8),s.yuY(12,sn,4,2,"ng-container",9),s.I0R(13,"button",10)(14,"mat-checkbox",11),s.qCj("click",function(Te){return Te.stopPropagation()})("change",function(){return Q.showHiddenContexts.emit()}),s.C$Y(),s.I0R(15,"span"),s.OEk(16),s.wVc(17,"translate"),s.C$Y()()()()(),s.yuY(18,ii,2,2,"ng-template",12),s.wVc(19,"keyvalue"),s.wVc(20,"async"),s.yuY(21,ni,3,3,"div",13),s.C$Y()),2&N&&(s.E7m("navigation",!0),s.yG2(2),s.E7m("ngIf",Q.showFilter()),s.yG2(2),s.eAK("--active",Q.sortedAlpha),s.E7m("matTooltip",s.kDX(5,12,"igo.context.contextManager.sortAlphabetically")),s.yG2(4),s.E7m("ngIf",Q.auth.authenticated&&Q.contextConfigs),s.yG2(),s.E7m("ngIf",Q.auth.authenticated&&Q.contextConfigs),s.yG2(3),s.E7m("ngForOf",Q.users),s.yG2(2),s.E7m("checked",Q.showHidden),s.yG2(2),s.oRS(" ",s.kDX(17,14,"igo.context.contextManager.showHidden")," "),s.yG2(2),s.E7m("ngForOf",s.kDX(19,16,s.kDX(20,18,Q.contexts$))),s.yG2(3),s.E7m("ngIf",Q.isEmpty))},dependencies:[y.yM,C.u_,f.wb,f.Up,f.w5,f.Gm,h.cN,h.yi,e.y,e.ot,e.ue,e._G,d.oJ,d.um,Ke.oB,Ke.qL,Ze.KO,Ze.a4,y.AI,$e._A,$e.aM,$e.OQ,$e.yG,C.Iw,Pe.Vn,Pe.WK,y.ii,pe,y.qU,C.a,C.uq,x._s,Ft.sD],styles:["[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}.context-filter-container[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 4px}.context-filter-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.sort-alpha.--active[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:red}.context-filter-min-width[_ngcontent-%COMP%]{width:calc(100% - 135px);margin:5px;padding-left:6px}.profil-menu[_ngcontent-%COMP%]{padding-left:8px}.profil-menu[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin-right:8px}.add-context-button[_ngcontent-%COMP%]{margin:0;width:40px;display:inline-flex;overflow:hidden}.actions-container[_ngcontent-%COMP%]{margin-left:4px}.no-result[_ngcontent-%COMP%]{padding:16px}"],changeDetection:0})}return ne})();var Lo=r(69400),si=r(21232);function Ii(ne,We){1&ne&&(s.I0R(0,"div",3)(1,"h4"),s.OEk(2),s.wVc(3,"translate"),s.C$Y(),s.I0R(4,"p"),s.OEk(5),s.wVc(6,"translate"),s.C$Y()()),2&ne&&(s.yG2(2),s.cNF(s.kDX(3,2,"igo.context.permission.readOnlyTitle")),s.yG2(3),s.cNF(s.kDX(6,4,"igo.context.permission.readOnlyMsg")))}function wi(ne,We){1&ne&&(s.I0R(0,"mat-radio-button",8),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&ne&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.permission.scope.public")," "))}function Ui(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"div",3)(1,"mat-radio-group",4),s.iHE("ngModelChange",function(Q){s.usT(_);const Ce=s.GaO(2);return s.kNx(Ce.context.scope,Q)||(Ce.context.scope=Q),s.CGJ(Q)}),s.qCj("change",function(){s.usT(_);const Q=s.GaO(2);return s.CGJ(Q.scopeChanged.emit(Q.context))}),s.I0R(2,"mat-radio-button",5),s.OEk(3),s.wVc(4,"translate"),s.C$Y(),s.I0R(5,"mat-radio-button",6),s.OEk(6),s.wVc(7,"translate"),s.C$Y(),s.yuY(8,wi,3,3,"mat-radio-button",7),s.C$Y()()}if(2&ne){const _=s.GaO(2);s.yG2(),s.OKB("ngModel",_.context.scope),s.yG2(2),s.oRS(" ",s.kDX(4,4,"igo.context.permission.scope.private")," "),s.yG2(3),s.oRS(" ",s.kDX(7,6,"igo.context.permission.scope.shared")," "),s.yG2(2),s.E7m("ngIf",_.authService.isAdmin)}}function Ao(ne,We){if(1&ne&&(s.I0R(0,"mat-option",20),s.OEk(1),s.wR5(2,"br"),s.I0R(3,"small",21),s.OEk(4),s.C$Y()()),2&ne){const _=We.$implicit;s.E7m("value",_),s.yG2(),s.oRS(" ",_.title,""),s.yG2(3),s.cNF(_.name)}}function mo(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"form",9),s.qCj("ngSubmit",function(){s.usT(_);const Q=s.GaO(2);return s.CGJ(Q.handleFormSubmit(Q.form.value))}),s.I0R(1,"mat-form-field",10),s.wR5(2,"input",11),s.wVc(3,"translate"),s.I0R(4,"mat-autocomplete",12,13),s.qCj("optionSelected",function(Q){s.usT(_);const Ce=s.GaO(2);return s.CGJ(Ce.onProfilSelected(Q.option.value))}),s.yuY(6,Ao,5,3,"mat-option",14),s.C$Y(),s.I0R(7,"mat-error"),s.OEk(8),s.wVc(9,"translate"),s.C$Y()(),s.I0R(10,"mat-radio-group",15)(11,"mat-radio-button",16),s.OEk(12),s.wVc(13,"translate"),s.C$Y(),s.I0R(14,"mat-radio-button",17),s.OEk(15),s.wVc(16,"translate"),s.C$Y()(),s.I0R(17,"div",18)(18,"button",19),s.OEk(19),s.wVc(20,"translate"),s.C$Y()()()}if(2&ne){const _=s.Gew(5),N=s.GaO(2);s.E7m("formGroup",N.form),s.yG2(2),s.E7m("placeholder",s.kDX(3,11,"igo.context.permission.user"))("formControl",N.formControl)("matAutocomplete",_),s.yG2(2),s.E7m("displayWith",N.displayFn),s.yG2(2),s.E7m("ngForOf",N.profils),s.yG2(2),s.oRS(" ",s.kDX(9,13,"igo.context.permission.profilRequired")," "),s.yG2(4),s.oRS(" ",s.kDX(13,15,"igo.context.permission.read")," "),s.yG2(3),s.oRS(" ",s.kDX(16,17,"igo.context.permission.write")," "),s.yG2(3),s.E7m("disabled",!N.form.valid),s.yG2(),s.oRS(" ",s.kDX(20,19,"igo.context.permission.addBtn")," ")}}function Bt(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"button",29),s.qCj("click",function(){s.usT(_);const Q=s.GaO().$implicit,Ce=s.GaO(5);return s.CGJ(Ce.removePermission.emit(Q))}),s.wVc(1,"translate"),s.I0R(2,"mat-icon"),s.OEk(3,"delete"),s.C$Y()()}2&ne&&s.E7m("matTooltip",s.kDX(1,1,"igo.context.permission.delete"))}function ho(ne,We){if(1&ne&&(s.I0R(0,"mat-list-item")(1,"mat-icon",25),s.OEk(2,"person"),s.C$Y(),s.I0R(3,"h4",26),s.OEk(4),s.I0R(5,"small",21),s.OEk(6),s.C$Y()(),s.I0R(7,"div",27),s.yuY(8,Bt,4,3,"button",28),s.C$Y()()),2&ne){const _=We.$implicit,N=s.GaO(5);s.yG2(4),s.oRS(" ",_.profilTitle," "),s.yG2(2),s.cNF(_.profil),s.yG2(2),s.E7m("ngIf",N.canWrite||_.profil===N.authService.decodeToken().user.sourceId)}}function ai(ne,We){if(1&ne&&(s.I0R(0,"igo-collapsible",24),s.wVc(1,"translate"),s.yuY(2,ho,9,3,"ng-template",22),s.C$Y()),2&ne){const _=s.GaO().$implicit;s.E7m("title",s.kDX(1,2,"igo.context.permission."+_.key)),s.yG2(2),s.E7m("ngForOf",_.value)}}function Ti(ne,We){1&ne&&s.yuY(0,ai,3,4,"igo-collapsible",23),2&ne&&s.E7m("ngIf",We.$implicit.value.length)}function Bo(ne,We){if(1&ne&&(s.I0R(0,"igo-list"),s.yuY(1,Ti,1,1,"ng-template",22),s.wVc(2,"keyvalue"),s.C$Y()),2&ne){const _=s.GaO(2);s.yG2(),s.E7m("ngForOf",s.kDX(2,1,_.permissions))}}function co(ne,We){if(1&ne&&(s.I0R(0,"div"),s.yuY(1,Ii,7,6,"div",1)(2,Ui,9,8,"div",1)(3,mo,21,21,"form",2)(4,Bo,3,3,"igo-list",0),s.C$Y()),2&ne){const _=s.GaO();s.yG2(),s.E7m("ngIf",!_.canWrite),s.yG2(),s.E7m("ngIf",_.canWrite),s.yG2(),s.E7m("ngIf","private"!==_.context.scope&&_.canWrite),s.yG2(),s.E7m("ngIf",_.permissions&&"private"!==_.context.scope)}}let Yi=(()=>{class ne{formBuilder;cd;http;authService;config;form;get context(){return this._context}set context(_){this._context=_,this.cd.detectChanges()}_context;get permissions(){return this._permissions}set permissions(_){this._permissions=_,this.cd.detectChanges()}_permissions;get profils(){return this._profils}set profils(_){this._profils=_,this.cd.detectChanges()}_profils=[];get canWrite(){return this.context.permission===M[M.write]}baseUrlProfils;formControl=new e.yM;formValueChanges$$;addPermission=new s._w7;removePermission=new s._w7;scopeChanged=new s._w7;constructor(_,N,Q,Ce,Te){this.formBuilder=_,this.cd=N,this.http=Q,this.authService=Ce,this.config=Te}ngOnInit(){this.buildForm(),this.baseUrlProfils=this.config.getConfig("context.url")+"/profils-users?",this.formValueChanges$$=this.formControl.valueChanges.subscribe(_=>{_.length?(this.http.get(this.baseUrlProfils+"q="+_).subscribe(N=>{this.profils=N}),this.profils.filter(N=>{const Q=_.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),Ce=N.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return(N.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")+Ce).includes(Q)})):this.profils=[]})}displayFn(_){return _?_.title:void 0}handleFormSubmit(_){this.addPermission.emit(_)}buildForm(){this.form=this.formBuilder.group({profil:[],typePermission:["read"]})}onProfilSelected(_){this.form.setValue({profil:_.name,typePermission:this.form.value.typePermission})}static \u0275fac=function(N){return new(N||ne)(s.GI1(e.KE),s.GI1(s.kD9),s.GI1(ie.KK),s.GI1(A.oj),s.GI1(O.aW))};static \u0275cmp=s.In1({type:ne,selectors:[["igo-context-permissions"]],inputs:{context:"context",permissions:"permissions"},outputs:{addPermission:"addPermission",removePermission:"removePermission",scopeChanged:"scopeChanged"},standalone:!0,features:[s.UHJ],decls:1,vars:1,consts:[[4,"ngIf"],["class","scopeForm",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"scopeForm"],[3,"ngModel","ngModelChange","change"],["value","private"],["value","protected"],["value","public",4,"ngIf"],["value","public"],[3,"formGroup","ngSubmit"],[1,"full-width"],["matInput","","required","",3,"placeholder","formControl","matAutocomplete"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["formControlName","typePermission"],["value","read"],["value","write"],[1,"igo-form-button-group"],["mat-raised-button","","type","submit",3,"disabled"],[3,"value"],[1,"mat-typography"],["ngFor","",3,"ngForOf"],[3,"title",4,"ngIf"],[3,"title"],["matListItemIcon",""],["matListItemTitle",""],["matListItemMeta","","igoStopPropagation","",1,"igo-actions-container"],["mat-icon-button","","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"]],template:function(N,Q){1&N&&s.yuY(0,co,5,4,"div",0),2&N&&s.E7m("ngIf",Q.context)},dependencies:[C.u_,si.yk,si.cv,si.cT,e.y,e.sz,e.ot,e.ue,e.u,e.eJ,e._G,e.sl,e.ug,e.uW,e.Wo,f.wb,f.Up,f.wJ,h.cN,h.yi,Lo.U1,Lo.e,P.I5,Lo.cG,C.Iw,P.Ax,d.oJ,d.Gw,d.um,y.yM,y.ii,mt.iI,mt.g9,mt.Y1,mt.UV,mt.At,Ke.oB,Ke.qL,y.mw,Ze.KO,Ze.a4,C.uq,x._s,Ft.sD],styles:["[_nghost-%COMP%]{margin:10px}.full-width[_ngcontent-%COMP%]{width:100%}mat-radio-button[_ngcontent-%COMP%]{padding:14px 14px 14px 0}.scopeForm[_ngcontent-%COMP%], form[_ngcontent-%COMP%]{padding:5px}"]})}return ne})();r(44876),r(61252),r(54584),r(53291);let Io=(()=>{class ne{contextService;route;language="";constructor(_,N){this.contextService=_,this.route=N,this.route.queryParams.subscribe(Q=>{Q.lang&&(this.language=Q.lang)})}getUrlWithApi(_){return this.language?`${location.origin+location.pathname}?context=${_.uri}&lang=${this.language}`:`${location.origin+location.pathname}?context=${_.uri}`}createContextShared(_,N){const Q=this.contextService.getContextFromMap(_);return Q.scope="public",Q.title=N.title,Q.uri=N.uri,this.contextService.create(Q)}updateContextShared(_,N,Q){const Ce=this.contextService.getContextFromMap(_);return this.contextService.update(Q,{title:N.title,map:Ce.map})}getUrlWithoutApi(_,N){if(!(this.route&&this.route.options.visibleOnLayersKey&&this.route.options.visibleOffLayersKey&&_.viewController.getZoom()))return;const Q=N.layerlistControls.querystring;let Ce=this.route.options.visibleOnLayersKey,Te=this.route.options.visibleOffLayersKey;const Ne=_.layers,gt=Ne.filter(no=>no.visible&&!no.isIgoInternalLayer),It=Ne.filter(no=>!no.visible&&!no.isIgoInternalLayer);0===gt.length&&(Ce=""),0===It.length&&(Te="");let it="",At=[];gt.length>It.length?(it=`${Ce}=*&${Te}=`,At=It):(it=`${Te}=*&${Ce}=`,At=gt);for(const no of At)no.id&&(it+=no.id+",");const Dt=[],eo=this.contextService.context$.value.layers;for(const no of eo)(typeof no.id<"u"||typeof no.source<"u")&&Dt.push(no.id||no.source.id);const Qt=this.makeLayersByService(Ne,Dt,"wms"),wo=this.makeLayersByService(Ne,Dt,"wmts"),Jo=this.makeLayersByService(Ne,Dt,"arcgisrest"),xn=this.makeLayersByService(Ne,Dt,"imagearcgisrest"),hi=this.makeLayersByService(Ne,Dt,"tilearcgisrest");it=it.substr(0,it.length-1);const Dn=this.route.options.centerKey,Li=this.route.options.contextKey,Ji=`${this.route.options.zoomKey}=${_.viewController.getZoom()}`,Qi=_.viewController.getCenter("EPSG:4326")||[],Pn=`${Dn}=${Qi[0].toFixed(5).replace(/\.([^0]+)0+$/,".$1")},${Qi[1].toFixed(5).replace(/\.([^0]+)0+$/,".$1")}`.replace(/.00000/g,"");let fi="";this.contextService.context$.value&&(fi=`${Li}=${this.contextService.context$.value.uri}`);let uo=this.language?`${location.origin}${location.pathname}?${fi}&${Ji}&${Pn}&${it}&${Q}&${Qt}&${Q}&${wo}&${Jo}&${xn}&${hi}&lang=${this.language}`:`${location.origin}${location.pathname}?${fi}&${Ji}&${Pn}&${it}&${Q}&${Qt}&${Q}&${wo}&${Jo}&${xn}&${hi}`;for(let no=0;no<5;no++)uo=uo.replace(/&&/g,"&"),uo=uo.endsWith("&")?uo.slice(0,-1):uo;return uo=uo.endsWith("&")?uo.slice(0,-1):uo,uo=uo.replace("?&wm","&wm"),uo=uo.replace("?&","?"),uo}makeLayersByService(_,N,Q){const Ce=[];for(const Ne of _.filter(gt=>gt.dataSource.options?.type===Q))if(-1===N.indexOf(Ne.id)){let it,gt=encodeURIComponent(Ne.dataSource.options.url),It="";switch(Ne.dataSource.options.type.toLowerCase()){case"wms":const eo=Ne.dataSource.options;It=encodeURIComponent(eo.params.LAYERS),it="1.3.0"===eo.params.VERSION?it:eo.params.VERSION;break;case"wmts":case"arcgisrest":case"imagearcgisrest":case"tilearcgisrest":It=encodeURIComponent(Ne.dataSource.options.layer)}const At=`${It}:igoz${Ne.zIndex}`;let Dt="";if(it){const eo=-1===Ne.dataSource.options.url.indexOf("?")?"?":"&";Dt=encodeURIComponent(`${eo}VERSION=${it}`)}gt=`${gt}${Dt}`,Ce.find(eo=>eo.url===gt)?Ce.forEach(eo=>{eo.url===gt&&eo.layers.push(At)}):Ce.push({url:gt,layers:[At]})}let Te="";if(Ce.length>=1){let Ne,gt;switch(Q.toLowerCase()){case"wms":Ne=this.route.options.wmsUrlKey,gt=this.route.options.wmsLayersKey;break;case"wmts":Ne=this.route.options.wmtsUrlKey,gt=this.route.options.wmtsLayersKey;break;case"arcgisrest":Ne=this.route.options.arcgisUrlKey,gt=this.route.options.arcgisLayersKey;break;case"imagearcgisrest":Ne=this.route.options.iarcgisUrlKey,gt=this.route.options.iarcgisLayersKey;break;case"tilearcgisrest":Ne=this.route.options.tarcgisUrlKey,gt=this.route.options.tarcgisLayersKey;break;default:Ne="",gt=""}let It="",it="";Ce.forEach(At=>{It+=`${At.url},`,it+=`(${At.layers.join(",")}),`}),It=It.endsWith(",")?It.slice(0,-1):It,it=it.endsWith(",")?it.slice(0,-1):it,Te=`${Ne}=${It}&${gt}=${it}`}return Te}static \u0275fac=function(N){return new(N||ne)(s.CoB(de),s.CoB(k.k$,8))};static \u0275prov=s.wxM({token:ne,factory:ne.\u0275fac,providedIn:"root"})}return ne})();function ci(ne,We){if(1&ne&&(s.I0R(0,"span",11),s.OEk(1),s.C$Y()),2&ne){const _=s.GaO();s.yG2(),s.oRS("",_.userId,"-")}}function Vo(ne,We){if(1&ne&&(s.I0R(0,"button",12),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&ne){const _=s.GaO();s.E7m("disabled",!_.form.valid),s.yG2(),s.oRS(" ",s.kDX(2,2,"igo.context.shareMap.button")," ")}}function ui(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"button",13),s.qCj("click",function(){s.usT(_);const Q=s.GaO();return s.CGJ(Q.updateContextShared(Q.form.value))}),s.OEk(1),s.wVc(2,"translate"),s.C$Y()}2&ne&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.refreshBtn")," "))}function xo(ne,We){if(1&ne){const _=s.KQA();s.I0R(0,"div",14)(1,"mat-form-field"),s.wR5(2,"textarea",15,16),s.wVc(4,"translate"),s.I0R(5,"button",17),s.qCj("click",function(){s.usT(_);const Q=s.Gew(3),Ce=s.GaO();return s.CGJ(Ce.copyTextToClipboard(Q))}),s.wVc(6,"translate"),s.I0R(7,"mat-icon"),s.OEk(8,"content_copy"),s.C$Y()()(),s.wR5(9,"div"),s.C$Y()}if(2&ne){const _=s.GaO();s.yG2(2),s.E7m("placeholder",s.kDX(4,3,"igo.context.shareMap.placeholderLink"))("value",_.url),s.yG2(3),s.E7m("matTooltip",s.kDX(6,5,"igo.context.shareMap.copy"))}}let ji=(()=>{class ne{languageService;messageService;auth;shareMapService;formBuilder;form;map;url;userId;idContextShared;constructor(_,N,Q,Ce,Te){this.languageService=_,this.messageService=N,this.auth=Q,this.shareMapService=Ce,this.formBuilder=Te}ngOnInit(){this.auth.authenticate$.subscribe(_=>{const N=this.auth.decodeToken();this.userId=N?.user?.id.toString(),this.buildForm()})}createUrl(_={}){const N=Object.assign({},_);N.uri=this.userId?`${this.userId}-${_.uri}`:_.uri,this.url=this.shareMapService.getUrlWithApi(N),this.shareMapService.createContextShared(this.map,N).subscribe(Q=>{this.idContextShared=Q.id,this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:N.title})},Q=>{Q.error.title=this.languageService.translate.instant("igo.context.shareMap.errorTitle"),this.messageService.showError(Q)})}updateContextShared(_={}){const N=Object.assign({},_);N.uri=this.userId?`${this.userId}-${_.uri}`:_.uri,this.shareMapService.updateContextShared(this.map,N,this.idContextShared).subscribe(Q=>{this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:N.title})},Q=>{Q.error.title=this.languageService.translate.instant("igo.context.shareMap.errorTitle"),this.messageService.showError(Q)})}copyTextToClipboard(_){te._D.copy(_)&&this.messageService.success("igo.context.shareMap.dialog.copyMsg","igo.context.shareMap.dialog.copyTitle")}buildForm(){this.url=void 0;const _=(0,te.uq)();let N="Partage ";N+=this.userId?`(${this.userId}-${_})`:`(${_})`,this.form=this.formBuilder.group({title:[N],uri:[_]})}static \u0275fac=function(N){return new(N||ne)(s.GI1(x.ov),s.GI1(T.mi),s.GI1(A.oj),s.GI1(Io),s.GI1(e.KE))};static \u0275cmp=s.In1({type:ne,selectors:[["igo-share-map-api"]],inputs:{map:"map"},standalone:!0,features:[s.UHJ],decls:21,vars:18,consts:[[1,"igo-form",3,"formGroup","ngSubmit"],[1,"igo-input-container"],["matInput","","required","","formControlName","title",3,"placeholder"],["id","uriInput",1,"igo-input-container"],["class","prefix",4,"ngIf"],[1,"fieldWrapper"],["matInput","","required","","formControlName","uri",3,"readonly","placeholder"],[1,"igo-form-button-group"],["mat-raised-button","","type","submit",3,"disabled",4,"ngIf"],["mat-raised-button","","type","button",3,"click",4,"ngIf"],["class","igo-input-container linkToShare",4,"ngIf"],[1,"prefix"],["mat-raised-button","","type","submit",3,"disabled"],["mat-raised-button","","type","button",3,"click"],[1,"igo-input-container","linkToShare"],["matInput","","readonly","","rows","3",1,"textAreaWithButton",3,"placeholder","value"],["textArea",""],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click"]],template:function(N,Q){1&N&&(s.I0R(0,"form",0),s.qCj("ngSubmit",function(){return Q.createUrl(Q.form.value)}),s.I0R(1,"div",1)(2,"mat-form-field"),s.wR5(3,"input",2),s.wVc(4,"translate"),s.I0R(5,"mat-error"),s.OEk(6),s.wVc(7,"translate"),s.C$Y()()(),s.I0R(8,"div",3)(9,"mat-form-field"),s.yuY(10,ci,2,1,"span",4),s.I0R(11,"span",5),s.wR5(12,"input",6),s.wVc(13,"translate"),s.C$Y(),s.I0R(14,"mat-error"),s.OEk(15),s.wVc(16,"translate"),s.C$Y()()(),s.I0R(17,"div",7),s.yuY(18,Vo,3,4,"button",8)(19,ui,3,3,"button",9),s.C$Y()(),s.yuY(20,xo,10,7,"div",10)),2&N&&(s.E7m("formGroup",Q.form),s.yG2(3),s.E7m("placeholder",s.kDX(4,10,"igo.context.contextManager.form.title")),s.yG2(3),s.oRS(" ",s.kDX(7,12,"igo.context.contextManager.form.titleRequired")," "),s.yG2(4),s.E7m("ngIf",Q.userId),s.yG2(2),s.E7m("readonly",!Q.userId)("placeholder",s.kDX(13,14,"igo.context.contextManager.form.uri")),s.yG2(3),s.oRS(" ",s.kDX(16,16,"igo.context.contextManager.form.uriRequired")," "),s.yG2(3),s.E7m("ngIf",!Q.url),s.yG2(),s.E7m("ngIf",Q.url),s.yG2(),s.E7m("ngIf",Q.url))},dependencies:[e.y,e.sz,e.ot,e.ue,e.u,e.eJ,e.sl,e.uW,e.Wo,f.wb,f.Up,f.wJ,h.cN,h.yi,C.u_,d.oJ,d.Gw,d.um,Ze.KO,Ze.a4,Ke.oB,Ke.qL,x._s,Ft.sD],styles:['@charset "UTF-8";mat-form-field[_ngcontent-%COMP%]{width:100%}#uriInput[_ngcontent-%COMP%]   .fieldWrapper[_ngcontent-%COMP%]{display:block;overflow:hidden}#uriInput[_ngcontent-%COMP%]   .prefix[_ngcontent-%COMP%]{float:left}.linkToShare\\a0[_ngcontent-%COMP%] {padding:25px 5px 5px}.linkToShare\\a0[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none;width:100%;line-height:1.3;height:40px;overflow-y:hidden;word-wrap:normal;word-break:break-all}.linkToShare\\a0[_ngcontent-%COMP%]   textarea.textAreaWithButton[_ngcontent-%COMP%]{width:calc(100% - 60px)}.linkToShare\\a0[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{float:right;margin:-10px 0}.igo-form[_ngcontent-%COMP%]{padding:20px 5px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}']})}return ne})();var cn=r(35876);function un(ne,We){1&ne&&(s.I0R(0,"h4"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&ne&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.included")," "))}function dn(ne,We){1&ne&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&ne&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.context")," "))}function pn(ne,We){1&ne&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&ne&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.center")," "))}function mn(ne,We){1&ne&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&ne&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.zoom")," "))}function Zt(ne,We){1&ne&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&ne&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.addedLayers")," "))}function gn(ne,We){1&ne&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&ne&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.visibleInvisible")," "))}function hn(ne,We){1&ne&&(s.I0R(0,"h4"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&ne&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.excluded")," "))}function Wn(ne,We){1&ne&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&ne&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.order")," "))}function Ki(ne,We){1&ne&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&ne&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.opacity")," "))}function Mi(ne,We){1&ne&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&ne&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.filterOgc")," "))}function fn(ne,We){1&ne&&(s.I0R(0,"li"),s.OEk(1),s.wVc(2,"translate"),s.C$Y()),2&ne&&(s.yG2(),s.oRS(" ",s.kDX(2,1,"igo.context.shareMap.filterTime")," "))}function Go(ne,We){1&ne&&(s.I0R(0,"div"),s.yuY(1,un,3,3,"h4",6),s.wVc(2,"translate"),s.I0R(3,"ul"),s.yuY(4,dn,3,3,"li",6),s.wVc(5,"translate"),s.yuY(6,pn,3,3,"li",6),s.wVc(7,"translate"),s.yuY(8,mn,3,3,"li",6),s.wVc(9,"translate"),s.yuY(10,Zt,3,3,"li",6),s.wVc(11,"translate"),s.yuY(12,gn,3,3,"li",6),s.wVc(13,"translate"),s.C$Y(),s.yuY(14,hn,3,3,"h4",6),s.wVc(15,"translate"),s.I0R(16,"ul"),s.yuY(17,Wn,3,3,"li",6),s.wVc(18,"translate"),s.yuY(19,Ki,3,3,"li",6),s.wVc(20,"translate"),s.yuY(21,Mi,3,3,"li",6),s.wVc(22,"translate"),s.yuY(23,fn,3,3,"li",6),s.wVc(24,"translate"),s.C$Y()()),2&ne&&(s.yG2(),s.E7m("ngIf",""!==s.kDX(2,11,"igo.context.shareMap.included")),s.yG2(3),s.E7m("ngIf",""!==s.kDX(5,13,"igo.context.shareMap.context")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(7,15,"igo.context.shareMap.center")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(9,17,"igo.context.shareMap.zoom")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(11,19,"igo.context.shareMap.addedLayers")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(13,21,"igo.context.shareMap.visibleInvisible")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(15,23,"igo.context.shareMap.excluded")),s.yG2(3),s.E7m("ngIf",""!==s.kDX(18,25,"igo.context.shareMap.order")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(20,27,"igo.context.shareMap.opacity")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(22,29,"igo.context.shareMap.filterOgc")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(24,31,"igo.context.shareMap.filterTime")))}function yn(ne,We){1&ne&&(s.wR5(0,"igo-custom-html",8),s.wVc(1,"translate")),2&ne&&s.E7m("html",s.kDX(1,1,"igo.context.shareMap.htmlClarifications"))}let Wi=(()=>{class ne{messageService;shareMapService;cdRef;mapState$$;map;url;publicShareOption={layerlistControls:{querystring:""}};constructor(_,N,Q){this.messageService=_,this.shareMapService=N,this.cdRef=Q}ngOnInit(){this.resetUrl(),this.mapState$$=(0,cn.E)([this.map.viewController.state$,this.map.status$]).subscribe(_=>{this.resetUrl(),this.cdRef.detectChanges()})}ngAfterViewInit(){this.resetUrl()}ngOnDestroy(){this.mapState$$.unsubscribe()}resetUrl(_={}){this.url=this.shareMapService.getUrlWithoutApi(this.map,this.publicShareOption)}copyTextToClipboard(_){te._D.copy(_)&&this.messageService.success("igo.context.shareMap.dialog.copyMsg","igo.context.shareMap.dialog.copyTitle")}static \u0275fac=function(N){return new(N||ne)(s.GI1(T.mi),s.GI1(Io),s.GI1(s.kD9))};static \u0275cmp=s.In1({type:ne,selectors:[["igo-share-map-url"]],inputs:{map:"map"},standalone:!0,features:[s.UHJ],decls:18,vars:13,consts:[[1,"igo-input-container","linkToShare"],["matInput","","readonly","","rows","3",3,"placeholder","value"],["textArea",""],[1,"igo-form-button-group"],["mat-raised-button","",3,"click"],[1,"mat-typography"],[4,"ngIf"],["class","shareCustomPadding","class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"]],template:function(N,Q){if(1&N){const Ce=s.KQA();s.I0R(0,"div",0)(1,"mat-form-field"),s.wR5(2,"textarea",1,2),s.wVc(4,"translate"),s.C$Y(),s.I0R(5,"div",3)(6,"button",4),s.qCj("click",function(){s.usT(Ce);const Ne=s.Gew(3);return s.CGJ(Q.copyTextToClipboard(Ne))}),s.I0R(7,"mat-icon"),s.OEk(8,"content_copy"),s.C$Y(),s.OEk(9),s.wVc(10,"translate"),s.C$Y()(),s.I0R(11,"div"),s.wR5(12,"br"),s.I0R(13,"section",5),s.yuY(14,Go,25,33,"div",6),s.wVc(15,"translate"),s.yuY(16,yn,2,3,"igo-custom-html",7),s.wVc(17,"translate"),s.C$Y()()()}2&N&&(s.yG2(2),s.E7m("placeholder",s.kDX(4,5,"igo.context.shareMap.placeholderLink"))("value",Q.url),s.yG2(7),s.oRS(" ",s.kDX(10,7,"igo.context.shareMap.copy")," "),s.yG2(5),s.E7m("ngIf",""===s.kDX(15,9,"igo.context.shareMap.htmlClarifications")),s.yG2(2),s.E7m("ngIf",""!==s.kDX(17,11,"igo.context.shareMap.htmlClarifications")))},dependencies:[f.wb,f.Up,h.cN,h.yi,d.oJ,d.Gw,Ke.oB,Ke.qL,C.u_,y.YM,x._s,Ft.sD],styles:['@charset "UTF-8";mat-form-field[_ngcontent-%COMP%]{width:100%}.linkToShare\\a0[_ngcontent-%COMP%] {padding:25px 5px 5px}.linkToShare\\a0[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none;width:100%;line-height:1.3;height:40px;overflow-y:hidden;word-wrap:normal;word-break:break-all}.linkToShare\\a0[_ngcontent-%COMP%]   textarea.textAreaWithButton[_ngcontent-%COMP%]{width:calc(100% - 60px)}.linkToShare\\a0[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{float:right;margin:-10px 0}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}igo-custom-html.shareCustomPadding[_ngcontent-%COMP%]{padding:0}']})}return ne})();var Di=r(18268);function _n(ne,We){if(1&ne&&(s.I0R(0,"mat-tab-group")(1,"mat-tab",2),s.wVc(2,"translate"),s.wR5(3,"igo-share-map-api",3),s.C$Y(),s.I0R(4,"mat-tab",2),s.wVc(5,"translate"),s.wR5(6,"igo-share-map-url",3),s.C$Y()()),2&ne){const _=s.GaO();s.yG2(),s.E7m("label",s.kDX(2,4,"igo.context.shareMap.shareWithApi")),s.yG2(2),s.E7m("map",_.map),s.yG2(),s.E7m("label",s.kDX(5,6,"igo.context.shareMap.shareWithUrl")),s.yG2(2),s.E7m("map",_.map)}}function Cn(ne,We){if(1&ne&&s.wR5(0,"igo-share-map-url",3),2&ne){const _=s.GaO();s.E7m("map",_.map)}}let vn=(()=>{class ne{config;map;hasApi=!1;constructor(_){this.config=_,this.hasApi=!!this.config.getConfig("context.url")}static \u0275fac=function(N){return new(N||ne)(s.GI1(O.aW))};static \u0275cmp=s.In1({type:ne,selectors:[["igo-share-map"]],inputs:{map:"map"},standalone:!0,features:[s.UHJ],decls:2,vars:2,consts:[[4,"ngIf"],[3,"map",4,"ngIf"],[3,"label"],[3,"map"]],template:function(N,Q){1&N&&s.yuY(0,_n,7,8,"mat-tab-group",0)(1,Cn,1,1,"igo-share-map-url",1),2&N&&(s.E7m("ngIf",Q.hasApi),s.yG2(),s.E7m("ngIf",!Q.hasApi))},dependencies:[C.u_,Di.WG,Di.aJ,Di._q,ji,Wi,x._s,Ft.sD]})}return ne})(),Fi=(()=>{class ne{contextService;messageService;component;editedContext$$;submitSuccessed=new s._w7;onEdit(_){this.contextService.update(this.component.context.id,_).subscribe(()=>{this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:_.title||this.component.context.title}),this.contextService.setEditedContext(void 0),this.submitSuccessed.emit(_)})}constructor(_,N,Q){this.contextService=N,this.messageService=Q,this.component=_}ngOnInit(){this.editedContext$$=this.contextService.editedContext$.subscribe(_=>this.handleEditedContextChange(_))}ngOnDestroy(){this.editedContext$$.unsubscribe()}handleEditedContextChange(_){this.component.context=_}static \u0275fac=function(N){return new(N||ne)(s.GI1(Ht,2),s.GI1(de),s.GI1(T.mi))};static \u0275dir=s.Sc5({type:ne,selectors:[["","igoContextEditBinding",""]],hostBindings:function(N,Q){1&N&&s.qCj("submitForm",function(Te){return Q.onEdit(Te)})},outputs:{submitSuccessed:"submitSuccessed"},standalone:!0})}return ne})(),bn=(()=>{class ne{contextService;mapService;languageService;confirmDialogService;messageService;auth;storageService;cdRef;component;contexts$$;selectedContext$$;defaultContextId$$;previousMessageId;onSelect(_){this.contextService.loadContext(_.uri)}onEdit(_){this.contextService.loadEditedContext(_.uri)}onSave(_){const N=this.mapService.getMap(),Q=this.contextService.getContextFromMap(N),Ce=()=>{this.messageService.success("igo.context.contextManager.dialog.saveMsg","igo.context.contextManager.dialog.saveTitle",void 0,{value:_.title})};if(_.imported)return Q.title=_.title,this.contextService.delete(_.id,!0),void this.contextService.create(Q).subscribe(Ne=>{this.contextService.loadContext(Ne.uri),Ce()});this.contextService.update(_.id,{layers:Q.layers,map:{view:Q.map.view}}).subscribe(()=>{Ce()})}onFavorite(_){_.id||(_.id=_.uri),this.contextService.setDefault(_.id).subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId),this.contextService.defaultContextId$.next(_.id);const N=this.messageService.success("igo.context.contextManager.dialog.favoriteMsg","igo.context.contextManager.dialog.favoriteTitle",void 0,{value:_.title});this.previousMessageId=N.toastId,this.cdRef.detectChanges()})}onManageTools(_){this.contextService.loadEditedContext(_.uri)}onManagePermissions(_){this.contextService.loadEditedContext(_.uri)}onDelete(_){this.confirmDialogService.open(this.languageService.translate.instant("igo.context.contextManager.dialog.confirmDelete")).subscribe(Q=>{Q&&this.contextService.delete(_.id,_.imported).subscribe(()=>{this.messageService.info("igo.context.contextManager.dialog.deleteMsg","igo.context.contextManager.dialog.deleteTitle",void 0,{value:_.title})})})}onClone(_){this.contextService.clone(_.id,{title:_.title+"-copy",uri:_.uri+"-copy"}).subscribe(()=>{this.messageService.success("igo.context.contextManager.dialog.cloneMsg","igo.context.contextManager.dialog.cloneTitle",void 0,{value:_.title})})}onCreate(_){const{title:N,empty:Q}=_,Ce=this.contextService.getContextFromMap(this.component.map,Q);Ce.title=N,this.contextService.create(Ce).subscribe(()=>{this.messageService.success("igo.context.bookmarkButton.dialog.createMsg","igo.context.bookmarkButton.dialog.createTitle",void 0,{value:Ce.title}),this.contextService.loadContext(Ce.uri)})}loadContexts(){const _=["none"];for(const N of this.component.permissions)(!0===N.checked||!0===N.indeterminate)&&_.push(N.name);this.contextService.loadContexts(_,!!this.component.showHidden)}showHiddenContexts(){this.component.showHidden=!this.component.showHidden,this.storageService.set("contexts.showHidden",this.component.showHidden),this.loadContexts()}onShowContext(_){this.contextService.showContext(_.id).subscribe()}onHideContext(_){this.contextService.hideContext(_.id).subscribe()}constructor(_,N,Q,Ce,Te,Ne,gt,It,it){this.contextService=N,this.mapService=Q,this.languageService=Ce,this.confirmDialogService=Te,this.messageService=Ne,this.auth=gt,this.storageService=It,this.cdRef=it,this.component=_}ngOnInit(){this.component.contexts={ours:[]},this.component.showHidden=this.storageService.get("contexts.showHidden"),this.contexts$$=this.contextService.contexts$.subscribe(N=>this.handleContextsChange(N)),this.defaultContextId$$=this.contextService.defaultContextId$.subscribe(N=>{this.component.defaultContextId=N});const _=this.storageService.get("favorite.context.uri");_&&!this.auth.authenticated&&this.contextService.defaultContextId$.next(_),this.selectedContext$$=this.contextService.context$.pipe((0,U.o)(100)).subscribe(N=>this.component.selectedContext=N),this.auth.authenticate$.subscribe(N=>{N&&this.contextService.getProfilByUser().subscribe(Q=>{this.component.users=Q,this.component.permissions=[];const Ce=this.component.users.reduce((Ne,gt)=>(Ne=Ne.concat(gt),gt.childs?Ne.concat(gt.childs):Ne),[]);for(const Ne of Ce){const gt={name:Ne.name,checked:this.storageService.get("contexts.permissions."+Ne.name)};null===gt.checked&&(gt.checked=!0),this.component.permissions.push(gt)}const Te=["none"];for(const Ne of this.component.permissions)(!0===Ne.checked||!0===Ne.indeterminate)&&Te.push(Ne.name);this.contextService.loadContexts(Te,!!this.component.showHidden)})})}ngOnDestroy(){this.contexts$$.unsubscribe(),this.selectedContext$$.unsubscribe(),this.defaultContextId$$.unsubscribe()}handleContextsChange(_){this.component.contexts=_}static \u0275fac=function(N){return new(N||ne)(s.GI1(ri,2),s.GI1(de),s.GI1(w.u00),s.GI1(x.ov),s.GI1(y.Ex),s.GI1(T.mi),s.GI1(A.oj),s.GI1(W.yQ),s.GI1(s.kD9))};static \u0275dir=s.Sc5({type:ne,selectors:[["","igoContextListBinding",""]],hostBindings:function(N,Q){1&N&&s.qCj("select",function(Te){return Q.onSelect(Te)})("edit",function(Te){return Q.onEdit(Te)})("save",function(Te){return Q.onSave(Te)})("favorite",function(Te){return Q.onFavorite(Te)})("manageTools",function(Te){return Q.onManageTools(Te)})("managePermissions",function(Te){return Q.onManagePermissions(Te)})("delete",function(Te){return Q.onDelete(Te)})("clone",function(Te){return Q.onClone(Te)})("create",function(Te){return Q.onCreate(Te)})("filterPermissionsChanged",function(){return Q.loadContexts()})("showHiddenContexts",function(){return Q.showHiddenContexts()})("show",function(Te){return Q.onShowContext(Te)})("hide",function(Te){return Q.onHideContext(Te)})},standalone:!0,features:[s.M5G([y.Ex])]})}return ne})(),Xi=(()=>{class ne{contextService;languageService;messageService;cd;component;editedContext$$;onAddPermission(_){_.profil?this.contextService.addPermissionAssociation(this.component.context.id,_.profil,_.typePermission).subscribe(Q=>{for(const Te of Q)this.component.permissions[_.typePermission].push(Te);this.messageService.success("igo.context.permission.dialog.addMsg","igo.context.permission.dialog.addTitle",void 0,{value:_.profil}),this.cd.detectChanges()}):this.messageService.error("igo.context.contextManager.errors.addPermissionEmpty","igo.context.contextManager.errors.addPermissionTitle")}onRemovePermission(_){this.contextService.deletePermissionAssociation(this.component.context.id,_.id).subscribe(()=>{const Q=this.component.permissions[_.typePermission].findIndex(Te=>Te.id===_.id);this.component.permissions[_.typePermission].splice(Q,1),this.messageService.success("igo.context.permission.dialog.deleteMsg","igo.context.permission.dialog.deleteTitle",void 0,{value:_.profil}),this.cd.detectChanges()})}onScopeChanged(_){const N=_.scope;this.contextService.update(_.id,{scope:N}).subscribe(()=>{this.messageService.success("igo.context.permission.dialog.scopeChangedMsg","igo.context.permission.dialog.scopeChangedTitle",void 0,{value:"igo.context.permission.scope."+N})})}constructor(_,N,Q,Ce,Te){this.contextService=N,this.languageService=Q,this.messageService=Ce,this.cd=Te,this.component=_}ngOnInit(){this.editedContext$$=this.contextService.editedContext$.subscribe(_=>this.handleEditedContextChange(_))}ngOnDestroy(){this.editedContext$$.unsubscribe(),this.contextService.editedContext$.next(void 0)}handleEditedContextChange(_){this.component.context=_,_&&this.contextService.getPermissions(_.id).subscribe(N=>{const Q={read:(N=N||[]).filter(Ce=>"read"===Ce.typePermission.toString()),write:N.filter(Ce=>"write"===Ce.typePermission.toString())};return this.component.permissions=Q})}static \u0275fac=function(N){return new(N||ne)(s.GI1(Yi,2),s.GI1(de),s.GI1(x.ov),s.GI1(T.mi),s.GI1(s.kD9))};static \u0275dir=s.Sc5({type:ne,selectors:[["","igoContextPermissionsBinding",""]],hostBindings:function(N,Q){1&N&&s.qCj("addPermission",function(Te){return Q.onAddPermission(Te)})("removePermission",function(Te){return Q.onRemovePermission(Te)})("scopeChanged",function(Te){return Q.onScopeChanged(Te)})},standalone:!0})}return ne})();var Ri=r(728),pi=r(6560),mi=r(86708);let On=(()=>{class ne{component;contextService;layerService;configService;styleListService;styleService;route;context$$;queryParams;contextLayers=[];removeLayersOnContextChange=!0;get map(){return this.component.map}constructor(_,N,Q,Ce,Te,Ne,gt){this.component=_,this.contextService=N,this.layerService=Q,this.configService=Ce,this.styleListService=Te,this.styleService=Ne,this.route=gt}ngOnInit(){this.context$$=this.contextService.context$.pipe((0,pi.I)(_=>void 0!==_)).subscribe(_=>this.handleContextChange(_)),this.route&&this.route.options.visibleOnLayersKey&&this.route.options.visibleOffLayersKey&&this.route.options.contextKey&&this.route.queryParams.pipe((0,I.K)(_=>!te.Yv.isEmpty(_))).subscribe(_=>{this.queryParams=_})}ngOnDestroy(){this.context$$.unsubscribe()}handleContextChange(_){if(void 0===_.layers)return;!0===this.removeLayersOnContextChange?this.map.removeAllLayers():this.map.removeLayers(this.contextLayers),this.contextLayers=[];const N=(0,Ri.U)(..._.layers.map((Q,Ce)=>this.layerService.createAsyncLayer(Q,_.uri)));N.pipe((0,mi.c)(N.pipe((0,U.o)(500)))).subscribe(Q=>{this.handleAddLayers(Q),_.extraFeatures&&_.extraFeatures.forEach(Ce=>{this.configService.getConfig("importExport")?.importWithStyle?function He(ne,We,_,N){let Q,Ce,Te;if(_.getStyleList(ne.name+".styleByAttribute")){const It=_.getStyleList(ne.name+".styleByAttribute");Q=(it,At)=>N.createStyleByAttribute(it,It,At)}else if(_.getStyleList(ne.name+".clusterStyle")){const It=_.getStyleList(ne.name+".clusterParam");Ce=_.getStyleList(ne.name+".distance"),Q=(it,At)=>{const Dt=N.createStyle(_.getStyleList(ne.name+".clusterStyle"),it,At);return N.createClusterStyle(it,At,It,Dt)}}else Q=_.getStyleList(ne.name+".style")?(It,it)=>N.createStyle(_.getStyleList(ne.name+".style"),It,it):(It,it)=>N.createStyle(_.getStyleList("default.style"),It,it);const Ne=ze(ne);_.getStyleList(ne.name+".clusterStyle")?(Te=new w.aaH({distance:Ce,type:"cluster",queryable:!0}),Te.ol.source.addFeatures(Ne)):(Te=new w.EBb({type:"vector",queryable:!0}),Te.ol.addFeatures(Ne));const gt=new w.Mdo({title:ne.name,isIgoInternalLayer:!0,source:Te,style:Q,opacity:ne.opacity,visible:ne.visible});We.addLayer(gt)}(Ce,this.map,this.styleListService,this.styleService):function Oe(ne,We){const N=ze(ne),Q=new w.EBb({type:"vector",queryable:!0});Q.ol.addFeatures(N);let Ce,Te=!1;const Ne=N[0]?.getKeys()??[];Ne.includes("_style")||Ne.includes("_mapTitle")?Ce=(0,w.M4J)():(Ce=(0,w.Cyp)(),Te=!0);const gt=new w.Mdo({title:ne.name,isIgoInternalLayer:!0,source:Q,igoStyle:{editable:Te},style:Ce,visible:ne.visible,opacity:ne.opacity});We.addLayer(gt)}(Ce,this.map)})}),this.layerService.createAsyncIdbLayers(_.uri).pipe((0,U.o)(500)).subscribe(Q=>this.handleAddLayers(Q))}handleAddLayers(_){_=_.filter(N=>void 0!==N).map(N=>(N.visible=this.computeLayerVisibilityFromUrl(N),N.zIndex=N.zIndex,N)),this.contextLayers.concat(_),this.map.addLayers(_)}computeLayerVisibilityFromUrl(_){const N=this.queryParams,Ce=_.id;let Te=_.visible;if(!N||!Ce)return Te;const Ne=N[this.route.options.contextKey];if(Ne===this.contextService.context$.value.uri||!Ne){let gt="",It="",it=[],At=[];this.route.options.visibleOnLayersKey&&N[this.route.options.visibleOnLayersKey]&&(gt=N[this.route.options.visibleOnLayersKey]),this.route.options.visibleOffLayersKey&&N[this.route.options.visibleOffLayersKey]&&(It=N[this.route.options.visibleOffLayersKey]),"*"===gt&&(Te=!0),"*"===It&&(Te=!1),it=gt.split(","),At=It.split(","),(it.indexOf(Ce)>-1||it.indexOf(Ce.toString())>-1)&&(Te=!0),(At.indexOf(Ce)>-1||At.indexOf(Ce.toString())>-1)&&(Te=!1)}return Te}static \u0275fac=function(N){return new(N||ne)(s.GI1(w.q2F),s.GI1(de),s.GI1(w.IZ6),s.GI1(O.aW),s.GI1(w.cTh),s.GI1(w.UND),s.GI1(k.k$,8))};static \u0275dir=s.Sc5({type:ne,selectors:[["","igoLayerContext",""]],inputs:{removeLayersOnContextChange:"removeLayersOnContextChange"},standalone:!0,features:[s.M5G([ie.SU])]})}return ne})();var In=r(9588);let gi=(()=>{class ne{contextService;mediaService;component;context$$;get map(){return this.component.map}constructor(_,N,Q){this.contextService=N,this.mediaService=Q,this.component=_}ngOnInit(){this.context$$=this.contextService.context$.pipe((0,pi.I)(_=>void 0!==_)).subscribe(_=>this.handleContextChange(_))}ngOnDestroy(){this.context$$.unsubscribe()}handleContextChange(_){if(void 0===_.map)return;const N=_.map.view;(!this.component.view||!0!==N.keepCurrentView||_.map.view.projection!==this.map.projection)&&(this.component.view=N),this.component.map.geolocationController&&this.component.map.geolocationController.updateGeolocationOptions(N);const Q=_.map.controls;if(!this.component.controls&&Q){if(this.mediaService.isMobile()&&"boolean"!=typeof Q.scaleLine){const Ce=Q.scaleLine;Ce.minWidth||(Ce.minWidth=Math.min(64,Ce.minWidth),Q.scaleLine=Ce)}this.component.controls=Q}}static \u0275fac=function(N){return new(N||ne)(s.GI1(w.q2F),s.GI1(de),s.GI1(In.QB))};static \u0275dir=s.Sc5({type:ne,selectors:[["","igoMapContext",""]],standalone:!0})}return ne})()},23302:(Fe,ce,r)=>{"use strict";r.d(ce,{U9:()=>e.U,YP:()=>C.Y});var C=r(12044),e=r(99744);r(48576)},48576:(Fe,ce,r)=>{"use strict";r.d(ce,{b:()=>L});var C=r(20968),e=r(99744),d=r(34896);let L=(()=>{class P{activityService;constructor(f){this.activityService=f}intercept(f,h){const R=f.headers.get("activityInterceptor");if(R){const O=f.clone({headers:f.headers.delete("activityInterceptor")});if("false"===R)return h.handle(O)}const y=this.activityService.register();return h.handle(f).pipe((0,C.U)(()=>{this.activityService.unregister(y)}))}static \u0275fac=function(h){return new(h||P)(d.CoB(e.U))};static \u0275prov=d.wxM({token:P,factory:P.\u0275fac})}return P})()},12044:(Fe,ce,r)=>{"use strict";r.d(ce,{Y:()=>L});var C=r(33712),e=r(48576),d=r(34896);let L=(()=>{class P{static forRoot(){return{ngModule:P,providers:[{provide:C.So,useClass:e.b,multi:!0}]}}static \u0275fac=function(h){return new(h||P)};static \u0275mod=d.a4G({type:P});static \u0275inj=d.s3X({})}return P})()},99744:(Fe,ce,r)=>{"use strict";r.d(ce,{U:()=>L});var C=r(43168),e=r(54844),d=r(34896);let L=(()=>{class P{counter$=new e.g(0);ids=[];constructor(){}register(){const f=(0,C.uq)();return this.ids.push(f),this.counter$.next(this.ids.length),f}unregister(f){const h=this.ids.indexOf(f);-1!==h&&(this.ids.splice(h,1),this.counter$.next(this.ids.length))}static \u0275fac=function(h){return new(h||P)};static \u0275prov=d.wxM({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})()},9204:(Fe,ce,r)=>{"use strict";r.d(ce,{aW:()=>y,sh:()=>x,WU:()=>R});var C=r(34896),e=r(33712),d=r(43168),L=r(54844),P=r(39732),o=r(51672);const f={showMenuButton:{alternativeKey:"menu.button.visible",mayBeRemoveIn:new Date("2024-06-06")},menuButtonReverseColor:{alternativeKey:"menu.button.useThemeColor",mayBeRemoveIn:new Date("2024-06-06")},importWithStyle:{alternativeKey:"importExport.importWithStyle",mayBeRemoveIn:new Date("2024-06-06")},hasGeolocateButton:{alternativeKey:"geolocate.button.visible",mayBeRemoveIn:new Date("2024-06-06")}},h=new Map(Object.entries(f).filter(([F,A])=>A.alternativeKey).map(([F,A])=>[A.alternativeKey,{deprecatedKey:F}])),R={lib:"17.0.0-next.6",releaseDate:1712675826202};let y=(()=>{class F{config;httpClient;configDeprecated=new Map(Object.entries(f));_isLoaded$=new L.g(null);isLoaded$=this._isLoaded$.asObservable();constructor(k){this.httpClient=new e.KK(k)}getConfigs(){return Array.from(this.configDeprecated.keys()).map(k=>{void 0!==d.Yv.resolve(this.config,k)&&this.handleDeprecatedConfig(k)}),this.config}getConfig(k,W){let w=d.Yv.resolve(this.config,k);return this.configDeprecated.get(k)&&void 0!==w?this.handleDeprecatedConfig(k):void 0===w&&(w=this.handleDeprecationPossibility(k)),w??W}handleDeprecatedConfig(k){const W=this.configDeprecated.get(k);let w=`This config (${k}) is deprecated and will be removed shortly`;W.alternativeKey&&(w+=` You should use this key (${W.alternativeKey}) as an alternate solution`),new Date>=W.mayBeRemoveIn?console.error(w):console.warn(w)}handleDeprecationPossibility(k){const W=h.get(k);if(W)return this.getConfig(W.deprecatedKey)}load(k){const W=k.default;return k.path?new Promise((w,te)=>{this.httpClient.get(k.path).pipe((0,o.a)(Z=>(console.log(`Configuration file ${k.path} could not be read`),this._isLoaded$.next(!1),w(!0),(0,P.c)(Z.error||"Server error")))).subscribe(Z=>{this.config=d.Yv.mergeDeep(d.Yv.mergeDeep({version:R},W),Z),this._isLoaded$.next(!0),w(!0)})}):(this.config=W,this._isLoaded$.next(!0),!0)}static \u0275fac=function(W){return new(W||F)(C.CoB(e.m))};static \u0275prov=C.wxM({token:F,factory:F.\u0275fac,providedIn:"root"})}return F})(),O=new C.UbH("configOptions");function x(F){return(0,C.AFj)([{provide:O,useValue:F},{provide:C.kZF,useFactory:T,multi:!0,deps:[y,O]}])}function T(F,A){return()=>F.load(A)}},24708:(Fe,ce,r)=>{"use strict";r.d(ce,{_s:()=>d,ov:()=>k,MV:()=>te});var C=r(72584),e=r(34896);let d=(()=>{class V{static \u0275fac=function(c){return new(c||V)};static \u0275mod=e.a4G({type:V});static \u0275inj=e.s3X({imports:[C.O0]})}return V})();var L=r(33712),P=r(43168),o=r(54844),f=r(83680),h=r(19432),R=r(44816),y=r(40604),O=r(78600);class x{configService;prefix;suffix;httpClient;_isLoaded$=new o.g(null);isLoaded$=this._isLoaded$.asObservable();constructor(B,z,c,I=".json"){this.configService=z,this.prefix=c,this.suffix=I,this.httpClient=new L.KK(B)}getTranslation(B){const z=this.httpClient.get(`locale/libs_locale/${B}.json`);return this.configService.isLoaded$.pipe((0,f.K)(c=>c),(0,h.G)(()=>{if(this.configService&&!this.prefix){const b=this.configService.getConfig("language.prefix");this.prefix=!b||Array.isArray(b)?b:[b]}if(!this.prefix||0===this.prefix.length)return this._isLoaded$.next(!0),z;const c=this.prefix.map(b=>this.httpClient.get(`${b}${B}${this.suffix}`));return(0,R.y)([z,...c]).pipe((0,y.k)(b=>b.reduce((G,D)=>P.Yv.mergeDeep(G,D),{})),(0,O.y)(()=>{this._isLoaded$.next(!0)}))}))}}var T=r(9204),a=r(31520),F=r(51672),A=r(35876);let k=(()=>{class V{translate;language;language$=new o.g(void 0);constructor(z){this.translate=z,this.language=this.translate.getBrowserLang();const c=this.getLanguage();this.translate.setDefaultLang(c),this.language$.next(c)}getLanguage(){return this.language.match(/en|fr/)?this.language:"en"}setLanguage(z){this.language=z.match(/en|fr/)?z:"en",(0,A.E)([this.translate.use(this.language),this.translate.reloadLang(this.language)]).subscribe(()=>{this.language$.next(this.language)})}static \u0275fac=function(c){return new(c||V)(e.CoB(C.qS))};static \u0275prov=e.wxM({token:V,factory:V.\u0275fac,providedIn:"root"})}return V})();class W{handle(B){if(!B.translateService.langs.length)throw new Error("Translations are not yet loaded.          Check that the LanguageService is injected.");if("igo."===B.key.substr(0,4))throw new Error(`The Key "${B.key}" is missing in locale file.`);return B.key}}const w=5e3;function te(V){return(0,e.AFj)([(0,e.ai8)(C.O0.forRoot(Z(V))),{provide:e.kZF,useFactory:B=>()=>B.translate.currentLoader.isLoaded$?.pipe((0,a.m)(w),(0,f.K)(z=>!0===z),(0,F.a)(z=>{throw z.message+=` - Request timed out for language loader after: ${w}`,z})),deps:[k],multi:!0}])}const Z=V=>({defaultLanguage:"fr",loader:V??K,missingTranslationHandler:{provide:C.sf,useClass:W}}),K={provide:C._E,useFactory:function X(V,B){return new x(V,B,void 0,void 0)},deps:[L.m,T.aW]}},9588:(Fe,ce,r)=>{"use strict";r.d(ce,{oZ:()=>C,cz:()=>e,QB:()=>o});var C=function(f){return f.Mobile="mobile",f.Tablet="tablet",f.Desktop="desktop",f}(C||{}),e=function(f){return f.Portrait="portrait",f.Landscape="landscape",f}(e||{}),d=r(73192),L=r(54844),P=r(34896);let o=(()=>{class f{media$=new L.g(void 0);orientation$=new L.g(void 0);constructor(R){R.observe([d.kP.HandsetLandscape]).subscribe(y=>{y.matches&&(this.media$.next(C.Mobile),this.orientation$.next(e.Landscape))}),R.observe([d.kP.HandsetPortrait]).subscribe(y=>{y.matches&&(this.media$.next(C.Mobile),this.orientation$.next(e.Portrait))}),R.observe([d.kP.TabletLandscape]).subscribe(y=>{y.matches&&(this.media$.next(C.Tablet),this.orientation$.next(e.Landscape))}),R.observe([d.kP.TabletPortrait]).subscribe(y=>{y.matches&&(this.media$.next(C.Tablet),this.orientation$.next(e.Portrait))}),R.observe([d.kP.WebLandscape]).subscribe(y=>{y.matches&&(this.media$.next(C.Desktop),this.orientation$.next(e.Landscape))}),R.observe([d.kP.WebPortrait]).subscribe(y=>{y.matches&&(this.media$.next(C.Desktop),this.orientation$.next(e.Portrait))})}getMedia(){return this.media$.value}getOrientation(){return this.orientation$.value}isTouchScreen(){return"ontouchstart"in document.documentElement}isMobile(){return"mobile"===this.getMedia()}isDesktop(){return"desktop"===this.getMedia()}static \u0275fac=function(y){return new(y||f)(P.CoB(d.w$))};static \u0275prov=P.wxM({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()},93020:(Fe,ce,r)=>{"use strict";r.d(ce,{UD:()=>d,mi:()=>O});var C=r(38472),e=r(34896);let d=(()=>{class x{static forRoot(){return{ngModule:x,providers:[]}}static \u0275fac=function(F){return new(F||x)};static \u0275mod=e.a4G({type:x});static \u0275inj=e.s3X({imports:[C.gv.forRoot({positionClass:"toast-bottom-right",timeOut:1e4,extendedTimeOut:1e4,titleClass:"mat-subtitle-2",messageClass:"toast-message",closeButton:!0,progressBar:!0,enableHtml:!0,tapToDismiss:!0,maxOpened:4,preventDuplicates:!0,resetTimeoutOnDuplicate:!0,countDuplicates:!1,includeTitleDuplicates:!0})]})}return x})();var L=function(x){return x.ERROR="error",x.ALERT="warning",x.WARNING="warning",x.INFO="info",x.SUCCESS="success",x.SHOW="show",x}(L||{}),P=r(9204),o=r(24708),f=r(54844),h=r(44816),R=r(24112),y=r(83680);let O=(()=>{class x{injector;configService;languageService;messages$=new f.g([]);options;activeMessageTranslations=[];constructor(a,F,A){this.injector=a,this.configService=F,this.languageService=A,this.options=this.configService.getConfig("message"),this.languageService.language$.pipe((0,R.o)(500)).subscribe(k=>{0===this.toastr.toasts.length&&(this.activeMessageTranslations=[]),this.toastr.toasts.map(W=>{const w=this.activeMessageTranslations.find(te=>te.id===W.toastId);if(w){const te={...w.textInterpolateParams},Z={...w.titleInterpolateParams};w.textInterpolateParams&&Object.keys(w.textInterpolateParams).map(K=>{K&&(te[K]=this.languageService.translate.instant(w.textInterpolateParams[K]))}),w.titleInterpolateParams&&Object.keys(w.titleInterpolateParams).map(K=>{K&&(Z[K]=this.languageService.translate.instant(w.titleInterpolateParams[K]))}),(0,h.y)([this.languageService.translate.get(w.textKey,te),this.languageService.translate.get(w.titleKey,Z)]).pipe((0,y.K)()).subscribe(K=>{W.toastRef.componentInstance.message=K[0],W.toastRef.componentInstance.title=K[1]})}})})}get toastr(){return this.injector.get(C.SA)}showError(a){return a.error.caught=!0,this.error(a.error.message,a.error.title)}message(a){const F=a.type;this.toastr.toastrConfig.iconClasses[F]=`toast-${F}`,this.messages$.next(this.messages$.value.concat([a])),a.options=a.options||{};const A=new Date;if(a.options.from=a.options.from?a.options.from:new Date("1 jan 1900"),a.options.to=a.options.to?a.options.to:new Date("1 jan 3000"),"string"==typeof a.options.from&&(a.options.from=new Date(Date.parse(a.options.from.replace(/-/g," ")))),"string"==typeof a.options.to&&(a.options.to=new Date(Date.parse(a.options.to.replace(/-/g," ")))),A>a.options.from&&A<a.options.to&&(!1===a.showIcon&&(this.toastr.toastrConfig.iconClasses[F]=`toast-${F} toast-no-icon`),(a=this.handleTemplate(a)).text)){let k;switch(a.type){case L.SUCCESS:k=this.success(a.text,a.title,a.options,a.textInterpolateParams,a.titleInterpolateParams);break;case L.ERROR:k=this.error(a.text,a.title,a.options,a.textInterpolateParams,a.titleInterpolateParams);break;case L.INFO:k=this.info(a.text,a.title,a.options,a.textInterpolateParams,a.titleInterpolateParams);break;case L.SHOW:k=this.show(a.text,a.title,a.options,a.textInterpolateParams,a.titleInterpolateParams);break;case L.ALERT:case L.WARNING:k=this.alert(a.text,a.title,a.options,a.textInterpolateParams,a.titleInterpolateParams);break;default:k=this.info(a.text,a.title,a.options,a.textInterpolateParams,a.titleInterpolateParams)}a.options.id=k.toastId}}success(a,F="igo.core.message.success",A={},k,W){return this.handleNgxToastr("success",a,F,A,k,W)}error(a,F="igo.core.message.error",A={},k,W){return this.handleNgxToastr("error",a,F,A,k,W)}info(a,F="igo.core.message.info",A={},k,W){return this.handleNgxToastr("info",a,F,A,k,W)}alert(a,F="igo.core.message.alert",A={},k,W){return this.handleNgxToastr("alert",a,F,A,k,W)}show(a,F="igo.core.message.info",A={},k,W){return this.handleNgxToastr("show",a,F,A,k,W)}handleNgxToastr(a,F,A,k={},W,w){const te={...W},Z={...w};W&&Object.keys(W).map(B=>{const z=W[B];z&&(te[B]="string"==typeof z?this.languageService.translate.instant(z):z)}),w&&Object.keys(w).map(B=>{if(B){const z=w[B];Z[B]="string"==typeof z?this.languageService.translate.instant(z):z}});const K=this.languageService.translate.instant(F,te),X=this.languageService.translate.instant(A,Z);let V;switch(a){case"success":V=this.toastr.success(K,X,k);break;case"error":V=this.toastr.error(K,X,k);break;case"show":case"info":V=this.toastr.info(K,X,k);break;case"alert":V=this.toastr.warning(K,X,k)}return this.activeMessageTranslations.push({id:V.toastId,titleKey:A,textKey:F,textInterpolateParams:W,titleInterpolateParams:w}),V}remove(a){this.toastr.remove(a)}removeAllAreNotError(){for(const a of this.messages$.value)a.type!==L.ERROR&&this.remove(a.options.id)}handleTemplate(a){if(!this.options?.template||a.html)return a;let F=this.options?.template;return F=F.replace("${text}",a.text),F=F.replace("${title}",a.title),a.html=void 0,a.text=F,a.title=void 0,a}static \u0275fac=function(F){return new(F||x)(e.CoB(e.zZn),e.CoB(P.aW),e.CoB(o.ov))};static \u0275prov=e.wxM({token:x,factory:x.\u0275fac,providedIn:"root"})}return x})()},39882:(Fe,ce,r)=>{"use strict";r.d(ce,{u:()=>o});var C=r(34896),e=r(93020),d=r(93244),L=r(24112),P=r(31792);let o=(()=>{class f{messageService;injector;stateChangeEventEmitter=new C._w7;onlineSubscription;offlineSubscription;previousMessageId;state={connection:window.navigator.onLine};constructor(R,y){this.messageService=R,this.injector=y,this.checkNetworkState()}checkNetworkState(){this.onlineSubscription=(0,d.w)(window,"online").subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId);const R=this.messageService.info("igo.core.network.online.message","igo.core.network.online.title");this.previousMessageId=R.toastId,this.state.connection=!0,this.emitEvent()}),this.offlineSubscription=(0,d.w)(window,"offline").subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId);const R=this.messageService.info("igo.core.network.offline.message","igo.core.network.offline.title");this.previousMessageId=R.toastId,this.state.connection=!1,this.emitEvent()})}emitEvent(){this.stateChangeEventEmitter.emit(this.state)}ngOnDestroy(){try{this.offlineSubscription.unsubscribe(),this.onlineSubscription.unsubscribe()}catch{}}currentState(R=!0){return R?this.stateChangeEventEmitter.pipe((0,L.o)(300),(0,P.W)(this.state)):this.stateChangeEventEmitter.pipe((0,L.o)(300))}static \u0275fac=function(y){return new(y||f)(C.CoB(e.mi),C.CoB(C.zZn))};static \u0275prov=C.wxM({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()},84112:(Fe,ce,r)=>{"use strict";r.d(ce,{k$:()=>P});var C=r(34896),e=r(57880);let d=new C.UbH("routeServiceOptions"),P=(()=>{class o{router;route;options;constructor(h,R,y){this.router=h,this.route=R,this.options=Object.assign({},{centerKey:"center",zoomKey:"zoom",projectionKey:"projection",contextKey:"context",searchKey:"search",visibleOnLayersKey:"visiblelayers",visibleOffLayersKey:"invisiblelayers",directionsCoordKey:"routing",directionsOptionsKey:"routingOptions",toolKey:"tool",wmsUrlKey:"wmsUrl",wmsLayersKey:"wmsLayers",wmtsUrlKey:"wmtsUrl",wmtsLayersKey:"wmtsLayers",arcgisUrlKey:"arcgisUrl",arcgisLayersKey:"arcgisLayers",iarcgisUrlKey:"iarcgisUrl",iarcgisLayersKey:"iarcgisLayers",tarcgisUrlKey:"tarcgisUrl",tarcgisLayersKey:"tarcgisLayers",vectorKey:"vector"},y)}get queryParams(){let h=decodeURIComponent(location.search);if(h.includes("\xa2er=")){h=h.replace("\xa2er","&center");const R=h.slice(1).split("&").map(y=>y.split("=")).reduce((y,O)=>{const[x,T]=O.map(decodeURIComponent);return y[x]=T,y},{});this.router.navigate([],{queryParams:R})}return this.route.queryParams}static \u0275fac=function(R){return new(R||o)(C.CoB(e.E5),C.CoB(e.gV),C.CoB(d,8))};static \u0275prov=C.wxM({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})()},21720:(Fe,ce,r)=>{"use strict";r.d(ce,{kR:()=>L,Ab:()=>e,yQ:()=>f,Om:()=>d});var C=r(54844),e=function(h){return h.SESSION="Session",h.LOCAL="Local",h}(e||{}),d=function(h){return h.ADDED="Added",h.MODIFIED="Modified",h.REMOVED="Removed",h.CLEARED="Cleared",h}(d||{});class L{options;storageChange$=new C.g(void 0);constructor(R){this.options=R.getConfig("storage")||{key:"igo"}}get(R,y){let O;if((!y||y===e.SESSION)&&(O=sessionStorage.getItem(`${this.options.key}.${R}`)),(y===e.LOCAL||!O&&!y)&&(O=localStorage.getItem(`${this.options.key}.${R}`)),O)try{O=JSON.parse(O)}catch{}return O}set(R,y,O=e.LOCAL){const x=this.get(R,O);O===e.SESSION?sessionStorage.setItem(`${this.options.key}.${R}`,JSON.stringify(y)):localStorage.setItem(`${this.options.key}.${R}`,JSON.stringify(y));const T=this.get(R,O);T!==x&&this.storageChange$.next({key:R,scope:O,event:void 0!==x?d.MODIFIED:d.ADDED,previousValue:x,currentValue:T})}remove(R,y=e.LOCAL){const O=this.get(R,y);y===e.SESSION?sessionStorage.removeItem(`${this.options.key}.${R}`):localStorage.removeItem(`${this.options.key}.${R}`),this.storageChange$.next({key:R,scope:y,event:d.REMOVED,previousValue:O})}clear(R=e.LOCAL){R===e.SESSION?sessionStorage.clear():localStorage.clear(),this.storageChange$.next({scope:R,event:d.CLEARED})}}var P=r(9204),o=r(34896);let f=(()=>{class h extends L{config;constructor(y){super(y),this.config=y}static \u0275fac=function(O){return new(O||h)(o.CoB(P.aW))};static \u0275prov=o.wxM({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})()},28660:(Fe,ce,r)=>{"use strict";r.d(ce,{I:()=>e,S:()=>C});var C=function(d){return d.wms="wms",d.wmts="wmts",d.arcgisrest="esriJSON",d.imagearcgisrest="esriJSON",d.tilearcgisrest="esriJSON",d}(C||{}),e=function(d){return d.FeatureLayer="Feature Layer",d.RasterLayer="Raster Layer",d.GroupLayer="Group Layer",d}(e||{})},21780:(Fe,ce,r)=>{"use strict";r.d(ce,{S:()=>X});var C=r(21124),e=r(33712),d=r(43168),L=r(156),P=r(49240),o=r(36584),f=r(73592),h=r(61252),R=r(46184),y=r(44816),O=r(1296),x=r(21296),T=r(40604),a=r(51672),F=r(90916),A=r(14191),k=r(59324),W=r(49704),w=r(88824),te=r(28660),Z=r(34896),K=r(12268);class X{http;mapService;parsers={wms:new P.c,wmts:new o.c,esriJSON:new f.c};constructor(B,z){this.http=B,this.mapService=z}getWMSOptions(B){return this.getCapabilities("wms",B.url,B.params.VERSION).pipe((0,T.k)(I=>I?this.parseWMSOptions(B,I):void 0))}getWMTSOptions(B){return this.getCapabilities("wmts",B.url,B.version).pipe((0,T.k)(b=>b?this.parseWMTSOptions(B,b):void 0))}getCartoOptions(B){return this.http.jsonp("https://"+B.account+".carto.com/api/v2/viz/"+B.mapId+"/viz.json","callback").pipe((0,T.k)(c=>this.parseCartoOptions(B,c)))}getArcgisOptions(B){const z=B.url+"/"+B.layer+"?f=json",c=this.getCapabilities("arcgisrest",B.url),I=this.http.get(z);return(0,y.y)([I,c]).pipe((0,T.k)(b=>this.parseArcgisOptions(B,b[0],b[1])))}getImageArcgisOptions(B){const z=B.url+"/"+B.layer+"?f=json",c=B.url+"/legend?f=json",I=this.getCapabilities("imagearcgisrest",B.url),b=this.http.get(z),G=this.http.get(c).pipe((0,T.k)(D=>D),(0,a.a)(D=>(console.log("No legend associated with this Image Service"),(0,O.of)(D))));return(0,y.y)([b,G,I]).pipe((0,T.k)(D=>this.parseTileOrImageArcgisOptions(B,D[0],D[1],D[2])))}getTileArcgisOptions(B){const z=B.url+"/"+B.layer+"?f=json",c=B.url+"/legend?f=json",I=this.getCapabilities("tilearcgisrest",B.url),b=this.http.get(z),G=this.http.get(c).pipe((0,T.k)(D=>D),(0,a.a)(D=>(console.log("No legend associated with this Tile Service"),(0,O.of)(D))));return(0,y.y)([b,G,I]).pipe((0,T.k)(D=>this.parseTileOrImageArcgisOptions(B,D[0],D[1],D[2])))}getCapabilities(B,z,c){const I=new e.i4({fromObject:{request:"GetCapabilities",service:B.toUpperCase(),version:c||"1.3.0",_i:"true"}});let b;return b="esriJSON"===te.S[B]?this.http.get(z+"?f=json"):this.http.get(z,{params:I,responseType:"text"}),b.pipe((0,T.k)(G=>{if("esriJSON"===te.S[B])return G;if(String(G).toLowerCase().includes("serviceexception")&&String(G).toLowerCase().includes("access denied"))throw{error:{message:"Service error getCapabilities: Access is denied"}};return this.parsers[B].read(G)}),(0,a.a)(G=>{throw typeof G.error<"u"&&(G.error.caught=!0),G}))}parseWMSOptions(B,z){const I=this.findDataSourceInCapabilities(z.Capability.Layer,B.params.LAYERS);if(!I)throw{error:{message:"Layer not found"}};const b=I.DataURL?I.DataURL[0]:void 0,G=I.Abstract?I.Abstract:void 0,D=I.KeywordList?I.KeywordList:void 0;let g=I.queryable;const U=this.getTimeFilter(I),M=U&&Object.keys(U).length>0,H=I.Style?this.getStyle(I.Style):void 0;let s=!0;I.EX_GeographicBoundingBox?I.EX_GeographicBoundingBox.forEach((ae,le)=>{le<2&&(ae>180||ae<-180)&&(s=!1),le>=2&&(ae>90||ae<-90)&&(s=!1)}):s=!1;const ie=s?h.W0(I.EX_GeographicBoundingBox,"EPSG:4326",this.mapService.getMap().projection):void 0;let de;const fe=[W.cv.GEOJSON,W.cv.GEOJSON2,W.cv.GML3,W.cv.GML2,W.cv.JSON,W.cv.HTML];for(const ae of fe)if(-1!==z.Capability.Request.GetFeatureInfo.Format.indexOf(ae)){const le=Object.keys(W.cv).find(oe=>W.cv[oe]===ae);de=W.s5[le];break}de||(g=!1);const Se=d.Yv.removeUndefined({_layerOptionsFromSource:{title:I.Title,maxResolution:(0,k.bg)(I.MaxScaleDenominator),minResolution:(0,k.bg)(I.MinScaleDenominator),extent:ie,metadata:{url:b?b.OnlineResource:void 0,extern:!!b||void 0,abstract:G,keywordList:D},legendOptions:H},queryable:g,queryFormat:de,timeFilter:M?U:void 0,timeFilterable:!!M||void 0,minDate:M?U.min:void 0,maxDate:M?U.max:void 0,stepDate:M?U.step:void 0});return d.Yv.mergeDeep(Se,B)}parseWMTSOptions(B,z){const c=z.Contents.Layer.find(D=>D.Identifier===B.layer),I=(0,R.o)(z,B),b=Object.assign(I,B),G=d.Yv.removeUndefined({_layerOptionsFromSource:{title:c.Title}});return d.Yv.mergeDeep(G,b)}parseCartoOptions(B,z){const c=[],I=z.layers[1].options.layer_definition;I.layers.forEach(G=>{c.push({type:G.type.toLowerCase(),options:G.options,legend:G.legend})});const b=d.Yv.removeUndefined({config:{version:I.version,layers:c}});return d.Yv.mergeDeep(b,B)}parseArcgisOptions(B,z,c){const I=z.name;let b,G;b=z.drawingInfo?.renderer?z.drawingInfo.renderer:void 0,z.drawingInfo&&(G=(new w.y).generateStyle(z,"esriMeters"===z.units?"m":"degrees"));const D=new L.c({target:z.copyrightText});let g,U;if(z.timeInfo){const s=z.timeInfo.timeExtent;g=s[0]+","+s[1];const ie=new Date;ie.setTime(s[0]);const de=new Date;de.setTime(s[1]),U={min:ie.toUTCString(),max:de.toUTCString(),range:!0,type:A.U.DATETIME,style:A.D.CALENDAR}}const M=Object.assign({},{style:G,LAYERS:B.layer?"show:"+B.layer:void 0,time:g}),H=d.Yv.removeUndefined({params:M,_layerOptionsFromSource:{title:I,minResolution:(0,k.bg)(z.maxScale),maxResolution:(0,k.bg)(z.minScale),metadata:{extern:!1,abstract:z.description||c.serviceDescription}},legendInfo:b,timeFilter:U,sourceFields:z.fields,queryTitle:z.displayField});return H.attributions=D,d.Yv.mergeDeep(H,B)}parseTileOrImageArcgisOptions(B,z,c,I){const b=z.name,G=c.layers?c.layers.find(s=>s.layerName===b):void 0,D=new L.c({target:z.copyrightText});let g,U;if(z.timeInfo){const s=z.timeInfo.timeExtent;g=s[0]+","+s[1];const ie=new Date;ie.setTime(s[0]);const de=new Date;de.setTime(s[1]),U={min:ie.toUTCString(),max:de.toUTCString(),range:!0,type:A.U.DATETIME,style:A.D.CALENDAR}}const M=Object.assign({},{LAYERS:B.layer?"show:"+B.layer:void 0,time:g}),H=d.Yv.removeUndefined({params:M,_layerOptionsFromSource:{title:b,minResolution:(0,k.bg)(z.maxScale),maxResolution:(0,k.bg)(z.minScale),metadata:{extern:!1,abstract:z.description||I.serviceDescription}},legendInfo:G,timeFilter:U,sourceFields:z.fields,queryTitle:z.displayField});return H.attributions=D,d.Yv.mergeDeep(H,B)}findDataSourceInCapabilities(B,z){if(Array.isArray(B)){let c;return B.find(I=>(c=this.findDataSourceInCapabilities(I,z),void 0!==c),this),c}return B.Layer?this.findDataSourceInCapabilities(B.Layer,z):B.Name&&B.Name===z?B:void 0}getTimeFilter(B){let z;if(B.Dimension){const c={};if(z=B.Dimension[0],z.values){const I=z.values.split("/");c.min=void 0!==I[0]?I[0]:void 0,c.max=void 0!==I[1]?I[1]:void 0,c.step=void 0!==I[2]?I[2]:void 0}return z.default&&(c.value=z.default),c}}getStyle(B){return{stylesAvailable:B.map(I=>({name:I.Name,title:I.Title})).filter((I,b,G)=>G.findIndex(D=>D.name===I.name)===b)}}static \u0275fac=function(z){return new(z||X)(Z.CoB(e.KK),Z.CoB(K.u))};static \u0275prov=Z.wxM({token:X,factory:X.\u0275fac,providedIn:"root"})}(0,C.UN)([(0,F.w)({maxCacheCount:20}),(0,C.YR)("design:type",Function),(0,C.YR)("design:paramtypes",[Object]),(0,C.YR)("design:returntype",x._)],X.prototype,"getArcgisOptions",null),(0,C.UN)([(0,F.w)({maxCacheCount:20}),(0,C.YR)("design:type",Function),(0,C.YR)("design:paramtypes",[Object]),(0,C.YR)("design:returntype",x._)],X.prototype,"getImageArcgisOptions",null),(0,C.UN)([(0,F.w)({maxCacheCount:20}),(0,C.YR)("design:type",Function),(0,C.YR)("design:paramtypes",[Object]),(0,C.YR)("design:returntype",x._)],X.prototype,"getTileArcgisOptions",null),(0,C.UN)([(0,F.w)({maxCacheCount:20}),(0,C.YR)("design:type",Function),(0,C.YR)("design:paramtypes",[String,String,String]),(0,C.YR)("design:returntype",x._)],X.prototype,"getCapabilities",null)},61200:(Fe,ce,r)=>{"use strict";r.d(ce,{O:()=>A});var C=r(58752),e=r(24708),d=r(93020),L=r(43168),P=r(54844),o=r(21296),f=r(1296),h=r(44816),R=r(51672),y=r(40604),O=r(21780),x=r(3544),T=r(92344),a=r(34896);class F{}let A=(()=>{class k{capabilitiesService;optionsService;wfsDataSourceService;languageService;messageService;authInterceptor;datasources$=new P.g([]);constructor(w,te,Z,K,X,V){this.capabilitiesService=w,this.optionsService=te,this.wfsDataSourceService=Z,this.languageService=K,this.messageService=X,this.authInterceptor=V}createAsyncDataSource(w,te){if(!w.type)throw console.error(w),new Error("Datasource needs a type");let Z;switch(w.type.toLowerCase()){case"osm":Z=this.createOSMDataSource(w);break;case"vector":Z=this.createFeatureDataSource(w);break;case"wfs":Z=this.createWFSDataSource(w);break;case"wms":const K=w;L.Yv.removeDuplicateCaseInsensitive(K.params),Z=this.createWMSDataSource(K,te);break;case"wmts":Z=this.createWMTSDataSource(w);break;case"xyz":Z=this.createXYZDataSource(w);break;case"tiledebug":Z=this.createTileDebugDataSource(w);break;case"carto":Z=this.createCartoDataSource(w);break;case"arcgisrest":Z=this.createArcGISRestDataSource(w,te);break;case"imagearcgisrest":Z=this.createArcGISRestImageDataSource(w,te);break;case"websocket":Z=this.createWebSocketDataSource(w);break;case"mvt":Z=this.createMVTDataSource(w);break;case"tilearcgisrest":Z=this.createTileArcGISRestDataSource(w,te);break;case"cluster":Z=this.createClusterDataSource(w);break;default:throw console.error(w),new Error("Invalid datasource type")}return this.datasources$.next(this.datasources$.value.concat([Z])),Z}createOSMDataSource(w){return new o._(te=>te.next(new x.yC(w)))}createFeatureDataSource(w){return new o._(te=>te.next(new x.EB(w)))}createWebSocketDataSource(w){return new o._(te=>te.next(new x.cR(w)))}createWFSDataSource(w){return new o._(te=>te.next(new x.ak(w,this.wfsDataSourceService,this.authInterceptor)))}createWMSDataSource(w,te){const Z=[];return w.optionsFromCapabilities&&window.navigator.onLine&&Z.push(this.capabilitiesService.getWMSOptions(w).pipe((0,R.a)(K=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:w.params.LAYERS}),K}))),this.optionsService&&w.optionsFromApi&&window.navigator.onLine&&Z.push(this.optionsService.getWMSOptions(w,te).pipe((0,R.a)(K=>(K.error.toDisplay=!0,K.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),K.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,f.of)({}))))),Z.push((0,f.of)(w)),(0,h.y)(Z).pipe((0,y.k)(K=>{const X=K.reduce((V,B)=>L.Yv.mergeDeep(V,B));return new x.CK(X,this.wfsDataSourceService)}),(0,R.a)(()=>(0,f.of)(void 0)))}createWMTSDataSource(w){return w.optionsFromCapabilities&&window.navigator.onLine?this.capabilitiesService.getWMTSOptions(w).pipe((0,y.k)(te=>te?new x.m6(te):void 0),(0,R.a)(()=>(this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:w.layer}),(0,f.of)(void 0)))):new o._(te=>te.next(new x.m6(w)))}createXYZDataSource(w){return new o._(te=>te.next(new x.nA(w)))}createTileDebugDataSource(w){return new o._(te=>te.next(new x.Uv(w)))}createCartoDataSource(w){return w.mapId?this.capabilitiesService.getCartoOptions(w).pipe((0,y.k)(te=>new x.aI(te))):new o._(te=>te.next(new x.aI(w)))}createArcGISRestDataSource(w,te){const Z=[];return window.navigator.onLine&&Z.push(this.capabilitiesService.getArcgisOptions(w).pipe((0,R.a)(K=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:w.layer}),K}))),this.optionsService&&w.optionsFromApi&&window.navigator.onLine&&Z.push(this.optionsService.getArcgisRestOptions(w,te).pipe((0,R.a)(K=>(K.error.toDisplay=!0,K.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),K.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,f.of)({}))))),Z.push((0,f.of)(w)),(0,h.y)(Z).pipe((0,y.k)(K=>{const X=K.reduce((V,B)=>L.Yv.mergeDeep(V,B));return new x.IH(X)}),(0,R.a)(()=>(0,f.of)(void 0)))}createArcGISRestImageDataSource(w,te){const Z=[];return window.navigator.onLine&&Z.push(this.capabilitiesService.getImageArcgisOptions(w).pipe((0,R.a)(K=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:w.params.LAYERS}),K}))),this.optionsService&&w.optionsFromApi&&window.navigator.onLine&&Z.push(this.optionsService.getArcgisRestOptions(w,te).pipe((0,R.a)(K=>(K.error.toDisplay=!0,K.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),K.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,f.of)({}))))),Z.push((0,f.of)(w)),(0,h.y)(Z).pipe((0,y.k)(K=>{const X=K.reduce((V,B)=>L.Yv.mergeDeep(V,B));return new x.yA(X)}),(0,R.a)(()=>(0,f.of)(void 0)))}createTileArcGISRestDataSource(w,te){const Z=[];return window.navigator.onLine&&Z.push(this.capabilitiesService.getImageArcgisOptions(w).pipe((0,R.a)(K=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:w.params.LAYERS}),K}))),this.optionsService&&w.optionsFromApi&&window.navigator.onLine&&Z.push(this.optionsService.getArcgisRestOptions(w,te).pipe((0,R.a)(K=>(K.error.toDisplay=!0,K.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),K.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),(0,f.of)({}))))),Z.push((0,f.of)(w)),(0,h.y)(Z).pipe((0,y.k)(K=>{const X=K.reduce((V,B)=>L.Yv.mergeDeep(V,B));return new x.W4(X)}),(0,R.a)(()=>(0,f.of)(void 0)))}createMVTDataSource(w){return new o._(te=>te.next(new x.cv(w)))}createClusterDataSource(w){return new o._(te=>te.next(new x.a(w)))}static \u0275fac=function(te){return new(te||k)(a.CoB(O.S),a.CoB(F,8),a.CoB(T.Q),a.CoB(e.ov),a.CoB(d.mi),a.CoB(C.kT))};static \u0275prov=a.wxM({token:k,factory:k.\u0275fac,providedIn:"root"})}return k})()},93176:(Fe,ce,r)=>{"use strict";r.d(ce,{a:()=>L});var C=r(43168),e=r(3784),d=r(67732);class L extends d.E{createOlSource(){return this.options.format=this.getSourceFormatFromOptions(this.options),this.options.source=super.createOlSource(),new e.c(this.options)}generateId(){return(0,C.uq)()}onUnwatch(){}}},94052:(Fe,ce,r)=>{"use strict";r.d(ce,{C:()=>e});var C=r(47864);class e{options;dataService;id;ol;legend;constructor(L={},P){this.options=L,this.dataService=P,this.options=L,this.id=this.options.id||this.generateId(),this.ol=this.createOlSource()}generateId(){return(0,C.KC)(this.options)}getLegend(L,P){return this.legend?this.legend:[]}setLegend(L){return this.legend=L.url?[{url:L.url}]:L.html?[{html:L.html}]:[],this.legend}}},67732:(Fe,ce,r)=>{"use strict";r.d(ce,{E:()=>P});var C=r(12396),e=r(83900),d=r(28772),L=r(94052);class P extends L.C{createOlSource(){const f={format:this.getSourceFormatFromOptions(this.options)};return new d.c(Object.assign(f,this.options))}getSourceFormatFromOptions(f){if(f.format)return f.format;let h;const R=f.formatType;if(R){if(h=e[R],void 0===h)throw new Error("Invalid vector source format ${formatType}.")}else h=C.c;const y=f.formatOptions;let O;return O=y?new h(y):new h,O}onUnwatch(){}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}}},3544:(Fe,ce,r)=>{"use strict";r.d(ce,{IH:()=>Z,aI:()=>w,a:()=>H.a,EB:()=>e.E,yA:()=>X,cv:()=>M,yC:()=>L,W4:()=>V.W,Uv:()=>c,ak:()=>O,CK:()=>T.C,m6:()=>A,cR:()=>I,nA:()=>o});var C=r(94052),e=r(67732),d=r(19860);class L extends C.C{createOlSource(){return this.options.url||(this.options.url="https://tile.openstreetmap.org/{z}/{x}/{y}.png"),new d.c(this.options)}onUnwatch(){}}var P=r(49228);class o extends C.C{createOlSource(){return new P.c(this.options)}onUnwatch(){}}var f=r(91784),h=r(28772),R=r(40912),y=r(38084);class O extends C.C{options;wfsService;authInterceptor;set ogcFilters(ie){this.options.ogcFilters=ie}get ogcFilters(){return this.options.ogcFilters}constructor(ie,de,fe){super((0,y.w$)(ie,"wfs")),this.options=ie,this.wfsService=de,this.authInterceptor=fe;const Se=this.options.ogcFilters,ae=this.options.paramsWFS.fieldNameGeometry||y.k3,le=new R.S;this.options.ogcFilters=le.defineOgcFiltersDefaultOptions(Se,ae),this.options.ogcFilters.enabled&&this.options.ogcFilters.editable&&(ie.sourceFields||[]).filter(oe=>!oe.values).length>0&&this.wfsService.getSourceFieldsFromWFS(this.options),Se?.pushButtons&&(Se.pushButtons.selectorType="pushButton"),Se?.checkboxes&&(Se.checkboxes.selectorType="checkbox"),Se?.radioButtons&&(Se.radioButtons.selectorType="radioButton"),Se?.select&&(Se.select.selectorType="select"),Se?.autocomplete&&(Se.autocomplete.selectorType="autocomplete"),this.setOgcFilters(this.options.ogcFilters,!0)}createOlSource(){return new h.c({format:(0,y.So)(this.options),strategy:f.OK})}setOgcFilters(ie,de=!1){this.ogcFilters=ie,de&&this.ol.notify("ogcFilters",this.ogcFilters)}onUnwatch(){}}r(92344);var T=r(21808),a=r(46184),F=r(43940);class A extends C.C{constructor(ie){super(ie)}createOlSource(){const ie=Object.assign({tileGrid:(0,F.g)(this.options.projection)},this.options);return new a.c(ie)}onUnwatch(){}}var k=r(51008),W=r(49704);class w extends C.C{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:W.Il.BLANK}createOlSource(){const de=Object.assign({crossOrigin:this.options.crossOrigin?this.options.crossOrigin:"anonymous"},this.options);return new k.c(de)}getLegend(){const ie=super.getLegend();if(ie.length>0)return ie;let de="<table>";if(this.options.config.layers[0].legend)return this.options.config.layers[0].legend.items.forEach(fe=>{!0===fe.visible&&(de+='<tr><td><p><font size="5" color="'+fe.value+'"> &#9679</font></p></td><td>'+fe.name+"</td></tr>")}),de+="</table>",[{html:de}];{const fe=this.options.config.layers[0].options,Se=["polygon-fill:","marker-fill:","shield-fill:","building-fill:","line-color:"];for(const ae of Se)if(fe.cartocss.includes(ae)){const le=fe.cartocss.split(ae).pop(),oe=le.substr(0,le.indexOf(";"));if(oe.includes("ramp")){const se=oe.split(", (")[1].split(","),me=oe.split(", (")[2].split(",");for(let be=0;be<se.length;be++)se[be]=se[be].replace(/("|\))/g,""),me[be]=me[be].replace(/("|\))/g,""),"="===me[be].replace(/\s+/g,"")&&(me[be]="Autres"),de+='<tr><td><p><font size="5" color="'+se[be]+'"> &#9679</font></p></td><td>'+me[be]+"</td></tr>";break}de+='<tr><td><p><font size="5" color="'+oe+'"> &#9679</font></p></td><td>'+(fe.layer_name?fe.layer_name:"")+"</td></tr>";break}return de+="</table>",[{html:de}]}}onUnwatch(){}}var te=r(73592);class Z extends C.C{createOlSource(){const ie=new te.c;return new h.c({attributions:this.options.params.attributions,overlaps:!1,format:ie,url:function(de,fe,Se){const ae=this.options.url+"/"+this.options.layer+"/query/",oe=["f=json",`geometry=${encodeURIComponent('{"xmin":'+de[0]+',"ymin":'+de[1]+',"xmax":'+de[2]+',"ymax":'+de[3]+',"spatialReference":{"wkid":102100}}')}`,"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"];return this.options.params.time&&oe.push(`time=${this.options.params.time}`),this.options.params.customParams&&this.options.params.customParams.forEach(se=>{oe.push(se)}),`${ae}?${oe.join("&")}`}.bind(this),strategy:f.OK})}getLegend(){const ie=this.options.legendInfo,de=super.getLegend();if(void 0===ie||de.length>0)return de;if(!ie)return;let Se,ae,le,fe="<table>";if(ie.legend)for(const oe of ie.legend)Se=this.htmlImgSrc(oe.contentType,oe.imageData),ae=oe.label?oe.label.replace("<Null>","Null"):"",fe+="<tr><td align='left'><img src=\""+Se+'" alt =\'\' /></td><td class="mat-typography">'+ae+"</td></tr>";else if("uniqueValue"===ie.type)for(const oe of ie.uniqueValueInfos)ae=oe.label.replace("<Null>","Null"),"esriPMS"===oe.symbol.type?(Se=this.htmlImgSrc(oe.symbol.contentType,oe.symbol.imageData),fe+="<tr><td align='left'><img src=\""+Se+'" alt =\'\' /></td><td class="mat-typography">'+ae+"</td></tr>"):"esriPMS"!==oe.symbol.type&&(le=this.createSVG(oe.symbol),fe+="<tr><td align='left'>"+le+'</td><td class="mat-typography">'+ae+"</td></tr>");else"simple"===ie.type&&(ae=ie.label?ie.label.replace("<Null>","Null"):"","esriPMS"===ie.symbol.type?(Se=this.htmlImgSrc(ie.symbol.contentType,ie.symbol.imageData),fe+="<tr><td align='left'><img src=\""+Se+'" alt =\'\' /></td><td class="mat-typography">'+ae+"</td></tr>"):"esriPMS"!==ie.symbol.type&&(le=this.createSVG(ie.symbol),fe+="<tr><td align='left'>"+le+'</td><td class="mat-typography">'+ae+"</td></tr>"));return fe+="</table>",[{html:fe}]}htmlImgSrc(ie,de){return`data:${ie};base64,${de}`}createSVG(ie){let de="";const fe=ie.color?ie.color:[0,0,0,0];if("esriSLS"===ie.type){const ae="stroke:rgba("+fe[0]+","+fe[1]+","+fe[2]+","+fe[3]+")",le="stroke-width:"+(ie.width?ie.width:0);"esriSLSSolid"===ie.style?de='<svg height="30" width="30"><line x1="0" y1="15" x2="30" y2="15" style="'+ae+";"+le+'"/></svg>':"esriSLSDash"===ie.style&&(de='<svg height="30" width="30"><line x1="0" y1="15" x2="30" y2="15" style="'+ae+";"+le+'" stroke-dasharray="5,5"/></svg>')}else if("esriSMSCircle"===ie.style||"esriSFSSolid"===ie.style){const Se=ie.outline.color,oe="stroke:rgba("+Se[0]+","+Se[1]+","+Se[2]+","+Se[3]+")",se="stroke-width:"+ie.outline.width,me="fill:rgba("+fe[0]+","+fe[1]+","+fe[2]+","+fe[3]+")";de="esriSMSCircle"===ie.style?'<svg height="30" width="30"><circle cx="15" cy="15" r="'+ie.size/2+'" style="'+oe+";"+se+";"+me+'"/></svg>':'<svg height="30" width="30"><rect x="5" y="5" width="20" height="20" style ="'+oe+";"+se+";"+me+'"/></svg>'}return de}onUnwatch(){}}var K=r(38952);class X extends C.C{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:W.Il.BLANK}createOlSource(){const ie=void 0===this.options.layer?this.options.params:Object.assign({LAYERS:`show:${this.options.layer}`},this.options.params);return"object"==typeof ie.renderingRule&&(ie.renderingRule=JSON.stringify(ie.renderingRule)),new K.c({ratio:1,params:ie,url:this.options.url})}getLegend(){const ie=this.options.legendInfo,de=super.getLegend();if(void 0===ie||void 0===this.options.layer||de.length>0)return de;if(!ie)return;let fe="<table>";for(const Se of ie.legend)fe+=`<tr><td align='left'><img src="${this.options.url}/${ie.layerId}/images/${Se.url}" alt ='' /></td><td class="mat-typography">`+Se.label.replace("<Null>","Null")+"</td></tr>";return fe+="</table>",[{html:fe}]}onUnwatch(){}}var V=r(92424),B=r(19508),z=r(48720);class c extends C.C{createOlSource(){const ie=JSON.parse(JSON.stringify(this.options));return this.options.tileGrid&&(delete ie.tileGrid,ie.tileGrid=new z.c(this.options.tileGrid)),new B.c(ie)}onUnwatch(){}}class I extends e.E{ws;createOlSource(){return this.createWebSocket(),this.options.format=this.getSourceFormatFromOptions(this.options),super.createOlSource()}createWebSocket(){this.ws=new WebSocket(this.options.url),this.ws.onmessage=this.onMessage.bind(this),this.options.onclose&&(this.ws.onclose=this.onClose.bind(this)),this.options.onerror&&(this.ws.onerror=this.onError.bind(this)),this.options.onopen&&(this.ws.onopen=this.onOpen.bind(this))}onMessage(ie){const de=this.options.format.readFeature(ie.data);switch(this.options.onmessage){case"update":const fe=this.ol.getFeatureById(de.getId());fe&&this.ol.removeFeature(fe),this.ol.addFeature(de);break;case"delete":this.ol.clear(!0),this.ol.addFeature(de);break;default:this.ol.addFeature(de)}}onClose(ie){}onError(ie){}onOpen(ie){}onUnwatch(){this.ws.close()}}var b=r(43168),G=r(58264),D=r(99668),g=r(19076),U=r(11772);class M extends C.C{createOlSource(){let ie;return ie="feature"===this.options.featureClass?new D.c({featureClass:G.c}):new D.c,this.options.format=ie,new g.c(this.options)}generateId(){return this.options.url?U.Cy.hashStr("mvt"+this.options.url):(0,b.uq)()}onUnwatch(){}}var H=r(93176)},92424:(Fe,ce,r)=>{"use strict";r.d(ce,{W:()=>L});var C=r(96120),e=r(49704),d=r(94052);class L extends d.C{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:e.Il.BLANK}createOlSource(){return new C.c(this.options)}getLegend(){const o=this.options.legendInfo,f=super.getLegend();if(void 0===o||void 0===this.options.layer||f.length>0)return f;if(!o)return;let h="<table>";for(const R of o.legend)h+=`<tr><td align='left'><img src="${this.options.url}/${o.layerId}/images/${R.url}" alt ='' /></td><td class="mat-typography">`+R.label.replace("<Null>","Null")+"</td></tr>";return h+="</table>",[{html:h}]}onUnwatch(){}}},92344:(Fe,ce,r)=>{"use strict";r.d(ce,{Q:()=>R});var C=r(21296),e=r(1296),d=r(35876),L=r(10211);class P{}var o=r(38084),f=r(34896),h=r(33712);let R=(()=>{class y extends P{http;constructor(x){super(),this.http=x}getData(){return console.log("This is defining a data service."),"This is defining a data service."}getSourceFieldsFromWFS(x){x.sourceFields&&0!==x.sourceFields.length?this.defineFieldAndValuefromWFS(x).subscribe(T=>{x.sourceFields.forEach(a=>{void 0===a.alias&&(a.alias=a.name),(void 0===a.values||0===a.values.length)&&(a.values=T.find(F=>F.name===a.name).values)})}):(x.sourceFields=[],this.defineFieldAndValuefromWFS(x).subscribe(T=>{x.sourceFields=T}))}wfsGetFeature(x,T=o.G4,a=o.sn,F,A=0,k=!1){const w=(0,o.as)(x,T,a,F,A,k).find(Z=>"getfeature"===Z.name).value,te=x.paramsWFS.outputFormat;return k||o._K.test(te)||!te?this.http.get(w,{responseType:"text"}):this.http.get(w)}defineFieldAndValuefromWFS(x){return new C._(T=>{const a=[];let F,A,k,W,w;W=(0,o.So)(x);const te=JSON.parse(JSON.stringify(x));delete te.paramsWFS.outputFormat,delete te.formatOptions,w=(0,o.So)(te);let Z=x.sourceFields?.filter(K=>!K.values).map(K=>K.name);this.wfsGetFeature(x,1,void 0,void 0,0,!0).pipe((0,L.m)(K=>String(K).toLowerCase().includes("exception")?(0,e.of)(!1):(0,e.of)(!0)),(0,L.m)(K=>this.wfsGetFeature(x,1).pipe((0,L.m)(X=>{const V=W.readFeatures(X);F=V[0].getKeys(),(x.sourceFields||0===x.sourceFields.length)&&(Z=F),A=F.filter(c=>Z.includes(c)&&c!==V[0].getGeometryName()&&!c.match(/boundedby/gi)),k=A.join(",");const B=[];let z=0;if(!K&&"2.0.0"===x.paramsWFS.version&&x.paramsWFS.maxFeatures>o.G4){for(;z<x.paramsWFS.maxFeatures;)B.push(this.wfsGetFeature(x,1e3,x.paramsWFS.srsName,k,z)),z+=1e3;w=W}else B.push(this.wfsGetFeature(x,x.paramsWFS.maxFeatures||o.G4,x.paramsWFS.srsName,k,0,!0));return(0,d.E)(B)})))).subscribe(K=>{let X=[];K.map(V=>{const B=w.readFeatures(V);X=X.concat(B)}),this.built_properties_value(X).forEach(V=>{a.push(V)}),T.next(a),T.complete()})})}built_properties_value(x){if(0===x.length)return[];const T=Object.assign({},x[0].getProperties());delete T[x[0].getGeometryName()],delete T.boundedBy;const a=[];for(const F in T)if(T.hasOwnProperty(F)){const A="object"==typeof x[0].get(F)?void 0:typeof x[0].get(F);a.push({name:F,alias:F,type:A,values:[T[F]]})}return x.every(F=>{const A=F.getProperties();for(const k in A)A.hasOwnProperty(k)&&k in T&&a.filter(W=>W.name===k).forEach(W=>{-1===W.values.indexOf(A[k])&&W.values.push(A[k])});return!0}),a}static \u0275fac=function(T){return new(T||y)(f.CoB(h.KK))};static \u0275prov=f.wxM({token:y,factory:y.\u0275fac,providedIn:"root"})}return y})()},21808:(Fe,ce,r)=>{"use strict";r.d(ce,{C:()=>h});var C=r(43168),e=r(45804),d=r(54844),L=r(40912),P=r(49704),o=r(94052),f=r(38084);class h extends o.C{options;wfsService;get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:P.Il.BLANK}set ogcFilters(y){this.options.ogcFilters=y}get ogcFilters(){return this.options.ogcFilters}set timeFilter(y){this.options.timeFilter=y}get timeFilter(){return this.options.timeFilter}timeFilter$=new d.g(void 0);constructor(y,O){super(y),this.options=y,this.wfsService=O;const x=y.params,T=x.DPI||96;x.DPI=T,x.MAP_RESOLUTION=T,x.FORMAT_OPTIONS="dpi:"+T,y.refreshIntervalSec&&y.refreshIntervalSec>0&&setInterval(()=>{this.refresh()},1e3*y.refreshIntervalSec);let a=f.k3;if(y.paramsWFS){const w=(0,f.w$)(y,"wms");C.Yv.mergeDeep(y.paramsWFS,w.paramsWFS),a=y.paramsWFS.fieldNameGeometry||a,y.download=Object.assign({},y.download,{dynamicUrl:this.buildDynamicDownloadUrlFromParamsWFS(y)})}y.sourceFields&&0!==y.sourceFields.length?y.sourceFields.forEach(w=>{w.alias=w.alias?w.alias:w.name}):y.sourceFields=[];const F=y.ogcFilters,A=new L.S;F?(F.advancedOgcFilters=!(F.pushButtons||F.checkboxes||F.radioButtons||F.select||F.autocomplete),F.advancedOgcFilters&&F.filters&&F.filters.calendarModeYear&&(F.advancedOgcFilters=!1),F.pushButtons&&(F.pushButtons.selectorType="pushButton"),F.checkboxes&&(F.checkboxes.selectorType="checkbox"),F.radioButtons&&(F.radioButtons.selectorType="radioButton"),F.select&&(F.select.selectorType="select"),F.autocomplete&&(F.autocomplete.selectorType="autocomplete")):y.ogcFilters=A.defineOgcFiltersDefaultOptions(F,a,"wms"),x.LAYERS.split(",").length>1&&F&&F.enabled&&(console.log("*******************************"),console.log("BE CAREFULL, YOUR WMS LAYERS ("+x.LAYERS+") MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! "),console.log("*******************************")),y.paramsWFS&&F&&F.enabled&&F.editable&&(y.sourceFields||[]).filter(w=>!w.values).length>0&&this.wfsService.getSourceFieldsFromWFS(y);const k=A.handleOgcFiltersAppliedValue(y,a);x.FILTER=k,this.ol.updateParams({FILTER:x.FILTER}),this.setOgcFilters(F,!0);const W=y;W?.timeFilterable&&W?.timeFilter&&this.setTimeFilter(W.timeFilter,!0)}refresh(){this.ol.updateParams({igoRefresh:Math.random()})}buildDynamicDownloadUrlFromParamsWFS(y){return(0,f.as)(y).find(T=>"getfeature"===T.name).value}createOlSource(){return new e.c(Object.assign({ratio:1},this.options))}setOgcFilters(y,O=!1){this.ogcFilters=y,O&&this.ol.notify("ogcFilters",this.ogcFilters)}setTimeFilter(y,O=!1){this.timeFilter=y,O&&(this.timeFilter$.next(this.timeFilter),this.ol.notify("timeFilter",this.ogcFilters))}getLegend(y,O){let x=super.getLegend();if(x.length>0&&void 0===y&&!O?.scale)return x;let a,T=!1;O?.size&&O?.extent&&O?.projection&&this.options.contentDependentLegend&&(a="1.3.0"===this.params.VERSION||void 0===this.params.VERSION?"CRS":"SRS",T=!0);const F=this.params;let A=[];void 0!==F.LAYERS&&(A=F.LAYERS.split(","));const k=this.options.url.replace(/\?$/,""),W=["REQUEST=GetLegendGraphic","SERVICE=WMS","FORMAT=image/png","SLD_VERSION=1.1.0",`VERSION=${F.VERSION||"1.3.0"}`];return void 0!==y&&W.push(`STYLE=${y}`),void 0!==O?.scale&&W.push(`SCALE=${O.scale}`),T&&(W.push(`WIDTH=${O.size[0]}`),W.push(`HEIGHT=${O.size[1]}`),W.push(`BBOX=${O.extent.join(",")}`),W.push(`${a}=${O.projection}`)),x=A.map(w=>{const te=k.match(/\?/)?"&":"?";return{url:`${k}${te}${W.join("&")}&LAYER=${w}`,title:A.length>1?w:void 0,currentStyle:void 0===y?void 0:y}}),x}onUnwatch(){}}},38084:(Fe,ce,r)=>{"use strict";r.d(ce,{G4:()=>F,So:()=>X,_K:()=>W,as:()=>Z,k3:()=>k,sn:()=>a,w$:()=>K,yK:()=>te});var C=r(11544),e=r(83900),d=r(58288),L=r(12396),P=r(73592),o=r(79084),f=r(10416),h=r(17439),R=r(95456),y=r(14984),O=r(61972),x=r(1676),T=r(40912);const a="EPSG:3857",F=5e3,A="2.0.0",k="geometry",W=new RegExp(/(.*)?gml(.*)?/gi);function te(V,B,z,c,I){const b=V.paramsWFS,G=Z(V,void 0,V.paramsWFS.srsName);let D;c?.enabled&&(D=c?.filters);const g=new T.S,U=g.buildFilter(D,B,z,c?.geometryName,V);let M=g.handleOgcFiltersAppliedValue(V,c?.geometryName,B,z),H="filter";M||(H="bbox",M=B.join(",")+","+z.getCode()),b.xmlFilter=c?.advancedOgcFilters?U:`${H}=${M}`;let s=G.find(de=>"getfeature"===de.name).value;return s=/(filter|bbox)=.*/gi.test(b.xmlFilter)?`${s}&${b.xmlFilter}`:s,V.download=Object.assign({},V.download,{dynamicUrl:s}),I&&(s+=`$&_t${(new Date).getTime()}`),s.replace(/&&/g,"&")}function Z(V,B,z,c,I=0,b=!1){const G="2.0.0",D=V.urlWfs,g=V.paramsWFS,U=B||F,M=g.version===G?`startIndex=${I}`:"",H=z||a;let s=g.outputFormat?`outputFormat=${g.outputFormat}`:"",ie=g.version?`version=${g.version}`:`version=${A}`;const fe=`${g.version===G?"typenames":"typename"}=${g.featureTypes}`,Se=g.version===G?"count":"maxFeatures";let ae=B?`${Se}=${U}`:g.maxFeatures?`${Se}=${g.maxFeatures}`:`${Se}=${U}`;b&&(s="",ie="version=1.1.0",ae=ae.replace("count","maxFeatures"));const le=z?`srsname=${H}`:g.srsName?"srsname="+g.srsName:`srsname=${H}`;let oe="",se="";c&&(oe=`propertyName=${c}`,se=`valueReference=${c}`);const me=V.sourceFields;if(!oe&&me&&me.length>0){const Ue=[];V.sourceFields.forEach(St=>{Ue.push(St.name)}),oe=`propertyName=${Ue.join(",")},${g.fieldNameGeometry}`}const be=-1===D.indexOf("?")?"?":"&";let qe=`${D}${be}service=WFS&request=GetFeature&${ie}&${fe}&`;qe+=`${s}&${le}&${ae}&${oe}&${M}`;let nt=`${D}?service=WFS&request=GetPropertyValue&version=${G}&${fe}&`;return nt+=`&${ae}&${se}`,[{name:"outputformat",value:s},{name:"version",value:ie},{name:"typename",value:fe},{name:"count",value:ae},{name:"srsname",value:le},{name:"propertyname",value:oe},{name:"valuereference",value:se},{name:"getcapabilities",value:`${D}${be}service=WFS&request=GetCapabilities&${ie}`.replace(/&&/g,"&")},{name:"getfeature",value:qe.replace(/&&/g,"&")},{name:"getpropertyvalue",value:nt.replace(/&&/g,"&")}]}function K(V,B){B&&"wfs"===B&&(V.paramsWFS=V.params);const z=V.paramsWFS;let c;return V.urlWfs=V.urlWfs||V.url,z.version=z.version||A,z.fieldNameGeometry=z.fieldNameGeometry||k,z.maxFeatures=z.maxFeatures||F,z.outputFormat&&(c=z.outputFormat),(W.test(c)||!c)&&(z.version="1.1.0"),Object.assign({},V)}function X(V){const B=V;let z;const c=B.paramsWFS.outputFormat?B.paramsWFS.outputFormat:void 0;return c?e[c]?(z=e[c],new z(B.formatOptions)):c.toLowerCase().match("gml2")?(z=C.c,new z({...B.formatOptions,gmlFormat:R.c})):c.toLowerCase().match("gml32")?(z=C.c,new z({...B.formatOptions,gmlFormat:O.c})):c.toLowerCase().match("gml3")?(z=C.c,new z({...B.formatOptions,gmlFormat:y.c})):c.toLowerCase().match("topojson")?(z=d.c,new z(B.formatOptions)):c.toLowerCase().match("geojson")?(z=L.c,new z(B.formatOptions)):c.toLowerCase().match("esrijson")?(z=P.c,new z(B.formatOptions)):c.toLowerCase().match("json")?(z=L.c,new z(B.formatOptions)):c.toLowerCase().match("gpx")?(z=o.c,new z(B.formatOptions)):c.toLowerCase().match("WKT")?(z=f.c,new z(B.formatOptions)):c.toLowerCase().match("osmxml")?(z=x.c,new z(B.formatOptions)):c.toLowerCase().match("kml")?(z=h.cp,new z(B.formatOptions)):new z:(z=C.c,new z(B.formatOptions))}},43940:(Fe,ce,r)=>{"use strict";r.d(ce,{g:()=>L});var C=r(94448),e=r(61252),d=r(27984);function L(P){const f=e._M(P||"EPSG:3857").getExtent(),h=(0,C.K6)(f)/256,R=new Array(20),y=new Array(20);for(let O=0;O<20;++O)R[O]=h/Math.pow(2,O),y[O]=O;return new d.c({origin:(0,C.Iq)(f),resolutions:R,matrixIds:y})}},69488:(Fe,ce,r)=>{"use strict";r.d(ce,{k:()=>K});var C=r(65056),e=r(34672),d=r(32328),L=r(27e3),P=r(24708),o=r(93020),f=r(84112),h=r(43168),R=r(61616),y=r(54844),O=r(59324),x=r(72156),T=r(49172),F=(r(19188),r(34896)),A=r(72584);function k(X,V){if(1&X){const B=F.KQA();F.I0R(0,"button",5),F.qCj("click",function(){F.usT(B);const c=F.GaO();return F.CGJ(c.resetStops())}),F.wVc(1,"translate"),F.I0R(2,"mat-icon"),F.OEk(3,"restore_page"),F.C$Y()()}2&X&&F.E7m("matTooltip",F.kDX(1,1,"igo.geo.directionsForm.resetDirectionsBtn"))}function W(X,V){if(1&X){const B=F.KQA();F.I0R(0,"button",1),F.qCj("click",function(){F.usT(B);const c=F.GaO();return F.CGJ(c.zoomRoute())}),F.wVc(1,"translate"),F.I0R(2,"mat-icon"),F.OEk(3,"zoom_in"),F.C$Y()()}2&X&&F.E7m("matTooltip",F.kDX(1,1,"igo.geo.directionsForm.zoomRoute"))}function w(X,V){if(1&X){const B=F.KQA();F.I0R(0,"button",1),F.qCj("click",function(){F.usT(B);const c=F.GaO();return F.CGJ(c.copyDirectionsToClipboard())}),F.wVc(1,"translate"),F.I0R(2,"mat-icon"),F.OEk(3,"content_copy"),F.C$Y()()}2&X&&F.E7m("matTooltip",F.kDX(1,1,"igo.geo.directionsForm.copy"))}function te(X,V){if(1&X){const B=F.KQA();F.I0R(0,"button",1),F.qCj("click",function(){F.usT(B);const c=F.GaO();return F.CGJ(c.copyLinkToClipboard())}),F.wVc(1,"translate"),F.I0R(2,"mat-icon"),F.OEk(3,"link"),F.C$Y()()}2&X&&F.E7m("matTooltip",F.kDX(1,1,"igo.geo.directionsForm.link"))}function Z(X,V){if(1&X){const B=F.KQA();F.I0R(0,"button",6),F.qCj("click",function(){F.usT(B);const c=F.GaO();return F.CGJ(c.printDirections())}),F.wVc(1,"async"),F.wVc(2,"translate"),F.I0R(3,"mat-icon"),F.OEk(4,"print"),F.C$Y()()}if(2&X){const B=F.GaO();F.E7m("disabled",F.kDX(1,2,B.disabled$))("matTooltip",F.kDX(2,4,"igo.geo.directionsForm.print"))}}let K=(()=>{class X{languageService;messageService;route;directionsService;get activeRoute(){return this.routesFeatureStore.all().find(B=>B.properties.active)}contextUri;zoomToActiveRoute$=new R.E;stopsStore;routesFeatureStore;stepFeatureStore;disabled$=new y.g(!1);constructor(B,z,c,I){this.languageService=B,this.messageService=z,this.route=c,this.directionsService=I}resetStops(){this.stopsStore.clearStops()}addStop(){(0,T.um)(this.stopsStore)}copyLinkToClipboard(){h._D.copy(this.getUrl())&&this.messageService.success("igo.geo.directionsForm.dialog.copyMsgLink","igo.geo.directionsForm.dialog.copyTitle")}zoomRoute(){this.zoomToActiveRoute$.next()}copyDirectionsToClipboard(){const B=this.directionsToText();h._D.copy(B)&&this.messageService.success("igo.geo.directionsForm.dialog.copyMsg","igo.geo.directionsForm.dialog.copyTitle")}directionsToText(){const B="\t";let z=this.languageService.translate.instant("igo.geo.directionsForm.instructions")+":\n",c="";const I=this.languageService.translate.instant("igo.geo.directionsForm.summary")+": \n"+B+this.activeRoute.properties.direction.title+"\n"+B+(0,T.YX)(this.activeRoute.properties.direction.distance)+"\n"+B+(0,T.AD)(this.activeRoute.properties.direction.duration)+"\n\n"+this.languageService.translate.instant("igo.geo.directionsForm.stopsList")+":\n",b=this.languageService.translate.instant("igo.geo.directionsForm.link")+":\n"+B+this.getUrl();let G=1;this.stopsStore.view.all().forEach(U=>{let M="",H="";U.text!==(0,O.uE)(U.coordinates).join(",")?(H=U.text,M=` ( ${(0,O.uE)(U.coordinates).join(",")} )`):H=(0,O.uE)(U.coordinates).join(","),c=c+B+G.toLocaleString()+". "+H+M+"\n",G++});let D=0;return this.activeRoute.properties.direction.steps.forEach(U=>{const M=this.formatStep(U,D).instruction,H=void 0===(0,T.YX)(U.distance)?"":" ("+(0,T.YX)(U.distance)+")";z=z+B+(D+1).toLocaleString()+". "+M+H+"\n",D++}),I+c+"\n"+b+"\n\n"+z}formatStep(B,z){return(0,T.qe)(B.maneuver.type,B.maneuver.modifier,B.name,B.maneuver.bearing_after,z,B.maneuver.exit,this.languageService,z===this.activeRoute.properties.direction.steps.length-1)}getUrl(){if(!this.route)return;let B="";this.contextUri&&(B=`context=${this.contextUri}&`);const z=this.routesFeatureStore.all().map(D=>D.properties.id).indexOf(this.activeRoute.properties.id);let c="";0!==z&&(c=`&${this.route.options.directionsOptionsKey}=result:${z}`);const I=this.route.options.directionsCoordKey,b=this.stopsStore.view.all().map(D=>(0,O.uE)(D.coordinates,6));let G="";return b.length>=2?(G=`${I}=${b.join(";")}`,`${location.origin}${location.pathname}?${B}tool=directions&sidenav=1&${G}${c}`):void 0}printDirections(){this.stepFeatureStore.clear(),this.disabled$.next(!0),this.directionsService.downloadDirection(this.routesFeatureStore.map,this.activeRoute.properties.direction).subscribe(()=>{this.disabled$.next(!1)})}static \u0275fac=function(z){return new(z||X)(F.GI1(P.ov),F.GI1(o.mi),F.GI1(f.k$,8),F.GI1(x.WI))};static \u0275cmp=F.In1({type:X,selectors:[["igo-directions-buttons"]],inputs:{contextUri:"contextUri",zoomToActiveRoute$:"zoomToActiveRoute$",stopsStore:"stopsStore",routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore"},standalone:!0,features:[F.UHJ],decls:16,vars:20,consts:[[1,"igo-form-button-group"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"disabled","matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"disabled","matTooltip","click"]],template:function(z,c){1&z&&(F.I0R(0,"div",0)(1,"button",1),F.qCj("click",function(){return c.addStop()}),F.wVc(2,"translate"),F.I0R(3,"mat-icon"),F.OEk(4,"add_location_alt"),F.C$Y()(),F.yuY(5,k,4,3,"button",2),F.wVc(6,"async"),F.wVc(7,"async"),F.yuY(8,W,4,3,"button",3),F.wVc(9,"async"),F.yuY(10,w,4,3,"button",3),F.wVc(11,"async"),F.yuY(12,te,4,3,"button",3),F.wVc(13,"async"),F.yuY(14,Z,5,6,"button",4),F.wVc(15,"async"),F.C$Y()),2&z&&(F.yG2(),F.E7m("matTooltip",F.kDX(2,6,"igo.geo.directionsForm.addStop")),F.yG2(4),F.E7m("ngIf",F.kDX(6,8,c.routesFeatureStore.count$)>=1||F.kDX(7,10,c.stopsStore.count$)>=1),F.yG2(3),F.E7m("ngIf",F.kDX(9,12,c.routesFeatureStore.count$)>=1),F.yG2(2),F.E7m("ngIf",F.kDX(11,14,c.routesFeatureStore.count$)>=1),F.yG2(2),F.E7m("ngIf",F.kDX(13,16,c.routesFeatureStore.count$)>=1),F.yG2(2),F.E7m("ngIf",F.kDX(15,18,c.routesFeatureStore.count$)>=1))},dependencies:[e.oJ,e.um,L.KO,L.a4,d.oB,d.qL,C.u_,C.a,P._s,A.sD]})}return X})()},8984:(Fe,ce,r)=>{"use strict";r.d(ce,{k:()=>c});var C=r(21600),e=r(65056),d=r(34896),L=r(71904),P=r(69400),o=r(34672),f=r(46176),h=r(50244),R=r(32328),y=r(42536),O=r(27e3),x=r(24708),T=r(83552),a=r(61252),F=r(12472),A=r(59324),k=r(9452),W=r(49172),te=(r(19188),r(72584));function Z(I,b){if(1&I){const G=d.KQA();d.I0R(0,"button",11),d.qCj("click",function(){d.usT(G);const g=d.GaO().$implicit,U=d.GaO();return d.CGJ(U.clearStop(g))}),d.wVc(1,"translate"),d.I0R(2,"mat-icon"),d.OEk(3,"close"),d.C$Y()()}2&I&&d.E7m("matTooltip",d.kDX(1,1,"igo.geo.directionsForm.clearStop"))}function K(I,b){if(1&I&&(d.I0R(0,"mat-option",14),d.OEk(1),d.C$Y()),2&I){const G=b.$implicit;d.E7m("value",G)("matTooltip",G.meta?G.meta.title:""),d.yG2(),d.oRS(" ",G.meta?G.meta.title:""," ")}}function X(I,b){if(1&I&&(d.I0R(0,"mat-optgroup",12),d.yuY(1,K,2,3,"mat-option",13),d.C$Y()),2&I){const G=b.$implicit;d.E7m("label",G.source.title)("disabled",!1===G.source.enabled),d.yG2(),d.E7m("ngForOf",G.results)}}function V(I,b){if(1&I){const G=d.KQA();d.I0R(0,"button",18),d.qCj("click",function(){d.usT(G);const g=d.GaO(2).$implicit,U=d.GaO();return d.CGJ(U.removeStop(g))}),d.wVc(1,"translate"),d.I0R(2,"mat-icon"),d.OEk(3,"delete"),d.C$Y()()}2&I&&d.E7m("matTooltip",d.kDX(1,1,"igo.geo.directionsForm.removeStop"))}function B(I,b){if(1&I&&(d.I0R(0,"div",15)(1,"button",16),d.wVc(2,"translate"),d.I0R(3,"mat-icon"),d.OEk(4,"drag_indicator"),d.C$Y()(),d.yuY(5,V,4,3,"button",17),d.wVc(6,"async"),d.C$Y()),2&I){const G=d.GaO(2);d.yG2(),d.E7m("matTooltip",d.kDX(2,2,"igo.geo.directionsForm.moveStop")),d.yG2(4),d.E7m("ngIf",d.kDX(6,4,G.stopsStore.count$)>2)}}function z(I,b){if(1&I){const G=d.KQA();d.I0R(0,"div",2),d.qCj("touchenter",function(){const U=d.usT(G).$implicit,M=d.GaO();return d.CGJ(M.onStopEnter(U))})("touchleave",function(){d.usT(G);const g=d.GaO();return d.CGJ(g.onStopLeave())})("mouseover",function(){const U=d.usT(G).$implicit,M=d.GaO();return d.CGJ(M.onStopEnter(U))})("mouseleave",function(){d.usT(G);const g=d.GaO();return d.CGJ(g.onStopLeave())})("cdkDragStarted",function(){d.usT(G);const g=d.GaO();return d.CGJ(g.stopIsDragged=!0)})("cdkDragEnded",function(){d.usT(G);const g=d.GaO();return d.CGJ(g.stopIsDragged=!1)}),d.I0R(1,"div",3)(2,"mat-form-field",4)(3,"mat-label"),d.OEk(4),d.C$Y(),d.I0R(5,"input",5),d.qCj("focus",function(){const U=d.usT(G).$implicit,M=d.GaO();return d.CGJ(M.onInputFocus(U))}),d.iHE("ngModelChange",function(g){const M=d.usT(G).$implicit;return d.kNx(M.text,g)||(M.text=g),d.CGJ(g)}),d.qCj("keyup",function(g){const M=d.usT(G).$implicit,H=d.GaO();return d.CGJ(H.setStopText(g,M))})("keydown.enter",function(g){return g.preventDefault()}),d.C$Y(),d.yuY(6,Z,4,3,"button",6),d.I0R(7,"mat-autocomplete",7,8),d.qCj("optionSelected",function(g){const M=d.usT(G).$implicit,H=d.GaO();return d.CGJ(H.chooseProposal(g,M))}),d.yuY(9,X,2,3,"mat-optgroup",9),d.C$Y()()(),d.yuY(10,B,7,6,"div",10),d.C$Y()}if(2&I){const G=b.$implicit,D=d.Gew(8),g=d.GaO();d.yG2(),d.E7m("ngClass",g.getNgClass(G)),d.yG2(3),d.cNF(g.getPlaceholder(G)),d.yG2(),d._6D("id",G.id),d.E7m("placeholder",g.getPlaceholder(G))("matTooltip",G.text),d.OKB("ngModel",G.text),d.E7m("matAutocomplete",D),d.yG2(),d.E7m("ngIf",(G.text||G.coordinates)&&g.stopWithHover&&G.id===g.stopWithHover.id),d.yG2(),d.E7m("displayWith",g.getOptionText),d.yG2(2),d.E7m("ngForOf",G.searchProposals),d.yG2(),d.E7m("ngIf",!g.stopIsDragged&&g.stopWithHover&&G.id===g.stopWithHover.id)}}let c=(()=>{class I{languageService;invalidKeys=["Control","Shift","Alt"];onMapClickEventKeys=[];stopWithHover;stopIsDragged=!1;stopsStore;stopsFeatureStore;projection;coordRoundedDecimals=6;debounce=200;length=2;stopInputHasFocus=new d._w7(!1);constructor(G){this.languageService=G}ngOnDestroy(){this.unlistenMapSingleClick()}onStopEnter(G){this.stopWithHover=G}onStopLeave(){this.stopWithHover=void 0}getOptionText(G){return G instanceof Object?G?.meta?G.meta.title:"":G}chooseProposal(G,D){const g=G.option.value;if(g){let U;const M=g.geometry;if("Point"===M.type)U=M.coordinates;else{const H=(0,F.c)(g.geometry);U=[H.geometry.coordinates[0],H.geometry.coordinates[1]]}U&&(D.coordinates=U,D.text=g.meta.title,this.stopsStore.update(D))}}setStopText(G,D){this.unlistenMapSingleClick();const g=G.target.value;0===g.length?this.clearStop(D):this.validateTerm(g)&&(D.text=g,this.stopsStore.update(D))}validateTerm(G){return!(!this.keyIsValid(G)||!(G.length>=this.length||0===G.length))}keyIsValid(G){return void 0===this.invalidKeys.find(D=>D===G)}getNgClass(G){return this.stopWithHover&&G.id===this.stopWithHover.id?"igo-input-container reduce":"igo-input-container"}getPlaceholder(G){let D="";return G.relativePosition?(G.relativePosition===k.mq.Intermediate&&(D=" #"+G.position),this.languageService.translate.instant("igo.geo.directionsForm."+G.relativePosition)+D):""}removeStop(G){(0,W.Wy)(this.stopsStore,G)}clearStop(G){this.stopsStore.update({id:G.id,relativePosition:G.relativePosition,position:G.position})}drop(G){this.moveStops(G.previousIndex,G.currentIndex)}moveStops(G,D){if(G!==D){const g=[...this.stopsStore.view.all()];(0,C.qv)(g,G,D),g.map((U,M)=>{U.relativePosition=(0,W.MG)(M,g.length),U.position=M}),this.stopsStore.updateMany(g),(0,W.GE)(this.stopsStore)}}onInputFocus(G){(!G.text||0===G.text?.length)&&(this.unlistenMapSingleClick(),this.stopInputHasFocus.emit(!0),this.listenMapSingleClick(G))}listenMapSingleClick(G){const D=this.stopsFeatureStore.layer.map.ol.once("singleclick",g=>{const U=a.AF(g.coordinate,this.stopsFeatureStore.layer.map.projection,this.projection),M=(0,A.uE)(U,this.coordRoundedDecimals);G.text=M.join(","),G.coordinates=M,this.stopsStore.update(G),setTimeout(()=>{this.stopInputHasFocus.emit(!1)},500)});this.onMapClickEventKeys.push(D)}unlistenMapSingleClick(){this.onMapClickEventKeys.map(G=>{T.S(G)}),this.onMapClickEventKeys=[]}static \u0275fac=function(D){return new(D||I)(d.GI1(x.ov))};static \u0275cmp=d.In1({type:I,selectors:[["igo-directions-inputs"]],inputs:{stopsStore:"stopsStore",stopsFeatureStore:"stopsFeatureStore",projection:"projection",coordRoundedDecimals:"coordRoundedDecimals",debounce:"debounce",length:"length"},outputs:{stopInputHasFocus:"stopInputHasFocus"},standalone:!0,features:[d.UHJ],decls:3,vars:3,consts:[["cdkDropList","",1,"stops-list",3,"cdkDropListDropped"],["touchleave","","cdkDragLockAxis","y","class","stop-box","cdkDrag","",3,"touchenter","touchleave","mouseover","mouseleave","cdkDragStarted","cdkDragEnded",4,"ngFor","ngForOf"],["touchleave","","cdkDragLockAxis","y","cdkDrag","",1,"stop-box",3,"touchenter","touchleave","mouseover","mouseleave","cdkDragStarted","cdkDragEnded"],[3,"ngClass"],["subscriptSizing","dynamic"],["type","text","matTooltipShowDelay","500","aria-label","Number","matInput","",3,"id","placeholder","matTooltip","ngModel","matAutocomplete","focus","ngModelChange","keyup","keydown.enter"],["mat-icon-button","","matSuffix","","matTooltipShowDelay","500","color","warn","aria-label","Clear",3,"matTooltip","click",4,"ngIf"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"label","disabled",4,"ngFor","ngForOf"],["class","igo-form-button-group",4,"ngIf"],["mat-icon-button","","matSuffix","","matTooltipShowDelay","500","color","warn","aria-label","Clear",3,"matTooltip","click"],[3,"label","disabled"],["matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["matTooltipShowDelay","500",3,"value","matTooltip"],[1,"igo-form-button-group"],["cdkDragHandle","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"swipe-vertical",3,"matTooltip"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"]],template:function(D,g){1&D&&(d.I0R(0,"div",0),d.qCj("cdkDropListDropped",function(M){return g.drop(M)}),d.yuY(1,z,11,11,"div",1),d.wVc(2,"async"),d.C$Y()),2&D&&(d.yG2(),d.E7m("ngForOf",d.kDX(2,1,g.stopsStore.view.all$())))},dependencies:[C.Cm,e.Iw,C.w5,e.QF,h.wb,h.Up,h.w5,h.Gm,y.cN,y.yi,L.y,L.ot,L.ue,L._G,P.U1,P.e,f.I5,f.Ar,P.cG,O.KO,O.a4,e.u_,o.oJ,o.um,R.oB,R.qL,f.Ax,C.A3,e.a,x._s,te.sD],styles:["[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{display:flex;align-items:center;padding-left:12px}[_nghost-%COMP%]   .stops-list[_ngcontent-%COMP%]{max-width:100%;min-height:60px;display:block;background:#fff;border-radius:4px;overflow:hidden;padding:20px 10px}[_nghost-%COMP%]   .swipe-vertical[_ngcontent-%COMP%]{cursor:move}[_nghost-%COMP%]   .stop-box[_ngcontent-%COMP%]{color:#000000de;display:flex;flex-direction:row;align-items:center;justify-content:space-between;box-sizing:border-box;background:#fff}[_nghost-%COMP%]   .stop-box[_ngcontent-%COMP%]:not(:last-child){margin-bottom:16px}[_nghost-%COMP%]   .cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}[_nghost-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}[_nghost-%COMP%]   .cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}[_nghost-%COMP%]   .stops-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .stop-box[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})}return I})()},72184:(Fe,ce,r)=>{"use strict";r.d(ce,{c:()=>z});var C=r(65056),e=r(71904),d=r(46176),L=r(75180),P=r(50244),o=r(32328),f=r(63916),h=r(77872),R=r(24708),y=r(58264),O=r(12396),x=r(62808),T=r(80848),a=r(24112),F=r(68392),A=r(9452),k=r(49172),w=(r(19188),r(34896)),te=r(72584);function Z(c,I){if(1&c&&(w.I0R(0,"mat-option",9),w.OEk(1),w.C$Y()),2&c){const b=I.$implicit,G=I.index,D=w.GaO(3);w.E7m("value",b),w.yG2(),w.MjK(" Option ",G+1," : ",D.formatDistance(b.distance)," (",D.formatDuration(b.duration),") ")}}function K(c,I){if(1&c){const b=w.KQA();w.I0R(0,"mat-form-field")(1,"mat-label"),w.OEk(2),w.wVc(3,"translate"),w.C$Y(),w.I0R(4,"mat-select",7),w.qCj("selectionChange",function(){w.usT(b);const D=w.GaO(2);return w.CGJ(D.changeRoute())}),w.iHE("ngModelChange",function(D){w.usT(b);const g=w.GaO(2);return w.kNx(g.activeDirection,D)||(g.activeDirection=D),w.CGJ(D)}),w.wVc(5,"translate"),w.yuY(6,Z,2,4,"mat-option",8),w.C$Y()()}if(2&c){const b=w.GaO(2);w.yG2(2),w.cNF(w.kDX(3,4,"igo.geo.directionsForm.drivingOptions")),w.yG2(2),w._6D("placeholder",w.kDX(5,6,"igo.geo.directionsForm.drivingOptions")),w.OKB("ngModel",b.activeDirection),w.yG2(2),w.E7m("ngForOf",b.directions)}}function X(c,I){1&c&&w.wR5(0,"mat-divider")}function V(c,I){if(1&c){const b=w.KQA();w.I0R(0,"mat-list-item",10),w.qCj("mouseenter",function(){const g=w.usT(b).$implicit,U=w.GaO(2);return w.CGJ(U.showSegment(g))})("click",function(){const g=w.usT(b).$implicit,U=w.GaO(2);return w.CGJ(U.showSegment(g,!0))}),w.I0R(1,"mat-icon",11),w.OEk(2),w.C$Y(),w.I0R(3,"span",12),w.OEk(4),w.C$Y(),w.I0R(5,"span",13),w.OEk(6),w.C$Y()()}if(2&c){const b=I.$implicit,G=I.index,D=w.GaO(2);w.yG2(),w.E7m("ngClass",D.formatStep(b,G).cssClass),w.yG2(),w.oRS("",D.formatStep(b,G).image," "),w.yG2(2),w.CAO(" ",G+1,". ",D.formatStep(b,G).instruction," "),w.yG2(2),w.oRS(" ",D.formatDistance(b.distance)," ")}}function B(c,I){if(1&c){const b=w.KQA();w.I0R(0,"div",1),w.yuY(1,K,7,8,"mat-form-field",2)(2,X,1,0,"mat-divider",2),w.I0R(3,"mat-list",3),w.qCj("mouseleave",function(){w.usT(b);const D=w.GaO();return w.CGJ(D.onStepsListBlur())}),w.I0R(4,"h2",4),w.OEk(5),w.C$Y(),w.I0R(6,"span",5),w.OEk(7),w.C$Y(),w.yuY(8,V,7,5,"mat-list-item",6),w.wR5(9,"mat-divider"),w.C$Y()()}if(2&c){const b=w.GaO();w.yG2(),w.E7m("ngIf",b.directions&&b.directions.length>1),w.yG2(),w.E7m("ngIf",b.directions&&0===b.directions.length),w.yG2(3),w.cNF(b.activeDirection.title),w.yG2(2),w.CAO(" ",b.formatDistance(b.activeDirection.distance),", ",b.formatDuration(b.activeDirection.duration)," "),w.yG2(),w.E7m("ngForOf",b.activeDirection.steps)}}let z=(()=>{class c{languageService;cdRef;activeDirection;directions;entities$$;routesFeatureStore;stepFeatureStore;constructor(b,G){this.languageService=b,this.cdRef=G}ngOnInit(){this.entities$$=this.routesFeatureStore.entities$.pipe((0,a.o)(200)).subscribe(b=>{const G=b.find(D=>D.properties.active);this.directions=b.map(D=>D.properties.direction),this.activeDirection=G?G.properties.direction:void 0,this.cdRef.detectChanges()})}ngOnDestroy(){this.entities$$.unsubscribe()}changeRoute(){this.routesFeatureStore.entities$.value.map(b=>b.properties.active=!b.properties.active),this.routesFeatureStore.layer.ol.getSource().getFeatures().map(b=>b.set("active",!b.get("active")))}formatDistance(b){return(0,k.YX)(b)}formatDuration(b){return(0,k.AD)(b)}formatStep(b,G){return(0,k.qe)(b.maneuver.type,b.maneuver.modifier,b.name,b.maneuver.bearing_after,G,b.maneuver.exit,this.languageService,G===this.activeDirection.steps.length-1)}onStepsListBlur(){this.stepFeatureStore.clear()}showSegment(b,G=!1){this.showRouteSegmentGeometry(b,G)}showRouteSegmentGeometry(b,G=!1){const g="vertex",s=new x.c(b.geometry.coordinates).transform("EPSG:4326",this.stepFeatureStore.layer.map.projection).getCoordinates()[0],ie=new T.c(s),de=new y.c({geometry:ie}),fe=(new O.c).writeGeometryObject(ie,{featureProjection:this.stepFeatureStore.layer.map.projection,dataProjection:this.stepFeatureStore.layer.map.projection}),Se=this.stepFeatureStore.get(g);this.stepFeatureStore.update({type:F.Y,geometry:fe,projection:this.stepFeatureStore.layer.map.projection,properties:{id:g,step:b,type:A.SC.Vertex},meta:{id:g,revision:(Se?Se.meta.revision:0)+1},ol:de}),G&&this.stepFeatureStore.layer.map.viewController.zoomToExtent(de.getGeometry().getExtent())}static \u0275fac=function(G){return new(G||c)(w.GI1(R.ov),w.GI1(w.kD9))};static \u0275cmp=w.In1({type:c,selectors:[["igo-directions-results"]],inputs:{routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore"},standalone:!0,features:[w.UHJ],decls:1,vars:1,consts:[["class","igo-input-container",4,"ngIf"],[1,"igo-input-container"],[4,"ngIf"],[3,"mouseleave"],["mat-header","",1,"igo-route-title"],[1,"mat-caption"],["class","igo-steps","igoListItem","",3,"mouseenter","click",4,"ngFor","ngForOf"],[3,"placeholder","ngModel","selectionChange","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["igoListItem","",1,"igo-steps",3,"mouseenter","click"],["matListItemIcon","",3,"ngClass"],[1,"igo-step-text"],["matListItemMeta",""]],template:function(G,D){1&G&&w.yuY(0,B,10,6,"div",0),2&G&&w.E7m("ngIf",D.directions&&D.activeDirection)},dependencies:[C.u_,P.wb,P.Up,P.w5,h.d5,h.kX,d.I5,e.y,e.ue,e._G,C.Iw,d.Ax,L.U,L.k,f.iI,f.oL,f.g9,f.Y1,f.At,o.oB,o.qL,C.QF,R._s,te.sD],styles:[".igo-input-container[_ngcontent-%COMP%]{width:100%;padding:20px 10px;box-sizing:border-box}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:70%}.igo-route-title[_ngcontent-%COMP%]{font-weight:700}.igo-steps[_ngcontent-%COMP%]{cursor:pointer;padding:35px 0}.igo-steps[_ngcontent-%COMP%]   .igo-step-text[_ngcontent-%COMP%]{overflow-wrap:break-word;word-wrap:break-word;white-space:pre-wrap}.mat-mdc-list-item[_ngcontent-%COMP%]{word-wrap:break-word!important;white-space:pre-wrap!important}.rotate-90[_ngcontent-%COMP%]{transform:rotate(90deg)}.rotate-45[_ngcontent-%COMP%]{transform:rotate(45deg)}.rotate-270[_ngcontent-%COMP%]{transform:rotate(270deg)}.rotate-250[_ngcontent-%COMP%]{transform:rotate(250deg)}.rotate-290[_ngcontent-%COMP%]{transform:rotate(290deg)}.icon-flipped[_ngcontent-%COMP%]{transform:scaleY(-1)}"]})}return c})()},96580:(Fe,ce,r)=>{"use strict";r.d(ce,{U:()=>C});class C{}},62747:(Fe,ce,r)=>{"use strict";r.d(ce,{U:()=>z});var C=r(43424),e=r(53e3),d=r(24708),L=r(43168),P=r(96764),o=r(25696),f=r(98492),h=r(61252),R=r(61616),y=r(11484),O=r(24112),x=r(40604),T=r(20624),a=r(34080),F=r(93199),A=r(29216),k=r(69488),W=r(8984),w=r(72184),te=r(9452),Z=r(40043),K=r(49172),V=(r(19188),r(34896)),B=r(72584);let z=(()=>{class c{cdRef;languageService;directionsService;searchService;queryService;watcher;projection="EPSG:4326";zoomRoute$$;storeEmpty$$;storeChange$$;routesQueries$$=[];selectStopInteraction;translateStop;selectedRoute;focusOnStop=!1;isTranslating=!1;previousStops=[];searchs$$=[];contextUri;stopsStore;stopsFeatureStore;routesFeatureStore;stepFeatureStore;debounce=200;length=2;coordRoundedDecimals=6;zoomToActiveRoute$=new R.E;get directionControlIsActive(){return!this.queryService.queryEnabled}get interactions(){return[this.selectStopInteraction,this.translateStop,this.selectedRoute]}constructor(b,G,D,g,U){this.cdRef=b,this.languageService=G,this.directionsService=D,this.searchService=g,this.queryService=U}ngOnInit(){this.queryService.queryEnabled=!1,this.initEntityStores(),setTimeout(()=>{(0,K.CM)(this.stopsFeatureStore,this.languageService),(0,K.MV)(this.routesFeatureStore,this.languageService),(0,K.sH)(this.stepFeatureStore),this.initOlInteraction()},1)}ngOnDestroy(){this.queryService.queryEnabled=!0,this.storeEmpty$$.unsubscribe(),this.storeChange$$.unsubscribe(),this.routesQueries$$.map(b=>b.unsubscribe()),this.zoomRoute$$.unsubscribe(),this.freezeStores()}freezeStores(){this.interactions.map(b=>this.routesFeatureStore.layer.map.ol.removeInteraction(b)),this.stopsFeatureStore.deactivateStrategyOfType(T.E),this.routesFeatureStore.deactivateStrategyOfType(T.E),this.stepFeatureStore.deactivateStrategyOfType(T.E)}initEntityStores(){this.watcher=new e.YX(this.stopsStore,this.cdRef),this.monitorEmptyEntityStore(),this.monitorEntityStoreChange(),this.monitorActiveRouteZoom()}monitorActiveRouteZoom(){this.zoomRoute$$=this.zoomToActiveRoute$.subscribe(()=>{if(this.routesFeatureStore.count>=1){const b=this.routesFeatureStore.all().find(G=>G.properties.active);if(b){b.ol.getGeometry();const G=b.ol.getGeometry().getExtent();this.routesFeatureStore.layer.map.viewController.zoomToExtent(G)}}})}initOlInteraction(){this.selectStopInteraction=new o.c({layers:[this.stopsFeatureStore.layer.ol],hitTolerance:7,condition:b=>"pointermove"===b.type&&!b.dragging}),this.translateStop=new f.c({features:this.selectStopInteraction.getFeatures()}),this.translateStop.on("translating",b=>{this.isTranslating=!0,this.executeStopTranslation(b.features)}),this.translateStop.on("translateend",b=>{this.isTranslating=!1,this.executeStopTranslation(b.features)}),this.selectedRoute=new o.c({layers:[this.routesFeatureStore.layer.ol],condition:P.gx,hitTolerance:7,filter:b=>b.get("type")===te.SC.Route&&b.get("active")&&!this.isTranslating}),this.selectedRoute.on("select",b=>{if(!1===this.focusOnStop){const G=(0,a.uE)(h.AF(b.mapBrowserEvent.coordinate,this.routesFeatureStore.layer.map.projection,this.projection),this.coordRoundedDecimals),D=(0,K.um)(this.stopsStore);D.text=G.join(","),D.coordinates=[G[0],G[1]]}}),this.interactions.map(b=>this.routesFeatureStore.layer.map.ol.addInteraction(b))}onStopInputHasFocusChange(b){b?this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute):this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute)}executeStopTranslation(b){if(0===b.getLength())return;const G=b.getArray()[0],D=G.getId(),g=h.AF(G.getGeometry().getCoordinates(),this.stopsFeatureStore.layer.map.projection,this.projection),U=this.stopsStore.get(D),M=(0,a.uE)(g,this.coordRoundedDecimals);U.coordinates=M,U.text=M.join(","),this.stopsStore.update(U)}monitorEmptyEntityStore(){this.storeEmpty$$=this.stopsStore.count$.pipe((0,y.a)()).subscribe(b=>{if(b<2){if((0,K.um)(this.stopsStore),2===this.stopsStore.count)return void this.stopsStore.storeInitialized$.next(!0);this.stopsStore.storeInitialized$.next(!1)}this.routesQueries$$.map(G=>G.unsubscribe())})}monitorEntityStoreChange(){this.storeChange$$=this.stopsStore.entities$.pipe((0,O.o)(this.debounce)).subscribe(b=>{this.handleStopDiff(b),(0,K.GE)(this.stopsStore),this.handleStopsFeature(),this.getRoutes(this.isTranslating)})}cancelSearch(){this.searchs$$.map(b=>b.unsubscribe())}handleStopDiff(b){const G=b.map(U=>L.Yv.removeUndefined({id:U.id,text:U.text,coordinates:U.coordinates})),D=L.OI.findChanges(this.previousStops,G,["coordinates"]),g=D.added.concat(D.modified);g&&g.map(U=>{const M=U.newValue;if(M){const H=this.stopsStore.get(M.id),s=H.text;if(!s||0===s.length)return;const ie=(0,a.Sc)(s,this.stopsFeatureStore.layer.map.projection);let de,fe=!1;ie.lonLat&&(fe=!0),de=this.searchService.search(s,{searchType:"Feature"}),this.cancelSearch();const Se=de.map(ae=>ae.request.pipe((0,x.k)(le=>le.filter(oe=>fe?"Point"===oe.data.geometry.type&&oe.data.geometry:oe.data.geometry))));this.searchs$$=Se.map(ae=>ae.pipe((0,x.k)(le=>le.filter(oe=>fe?"Point"===oe.data.geometry.type&&oe.data.geometry:oe.data.geometry))).subscribe(le=>{if(le.length>0){const oe=le[0].source,se=le[0].meta,me=le.map(ke=>ke.data);H.searchProposals||(H.searchProposals=[]),H.searchProposals=H.searchProposals.filter(ke=>ke.type===(fe?te.S_.Coord:te.S_.Text));let be=H.searchProposals.find(ke=>ke.source===oe);be?be.results=me:H.searchProposals.push({type:fe?te.S_.Coord:te.S_.Text,source:oe,meta:se,results:me})}this.cdRef.detectChanges()}))}}),this.previousStops=G}handleStopsFeature(){const b=this.stopsStore.all();b.filter(g=>g.coordinates).map(g=>this.addStopOverlay(g)),this.stopsFeatureStore.all().map(g=>{this.stopsStore.get(g.properties.id)||this.stopsFeatureStore.delete(g)}),b.filter(g=>!g.coordinates).map(g=>{const U=this.stopsFeatureStore.get(g.id);U&&this.stopsFeatureStore.delete(U)})}getRoutes(b=!1){const G=this.stopsStore.view.all().filter(M=>M.coordinates);if(G.length<2)return void this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());const D=G.map(M=>(0,a.uE)(M.coordinates,this.coordRoundedDecimals));this.routesQueries$$.map(M=>M.unsubscribe());const U=this.directionsService.route(D,b?{overview:!0,steps:!1,alternatives:!1,continue_straight:!1}:void 0);U&&U.map(M=>this.routesQueries$$.push(M.subscribe(H=>{this.routesFeatureStore.deleteMany(this.routesFeatureStore.all()),H.map(s=>(0,K.S_)(this.routesFeatureStore,s,this.projection,s===H[0]))})))}addStopOverlay(b){(0,K.Mx)(b,this.stopsStore,this.stopsFeatureStore,this.projection,this.languageService)}onToggleDirectionsControl(b){this.queryService.queryEnabled=!b;const G=this.routesFeatureStore.layer.map.ol;this.interactions.map(D=>b?G.addInteraction(D):G.removeInteraction(D))}static \u0275fac=function(G){return new(G||c)(V.GI1(V.kD9),V.GI1(d.ov),V.GI1(Z.W),V.GI1(A._),V.GI1(F.E))};static \u0275cmp=V.In1({type:c,selectors:[["igo-directions"]],inputs:{contextUri:"contextUri",stopsStore:"stopsStore",stopsFeatureStore:"stopsFeatureStore",routesFeatureStore:"routesFeatureStore",stepFeatureStore:"stepFeatureStore",debounce:"debounce",length:"length",coordRoundedDecimals:"coordRoundedDecimals",zoomToActiveRoute$:"zoomToActiveRoute$"},standalone:!0,features:[V.UHJ],decls:7,vars:18,consts:[[1,"directions-options"],[3,"checked","labelPosition","change"],[3,"stepFeatureStore","contextUri","zoomToActiveRoute$","routesFeatureStore","stopsStore"],[3,"coordRoundedDecimals","projection","stopsFeatureStore","stopsStore","debounce","length","stopInputHasFocus"],[3,"stepFeatureStore","routesFeatureStore"]],template:function(G,D){1&G&&(V.I0R(0,"div",0)(1,"mat-slide-toggle",1),V.qCj("change",function(U){return D.onToggleDirectionsControl(U.checked)}),V.OEk(2),V.wVc(3,"translate"),V.C$Y()(),V.wR5(4,"igo-directions-buttons",2),V.I0R(5,"igo-directions-inputs",3),V.qCj("stopInputHasFocus",function(U){return D.onStopInputHasFocusChange(U)}),V.C$Y(),V.wR5(6,"igo-directions-results",4)),2&G&&(V.yG2(),V.E7m("checked",D.directionControlIsActive)("labelPosition","before"),V.yG2(),V.oRS(" ",V.kDX(3,16,"igo.geo.directionsForm.toggleActive")," "),V.yG2(2),V.E7m("stepFeatureStore",D.stepFeatureStore)("contextUri",D.contextUri)("zoomToActiveRoute$",D.zoomToActiveRoute$)("routesFeatureStore",D.routesFeatureStore)("stopsStore",D.stopsStore),V.yG2(),V.E7m("coordRoundedDecimals",D.coordRoundedDecimals)("projection",D.projection)("stopsFeatureStore",D.stopsFeatureStore)("stopsStore",D.stopsStore)("debounce",D.debounce)("length",D.length),V.yG2(),V.E7m("stepFeatureStore",D.stepFeatureStore)("routesFeatureStore",D.routesFeatureStore))},dependencies:[C.GE,C.cP,k.k,W.k,w.c,d._s,B.sD],styles:[".directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}.directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}.directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}"]})}return c})()},74180:(Fe,ce,r)=>{"use strict";r.d(ce,{W0:()=>e,c9:()=>L});var C=r(96580);class e{sources;constructor(o){this.sources=o}}function d(P){return new e(P)}function L(){return{provide:e,useFactory:d,deps:[C.U]}}},9452:(Fe,ce,r)=>{"use strict";r.d(ce,{SC:()=>L,S_:()=>d,Yn:()=>C,g1:()=>e,mq:()=>P});var C=function(o){return o[o.GeoJSON=0]="GeoJSON",o[o.JSON=1]="JSON",o}(C||{}),e=function(o){return o.Route="route",o.Trip="trip",o}(e||{}),d=function(o){return o.Coord="coord",o.Text="text",o}(d||{}),L=function(o){return o.Stop="stop",o.Route="route",o.Vertex="vertex",o}(L||{}),P=function(o){return o.Start="start",o.Intermediate="intermediate",o.End="end",o}(P||{})},40043:(Fe,ce,r)=>{"use strict";r.d(ce,{W:()=>te});var C=r(35392),e=r(65056),d=r(23302),L=r(9204),P=r(24708),o=r(43168),f=r(96116),h=r.n(f),R=r(864),x=(r(32256),r(30816)),T=r.n(x),a=r(61616),F=r(29272),A=r(47580),k=r(49172),W=r(34896),w=r(74180);let te=(()=>{class Z{directionsSourceService;configService;languageService;printService;document;activityService;constructor(X,V,B,z,c,I){this.directionsSourceService=X,this.configService=V,this.languageService=B,this.printService=z,this.document=c,this.activityService=I}route(X,V={}){if(0!==X.length)return this.directionsSourceService.sources.filter(B=>B.enabled).map(B=>this.routeSource(B,X,V))}routeSource(X,V,B={}){return X.route(V,B)}downloadDirection(X,V){var B=this;const z=this.activityService.register(),c=new a.E,I=new R.default({orientation:"p",format:"Letter",unit:"mm"}),b=[I.internal.pageSize.width,I.internal.pageSize.height],G=[10,10,10,10],U=[b[0],b[1]-G[0]-G[2]],M=`${V.title} (${(0,k.YX)(V.distance)}, ${(0,k.AD)(V.duration)})`;return I.text(M,I.internal.pageSize.width/2,25,{align:"center"}),G[0]+=20,this.printService.addMap(I,X,96,U,G,A.ID.none).subscribe(function(){var ie=(0,C.c)(function*(de){de===o.qM.Done&&(yield B.addInstructions(I,V,M),B.setPageHeaderFooter(I),yield I.save(`${M}.pdf`,{returnPromise:!0})),B.activityService.unregister(z),c.next(de)});return function(de){return ie.apply(this,arguments)}}()),c}setHTMLTableContent(X){var V=this;return(0,C.c)(function*(){const B=yield V.directionsInstruction(X),z=document.createElement("table"),c=document.createElement("tbody");for(let D=0;D<B.length;D++){const g=B[D];var I=document.createElement("tr"),b=document.createElement("td"),G=document.createElement("td");const U=document.createElement("img");U.src=g.icon;const M=document.createElement("span");if(M.innerHTML=g.instruction,b.appendChild(U),G.appendChild(M),g.distance){const H=document.createElement("span");H.style.verticalAlign="middle",H.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+g.distance,G.appendChild(H)}I.append(b),I.append(G),c.appendChild(I)}return z.appendChild(c),z})()}directionsInstruction(X){var V=this;return(0,C.c)(function*(){const z=V.document.getElementsByTagName("igo-directions-results")[0].getElementsByTagName("mat-list")[0].getElementsByTagName("mat-list-item");let c=[];for(let b=0;b<z.length;b++){const D=z[b].getElementsByTagName("mat-icon")[0],g=D.getAttribute("data-mat-icon-name");if(!c.some(M=>M.name===g)){const M=yield h()(D,{scale:3});c.push({name:g,icon:M.toDataURL()})}}let I=[];for(let b=0;b<X.steps.length;b++){const G=X.steps[b],D=(0,k.qe)(G.maneuver.type,G.maneuver.modifier,G.name,G.maneuver.bearing_after,b,G.maneuver.exit,V.languageService,b===X.steps.length-1),g=(0,k.YX)(G.distance);I.push({instruction:b+1+". "+D.instruction,icon:c.find(U=>U.name===D.image).icon,distance:g?"("+g+")":void 0})}return I})()}addInstructions(X,V,B){var z=this;return(0,C.c)(function*(){X.addPage(),X.text(B,X.internal.pageSize.width/2,25,{align:"center"});const I=yield z.setHTMLTableContent(V);X.autoTable({html:I,startY:30,margin:{top:20,bottom:20},columnStyles:{0:{cellWidth:10}},theme:"plain",styles:{fontSize:12},didDrawCell:function(G){if(0===G.column.index&&"body"===G.cell.section){G.row.height=10;const g=G.cell.raw.getElementsByTagName("img")[0];X.addImage(g.src,G.cell.x,G.cell.y,8,8)}}})})()}setPageHeaderFooter(X){const V=X.getNumberOfPages(),B=T()(Date.now()).format("DD/MM/YYYY hh:mm").toString(),c=this.configService.getConfig("directionsSources.logo")||"assets/logo.png";for(let I=0;I<V;I++){X.setPage(I),X.setFontSize(8);const b=X.internal.pageSize,G=b.height?b.height:b.getHeight(),D=b.width?b.width:b.getWidth();X.text(B,10,10,{baseline:"top"}),X.addImage(c,"PNG",D-20,5,10,10),X.text(B,10,G-10),X.text("Page "+X.getCurrentPageInfo().pageNumber+" / "+V,D-20,G-10)}}static \u0275fac=function(V){return new(V||Z)(W.CoB(w.W0),W.CoB(L.aW),W.CoB(P.ov),W.CoB(F.K),W.CoB(e.Ud),W.CoB(d.U9))};static \u0275prov=W.wxM({token:Z,factory:Z.\u0275fac,providedIn:"root"})}return Z})()},49172:(Fe,ce,r)=>{"use strict";r.d(ce,{AD:()=>G,CM:()=>V,GE:()=>W,MG:()=>w,MV:()=>B,Mx:()=>c,S_:()=>I,Wy:()=>K,YX:()=>b,qe:()=>D,sH:()=>z,um:()=>Z});var C=r(43168),e=r(58264),d=r(12396),L=r(80848),P=r(62808),o=r(61252),f=r(54776),h=r(87544),R=r(45212),y=r(67732),O=r(70524),x=r(68392),T=r(64096),a=r(20624),F=r(2892),A=r(47572),k=r(9452);function W(M,H="asc",s="position"){M.view.sort({direction:H,valueAccessor:ie=>ie[s]})}function w(M,H){let s=k.mq.Intermediate;return 0===M?s=k.mq.Start:M===H-1&&(s=k.mq.End),s}function Z(M){const H=(0,C.uq)(),s=M.all();let ie;ie=0===M.count?[0]:s.map(le=>le.position);const de=Math.max(...ie),fe=de,Se=de+1,ae=M.all().find(le=>le.position===de);return ae&&(ae.position=Se,ae.relativePosition=w(Se,M.count+1)),M.insert({id:H,position:fe,relativePosition:w(fe,M.count+1)}),W(M),M.get(H)}function K(M,H){M.delete(H),function te(M){const H=[...M.all()];H.sort((s,ie)=>s.position-ie.position),H.map((s,ie)=>{s.position=ie,s.relativePosition=w(s.position,H.length)}),H&&M.updateMany(H)}(M)}function X(M,H){const s=[new f.cp({geometry:M.getGeometry(),image:new h.c({radius:7,stroke:new R.c({color:"#FF0000",width:3})})})],ie=(0,A.o)({text:M.get("stopText"),opacity:M.get("stopOpacity"),markerColor:M.get("stopColor"),markerOutlineColor:[255,255,255]}),de=[new f.cp({stroke:new R.c({color:`rgba(106, 121, 130, ${M.get("active")?.75:0})`,width:10})}),new f.cp({stroke:new R.c({color:`rgba(79, 169, 221, ${M.get("active")?.75:0})`,width:6})})];return M.get("type")===k.SC.Stop?ie:"vertex"===M.get("type")?s:M.get("type")===k.SC.Route?de:void 0}function V(M,H){const s=new a.E({motion:x.S.None}),ie=new F.M({isIgoInternalLayer:!0,id:"igo-direction-stops-layer",title:H.translate.instant("igo.geo.directionsForm.stopLayer"),zIndex:911,source:new y.E,showInLayerList:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-stops-layer",links:[{syncedDelete:!0,linkedIds:["igo-direction-route-layer"],properties:[]}]},exportable:!0,browsable:!1,style:X});(0,O.m)(M,ie),M.layer.visible=!0,(0,T.s)(M,s)}function B(M,H){const s=new a.E({motion:x.S.None}),ie=new F.M({isIgoInternalLayer:!0,id:"igo-direction-route-layer",title:H.translate.instant("igo.geo.directionsForm.routeLayer"),zIndex:910,source:new y.E,showInLayerList:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-route-layer"},exportable:!0,browsable:!1,style:X});(0,O.m)(M,ie),M.layer.visible=!0,(0,T.s)(M,s)}function z(M){const H=new a.E({motion:x.S.None}),s=new F.M({isIgoInternalLayer:!0,id:"igo-direction-step-layer",title:"",zIndex:910,source:new y.E,showInLayerList:!1,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-route-layer"},exportable:!1,browsable:!1,style:X});(0,O.m)(M,s),M.layer.visible=!0,(0,T.s)(M,H)}function c(M,H,s,ie,de){let fe,Se;switch(M.relativePosition){case k.mq.Start:fe="#008000",Se=de.translate.instant("igo.geo.directionsForm.start");break;case k.mq.End:fe="#f64139",Se=de.translate.instant("igo.geo.directionsForm.end");break;default:fe="#ffd700",Se=de.translate.instant("igo.geo.directionsForm.intermediate")+" #"+M.position}const ae=new L.c(o.AF(M.coordinates,ie,s.map.projection)),le=(new d.c).writeGeometryObject(ae,{featureProjection:s.map.projection,dataProjection:s.map.projection}),oe=s.get(M.id),me={type:x.Y,geometry:le,projection:s.map.projection,properties:{id:M.id,type:k.SC.Stop,stopText:Se,stopColor:fe,stopOpacity:1,stop:M},meta:{id:M.id,revision:(oe?oe.meta.revision:0)+1},ol:new e.c({geometry:ae})};s.update(me)}function I(M,H,s,ie=!1,de=!1){const ae=new P.c(H.geometry.coordinates).transform(s,M.map.projection),le=(new d.c).writeGeometryObject(ae,{featureProjection:M.map.projection,dataProjection:M.map.projection}),oe=M.get(H.id),me={type:x.Y,geometry:le,projection:M.map.projection,properties:{id:H.id,type:k.SC.Route,active:ie,direction:H},meta:{id:H.id,revision:(oe?oe.meta.revision:0)+1},ol:new e.c({geometry:ae})};M.update(me)}function b(M){if(0!==M)return M>=1e5?C.UD.roundToNDecimal(Math.round(M)/1e3,1)+" km":M>=1e4||M>=1e3?C.UD.roundToNDecimal(Math.round(M)/100/10,1)+" km":C.UD.roundToNDecimal(M,0)+" m"}function G(M){if(M>=3600){const H=Math.floor(M/3600),s=Math.round(60*(M/3600-H));return 60===s?H+1+" h":H+" h "+s+" min"}return M>=60?Math.round(M/60)+" min":M+" s"}function D(M,H,s,ie,de,fe,Se,ae=!1){const le=Se.translate;let oe,se="arrow_forward",me="rotate-270";const be=function U(M,H){const s=H.translate;return M>=337||M<23?s.instant("igo.geo.cardinalPoints.n"):M<67?s.instant("igo.geo.cardinalPoints.ne"):M<113?s.instant("igo.geo.cardinalPoints.e"):M<157?s.instant("igo.geo.cardinalPoints.se"):M<203?s.instant("igo.geo.cardinalPoints.s"):M<247?s.instant("igo.geo.cardinalPoints.sw"):M<293?s.instant("igo.geo.cardinalPoints.w"):M<337?s.instant("igo.geo.cardinalPoints.nw"):void 0}(ie,Se),ke=function g(M,H){const s=H.translate;return"uturn"===M?s.instant("igo.geo.directions.uturn"):"sharp right"===M?s.instant("igo.geo.directions.sharp right"):"right"===M?s.instant("igo.geo.directions.right"):"slight right"===M?s.instant("igo.geo.directions.slight right"):"sharp left"===M?H.translate.instant("igo.geo.directions.sharp left"):"left"===M?H.translate.instant("igo.geo.directions.left"):"slight left"===M?H.translate.instant("igo.geo.directions.slight left"):"straight"===M?H.translate.instant("igo.geo.directions.straight"):M}(H,Se);let nt=("straight"===H?"":le.instant("igo.geo.directions.modifier.prefix"))+ke;if(H?.search("slight")>=0&&(nt=ke),"uturn"===H?(se="arrow_forward",me="rotate-90"):"sharp right"===H||"right"===H?(se="subdirectory_arrow_right",me="icon-flipped"):"slight right"===H?(se="arrow_forward",me="rotate-290"):"straight"===H?se="arrow_forward":"slight left"===H?(se="arrow_forward",me="rotate-250"):("left"===H||"sharp left"===H)&&(se="subdirectory_arrow_left",me="icon-flipped"),"turn"===M)oe="straight"===H?le.instant("igo.geo.directions.turn.straight",{route:s}):"uturn"===H?le.instant("igo.geo.directions.turn.uturn",{route:s}):le.instant("igo.geo.directions.turn.else",{route:s,aggregatedDirection:nt,translatedModifier:ke});else if("new name"===M)oe=le.instant("igo.geo.directions.new name",{route:s,translatedDirection:be}),se="explore",me="";else if("depart"===M)oe=le.instant("igo.geo.directions.depart",{route:s,translatedDirection:be}),se="explore",me="";else if("arrive"===M)ae?(nt=ke?nt:"",oe=le.instant("igo.geo.directions.arrive.lastStep",{coma:ke?", ":"",aggregatedDirection:nt})):(oe=le.instant("igo.geo.directions.arrive.intermediate",{route:s}),se="location_on",me="");else if("merge"===M)oe=le.instant("igo.geo.directions.merge",{route:s}),se="arrow_forward",me="rotate-270";else if("on ramp"===M)oe=le.instant("igo.geo.directions.on ramp",{aggregatedDirection:nt});else if("off ramp"===M)oe=le.instant("igo.geo.directions.off ramp",{aggregatedDirection:nt});else if("fork"===M)oe=H.search("left")>=0?le.instant("igo.geo.directions.fork.left",{route:s}):H.search("right")>=0?le.instant("igo.geo.directions.fork.right",{route:s}):le.instant("igo.geo.directions.fork.else",{route:s});else if("end of road"===M)oe=le.instant("igo.geo.directions.end of road",{translatedModifier:ke,route:s});else if("use lane"===M)oe=le.instant("igo.geo.directions.use lane");else if("continue"===M&&"uturn"!==H)oe=le.instant("igo.geo.directions.continue.notUturn",{route:s}),se="arrow_forward",me="rotate-270";else if("roundabout"===M){const Ue=le.instant(1===fe?"igo.geo.directions.cntSuffix.first":"igo.geo.directions.cntSuffix.secondAndMore");oe=le.instant("igo.geo.directions.roundabout",{exit:fe,cntSuffix:Ue,route:s}),se="donut_large",me=""}else"rotary"===M?(oe=le.instant("igo.geo.directions.rotary"),se="donut_large",me=""):"roundabout turn"===M?(oe=le.instant("igo.geo.directions.roundabout turn"),se="donut_large",me=""):"exit roundabout"===M?(oe=le.instant("igo.geo.directions.exit roundabout",{route:s}),se="arrow_forward",me="rotate-270"):oe="notification"===M?le.instant("igo.geo.directions.notification"):"uturn"===H?le.instant("igo.geo.directions.uturnText",{translatedDirection:be,route:s}):le.instant("igo.geo.directions.unknown");return se=ae?"flag":se,me=ae?"":me,se=0===de?"explore":se,me=0===de?"":me,{instruction:oe,image:se,cssClass:me}}},72156:(Fe,ce,r)=>{"use strict";r.d(ce,{SY:()=>L.SY,WI:()=>C.W,aW:()=>L.aW,cz:()=>L.cz,qM:()=>L.qM});var C=r(40043),L=(r(9452),r(49172),r(19188))},19188:(Fe,ce,r)=>{"use strict";r.d(ce,{SY:()=>L,aW:()=>o,cz:()=>P,qM:()=>f});var C=r(53e3),e=r(54844),d=r(40240);class L extends C.qc{storeInitialized$=new e.g(!1);clearStops(){this.storeInitialized$.next(!1),this.clear()}}class P extends d.y{}class o extends d.y{}class f extends d.y{}},28616:(Fe,ce,r)=>{"use strict";r.d(ce,{w:()=>b});var C=r(65056),e=r(34896),d=r(32328),L=r(53e3),P=r(9204),o=r(24708),f=r(93020),h=r(39882),R=r(43168),y=r(61616),O=r(94364),a=(r(89500),r(78168),r(33712)),F=r(50168),A=r(72584);function k(G,D){if(1&G&&(e.I0R(0,"td")(1,"mat-icon",7),e.OEk(2),e.C$Y()()),2&G){const g=e.GaO(3);e.yG2(2),e.cNF(g.icon)}}function W(G,D){if(1&G){const g=e.KQA();e.I0R(0,"td")(1,"a",8),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"button",9),e.qCj("click",function(){e.usT(g);const M=e.GaO().$implicit,H=e.GaO(2);return e.CGJ(H.copyTextToClipboard(M.value))}),e.I0R(5,"mat-icon"),e.OEk(6,"content_copy"),e.C$Y()()()}if(2&G){const g=e.GaO().$implicit,U=e.GaO(2);e.yG2(),e._6D("href",g.value,e.K6U),e.yG2(),e.CAO(" ",e.kDX(3,3,"igo.geo.targetHtmlUrl")," ",U.title,"")}}function w(G,D){if(1&G&&(e.I0R(0,"td",10),e.OEk(1),e.C$Y()),2&G){const g=e.GaO().$implicit;e.yG2(),e.oRS(" ",g.key," ")}}function te(G,D){if(1&G&&e.wR5(0,"td",11),2&G){const g=e.GaO().$implicit;e.E7m("innerHTML",g.value,e.E3n)}}const Z=()=>({cursor:"pointer",color:"blue"});function K(G,D){if(1&G){const g=e.KQA();e.I0R(0,"td")(1,"u",12),e.qCj("click",function(){e.usT(g);const M=e.GaO().$implicit,H=e.GaO(2);return e.CGJ(H.openSecureUrl(M.value))}),e.OEk(2),e.C$Y()()}if(2&G){const g=e.GaO().$implicit,U=e.GaO(2);e.yG2(),e.E7m("ngStyle",e.q4q(2,Z)),e.yG2(),e.cNF(U.getEmbeddedLinkText(g.value))}}function X(G,D){if(1&G){const g=e.KQA();e.I0R(0,"td")(1,"u",12),e.qCj("click",function(){e.usT(g);const M=e.GaO().$implicit,H=e.GaO(2);return e.CGJ(H.openSecureUrl(M.value))}),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"button",9),e.qCj("click",function(){e.usT(g);const M=e.GaO().$implicit,H=e.GaO(2);return e.CGJ(H.copyTextToClipboard(M.value))}),e.I0R(5,"mat-icon"),e.OEk(6,"content_copy"),e.C$Y()()()}2&G&&(e.yG2(),e.E7m("ngStyle",e.q4q(4,Z)),e.yG2(),e.cNF(e.kDX(3,2,"igo.geo.targetHtmlUrl")))}function V(G,D){if(1&G){const g=e.KQA();e.I0R(0,"td")(1,"a",13),e.qCj("click",function(){e.usT(g);const M=e.GaO().$implicit,H=e.GaO(2);return e.CGJ(H.openSecureUrl(M.value))}),e.wR5(2,"img",14),e.wVc(3,"async"),e.wVc(4,"secureImage"),e.C$Y()()}if(2&G){const g=e.GaO().$implicit;e.yG2(),e._6D("href",g.value,e.K6U),e.yG2(),e._6D("src",e.kDX(3,2,e.kDX(4,4,g.value)),e.K6U)}}function B(G,D){if(1&G&&(e.wR5(0,"td",11),e.wVc(1,"json")),2&G){const g=e.GaO().$implicit;e.E7m("innerHTML",e.kDX(1,1,g.value),e.E3n)}}function z(G,D){if(1&G&&(e.I0R(0,"tr"),e.yuY(1,k,3,1,"td",4)(2,W,7,5,"td",4)(3,w,2,1,"td",5)(4,te,1,1,"td",6)(5,K,3,3,"td",4)(6,X,7,5,"td",4)(7,V,5,6,"td",4)(8,B,2,3,"td",6),e.C$Y()),2&G){const g=D.$implicit,U=e.GaO(2);e.yG2(),e.E7m("ngIf","_blank"===U.feature.properties.target&&"url"===g.key),e.yG2(),e.E7m("ngIf","_blank"===U.feature.properties.target&&"url"===g.key),e.yG2(),e.E7m("ngIf",void 0===U.feature.properties.target),e.yG2(),e.E7m("ngIf",void 0===U.feature.properties.target&&!U.isObject(g.value)&&!U.isUrl(g.value)&&!U.isEmbeddedLink(g.value)),e.yG2(),e.E7m("ngIf",void 0===U.feature.properties.target&&U.isEmbeddedLink(g.value)),e.yG2(),e.E7m("ngIf",void 0===U.feature.properties.target&&!U.isObject(g.value)&&(U.isDoc(g.value)||U.isUrl(g.value))&&!U.isImg(g.value)),e.yG2(),e.E7m("ngIf",void 0===U.feature.properties.target&&!U.isObject(g.value)&&U.isUrl(g.value)&&U.isImg(g.value)),e.yG2(),e.E7m("ngIf",void 0===U.feature.properties.target&&U.isObject(g.value))}}function c(G,D){if(1&G&&(e.I0R(0,"table",2)(1,"tbody"),e.yuY(2,z,9,8,"tr",3),e.wVc(3,"keyvalue"),e.C$Y()()),2&G){const g=e.GaO();e.yG2(2),e.E7m("ngForOf",e.kDX(3,1,g.filterFeatureProperties(g.feature)))}}function I(G,D){if(1&G&&e.wR5(0,"iframe",15),2&G){const g=e.GaO();e.E7m("srcdoc",g.htmlSanitizer(g.feature.properties),e.E3n)("src",g.urlSanitizer(g.feature.properties.url),e.CaN)}}let b=(()=>{class G{http;cdRef;sanitizer;networkService;messageService;configService;state;unsubscribe$=new y.E;ready=!1;get source(){return this._source}set source(g){this._source=g,this.cdRef.detectChanges()}map;toolbox;get feature(){return this._feature}set feature(g){this._feature=g,this.cdRef.detectChanges(),this.selectFeature.emit()}_feature;_source;routeEvent=new e._w7;selectFeature=new e._w7;htmlDisplayEvent=new e._w7;get title(){return(0,L.YB)(this.feature)}get icon(){return(0,L.sH)(this.feature)||"link"}constructor(g,U,M,H,s,ie){this.http=g,this.cdRef=U,this.sanitizer=M,this.networkService=H,this.messageService=s,this.configService=ie,this.networkService.currentState().pipe((0,O.a)(this.unsubscribe$)).subscribe(de=>{this.state=de})}ngOnInit(){this.ready=!0}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}urlSanitizer(g){return this.sanitizer.bypassSecurityTrustResourceUrl(g)}isHtmlDisplay(){return this.feature&&this.isObject(this.feature.properties)&&"iframe"===this.feature.properties.target?(this.htmlDisplayEvent.emit(!0),!0):(this.htmlDisplayEvent.emit(!1),!1)}htmlSanitizer(g){if(g.body){if(!/<base href="[\w:\/\.]+">/.test(g.body)){const M=new URL(g.url,window.location.origin);g.body=g.body.replace("<head>",`<head><base href="${M.origin}">`)}return this.sanitizer.bypassSecurityTrustHtml(g.body)}}isObject(g){return"object"==typeof g}openSecureUrl(g){let U;const M=new RegExp(this.configService?.getConfig("depot.url")+'.*?(?="|$)');if(M.test(g))U=g.match(M)[0],this.http.get(U,{responseType:"blob"}).subscribe(s=>{const ie=URL.createObjectURL(s);window.open(ie,"_blank"),this.cdRef.detectChanges()},s=>{this.messageService.error("igo.geo.targetHtmlUrlUnauthorized","igo.geo.targetHtmlUrlUnauthorizedTitle")});else{let s=g;if(this.isEmbeddedLink(g)){var H=document.createElement("div");H.innerHTML=g,s=H.children[0].getAttribute("href")}window.open(s,"_blank")}}isUrl(g){if("string"==typeof g)return/^https?:\/\//.test(g)}isDoc(g){if("string"==typeof g)return!!this.isUrl(g)&&/(pdf|docx?|xlsx?)$/.test(g.toLowerCase())}isImg(g){if("string"==typeof g)return!!this.isUrl(g)&&/(jpe?g|png|gif)$/.test(g.toLowerCase())}isEmbeddedLink(g){return"string"==typeof g&&1===(g.match(/<a/g)||[]).length}getEmbeddedLinkText(g){let M=g.match(/(?:>).*?(?=<|$)/)[0];return M=M.replace(/>/g,""),M}filterFeatureProperties(g){const U=g.meta?g.meta.alias:void 0,M={};let H;return this.map&&this.map.forcedOffline$.pipe((0,O.a)(this.unsubscribe$)).subscribe(s=>{H=s}),g.properties&&g.properties.Route&&this.toolbox&&!this.toolbox.getTool("directions")&&delete g.properties.Route,U?(Object.keys(U).forEach(s=>{M[U[s]]=g.properties[s]}),M):(void 0!==H&&H?g.meta&&g.meta.excludeAttributeOffline&&g.meta.excludeAttributeOffline.forEach(ie=>{delete g.properties[ie]}):this.state.connection&&g.meta&&g.meta.excludeAttribute?g.meta.excludeAttribute.forEach(ie=>{delete g.properties[ie]}):!this.state.connection&&g.meta&&g.meta.excludeAttributeOffline&&g.meta.excludeAttributeOffline.forEach(ie=>{delete g.properties[ie]}),g.properties)}copyTextToClipboard(g){R._D.copy(g)&&this.messageService.success("igo.geo.query.link.message")}static \u0275fac=function(U){return new(U||G)(e.GI1(a.KK),e.GI1(e.kD9),e.GI1(F.mI),e.GI1(h.u),e.GI1(f.mi),e.GI1(P.aW))};static \u0275cmp=e.In1({type:G,selectors:[["igo-feature-details"]],inputs:{source:"source",map:"map",toolbox:"toolbox",feature:"feature"},outputs:{routeEvent:"routeEvent",selectFeature:"selectFeature",htmlDisplayEvent:"htmlDisplayEvent"},standalone:!0,features:[e.UHJ],decls:2,vars:2,consts:[["class","igo-striped mat-typography",4,"ngIf"],[3,"srcdoc","src",4,"ngIf"],[1,"igo-striped","mat-typography"],[4,"ngFor","ngForOf"],[4,"ngIf"],["id","keyValue",4,"ngIf"],[3,"innerHTML",4,"ngIf"],["matListItemIcon",""],["target","_blank","rel","noopener noreferrer",3,"href"],["mat-icon-button","",1,"copyClipboard",3,"click"],["id","keyValue"],[3,"innerHTML"],[3,"ngStyle","click"],["target","_blank","rel","noopener noreferrer",3,"href","click"],["igoImageError","","width","225","height","auto",3,"src"],[3,"srcdoc","src"]],template:function(U,M){1&U&&e.yuY(0,c,4,3,"table",0)(1,I,1,2,"iframe",1),2&U&&(e.E7m("ngIf",M.ready&&M.feature&&M.isObject(M.feature.properties)&&"iframe"!==M.feature.properties.target),e.yG2(),e.E7m("ngIf",M.isHtmlDisplay()))},dependencies:[C.u_,C.Iw,d.oB,d.qL,C.Qt,L.MJ,C.a,C.ED,C.uq,o._s,A.sD,L.kd],styles:["table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px}#keyValue[_ngcontent-%COMP%]{width:30%}table[_ngcontent-%COMP%]     .routing{cursor:pointer}iframe[_ngcontent-%COMP%]{height:calc(100% - 4px);width:100%;border:0}.copyClipboard[_ngcontent-%COMP%]{border:none;background:transparent;cursor:pointer}"],changeDetection:0})}return G})()},86464:(Fe,ce,r)=>{"use strict";r.d(ce,{U:()=>L});var C=r(34896),e=r(54844),d=r(28616);let L=(()=>{class P{el;component;get feature(){return this.component.feature}feature$=new e.g(void 0);routingEvent=new C._w7;setFeature(){this.feature$.next(this.feature)}constructor(f,h){this.el=h,this.component=f}ngOnInit(){this.feature$.subscribe(()=>{this.feature.geometry&&this.bindClicking()})}bindClicking(){setTimeout(()=>{const f=this.el.nativeElement.querySelector("span.routing");f&&f.addEventListener("click",()=>{this.routingEvent.emit()})},1)}static \u0275fac=function(h){return new(h||P)(C.GI1(d.w,2),C.GI1(C.GMv))};static \u0275dir=C.Sc5({type:P,selectors:[["","igoFeatureDetailsDirective",""]],hostBindings:function(h,R){1&h&&C.qCj("selectFeature",function(){return R.setFeature()})},outputs:{routingEvent:"routingEvent"},standalone:!0})}return P})()},72432:(Fe,ce,r)=>{"use strict";r.d(ce,{Y:()=>y});var C=r(65056),e=r(34896),d=r(53e3),L=r(43168),P=r(54844),o=r(68392);const f=["igoForm"],h=["*",[["","formButtons",""]]],R=["*","[formButtons]"];let y=(()=>{class O{form;set feature(T){this.feature$.next(T)}get feature(){return this.feature$.value}feature$=new P.g(void 0);submitForm=new e._w7;igoForm;constructor(){}onSubmit(T){const a=this.formDataToFeature(T);this.submitForm.emit(a)}getData(){return this.formDataToFeature(this.igoForm.getData())}formDataToFeature(T){const a={},F={};void 0===this.feature?F.id=(0,L.uq)():(Object.assign(a,this.feature.properties),Object.assign(F,this.feature.meta,{revision:(0,d.mU)(this.feature)+1}));Object.entries(T).forEach(W=>{const[w,te]=W;if(w.startsWith("properties.")){const Z=w.substr(11);a[Z]=te}});let k=T.geometry;return void 0===k&&void 0!==this.feature&&(k=this.feature.geometry),{meta:F,type:o.Y,geometry:k,projection:"EPSG:4326",properties:a}}static \u0275fac=function(a){return new(a||O)};static \u0275cmp=e.In1({type:O,selectors:[["igo-feature-form"]],viewQuery:function(a,F){if(1&a&&e.CC$(f,7),2&a){let A;e.wto(A=e.Gqi())&&(F.igoForm=A.first)}},inputs:{form:"form",feature:"feature"},outputs:{submitForm:"submitForm"},standalone:!0,features:[e.UHJ],ngContentSelectors:R,decls:5,vars:4,consts:[[3,"form","formData","submitForm"],["igoForm",""]],template:function(a,F){1&a&&(e.kPM(h),e.I0R(0,"igo-form",0,1),e.qCj("submitForm",function(k){return F.onSubmit(k)}),e.wVc(2,"async"),e._Xx(3),e._Xx(4,1,["formButtons",""]),e.C$Y()),2&a&&e.E7m("form",F.form)("formData",e.kDX(2,2,F.feature$))},dependencies:[d.Yl,C.a],styles:["[_nghost-%COMP%]{display:block}igo-form[_ngcontent-%COMP%]{height:100%}"],changeDetection:0})}return O})()},39844:(Fe,ce,r)=>{"use strict";r.d(ce,{Yf:()=>P.Yf,wP:()=>C.w,Su:()=>P.Su,ym:()=>P.ym,E9:()=>P.E9,kj:()=>P.kj,q1:()=>P.q1,qK:()=>P.qK,K6:()=>P.K6,Ki:()=>P.Ki,Yv:()=>P.Yv,QX:()=>P.QX,sf:()=>P.sf,Uz:()=>P.Uz,mM:()=>P.mM});var C=r(28616);r(86464);r(72432);var P=r(76572)},70524:(Fe,ce,r)=>{"use strict";r.d(ce,{m:()=>d});var C=r(3544),e=r(2892);function d(L,P){void 0===L.layer?(P=P||new e.M({source:new C.EB}),L.bindLayer(P),void 0===L.layer.map&&L.map.addLayer(L.layer)):void 0===L.layer.map&&L.map.addLayer(L.layer)}},68392:(Fe,ce,r)=>{"use strict";r.d(ce,{S:()=>e,Y:()=>C});const C="Feature";var e=function(d){return d[d.None=0]="None",d[d.Move=1]="Move",d[d.Zoom=2]="Zoom",d[d.Default=3]="Default",d}(e||{})},14672:(Fe,ce,r)=>{"use strict";r.d(ce,{In:()=>x,K6:()=>O,Ki:()=>k,QX:()=>w,Wg:()=>Z,Yv:()=>W,gV:()=>te,q1:()=>F,qK:()=>T});var C=r(53e3),e=r(43168),d=r(94448),L=r(12396),P=r(62808),o=r(80848),f=r(36752),h=r(61252),R=r(54776),y=r(68392);function O(K,X,V){V=V||C._I;const z=(new L.c).readFeature(K,{dataProjection:K.projection,featureProjection:X});z.setId(V(K));const c=(0,C.YB)(K);void 0!==c&&z.set("_title",c,!0),void 0!==K.extent&&z.set("_extent",K.extent,!0),void 0!==K.projection&&z.set("_projection",K.projection,!0);const I=(0,C.u6)(K,"meta.mapTitle");void 0!==I&&z.set("_mapTitle",I,!0),z.set("_entityRevision",(0,C.mU)(K),!0);const b=(0,C.sH)(K);return void 0!==b&&z.set("_icon",b,!0),K.meta&&K.meta.style&&z.set("_style",K.meta.style,!0),K.sourceId&&z.set("_sourceId",K.sourceId,!0),z}function x(K,X,V,B="EPSG:4326"){let z,c,I,b;V?(c=V.get("title"),V.get("sourceOptions")&&(I=V.get("sourceOptions").excludeAttribute,b=V.get("sourceOptions").excludeAttributeOffline)):c=K.get("_title");const G=new L.c,D=K.getProperties(),g=K.getType();if("Polygon"===g){const ie=K.getEnds();z=new f.cp(K.getFlatCoordinates(),"XY",ie)}else"Point"===g?z=new o.c(K.getFlatCoordinates(),"XY"):"LineString"===g&&(z=new P.c(K.getFlatCoordinates(),"XY"));const U=G.writeGeometryObject(z,{dataProjection:B,featureProjection:X}),M=K.getId()?K.getId():(0,e.uq)(),H=K.get("_mapTitle"),s=h.W0(K.getExtent(),X,B);return{type:y.Y,projection:B,extent:s,meta:{id:M,title:c||H||M,mapTitle:H,excludeAttribute:I,excludeAttributeOffline:b},properties:D,geometry:U,ol:K}}function T(K,X,V,B="EPSG:4326"){let z,c,I,b;const G=new L.c,g=K.getKeys().filter(ie=>!ie.startsWith("_")&&"geometry"!==ie).reduce((ie,de)=>(ie[de]=K.get(de),ie),{}),U=G.writeGeometryObject(K.getGeometry(),{dataProjection:B,featureProjection:X});if(V){z=V.get("title");const ie=V.get("sourceOptions");ie&&(c=ie.excludeAttribute,I=ie.excludeAttributeOffline,b=ie.idColumn||("arcgisrest"===ie.type||"tilearcgisrest"===ie.type?"OBJECTID":void 0))}else z=K.get("_title");const M=K.get("_mapTitle"),H=K.getId()?K.getId():K.get(b)?K.get(b):(0,e.uq)();return K.get("_newFeature"),{type:y.Y,projection:B,extent:K.get("_extent"),meta:{id:H,title:z||M||H,mapTitle:M,revision:K.getRevision(),style:K.get("_style"),excludeAttribute:c,excludeAttributeOffline:I},properties:g,geometry:U,ol:K}}function F(K,X){const V=d.Gu();return K.forEach(B=>{const z=function a(K,X){let V=d.Gu();const B=K.get("_extent"),z=K.get("_projection");if(void 0!==B&&void 0!==z)V=h.W0(B,z,X);else{const c=K.getGeometry();null!==c&&(V=c.getExtent())}return V}(B,X);d.SU(V,z)}),V}function A(K,X){const[V,B]=d.iK(K);return[X[3]?K[0]-V*X[3]:K[0],X[2]?K[1]-B*X[2]:K[1],X[1]?K[2]+V*X[1]:K[2],X[0]?K[3]+B*X[0]:K[3]]}function k(K,X,V=.05){const B=Array.isArray(V)?V:[V,V,V,V],c=A(K,[-1,-1,-1,-1].map((I,b)=>I*B[b]));return!d.cP(c,X)}function W(K,X,V){V=V||.004;const B=K.getExtent(),z=d.kh(B),c=d.kh(X);return!(0===c&&K.getZoom()>13)&&c/z<V}function w(K,X,V=y.S.Default,B,z){const c=K.getExtent(),b=F(X,K.getOlProjection());let G=b;void 0!==B&&(G=A(G,B)),V===y.S.Zoom?K.zoomToExtent(G):V===y.S.Move?K.moveToExtent(G):V===y.S.Default&&(k(c,b)||W(K,b,z))&&K.zoomToExtent(G)}function te(K){K.setStyle(new R.cp({}))}function Z(K,X){const V=new Map;X.forEach(I=>{V.set(I.getId(),I)});const B=[];K.forEach(I=>{const b=V.get(I.getId());void 0===b||b.get("_entityRevision")!==I.get("_entityRevision")?B.push(I):V.delete(b.getId())});const z=Array.from(V.keys());return{add:X.filter(I=>z.indexOf(I.getId())>=0),remove:B}}},76572:(Fe,ce,r)=>{"use strict";r.d(ce,{Yf:()=>C.Y,Su:()=>C.S,ym:()=>L.y,IV:()=>P.I,CE:()=>h,_c:()=>F,E9:()=>T.E,oJ:()=>w,kj:()=>A.k,eu:()=>x,q1:()=>e.q1,qK:()=>e.qK,K6:()=>e.K6,Ki:()=>e.Ki,Yv:()=>e.Yv,QX:()=>e.QX,sf:()=>te.s,Uz:()=>te.U,mM:()=>d.m});var C=r(68392),e=r(14672),d=r(70524),L=r(40240),P=r(33436),o=r(53e3),f=r(24112);class h extends o.uk{options;stores$$=new Map;resolution$$=[];empty$$;constructor(K){super(K),this.options=K}bindStore(K){super.bindStore(K),!0===this.active&&this.watchStore(K),this.empty$$=K.empty$.subscribe(()=>this.updateEntitiesInResolution(K,K.layer.map.viewController.getResolution()))}unbindStore(K){super.unbindStore(K),!0===this.active&&this.unwatchStore(K)}doActivate(){this.stores.forEach(K=>this.watchStore(K))}doDeactivate(){this.unwatchAll()}watchStore(K){this.stores$$.has(K)||(this.updateEntitiesInResolution(K,K.layer.map.viewController.getResolution()),this.resolution$$.push(K.layer.map.viewController.resolution$.pipe((0,f.o)(250)).subscribe(X=>{this.updateEntitiesInResolution(K,X)})))}updateEntitiesInResolution(K,X){K.state.updateAll(X>K.layer.minResolution&&X<K.layer.maxResolution?{inMapResolution:!0}:{inMapResolution:!1})}unwatchStore(K){void 0!==this.stores$$.get(K)&&this.stores$$.delete(K)}unwatchAll(){this.stores$$.clear(),this.resolution$$.map(K=>K.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}var R=r(43168),y=r(91296),O=r(47864);class x extends o.uk{options;propertyTypeDetectorService;capabilitiesService;stores$$=new Map;states$$=[];empty$$;map;constructor(K,X,V){super(K),this.options=K,this.propertyTypeDetectorService=X,this.capabilitiesService=V,this.map=K.map}bindStore(K){super.bindStore(K),!0===this.active&&this.watchStore(K)}unbindStore(K){super.unbindStore(K),!0===this.active&&this.unwatchStore(K)}doActivate(){this.stores.forEach(K=>this.watchStore(K))}doDeactivate(){this.unwatchAll()}watchStore(K){this.stores$$.has(K)||(this.updateEntitiesPropertiesState(K),this.states$$.push(this.map.layers$.pipe((0,f.o)(250),(0,y.c)()).subscribe(([X,V])=>{let B;X&&(B=X.map(c=>c.id));const z=V.filter(c=>!B.includes(c.id));this.updateEntitiesPropertiesState(K,z)})),this.states$$.push(K.entities$.pipe((0,f.o)(250)).subscribe(X=>{this.updateEntitiesPropertiesState(K)})))}updateEntitiesPropertiesState(K,X){const V=this.map.layers.map(U=>U.id);let B=[];B=X?K.entities$.value:K.stateView.all().length?K.stateView.all().filter(M=>!M.state.geoService).map(M=>M.entity):K.entities$.value;const c=B.slice(0,B.length>=250?250:B.length);let I=[];c.map(U=>{I=I.concat(Object.keys(U.properties||{}))}),I=[...new Set(I)];const b={};I.map(U=>{b[U]=[...new Set(B.map(M=>M.properties[U]))]});const G={};Object.entries(b).forEach(U=>{const[M,H]=U,s=H.filter(ie=>this.propertyTypeDetectorService.isGeoService(ie));s?.length&&(G[M]=s)});const D=[];Object.entries(G).forEach(U=>{const[M,H]=U;H.map(s=>{const ie=this.propertyTypeDetectorService.getGeoService(s,I);if(ie){const de=I.filter(Se=>ie.propertiesForLayerName.includes(Se)),fe=de.length?de[0]:void 0;fe&&D.push({url:s,urlProperty:M,layerNameProperty:fe,geoService:ie})}})});const g=[];D.map(U=>{const M=U.url,H=U.geoService.type||"wms";b[U.layerNameProperty].map(s=>{let de,ie=s;["arcgisrest","imagearcgisrest","tilearcgisrest"].includes(H)&&(ie=void 0,de=s);const fe=R.Yv.removeUndefined({sourceOptions:{type:H||"wms",url:M,optionsFromCapabilities:!0,optionsFromApi:!0,params:{LAYERS:ie,LAYER:de}}}),Se=(0,O.KC)(fe.sourceOptions);g.push({geoServiceAssociation:U,state:{added:void 0!==V.find(ae=>ae===Se),haveGeoServiceProperties:!0,type:H,url:M,layerName:s}})})}),g.map(U=>{const M=U.geoServiceAssociation.urlProperty,H=U.geoServiceAssociation.layerNameProperty,s=U.state.url,ie=U.state.layerName,de=B.filter(Se=>Se.properties[M]===s&&Se.properties[H]===ie);K.state.updateMany(de,{geoService:U.state},!0)})}unwatchStore(K){void 0!==this.stores$$.get(K)&&this.stores$$.delete(K)}unwatchAll(){this.stores$$.clear(),this.states$$.map(K=>K.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}var T=r(20624),a=r(93176);class F extends o.uk{options;stores$$=new Map;constructor(K){super(K),this.options=K}bindStore(K){super.bindStore(K),!0===this.active&&this.watchStore(K)}unbindStore(K){super.unbindStore(K),!0===this.active&&this.unwatchStore(K)}doActivate(){this.stores.forEach(K=>this.watchStore(K))}doDeactivate(){this.unwatchAll()}watchStore(K){this.stores$$.has(K)||(this.onSourceChanges(K),K.layer.ol.getSource().on("change",V=>{this.onSourceChanges(K)}))}unwatchStore(K){void 0!==this.stores$$.get(K)&&this.stores$$.delete(K)}unwatchAll(){Array.from(this.stores$$.entries()).forEach(K=>{}),this.stores$$.clear()}onSourceChanges(K){let X=K.layer.ol.getSource().getFeatures();K.layer.dataSource instanceof a.a&&(X=X.flatMap(V=>V.get("features"))),0===X.length?K.clear():K.setStoreOlFeatures(X)}}var A=r(18080),k=r(82304),W=r(53404);class w extends o.uk{options;stores$$=new Map;constructor(K){super(K),this.options=K}bindStore(K){super.bindStore(K),!0===this.active&&this.watchStore(K)}unbindStore(K){super.unbindStore(K),!0===this.active&&this.unwatchStore(K)}doActivate(){this.stores.forEach(K=>this.watchStore(K))}doDeactivate(){this.unwatchAll()}initStoreSearchIndex(K){K.searchDocument=new k.Document({tokenize:"full"})}watchStore(K){this.stores$$.has(K)||(this.initStoreSearchIndex(K),K.entities$.pipe((0,W.O)(X=>!X.length)).subscribe(()=>this.onEntitiesChanges(K)))}unwatchStore(K){void 0!==this.stores$$.get(K)&&(K.searchDocument=void 0,this.stores$$.delete(K))}unwatchAll(){Array.from(this.stores$$.entries()).forEach(K=>{}),this.stores$$.clear()}onEntitiesChanges(K){const X=this.options.percentDistinctValueRatio||2,V=[];K.index.forEach((I,b)=>{const G=I.properties;G.igoSearchID=b,V.push(G)});const B=[];let z=[],c=[];if(this.options.sourceFields)z=this.options.sourceFields.filter(I=>!I.searchIndex?.enabled),c=this.options.sourceFields.filter(I=>I.searchIndex?.enabled).map(I=>Object.assign({},{field:I.name,tokenize:"full"},I.searchIndex));else if(V.length){const I=Object.keys(V[0]),b=[];z=I.map(D=>{const g=[...new Set(V.map(U=>U[D]))];g.length/V.length*100<=X||g.every(U=>Number(U)===U&&U%1!=0)?z.push(D):b.push(D)}).filter(D=>D),c=b.filter(D=>"igoSearchID"!==D).map(D=>({field:D,tokenize:"full"}))}K.index.forEach((I,b)=>{const G=JSON.parse(JSON.stringify(I.properties));z.map(D=>delete G[D]),Object.keys(G).length&&B.push(G)}),0===B.length?this.initStoreSearchIndex(K):(K.searchDocument=new k.Document({document:{id:"igoSearchID",index:c}}),B.map(I=>{K.searchDocument.add(I.igoSearchID,I)}))}}var te=r(64096)},40240:(Fe,ce,r)=>{"use strict";r.d(ce,{y:()=>P});var C=r(53e3),e=r(94448),d=r(68392),L=r(14672);class P extends C.qc{layer;map;get source(){return this.layer?this.layer.dataSource:void 0}set searchDocument(f){this._searchDocument=f}get searchDocument(){return this._searchDocument}_searchDocument;constructor(f,h){super(f,h),this.map=h.map}bindLayer(f){return this.layer=f,this}setLayerFeatures(f,h=d.S.Default,R,y,O){O=O||C._I,this.checkLayer();const x=f.map(T=>(0,L.K6)(T,this.map.projection,O));this.setLayerOlFeatures(x,h,R,y)}setStoreOlFeatures(f){this.checkLayer();const h=f.map(R=>(R.set("_featureStore",this,!0),(0,L.qK)(R,this.layer.map.projection)));this.load(h)}clearLayer(){this.checkLayer(),this.source.ol.clear()}checkLayer(){if(void 0===this.layer)throw new Error("This FeatureStore is not bound to a layer.")}setLayerOlFeatures(f,h=d.S.Default,R,y){const O=this.layer.ol.getSource(),x=(0,L.Wg)(O.getFeatures(),f);x.remove.length>0&&this.removeOlFeaturesFromLayer(x.remove),x.add.length>0&&this.addOlFeaturesToLayer(x.add),x.add.length>0?(0,L.QX)(this.map.viewController,x.add,h,R,y):x.remove.length>0&&(0,L.QX)(this.map.viewController,f,h,R,y)}setLayerExtent(){let f=this.entities$.getValue(),h=e.Gu(),R=[];f.forEach(O=>{R.push((0,L.K6)(O,this.map.projection))});const y=(0,L.q1)(R,this.map.viewProjection);e.SU(h,y),this.layer.setExtent(h)}addOlFeaturesToLayer(f){f.forEach(h=>{h.set("_featureStore",this,!0)}),this.source.ol.addFeatures(f)}removeOlFeaturesFromLayer(f){f.forEach(h=>{this.source.ol.removeFeature(h)})}}},64096:(Fe,ce,r)=>{"use strict";r.d(ce,{U:()=>L,s:()=>d});var C=r(20624),e=r(18080);function d(P,o){void 0===P.getStrategyOfType(C.E)?(o=o||new C.E({}),P.addStrategy(o),o.activate()):P.activateStrategyOfType(C.E)}function L(P,o){void 0===P.getStrategyOfType(e.k)?(o=o||new e.k({map:P.map}),P.addStrategy(o),o.activate()):P.activateStrategyOfType(e.k)}},33436:(Fe,ce,r)=>{"use strict";r.d(ce,{I:()=>P});var C=r(53e3),e=r(94448),d=r(53404),L=r(24112);class P extends C.uk{options;stores$$=new Map;states$$=[];empty$$;constructor(f){super(f),this.options=f}bindStore(f){super.bindStore(f),!0===this.active&&this.watchStore(f),this.empty$$=f.empty$.pipe((0,d.O)(h=>!h)).subscribe(()=>this.updateEntitiesInExtent(f))}unbindStore(f){super.unbindStore(f),!0===this.active&&this.unwatchStore(f)}doActivate(){this.stores.forEach(f=>this.watchStore(f))}doDeactivate(){this.unwatchAll()}watchStore(f){this.stores$$.has(f)||(this.updateEntitiesInExtent(f),this.states$$.push(f.layer.map.viewController.state$.pipe((0,L.o)(250)).subscribe(()=>this.updateEntitiesInExtent(f))))}updateEntitiesInExtent(f){if(f?.layer?.map?.viewController){f.state.updateAll({inMapExtent:!1});const h=f.layer.map.viewController.getExtent(),y=this.getFeaturesInExtent(f.entities$.value,h);f.state.updateMany(y,{inMapExtent:!0},!1)}}getFeaturesInExtent(f,h){return f.reduce((R,y)=>{const O=y.ol?.getGeometry();if(O){const x=O.getExtent();e.K0(x,h)&&R.push(y)}else R.push(y);return R},[])}unwatchStore(f){void 0!==this.stores$$.get(f)&&this.stores$$.delete(f)}unwatchAll(){this.stores$$.clear(),this.states$$.map(f=>f.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}}},20624:(Fe,ce,r)=>{"use strict";r.d(ce,{E:()=>d});var C=r(53e3),e=r(68392);class d extends C.uk{options;stores$$=new Map;motion;constructor(P){super(P),this.options=P,this.setMotion(P.motion)}bindStore(P){super.bindStore(P),!0===this.active&&this.watchStore(P)}unbindStore(P){super.unbindStore(P),!0===this.active&&this.unwatchStore(P)}setMotion(P){this.motion=P}doActivate(){this.stores.forEach(P=>this.watchStore(P))}doDeactivate(){this.unwatchAll()}watchStore(P){if(this.stores$$.has(P))return;const o=P.view.all$().subscribe(f=>this.onFeaturesChange(f,P));this.stores$$.set(P,o)}unwatchStore(P){const o=this.stores$$.get(P);void 0!==o&&(o.unsubscribe(),this.stores$$.delete(P))}unwatchAll(){Array.from(this.stores$$.entries()).forEach(P=>{P[1].unsubscribe()}),this.stores$$.clear()}onFeaturesChange(P,o){0===P.length?o.clearLayer():o.setLayerFeatures(P,this.selectMotion(o),this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)}selectMotion(P){return void 0!==this.motion?this.motion:!0===P.pristine||P.count>P.view.count?e.S.Default:e.S.None}}},18080:(Fe,ce,r)=>{"use strict";r.d(ce,{E:()=>T,k:()=>a});var C=r(53e3),e=r(83552),d=r(56224),L=r(35876),P=r(40604),o=r(24112),f=r(68013),h=r(3544),R=r(2892),y=r(59324),O=r(68392),x=r(40240);class T extends d.c{constructor(A){super(A)}}class a extends C.uk{options;mapClickListener;olDragSelectInteraction;olDragSelectInteractionEndKey;stores$$;motion;get map(){return this.options.map}get overlayStore(){return this._overlayStore}_overlayStore;constructor(A){super(A),this.options=A,this.setMotion(A.motion),this._overlayStore=this.createOverlayStore()}bindStore(A){super.bindStore(A),!0===this.active&&this.activate()}unbindStore(A){super.unbindStore(A),!0===this.active&&this.activate()}setMotion(A){this.motion=A}unselectAll(){this.stores.forEach(A=>{A.state.updateAll({selected:!1})})}clear(){this.overlayStore.source.ol.clear(),this.overlayStore.clear()}deactivateSelection(){this.unlistenToMapClick(),this.removeDragBoxInteraction(),this.unwatchAll()}doActivate(){this.addOverlayLayer(),this.listenToMapClick(),!0===this.options.dragBox&&this.addDragBoxInteraction(),this.watchAll()}doDeactivate(){this.deactivateSelection(),this.removeOverlayLayer()}watchAll(){this.unwatchAll();const A=this.stores.map(k=>k.stateView.manyBy$(W=>!0===W.state.selected).pipe((0,P.k)(W=>W.map(w=>w.entity))));this.stores$$=(0,L.E)(A).pipe((0,o.o)(5),(0,f.s)(1),(0,P.k)(k=>k.reduce((W,w)=>W.concat(w)))).subscribe(k=>this.onSelectFromStore(k))}unwatchAll(){void 0!==this.stores$$&&this.stores$$.unsubscribe()}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",A=>{this.onMapClick(A)})}unlistenToMapClick(){(0,e.S)(this.mapClickListener)}onMapClick(A){const k=!(0,y.q)(A),W=!k,w=A.map.getFeaturesAtPixel(A.pixel,{hitTolerance:this.options.hitTolerance||0,layerFilter:te=>void 0!==this.stores.find(K=>K.layer?.ol===te)});this.onSelectFromMap(w,k,W)}addDragBoxInteraction(){let A;const k=this.map.ol.getInteractions().getArray();for(const W of k)if(W instanceof T){A=W;break}void 0===A&&(A=new T({condition:y.q}),this.map.ol.addInteraction(A),this.olDragSelectInteraction=A),this.olDragSelectInteractionEndKey=A.on("boxend",W=>this.onDragBoxEnd(W))}removeDragBoxInteraction(){void 0!==this.olDragSelectInteractionEndKey&&(0,e.S)(this.olDragSelectInteractionEndKey),void 0!==this.olDragSelectInteraction&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=void 0}onDragBoxEnd(A){const k=!(0,y.q)(A.mapBrowserEvent),w=A.target.getGeometry().getExtent(),te=this.stores.reduce((Z,K)=>{const X=K.layer.ol.getSource();return Z.push(...X.getFeaturesInExtent(w)),Z},[]);this.onSelectFromMap(te,k,!1)}onSelectFromStore(A){const k=this.motion,w=this.overlayStore.layer.ol.getSource().getFeatures().map(K=>K.getId()),te=A.map(this.overlayStore.getKey);let Z;Z=0!==A.length&&(w.length!==te.length||!w.every(K=>te.indexOf(K)>=0)),this.overlayStore.setLayerFeatures(A,Z?k:O.S.None,this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)}onSelectFromMap(A,k,W){const w=this.groupFeaturesByStore(A);this.stores.forEach(te=>{const Z=w.get(te);void 0===Z&&!0===k?this.unselectAllFeaturesFromStore(te):void 0===Z&&!1===k||this.selectFeaturesFromStore(te,Z,k,W)})}selectFeaturesFromStore(A,k,W,w){!0===w?A.state.reverseMany(k,["selected"]):A.state.updateMany(k,{selected:!0},W)}unselectAllFeaturesFromStore(A){A.state.updateAll({selected:!1})}groupFeaturesByStore(A){const k=new Map;return null==A||A.forEach(W=>{const w=W.get("_featureStore");if(void 0===w)return;let te=k.get(w);void 0===te&&(te=[],k.set(w,te));const Z=w.get(W.getId());void 0!==Z&&te.push(Z)}),k}createOverlayStore(){const A=this.options.layer?this.options.layer:this.createOverlayLayer();return new x.y([],{map:this.map}).bindLayer(A)}createOverlayLayer(){return new R.M({zIndex:300,source:new h.EB,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1})}addOverlayLayer(){void 0===this.overlayStore.layer.map&&this.map.addLayer(this.overlayStore.layer)}removeOverlayLayer(){this.overlayStore.source.ol.clear(),this.map.removeLayer(this.overlayStore.layer)}}},5196:(Fe,ce,r)=>{"use strict";r.d(ce,{e:()=>e,w:()=>C});var C=function(d){return d.BasicNumericOperator="basicnumericoperator",d.Basic="basic",d.BasicAndSpatial="basicandspatial",d.Spatial="spatial",d.All="all",d.Time="time",d}(C||{}),e=function(d){return d.BBOX="BBox",d.PropertyIsBetween="PropertyIsBetween",d.Contains="Contains",d.During="During",d.PropertyIsEqualTo="PropertyIsEqualTo",d.PropertyIsGreaterThan="PropertyIsGreaterThan",d.PropertyIsGreaterThanOrEqualTo="PropertyIsGreaterThanOrEqualTo",d.Intersects="Intersects",d.PropertyIsNull="PropertyIsNull",d.PropertyIsLessThan="PropertyIsLessThan",d.PropertyIsLessThanOrEqualTo="PropertyIsLessThanOrEqualTo",d.PropertyIsLike="PropertyIsLike",d.PropertyIsNotEqualTo="PropertyIsNotEqualTo",d.Within="Within",d.And="And",d.Or="Or",d.Not="Not",d}(e||{})},40912:(Fe,ce,r)=>{"use strict";r.d(ce,{S:()=>h});var C=r(43168),e=r(11544),d=r(10416),L=r(68470),P=r(30816),o=r.n(P),f=r(5196);class h{filterSequence=[];operators={[f.e.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[f.e.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[f.e.PropertyIsLike]:{spatial:!1,fieldRestrict:["string"]},[f.e.PropertyIsGreaterThan]:{spatial:!1,fieldRestrict:["number"]},[f.e.PropertyIsGreaterThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[f.e.PropertyIsLessThan]:{spatial:!1,fieldRestrict:["number"]},[f.e.PropertyIsLessThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[f.e.PropertyIsBetween]:{spatial:!1,fieldRestrict:["number"]},[f.e.During]:{spatial:!1,fieldRestrict:[]},[f.e.PropertyIsNull]:{spatial:!1,fieldRestrict:[]},[f.e.Intersects]:{spatial:!0,fieldRestrict:[]},[f.e.Within]:{spatial:!0,fieldRestrict:[]},[f.e.Contains]:{spatial:!0,fieldRestrict:[]}};defineOgcFiltersDefaultOptions(y,O,x){let T=!0;return x&&"wms"===x&&(T=!1),(y=y||{}).enabled=void 0===y.enabled?T:y.enabled,y.editable=void 0===y.editable?T:y.editable,y.geometryName=O,y.advancedOgcFilters=!0,y.enabled&&(y.pushButtons||y.checkboxes||y.radioButtons||y.select||y.autocomplete)&&(y.advancedOgcFilters=!1),y}buildFilter(y,O,x,T,a){let F,A,k;if(A=!/intersects|contains|within/gi.test(JSON.stringify(y)),y&&(T=void 0!==y.geometryName?y.geometryName:T),O&&y&&(F=L.OK(T,O,x.getCode())),!y)return"bbox="+O.join(",")+","+x.getCode();y=this.checkIgoFiltersProperties(y,T,x),k=O&&A?L.iG(F,this.bundleFilter(y,a)):this.bundleFilter(y,a);const W={srsName:"",featureNS:"",featurePrefix:"",featureTypes:["featureTypes"],filter:k,outputFormat:"",geometryName:T},w=(new e.c).writeGetFeature(W);return"filter="+(new XMLSerializer).serializeToString(w).split(/typenames *=|typename *=\"featureTypes\" *>/gi)[1].split(/<\/Query><\/GetFeature>/gi)[0]}bundleFilter(y,O){if(y instanceof Array){const x=[];return y.forEach(T=>{x.push(this.bundleFilter(T,O))}),x}return y.hasOwnProperty("logical")?this.createFilter({operator:y.logical,logicalArray:this.bundleFilter(y.filters,O)},O):y.hasOwnProperty("operator")?this.createFilter(y,O):void 0}createFilter(y,O){const x=y.operator,T=y.logicalArray,a=y.propertyName,F=y.pattern,A=!y.matchCase||y.matchCase,k=y.wildCard?y.wildCard:"*",W=y.singleChar?y.singleChar:".",w=y.escapeChar?y.escapeChar:"!",te=y.lowerBoundary,Z=y.upperBoundary,K=y.geometryName,X=y.extent,V=y.wkt_geometry,B=y.srsName?y.srsName:"EPSG:3857",z=this.parseFilterOptionDate(y.begin,O?O.minDate:void 0),c=this.parseFilterOptionDate(y.end,O?O.maxDate:void 0),I=y.expression;let b;switch(V&&(b=(new d.c).readGeometry(V,{dataProjection:B,featureProjection:B||"EPSG:3857"})),x.toLowerCase()){case f.e.BBOX.toLowerCase():return L.OK(K,X,B);case f.e.PropertyIsBetween.toLowerCase():return L.YX(a,te||-1e40,Z||1e40);case f.e.Contains.toLowerCase():return L.Y7(K,b,B);case f.e.During.toLowerCase():return L.In(a,z,c);case f.e.PropertyIsEqualTo.toLowerCase():return L.cv(a,I,A);case f.e.PropertyIsGreaterThan.toLowerCase():return L.kP(a,I);case f.e.PropertyIsGreaterThanOrEqualTo.toLowerCase():return L.Ky(a,I);case f.e.Intersects.toLowerCase():return L.K0(K,b,B);case f.e.PropertyIsNull.toLowerCase():return L.Av(a);case f.e.PropertyIsLessThan.toLowerCase():return L.cP(a,I);case f.e.PropertyIsLessThanOrEqualTo.toLowerCase():return L.ov(a,I);case f.e.PropertyIsLike.toLowerCase():return L.G2(a,F?F.replace(/[()_]/gi,W):k,k,W,w,A);case f.e.PropertyIsNotEqualTo.toLowerCase():return L.Qb(a,I,A);case f.e.Within.toLowerCase():return L.Cu(K,b,B);case f.e.And.toLowerCase():return L.iG.apply(null,T);case f.e.Or.toLowerCase():return L.or.apply(null,T);case f.e.Not.toLowerCase():return L.ik.apply(null,T);default:return}}defineInterfaceFilterSequence(y,O,x="",T=-1){return y instanceof Array?y.forEach(a=>{this.filterSequence.concat(this.defineInterfaceFilterSequence(a,O,x,T))}):y.hasOwnProperty("logical")?this.filterSequence.concat(this.defineInterfaceFilterSequence(y.filters,O,y.logical,T+=1)):y.hasOwnProperty("operator")&&this.filterSequence.push(this.addInterfaceFilter(y,O,T,x)),this.filterSequence}computeAllowedOperators(y,O,x){let a,F,A,T={};if(y&&O){const k=y.find(W=>W.name===O);a=k&&k.allowedOperatorsType?k.allowedOperatorsType:x}switch(y&&y.map(k=>{if(!k.allowedOperatorsType)return;const W=k.allowedOperatorsType.toLowerCase();(W===f.w.All.toLowerCase()||W===f.w.Spatial.toLowerCase()||W===f.w.BasicAndSpatial.toLowerCase())&&(F=!0,W===f.w.All.toLowerCase()&&(A=!0))}),a=a||f.w.BasicAndSpatial,a.toLowerCase()){case f.w.All:T=this.operators;break;case f.w.Spatial:T={[f.e.Intersects]:{spatial:!0,fieldRestrict:[]},[f.e.Within]:{spatial:!0,fieldRestrict:[]}};break;case f.w.BasicAndSpatial:T={[f.e.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[f.e.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[f.e.Intersects]:{spatial:!0,fieldRestrict:[]},[f.e.Within]:{spatial:!0,fieldRestrict:[]}};break;case f.w.Basic:T={[f.e.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[f.e.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]}};break;case f.w.Time:T={[f.e.During]:{spatial:!1,fieldRestrict:[]}};break;case f.w.BasicNumericOperator:T={[f.e.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[f.e.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[f.e.PropertyIsGreaterThan]:{spatial:!1,fieldRestrict:["number"]},[f.e.PropertyIsGreaterThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[f.e.PropertyIsLessThan]:{spatial:!1,fieldRestrict:["number"]},[f.e.PropertyIsLessThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]}};break;default:T={[f.e.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[f.e.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[f.e.Intersects]:{spatial:!0,fieldRestrict:[]},[f.e.Within]:{spatial:!0,fieldRestrict:[]}}}return F&&(T.Intersects={spatial:!0,fieldRestrict:[]},T.Within={spatial:!0,fieldRestrict:[]},A&&(T.Contains={spatial:!0,fieldRestrict:[]})),T}addInterfaceFilter(y,O,x=0,T="Or"){y||(y={operator:"PropertyIsEqualTo"});const a={propertyName:"",operator:"",active:"",filterid:(0,C.uq)(),step:"",begin:"",end:"",sliderOptions:{},lowerBoundary:"",upperBoundary:"",expression:"",pattern:"",wildCard:"*",singleChar:".",escapeChar:"!",matchCase:!0,igoSpatialSelector:"",igoSNRC:"",geometryName:"",geometry:"",wkt_geometry:"",extent:"",srsName:"",parentLogical:"",level:0};return Object.assign(a,{parentLogical:T,level:x,geometryName:O},y)}checkIgoFiltersProperties(y,O,x,T=!1){const a=[];return y instanceof Array?(y.forEach(F=>{a.push(this.checkIgoFiltersProperties(F,O,x,T))}),a):y.hasOwnProperty("logical")?Object.assign({},{logical:y.logical,filters:this.checkIgoFiltersProperties(y.filters,O,x,T)}):y.hasOwnProperty("operator")?this.addFilterProperties(y,O,x,T):void 0}addFilterProperties(y,O,x,T=!1){const a=y.hasOwnProperty("filterid")?y.filterid:(0,C.uq)(),F=y.hasOwnProperty("active")?y.active:T,A=y.hasOwnProperty("srsName")?y.srsName:x?x.getCode():"EPSG:3857";return Object.assign({},{filterid:a,active:F,igoSpatialSelector:"fixedExtent",srsName:A},y,{geometryName:O})}rebuiltIgoOgcFilterObjectFromSequence(y){if(y instanceof Array&&y.length>=1){let x,a,O=y[0].parentLogical,T=[];return y.forEach(F=>{const A=Object.assign({},F),k=y.indexOf(F);x=k>=0&&k<y.length-1?y[k+1]:A,delete A.active,delete A.filterid,delete A.parentLogical,T.push(A),1===y.length?a=A:O!==x.parentLogical&&(1===T.length?console.log("You must set at least two operator in a logical ("+O+")"):(a=Object.assign({},{logical:O,filters:T}),T=[a],O=x.parentLogical))}),a}}computeIgoSelector(y){if(y.groups.every(x=>void 0!==x.computedSelectors))return y;let O;if(y.groups&&y.bundles){if(!y.bundles.every(x=>void 0!==x.id))throw new Error("You must set an id for each of your bundles");O=C.Yv.copyDeep(y),O.groups.forEach(x=>{x.title=x.title?x.title:x.name,x.enabled=!!x.enabled&&x.enabled,x.computedSelectors=C.Yv.copyDeep(O.bundles.filter(T=>x.ids.includes(T.id)))})}else!y.groups&&y.bundles?(O=C.Yv.copyDeep(y),O.groups=[{title:"group1",name:"group1",computedSelectors:C.Yv.copyDeep(O.bundles)}]):O={bundles:y,groups:[{title:"group1",name:"group1",computedSelectors:C.Yv.copyDeep(y)}],selectorType:O.selectorType};return O.groups.find(x=>x.enabled)||(O.groups[0].enabled=!0),O}handleOgcFiltersAppliedValue(y,O,x,T){const a=y.ogcFilters;if(!a)return;const F=[];let A="",k="";if(a.enabled&&(a.pushButtons||a.checkboxes||a.radioButtons||a.select||a.autocomplete)){let w;if(a.pushButtons){w=a.pushButtons;const te=this.formatGroupAndFilter(a,w);for(const Z of te)F.push(Z)}if(a.checkboxes){w=a.checkboxes;const te=this.formatGroupAndFilter(a,w);for(const Z of te)F.push(Z)}if(a.radioButtons){w=a.radioButtons;const te=this.verifyMultipleEnableds(w),Z=this.formatGroupAndFilter(a,te);for(const K of Z)F.push(K)}if(a.select){w=a.select;const te=this.verifyMultipleEnableds(w),Z=this.formatGroupAndFilter(a,te);for(const K of Z)F.push(K)}if(a.autocomplete){w=a.autocomplete;const te=this.formatGroupAndFilter(a,w);for(const Z of te)F.push(Z)}F.length>=1&&(A=this.buildFilter(1===F.length?F[0]:{logical:"And",filters:F},x,T,a.geometryName))}a.enabled&&a.filters&&(a.geometryName=a.geometryName||O,k=this.buildFilter(a.filters,x,T,a.geometryName,y));let W=a.advancedOgcFilters?k:A;return"wms"===y.type&&(W=this.formatProcessedOgcFilter(W,y.params.LAYERS)),"wfs"===y.type&&(W=this.formatProcessedOgcFilter(W,y.params.featureTypes)),W}verifyMultipleEnableds(y){return y.bundles.forEach(O=>{if(!O.multiple&&O.selectors){const x=O.selectors.reduce((T,a,F)=>!0===a.enabled?T.concat(F):T,[]);x.length>1&&(x.splice(0,1),x.forEach(T=>{O.selectors[T].enabled=!1}))}}),y}formatGroupAndFilter(y,O){const x=(O=this.computeIgoSelector(O)).groups.find(a=>a.enabled).computedSelectors,T=[];return x.map(a=>{const F=[],A=a.selectors;A&&(A.filter(k=>!0===k.enabled).forEach(k=>F.push(k.filters)),1===F.length?T.push(F[0]):F.length>1&&T.push({logical:a.logical,filters:F}))}),"pushButton"===O.selectorType?y.pushButtons=O:"checkbox"===O.selectorType?y.checkboxes=O:"radioButton"===O.selectorType?y.radioButtons=O:"select"===O.selectorType?y.select=O:"autocomplete"===O.selectorType&&(y.autocomplete=O),T}formatProcessedOgcFilter(y,O){if(!y)return;let x="";return 0===y.length&&-1===O.indexOf(",")?x=y:O.split(",").forEach(a=>{x=`${x}(${y.replace("filter=","")})`}),x=x.replace(/\(\)/g,""),x.length>0?x.replace("filter=",""):void 0}parseFilterOptionDate(y,O){return y?"today"===y?void 0:o()(y).isValid()?y:void 0:O}}},14191:(Fe,ce,r)=>{"use strict";r.d(ce,{D:()=>e,U:()=>C});var C=function(d){return d.DATE="date",d.TIME="time",d.DATETIME="datetime",d.YEAR="year",d}(C||{}),e=function(d){return d.CALENDAR="calendar",d.SLIDER="slider",d}(e||{})},17115:(Fe,ce,r)=>{"use strict";r.d(ce,{i:()=>x});var C=r(83552),e=r(96764),d=r(32736),L=r(99376),P=r(25696),o=r(53156),f=r(28772),h=r(61616),R=r(54844),y=r(93244),O=r(36124);class x{options;start$=new h.E;end$=new h.E;changes$=new h.E;modify$=new h.E;select$=new h.E;abort$=new h.E;freehand$=new R.g(!1);ispredefinedRadius$=new R.g(!1);predefinedRadius$=new R.g(void 0);radiusDrawEnd$=new R.g(void 0);keyDown$$;olGeometryType;olInteractionStyle;olMap;olDrawingLayer;olDrawInteraction;olSelectInteraction;olModifyInteraction;onDrawStartKey;onDrawEndKey;onDrawAbortKey;onDrawKey;radius;mousePosition;get radiusVal(){return this.predefinedRadius$.getValue()}set radiusValData(a){this.predefinedRadius$.next(a)}get active(){return void 0!==this.olMap}get olDrawingLayerSource(){return this.olDrawingLayer.getSource()}constructor(a){this.options=a,this.olDrawingLayer=a.drawingLayer?a.drawingLayer:this.createOlInnerOverlayLayer(),this.olGeometryType=this.options.geometryType,this.olInteractionStyle=this.options.interactionStyle}setOlMap(a,F){if(!a)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlInteractions(),void(this.olMap=a);this.olMap=a,this.addOlInnerOverlayLayer(),this.addOlInteractions(F)}getSource(){return this.olDrawingLayerSource}setOlInteractionStyle(a){this.olInteractionStyle=a}setGeometryType(a){this.olGeometryType=a}getGeometryType(){return this.olGeometryType}createOlInnerOverlayLayer(){return new o.c({source:this.options.drawingLayerSource?this.options.drawingLayerSource:new f.c,style:this.options.drawingLayerStyle,zIndex:500})}removeOlInnerOverlayLayer(){!this.options.drawingLayer&&this.olMap&&this.olMap.removeLayer(this.olDrawingLayer)}addOlInnerOverlayLayer(){this.options.drawingLayer||this.olMap.addLayer(this.olDrawingLayer)}clearOlInnerOverlaySource(){!this.options.drawingLayer&&!this.options.drawingLayerSource&&this.olDrawingLayerSource.clear(!0)}addOlInteractions(a){let F;if(F=this.freehand$.getValue()?new d.cp("Point"===this.olGeometryType?{type:"Circle",source:this.getSource(),style:"function"==typeof this.olInteractionStyle?void 0:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!0}:{type:this.olGeometryType,source:this.getSource(),style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!0}):this.ispredefinedRadius$.getValue()?new d.cp({type:"Point",source:this.getSource(),stopClick:!0,style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:()=>!1}):new d.cp({type:this.olGeometryType,source:this.getSource(),stopClick:!0,style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:()=>!1}),this.olMap.addInteraction(F),this.olDrawInteraction=F,this.onDrawStartKey=F.on("drawstart",A=>this.onDrawStart(A)),this.onDrawEndKey=F.on("drawend",A=>this.onDrawEnd(A)),this.onDrawAbortKey=F.on("drawabort",A=>this.abort$.next(A.feature.getGeometry())),a){const A=new L.c({source:this.getSource()});if(this.olMap.addInteraction(A),this.olModifyInteraction=A,!this.olSelectInteraction){const k=new P.c({condition:e.q0,style:void 0});this.olMap.addInteraction(k),this.olSelectInteraction=k,this.olSelectInteraction.on("select",W=>this.onSelect(W))}}}removeOlInteractions(){this.unsubscribeKeyDown(),(0,C.S)([this.onDrawStartKey,this.onDrawEndKey,this.onDrawKey,this.onDrawAbortKey]),this.olMap&&(this.olMap.removeInteraction(this.olDrawInteraction),this.olMap.removeInteraction(this.olModifyInteraction)),this.olDrawInteraction=void 0,this.olModifyInteraction=void 0}onDrawStart(a){const F=a.feature.getGeometry();this.start$.next(F),this.clearOlInnerOverlaySource(),this.onDrawKey=F.on("change",A=>{this.mousePosition=(0,O.y6)(A),this.changes$.next(A.target)}),this.subscribeKeyDown()}onDrawEnd(a){"Point"===a.feature.getGeometry().getType()&&this.radiusDrawEnd$.next(this.predefinedRadius$.getValue()),this.unsubscribeKeyDown(),(0,C.S)(this.onDrawKey);const F=a.feature.getGeometry();F.on("change",()=>{this.modify$.next(F)}),this.end$.next(F)}onSelect(a){1===a.selected.length&&this.select$.next(a.selected[0])}subscribeKeyDown(){this.unsubscribeKeyDown(),this.keyDown$$=(0,y.w)(document,"keydown").subscribe(a=>{"Escape"!==a.key?("Backspace"===a.key&&this.olDrawInteraction.removeLastPoint(),"Enter"===a.key&&this.olDrawInteraction.finishDrawing()," "!==a.key||this.olMap.getView().animate({center:this.mousePosition,duration:100})):this.olDrawInteraction.abortDrawing()})}unsubscribeKeyDown(){this.keyDown$$&&(this.keyDown$$.unsubscribe(),this.keyDown$$=void 0)}}},48908:(Fe,ce,r)=>{"use strict";r.d(ce,{i4:()=>C.i,Up:()=>F});var C=r(17115),e=r(58264),d=r(83552),L=r(12760),P=r(36752),o=r(56224),f=r(32736),h=r(99376),R=r(98492),y=r(53156),O=r(28772),x=r(61616),T=r(93244),a=r(36124);class F{options;start$=new x.E;end$=new x.E;changes$=new x.E;olMap;olOverlayLayer;olModifyInteraction;onModifyStartKey;onModifyEndKey;onModifyKey;olModifyInteractionIsActive=!1;olTranslateInteraction;onTranslateStartKey;onTranslateEndKey;onTranslateKey;olTranslateInteractionIsActive=!1;olDrawInteraction;onDrawStartKey;onDrawEndKey;onDrawKey;olDrawInteractionIsActive=!1;mousePosition;keyDown$$;drawKeyUp$$;drawKeyDown$$;removedOlInteractions=[];olLinearRingsLayer;olOuterGeometry;get active(){return void 0!==this.olMap}get olOverlaySource(){return this.olOverlayLayer.getSource()}get olLinearRingsSource(){return this.olLinearRingsLayer.getSource()}modify=!0;translate=!0;constructor(w){this.options=w,void 0!==w.modify&&(this.modify=w.modify),void 0!==w.translate&&(this.translate=w.translate),this.olOverlayLayer=void 0!==w.layer?w.layer:this.createOlInnerOverlayLayer(),this.olLinearRingsLayer=this.createOlLinearRingsLayer()}setOlMap(w){if(void 0===w)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlModifyInteraction(),this.removeOlTranslateInteraction(),this.removeOlDrawInteraction(),void(this.olMap=w);this.olMap=w,this.addOlInnerOverlayLayer(),!0===this.modify&&this.addOlDrawInteraction(),!0===this.translate&&(this.addOlTranslateInteraction(),this.activateTranslateInteraction()),!0===this.modify&&(this.addOlModifyInteraction(),this.activateModifyInteraction())}getSource(){return this.olOverlaySource}setOlGeometry(w){const te=new e.c({geometry:w});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(te)}createOlInnerOverlayLayer(){return new y.c({source:this.options.source?this.options.source:new O.c,style:this.options.layerStyle,zIndex:500})}addOlInnerOverlayLayer(){void 0===this.options.layer&&this.olMap.addLayer(this.olOverlayLayer)}removeOlInnerOverlayLayer(){void 0===this.options.layer&&void 0!==this.olMap&&this.olMap.removeLayer(this.olOverlayLayer)}clearOlInnerOverlaySource(){void 0===this.options.layer&&void 0===this.options.source&&this.olOverlaySource.clear(!0)}createOlLinearRingsLayer(){return new y.c({source:new O.c,style:(0,a.cb)(),zIndex:500})}addOlLinearRingsLayer(){this.olMap.addLayer(this.olLinearRingsLayer)}removeOlLinearRingsLayer(){this.olMap.removeLayer(this.olLinearRingsLayer)}clearOlLinearRingsSource(){this.olLinearRingsSource.clear(!0)}addOlModifyInteraction(){const w=new h.c({source:this.olOverlaySource,style:this.options.drawStyle});this.olModifyInteraction=w}removeOlModifyInteraction(){void 0!==this.olModifyInteraction&&(this.deactivateModifyInteraction(),this.olModifyInteraction=void 0)}activateModifyInteraction(){!0!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!0,this.onModifyStartKey=this.olModifyInteraction.on("modifystart",w=>this.onModifyStart(w)),this.onModifyEndKey=this.olModifyInteraction.on("modifyend",w=>this.onModifyEnd(w)),this.olMap.addInteraction(this.olModifyInteraction))}deactivateModifyInteraction(){!1!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!1,(0,d.S)([this.onModifyStartKey,this.onModifyEndKey,this.onModifyKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olModifyInteraction))}onModifyStart(w){const te=w.features.item(0).getGeometry();this.start$.next(te),this.onModifyKey=te.on("change",Z=>{this.mousePosition=(0,a.y6)(Z),this.changes$.next(Z.target)}),this.subscribeToKeyDown()}onModifyEnd(w){(0,d.S)(this.onModifyKey),this.end$.next(w.features.item(0).getGeometry()),this.unsubscribeToKeyDown()}subscribeToKeyDown(){this.keyDown$$=(0,T.w)(document,"keydown").subscribe(w=>{" "!==w.key||this.olMap.getView().animate({center:this.mousePosition,duration:0})})}unsubscribeToKeyDown(){void 0!==this.keyDown$$&&this.keyDown$$.unsubscribe()}addOlTranslateInteraction(){const w=new R.c({layers:[this.olOverlayLayer]});this.olTranslateInteraction=w}removeOlTranslateInteraction(){void 0!==this.olTranslateInteraction&&(this.deactivateTranslateInteraction(),this.olTranslateInteraction=void 0)}activateTranslateInteraction(){!0!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!0,this.onTranslateStartKey=this.olTranslateInteraction.on("translatestart",w=>this.onTranslateStart(w)),this.onTranslateEndKey=this.olTranslateInteraction.on("translateend",w=>this.onTranslateEnd(w)),this.olMap.addInteraction(this.olTranslateInteraction))}deactivateTranslateInteraction(){!1!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!1,(0,d.S)([this.onTranslateStartKey,this.onTranslateEndKey,this.onTranslateKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olTranslateInteraction))}onTranslateStart(w){const te=w.features.item(0).getGeometry();this.start$.next(te),this.onTranslateKey=te.on("change",Z=>{})}onTranslateEnd(w){(0,d.S)(this.onTranslateKey),this.end$.next(w.features.item(0).getGeometry())}addOlDrawInteraction(){const w=new f.cp({type:"Polygon",source:this.olLinearRingsSource,stopClick:!0,style:(0,a.cb)(),condition:te=>(this.olOuterGeometry||this.getOlGeometry()).intersectsCoordinate(te.coordinate)});this.olDrawInteraction=w,this.subscribeToDrawKeyDown()}subscribeToDrawKeyDown(){this.drawKeyDown$$=(0,T.w)(document,"keydown").subscribe(w=>{if("Control"!==w.key)return;this.unsubscribeToDrawKeyDown();const te=this.getOlGeometry();!te||!(te instanceof P.cp)||(this.subscribeToDrawKeyUp(),this.deactivateModifyInteraction(),this.deactivateTranslateInteraction(),this.activateDrawInteraction())})}subscribeToDrawKeyUp(){this.drawKeyUp$$=(0,T.w)(document,"keyup").subscribe(w=>{"Control"===w.key&&(this.unsubscribeToDrawKeyUp(),this.unsubscribeToKeyDown(),this.deactivateDrawInteraction(),this.activateModifyInteraction(),!0===this.translate&&this.activateTranslateInteraction(),this.subscribeToDrawKeyDown(),this.olOuterGeometry=void 0,this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()))})}unsubscribeToDrawKeyDown(){void 0!==this.drawKeyDown$$&&this.drawKeyDown$$.unsubscribe()}unsubscribeToDrawKeyUp(){void 0!==this.drawKeyUp$$&&this.drawKeyUp$$.unsubscribe()}removeOlDrawInteraction(){void 0!==this.olDrawInteraction&&(this.unsubscribeToKeyDown(),this.unsubscribeToDrawKeyUp(),this.unsubscribeToDrawKeyDown(),this.deactivateDrawInteraction(),this.clearOlLinearRingsSource(),this.olDrawInteraction=void 0)}activateDrawInteraction(){!0!==this.olDrawInteractionIsActive&&(this.clearOlLinearRingsSource(),this.addOlLinearRingsLayer(),this.olMap.getInteractions().forEach(w=>{w instanceof o.c&&(this.olMap.removeInteraction(w),this.removedOlInteractions.push(w))}),this.olDrawInteractionIsActive=!0,this.onDrawStartKey=this.olDrawInteraction.on("drawstart",w=>this.onDrawStart(w)),this.onDrawEndKey=this.olDrawInteraction.on("drawend",w=>this.onDrawEnd(w)),this.olMap.addInteraction(this.olDrawInteraction))}deactivateDrawInteraction(){!1!==this.olDrawInteractionIsActive&&(this.removeOlLinearRingsLayer(),this.removedOlInteractions.forEach(w=>{this.olMap.addInteraction(w)}),this.removedOlInteractions=[],this.olDrawInteractionIsActive=!1,(0,d.S)([this.onDrawStartKey,this.onDrawEndKey,this.onDrawKey]),void 0!==this.olMap&&this.olMap.removeInteraction(this.olDrawInteraction))}onDrawStart(w){const te=w.feature.getGeometry();this.olOuterGeometry=this.getOlGeometry().clone();const Z=te.getLinearRing().getCoordinates();this.addLinearRingToOlGeometry(Z),this.start$.next(this.getOlGeometry()),this.onDrawKey=te.on("change",K=>{this.mousePosition=(0,a.y6)(K);const V=K.target.getLinearRing(0).getCoordinates();this.updateLinearRingOfOlGeometry(V),this.changes$.next(this.getOlGeometry())}),this.subscribeToKeyDown()}onDrawEnd(w){(0,d.S)(this.onDrawKey),this.olOuterGeometry=void 0;const te=w.feature.getGeometry().getLinearRing().getCoordinates();this.updateLinearRingOfOlGeometry(te),this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()),this.unsubscribeToKeyDown()}addLinearRingToOlGeometry(w){const te=this.getOlGeometry(),Z=new L.c(w);(0,a.wv)(te,Z)}updateLinearRingOfOlGeometry(w){const te=this.getOlGeometry(),K=te.getLinearRings().slice(0,-1).map(X=>X.getCoordinates());K.push(w),te.setCoordinates(K)}getOlGeometry(){const w=this.olOverlaySource.getFeatures();return w.length>0?w[0].getGeometry():void 0}}r(52836)},52836:(Fe,ce,r)=>{"use strict";Error},36124:(Fe,ce,r)=>{"use strict";r.d(ce,{cb:()=>y,gD:()=>R,wv:()=>a,y6:()=>F});var C=r(36752),e=r(87544),d=r(45212),L=r(88872),P=r(54776);function R(A){return new e.c({stroke:new d.c({color:(A=A||[0,153,255]).concat([1]),width:2}),fill:new L.c({color:A.concat([.2])}),radius:8})}function y(){return new P.cp({stroke:new d.c({color:[0,153,255,1],width:2})})}function a(A,k){A.appendLinearRing(k)}function F(A){const k=A.target;return k instanceof C.cp?k.getFlatCoordinates().slice(-4,-2):k.getFlatCoordinates().slice(-2)}r(72855),r(11432),r(52836)},41912:(Fe,ce,r)=>{"use strict";r.d(ce,{Up:()=>d.Up,i4:()=>d.i4}),r(52836),r(36124);var d=r(48908)},99228:(Fe,ce,r)=>{"use strict";r.d(ce,{IZ:()=>C.I,Md:()=>e.Md,aG:()=>e.aG,wL:()=>e.wL});var C=r(7036),e=r(56708)},8492:(Fe,ce,r)=>{"use strict";r.d(ce,{i:()=>C});const C="Layer"},7036:(Fe,ce,r)=>{"use strict";r.d(ce,{I:()=>V});var C=r(58752),e=r(93020),d=r(43168),L=r(54776),P=r(80372),o=r(21296),f=r(1296),h=r(35876),R=r(40604),y=r(51672),O=r(10211),x=r(61200),T=r(3544),a=r(39532),F=r(82048);function A(B){const z=B;return"mvt"===z.sourceOptions?.type&&(z.igoStyle?.styleByAttribute?.hoverStyle||z.igoStyle?.hoverStyle)&&(z.sourceOptions.featureClass=z.sourceOptions.featureClass||"feature"),B}var k=r(56708),W=r(34896),w=r(33712),te=r(61616),Z=r(83680),K=r(96832);let X=(()=>{class B{ngxIndexedDBService;dbName="layerData";constructor(c){this.ngxIndexedDBService=c}update(c){const I=new te.E;return this.ngxIndexedDBService.getByID(this.dbName,c.layerId).pipe((0,Z.K)(),(0,O.m)(b=>b?this.customUpdate(c):this.ngxIndexedDBService.add(this.dbName,c))).subscribe(b=>{I.next(b),I.complete()}),I}customUpdate(c){const I=new te.E;return this.ngxIndexedDBService.deleteByKey(this.dbName,c.layerId).pipe((0,O.m)(G=>G?this.ngxIndexedDBService.add(this.dbName,c):(0,f.of)(void 0))).subscribe(G=>{G&&I.next(G),I.complete()}),I}getByID(c){return this.ngxIndexedDBService.getByID(this.dbName,c)}deleteByKey(c){return this.ngxIndexedDBService.deleteByKey(this.dbName,c)}getAll(){return this.ngxIndexedDBService.getAll(this.dbName)}static \u0275fac=function(I){return new(I||B)(W.CoB(K.aQ))};static \u0275prov=W.wxM({token:B,factory:B.\u0275fac,providedIn:"root"})}return B})(),V=(()=>{class B{http;styleService;dataSourceService;geoNetworkService;messageService;layerDBService;authInterceptor;constructor(c,I,b,G,D,g,U){this.http=c,this.styleService=I,this.dataSourceService=b,this.geoNetworkService=G,this.messageService=D,this.layerDBService=g,this.authInterceptor=U}createLayer(c){if(!c.source)return;let I;switch(c.source.options&&c.source.options._layerOptionsFromSource&&(c=d.Yv.mergeDeep(c.source.options._layerOptionsFromSource,c||{})),c.source.constructor){case T.yC:case T.m6:case T.nA:case T.Uv:case T.aI:case T.W4:I=this.createTileLayer(c);break;case T.EB:case T.ak:case T.IH:case T.cR:case T.a:I=this.createVectorLayer(c);break;case T.yA:case T.CK:I=this.createImageLayer(c);break;case T.cv:const b=A(c);I=this.createVectorTileLayer(b)}return I}createAsyncLayer(c,I){const b=A(c);return b.source?new o._(G=>G.next(this.createLayer(b))):this.dataSourceService.createAsyncDataSource(b.sourceOptions,I).pipe((0,R.k)(G=>{if(void 0!==G)return this.createLayer(Object.assign(b,{source:G}))}))}createImageLayer(c){return new k.Iw(c,this.messageService,this.authInterceptor)}createTileLayer(c){return new k.t9(c,this.messageService,this.authInterceptor)}createVectorLayer(c){let b,I=c.style;if(c.igoStyle||(c.igoStyle={}),this.handleLegacyStyles(c,["styleByAttribute","hoverStyle","mapboxStyle","clusterBaseStyle","style"]),c.igoStyle.igoStyleObject&&!c.idbInfo?.storeToIdb?I=(g,U)=>this.styleService.createStyle(c.igoStyle.igoStyleObject,g,U):c.igoStyle.igoStyleObject&&c.idbInfo?.storeToIdb&&(I=this.styleService.parseStyle("style",c.igoStyle.igoStyleObject)),c.source instanceof T.IH)I=c.source.options.params.style;else if(c.igoStyle?.styleByAttribute){const g=this.styleService;c.style=(U,M)=>g.createStyleByAttribute(U,c.igoStyle.styleByAttribute,M),b=new k.Md(c,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)}if(c.source instanceof T.a){const g=this.styleService,U=c.igoStyle.clusterBaseStyle;c.style=(M,H)=>g.createClusterStyle(M,H,c.clusterParam,U),b=new k.Md(c,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)}const D=Object.assign({},c,{style:I});return b||(b=new k.Md(D,this.messageService,this.authInterceptor,this.geoNetworkService,this.geoNetworkService.geoDBService,this.layerDBService)),this.applyMapboxStyle(b,D),b}handleLegacyStyles(c,I){I.map(b=>{if(c[b]){let G=b;if("style"===b){if(c[b]instanceof L.cp)return;if("object"!=typeof c[b])return;G="igoStyleObject"}c.igoStyle[G]=c[b],delete c[b],console.warn(`\n        The location of this style option (${b}) is deprecated.\n        Please move this property within igoStyle property.\n        Ex: ${b}: {...} must be transfered to igoStyle: { ${G}: {...} }\n        This legacy conversion will be deleted in 2024.\n        `)}})}createVectorTileLayer(c){let I,b;if(c.igoStyle||(c.igoStyle={}),this.handleLegacyStyles(c,["styleByAttribute","hoverStyle","mapboxStyle","style"]),c.igoStyle.igoStyleObject&&(I=(g,U)=>this.styleService.createStyle(c.igoStyle.igoStyleObject,g,U)),c.igoStyle.styleByAttribute){const g=this.styleService;c.style=(U,M)=>g.createStyleByAttribute(U,c.igoStyle.styleByAttribute,M),b=new k.qR(c,this.messageService,this.authInterceptor)}const D=Object.assign({},c,{style:I});return b||(b=new k.qR(D,this.messageService,this.authInterceptor)),this.applyMapboxStyle(b,D),b}applyMapboxStyle(c,I){I.igoStyle?.mapboxStyle&&this.getStuff(I.igoStyle.mapboxStyle.url).subscribe(b=>{if(b.sprite){const G=this.getAbsoluteUrl(I.igoStyle.mapboxStyle.url,b.sprite);this.getStuff(G+".json").subscribe(D=>{(0,P.M7)(c.ol,b,I.igoStyle.mapboxStyle.source,void 0,D,G+".png")})}else(0,P.M7)(c.ol,b,I.igoStyle.mapboxStyle.source)})}getStuff(c){return this.http.get(c).pipe((0,R.k)(I=>I),(0,y.a)(I=>(console.log("No style was found"),(0,f.of)(I))))}getAbsoluteUrl(c,I){return new RegExp("^http|//","i").test(I)?I:"/"===c.substr(c.length-1)?c+I:c+"/"+I}createAsyncIdbLayers(c="*"){return this.layerDBService.getAll().pipe((0,O.m)(I=>{const G=("*"!==c?I.filter(D=>D.detailedContextUri===c):I).map(D=>Object.assign({},D.layerOptions,{sourceOptions:D.sourceOptions}));return(0,h.E)(G.map(D=>this.createAsyncLayer(D)))}))}static \u0275fac=function(I){return new(I||B)(W.CoB(w.KK),W.CoB(F.U),W.CoB(x.O),W.CoB(a.U),W.CoB(e.mi),W.CoB(X),W.CoB(C.kT,8))};static \u0275prov=W.wxM({token:B,factory:B.\u0275fac,providedIn:"root"})}return B})()},56708:(Fe,ce,r)=>{"use strict";r.d(ce,{Iw:()=>P,aG:()=>e.a,t9:()=>h,wL:()=>e.w,Md:()=>R.M,qR:()=>O});var C=r(55792),e=r(68252),d=r(87816),L=r(29632);class P extends C.a{messageService;authInterceptor;watcher;constructor(T,a,F){super(T,a,F),this.messageService=a,this.authInterceptor=F,this.watcher=new L.s(this,this.messageService),this.status$=this.watcher.status$,this.status$.subscribe(A=>{0===A&&(this.olLoadingProblem=!0)})}createOlLayer(){const T=Object.assign({},this.options,{source:this.options.source.ol}),a=new d.c(T);return this.authInterceptor&&a.getSource().setImageLoadFunction((F,A)=>{this.customLoader(F,A,this.authInterceptor,this.messageService)}),a}setMap(T){void 0===T?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(T)}customLoader(T,a,F,A){const k=new XMLHttpRequest,W=F.alterUrlWithKeyAuth(a);let w=a;if(W&&(w=W),k.open("GET",w),!F.interceptXhr(k,w))return k.abort(),void(T.getImage().src=w);k.responseType="arraybuffer",k.onload=function(){const Z=new Uint8Array(this.response);(new TextDecoder).decode(Z).includes("ServiceExceptionReport")&&A.error("igo.geo.dataSource.optionsApiUnavailable","igo.geo.dataSource.unavailableTitle");const X=new Blob([Z],{type:"image/png"}),B=window.URL.createObjectURL(X);T.getImage().src=B},k.send()}}var o=r(24124),f=r(48004);class h extends C.a{messageService;authInterceptor;watcher;constructor(T,a,F){super(T,a),this.messageService=a,this.authInterceptor=F,this.watcher=new f.e(this),this.status$=this.watcher.status$}createOlLayer(){const T=Object.assign({},this.options,{source:this.options.source.ol}),a=new o.c(T);return a.getSource().setTileLoadFunction((A,k)=>{this.customLoader(A,k,this.authInterceptor)}),a}customLoader(T,a,F){const A=F.alterUrlWithKeyAuth(a);let k=a;A&&(k=A),T.getImage().src=k}setMap(T){void 0===T?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(T)}}var R=r(2892),y=r(28184);class O extends C.a{messageService;authInterceptor;watcher;constructor(T,a,F){super(T,a,F),this.messageService=a,this.authInterceptor=F,this.watcher=new f.e(this),this.status$=this.watcher.status$}createOlLayer(){const T=Object.assign({},this.options,{source:this.options.source.ol}),a=new y.c(T);return a.getSource().setTileLoadFunction((A,k)=>{const W=this.customLoader(k,A.getFormat(),this.authInterceptor,A.onLoad.bind(A));W&&A.setLoader(W)}),a}customLoader(T,a,F,A,k){return(W,w,te)=>{const Z=new XMLHttpRequest;let K=T;if("function"!=typeof T){const X=F.alterUrlWithKeyAuth(T);X&&(K=X)}else K=T(W,w,te);Z.open("GET",K),F&&F.interceptXhr(Z,K),"arraybuffer"===a.getType()&&(Z.responseType="arraybuffer"),Z.onload=X=>{if(!Z.status||Z.status>=200&&Z.status<300){const V=a.getType();let B;"json"===V||"text"===V?B=Z.responseText:"xml"===V?(B=Z.responseXML,B||(B=(new DOMParser).parseFromString(Z.responseText,"application/xml"))):"arraybuffer"===V&&(B=Z.response),B?A.call(this,a.readFeatures(B,{extent:W,featureProjection:te}),a.readProjection(B)):k.call(this)}else k.call(this)},Z.onerror=()=>{k.call(this)},Z.send()}}setMap(T){void 0===T?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(T)}}},68252:(Fe,ce,r)=>{"use strict";r.d(ce,{a:()=>C,w:()=>e});var C=function(d){return d.OPACITY="opacity",d.VISIBLE="visible",d.OGCFILTERS="ogcFilters",d.MINRESOLUTION="minResolution",d.MAXRESOLUTION="maxResolution",d.ZINDEX="zIndex",d.TIMEFILTER="timeFilter",d}(C||{}),e=function(d){return d.TITLE="title",d.ABSTRACT="abstract",d.CUSTOM="custom",d}(e||{})},55792:(Fe,ce,r)=>{"use strict";r.d(ce,{a:()=>P});var C=r(54844),e=r(35876),d=r(40604),L=r(59324);class P{options;messageService;authInterceptor;geoDBService;layerDBService;collapsed;dataSource;legend;legendCollapsed=!0;firstLoadComponent=!0;map;ol;olLoadingProblem=!1;status$;hasBeenVisible$=new C.g(void 0);hasBeenVisible$$;resolution$$;get isIgoInternalLayer(){return this.options.isIgoInternalLayer||!1}get id(){return this.options.id||this.dataSource.id}get alias(){return this.options.alias}get title(){return this.options.title}set title(f){this.options.title=f}get zIndex(){return this.ol.getZIndex()}set zIndex(f){this.ol.setZIndex(f)}get baseLayer(){return this.options.baseLayer}set baseLayer(f){this.options.baseLayer=f}get opacity(){return this.ol.get("opacity")}set opacity(f){this.ol.setOpacity(f)}set isInResolutionsRange(f){this.isInResolutionsRange$.next(f)}get isInResolutionsRange(){return this.isInResolutionsRange$.value}isInResolutionsRange$=new C.g(!1);set maxResolution(f){this.ol.setMaxResolution(0===f?0:f||1/0),this.updateInResolutionsRange()}get maxResolution(){return this.ol.getMaxResolution()}set minResolution(f){this.ol.setMinResolution(f||0),this.updateInResolutionsRange()}get minResolution(){return this.ol.getMinResolution()}set visible(f){this.ol.setVisible(f),this.visible$.next(f),!this.hasBeenVisible$.value&&f&&this.hasBeenVisible$.next(f),this.options?.messages&&f&&this.options?.messages.filter(h=>h.options?.showOnEachLayerVisibility).map(h=>this.showMessage(h))}get visible(){return this.visible$.value}visible$=new C.g(void 0);get displayed(){return this.visible&&this.isInResolutionsRange}displayed$=(0,e.E)([this.isInResolutionsRange$,this.visible$]).pipe((0,d.k)(f=>f[0]&&f[1]));get showInLayerList(){return!1!==this.options.showInLayerList}constructor(f,h,R,y,O){this.options=f,this.messageService=h,this.authInterceptor=R,this.geoDBService=y,this.layerDBService=O,this.dataSource=f.source,this.ol=this.createOlLayer(),void 0!==f.zIndex&&(this.zIndex=f.zIndex),f.baseLayer&&void 0===f.visible&&(f.visible=!1),this.maxResolution=f.maxResolution||(0,L.bg)(Number(f.maxScaleDenom)),this.minResolution=f.minResolution||(0,L.bg)(Number(f.minScaleDenom)),this.visible=void 0===f.visible||f.visible,this.opacity=void 0===f.opacity?1:f.opacity,f.legendOptions&&(f.legendOptions.url||f.legendOptions.html)&&(this.legend=this.dataSource.setLegend(f.legendOptions)),this.legendCollapsed=!f.legendOptions||!f.legendOptions.collapsed||f.legendOptions.collapsed,this.ol.set("_layer",this,!0)}setMap(f){this.map=f,this.unobserveResolution(),void 0!==f&&(this.observeResolution(),this.hasBeenVisible$$=this.hasBeenVisible$.subscribe(()=>{this.options.messages&&this.visible&&this.options.messages.map(h=>{this.showMessage(h)})}))}showMessage(f){this.messageService&&(f.title=f.title,f.text=f.text,this.messageService.message(f))}observeResolution(){this.resolution$$=this.map.viewController.resolution$.subscribe(()=>this.updateInResolutionsRange())}unobserveResolution(){void 0!==this.resolution$$&&(this.resolution$$.unsubscribe(),this.resolution$$=void 0)}updateInResolutionsRange(){if(void 0!==this.map){const f=this.map.viewController.getResolution();this.isInResolutionsRange=f>=this.minResolution&&f<=(void 0===this.maxResolution?1/0:this.maxResolution)}else this.isInResolutionsRange=!1}}},2892:(Fe,ce,r)=>{"use strict";r.d(ce,{M:()=>B});var C=r(43168),e=r(83552),d=r(82736),L=r(44876),P=r(12396),o=r(53156),f=r(61252),h=r(54760),R=r(2500),y=r(93244),O=r(3360),x=r(1296),T=r(24112),a=r(2924),F=r(10211),A=r(83680),k=r(51672),W=r(67732),w=r(38084),te=r(85308),Z=r(96659),X=r(84052),V=r(55792);class B extends V.a{messageService;authInterceptor;geoNetworkService;geoDBService;layerDBService;previousLoadExtent;previousLoadResolution;previousOgcFilters;xhrAccumulator=[];watcher;trackFeatureListenerId;get browsable(){return!1!==this.options.browsable}get exportable(){return!1!==this.options.exportable}constructor(c,I,b,G,D,g){super(c,I,b,D,g),this.messageService=I,this.authInterceptor=b,this.geoNetworkService=G,this.geoDBService=D,this.layerDBService=g,this.watcher=new X.w(this),this.status$=this.watcher.status$}createOlLayer(){const c=this.options.opacity||1,I=!1!==this.options.visible,b=this.options.minResolution||(0,te.bg)(Number(this.options.minScaleDenom)),G=this.options.maxResolution||(0,te.bg)(Number(this.options.maxScaleDenom)),D=this.options.sourceOptions;this.dataSource instanceof W.E&&(D?.preload?.bypassResolution||D?.preload?.bypassVisible)&&(this.options.opacity=0,D.preload.bypassResolution&&(this.options.minResolution||this.options.maxResolution)&&(this.options.minResolution=0,this.options.maxResolution=1/0),D.preload.bypassVisible&&!I&&(this.options.visible=!0));const g=Object.assign({},this.options,{source:this.options.source.ol,sourceOptions:this.options.sourceOptions||this.options.source.options});this.options.animation&&this.dataSource.ol.on("addfeature",function(s){this.flash(s.feature)}.bind(this)),this.options.idbInfo?.storeToIdb&&this.geoDBService&&(this.options.idbInfo.firstLoad&&this.maintainFeaturesInIdb(),this.dataSource.ol.once("featuresloadend",()=>{this.dataSource.ol.on("addfeature",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("changefeature",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("clear",()=>this.maintainFeaturesInIdb()),this.dataSource.ol.on("removefeature",()=>this.maintainFeaturesInIdb())})),this.dataSource instanceof W.E&&(D?.preload?.bypassResolution||D?.preload?.bypassVisible)&&this.dataSource.ol.once("featuresloadend",()=>{c&&(this.opacity=c),D.preload.bypassResolution&&(this.minResolution=b,this.maxResolution=G),D.preload.bypassVisible&&(this.visible=I)}),this.options.trackFeature&&this.enableTrackFeature(this.options.trackFeature);const U=new o.c(g),M=U.getSource(),H=M.getUrl();if("function"==typeof H)return U;if(H||"wfs"===g.sourceOptions?.type){let s;const ie=g.sourceOptions;s="wfs"===ie?.type&&(ie.params||ie.paramsWFS)?(de,fe,Se,ae,le)=>{this.customWFSLoader(M,ie,this.authInterceptor,de,fe,Se,ae,le)}:(de,fe,Se,ae,le)=>{this.customLoader(M,H,this.authInterceptor,de,fe,Se,ae,le)},s&&M.setLoader(s)}else if(this.options.idbInfo?.storeToIdb&&this.geoDBService){const s=(ie,de,fe,Se,ae)=>{this.customIDBLoader(M,g.id,ie,fe,Se,ae)};s&&M.setLoader(s)}return this.options.idbInfo?.storeToIdb&&this.geoDBService&&U.once("sourceready",()=>{this.options.idbInfo.firstLoad&&this.maintainOptionsInIdb(),(0,y.w)(U,"change").pipe((0,T.o)(750)).subscribe(()=>this.maintainOptionsInIdb()),U.on("change:zIndex",()=>this.maintainOptionsInIdb())}),U}removeLayerFromIDB(){this.geoDBService&&this.layerDBService&&(0,O.E)(this.geoDBService.deleteByKey(this.id),this.layerDBService.deleteByKey(this.id)).subscribe()}maintainOptionsInIdb(){this.options.igoStyle.igoStyleObject=function K(z){const c=z.getStyle();return"function"==typeof c||c instanceof Array?void 0:{fill:{color:c.getFill().getColor()},stroke:{color:c.getStroke().getColor(),width:2},circle:{fill:{color:c.getImage().getFill().getColor()},stroke:{color:c.getImage().getStroke().getColor(),width:2},radius:5}}}(this.ol);const c=C.Yv.removeUndefined({layerId:this.id,detailedContextUri:this.options.idbInfo.contextUri,sourceOptions:{id:this.id,type:"vector",queryable:!0},layerOptions:{workspace:this.options.workspace,zIndex:this.ol?this.zIndex:1e6,id:this.id,isIgoInternalLayer:this.isIgoInternalLayer,title:this.title,igoStyle:this.options.igoStyle,idbInfo:Object.assign({},this.options.idbInfo,{firstLoad:!1})},insertEvent:`${this.title}-${this.id}-${new Date}`});this.layerDBService.update(c)}maintainFeaturesInIdb(){const c=this.dataSource.ol.getFeatures(),I=JSON.parse((new P.c).writeFeatures(c,{dataProjection:"EPSG:4326",featureProjection:this.dataSource.ol.getProjection()||"EPSG:3857"}));this.geoDBService.update(this.id,this.id,I,Z.G.User,`${this.title}-${this.id}-${new Date}`)}flash(c){const I=(new Date).getTime(),b=this.ol.on("postrender",function G(D){const g=(0,R.wX)(D),U=D.frameState,M=c.getGeometry().clone(),H=U.time-I,s=H/this.options.animation.duration,ie=(0,L.Q7)(1-s),de=(0,d.f4)(this.options.animation.color||"red");de[3]=ie;let fe=this.ol.getStyleFunction().call(this,c).find(ae=>ae.getImage());fe||(fe=this.ol.getStyleFunction().call(this,c)[0]);const Se=fe.clone();switch(c.getGeometry().getType()){case"Point":if(null!==Se.getImage()&&"function"==typeof Se.getImage().getRadius){const ae=(0,L.Q7)(s)*(3*Se.getImage().getRadius());Se.getImage().setRadius(ae),Se.getImage().setOpacity(ie)}break;case"LineString":Se.getImage()&&(Se.getImage().getStroke().setColor(de),Se.getImage().getStroke().setWidth((0,L.Q7)(s)*(3*Se.getImage().getStroke().getWidth()))),Se.getStroke()&&(Se.getStroke().setColor(de),Se.getStroke().setWidth((0,L.Q7)(s)*(3*Se.getStroke().getWidth())));break;case"Polygon":Se.getImage()&&Se.getImage().getFill().setColor(de),Se.getFill()&&Se.getFill().setColor(de)}if(Se.setText(""),g.setStyle(Se),g.drawGeometry(M),H>this.options.animation.duration)return(0,e.S)(b),void this.map.ol.render();this.map.ol.render()}.bind(this))}setMap(c){void 0===c?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.setMap(c)}setExtent(c){this.options.extent=c}onUnwatch(){this.dataSource.onUnwatch(),this.stopAnimation()}stopAnimation(){this.dataSource.ol.un("addfeature",function(c){this.visible&&this.flash(c.feature)}.bind(this))}enableTrackFeature(c){this.trackFeatureListenerId=this.dataSource.ol.on("addfeature",this.trackFeature.bind(this,c))}centerMapOnFeature(c){const I=this.dataSource.ol.getFeatureById(c);I&&this.map.ol.getView().setCenter(I.getGeometry().getCoordinates())}trackFeature(c,I){I.feature.getId()===c&&this.visible&&this.centerMapOnFeature(c)}disableTrackFeature(c){(0,e.S)(this.trackFeatureListenerId)}customWFSLoader(c,I,b,G,D,g,U,M,H){{const s=I.paramsWFS,ie=s.srsName?new h.c({code:s.srsName}):g,de=f.W0(G,g,ie),fe=I.ogcFilters;if(this.previousLoadExtent&&this.previousLoadExtent!==de||this.previousLoadResolution&&this.previousLoadResolution!==D||this.previousOgcFilters&&this.previousOgcFilters!==fe){c.removeLoadedExtent(this.previousLoadExtent);for(let le of this.xhrAccumulator)le.abort()}this.previousLoadExtent=de,this.previousLoadResolution=D,this.previousOgcFilters=fe,s.srsName=s.srsName||g.getCode();const Se=(0,w.yK)(I,de,ie,fe,H);let ae=0;if("2.0.0"===s.version&&s.maxFeatures>w.G4)for(;ae<s.maxFeatures;){let oe=Se.replace("count="+s.maxFeatures,"count=1000");oe=oe.replace("startIndex=0","0"),oe+="&startIndex="+ae,oe.replace(/&&/g,"&"),this.getFeatures(c,b,de,ie,g,oe,U,M),ae+=1e3}else this.getFeatures(c,b,de,ie,g,Se,U,M)}}getFeatures(c,I,b,G,D,g,U,M){const H=new XMLHttpRequest,s=I.alterUrlWithKeyAuth(g);let ie=g;s&&(ie=s),H.open("GET",ie),I&&I.interceptXhr(H,ie);const de=()=>{c.removeLoadedExtent(b),M()};H.onerror=de,H.onload=()=>{if(200===H.status&&H.responseText.length>0){const fe=c.getFormat().readFeatures(H.responseText,{dataProjection:G,featureProjection:D});fe?(c.addFeatures(fe),U(fe)):U([])}else de()},this.xhrAccumulator.push(H),H.send()}customLoader(c,I,b,G,D,g,U,M){const H=new XMLHttpRequest;let s=I;if("function"!=typeof I){const ie=b.alterUrlWithKeyAuth(I);ie&&(s=ie)}if(this.geoNetworkService&&"function"!=typeof I){let fe=c.getFormat().getType();const Se=()=>{c.removeLoadedExtent(G),M()},ae={responseType:fe};this.geoNetworkService.geoDBService.get(I).pipe((0,a.o)(750)).pipe((0,F.m)(le=>le?(0,x.of)(le):this.geoNetworkService.get(s,ae).pipe((0,A.K)(),(0,k.a)(oe=>{throw Se(),oe})))).subscribe(le=>{if(le){const oe=c.getFormat(),se=oe.getType();let me;if("json"===se||"text"===se?me=le:"xml"===se?(me=le,me||(me=(new DOMParser).parseFromString(le,"application/xml"))):"arraybuffer"===se&&(me=le),me){const be=oe.readFeatures(me,{extent:G,featureProjection:g});c.addFeatures(be),U(be)}else Se()}})}else{H.open("GET",s);const ie=c.getFormat();"arraybuffer"===ie.getType()&&(H.responseType="arraybuffer"),b&&b.interceptXhr(H,s);const de=()=>{c.removeLoadedExtent(G),M()};H.onerror=de,H.onload=()=>{if(!H.status||H.status>=200&&H.status<300){const fe=ie.getType();let Se;if("json"===fe||"text"===fe?Se=H.responseText:"xml"===fe?(Se=H.responseXML,Se||(Se=(new DOMParser).parseFromString(H.responseText,"application/xml"))):"arraybuffer"===fe&&(Se=H.response),Se){const ae=ie.readFeatures(Se,{extent:G,featureProjection:g});c.addFeatures(ae),U(ae)}else de()}else de()},H.send()}}customIDBLoader(c,I,b,G,D,g){if(this.geoNetworkService){const U=()=>{c.removeLoadedExtent(b),g()};this.geoNetworkService.geoDBService.get(I).subscribe(M=>{if(M){const H=c.getFormat(),s=H.getType();let ie;if("json"===s||"text"===s?ie=M:"xml"===s?(ie=M,ie||(ie=(new DOMParser).parseFromString(M,"application/xml"))):"arraybuffer"===s&&(ie=M),ie){const de=H.readFeatures(ie,{extent:b,featureProjection:G});c.addFeatures(de,H.readProjection(ie)),D(de)}else U()}})}}}},29632:(Fe,ce,r)=>{"use strict";r.d(ce,{s:()=>e});var C=r(43168);class e extends C.WO{id;loaded=0;loading=0;source;messageService;constructor(L,P){super(),this.source=L.options.source.ol,this.id=(0,C.uq)(),this.messageService=P}watch(){this.source.on("imageloadstart",L=>this.handleLoadStart(L)),this.source.on("imageloadend",L=>this.handleLoadEnd(L)),this.source.on("imageloaderror",L=>this.handleLoadEnd(L)),this.source.on("imageloaderror",L=>this.handleLoadError(L))}unwatch(){this.source.un("imageloadstart",L=>this.handleLoadStart(L)),this.source.un("imageloadend",L=>this.handleLoadEnd(L)),this.source.un("imageloaderror",L=>this.handleLoadEnd(L)),this.source.un("imageloaderror",L=>this.handleLoadError(L))}handleLoadStart(L){L.image.__watchers__||(L.image.__watchers__=[]),L.image.__watchers__.push(this.id),this.loading+=1,this.status=C.qM.Working}handleLoadEnd(L){if(!L.image.__watchers__)return;const P=L.image.__watchers__.indexOf(this.id);if(P<0)return;L.image.__watchers__.splice(P,1),this.loaded+=1;const o=this.loading;this.loaded>=o&&o===this.loading&&(this.status=C.qM.Done,this.loaded=this.loading=0)}handleLoadError(L){L.image.__watchers__&&(this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:L.target.params_.LAYERS}),this.loaded=-1,this.loading=0,this.status=C.qM.Error)}}},48004:(Fe,ce,r)=>{"use strict";r.d(ce,{e:()=>e});var C=r(43168);class e extends C.WO{id;loaded=0;loading=0;source;constructor(L){super(),this.source=L.options.source.ol,this.id=(0,C.uq)()}watch(){this.source.on("tileloadstart",L=>this.handleLoadStart(L)),this.source.on("tileloadend",L=>this.handleLoadEnd(L)),this.source.on("tileloaderror",L=>this.handleLoadEnd(L))}unwatch(){this.source.un("tileloadstart",L=>this.handleLoadStart(L)),this.source.un("tileloadend",L=>this.handleLoadEnd(L)),this.source.un("tileloaderror",L=>this.handleLoadEnd(L))}handleLoadStart(L){L.tile.__watchers__||(L.tile.__watchers__=[]),L.tile.__watchers__.push(this.id),this.loading+=1,this.status=C.qM.Working}handleLoadEnd(L){if(!L.tile.__watchers__)return;const P=L.tile.__watchers__.indexOf(this.id);if(P<0)return;L.tile.__watchers__.splice(P,1),this.loaded+=1;const o=this.loading;this.loaded>=o&&o===this.loading&&(this.status=C.qM.Done,this.loaded=this.loading=0)}}},84052:(Fe,ce,r)=>{"use strict";r.d(ce,{w:()=>d});var C=r(43168),e=r(93176);class d extends C.WO{id;loaded=0;loading=0;layer;constructor(P){super(),this.layer=P,this.id=(0,C.uq)()}watch(){let P=this.layer.options.source.ol;this.layer.dataSource instanceof e.a&&(P=this.layer.options.source.options.source),P.getUrl()&&(P.on("featuresloadstart",o=>this.handleLoadStart(o)),P.on("featuresloadend",o=>this.handleLoadEnd(o)),P.on("featuresloaderror",o=>this.handleLoadEnd(o)))}unwatch(){let P=this.layer.options.source.ol;this.layer.dataSource instanceof e.a&&(P=this.layer.options.source.options.source),P.getUrl()&&(P.un("featuresloadstart",o=>this.handleLoadStart(o)),P.un("featuresloadend",o=>this.handleLoadEnd(o)),P.un("featuresloaderror",o=>this.handleLoadEnd(o)))}handleLoadStart(P){this.loading+=1,this.status=C.qM.Working}handleLoadEnd(P){this.loaded+=1;const o=this.loading;this.loaded>=o&&o===this.loading&&(this.status=C.qM.Done,this.loaded=this.loading=0)}}},48920:(Fe,ce,r)=>{"use strict";r.d(ce,{Q:()=>W});var C=r(65056),e=r(34672),d=r(32328),L=r(27e3),P=r(24708),o=r(9588),h=(r(89500),r(53291));function R(){return(0,h.gV)("baseLayerSwitcherState",[(0,h.K2)("collapseIcon",(0,h.wb)({height:"40px",width:"40px",overflow:"hidden"})),(0,h.K2)("collapseMap",(0,h.wb)({height:"80px",overflow:"hidden"})),(0,h.K2)("expand",(0,h.wb)({overflow:"hidden"})),(0,h.aK)("collapse => expand",(0,h.Cs)("200ms")),(0,h.aK)("expand => collapse",(0,h.Cs)("200ms"))])}var y=r(60192),O=r(34896),x=r(72584);function T(w,te){1&w&&(O.I0R(0,"div",6)(1,"button",7),O.wVc(2,"translate"),O.I0R(3,"mat-icon"),O.OEk(4,"photo_library"),O.C$Y()()()),2&w&&(O.yG2(),O.E7m("matTooltip",O.kDX(2,1,"igo.geo.mapButtons.baselayerSwitcher")))}function a(w,te){if(1&w&&(O.wR5(0,"igo-mini-basemap",8),O.wVc(1,"translate")),2&w){const Z=te.$implicit,K=te.index,X=O.GaO(2);O.E7m("map",X.map)("baseLayer",Z)("title",X.baseLayers.length>2&&!X.expand?O.kDX(1,5,"igo.geo.baselayersSwitcher.title"):Z.title)("display",X.expand||0===K&&!X.useStaticIcon)("disabled",!X.expand&&X.baseLayers.length>1)}}function F(w,te){1&w&&(O.I0R(0,"div",9)(1,"mat-icon",10),O.OEk(2,"arrow_drop_down"),O.C$Y()())}const A=w=>({"container-expand":w});function k(w,te){if(1&w){const Z=O.KQA();O.I0R(0,"div",1),O.qCj("@baseLayerSwitcherState.start",function(){O.usT(Z);const X=O.GaO();return O.CGJ(X.showButton=!1)})("@baseLayerSwitcherState.done",function(){O.usT(Z);const X=O.GaO();return O.CGJ(X.showButton=!0)})("click",function(){O.usT(Z);const X=O.GaO();return O.CGJ(X.collapseOrExpand())}),O.yuY(1,T,5,3,"div",2),O.I0R(2,"div",3),O.yuY(3,a,2,7,"igo-mini-basemap",4),O.C$Y(),O.yuY(4,F,3,0,"div",5),O.C$Y()}if(2&w){const Z=O.GaO();O.E7m("ngClass",O.S45(5,A,Z.expand))("@baseLayerSwitcherState",Z.expand?"expand":Z.useStaticIcon?"collapseIcon":"collapseMap"),O.yG2(),O.E7m("ngIf",Z.useStaticIcon&&!Z.expand&&Z.showButton),O.yG2(2),O.E7m("ngForOf",Z.baseLayers),O.yG2(),O.E7m("ngIf",Z.hasMoreThanTwo)}}let W=(()=>{class w{mediaService;map;useStaticIcon;_baseLayers=[];expand=!1;showButton=!0;layers$$;get hasMoreThanTwo(){return this.baseLayers.length>1}constructor(Z){this.mediaService=Z,this.mediaService.media$.value===o.oZ.Mobile&&void 0===this.useStaticIcon&&(this.useStaticIcon=!0)}ngAfterViewInit(){this.layers$$=this.map.layers$.subscribe(Z=>{this._baseLayers=Z.filter(K=>K.baseLayer)})}ngOnDestroy(){this.layers$$.unsubscribe()}collapseOrExpand(){this.expand=!(!this.hasMoreThanTwo&&!this.useStaticIcon||this.expand)}get baseLayers(){const Z=this.map.viewController.getResolution(),K=this.map.viewController.getZoom(),X=this._baseLayers.filter(B=>(!B.options.maxResolution||Z<=B.options.maxResolution)&&(!B.options.minResolution||Z>=B.options.minResolution)&&(!B.options.source.options.maxZoom||K<=B.options.source.options.maxZoom)&&(!B.options.source.options.minZoom||K>=B.options.source.options.minZoom)),V=X.filter(B=>!B.visible);return V.length+1===X.length?V:X}static \u0275fac=function(K){return new(K||w)(O.GI1(o.QB))};static \u0275cmp=O.In1({type:w,selectors:[["igo-baselayers-switcher"]],inputs:{map:"map",useStaticIcon:"useStaticIcon"},standalone:!0,features:[O.UHJ],decls:1,vars:1,consts:[["class","igo-baselayers-switcher-container",3,"ngClass","click",4,"ngIf"],[1,"igo-baselayers-switcher-container",3,"ngClass","click"],["class","igo-baselayers-switcher-button-container",4,"ngIf"],[1,"basemap-list"],[3,"map","baseLayer","title","display","disabled",4,"ngFor","ngForOf"],["class","more-baselayers",4,"ngIf"],[1,"igo-baselayers-switcher-button-container"],["mat-icon-button","","matTooltipPosition","right","color","primary",3,"matTooltip"],[3,"map","baseLayer","title","display","disabled"],[1,"more-baselayers"],["color","primary",1,"material-icons","mat-icon"]],template:function(K,X){1&K&&O.yuY(0,k,5,7,"div",0),2&K&&O.E7m("ngIf",X.baseLayers.length>0)},dependencies:[C.u_,C.QF,e.oJ,e.um,L.KO,L.a4,d.oB,d.qL,C.Iw,y._,P._s,x.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}.basemap-list[_ngcontent-%COMP%]   igo-mini-basemap[_ngcontent-%COMP%]{display:block}.basemap-list[_ngcontent-%COMP%]   igo-mini-basemap[_ngcontent-%COMP%]:not(:first-child){margin-top:4px}.igo-baselayers-switcher-container[_ngcontent-%COMP%]{height:auto;position:relative}.container-expand[_ngcontent-%COMP%]{overflow:hidden;border-width:0}.more-baselayers[_ngcontent-%COMP%]{width:80px;height:20px;background-color:#fff;text-align:center;cursor:pointer}.more-baselayers[_ngcontent-%COMP%]:hover{background-color:#efefef}.igo-baselayers-switcher-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}.igo-baselayers-switcher-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"],data:{animation:[R()]}})}return w})()},60192:(Fe,ce,r)=>{"use strict";r.d(ce,{_:()=>R});var C=r(65056),d=(r(99228),r(7036)),L=r(9364),P=r(89500),o=r(34896);function f(y,O){if(1&y&&(o.I0R(0,"div",5),o.OEk(1),o.C$Y()),2&y){const x=o.GaO(2);o.yG2(),o.cNF(x.title)}}function h(y,O){if(1&y){const x=o.KQA();o.I0R(0,"div",2),o.qCj("click",function(){o.usT(x);const a=o.GaO();return o.CGJ(a.changeBaseLayer(a.baseLayer))}),o.wR5(1,"igo-map-browser",3),o.yuY(2,f,2,1,"div",4),o.C$Y()}if(2&y){const x=o.GaO();o.yG2(),o.E7m("map",x.basemap),o.yG2(),o.E7m("ngIf",x.title)}}let R=(()=>{class y{layerService;appRef;map;disabled;title;get display(){return this._display}set display(x){this._display=x,this.basemap.ol.getView().changed()}_display;get baseLayer(){return this._baseLayer}set baseLayer(x){this._baseLayer=x,this.handleBaseLayerChanged(x)}_baseLayer;basemap=new P.y({controls:{},interactions:!1});constructor(x,T){this.layerService=x,this.appRef=T}ngAfterViewInit(){this.handleMainMapViewChange(this.map.ol.getView()),this.map.viewController.olView.on("change",x=>{this.handleMainMapViewChange(x.target)}),this.map.ol.on("pointerdrag",x=>{this.handleMainMapViewChange(x.target.getView())})}ngOnDestroy(){this.map.viewController.olView.un("change",x=>{this.handleMainMapViewChange(x.target)}),this.map.ol.un("pointerdrag",x=>{this.handleMainMapViewChange(x.target.getView())})}changeBaseLayer(x){this.disabled||(this.map.changeBaseLayer(x),this.appRef.tick())}handleMainMapViewChange(x){const T=x.getProperties();this.basemap.viewController.olView.setResolution(T.resolution),this.basemap.viewController.olView.setRotation(T.rotation),this.basemap.viewController.olView.setCenter(this.map.viewController.getCenter())}handleBaseLayerChanged(x){this.basemap.removeAllLayers();const T=Object.assign(Object.create(x.options),x.options,{visible:!0,baseLayer:!1}),a=this.layerService.createLayer(T);this.basemap.addLayer(a),this.handleLinkedBaseLayer(a)}handleLinkedBaseLayer(x){const T=x.options.linkedLayers;if(!T)return;const a=T.links;a&&a.map(A=>{A.linkedIds.map(k=>{const W=this.map.layers.find(w=>w.options.linkedLayers?.linkId===k);if(W){const w=Object.assign(Object.create(W.options),W.options,{zIndex:9e3,visible:W.options.linkedLayers?.showInMiniBaseMap??!0,baseLayer:!1});this.basemap.addLayer(this.layerService.createLayer(w))}})})}static \u0275fac=function(T){return new(T||y)(o.GI1(d.I),o.GI1(o.Swk))};static \u0275cmp=o.In1({type:y,selectors:[["igo-mini-basemap"]],inputs:{map:"map",disabled:"disabled",title:"title",display:"display",baseLayer:"baseLayer"},standalone:!0,features:[o.UHJ],decls:2,vars:1,consts:[[1,"igo-mini-basemap-container"],[3,"click",4,"ngIf"],[3,"click"],[3,"map"],["class","igo-mini-basemap-title",4,"ngIf"],[1,"igo-mini-basemap-title"]],template:function(T,a){1&T&&(o.I0R(0,"div",0),o.yuY(1,h,3,2,"div",1),o.C$Y()),2&T&&(o.yG2(),o.E7m("ngIf",a.display))},dependencies:[C.u_,L.q],styles:[".igo-mini-basemap-container[_ngcontent-%COMP%]{width:80px;height:80px;background-color:#ffffff03;border:2px solid white;box-shadow:0 1px 4px #0000004d;cursor:pointer}.igo-mini-basemap-container[_ngcontent-%COMP%]:hover   .igo-mini-basemap-title[_ngcontent-%COMP%]{color:#000;text-shadow:0 0 5px white}.igo-mini-basemap-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}.igo-mini-basemap-title[_ngcontent-%COMP%]{position:relative;top:-76px;height:76px;width:76px;text-align:center;vertical-align:bottom;color:#fff;text-shadow:0 0 5px black;white-space:normal;display:flex;align-items:flex-end;justify-content:center}"],changeDetection:0})}return y})()},42860:(Fe,ce,r)=>{"use strict";r.d(ce,{c:()=>x});var C=r(65056),e=r(34672),d=r(32328),L=r(27e3),P=r(9204),o=r(24708),f=r(54844),R=(r(89500),r(34896)),y=r(72584);function O(T,a){if(1&T){const F=R.KQA();R.I0R(0,"div",1)(1,"button",2),R.qCj("click",function(){R.usT(F);const k=R.GaO();return R.CGJ(k.onGeolocationClick())}),R.wVc(2,"translate"),R.wVc(3,"translate"),R.I0R(4,"mat-icon"),R.OEk(5),R.wVc(6,"async"),R.C$Y()()()}if(2&T){const F=R.GaO();R.yG2(),R.E7m("matTooltip",F.map.geolocationController.tracking?R.kDX(2,3,"igo.geo.mapButtons.geolocateInactive"):R.kDX(3,5,"igo.geo.mapButtons.geolocate"))("color",F.color),R.yG2(4),R.cNF(R.kDX(6,7,F.icon$))}}let x=(()=>{class T{configService;tracking$$;icon$=new f.g("my_location");get map(){return this._map}set map(F){this._map=F}_map;get color(){return this._color}set color(F){this._color=F}_color;constructor(F){this.configService=F}ngAfterContentInit(){this.map.ol.once("rendercomplete",()=>{this.tracking$$=this.map.geolocationController.tracking$.subscribe(F=>{F||this.configService.getConfig("geolocate.basic")?this.icon$.next("my_location"):this.icon$.next("location_searching")})})}ngOnDestroy(){this.tracking$$&&this.tracking$$.unsubscribe()}onGeolocationClick(){this.map.geolocationController.tracking=!this.map.geolocationController.tracking}static \u0275fac=function(A){return new(A||T)(R.GI1(P.aW))};static \u0275cmp=R.In1({type:T,selectors:[["igo-geolocate-button"]],inputs:{map:"map",color:"color"},standalone:!0,features:[R.UHJ],decls:1,vars:1,consts:[["class","igo-geolocate-button-container",4,"ngIf"],[1,"igo-geolocate-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","click"]],template:function(A,k){1&A&&R.yuY(0,O,7,9,"div",0),2&A&&R.E7m("ngIf",k.map.geolocationController)},dependencies:[C.u_,e.oJ,e.um,L.KO,L.a4,d.oB,d.qL,C.a,o._s,y.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-geolocate-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-geolocate-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return T})()},34419:(Fe,ce,r)=>{"use strict";r.d(ce,{e:()=>y});var C=r(34672),e=r(32328),d=r(27e3),L=r(9204),P=r(24708),o=r(61252),h=(r(89500),r(34896)),R=r(72584);let y=(()=>{class O{configService;map;color;extentOverride;centerOverride;zoomOverride;homeExtentButtonExtent;homeExtentButtonCenter;homeExtentButtonZoom;constructor(T){this.configService=T,this.computeHomeExtent()}computeHomeExtent(){const T=this.configService.getConfig("homeExtentButton");this.homeExtentButtonExtent=this.extentOverride||T?.homeExtButtonExtent,this.homeExtentButtonCenter=this.centerOverride||T?.homeExtButtonCenter,this.homeExtentButtonZoom=this.zoomOverride||T?.homeExtButtonZoom,this.centerOverride&&this.zoomOverride&&(this.homeExtentButtonExtent=void 0)}onToggleClick(){if(this.computeHomeExtent(),this.homeExtentButtonExtent)this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);else if(this.homeExtentButtonCenter&&this.homeExtentButtonZoom){const T=o.QH(this.homeExtentButtonCenter,this.map.viewController.olView.getProjection().getCode());this.map.viewController.olView.setCenter(T),this.map.viewController.zoomTo(this.homeExtentButtonZoom)}}static \u0275fac=function(a){return new(a||O)(h.GI1(L.aW))};static \u0275cmp=h.In1({type:O,selectors:[["igo-home-extent-button"]],inputs:{map:"map",color:"color",extentOverride:"extentOverride",centerOverride:"centerOverride",zoomOverride:"zoomOverride"},standalone:!0,features:[h.UHJ],decls:5,vars:4,consts:[[1,"igo-home-extent-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","click"]],template:function(a,F){1&a&&(h.I0R(0,"div",0)(1,"button",1),h.qCj("click",function(){return F.onToggleClick()}),h.wVc(2,"translate"),h.I0R(3,"mat-icon"),h.OEk(4,"home"),h.C$Y()()()),2&a&&(h.yG2(),h.E7m("matTooltip",h.kDX(2,2,"igo.geo.mapButtons.home-extent"))("color",F.color))},dependencies:[C.oJ,C.um,d.KO,d.a4,e.oB,e.qL,P._s,R.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-home-extent-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-home-extent-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return O})()},34080:(Fe,ce,r)=>{"use strict";r.d(ce,{cd:()=>d.c,eq:()=>L.e,yG:()=>O.yG,Y1:()=>P.Y,q2:()=>o.q,u0:()=>O.u0,kn:()=>O.kn,qM:()=>O.qM,i6:()=>y.i,w1:()=>T.w,qc:()=>a.q,KG:()=>O.KG,rE:()=>O.rE,uE:()=>O.uE,Sc:()=>O.Sc,ET:()=>O.ET,KM:()=>O.KM}),r(48920),r(60192);var d=r(42860),L=r(34419),P=r(94440),o=r(9364),y=(r(55452),r(78416),r(65972),r(76332)),O=r(85308),T=(r(72124),r(50208)),a=r(75872)},94440:(Fe,ce,r)=>{"use strict";r.d(ce,{Y:()=>L});var C=r(65056),e=r(34896);function d(P,o){if(1&P&&(e.I0R(0,"div",1)(1,"pre"),e.OEk(2),e.C$Y()()),2&P){const f=e.GaO();e.yG2(2),e.cNF(f.infoContent)}}let L=(()=>{class P{infoContent="";constructor(){}static \u0275fac=function(h){return new(h||P)};static \u0275cmp=e.In1({type:P,selectors:[["igo-info-section"]],inputs:{infoContent:"infoContent"},standalone:!0,features:[e.UHJ],decls:1,vars:1,consts:[["class","infoSection",4,"ngIf"],[1,"infoSection"]],template:function(h,R){1&h&&e.yuY(0,d,3,1,"div",0),2&h&&e.E7m("ngIf",R.infoContent&&R.infoContent.length)},dependencies:[C.u_],styles:[".infoSection[_ngcontent-%COMP%]{border-radius:10px;background-color:#6e6e6e66;padding:2.5px;position:absolute;text-align:center;top:5px;left:50%;text-shadow:0 0 5px white,0 0 10px white,0 0 15px white}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.infoSection[_ngcontent-%COMP%]{top:50px;left:10%}}"]})}return P})()},9364:(Fe,ce,r)=>{"use strict";r.d(ce,{q:()=>o});var C=r(23302),e=r(43168),L=(r(89500),r(34896));const P=["*"];let o=(()=>{class f{activityService;activityId;status$$;map;get view(){return this._view}set view(R){this._view=R,void 0!==this.map&&this.map.updateView(R)}_view;get controls(){return this._controls}set controls(R){this._controls=R,void 0!==this.map&&this.map.updateControls(R)}_controls;id=`igo-map-target-${(0,e.uq)()}`;constructor(R){this.activityService=R}ngOnInit(){this.status$$=this.map.status$.subscribe(R=>this.handleStatusChange(R))}ngAfterViewInit(){this.map.setTarget(this.id)}ngOnDestroy(){this.map.setTarget(void 0),this.activityService.unregister(this.activityId),this.status$$.unsubscribe()}handleStatusChange(R){R===e.qM.Working&&void 0===this.activityId?this.activityId=this.activityService.register():R===e.qM.Done&&void 0!==this.activityId&&(this.activityService.unregister(this.activityId),this.activityId=void 0)}static \u0275fac=function(y){return new(y||f)(L.GI1(C.U9))};static \u0275cmp=L.In1({type:f,selectors:[["igo-map-browser"]],inputs:{map:"map",view:"view"},standalone:!0,features:[L.UHJ],ngContentSelectors:P,decls:2,vars:1,consts:[[1,"igo-map-browser-target",3,"id"]],template:function(y,O){1&y&&(L.kPM(),L.wR5(0,"div",0),L._Xx(1)),2&y&&L.E7m("id",O.id)},styles:["[_nghost-%COMP%]{position:relative;display:block}[_nghost-%COMP%], .igo-map-browser-target[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]     .ol-attribution{flex-flow:row;left:50px;bottom:5px;text-align:left;padding:0;margin-right:90px;background-color:#fff0;width:calc(100% - 100px)}[_nghost-%COMP%]     .ol-attribution.ol-logo-only{height:inherit}[_nghost-%COMP%]     .ol-attribution.ol-collapsed{background:none}[_nghost-%COMP%]     .ol-attribution.ol-collapsed button{transform:none}[_nghost-%COMP%]     .ol-attribution button{transform:rotate(180deg);background-color:#fff;cursor:pointer;outline:none}[_nghost-%COMP%]     .ol-scale-line-inner{color:#000;border-color:#000;text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px;box-shadow:0 1px 0 1px #fff9}[_nghost-%COMP%]     .ol-scale-line{background-color:#fff0;bottom:4px;transform:translate(-50%);left:50%}[_nghost-%COMP%]     .ol-scale-bar{background-color:#fff0;bottom:4px;transform:translate(-50%);left:50%}[_nghost-%COMP%]     .ol-scale-text{text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px}[_nghost-%COMP%]     .ol-scale-step-text{text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px}[_nghost-%COMP%]     canvas{display:block}"]})}return f})()},55452:(Fe,ce,r)=>{"use strict";r.d(ce,{O:()=>d}),r(89500);var e=r(34896);let d=(()=>{class L{map;displayCenter$$;constructor(){}ngAfterViewInit(){this.map&&(this.displayCenter$$=this.map.mapCenter$.subscribe(o=>{document.getElementById("mapCenter").style.visibility=o?"visible":"hidden"})),this.letZoom()}ngOnDestroy(){this.displayCenter$$&&this.displayCenter$$.unsubscribe()}letZoom(){document.getElementById("mapCenter").addEventListener("wheel",o=>{o.deltaY>0?this.map.viewController.zoomOut():this.map.viewController.zoomIn()},!0)}static \u0275fac=function(f){return new(f||L)};static \u0275cmp=e.In1({type:L,selectors:[["igo-map-center"]],inputs:{map:"map"},standalone:!0,features:[e.UHJ],decls:3,vars:0,consts:[["id","mapCenter",1,"mapCenter"],[1,"vertical"],[1,"horizontal"]],template:function(f,h){1&f&&(e.I0R(0,"div",0),e.wR5(1,"div",1)(2,"div",2),e.C$Y())},styles:[".mapCenter[_ngcontent-%COMP%]{width:30px;height:30px;position:absolute;top:50%;left:50%;transform:translate(-15px,-15px);pointer-events:none}.mapCenter[_ngcontent-%COMP%]   .vertical[_ngcontent-%COMP%], .mapCenter[_ngcontent-%COMP%]   .horizontal[_ngcontent-%COMP%]{width:4px;height:30px;position:absolute;left:13px;background-color:#000}.mapCenter[_ngcontent-%COMP%]   .horizontal[_ngcontent-%COMP%]{transform:rotate(90deg)}"]})}return L})()},78416:(Fe,ce,r)=>{"use strict";r.d(ce,{a:()=>R});var C=r(65056),e=r(34896),d=r(34672),L=r(32328),P=r(27e3),o=r(9204),f=r(24708),h=r(72584);let R=(()=>{class y{configService;get sidenavOpened(){return this._sidenavOpenend}set sidenavOpened(x){this._sidenavOpenend=x,this.getClassMenuButton()}_sidenavOpenend;openSidenav=new e._w7;useThemeColor;menuButtonClass;constructor(x){this.configService=x;const T=this.configService.getConfig("menu.button.useThemeColor");this.useThemeColor=void 0!==T&&T}getClassMenuButton(){this.menuButtonClass={"menu-button-white-background":!this.useThemeColor}}onToggleSidenavClick(){this.openSidenav.emit()}static \u0275fac=function(T){return new(T||y)(e.GI1(o.aW))};static \u0275cmp=e.In1({type:y,selectors:[["igo-menu-button"]],inputs:{sidenavOpened:"sidenavOpened"},outputs:{openSidenav:"openSidenav"},standalone:!0,features:[e.UHJ],decls:4,vars:4,consts:[["mat-icon-button","","id","menu-button","tooltip-position","below","matTooltipShowDelay","500",3,"ngClass","matTooltip","click"]],template:function(T,a){1&T&&(e.I0R(0,"button",0),e.qCj("click",function(){return a.onToggleSidenavClick()}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"menu"),e.C$Y()()),2&T&&e.E7m("ngClass",a.menuButtonClass)("matTooltip",e.kDX(1,2,a.sidenavOpened?"menu.close":"menu.open"))},dependencies:[d.oJ,d.um,C.QF,P.KO,P.a4,L.oB,L.qL,f._s,h.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}"]})}return y})()},65972:(Fe,ce,r)=>{"use strict";r.d(ce,{I:()=>y});var C=r(65056),e=r(34672),d=r(32328),L=r(27e3),P=r(24708),f=(r(89500),r(34896)),h=r(72584);const R=O=>[O];let y=(()=>{class O{btnStyle="onlineStyle";map;color;enabled=!1;constructor(){}ngOnInit(){this.map.forcedOffline$.next(this.enabled)}onClick(){this.enabled=!this.enabled,this.handleButtonStyle(),this.map.forcedOffline$.next(this.enabled)}handleButtonStyle(){this.btnStyle=this.enabled?"offlineStyle":"onlineStyle"}static \u0275fac=function(a){return new(a||O)};static \u0275cmp=f.In1({type:O,selectors:[["igo-offline-button"]],inputs:{map:"map",color:"color",enabled:"enabled"},standalone:!0,features:[f.UHJ],decls:6,vars:9,consts:[[1,"igo-user-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","ngClass","color","click"]],template:function(a,F){1&a&&(f.I0R(0,"div",0)(1,"button",1),f.qCj("click",function(){return F.onClick()}),f.wVc(2,"translate"),f.wVc(3,"translate"),f.I0R(4,"mat-icon"),f.OEk(5,"wifi_off"),f.C$Y()()()),2&a&&(f.yG2(),f.E7m("matTooltip",F.enabled?f.kDX(2,3,"igo.geo.mapButtons.online"):f.kDX(3,5,"igo.geo.mapButtons.offline"))("ngClass",f.S45(7,R,F.btnStyle))("color",F.enabled?F.color:null))},dependencies:[e.oJ,e.um,L.KO,L.a4,C.QF,d.oB,d.qL,P._s,h.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .onlineStyle[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .onlineStyle[_ngcontent-%COMP%]:hover{background-color:#efefef}[_nghost-%COMP%]   .offlineStyle[_ngcontent-%COMP%]{width:40px;background-color:#b9b9b9}"]})}return O})()},76332:(Fe,ce,r)=>{"use strict";r.d(ce,{i:()=>T});var C=r(65056),e=r(34672),d=r(32328),L=r(27e3),P=r(24708),o=r(72855),f=r(54844),R=(r(89500),r(34896)),y=r(72584);const O=(a,F)=>({azimuth:a,rotation:F});function x(a,F){if(1&a){const A=R.KQA();R.I0R(0,"div",1),R.wVc(1,"async"),R.wVc(2,"translate"),R.wVc(3,"translate"),R.I0R(4,"button",2),R.qCj("click",function(){R.usT(A);const W=R.GaO();return R.CGJ(W.map.viewController.resetRotation())}),R.wVc(5,"async"),R.I0R(6,"mat-icon",3),R.wVc(7,"async"),R.OEk(8,"navigation "),R.C$Y()()()}if(2&a){const A=R.GaO();R.E7m("matTooltip",R.kDX(1,4,A.rotated$)?R.g7$(2,6,"igo.geo.mapButtons.resetRotation",R.IBC(15,O,A.azimuthRounded,A.rotationRounded)):R.kDX(3,9,"igo.geo.mapButtons.tipRotation")),R.yG2(4),R.E7m("color",A.color)("disabled",!1===R.kDX(5,11,A.rotated$)),R.yG2(2),R.E7m("ngStyle",R.kDX(7,13,A.currentStyle$))}}let T=(()=>{class a{rotated$=new f.g(!1);azimuthRounded=0;rotationRounded=0;currentStyle$=new f.g({transform:"rotate(0rad)"});map;showIfNoRotation;color;constructor(){}ngAfterContentInit(){this.map.viewController.rotation$.subscribe(A=>{const k=A||0,W=180*k/Math.PI;this.rotationRounded=Math.round(W),this.azimuthRounded=Math.round((0,o.g9)(-1*W)),this.currentStyle$.next({transform:"rotate("+k+"rad)"}),this.rotated$.next(0!==k)})}static \u0275fac=function(k){return new(k||a)};static \u0275cmp=R.In1({type:a,selectors:[["igo-rotation-button"]],inputs:{map:"map",showIfNoRotation:"showIfNoRotation",color:"color"},standalone:!0,features:[R.UHJ],decls:2,vars:3,consts:[["class","igo-rotation-button-container","matTooltipPosition","left",3,"matTooltip",4,"ngIf"],["matTooltipPosition","left",1,"igo-rotation-button-container",3,"matTooltip"],["mat-icon-button","","matTooltipPosition","left",3,"color","disabled","click"],[3,"ngStyle"]],template:function(k,W){1&k&&(R.yuY(0,x,9,18,"div",0),R.wVc(1,"async")),2&k&&R.E7m("ngIf",R.kDX(1,1,W.rotated$)&&!W.showIfNoRotation||W.showIfNoRotation)},dependencies:[C.u_,L.KO,L.a4,e.oJ,e.um,d.oB,d.qL,C.Qt,C.a,P._s,y.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-rotation-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-rotation-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return a})()},86908:(Fe,ce,r)=>{"use strict";r.d(ce,{G:()=>e});var C=r(83552);class e{olMap;observerKeys=[];getOlMap(){return this.olMap}setOlMap(L){if(void 0!==L&&void 0!==this.getOlMap())throw new Error("This controller is already bound to a map.");if(void 0===L)return this.teardownObservers(),void(this.olMap=L);this.olMap=L}teardownObservers(){this.observerKeys.forEach(L=>(0,C.S)(L)),this.observerKeys=[]}}},89019:(Fe,ce,r)=>{"use strict";r.d(ce,{I:()=>C});var C=function(e){return e.Position="position",e.PositionDirection="positionDirection",e.Accuracy="accuracy",e.Buffer="buffer",e}(C||{})},42364:(Fe,ce,r)=>{"use strict";r.d(ce,{E:()=>K});var C=r(58264),e=r(2296),d=r(80848),L=r(28668),P=r(36752),o=r(61252),f=r(49412),h=r(54776),R=r(87544),y=r(88872),O=r(45212),x=r(62632),T=r(71888),a=r(54844),F=r(51712),A=r(19432),k=r(68392),W=r(14672),w=r(36404),te=r(86908),Z=r(89019);class K extends te.G{map;options;storageService;configService;arrowRotation;subscriptions$$=[];geolocationOverlay;positionFeatureStyle=new h.cp({image:new R.c({radius:6,fill:new y.c({color:"#3399CC"}),stroke:new O.c({color:"#fff",width:2})})});accuracyFeatureStyle=new h.cp({stroke:new O.c({color:"rgba(120, 120, 120, 0.4)",width:1}),fill:new y.c({color:"rgba(120, 120, 120, 0.4)"})});get bufferStyle(){return new h.cp({stroke:new O.c({width:2,color:this.buffer.bufferStroke}),fill:new y.c({color:this.buffer.bufferFill}),text:new x.c({textAlign:"left",offsetX:10,offsetY:-10,font:"12px Calibri,sans-serif",text:this.buffer.showBufferRadius?`${this.buffer.bufferRadius}m`:"",fill:new y.c({color:"#000"}),stroke:new O.c({color:"#fff",width:3})})})}get arrowStyle(){return new h.cp({image:new T.c({radius:5.5,fill:new y.c({color:"rgba(0, 132, 202)"}),stroke:new O.c({color:"#fff",width:1.5}),points:3,displacement:[0,9],rotation:this.arrowRotation,rotateWithView:!0})})}geolocation;emissionIntervalSeconds$=new a.g(5);position$=new a.g(void 0);tracking$=new a.g(void 0);followPosition$=new a.g(void 0);lastPosition;set buffer(V){this._buffer=V,this.handleFeatureCreation(this.position$.value)}get buffer(){return this._buffer}_buffer;set accuracyThreshold(V){this._accuracyThreshold=V,this.handleFeatureCreation(this.position$.value)}get accuracyThreshold(){return this._accuracyThreshold}_accuracyThreshold;get olGeolocation(){return this.geolocation}get tracking(){return this.geolocation.getTracking()}set tracking(V){this.geolocation.setTracking(V||!1),this.tracking$.next(V),this.storageService&&void 0!==V&&this.storageService.set("geolocation.tracking",V),V||this.position$.next(void 0)}set followPosition(V){this._followPosition=V,this.followPosition$.next(V),!1===this.configService?.getConfig("geolocate.followPosition")&&(this._followPosition=!1,this.followPosition$.next(!1)),this.handleFeatureCreation(this.position$.value),this.storageService&&void 0!==V&&this.storageService.set("geolocation.followPosition",V)}get followPosition(){return this._followPosition}_followPosition;constructor(V,B,z,c){super(),this.map=V,this.options=B,this.storageService=z,this.configService=c,this.geolocationOverlay=new w.m(this.map),this._followPosition=!(!this.options||!this.options.followPosition)&&this.options.followPosition,this._buffer=this.options&&this.options.buffer?this.options.buffer:void 0,this._accuracyThreshold=this.options&&this.options.accuracyThreshold?this.options.accuracyThreshold:5e3}setOlMap(V){super.setOlMap(V),this.setupObservers()}deleteGeolocationFeatures(){this.deleteFeatureByType(Z.I.Position),this.deleteFeatureByType(Z.I.PositionDirection),this.deleteFeatureByType(Z.I.Accuracy),this.deleteFeatureByType(Z.I.Buffer)}setupObservers(){this.tracking$.subscribe(B=>{B?this.onPositionChange(!0,!0):this.deleteGeolocationFeatures()}),this.geolocation=new e.c({trackingOptions:{enableHighAccuracy:!0,maximumAge:1e4,timeout:6e5},projection:this.options.projection});let V=!1;this.subscriptions$$.push(this.emissionIntervalSeconds$.pipe((0,A.G)(B=>(0,F.I)(1e3*B))).subscribe(()=>{V===this.tracking?this.onPositionChange(!0):(V=this.tracking,this.onPositionChange(!0,!0))})),this.geolocation.on("change",B=>{this.onPositionChange(!1,!1)})}updateArrowFeatureOrientation(V){const B=o.AF(V.position,V.projection,"EPSG:4326");if(!this.lastPosition)return void(this.lastPosition={coordinates:B,dateTime:new Date});const z=this.getFeatureByType(Z.I.PositionDirection),c=V?.speed>1.25&&this.distanceBetweenPoints(this.lastPosition.coordinates,B)>.003;if(V.accuracy<=this.accuracyThreshold&&c){var G=Math.atan2(B[0]-this.lastPosition.coordinates[0],B[1]-this.lastPosition.coordinates[1]);G<0&&(G=2*Math.PI+G),this.arrowRotation=G,z&&z.setStyle(this.arrowStyle),this.lastPosition={coordinates:B,dateTime:new Date}}else z&&(new Date).getTime()-this.lastPosition.dateTime.getTime()>3e3&&(0,W.gV)(z)}distanceBetweenPoints(V,B){return f.c$(V,B)/1e3}addOnChangedListener(V){let B=()=>{V(this.geolocation)};return this.geolocation.on("change",B),B}deleteChangedListener(V){this.geolocation.un("change",V)}updateGeolocationOptions(V){if(!V)return;let B=V.geolocate,z=V.alwaysTracking;if(this.storageService){const c=this.storageService.get("geolocation.tracking");null!=c&&(B=c);const I=this.storageService.get("geolocation.followPosition");null!=I&&(z=I)}this.tracking=B,this.followPosition=z,this.buffer=V.buffer}teardownObservers(){this.subscriptions$$.length&&this.subscriptions$$.map(V=>V.unsubscribe()),super.teardownObservers()}onPositionChange(V=!1,B=!1){if(!this.tracking)return;const z=this.geolocation.getProperties();if(z.accuracy>this.accuracyThreshold)return console.warn("Poor geolocation accuracy. No position are stored/shown"),void this.position$.next(void 0);const c={position:z.position,projection:this.geolocation.getProjection().getCode(),accuracy:z.accuracy,altitude:z.altitude,altitudeAccuracy:z.altitudeAccuracy,heading:z.heading,speed:z.speed,enableHighAccuracy:!!z.trackingOptions?.enableHighAccuracy,timestamp:new Date};this.handleFeatureCreation(c),this.handleViewFromFeatures(c,B),V&&this.position$.next(c)}getFeatureByType(V){return this.geolocationOverlay.dataSource.ol.getFeatureById(V)}deleteFeatureByType(V){const B=this.geolocationOverlay?.dataSource.ol.getFeatureById(V);B&&this.geolocationOverlay.dataSource.ol.removeFeature(B)}handleFeatureCreation(V){if(!V||!V.position)return;const B=new d.c(V.position),z=(0,P.IH)(new L.c(V.position,V.accuracy||0));let c=this.getFeatureByType(Z.I.Position),I=this.getFeatureByType(Z.I.PositionDirection),b=this.getFeatureByType(Z.I.Accuracy);const G=!!c,D=!!I,g=!!b;if(D||(I=new C.c({geometry:B}),I.setId(Z.I.PositionDirection),(0,W.gV)(I)),G||(c=new C.c({geometry:B}),c.setId(Z.I.Position),c.setStyle(this.positionFeatureStyle)),g||(b=new C.c({geometry:z}),b.setId(Z.I.Accuracy),b.setStyle(this.accuracyFeatureStyle)),B&&(G?c.setGeometry(B):this.geolocationOverlay.addOlFeature(c,k.S.None),D?I.setGeometry(B):this.geolocationOverlay.addOlFeature(I,k.S.None),this.updateArrowFeatureOrientation(V),g?b.setGeometry(z):this.geolocationOverlay.addOlFeature(b,k.S.None),this.buffer)){let U=this.getFeatureByType(Z.I.Buffer);const M=!!U,H=new L.c(V.position,this.buffer.bufferRadius);M||(U=new C.c(H),U.setId(Z.I.Buffer),U.setStyle(this.positionFeatureStyle)),U.setStyle(this.bufferStyle),M?U.setGeometry(H):this.geolocationOverlay.addOlFeature(U,k.S.None)}}handleViewFromFeatures(V,B=!1){const G=[this.getFeatureByType(Z.I.Position),this.getFeatureByType(Z.I.PositionDirection),this.getFeatureByType(Z.I.Accuracy),this.getFeatureByType(Z.I.Buffer)].filter(D=>D);if(G.length>0){const D=(0,W.q1)(G,this.map.viewProjection),g=V?.speed>12.5?[.25,.25,.25,.25]:[.15,.1,.1,.1],U=(0,W.Ki)(this.map.getExtent(),D,g);let M=this.followPosition&&U?k.S.Move:k.S.None;B&&(M=k.S.Zoom),M!==k.S.None&&(0,W.QX)(this.map.viewController,G,M)}}}},87272:(Fe,ce,r)=>{"use strict";r.d(ce,{c:()=>R});var C=r(44876),e=r(61252),d=r(54844),L=r(61616),P=r(24112),o=r(93836),f=r(59324),h=r(86908);class R extends h.G{options;rotation$=new d.g(0);resolution$=new d.g(void 0);state$=new d.g(void 0);padding=[0,0,0,0];maxZoomOnExtent=19;maxLayerZoomExtent;extent$=new L.E;extent$$;states=[];stateIndex=0;get stateHistory(){return!!this.options&&!0===this.options.stateHistory}get olView(){return this.olMap.getView()}constructor(O){super(),this.options=O}setPadding(O){(O.top||0===O.top)&&(this.padding[0]=O.top),(O.right||0===O.right)&&(this.padding[1]=O.right),(O.bottom||0===O.bottom)&&(this.padding[2]=O.bottom),(O.left||0===O.left)&&(this.padding[3]=O.left)}setOlMap(O){super.setOlMap(O),this.setupObservers()}setupObservers(){!0===this.stateHistory&&this.observerKeys.push(this.olMap.on("moveend",O=>this.onMoveEnd(O))),this.extent$$=this.extent$.pipe((0,P.o)(25)).subscribe(O=>{this.setExtent(O.extent,O.action)})}monitorRotation(){this.observerKeys.push(this.olMap.getView().on("change:rotation",O=>{this.rotation$.next(O.target.getRotation())})),this.rotation$.next(this.getRotation())}teardownObservers(){super.teardownObservers(),void 0!==this.extent$$&&(this.extent$$.unsubscribe(),this.extent$$=void 0)}getOlProjection(){return this.olView.getProjection()}getCenter(O){let x=this.olView.getCenter();return O&&x&&(x=e.AF(x,this.getOlProjection(),O)),x}getExtent(O){let x=this.olView.calculateExtent(this.olMap.getSize());return O&&x&&(x=e.W0(x,this.getOlProjection(),O)),x}getScale(O=96){return(0,f.iC)(this.getResolution(),this.getOlProjection().getUnits(),O)}getResolution(){return this.olView.getResolution()}getZoom(){return Math.round(this.olView.getZoom())}zoomIn(){this.zoomTo(this.olView.getZoom()+1)}zoomOut(){this.zoomTo(this.olView.getZoom()-1)}zoomTo(O){this.olView.cancelAnimations(),this.olView.animate({zoom:O,duration:250,easing:C.Q7})}moveToExtent(O){this.extent$.next({extent:O,action:o.a.Move})}zoomToExtent(O){this.extent$.next({extent:O,action:o.a.Zoom})}getRotation(){return this.olView.getRotation()}resetRotation(){this.olView.animate({rotation:0})}hasPreviousState(){return this.states.length>1&&this.stateIndex>0}hasNextState(){return this.states.length>1&&this.stateIndex<this.states.length-1}previousState(){this.hasPreviousState()&&this.setStateIndex(this.stateIndex-1)}nextState(){this.hasNextState()&&this.setStateIndex(this.stateIndex+1)}clearStateHistory(){this.states=[],this.stateIndex=0}setInitialState(){this.states.length>0&&this.setStateIndex(0)}setExtent(O,x,T=!0){const a=this.olView;a.cancelAnimations();const F=T?500:0,A=a.getZoom(),k=a.getCenter(),W=[O[0]+(O[2]-O[0])/2,O[1]+(O[3]-O[1])/2],w=Math.sqrt(Math.pow(k[0]-W[0],2)+Math.pow(k[1]-W[1],2)),te=a.calculateExtent(),Z=Math.sqrt(Math.pow(te[2]-te[0],2)+Math.pow(te[3]-te[1],2)),V=w/((Math.sqrt(Math.pow(O[2]-O[0],2)+Math.pow(O[3]-O[1],2))+Z)/2),B=x===o.a.Move||A>this.maxZoomOnExtent?A:this.maxZoomOnExtent;a.fit(O,{size:this.olMap.getSize(),maxZoom:B,padding:this.padding,duration:V>4?0:F,callback:z=>{z||a.fit(O,{size:this.olMap.getSize(),maxZoom:B,padding:this.padding,duration:V>4?0:F})}})}setStateIndex(O){this.stateIndex=O,this.setState(this.states[O])}setState(O){this.olView.animate({resolution:O.resolution,center:O.center,duration:0})}onMoveEnd(O){const x=this.getResolution();this.resolution$.value!==x&&this.resolution$.next(x);const T={resolution:x,center:this.getCenter(),zoom:this.getZoom()};if(!0===this.stateHistory){const a=this.stateIndex;(0,f.Ko)(T,0===this.states.length?void 0:this.states[a])||(this.states=this.states.slice(0,a+1).concat([T]),this.stateIndex=this.states.length-1)}this.state$.next(T)}}},87159:(Fe,ce,r)=>{"use strict";r.d(ce,{C:()=>X});var C=r(53e3),e=r(9588),d=r(43168),L=r(58264),P=r(83552),o=r(80848),f=r(36752),h=r(62808),R=r(53156),y=r(28184),O=r(24328),x=r(19076),T=r(83680),a=r(67732),F=r(70524),A=r(68392),k=r(40240),W=r(56708),w=r(9364),te=r(59800),Z=r(82048),K=r(34896);let X=(()=>{class V{component;mediaService;styleService;store;pointerHoverFeatureStore=new C.qc([]);lastTimeoutRequest;store$$;layers$$;selectionLayer;selectionMVT={};mvtStyleOptions;pointerMoveListener;singleClickMapListener;hoverFeatureId="hoverFeatureId";igoHoverFeatureDelay=1e3;igoHoverFeatureEnabled=!1;mouseout(){clearTimeout(this.lastTimeoutRequest),this.clearLayer()}get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(z,c,I){this.component=z,this.mediaService=c,this.styleService=I}ngOnInit(){this.map.status$.pipe((0,T.K)(z=>z===d.qM.Done)).subscribe(()=>{this.store=new k.y([],{map:this.map}),this.initStore(),this.listenToMapPointerMove(),this.subscribeToPointerStore(),this.listenToMapClick()}),this.layers$$=this.map.layers$.subscribe(z=>{this.store&&!z.find(c=>"hoverFeatureId"===c.id)&&this.initStore()})}initStore(){const z=this.store,c=new W.Md({isIgoInternalLayer:!0,id:"hoverFeatureId",title:"hoverFeature",zIndex:900,source:new a.E,showInLayerList:!1,exportable:!1,browsable:!1,style:te._o});(0,F.m)(z,c),this.selectionLayer=new y.c({map:this.map.ol,zIndex:901,renderMode:"vector",declutter:!0,source:new x.c({projection:this.map.projection}),style:(I,b)=>{if(this.mvtStyleOptions&&I.getId()in this.selectionMVT)return this.createHoverStyle(I,this.mvtStyleOptions,b)}})}createHoverStyle(z,c,I){const b={...c};let G=c.label?c.label.attribute:void 0,D=!!c.label?.style;if(z.get("_isLabel")){const g=b.data?b.data.length:0,U=[],M=[],H=[],s=[];for(let ie=0;ie<g;ie++)U.push(0),M.push("rgba(255, 255, 255, 0)"),H.push(0),s.push("rgba(255, 255, 255, 0)");b.radius=U,b.stroke=M,b.width=H,b.fill=s}else b.label=void 0,D=!1,G=void 0;return!D&&G&&(b.label.style={textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:{color:"#000"},backgroundFill:{color:"rgba(255, 255, 255, 0.5)"},backgroundStroke:{color:"rgba(200, 200, 200, 0.75)",width:2},stroke:{color:"#fff",width:3},overflow:!0,offsetX:10,offsetY:20,padding:[2.5,2.5,2.5,2.5]}),this.styleService.createStyleByAttribute(z,b,I)}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unlistenToMapSingleClick(),this.layers$$.unsubscribe()}subscribeToPointerStore(){this.store$$=this.pointerHoverFeatureStore.entities$.subscribe(z=>{this.addFeatureOverlay(z)})}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",z=>this.onMapEvent(z))}listenToMapClick(){this.singleClickMapListener=this.map.ol.on("singleclick",z=>this.onMapSingleClickEvent(z))}unsubscribeToPointerStore(){this.store$$.unsubscribe()}unlistenToMapPointerMove(){(0,P.S)(this.pointerMoveListener),this.pointerMoveListener=void 0}unlistenToMapSingleClick(){(0,P.S)(this.singleClickMapListener),this.singleClickMapListener=void 0}onMapSingleClickEvent(z){this.clearLayer()}onMapEvent(z){if(z.dragging||!this.igoHoverFeatureEnabled||this.mediaService.isTouchScreen())return void this.clearLayer();typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);let I,c=-1/0;const b=this.map.ol.getPixelFromCoordinate(z.coordinate);this.lastTimeoutRequest=setTimeout(()=>{if(this.map.ol.forEachFeatureAtPixel(b,(G,D)=>{if(!D)return;const g=this.map.getLayerByOlUId(D.ol_uid);this.canProcessHover(g)&&(g.zIndex<=c||(c=g.zIndex,I=D))},{hitTolerance:10,layerFilter:G=>G instanceof R.c||G instanceof y.c}),!I)return this.clearLayer(),void this.pointerHoverFeatureStore.clear();this.map.ol.forEachFeatureAtPixel(b,(G,D)=>{if(void 0===G.get("hoverSummary")&&G.getProperties()!==this.pointerHoverFeatureStore.all()[0]?.getProperties()){let g;if(this.clearLayer(),D instanceof R.c){const U=this.map.getLayerByOlUId(D.ol_uid);if(!this.canProcessHover(U))return;let M=this.handleRenderFeature(G);this.setLayerStyleFromOptions(U,M);const H=[M];M.set("_isLabel",!1);const s=new L.c;s.setProperties(M.getProperties());const ie="Point"===M.getGeometry().getType()?M.getGeometry():new o.c(z.coordinate);return s.setGeometry(ie),s.setId(M.getId()),s.set("_isLabel",!0),this.setLayerStyleFromOptions(U,s),H.push(s),this.pointerHoverFeatureStore.load(H),g=U,!0}if(D instanceof y.c){const U=this.map.getLayerByOlUId(D.ol_uid);if(!this.canProcessHover(U))return;U?.options?.igoStyle?.styleByAttribute?.hoverStyle?this.mvtStyleOptions=U.options.igoStyle.styleByAttribute.hoverStyle:U?.options?.igoStyle?.hoverStyle&&(this.mvtStyleOptions=U.options.igoStyle.hoverStyle),this.selectionLayer.setSource(D.getSource()),D.getFeatures(z.pixel).then(M=>{if(!M.length)return this.selectionMVT={},this.selectionLayer.changed(),void this.clearLayer();const H=M[0];if(!H)return void this.clearLayer();let s=this.handleRenderFeature(H);s.set("_isLabel",!1);const ie=new L.c;ie.setProperties(s.getProperties());const de="Point"===s.getGeometry().getType()?s.getGeometry():new o.c(z.coordinate);ie.setGeometry(de),ie.setId(s.getId()),ie.set("_isLabel",!0),this.setLayerStyleFromOptions(U,ie),this.pointerHoverFeatureStore.load([ie]),this.selectionMVT[H.getId()]=s,this.selectionLayer.changed()}),g=U}}},{hitTolerance:10,layerFilter:G=>G===I})},this.igoHoverFeatureDelay)}canProcessHover(z){return!(!z||!z.visible||!z.options||!z.options.igoStyle?.styleByAttribute&&!z.options.igoStyle?.hoverStyle||z.options.igoStyle?.styleByAttribute&&!z.options.igoStyle?.styleByAttribute.hoverStyle&&!z.options.igoStyle?.hoverStyle)}handleRenderFeature(z){let c;return z instanceof O.cp?(c=new L.c({geometry:this.getGeometry(z)}),c.setId(z.getId())):z instanceof L.c&&(c=z),c.setProperties(z.getProperties()),c}addFeatureOverlay(z){if(z.length>0){const c=z[0];this.clearLayer();const I=new L.c({geometry:c.getGeometry(),meta:{id:this.hoverFeatureId},hoverSummary:this.getHoverSummary(c.getProperties())});this.store.setLayerOlFeatures([I],A.S.None)}}setLayerStyleFromOptions(z,c){const I=this.store.layer.map.viewController.getResolution();z?.options?.igoStyle?.styleByAttribute?.hoverStyle?this.store.layer.ol.setStyle(this.createHoverStyle(c,z.options.igoStyle.styleByAttribute.hoverStyle,I)):z?.options?.igoStyle?.hoverStyle&&this.store.layer.ol.setStyle(this.createHoverStyle(c,z.options.igoStyle.hoverStyle,I))}getHoverSummary(z){let c="";for(const[I,b]of Object.entries(z))!I.startsWith("_")&&"geometry"!==I&&(c+=`${I}: ${b}\n`);return c.length>=2?c.slice(0,-2):c}getGeometry(z){let c;if(z.getOrientedFlatCoordinates){const I=z.getOrientedFlatCoordinates(),b=[];switch(I.forEach((G,D)=>{D%2==0&&b.push([parseFloat(I[D]),parseFloat(I[D+1])])}),z.getType()){case"Point":c=new o.c(b);break;case"Polygon":c=new f.cp([b]);break;case"LineString":c=new h.c([b])}}else c=z.getGeometry();return c}clearLayer(){this.selectionMVT={},this.selectionLayer&&this.selectionLayer.changed(),this.store&&this.store.clearLayer()}static \u0275fac=function(c){return new(c||V)(K.GI1(w.q,2),K.GI1(e.QB),K.GI1(Z.U))};static \u0275dir=K.Sc5({type:V,selectors:[["","igoHoverFeature",""]],hostBindings:function(c,I){1&c&&K.qCj("mouseout",function(){return I.mouseout()})},inputs:{igoHoverFeatureDelay:"igoHoverFeatureDelay",igoHoverFeatureEnabled:"igoHoverFeatureEnabled"},standalone:!0})}return V})()},85308:(Fe,ce,r)=>{"use strict";r.d(ce,{C3:()=>f.C,yG:()=>C.y,U1:()=>P.U,u0:()=>d.u,kn:()=>o.k,qM:()=>h.q,KG:()=>x.KG,rE:()=>L.rE,bg:()=>L.bg,uE:()=>L.uE,Sc:()=>L.Sc,ET:()=>x.ET,KM:()=>x.KM});var C=r(89500),d=(r(93836),r(12268)),L=r(59324),P=r(55760),o=r(50056),f=r(87159),h=r(16660),x=(r(42364),r(89019),r(87272),r(7700));r(19724)},19724:(Fe,ce,r)=>{"use strict";r.d(ce,{GK:()=>k,S8:()=>W,UR:()=>R,aY:()=>T,m:()=>x,yP:()=>A});var C=r(56096),e=r(21808),d=r(40912),L=r(56708);function P(w){return w.options.linkedLayers}function o(w,te){return w.layers.find(Z=>Z.options.linkedLayers?.linkId===te)}function R(w,te,Z){let K=te,X=K,V=!0;for(;V;)K=X,X=y(w,K,Z),V=!!X;return V||function f(w,te){let Z=!1;const K=P(w);return K?.links&&(Z=!!K.links.find(V=>V.properties.includes(te))),Z}(K,Z)||(K=void 0),V?X:K}function y(w,te,Z){if(te?.options.linkedLayers?.linkId){const K=te.options.linkedLayers.linkId;let X=w.layers.filter(V=>{const B=V.options.linkedLayers;if(B&&B.links)return B.links.find(c=>c.linkedIds.includes(K)&&c.properties.includes(Z))});return X.length>1&&console.warn(`Your layer ${te.title||te.id} must only have 1 parent (${X.map(V=>V.title||V.id)})\n            , The first parent (${X[0].title||X[0].id}) will be use to sync properties`),X[0]}}function O(w,te,Z){let K=[];return te?.options.linkedLayers?.links&&te.options.linkedLayers.links.filter(X=>X.properties.includes(Z)).map(X=>{K=K.concat(X.linkedIds)}),K.map(X=>o(w,X))}function x(w,te,Z,K){return O(w,te,K).map(V=>{Z.push(V),O(w,V,K)&&x(w,V,Z,K)}),Z}function T(w,te){let Z=te,K=Z,X=!0;for(;X;)Z=K,K=a(w,Z),X=!!K;return X||function h(w){let te=!1;const Z=P(w);return Z?.links&&(te=!!Z.links.find(X=>X.syncedDelete)),te}(Z)||(Z=void 0),X?K:Z}function a(w,te){if(te.options.linkedLayers?.linkId){const Z=te.options.linkedLayers.linkId;let K=w.layers.filter(X=>{const V=X.options.linkedLayers;if(V&&V.links)return V.links.find(z=>z.linkedIds.includes(Z)&&z.syncedDelete)});return K.length>1&&console.warn(`Your layer ${te.title||te.id} must only have 1 parent (${K.map(X=>X.title||X.id)})\n          , The first parent (${K[0].title||K[0].id}) will be use to sync properties`),K[0]}}function F(w,te){let Z=[];return te?.options.linkedLayers?.links&&te.options.linkedLayers.links.filter(K=>K.syncedDelete).map(K=>{Z=Z.concat(K.linkedIds)}),Z.map(K=>o(w,K))}function A(w,te,Z){return F(w,te).map(X=>{Z.push(X),F(w,X)&&A(w,X,Z)}),Z}function k(w,te){const Z={},K=Object.keys(L.aG);K.map(X=>{Z[L.aG[X]]=[]}),te.filter(X=>P(X)).map(X=>{K.map(V=>{const B=L.aG[V],z=R(w,X,B),I=Z[B].map(b=>b.id);z&&!I.includes(z.id)&&Z[B].push(z)})}),Object.keys(Z).map(X=>{Z[X].map(B=>B.ol.notify(X,void 0))})}function W(w,te,Z){if(!te)return;const K=new d.S;let X=!0,V=!0;const B=te.key;let z;if("ogcFilters"===B?(X=!1,V=!0,z=Z.dataSource.options.ogcFilters):"timeFilter"===B?(X=!1,V=!0,z=Z.dataSource.options.timeFilter):(X=!0,V=!1,z=Z.ol.get(B)),P(Z)){let I=R(w,Z,B);I||(I=Z);const b=[I];x(w,I,b,B);let G=!1;const D=Z.options.source.options.type,g=Z.dataSource.options;b.map(U=>{if(Z&&U&&(0,C.gV)(Z.ol)!==(0,C.gV)(U?.ol)){const M=U.options.source.options.type;if(X)U.ol.set(B,z,!0),"visible"===B&&U.visible$.next(z),("minResolution"===B||"maxResolution"===B)&&(G=!0);else if(V)if("ogcFilters"===B){if(U.dataSource.setOgcFilters(z,!1),"wfs"===M&&U.ol.getSource().refresh(),"wms"===M){let H;"wfs"===D?H=K.handleOgcFiltersAppliedValue(g,Z.dataSource.options.fieldNameGeometry,void 0,w.viewController.getOlProjection()):"wms"===D&&(H=Z.dataSource.ol.getParams().FILTER),U.dataSource.ol.updateParams({FILTER:H})}}else if(U.dataSource instanceof e.C&&"timeFilter"===B){U.dataSource.setTimeFilter(z,!1);const H=Z.ol.getSource().getParams().TIME;U.dataSource.ol.updateParams({TIME:H})}}}),G&&w.viewController.resolution$.next(w.viewController.resolution$.value)}}},50056:(Fe,ce,r)=>{"use strict";r.d(ce,{k:()=>o});var C=r(34896),e=r(9588),d=r(83552),L=r(61252),P=r(9364);let o=(()=>{class f{component;mediaService;lastTimeoutRequest;pointerMoveListener;mapClickListener;pointerPositionDelay=1e3;pointerPositionCoord=new C._w7;get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(R,y){this.component=R,this.mediaService=y}ngOnInit(){this.listenToMapPointerMove(),this.listenToMapClick()}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unlistenToMapClick()}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",R=>this.onPointerEvent(R,this.pointerPositionDelay))}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",R=>this.onPointerEvent(R,0))}unlistenToMapPointerMove(){(0,d.S)(this.pointerMoveListener),this.pointerMoveListener=void 0}unlistenToMapClick(){this.mapClickListener=void 0}onPointerEvent(R,y){if(R.dragging||this.mediaService.isTouchScreen())return;typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);const O=(0,L.AF)(R.coordinate,this.mapProjection,"EPSG:4326");this.lastTimeoutRequest=setTimeout(()=>{this.pointerPositionCoord.emit(O)},y)}static \u0275fac=function(y){return new(y||f)(C.GI1(P.q,2),C.GI1(e.QB))};static \u0275dir=C.Sc5({type:f,selectors:[["","igoPointerPosition",""]],inputs:{pointerPositionDelay:"pointerPositionDelay"},outputs:{pointerPositionCoord:"pointerPositionCoord"},standalone:!0})}return f})()},93836:(Fe,ce,r)=>{"use strict";r.d(ce,{a:()=>C});var C=function(e){return e[e.Move=0]="Move",e[e.Zoom=1]="Zoom",e}(C||{})},12268:(Fe,ce,r)=>{"use strict";r.d(ce,{u:()=>e});var C=r(34896);let e=(()=>{class d{map;constructor(){}getMap(){return this.map}setMap(P){this.map=P}static \u0275fac=function(o){return new(o||d)};static \u0275prov=C.wxM({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})()},89500:(Fe,ce,r)=>{"use strict";r.d(ce,{y:()=>Z});var C=r(28900),e=r(17500),d=r(156),L=r(78960),P=r(77272),o=r(61252),f=r(42124),h=r(56096),R=r(3576),y=r(54844),O=r(91296),x=r(53404),T=r(56708),a=r(36404),F=r(43168),A=r(11484);class k extends F.WO{propertyChange$=new y.g(void 0);loaded=0;loading=0;layers=[];subscriptions=[];constructor(){super()}watch(){}unwatch(){this.layers.forEach(X=>this.unwatchLayer(X),this)}setPropertyChange(X,V){[T.aG.TIMEFILTER,T.aG.OGCFILTERS,T.aG.VISIBLE,T.aG.OPACITY,T.aG.MINRESOLUTION,T.aG.MAXRESOLUTION].includes(X.key)&&this.propertyChange$.next({event:X,layer:V})}watchLayer(X){if(void 0===X.status$)return;X.ol.on("propertychange",B=>this.setPropertyChange(B,X)),X.dataSource.ol.on("propertychange",B=>this.setPropertyChange(B,X)),this.layers.push(X);const V=X.status$.pipe((0,A.a)()).subscribe(B=>{B===F.qM.Error&&(this.loading=0,this.loaded=-1),B===F.qM.Working?this.loading+=1:B===F.qM.Done&&(this.loaded+=1),this.loaded>=this.loading?(this.loading=this.loaded=0,this.status=F.qM.Done):this.loading>0&&(this.status=F.qM.Working)});this.subscriptions.push(V)}unwatchLayer(X){X.ol.un("propertychange",B=>this.setPropertyChange(B,X)),X.dataSource.ol.un("propertychange",B=>this.setPropertyChange(B,X)),X.status$.next(F.qM.Done);const V=this.layers.indexOf(X);V>=0&&(-1!==[F.qM.Working,F.qM.Waiting].indexOf(X.watcher.status)&&(this.loaded+=1),this.subscriptions[V].unsubscribe(),this.subscriptions.splice(V,1),this.layers.splice(V,1),X.watcher.unwatch())}}var W=r(42364),w=r(87272),te=r(19724);class Z{storageService;configService;ol;forcedOffline$=new y.g(!1);layers$=new y.g([]);layersAddedByClick$=new y.g(void 0);status$;propertyChange$;overlay;queryResultsOverlay;searchResultsOverlay;viewController;geolocationController;swipeEnabled$=new y.g(!1);mapCenter$=new y.g(!1);selectedFeatures$=new y.g(null);bufferDataSource;layerWatcher;options;mapViewOptions;defaultOptions={controls:{attribution:!1}};get layers(){return this.layers$.value}get projection(){return this.projectionCode}get viewProjection(){return this.viewController.getOlProjection()}get projectionCode(){return this.viewProjection.getCode()}constructor(X,V,B){this.storageService=V,this.configService=B,this.options=Object.assign({},this.defaultOptions,X),this.layerWatcher=new k,this.status$=this.layerWatcher.status$,this.propertyChange$=this.layerWatcher.propertyChange$,f.sV(R.c),this.init()}init(){const X=[];this.options.controls&&(this.options.controls.attribution&&X.push(new d.c(!0===this.options.controls.attribution?{}:this.options.controls.attribution)),this.options.controls.scaleLine&&X.push(new L.c(!0===this.options.controls.scaleLine?{}:this.options.controls.scaleLine)));let V={};!1===this.options.interactions&&(V={altShiftDragRotate:!1,doubleClickZoom:!1,keyboard:!1,mouseWheelZoom:!1,shiftDragZoom:!1,dragPan:!1,pinchRotate:!1,pinchZoom:!1}),this.ol=new C.c({interactions:P.Q(V),controls:X}),this.setView(this.options.view||{}),this.viewController=new w.c({stateHistory:!0}),this.viewController.setOlMap(this.ol),this.overlay=new a.m(this),this.queryResultsOverlay=new a.m(this),this.searchResultsOverlay=new a.m(this),this.ol.once("rendercomplete",()=>{this.geolocationController=new W.E(this,{projection:this.viewController.getOlProjection()},this.storageService,this.configService),this.geolocationController.setOlMap(this.ol),this.geolocationController&&this.geolocationController.updateGeolocationOptions(this.mapViewOptions),this.layers$.pipe((0,O.c)()).subscribe(([B,z])=>{let c;B&&(c=B.map(b=>b.id));const I=z.filter(b=>!c.includes(b.id));for(const b of I)b.options.linkedLayers&&b.ol.once("postrender",()=>{(0,te.GK)(this,I)})}),this.viewController.monitorRotation()}),this.propertyChange$.pipe((0,x.O)(B=>!B)).subscribe(B=>(0,te.S8)(this,B.event,B.layer))}setTarget(X){this.ol.setTarget(X),void 0!==X?this.layerWatcher.subscribe(()=>{},null):this.layerWatcher.unsubscribe()}updateView(X){const B={...this.ol.getView().getProperties(),...X};X.zoom&&null==X.resolution&&(B.resolution=void 0),this.setView(B),X.maxZoomOnExtent&&(this.viewController.maxZoomOnExtent=X.maxZoomOnExtent),this.mapViewOptions=X}setView(X){void 0!==this.viewController&&this.viewController.clearStateHistory();const V={constrainResolution:!0,...X};X.center&&(V.center=o.QH(X.center,X.projection)),this.ol.setView(new e.cp(V)),X.maxLayerZoomExtent&&(this.viewController.maxLayerZoomExtent=X.maxLayerZoomExtent)}updateControls(X){if(void 0===X)return;const V=[];X.attribution&&V.push(new d.c(!0===X.attribution?{}:X.attribution)),X.scaleLine&&V.push(new L.c(!0===X.scaleLine?{}:X.scaleLine)),Object.assign([],this.ol.getControls().getArray()).forEach(z=>{this.ol.removeControl(z)}),V.forEach(z=>{this.ol.addControl(z)})}getCenter(X){return this.viewController.getCenter(X)}getExtent(X){return this.viewController.getExtent(X)}getZoom(){return this.viewController.getZoom()}changeBaseLayer(X){if(X){for(const V of this.getBaseLayers())V.visible=!1;X.visible=!0,this.viewController.olView.setMinZoom(X.dataSource.options.minZoom||(this.options.view||{}).minZoom),this.viewController.olView.setMaxZoom(X.dataSource.options.maxZoom||(this.options.view||{}).maxZoom)}}getBaseLayers(){return this.layers.filter(X=>!0===X.baseLayer)}getLayerById(X){return this.layers.find(V=>V.id&&V.id===X)}getLayerByAlias(X){return this.layers.find(V=>V.alias&&V.alias===X)}getLayerByOlUId(X){return this.layers.find(V=>(0,h.gV)(V.ol)&&(0,h.gV)(V.ol)===X)}getLayerByOlLayer(X){const V=(0,h.gV)(X);return this.getLayerByOlUId(V)}addLayer(X,V=!0){this.addLayers([X])}addLayers(X,V=!0){let B=0,z=0;const c=X.map(I=>{if(!I)return;const b=I.zIndex?0:I.baseLayer?z++:B++;return this.doAddLayer(I,b)}).filter(I=>void 0!==I);this.setLayers([].concat(this.layers,c))}removeLayer(X){this.removeLayers([X])}removeLayers(X){const V=this.layers$.value.slice(0),B=[];X.forEach(z=>{z instanceof T.Md&&z.removeLayerFromIDB();const c=V.indexOf(z);c>=0&&(B.push(z),V.splice(c,1),this.handleLinkedLayersDeletion(z,B),B.map(I=>{const b=V.indexOf(I);b>=0&&V.splice(b,1)}))}),B.forEach(z=>this.doRemoveLayer(z)),this.setLayers(V)}handleLinkedLayersDeletion(X,V){let B=(0,te.aY)(this,X);B||(B=X);const z=(0,te.yP)(this,B,[B]);for(const c of z)V.push(c)}removeAllLayers(){this.layers.forEach(X=>this.doRemoveLayer(X)),this.layers$.next([])}raiseLayer(X){const V=this.getLayerIndex(X);V>1&&this.moveLayer(X,V,V-1)}raiseLayers(X){for(const V of X)this.raiseLayer(V)}lowerLayer(X){const V=this.getLayerIndex(X);V<this.layers.length-1&&this.moveLayer(X,V,V+1)}lowerLayers(X){const V=X.reverse();for(const B of V)this.lowerLayer(B)}moveLayer(X,V,B){const z=this.layers[B],I=X.zIndex;z.baseLayer||X.baseLayer||(X.zIndex=z.zIndex,z.zIndex=I,this.layers[B]=X,this.layers[V]=z,this.layers$.next(this.layers.slice(0)))}doAddLayer(X,V){X.baseLayer&&X.visible&&this.changeBaseLayer(X);const B=this.getLayerById(X.id);if(void 0===B){if(!X.baseLayer&&X.zIndex&&(X.zIndex+=10),void 0===X.zIndex||0===X.zIndex){const z=Math.max(X.baseLayer?0:10,...this.layers.filter(c=>c.baseLayer===X.baseLayer&&c.zIndex<200).map(c=>c.zIndex));X.zIndex=z+1+V}return X.baseLayer&&X.zIndex>9&&(X.zIndex=10),X.setMap(this),this.layerWatcher.watchLayer(X),this.ol.addLayer(X.ol),X}B.visible=!0}doRemoveLayer(X){this.layerWatcher.unwatchLayer(X),this.ol.removeLayer(X.ol),X.setMap(void 0)}setLayers(X){this.layers$.next(this.sortLayersByZIndex(X).slice(0))}sortLayersByZIndex(X){return X.sort((V,B)=>B.zIndex-V.zIndex)}getLayerIndex(X){return this.layers.findIndex(V=>V===X)}}},59324:(Fe,ce,r)=>{"use strict";r.d(ce,{G2:()=>o,Ko:()=>f,Re:()=>a,Sc:()=>L,bg:()=>R,iC:()=>y,mC:()=>T,q:()=>O,rE:()=>h,uE:()=>x});var C=r(43168),e=r(872),d=r(61252);function L(k,W,w={}){let te,Z,K,X,V,B,z,c,I,b,G,D,g,U,M,H,s,ie,de,ae;const le=new RegExp("(\\s*;\\s*[\\d]{4,6})","g"),oe="([-+])?([\\d]{1,3})([,.](\\d+))?",se=`${oe}[\\s,]+${oe}`,me=new RegExp(`^${se}$`,"g"),be="([0-9]{1,2})[:|\xb0]?\\s*([0-9]{1,2})?[:|'|\u2032|\u2019]?\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\s*[\"|\u2033|\u201d]?\\s*",ke=`${be}([N|S|E|W|O]),?\\s*${be}([N|S|E|W|O])`,qe=new RegExp(`^${ke}$`,"gi"),nt="(UTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",Ue=new RegExp(`^${nt}`,"gi"),St="(MTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",Ae=new RegExp(`^${St}`,"gi"),Qe="([-+])?(\\d{1,3})[,.](\\d+)",_e=`${Qe}\\s*[,]?\\s*${Qe}`,Ie=new RegExp(`^${_e}`,"g"),je="([-+])?(\\d{1,3})[\\s,.]{1}(\\d{1,2})[\\s,.]{1}(\\d{1,2})[.,]?(\\d{1,5})?",Ve=`${je}\\s*[,.]?\\s*${je}`,ot=new RegExp(`^${Ve}`,"g"),lt="LAT\\s*[\\s:]*\\s*([-+])?(\\d{1,2})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*LONG\\s*[\\s:]*\\s*([-+])?(\\d{1,3})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*UNC\\s*[\\s:]?\\s*(\\d+)\\s*CONF\\s*[\\s:]?\\s*(\\d{1,3})",Me=new RegExp(`^${lt}?`,"gi"),ct="([-+]?\\d+)[,.]?(\\d+)?",Oe=`${ct}[\\s,]+${ct}`,He=new RegExp(`^${Oe}$`,"g");let ze=!1;if(k=k.toLocaleUpperCase().trim(),le.test(k)?[Z,ae]=k.split(";").map(Rt=>Rt.trim()):Z=k,me.test(Z))[,K,ie,,c,I,de,,U]=Z.match(se),ie=parseFloat((K||"")+ie+"."+c),de=parseFloat((I||"")+de+"."+U);else if(qe.test(Z))[,X,V,B,z,b,G,D,g]=Z.match(ke),("S"===z||"N"===z)&&(X=[b,b=X][0],V=[G,G=V][0],B=[D,D=B][0],z=[g,g=z][0]),ie=P(parseFloat(X),parseFloat(V),parseFloat(B),z),de=P(parseFloat(b),parseFloat(G),parseFloat(D),g);else if(Ue.test(Z)){ze=!0,[,,M,ie,de]=Z.match(nt);const Rt=Number(M)<10?`EPSG:3260${M}`:`EPSG:326${M}`;[ie,de]=d.AF([parseFloat(ie),parseFloat(de)],Rt,"EPSG:4326")}else if(Ae.test(Z)){ze=!0,[,,M,ie,de]=Z.match(St);const Rt=Number(M)<10?`EPSG:3218${M}`:`EPSG:321${80+Number(M)}`;[ie,de]=d.AF([parseFloat(ie),parseFloat(de)],Rt,"EPSG:4326")}else if(ot.test(Z))[,K,X,V,B,c,I,b,G,D,U]=Z.match(Ve),ie=P(parseFloat((K||"")+X),parseFloat(V),parseFloat(B),z),de=P(parseFloat((I||"")+b),parseFloat(G),parseFloat(D),g);else if(Ie.test(Z))[,K,X,c,I,b,U]=Z.match(_e),ie=P(parseFloat((K||"")+X),parseFloat(V),parseFloat(B),z),de=P(parseFloat((I||"")+b),parseFloat(G),parseFloat(D),g);else if(Me.test(Z))[,I,b,G,D,,g,K,X,V,B,,z,H,s]=Z.match(lt),z||(z="W"),ie=V&&V.length>2?parseFloat((K||"")+X+"."+V):P(parseFloat(X),parseFloat(V),parseFloat(B),z),de=G&&G.length>2?parseFloat((I||"")+b+"."+G):P(parseFloat(b),parseFloat(G),parseFloat(D),g);else{if(!He.test(Z))return{lonLat:void 0,message:"",radius:void 0,conf:void 0};ze=!0,[,ie,c,de,U]=Z.match(Oe),c&&(ie=parseFloat(ie+"."+c)),U&&(de=parseFloat(de+"."+U))}if(w.forceNA&&!ze&&(ie>0&&de>0&&(ie>de?ie=-ie:de=-de),ie>de&&(ie=[de,de=ie][0])),te=[Number(ie),Number(de)],void 0!==ae&&"4326"!==ae||te[0]>180||te[0]<-180||te[1]>90||te[1]<-90){const Rt=ae?"EPSG:"+ae:W,Ft="EPSG:4326";try{te=d.AF(te,Rt,Ft)}catch{return{lonLat:void 0,message:"Projection "+Rt+" not supported",radius:void 0,conf:void 0}}}return Math.abs(te[0])<=180&&Math.abs(te[1])<=90?{lonLat:te,message:"",radius:H?parseInt(H,10):void 0,conf:s?parseInt(s,10):void 0}:{lonLat:void 0,message:"Coordinate out of Longitude/Latitude bounds",radius:void 0,conf:void 0}}function P(k,W,w,te){W=W||0,w=w||0;const Z=k<0;let K=Math.abs(k)+W/60+w/3600;return(Z||"S"===te||"W"===te)&&(K=-K),K}function o(k,W=3){const w=[];return k.forEach(te=>{const Z=te<0?Math.ceil(te):Math.floor(te),K=te<0?60*(Z-te):60*(te-Z),X=Math.floor(K),V=(60*(K-X)).toFixed(W);w.push(`${Z}\xb0 ${X}' ${V}"`)}),w}function f(k,W){if(void 0===k||void 0===W)return!1;const w=1e-4;return k.zoom===W.zoom&&Math.trunc(k.center[0]/w)===Math.trunc(W.center[0]/w)&&Math.trunc(k.center[1]/w)===Math.trunc(W.center[1]/w)}function h(k){return(k=Math.round(k))<1e4?k+"":(k=Math.round(k/1e3))<1e3?k+"K":(k=Math.round(k/1e3))+"M"}function R(k,W=96){return k/(39.3701*W)}function y(k,W="m",w=96){return k*d.q[W]*39.3701*w}function O(k){const W=k.originalEvent;return!W.altKey&&(e.q2?W.metaKey:W.ctrlKey)&&!W.shiftKey}function x(k,W=3){return[C.UD.roundToNDecimal(k[0],W),C.UD.roundToNDecimal(k[1],W)]}function T(k,W=3){return x(k,W).map(w=>w.toString())}function a(k,W){const w=d.AF(k,"EPSG:4326","EPSG:3857"),te=[{code:"EPSG:3857",alias:"Web Mercator",coord:w,igo2CoordFormat:`${x(w).join(", ")} ; 3857`}],Z=function F(k){return Math.ceil((k[0]+180)/6)}(k),K=Z<10?`EPSG:3260${Z}`:`EPSG:326${Z}`,X=`UTM-${Z}`,V=d.AF(k,"EPSG:4326",K);te.push({code:K,alias:"UTM",coord:V,igo2CoordFormat:`${X} ${x(V).join(", ")}`});const B=function A(k){const W=k[0];let w;return W<-51&&W>-54&&(w=1),W<-54&&W>-57&&(w=2),W<-57&&W>-60&&(w=3),W<-60&&W>-63&&(w=4),W<-63&&W>-66&&(w=5),W<-66&&W>-69&&(w=6),W<-69&&W>-72&&(w=7),W<-72&&W>-75&&(w=8),W<-75&&W>-78&&(w=9),W<-78&&W>-81&&(w=10),w}(k);if(B){const z=B<10?`EPSG:3218${B}`:`EPSG:321${80+B}`,c=`MTM-${B}`,I=d.AF(k,"EPSG:4326",z);te.push({code:z,alias:"MTM",coord:I,igo2CoordFormat:`${c} ${x(I).join(", ")}`})}return W.forEach(z=>{const c=d.AF(k,"EPSG:4326",z.code),I=z.code.split(":")[1];te.push({code:z.code,alias:z.alias||z.code,coord:c,igo2CoordFormat:`${x(c).join(", ")} ; ${I}`})}),te}},55760:(Fe,ce,r)=>{"use strict";r.d(ce,{U:()=>o});var C=r(93020),e=r(39882),d=r(35876),L=r(9364),P=r(34896);let o=(()=>{class f{networkService;messageService;component;get map(){return this.component.map}previousMessageId;constructor(R,y,O){this.networkService=y,this.messageService=O,this.component=R}ngAfterViewInit(){const R=window.navigator.onLine;this.map.forcedOffline$.subscribe(y=>{const O=window.navigator.onLine;if(!R||R!==O||y)if(this.previousMessageId&&this.messageService.remove(this.previousMessageId),!y&&O){const x=this.messageService.info("igo.geo.network.online.message","igo.geo.network.online.title");this.previousMessageId=x.toastId}else if(y){const x=this.messageService.info("igo.geo.network.offline.message","igo.geo.network.offline.title");this.previousMessageId=x.toastId}}),(0,d.E)([this.networkService.currentState(),this.map.forcedOffline$,this.map.layers$]).subscribe(y=>{this.handleLayersOnlineState(y[0].connection,y[1],y[2])})}handleNonOfflinableLayerResolution(R,y,O){!R||y?O.maxResolution=0:(R||!y)&&(O.maxResolution=O.options.maxResolution||1/0)}handleLayersOnlineState(R,y,O){O.forEach(x=>{let T;if(!x.isIgoInternalLayer){if(x.options.sourceOptions?.pathOffline&&(T=x.options.sourceOptions),!T)return void this.handleNonOfflinableLayerResolution(R,y,x);{const a=T.type;if("mvt"===a&&x.ol.getSource().refresh(),!R||y){if(["vector","cluster"].includes(a))return;x.ol.getSource().setUrl(T.pathOffline)}else if(R&&y)this.handleNonOfflinableLayerResolution(R,y,x);else{if(["vector","cluster"].includes(a))return;x.ol.getSource().setUrl(T.url)}}}})}static \u0275fac=function(y){return new(y||f)(P.GI1(L.q),P.GI1(e.u),P.GI1(C.mi))};static \u0275dir=P.Sc5({type:f,selectors:[["","igoMapOffline",""]],standalone:!0})}return f})()},16660:(Fe,ce,r)=>{"use strict";r.d(ce,{q:()=>o});var C=r(9204),e=r(61252),d=r(42124),L=r(3576),P=r(34896);let o=(()=>{class f{config;constructor(R){this.config=R,(this.config.getConfig("projections")||[]).forEach(O=>{O.alias=O.alias?O.alias:O.code,this.registerProjection(O)});for(let O=1;O<61;O++)this.registerProjection({code:O<10?`EPSG:3260${O}`:`EPSG:326${O}`,def:`+proj=utm +zone=${O} +datum=WGS84 +units=m +no_defs`,extent:void 0});for(let O=1;O<11;O++){const x=O<10?`EPSG:3218${O}`:`EPSG:321${80+O}`;let T;T=Number(O)<=2?-50-3*Number(O):Number(O)>=12?-81-3*(Number(O)-12):-49.5-3*Number(O),this.registerProjection({code:x,def:`+proj=tmerc +lat_0=0 +lon_0=${T} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"`,extent:void 0})}}registerProjection(R){L.c.defs(R.code,R.def),d.sV(L.c),R.extent&&e._M(R.code).setExtent(R.extent)}static \u0275fac=function(y){return new(y||f)(P.CoB(C.aW))};static \u0275prov=P.wxM({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()},7700:(Fe,ce,r)=>{"use strict";r.d(ce,{ET:()=>e,GU:()=>P,KG:()=>L,KM:()=>d});var C=r(7080);function e(o){let f=-54;if(o<-81||o>f)return 0;{let y=2;for(;Math.abs(o-f)>3;)f-=3,y++;return y}}function d(o){let f=-180,y=1;for(;Math.abs(o-f)>6;)f+=6,y++;return y}function L(o){const f=o.mtmZone,h=o.utmZone;return{projFromConfig:!1!==o.projFromConfig,nad83:!1!==o.nad83,wgs84:!1!==o.wgs84,webMercator:!1!==o.webMercator,utm:!1!==o.utm,mtm:!1!==o.mtm,utmZone:{minZone:h&&h.minZone?h.minZone:17,maxZone:h&&h.maxZone?h.maxZone:21},mtmZone:{minZone:f&&f.minZone?f.minZone:2,maxZone:f&&f.maxZone?f.maxZone:10}}}function P(o){const f=o.file,h=o.nbLines??500,R=new FileReader;return(0,C.Q)(new Promise(y=>{f.name.toLowerCase().endsWith(".geojson")||f.name.toLowerCase().endsWith(".json")||f.name.toLowerCase().endsWith(".gml")?(R.onload=O=>{if(f.name.toLowerCase().endsWith(".geojson")||f.name.toLowerCase().endsWith(".json")){const x=JSON.parse(R.result);if(x.crs?.properties?.name){const T=x.crs.properties.name.match(/EPSG:{1,2}\d{0,6}/gm);return null!==T&&T.length?void y(T[0].replace(/::/g,":")):void y("epsgNotDefined")}y("epsgNotDefined")}else if(f.name.toLowerCase().endsWith(".gml")){const T=R.result.split("\n");for(let a=0;a<=h;a++){const F=T[a].match(/EPSG:\d{0,6}/gm);if(null!==F&&F.length){y(F[0]);break}y(void 0)}}else y("epsgNotDefined")},R.readAsText(f,"UTF-8")):y("epsgNotDefined")}))}},72124:(Fe,ce,r)=>{"use strict";r.d(ce,{Q:()=>L});var C=r(2500),d=(r(89500),r(34896));let L=(()=>{class P{map;layers;pos1;pos3;inDragAction=!1;swipeEnabled$$;boundPrerender=this.prerender.bind(this);constructor(){}ngAfterViewInit(){this.getListOfLayers(),this.swipeEnabled$$=this.map.swipeEnabled$.subscribe(f=>{f?this.displaySwipe():this.displaySwipeOff()}),this.letZoom()}ngOnDestroy(){this.swipeEnabled$$.unsubscribe(),this.map.swipeEnabled$.unsubscribe(),this.displaySwipeOff()}displaySwipe(){this.swipeId&&(this.swipeId.style.visibility="visible"),this.layers.map(f=>f.ol.on("prerender",this.boundPrerender)),this.layers.map(f=>f.ol.on("postrender",this.postrender)),this.map.ol.render()}displaySwipeOff(){this.swipeId&&(this.swipeId.style.visibility="hidden"),this.layers.map(f=>f.ol.un("prerender",this.boundPrerender)),this.layers.map(f=>f.ol.un("postrender",this.postrender)),this.map.ol.render(),this.layers=[]}get swipeId(){return document.getElementById("igo-layer-swipe")}getListOfLayers(){this.map.selectedFeatures$.subscribe(f=>{if(this.layers=[],null!==f)for(const h of f)this.layers.includes(h)||this.layers.push(h)})}dragDown(f){this.inDragAction=!0,f.preventDefault(),"mousedown"===f.type?(this.pos3=f.clientX,this.mouseSwipe(),document.onmouseup=this.closeDragMouseElement):"touchstart"===f.type&&(document.getElementById("arrows").style.visibility="hidden",this.pos3=f.touches[0].clientX,this.touchSwipe(),document.ontouchend=this.closeDragTouchElement)}mouseSwipe(){document.addEventListener("mousemove",f=>{this.inDragAction&&(f.preventDefault(),this.pos1=this.pos3-f.clientX,this.pos3=f.clientX,this.swipeId.style.left=this.swipeId.offsetLeft-this.pos1+"px"),this.map.ol.render()})}touchSwipe(){document.addEventListener("touchmove",f=>{this.inDragAction&&(f.preventDefault(),document.getElementById("arrows").style.visibility="hidden",this.pos1=this.pos3-f.changedTouches[0].clientX,this.pos3=f.changedTouches[0].clientX,this.swipeId.style.left=this.swipeId.offsetLeft-this.pos1+"px"),this.map.ol.render()})}closeDragMouseElement(){document.onmouseup=null,document.onmousemove=null,this.inDragAction=!1}closeDragTouchElement(){document.ontouchend=null,document.ontouchmove=null,document.getElementById("arrows").style.visibility="visible",this.inDragAction=!1}prerender(f){const h=f.context,R=this.map.ol.getSize(),y=this.swipeId.offsetLeft,O=(0,C.sv)(f,[y,0]),x=(0,C.sv)(f,[0,0]),T=(0,C.sv)(f,[y,R[1]]),a=(0,C.sv)(f,[0,R[1]]);h.save(),h.beginPath(),h.moveTo(O[0],O[1]),h.lineTo(T[0],T[1]),h.lineTo(a[0],a[1]),h.lineTo(x[0],x[1]),h.closePath(),h.clip()}postrender(f){f.context.restore(),f.context.save()}letZoom(){document.getElementById("igo-layer-swipe").addEventListener("wheel",f=>{f.deltaY>0?this.map.viewController.zoomOut():this.map.viewController.zoomIn()},!0)}static \u0275fac=function(h){return new(h||P)};static \u0275cmp=d.In1({type:P,selectors:[["igo-swipe-control"]],inputs:{map:"map"},standalone:!0,features:[d.UHJ],decls:5,vars:0,consts:[["id","igo-layer-swipe",1,"igo-swipe-control-container",3,"mousedown","mouseup","touchstart","touchend"],[1,"igo-swipe-control-line"],["id","arrows",1,"igo-swipe-control-arrows"],[1,"igo-arrow-left"],[1,"igo-arrow-right"]],template:function(h,R){1&h&&(d.I0R(0,"div",0),d.qCj("mousedown",function(O){return R.dragDown(O)})("mouseup",function(){return R.closeDragMouseElement()})("touchstart",function(O){return R.dragDown(O)})("touchend",function(){return R.closeDragTouchElement()}),d.wR5(1,"div",1),d.I0R(2,"div",2),d.wR5(3,"div",3)(4,"div",4),d.C$Y()())},styles:[".igo-swipe-control-container[_ngcontent-%COMP%]{position:absolute;width:80px;height:100%;top:0%;left:50%;cursor:grab;z-index:1;transform:translate(-40px)}.igo-swipe-control-container[_ngcontent-%COMP%]:active{cursor:grabbing}.igo-swipe-control-line[_ngcontent-%COMP%]{position:absolute;width:4px;height:100%;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#5e5a5a}.igo-swipe-control-arrows[_ngcontent-%COMP%]{position:absolute;width:32px;height:32px;left:50%;top:50%;transform:translate(-50%,-50%);margin-top:-16px;padding:5px 4px;background-color:#5e5a5a;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0)}.igo-swipe-control-arrows[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:inline-block;width:0;height:0;border-top:10px solid transparent;border-bottom:10px solid transparent}.igo-swipe-control-arrows[_ngcontent-%COMP%]   .igo-arrow-right[_ngcontent-%COMP%]{margin-left:4px;border-left:10px solid white}.igo-swipe-control-arrows[_ngcontent-%COMP%]   .igo-arrow-left[_ngcontent-%COMP%]{border-right:10px solid white}.igo-swipe-control-arrows[_ngcontent-%COMP%]:active{display:none}"]})}return P})()},50208:(Fe,ce,r)=>{"use strict";r.d(ce,{w:()=>T});var C=r(65056),e=r(34672),d=r(32328),L=r(27e3),P=r(24708),o=r(21720),f=r(43168),h=r(60904),R=r.n(h),y=r(54844),O=r(34896),x=r(72584);let T=(()=>{class a{storageService;color="primary";get enabled(){return this.storageService.get("wakeLockEnabled")}set enabled(A){this.storageService.set("wakeLockEnabled",A)}noSleep;icon$=new y.g("bedtime");visible=!1;constructor(A){this.storageService=A,this.noSleep=new(R()),f.sX.satisfies({ie:">0",edge:"<84",chrome:"<84",firefox:">0",opera:"<70",safari:">0"})&&(this.disableWakeLock(),this.enabled=!1,window.addEventListener("blur",()=>{this.disableWakeLock(),this.enabled=!1})),this.enabled?this.enableWakeLock():this.disableWakeLock()}enableWakeLock(){this.noSleep.enable(),this.enabled=!0,this.icon$.next("bedtime_off")}disableWakeLock(){this.noSleep.disable(),this.enabled=!1,this.icon$.next("bedtime")}toggleWakeLock(){this.enabled?this.disableWakeLock():this.enableWakeLock()}static \u0275fac=function(k){return new(k||a)(O.GI1(o.yQ))};static \u0275cmp=O.In1({type:a,selectors:[["igo-wake-lock-button"]],inputs:{color:"color",enabled:"enabled"},standalone:!0,features:[O.UHJ],decls:7,vars:9,consts:[[1,"igo-wake-lock-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"color","matTooltip","click"]],template:function(k,W){1&k&&(O.I0R(0,"div",0)(1,"button",1),O.qCj("click",function(){return W.toggleWakeLock()}),O.wVc(2,"translate"),O.wVc(3,"translate"),O.I0R(4,"mat-icon"),O.OEk(5),O.wVc(6,"async"),O.C$Y()()()),2&k&&(O.yG2(),O.E7m("color",W.color)("matTooltip",W.enabled?O.kDX(2,3,"igo.geo.mapButtons.preventScreenLock"):O.kDX(3,5,"igo.geo.mapButtons.letScreenLock")),O.yG2(4),O.cNF(O.kDX(6,7,W.icon$)))},dependencies:[e.oJ,e.um,L.KO,L.a4,d.oB,d.qL,C.a,P._s,x.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-wake-lock-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-wake-lock-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}"]})}return a})()},75872:(Fe,ce,r)=>{"use strict";r.d(ce,{q:()=>R});var C=r(34672),e=r(32328),d=r(27e3),L=r(24708),o=(r(89500),r(34896)),f=r(72584);const h=y=>({zoom:y});let R=(()=>{class y{map;color;get zoom(){return this.map.viewController.getZoom()}get minZoom(){return this.map.viewController.olView.getMinZoom()||1}get maxZoom(){return this.map.viewController.olView.getMaxZoom()}constructor(){}static \u0275fac=function(T){return new(T||y)};static \u0275cmp=o.In1({type:y,selectors:[["igo-zoom-button"]],inputs:{map:"map",color:"color"},standalone:!0,features:[o.UHJ],decls:9,vars:16,consts:[[1,"igo-zoom-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"matTooltip","color","disabled","click"]],template:function(T,a){1&T&&(o.I0R(0,"div",0)(1,"button",1),o.qCj("click",function(){return a.map.viewController.zoomIn()}),o.wVc(2,"translate"),o.I0R(3,"mat-icon"),o.OEk(4,"add"),o.C$Y()(),o.I0R(5,"button",1),o.qCj("click",function(){return a.map.viewController.zoomOut()}),o.wVc(6,"translate"),o.I0R(7,"mat-icon"),o.OEk(8,"remove"),o.C$Y()()()),2&T&&(o.yG2(),o.E7m("matTooltip",o.g7$(2,6,"igo.geo.mapButtons.zoomIn",o.S45(12,h,a.zoom+1)))("color",a.color)("disabled",a.zoom>=a.maxZoom),o.yG2(4),o.E7m("matTooltip",o.g7$(6,9,"igo.geo.mapButtons.zoomOut",o.S45(14,h,a.zoom-1)))("color",a.color)("disabled",a.zoom<=a.minZoom))},dependencies:[C.oJ,C.um,d.KO,d.a4,e.oB,e.qL,L._s,f.sD],styles:["[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]{width:40px}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#fff}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#efefef}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-bottom:2px}"]})}return y})()},49312:(Fe,ce,r)=>{"use strict";r.d(ce,{K8:()=>C.K8,y:()=>d.y,wP:()=>C.wP,aK:()=>C.aK,ox:()=>C.ox,cD:()=>C.cD,ie:()=>C.ie});var C=r(45076),d=(r(87080),r(79280))},87080:(Fe,ce,r)=>{"use strict";r.d(ce,{j:()=>L});var C=r(69904),e=r(8512),d=r(34896);let L=(()=>{class P{transform(f,h,R=!1,y=1){let O;return Object.values(C.Mh).indexOf(h)>=0?O=(0,e.Ej)(f,h):Object.values(C.K8).indexOf(h)>=0&&(O=(0,e.iK)(f,h)),O&&(0,e.wP)(O,{decimal:1,unit:h,unitAbbr:R,locale:"fr"})}static \u0275fac=function(h){return new(h||P)};static \u0275pipe=d.UTH({name:"measureFormat",type:P,pure:!0,standalone:!0})}return P})()},79280:(Fe,ce,r)=>{"use strict";r.d(ce,{y:()=>St});var C=r(65056),e=r(34672),d=r(24296),L=r(75180),P=r(32328),o=r(43424),f=r(27e3),h=r(53e3),R=r(24708),y=r(21720),O=r(43168),x=r(83552),T=r(12396),a=r(28772),F=r(54776),A=r(54844),k=r(68013),W=r(3544),w=r(39844),te=r(41912),Z=r(99228),X=(r(89500),r(69904)),V=r(8512),B=r(40600),z=r(87080),c=r(34896),I=r(72584);function b(Ae,Qe){if(1&Ae&&(c.I0R(0,"table",3)(1,"thead")(2,"tr")(3,"th",4),c.OEk(4),c.wVc(5,"translate"),c.C$Y()()(),c.I0R(6,"tbody")(7,"tr")(8,"td"),c.OEk(9),c.wVc(10,"measureFormat"),c.C$Y(),c.I0R(11,"td"),c.OEk(12),c.wVc(13,"translate"),c.C$Y()(),c.I0R(14,"tr")(15,"td"),c.OEk(16),c.wVc(17,"measureFormat"),c.C$Y(),c.I0R(18,"td"),c.OEk(19),c.wVc(20,"translate"),c.C$Y()(),c.I0R(21,"tr")(22,"td"),c.OEk(23),c.wVc(24,"measureFormat"),c.C$Y(),c.I0R(25,"td"),c.OEk(26),c.wVc(27,"translate"),c.C$Y()(),c.I0R(28,"tr")(29,"td"),c.OEk(30),c.wVc(31,"measureFormat"),c.C$Y(),c.I0R(32,"td"),c.OEk(33),c.wVc(34,"translate"),c.C$Y()()()()),2&Ae){const _e=c.GaO();c.yG2(4),c.oRS(" ",c.kDX(5,9,"igo.geo.measure.dialog.length.title")," "),c.yG2(5),c.cNF(c.g7$(10,11,_e.data.length,_e.measureLengthUnit.Meters)),c.yG2(3),c.cNF(c.kDX(13,14,"igo.geo.measure.dialog.lengthInMeters")),c.yG2(4),c.oRS(" ",c.g7$(17,16,_e.data.length,_e.measureLengthUnit.Kilometers)," "),c.yG2(3),c.cNF(c.kDX(20,19,"igo.geo.measure.dialog.lengthInKilometers")),c.yG2(4),c.cNF(c.g7$(24,21,_e.data.length,_e.measureLengthUnit.Miles)),c.yG2(3),c.cNF(c.kDX(27,24,"igo.geo.measure.dialog.lengthInMiles")),c.yG2(4),c.cNF(c.g7$(31,26,_e.data.length,_e.measureLengthUnit.Feet)),c.yG2(3),c.cNF(c.kDX(34,29,"igo.geo.measure.dialog.lengthInFeet"))}}function G(Ae,Qe){if(1&Ae&&(c.I0R(0,"table",3)(1,"thead")(2,"tr")(3,"th",4),c.OEk(4),c.wVc(5,"translate"),c.C$Y()()(),c.I0R(6,"tbody")(7,"tr")(8,"td"),c.OEk(9),c.wVc(10,"measureFormat"),c.C$Y(),c.I0R(11,"td"),c.OEk(12),c.wVc(13,"translate"),c.C$Y()(),c.I0R(14,"tr")(15,"td"),c.OEk(16),c.wVc(17,"measureFormat"),c.C$Y(),c.I0R(18,"td"),c.OEk(19),c.wVc(20,"translate"),c.C$Y()(),c.I0R(21,"tr")(22,"td"),c.OEk(23),c.wVc(24,"measureFormat"),c.C$Y(),c.I0R(25,"td"),c.OEk(26),c.wVc(27,"translate"),c.C$Y()(),c.I0R(28,"tr")(29,"td"),c.OEk(30),c.wVc(31,"measureFormat"),c.C$Y(),c.I0R(32,"td"),c.OEk(33),c.wVc(34,"translate"),c.C$Y()(),c.I0R(35,"tr")(36,"td"),c.OEk(37),c.wVc(38,"measureFormat"),c.C$Y(),c.I0R(39,"td"),c.OEk(40),c.wVc(41,"translate"),c.C$Y()(),c.I0R(42,"tr")(43,"td"),c.OEk(44),c.wVc(45,"translate"),c.C$Y(),c.I0R(46,"td"),c.OEk(47),c.wVc(48,"measureFormat"),c.C$Y()()()()),2&Ae){const _e=c.GaO();c.yG2(4),c.oRS(" ",c.kDX(5,13,"igo.geo.measure.dialog.area.title")," "),c.yG2(5),c.cNF(c.g7$(10,15,_e.data.area,_e.measureAreaUnit.SquareMeters)),c.yG2(3),c.cNF(c.kDX(13,18,"igo.geo.measure.dialog.areaInSquareMeters")),c.yG2(4),c.oRS(" ",c.g7$(17,20,_e.data.area,_e.measureAreaUnit.SquareKilometers)," "),c.yG2(3),c.oRS(" ",c.kDX(20,23,"igo.geo.measure.dialog.areaInSquareKilometers")," "),c.yG2(4),c.cNF(c.g7$(24,25,_e.data.area,_e.measureAreaUnit.SquareMiles)),c.yG2(3),c.cNF(c.kDX(27,28,"igo.geo.measure.dialog.areaInSquareMiles")),c.yG2(4),c.cNF(c.g7$(31,30,_e.data.area,_e.measureAreaUnit.Acres)),c.yG2(3),c.cNF(c.kDX(34,33,"igo.geo.measure.dialog.areaInAcres")),c.yG2(4),c.cNF(c.g7$(38,35,_e.data.area,_e.measureAreaUnit.Hectares)),c.yG2(3),c.cNF(c.kDX(41,38,"igo.geo.measure.dialog.areaInHectares")),c.yG2(4),c.cNF(c.kDX(45,40,"igo.geo.measure.dialog.perimeterInMeters")),c.yG2(3),c.cNF(c.g7$(48,42,_e.data.perimeter,_e.measureLengthUnit.Meters))}}let D=(()=>{class Ae{dialogRef;data;measureAreaUnit=X.Mh;measureLengthUnit=X.K8;constructor(_e,Ie){this.dialogRef=_e,this.data=Ie}onNoClick(){this.dialogRef.close()}static \u0275fac=function(Ie){return new(Ie||Ae)(c.GI1(B.yI),c.GI1(B.sR))};static \u0275cmp=c.In1({type:Ae,selectors:[["igo-measurer-dialog"]],standalone:!0,features:[c.UHJ],decls:6,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["class","mat-typography",4,"ngIf"],[1,"mat-typography"],["colspan","2"]],template:function(Ie,je){1&Ie&&(c.I0R(0,"h3",0),c.OEk(1),c.wVc(2,"translate"),c.C$Y(),c.I0R(3,"div",1),c.yuY(4,b,35,31,"table",2)(5,G,49,45,"table",2),c.C$Y()),2&Ie&&(c.yG2(),c.cNF(c.kDX(2,3,"igo.geo.measure.dialog.title")),c.yG2(3),c.E7m("ngIf",je.data.length>0),c.yG2(),c.E7m("ngIf",je.data.area>0))},dependencies:[B.WQ,B.iU,C.u_,R._s,I.sD,z.j],styles:["[_nghost-%COMP%]{font-family:Roboto,Helvetica Neue,sans-serif}h3[_ngcontent-%COMP%]{text-align:center;margin:0}table[_ngcontent-%COMP%]{width:100%;padding:10px}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{padding-left:10px}"]})}return Ae})();var g=r(46176),U=r(50244),M=r(42536),H=r(77872);function s(Ae,Qe){if(1&Ae&&(c.I0R(0,"mat-option",5),c.OEk(1),c.wVc(2,"translate"),c.C$Y()),2&Ae){const _e=Qe.$implicit;c.E7m("value",_e),c.yG2(),c.oRS(" ",c.kDX(2,2,"igo.geo.measure."+_e)," ")}}let ie=(()=>{class Ae{measure$=new A.g(void 0);measure$$;measureType;measureUnit;set measure(_e){this.measure$.next(_e)}get measure(){return this.measure$.value}set auto(_e){this.toggleAutoUnit(_e)}get auto(){return this._auto}_auto=!1;placeholder;measureUnitChange=new c._w7;get measureUnits(){return Object.values(this.measureType===X.gn.Area?X.Mh:X.K8)}constructor(){}ngOnDestroy(){this.toggleAutoUnit(!1)}onMeasureUnitChange(_e){this.measureUnit=_e,this.measureUnitChange.emit(_e)}toggleAutoUnit(_e){void 0!==this.measure$$&&this.measure$$.unsubscribe(),!0===_e&&(this.measure$$=this.measure$.subscribe(Ie=>{this.computeBestMeasureUnit(Ie)})),this._auto=_e}computeBestMeasureUnit(_e){let Ie=this.measureUnit;this.measureType===X.gn.Area?Ie=(0,V.AX)(_e):this.measureType===X.gn.Length&&(Ie=(0,V.Gs)(_e)),Ie!==this.measureUnit&&this.onMeasureUnitChange(Ie)}static \u0275fac=function(Ie){return new(Ie||Ae)};static \u0275cmp=c.In1({type:Ae,selectors:[["igo-measurer-item"]],inputs:{measureType:"measureType",measureUnit:"measureUnit",measure:"measure",auto:"auto",placeholder:"placeholder"},outputs:{measureUnitChange:"measureUnitChange"},standalone:!0,features:[c.UHJ],decls:9,vars:12,consts:[["floatLabel","always",1,"measure-field"],["matInput","",3,"disabled","readonly","value"],[1,"unit-field"],[3,"value","disabled","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(Ie,je){1&Ie&&(c.I0R(0,"mat-form-field",0)(1,"mat-label"),c.OEk(2),c.C$Y(),c.wR5(3,"input",1),c.wVc(4,"measureFormat"),c.wVc(5,"async"),c.C$Y(),c.I0R(6,"mat-form-field",2)(7,"mat-select",3),c.qCj("selectionChange",function(ot){return je.onMeasureUnitChange(ot.value)}),c.yuY(8,s,3,4,"mat-option",4),c.C$Y()()),2&Ie&&(c.yG2(2),c.cNF(je.placeholder),c.yG2(),c.E7m("disabled",!0)("readonly",!0)("value",c.g7$(4,7,c.kDX(5,10,je.measure$)||0,je.measureUnit)),c.yG2(4),c.E7m("value",je.measureUnit)("disabled",je.auto),c.yG2(),c.E7m("ngForOf",je.measureUnits))},dependencies:[U.wb,U.Up,U.w5,M.cN,M.yi,H.d5,H.kX,g.I5,C.Iw,g.Ax,C.a,R._s,I.sD,z.j],styles:["[_nghost-%COMP%]{display:flex;width:100%;padding:5px 10px}[_nghost-%COMP%]   .measure-field[_ngcontent-%COMP%]{pointer-events:none;flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{margin-left:8px;flex:1}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}"],changeDetection:0})}return Ae})();const de=["table"];function fe(Ae,Qe){1&Ae&&c.wR5(0,"mat-divider")}function Se(Ae,Qe){if(1&Ae){const _e=c.KQA();c.I0R(0,"mat-slide-toggle",7),c.qCj("change",function(je){c.usT(_e);const Ve=c.GaO();return c.CGJ(Ve.onToggleDisplayLines(je.checked))}),c.OEk(1),c.wVc(2,"translate"),c.C$Y()}if(2&Ae){const _e=c.GaO();c.E7m("checked",_e.displayLines)("labelPosition","before"),c.yG2(),c.oRS(" ",c.kDX(2,3,"igo.geo.measure.toggleDisplayLines")," ")}}function ae(Ae,Qe){1&Ae&&c.wR5(0,"mat-divider")}function le(Ae,Qe){if(1&Ae){const _e=c.KQA();c.I0R(0,"mat-slide-toggle",7),c.qCj("change",function(je){c.usT(_e);const Ve=c.GaO();return c.CGJ(Ve.onToggleDisplayDistance(je.checked))}),c.OEk(1),c.wVc(2,"translate"),c.C$Y()}if(2&Ae){const _e=c.GaO();c.E7m("checked",_e.displayDistance)("labelPosition","before"),c.yG2(),c.oRS(" ",c.kDX(2,3,"igo.geo.measure.toggleDisplayDistance")," ")}}function oe(Ae,Qe){if(1&Ae){const _e=c.KQA();c.I0R(0,"mat-slide-toggle",7),c.qCj("change",function(je){c.usT(_e);const Ve=c.GaO();return c.CGJ(Ve.onToggleDisplayAreas(je.checked))}),c.OEk(1),c.wVc(2,"translate"),c.C$Y()}if(2&Ae){const _e=c.GaO();c.E7m("checked",_e.displayAreas)("labelPosition","before"),c.yG2(),c.oRS(" ",c.kDX(2,3,"igo.geo.measure.toggleDisplayAreas")," ")}}function se(Ae,Qe){1&Ae&&c.wR5(0,"mat-divider")}function me(Ae,Qe){if(1&Ae){const _e=c.KQA();c.I0R(0,"igo-measurer-item",14),c.qCj("measureUnitChange",function(je){c.usT(_e);const Ve=c.GaO(2);return c.CGJ(Ve.onLengthUnitChange(je))}),c.wVc(1,"translate"),c.C$Y()}if(2&Ae){const _e=c.GaO().ngIf,Ie=c.GaO();c.E7m("measureType",Ie.measureType.Length)("measureUnit",Ie.activeLengthUnit)("measure",_e.length)("auto",Ie.measureUnitsAuto)("placeholder",c.kDX(1,5,Ie.activeMeasureType===Ie.measureType.Area?"igo.geo.measure.perimeter":"igo.geo.measure.length"))}}function be(Ae,Qe){if(1&Ae){const _e=c.KQA();c.I0R(0,"igo-measurer-item",14),c.qCj("measureUnitChange",function(je){c.usT(_e);const Ve=c.GaO(2);return c.CGJ(Ve.onAreaUnitChange(je))}),c.wVc(1,"translate"),c.C$Y()}if(2&Ae){const _e=c.GaO().ngIf,Ie=c.GaO();c.E7m("measureType",Ie.measureType.Area)("measureUnit",Ie.activeAreaUnit)("measure",_e.area)("auto",Ie.measureUnitsAuto)("placeholder",c.kDX(1,5,"igo.geo.measure.area"))}}function ke(Ae,Qe){if(1&Ae&&(c.SAx(0),c.yuY(1,me,2,7,"igo-measurer-item",13)(2,be,2,7,"igo-measurer-item",13),c.k70()),2&Ae){const _e=c.GaO();c.yG2(),c.E7m("ngIf",_e.activeMeasureType===_e.measureType.Length||_e.activeMeasureType===_e.measureType.Area),c.yG2(),c.E7m("ngIf",_e.activeMeasureType===_e.measureType.Area)}}function qe(Ae,Qe){1&Ae&&c.wR5(0,"mat-divider")}function nt(Ae,Qe){if(1&Ae){const _e=c.KQA();c.I0R(0,"button",15),c.qCj("click",function(){c.usT(_e);const je=c.GaO();return c.CGJ(je.onCalculateClick())}),c.wVc(1,"translate"),c.wVc(2,"async"),c.I0R(3,"mat-icon"),c.OEk(4,"calculate"),c.C$Y()()}if(2&Ae){const _e=c.GaO();c.E7m("matTooltip",c.kDX(1,2,"igo.geo.measure.actionbar.calculate.tooltip"))("disabled",0===c.kDX(2,4,_e.selectedFeatures$).length)}}function Ue(Ae,Qe){if(1&Ae){const _e=c.KQA();c.I0R(0,"button",16),c.qCj("click",function(){c.usT(_e);const je=c.GaO();return c.CGJ(je.onDeleteClick())}),c.wVc(1,"translate"),c.wVc(2,"async"),c.I0R(3,"mat-icon"),c.OEk(4,"delete"),c.C$Y()()}if(2&Ae){const _e=c.GaO();c.E7m("matTooltip",c.kDX(1,2,"igo.geo.measure.actionbar.delete.tooltip"))("disabled",0===c.kDX(2,4,_e.selectedFeatures$).length)}}let St=(()=>{class Ae{languageService;dialog;storageService;document;tableTemplate;subscriptions$$=[];measureType=X.gn;measureAreaUnit=X.Mh;measureLengthUnit=X.K8;measureUnitsAuto=!1;displayDistance=!0;displayLines=!0;displayAreas=!0;hasLine$=new A.g(!1);hasArea$=new A.g(!1);measure$=new A.g({});selectedFeatures$=new A.g([]);showTooltips=!0;drawControlIsDisabled=!0;drawLineControl;drawPolygonControl;modifyControl;activeOlGeometry;activeLengthUnit=X.K8.Meters;activeAreaUnit=X.Mh.SquareMeters;onFeatureAddedKey;onFeatureRemovedKey;activeDrawControl;drawStart$$;drawEnd$$;drawChanges$$;modifyStart$$;modifyEnd$$;modifyChanges$$;selectedFeatures$$;olDrawSource=new a.c;map;store;set activeMeasureType(_e){this.setActiveMeasureType(_e)}get activeMeasureType(){return this._activeMeasureType}_activeMeasureType;minSegmentLength=10;table;get drawControlIsActive(){return void 0!==this.activeDrawControl}get projection(){return this.map.ol.getView().getProjection().getCode()}constructor(_e,Ie,je,Ve){this.languageService=_e,this.dialog=Ie,this.storageService=je,this.document=Ve,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,columns:[{name:"length",title:this.languageService.translate.instant("igo.geo.measure.lengthHeader"),valueAccessor:ot=>{const lt=this.activeLengthUnit,Me=(0,V.iK)(ot.properties.measure.length,lt);return(0,V.wP)(Me,{decimal:1,unit:lt,unitAbbr:!1,locale:"fr"})}},{name:"area",title:this.languageService.translate.instant("igo.geo.measure.areaHeader"),valueAccessor:ot=>{const lt=this.activeAreaUnit,Me=(0,V.Ej)(ot.properties.measure.area,lt);return Me?(0,V.wP)(Me,{decimal:1,unit:lt,unitAbbr:!1,locale:"fr"}):""}}]}}ngOnInit(){this.getSavedUnits(),this.initStore(),this.createDrawLineControl(),this.createDrawPolygonControl(),this.createModifyControl(),this.toggleDrawControl(),this.updateTooltipsOfOlSource(this.store.source.ol),this.checkDistanceAreaToggle(),this.setActiveMeasureType(X.gn.Length)}ngOnDestroy(){this.setActiveMeasureType(void 0),this.deactivateModifyControl(),this.freezeStore(),this.subscriptions$$.map(_e=>_e.unsubscribe())}onMeasureTypeChange(_e){this.activeMeasureType=_e}onToggleDrawControl(_e){!0===_e?this.toggleDrawControl():this.deactivateDrawControl()}onToggleMeasureUnitsAuto(_e){this.measureUnitsAuto=_e}onToggleDisplayDistance(_e){this.displayDistance=_e,this.onDisplayDistance(),this.storageService.set("distanceToggle",!!_e,y.Ab.SESSION)}onToggleDisplayLines(_e){this.displayLines=_e,this.onDisplayLines(),this.storageService.set("linesToggle",!!_e,y.Ab.SESSION)}onToggleDisplayAreas(_e){this.displayAreas=_e,this.onDisplayAreas(),this.storageService.set("areasToggle",!!_e,y.Ab.SESSION)}checkDistanceAreaToggle(){!1===this.storageService.get("distanceToggle")&&(this.displayDistance=!1),!1===this.storageService.get("linesToggle")&&(this.displayLines=!1),!1===this.storageService.get("areasToggle")&&(this.displayAreas=!1)}onDisplayDistance(){const _e=this.document.getElementsByClassName("igo-map-tooltip-measure-polygone-segments");this.displayDistance?Array.from(_e).map(Ie=>Ie.classList.remove("igo-map-tooltip-hidden")):Array.from(_e).map(Ie=>Ie.classList.add("igo-map-tooltip-hidden"))}onDisplayLines(){const _e=this.document.getElementsByClassName("igo-map-tooltip-measure-line-segments");this.displayLines?Array.from(_e).map(Ie=>{Ie.classList.remove("igo-map-tooltip-hidden")}):Array.from(_e).map(Ie=>{Ie.classList.add("igo-map-tooltip-hidden")})}onDisplayAreas(){const _e=this.document.getElementsByClassName("igo-map-tooltip-measure-area");this.displayAreas?Array.from(_e).map(Ie=>Ie.classList.remove("igo-map-tooltip-hidden")):Array.from(_e).map(Ie=>Ie.classList.add("igo-map-tooltip-hidden"))}onLengthUnitChange(_e){this.activeLengthUnit=_e,this.saveCurrentUnits(),this.refreshTableAndTooltip()}onAreaUnitChange(_e){this.activeAreaUnit=_e,this.saveCurrentUnits(),this.refreshTableAndTooltip()}refreshTableAndTooltip(){this.store.stateView.clear(),this.updateTooltipsOfOlSource(this.store.source.ol),void 0!==this.activeOlGeometry&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)}onCalculateClick(){const _e=this.selectedFeatures$.value,Ie=_e.reduce((ot,lt)=>ot+lt.properties.measure.area||0,0),je=_e.reduce((ot,lt)=>"Polygon"===lt.geometry.type?ot:ot+lt.properties.measure.length||0,0),Ve=_e.reduce((ot,lt)=>"LineString"===lt.geometry.type?ot:ot+lt.properties.measure.length||0,0);this.openDialog({area:Ie,length:je,perimeter:Ve})}onDeleteClick(){this.store.deleteMany(this.selectedFeatures$.value),this.selectedFeatures$.value.forEach(_e=>{this.olDrawSource.getFeatures().forEach(Ie=>{const je=Ie.getGeometry();_e.properties.id===je.ol_uid&&this.olDrawSource.removeFeature(Ie)})})}onModifyClick(){if(1===this.selectedFeatures$.value.length)if(!0===this.modifyControl.active)this.deactivateModifyControl(),this.toggleDrawControl();else{const _e=this.selectedFeatures$.value[0],je=this.store.layer.ol.getSource().getFeatures().find(Ve=>Ve.get("id")===_e.properties.id);if(void 0!==je){this.deactivateDrawControl(),this.activateModifyControl();const Ve=je.getGeometry();this.clearTooltipsOfOlGeometry(Ve),this.modifyControl.setOlGeometry(Ve)}}}openDialog(_e){this.dialog.open(D,{data:_e})}initStore(){const _e=this.store,Ie=new Z.Md({title:this.languageService.translate.instant("igo.geo.measure.layerTitle"),isIgoInternalLayer:!0,id:`igo-measures-${(0,O.uq)()}`,zIndex:200,source:new W.EB,style:(0,V.wr)(),showInLayerList:!0,exportable:!0,browsable:!1,workspace:{enabled:!1}});(0,w.mM)(_e,Ie),_e.layer.visible=!0,Ie.visible$.subscribe(je=>{const Ve=this.document.getElementsByClassName("igo-map-tooltip-measure");je?Array.from(Ve).map(ot=>ot.classList.remove("igo-map-tooltip-measure-by-display")):Array.from(Ve).map(ot=>ot.classList.add("igo-map-tooltip-measure-by-display"))}),(0,w.sf)(_e),(0,w.Uz)(_e,new w.kj({map:this.map,many:!0})),this.onFeatureAddedKey=_e.source.ol.on("addfeature",je=>{const Ve=je.feature,ot=Ve.getGeometry();this.updateMeasureOfOlGeometry(ot,Ve.get("measure")),this.onDisplayDistance(),this.onDisplayLines(),this.onDisplayAreas()}),this.onFeatureRemovedKey=_e.source.ol.on("removefeature",je=>{const Ve=je.feature.getGeometry();this.clearTooltipsOfOlGeometry(Ve)}),this.selectedFeatures$$=_e.stateView.manyBy$(je=>!0===je.state.selected).pipe((0,k.s)(1)).subscribe(je=>{!0===this.modifyControl.active&&this.deactivateModifyControl(),this.selectedFeatures$.next(je.map(Ve=>Ve.entity))}),this.subscriptions$$.push(this.store.entities$.subscribe(je=>{je.find(Ve=>"Polygon"===Ve.geometry.type)?this.hasArea$.next(!0):this.hasArea$.next(!1),je.find(Ve=>"LineString"===Ve.geometry.type)?this.hasLine$.next(!0):this.hasLine$.next(!1)})),this.subscriptions$$.push(this.store.count$.subscribe(je=>{this.store.layer.options.showInLayerList=je>=1}))}freezeStore(){const _e=this.store;this.selectedFeatures$$.unsubscribe(),(0,x.S)(this.onFeatureAddedKey),(0,x.S)(this.onFeatureRemovedKey),_e.deactivateStrategyOfType(w.E9),_e.deactivateStrategyOfType(w.kj)}createDrawLineControl(){this.drawLineControl=new te.i4({geometryType:"LineString",drawingLayerSource:this.olDrawSource,interactionStyle:(0,V.yK)(),drawingLayerStyle:new F.cp({})})}createDrawPolygonControl(){this.drawPolygonControl=new te.i4({geometryType:"Polygon",drawingLayerSource:this.olDrawSource,interactionStyle:(0,V.yK)(),drawingLayerStyle:new F.cp({})})}createModifyControl(){this.modifyControl=new te.Up({source:this.olDrawSource,drawStyle:(0,V.yK)(),layerStyle:new F.cp({})})}toggleDrawControl(){this.deactivateDrawControl(),this.activeMeasureType===X.gn.Length?this.activateDrawControl(this.drawLineControl):this.activeMeasureType===X.gn.Area&&this.activateDrawControl(this.drawPolygonControl)}activateDrawControl(_e){this.drawControlIsDisabled=!1,this.activeDrawControl=_e,this.drawStart$$=_e.start$.subscribe(Ie=>this.onDrawStart(Ie)),this.drawEnd$$=_e.end$.subscribe(Ie=>this.onDrawEnd(Ie)),this.drawChanges$$=_e.changes$.subscribe(Ie=>this.onDrawChanges(Ie)),this.drawChanges$$=_e.abort$.subscribe(Ie=>{this.clearTooltipsOfOlGeometry(Ie),this.clearMeasures()}),_e.setOlMap(this.map.ol,!1)}deactivateDrawControl(){void 0!==this.activeDrawControl&&(this.olDrawSource.clear(),void 0!==this.drawStart$$&&this.drawStart$$.unsubscribe(),void 0!==this.drawEnd$$&&this.drawEnd$$.unsubscribe(),void 0!==this.drawChanges$$&&this.drawChanges$$.unsubscribe(),this.clearTooltipsOfOlSource(this.olDrawSource),void 0!==this.activeOlGeometry&&this.clearTooltipsOfOlGeometry(this.activeOlGeometry),this.activeDrawControl.setOlMap(void 0),this.activeDrawControl=void 0,this.activeOlGeometry=void 0)}setActiveMeasureType(_e){this._activeMeasureType=_e,this.clearMeasures(),this.toggleDrawControl()}onDrawStart(_e){this.activeOlGeometry=_e}onDrawEnd(_e){this.activeOlGeometry=void 0,this.finalizeMeasureOfOlGeometry(_e),this.addFeatureToStore(_e),this.clearTooltipsOfOlGeometry(_e),this.olDrawSource.clear(!0)}onDrawChanges(_e){const Ie=(0,V.ox)(_e,this.projection);this.updateMeasureOfOlGeometry(_e,Object.assign({},Ie,{area:void 0})),this.measure$.next(Ie)}activateModifyControl(){const _e=this.store.getStrategyOfType(w.kj);_e.deactivate(),_e.clear(),this.modifyStart$$=this.modifyControl.start$.subscribe(Ie=>this.onModifyStart(Ie)),this.modifyEnd$$=this.modifyControl.end$.subscribe(Ie=>this.onModifyEnd(Ie)),this.modifyChanges$$=this.modifyControl.changes$.subscribe(Ie=>this.onModifyChanges(Ie)),this.modifyControl.setOlMap(this.map.ol)}deactivateModifyControl(){void 0!==this.modifyStart$$&&this.modifyStart$$.unsubscribe(),void 0!==this.modifyEnd$$&&this.modifyEnd$$.unsubscribe(),void 0!==this.modifyChanges$$&&this.modifyChanges$$.unsubscribe(),void 0!==this.activeOlGeometry&&(1===this.selectedFeatures$.value.length&&this.addFeatureToStore(this.activeOlGeometry,this.selectedFeatures$.value[0]),this.finalizeMeasureOfOlGeometry(this.activeOlGeometry)),this.olDrawSource.clear(),this.store.activateStrategyOfType(w.kj),this.activeOlGeometry=void 0,this.modifyControl.setOlMap(void 0)}onModifyStart(_e){this.onDrawStart(_e)}onModifyChanges(_e){this.onDrawChanges(_e)}onModifyEnd(_e){this.finalizeMeasureOfOlGeometry(_e)}finalizeMeasureOfOlGeometry(_e){const Ie=(0,V.ox)(_e,this.projection);this.updateMeasureOfOlGeometry(_e,Ie)}updateMeasureOfOlGeometry(_e,Ie){_e.setProperties({_measure:Ie},!0),this.updateTooltipsOfOlGeometry(_e)}clearMeasures(){this.measure$.next({})}addFeatureToStore(_e,Ie){const je=Ie?Ie.properties.id:_e.ol_uid,Ve=this.map.ol.getView().getProjection(),ot=(new T.c).writeGeometryObject(_e,{featureProjection:Ve,dataProjection:Ve});this.store.update({type:w.Yf,geometry:ot,projection:Ve.getCode(),properties:{id:je,measure:_e.get("_measure")},meta:{id:je}})}updateTooltipsOfOlGeometry(_e){const Ie=_e.get("_measure"),je=Ie.lengths,Ve=Ie.area,ot=(0,V.Og)(_e);if(je.length===ot.length)for(let lt=0;lt<ot.length;lt++){const Me=je[lt];void 0!==Me&&this.updateOlTooltip(ot[lt],(0,V.iK)(Me,this.activeLengthUnit),this.activeLengthUnit,X.gn.Length)}void 0!==Ve&&this.updateOlTooltip((0,V.IP)(_e),(0,V.Ej)(Ve,this.activeAreaUnit),this.activeAreaUnit,X.gn.Area)}showTooltipsOfOlGeometry(_e){(0,V.aK)(_e).forEach(Ie=>{this.shouldShowTooltip(Ie)&&this.map.ol.addOverlay(Ie)})}clearTooltipsOfOlGeometry(_e){(0,V.aK)(_e).forEach(Ie=>{void 0!==Ie&&void 0!==Ie.getMap()&&this.map.ol.removeOverlay(Ie)})}updateTooltipsOfOlSource(_e){_e.forEachFeature(Ie=>{this.updateTooltipsOfOlGeometry(Ie.getGeometry())})}showTooltipsOfOlSource(_e){_e.forEachFeature(Ie=>{this.showTooltipsOfOlGeometry(Ie.getGeometry())})}clearTooltipsOfOlSource(_e){_e.forEachFeature(Ie=>{void 0!==Ie.getGeometry()&&this.clearTooltipsOfOlGeometry(Ie.getGeometry())})}updateOlTooltip(_e,Ie,je,Ve){_e.setProperties({_measure:Ie,_unit:je,_type:Ve},!0),_e.getElement().innerHTML=this.computeTooltipInnerHTML(_e),this.shouldShowTooltip(_e)&&this.map.ol.addOverlay(_e)}computeTooltipInnerHTML(_e){const Ie=_e.getProperties();return(0,V.wP)(Ie._measure,{decimal:1,unit:Ie._unit,unitAbbr:!0,locale:"fr"},this.languageService)}shouldShowTooltip(_e){if(!1===this.showTooltips)return!1;const Ie=_e.getProperties(),je=Ie._measure;if(void 0===je)return!1;if(Ie._unit===X.gn.Length){const Ve=(0,V.iK)(this.minSegmentLength,Ie._unit)||0;return je>Math.max(Ve,0)}return!0}saveCurrentUnits(){this.storageService.set("distanceUnit",this.activeLengthUnit,y.Ab.SESSION),this.storageService.set("areaUnit",this.activeAreaUnit,y.Ab.SESSION)}getSavedUnits(){const _e=this.storageService.get("distanceUnit"),Ie=this.storageService.get("areaUnit");this.activeLengthUnit=_e||this.activeLengthUnit,this.activeAreaUnit=Ie||this.activeAreaUnit}static \u0275fac=function(Ie){return new(Ie||Ae)(c.GI1(R.ov),c.GI1(B.qW),c.GI1(y.yQ),c.GI1(C.Ud))};static \u0275cmp=c.In1({type:Ae,selectors:[["igo-measurer"]],viewQuery:function(Ie,je){if(1&Ie&&c.CC$(de,7),2&Ie){let Ve;c.wto(Ve=c.Gqi())&&(je.table=Ve.first)}},inputs:{map:"map",store:"store",activeMeasureType:"activeMeasureType",minSegmentLength:"minSegmentLength"},standalone:!0,features:[c.UHJ],decls:43,vars:60,consts:[[1,"measure-type-toggle","mat-typography"],[3,"value","change"],[3,"value"],[1,"measure-options","mat-typography"],[3,"disabled","checked","labelPosition","change"],[4,"ngIf"],[3,"checked","labelPosition","change",4,"ngIf"],[3,"checked","labelPosition","change"],[1,"measure-store-buttons"],["mat-icon-button","","color","accent",3,"matTooltip","disabled","click",4,"ngIf"],["mat-icon-button","","color","warn",3,"matTooltip","disabled","click",4,"ngIf"],[1,"table-compact",3,"store","template"],["table",""],[3,"measureType","measureUnit","measure","auto","placeholder","measureUnitChange",4,"ngIf"],[3,"measureType","measureUnit","measure","auto","placeholder","measureUnitChange"],["mat-icon-button","","color","accent",3,"matTooltip","disabled","click"],["mat-icon-button","","color","warn",3,"matTooltip","disabled","click"]],template:function(Ie,je){1&Ie&&(c.I0R(0,"div")(1,"div",0)(2,"mat-button-toggle-group",1),c.qCj("change",function(ot){return je.onMeasureTypeChange(ot.value)}),c.I0R(3,"mat-button-toggle",2),c.OEk(4),c.wVc(5,"translate"),c.C$Y(),c.I0R(6,"mat-button-toggle",2),c.OEk(7),c.wVc(8,"translate"),c.C$Y()()(),c.I0R(9,"div",3)(10,"mat-slide-toggle",4),c.qCj("change",function(ot){return je.onToggleDrawControl(ot.checked)}),c.OEk(11),c.wVc(12,"translate"),c.C$Y(),c.yuY(13,fe,1,0,"mat-divider",5),c.wVc(14,"async"),c.yuY(15,Se,3,5,"mat-slide-toggle",6),c.wVc(16,"async"),c.yuY(17,ae,1,0,"mat-divider",5),c.wVc(18,"async"),c.wVc(19,"async"),c.yuY(20,le,3,5,"mat-slide-toggle",6),c.wVc(21,"async"),c.yuY(22,oe,3,5,"mat-slide-toggle",6),c.wVc(23,"async"),c.yuY(24,se,1,0,"mat-divider",5),c.wVc(25,"async"),c.I0R(26,"mat-slide-toggle",7),c.qCj("change",function(ot){return je.onToggleMeasureUnitsAuto(ot.checked)}),c.OEk(27),c.wVc(28,"translate"),c.C$Y()(),c.yuY(29,ke,3,2,"ng-container",5),c.wVc(30,"async"),c.yuY(31,qe,1,0,"mat-divider",5),c.wVc(32,"async"),c.wVc(33,"async"),c.I0R(34,"div",8),c.yuY(35,nt,5,6,"button",9),c.wVc(36,"async"),c.wVc(37,"async"),c.yuY(38,Ue,5,6,"button",10),c.wVc(39,"async"),c.wVc(40,"async"),c.C$Y(),c.wR5(41,"igo-entity-table",11,12),c.C$Y()),2&Ie&&(c.yG2(2),c.E7m("value",je.activeMeasureType),c.yG2(),c.E7m("value",je.measureType.Length),c.yG2(),c.oRS(" ",c.kDX(5,24,"igo.geo.measure."+je.measureType.Length)," "),c.yG2(2),c.E7m("value",je.measureType.Area),c.yG2(),c.oRS(" ",c.kDX(8,26,"igo.geo.measure."+je.measureType.Area)," "),c.yG2(3),c.E7m("disabled",je.drawControlIsDisabled)("checked",je.drawControlIsActive)("labelPosition","before"),c.yG2(),c.oRS(" ",c.kDX(12,28,"igo.geo.measure.toggleActive")," "),c.yG2(2),c.E7m("ngIf",c.kDX(14,30,je.hasLine$)),c.yG2(2),c.E7m("ngIf",c.kDX(16,32,je.hasLine$)),c.yG2(2),c.E7m("ngIf",c.kDX(18,34,je.hasLine$)||c.kDX(19,36,je.hasArea$)),c.yG2(3),c.E7m("ngIf",c.kDX(21,38,je.hasArea$)),c.yG2(2),c.E7m("ngIf",c.kDX(23,40,je.hasArea$)),c.yG2(2),c.E7m("ngIf",c.kDX(25,42,je.hasArea$)),c.yG2(2),c.E7m("checked",je.measureUnitsAuto)("labelPosition","before"),c.yG2(),c.oRS(" ",c.kDX(28,44,"igo.geo.measure.toggleAutoUnits")," "),c.yG2(2),c.E7m("ngIf",c.kDX(30,46,je.measure$)),c.yG2(2),c.E7m("ngIf",c.kDX(32,48,je.hasLine$)||c.kDX(33,50,je.hasArea$)),c.yG2(4),c.E7m("ngIf",c.kDX(36,52,je.hasLine$)||c.kDX(37,54,je.hasArea$)),c.yG2(3),c.E7m("ngIf",c.kDX(39,56,je.hasLine$)||c.kDX(40,58,je.hasArea$)),c.yG2(3),c.E7m("store",je.store)("template",je.tableTemplate))},dependencies:[d.ue,d.gn,d.KU,o.GE,o.cP,C.u_,L.U,L.k,ie,e.oJ,e.um,f.KO,f.a4,P.oB,P.qL,h.Eh,C.a,R._s,I.sD],styles:["[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .measure-store-buttons[_ngcontent-%COMP%]{margin-left:-2px}[_nghost-%COMP%]   .measure-store-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-of-type{margin-left:14px}[_nghost-%COMP%]   .table-compact[_ngcontent-%COMP%]     .mat-mdc-header-cell.mat-column-selectionCheckbox{width:52px}[_nghost-%COMP%]   .igo-map-tooltip[_ngcontent-%COMP%]{position:relative;border-radius:4px;padding:4px 8px;white-space:nowrap}  .igo-map-tooltip-hidden, .igo-map-tooltip-measure-by-display[_ngcontent-%COMP%]{display:none}"],changeDetection:0})}return Ae})()},45076:(Fe,ce,r)=>{"use strict";r.d(ce,{K8:()=>C.K8,aK:()=>e.aK,cD:()=>e.cD,ie:()=>e.ie,ox:()=>e.ox,wP:()=>e.wP});var C=r(69904),e=r(8512)},69904:(Fe,ce,r)=>{"use strict";r.d(ce,{K8:()=>d,Ks:()=>L,Mh:()=>P,gn:()=>e,kK:()=>o});var e=function(f){return f.Length="length",f.Area="area",f}(e||{}),d=function(f){return f.Meters="meters",f.Kilometers="kilometers",f.Miles="miles",f.Feet="feet",f}(d||{});const L={[d.Meters]:"m",[d.Kilometers]:"km",[d.Miles]:"mi",[d.Feet]:"ft"};var P=function(f){return f.SquareMeters="squareMeters",f.SquareKilometers="squareKilometers",f.SquareMiles="squareMiles",f.SquareFeet="squareFeet",f.Hectares="hectares",f.Acres="acres",f}(P||{});const o={[P.SquareMeters]:"m\xb2",[P.SquareKilometers]:"km\xb2",[P.SquareMiles]:"mi\xb2",[P.SquareFeet]:"ft\xb2",[P.Hectares]:"ha",[P.Acres]:"ac"}},8512:(Fe,ce,r)=>{"use strict";r.d(ce,{AX:()=>B,Ej:()=>K,Gs:()=>V,IP:()=>de,Og:()=>H,aK:()=>Se,aS:()=>b,cD:()=>I,iK:()=>Z,ie:()=>D,ox:()=>G,wP:()=>X,wr:()=>c,yK:()=>z});var C=r(28276),e=r(94448),d=r(28668),L=r(62808),P=r(80848),o=r(36752),f=r(49412),h=r(54776),R=r(45212),y=r(88872),O=r(87544),x=r(69904);function T(le){return.001*le}function a(le){return 3.2808*le}function F(le){return 621e-6*le}function A(le){return 1e-6*le}function k(le){return 3.861e-7*le}function W(le){return 10.764*le}function w(le){return 1e-4*le}function te(le){return 24711e-8*le}function Z(le,oe){const me=new Map([[x.K8.Meters,be=>be],[x.K8.Kilometers,T],[x.K8.Miles,F],[x.K8.Feet,a]]).get(oe);return me?me(le):void 0}function K(le,oe){const me=new Map([[x.Mh.SquareMeters,be=>be],[x.Mh.SquareKilometers,A],[x.Mh.SquareMiles,k],[x.Mh.SquareFeet,W],[x.Mh.Hectares,w],[x.Mh.Acres,te]]).get(oe);return me?me(le):void 0}function X(le,oe,se){let me=oe.decimal;(void 0===me||me<0)&&(me=1);const be=[];return be.push(void 0!==oe.locale?le.toLocaleString(oe.locale,{minimumFractionDigits:me,maximumFractionDigits:me}):le.toFixed(me).toString()),void 0!==oe.unit&&!0===oe.unitAbbr&&be.push(se?se.translate.instant(x.Ks[oe.unit]?"igo.geo.measure."+x.Ks[oe.unit]:"igo.geo.measure."+x.kK[oe.unit]):x.Ks[oe.unit]||x.kK[oe.unit]),be.filter(ke=>void 0!==ke).join(" ")}function V(le){let oe=x.K8.Meters,se=le;const me=[x.K8.Kilometers];for(;se>1e3&&me.length>0;)oe=me.pop(),se=Z(le,oe);return oe}function B(le){let oe=x.Mh.SquareMeters,se=le;const me=[x.Mh.SquareKilometers];for(;se>1e6&&me.length>0;)oe=me.pop(),se=K(le,oe);return oe}function z(){return new h.cp({stroke:new R.c({color:"#ffcc33",lineDash:[10,10],width:2}),fill:new y.c({color:"rgba(255, 255, 255, 0.2)"}),image:new O.c({radius:5,stroke:new R.c({color:"#ffcc33"}),fill:new y.c({color:"rgba(255, 255, 255, 0.2)"})})})}function c(){return new h.cp({stroke:new R.c({color:"#ffcc33",width:2}),fill:new y.c({color:"rgba(255, 255, 255, 0.2)"})})}function I(le,oe){if(!(le instanceof P.c)&&0!==le.getFlatCoordinates().length)return(0,f.S2)(le,{projection:oe})}function b(le,oe){if(!(le instanceof P.c||le instanceof L.c)&&0!==le.getFlatCoordinates().length)return(0,f.kh)(le,{projection:oe})}function G(le,oe){const se=I(le,oe),me=b(le,oe),be=[],ke=le.getFlatCoordinates(),qe=ke.length;for(let nt=0;nt<=qe-4;nt+=2){const Ue=new L.c([[ke[nt],ke[nt+1]],[ke[nt+2],ke[nt+3]]]);be.push(I(Ue,oe))}return{area:me,length:se,lengths:be}}function D(le){let oe;if(le instanceof P.c){const se=new P.c(le.getFlatCoordinates());oe=new Array(1),oe[0]=se}else{oe=U(le);const se=le.getFlatCoordinates(),me=oe.length;for(let be=0;be<me;be++){const ke=2*be,nt=new L.c([[se[ke],se[ke+1]],[se[ke+2],se[ke+3]]]).getCoordinateAt(.5),Ue=oe[be];void 0!==Ue?Ue.setCoordinates(nt):oe[be]=new P.c(nt)}}return oe}function U(le){let oe;oe=le instanceof d.c?0:Math.max(le.getFlatCoordinates().length/2-1,0);let se=le.get("_midpoints");if(void 0===se)return se=new Array(le instanceof P.c?1:oe),le.set("_midpoints",se,!0),se;if(0===oe||oe===se.length)return se;if(oe>se.length)return se.push(...new Array(oe-se.length)),se;for(let me=oe;me<se.length;me++){const be=se[oe];void 0!==be&&M(be)}return se.splice(oe),se}function M(le){const oe=le.get("_tooltip");if(void 0!==oe){const se=oe.getMap();void 0!==se&&se.removeOverlay(oe)}}function H(le){const oe=D(le);let se="";return le instanceof L.c?se="line-":le instanceof o.cp&&(se="polygone-"),oe.map(be=>{let ke=be.get("_tooltip");return void 0===ke?ke=ae(be,!1,se):ke.setPosition(be.getFlatCoordinates()),ke})}function de(le){const oe=function ie(le){let oe=le.get("_center");const se=(0,e.Ks)(le.getExtent());return void 0!==oe?oe.setCoordinates(se):(oe=new P.c(se),le.set("_center",oe)),oe}(le);let se=oe.get("_tooltip");return void 0===se?se=ae(oe,!0):se.setPosition(oe.getFlatCoordinates()),se}function Se(le){const oe=[].concat(function s(le){return U(le).map(se=>se?se.get("_tooltip"):void 0)}(le)||[]),se=function fe(le){const oe=le.get("_center");return oe?oe.get("_tooltip"):void 0}(le);return void 0!==se&&oe.push(se),oe}function ae(le,oe=!1,se=""){const me=new C.c({element:document.createElement("div"),offset:[-30,-10],className:(oe?["igo-map-tooltip","igo-map-tooltip-measure","igo-map-tooltip-measure-area"]:["igo-map-tooltip","igo-map-tooltip-measure",`igo-map-tooltip-measure-${se}segments`]).join(" "),stopEvent:!1});return me.setPosition(le.getFlatCoordinates()),le.set("_tooltip",me),me}},96659:(Fe,ce,r)=>{"use strict";r.d(ce,{G:()=>C});var C=function(e){return e.System="system",e.User="user",e}(C||{})},31112:(Fe,ce,r)=>{"use strict";r.d(ce,{U:()=>y});var C=r(43168),e=r(96832),d=r(61616),L=r(1296),P=r(83680),o=r(10211),f=r(40604),h=r(37496),R=r(34896);let y=(()=>{class O{ngxIndexedDBService;dbName="geoData";collisionsMap=new Map;_newData=0;compression=new C.C3;constructor(T){this.ngxIndexedDBService=T}update(T,a,F,A,k){if(!F)return;let W=!1;const w=new d.E;let Z,te=(0,L.of)(F);return F instanceof Blob&&(te=this.compression.compressBlob(F),W=!0),te.pipe((0,P.K)(),(0,o.m)(K=>(Z={url:T,regionID:a,object:K,compressed:W,insertSource:A,insertEvent:k},this.ngxIndexedDBService.getByID(this.dbName,T))),(0,o.m)(K=>{if(K){const X=K.regionID;if(X!==a){const V=this.collisionsMap.get(X);void 0!==V?(V.push(K.url),this.collisionsMap.set(X,V)):this.collisionsMap.set(X,[K.url])}return this.customUpdate(Z)}return this._newData++,this.ngxIndexedDBService.add(this.dbName,Z)})).subscribe(K=>{w.next(K),w.complete()}),w}customUpdate(T){const a=new d.E;return this.ngxIndexedDBService.deleteByKey(this.dbName,T.url).pipe((0,o.m)(A=>A?this.ngxIndexedDBService.add(this.dbName,T):(0,L.of)(void 0))).subscribe(A=>{A&&a.next(A),a.complete()}),a}get(T){return this.ngxIndexedDBService.getByID(this.dbName,T).pipe((0,f.k)(a=>{if(a){const F=a.object;return a.compressed?this.compression.decompressBlob(F):F}}))}getByID(T){return this.ngxIndexedDBService.getByID(this.dbName,T)}deleteByKey(T){return this.ngxIndexedDBService.deleteByKey(this.dbName,T)}getRegionCountByID(T){const a=new d.E;return this.getRegionByID(T).subscribe(A=>{a.next(A.length),a.complete()}),a}getRegionByID(T){if(!T)return;const a=IDBKeyRange.only(T);return this.ngxIndexedDBService.getAllByIndex(this.dbName,"regionID",a)}deleteByRegionID(T){if(!T)return;const a=IDBKeyRange.only(T),F=this.ngxIndexedDBService.getAllByIndex(this.dbName,"regionID",a);return F.subscribe(A=>{A.forEach(k=>{this.ngxIndexedDBService.deleteByKey(this.dbName,k.url)})}),F}openCursor(T=IDBKeyRange.lowerBound(0),a=e.aI.readonly){return this.ngxIndexedDBService.openCursorByIndex(this.dbName,"regionID",T,a)}resetCounters(){this.resetCollisionsMap(),this._newData=0}resetCollisionsMap(){this.collisionsMap=new Map}revertCollisions(){for(const[T,a]of this.collisionsMap)for(const F of a)this.ngxIndexedDBService.getByKey(this.dbName,F).pipe((0,h.U)(1)).subscribe(A=>{A.regionID=T,this.customUpdate(A)})}get newData(){return this._newData}static \u0275fac=function(a){return new(a||O)(R.CoB(e.aQ))};static \u0275prov=R.wxM({token:O,factory:O.\u0275fac,providedIn:"root"})}return O})()},39532:(Fe,ce,r)=>{"use strict";r.d(ce,{U:()=>o});var C=r(39882),e=r(31112),d=r(34896),L=r(33712);let o=(()=>{class f{http;geoDBService;networkService;networkOnline=!0;constructor(R,y,O){this.http=R,this.geoDBService=y,this.networkService=O,this.networkService.currentState().subscribe(x=>{this.networkOnline=x.connection})}get(R,y){return window.navigator.onLine&&this.networkOnline?this.getOnline(R,y):this.getOffline(R)}getOnline(R,y){let O;switch(y.responseType){case"arraybuffer":O=this.http.get(R,{responseType:"arraybuffer",withCredentials:y.withCredentials});break;case"text":O=this.http.get(R,{responseType:"text",withCredentials:y.withCredentials});break;case"json":O=this.http.get(R,{responseType:"json",withCredentials:y.withCredentials});break;default:O=this.http.get(R,{responseType:"blob",withCredentials:y.withCredentials})}return O}getOffline(R){return this.geoDBService.get(R)}isOnline(){return this.networkOnline&&window.navigator.onLine}static \u0275fac=function(y){return new(y||f)(d.CoB(L.KK),d.CoB(e.U),d.CoB(C.u))};static \u0275prov=d.wxM({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()},36404:(Fe,ce,r)=>{"use strict";r.d(ce,{m:()=>d});var C=r(76572),e=r(25607);class d{map;layer;get dataSource(){return this.layer.dataSource}constructor(P){this.layer=(0,e.c)(),this.setMap(P)}setMap(P){void 0===P?void 0!==this.map&&this.map.ol.removeLayer(this.layer.ol):P.ol.addLayer(this.layer.ol),this.map=P}setFeatures(P,o=C.Su.Default,f){if(f)for(const h of this.dataSource.ol.getFeatures())h.get("_sourceId")===f&&this.removeOlFeature(h);else this.clear();this.addFeatures(P,o)}addFeature(P,o=C.Su.Default){this.addFeatures([P],o)}addFeatures(P,o=C.Su.Default){const f=[];P.forEach(h=>{const R=(0,C.K6)(h,this.map.projection);null!==R.getGeometry()&&f.push(R)}),this.addOlFeatures(f,o)}addOlFeature(P,o=C.Su.Default){this.addOlFeatures([P],o)}addOlFeatures(P,o=C.Su.Default){this.dataSource.ol.addFeatures(P),(0,C.QX)(this.map.viewController,P,o)}removeFeature(P){this.removeFeatures([P])}removeFeatures(P){P.forEach(o=>{o.meta&&this.dataSource.ol.getFeatureById(o.meta.id)&&this.removeOlFeature(this.dataSource.ol.getFeatureById(o.meta.id))})}removeOlFeature(P){this.dataSource.ol.removeFeature(P)}clear(){this.dataSource.ol.clear()}}},25607:(Fe,ce,r)=>{"use strict";r.d(ce,{c:()=>L});var C=r(3544),e=r(2892),d=r(52756);function L(){const P=new C.EB;return new e.M({title:"Overlay",zIndex:300,source:P,style:(0,d.I)()})}},29272:(Fe,ce,r)=>{"use strict";r.d(ce,{K:()=>V});var C=r(35392),e=r(53e3),d=r(23302),L=r(9204),P=r(24708),o=r(93020),f=r(43168),h=r(16772),R=r(96116),y=r.n(R),O=r(864),x=r(97104),T=r.n(x),a=r(61616),F=r(21296),A=r(44816),k=r(40604),w=r(59324);function te(B){const z=function(c,I){const b=c.join(" "),G=I[0],D=I[2],g=I[1],U=I[3],M=[U,G,g,G,g,D,U,D].join(" "),H=this.internal.newAdditionalObject(),s=this.internal.newAdditionalObject(),ie=this.internal.newAdditionalObject();ie.content='<< /EPSG 3857 /Type /PROJCS /WKT (PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.017453292519943295]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",0.0],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]) >>',s.content="<< /Bounds [ 0 1 0 0 1 0 1 1 ] /GCS "+ie.objId+" 0 R /GPTS [ "+M+" ] /LPTS [ 0 1 0 0 1 0 1 1 ] /Subtype /GEO /Type /Measure >>",H.content="<< /BBox [ "+b+" ] /Measure "+s.objId+" 0 R /Name (Layer) /Type /Viewport >>";const de=this.internal.newAdditionalObject(),fe=(new Date).toLocaleDateString("en-CA");return de.content="<< /Name IGO2 /Type /OCG /Date "+fe+" >>",H.objId};B.setGeoArea=function(c,I){this.internal.events.subscribe("putPage",function(){const b=z.call(this,c,I);this.internal.write("/VP [ "+b+" 0 R ]")})}}var Z=r(47580),K=r(34896),X=r(33712);let V=(()=>{class B{http;messageService;activityService;languageService;configService;zipFile;nbFileToProcess;activityId;imgSizeAdded;mapPrintExtent;TEXTPDFFONT={titleFont:"Sans Serif",titleFontStyle:"bold",subtitleFont:"Sans Serif",subtitleFontStyle:"bold",commentFont:"Sans Serif",commentFontStyle:"normal",commentFontSize:12};constructor(c,I,b,G,D){this.http=c,this.messageService=I,this.activityService=b,this.languageService=G,this.configService=D}print(c,I){var b=this;const G=new a.E,D=I.paperFormat,g=+I.resolution,U=I.orientation,M=I.legendPosition;this.activityId=this.activityService.register(),te(O.default.API);const H=new O.default({orientation:U,format:D.toLowerCase(),unit:"mm"}),s=[H.internal.pageSize.width,H.internal.pageSize.height],ie=[10,10,10,10],fe=s[1]-ie[0]-ie[2],Se=[s[0]-ie[3]-ie[1],fe];let ae,le;(""!==I.title||""!==I.subtitle)&&(D===Z.QH.A1||D===Z.QH.A0)&&(ie[0]+=10);const oe=Math.round(2*(fe+145)*.05)/2;return void 0!==I.title&&""!==I.title&&(ae=this.getTextPdfObjectSizeAndMarg(I.title,ie,this.TEXTPDFFONT.titleFont,oe,this.TEXTPDFFONT.titleFontStyle,H),this.addTextInPdfDoc(H,I.title,this.TEXTPDFFONT.titleFont,this.TEXTPDFFONT.titleFontStyle,ae.fontSize,ae.marginLeft+ie[3],ie[0]),ie[0]=ae.height+ie[0]),void 0!==I.subtitle&&""!==I.subtitle&&(le=this.getTextPdfObjectSizeAndMarg(I.subtitle,ie,this.TEXTPDFFONT.subtitleFont,""!==I.title?.7*ae.fontSize:.7*oe,this.TEXTPDFFONT.subtitleFontStyle,H),this.addTextInPdfDoc(H,I.subtitle,this.TEXTPDFFONT.subtitleFont,this.TEXTPDFFONT.subtitleFontStyle,le.fontSize,le.marginLeft+ie[3],ie[0]),ie[0]+=5),(!0===I.showProjection||!0===I.showScale)&&this.addProjScale(H,c,g,I.showProjection,I.showScale),void 0!==I.comment&&""!==I.comment&&this.addComment(H,I.comment),this.addMap(H,c,g,Se,ie,M).subscribe(function(){var se=(0,C.c)(function*(me){me===f.qM.Done&&(yield b.handleMeasureLayer(H,c,ie),b.addGeoRef(H,b.imgSizeAdded[0],b.imgSizeAdded[1],ie),"none"!==I.legendPosition?["topleft","topright","bottomleft","bottomright"].indexOf(I.legendPosition)>-1?yield b.addLegendSamePage(H,c,ie,g,I.legendPosition):"newpage"===I.legendPosition&&(yield b.addLegend(H,c,ie,g)):yield b.saveDoc(H)),(me===f.qM.Done||me===f.qM.Error)&&(b.activityService.unregister(b.activityId),G.next(f.qM.Done))});return function(me){return se.apply(this,arguments)}}()),G}addGeoRef(c,I,b,G){const g=c.internal.pageSize.getHeight(),U=G[3],M=g-G[0]-b;let H=[U,M,U+I,M+b];for(let s=0;s<H.length;s++)H[s]=this.pdf_units2points(H[s],"mm");c.setGeoArea(H,this.mapPrintExtent)}handleMeasureLayer(c,I,b){var G=this;return(0,C.c)(function*(){if(I.layers.find(D=>D.visible&&D.id.startsWith("igo-measures-"))){let D;const g=I.ol.getOverlayContainer();yield y()(g,{scale:1,backgroundColor:null}).then(U=>{D=U}),G.addCanvas(c,D,b)}})()}getLayersLegendHtml(c,I,b){return new F._(G=>{let D="";const g=function W(B,z){const c=[];for(const I of B){const b=I.options.legendOptions;if(!1===I.visible)continue;const G=I.dataSource.getLegend(void 0,z)||[];for(const D of G)void 0!==D.url&&c.push({title:I.title||"",url:D.url,display:void 0===b?.display||b.display,isInResolutionsRange:I.isInResolutionsRange})}return c}(c.layers,{resolution:c.viewController.getResolution(),extent:c.viewController.getExtent(),projection:c.viewController.getOlProjection().getCode(),size:c.ol.getSize()});if(0===g.filter(M=>!0===M.display).length)return G.next(D),void G.complete();D+='<style media="screen" type="text/css">',D+=".html2canvas-container { width: "+I+"mm !important; height: 2000px !important; }",D+="table.tableLegend {table-layout: auto;}",D+="div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}",D+="</style>",D+='<font size="3" face="Times" >',D+='<div class="styleLegend">',D+='<table class="tableLegend" >';const U=g.filter(M=>M.display&&!0===M.isInResolutionsRange).map(M=>this.getDataImage(M.url).pipe((0,k.k)(H=>{let s="<tr><td>"+M.title.toUpperCase()+"</td></tr>";return s+='<tr><td><img src="'+H+'"></td></tr>',s})));(0,A.y)(U).subscribe(M=>{D=M.reduce((H,s)=>H+s,D),D+="</table>",D+="</div>",G.next(D),G.complete()})})}getDataImage(c){return new e.kd(this.http,this.configService).transform(c)}getLayersLegendImage(c,I="png",b,G){var D=this;return(0,C.c)(function*(){const g=new a.E;let M=yield D.getLayersLegendHtml(c,200,G).toPromise();I=I.toLowerCase(),0===M.length&&(M='<font size="12" face="Courier New" >',M+='<div align="center"><b>NO LEGEND</b></div>');const H=window.document.createElement("div");H.style.position="absolute",H.style.top="0",H.style.zIndex="-1",window.document.body.appendChild(H),H.innerHTML=M,yield D.timeout(1);const s=yield y()(H,{useCORS:!0}).catch(ie=>{console.log(ie)});if(D.removeHtmlElement(H),s){let ie=f.qM.Done;try{b?D.generateCanvaFileToZip(s,"legendImage."+I):D.saveCanvasImageAsFile(s,"legendImage",I)}catch{ie=f.qM.Error}g.next(ie)}return g})()}removeHtmlElement(c){c.parentNode.removeChild(c)}getTextPdfObjectSizeAndMarg(c,I,b,G,D,g){const H=g.internal.pageSize.getWidth()-I[1]-I[3];g.setFont(b,D),g.setFontSize(G);let ie,s=g.getTextDimensions(c);return s.w>H?(ie=0,g.setFontSize(G*=.7),s=g.getTextDimensions(c)):ie=(H-s.w)/2,{fontSize:G,marginLeft:ie,height:s.h}}addComment(c,I){this.addTextInPdfDoc(c,I,this.TEXTPDFFONT.commentFont,this.TEXTPDFFONT.commentFontStyle,this.TEXTPDFFONT.commentFontSize,10,c.internal.pageSize.height-10,!0)}addTextInPdfDoc(c,I,b,G,D,g,U,M=!1){c.setFont(b,G),c.setFontSize(D),M&&(I=c.splitTextToSize(I,c.internal.pageSize.getWidth()-3*g)),c.text(I,g,U)}addProjScale(c,I,b,G,D){const g=this.languageService.translate,s=c.internal.pageSize.height-15;let ie="";if(!0===G&&(ie+=g.instant("igo.geo.printForm.projection")+": "+I.projection),!0===D){!0===G&&(ie+="   ");const de=g.instant("igo.geo.printForm.scale"),fe=I.viewController.getScale(b);ie+=de+": ~ 1 / "+(0,w.rE)(fe)}c.setFont(this.TEXTPDFFONT.commentFont),c.setFontSize(12),c.text(ie,10,s)}addLegend(c,I,b,G){var D=this;return(0,C.c)(function*(){const g=c.internal.pageSize.width,U=yield D.getLayersLegendHtml(I,g,G).toPromise();if(""===U)return yield D.saveDoc(c),!0;const M=window.document.createElement("div");M.style.position="absolute",M.style.top="0",M.style.zIndex="-1",window.document.body.appendChild(M),M.innerHTML=U,yield D.timeout(1);const H=yield y()(M,{useCORS:!0}).catch(s=>{console.log(s)});if(D.removeHtmlElement(M),H){const ie=[25.4*H.width*.85/G,25.4*H.height*.85/G];let de;c.addPage(),de=H.toDataURL("image/png"),c.addImage(de,"PNG",10,10,ie[0],ie[1])}yield D.saveDoc(c)})()}addLegendSamePage(c,I,b,G,D){var g=this;return(0,C.c)(function*(){const U=c.internal.pageSize.width,M=yield g.getLayersLegendHtml(I,U,G).toPromise();if(""===M)return yield g.saveDoc(c),!0;const H=window.document.createElement("div");H.style.position="absolute",H.style.top="0",H.style.zIndex="-1",window.document.body.appendChild(H),H.innerHTML=M,yield g.timeout(1);const s=yield y()(H,{useCORS:!0}).catch(de=>{console.log(de)});let ie;if(g.removeHtmlElement(H),s){const fe=[25.4*s.width*.85/G,25.4*s.height*.85/G];"bottomright"===D?ie=[c.internal.pageSize.height-b[2]-fe[1],b[1],b[2],c.internal.pageSize.width-b[1]-fe[0]]:"topright"===D?ie=[b[0],b[1],c.internal.pageSize.height-b[0]-fe[1],c.internal.pageSize.width-b[1]-fe[0]]:"bottomleft"===D?ie=[c.internal.pageSize.height-b[2]-fe[1]-15,c.internal.pageSize.width-b[3]-fe[0],b[2]+15,b[3]]:"topleft"===D&&(ie=[b[0],c.internal.pageSize.width-b[3]-fe[0],c.internal.pageSize.height-b[0]-fe[1],b[3]]),g.addCanvas(c,s,ie),yield g.saveDoc(c)}})()}defineNbFileToProcess(c){this.nbFileToProcess=c}timeout(c){return new Promise(I=>setTimeout(I,c))}addCanvas(c,I,b){let G;if(I&&(G=I.toDataURL("image/png")),void 0!==G){if(G.length<20)return void console.log("Warning: An image cannot be print in pdf file");const D=this.getImageSizeToFitPdf(c,I,b);c.addImage(G,"PNG",b[3],b[0],D[0],D[1]),c.rect(b[3],b[0],D[0],D[1]),this.imgSizeAdded=D}}addMap(c,I,b,G,D,g){var U=this;const M=I.ol.getSize(),H=I.ol.getView().getResolution(),s=this.setMapResolution(I,G,b,H),ie=new a.E;let de;return I.ol.once("rendercomplete",function(){var fe=(0,C.c)(function*(Se){const ae=Se.target.getViewport().getElementsByTagName("canvas"),le=yield U.drawMap(s,ae);U.mapPrintExtent=I.viewController.getExtent("EPSG:3857"),U.resetOriginalMapSize(I,M,H),yield U.drawMapControls(I,le,g);const oe=I.status$.subscribe(se=>{if(clearTimeout(de),se!==f.qM.Done)return;oe.unsubscribe();let me=f.qM.Done;try{0!==le.width&&U.addCanvas(c,le,D)}catch{me=f.qM.Error,U.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}ie.next(me)});de=window.setTimeout(()=>{oe.unsubscribe();let se=f.qM.Done;try{0!==le.width&&U.addCanvas(c,le,D)}catch{se=f.qM.Error,U.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}U.resetOriginalMapSize(I,M,H),ie.next(se)},200)});return function(Se){return fe.apply(this,arguments)}}()),ie}setMapResolution(c,I,b,G){const D=c.ol.getSize(),g=Math.round(I[0]*b/25.4),U=Math.round(I[1]*b/25.4);c.ol.setSize([g,U]);const H=Math.min(g/D[0],U/D[1]);return c.ol.getView().setResolution(G/H),[g,U]}resetOriginalMapSize(c,I,b){c.ol.setSize(I),c.ol.getView().setResolution(b),c.ol.updateSize(),c.ol.renderSync()}drawMap(c,I){var b=this;return(0,C.c)(function*(){const G=document.createElement("canvas");G.width=c[0],G.height=c[1];for(let D=0;D<I.length;D++){const g=I[D];g.width>0&&b.handleCanvas(g,G)}return G})()}handleCanvas(c,I){const b=I.getContext("2d"),G=c.parentElement.style.opacity||c.style.opacity;b.globalAlpha=""===G?1:Number(G);const D=c.style.transform;let g;g=D?D.match(/^matrix\(([^\(]*)\)$/)[1].split(",").map(Number):[parseFloat(c.style.width)/c.width,0,0,parseFloat(c.style.height)/c.height,0,0],CanvasRenderingContext2D.prototype.setTransform.apply(b,g);const U=c.parentElement.style.backgroundColor;U&&(b.fillStyle=U,b.fillRect(0,0,c.width,c.height)),b.drawImage(c,0,0),b.globalAlpha=1,b.setTransform(1,0,0,1,0,0)}drawMapControls(c,I,b){var G=this;return(0,C.c)(function*(){const D=I.getContext("2d"),g=c.ol.getOverlayContainerStopEvent().cloneNode(!0);yield G.addNorthDirection(g,b),yield G.addAttribution(g),g.style.width=I.width+"px",g.style.height=I.height+"px",g.style.zIndex="-1",document.getElementsByClassName("ol-viewport")[0].appendChild(g);const U=yield y()(g,{scale:1,backgroundColor:null,allowTaint:!0,useCORS:!0});0!==U.width&&0!==U.height&&D.drawImage(U,0,0),g.remove()})()}addNorthDirection(c,I){return(0,C.c)(function*(){const b=document.getElementsByTagName("igo-rotation-button")[0].cloneNode(!0),G=b.getElementsByTagName("button")[0];if(!G)return null;"topright"===I&&(b.style.width="inherit",b.style.left="10px"),G.parentElement.style.background="transparent",G.style.color="#000",c.appendChild(b)})()}addAttribution(c){return(0,C.c)(function*(){const I=c.getElementsByClassName("ol-attribution")[0],b=I.getElementsByTagName("button")[0];if(!b)return null;b.setAttribute("data-html2canvas-ignore","true"),I.classList.contains("ol-collapsed")&&I.classList.remove("ol-collapsed")})()}downloadMapImage(c,I,b="png",G=!1,D=!1,g="",U="",M="",H=!0,s){var ie=this;const de=new a.E;this.activityId=this.activityService.register();const fe=this.languageService.translate;b=b.toLowerCase();const Se=+I,ae=c.ol.getSize(),le=c.ol.getView().getResolution();return c.ol.once("rendercomplete",function(){var oe=(0,C.c)(function*(se){const me=c.ol.getSize(),be=se.target.getViewport().getElementsByTagName("canvas"),ke=yield ie.drawMap(me,be);ie.resetOriginalMapSize(c,ae,le),yield ie.drawMapControls(c,ke,s),"none"!==s&&(["topleft","topright","bottomleft","bottomright"].indexOf(s)>-1?yield ie.addLegendToImage(ke,c,Se,s,b):"newpage"===s&&(yield ie.getLayersLegendImage(c,b,H,Se)));const qe=document.createElement("canvas"),nt=qe.getContext("2d");let Ue=0;const St=ke.width;let Ae=ke.height;nt.font="20px Calibri";const Qe=nt.measureText(M).width;Ae=""!==g?Ae+30:Ae,Ae=""!==U?Ae+30:Ae,Ae=!1!==G||!1!==D?Ae+30:Ae;const _e=Ae-10,Ie=Math.ceil(Qe/St);Ae=""!==M?Ae+30*Ie:Ae;let je=Ae-20*Ie+5;if(qe.width=St,qe.height=Ae,["bmp","gif","jpeg","png","tiff"].indexOf(b)>-1&&("jpeg"===b||""!==g||""!==U||""!==M||!1!==G||!1!==D)&&(nt.fillStyle="#ffffff",nt.fillRect(0,0,St,Ae),nt.fillStyle="#000000"),""!==g&&(nt.font="26px Calibri",Ue=30,nt.textAlign="center",nt.fillText(g,St/2,20,.9*St)),""!==U&&(nt.font="26px Calibri",Ue=60,nt.textAlign="center",nt.fillText(U,St/2,50,.9*St)),nt.font="20px Calibri",!1!==G||!1!==D){let lt="";if(!1!==G&&(lt=fe.instant("igo.geo.printForm.projection")+": "+c.projection+"         "),!1!==D){const Me=fe.instant("igo.geo.printForm.scale"),ct=c.viewController.getScale(Se);lt+=Me+": ~ 1 / "+(0,w.rE)(ct)}nt.textAlign="center",nt.fillText(lt,St/2,_e,.9*St)}if(""!==M)if(nt.textAlign="center",1===Ie)nt.fillText(M,St/2,je);else{const Me=Math.floor(M.length/Ie);let He,ct="",Oe=0;for(let ze=0;ze<Ie;ze++)Ie-1>ze?(ct=M.substr(Oe,Me),He=ct.lastIndexOf(" "),nt.fillText(ct.substr(0,He),St/2,je),Oe+=He,je+=20):nt.fillText(M.substr(Oe),St/2,je)}nt.drawImage(ke,0,Ue);let Ve=f.qM.Done,ot="map."+b;"tiff"===b.toLowerCase()&&(ot="map"+c.projection.replace(":","_")+"."+b);try{H?(b.toLowerCase(),ie.generateCanvaFileToZip(qe,ot)):ie.saveCanvasImageAsFile(qe,ot,b)}catch{Ve=f.qM.Error}if(de.next(Ve),"tiff"===b.toLowerCase()){const lt=ot.substring(0,ot.toLowerCase().indexOf(".tiff"))+".tfw",Me=ie.getWorldFileInformation(c),ct=new Blob([Me],{type:"text/plain;charset=utf-8"});H?ie.addFileToZip(lt,ct):((0,h.saveAs)(ct,lt),ie.saveFileProcessing())}});return function(se){return oe.apply(this,arguments)}}()),this.setMapImageResolution(c,ae,Se,le),de}setMapImageResolution(c,I,b,G){const D=b/96,g=[Math.round(I[0]*D),Math.round(I[1]*D)];c.ol.setSize(g);const U=Math.min(g[0]/I[0],g[1]/I[1]);c.ol.getView().setResolution(G/U),c.ol.renderSync()}addLegendToImage(c,I,b,G,D){var g=this;return(0,C.c)(function*(){const U="map."+D,M=c.getContext("2d"),H=yield g.getLayersLegendHtml(I,c.width,b).toPromise();if(""===H)return yield g.saveCanvasImageAsFile(c,U,D),!0;const s=window.document.createElement("div");s.style.position="absolute",s.style.top="0",s.style.zIndex="-1",window.document.body.appendChild(s),s.innerHTML=H,yield g.timeout(1);const ie=yield y()(s,{useCORS:!0}).catch(de=>{console.log(de)});if(ie){const de=c.height,fe=c.width,Se=ie.height,ae=ie.width,le=.01*de;let oe,se;return"bottomright"===G?(oe=fe-ae-le,se=de-Se-le):"topright"===G?(oe=fe-ae-le,se=le):"bottomleft"===G?(oe=le,se=de-Se-le-15):"topleft"===G&&(oe=le,se=le),M.drawImage(ie,oe,se,ae,Se),M.strokeRect(oe,se,ae,Se),g.removeHtmlElement(s),!0}})()}renderMap(c,I,b){c.ol.updateSize(),c.ol.renderSync()}saveDoc(c){return(0,C.c)(function*(){yield c.save("map_georef.pdf",{returnPromise:!0})})()}getImageSizeToFitPdf(c,I,b){const G=c.internal.pageSize.getHeight()-(b[0]+b[2]+10),D=c.internal.pageSize.getWidth()-(b[1]+b[3]),g=this.pdf_units2points(I.height,"mm"),U=this.pdf_units2points(I.width,"mm"),M=g/G,H=U/D,s=M>H?M:H;return[s>1?U/s:U,s>1?g/s:g]}getWorldFileInformation(c){const I=c.viewController.getResolution(),b=c.viewController.getExtent();return[I,0,0,-I,b[0]+I/.5,b[3]-I/.5].join("\n")}saveCanvasImageAsFile(c,I,b){const G="image/"+b,D=this;try{c.toDataURL(),c.toBlob(g=>{(0,h.saveAs)(g,I),D.saveFileProcessing()},G)}catch{this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}}generateCanvaFileToZip(c,I){const G=this;(!this.hasOwnProperty("zipFile")||typeof this.zipFile>"u")&&(this.zipFile=new(T()));try{c.toDataURL(),navigator.msSaveBlob?this.addFileToZip(I,c.msToBlob()):c.toBlob(D=>{G.addFileToZip(I,D)},"image/jpeg")}catch{this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}}addFileToZip(c,I){this.zipFile.file(c,I),this.nbFileToProcess--,0===this.nbFileToProcess&&(this.getZipFile(),this.activityService.unregister(this.activityId))}saveFileProcessing(){this.nbFileToProcess--,0===this.nbFileToProcess&&this.activityService.unregister(this.activityId)}getZipFile(){const c=this;this.zipFile.generateAsync({type:"blob"}).then(I=>{(0,h.saveAs)(I,"map.zip"),delete c.zipFile})}pdf_units2points(c,I){let b=1;switch(I){case"pt":b=1;break;case"mm":b=72/25.4;break;case"cm":b=72/2.54;break;case"in":b=72;break;case"px":b=96/72;break;case"pc":case"em":b=12;break;case"ex":b=6;break;default:throw new Error("Invalid unit: "+I)}return c*b}static \u0275fac=function(I){return new(I||B)(K.CoB(X.KK),K.CoB(o.mi),K.CoB(d.U9),K.CoB(P.ov),K.CoB(L.aW))};static \u0275prov=K.wxM({token:B,factory:B.\u0275fac,providedIn:"root"})}return B})()},47580:(Fe,ce,r)=>{"use strict";r.d(ce,{ID:()=>f,QH:()=>d,mw:()=>o,qp:()=>L,wR:()=>P,wf:()=>e});var C=r(43168);const e=(0,C.GC)(["Pdf","Image"]),d=(0,C.GC)(["A0","A1","A2","A3","A4","A5","Letter","Legal"]),L=(0,C.GC)(["landscape","portrait"]),P=["72","96","150","300"],o=(0,C.GC)(["Bmp","Gif","Jpeg","Png","Tiff"]),f=(0,C.GC)(["none","topright","topleft","bottomleft","bottomright","newpage"])},87048:(Fe,ce,r)=>{"use strict";r.d(ce,{s:()=>T});var C=r(34896),e=r(83552),d=r(24328),L=r(3360),P=r(1296),o=r(14672),f=r(18080),h=r(2892),R=r(9364),y=r(59324),O=r(93199),x=r(17400);let T=(()=>{class a{component;queryService;queries$$=[];mapClickListener;olDragSelectInteraction;olDragSelectInteractionEndKey;queryFeatures=!1;queryFeaturesHitTolerance=0;queryFeaturesCondition;waitForAllQueries=!0;query=new C._w7;get map(){return this.component.map}constructor(A,k){this.component=A,this.queryService=k}ngAfterViewInit(){this.listenToMapClick(),this.addDragBoxInteraction()}ngOnDestroy(){this.cancelOngoingQueries(),this.unlistenToMapClick(),this.removeDragBoxInteraction()}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",A=>this.onMapEvent(A))}unlistenToMapClick(){(0,e.S)(this.mapClickListener),this.mapClickListener=void 0}onMapEvent(A){if(this.cancelOngoingQueries(),!this.queryService.queryEnabled)return;const k=[];this.queryFeatures&&k.push(this.doQueryFeatures(A));const W=this.map.ol.getView().getResolution(),w=this.map.layers.filter(x.wd);k.push(...this.queryService.query(w,{coordinates:A.coordinate,projection:this.map.projection,resolution:W})),0!==k.length&&(this.waitForAllQueries?this.queries$$.push((0,L.E)(...k).subscribe(te=>{const Z=[].concat(...te);this.query.emit({features:Z,event:A})})):this.queries$$=k.map(te=>te.subscribe(Z=>{this.query.emit({features:Z,event:A})})))}doQueryFeatures(A){const k=[];if("singleclick"===A.type)this.map.ol.forEachFeatureAtPixel(A.pixel,(W,w)=>{const te=this.map.getLayerById(w.values_._layer.id);if(!te.dataSource.options.queryFormatAsWms&&W)if(W.get("features"))for(const Z of W.get("features")){const K=(0,o.qK)(Z,this.map.projection);K.meta={title:Z.values_.nom,id:w.values_._layer.id+"."+Z.id_,icon:Z.values_._icon,sourceTitle:w.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(te)},k.push(K)}else if(W instanceof d.cp){const Z=(0,o.In)(W,this.map.projection,w);Z.meta={id:w.values_._layer.id+"."+Z.meta.id,sourceTitle:w.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(te),title:this.queryService.getQueryTitle(Z,te)||Z.meta.title},k.push(Z)}else{const Z=(0,o.qK)(W,this.map.projection,w);Z.meta={id:w.values_._layer.id+"."+Z.meta.id,sourceTitle:w.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(te),title:this.queryService.getQueryTitle(Z,te)||Z.meta.title},k.push(Z)}},{hitTolerance:this.queryFeaturesHitTolerance||0,layerFilter:this.queryFeaturesCondition?this.queryFeaturesCondition:x.aA});else if("boxend"===A.type){const w=A.target.getGeometry().getExtent();this.map.layers.filter(x.wd).filter(te=>te instanceof h.M&&te.visible).map(te=>{te.dataSource.ol.forEachFeatureIntersectingExtent(w,K=>{const X=(0,o.qK)(K,this.map.projection,te.ol);X.meta={id:te.id+"."+K.getId(),icon:K.values_._icon,sourceTitle:te.title,alias:this.queryService.getAllowedFieldsAndAlias(te),title:this.queryService.getQueryTitle(X,te)||X.meta.title},k.push(X)})})}return(0,P.of)(k)}cancelOngoingQueries(){this.queries$$.forEach(A=>A.unsubscribe()),this.queries$$=[]}addDragBoxInteraction(){let A;const k=this.map.ol.getInteractions().getArray();for(const W of k)if(W instanceof f.E){A=W;break}void 0===A&&(A=new f.E({condition:y.q}),this.map.ol.addInteraction(A),this.olDragSelectInteraction=A),this.olDragSelectInteractionEndKey=A.on("boxend",W=>this.onMapEvent(W))}removeDragBoxInteraction(){void 0!==this.olDragSelectInteractionEndKey&&(0,e.S)(this.olDragSelectInteractionEndKey),void 0!==this.olDragSelectInteraction&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=void 0}static \u0275fac=function(k){return new(k||a)(C.GI1(R.q,2),C.GI1(O.E))};static \u0275dir=C.Sc5({type:a,selectors:[["","igoQuery",""]],inputs:{queryFeatures:"queryFeatures",queryFeaturesHitTolerance:"queryFeaturesHitTolerance",queryFeaturesCondition:"queryFeaturesCondition",waitForAllQueries:"waitForAllQueries"},outputs:{query:"query"},standalone:!0})}return a})()},49704:(Fe,ce,r)=>{"use strict";r.d(ce,{Il:()=>d,cv:()=>e,s5:()=>C});var C=function(L){return L.GML2="gml2",L.GML3="gml3",L.JSON="json",L.GEOJSON="geojson",L.GEOJSON2="geojson2",L.ESRIJSON="esrijson",L.TEXT="text",L.HTML="html",L.HTMLGML2="htmlgml2",L}(C||{}),e=function(L){return L.GML2="application/vnd.ogc.gml",L.GML3="application/vnd.ogc.gml/3.1.1",L.JSON="application/json",L.GEOJSON="application/geojson",L.GEOJSON2="geojson",L.ESRIJSON="application/json",L.TEXT="text/plain",L.HTML="text/html",L.HTMLGML2="text/html",L}(e||{}),d=function(L){return L.IFRAME="iframe",L.BLANK="_blank",L}(d||{})},93199:(Fe,ce,r)=>{"use strict";r.d(ce,{E:()=>V});var C=r(93020),e=r(43168),d=r(94448),L=r(55784),P=r(10416),o=r(73592),f=r(95456),h=r(14984),R=r(30533),y=r(416),O=r(80848),x=r(62808),T=r(36752),a=r(1296),F=r(9240),A=r(40604),k=r(27164),W=r.n(k),w=r(3544),te=r(68392),Z=r(49704),K=r(34896),X=r(33712);let V=(()=>{class B{http;messageService;queryEnabled=!0;defaultFeatureCount=20;featureCount=20;previousMessageIds=[];constructor(c,I){this.http=c,this.messageService=I}query(c,I){this.previousMessageIds.length&&this.previousMessageIds.forEach(D=>{this.messageService.remove(D)});const b=c.filter(D=>D.visible&&D.isInResolutionsRange).map(D=>this.queryLayer(D,I));return[].concat.apply([],b)}queryLayer(c,I){const b=this.getQueryUrl(c.dataSource,I,!1,c.map.viewController.getExtent());if(!b)return(0,a.of)([]);const G=c.map.viewController.getResolution(),D=c.map.viewController.getScale();if(c.dataSource.options.queryFormat===Z.s5.HTMLGML2){if("string"==typeof b){const M=this.getQueryUrl(c.dataSource,I,!0);return this.http.get(M,{responseType:"text"}).pipe((0,F.O)(H=>{const s=this.mergeGML(H,b,c),ie=s[0],de=s[1];return this.http.get(b,{responseType:"text"}).pipe((0,A.k)(fe=>this.extractData(fe,c,I,b,ie,de)))}))}const g=this.getQueryUrl(c.dataSource,I,!0);let U=[];for(let M=0;M<g.length;M++){const H=g[M];this.checkScaleAndResolution(G,D,H)&&U.push(this.requestDataForHTMLGML2(H.url,b[M].url,c,I))}return U}{if("string"==typeof b)return this.http.get(b,{responseType:"text"}).pipe((0,A.k)(M=>this.extractData(M,c,I,b)));let g=[];for(let U=0;U<b.length;U++){const M=b[U];if(this.checkScaleAndResolution(G,D,M)){const H=this.http.get(M.url,{responseType:"text"});g.push(H.pipe((0,A.k)(s=>this.extractData(s,c,I,M.url))))}}return g}}requestDataForHTMLGML2(c,I,b,G){return this.http.get(c,{responseType:"text"}).pipe((0,F.O)(D=>{const g=this.mergeGML(D,I,b),U=g[0],M=g[1];return this.http.get(I,{responseType:"text"}).pipe((0,A.k)(H=>this.extractData(H,b,G,I,U,M)))}))}checkScaleAndResolution(c,I,b){let G,D;return!(b.minResolution||b.maxResolution||b.minScale||b.maxScale)||(b.minResolution&&b.maxResolution?c>=b.minResolution&&c<=b.maxResolution&&(D=!0):(b.minResolution&&c>=b.minResolution&&(D=!0),b.maxResolution&&c<=b.maxResolution&&(D=!0)),b.minScale&&b.maxScale?I>b.minScale&&I<b.maxScale&&(G=!0):(b.maxScale&&I<=b.maxScale&&(G=!0),b.minScale&&I>=b.minScale&&(G=!0)),!0===G&&!0===D||!0===D&&!G||!0===G&&!D)}mergeGML(c,I,b){let D=(new f.c).readFeatures(c);0===D.length&&(D=(new L.c).readFeatures(c));const g=new R.c([]);let U;const M=[];let s,H=new y.c([]);const ie=D.length,Se=this.getQueryParams(I.toLowerCase()).bbox.split(","),ae=d.Gu();let oe,se,me,be;if(d.SU(ae,Se),b.options?.source?.options){const qe=b.options.source.options;qe.queryTitle&&(se=qe.queryTitle)}switch(D.map(qe=>{if(se){let St=qe.getProperties()[se];St&&(oe=oe?`${oe},${St}`:St)}const nt=qe.getGeometry().getCoordinates(),Ue=qe.getGeometry().getType();switch(!s&&(s=Ue),Ue){case"Point":1===ie?U=new O.c(nt,"XY"):M.push(nt);break;case"LineString":g.appendLineString(new x.c(nt,"XY"));break;case"Polygon":H.appendPolygon(new T.cp(nt,"XY"));break;case"MultiPolygon":H=new y.c(nt,"XY");break;default:return}}),me=0===M.length&&U?{type:U.getType(),coordinates:U.getCoordinates()}:{type:"Polygon",coordinates:[this.convexHull(M)]},s){case"LineString":be={type:g.getType(),coordinates:g.getCoordinates()};break;case"Point":be=me;break;case"Polygon":case"MultiPolygon":be={type:H.getType(),coordinates:H.getCoordinates()}}const ke={};return se&&(ke[se]=oe),[be,ke]}cross(c,I,b){return(c[0]-b[0])*(I[1]-b[1])-(c[1]-b[1])*(I[0]-b[0])}convexHull(c){c.sort((G,D)=>G[0]===D[0]?G[1]-D[1]:G[0]-D[0]);const I=[];for(const G of c){for(;I.length>=2&&this.cross(I[I.length-2],I[I.length-1],G)<=0;)I.pop();I.push(G)}const b=[];for(let G=c.length-1;G>=0;G--){for(;b.length>=2&&this.cross(b[b.length-2],b[b.length-1],c[G])<=0;)b.pop();b.push(c[G])}return b.pop(),I.pop(),I.concat(b)}extractData(c,I,b,G,D,g){const U=I.dataSource,M=this.getAllowedFieldsAndAlias(I);let H=[];switch(U.options.queryFormat){case Z.s5.GML3:H=this.extractGML3Data(c,I.zIndex,M);break;case Z.s5.JSON:case Z.s5.GEOJSON:case Z.s5.GEOJSON2:H=this.extractGeoJSONData(c,I.zIndex,M);break;case Z.s5.ESRIJSON:H=this.extractEsriJSONData(c,I.zIndex,M);break;case Z.s5.TEXT:H=this.extractTextData(c);break;case Z.s5.HTML:H=this.extractHtmlData(c,U.queryHtmlTarget,G);break;case Z.s5.HTMLGML2:H=this.extractHtmlData(c,U.queryHtmlTarget,G,D,g);break;default:H=this.extractGML2Data(c,I,M)}if(H.length>0&&(null===H[0].geometry||!H[0].geometry)){const de=this.createGeometryFromUrlClick(G);for(const fe of H)fe.geometry=de}const s=I.dataSource;if((s.params?.FEATURE_COUNT?new RegExp("FEATURE_COUNT="+this.featureCount):new RegExp("FEATURE_COUNT="+this.defaultFeatureCount)).test(G)&&(s.params?.FEATURE_COUNT&&this.featureCount>1&&H.length===this.featureCount||!s.params?.FEATURE_COUNT&&H.length===this.defaultFeatureCount)){const de=this.messageService.info("igo.geo.query.featureCountMax",void 0,void 0,{value:I.title});this.previousMessageIds.push(de.toastId)}return H.map((de,fe)=>{const Se=de.properties[U.mapLabel];let ae;if("wms"===I.options.sourceOptions?.type){const se=I.options.sourceOptions;ae=se?se.excludeAttribute:void 0}let le=this.getQueryTitle(de,I);!le&&H.length>1?le=`${I.title} (${fe+1})`:le||(le=I.title);const oe=Object.assign({},de.meta||{},{id:(0,e.uq)(),title:le,mapTitle:Se,sourceTitle:I.title,order:1e3-I.zIndex,excludeAttribute:ae});return Object.assign(de,{meta:oe,projection:"carto"===U.options.type?"EPSG:4326":b.projection})})}createGeometryFromUrlClick(c){const I=this.getQueryParams(c.toLowerCase()),b=I.bbox,G=parseInt(I.width,10),D=parseInt(I.height,10),g=parseInt(I.i||I.x,10),U=parseInt(I.j||I.y,10),M=b.split(",");let H=.05*(Math.abs(parseFloat(M[0]))-Math.abs(parseFloat(M[2])));Math.abs(parseFloat(M[0]))<180&&(H=.045);const s=parseFloat(M[0])+Math.abs(parseFloat(M[0])-parseFloat(M[2]))*g/G-H,ie=parseFloat(M[1])+Math.abs(parseFloat(M[1])-parseFloat(M[3]))*U/D-H,de=s+2*H,fe=ie+2*H,Se="POLYGON(("+s+" "+ie+", "+s+" "+fe+", "+de+" "+fe+", "+de+" "+ie+", "+s+" "+ie+"))",oe=(new P.c).readFeature(Se).getGeometry();return{type:oe.getType(),coordinates:oe.getCoordinates()}}extractGML2Data(c,I,b){let D=(new f.c).readFeatures(c);if(0===D.length){const g=new L.c;try{D=g.readFeatures(c)}catch{console.warn("query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.")}}return D.map(g=>this.featureToResult(g,I,b))}extractGML3Data(c,I,b){const G=new h.c;let D=[];try{D=G.readFeatures(c)}catch{console.warn("query.service: GML3 is not well supported")}return D.map(g=>this.featureToResult(g,I,b))}extractGeoJSONData(c,I,b){let G=[];try{G=JSON.parse(c.replace(/(\r|\n)/g," ")).features}catch{console.warn("query.service: Unable to parse geojson","\n",c)}return G.map(D=>D.meta={id:(0,e.uq)(),order:1e3-I,alias:b}),G}extractEsriJSONData(c,I,b){if(c)try{if(JSON.parse(c).error)return[]}catch{}return(new o.c).readFeatures(c).map(g=>this.featureToResult(g,I,b))}extractTextData(c){return[]}extractHtmlData(c,I,b,G,D){const g=this.getQueryParams(b.toLowerCase()),U=g.crs||g.srs||"EPSG:3857",M=this.createGeometryFromUrlClick(b);I!==Z.Il.BLANK&&I!==Z.Il.IFRAME&&(I=Z.Il.IFRAME);const H=c.toLowerCase().indexOf("<body>"),s=c.toLowerCase().lastIndexOf("</body>")+7;return""===W()(c.slice(H,s).replace(/(\r|\n|\s)/g,""))||""===c?[]:[{type:te.Y,projection:U,properties:Object.assign({target:I,body:c,url:b},D),geometry:G||M}]}getQueryParams(c){const I=c.split("?");if(!I[1])return;const b=I[1].split("&"),G={};return b.forEach(D=>{D=D.split("="),G[D[0]]=decodeURIComponent(D[1]||"")}),G}featureToResult(c,I,b){const G=c.getGeometry(),D=Object.assign({},c.getProperties());let g;return delete D.geometry,delete D.GEOMETRIE,delete D.boundedBy,delete D.shape,delete D.SHAPE,delete D.SHAPE_S,delete D.SHAPE_L,delete D.SHAPE_P,delete D.the_geom,delete D.geom,delete D.geom32198,G&&(g={type:G.getType(),coordinates:G.getCoordinates()}),{type:te.Y,projection:void 0,properties:D,geometry:g,meta:{id:(0,e.uq)(),order:1e3-I,alias:b}}}getQueryUrl(c,I,b=!1,G){let D;if(c.options.queryUrls)return this.getCustomQueryUrl(c,I,G);switch(c.constructor){case w.CK:const g=c,U={INFO_FORMAT:g.params.INFO_FORMAT||this.getMimeInfoFormat(c.options.queryFormat),QUERY_LAYERS:g.params.LAYERS,FEATURE_COUNT:g.params.FEATURE_COUNT||this.defaultFeatureCount};g.params.FEATURE_COUNT&&(this.featureCount=g.params.FEATURE_COUNT),b&&(U.INFO_FORMAT=this.getMimeInfoFormat(Z.s5.GML2)),D=g.ol.getFeatureInfoUrl(I.coordinates,I.resolution,I.projection,U);break;case w.aI:D=`${"https://"+c.options.account+".carto.com/api/v2/sql?"}format=GeoJSON${"&q="+c.options.config.layers[0].options.sql} WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(${I.coordinates[0]+","+I.coordinates[1]+"),3857),"+(c.options.queryPrecision?c.options.queryPrecision:"1000")+"))"}`;break;case w.yA:case w.W4:const ae=c,le=Math.abs(G[0]-G[2]),oe=Math.abs(G[1]-G[3]),be=ae.options.queryPrecision?ae.options.queryPrecision:.005*(le>oe?le:oe),ke=d.cz(d.cj([I.coordinates]),be);D=`${ae.options.url+"/"+ae.options.layer+"/query/"}?${["f=json",`geometry=${encodeURIComponent('{"xmin":'+ke[0]+',"ymin":'+ke[1]+',"xmax":'+ke[2]+',"ymax":'+ke[3]+',"spatialReference":{"wkid":102100}}')}`,"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"].join("&")}`}return D}getMimeInfoFormat(c){let I="application/vnd.ogc.gml";const b=Object.keys(Z.s5).find(G=>Z.s5[G]===c);return b&&(I=Z.cv[b]),I}getAllowedFieldsAndAlias(c){let I;return c.options?.source?.options?.sourceFields&&c.options.source.options.sourceFields.length>=1&&(I={},c.options.source.options.sourceFields.forEach(b=>{I[b.name]=b.alias?b.alias:b.name})),I}getQueryTitle(c,I){let b;if(I.options?.source?.options){const G=I.options.source.options;G.queryTitle&&(b=this.getLabelMatch(c,G.queryTitle))}return b}getLabelMatch(c,I){let b=I;const G=Array.from(I.matchAll(/\$\{([^\{\}]+)\}/g));return G.forEach(D=>{b=b.replace(D[0],c.properties[D[1]])}),0===G.length&&b===I&&(b=c.properties[I]||I),b}getCustomQueryUrl(c,I,b){const G=d.C2(I.coordinates,I.resolution,0,[101,101]);return c.options.queryUrls.map(D=>{let g={url:D.url.replace(/\{bbox\}/g,G.join(",")).replace(/\{x\}/g,I.coordinates[0].toString()).replace(/\{y\}/g,I.coordinates[1].toString()).replace(/\{resolution\}/g,I.resolution.toString()).replace(/\{srid\}/g,I.projection.replace("EPSG:",""))};return b&&g.url.replace(/\{xmin\}/g,b[0].toString()).replace(/\{ymin\}/g,b[1].toString()).replace(/\{xmax\}/g,b[2].toString()).replace(/\{ymax\}/g,b[3].toString()),D.maxResolution&&(g.maxResolution=D.maxResolution),D.minResolution&&(g.minResolution=D.minResolution),D.minScale&&(g.minScale=D.minScale),D.maxScale&&(g.maxScale=D.maxScale),g})}static \u0275fac=function(I){return new(I||B)(K.CoB(X.KK),K.CoB(C.mi))};static \u0275prov=K.wxM({token:B,factory:B.\u0275fac,providedIn:"root"})}return B})()},17400:(Fe,ce,r)=>{"use strict";function C(P){return!0===P.dataSource.options.queryable}function L(P){const o=P.get("_layer");return void 0!==o&&C(o)&&function d(P){const o=P.dataSource;return void 0===o.options.queryLayerFeatures||!0===o.options.queryLayerFeatures}(o)}r.d(ce,{aA:()=>L,wd:()=>C})},8636:(Fe,ce,r)=>{"use strict";r.d(ce,{A:()=>D});var C=r(65056),e=r(34896),d=r(34672),L=r(75180),P=r(50244),o=r(32328),f=r(42536),h=r(27e3),y=(r(53e3),r(9204)),O=r(24708),x=r(54844),T=r(43451),a=r(25376),F=r(11484),A=r(1560),k=r(50620),W=r(29220),w=r(29216),te=r(83456),Z=r(72584);const K=["input"];function X(g,U){if(1&g&&(e.I0R(0,"mat-label"),e.OEk(1),e.C$Y()),2&g){const M=e.GaO();e.yG2(),e.cNF(M.label)}}function V(g,U){if(1&g){const M=e.KQA();e.I0R(0,"button",11),e.qCj("click",function(){e.usT(M);const s=e.GaO();return e.CGJ(s.onClearButtonClick())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"close"),e.C$Y()()}if(2&g){const M=e.GaO();e.E7m("color",M.color)("matTooltip",e.kDX(1,2,"igo.geo.search.clearSearch"))}}function B(g,U){1&g&&e.wR5(0,"mat-divider",12),2&g&&e.E7m("vertical",!0)}function z(g,U){if(1&g){const M=e.KQA();e.I0R(0,"button",13),e.qCj("click",function(){e.usT(M);const s=e.GaO();return e.CGJ(s.handleSearch())}),e.I0R(1,"mat-icon"),e.OEk(2,"search"),e.C$Y()()}if(2&g){const M=e.GaO();e.E7m("color",M.color)}}function c(g,U){if(1&g){const M=e.KQA();e.I0R(0,"igo-search-selector",14),e.qCj("searchTypeChange",function(s){e.usT(M);const ie=e.GaO();return e.CGJ(ie.onSearchTypeChange(s))}),e.wVc(1,"async"),e.C$Y()}if(2&g){const M=e.GaO();e.E7m("searchTypes",M.searchTypes)("searchType",e.kDX(1,2,M.searchType$))}}function I(g,U){if(1&g){const M=e.KQA();e.I0R(0,"igo-search-settings",15),e.qCj("pointerSummaryStatus",function(s){e.usT(M);const ie=e.GaO();return e.CGJ(ie.pointerSummaryStatus.emit(s))})("searchResultsGeometryStatus",function(s){e.usT(M);const ie=e.GaO();return e.CGJ(ie.searchResultsGeometryStatus.emit(s))})("reverseSearchCoordsFormatStatus",function(s){e.usT(M);const ie=e.GaO();return e.CGJ(ie.reverseSearchCoordsFormatStatus.emit(s))})("searchSourceChange",function(){e.usT(M);const s=e.GaO();return e.CGJ(s.onSearchSettingsChange())}),e.C$Y()}if(2&g){const M=e.GaO();e.E7m("pointerSummaryEnabled",M.pointerSummaryEnabled)("searchResultsGeometryEnabled",M.searchResultsGeometryEnabled)("reverseSearchCoordsFormatEnabled",M.reverseSearchCoordsFormatEnabled)}}const b=g=>({empty:g}),G=g=>({hasSearchIcon:g});let D=(()=>{class g{configService;searchService;searchSourceService;static invalidKeys=["Control","Shift","Alt","ArrowDown","ArrowUp","ArrowRight","ArrowLeft"];placeholder$=new x.g("igo.geo.search.placeholder");empty$=new x.g(!0);term$$;stream$=new x.g("");stream$$;searchType$$;researches$$;showSearchButton=!1;searchTypes=W.a;withDivider;set searchType(M){this.setSearchType(M)}get searchType(){return this.searchType$.value}searchType$=new x.g(void 0);pointerSummaryStatus=new e._w7;searchResultsGeometryStatus=new e._w7;reverseSearchCoordsFormatStatus=new e._w7;set term(M){this.setTerm(M)}get term(){return this.term$.value}term$=new x.g("");set disabled(M){this.disabled$.next(M)}get disabled(){return this.disabled$.value}disabled$=new x.g(!1);pointerSummaryEnabled=!1;searchResultsGeometryEnabled=!1;get reverseSearchCoordsFormatEnabled(){return this._reverseSearchCoordsFormatEnabled}set reverseSearchCoordsFormatEnabled(M){this._reverseSearchCoordsFormatEnabled=M,this.setTerm(this.term,!0)}_reverseSearchCoordsFormatEnabled=!1;floatLabel="auto";appearance="fill";placeholder;label;color="primary";termSplitter="|";debounce=200;minLength=2;searchSelector=!1;searchSettings=!1;forceNA=!1;store;searchTermChange=new e._w7;search=new e._w7;searchTypeChange=new e._w7;clearFeature=new e._w7;searchSettingsChange=new e._w7;input;get empty(){return 0===this.term.length}constructor(M,H,s){this.configService=M,this.searchService=H,this.searchSourceService=s}ngOnInit(){this.term$$=this.term$.subscribe(H=>{this.empty$.next(void 0===H||0===H.length)}),this.stream$$=this.stream$.pipe((0,a.C)(()=>(0,T.k)(this.debounce))).subscribe(H=>this.onSetTerm(H)),this.handlePlaceholder(),this.searchType$$=this.searchType$.pipe((0,F.a)()).subscribe(H=>this.onSetSearchType(H));const M=this.configService.getConfig("searchBar.showSearchButton");this.showSearchButton=void 0!==M&&M}ngOnDestroy(){this.term$$.unsubscribe(),this.stream$$.unsubscribe(),this.searchType$$.unsubscribe()}onKeyup(M){this.keyIsValid(M.key)&&this.setTerm(M.target.value)}onClearButtonClick(){this.clear(),this.clearFeature.emit()}onSearchTypeChange(M){this.setSearchType(M)}setSearchType(M){this.searchType$.next(M)}onSearchSettingsChange(){this.doSearch(this.term),this.searchSettingsChange.emit(),this.handlePlaceholder()}setTerm(M,H){if(this.disabled)return;(M=M||"")!==this.term&&!H&&this.term$.next(M);const s=M.replace(/(#[^\s]*)/g,"").trim();(s.length>=this.minLength||0===s.length)&&this.stream$.next(M)}handleSearch(){this.doSearch(this.term)}clear(){this.term$.next(""),this.stream$.next(""),this.input.nativeElement.focus()}keyIsValid(M){return-1===g.invalidKeys.indexOf(M)}onSetTerm(M){this.searchTermChange.emit(M),this.doSearch(M)}handlePlaceholder(){const M=[...new Set(this.searchSourceService.getEnabledSources().filter(s=>!["map","coordinatesreverse"].includes(s.getId())).map(s=>s.getType()))];let H="igo.geo.search.placeholder";1===M.length?H=`igo.geo.search.${M[0].toLowerCase()}.placeholder`:0===M.length&&(H="igo.geo.search.emptyType.placeholder"),this.placeholder$.next(H)}onSetSearchType(M){if(null==M)return;this.searchTypeChange.emit(M);const H=`igo.geo.search.${M.toLowerCase()}.placeholder`;this.placeholder$.next(H),this.setTerm(this.term)}doSearch(M){let H;this.researches$$&&(this.researches$$.map(ie=>ie.unsubscribe()),this.researches$$=void 0),this.termSplitter&&M.match(new RegExp(this.termSplitter,"g"))?(H=M.split(this.termSplitter).filter(ie=>ie.length>=this.minLength),this.store&&this.store.clear()):H=[M];let s=[];H.map(ie=>{""!==(ie?ie.replace(/(#[^\s]*)/g,"").trim():"")?s=s.concat(this.searchService.search(ie,{forceNA:this.forceNA})):void 0!==this.store&&this.store.clear()}),this.researches$$=s.map(ie=>ie.request.subscribe(de=>{this.onResearchCompleted(ie,de)}))}onResearchCompleted(M,H){if(this.search.emit({research:M,results:H}),void 0!==this.store){const s=this.store.all().filter(ie=>ie.source!==M.source).concat(H);this.store.updateMany(s)}}static \u0275fac=function(H){return new(H||g)(e.GI1(y.aW),e.GI1(w._),e.GI1(te.i))};static \u0275cmp=e.In1({type:g,selectors:[["igo-search-bar"]],viewQuery:function(H,s){if(1&H&&e.CC$(K,7),2&H){let ie;e.wto(ie=e.Gqi())&&(s.input=ie.first)}},inputs:{searchTypes:"searchTypes",withDivider:"withDivider",searchType:"searchType",term:"term",disabled:"disabled",pointerSummaryEnabled:"pointerSummaryEnabled",searchResultsGeometryEnabled:"searchResultsGeometryEnabled",reverseSearchCoordsFormatEnabled:"reverseSearchCoordsFormatEnabled",floatLabel:"floatLabel",appearance:"appearance",placeholder:"placeholder",label:"label",color:"color",termSplitter:"termSplitter",debounce:"debounce",minLength:"minLength",searchSelector:"searchSelector",searchSettings:"searchSettings",forceNA:"forceNA",store:"store"},outputs:{pointerSummaryStatus:"pointerSummaryStatus",searchResultsGeometryStatus:"searchResultsGeometryStatus",reverseSearchCoordsFormatStatus:"reverseSearchCoordsFormatStatus",searchTermChange:"searchTermChange",search:"search",searchTypeChange:"searchTypeChange",clearFeature:"clearFeature",searchSettingsChange:"searchSettingsChange"},standalone:!0,features:[e.UHJ],decls:17,vars:29,consts:[[1,"igo-search-bar-container",3,"ngClass"],[3,"floatLabel","appearance"],[4,"ngIf"],["matInput","","autocomplete","off",3,"ngClass","disabled","placeholder","value","keyup"],["input",""],["mat-icon-button","","matSuffix","",3,"color","matTooltip","click",4,"ngIf"],[3,"vertical",4,"ngIf"],[1,"search-bar-buttons"],["mat-icon-button","",3,"color","click",4,"ngIf"],[3,"searchTypes","searchType","searchTypeChange",4,"ngIf"],[3,"pointerSummaryEnabled","searchResultsGeometryEnabled","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","searchSourceChange",4,"ngIf"],["mat-icon-button","","matSuffix","",3,"color","matTooltip","click"],[3,"vertical"],["mat-icon-button","",3,"color","click"],[3,"searchTypes","searchType","searchTypeChange"],[3,"pointerSummaryEnabled","searchResultsGeometryEnabled","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","searchSourceChange"]],template:function(H,s){1&H&&(e.I0R(0,"div",0),e.wVc(1,"async"),e.I0R(2,"mat-form-field",1),e.yuY(3,X,2,1,"mat-label",2),e.I0R(4,"input",3,4),e.qCj("keyup",function(de){return s.onKeyup(de)}),e.wVc(6,"async"),e.wVc(7,"async"),e.wVc(8,"translate"),e.wVc(9,"async"),e.C$Y(),e.yuY(10,V,4,4,"button",5),e.wVc(11,"async"),e.C$Y(),e.yuY(12,B,1,1,"mat-divider",6),e.I0R(13,"div",7),e.yuY(14,z,3,1,"button",8)(15,c,2,4,"igo-search-selector",9)(16,I,1,3,"igo-search-settings",10),e.C$Y()()),2&H&&(e.E7m("ngClass",e.S45(25,b,e.kDX(1,13,s.empty$))),e.yG2(2),e.E7m("floatLabel",s.floatLabel)("appearance",s.appearance),e.yG2(),e.E7m("ngIf",s.label),e.yG2(),e.E7m("ngClass",e.S45(27,G,s.showSearchButton))("disabled",e.kDX(6,15,s.disabled$))("placeholder",s.placeholder?s.placeholder:e.kDX(7,17,s.placeholder$)?e.kDX(8,19,s.placeholder$.value):void 0)("value",e.kDX(9,21,s.term$)),e.yG2(6),e.E7m("ngIf",!1===e.kDX(11,23,s.empty$)),e.yG2(2),e.E7m("ngIf",s.withDivider),e.yG2(2),e.E7m("ngIf",s.showSearchButton),e.yG2(),e.E7m("ngIf",s.searchSelector),e.yG2(),e.E7m("ngIf",s.searchSettings))},dependencies:[C.QF,P.wb,P.Up,P.w5,P.Gm,C.u_,f.cN,f.yi,d.oJ,d.um,h.KO,h.a4,o.oB,o.qL,L.U,L.k,A.s,k.Q,C.a,O._s,Z.sD],styles:['[_nghost-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}[_nghost-%COMP%]     .mat-mdc-text-field-wrapper{align-items:center;padding-right:0}[_nghost-%COMP%]     .mat-mdc-form-field-infix{align-self:center}@media (max-width: 599px){[_nghost-%COMP%]     .mat-mdc-form-field-infix{width:158px}}[_nghost-%COMP%]     mat-form-field .mdc-line-ripple{display:none}[_nghost-%COMP%]     mat-form-field input{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.igo-search-bar-container[_ngcontent-%COMP%]{position:relative;width:100%;display:flex}mat-form-field[_ngcontent-%COMP%]{flex:1}mat-divider[_ngcontent-%COMP%]{margin:8px 0}.search-bar-buttons[_ngcontent-%COMP%]{position:relative;display:inline-flex}.search-bar-buttons[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:nth-child(2):before{content:"";border-right:1px solid #ddd;height:28px}igo-search-selector[_ngcontent-%COMP%]{background-color:#fff;top:0;border-radius:0}igo-search-settings[_ngcontent-%COMP%]{background-color:#fff;top:0;border-radius:0}'],changeDetection:0})}return g})()},8408:(Fe,ce,r)=>{"use strict";r.d(ce,{q:()=>de});var C=r(65056),e=r(50032),d=r(34672),L=r(32328),P=r(27e3),o=r(53e3),f=r(24708),h=r(9588),R=r(87544),y=r(88872),O=r(45212),x=r(54776),T=r(54844),a=r(37496),F=r(61200),A=r(39844),k=r(8492),W=r(7036),w=r(2892),Z=(r(89500),r(49312)),K=r(71904),X=r(69400),V=r(46176),B=r(40600),z=r(50244),c=r(42536),I=r(63916),b=r(31792),G=r(40604),D=r(66908),g=r(34896),U=r(72584);function M(fe,Se){if(1&fe&&(g.I0R(0,"mat-option",14)(1,"p",15),g.OEk(2),g.C$Y()()),2&fe){const ae=Se.$implicit;g.E7m("value",ae),g.yG2(2),g.cNF(ae.title)}}let H=(()=>{class fe{formBuilder;languageService;dialogRef;data;form;feature;layers=[];filteredLayers$;constructor(ae,le,oe,se){this.formBuilder=ae,this.languageService=le,this.dialogRef=oe,this.data=se,this.form=this.formBuilder.group({layerName:["",[K.AQ.required]]})}ngOnInit(){this.feature=this.data.feature,this.layers=this.data.layers,this.filteredLayers$=this.form.controls.layerName.valueChanges.pipe((0,b.W)(""),(0,G.k)(ae=>this.filter(ae)))}filter(ae){if("string"==typeof ae)return this.layers.map(le=>le).filter(le=>le?.title?.toLowerCase().includes(ae.toLowerCase()))}displayFn(ae){return ae&&ae.title?ae.title:""}save(){this.dialogRef.close({layer:this.form.value.layerName,feature:this.feature})}cancel(){this.dialogRef.close()}static \u0275fac=function(le){return new(le||fe)(g.GI1(K.KE),g.GI1(f.ov),g.GI1(B.yI),g.GI1(B.sR,8))};static \u0275cmp=g.In1({type:fe,selectors:[["igo-save-feature-dialog"]],standalone:!0,features:[g.UHJ],decls:23,vars:22,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[1,"igo-form",3,"formGroup"],[3,"navigation","selection"],["igoListItem","","color","accent",3,"result","showIcons"],[1,"igo-input-container"],["type","text","matInput","","formControlName","layerName",3,"placeholder","matAutocomplete"],[3,"displayWith"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["mat-dialog-actions","",2,"justify-content","center"],[1,"igo-form-button-group","create-layer-button-top-padding"],["mat-raised-button","","type","button",3,"click"],["id","createLayerBtnDialog","mat-raised-button","","type","button","color","primary",3,"click"],[3,"value"],["matListItemTitle",""]],template:function(le,oe){if(1&le&&(g.I0R(0,"h1",0),g.OEk(1),g.wVc(2,"translate"),g.C$Y(),g.I0R(3,"div",1)(4,"form",2)(5,"igo-list",3),g.wR5(6,"igo-search-results-item",4),g.C$Y(),g.I0R(7,"div",5)(8,"mat-form-field"),g.wR5(9,"input",6),g.wVc(10,"translate"),g.I0R(11,"mat-autocomplete",7,8),g.yuY(13,M,3,2,"mat-option",9),g.wVc(14,"async"),g.C$Y()()()()(),g.I0R(15,"div",10)(16,"div",11)(17,"button",12),g.qCj("click",function(){return oe.cancel()}),g.OEk(18),g.wVc(19,"translate"),g.C$Y(),g.I0R(20,"button",13),g.qCj("click",function(){return oe.save()}),g.OEk(21),g.wVc(22,"translate"),g.C$Y()()()),2&le){const se=g.Gew(12);g.yG2(),g.oRS(" ",g.kDX(2,12,"igo.geo.layer.saveFeatureInLayer"),"\n"),g.yG2(3),g.E7m("formGroup",oe.form),g.yG2(),g.E7m("navigation",!1)("selection",!1),g.yG2(),g.E7m("result",oe.feature)("showIcons",!0),g.yG2(3),g._6D("placeholder",g.kDX(10,14,"igo.geo.layer.chooseOrSet")),g.E7m("matAutocomplete",se),g.yG2(2),g.E7m("displayWith",oe.displayFn),g.yG2(2),g.E7m("ngForOf",g.kDX(14,16,oe.filteredLayers$)),g.yG2(5),g.oRS(" ",g.kDX(19,18,"igo.geo.layer.cancelBtn")," "),g.yG2(3),g.oRS(" ",g.kDX(22,20,"igo.geo.layer.saveBtn")," ")}},dependencies:[B.WQ,B.iU,K.y,K.sz,K.ot,K.ue,K.u,K.sl,K.uW,K.Wo,o.yM,D.g,o.qU,z.wb,z.Up,c.cN,c.yi,X.U1,X.e,V.I5,X.cG,C.Iw,V.Ax,I.iI,I.UV,B.Yp,d.oJ,d.Gw,C.a,f._s,U.sD],styles:["[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .create-layer-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   button#createLayerBtnDialog[disabled=true][_ngcontent-%COMP%]{cursor:default;background-color:#0000001f;color:#00000042}[_nghost-%COMP%]   .error[_ngcontent-%COMP%]{color:red}"]})}return fe})();function s(fe,Se){if(1&fe){const ae=g.KQA();g.I0R(0,"button",2),g.qCj("mouseenter",function(oe){g.usT(ae);const se=g.GaO();return g.CGJ(se.onMouseEvent(oe))})("mouseleave",function(oe){g.usT(ae);const se=g.GaO();return g.CGJ(se.onMouseEvent(oe))})("click",function(oe){g.usT(ae);const se=g.GaO();return g.CGJ(se.onToggleClick(oe))}),g.wVc(1,"translate"),g.wVc(2,"async"),g.I0R(3,"mat-icon",3),g.wVc(4,"async"),g.wVc(5,"async"),g.wVc(6,"async"),g.wVc(7,"async"),g.wVc(8,"async"),g.wVc(9,"async"),g.OEk(10),g.wVc(11,"async"),g.C$Y()()}if(2&fe){const ae=g.GaO();g.E7m("matTooltip",g.kDX(1,7,ae.computeTooltip()))("color",g.kDX(2,9,ae.isPreview$)?"":ae.added?"warn":""),g.yG2(3),g.E7m("igoMatBadgeIcon",ae.getBadgeIcon())("igoMatBadgeInverseColor",!0)("matBadgeHidden",g.kDX(4,11,ae.inRange$)&&!0===g.kDX(5,13,ae.isVisible$)||g.kDX(6,15,ae.inRange$)&&!ae.added||g.kDX(7,17,ae.inRange$)&&g.kDX(8,19,ae.isPreview$))("matBadgeDisabled",!1===g.kDX(9,21,ae.inRange$)),g.yG2(7),g.oRS("",g.kDX(11,23,ae.isPreview$)?"add":ae.added?"delete":"add"," ")}}function ie(fe,Se){if(1&fe){const ae=g.KQA();g.I0R(0,"button",4),g.qCj("click",function(){g.usT(ae);const oe=g.GaO();return g.CGJ(oe.addFeatureToLayer())}),g.wVc(1,"translate"),g.wVc(2,"async"),g.I0R(3,"mat-icon",5),g.wVc(4,"async"),g.OEk(5,"add_to_photos "),g.C$Y()()}if(2&fe){const ae=g.GaO();g.E7m("id",ae.isMobile?"":"hide-save-search-result-btn")("matTooltip",g.kDX(1,5,g.kDX(2,7,ae.addFeatureToLayerTooltip$))),g.yG2(3),g.E7m("igoMatBadgeInverseColor",!0)("matBadgeHidden",g.kDX(4,9,ae.inRange$))("matBadgeDisabled",!0)}}let de=(()=>{class fe{layerService;dialog;dataSourceService;mediaService;tooltip$=new T.g("igo.geo.catalog.layer.addToMap");addFeatureToLayerTooltip$=new T.g("igo.geo.search.addToLayer");resolution$$;layers$$;inRange$=new T.g(!0);isVisible$=new T.g(!1);isPreview$=new T.g(!1);layersSubcriptions=[];lastTimeoutRequest;mouseInsideAdd=!1;layer;store;added;map;saveSearchResultInLayer=!1;get color(){return this._color}set color(ae){this._color=ae}_color="primary";stores=[];get allLayers(){return this.map.layers.filter(ae=>String(ae.id).includes("igo-search-layer"))}mediaService$$;isMobile=!1;constructor(ae,le,oe,se){this.layerService=ae,this.dialog=le,this.dataSourceService=oe,this.mediaService=se}ngOnInit(){this.mediaService$$=this.mediaService.media$.subscribe(ae=>{ae===h.oZ.Mobile&&(this.isMobile=!0)}),"Layer"===this.layer.meta.dataType&&(this.added=-1!==this.map.layers.findIndex(ae=>ae.id===this.layer.data.sourceOptions.id)),this.layers$$=this.map.layers$.subscribe(()=>{this.isVisible()}),this.resolution$$=this.map.viewController.resolution$.subscribe(ae=>{this.isInResolutionsRange(ae),this.isVisible()})}ngOnDestroy(){this.resolution$$.unsubscribe(),this.layers$$.unsubscribe(),this.mediaService$$&&this.mediaService$$.unsubscribe()}onMouseEvent(ae){this.onToggleClick(ae)}onToggleClick(ae){typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);const le=ae||{};if("mouseenter"!==le.type||!this.mouseInsideAdd)switch(le.type){case"click":this.isPreview$.value||(this.added?this.remove():this.add(le)),this.isPreview$.next(!1);break;case"mouseenter":!this.isPreview$.value&&!this.added&&(this.lastTimeoutRequest=setTimeout(()=>{this.add(le),this.isPreview$.next(!0)},500)),this.mouseInsideAdd=!0;break;case"mouseleave":this.isPreview$.value&&(this.remove(),this.isPreview$.next(!1)),this.mouseInsideAdd=!1}}add(ae){this.added||(this.added=!0,this.addLayerToMap(ae))}remove(){this.added&&(this.added=!1,this.removeLayerFromMap(),this.layersSubcriptions.map(ae=>ae.unsubscribe()),this.layersSubcriptions=[])}addLayerToMap(ae){if(void 0===this.map||this.layer.meta.dataType!==k.i)return;const le=this.layer.data;void 0===le.sourceOptions.optionsFromApi&&(le.sourceOptions.optionsFromApi=!0),this.layersSubcriptions.push(this.layerService.createAsyncLayer(le).subscribe(oe=>{"click"===ae.type&&this.map.layersAddedByClick$.next([oe]),this.map.addLayer(oe)}))}removeLayerFromMap(){if(void 0===this.map||this.layer.meta.dataType!==k.i)return;const ae=this.map.getLayerById(this.layer.data.sourceOptions.id);this.map.removeLayer(ae)}isInResolutionsRange(ae){this.inRange$.next(ae>=(this.layer.data.minResolution||0)&&ae<=(this.layer.data.maxResolution||1/0))}isVisible(){if(this.layer?.data?.sourceOptions?.id){const ae=this.map.getLayerById(this.layer.data.sourceOptions.id);this.isVisible$.next(!!ae&&ae.visible)}}getBadgeIcon(){return this.inRange$.value&&this.isVisible$.value?"":"visibility_off"}computeTooltip(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?this.isVisible$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapNotVisible":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"}addFeatureToLayer(){"Feature"===this.layer.meta.dataType&&this.dialog.open(H,{width:"700px",data:{feature:this.layer,layers:this.allLayers}}).afterClosed().subscribe(oe=>{if(oe)if(this.stores.length>0&&this.stores.map(se=>(se.state.updateAll({selected:!1}),se?.layer&&(se.layer.visible=!1),se)),"string"==typeof oe.layer)this.createLayer(oe.layer,oe.feature);else{const se=this.stores.find(me=>me.layer.id===oe.layer.id);se.layer.visible=!0,se.layer.opacity=1,this.addFeature(oe.feature,se)}})}createLayer(ae,le){const oe=new A.ym([],{map:this.map}),se=[new x.cp({image:new R.c({radius:5,stroke:new O.c({width:1,color:"rgba(143,7,7,1)"}),fill:new y.c({color:"rgba(143,7,7,1)"})})}),new x.cp({stroke:new O.c({width:1,color:"rgba(143,7,7,1)"}),fill:new y.c({color:"rgba(0, 0, 255, 0.1)"})})];let me=0;for(const be of this.allLayers){let ke=Number(be.id.replace("igo-search-layer",""));me=Math.max(ke,me)}this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,a.U)(1)).subscribe(be=>{let ke=new w.M({isIgoInternalLayer:!0,id:"igo-search-layer"+ ++me,title:ae,source:be,igoStyle:{editable:!1,igoStyleObject:{fill:{color:"rgba(255,255,255,0.4)"},stroke:{color:"rgba(143,7,7,1)",width:1},circle:{fill:{color:"rgba(255,255,255,0.4)"},stroke:{color:"rgba(143,7,7,1)",width:1},radius:5}}},style:se,showInLayerList:!0,exportable:!0,workspace:{enabled:!0}});(0,A.mM)(oe,ke),(0,A.sf)(oe,new A.E9({motion:A.Su.None})),(0,A.Uz)(oe,new A.kj({map:this.map,motion:A.Su.None,many:!0})),oe.layer.visible=!0,oe.source.ol.on("removefeature",qe=>{const nt=qe.feature.getGeometry();this.clearLabelsOfOlGeometry(nt)}),this.addFeature(le,oe),this.stores.push(oe)})}addFeature(ae,le){const oe={type:ae.data.type,geometry:{coordinates:ae.data.geometry.coordinates,type:ae.data.geometry.type},projection:ae.data.projection,properties:ae.data.properties,meta:{id:ae.meta.id}};delete oe.properties.Route,le.update(oe),le.setLayerExtent(),le.layer.ol.getSource().refresh()}clearLabelsOfOlGeometry(ae){(0,Z.aK)(ae).forEach(le=>{le&&le.getMap()&&this.map.ol.removeOverlay(le)})}static \u0275fac=function(le){return new(le||fe)(g.GI1(W.I),g.GI1(B.qW),g.GI1(F.O),g.GI1(h.QB))};static \u0275cmp=g.In1({type:fe,selectors:[["igo-search-add-button"]],inputs:{layer:"layer",store:"store",added:"added",map:"map",saveSearchResultInLayer:"saveSearchResultInLayer",color:"color",stores:"stores"},standalone:!0,features:[g.UHJ],decls:2,vars:2,consts:[["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click",4,"ngIf"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"id","matTooltip","click",4,"ngIf"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click"],["aria-hidden","false","matBadge","icon","igoMatBadgeColor","rgba(0,0,0,0.87)","igoMatBadgeBackgroundColor","none","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeIcon","igoMatBadgeInverseColor","matBadgeHidden","matBadgeDisabled"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"id","matTooltip","click"],["aria-hidden","false","matBadge","icon","igoMatBadgeIcon","visibility_off","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeInverseColor","matBadgeHidden","matBadgeDisabled"]],template:function(le,oe){1&le&&g.yuY(0,s,12,25,"button",0)(1,ie,6,11,"button",1),2&le&&(g.E7m("ngIf","Layer"===oe.layer.meta.dataType),g.yG2(),g.E7m("ngIf","Feature"===oe.layer.meta.dataType&&oe.saveSearchResultInLayer))},dependencies:[C.u_,d.oJ,d.um,o.mw,P.KO,P.a4,L.oB,L.qL,e.g,e.S,o.qS,C.a,f._s,U.sD],styles:["[_nghost-%COMP%]   #hide-save-search-result-btn[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   #show-save-search-result-btn[_ngcontent-%COMP%]{display:block}"],changeDetection:0})}return fe})()},66908:(Fe,ce,r)=>{"use strict";r.d(ce,{g:()=>W});var C=r(65056),e=r(34896),d=r(34672),L=r(32328),P=r(63916),o=r(27e3),f=r(53e3),h=r(12396),R=r(39844);function O(w,te){if(1&w&&(e.I0R(0,"mat-icon",6),e.OEk(1),e.C$Y()),2&w){const Z=e.GaO();e.yG2(),e.cNF(Z.showIcons?Z.icon:"blank")}}function x(w,te){if(1&w&&e.wR5(0,"div",7),2&w){const Z=e.GaO();e.E7m("innerHtml",Z.titleHtml,e.E3n)("matTooltip",Z.tooltipHtml)}}function T(w,te){if(1&w&&(e.I0R(0,"span",9),e.OEk(1),e.C$Y()),2&w){const Z=e.GaO(2);e.E7m("matTooltip",Z.title),e.yG2(),e.cNF(Z.title)}}function a(w,te){if(1&w&&e.yuY(0,T,2,2,"span",8),2&w){const Z=e.GaO();e.E7m("ngIf",!Z.titleHtml)}}function F(w,te){if(1&w){const Z=e.KQA();e.I0R(0,"button",10),e.qCj("click",function(){e.usT(Z);const X=e.GaO();return e.CGJ(X.onZoomHandler())}),e.I0R(1,"mat-icon"),e.OEk(2,"search"),e.C$Y()()}}r(89500);const A=[[["","igoSearchItemToolbar",""]]],k=["[igoSearchItemToolbar]"];let W=(()=>{class w{result;map;showIcons;withZoomButton=!1;zoomEvent=new e._w7;format=new h.c;get title(){return(0,f.YB)(this.result)}get titleHtml(){return(0,f.E$)(this.result)}get tooltipHtml(){return this.titleHtml.replace(/<small?[^>]+(>|$)/g,"\n").replace(/<\/?[^>]+(>|$)/g,"")}get icon(){return(0,f.sH)(this.result)}onZoomHandler(){const Z=this.format.readFeature(this.result.data,{dataProjection:this.result.data.projection,featureProjection:this.map.projection});(0,R.QX)(this.map.viewController,[Z],R.Su.Default)}onMouseEvent(Z){const K=Z.target;switch(Z.type){case"mouseenter":const V=K.querySelector("#hide-save-search-result-btn");V&&V.setAttribute("id","show-save-search-result-btn");break;case"mouseleave":const B=K.querySelector("#show-save-search-result-btn");B&&B.setAttribute("id","hide-save-search-result-btn")}}static \u0275fac=function(K){return new(K||w)};static \u0275cmp=e.In1({type:w,selectors:[["igo-search-results-item"]],inputs:{result:"result",map:"map",showIcons:"showIcons",withZoomButton:"withZoomButton"},outputs:{zoomEvent:"zoomEvent"},standalone:!0,features:[e.UHJ],ngContentSelectors:k,decls:8,vars:4,consts:[[3,"mouseenter","mouseleave"],["matListItemIcon","",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500","matTooltipClass","search-result-tooltip",3,"innerHtml","matTooltip",4,"ngIf","ngIfElse"],["normalTitle",""],["matListItemMeta",""],["igoStopPropagation","","mat-icon-button","",3,"click",4,"ngIf"],["matListItemIcon",""],["matListItemTitle","","matTooltipShowDelay","500","matTooltipClass","search-result-tooltip",3,"innerHtml","matTooltip"],["matListItemTitle","","matTooltipShowDelay","500",3,"matTooltip",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"matTooltip"],["igoStopPropagation","","mat-icon-button","",3,"click"]],template:function(K,X){if(1&K&&(e.kPM(A),e.I0R(0,"mat-list-item",0),e.qCj("mouseenter",function(B){return X.onMouseEvent(B)})("mouseleave",function(B){return X.onMouseEvent(B)}),e.yuY(1,O,2,1,"mat-icon",1)(2,x,1,2,"div",2)(3,a,1,1,"ng-template",null,3,e.gJz),e.I0R(5,"div",4),e.yuY(6,F,3,0,"button",5),e._Xx(7),e.C$Y()()),2&K){const V=e.Gew(4);e.yG2(),e.E7m("ngIf",X.icon),e.yG2(),e.E7m("ngIf",X.titleHtml)("ngIfElse",V),e.yG2(4),e.E7m("ngIf",X.withZoomButton)}},dependencies:[P.iI,P.g9,P.Y1,P.UV,P.At,C.u_,L.oB,L.qL,o.KO,o.a4,d.oJ,d.um,f.mw],styles:["[_nghost-%COMP%]     small{color:#8c8c8c}[_nghost-%COMP%]   div[matlistitemmeta][_ngcontent-%COMP%]:empty{display:none}[_nghost-%COMP%]     .search-result-tooltip{white-space:pre-line}"],changeDetection:0})}return w})()},69800:(Fe,ce,r)=>{"use strict";r.d(ce,{T:()=>ae});var C=r(65056),e=r(34896),d=r(18268),L=r(53e3),P=r(9204),o=r(24708),f=r(54844),h=r(54584),R=r(43451),y=r(25376),O=r(40604),T=(r(89500),r(29216)),a=r(66908),F=r(72584);const A=["igoSearchItemToolbar"];function k(le,oe){1&le&&e.C_f(0)}const W=le=>({results:le});function w(le,oe){if(1&le){const se=e.KQA();e.I0R(0,"igo-collapsible",7),e.qCj("toggle",function(be){e.usT(se);const ke=e.GaO().$implicit,qe=e.GaO(2);return e.CGJ(qe.collapsed[ke.source.title]=be)}),e.yuY(1,k,1,0,"ng-container",8),e.C$Y()}if(2&le){const se=e.GaO().$implicit,me=e.Gew(4),be=e.GaO(2);e.m8U(se.source.getId()),e.E7m("title",be.computeGroupTitle(se))("collapsed",be.collapsed[se.source.title]),e.yG2(),e.E7m("ngTemplateOutlet",me)("ngTemplateOutletContext",e.S45(6,W,se.results))}}function te(le,oe){1&le&&e.C_f(0)}function Z(le,oe){if(1&le&&e.yuY(0,te,1,0,"ng-container",8),2&le){const se=e.GaO().$implicit,me=e.Gew(4);e.E7m("ngTemplateOutlet",me)("ngTemplateOutletContext",e.S45(2,W,se.results))}}const K=le=>({result:le});function X(le,oe){if(1&le){const se=e.KQA();e.I0R(0,"igo-search-results-item",10),e.qCj("focus",function(){const ke=e.usT(se).$implicit,qe=e.GaO(4);return e.CGJ(qe.resultFocus.emit(ke))})("unfocus",function(){const ke=e.usT(se).$implicit,qe=e.GaO(4);return e.CGJ(qe.resultUnfocus.emit(ke))})("select",function(){const ke=e.usT(se).$implicit,qe=e.GaO(4);return e.CGJ(qe.onResultSelect(ke))})("mouseenter",function(){const ke=e.usT(se).$implicit,qe=e.GaO(4);return e.CGJ(qe.resultFocus.emit(ke))})("mouseleave",function(){const ke=e.usT(se).$implicit,qe=e.GaO(4);return e.CGJ(qe.resultUnfocus.emit(ke))}),e.C_f(1,11),e.C$Y()}if(2&le){const se=oe.$implicit,me=e.GaO(4);e.E7m("map",me.map)("result",se)("showIcons",me.showIcons)("withZoomButton",me.withZoomButton)("focused",me.store.state.get(se).focused)("selected",me.store.state.get(se).selected),e.yG2(),e.E7m("ngTemplateOutlet",me.templateSearchToolbar)("ngTemplateOutletContext",e.S45(8,K,se))}}function V(le,oe){if(1&le){const se=e.KQA();e.I0R(0,"span",12),e.qCj("click",function(){e.usT(se);const be=e.GaO(2).$implicit,ke=e.GaO(2);return e.CGJ(ke.displayMoreResults(be))}),e.I0R(1,"u"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()}2&le&&(e.yG2(2),e.cNF(e.kDX(3,1,"igo.geo.search.displayMoreResults")))}function B(le,oe){if(1&le&&e.yuY(0,X,2,10,"ng-template",2)(1,V,4,3,"span",9),2&le){const se=oe.results,me=e.GaO().$implicit,be=e.GaO(2);e.E7m("ngForOf",se),e.yG2(),e.E7m("ngIf",be.isMoreResults(me))}}function z(le,oe){if(1&le&&e.yuY(0,w,2,8,"igo-collapsible",4)(1,Z,1,4,"ng-template",null,5,e.gJz)(3,B,2,2,"ng-template",null,6,e.gJz),2&le){const se=e.Gew(2),me=e.GaO(2);e.E7m("ngIf",me.mode===me.searchResultMode.Grouped)("ngIfElse",se)}}function c(le,oe){if(1&le&&(e.I0R(0,"igo-list",1),e.yuY(1,z,5,2,"ng-template",2,3,e.gJz),e.wVc(3,"async"),e.C$Y()),2&le){const se=e.GaO();e.E7m("navigation",!0),e.yG2(),e.E7m("ngForOf",e.kDX(3,2,se.results$))}}function I(le,oe){1&le&&e.C_f(0)}function b(le,oe){1&le&&e.C_f(0)}const G=le=>({group:le});function D(le,oe){if(1&le&&(e.I0R(0,"mat-tab",17),e.yuY(1,b,1,0,"ng-container",8),e.C$Y()),2&le){const se=oe.$implicit;e.GaO(2);const me=e.Gew(7),be=e.GaO();e.E7m("label",be.computeGroupTitle(se)),e.yG2(),e.E7m("ngTemplateOutlet",me)("ngTemplateOutletContext",e.S45(3,G,se))}}function g(le,oe){if(1&le&&(e.I0R(0,"mat-tab-group",15),e.yuY(1,D,2,5,"mat-tab",16),e.wVc(2,"async"),e.C$Y()),2&le){const se=e.GaO(2);e.yG2(),e.E7m("ngForOf",e.kDX(2,1,se.results$))}}function U(le,oe){1&le&&e.C_f(0)}function M(le,oe){if(1&le&&e.yuY(0,U,1,0,"ng-container",8),2&le){const se=oe.$implicit;e.GaO(2);const me=e.Gew(7);e.E7m("ngTemplateOutlet",me)("ngTemplateOutletContext",e.S45(2,G,se))}}function H(le,oe){if(1&le&&(e.yuY(0,M,1,4,"ng-template",2),e.wVc(1,"async")),2&le){const se=e.GaO(2);e.E7m("ngForOf",e.kDX(1,1,se.results$))}}function s(le,oe){if(1&le){const se=e.KQA();e.I0R(0,"igo-search-results-item",10),e.qCj("focus",function(){const ke=e.usT(se).$implicit,qe=e.GaO(3);return e.CGJ(qe.resultFocus.emit(ke))})("unfocus",function(){const ke=e.usT(se).$implicit,qe=e.GaO(3);return e.CGJ(qe.resultUnfocus.emit(ke))})("select",function(){const ke=e.usT(se).$implicit,qe=e.GaO(3);return e.CGJ(qe.onResultSelect(ke))})("mouseenter",function(){const ke=e.usT(se).$implicit,qe=e.GaO(3);return e.CGJ(qe.resultFocus.emit(ke))})("mouseleave",function(){const ke=e.usT(se).$implicit,qe=e.GaO(3);return e.CGJ(qe.resultUnfocus.emit(ke))}),e.C_f(1,11),e.C$Y()}if(2&le){const se=oe.$implicit,me=e.GaO(3);e.E7m("map",me.map)("result",se)("showIcons",me.showIcons)("withZoomButton",me.withZoomButton)("focused",me.store.state.get(se).focused)("selected",me.store.state.get(se).selected),e.yG2(),e.E7m("ngTemplateOutlet",me.templateSearchToolbar)("ngTemplateOutletContext",e.S45(8,K,se))}}function ie(le,oe){if(1&le){const se=e.KQA();e.I0R(0,"span",12),e.qCj("click",function(){e.usT(se);const be=e.GaO().group,ke=e.GaO(2);return e.CGJ(ke.displayMoreResults(be))}),e.I0R(1,"u"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()}2&le&&(e.yG2(2),e.cNF(e.kDX(3,1,"igo.geo.search.displayMoreResults")))}function de(le,oe){if(1&le&&e.yuY(0,s,2,10,"ng-template",2)(1,ie,4,3,"span",9),2&le){const se=oe.group,me=e.GaO(2);e.E7m("ngForOf",se.results),e.yG2(),e.E7m("ngIf",me.isMoreResults(se))}}function fe(le,oe){if(1&le&&(e.I0R(0,"igo-list",1),e.yuY(1,I,1,0,"ng-container",13)(2,g,3,3,"ng-template",null,14,e.gJz)(4,H,2,3,"ng-template",null,5,e.gJz)(6,de,2,2,"ng-template",null,6,e.gJz),e.C$Y()),2&le){const se=e.Gew(3),me=e.Gew(5),be=e.GaO();e.E7m("navigation",!0),e.yG2(),e.E7m("ngIf",be.mode===be.searchResultMode.Grouped)("ngIfThen",se)("ngIfElse",me)}}var Se=function(le){return le.Grouped="grouped",le.Flat="flat",le}(Se||{});let ae=(()=>{class le{cdRef;searchService;configService;showResultsCount=!0;searchResultMode=Se;watcher;settingsChange$$;pageIterator=[];collapsed=[];map;store;showIcons;mode=Se.Grouped;withZoomButton=!1;tabsMode=!1;get term(){return this._term}set term(se){this._term=se,this.pageIterator=[]}_term;settingsChange$=new f.g(void 0);termSplitter="|";resultFocus=new e._w7;resultUnfocus=new e._w7;resultSelect=new e._w7;moreResults=new e._w7;resultMouseenter=new e._w7;resultMouseleave=new e._w7;templateSearchToolbar;get results$(){return void 0===this._results$&&(this._results$=this.liftResults()),this._results$}_results$;constructor(se,me,be){this.cdRef=se,this.searchService=me,this.configService=be}ngOnInit(){this.watcher=new L.YX(this.store,this.cdRef),this.settingsChange$$=this.settingsChange$.subscribe(()=>{this.pageIterator=[]}),!1===this.configService.getConfig("searchSources.showResultsCount")&&(this.showResultsCount=!1)}ngOnDestroy(){this.watcher.destroy(),this.settingsChange$$.unsubscribe()}computeGroupTitle(se){const me=[se.source.title],be=se.results.length;return be>1&&this.showResultsCount&&me.push(`(${be})`),me.join(" ")}onResultSelect(se){this.store.state.get(se)&&!0===this.store.state.get(se).selected||(this.store.state.update(se,{focused:!0,selected:!0},!0),this.resultSelect.emit(se))}liftResults(){return this.store.stateView.all$().pipe((0,y.C)(se=>0===se.length?h.k:(0,R.k)(200)),(0,O.k)(se=>this.groupResults(se.map(me=>me.entity).sort(this.sortByOrder))))}sortByOrder(se,me){return se.source.displayOrder-me.source.displayOrder}groupResults(se){const me=new Map;return se.forEach(be=>{const ke=be.source;let qe=me.get(ke);void 0===qe&&(qe=[],me.set(ke,qe)),qe.push(be)}),Array.from(me.keys()).map(be=>(void 0===this.pageIterator[be.getId()]&&(this.pageIterator[be.getId()]=1),{source:be,results:me.get(be)}))}isMoreResults(se){return this.store.getStrategyOfType(L.qq)?.active?se.results?.length%+se.source.params.limit==0&&+se.source.params.page<30:se.results&&!0===se.results[se.results.length-1].meta.nextPage}displayMoreResults(se){const me={sourceId:se.source.getId(),page:++this.pageIterator[se.source.getId()]};let be;be=this.termSplitter&&this.term.match(new RegExp(this.termSplitter,"g"))?this.term.split(this.termSplitter):[this.term];let ke=[];be.map(qe=>{ke=ke.concat(this.searchService.search(qe,me))}),ke.map(qe=>{qe.request.subscribe(nt=>{const Ue=se.results.concat(nt);nt.length||(Ue[Ue.length-1].meta.nextPage=!1),this.moreResults.emit({research:qe,results:Ue})})})}static \u0275fac=function(me){return new(me||le)(e.GI1(e.kD9),e.GI1(T._),e.GI1(P.aW))};static \u0275cmp=e.In1({type:le,selectors:[["igo-search-results"]],contentQueries:function(me,be,ke){if(1&me&&e.szK(ke,A,5),2&me){let qe;e.wto(qe=e.Gqi())&&(be.templateSearchToolbar=qe.first)}},inputs:{map:"map",store:"store",showIcons:"showIcons",mode:"mode",withZoomButton:"withZoomButton",tabsMode:"tabsMode",term:"term",settingsChange$:"settingsChange$",termSplitter:"termSplitter"},outputs:{resultFocus:"resultFocus",resultUnfocus:"resultUnfocus",resultSelect:"resultSelect",moreResults:"moreResults",resultMouseenter:"resultMouseenter",resultMouseleave:"resultMouseleave"},standalone:!0,features:[e.UHJ],decls:2,vars:2,consts:[[3,"navigation",4,"ngIf"],[3,"navigation"],["ngFor","",3,"ngForOf"],["groupTemplate",""],[3,"class","title","collapsed","toggle",4,"ngIf","ngIfElse"],["flatTemplate",""],["storeItemTemplate",""],[3,"title","collapsed","toggle"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","moreResults mat-typography",3,"click",4,"ngIf"],["igoListItem","","color","accent",3,"map","result","showIcons","withZoomButton","focused","selected","focus","unfocus","select","mouseenter","mouseleave"],["igoSearchItemToolbar","",3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"moreResults","mat-typography",3,"click"],[4,"ngIf","ngIfThen","ngIfElse"],["tabsTemplate",""],["dynamicHeight","",1,"custom-tabs-view"],[3,"label",4,"ngFor","ngForOf"],[3,"label"]],template:function(me,be){1&me&&e.yuY(0,c,4,4,"igo-list",0)(1,fe,8,4,"igo-list",0),2&me&&(e.E7m("ngIf",!1===be.tabsMode),e.yG2(),e.E7m("ngIf",be.tabsMode))},dependencies:[C.u_,L.yM,C.Iw,L.ii,C.XV,a.g,L.qU,d.WG,d.aJ,d._q,C.a,o._s,F.sD],styles:["[_nghost-%COMP%]   .moreResults[_ngcontent-%COMP%]{cursor:pointer;color:#00f;float:right;margin-right:10px;margin-top:5px}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]     mat-list{height:100%}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]     mat-list .custom-tabs-view .mat-mdc-tab-header-pagination{min-width:20px}"],changeDetection:0})}return le})()},1560:(Fe,ce,r)=>{"use strict";r.d(ce,{s:()=>F});var C=r(65056),e=r(34896),d=r(34672),L=r(32328),P=r(87848),o=r(21232),f=r(27e3),h=r(24708),R=r(54844),y=r(11484),O=r(29220),x=r(83456),T=r(72584);function a(A,k){if(1&A&&(e.I0R(0,"mat-radio-button",6),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&A){const W=k.$implicit,w=e.GaO();e.E7m("value",W),e.yG2(),e.oRS(" ",e.kDX(2,2,w.getSearchTypeTitle(W))," ")}}let F=(()=>{class A{searchSourceService;searchType$=new R.g(void 0);searchType$$;searchTypes=O.a;set searchType(W){this.setSearchType(W)}get searchType(){return this.searchType$.value}searchTypeChange=new e._w7;constructor(W){this.searchSourceService=W}ngOnInit(){this.searchType$$=this.searchType$.pipe((0,y.a)()).subscribe(W=>this.onSetSearchType(W))}ngOnDestroy(){this.searchType$$.unsubscribe()}onSearchTypeChange(W){this.setSearchType(W)}getSearchTypeTitle(W){return`igo.geo.search.${W.toLowerCase()}.title`}setSearchType(W){this.searchType$.next(W)}onSetSearchType(W){null!=W&&(this.searchSourceService.enableSourcesByType(W),this.searchTypeChange.emit(W))}static \u0275fac=function(w){return new(w||A)(e.GI1(x.i))};static \u0275cmp=e.In1({type:A,selectors:[["igo-search-selector"]],inputs:{searchTypes:"searchTypes",searchType:"searchType"},outputs:{searchTypeChange:"searchTypeChange"},standalone:!0,features:[e.UHJ],decls:10,vars:8,consts:[[1,"igo-search-selector"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"igo-search-selector-button",3,"matTooltip","matMenuTriggerFor"],["xPosition","before","yPosition","above",1,"no-border-radius"],["searchSelectorMenu","matMenu"],[1,"igo-search-selector-radio-group",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(w,te){if(1&w&&(e.I0R(0,"div",0)(1,"button",1),e.wVc(2,"translate"),e.I0R(3,"mat-icon"),e.OEk(4,"arrow_drop_down"),e.C$Y()(),e.I0R(5,"mat-menu",2,3)(7,"mat-radio-group",4),e.qCj("change",function(K){return te.onSearchTypeChange(K.value)}),e.wVc(8,"async"),e.yuY(9,a,3,4,"mat-radio-button",5),e.C$Y()()()),2&w){const Z=e.Gew(6);e.yG2(),e.E7m("matTooltip",e.kDX(2,4,"igo.geo.search.menu.tooltip"))("matMenuTriggerFor",Z),e.yG2(6),e.E7m("value",e.kDX(8,6,te.searchType$)),e.yG2(2),e.E7m("ngForOf",te.searchTypes)}},dependencies:[d.oJ,d.um,f.KO,f.a4,P._A,P.aM,P.yG,L.oB,L.qL,o.yk,o.cv,o.cT,C.Iw,C.a,h._s,T.sD],styles:["[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]{border-radius:0}[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-search-selector-radio-group[_ngcontent-%COMP%]{display:inline-flex;flex-direction:column}[_nghost-%COMP%]   .igo-search-selector-radio-group[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin:5px}"],changeDetection:0})}return A})()},50620:(Fe,ce,r)=>{"use strict";r.d(ce,{Q:()=>I});var C=r(65056),e=r(34896),d=r(34672),L=r(58539),P=r(75180),o=r(32328),f=r(87848),h=r(21232),R=r(43424),y=r(27e3),O=r(24708),x=r(9588),T=r(21720),a=r(14452),F=r(83456),A=r(72584);function k(b,G){if(1&b){const D=e.KQA();e.I0R(0,"div",10)(1,"button",11),e.qCj("click",function(U){e.usT(D);const M=e.GaO();return e.CGJ(M.checkUncheckAllSources(U))}),e.OEk(2),e.wVc(3,"translate"),e.wVc(4,"translate"),e.C$Y()()}if(2&b){const D=e.GaO();e.yG2(2),e.oRS(" ",D.searchSourcesAllEnabled?e.kDX(4,3,"igo.geo.search.searchSources.selectAll"):e.kDX(3,1,"igo.geo.search.searchSources.unselectAll")," ")}}function W(b,G){if(1&b&&(e.I0R(0,"button",17),e.OEk(1),e.C$Y()),2&b){const D=e.GaO().$implicit,g=e.Gew(6);e.E7m("matMenuTriggerFor",g),e.yG2(),e.oRS(" ",D.title," ")}}function w(b,G){if(1&b&&(e.I0R(0,"button",7),e.OEk(1),e.C$Y()),2&b){const D=e.GaO().$implicit;e.yG2(),e.oRS(" ",D.title," ")}}function te(b,G){if(1&b){const D=e.KQA();e.I0R(0,"mat-radio-button",23),e.qCj("click",function(U){return U.stopPropagation()})("change",function(U){const H=e.usT(D).$implicit,s=e.GaO(2).$implicit,ie=e.GaO().$implicit,de=e.GaO();return e.CGJ(de.settingsValueCheckedRadioButton(U,ie,s,H))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&b){const D=G.$implicit,g=e.GaO(4);e.E7m("value",D)("matTooltip",g.getAvailableHashtagsValues(D))("checked",D.enabled),e.yG2(),e.oRS(" ",e.kDX(2,4,D.title)," ")}}function Z(b,G){if(1&b&&(e.I0R(0,"span")(1,"mat-radio-group",21),e.yuY(2,te,3,6,"mat-radio-button",22),e.C$Y()()),2&b){const D=e.GaO().$implicit;e.yG2(),e.E7m("value",D),e.yG2(),e.E7m("ngForOf",D.values)}}function K(b,G){if(1&b){const D=e.KQA();e.I0R(0,"div",10)(1,"button",11),e.qCj("click",function(U){e.usT(D);const M=e.GaO(2).$implicit,H=e.GaO().$implicit,s=e.GaO();return e.CGJ(s.checkUncheckAll(U,H,M))}),e.OEk(2),e.wVc(3,"translate"),e.wVc(4,"translate"),e.C$Y()()}if(2&b){const D=e.GaO(2).$implicit;e.yG2(2),e.oRS(" ",D.allEnabled||void 0===D.allEnabled?e.kDX(3,1,"igo.geo.search.searchSources.settings.unselectAll"):e.kDX(4,3,"igo.geo.search.searchSources.settings.selectAll")," ")}}function X(b,G){if(1&b){const D=e.KQA();e.I0R(0,"div",25)(1,"mat-checkbox",26),e.qCj("click",function(U){return U.stopPropagation()})("change",function(U){const H=e.usT(D).$implicit,s=e.GaO(2).$implicit,ie=e.GaO().$implicit,de=e.GaO();return e.CGJ(de.settingsValueCheckedCheckbox(U,ie,s,H))}),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()}if(2&b){const D=G.$implicit,g=e.GaO(2).$implicit,U=e.GaO(2);e.yG2(),e.m4B("display",U.displayBlock),e.E7m("checked",D.enabled)("value",g)("matTooltip",U.getAvailableHashtagsValues(D)),e.yG2(),e.oRS(" ",e.kDX(3,6,D.title)," ")}}function V(b,G){if(1&b&&(e.I0R(0,"span"),e.yuY(1,K,5,5,"div",4)(2,X,4,8,"div",24),e.C$Y()),2&b){const D=e.GaO().$implicit,g=e.GaO(2);e.yG2(),e.E7m("ngIf",D.values.length>3),e.yG2(),e.E7m("ngForOf",g.getAvailableValues(D))}}function B(b,G){if(1&b&&(e.SAx(0),e.I0R(1,"button",17),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"mat-menu",18,19),e.yuY(6,Z,3,2,"span",20)(7,V,3,2,"span",20),e.C$Y(),e.k70()),2&b){const D=G.$implicit,g=e.Gew(5);e.yG2(),e.E7m("matMenuTriggerFor",g),e.yG2(),e.oRS(" ",e.kDX(3,5,"igo.geo.search.searchSources.settings."+D.title)," "),e.yG2(2),e.E7m("ngSwitch",D.type),e.yG2(2),e.E7m("ngSwitchCase","radiobutton"),e.yG2(),e.E7m("ngSwitchCase","checkbox")}}function z(b,G){if(1&b){const D=e.KQA();e.SAx(0),e.I0R(1,"span",12)(2,"mat-checkbox",13),e.qCj("click",function(U){return U.stopPropagation()})("change",function(U){const H=e.usT(D).$implicit,s=e.GaO();return e.CGJ(s.onCheckSearchSource(U,H))}),e.C$Y(),e.yuY(3,W,2,2,"button",14)(4,w,2,1,"button",15),e.C$Y(),e.I0R(5,"mat-menu",null,16),e.yuY(7,B,8,7,"ng-container",5),e.C$Y(),e.k70()}if(2&b){const D=G.$implicit;e.yG2(2),e.E7m("checked",D.enabled)("value",D),e.yG2(),e.E7m("ngIf",D.settings.length>0),e.yG2(),e.E7m("ngIf",0===D.settings.length),e.yG2(3),e.E7m("ngForOf",D.settings)}}function c(b,G){if(1&b){const D=e.KQA();e.I0R(0,"mat-slide-toggle",9),e.qCj("change",function(U){e.usT(D);const M=e.GaO();return e.CGJ(M.changePointerReverseSearch(U))})("click",function(U){return U.stopPropagation()}),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()}if(2&b){const D=e.GaO();e.E7m("matTooltip",e.kDX(1,3,"igo.geo.search.pointerSearchSummary.tooltip"))("checked",D.pointerSummaryEnabled),e.yG2(2),e.oRS(" ",e.kDX(3,5,"igo.geo.search.pointerSearchSummary.title")," ")}}let I=(()=>{class b{searchSourceService;mediaService;storageService;hasPointerReverseSearchSource=!1;searchSourcesAllEnabled=!1;buffer=[];lastKeyTime=Date.now();displayBlock="block";get isTouchScreen(){return this.mediaService.isTouchScreen()}pointerSummaryEnabled=!1;searchResultsGeometryEnabled=!1;reverseSearchCoordsFormatEnabled=!1;searchSourceChange=new e._w7;pointerSummaryStatus=new e._w7;searchResultsGeometryStatus=new e._w7;reverseSearchCoordsFormatStatus=new e._w7;handleKeyboardEvent(D){"F2"===D.key&&(this.pointerSummaryEnabled=!this.pointerSummaryEnabled,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled))}constructor(D,g,U){this.searchSourceService=D,this.mediaService=g,this.storageService=U}ngOnInit(){this.hasPointerReverseSearchSource=this.hasReverseSearchSourcesForPointerSummary()}getSearchSources(){const D=this.searchSourceService.getSources().filter(a.ay).filter(M=>M.available&&"map"!==M.getId()&&M.showInSettings),g=this.searchSourceService.getSources().filter(a.ae).filter(M=>M.available&&"map"!==M.getId()&&M.showInSettings),U=D.concat(g);return this.computeSourcesCheckAllBehavior(U),U}hasReverseSearchSourcesForPointerSummary(){return!!this.searchSourceService.getEnabledSources().filter(a.ig).length}settingsValueCheckedCheckbox(D,g,U,M){M.enabled=D.checked,g.setParamFromSetting(U),this.searchSourceChange.emit(g)}computeSettingCheckAllBehavior(D){D.allEnabled=void 0===D.allEnabled?!D.values.find(g=>g.enabled):!D.allEnabled}computeSourcesCheckAllBehavior(D){const g=D.filter(M=>M.enabled).length,U=D.filter(M=>!M.enabled).length;this.searchSourcesAllEnabled=!(g>=U)}checkUncheckAll(D,g,U){D.stopPropagation(),this.computeSettingCheckAllBehavior(U),U.values.forEach(M=>{M.enabled=U.allEnabled}),g.setParamFromSetting(U),this.searchSourceChange.emit(g)}checkUncheckAllSources(D){D.stopPropagation(),this.getSearchSources().map(g=>{g.enabled=this.searchSourcesAllEnabled,this.searchSourceChange.emit(g)})}settingsValueCheckedRadioButton(D,g,U,M){U.values.forEach(H=>{H.enabled=H.value!==M.value?!D.source.checked:D.source.checked}),g.setParamFromSetting(U),this.searchSourceChange.emit(g)}onCheckSearchSource(D,g){g.enabled=D.checked;const U=this.storageService.get(g.getId()+".options")||{};U.enabled=g.enabled,this.storageService.set(g.getId()+".options",U),this.searchSourceChange.emit(g)}getAvailableValues(D){return D.values.filter(g=>!1!==g.available)}getAvailableHashtagsValues(D){if(D.hashtags)return D.hashtags.map(g=>"#"+g).join(", ")}stopPropagation(D){D.stopPropagation()}changePointerReverseSearch(D){this.pointerSummaryEnabled=D.checked,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled)}changeSearchResultsGeometry(D){this.searchResultsGeometryEnabled=D.checked,this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled)}reverseSearchCoordsFormat(D){this.reverseSearchCoordsFormatEnabled=D.checked,this.reverseSearchCoordsFormatStatus.emit(this.reverseSearchCoordsFormatEnabled)}static \u0275fac=function(g){return new(g||b)(e.GI1(F.i),e.GI1(x.QB),e.GI1(T.yQ))};static \u0275cmp=e.In1({type:b,selectors:[["igo-search-settings"]],hostBindings:function(g,U){1&g&&e.qCj("keydown",function(H){return U.handleKeyboardEvent(H)},!1,e.wLc)},inputs:{pointerSummaryEnabled:"pointerSummaryEnabled",searchResultsGeometryEnabled:"searchResultsGeometryEnabled",reverseSearchCoordsFormatEnabled:"reverseSearchCoordsFormatEnabled"},outputs:{searchSourceChange:"searchSourceChange",pointerSummaryStatus:"pointerSummaryStatus",searchResultsGeometryStatus:"searchResultsGeometryStatus",reverseSearchCoordsFormatStatus:"reverseSearchCoordsFormatStatus"},standalone:!0,features:[e.UHJ],decls:24,vars:23,consts:[[1,"igo-search-settings"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"igo-search-settings-button",3,"matTooltip","matMenuTriggerFor"],[1,"no-border-radius"],["searchSettingsMenu","matMenu"],["class","checkAllButton",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"pointer-summary-slide-toggle-container"],["mat-menu-item",""],["class","search-option","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","checked","change","click",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500",1,"search-option",3,"matTooltip","checked","change","click"],[1,"checkAllButton"],["mat-raised-button","",3,"click"],[1,"igo-search-settings-search-source"],[1,"igo-search-settings-checkbox",3,"checked","value","click","change"],["mat-menu-item","",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",4,"ngIf"],["sub_menu","matMenu"],["mat-menu-item","",3,"matMenuTriggerFor"],["yPosition","above",3,"ngSwitch"],["test_sub_menu","matMenu"],[4,"ngSwitchCase"],[1,"igo-search-settings-radio-group",3,"value"],["class","mat-typography",3,"value","matTooltip","checked","click","change",4,"ngFor","ngForOf"],[1,"mat-typography",3,"value","matTooltip","checked","click","change"],["class","igo-search-settings-sub-menu","mat-menu-item","",4,"ngFor","ngForOf"],["mat-menu-item","",1,"igo-search-settings-sub-menu"],[3,"checked","value","matTooltip","click","change"]],template:function(g,U){if(1&g&&(e.I0R(0,"div",0)(1,"button",1),e.wVc(2,"translate"),e.I0R(3,"mat-icon"),e.OEk(4,"expand_more"),e.C$Y()(),e.I0R(5,"mat-menu",2,3),e.yuY(7,k,5,5,"div",4)(8,z,8,5,"ng-container",5),e.wR5(9,"mat-divider"),e.I0R(10,"span",6)(11,"div",7),e.yuY(12,c,4,7,"mat-slide-toggle",8),e.C$Y(),e.I0R(13,"div",7)(14,"mat-slide-toggle",9),e.qCj("change",function(H){return U.changeSearchResultsGeometry(H)})("click",function(H){return H.stopPropagation()}),e.wVc(15,"translate"),e.OEk(16),e.wVc(17,"translate"),e.C$Y()(),e.I0R(18,"div",7)(19,"mat-slide-toggle",9),e.qCj("change",function(H){return U.reverseSearchCoordsFormat(H)})("click",function(H){return H.stopPropagation()}),e.wVc(20,"translate"),e.wVc(21,"translate"),e.OEk(22),e.wVc(23,"translate"),e.C$Y()()()()()),2&g){const M=e.Gew(6);e.yG2(),e.E7m("matTooltip",e.kDX(2,11,"igo.geo.search.menu.tooltip"))("matMenuTriggerFor",M),e.yG2(6),e.E7m("ngIf",U.getSearchSources().length>4),e.yG2(),e.E7m("ngForOf",U.getSearchSources()),e.yG2(4),e.E7m("ngIf",U.hasPointerReverseSearchSource&&!U.isTouchScreen),e.yG2(2),e.E7m("matTooltip",e.kDX(15,13,"igo.geo.search.searchResultsGeometry.tooltip"))("checked",U.searchResultsGeometryEnabled),e.yG2(2),e.oRS(" ",e.kDX(17,15,"igo.geo.search.searchResultsGeometry.title")," "),e.yG2(3),e.E7m("matTooltip",U.reverseSearchCoordsFormatEnabled?e.kDX(20,17,"igo.geo.search.reverseCoordFormat.tooltipLatLon"):e.kDX(21,19,"igo.geo.search.reverseCoordFormat.tooltipLonLat"))("checked",U.reverseSearchCoordsFormatEnabled),e.yG2(3),e.oRS(" ",e.kDX(23,21,"igo.geo.search.reverseCoordFormat.title")," ")}},dependencies:[d.oJ,d.Gw,d.um,y.KO,y.a4,f._A,f.aM,f.OQ,f.yG,o.oB,o.qL,C.u_,C.Iw,L.Vn,L.WK,C.Ko,C.Wm,h.yk,h.cv,h.cT,P.U,P.k,R.GE,R.cP,O._s,A.sD],styles:["[_nghost-%COMP%]{display:flex;align-items:center}.checkAllButton[_ngcontent-%COMP%]{text-align:center;padding:0 5px}.igo-search-settings-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-right:16px}.igo-search-settings-checkbox[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{display:flex}.igo-search-settings-search-source[_ngcontent-%COMP%]{display:flex;width:100%}.igo-search-settings-search-source[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{display:flex;margin-left:5px;margin-right:5px}.search-option[_ngcontent-%COMP%]{display:block;margin-right:10px;margin-bottom:15px}.pointer-summary-slide-toggle-container[_ngcontent-%COMP%]{overflow-x:hidden}.pointer-summary-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{margin:10px 0}.igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], .igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}.igo-search-settings-sub-menu[_ngcontent-%COMP%]{min-height:34px}"],changeDetection:0})}return b})()},71320:(Fe,ce,r)=>{"use strict";r.d(ce,{k:()=>Z});var C=r(53e3),e=r(9588),d=r(43168),L=r(58264),P=r(83552),o=r(12396),f=r(80848),h=r(61252),R=r(83680),y=r(67732),O=r(70524),x=r(68392),T=r(40240),a=r(2892),F=r(9364),A=r(59800),k=r(29216),W=r(14452),w=r(34896),te=r(83456);let Z=(()=>{class K{component;searchService;searchSourceService;mediaService;store;lonLat;pointerSearchStore=new C.qc([]);lastTimeoutRequest;store$$;layers$$;reverseSearch$$=[];hasPointerReverseSearchSource=!1;pointerMoveListener;searchPointerSummaryFeatureId="searchPointerSummaryFeatureId";igoSearchPointerSummaryDelay=1e3;igoSearchPointerSummaryEnabled=!1;mouseleave(){clearTimeout(this.lastTimeoutRequest),this.clearLayer()}get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(V,B,z,c){this.component=V,this.searchService=B,this.searchSourceService=z,this.mediaService=c}ngOnInit(){this.listenToMapPointerMove(),this.map.status$.pipe((0,R.K)(V=>V===d.qM.Done)).subscribe(()=>{this.store=new T.y([],{map:this.map}),this.initStore(),this.subscribeToPointerStore()}),this.layers$$=this.map.layers$.subscribe(V=>{this.store&&!V.find(B=>"searchPointerSummaryId"===B.id)&&this.initStore()})}initStore(){const V=this.store,B=new a.M({isIgoInternalLayer:!0,id:"searchPointerSummaryId",title:"searchPointerSummary",zIndex:900,source:new y.E,showInLayerList:!1,exportable:!1,browsable:!1,style:A.uq});(0,O.m)(V,B)}ngAfterContentChecked(){this.hasPointerReverseSearchSource=!!this.searchSourceService.getEnabledSources().filter(W.ig).length}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unsubscribeReverseSearch(),this.layers$$.unsubscribe()}subscribeToPointerStore(){this.store$$=this.pointerSearchStore.entities$.subscribe(V=>{this.entitiesToPointerOverlay(V)})}computeSummaryClosestFeature(V){const B={};return V.map(z=>{z.data.properties.type&&z.data.properties.distance>=0&&(B.hasOwnProperty(z.data.properties.type)?z.data.properties.distance<B[z.data.properties.type].distance&&(B[z.data.properties.type]={distance:z.data.properties.distance,title:z.meta.pointerSummaryTitle||z.meta.title}):B[z.data.properties.type]={distance:z.data.properties.distance,title:z.meta.pointerSummaryTitle||z.meta.title})}),B}entitiesToPointerOverlay(V){const B=this.computeSummaryClosestFeature(V),z=Object.keys(B),c=[],I=[];V.map(b=>{const G=z.indexOf(b.data.properties.type);-1!==G?(I.push(B[b.data.properties.type].title),z.splice(G,1),c.push(b.data.properties.type)):-1===c.indexOf(b.data.properties.type)&&I.push(b.meta.pointerSummaryTitle||b.meta.title)}),I.length&&this.addPointerOverlay(I.join("\n"))}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",V=>this.onMapEvent(V))}unsubscribeToPointerStore(){this.store$$.unsubscribe()}unsubscribeReverseSearch(){this.reverseSearch$$.map(V=>V.unsubscribe()),this.reverseSearch$$=[]}unlistenToMapPointerMove(){(0,P.S)(this.pointerMoveListener),this.pointerMoveListener=void 0}onMapEvent(V){!V.dragging&&this.igoSearchPointerSummaryEnabled&&this.hasPointerReverseSearchSource&&!this.mediaService.isTouchScreen()?(typeof this.lastTimeoutRequest<"u"&&(clearTimeout(this.lastTimeoutRequest),this.clearLayer(),this.unsubscribeReverseSearch()),this.lonLat=(0,h.AF)(V.coordinate,this.mapProjection,"EPSG:4326"),this.lastTimeoutRequest=setTimeout(()=>{this.onSearchCoordinate()},this.igoSearchPointerSummaryDelay)):this.clearLayer()}sortByOrder(V,B){return V.source.displayOrder-B.source.displayOrder}onSearchCoordinate(){this.pointerSearchStore.clear();const V=this.searchService.reverseSearch(this.lonLat,{params:{geometry:"false",icon:"false"}},!0);for(const B in V)V.length>0&&this.reverseSearch$$.push(V[B].request.subscribe(z=>{this.onSearch({research:V[B],results:z})}))}onSearch(V){const B=V.results,z=this.pointerSearchStore.all().filter(c=>c.source!==V.research.source).concat(B);this.pointerSearchStore.load(z.sort(this.sortByOrder))}addPointerOverlay(V){this.clearLayer();const B=new f.c((0,h.AF)(this.lonLat,"EPSG:4326",this.mapProjection)),z=new L.c({geometry:B}),c=(new o.c).writeGeometryObject(B,{featureProjection:this.mapProjection,dataProjection:this.mapProjection});this.store.setLayerFeatures([{type:x.Y,geometry:c,projection:this.mapProjection,properties:{id:this.searchPointerSummaryFeatureId,pointerSummary:V},meta:{id:this.searchPointerSummaryFeatureId},ol:z}],x.S.None)}clearLayer(){this.store&&this.store.clearLayer()}static \u0275fac=function(B){return new(B||K)(w.GI1(F.q,2),w.GI1(k._),w.GI1(te.i),w.GI1(e.QB))};static \u0275dir=w.Sc5({type:K,selectors:[["","igoSearchPointerSummary",""]],hostBindings:function(B,z){1&B&&w.qCj("mouseleave",function(){return z.mouseleave()})},inputs:{igoSearchPointerSummaryDelay:"igoSearchPointerSummaryDelay",igoSearchPointerSummaryEnabled:"igoSearchPointerSummaryEnabled"},standalone:!0})}return K})()},83456:(Fe,ce,r)=>{"use strict";r.d(ce,{i:()=>C});class C{sources;constructor(d){this.sources=d}getSources(){return this.sources}getEnabledSources(){return this.getSources().filter(d=>!0===d.enabled)}enableSourcesByType(d){this.getSources().forEach(L=>{L.enabled=L.constructor.type===d})}setParamFromSetting(d,L){d.setParamFromSetting(L)}setWorkspaces(d,L){d.setWorkspaces(L)}}},29220:(Fe,ce,r)=>{"use strict";r.d(ce,{a:()=>d});var C=r(68392),e=r(8492);const d=[C.Y,e.i]},29216:(Fe,ce,r)=>{"use strict";r.d(ce,{_:()=>f});var C=r(21720),e=r(59324),d=r(14452),L=r(34896),P=r(83456),o=r(12268);let f=(()=>{class h{searchSourceService;mapService;storageService;constructor(y,O,x){this.searchSourceService=y,this.mapService=O,this.storageService=x}search(y,O={}){if(!this.termIsValid(y))return[];const x=this.mapService.getMap()?.projection||"EPSG:3857",T=(0,e.Sc)(y,x,{forceNA:O.forceNA});if(T.lonLat)return this.reverseSearch(T.lonLat,{distance:T.radius,conf:T.conf});let a;return T.message&&console.log(T.message),O.extent=this.mapService.getMap()?.viewController.getExtent("EPSG:4326"),a=O.getEnabledOnly||void 0===O.getEnabledOnly?this.searchSourceService.getEnabledSources():this.searchSourceService.getSources(),O.sourceId?a=a.filter(F=>F.getId()===O.sourceId):O.searchType&&(a=a.filter(F=>F.getType()===O.searchType)),a=a.filter(d.ay),this.searchSources(a,y,O)}reverseSearch(y,O,x=!1){const T=x?d.ig:d.ae,a=this.searchSourceService.getEnabledSources().filter(T),F=this.storageService.get("reverseSearchCoordsFormatEnabled")||!1;return this.reverseSearchSources(a,y,O||{},F)}searchSources(y,O,x){return y.map(T=>({request:T.search(O,x),reverse:!1,source:T}))}reverseSearchSources(y,O,x,T){return y.map(a=>({request:a.reverseSearch(O,x,T),reverse:!0,source:a}))}termIsValid(y){return"string"==typeof y&&""!==y}static \u0275fac=function(O){return new(O||h)(L.CoB(P.i),L.CoB(o.u),L.CoB(C.yQ))};static \u0275prov=L.wxM({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})()},14452:(Fe,ce,r)=>{"use strict";function e(h){return void 0!==h.search}function d(h){return void 0!==h.reverseSearch}function L(h){return void 0!==h.reverseSearch&&!0===h.showInPointerSummary}function o(h,R){let y="";return R.split("").forEach((O,x)=>{O!==h.charAt(x)&&(y+=O)}),y}function f(h,R,y=!1){if(!h||!R)return 0;const O=y?h:h.toString().toLowerCase(),x=y?R:R.toString().toLowerCase(),F=o(O,x)+o(x,O);let A=0;return F.length&&(A=F.length/O.length*100),100-Math.floor(A)}r.d(ce,{Un:()=>f,ae:()=>d,ay:()=>e,ig:()=>L}),r(68392)},78168:(Fe,ce,r)=>{"use strict";r.d(ce,{i:()=>e});var C=r(43168);let e=(()=>class d{storageService;static id="";static type="";options;getId(){throw new Error('You have to implement the method "getId".')}getType(){throw new Error('You have to implement the method "getType".')}getDefaultOptions(){throw new Error('You have to implement the method "getDefaultOptions".')}get title(){return this.options.title}get available(){return!1!==this.options.available}set enabled(P){this.options.enabled=P}get enabled(){return this.available&&!1!==this.options.enabled}get showInPointerSummary(){return this.options.showInPointerSummary||!1}get showInSettings(){const P=this.options.showInSettings;return void 0===P||P}get searchUrl(){return this.options.searchUrl}get params(){return this.options.params}get settings(){return void 0===this.options.settings?[]:this.options.settings}set featureStoresWithIndex(P){this._featureStoresWithIndex=P}get featureStoresWithIndex(){return this._featureStoresWithIndex}_featureStoresWithIndex;setWorkspaces(P){this.options.available=P.filter(h=>h.entityStore.searchDocument).length>=1;const o=[];this.featureStoresWithIndex=P.filter(h=>h.entityStore.searchDocument).map(h=>(o.push({title:h.title,value:h.title,enabled:!0}),h.entityStore));const f=this.options.settings.find(h=>"datasets"===h.title);f&&(f.values=o),this.setParamFromSetting(f)}setParamFromSetting(P,o=!0){switch(P.type){case"radiobutton":P.values.forEach(h=>{h.enabled&&(this.options.params=Object.assign(this.options.params||{},{[P.name]:h.value}))});break;case"checkbox":let f="";P.values.filter(h=>!1!==h.available).forEach(h=>{h.enabled&&(f+=h.value+",")}),f=f.slice(0,-1),this.options.params=Object.assign(this.options.params||{},{[P.name]:f})}o&&this.storageService&&this.storageService.set(this.getId()+".options",{params:this.options.params})}get displayOrder(){return void 0===this.options.order?99:this.options.order}constructor(P,o){if(this.storageService=o,this.options=P,this.storageService){const f=this.storageService.get(this.getId()+".options");f&&(this.options=C.Yv.mergeDeep(this.options,f))}this.options=C.Yv.mergeDeep(this.getDefaultOptions(),this.options),this.settings.forEach(f=>{this.setParamFromSetting(f,!1)})}getHashtagsValid(P,o){const f=P.match(/(#[A-Za-z\xc0-\xff-+]+)/g);if(!f)return;const h=this.getSettingsValues(o),R=[];return f.forEach(y=>{h.values.forEach(O=>{const x=y.substring(1);if("string"==typeof O.value){const T=O.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(","),a=T.indexOf(x.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""));-1!==a&&R.push(T[a])}O.hashtags&&-1!==O.hashtags.indexOf(x.toLowerCase())&&R.push(O.value)})}),R.filter((y,O)=>R.indexOf(y)===O)}getSettingsValues(P){return this.getDefaultOptions().settings.find(o=>o.name===P)}})()},88824:(Fe,ce,r)=>{"use strict";r.d(ce,{y:()=>R});var C=r(61252),e=r(54776),d=r(62632),L=r(88872),P=r(91088),o=r(45212),f=r(87544),h=r(71888);class R{_converters;_renderers;constructor(){this._converters={},this._converters.esriPMS=R._convertEsriPMS,this._converters.esriSFS=R._convertEsriSFS,this._converters.esriSLS=R._convertEsriSLS,this._converters.esriSMS=R._convertEsriSMS,this._converters.esriTS=R._convertEsriTS,this._renderers={},this._renderers.uniqueValue=this._renderUniqueValue,this._renderers.simple=this._renderSimple,this._renderers.classBreaks=this._renderClassBreaks}static _convertPointToPixel(O){return O/.75}static _transformColor(O){return[O[0],O[1],O[2],O[3]/255]}static _getResolutionForScale(O,x){const a=C.q[x];return parseFloat(O)/(39.3701*a*96)}static _convertEsriTS(O){const x=R._transformAngle(O.angle),T=void 0!==O.text?O.text:void 0;return new e.cp({text:new d.c({fill:new L.c({color:R._transformColor(O.color)}),font:O.font.style+" "+O.font.weight+" "+O.font.size+" px "+O.font.family,textBaseline:O.verticalAlignment,textAlign:O.horizontalAlignment,offsetX:R._convertPointToPixel(O.xoffset),offsetY:R._convertPointToPixel(O.yoffset),rotation:x,text:T})})}static _convertEsriPMS(O){const x="data:"+O.contentType+";base64, "+O.imageData,T=R._transformAngle(O.angle);return new e.cp({image:new P.c({src:x,rotation:T})})}static _convertEsriSFS(O){const x=new L.c({color:R._transformColor(O.color)}),T=O.outline?R._convertOutline(O.outline):void 0;return new e.cp({fill:x,stroke:T})}static _convertOutline(O){let x;const T=R._transformColor(O.color);return"esriSLSDash"===O.style?x=[5]:"esriSLSDashDot"===O.style?x=[5,5,1,2]:"esriSLSDashDotDot"===O.style?x=[5,5,1,2,1,2]:"esriSLSDot"===O.style?x=[1,2]:"esriSLSNull"===O.style&&(T[3]=0),new o.c({color:T,lineDash:x,width:R._convertPointToPixel(O.width)})}static _convertEsriSLS(O){return new e.cp({stroke:R._convertOutline(O)})}static _transformAngle(O){if(0===O||void 0===O)return;const T=-O*Math.PI/180+Math.PI/2;return T<0?2*Math.PI+T:T}static _convertEsriSMS(O){const x=new L.c({color:R._transformColor(O.color)}),T=O.outline?R._convertOutline(O.outline):void 0,a=R._convertPointToPixel(O.size)/2,F=R._transformAngle(O.angle);return"esriSMSCircle"===O.style?new e.cp({image:new f.c({radius:a,fill:x,stroke:T})}):"esriSMSCross"===O.style?new e.cp({image:new h.c({fill:x,stroke:T,points:4,radius:a,radius2:0,angle:0,rotation:F})}):"esriSMSDiamond"===O.style?new e.cp({image:new h.c({fill:x,stroke:T,points:4,radius:a,rotation:F})}):"esriSMSSquare"===O.style?new e.cp({image:new h.c({fill:x,stroke:T,points:4,radius:a,angle:Math.PI/4,rotation:F})}):"esriSMSX"===O.style?new e.cp({image:new h.c({fill:x,stroke:T,points:4,radius:a,radius2:0,angle:Math.PI/4,rotation:F})}):"esriSMSTriangle"===O.style?new e.cp({image:new h.c({fill:x,stroke:T,points:3,radius:a,angle:0,rotation:F})}):void 0}_convertLabelingInfo(O,x){const T=[];for(let a=0,F=O.length;a<F;++a){const A=O[a].labelExpression,k=A.substr(A.indexOf("[")+1,A.indexOf("]")-1),W=O[a].symbol,w=O[a].maxScale,te=O[a].minScale;let Z=null;0!==w&&(Z=R._getResolutionForScale(w,x));let K=null;0!==te&&(K=R._getResolutionForScale(te,x));const X=this._converters[W.type].call(this,W);T.push(function(V,B){let z=!0;if(null!==this.minResolution&&null!==this.maxResolution?z=B<this.maxResolution&&B>=this.minResolution:null!==this.minResolution?z=B>=this.minResolution:null!==this.maxResolution&&(z=B<this.maxResolution),z){const c=V.get(this.field);return this.style.getText().setText(c),[this.style]}}.bind({minResolution:Z,maxResolution:K,field:k,style:X}))}return T}_renderSimple(O){const x=this._converters[O.symbol.type].call(this,O.symbol);return()=>[x]}_renderClassBreaks(O){const x=O.defaultSymbol,T=this._converters[x.type].call(this,x),a=O.field,F=[];for(let A=0,k=O.classBreakInfos.length;A<k;++A){const W=O.classBreakInfos[A];let w;w=null==W.classMinValue?0===A?O.minValue:O.classBreakInfos[A-1].classMaxValue:W.classMinValue;const te=W.classMaxValue,Z=W.symbol,K=this._converters[Z.type].call(this,Z);F.push({min:w,max:te,style:K})}return A=>{const k=A.get(a);for(let W=0,w=F.length;W<w;++W){let te;if(te=0===W?k>=F[W].min&&k<=F[W].max:k>F[W].min&&k<=F[W].max,te)return[F[W].style]}return[T]}}_renderUniqueValue(O){const x=O.defaultSymbol;let T=[];x&&(T=[this._converters[x.type].call(this,x)]);const a=O.field1,F=O.uniqueValueInfos,A=this;return(()=>{const k={};for(let W=0,w=F.length;W<w;++W){const te=F[W],Z=te.symbol;k[te.value]=[A._converters[Z.type].call(A,Z)]}return W=>k[W.get(a)]||T})()}generateStyle(O,x){const T=O.drawingInfo;let a=[];const F=this._renderers[T.renderer.type].call(this,T.renderer);if(void 0!==F&&a.push(F),O.labelingInfo){const A=this._convertLabelingInfo(O.labelingInfo,x);a=a.concat(A)}return 1===a.length?a[0]:(A,k)=>{let W=[];for(let w=0,te=a.length;w<te;++w){const Z=a[w].call(null,A,k);Z&&(W=W.concat(Z))}return W}}}},59800:(Fe,ce,r)=>{"use strict";r.d(ce,{Cy:()=>R,M4:()=>h,_o:()=>y,uq:()=>O});var C=r(45212),e=r(88872),d=r(54776),L=r(87544),P=r(62632),o=r(91088),f=r(82048);function h(){const x=Math.floor(255*Math.random()),T=Math.floor(255*Math.random()),a=Math.floor(255*Math.random()),F=new C.c({color:[x,T,a,1],width:2}),A=new e.c({color:[x,T,a,.4]});return(k,W)=>{const w=k.get("_style");if(w){if(w.circle&&k.get("rad")&&k.get("longitude")&&k.get("latitude")){const K=[k.get("longitude"),k.get("latitude")],X=k.get("rad")/Math.cos(Math.PI/180*K[1])/W;w.circle.radius=X}return(new f.U).createStyle(w,void 0,W)}return new d.cp({stroke:F,fill:A,image:new L.c({radius:5,stroke:F,fill:A}),text:k.get("_mapTitle")?new P.c({text:k.get("_mapTitle").toString(),offsetX:5,offsetY:-5,font:"12px Calibri,sans-serif",fill:new e.c({color:"#000"}),stroke:new C.c({color:"#fff",width:3}),overflow:!0}):void 0})}}function R(){const x=Math.floor(255*Math.random()),T=Math.floor(255*Math.random()),a=Math.floor(255*Math.random()),F=new C.c({color:[x,T,a,1],width:2}),A=new e.c({color:[x,T,a,.4]});return new d.cp({stroke:F,fill:A,image:new L.c({radius:5,stroke:F,fill:A})})}function y(x,T){const F=[new d.cp({text:new P.c({text:x.get("hoverSummary"),textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:new e.c({color:"#000"}),backgroundFill:new e.c({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new C.c({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new C.c({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:20,padding:[2.5,2.5,2.5,2.5]})})];return"Point"===x.getGeometry().getType()?F.push(new d.cp({image:new L.c({radius:10,stroke:new C.c({color:"blue",width:3})})})):(F.push(new d.cp({stroke:new C.c({color:"white",width:5})})),F.push(new d.cp({stroke:new C.c({color:"blue",width:3})}))),F}function O(x,T){return new d.cp({image:new o.c({src:"./assets/igo2/geo/icons/cross_black_18px.svg"}),text:new P.c({text:x.get("pointerSummary"),textAlign:"left",textBaseline:"bottom",font:"12px Calibri,sans-serif",fill:new e.c({color:"#000"}),backgroundFill:new e.c({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new C.c({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new C.c({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:-10,padding:[2.5,2.5,2.5,2.5]})})}},47572:(Fe,ce,r)=>{"use strict";r.d(ce,{o:()=>f});var C=r(82736),e=r(54776),d=r(91088),L=r(62632),P=r(88872),o=r(45212);function f({text:h,opacity:R=1,markerColor:y=[0,161,222],markerOutlineColor:O=[255,255,255]}={}){let x,T,a,F;const A=(0,C.f4)(y).slice(0),k=(0,C.f4)(O).slice(0);return 4===A.length&&("string"!=typeof y||/^#[0-9A-F]{8}$/i.test(y))&&(R=A[3]),T=`"rgba(${A[0]},${A[1]},${A[2]},${R})"`,x=y,a=`"rgb(${k[0]},${k[1]},${k[2]})"`,F='data:image/svg+xml;utf8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" height="36" width="36" viewBox="0 0 36 36"><path fill='+T+" stroke="+a+' stroke-width="2" d="M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z"></path></svg>',new e.cp({image:new d.c({src:F,opacity:R,anchor:[.5,.92]}),text:new L.c({text:h,font:"12px Calibri,sans-serif",fill:new P.c({color:"#000"}),stroke:new o.c({color:"#fff",width:3}),overflow:!0})})}},52756:(Fe,ce,r)=>{"use strict";r.d(ce,{B:()=>y,I:()=>R});var C=r(82736),e=r(45212),d=r(88872),L=r(54776),P=r(87544),o=r(62632),f=r(82048),h=r(47572);function R(){const x=y(),T=(0,h.o)();let a;return(F,A)=>{if("bufferFeature"===F.getId())return a=function O(x=[0,161,222,1],T=2,a=[0,161,222,.15],F){const A=new e.c({width:T,color:x}),k=new d.c({color:a});return new L.cp({stroke:A,fill:k,image:new P.c({radius:5,stroke:A,fill:k}),text:new o.c({font:"12px Calibri,sans-serif",text:F,fill:new d.c({color:"#000"}),stroke:new e.c({color:"#fff",width:3}),overflow:!0})})}(F.get("bufferStroke"),2,F.get("bufferFill"),F.get("bufferText")),a;{const k=F.get("_style");return k?(new f.U).createStyle(k,F,A):(a="Point"===F.getGeometry().getType()?T:x,a.getText().setText(F.get("_mapTitle")),a)}}}function y({text:x,strokeWidth:T=2,fillColor:a=[0,161,222,.3],strokeColor:F=[0,161,222,.9]}={}){const A=(0,C.f4)(a).slice(0),k=(0,C.f4)(F).slice(0),W=new e.c({width:T,color:k}),w=new d.c({color:A});return new L.cp({stroke:W,fill:w,image:new P.c({radius:5,stroke:W,fill:w}),text:new o.c({text:x,font:"12px Calibri,sans-serif",fill:new d.c({color:"#000"}),stroke:new e.c({color:"#fff",width:3}),overflow:!0})})}},82048:(Fe,ce,r)=>{"use strict";r.d(ce,{U:()=>T});var C=r(58264),e=r(54776),d=r(7444),L=r(71888),P=r(88872),o=r(45212),f=r(62632),h=r(91088),R=r(87544),y=r(59324),O=r(47572),x=r(34896);let T=(()=>{class a{style;createStyle(A,k,W){if(!A)return(0,O.o)();if("function"==typeof A||A instanceof e.cp)return A;const w=this.parseStyle("style",A);if(w.getText()){let te=0,Z=1/0;if(A.text){const K=A.text?.minScaleDenom?(0,y.bg)(Number(A.text.minScaleDenom)):void 0,X=A.text?.maxScaleDenom?(0,y.bg)(Number(A.text.maxScaleDenom)):void 0;te=K||(A.text?.minResolution?A.text.minResolution:0),Z=X||(A.text?.maxResolution?A.text.maxResolution:1/0)}(A.text?.minScaleDenom||A.text?.maxScaleDenom||A.text?.minResolution||A.text?.maxResolution)&&(k&&W>=te&&W<=Z?k&&A.text.attribute&&w.getText().setText(this.getLabel(k,A.text.attribute)):w.setText())}return w}parseStyle(A,k){const W={},w=this.getOlCls(A);return w&&k instanceof Object?(Object.keys(k).forEach(te=>{const Z=this.getOlKey(te);W[Z]=this.parseStyle(te,k[te])}),new w(W)):k}getOlKey(A){let k;switch(A.toLowerCase()){case"circle":case"regularshape":case"icon":k="image"}return k||A}getOlCls(A){let k=d[A.charAt(0).toUpperCase()+A.slice(1)];return"regularshape"===A&&(k=L.c),"backgroundFill"===A&&(k=P.c),"backgroundStroke"===A&&(k=o.c),k}createStyleByAttribute(A,k,W){let w;const te=k.type?k.type:this.guessTypeFeature(A),Z=k.attribute,K=k.data,X=k.stroke,V=k.width,B=k.fill,z=k.anchor,c=k.radius,I=k.icon,b=k.scale,G=K?K.length:0,D=k.label?k.label.attribute:void 0,g=k.label?.minScaleDenom?(0,y.bg)(Number(k.label.minScaleDenom)):void 0,U=k.label?.maxScaleDenom?(0,y.bg)(Number(k.label.maxScaleDenom)):void 0,s=g||(k.label?.minResolution?k.label.minResolution:0),ie=U||(k.label?.maxResolution?k.label.maxResolution:1/0);let de=k.label?.style?this.parseStyle("text",k.label.style):void 0;!de&&D&&(de=new f.c);const fe=k.baseStyle;if(de&&de.setText(W>=s&&W<=ie?this.getLabel(A,D):""),"circle"===te){for(let Se=0;Se<G;Se++){const ae=typeof A.get(Z)<"u"&&null!==A.get(Z)?A.get(Z):"";if(ae===K[Se]||ae.toString().match(new RegExp(K[Se],"gmi")))return I?(w=[new e.cp({image:new h.c({color:B?B[Se]:void 0,src:I[Se],scale:b?b[Se]:1,anchor:z?z[Se]:[.5,.5]}),text:de instanceof f.c?de:void 0})],w):(w=[new e.cp({image:new R.c({radius:c?c[Se]:4,stroke:new o.c({color:X?X[Se]:"black",width:V?V[Se]:1}),fill:new P.c({color:B?B[Se]:"black"})}),text:de instanceof f.c?de:void 0})],w)}if(!A.getStyle())return fe?(w=this.createStyle(fe,A,W),de&&w.setText(de),w):(w=[new e.cp({image:new R.c({radius:4,stroke:new o.c({color:"black"}),fill:new P.c({color:"#bbbbf2"})})})],w)}else if("regular"===te){for(let Se=0;Se<G;Se++){const ae=typeof A.get(Z)<"u"&&null!==A.get(Z)?A.get(Z):"";if(ae===K[Se]||ae.toString().match(new RegExp(K[Se],"gmi")))return w=[new e.cp({stroke:new o.c({color:X?X[Se]:"black",width:V?V[Se]:1}),fill:new P.c({color:B?B[Se]:"rgba(255,255,255,0.4)"}),text:de instanceof f.c?de:void 0})],w}if(A instanceof C.c&&!A.getStyle())return fe?(w=this.createStyle(fe,A,W),de&&w.setText(de),w):(w=[new e.cp({stroke:new o.c({color:"black"}),fill:new P.c({color:"#bbbbf2"})})],w)}}createClusterStyle(A,k,W={},w){let te;const Z=A.get("features").length;if(1!==Z){if(W.clusterRanges)for(const K of W.clusterRanges)if((!K.minRadius||K.minRadius<=Z)&&(!K.maxRadius||K.maxRadius>=Z)){if(te=this.createStyle(K.style),K.showRange){const X=new f.c({text:Z.toString(),fill:new P.c({color:"#fff"})});te.setText(X)}if(K.dynamicRadius){let X;const V=te.getRadius();X=5*Math.log(Z),X<V&&(X=V),te.image_.setRadius(X)}break}if(!te){let K;W.radiusCalc?K=W.radiusCalc(Z):(K=5*Math.log(Z),K<6&&(K=6)),te=[new e.cp({image:new R.c({radius:K,stroke:new o.c({color:"black"}),fill:new P.c({color:"rgba(24, 134, 45, 0.5)"})}),text:new f.c({text:Z.toString(),fill:new P.c({color:"#fff"})})})]}}else te=this.createStyle(w,A,k);return te}getLabel(A,k){let W=k;if(!W)return;const w=Array.from(k.matchAll(/\$\{([^\{\}]+)\}/g));return w.forEach(te=>{W=W.replace(te[0],A.get(te[1]))}),0===w.length&&W===k&&(W=A.get(k)||k),W}guessTypeFeature(A){switch(A.getGeometry().getType()){case"Point":case"MultiPoint":case"Circle":return"circle";default:return"regular"}}static \u0275fac=function(k){return new(k||a)};static \u0275prov=x.wxM({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})()},47864:(Fe,ce,r)=>{"use strict";r.d(ce,{KC:()=>d,iL:()=>O});var C=r(43168),e=r(11772);function d(x){return({wms:L,wmts:P,xyz:o,feature:f,wfs:h,arcgisrest:R,imagearcgisrest:R,tilearcgisrest:R,osm:F=>"OSM",tiledebug:F=>"tiledebug"}[x.type]||y)(x)}function L(x){const T=x.params.LAYERS,F="wms"+O(x.url)+T;return e.Cy.hashStr(F)}function P(x){const T=x.layer,F="wmts"+O(x.url)+T;return e.Cy.hashStr(F)}function o(x){const a="xyz"+O(x.url);return e.Cy.hashStr(a)}function f(x){if(!x.url)return y();const a="feature"+O(x.url);return e.Cy.hashStr(a)}function h(x){if(!x.url||!x.params)return y();const a="wfs"+O(x.url)+x.params.featureTypes;return e.Cy.hashStr(a)}function R(x){const T=x.layer,a=O(x.url);return e.Cy.hashStr((x.type||"arcgis")+a+T)}function y(x){return(0,C.uq)()}function O(x){const a=("/"===x.charAt(0)?window.location.origin+x:x).split(/[?&]/);let F=a.shift();const A=a.filter(k=>0!==k.length&&"_"!==k.charAt(0));return A.length&&(F+="?"+A.join("&")),F}},58776:(Fe,ce,r)=>{"use strict";r.d(ce,{iOV:()=>Ua,kvX:()=>ja,oxI:()=>vd,aaH:()=>Mo.a,OEM:()=>Kr.O,YdQ:()=>$e,Se2:()=>Vl,gLH:()=>cl,O_6:()=>pa,YNI:()=>wr,YfI:()=>Be.Yf,EBb:()=>Mo.EB,wP$:()=>Be.wP,Suj:()=>Be.Su,ym_:()=>Be.ym,E9g:()=>Be.E9,kj0:()=>Be.kj,Wwb:()=>ll,cdH:()=>Wt.cd,s9F:()=>D,eqy:()=>Wt.eq,aw9:()=>Bi,ach:()=>gd,yGW:()=>Wt.yG,SET:()=>ip,G_h:()=>sd,Oy$:()=>Ft,OrO:()=>Sa,Y1E:()=>Wt.Y1,ApN:()=>tl,wSE:()=>as,Ult:()=>ol,m2U:()=>us,g7B:()=>hr,IZ6:()=>oo.IZ,q2F:()=>Wt.q2,u00:()=>Wt.u0,K88:()=>ao.K8,yaV:()=>ao.y,Idw:()=>ds,Ga$:()=>yr,w35:()=>xt.w,Kwu:()=>$a,__k:()=>jo,E9h:()=>lr,isy:()=>zn,Iz2:()=>Dp,knT:()=>Wt.kn,eAF:()=>Sp,qME:()=>Wt.qM,s5H:()=>lt.s5,IlJ:()=>lt.Il,i6P:()=>Wt.i6,aWp:()=>Lr.aW,AD2:()=>C.A,qE2:()=>L.q,kBh:()=>P.T,_wi:()=>F._,i6q:()=>O.i,uu$:()=>Xr,c97:()=>De,kjd:()=>et,_cQ:()=>Xt,K4n:()=>Zr,qM$:()=>Lr.qM,czr:()=>Lr.cz,SYK:()=>Lr.SY,cTh:()=>is,iOO:()=>ud,UND:()=>mr.U,eM$:()=>es,gpx:()=>pr,eAs:()=>ts,gho:()=>br,DCK:()=>Lt.D,U3K:()=>Lt.U,wL1:()=>oo.wL,ktW:()=>Pa,Mdo:()=>oo.Md,w16:()=>Wt.w1,MrZ:()=>Cs,WQ3:()=>Zp,qcl:()=>Wt.qc,q17:()=>Be.q1,KGf:()=>Wt.KG,o5m:()=>rl.o,qKz:()=>Be.qK,Cyp:()=>xr.Cy,M4J:()=>xr.M4,K6O:()=>Be.K6,Ki0:()=>Be.Ki,Yvl:()=>Be.Yv,rEB:()=>Wt.rE,_aW:()=>$r,IvV:()=>sl,wvY:()=>Yp,cDV:()=>ao.cD,QX5:()=>Be.QX,UfW:()=>Vp,yCe:()=>s,iew:()=>Qe,A7Y:()=>Ie,kzx:()=>He,QPw:()=>Op,qED:()=>a,oN0:()=>Ap,uEw:()=>Wt.uE,ayN:()=>me.ay,ETi:()=>Wt.ET,KMH:()=>Wt.KM});var C=r(8636),e=r(34896);let d=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[C.A]})}return l})();var L=r(8408),P=r(69800);let o=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[P.T,L.q]})}return l})();var f=r(1560);let h=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[f.s]})}return l})();var R=r(50620);let y=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[R.Q]})}return l})();var O=r(83456),x=r(78168);function T(l){return new O.i(l)}function a(){return{provide:O.i,useFactory:T,deps:[x.i]}}var F=r(29216),A=r(9204),k=r(24708),W=r(21720),te=(r(16660),r(21124)),Z=r(12396),K=r(28668),X=r(36752),V=r(61252),B=r(54844),z=r(1296),c=r(21296),I=r(90916),b=r(68392),G=r(59324);class D{static getGoogleMapsCoordLink(m,t){return`https://www.google.com/maps/search/?api=1&query=${t}%2C${m}`}static getGoogleStreetViewLink(m,t){return`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${t}%2C${m}`}static getGoogleMapsNameLink(m){return`https://www.google.com/maps/search/?api=1&query=${encodeURI(m)}`}}class g{static getOpenStreetMapLink(m,t,i=17){return`https://www.openstreetmap.org/?mlat=${t}&mlon=${m}#map=${i}/${t}/${m}`}static getOpenStreetCamLink(m,t,i=17){return`https://openstreetcam.org/map/@${t},${m},${i}z`}}let U=(()=>{class l{languageService;constructor(t){this.languageService=t}formatResult(t){return t}static \u0275fac=function(i){return new(i||l)(e.CoB(k.ov))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();class M extends x.i{languageService;static id="coordinatesreverse";static type=b.Y;projections;title$=new B.g("");get title(){return this.title$.getValue()}constructor(m,t,i,n){super(m,i),this.languageService=t,this.projections=n,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return M.id}getType(){return M.type}getDefaultOptions(){return{title:"igo.geo.search.coordinates.name",order:1,showInSettings:!1}}reverseSearch(m,t,i){return(0,z.of)([this.dataToResult(m,t,i)])}dataToResult(m,t,i){const n=(0,G.G2)(m),v=(0,G.Re)(m,this.projections).reduce((Ge,tt)=>(Ge[tt.alias]=tt.igo2CoordFormat,Ge),{}),Y=i?(0,G.uE)(m,6).reverse().join(", "):(0,G.uE)(m,6).join(", "),ue=i?n.reverse().join(", "):n.join(", ");let ye={type:"Point",coordinates:[m[0],m[1]]};const Ee={};let we="";if(t.distance){Ee[this.languageService.translate.instant("igo.geo.search.coordinates.radius")]=t.distance,we="<br><small>Rayon: "+t.distance+" m</small>";const tt=V.AF([m[0],m[1]],"EPSG:4326","EPSG:3857"),pt=new K.c(tt,t.distance),Tt=(0,X.IH)(pt),jt=new Z.c;ye=JSON.parse(jt.writeGeometry(Tt.transform("EPSG:3857","EPSG:4326")))}return t.conf&&(Ee[this.languageService.translate.instant("igo.geo.search.coordinates.conf")]=t.conf,we+=""===we?"<br>":"<small> - </small>",we+="<small>Confiance: "+t.conf+"%</small>"),Ee[this.languageService.translate.instant(i?"igo.geo.search.coordinates.reversedCoord":"igo.geo.search.coordinates.coord")]=Y,Ee[this.languageService.translate.instant(i?"igo.geo.search.coordinates.reversedCoordDMS":"igo.geo.search.coordinates.coordDMS")]=ue,{source:this,data:{type:b.Y,projection:"EPSG:4326",geometry:ye,extent:void 0,properties:Object.assign(Ee,v,{GoogleMaps:D.getGoogleMapsCoordLink(m[0],m[1]),GoogleStreetView:D.getGoogleStreetViewLink(m[0],m[1]),OpenStreetMap:g.getOpenStreetMapLink(m[0],m[1],14),Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"}),meta:{id:m[0].toString()+","+m[1].toString(),title:Y}},meta:{dataType:b.Y,id:m[0].toString()+","+m[1].toString(),title:Y,titleHtml:Y+we,icon:"location_on",score:100}}}static \u0275fac=function(t){return new(t||M)(e.CoB("options"),e.CoB(k.ov),e.CoB(W.yQ),e.CoB("projections"))};static \u0275prov=e.wxM({token:M,factory:M.\u0275fac})}function H(l){return new U(l)}function s(){return{provide:U,useFactory:H,deps:[k.ov]}}(0,te.UN)([(0,I.w)({maxCacheCount:20}),(0,te.YR)("design:type",Function),(0,te.YR)("design:paramtypes",[Array,Object,Boolean]),(0,te.YR)("design:returntype",c._)],M.prototype,"reverseSearch",null);var fe=r(33712),Se=r(58752),ae=r(43168),le=r(12472),oe=r(40604),se=r(51672),me=r(14452),be=r(53e3);const ke={"map-marker":"location_on",city:"location_city","flag-triangle":"flag","map-marker-alert":"fmd_bad","map-marker-radius":"pin_drop","map-marker-multiple":"local_post_office","map-legend":"map",bank:"account_balance","map-search":"search_insights","book-open-variant":"menu_book","office-building":"apartment","table-picnic":"table_restaurant",flash:"flash_on",engine:be.ol,"road-variant":"add_road","baby-face-outline":"child_care","home-account":"location_home",hospital:"local_hospital",pharmacy:"local_pharmacy","police-badge-outline":"local_police",parking:"local_parking",tree:"nature","home-city":"home_work",terrain:"landscape","panorama-horizontal":"panorama_horizontal"};let qe=(()=>{class l{languageService;constructor(t){this.languageService=t}formatResult(t){return t}static \u0275fac=function(i){return new(i||l)(e.CoB(k.ov))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();class nt{encodeKey(m){return encodeURIComponent(m)}encodeValue(m){return encodeURIComponent(m)}decodeKey(m){return decodeURIComponent(m)}decodeValue(m){return decodeURIComponent(m)}}class Ue extends x.i{http;languageService;formatter;static id="icherche";static type=b.Y;static propertiesBlacklist=[];title$=new B.g("");hashtagsLieuxToKeep=[];get title(){return this.title$.getValue()}constructor(m,t,i,n,p,v){super(n,i),this.http=m,this.languageService=t,this.formatter=p;const Y=v.get(Se.oj);this.settings.length&&(Y?Y.authenticate$.subscribe(()=>{this.getAllowedTypes()}):this.getAllowedTypes()),this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return Ue.id}getType(){return Ue.type}getDefaultOptions(){const m=this.options.params&&this.options.params.limit?Number(this.options.params.limit):void 0,t=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):void 0,i=this.options.params?.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","codes-postaux","routes","intersections","municipalites","mrc","regadmin","lieux"],n=this.options.showAdvancedSettings;return{title:"igo.geo.search.icherche.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==i.indexOf("adresses"),hashtags:["adresse"]},{title:"igo.geo.search.icherche.type.oldAddress",value:"anciennes-adresses",enabled:-1!==i.indexOf("anciennes-adresses"),hashtags:["anciennes-adresses"]},{title:"igo.geo.search.icherche.type.oldCity",value:"anciennes-municipalites",enabled:-1!==i.indexOf("anciennes-municipalites"),hashtags:["anciennes-municipalites"]},{title:"igo.geo.search.icherche.type.cn",value:"bornes-cn",enabled:-1!==i.indexOf("bornes-cn"),hashtags:["borne","bornes","cn"]},{title:"igo.geo.search.icherche.type.sumi",value:"bornes-sumi",enabled:-1!==i.indexOf("bornes-sumi"),hashtags:["borne","bornes","sumi"]},{title:"igo.geo.search.icherche.type.cadastre",value:"cadastre",enabled:-1!==i.indexOf("cadastre"),hashtags:["cadastre"]},{title:"igo.geo.search.icherche.type.postalCode",value:"codes-postaux",enabled:-1!==i.indexOf("codes-postaux"),hashtags:["code-postal"]},{title:"igo.geo.search.icherche.type.entreprise",value:"entreprises",enabled:-1!==i.indexOf("entreprises"),available:!1,hashtags:["entreprise"]},{title:"igo.geo.search.icherche.type.cycleStop",value:"haltes_cyclables",enabled:-1!==i.indexOf("haltes_cyclables"),hashtags:["haltevelo","haltes_cyclables"]},{title:"igo.geo.search.icherche.type.restArea",value:"haltes_routieres",enabled:-1!==i.indexOf("haltes_routieres"),hashtags:["halteroute","haltes_routieres"]},{title:"igo.geo.search.icherche.type.hq",value:"hq",enabled:-1!==i.indexOf("hq"),hashtags:["hq"]},{title:"igo.geo.search.icherche.type.intersection",value:"intersections",enabled:-1!==i.indexOf("intersections"),hashtags:["intersection","+"]},{title:"igo.geo.search.icherche.type.place",value:"lieux",enabled:-1!==i.indexOf("lieux"),hashtags:["lieu"]},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==i.indexOf("mrc"),hashtags:["mrc"]},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==i.indexOf("municipalites"),hashtags:["municipalit\xe9","mun"]},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==i.indexOf("regadmin"),hashtags:["r\xe9gion-administrative","regadmin"]},{title:"igo.geo.search.icherche.type.gcc",value:"bornes-gcc",enabled:-1!==i.indexOf("bornes-gcc"),hashtags:["borne","bornes","rep\xe8re","gcc","ccg"]},{title:"igo.geo.search.icherche.type.km",value:"bornes-km",enabled:-1!==i.indexOf("bornes-km"),hashtags:["borne","bornes","rep\xe8re","km"]},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==i.indexOf("routes"),hashtags:["route"]},{title:"igo.geo.search.icherche.type.exit",value:"sorties-autoroute",enabled:-1!==i.indexOf("sorties-autoroute"),hashtags:["sortie","sorties","exit"]},{title:"igo.geo.search.icherche.type.cultpatri",value:"culture",enabled:-1!==i.indexOf("culture"),hashtags:["grille","culture"]},{title:"igo.geo.search.icherche.type.unites",value:"unites",enabled:-1!==i.indexOf("unites"),hashtags:["unites","adresse"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===m},{title:"5",value:5,enabled:5===m||!m},{title:"10",value:10,enabled:10===m},{title:"25",value:25,enabled:25===m},{title:"50",value:50,enabled:50===m}]},n&&{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:10===t},{title:"30 %",value:30,enabled:30===t||!t},{title:"50 %",value:50,enabled:50===t},{title:"75 %",value:75,enabled:75===t},{title:"100 %",value:100,enabled:100===t}]},{type:"radiobutton",title:"restrictExtent",name:"loc",values:[{title:"igo.geo.search.icherche.restrictExtent.map",value:"true",enabled:!1},{title:"igo.geo.search.icherche.restrictExtent.quebec",value:"false",enabled:!0}]}].filter(Boolean)}}search(m,t){const i=this.computeRequestParams(m,t||{});return i.get("type").length?(this.options.params.page=i.get("page")||"1",this.getSearch(m,i)):(0,z.of)([])}getSearch(m,t){return this.http.get(`${this.searchUrl}/geocode`,{params:t}).pipe((0,oe.k)(i=>this.extractResults(i,m)),(0,se.a)(i=>{throw i.error.toDisplay=!0,i.error.title=this.languageService.translate.instant(this.getDefaultOptions().title),i}))}getAllowedTypes(){return this.http.get(`${this.searchUrl}/types`).subscribe(m=>{const t=this.settings.find(i=>"type"===i.name);t.values.forEach(i=>{const n=new RegExp(`^${i.value}(\\.|$)`),p=m.filter(v=>n.test(v));i.available=p.length>0,"lieux"===i.value&&(this.hashtagsLieuxToKeep=[...new Set(p.map(v=>v.split(".")).reduce((v,Y)=>v.concat(Y)).filter(v=>"lieux"!==v))])}),this.setParamFromSetting(t,!1)})}computeRequestParams(m,t){const i=Object.assign({geometry:!0,bbox:!0,icon:!0,type:"adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi"},this.params,this.computeOptionsParam(m,t||{}).params,{q:this.computeTerm(m),page:t.page});if("true"===i.loc){const[n,p,v,Y]=t.extent;i.loc=`${n},${p};${v},${p};${v},${Y};${n},${Y};${n},${p}`}else"false"===i.loc&&delete i.loc;return/#[A-Za-z]+/.test(i.q)&&(i.type="lieux"),new fe.i4({fromObject:ae.Yv.removeUndefined(i),encoder:new nt})}extractResults(m,t){return m.features.map(i=>this.formatter.formatResult(this.dataToResult(i,t,m)))}dataToResult(m,t,i){const n=this.computeProperties(m),p=[this.getId(),n.type,n.code].join("."),v=m.highlight.title||m.properties.nom,Y=m.highlight.title2?" <small> "+m.highlight.title2+"</small>":"",ue=m.highlight.title3?"<br><small> "+m.highlight.title3+"</small>":"";let ye=m.icon;return"string"==typeof ye&&Object.keys(ke).includes(ye)&&(ye=ke[ye]),{source:this,data:{type:b.Y,projection:"EPSG:4326",geometry:m.geometry,extent:m.bbox,properties:n,meta:{id:p,title:m.properties.nom}},meta:{dataType:b.Y,id:p,title:m.properties.nom,titleHtml:v+Y+ue,icon:ye||"location_on",score:m.score||(0,me.Un)(t.trim(),m.properties.nom),nextPage:i.features.length%+this.options.params.limit==0&&+this.options.params.page<10}}}computeProperties(m){const t=ae.Yv.removeKeys(m.properties,Ue.propertiesBlacklist);if(!m.geometry)return Object.assign({type:m.index},t);const i={GoogleMaps:""};let n,p;if("Point"===m.geometry.type)n=D.getGoogleMapsCoordLink(m.geometry.coordinates[0],m.geometry.coordinates[1]);else{const Y=(0,le.c)(m.geometry);n=D.getGoogleMapsCoordLink(Y.geometry.coordinates[0],Y.geometry.coordinates[1])}p=D.getGoogleMapsNameLink("routes"===m.index?m.properties.nom+", "+m.properties.municipalite:"municipalites"===m.index?m.properties.nom+", ville":"mrc"===m.index?"mrc+"+m.properties.nom:"regadmin"===m.index?m.properties.nom+",+QC":m.properties.nom||m.highlight.title),i.GoogleMaps="<a href="+n+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByCoord")+"</a> <br /> <a href="+p+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByName")+"</a>","Point"===m.geometry.type&&(i.GoogleStreetView=D.getGoogleStreetViewLink(m.geometry.coordinates[0],m.geometry.coordinates[1]));const v={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign({type:m.index},t,i,v)}computeTerm(m){let i=!1;return i=(m.match(/(#[A-Za-z]+)/g)||[]).some(n=>{const p=n.substring(1);return this.hashtagsLieuxToKeep.some(v=>v.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")===p.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""))}),i||(m=m.replace(/(#[A-Za-z]+)/g,"")),m.replace(/[^\w\xc0-\xff !\-\+\(\)\.\/\xbd\xbc\xbe,'#]+/g,"")}computeOptionsParam(m,t){const i=super.getHashtagsValid(m,"type");return i&&(t.params=Object.assign(t.params||{},{type:i.join(",")})),t}static \u0275fac=function(t){return new(t||Ue)(e.CoB(fe.KK),e.CoB(k.ov),e.CoB(W.yQ),e.CoB("options"),e.CoB(qe),e.CoB(e.zZn))};static \u0275prov=e.wxM({token:Ue,factory:Ue.\u0275fac})}(0,te.UN)([(0,I.w)({maxCacheCount:20,cacheHasher:ae.EB}),(0,te.YR)("design:type",Function),(0,te.YR)("design:paramtypes",[String,fe.i4]),(0,te.YR)("design:returntype",c._)],Ue.prototype,"getSearch",null);class St extends x.i{http;languageService;static id="icherchereverse";static type=b.Y;static propertiesBlacklist=[];title$=new B.g("");get title(){return this.title$.getValue()}constructor(m,t,i,n,p){super(n,i),this.http=m,this.languageService=t,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))});const v=p.get(Se.oj);this.settings.length&&(v?v.authenticate$.subscribe(()=>{this.getAllowedTypes()}):this.getAllowedTypes())}getId(){return St.id}getType(){return St.type}getDefaultOptions(){const m=this.options.params&&this.options.params.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","municipalites","mrc","regadmin"];return{title:"igo.geo.search.ichercheReverse.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==m.indexOf("adresses")},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==m.indexOf("routes"),available:!1},{title:"igo.geo.search.icherche.type.district",value:"arrondissements",enabled:-1!==m.indexOf("arrondissements")},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==m.indexOf("municipalites")},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==m.indexOf("mrc")},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==m.indexOf("regadmin")},{title:"igo.geo.search.icherche.type.unites",value:"unites",enabled:-1!==m.indexOf("unites")}]},{type:"radiobutton",title:"radius",name:"bufferInput",values:[{title:"100 m",value:100,enabled:!this.options.distance||100===this.options.distance},{title:"500 m",value:500,enabled:500===this.options.distance},{title:"1 km",value:1e3,enabled:1e3===this.options.distance},{title:"2 km",value:2e3,enabled:2e3===this.options.distance},{title:"5 km",value:5e3,enabled:5e3===this.options.distance}]}]}}reverseSearch(m,t){const i=this.computeRequestParams(m,t||{});return i.get("type").length?this.getReverseSearch(i):(0,z.of)([])}getReverseSearch(m){return this.http.get(`${this.searchUrl}/locate`,{params:m}).pipe((0,oe.k)(t=>this.extractResults(t)))}getAllowedTypes(){return this.http.get(`${this.searchUrl}/types`).subscribe(m=>{const t=this.settings.find(i=>"type"===i.name);t.values.forEach(i=>{i.available=m.indexOf(i.value)>-1}),this.setParamFromSetting(t,!1)})}computeRequestParams(m,t){return(t.distance||this.options.distance)&&(t.params=Object.assign(t.params||{},{bufferInput:t.distance||this.options.distance})),new fe.i4({fromObject:Object.assign({loc:m.join(","),sort:"distance",geometry:!0,icon:!0},t.params||{},this.params)})}extractResults(m){return m.features.map(t=>this.dataToResult(t))}getSubtitle(m){if(!this.settings.length)return"";let t="";if("arrondissements"===m.properties.type)t=m.properties.municipalite+" (Arrondissement)";else{const n=this.settings.find(p=>"type"===p.name).values.find(p=>p.value===m.properties.type);n&&(t=this.languageService.translate.instant(n.title))}return t}dataToResult(m){const t=this.computeProperties(m),i=this.computeExtent(m),n=[this.getId(),t.type,t.code].join("."),p=m.properties.nom,v=" <small> "+this.getSubtitle(m)+"</small>";return{source:this,data:{type:b.Y,projection:"EPSG:4326",geometry:m.geometry,extent:i,properties:t,meta:{id:n,title:m.properties.nom}},meta:{dataType:b.Y,id:n,title:m.properties.nom,titleHtml:p+v,icon:m.icon||"location_on",pointerSummaryTitle:this.getSubtitle(m)+": "+m.properties.nom}}}computeProperties(m){const t=ae.Yv.removeKeys(m.properties,St.propertiesBlacklist),i={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign(t,i)}computeExtent(m){return m.bbox?[m.bbox[0],m.bbox[2],m.bbox[1],m.bbox[3]]:void 0}static \u0275fac=function(t){return new(t||St)(e.CoB(fe.KK),e.CoB(k.ov),e.CoB(W.yQ),e.CoB("options"),e.CoB(e.zZn))};static \u0275prov=e.wxM({token:St,factory:St.\u0275fac})}function Ae(l){return new qe(l)}function Qe(){return{provide:qe,useFactory:Ae,deps:[k.ov]}}function _e(l,m,t,i,n,p){return new Ue(l,m,t,i.getConfig(`searchSources.${Ue.id}`),n,p)}function Ie(){return{provide:x.i,useFactory:_e,multi:!0,deps:[fe.KK,k.ov,W.yQ,A.aW,qe,e.zZn]}}(0,te.UN)([(0,I.w)({maxCacheCount:20,cacheHasher:ae.EB}),(0,te.YR)("design:type",Function),(0,te.YR)("design:paramtypes",[fe.i4]),(0,te.YR)("design:returntype",c._)],St.prototype,"getReverseSearch",null);var ot=r(8492),lt=r(49704);let Me=(()=>{class l{languageService;constructor(t){this.languageService=t}formatResult(t){const i=["title","abstract","groupTitle","metadataUrl","downloadUrl","urlInfo","name"],n=Object.entries(t.properties).filter(([v])=>-1!==i.indexOf(v)).reduce((v,Y)=>{const[ue,ye]=Y;let Ee;try{Ee=this.languageService.translate.instant("igo.geo.search.ilayer.properties."+ue)}catch{Ee=ue}return v[Ee]=ye||"",v},{}),p=Object.assign({},t);return p.properties=n,p}static \u0275fac=function(i){return new(i||l)(e.CoB(k.ov))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();class ct extends x.i{http;languageService;formatter;static id="ilayer";static type=ot.i;title$=new B.g("");get title(){return this.title$.getValue()}constructor(m,t,i,n,p){super(n,i),this.http=m,this.languageService=t,this.formatter=p,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return ct.id}getType(){return ct.type}getDefaultOptions(){const m=this.options.params&&this.options.params.limit?Number(this.options.params.limit):void 0,t=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):void 0;return{title:"igo.geo.search.ilayer.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.ilayer.type.layer",value:"layer",enabled:!0,hashtags:["layer","layers","couche","couches"]},{title:"igo.geo.search.ilayer.type.groupLayer",value:"group",enabled:!1,hashtags:["gr-layer","gr-layers","gr-couche","gr-couches"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===m},{title:"5",value:5,enabled:5===m||!m},{title:"10",value:10,enabled:10===m},{title:"25",value:25,enabled:25===m},{title:"50",value:50,enabled:50===m}]},this.options.showAdvancedSettings&&{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:10===t},{title:"30 %",value:30,enabled:30===t},{title:"50 %",value:50,enabled:50===t||!t},{title:"75 %",value:75,enabled:75===t},{title:"100 %",value:100,enabled:100===t}]}].filter(Boolean)}}search(m,t){const i=this.computeSearchRequestParams(m,t||{});return i.get("q")&&i.get("type")?(this.options.params.page=i.get("page")||"1",this.getSearch(m,i)):(0,z.of)([])}getSearch(m,t){return this.http.get(this.searchUrl,{params:t}).pipe((0,oe.k)(i=>this.extractResults(i,m)))}computeSearchRequestParams(m,t){return new fe.i4({fromObject:ae.Yv.removeUndefined(Object.assign({q:this.computeTerm(m)},this.params,this.computeOptionsParam(m,t||{}).params,{page:t.page}))})}computeTerm(m){return m.replace(/(#[^\s]*)/g,"").replace(/[^\w\xc0-\xff !\-\(\),'#]+/g,"")}computeOptionsParam(m,t){const i=super.getHashtagsValid(m,"type");return i&&(t.params=Object.assign(t.params||{},{type:i.join(",")})),t}extractResults(m,t){return m.items.map(i=>this.dataToResult(i,t,m))}dataToResult(m,t,i){const n=this.computeLayerOptions(m),p=m.highlight.title||m.properties.title,v=m.highlight.groupTitle||m.properties.groupTitle,Y=v?' <small style="color: #6f6969"> '+v+"</small>":"";return{source:this,meta:{dataType:ot.i,id:[this.getId(),m.properties.id].join("."),title:m.properties.title,titleHtml:p+Y,icon:"Layer"===m.properties.type?"layers":"map",score:m.score||(0,me.Un)(t.trim(),m.properties.name),nextPage:i.items.length%+this.options.params.limit==0&&+this.options.params.page<10},data:n}}computeLayerOptions(m){const t=m.properties.url,i=this.extractQueryParamsFromSourceUrl(t);return ae.Yv.removeUndefined({sourceOptions:{id:m.properties.id,type:m.properties.format,url:t,queryFormat:i.queryFormat,queryHtmlTarget:i.queryHtmlTarget,params:"wms"===m.properties.format?{LAYERS:m.properties.name}:void 0,layer:"wms"===m.properties.format?void 0:m.properties.name,optionsFromCapabilities:!0,crossOrigin:"anonymous"},title:m.properties.title,maxResolution:(0,G.bg)(Number(m.properties.maxScaleDenom)),minResolution:(0,G.bg)(Number(m.properties.minScaleDenom)),metadata:{url:m.properties.metadataUrl,extern:!!m.properties.metadataUrl||void 0,abstract:m.properties.abstract||void 0},properties:this.formatter.formatResult(m).properties})}extractQueryParamsFromSourceUrl(m){let t,i;const n=this.options.queryFormat;if(n){for(const p of Object.keys(n)){const v=n[p];if("*"===v){t=lt.s5[p.toUpperCase()];break}const Y=v.urls;if(Array.isArray(Y)){Y.forEach(ue=>{-1!==m.indexOf(ue)&&(t=lt.s5[p.toUpperCase()])});break}}(t===lt.s5.HTML||t===lt.s5.HTMLGML2)&&(i="iframe")}return{queryFormat:t,queryHtmlTarget:i}}static \u0275fac=function(t){return new(t||ct)(e.CoB(fe.KK),e.CoB(k.ov),e.CoB(W.yQ),e.CoB("options"),e.CoB(Me))};static \u0275prov=e.wxM({token:ct,factory:ct.\u0275fac})}function Oe(l){return new Me(l)}function He(){return{provide:Me,useFactory:Oe,deps:[k.ov]}}(0,te.UN)([(0,I.w)({maxCacheCount:20,cacheHasher:ae.EB}),(0,te.YR)("design:type",Function),(0,te.YR)("design:paramtypes",[String,fe.i4]),(0,te.YR)("design:returntype",c._)],ct.prototype,"getSearch",null);let Ft=(()=>{class l{static forRoot(){return{ngModule:l,providers:[F._,a(),Qe(),s(),He()]}}static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[d,h,o,y,d,h,o,y]})}return l})();var Et=r(69488),ko=r(8984),so=r(72184),Si=r(62747),bi=r(74180);let Bi=(()=>{class l{static forRoot(){return{ngModule:l}}static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({providers:[(0,bi.c9)()],imports:[Ft.forRoot(),Si.U,ko.k,Et.k,so.c]})}return l})();var Ke=r(65056),Ze=r(34672),dt=r(32328),ht=r(27e3),Ht=(r(55792),r(93020)),mt=r(54760);let Eo=(()=>{class l{transform(t,i){let n;return"time"===i&&(n=t.filter(p=>{const v=p.dataSource;return this.isTimeFilterable(v)&&void 0!==v.options.timeFilter&&Object.keys(v.options.timeFilter).length})),"ogc"===i&&(n=t.filter(p=>this.isOgcFilterable(p.dataSource))),n}isTimeFilterable(t){return"wms"===t.options.type&&t.options.timeFilterable}isOgcFilterable(t){let i=!1;return t.options.ogcFilters&&t.options.ogcFilters.enabled&&t.options.ogcFilters.editable&&(i=!0),t.options.ogcFilters&&t.options.ogcFilters.enabled&&(t.options.ogcFilters.pushButtons||t.options.ogcFilters.checkboxes||t.options.ogcFilters.radioButtons||t.options.ogcFilters.select||t.options.ogcFilters.autocomplete)&&(i=!0),i}static \u0275fac=function(i){return new(i||l)};static \u0275pipe=e.UTH({name:"filterableDataSource",type:l,pure:!0,standalone:!0})}return l})();var Lt=r(14191),Ho=r(92424),qo=r(21808);let Ro=(()=>{class l{constructor(){}filterByDate(t,i){let n,p,v,Y;if(Array.isArray(i)){const ye=[];i[0]&&(v=this.reformatDateTime(i[0]),ye.push(i[0])),i[1]&&(Y=this.reformatDateTime(i[1]),ye.push(i[1])),2===ye.length&&v!==Y&&(n=t instanceof Ho.W?v+","+Y:v+"/"+Y),v===Y&&(n=v)}else i&&(p=this.reformatDateTime(i),n=p);t.ol.updateParams({TIME:n}),t instanceof qo.C&&t.setTimeFilter(t.timeFilter,!0)}filterByYear(t,i){let n,p,v;if(Array.isArray(i)){const ue=[];i[0]&&(p=i[0],ue.push(i[0])),i[1]&&(v=i[1],ue.push(i[1])),2===ue.length&&p!==v&&(n=t instanceof Ho.W?p+","+v:p+"/"+v),p===v&&(n=p)}else n=i;t.ol.updateParams({TIME:n}),t instanceof qo.C&&t.setTimeFilter(t.timeFilter,!0)}reformatDateTime(t){const i=t.getFullYear();let n=t.getMonth()+1,p=t.getUTCDate(),v=t.getUTCHours(),Y=t.getUTCMinutes();return Number(n)<10&&(n="0"+n),Number(p)<10&&(p="0"+p),Number(v)<10&&(v="0"+v),Number(Y)<10&&(Y="0"+Y),i+"-"+n+"-"+p+"T"+v+":"+Y+":00Z"}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();var xt=r(5196),zt=r(40912);let Ut=(()=>{class l{constructor(){}filterByOgc(t,i){const n=(new zt.S).formatProcessedOgcFilter(i,t.options.params.LAYERS);t.ol.updateParams({FILTER:n})}setOgcWFSFiltersOptions(t){const i=t.options,n=new zt.S;i.ogcFilters.enabled&&i.ogcFilters.filters&&(i.ogcFilters.filters=n.checkIgoFiltersProperties(i.ogcFilters.filters,i.paramsWFS.fieldNameGeometry,new mt.c({code:i.paramsWFS.srsName}),!0),i.ogcFilters.interfaceOgcFilters||(i.ogcFilters.interfaceOgcFilters=n.defineInterfaceFilterSequence(i.ogcFilters.filters,i.paramsWFS.fieldNameGeometry)))}setOgcWMSFiltersOptions(t){const i=t.options,n=new zt.S;i.ogcFilters.enabled&&i.ogcFilters.filters?(i.ogcFilters.filters=n.checkIgoFiltersProperties(i.ogcFilters.filters,i.fieldNameGeometry,void 0,!0),i.ogcFilters.interfaceOgcFilters||(i.ogcFilters.interfaceOgcFilters=n.defineInterfaceFilterSequence(i.ogcFilters.filters,i.fieldNameGeometry)),this.filterByOgc(t,n.buildFilter(i.ogcFilters.filters,void 0,void 0,void 0,t.options)),i.filtered=!0):(i.ogcFilters.filters=void 0,i.ogcFilters.interfaceOgcFilters=[],i.filtered=!1)}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();var Xt=function(l){return l.Predefined="Predefined",l.Polygon="Polygon",l.Point="Point",l}(Xt||{}),De=function(l){return l.Address="Address",l.Thematics="Thematics",l}(De||{});let et=(()=>{class l{http;languageService;configService;baseUrl="https://geoegl.msp.gouv.qc.ca/apis/terrapi/";urlFilterList={AdmRegion:"regadmin",Arrond:"arrondissements",CircFed:"circ-fed",CircProv:"circ-prov",DirReg:"dir-reg",MRC:"mrc",Mun:"municipalites",RegTour:"tourisme",bornes:"bornes-sumi",hydro:"hydro",routes:"routes"};constructor(t,i,n){this.http=t,this.languageService=i,this.configService=n,this.baseUrl=this.configService.getConfig("spatialFilter.url")||this.baseUrl}getKeyByValue(t,i){return Object.keys(t).find(n=>t[n]===i)}loadFilterList(t){if(t)return this.http.get(this.baseUrl+this.urlFilterList[t]).pipe((0,oe.k)(n=>n.features.map(p=>(p.meta={id:p.properties.code},p))))}loadThematicsList(){const i=[];return this.http.get(this.baseUrl+"types").pipe((0,oe.k)(n=>(n.forEach(p=>{if(p.startsWith("lieux")){const v={name:void 0,source:p};let Y=p.substring(6,p.length),ue=Y;if(Y.includes(".")){const ye=Y.indexOf(".");ue=Y.substring(ye+1,Y.length),Y=Y.substring(0,ye)}try{v.name=this.languageService.translate.instant("igo.geo.terrapi."+ue)}catch{v.name=ue.substring(0,1).toUpperCase()+ue.substring(1,ue.length-1)}try{v.group=this.languageService.translate.instant("igo.geo.spatialFilter.group."+Y)}catch{v.group=Y.substring(0,1).toUpperCase()+Y.substring(1,ue.length-1)}i.push(v)}else if(this.getKeyByValue(this.urlFilterList,p)){const v={name:void 0,source:p},Y=this.getKeyByValue(this.urlFilterList,p);try{v.name=this.languageService.translate.instant("igo.geo.terrapi."+Y)}catch{v.name=Y.substring(0,1).toUpperCase()+Y.substring(1,Y.length-1)}v.source=p,i.push(v)}}),i)))}loadFilterItem(t,i,n,p,v){if(n){const ue=this.baseUrl+this.urlFilterList[n];let ye="";return i===De.Address?(ye="adresses",this.http.get(ue+"/"+t.properties.code+"/"+ye,{params:{geometry:"true",icon:"true",bufferInput:v.toString(),simplified:"100"}}).pipe((0,oe.k)(Ee=>Ee.features.map(we=>(we.meta={id:we.properties.code,title:this.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:we.icon},we))))):(ye=p.source,this.http.get(ue+"/"+t.properties.code+"/"+ye,{params:{geometry:"true",icon:"true",bufferInput:v.toString(),simplified:"100"}}).pipe((0,oe.k)(Ee=>Ee.features.map(we=>(we.meta={id:we.properties.code,title:p.name,icon:we.icon},we)))))}{const Y=this.baseUrl+"locate";return i===De.Address?this.http.post(Y+"?type=adresses",{geometry:"true",icon:"true",loc:JSON.stringify(t),bufferInput:v.toString(),simplified:"100"}).pipe((0,oe.k)(ye=>ye.features.map(Ee=>(Ee.meta={id:Ee.properties.code,title:this.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:Ee.icon},Ee)))):this.http.post(Y+"?type="+p.source,{geometry:"true",icon:"true",loc:JSON.stringify(t),bufferInput:v.toString(),simplified:"100"}).pipe((0,oe.k)(ye=>ye.features.map(Ee=>(Ee.meta={id:Ee.properties.code,title:p.name,icon:Ee.icon},Ee))))}}loadItemById(t,i){const n=this.urlFilterList[i],p="/"+t.properties.code;if(n&&p)return this.http.get(this.baseUrl+n+p,{params:{geometry:"true"}}).pipe((0,oe.k)(v=>(v.meta={id:v.properties.code,alias:v.properties.nom,title:v.properties.nom},v)))}loadBufferGeometry(t,i,n,p){if(i!==Xt.Predefined)return this.http.post(this.baseUrl+"geospatial/buffer?",{buffer:n,loc:JSON.stringify(t)}).pipe((0,oe.k)(v=>v));{const v=this.urlFilterList[p],Y="/"+t.properties.code;if(v&&Y)return this.http.get(this.baseUrl+v+Y,{params:{geometry:"100",bufferOutput:n.toString()}}).pipe((0,oe.k)(ue=>(ue.meta={id:ue.properties.code,alias:ue.properties.nom,title:ue.properties.nom},ue)))}}static \u0275fac=function(i){return new(i||l)(e.CoB(fe.KK),e.CoB(k.ov),e.CoB(A.aW))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),he=(()=>{class l{messageService;constructor(t){this.messageService=t}open(t){this.messageService.success("igo.geo.download.start","igo.geo.download.title");const i=t.dataSource.options;if(Object.keys(i.download).length>0)if(i.download.dynamicUrl&&void 0===i.download.url){let n,p=new mt.c({code:t.map.projection});const v=t.dataSource.options.paramsWFS;v&&Object.keys(v).length>0?(p=v.srsName?new mt.c({code:v.srsName}):p,n=t.dataSource.options.paramsWFS):n=t.dataSource.options.params;const Y=V.W0(t.map.viewController.getExtent(),new mt.c({code:t.map.projection}),p),ue=void 0===n.outputFormatDownload?void 0===n.outputFormat?"":"outputformat="+n.outputFormat:"outputformat="+n.outputFormatDownload,ye=i.download.dynamicUrl.replace(/&?outputformat=[^&]*/gi,"").replace(/&?filter=[^&]*/gi,"").replace(/&?bbox=[^&]*/gi,""),Ee=t.dataSource.options.ogcFilters;let we;we=(new zt.S).handleOgcFiltersAppliedValue(t.dataSource.options,Ee.geometryName,Y,p),we=we?"filter="+encodeURIComponent(we):(new zt.S).buildFilter(void 0,Y,p,Ee.geometryName),window.open(`${ye}&${we}&${ue}`,"_blank")}else i.download&&window.open(i.download.url,"_blank")}static \u0275fac=function(i){return new(i||l)(e.CoB(Ht.mi))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var pe=r(72584);function Pe(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",1),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.openDownload(n.layer))}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"download"),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.download.action"))("color",t.color)}}let $e=(()=>{class l{downloadService;get layer(){return this._layer}set layer(t){this._layer=t}_layer;get color(){return this._color}set color(t){this._color=t}_color="primary";constructor(t){this.downloadService=t}openDownload(t){this.downloadService.open(t)}get options(){if(this.layer)return this.layer.dataSource.options}static \u0275fac=function(i){return new(i||l)(e.GI1(he))};static \u0275cmp=e.In1({type:l,selectors:[["igo-download-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[e.UHJ],decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"]],template:function(i,n){1&i&&e.yuY(0,Pe,4,4,"button",0),2&i&&e.E7m("ngIf",n.options&&n.options.download&&(n.options.download.dynamicUrl||n.options.download.url))},dependencies:[Ke.u_,Ze.oJ,Ze.um,ht.KO,ht.a4,dt.oB,dt.qL,k._s,pe.sD],changeDetection:0})}return l})();var st=r(50032),Wt=r(34080),xe=r(71904),$t=r(58539),to=r(75180),Ot=r(63916),kt=r(46176),yt=r(50244),Gt=r(77872),zo=r(21780);const Vn=["renderedLegend"];function vo(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-list-item")(1,"mat-icon",7),e.qCj("toggle",function(n){e.usT(t);const p=e.GaO(2).$implicit,v=e.GaO(3);return e.CGJ(v.toggleLegendItem(n,p))}),e.OEk(2,"expand_less "),e.C$Y(),e.I0R(3,"span",8),e.OEk(4),e.wVc(5,"async"),e.C$Y()()}if(2&l){e.GaO();const t=e.Gew(3),i=e.GaO().$implicit,n=e.GaO(3);e.yG2(),e.E7m("target",t)("collapsed",i.collapsed),e.yG2(3),e.oRS("",e.kDX(5,3,n.computeItemTitle(i))," ")}}function sn(l,m){if(1&l&&(e.I0R(0,"mat-option",11),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.name),e.yG2(),e.cNF(t.title)}}function Oi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div")(1,"mat-form-field")(2,"mat-select",9),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(5);return e.kNx(p.currentStyle,n)||(p.currentStyle=n),e.CGJ(n)}),e.qCj("selectionChange",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.onChangeStyle())}),e.wVc(3,"translate"),e.yuY(4,sn,2,2,"mat-option",10),e.C$Y()()()}if(2&l){const t=e.GaO(5);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("ngModel",t.currentStyle),e.yG2(2),e.E7m("ngForOf",t.styles)}}function an(l,m){if(1&l){const t=e.KQA();e.I0R(0,"img",14,15),e.qCj("load",function(){e.usT(t);const n=e.GaO(4).$implicit,p=e.GaO(3);return e.CGJ(p.onLoadImage(n.title))}),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO(4).$implicit;e._6D("id",t.title),e._6D("alt",e.kDX(2,4,"igo.geo.layer.legend.loadingLegendText")),e.E7m("hideError",!0)("src",t.imgGraphValue,e.K6U)}}function ti(l,m){1&l&&(e.I0R(0,"small"),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLegendScale")," "))}function oi(l,m){if(1&l&&(e.I0R(0,"div"),e.yuY(1,an,3,6,"img",13)(2,ti,3,3,"small",0),e.C$Y()),2&l){const t=e.GaO(3).$implicit,i=e.GaO(3);e.yG2(),e.E7m("ngIf",t.imgGraphValue),e.yG2(),e.E7m("ngIf",i.imagesHeight[t.title]<16)}}function ii(l,m){if(1&l&&(e.wR5(0,"div",16),e.wVc(1,"sanitizeHtml")),2&l){const t=e.GaO(3).$implicit;e.E7m("ngStyle",t.style)("innerHTML",e.kDX(1,2,t.html),e.E3n)}}function ni(l,m){if(1&l&&(e.I0R(0,"div"),e.yuY(1,oi,3,2,"div",0)(2,ii,2,4,"div",12),e.C$Y()),2&l){const t=e.GaO(2).$implicit;e.yG2(),e.E7m("ngIf",t.url),e.yG2(),e.E7m("ngIf",t.html)}}const ri=l=>({"with-title":l});function Lo(l,m){if(1&l&&(e.I0R(0,"div"),e.yuY(1,vo,6,5,"mat-list-item",0),e.I0R(2,"div",5,6),e.yuY(4,Oi,5,5,"div",0)(5,ni,3,2,"div",0),e.C$Y()()),2&l){const t=e.GaO().$implicit,i=e.GaO(3);e.yG2(),e.E7m("ngIf",t.title),e.yG2(),e.E7m("ngClass",e.S45(4,ri,t.title)),e.yG2(2),e.E7m("ngIf",void 0!==i.currentStyle),e.yG2(),e.E7m("ngIf",!t.collapsed)}}function si(l,m){if(1&l&&(e.SAx(0,null,4),e.yuY(2,Lo,6,6,"div",1),e.k70()),2&l){e.GaO(2);const t=e.Gew(3),i=e.GaO();e.yG2(2),e.E7m("ngIf",i.getLegend)("ngIfElse",t)}}function Ii(l,m){if(1&l&&(e.SAx(0),e.yuY(1,si,3,2,"ng-container",3),e.k70()),2&l){const t=e.GaO().ngIf;e.yG2(),e.E7m("ngForOf",t.slice().reverse())}}function wi(l,m){1&l&&(e.I0R(0,"small"),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLegendText")," "))}function Ui(l,m){if(1&l&&(e.SAx(0),e.yuY(1,Ii,2,1,"ng-container",1)(2,wi,3,3,"ng-template",null,2,e.gJz),e.k70()),2&l){const t=m.ngIf,i=e.Gew(3);e.yG2(),e.E7m("ngIf",t.length)("ngIfElse",i)}}let Ao=(()=>{class l{capabilitiesService;languageService;configService;http;cdRef;updateLegendOnResolutionChange=!1;legendItems$=new B.g([]);state$$;styles;currentStyle;scale=void 0;view=void 0;renderedLegends;imagesHeight={};layer;getLegend=!0;constructor(t,i,n,p,v){this.capabilitiesService=t,this.languageService=i,this.configService=n,this.http=p,this.cdRef=v}ngOnInit(){let t=this.layer.legend;this.styles=this.listStyles();const i=this.layer.options.source.options;if(i&&i.params&&i.params.STYLES?this.currentStyle=this.styles.find(n=>n.name===i.params.STYLES).name:t?this.styles&&this.styles.length>1&&(this.currentStyle=t[0].currentStyle):this.styles&&this.styles.length>1&&(this.currentStyle=this.styles[0].name),t=typeof this.layer.options.legendOptions<"u"&&!1===this.layer.options.legendOptions.display?[]:this.layer.dataSource.getLegend(this.currentStyle,this.view),this.updateLegendOnResolutionChange||i.contentDependentLegend)this.state$$=this.layer.map.viewController.state$.subscribe(()=>this.onViewControllerStateChange());else if(t&&0!==t.length){this.legendItems$.next(t);for(const n of t)this.getLegendGraphic(n)}}ngOnDestroy(){void 0!==this.state$$&&this.state$$.unsubscribe()}getLegendGraphic(t){t.url&&new be.kd(this.http,this.configService).transform(t.url).pipe((0,se.a)(n=>{if(n.error)return n.error.caught=!0,this.getLegend=!1,this.cdRef.detectChanges(),n})).subscribe(n=>{const p=this.legendItems$.value.findIndex(Y=>Y.title===t.title);this.legendItems$.value[p].imgGraphValue=n,this.cdRef.detectChanges()})}toggleLegendItem(t,i){i.collapsed=t}transfertToggleLegendItem(t){const i=t,n=this.layer.legend;for(let p=0;p<n.length;p++)i[p].collapsed=n[p].collapsed;return i}computeItemTitle(t){const i=this.layer.dataSource.options;if("wms"!==i.type)return(0,z.of)(t.title);const n=i.params.LAYERS.split(","),p=JSON.parse(JSON.stringify(i));return p.params.LAYERS=n.find(v=>v===t.title),this.capabilitiesService.getWMSOptions(p).pipe((0,oe.k)(v=>v._layerOptionsFromSource.title))}onViewControllerStateChange(){this.view={resolution:this.layer.map.viewController.getResolution(),extent:this.layer.map.viewController.getExtent(),projection:this.layer.map.viewController.getOlProjection().getCode(),scale:this.layer.map.viewController.getScale(),size:this.layer.map.ol.getSize()},this.updateLegend()}updateLegend(){let t=this.layer.dataSource.getLegend(this.currentStyle,this.view);if(this.layer.legend&&this.layer.legend.length>1&&(t=this.transfertToggleLegendItem(t)),this.layer.legend=t,0!==t.length||0!==this.legendItems$.value.length){this.legendItems$.next(t);for(const i of this.legendItems$.value)this.getLegendGraphic(i)}}listStyles(){const t=this.layer.options;if(t&&t.legendOptions){let p=[{name:"",title:this.languageService.translate.instant("igo.geo.layer.legend.default")}];return t.legendOptions.stylesAvailable&&(p=p.concat(t.legendOptions.stylesAvailable.filter(v=>"default"!==v.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")&&"defaut"!==v.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")))),p.filter(v=>!v.title).map(v=>v.title=v.name),p.map(v=>v.title=v.title.charAt(0).toUpperCase()+v.title.slice(1).replace(/_/g," ")),p}}onChangeStyle(){this.updateLegend();let t="";this.layer.dataSource instanceof qo.C&&(this.layer.dataSource.ol.getParams().LAYERS.split(",").map(i=>t+=this.currentStyle+","),t=t.slice(0,-1),this.layer.dataSource.ol.updateParams({STYLES:t}))}onLoadImage(t){let i;i=1===this.renderedLegends.length?this.renderedLegends.first.nativeElement:this.renderedLegends.find(n=>n.nativeElement.id===t).nativeElement,this.imagesHeight[t]=i.height}static \u0275fac=function(i){return new(i||l)(e.GI1(zo.S),e.GI1(k.ov),e.GI1(A.aW),e.GI1(fe.KK),e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-legend"]],viewQuery:function(i,n){if(1&i&&e.CC$(Vn,5),2&i){let p;e.wto(p=e.Gqi())&&(n.renderedLegends=p)}},inputs:{updateLegendOnResolutionChange:"updateLegendOnResolutionChange",layer:"layer"},standalone:!0,features:[e.UHJ],decls:2,vars:3,consts:[[4,"ngIf"],[4,"ngIf","ngIfElse"],["noItems",""],[4,"ngFor","ngForOf"],["renderedLegends",""],[1,"igo-layer-legend",3,"ngClass"],["legend",""],["id","legend-toggle","matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"target","collapsed","toggle"],["matListItemTitle",""],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"ngStyle","innerHTML",4,"ngIf"],["igoImageError","",3,"hideError","id","src","alt","load",4,"ngIf"],["igoImageError","",3,"hideError","id","src","alt","load"],["renderedLegend",""],[3,"ngStyle","innerHTML"]],template:function(i,n){1&i&&(e.yuY(0,Ui,4,2,"ng-container",0),e.wVc(1,"async")),2&i&&e.E7m("ngIf",e.kDX(1,1,n.legendItems$))},dependencies:[Ke.u_,Ke.Iw,Ot.iI,Ot.g9,Ot.Y1,Ot.UV,dt.oB,dt.qL,be.mK,Ke.QF,yt.wb,yt.Up,Gt.d5,Gt.kX,kt.I5,ht.KO,ht.a4,xe.y,xe.ue,xe._G,kt.Ax,be.MJ,Ke.Qt,Ke.a,k._s,pe.sD,be.Ux],styles:['[_nghost-%COMP%]   .igo-layer-legend.with-title[_ngcontent-%COMP%]{padding-left:18px}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%}[_nghost-%COMP%]   img[_ngcontent-%COMP%]:after{content:" ";position:relative;height:17px;float:left;width:17px;top:-3px;right:19px;background-color:#fff;border:3px solid #f3f3f3;border-radius:50%;animation:2s linear infinite _ngcontent-%COMP%_spin}@-moz-document url-prefix(){-shadowcsshost-no-combinator img:after{margin-left:19px}}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}'],changeDetection:0})}return l})();var mo=r(69400),Bt=r(42536),ho=r(10416);let ai=(()=>{class l{constructor(){}wktToFeature(t,i,n){return(new ho.c).readFeature(t,{dataProjection:i,featureProjection:n})}extentToWkt(t,i,n){let p=V.W0(i,n,t);return p=this.roundCoordinateArray(p,t,0),{wktPoly:`POLYGON((\n      ${i[0]} ${i[1]},\n      ${i[0]} ${i[3]},\n      ${i[2]} ${i[3]},\n      ${i[2]} ${i[1]},\n      ${i[0]} ${i[1]}))`,wktLine:`LINESTRING(\n      ${i[0]} ${i[1]},\n      ${i[0]} ${i[3]},\n      ${i[2]} ${i[3]},\n      ${i[2]} ${i[1]},\n      ${i[0]} ${i[1]})`,wktMultiPoints:`MULTIPOINT(\n        ${i[0]} ${i[1]},\n        ${i[0]} ${i[3]},\n        ${i[2]} ${i[3]},\n        ${i[2]} ${i[1]})`}}roundCoordinateArray(t,i,n=0){const v=V._M(i).getUnits();return-1!==["ft","m","us-ft"].indexOf(v)&&(t=this.roundArray(t,n)),t}roundArray(t,i=0){let n=0;for(;n<t.length;)t[n]=t[n].toFixed(i),n++;return t}snrcToWkt(t,i){let n;t=t.toLowerCase();const p={1:{from:-56,to:-64},2:{from:-64,to:-72},3:{from:-72,to:-80},4:{from:-80,to:-88},5:{from:-88,to:-96},6:{from:-96,to:-104},7:{from:-104,to:-112},8:{from:-112,to:-120},9:{from:-120,to:-128},10:{from:-128,to:-136}},v={1:{from:44,to:48},2:{from:48,to:52},3:{from:52,to:56},4:{from:56,to:60},5:{from:60,to:64},6:{from:64,to:68},7:{from:68,to:72},8:{from:72,to:76},9:{from:76,to:-128}},Y=[["m","n","o","p"],["l","k","j","i"],["e","f","g","h"],["d","c","b","a"]],ue=[["13","14","15","16"],["12","11","10","09"],["05","06","07","08"],["04","03","02","01"]];let Le=!1,Xe=!1,Ge=!1;if(/\d{2,3}[a-p][0,1][0-9]/gi.test(t)?Ge=!0:/\d{2,3}[a-p]/gi.test(t)?Xe=!0:/\d{2,3}/gi.test(t)&&(Le=!0),Le?t+="a01":Xe&&(t+="01"),/\d{2,3}[a-p][0,1][0-9]/gi.test(t)){const pt=t.split(/(?=[a-p])/gi),Tt=pt[0],jt=pt[1][0],Co=pt[1].split(jt)[1];let Wo=1;3===Tt.length&&(Wo=2);const er=Tt.substring(0,Wo),dl=Tt.substring(Wo),pl=8,No=4,vi=2,tr=1,ml=.5,gl=.25;let Ss=0,bs=0,hl=0,fl=0;Y.forEach(Yn=>{-1!==Yn.indexOf(jt)&&(bs=Y.indexOf(Yn),Ss=Yn.indexOf(jt))}),ue.forEach(Yn=>{-1!==Yn.indexOf(Co)&&(fl=ue.indexOf(Yn),hl=Yn.indexOf(Co))});let Os=0,Is=0,ws=0,Ts=0,Br=pl,Ur=No;Xe?(Os=Ss*vi,Is=bs*tr,ws=0,Ts=0,Br=vi,Ur=tr):Ge&&(Os=Ss*vi,Is=bs*tr,ws=hl*ml,Ts=fl*gl,Br=ml,Ur=gl);const Mt={ul:[p[er].to+Os+ws,v[dl].to-Is-Ts]};return Mt.lr=[Mt.ul[0]+Br,Mt.ul[1]-Ur],Mt.ur=[Mt.ul[0],Mt.ul[1]-Ur],Mt.ll=[Mt.ul[0]+Br,Mt.ul[1]],Mt.ul=V.AF([Mt.ul[0],Mt.ul[1]],"EPSG:4326",i),Mt.lr=V.AF([Mt.lr[0],Mt.lr[1]],"EPSG:4326",i),Mt.ur=V.AF([Mt.ur[0],Mt.ur[1]],"EPSG:4326",i),Mt.ll=V.AF([Mt.ll[0],Mt.ll[1]],"EPSG:4326",i),Mt.ul=this.roundCoordinateArray(Mt.ul,i,0),Mt.lr=this.roundCoordinateArray(Mt.lr,i,0),Mt.ur=this.roundCoordinateArray(Mt.ur,i,0),Mt.ll=this.roundCoordinateArray(Mt.ll,i,0),n="POLYGON(("+[Mt.ul.join(" "),Mt.ur.join(" "),Mt.lr.join(" "),Mt.ll.join(" "),Mt.ul.join(" ")].join(",")+"))",{wktPoly:n,wktLine:"LINESTRING("+[Mt.ul.join(" "),Mt.ur.join(" "),Mt.lr.join(" "),Mt.ll.join(" "),Mt.ul.join(" ")].join(",")+")",wktMultiPoints:"MULTIPOINT("+[Mt.ul.join(" "),Mt.ur.join(" "),Mt.lr.join(" "),Mt.ll.join(" ")].join(",")+")"}}}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var Ti=r(61792),Bo=r(24392),co=r(43424),Yi=r(30816),at=r.n(Yi);let go=(()=>{class l{defaultStepMillisecond=6e4;constructor(){}step(t,i){return t.options.stepDate?t.options.stepDate:i.step}stepMillisecond(t,i){const n=at().duration(this.step(t,i)).asMilliseconds();return 0===n?this.defaultStepMillisecond:n}stepIsYearDuration(t){const i=at().duration(t);return 0!==i.years()&&0===i.months()&&0===i.weeks()&&0===i.days()&&0===i.hours()&&0===i.minutes()}stepIsMonthDuration(t){const i=at().duration(t);return 0!==i.months()&&0===i.weeks()&&0===i.days()&&0===i.hours()&&0===i.minutes()}stepIsWeekDuration(t){const i=at().duration(t);return 0!==i.weeks()&&7===i.days()&&0===i.hours()&&0===i.minutes()}stepIsDayDuration(t){const i=at().duration(t);return 0!==i.days()&&0===i.hours()&&0===i.minutes()}stepIsHourDuration(t){const i=at().duration(t);return 0!==i.hours()&&0===i.minutes()}stepIsMinuteDuration(t){return 0!==at().duration(t).minutes()}dateToNumber(t){let i=new Date;return t&&(i=new Date(t)),i.getTime()}addStep(t,i){return at()(t).add(i,"milliseconds").toDate()}subtractStep(t,i){return at()(t).subtract(i,"milliseconds").toDate()}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();var Jt=r(79764);let So=(()=>{class l{ogcFilterTimeService;currentFilter;begin;max;datasource;changeProperty=new e._w7;slider;interval;sliderValue=1;calculatedStep=0;_defaultDisplayFormat="DD/MM/YYYY HH:mm A";_defaultSliderInterval=2e3;playIcon="play_circle";resetIcon="replay";get sliderInterval(){return void 0===this.currentFilter.sliderInterval?this._defaultSliderInterval:this.currentFilter.sliderInterval}get displayFormat(){return this.currentFilter.sliderOptions?.displayFormat?this.currentFilter.sliderOptions.displayFormat:this.currentFilter.displayFormat?this.currentFilter.displayFormat:this._defaultDisplayFormat}get beginMillisecond(){return this.ogcFilterTimeService.dateToNumber(this.begin)}get maxMillisecond(){return this.ogcFilterTimeService.dateToNumber(this.max)}get stepMillisecond(){return this.ogcFilterTimeService.stepMillisecond(this.datasource,this.currentFilter)}constructor(t){this.ogcFilterTimeService=t,this.sliderDisplayWith=this.sliderDisplayWith.bind(this)}ngOnInit(){this.calculateStep(),this.handleSliderInput({value:1})}sliderDisplayWith(t){let i=new Date(this.beginMillisecond+(t-1)*this.stepMillisecond);if(this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const n=at().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).years();i=at()(this.beginMillisecond).add((t-1)*n,"year").toDate()}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const n=at().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).months();i=at()(this.beginMillisecond).add((t-1)*n,"month").toDate()}return at()(i).format(this.displayFormat)}playFilter(t){this.interval?this.stopFilter():(this.playIcon="pause_circle",this.interval=setInterval(i=>{if(this.slider.step<this.calculatedStep){const p="_emitInputEvent";this.slider._increment(1),this.slider[p]()}else this.stopFilter()},this.sliderInterval,this))}stopFilter(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play_circle"}resetFilter(t){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play_circle",this.slider.step=1,this.slider._emitInputEvent()}handleSliderInput(t){if(t)if(this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const i=at().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).years(),n=at()(this.beginMillisecond).add((t.value-1)*i,"year").toDate(),p=at()(n).add(i,"year").toDate();this.changeProperty.next({value:at()(n).toDate().toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:at()(p).toDate().toISOString(),pos:2,refreshFilter:!0})}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const i=at().duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).months(),n=at()(this.beginMillisecond).add((t.value-1)*i,"month").toDate(),p=at()(n).add(i,"month").toDate();this.changeProperty.next({value:at()(n).startOf("month").toDate().toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:at()(p).toDate().toISOString(),pos:2,refreshFilter:!0})}else if(this.ogcFilterTimeService.stepIsDayDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))||this.ogcFilterTimeService.stepIsHourDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))||this.ogcFilterTimeService.stepIsMinuteDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){const i=new Date(this.beginMillisecond+this.stepMillisecond*(t.value-1));this.changeProperty.next({value:i.toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:new Date(this.ogcFilterTimeService.addStep(i.toISOString(),this.stepMillisecond)).toISOString(),pos:2,refreshFilter:!0})}}calculateStep(){for(let t=1;this.maxMillisecond-(this.beginMillisecond+t*this.stepMillisecond)>=-1;t++)this.calculatedStep=t}static \u0275fac=function(i){return new(i||l)(e.GI1(go))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter-time-slider"]],viewQuery:function(i,n){if(1&i&&e.CC$(Jt.Cg,5),2&i){let p;e.wto(p=e.Gqi())&&(n.slider=p.first)}},inputs:{currentFilter:"currentFilter",begin:"begin",max:"max",datasource:"datasource"},outputs:{changeProperty:"changeProperty"},standalone:!0,features:[e.M5G([go]),e.UHJ],decls:11,vars:7,consts:[[1,"slider-container"],["id","time-slider","thumbLabel","",3,"step","min","max","ngModel","displayWith","ngModelChange"],["ngSlider",""],["matSliderThumb","",3,"input"],["ngSliderThumb","matSliderThumb"],["mat-icon-button","","color","primary",3,"click"]],template:function(i,n){if(1&i){const p=e.KQA();e.I0R(0,"div",0)(1,"mat-slider",1,2),e.iHE("ngModelChange",function(Y){return e.kNx(n.sliderValue,Y)||(n.sliderValue=Y),Y}),e.I0R(3,"input",3,4),e.qCj("input",function(){e.usT(p);const Y=e.Gew(4),ue=e.Gew(2);return e.CGJ(n.handleSliderInput({source:Y,parent:ue,value:Y.value}))}),e.C$Y()(),e.I0R(5,"button",5),e.qCj("click",function(Y){return n.playFilter(Y)}),e.I0R(6,"mat-icon"),e.OEk(7),e.C$Y()(),e.I0R(8,"button",5),e.qCj("click",function(Y){return n.resetFilter(Y)}),e.I0R(9,"mat-icon"),e.OEk(10),e.C$Y()()()}2&i&&(e.yG2(),e.E7m("step",1)("min",1)("max",n.calculatedStep),e.OKB("ngModel",n.sliderValue),e.E7m("displayWith",n.sliderDisplayWith),e.yG2(6),e.cNF(n.playIcon),e.yG2(3),e.cNF(n.resetIcon))},dependencies:[Jt.yO,Jt.Cg,Jt._s,xe.y,xe.ue,xe._G,Ze.oJ,Ze.um,dt.oB,dt.qL],styles:["[_nghost-%COMP%]     input{text-align:center!important;margin:auto 5px!important}[_nghost-%COMP%]   .datetime-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .slider-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .datetime-input[_ngcontent-%COMP%]{display:inline-block;margin:5px 25px}[_nghost-%COMP%]   .date-input[_ngcontent-%COMP%]{width:120px;margin-right:25px}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{display:inherit;margin-right:25px}[_nghost-%COMP%]   .hour-input[_ngcontent-%COMP%], [_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{width:40px}[_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{margin-left:10px}"]})}return l})();const Xo=["endDatepickerTime"],jn=["beginDatepickerTime"],Ei=["beginTime"],bo=["endTime"];function Uo(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",4),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO();return e.kNx(p.sliderMode,n)||(p.sliderMode=n),e.CGJ(n)}),e.qCj("change",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.modeChange(n))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.OKB("ngModel",t.sliderMode),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.filter.sliderModeTitle")," ")}}function Oo(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",5)(1,"igo-ogc-filter-time-slider",6),e.qCj("changeProperty",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changePropertyByPass(n))}),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("begin",t.beginValue)("max",t.restrictedToStep()?t.maxDate:t.endValue)("currentFilter",t.currentFilter)("datasource",t.datasource)}}function ln(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",9)(1,"mat-form-field",10)(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"input",11),e.qCj("change",function(n){e.usT(t);const p=e.Gew(8),v=e.GaO(2);return e.CGJ(v.yearOnlyInputChange(n,p,"begin"))}),e.C$Y(),e.wR5(6,"mat-datepicker-toggle",12),e.I0R(7,"mat-datepicker",13,14),e.qCj("yearSelected",function(n){e.usT(t);const p=e.Gew(8),v=e.GaO(2);return e.CGJ(v.yearSelected(n,p,"begin"))}),e.C$Y(),e.wR5(9,"input",15,16),e.C$Y(),e.I0R(11,"mat-form-field",10)(12,"mat-label"),e.OEk(13),e.wVc(14,"translate"),e.C$Y(),e.I0R(15,"input",11),e.qCj("change",function(n){e.usT(t);const p=e.Gew(18),v=e.GaO(2);return e.CGJ(v.yearOnlyInputChange(n,p,"end"))}),e.C$Y(),e.wR5(16,"mat-datepicker-toggle",12),e.I0R(17,"mat-datepicker",13,17),e.qCj("yearSelected",function(n){e.usT(t);const p=e.Gew(18),v=e.GaO(2);return e.CGJ(v.yearSelected(n,p,"end"))}),e.C$Y(),e.wR5(19,"input",15,18),e.C$Y(),e.I0R(21,"div",19)(22,"button",20),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.resetFilter())}),e.wVc(23,"translate"),e.I0R(24,"mat-icon"),e.OEk(25),e.C$Y()(),e.I0R(26,"mat-slide-toggle",21),e.qCj("change",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.toggleFilterState())}),e.wVc(27,"translate"),e.C$Y()()()}if(2&l){const t=e.Gew(8),i=e.Gew(18),n=e.GaO(2);e.yG2(3),e.cNF(e.kDX(4,27,"igo.geo.timeFilter.startYear")),e.yG2(2),e._6D("value",n.onlyYearBegin),e.E7m("disabled",n.filterStateDisable),e.yG2(),e.E7m("for",t)("disabled",n.filterStateDisable),e.yG2(),e.E7m("startView",n.calendarView())("startAt",n.beginValue),e.yG2(2),e.E7m("matDatepicker",t)("value",n.beginValue?n.beginValue:n.handleDate(n.datasource.options.minDate))("min",n.handleDate(n.datasource.options.minDate))("max",n.endValue&&!n.restrictedToStep()?n.endValue:n.handleDate(n.datasource.options.maxDate)),e.yG2(4),e.cNF(e.kDX(14,29,"igo.geo.timeFilter.endYear")),e.yG2(2),e._6D("value",n.onlyYearEnd),e.E7m("disabled",n.filterStateDisable),e.yG2(),e.E7m("for",i)("disabled",n.filterStateDisable),e.yG2(),e.E7m("startView",n.calendarView())("startAt",n.endValue),e.yG2(2),e.E7m("matDatepicker",i)("value",n.endValue?n.endValue:n.handleDate(n.datasource.options.maxDate))("min",n.beginValue?n.beginValue:n.handleDate(n.datasource.options.minDate))("max",n.handleDate(n.datasource.options.maxDate)),e.yG2(3),e.E7m("matTooltip",e.kDX(23,31,"igo.geo.filter.resetFilters"))("disabled",n.filterStateDisable),e.yG2(3),e.cNF(n.resetIcon),e.yG2(),e.E7m("matTooltip",e.kDX(27,33,"igo.geo.filter.toggleFilterState"))("checked",!n.filterStateDisable)}}function Vi(l,m){if(1&l&&(e.I0R(0,"mat-option",36),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function Kn(l,m){if(1&l&&(e.I0R(0,"mat-option",36),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function li(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",31)(1,"mat-form-field",32)(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"mat-select",33),e.qCj("selectionChange",function(){e.usT(t),e.GaO();const n=e.Gew(5),p=e.GaO(2);return e.CGJ(p.changeTemporalProperty(n.value,1))}),e.yuY(6,Vi,2,2,"mat-option",34),e.C$Y()(),e.I0R(7,"mat-form-field",35)(8,"mat-label"),e.OEk(9),e.wVc(10,"translate"),e.C$Y(),e.I0R(11,"mat-select",33),e.qCj("selectionChange",function(){e.usT(t),e.GaO();const n=e.Gew(5),p=e.GaO(2);return e.CGJ(p.changeTemporalProperty(n.value,1))}),e.yuY(12,Kn,2,2,"mat-option",34),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(3),e.cNF(e.kDX(4,8,"igo.geo.timeFilter.hour")),e.yG2(2),e.E7m("formControl",t.beginHourFormControl),e.e48("disabled",!t.currentFilter.active),e.yG2(),e.E7m("ngForOf",t.beginHours),e.yG2(3),e.cNF(e.kDX(10,10,"igo.geo.timeFilter.minute")),e.yG2(2),e.E7m("formControl",t.beginMinuteFormControl),e.e48("disabled",!t.currentFilter.active),e.yG2(),e.E7m("ngForOf",t.beginMinutes)}}function Yo(l,m){if(1&l&&(e.I0R(0,"mat-option",36),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function xi(l,m){if(1&l&&(e.I0R(0,"mat-option",36),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function Io(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",31)(1,"mat-form-field",32)(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"mat-select",33),e.qCj("selectionChange",function(){e.usT(t),e.GaO();const n=e.Gew(4),p=e.GaO(3);return e.CGJ(p.changeTemporalProperty(n.value,2))}),e.yuY(6,Yo,2,2,"mat-option",34),e.C$Y()(),e.I0R(7,"mat-form-field",35)(8,"mat-label"),e.OEk(9),e.wVc(10,"translate"),e.C$Y(),e.I0R(11,"mat-select",33),e.qCj("selectionChange",function(){e.usT(t),e.GaO();const n=e.Gew(4),p=e.GaO(3);return e.CGJ(p.changeTemporalProperty(n.value,2))}),e.yuY(12,xi,2,2,"mat-option",34),e.C$Y()()()}if(2&l){const t=e.GaO(4);e.yG2(3),e.cNF(e.kDX(4,8,"igo.geo.timeFilter.hour")),e.yG2(2),e.E7m("formControl",t.endHourFormControl),e.e48("disabled",!t.currentFilter.active),e.yG2(),e.E7m("ngForOf",t.endHours),e.yG2(3),e.cNF(e.kDX(10,10,"igo.geo.timeFilter.minute")),e.yG2(2),e.E7m("formControl",t.endMinuteFormControl),e.e48("disabled",!t.currentFilter.active),e.yG2(),e.E7m("ngForOf",t.endMinutes)}}function ci(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",23)(1,"mat-form-field",24),e.wR5(2,"mat-datepicker-toggle",12),e.I0R(3,"input",25,37),e.qCj("dateChange",function(){e.usT(t);const n=e.Gew(4),p=e.GaO(3);return e.CGJ(p.changeTemporalProperty(n.value,2))}),e.wVc(5,"translate"),e.C$Y(),e.wR5(6,"span",27),e.I0R(7,"mat-datepicker",28,17),e.qCj("yearSelected",function(n){e.usT(t);const p=e.Gew(8),v=e.GaO(3);return e.CGJ(v.yearSelected(n,p,"end"))})("monthSelected",function(n){e.usT(t);const p=e.Gew(8),v=e.GaO(3);return e.CGJ(v.monthSelected(n,p,"end"))}),e.C$Y()(),e.yuY(9,Io,13,12,"div",29),e.C$Y()}if(2&l){const t=e.Gew(8),i=e.GaO(3);e.yG2(2),e.E7m("for",t)("disabled",i.filterStateDisable),e.yG2(),e.E7m("matDatepicker",t)("placeholder",e.kDX(5,13,"igo.geo.timeFilter.endDate"))("matDatepickerFilter",i.filterEndFunction)("value",i.endValue?i.endValue:i.handleDate(i.datasource.options.maxDate))("min",i.beginValue?i.beginValue:i.handleDate(i.datasource.options.minDate))("max",i.handleDate(i.datasource.options.maxDate))("disabled",i.filterStateDisable),e.e48("disabled",!i.currentFilter.active),e.yG2(4),e.E7m("startView",i.calendarView())("startAt",i.endValue),e.yG2(2),e.E7m("ngIf","datetime"===i.calendarType())}}function Vo(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",22)(1,"div",23)(2,"mat-form-field",24),e.wR5(3,"mat-datepicker-toggle",12),e.I0R(4,"input",25,26),e.qCj("dateChange",function(){e.usT(t);const n=e.Gew(5),p=e.GaO(2);return e.CGJ(p.changeTemporalProperty(n.value,1))}),e.wVc(6,"translate"),e.C$Y(),e.wR5(7,"span",27),e.I0R(8,"mat-datepicker",28,14),e.qCj("yearSelected",function(n){e.usT(t);const p=e.Gew(9),v=e.GaO(2);return e.CGJ(v.yearSelected(n,p,"begin"))})("monthSelected",function(n){e.usT(t);const p=e.Gew(9),v=e.GaO(2);return e.CGJ(v.monthSelected(n,p,"begin"))}),e.C$Y()(),e.yuY(10,li,13,12,"div",29),e.C$Y(),e.yuY(11,ci,10,15,"div",30),e.I0R(12,"div",19)(13,"button",20),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.resetFilter())}),e.wVc(14,"translate"),e.I0R(15,"mat-icon"),e.OEk(16),e.C$Y()(),e.I0R(17,"mat-slide-toggle",21),e.qCj("change",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.toggleFilterState())}),e.wVc(18,"translate"),e.C$Y()()()}if(2&l){const t=e.Gew(9),i=e.GaO(2);e.yG2(3),e.E7m("for",t)("disabled",i.filterStateDisable),e.yG2(),e.E7m("matDatepicker",t)("placeholder",e.kDX(6,19,"igo.geo.timeFilter.startDate"))("matDatepickerFilter",i.filterBeginFunction)("value",i.beginValue?i.beginValue:i.handleDate(i.datasource.options.minDate))("min",i.handleDate(i.datasource.options.minDate))("max",i.endValue&&!i.restrictedToStep()?i.endValue:i.handleDate(i.datasource.options.maxDate))("disabled",i.filterStateDisable),e.e48("disabled",!i.currentFilter.active),e.yG2(4),e.E7m("startView",i.calendarView())("startAt",i.beginValue),e.yG2(2),e.E7m("ngIf","datetime"===i.calendarType()),e.yG2(),e.E7m("ngIf",!i.restrictedToStep()),e.yG2(2),e.E7m("matTooltip",e.kDX(14,21,"igo.geo.filter.resetFilters"))("disabled",i.filterStateDisable),e.yG2(3),e.cNF(i.resetIcon),e.yG2(),e.E7m("matTooltip",e.kDX(18,23,"igo.geo.filter.toggleFilterState"))("checked",!i.filterStateDisable)}}function ui(l,m){if(1&l&&(e.I0R(0,"div"),e.yuY(1,ln,28,35,"div",7)(2,Vo,19,25,"div",8),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",t.calendarTypeYear),e.yG2(),e.E7m("ngIf","year"!==t.calendarType())}}let xo=(()=>{class l{ogcFilterTimeService;datasource;currentFilter;changeProperty=new e._w7;beginHours;endHours;beginMinutes;endMinutes;beginHourFormControl=new xe.yM;beginMinuteFormControl=new xe.yM;endHourFormControl=new xe.yM;endMinuteFormControl=new xe.yM;_beginValue;_endValue;_defaultMin="1900-01-01";_defaultMax="2052-01-06";_defaultDisplayFormat="DD/MM/YYYY HH:mm A";_defaultSliderModeEnabled=!0;ogcFilterOperator=xt.e;sliderMode=!1;defaultStepMillisecond=6e4;options;onlyYearBegin;onlyYearEnd;calendarTypeYear=!1;resetIcon="replay";filterStateDisable;endDatepickerTime;beginDatepickerTime;beginTime;endTime;get step(){return this.datasource.options.stepDate?this.datasource.options.stepDate:this.currentFilter.step}get stepMilliseconds(){const t=at().duration(this.step).asMilliseconds();return 0===t?this.defaultStepMillisecond:t}set beginValue(t){this._beginValue=t}get beginValue(){return this._beginValue}set endValue(t){this._endValue=t}get endValue(){return this._endValue}get sliderInterval(){return void 0===this.currentFilter.sliderInterval?2e3:this.currentFilter.sliderInterval}get maxDate(){return this.datasource.options.maxDate?this.datasource.options.maxDate:this._defaultMax}get displayFormat(){return this.currentFilter.displayFormat?this.currentFilter.displayFormat:this._defaultDisplayFormat}filterBeginFunction;filterEndFunction;constructor(t){this.ogcFilterTimeService=t}ngOnInit(){this.currentFilter.sliderOptions&&(this.currentFilter.sliderOptions.enabled=void 0!==this.currentFilter.sliderOptions.enabled?this.currentFilter.sliderOptions.enabled:this._defaultSliderModeEnabled),this.beginValue=this.parseFilter(this.handleMin()),this.endValue=this.parseFilter(this.handleMax()),this.onlyYearBegin=this.beginValue.getUTCFullYear(),this.onlyYearEnd=this.endValue.getUTCFullYear(),this.calendarTypeYear=this.isCalendarYearMode(),this.setFilterStateDisable(),this.updateHoursMinutesArray(),this.updateValues(),this.dateFilter(this.filterBeginFunction,"begin"),this.dateFilter(this.filterEndFunction,"end")}parseFilter(t){if(!t)return new Date;if(isNaN(new Date(t).getTime())){if(t.search("now")>=0){const i=t.match(/years|months|weeks|days|hours|seconds/);if(t.match(/\+/)){const n=parseInt(t.substring(t.search("+")+1,i.index),10);return at()().add(n,i[0]).toDate()}if(t.match(/\-/)){const n=parseInt(t.substring(t.search("-")+1,i.index),10);return at()().subtract(n,i[0]).toDate()}return new Date}if(t.search("today")>=0){const i=at()().endOf("day").toDate(),n=t.match(/years|months|weeks|days|hours|seconds/);if(t.match(/\+/)){const p=parseInt(t.substring(t.search("+")+1,n.index),10);return at()(i).add(p,n[0]).toDate()}if(t.match(/\-/)){const p=parseInt(t.substring(t.search("-")+1,n.index),10);return at()(i).subtract(p,n[0]).toDate()}return i}return new Date}return this.currentFilter.calendarModeYear?this.getDateFromStringWithoutTime(t):t?new Date(t):new Date}changeTemporalProperty(t,i,n=!0){if(!this.isValidDate(t))return;let p=this.getDateTime(t,i);if(this.isCalendarYearMode()){let v;return 1===i?(this.beginValue=t,this.onlyYearBegin=this.beginValue.getFullYear(),v=`${this.onlyYearBegin}-01-01`):(this.endValue=t,this.onlyYearEnd=this.endValue.getFullYear(),v=`${this.onlyYearEnd}-01-01`),void this.changeProperty.next({value:v,pos:i,refreshFilter:n})}2===i&&"date"===this.calendarType()&&!this.sliderMode&&(p=at()(p).endOf("day").toDate()),1===i?(this.beginValue=p,this.restrictedToStep()&&this.changeTemporalProperty(this.ogcFilterTimeService.addStep(p,this.stepMilliseconds),2,n)):this.endValue=p,this.updateHoursMinutesArray(),this.changeProperty.next({value:p.toISOString(),pos:i,refreshFilter:n})}handleDate(t){if(t&&""!==t)return"string"==typeof t&&this.currentFilter.calendarModeYear?this.getDateFromStringWithoutTime(t):new Date(t)}calendarType(){return this.currentFilter.calendarModeYear?"year":this.stepMilliseconds<864e5?"datetime":"date"}isCalendarYearMode(){return"year"===this.calendarType()}yearOnlyInputChange(t,i,n){const v=this.getDateFromStringWithoutTime(t.target.value);this.yearSelected(v,i,n)}yearSelected(t,i,n,p=!0){this.ogcFilterTimeService.stepIsYearDuration(this.step)&&(i&&i.close(),"end"===n?t=at()(t).endOf("year").toDate():"begin"===n&&this.restrictedToStep()&&!this.calendarTypeYear&&this.yearSelected(t,void 0,"end"),this.changeTemporalProperty(t,"begin"===n?1:2,p))}monthSelected(t,i,n,p=!0){this.ogcFilterTimeService.stepIsMonthDuration(this.step)&&(i&&i.close(),"end"===n?t=at()(t).endOf("month").toDate():"begin"===n&&this.restrictedToStep()&&this.monthSelected(t,void 0,"end"),this.changeTemporalProperty(t,"begin"===n?1:2,p))}calendarView(){const t=this.stepMilliseconds,i=Math.abs(this.parseFilter(this.currentFilter.end).getTime()-this.parseFilter(this.currentFilter.begin).getTime());return this.ogcFilterTimeService.stepIsYearDuration(this.step)?"multi-year":this.ogcFilterTimeService.stepIsMonthDuration(this.step)?"year":t<864e5&&i<864e5?"clock":"month"}dateFilter(t,i){const n=new Date(i),p=n.getTime()-new Date(this.handleMin()).getTime();if(this.ogcFilterTimeService.stepIsYearDuration(this.step)){const v=at()(n).diff(at()(this.handleMin()),"years",!0);if("end"===t){const Y=at()(n).add(1,"d"),ue=at()(Y).diff(at()(this.handleMin()),"years",!0);return void(this.filterEndFunction=ue%at().duration(this.step).asYears()==0)}if("begin"===t)return void(this.filterBeginFunction=v%at().duration(this.step).asYears()==0)}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.step)){const v=at()(n).diff(at()(this.handleMin()),"months",!0);if("end"===t){const Y=at()(n).add(1,"d"),ue=at()(Y).diff(at()(this.handleMin()),"months",!0);return void(this.filterEndFunction=ue%at().duration(this.step).asMonths()==0)}if("begin"===t)return void(this.filterBeginFunction=v%at().duration(this.step).asMonths()==0)}else if(this.ogcFilterTimeService.stepIsWeekDuration(this.step)){const v=at()(n).diff(at()(this.handleMin()),"weeks",!0);if("end"===t){const Y=at()(n).add(1,"d"),ue=at()(Y).diff(at()(this.handleMin()),"weeks",!0);return void(this.filterEndFunction=ue%at().duration(this.step).asWeeks()==0)}if("begin"===t)return void(this.filterBeginFunction=v%at().duration(this.step).asWeeks()==0)}else if(this.ogcFilterTimeService.stepIsDayDuration(this.step)){const v=at()(n).diff(at()(this.handleMin()),"days",!0);if("end"===t){const Y=at()(n).add(1,"d"),ye=at()(Y).diff(at()(this.handleMin()),"days",!0)%at().duration(this.step).asDays();return void(this.filterEndFunction=ye<1e-7&&ye>-1e-7||0===ye)}if("begin"===t){const Y=v%at().duration(this.step).asDays()+1;return void(this.filterBeginFunction=Y<1e-7&&Y>-1e-7&&0!==Y||1===Y)}}else if(this.ogcFilterTimeService.stepIsHourDuration(this.step)){if("end"===t){const v=at()(n).diff(at()(this.handleMin()),"hours",!0);return void(this.filterEndFunction=v%at().duration(this.step).asHours()==0)}if("begin"===t){const v=at()(n).diff(at()(this.handleMin()),"hours",!0);return void(this.filterBeginFunction=v%at().duration(this.step).asHours()==0)}}else if(this.ogcFilterTimeService.stepIsMinuteDuration(this.step)){if("end"===t)return void(this.filterEndFunction=!0);if("begin"===t)return void(this.filterBeginFunction=!0)}this.filterEndFunction=p%this.stepMilliseconds==0,this.filterBeginFunction=p%this.stepMilliseconds==0}getDateTime(t,i){const n=new Date(t);let p;if(!this.sliderMode)switch(i){case 1:if(this.currentFilter.calendarModeYear){p=n.setHours(0,0);break}p=n.setHours(this.beginHourFormControl.value,this.beginMinuteFormControl.value);break;case 2:if(this.currentFilter.calendarModeYear){p=n.setHours(0,0);break}p=n.setHours(this.endHourFormControl.value,this.endMinuteFormControl.value)}return new Date(p||n)}handleMinuteIncrement(){return this.ogcFilterTimeService.stepIsMinuteDuration(this.step)?this.stepMilliseconds<36e5?this.stepMilliseconds/1e3==60?1:this.stepMilliseconds/1e3:this.stepMilliseconds%36e5/60:this.ogcFilterTimeService.stepIsHourDuration(this.step)?60:1}handleHourIncrement(){return this.ogcFilterTimeService.stepIsHourDuration(this.step)?this.stepMilliseconds/1e3/60/60:1}fullBeginHoursArray(t){this.beginHours=Array.from(t?{length:(this.endHourFormControl.value-0)/this.handleHourIncrement()+1}:{length:23/this.handleHourIncrement()+1},(i,n)=>0+n*this.handleHourIncrement()),this.beginHourFormControl.setValue(this.beginValue.getHours())}fullEndHoursArray(t){this.endHours=t?Array.from({length:(23-this.beginHourFormControl.value)/this.handleHourIncrement()+1},(i,n)=>this.beginHourFormControl.value+n*this.handleHourIncrement()):Array.from({length:23/this.handleHourIncrement()+1},(i,n)=>0+n*this.handleHourIncrement()),this.endHourFormControl.setValue(this.endValue.getHours())}fullBeginMinutesArray(t){this.beginMinutes=Array.from(t?{length:(this.endMinuteFormControl.value-0)/this.handleMinuteIncrement()+1}:{length:59/this.handleMinuteIncrement()+1},(i,n)=>0+n*this.handleMinuteIncrement()),this.beginMinuteFormControl.setValue(this.beginValue.getMinutes())}fullEndMinutesArray(t){this.endMinutes=t?Array.from({length:(59-this.beginMinuteFormControl.value)/this.handleMinuteIncrement()+1},(i,n)=>this.beginMinuteFormControl.value+n*this.handleMinuteIncrement()):Array.from({length:59/this.handleMinuteIncrement()+1},(i,n)=>0+n*this.handleMinuteIncrement()),this.endMinuteFormControl.setValue(this.endValue.getMinutes())}updateHoursMinutesArray(){const t=new Date(this.beginValue),i=new Date(this.endValue);t.setHours(0,0)===i.setHours(0,0)?(this.fullBeginHoursArray(!0),this.fullEndHoursArray(!0),this.beginValue.getHours()===this.endValue.getHours()&&(this.fullBeginMinutesArray(!0),this.fullEndMinutesArray(!0))):(this.fullBeginHoursArray(),this.fullEndHoursArray(),this.fullBeginMinutesArray(),this.fullEndMinutesArray())}updateValues(){this.changeTemporalProperty(this.beginValue,1,!1),this.changeTemporalProperty(this.endValue,2,!0)}restrictedToStep(){return!!this.currentFilter.restrictToStep&&this.currentFilter.restrictToStep}handleMin(){return this.currentFilter.begin?this.currentFilter.begin:this.datasource.options.minDate?this.datasource.options.minDate:this._defaultMin}handleMax(){return this.currentFilter.end?this.currentFilter.end:this.datasource.options.maxDate?this.datasource.options.maxDate:this._defaultMax}changePropertyByPass(t){this.changeProperty.next(t)}modeChange(t){t.checked||this.updateValues()}setFilterStateDisable(){this.filterStateDisable=!!this.currentFilter&&!this.currentFilter.active,"datetime"===this.calendarType()&&(!0===this.filterStateDisable?(this.beginHourFormControl.disable(),this.beginMinuteFormControl.disable(),this.endHourFormControl.disable(),this.endMinuteFormControl.disable()):(this.beginHourFormControl.enable(),this.beginMinuteFormControl.enable(),this.endHourFormControl.enable(),this.endMinuteFormControl.enable()))}getDateFromStringWithoutTime(t){let i,n="01",p="01";if(10===t.length){const v=t.split("-");if(3!==v.length)throw new Error("Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY");i=v[0],n=v[1],p=v[2]}else{if(4!==t.length)return new Date(t);i=t}return new Date(`${i}-${n}-${p} 00:00:00`)}resetFilter(){let i,n,p,v,t=this.datasource.options.ogcFilters.filters;this.calendarTypeYear?(v="today"===t.end?`${(new Date).toLocaleDateString("en-CA").substring(0,4)}-01-01`:`${t.end.substring(0,4)}-01-01`,p=`${t.begin.substring(0,4)}-01-01`,i=this.getDateFromStringWithoutTime(p),n=this.getDateFromStringWithoutTime(v)):(i=this.parseFilter(t.begin),n=this.parseFilter(t.end),p=i.toISOString(),v=n.toISOString()),(this.currentFilter.begin!==p||this.currentFilter.end!==v)&&(this.beginValue=i,this.endValue=n,this.updateValues())}toggleFilterState(){this.currentFilter.active=!0!==this.currentFilter.active,this.setFilterStateDisable(),this.updateValues()}isValidDate(t){return t instanceof Date&&!isNaN(t.getTime())}static \u0275fac=function(i){return new(i||l)(e.GI1(go))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter-time"]],viewQuery:function(i,n){if(1&i&&(e.CC$(Xo,5),e.CC$(jn,5),e.CC$(Ei,5),e.CC$(bo,5)),2&i){let p;e.wto(p=e.Gqi())&&(n.endDatepickerTime=p.first),e.wto(p=e.Gqi())&&(n.beginDatepickerTime=p.first),e.wto(p=e.Gqi())&&(n.beginTime=p.first),e.wto(p=e.Gqi())&&(n.endTime=p.first)}},inputs:{datasource:"datasource",currentFilter:"currentFilter"},outputs:{changeProperty:"changeProperty"},standalone:!0,features:[e.M5G([go,(0,Ti.CA)()]),e.UHJ],decls:4,vars:3,consts:[[1,"datetime-container"],[3,"ngModel","ngModelChange","change",4,"ngIf"],["class","slider-container",4,"ngIf"],[4,"ngIf"],[3,"ngModel","ngModelChange","change"],[1,"slider-container"],[3,"begin","max","currentFilter","datasource","changeProperty"],["class","year-input-container",4,"ngIf"],["class","datetime-input-container",4,"ngIf"],[1,"year-input-container"],["subscriptSizing","dynamic",1,"year-input"],["matInput","",1,"year-input-only-year",3,"value","disabled","change"],["matSuffix","",3,"for","disabled"],["panelClass","datepicker-year",3,"startView","startAt","yearSelected"],["beginDatepicker",""],["matInput","","enabled","false","readonly","true",1,"year-input-hide",3,"matDatepicker","value","min","max"],["beginYear",""],["endDatepicker",""],["endYear",""],[1,"actions-container"],["mat-icon-button","","color","primary",1,"reset-button",3,"matTooltip","disabled","click"],["tooltip-position","below","matTooltipShowDelay","500",1,"toggle-filter-state",3,"matTooltip","checked","change"],[1,"datetime-input-container"],[1,"datetime-input"],["subscriptSizing","dynamic",1,"date-input"],["matInput","",3,"matDatepicker","placeholder","matDatepickerFilter","value","min","max","disabled","dateChange"],["begin",""],[1,"filler"],[3,"startView","startAt","yearSelected","monthSelected"],["class","time-input",4,"ngIf"],["class","datetime-input",4,"ngIf"],[1,"time-input"],["subscriptSizing","dynamic",1,"hour-input"],[3,"formControl","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["subscriptSizing","dynamic",1,"minute-input"],[3,"value"],["end",""]],template:function(i,n){1&i&&(e.I0R(0,"div",0),e.yuY(1,Uo,3,4,"mat-slide-toggle",1)(2,Oo,2,4,"div",2)(3,ui,3,2,"div",3),e.C$Y()),2&i&&(e.yG2(),e.E7m("ngIf",null==n.currentFilter.sliderOptions?null:n.currentFilter.sliderOptions.enabled),e.yG2(),e.E7m("ngIf",n.sliderMode),e.yG2(),e.E7m("ngIf",!n.sliderMode))},dependencies:[Ke.u_,co.GE,co.cP,xe.y,xe.ue,xe._G,So,yt.wb,yt.Up,yt.w5,yt.Gm,Bt.cN,Bt.yi,Bo.iU,Bo.SU,Bo.Ul,Bo.yu,Ze.oJ,Ze.um,ht.KO,ht.a4,dt.oB,dt.qL,Gt.d5,Gt.kX,kt.I5,xe.sl,xe.ug,Ke.Iw,kt.Ax,k._s,pe.sD],styles:["[_nghost-%COMP%]     input{text-align:center!important;margin:auto 5px!important}[_nghost-%COMP%]   .slider-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .datetime-input-container[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}[_nghost-%COMP%]   .datetime-input-container[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(:last-child){margin-right:8px}[_nghost-%COMP%]   .datetime-input[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .date-input[_ngcontent-%COMP%]{width:154px}[_nghost-%COMP%]   .actions-container[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{margin-top:16px}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(:last-child){margin-right:8px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{margin-top:4px}}[_nghost-%COMP%]   .hour-input[_ngcontent-%COMP%], [_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{width:100px}[_nghost-%COMP%]   .year-input-container[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .year-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]:not(:last-child){margin-right:4px}[_nghost-%COMP%]   .year-input-hide[_ngcontent-%COMP%]{width:120px;margin-right:25px;display:none}[_nghost-%COMP%]   .year-input-only-year[_ngcontent-%COMP%]{width:120px;margin-right:25px;text-align:left!important}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-arrow{display:none}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-period-button{pointer-events:none}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover{background-color:#0000001f;border-radius:999px}"]})}return l})();function ji(l,m){if(1&l&&(e.I0R(0,"mat-option",23),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.alias)("id",t.name)("matTooltip",t.alias),e.yG2(),e.oRS(" ",t.alias," ")}}function cn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",24),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.clearSelectedField())}),e.I0R(1,"mat-icon"),e.OEk(2,"close"),e.C$Y()()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active)}}function un(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",17),e.qCj("mouseenter",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable="selectField")})("mouseleave",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable=void 0)}),e.I0R(1,"input",18),e.qCj("input",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.updateFieldsList(n.target.value))}),e.wVc(2,"translate"),e.wVc(3,"async"),e.wVc(4,"async"),e.wVc(5,"async"),e.wVc(6,"async"),e.wVc(7,"translate"),e.C$Y(),e.I0R(8,"mat-autocomplete",19,20),e.qCj("optionSelected",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeField(n.option.id))}),e.yuY(10,ji,2,4,"mat-option",21),e.wVc(11,"async"),e.C$Y(),e.yuY(12,cn,3,1,"button",22),e.C$Y()}if(2&l){const t=e.Gew(9),i=e.GaO();e.E7m("floatLabel",i.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,8,"igo.geo.sourceFields.selectField"))("disabled",!i.currentFilter.active)("matAutocomplete",t)("value",e.kDX(3,10,i.selectedField$)?e.kDX(4,12,i.selectedField$).alias:"")("matTooltip",e.kDX(5,14,i.selectedField$)?e.kDX(6,16,i.selectedField$).alias:e.kDX(7,18,"igo.geo.sourceFields.selectField")),e.yG2(9),e.E7m("ngForOf",e.kDX(11,20,i.filteredFields$)),e.yG2(2),e.E7m("ngIf",i.currentFilter.propertyName&&"selectField"===i.inputClearable&&i.currentFilter.active)}}function dn(l,m){if(1&l&&(e.I0R(0,"mat-option",4),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.key)("matTooltip",e.kDX(1,3,"igo.geo.operators.tooltip."+t.key)),e.yG2(2),e.oRS(" ",e.kDX(3,5,"igo.geo.operators."+t.key)," ")}}function pn(l,m){if(1&l&&(e.I0R(0,"mat-option",28),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.type),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.spatialSelector."+t.type)," ")}}function mn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",25)(1,"mat-select",26),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeSpatialSelector(n.value))}),e.yuY(2,pn,3,4,"mat-option",27),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("disabled",!t.currentFilter.active)("value",t.currentFilter.igoSpatialSelector),e.yG2(),e.E7m("ngForOf",t.igoSpatialSelectors)}}function Zt(l,m){if(1&l&&(e.I0R(0,"mat-option",32),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t)("matTooltip",t),e.yG2(),e.oRS(" ",t," ")}}function gn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",24),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.clearProperty())}),e.I0R(1,"mat-icon"),e.OEk(2,"close"),e.C$Y()()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active)}}function hn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",29),e.qCj("mouseenter",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable="selectProperty")})("mouseleave",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable=void 0)}),e.I0R(1,"input",18),e.qCj("input",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.updateValuesList(n.target.value))}),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"mat-autocomplete",19,30),e.qCj("optionSelected",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeProperty(n.option.value))}),e.yuY(5,Zt,2,3,"mat-option",31),e.wVc(6,"async"),e.C$Y(),e.yuY(7,gn,3,1,"button",22),e.C$Y()}if(2&l){const t=e.Gew(4),i=e.GaO();e.E7m("floatLabel",i.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,8,"igo.geo.filter.placeholder"))("disabled",!i.currentFilter.active)("matAutocomplete",t)("value","expression"===i.detectProperty()?i.currentFilter.expression:i.currentFilter.pattern)("matTooltip","expression"===i.detectProperty()?i.currentFilter.expression||"":i.currentFilter.pattern||""),e.yG2(4),e.E7m("ngForOf",e.kDX(6,10,i.filteredValues$)),e.yG2(2),e.E7m("ngIf",i.isClearable()&&"selectProperty"===i.inputClearable&&i.currentFilter.active)}}function Wn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",24),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.currentFilter.igoSNRC="")}),e.I0R(1,"mat-icon"),e.OEk(2,"close"),e.C$Y()()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active&&"selectSNRC"===t.inputClearable&&t.currentFilter.active)}}function Ki(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",33),e.qCj("mouseenter",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable="selectSNRC")})("mouseleave",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable=void 0)}),e.I0R(1,"input",34),e.qCj("input",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeSNRC(n.target.value))}),e.wVc(2,"translate"),e.C$Y(),e.yuY(3,Wn,3,1,"button",22),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("floatLabel",t.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,5,"igo.geo.filter.placeholderSnrc"))("value",t.currentFilter.igoSNRC)("matTooltip",t.currentFilter.igoSNRC?t.currentFilter.igoSNRC:""),e.yG2(2),e.E7m("ngIf",t.currentFilter.igoSNRC)}}function Mi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",36),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.changeMapExtentGeometry())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"zoom_out_map"),e.C$Y()()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active)("disabled",!t.currentFilter.active)("matTooltip",e.kDX(1,3,"igo.geo.spatialSelector.btnSetExtent"))}}function fn(l,m){if(1&l&&(e.SAx(0),e.yuY(1,Mi,4,5,"button",35),e.k70()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf","fixedExtent"===t.currentFilter.igoSpatialSelector)}}function Go(l,m){if(1&l&&(e.I0R(0,"mat-option",32),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t)("matTooltip",t),e.yG2(),e.oRS(" ",t," ")}}function yn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",24),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.clearProperty(1))}),e.I0R(1,"mat-icon"),e.OEk(2,"close"),e.C$Y()()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active)}}function Wi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",37),e.qCj("mouseenter",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable="selectProperty1")})("mouseleave",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable=void 0)}),e.I0R(1,"input",38),e.qCj("input",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.updateValuesList(n.target.value,1))}),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"mat-autocomplete",19,39),e.qCj("optionSelected",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeNumericProperty(n.option.value,1))}),e.yuY(5,Go,2,3,"mat-option",31),e.wVc(6,"async"),e.C$Y(),e.yuY(7,yn,3,1,"button",22),e.C$Y()}if(2&l){const t=e.Gew(4),i=e.GaO();e.E7m("floatLabel",i.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,7,"igo.geo.filter.placeholder"))("disabled",!i.currentFilter.active)("matAutocomplete",t)("value","lowerBoundary"===i.detectProperty(1)?i.currentFilter.lowerBoundary:i.currentFilter.begin),e.yG2(4),e.E7m("ngForOf",e.kDX(6,9,i.filteredValues$)),e.yG2(2),e.E7m("ngIf",i.isClearable(1)&&"selectProperty1"===i.inputClearable&&i.currentFilter.active)}}function Di(l,m){if(1&l&&(e.I0R(0,"mat-option",32),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t)("matTooltip",t),e.yG2(),e.oRS(" ",t," ")}}function _n(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",24),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.clearProperty(2))}),e.I0R(1,"mat-icon"),e.OEk(2,"close"),e.C$Y()()}if(2&l){const t=e.GaO(2);e.E7m("disabled",!t.currentFilter.active)}}function Cn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",37),e.qCj("mouseenter",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable="selectProperty2")})("mouseleave",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.inputClearable=void 0)}),e.I0R(1,"input",38),e.qCj("input",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.updateValuesList(n.target.value,2))}),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"mat-autocomplete",19,40),e.qCj("optionSelected",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeNumericProperty(n.option.value,2))}),e.yuY(5,Di,2,3,"mat-option",31),e.wVc(6,"async"),e.C$Y(),e.yuY(7,_n,3,1,"button",22),e.C$Y()}if(2&l){const t=e.Gew(4),i=e.GaO();e.E7m("floatLabel",i.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,7,"igo.geo.filter.placeholder"))("disabled",!i.currentFilter.active)("matAutocomplete",t)("value","upperBoundary"===i.detectProperty(2)?i.currentFilter.upperBoundary:i.currentFilter.end),e.yG2(4),e.E7m("ngForOf",e.kDX(6,9,i.filteredValues$)),e.yG2(2),e.E7m("ngIf",i.isClearable(2)&&"selectProperty2"===i.inputClearable&&i.currentFilter.active)}}function vn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"igo-ogc-filter-time",41),e.qCj("changeProperty",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeProperty(n.value,n.pos))}),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("datasource",t.datasource)("currentFilter",t.currentFilter)}}const or=(l,m)=>({logical:l,logicalHidden:m}),Ni=(l,m)=>({operator:l,dualInput:m}),Hi=()=>["expression","pattern"],zi=()=>["lowerBoundary","begin"],Sn=()=>["upperBoundary","end"];let di=(()=>{class l{wktService;ogcFilterOperator=xt.e;filteredValues$;filteredFields$;allOgcFilterOperators;ogcFilterOperators$=new B.g(void 0);igoSpatialSelectors;value="";inputOperator;selectedField$=new B.g(void 0);fields$=new B.g([]);color="primary";disabled;currentFilterIsSpatial$=new B.g(!1);defaultStepMillisecond=6e3;inputClearable;refreshFilters;datasource;map;currentFilter;set snrc(t){(/^\d{2}$/gi.test(t)||/^\d{2}[a-p]$/gi.test(t)||/^\d{2}[a-l][0,1][0-9]$/gi.test(t))&&(this._snrc=t,this.currentFilter.igoSNRC=t)}get snrc(){return this._snrc}_snrc="";floatLabel;get activeFilters(){return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(t=>!0===t.active)}get allowedOperators(){return(new zt.S).computeAllowedOperators(this.fields$.value,this.currentFilter.propertyName,this.datasource.options.ogcFilters.allowedOperatorsType)}constructor(t){this.wktService=t,this.allOgcFilterOperators=(new zt.S).operators,this.ogcFilterOperators$.next(this.allOgcFilterOperators),this.igoSpatialSelectors=[{type:"fixedExtent"},{type:"snrc"}]}ngOnInit(){if(this.datasource.options.sourceFields){const t=this.datasource.options.sourceFields.filter(i=>void 0===i.excludeFromOgcFilters||!i.excludeFromOgcFilters);t.map(i=>{i.values&&i.values.sort()}),this.fields$.next(t)}this.updateFieldsList(),this.selectedField$.next(this.fields$.value.find(t=>t.name===this.currentFilter.propertyName)),this.updateValuesList(),this.selectedField$.subscribe(t=>{this.ogcFilterOperators$.next(this.allowedOperators),-1===Object.keys(this.allowedOperators).indexOf(this.currentFilter.operator)&&(this.currentFilter.operator=Object.keys(this.allowedOperators)[0],this.currentFilter.operator=Object.keys(this.allowedOperators)[0]),this.updateValuesList()}),this.currentFilterIsSpatial()}updateFieldsList(t){this.filteredFields$=t&&t.length>0?(0,z.of)(this._filterFields(t)):this.fields$,this.fields$.value.find(i=>i.name===t)&&this.changeField(t)}updateValuesList(t,i){this.filteredValues$=(0,z.of)(t&&t.length>0?this._filterValues(t):this.selectedField$.value?this.selectedField$.value.values:[]),t&&t.length>=1&&this.changeProperty(t,i)}_filterFields(t){const i=new RegExp(t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),"gi");return this.fields$.value.filter(n=>i.test(n.alias.normalize("NFD").replace(/[\u0300-\u036f]/g,"")))}_filterValues(t){const i=new RegExp(t.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,""),"gi");return this.selectedField$.value?.values?.filter(n=>n&&i.test(n.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"")))}clearSelectedField(){this.currentFilter.propertyName="",this.selectedField$.next(void 0),this.clearProperty()}isClearable(t){const i=this.detectProperty(t);if(i)return this.currentFilter[i]}clearProperty(t){const i=this.detectProperty(t);if(i)return this.currentFilter[i]=""}toggleFilterState(t){this.datasource.options.ogcFilters.interfaceOgcFilters.find(i=>i.filterid===this.currentFilter.filterid).active=t.checked,this.refreshFilters()}deleteFilter(){const t=this.datasource.options.ogcFilters;t.interfaceOgcFilters=t.interfaceOgcFilters.filter(i=>i.filterid!==this.currentFilter.filterid),this.refreshFilters()}changeLogical(t){this.currentFilter.parentLogical=t,this.refreshFilters()}changeOperator(t){this.currentFilter.operator=t,this.currentFilterIsSpatial(),this.currentFilterIsSpatial$.value&&0===this.currentFilter.wkt_geometry.length?this.changeSpatialSelector(this.currentFilter.igoSpatialSelector):this.refreshFilters()}changeField(t){this.currentFilter.propertyName=t,this.selectedField$.next(this.fields$.value.find(i=>i.name===this.currentFilter.propertyName)),this.refreshFilters()}changeCaseSensitive(t){this.currentFilter.matchCase=t.checked,this.refreshFilters()}changeProperty(t,i,n=!0){const p=this.detectProperty(i);p&&(this.datasource.options.ogcFilters.interfaceOgcFilters.find(v=>v.filterid===this.currentFilter.filterid)[p]=t,n&&this.refreshFilters())}changeNumericProperty(t,i){this.changeProperty(parseFloat(t),i)}changeSpatialSelector(t){this.currentFilter.igoSpatialSelector=t,"fixedExtent"===t&&this.changeMapExtentGeometry(!1),this.currentFilterIsSpatial(),this.refreshFilters()}changeSNRC(t){this.snrc=t,this.changeSNRCGeometry()}changeSNRCGeometry(){this.datasource.options.ogcFilters.interfaceOgcFilters.find(i=>i.filterid===this.currentFilter.filterid)&&(this.snrc&&"snrc"===this.currentFilter.igoSpatialSelector&&(this.currentFilter.wkt_geometry=this.wktService.snrcToWkt(this.snrc,this.map.projection).wktPoly),this.refreshFilters())}changeMapExtentGeometry(t=!0){this.datasource.options.ogcFilters.interfaceOgcFilters.find(n=>n.filterid===this.currentFilter.filterid)&&("fixedExtent"===this.currentFilter.igoSpatialSelector&&(this.currentFilter.wkt_geometry=this.wktService.extentToWkt(this.map.projection,this.map.viewController.getExtent(),this.map.projection).wktPoly),t&&this.refreshFilters())}detectProperty(t){switch(this.currentFilter.operator){case xt.e.PropertyIsNotEqualTo:case xt.e.PropertyIsEqualTo:case xt.e.PropertyIsGreaterThan:case xt.e.PropertyIsGreaterThanOrEqualTo:case xt.e.PropertyIsLessThan:case xt.e.PropertyIsLessThanOrEqualTo:return"expression";case xt.e.PropertyIsLike:return"pattern";case xt.e.PropertyIsBetween:return t&&1===t?"lowerBoundary":t&&2===t?"upperBoundary":void 0;case xt.e.During:return t&&1===t?"begin":t&&2===t?"end":void 0;default:return}}currentFilterIsSpatial(){let t=!1;this.currentFilter&&(t=-1!==[xt.e.Contains,xt.e.Intersects,xt.e.Within].indexOf(this.currentFilter.operator)),this.currentFilterIsSpatial$.next(t)}isTemporalOperator(){return this.currentFilter.operator.toLowerCase()===this.ogcFilterOperator.During.toLowerCase()}static \u0275fac=function(i){return new(i||l)(e.GI1(ai))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter-form"]],inputs:{refreshFilters:"refreshFilters",datasource:"datasource",map:"map",currentFilter:"currentFilter",floatLabel:"floatLabel"},standalone:!0,features:[e.UHJ],decls:44,vars:76,consts:[[1,"ogc-filter-form-container"],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","checked","click","change"],[3,"ngClass"],["tooltip-position","above","matTooltipShowDelay","500",3,"disabled","value","matTooltip","selectionChange"],["tooltip-position","above","matTooltipShowDelay","500",3,"value","matTooltip"],["class","field",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[3,"ngClass","floatLabel"],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","value","selectionChange"],["tooltip-position","above","matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["class","spatialSelector",4,"ngIf"],["class","singleInput",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[1,"igo-layer-button-group"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["class","snrc",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[4,"ngIf"],["class","dualInput",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[3,"datasource","currentFilter","changeProperty",4,"ngIf"],[1,"field",3,"floatLabel","mouseenter","mouseleave"],["matInput","","tooltip-position","above","matTooltipShowDelay","500",3,"placeholder","disabled","matAutocomplete","value","matTooltip","input"],[3,"optionSelected"],["autoCompleteField","matAutocomplete"],["matTooltipShowDelay","500",3,"value","id","matTooltip",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"disabled","click",4,"ngIf"],["matTooltipShowDelay","500",3,"value","id","matTooltip"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"disabled","click"],[1,"spatialSelector"],[3,"disabled","value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"singleInput",3,"floatLabel","mouseenter","mouseleave"],["autoCompleteValues","matAutocomplete"],["matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["matTooltipShowDelay","500",3,"value","matTooltip"],[1,"snrc",3,"floatLabel","mouseenter","mouseleave"],["matInput","","tooltip-position","above","matTooltipShowDelay","500",3,"placeholder","value","matTooltip","input"],["matSuffix","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click",4,"ngIf"],["matSuffix","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click"],[1,"dualInput",3,"floatLabel","mouseenter","mouseleave"],["matInput","","type","number",3,"placeholder","disabled","matAutocomplete","value","input"],["autoDualValueOperator1","matAutocomplete"],["autoDualValueOperator2","matAutocomplete"],[3,"datasource","currentFilter","changeProperty"]],template:function(i,n){1&i&&(e.I0R(0,"div",0)(1,"mat-checkbox",1),e.qCj("click",function(v){return v.stopPropagation()})("change",function(v){return n.toggleFilterState(v)}),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"mat-form-field",2)(4,"mat-select",3),e.qCj("selectionChange",function(v){return n.changeLogical(v.value)}),e.wVc(5,"translate"),e.I0R(6,"mat-option",4),e.wVc(7,"translate"),e.OEk(8),e.wVc(9,"translate"),e.C$Y(),e.I0R(10,"mat-option",4),e.wVc(11,"translate"),e.OEk(12),e.wVc(13,"translate"),e.C$Y()()(),e.yuY(14,un,13,22,"mat-form-field",5),e.wVc(15,"async"),e.wVc(16,"async"),e.wVc(17,"async"),e.wVc(18,"async"),e.I0R(19,"mat-form-field",6),e.wVc(20,"async"),e.wVc(21,"async"),e.I0R(22,"mat-select",7),e.qCj("selectionChange",function(v){return n.changeOperator(v.value)}),e.wVc(23,"translate"),e.wVc(24,"translate"),e.yuY(25,dn,4,7,"mat-option",8),e.wVc(26,"keyvalue"),e.wVc(27,"async"),e.C$Y()(),e.yuY(28,mn,3,3,"mat-form-field",9),e.wVc(29,"async"),e.yuY(30,hn,8,12,"mat-form-field",10),e.I0R(31,"div",11)(32,"button",12),e.qCj("click",function(){return n.deleteFilter()}),e.wVc(33,"translate"),e.I0R(34,"mat-icon"),e.OEk(35,"delete"),e.C$Y()()(),e.yuY(36,Ki,4,7,"mat-form-field",13),e.wVc(37,"async"),e.yuY(38,fn,2,1,"ng-container",14),e.wVc(39,"async"),e.C$Y(),e.I0R(40,"div",0),e.yuY(41,Wi,8,11,"mat-form-field",15)(42,Cn,8,11,"mat-form-field",15),e.C$Y(),e.yuY(43,vn,1,2,"igo-ogc-filter-time",16)),2&i&&(e.yG2(),e.E7m("matTooltip",e.kDX(2,27,"igo.geo.filter.toggleFilterState"))("checked",n.currentFilter.active),e.yG2(2),e.E7m("ngClass",e.IBC(67,or,0!==n.activeFilters.indexOf(n.currentFilter)&&!0===n.currentFilter.active,0===n.activeFilters.indexOf(n.currentFilter)||!0!==n.currentFilter.active)),e.yG2(),e.E7m("disabled",!n.currentFilter.active)("value",n.currentFilter.parentLogical)("matTooltip",n.currentFilter.parentLogical?e.kDX(5,29,"igo.geo.operators.tooltip."+n.currentFilter.parentLogical):""),e.yG2(2),e.E7m("value",n.ogcFilterOperator.And)("matTooltip",e.kDX(7,31,"igo.geo.operators.tooltip.And")),e.yG2(2),e.oRS(" ",e.kDX(9,33,"igo.geo.operators.And")," "),e.yG2(2),e.E7m("value",n.ogcFilterOperator.Or)("matTooltip",e.kDX(11,35,"igo.geo.operators.tooltip.Or")),e.yG2(2),e.oRS(" ",e.kDX(13,37,"igo.geo.operators.Or")," "),e.yG2(2),e.E7m("ngIf",!1===e.kDX(15,39,n.currentFilterIsSpatial$)&&e.kDX(16,41,n.fields$)&&e.kDX(17,43,n.fields$).length>0&&""!==e.kDX(18,45,n.fields$)[0].name),e.yG2(5),e.E7m("ngClass",e.IBC(70,Ni,!1===e.kDX(20,47,n.currentFilterIsSpatial$),e.kDX(21,49,n.currentFilterIsSpatial$)))("floatLabel",n.floatLabel),e.yG2(3),e.E7m("matTooltip",n.currentFilter.operator?e.kDX(23,51,"igo.geo.operators.tooltip."+n.currentFilter.operator):e.kDX(24,53,"igo.geo.filter.selectOperator"))("disabled",!n.currentFilter.active)("value",n.currentFilter.operator),e.yG2(3),e.E7m("ngForOf",e.kDX(26,55,e.kDX(27,57,n.ogcFilterOperators$))),e.yG2(3),e.E7m("ngIf",e.kDX(29,59,n.currentFilterIsSpatial$)),e.yG2(2),e.E7m("ngIf",-1!==e.q4q(73,Hi).indexOf(n.detectProperty())),e.yG2(2),e.E7m("matTooltip",e.kDX(33,61,"igo.geo.filter.removeFilter")),e.yG2(4),e.E7m("ngIf",e.kDX(37,63,n.currentFilterIsSpatial$)&&"snrc"===n.currentFilter.igoSpatialSelector),e.yG2(2),e.E7m("ngIf",e.kDX(39,65,n.currentFilterIsSpatial$)&&"fixedExtent"===n.currentFilter.igoSpatialSelector),e.yG2(3),e.E7m("ngIf",!n.isTemporalOperator()&&-1!==e.q4q(74,zi).indexOf(n.detectProperty(1))),e.yG2(),e.E7m("ngIf",!n.isTemporalOperator()&&-1!==e.q4q(75,Sn).indexOf(n.detectProperty(2))),e.yG2(),e.E7m("ngIf",n.isTemporalOperator()))},dependencies:[$t.Vn,$t.WK,ht.KO,ht.a4,yt.wb,yt.Up,yt.Gm,Ke.QF,Gt.d5,Gt.kX,kt.I5,kt.Ax,Ke.u_,Bt.cN,Bt.yi,mo.U1,mo.e,mo.cG,Ke.Iw,Ze.oJ,Ze.um,dt.oB,dt.qL,xo,Ke.a,Ke.uq,k._s,pe.sD],styles:["[_nghost-%COMP%]{width:100%;padding:5px 10px}[_nghost-%COMP%]     .mat-mdc-form-field .mat-icon svg{width:1em;height:1em;color:#d3d3d3}[_nghost-%COMP%]   .ogc-filter-form-container[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-mdc-select-arrow[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   .logical[_ngcontent-%COMP%]{flex-flow:column nowrap;width:100%;max-width:60px;margin-right:5px}[_nghost-%COMP%]   .logicalHidden[_ngcontent-%COMP%]{width:0px;visibility:hidden;max-width:0px}[_nghost-%COMP%]     .logical .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]     .logicalHidden .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .field[_ngcontent-%COMP%]{width:150px;margin-right:5px}[_nghost-%COMP%]     .field .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .operator[_ngcontent-%COMP%]{width:150px;margin-right:5px;text-align:center}[_nghost-%COMP%]     .operator .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .spatialSelector[_ngcontent-%COMP%]{width:110px;margin-right:5px}[_nghost-%COMP%]     .spatialSelector .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .singleInput[_ngcontent-%COMP%]{width:150px;margin-right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .singleInput[_ngcontent-%COMP%]{width:27%}}[_nghost-%COMP%]   .snrc[_ngcontent-%COMP%]{width:110px;margin-right:5px}[_nghost-%COMP%]     .singleInput .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .dualInput[_ngcontent-%COMP%]{width:150px;margin-right:5px}[_nghost-%COMP%]     .dualInput .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]{display:flex;padding-top:5px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{display:flex}"]})}return l})();var Pi=r(35392),io=r(24296),Po=r(21232),fo=r(24112);const Fi=["selection"];function bn(l,m){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS("",t.title," ")}}function Xi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",10)(1,"mat-form-field")(2,"mat-select",11),e.iHE("valueChange",function(n){e.usT(t);const p=e.GaO(3);return e.kNx(p.currentPushButtonsGroup,n)||(p.currentPushButtonsGroup=n),e.CGJ(n)}),e.wVc(3,"translate"),e.yuY(4,bn,2,2,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("value",t.currentPushButtonsGroup),e.yG2(2),e.E7m("ngForOf",t.getPushButtonsGroups())}}function Ri(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-button-toggle",16),e.qCj("change",function(){const p=e.usT(t).$implicit,v=e.GaO(3).$implicit,Y=e.GaO();return e.CGJ(Y.onSelectionChange(p,v.selectorType))}),e.OEk(1),e.C$Y()}if(2&l){const t=m.$implicit,i=e.GaO(4);e.E7m("matTooltip",i.getToolTip(t))("ngStyle",i.getButtonColor(t))("checked",t.enabled)("value",t),e.yG2(),e.oRS("",t.title," ")}}function pi(l,m){if(1&l&&(e.SAx(0),e.I0R(1,"h3"),e.OEk(2),e.C$Y(),e.I0R(3,"mat-button-toggle-group",14),e.yuY(4,Ri,2,5,"mat-button-toggle",15),e.C$Y(),e.k70()),2&l){const t=m.$implicit,i=e.GaO(3);e.yG2(2),e.cNF(t.title),e.yG2(),e._6D("vertical",i.bundleIsVertical(t)),e.yG2(),e.E7m("ngForOf",t.selectors)}}function mi(l,m){if(1&l&&(e.I0R(0,"div",8),e.wR5(1,"mat-divider"),e.yuY(2,Xi,5,5,"div",9)(3,pi,5,3,"ng-container",1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(2),e.E7m("ngIf",t.getPushButtonsGroups().length>1),e.yG2(),e.E7m("ngForOf",t.currentPushButtonsGroup.computedSelectors)}}function On(l,m){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS("",t.title," ")}}function In(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",10)(1,"mat-form-field")(2,"mat-select",18),e.iHE("valueChange",function(n){e.usT(t);const p=e.GaO(3);return e.kNx(p.currentCheckboxesGroup,n)||(p.currentCheckboxesGroup=n),e.CGJ(n)}),e.wVc(3,"translate"),e.yuY(4,On,2,2,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("value",t.currentCheckboxesGroup),e.yG2(2),e.E7m("ngForOf",t.getCheckboxesGroups())}}function gi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-checkbox",21),e.qCj("change",function(){const p=e.usT(t).$implicit,v=e.GaO(3).$implicit,Y=e.GaO();return e.CGJ(Y.onSelectionChange(p,v.selectorType))}),e.OEk(1),e.C$Y()}if(2&l){const t=m.$implicit,i=e.GaO(4);e.E7m("matTooltip",i.getToolTip(t))("checked",t.enabled)("value",t),e.yG2(),e.oRS("",t.title," ")}}function wn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"u",24),e.qCj("click",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.displayLessResults("checkbox"))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}2&l&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.geo.filter.displayLessResults")," "))}function Tn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"u",25),e.qCj("click",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.displayMoreResults("checkbox"))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}2&l&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.geo.filter.displayMoreResults")," "))}function En(l,m){if(1&l&&(e.I0R(0,"p"),e.yuY(1,wn,3,3,"u",22)(2,Tn,3,3,"u",23),e.C$Y()),2&l){const t=e.GaO().$implicit,i=e.GaO(3);e.yG2(),e.E7m("ngIf",i.isLessResults(t,"checkbox")),e.yG2(),e.E7m("ngIf",i.isMoreResults(t,"checkbox"))}}function ne(l,m){if(1&l&&(e.SAx(0),e.I0R(1,"h3"),e.OEk(2),e.C$Y(),e.I0R(3,"div",19),e.yuY(4,gi,2,4,"mat-checkbox",20),e.C$Y(),e.yuY(5,En,3,2,"p",2),e.k70()),2&l){const t=m.$implicit,i=e.GaO(3);e.yG2(2),e.cNF(t.title),e.yG2(2),e.E7m("ngForOf",t.selectors),e.yG2(),e.E7m("ngIf",i.isLessResults(t,"checkbox")||i.isMoreResults(t,"checkbox"))}}function We(l,m){if(1&l&&(e.I0R(0,"div",17),e.wR5(1,"mat-divider"),e.yuY(2,In,5,5,"div",9)(3,ne,6,3,"ng-container",1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(2),e.E7m("ngIf",t.getCheckboxesGroups().length>1),e.yG2(),e.E7m("ngForOf",t.currentCheckboxesGroup.computedSelectors)}}function _(l,m){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS("",t.title," ")}}function N(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",10)(1,"mat-form-field")(2,"mat-select",27),e.iHE("valueChange",function(n){e.usT(t);const p=e.GaO(3);return e.kNx(p.currentRadioButtonsGroup,n)||(p.currentRadioButtonsGroup=n),e.CGJ(n)}),e.wVc(3,"translate"),e.yuY(4,_,2,2,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("value",t.currentRadioButtonsGroup),e.yG2(2),e.E7m("ngForOf",t.getRadioButtonsGroups())}}function Q(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-radio-button",30),e.qCj("change",function(){e.usT(t);const n=e.GaO(4);return e.CGJ(n.emptyRadioButtons())}),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()}2&l&&(e.E7m("matTooltip",e.kDX(1,2,"igo.geo.filter.resetFilters")),e.yG2(2),e.oRS("",e.kDX(3,4,"igo.geo.filter.resetFilters")," "))}function Ce(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-radio-button",21),e.qCj("change",function(){const p=e.usT(t).$implicit,v=e.GaO(3).$implicit,Y=e.GaO();return e.CGJ(Y.onSelectionChange(p,v.selectorType))}),e.OEk(1),e.C$Y()}if(2&l){const t=m.$implicit,i=e.GaO(4);e.E7m("matTooltip",i.getToolTip(t))("checked",t.enabled)("value",t),e.yG2(),e.oRS("",t.title," ")}}function Te(l,m){if(1&l){const t=e.KQA();e.I0R(0,"u",24),e.qCj("click",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.displayLessResults("radio"))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}2&l&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.geo.filter.displayLessResults")," "))}function Ne(l,m){if(1&l){const t=e.KQA();e.I0R(0,"u",25),e.qCj("click",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.displayMoreResults("radio"))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}2&l&&(e.yG2(),e.oRS("",e.kDX(2,1,"igo.geo.filter.displayMoreResults")," "))}function gt(l,m){if(1&l&&(e.I0R(0,"p"),e.yuY(1,Te,3,3,"u",22)(2,Ne,3,3,"u",23),e.C$Y()),2&l){const t=e.GaO().$implicit,i=e.GaO(3);e.yG2(),e.E7m("ngIf",i.isLessResults(t,"radio")),e.yG2(),e.E7m("ngIf",i.isMoreResults(t,"radio"))}}function It(l,m){if(1&l&&(e.SAx(0),e.I0R(1,"h3"),e.OEk(2),e.C$Y(),e.I0R(3,"mat-radio-group",28),e.yuY(4,Q,4,6,"mat-radio-button",29)(5,Ce,2,4,"mat-radio-button",20)(6,gt,3,2,"p",2),e.C$Y(),e.k70()),2&l){const t=m.$implicit,i=e.GaO(3);e.yG2(2),e.cNF(t.title),e.yG2(2),e.E7m("ngIf",t.unfiltered),e.yG2(),e.E7m("ngForOf",t.selectors),e.yG2(),e.E7m("ngIf",i.isLessResults(t,"radio")||i.isMoreResults(t,"radio"))}}function it(l,m){if(1&l&&(e.I0R(0,"div",26),e.wR5(1,"mat-divider"),e.yuY(2,N,5,5,"div",9)(3,It,7,4,"ng-container",1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(2),e.E7m("ngIf",t.getRadioButtonsGroups().length>1),e.yG2(),e.E7m("ngForOf",t.currentRadioButtonsGroup.computedSelectors)}}function At(l,m){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS("",t.title," ")}}function Dt(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",10)(1,"mat-form-field")(2,"mat-select",32),e.iHE("valueChange",function(n){e.usT(t);const p=e.GaO(3);return e.kNx(p.currentSelectGroup,n)||(p.currentSelectGroup=n),e.CGJ(n)}),e.wVc(3,"translate"),e.yuY(4,At,2,2,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("value",t.currentSelectGroup),e.yG2(2),e.E7m("ngForOf",t.getSelectGroups())}}function eo(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-button",36),e.qCj("click",function(){e.usT(t);const n=e.GaO(4);return e.CGJ(n.emptySelect())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"filter_alt_off"),e.C$Y()()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.filter.resetFilters"))}const Qt=()=>({standalone:!0});function wo(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-checkbox",41),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(5);return e.kNx(p.selectAllSelected,n)||(p.selectAllSelected=n),e.CGJ(n)}),e.qCj("change",function(){e.usT(t);const n=e.GaO(5);return e.CGJ(n.toggleAllSelection())}),e.OEk(1,"Tous "),e.C$Y()}if(2&l){const t=e.GaO(5);e.OKB("ngModel",t.selectAllSelected),e.E7m("ngModelOptions",e.q4q(2,Qt))}}function Jo(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-option",42),e.qCj("onSelectionChange",function(n){e.usT(t);const p=e.GaO(2).$implicit,v=e.GaO(3);return e.CGJ(v.selectOptionClick(n.source.value,p,n))}),e.OEk(1),e.C$Y()}if(2&l){const t=m.$implicit,i=e.GaO(5);e.E7m("matTooltip",i.getToolTip(t))("value",t),e.yG2(),e.oRS("",t.title," ")}}function xn(l,m){if(1&l&&(e.I0R(0,"div")(1,"mat-select",37,38)(3,"div",19),e.yuY(4,wo,2,3,"mat-checkbox",39),e.C$Y(),e.yuY(5,Jo,2,3,"mat-option",40),e.C$Y()()),2&l){const t=e.GaO().$implicit;e.yG2(),e.E7m("multiple",t.multiple)("placeholder",t.title),e.yG2(3),e.E7m("ngIf",t.multiple),e.yG2(),e.E7m("ngForOf",t.selectors)}}function hi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-option",42),e.qCj("onSelectionChange",function(n){e.usT(t);const p=e.GaO(2).$implicit,v=e.GaO(3);return e.CGJ(v.selectOptionClick(n.source.value,p))}),e.OEk(1),e.C$Y()}if(2&l){const t=m.$implicit,i=e.GaO(5);e.E7m("matTooltip",i.getToolTip(t))("value",t),e.yG2(),e.oRS("",t.title," ")}}function Mn(l,m){if(1&l&&(e.I0R(0,"mat-select",43),e.yuY(1,hi,2,3,"mat-option",40),e.C$Y()),2&l){const t=e.GaO().$implicit;e.E7m("placeholder",t.title),e.yG2(),e.E7m("ngForOf",t.selectors)}}function Dn(l,m){if(1&l&&(e.SAx(0),e.I0R(1,"h3"),e.OEk(2),e.C$Y(),e.I0R(3,"div",10),e.yuY(4,eo,4,3,"mat-button",33),e.I0R(5,"mat-form-field"),e.yuY(6,xn,6,4,"div",34)(7,Mn,2,2,"ng-template",null,35,e.gJz),e.C$Y()(),e.k70()),2&l){const t=m.$implicit,i=e.Gew(8);e.yG2(2),e.cNF(t.title),e.yG2(2),e.E7m("ngIf",t.unfiltered&&!t.multiple),e.yG2(),e.m4B("width",t.width?t.width:void 0,"%"),e.yG2(),e.E7m("ngIf",t.multiple)("ngIfElse",i)}}function Li(l,m){if(1&l&&(e.I0R(0,"div",31),e.wR5(1,"mat-divider"),e.yuY(2,Dt,5,5,"div",9)(3,Dn,9,6,"ng-container",1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(2),e.E7m("ngIf",t.getSelectGroups().length>1),e.yG2(),e.E7m("ngForOf",t.currentSelectGroup.computedSelectors)}}function Ji(l,m){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS("",t.title," ")}}function Qi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",10)(1,"mat-form-field")(2,"mat-select",45),e.iHE("valueChange",function(n){e.usT(t);const p=e.GaO(3);return e.kNx(p.currentAutocompleteGroup,n)||(p.currentAutocompleteGroup=n),e.CGJ(n)}),e.wVc(3,"translate"),e.yuY(4,Ji,2,2,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO(3);e.yG2(2),e.E7m("matTooltip",e.kDX(3,3,"igo.geo.layer.legend.selectStyle")),e.OKB("value",t.currentAutocompleteGroup),e.yG2(2),e.E7m("ngForOf",t.getAutocompleteGroups())}}function Zi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-button",36),e.qCj("click",function(){e.usT(t);const n=e.GaO(4);return e.CGJ(n.emptyAutocomplete())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"filter_alt_off"),e.C$Y()()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.filter.resetFilters"))}function Nn(l,m){if(1&l&&(e.I0R(0,"mat-option",13),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t.value," ")}}function Pn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field"),e.wR5(1,"input",47,48),e.I0R(3,"mat-autocomplete",49,50),e.qCj("optionSelected",function(n){e.usT(t);const p=e.GaO(4);return e.CGJ(p.autocompleteOptionClick(n.option.value))}),e.yuY(6,Nn,2,2,"mat-option",12),e.wVc(7,"async"),e.C$Y()()}if(2&l){const t=e.Gew(4),i=e.GaO().$implicit,n=e.GaO(3);e.m4B("width",i.width?i.width:void 0,"%"),e.yG2(),e.E7m("matAutocomplete",t)("placeholder",i.title),e.yG2(2),e.E7m("displayWith",n.displayFn),e.yG2(3),e.E7m("ngForOf",e.kDX(7,6,n.filteredOgcAutocomplete[i.id]))}}function fi(l,m){if(1&l&&(e.SAx(0),e.I0R(1,"h3"),e.OEk(2),e.C$Y(),e.I0R(3,"div",10),e.yuY(4,Zi,4,3,"mat-button",33)(5,Pn,8,8,"mat-form-field",46),e.C$Y(),e.k70()),2&l){const t=m.$implicit,i=e.GaO(3);e.yG2(2),e.cNF(t.title),e.yG2(2),e.E7m("ngIf",t.unfiltered),e.yG2(),e.E7m("ngIf",i.filteredOgcAutocomplete[t.id])}}function uo(l,m){if(1&l&&(e.I0R(0,"div",44),e.wR5(1,"mat-divider"),e.yuY(2,Qi,5,5,"div",9)(3,fi,6,3,"ng-container",1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(2),e.E7m("ngIf",t.getAutocompleteGroups().length>1),e.yG2(),e.E7m("ngForOf",t.currentAutocompleteGroup.computedSelectors)}}function no(l,m){if(1&l&&(e.I0R(0,"div"),e.yuY(1,mi,4,2,"div",3)(2,We,4,2,"div",4)(3,it,4,2,"div",5)(4,Li,4,2,"div",6)(5,uo,4,2,"div",7),e.C$Y()),2&l){const t=m.$implicit;e.yG2(),e.E7m("ngIf","pushButton"===t.selectorType),e.yG2(),e.E7m("ngIf","checkbox"===t.selectorType),e.yG2(),e.E7m("ngIf","radioButton"===t.selectorType),e.yG2(),e.E7m("ngIf","select"===t.selectorType),e.yG2(),e.E7m("ngIf","autocomplete"===t.selectorType)}}function ir(l,m){1&l&&(e.I0R(0,"h3"),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.filter.reportingDate")," "))}function nr(l,m){if(1&l&&(e.I0R(0,"h3"),e.OEk(1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(),e.cNF(t.currentFilter.title)}}function Fn(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div"),e.wR5(1,"mat-divider"),e.yuY(2,ir,3,3,"h3",2)(3,nr,2,1,"h3",2),e.I0R(4,"igo-ogc-filter-time",51),e.qCj("changeProperty",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeProperty(n.value,n.pos))}),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(2),e.E7m("ngIf",!t.currentFilter.title),e.yG2(),e.E7m("ngIf",t.currentFilter.title),e.yG2(),e.E7m("datasource",t.datasource)("currentFilter",t.currentFilter)}}let Rn=(()=>{class l{ogcFilterService;formBuilder;domService;configService;cdRef;sel;refreshFilters;datasource;map;checkboxesIndex=5;radioButtonsIndex=5;baseIndex=5;get currentFilter(){return this._currentFilter}set currentFilter(t){this._currentFilter=t,this._currentFilter?.sliderOptions&&(this._currentFilter.sliderOptions.enabled=!1)}_currentFilter;ogcFilterOperator=xt.e;form;ogcFilterWriter;color="primary";selectAllSelected=!1;selectEnabled$=new B.g(void 0);selectEnableds$=new B.g([]);autocompleteEnabled$=new B.g(void 0);filteredOgcAutocomplete={};applyFiltersTimeout;get ogcFiltersSelectors(){const t=[];return this.datasource?.options?.ogcFilters?.pushButtons&&t.push(this.datasource?.options?.ogcFilters?.pushButtons),this.datasource?.options?.ogcFilters?.checkboxes&&t.push(this.datasource?.options?.ogcFilters?.checkboxes),this.datasource?.options?.ogcFilters?.radioButtons&&t.push(this.datasource?.options?.ogcFilters?.radioButtons),this.datasource?.options?.ogcFilters?.select&&t.push(this.datasource?.options?.ogcFilters?.select),this.datasource?.options?.ogcFilters?.autocomplete&&t.push(this.datasource?.options?.ogcFilters?.autocomplete),t.sort((i,n)=>i.order<n.order?-1:i.order>n.order?1:0),t}get currentPushButtonsGroup(){return this.form.get("pushButtonsGroup").value}set currentPushButtonsGroup(t){this.form.patchValue({pushButtonsGroup:t})}get currentCheckboxesGroup(){return this.form.get("checkboxesGroup").value}set currentCheckboxesGroup(t){this.form.patchValue({checkboxesGroup:t})}get currentRadioButtonsGroup(){return this.form.get("radioButtonsGroup").value}set currentRadioButtonsGroup(t){this.form.patchValue({radioButtonsGroup:t})}get currentSelectGroup(){return this.form.get("selectGroup").value}set currentSelectGroup(t){this.form.patchValue({selectGroup:t}),this.cdRef.detectChanges()}get currentAutocompleteGroup(){return this.form.get("autocompleteGroup").value}set currentAutocompleteGroup(t){this.form.patchValue({autocompleteGroup:t}),this.cdRef.detectChanges()}get selectEnabled(){return this.selectEnabled$.value}set selectEnabled(t){this.selectEnabled$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentSelectGroup.computedSelectors.forEach(i=>{i.selectors?.forEach(n=>{n.enabled=t===n})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}get selectEnableds(){return this.selectEnableds$.value}set selectEnableds(t){this.selectEnableds$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentSelectGroup.computedSelectors.forEach(i=>{i.selectors?.forEach(n=>{n.enabled=!!t.includes(n)})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}get autocompleteEnabled(){return this.autocompleteEnabled$.value}set autocompleteEnabled(t){this.autocompleteEnabled$.next(t),clearTimeout(this.applyFiltersTimeout),this.currentAutocompleteGroup.computedSelectors.forEach(i=>{i.selectors?.forEach(n=>{n.enabled=t===n.title})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}constructor(t,i,n,p,v){this.ogcFilterService=t,this.formBuilder=i,this.domService=n,this.configService=p,this.cdRef=v,this.ogcFilterWriter=new zt.S,this.buildForm()}buildForm(){this.form=this.formBuilder.group({pushButtons:["",[xe.AQ.required]],radioButtons:["",[xe.AQ.required]],pushButtonsGroup:["",[xe.AQ.required]],checkboxesGroup:["",[xe.AQ.required]],radioButtonsGroup:["",[xe.AQ.required]],selectGroup:["",[xe.AQ.required]],select:["",[xe.AQ.required]],selectMulti:["",[xe.AQ.required]],autocompleteGroup:["",[xe.AQ.required]],autocomplete:["",[xe.AQ.required]]})}getPushButtonsGroups(){if(this.datasource?.options?.ogcFilters?.pushButtons)return this.datasource.options.ogcFilters.pushButtons.groups}getCheckboxesGroups(){if(this.datasource?.options?.ogcFilters?.checkboxes)return this.datasource.options.ogcFilters.checkboxes.groups}getRadioButtonsGroups(){if(this.datasource?.options?.ogcFilters?.radioButtons)return this.datasource.options.ogcFilters.radioButtons.groups}getSelectGroups(){if(this.datasource?.options?.ogcFilters?.select)return this.datasource.options.ogcFilters.select.groups}getAutocompleteGroups(){if(this.datasource?.options?.ogcFilters?.autocomplete)return this.datasource.options.ogcFilters.autocomplete.groups}ngOnInit(){var t=this;return(0,Pi.c)(function*(){t.datasource.options.ogcFilters&&(t.datasource.options.ogcFilters.pushButtons&&(t.currentPushButtonsGroup=t.datasource.options.ogcFilters.pushButtons.groups.find(i=>i.enabled)||t.datasource.options.ogcFilters.pushButtons.groups[0]),t.datasource.options.ogcFilters.checkboxes&&(t.currentCheckboxesGroup=t.datasource.options.ogcFilters.checkboxes.groups.find(i=>i.enabled)||t.datasource.options.ogcFilters.checkboxes.groups[0]),t.datasource.options.ogcFilters.radioButtons&&(t.currentRadioButtonsGroup=t.datasource.options.ogcFilters.radioButtons.groups.find(i=>i.enabled)||t.datasource.options.ogcFilters.radioButtons.groups[0]),t.datasource.options.ogcFilters.select&&(t.currentSelectGroup=t.datasource.options.ogcFilters.select.groups.find(i=>i.enabled)||t.datasource.options.ogcFilters.select.groups[0],t.getSelectEnabled(),yield t.getSelectDomValues()),t.datasource.options.ogcFilters.autocomplete&&(t.currentAutocompleteGroup=t.datasource.options.ogcFilters.autocomplete.groups.find(i=>i.enabled)||t.datasource.options.ogcFilters.autocomplete.groups[0],t.getAutocompleteEnabled(),yield t.getAutocompleteDomValues()),t.applyFilters()),t.form.get("pushButtonsGroup").valueChanges.pipe((0,fo.o)(750)).subscribe(()=>{t.onPushButtonsChangeGroup(),t.applyFilters()}),t.form.get("checkboxesGroup").valueChanges.pipe((0,fo.o)(750)).subscribe(()=>{t.onCheckboxesChangeGroup(),t.applyFilters()}),t.form.get("radioButtonsGroup").valueChanges.pipe((0,fo.o)(750)).subscribe(()=>{t.onRadioButtonsChangeGroup(),t.applyFilters()}),t.form.get("selectGroup").valueChanges.pipe((0,fo.o)(750)).subscribe(()=>{t.onSelectChangeGroup(),t.applyFilters()}),t.form.get("autocompleteGroup").valueChanges.pipe((0,fo.o)(750)).subscribe(()=>{t.onAutocompleteChangeGroup(),t.applyFilters()}),t.form.get("pushButtons").valueChanges.pipe((0,fo.o)(750)).subscribe(()=>{t.applyFilters()}),t.form.get("radioButtons").valueChanges.pipe((0,fo.o)(750)).subscribe(()=>{t.applyFilters()})})()}getSelectEnabled(){const t=[];let i;this.currentSelectGroup.computedSelectors.forEach(n=>{n.multiple?(n.selectors?.forEach(p=>{p.enabled&&t.push(p)}),this.selectEnableds=t,this.form.controls.selectMulti.setValue(t)):(n.selectors?.forEach(p=>{p.enabled&&(i=p)}),this.form.controls.select.reset(i),this.selectEnabled$.subscribe(p=>{this.form.controls.select.value!==p&&this.form.controls.select.setValue(p)}),this.selectEnabled=i)})}getAutocompleteEnabled(){let t;this.currentAutocompleteGroup.computedSelectors.forEach(i=>{i.selectors?.forEach(n=>{n.enabled&&(t=n.title,this.form.controls.autocomplete.setValue({id:n.filters.expression,value:n.title}))}),this.autocompleteEnabled=t})}getToolTip(t){let i;return t.tooltip&&(i=Array.isArray(t.tooltip)?t.tooltip.join("\n"):t.tooltip),i||""}getSelectDomValues(){var t=this;return(0,Pi.c)(function*(){for(const i of t.datasource.options.ogcFilters.select.bundles)if(i.domSelectors){let n;for(const p of i.domSelectors){let v;for(const Y of t.configService.getConfig("dom"))(p.id===Y.id||p.name===Y.name)&&(v={id:Y.id,url:Y.url,name:Y.name,values:Y.values});if(n=v.url?yield t.domService.getDom(v):v.values,n){let ue,Y=i;Y.selectors=[];for(const ye of n){if(i.multiple){let Ee;Ee=!!t.selectEnableds?.find(we=>we.title===ye.value),ue={title:ye.value,enabled:Ee,filters:{operator:p.operator,propertyName:p.propertyName,expression:ye.id}}}else ue={title:ye.value,enabled:t.selectEnabled?.title===ye.value,filters:{operator:p.operator,propertyName:p.propertyName,expression:ye.id}};Y.selectors.push(ue)}t.getSelectGroups().find(ye=>ye.ids.includes(Y.id)).computedSelectors.find(ye=>ye.title===Y.title).selectors=Y.selectors}}t.getSelectEnabled()}})()}getAutocompleteDomValues(){var t=this;return(0,Pi.c)(function*(){for(const i of t.datasource.options.ogcFilters.autocomplete.bundles)if(i.domSelectors){let n;for(const p of i.domSelectors){let v;for(const Y of t.configService.getConfig("dom"))(p.id===Y.id||p.name===Y.name)&&(v={id:Y.id,url:Y.url,name:Y.name,values:Y.values});if(n=v.url?yield t.domService.getDom(v):v.values,n){let ue,Y=i;Y.selectors=[];for(const ye of n)ue={title:ye.value,enabled:!(!t.autocompleteEnabled||t.autocompleteEnabled!==ye.value),filters:{operator:p.operator,propertyName:p.propertyName,expression:ye.id}},Y.selectors.push(ue);t.getAutocompleteGroups().find(ye=>ye.ids.includes(Y.id)).computedSelectors.find(ye=>ye.title===Y.title).selectors=Y.selectors}}t.filteredOgcAutocomplete[i.id]=new c._,t.cdRef.detectChanges(),t.filteredOgcAutocomplete[i.id]=t.form.controls.autocomplete.valueChanges.pipe((0,oe.k)(p=>{if(p.length)return n?.filter(v=>{const Y=p?p.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"";return v.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(Y)})}))}})()}getButtonColor(t){let i;return t.color&&t.enabled&&(i={"background-color":`rgba(${t.color})`}),i}bundleIsVertical(t){return!!t.vertical&&t.vertical}onPushButtonsChangeGroup(){this.getPushButtonsGroups().map(t=>t.enabled=!1),this.getPushButtonsGroups().find(t=>t===this.currentPushButtonsGroup).enabled=!0}onCheckboxesChangeGroup(){this.getCheckboxesGroups().map(t=>t.enabled=!1),this.getCheckboxesGroups().find(t=>t===this.currentCheckboxesGroup).enabled=!0}onRadioButtonsChangeGroup(){this.getRadioButtonsGroups().map(t=>t.enabled=!1),this.getRadioButtonsGroups().find(t=>t===this.currentRadioButtonsGroup).enabled=!0}onSelectChangeGroup(){this.getSelectGroups().map(t=>t.enabled=!1),this.getSelectGroups().find(t=>t===this.currentSelectGroup).enabled=!0}onAutocompleteChangeGroup(){this.getAutocompleteGroups().map(t=>t.enabled=!1),this.getAutocompleteGroups().find(t=>t===this.currentAutocompleteGroup).enabled=!0}onSelectionChange(t,i){clearTimeout(this.applyFiltersTimeout),"radioButton"===i&&this.emptyRadioButtons(),t&&(t.enabled=!t.enabled),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}emptyRadioButtons(){this.currentRadioButtonsGroup.computedSelectors.forEach(t=>{t.selectors.map(i=>i.enabled=!1),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)})}emptySelect(){this.selectEnabled=void 0}emptyAutocomplete(){this.autocompleteEnabled=void 0,this.form.controls.autocomplete.setValue(""),this.form.controls.autocomplete.markAsUntouched()}toggleAllSelection(){if(this.selectAllSelected){const t=[];this.currentSelectGroup.computedSelectors.forEach(i=>{i.selectors?.forEach(n=>{t.push(n)})}),this.sel.options.forEach(i=>i.select()),this.selectEnableds=t}else this.sel.options.forEach(t=>t.deselect()),this.selectEnableds=[]}selectOptionClick(t,i,n){if(i.multiple){const p=this.selectEnableds;let v=!0;if(this.sel.options.forEach(Y=>{Y.selected||(v=!1)}),this.selectAllSelected=v,n.isUserInput)if(p.length){for(const Y of p)if(Y.title===t.title){if(Y.enabled&&t.enabled){p.splice(p.indexOf(Y),1),this.selectEnableds=p;break}}else if(p.indexOf(Y)===p.length-1){p.push(t),this.selectEnableds=p;break}}else p.push(t),this.selectEnableds=p}else this.selectEnabled=t}autocompleteOptionClick(t){this.autocompleteEnabled=t.value}displayFn(t){return t?t.value:void 0}applyFilters(){let t="";const i=[],n=[this.currentPushButtonsGroup,this.currentCheckboxesGroup,this.currentRadioButtonsGroup,this.currentSelectGroup,this.currentAutocompleteGroup];for(const p of n)p.computedSelectors&&p.computedSelectors.map(v=>{const Y=[];v.selectors?.filter(ue=>!0===ue.enabled).forEach(ue=>Y.push(ue.filters)),Y.length>=1&&i.push(1===Y.length?Y[0]:{logical:v.logical,filters:Y})});this.isTemporalOperator()&&this._currentFilter.active&&i.push(this.datasource.options.ogcFilters.interfaceOgcFilters[0]),i.length>=1&&(t=this.ogcFilterWriter.buildFilter(1===i.length?i[0]:{logical:"And",filters:i})),"wms"===this.datasource.options.type&&this.ogcFilterService.filterByOgc(this.datasource,t),"wfs"===this.datasource.options.type&&this.datasource.ol.refresh(),this.datasource.setOgcFilters(this.datasource.options.ogcFilters,!0)}isMoreResults(t,i){let n=0;for(const v of t.selectors)n++;return n>("radio"===i?this.radioButtonsIndex:this.checkboxesIndex)}displayMoreResults(t){"radio"===t?this.radioButtonsIndex+=5:this.checkboxesIndex+=5}isLessResults(t,i){let n=0;for(const v of t.selectors)n++;return this.baseIndex!==("radio"===i?this.radioButtonsIndex:this.checkboxesIndex)&&n>this.baseIndex}displayLessResults(t){"radio"===t?this.radioButtonsIndex=this.baseIndex:this.checkboxesIndex=this.baseIndex}isTemporalOperator(){return this.currentFilter?.operator?.toLowerCase()===this.ogcFilterOperator.During.toLowerCase()}changeProperty(t,i,n=!0){const p=this.detectProperty(i);p&&(this.datasource.options.ogcFilters.interfaceOgcFilters.find(v=>v.filterid===this.currentFilter.filterid)[p]=t,n&&this.applyFilters())}detectProperty(t){switch(this.currentFilter.operator){case xt.e.PropertyIsNotEqualTo:case xt.e.PropertyIsEqualTo:case xt.e.PropertyIsGreaterThan:case xt.e.PropertyIsGreaterThanOrEqualTo:case xt.e.PropertyIsLessThan:case xt.e.PropertyIsLessThanOrEqualTo:return"expression";case xt.e.PropertyIsLike:return"pattern";case xt.e.PropertyIsBetween:return t&&1===t?"lowerBoundary":t&&2===t?"upperBoundary":void 0;case xt.e.During:return t&&1===t?"begin":t&&2===t?"end":void 0;default:return}}static \u0275fac=function(i){return new(i||l)(e.GI1(Ut),e.GI1(xe.KE),e.GI1(be.Mx),e.GI1(A.aW),e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter-selection"]],viewQuery:function(i,n){if(1&i&&e.CC$(Fi,5),2&i){let p;e.wto(p=e.Gqi())&&(n.sel=p.first)}},inputs:{refreshFilters:"refreshFilters",datasource:"datasource",map:"map",checkboxesIndex:"checkboxesIndex",radioButtonsIndex:"radioButtonsIndex",baseIndex:"baseIndex",currentFilter:"currentFilter"},standalone:!0,features:[e.M5G([be.Mx]),e.UHJ],decls:3,vars:3,consts:[[3,"formGroup"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","pushButtonGroups",4,"ngIf"],["class","checkboxGroups",4,"ngIf"],["class","radioButtonGroups",4,"ngIf"],["class","selectGroups",4,"ngIf"],["class","autocompleteGroups",4,"ngIf"],[1,"pushButtonGroups"],["class","groupsSelector",4,"ngIf"],[1,"groupsSelector"],["formControlName","pushButtonsGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","pushButtons","appearance","legacy","multiple","true",1,"mat-typography",3,"vertical"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","ngStyle","checked","value","change",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","ngStyle","checked","value","change"],[1,"checkboxGroups"],["formControlName","checkboxesGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[1,"checkboxes","mat-typography"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","checked","value","change",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","checked","value","change"],["class","lessResults mat-typography",3,"click",4,"ngIf"],["class","moreResults mat-typography",3,"click",4,"ngIf"],[1,"lessResults","mat-typography",3,"click"],[1,"moreResults","mat-typography",3,"click"],[1,"radioButtonGroups"],["formControlName","radioButtonsGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],["formControlName","radioButtons",1,"mat-typography"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","change",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","change"],[1,"selectGroups"],["formControlName","selectGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","click",4,"ngIf"],[4,"ngIf","ngIfElse"],["notMulti",""],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","click"],["formControlName","selectMulti",3,"multiple","placeholder"],["selection",""],[3,"ngModel","ngModelOptions","ngModelChange","change",4,"ngIf"],["tooltip-position","below","matTooltipDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","value","onSelectionChange",4,"ngFor","ngForOf"],[3,"ngModel","ngModelOptions","ngModelChange","change"],["tooltip-position","below","matTooltipDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","value","onSelectionChange"],["formControlName","select",3,"placeholder"],[1,"autocompleteGroups"],["formControlName","autocompleteGroup","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","value","valueChange"],[3,"width",4,"ngIf"],["matInput","","type","text","formControlName","autocomplete",1,"autocomplete",3,"matAutocomplete","placeholder"],["autocomplete",""],[3,"displayWith","optionSelected"],["auto","matAutocomplete","autocomplete",""],[3,"datasource","currentFilter","changeProperty"]],template:function(i,n){1&i&&(e.I0R(0,"form",0),e.yuY(1,no,6,5,"div",1),e.C$Y(),e.yuY(2,Fn,5,4,"div",2)),2&i&&(e.E7m("formGroup",n.form),e.yG2(),e.E7m("ngForOf",n.ogcFiltersSelectors),e.yG2(),e.E7m("ngIf",n.isTemporalOperator()))},dependencies:[xe.y,xe.sz,xe.ot,xe.ue,xe.u,xe._G,xe.sl,xe.uW,xe.Wo,Ke.Iw,Ke.u_,to.U,to.k,yt.wb,yt.Up,Gt.d5,Gt.kX,kt.I5,ht.KO,ht.a4,kt.Ax,io.ue,io.gn,io.KU,Ke.Qt,$t.Vn,$t.WK,Po.yk,Po.cv,Po.cT,dt.oB,dt.qL,Bt.cN,Bt.yi,mo.U1,mo.e,mo.cG,xo,Ke.a,k._s,pe.sD],styles:["[_nghost-%COMP%]   .mat-button-toggle-group[_ngcontent-%COMP%]{margin:5px;flex-wrap:wrap;box-shadow:none!important;width:95%}[_nghost-%COMP%]   .checkboxes[_ngcontent-%COMP%]{flex-wrap:wrap;box-shadow:none}[_nghost-%COMP%]   .groupsSelector[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{display:inline-flex;border:1.5px solid black;border-radius:5px;margin:5px;white-space:normal;min-height:40px;height:auto;width:142px}[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]     .mat-button-toggle-label-content{line-height:unset;font-size:small;display:block}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:45%}}[_nghost-%COMP%]     .material-tooltip{white-space:pre-wrap}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%], [_nghost-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin:7px;width:95%;display:inline-flex;font-size:larger}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]     label, [_nghost-%COMP%]   mat-radio-button[_ngcontent-%COMP%]     label{white-space:normal}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{vertical-align:middle}[_nghost-%COMP%]   mat-button[_ngcontent-%COMP%]{padding-right:10px;cursor:pointer}[_nghost-%COMP%]   h3[_ngcontent-%COMP%]{margin:7px;text-align:left}[_nghost-%COMP%]   u[_ngcontent-%COMP%]{cursor:pointer;color:#00f;margin:5px}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{margin:unset}"]})}return l})();function rr(l,m){if(1&l&&e.wR5(0,"igo-ogc-filter-selection",2),2&l){const t=e.GaO();e.E7m("refreshFilters",t.refreshFunc)("datasource",t.datasource)("map",t.map)("currentFilter",t.currentFilter)}}function sr(l,m){if(1&l&&e.wR5(0,"igo-ogc-filter-form",4),2&l){const t=m.$implicit,i=e.GaO(2);e.E7m("currentFilter",t)("refreshFilters",i.refreshFunc)("datasource",i.datasource)("map",i.map)}}function ar(l,m){if(1&l&&e.yuY(0,sr,1,4,"ng-template",3),2&l){const t=e.GaO();e.E7m("ngForOf",t.datasource.options.ogcFilters.interfaceOgcFilters)}}let Hn=(()=>{class l{datasource;map;refreshFilters;get refreshFunc(){return this.refreshFilters}get advancedOgcFilters(){if(this.datasource.options.ogcFilters)return this.datasource.options.ogcFilters.advancedOgcFilters}get currentFilter(){return this.datasource.options.ogcFilters.interfaceOgcFilters?this.datasource.options.ogcFilters.interfaceOgcFilters[0]:void 0}color="primary";constructor(){}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filterable-form"]],inputs:{datasource:"datasource",map:"map",refreshFilters:"refreshFilters"},standalone:!0,features:[e.M5G([{provide:Gt.kF,useValue:{overlayPanelClass:"igo-overlay-panel-width"}},{provide:mo.GE,useValue:{overlayPanelClass:"igo-overlay-panel-width"}}]),e.UHJ],decls:2,vars:2,consts:[["igoListItem","",3,"refreshFilters","datasource","map","currentFilter",4,"ngIf"],[4,"ngIf"],["igoListItem","",3,"refreshFilters","datasource","map","currentFilter"],["ngFor","",3,"ngForOf"],[3,"currentFilter","refreshFilters","datasource","map"]],template:function(i,n){1&i&&e.yuY(0,rr,1,4,"igo-ogc-filter-selection",0)(1,ar,1,1,null,1),2&i&&(e.E7m("ngIf",!n.advancedOgcFilters),e.yG2(),e.E7m("ngIf",n.advancedOgcFilters&&n.datasource.options.ogcFilters.editable))},dependencies:[Ke.u_,Rn,be.qU,Ke.Iw,di],styles:[".igo-overlay-panel-width{min-width:-moz-fit-content;min-width:fit-content}\n\n/*# sourceMappingURL=ogc-filterable-form.component.ts-angular-inline--1.css.map*/"]})}return l})();function q(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-icon",10),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleFiltersCollapsed())}),e.OEk(1,"expand_less "),e.C$Y()}if(2&l){const t=e.GaO(),i=e.Gew(8);e.E7m("target",i)("collapsed",t.filtersCollapsed)}}const Re=l=>({cursor:l});function E(l,m){if(1&l){const t=e.KQA();e.I0R(0,"span",11),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleLegendOnClick())}),e.OEk(1),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("ngStyle",e.S45(3,Re,t.filtersCollapsed?"default":"pointer"))("matTooltip",t.layer.title),e.yG2(),e.oRS(" ",t.layer.title," ")}}function ee(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",12),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.addFilterToSequence())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"add"),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("disabled",t.addFilterDisabled())("matTooltip",e.kDX(1,3,"igo.geo.filter.addFilter"))("color",t.color)}}const ge=l=>({disabled:l});function Ye(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",13),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.layer.visible=!n.layer.visible)}),e.wVc(1,"translate"),e.wVc(2,"translate"),e.I0R(3,"mat-icon",0),e.wVc(4,"async"),e.OEk(5),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.kDX(1,4,"igo.geo.layer.hideLayer"):e.kDX(2,6,"igo.geo.layer.showLayer")),e.yG2(3),e.E7m("ngClass",e.S45(10,ge,!1===e.kDX(4,8,t.inResolutionRange$))),e.yG2(2),e.oRS("",t.layer.visible?"visibility":"visibility_off"," ")}}function Je(l,m){if(1&l&&e.wR5(0,"igo-layer-legend",17),2&l){const t=e.GaO(2);e.E7m("layer",t.layer)}}function ro(l,m){if(1&l&&(e.I0R(0,"div",14,15),e.yuY(2,Je,1,1,"igo-layer-legend",16),e.wVc(3,"async"),e.C$Y()),2&l){const t=e.GaO();e.yG2(2),e.E7m("ngIf",e.kDX(3,1,t.showLegend$))}}function yi(l,m){if(1&l){const t=e.KQA();e.I0R(0,"section",18),e.wR5(1,"mat-divider"),e.I0R(2,"mat-checkbox",19),e.qCj("change",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.changeOgcFilterType(n))}),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO();return e.kNx(p.datasource.options.ogcFilters.advancedOgcFilters,n)||(p.datasource.options.ogcFilters.advancedOgcFilters=n),e.CGJ(n)}),e.OEk(3),e.wVc(4,"translate"),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(2),e.OKB("ngModel",t.datasource.options.ogcFilters.advancedOgcFilters),e.yG2(),e.oRS(" ",e.kDX(4,2,"igo.geo.filter.advancedOgcFilters")," ")}}const Fo=l=>({"separate-item":l});let jo=(()=>{class l{ogcFilterService;color="primary";lastRunOgcFilter;defaultLogicalParent=xt.e.And;hasActiveSpatialFilter=!1;filtersAreEditable=!0;filtersCollapsed=!0;hasSelector=!1;showLegend$=new B.g(!1);inResolutionRange$=new B.g(!0);resolution$$;ogcFilterWriter;layer;map;header=!0;get refreshFunc(){return this.refreshFilters.bind(this)}get datasource(){return this.layer.dataSource}constructor(t){this.ogcFilterService=t,this.ogcFilterWriter=new zt.S}ngOnInit(){this.layer.visible&&(this.filtersCollapsed=!1);const t=this.datasource.options.ogcFilters;switch((t.pushButtons&&t.pushButtons.bundles.length>0||t.checkboxes&&t.checkboxes.bundles.length>0||t.radioButtons&&t.radioButtons.bundles.length>0||t.select&&t.select.bundles.length>0||t.autocomplete&&t.autocomplete.bundles.length>0)&&(void 0===t.advancedOgcFilters&&(t.advancedOgcFilters=!1),this.hasSelector=!0),this.datasource.options.type){case"wms":this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);break;case"wfs":this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource)}t&&(t.interfaceOgcFilters&&(this.lastRunOgcFilter=JSON.parse(JSON.stringify(t.interfaceOgcFilters)),t.interfaceOgcFilters.filter(n=>n.wkt_geometry).length>=1&&(this.hasActiveSpatialFilter=!0)),this.filtersAreEditable=!!t.editable&&t.editable),this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.inResolutionRange$.next(this.layer.isInResolutionsRange)})}ngOnDestroy(){this.resolution$$.unsubscribe()}addFilterToSequence(){this.filtersCollapsed=!1;const i=this.datasource.options.ogcFilters.interfaceOgcFilters||[],n=0===i.length?0:i[i.length-1].level;let p="";const v=this.datasource.options.sourceFields.filter(we=>!we.excludeFromOgcFilters);let Y;v.length>0&&(p=void 0===v[0].name?"":v[0].name);const ue=this.datasource.options;ue.fieldNameGeometry?Y=ue.fieldNameGeometry:this.datasource.options.paramsWFS&&this.datasource.options.paramsWFS.fieldNameGeometry&&(Y=this.datasource.options.paramsWFS.fieldNameGeometry);const ye=this.ogcFilterWriter.computeAllowedOperators(this.datasource.options.sourceFields,p,this.datasource.options.ogcFilters.allowedOperatorsType),Ee=Object.keys(ye)[0];i.push(this.ogcFilterWriter.addInterfaceFilter({propertyName:p,operator:Ee,active:!0,igoSpatialSelector:"fixedExtent",srsName:this.map.projection},Y,n,this.defaultLogicalParent)),this.datasource.options.ogcFilters.interfaceOgcFilters=i}refreshFilters(t){!0===t&&(this.lastRunOgcFilter=void 0);const i=this.datasource.options.ogcFilters,n=i.interfaceOgcFilters?i.interfaceOgcFilters.filter(p=>!0===p.active):[];if(0===n.length&&(i.filters=void 0,i.filtered=!1),n.length>1&&(n[0].parentLogical=n[1].parentLogical),this.hasActiveSpatialFilter=0!==n.filter(p=>-1!==["Contains","Intersects","Within"].indexOf(p.operator)).length,JSON.stringify(this.lastRunOgcFilter)!==JSON.stringify(n)){if("wfs"===this.layer.dataSource.options.type)this.layer.dataSource.options.ogcFilters.filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(n),this.layer.dataSource.ol.refresh();else if("wms"===this.layer.dataSource.options.type&&i.enabled){let p="";if(n.length>=1){const v=this.layer.dataSource,Y=v.options.ogcFilters;Y.filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(n),p=this.ogcFilterWriter.buildFilter(Y.filters,void 0,void 0,this.layer.dataSource.options.fieldNameGeometry,v.options)}this.ogcFilterService.filterByOgc(this.datasource,p),this.datasource.options.ogcFilters.filtered=0!==n.length}this.lastRunOgcFilter=JSON.parse(JSON.stringify(n))}this.layer.dataSource.setOgcFilters(i,!0)}setVisible(){this.layer.visible=!0}isAdvancedOgcFilters(){return this.datasource.options.ogcFilters.advancedOgcFilters}addFilterDisabled(){return!this.datasource.options.sourceFields||0===this.datasource.options.sourceFields.length}changeOgcFiltersAdvancedOgcFilters(t){this.datasource.options.ogcFilters.advancedOgcFilters=t}changeOgcFilterType(t){this.changeOgcFiltersAdvancedOgcFilters(t.checked),t.checked&&this.refreshFilters(!0)}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)}toggleFiltersCollapsed(){this.filtersCollapsed=!this.filtersCollapsed}static \u0275fac=function(i){return new(i||l)(e.GI1(Ut))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filterable-item"]],inputs:{layer:"layer",map:"map",header:"header"},standalone:!0,features:[e.M5G([Ut]),e.UHJ],decls:12,vars:12,consts:[[3,"ngClass"],["class","igo-chevron","matListItemIcon","","igoCollapse","",3,"target","collapsed","click",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"ngStyle","matTooltip","click",4,"ngIf"],["matListItemMeta",""],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","color","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["ogcFilters",""],["class","igo-layer-legend-container",4,"ngIf"],[3,"datasource","map","refreshFilters"],["class","mat-typography advancedOgcFilters",4,"ngIf"],["matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"target","collapsed","click"],["matListItemTitle","","matTooltipShowDelay","500",3,"ngStyle","matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","color","click"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],[3,"layer"],[1,"mat-typography","advancedOgcFilters"],[3,"ngModel","change","ngModelChange"]],template:function(i,n){1&i&&(e.I0R(0,"div",0)(1,"mat-list-item"),e.yuY(2,q,2,2,"mat-icon",1)(3,E,2,5,"span",2),e.I0R(4,"div",3),e.yuY(5,ee,4,5,"button",4)(6,Ye,6,12,"button",5),e.C$Y()(),e.I0R(7,"div",null,6),e.yuY(9,ro,4,3,"div",7),e.wR5(10,"igo-ogc-filterable-form",8),e.yuY(11,yi,5,4,"section",9),e.C$Y()()),2&i&&(e.E7m("ngClass",e.S45(10,Fo,!0===n.header)),e.yG2(2),e.E7m("ngIf",n.header),e.yG2(),e.E7m("ngIf",n.header),e.yG2(2),e.E7m("ngIf",n.isAdvancedOgcFilters()&&n.filtersAreEditable),e.yG2(),e.E7m("ngIf",n.header),e.yG2(3),e.E7m("ngIf",n.header),e.yG2(),e.E7m("datasource",n.datasource)("map",n.map)("refreshFilters",n.refreshFunc),e.yG2(),e.E7m("ngIf",n.hasSelector&&n.filtersAreEditable))},dependencies:[Ke.QF,Ot.iI,Ot.g9,Ot.Y1,to.k,Ot.UV,Ot.At,Ke.u_,dt.oB,dt.qL,be.mK,Ke.Qt,ht.KO,ht.a4,Ze.oJ,Ze.um,Ao,Hn,to.U,$t.Vn,$t.WK,xe.y,xe.ue,xe._G,Ke.a,k._s,pe.sD],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .advancedOgcFilters[_ngcontent-%COMP%]{text-align:center;width:100%;display:inline-block}[_nghost-%COMP%]   .mat-mdc-list-item[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:1.125em;width:calc(100% - 18px)}[_nghost-%COMP%]   mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}[_nghost-%COMP%]   .separate-item[_ngcontent-%COMP%]{border-bottom:4px solid darkgrey}[_nghost-%COMP%]     .mdc-list-item__start, [_nghost-%COMP%]     .mdc-list-item__end, [_nghost-%COMP%]     .mdc-list-item__content{pointer-events:auto}"]})}return l})();function Ln(l,m){if(1&l&&(e.I0R(0,"button",2),e.wVc(1,"translate"),e.I0R(2,"mat-icon",3),e.OEk(3,"filter_alt"),e.C$Y()()),2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,3,"igo.geo.filter.filterBy"))("color",t.color),e.yG2(2),e.E7m("matBadge",t.badge)}}function na(l,m){if(1&l&&e.wR5(0,"igo-ogc-filterable-item",7),2&l){const t=e.GaO(2);e.E7m("header",!1)("map",t.layer.map)("layer",t.layer)}}function Yr(l,m){if(1&l&&(e.I0R(0,"div",4,5),e.yuY(2,na,1,3,"igo-ogc-filterable-item",6),e.C$Y()),2&l){const t=e.GaO();e.yG2(2),e.E7m("ngIf",t.ogcFilterCollapse&&t.options.ogcFilters.enabled)}}let yr=(()=>{class l{options;get badge(){const t=this.options.ogcFilters;let i=0;if(t&&!t.advancedOgcFilters){if(t.pushButtons){const p=t.pushButtons.groups.find(Y=>Y.enabled);let v=0;p&&p.computedSelectors?.map(Y=>v+=Y.selectors?.filter(ue=>ue.enabled).length),i+=v}if(t.checkboxes){const p=t.checkboxes.groups.find(Y=>Y.enabled);let v=0;p&&p.computedSelectors?.map(Y=>v+=Y.selectors?.filter(ue=>ue.enabled).length),i+=v}if(t.radioButtons){const p=t.radioButtons.groups.find(Y=>Y.enabled);let v=0;p&&p.computedSelectors?.map(Y=>v+=Y.selectors?.filter(ue=>ue.enabled).length),i+=v}if(t.select){const p=t.select.groups.find(Y=>Y.enabled);let v=0;p&&p.computedSelectors?.map(Y=>v+=Y.selectors?.filter(ue=>ue.enabled).length),i+=v}if(t.autocomplete){const p=t.autocomplete.groups.find(Y=>Y.enabled);let v=0;p&&p.computedSelectors?.map(Y=>v+=Y.selectors?.filter(ue=>ue.enabled).length),i+=v}}else{if(t&&t.filters&&!t.filters.filters)return 1;if(t&&t.filters&&t.filters.filters)return t.filters.filters.length}if(t.filters&&"During"===t.filters.operator&&t.filters.active&&t.interfaceOgcFilters&&t.interfaceOgcFilters[0].active){const n=t.interfaceOgcFilters[0];t.filters.calendarModeYear?(n.begin.substring(0,4)!==this.options.minDate.substring(0,4)||n.end.substring(0,4)!==this.options.maxDate.substring(0,4))&&(i+=1):(n.begin!==this.options.minDate||n.end!==this.options.maxDate)&&(i+=1)}return i>0?i:void 0}get layer(){return this._layer}set layer(t){this._layer=t,t&&(this.options=this.layer.dataSource.options)}_layer;map;color="primary";header;ogcFilterCollapse=!1;constructor(){}ngOnInit(){this.options=this.layer.dataSource.options}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter-button"]],inputs:{layer:"layer",map:"map",color:"color",header:"header"},standalone:!0,features:[e.UHJ],decls:2,vars:2,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["class","igo-layer-actions-container",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium",3,"matBadge"],[1,"igo-layer-actions-container"],["ogcFilter",""],["igoListItem","",3,"header","map","layer",4,"ngIf"],["igoListItem","",3,"header","map","layer"]],template:function(i,n){1&i&&e.yuY(0,Ln,4,5,"button",0)(1,Yr,3,1,"div",1),2&i&&(e.E7m("ngIf",n.header&&n.options.ogcFilters&&n.options.ogcFilters.enabled&&(n.options.ogcFilters.pushButtons||n.options.ogcFilters.checkboxes||n.options.ogcFilters.radioButtons||n.options.ogcFilters.select||n.options.ogcFilters.autocomplete||n.options.ogcFilters.editable)),e.yG2(),e.E7m("ngIf",n.options.ogcFilters&&n.options.ogcFilters.enabled&&(n.options.ogcFilters.pushButtons||n.options.ogcFilters.checkboxes||n.options.ogcFilters.radioButtons||n.options.ogcFilters.select||n.options.ogcFilters.autocomplete||n.options.ogcFilters.editable)))},dependencies:[Ke.u_,Ze.oJ,Ze.um,ht.KO,ht.a4,dt.oB,dt.qL,st.g,st.S,jo,be.qU,k._s,pe.sD],changeDetection:0})}return l})();function ra(l,m){1&l&&(e.I0R(0,"div",3),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.filter.noFilterableLayer")," "))}function sa(l,m){if(1&l&&e.wR5(0,"igo-ogc-filterable-item",4),2&l){const t=m.$implicit;e.E7m("header",!0)("layer",t)("map",t.map)}}let zn=(()=>{class l{layers;map;constructor(){}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filterable-list"]],inputs:{layers:"layers",map:"map"},standalone:!0,features:[e.UHJ],decls:5,vars:10,consts:[[3,"navigation","selection"],["id","no-layer-message",4,"ngIf"],["ngFor","",3,"ngForOf"],["id","no-layer-message"],["igoListItem","",3,"header","layer","map"]],template:function(i,n){1&i&&(e.I0R(0,"igo-list",0),e.yuY(1,ra,3,3,"div",1),e.wVc(2,"filterableDataSource"),e.yuY(3,sa,1,3,"ng-template",2),e.wVc(4,"filterableDataSource"),e.C$Y()),2&i&&(e.E7m("navigation",!1)("selection",!1),e.yG2(),e.E7m("ngIf",0===e.g7$(2,4,n.layers,"ogc").length),e.yG2(2),e.E7m("ngForOf",e.g7$(4,7,n.layers,"ogc")))},dependencies:[be.yM,Ke.u_,Ke.Iw,jo,be.qU,k._s,pe.sD,Eo],styles:["#no-layer-message[_ngcontent-%COMP%]{padding:7%;text-align:center;font-size:medium;font-weight:700}"],changeDetection:0})}return l})();var Xn=r(12268);let lr=(()=>{class l{mapService;component;layers$$;constructor(t,i){this.mapService=i,this.component=t}ngOnInit(){this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(t=>{this.component.layers=t.filter(i=>i.showInLayerList)})}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(i){return new(i||l)(e.GI1(zn,2),e.GI1(Xn.u))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoOgcFilterableListBinding",""]],standalone:!0})}return l})();var Vr=r(17469),jr=r(14899),Qo=r(80956),_i=r(72032),$o=r(54776),Gi=r(87544),yo=r(45212),_o=r(88872),Mo=r(3544),Kr=r(61200),cr=r(28660),Nt=function(l){return l.Point="Point",l.LineString="LineString",l.Polygon="Polygon",l.Circle="Circle",l}(Nt||{}),bt=function(l){return l.Coordinates="Coordinates",l.Length="Length",l.Area="Area",l.Predefined="Predefined",l.Custom="Custom",l}(bt||{}),qi=function(l){return l.DecimalDegree="DD",l.DegreesMinutesSeconds="DMS",l}(qi||{});let _r=(()=>{class l{config;icons;constructor(t){this.config=t,this.getIconsList()}getIcons(){return this.icons}getPath(){return this.config.getConfig("drawingTool.icons")||[]}getIconsList(){this.icons=this.getPath()}static \u0275fac=function(i){return new(i||l)(e.CoB(A.aW))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var To=r(8512);function ur(l,m,t,i){return new $o.cp({stroke:new yo.c({color:m||"rgba(143,7,7,1)",width:t||1}),fill:new _o.c({color:l||"rgba(255,255,255,0.4)"}),image:new Gi.c({radius:5,stroke:new yo.c({color:m||"rgba(143,7,7,1)",width:t||1}),fill:new _o.c({color:l||"rgba(255,255,255,0.4)"})})})}function vr(l,m){let i=new Map([[qi.DecimalDegree,n=>{if("number"==typeof n[0])return(0,G.mC)(n,5);{const p=[Number(n[0]),Number(n[1])];return(0,G.mC)(p,5)}}],[qi.DegreesMinutesSeconds,n=>(0,G.G2)(n,2)]]).get(m);return i?i(l):void 0}var Ci=r(53291),$i=r(58264),J=r(80848),j=r(28772),u=r(49412),S=r(95128),$=r(83680),re=r(68013),ve=r(67732),Be=r(39844),rt=r(70524),Ct=r(17115),vt=r(2892),ft=(r(89500),r(69904)),Pt=function(l){return l.Arial="Arial",l.ArialBlack="Arial Black",l.Verdana="Verdana",l.Tahoma="Tahoma",l.TrebuchetMS="Trebuchet MS",l.Impact="Impact",l.TimesNewRoman="Times New Roman",l.Georgia="Georgia",l.AmericanTypewriter="American Typewriter",l.Courier="Courier",l.LucidaConsole="Lucida Console",l.BrushScriptMT="Brush Script MT",l.ComicSansMS="Comic Sans MS",l}(Pt||{}),_t=r(40600),Do=r(62632),ki=r(91088);let Ko=(()=>{class l{fillColor="rgba(255,255,255,0.4)";strokeColor="rgba(143,7,7,1)";strokeWidth=1;labelsAreShown=!0;icon;fontSize="15";fontStyle=Pt.Arial.toString();offsetX=0;offsetY=0;constructor(){}getFillColor(){return this.fillColor}setFillColor(t){this.fillColor=t}getStrokeColor(){return this.strokeColor}setStrokeColor(t){this.strokeColor=t}getStrokeWidth(){return this.strokeWidth}getLabelsAreShown(){return this.labelsAreShown}toggleLabelsAreShown(){this.labelsAreShown=!this.labelsAreShown}setIcon(t){this.icon=t}getIcon(){return this.icon}getFontSize(){return this.fontSize}setFontSize(t){this.fontSize=t}getFontStyle(){return this.fontStyle}setFontStyle(t){this.fontStyle=t}getOffsetX(){return this.offsetX}setOffsetX(t){this.offsetX=t}getOffsetY(){return this.offsetY}setOffsetY(t){this.offsetY=t}createIndividualElementStyle(t,i,n,p,v,Y,ue,ye,Ee,we){let Le,Xe=!1;t.getGeometry()instanceof J.c&&(Xe=!Xe);const tt=n?t.get("draw"):"";t.set("_mapTitle",tt);const pt={text:tt,stroke:{color:"white",width:.75},fill:{color:"black"},font:p,overflow:!0,offsetX:ue,offsetY:ye};let Tt;if(t.get("rad")){const jt=(0,V.AF)(t.getGeometry().flatCoordinates,Ee,"EPSG:4326"),Co=t.get("rad")/Math.cos(Math.PI/180*jt[1])/i;return Tt={text:pt,circle:{radius:Co,stroke:{color:Y||this.strokeColor,width:this.strokeWidth},fill:{color:v}}},t.set("_style",Tt),Le=new $o.cp({text:new Do.c({text:tt,stroke:new yo.c({color:"white",width:.75}),fill:new _o.c({color:"black"}),font:p,overflow:!0,offsetX:ue,offsetY:ye}),image:new Gi.c({radius:Co,stroke:new yo.c({color:Y||this.strokeColor,width:this.strokeWidth}),fill:new _o.c({color:v})})}),Le}return we?(this.offsetY=-26,pt.offsetY=this.offsetY,t.set("_style",{text:pt,stroke:{color:Y,width:this.strokeWidth},fill:{color:v},icon:{src:we}}),Le=new $o.cp({text:new Do.c({text:n?t.get("draw"):"",stroke:new yo.c({color:"white",width:.75}),fill:new _o.c({color:"black"}),font:p,overflow:!0,offsetX:ue,offsetY:ye}),stroke:new yo.c({color:Y,width:this.strokeWidth}),fill:new _o.c({color:v}),image:new ki.c({src:we})}),Le):(this.offsetY=Xe?-15:0,pt.offsetY=this.offsetY,t.set("_style",{text:pt,stroke:{color:Y,width:this.strokeWidth},fill:{color:v},circle:{radius:5,stroke:{color:Y,width:this.strokeWidth},fill:{color:v}}}),Le=new $o.cp({text:new Do.c({text:n?t.get("draw"):"",stroke:new yo.c({color:"white",width:.75}),fill:new _o.c({color:"black"}),font:p,overflow:!0,offsetX:ue,offsetY:ye}),stroke:new yo.c({color:Y,width:this.strokeWidth}),fill:new _o.c({color:v}),image:new Gi.c({radius:5,stroke:new yo.c({color:Y,width:this.strokeWidth}),fill:new _o.c({color:v})})}),Le)}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function en(l,m){1&l&&(e.SAx(0),e.I0R(1,"span")(2,"mat-icon",5),e.OEk(3,"format_color_fill"),e.C$Y(),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.wR5(6,"igo-color-picker-form-field",21),e.k70()),2&l&&(e.yG2(4),e.oRS(" ",e.kDX(5,1,"igo.geo.style.fill")," "))}function Jn(l,m){if(1&l&&(e.I0R(0,"mat-option",22),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t," ")}}let dr=(()=>{class l{dialogRef;formBuilder;drawStyleService;data;confirmFlag=!1;form;styleModalData;linestringOnly;constructor(t,i,n,p){this.dialogRef=t,this.formBuilder=i,this.drawStyleService=n,this.data=p}ngOnInit(){this.linestringOnly=!0;for(const t of this.data.features)"LineString"!==t.geometry.type&&(this.linestringOnly=!1);this.buildStyleData(),this.buildForm()}buildForm(){this.form=this.formBuilder.group({fill:[this.getFeatureFillColor()],stroke:[this.getFeatureStrokeColor()]})}buildStyleData(){this.styleModalData={fillColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)",strokeColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)",fontSize:this.data.features.length>0?this.data.features[0].properties.fontStyle.split(" ")[0].replace("px",""):"20",fontStyle:this.data.features.length>0?this.data.features[0].properties.fontStyle.substring(this.data.features[0].properties.fontStyle.indexOf(" ")+1):Pt.Arial,offsetX:this.data.features.length>0?this.data.features[0].properties.offsetX:this.drawStyleService.getOffsetX(),offsetY:this.data.features.length>0?this.data.features[0].properties.offsetY:this.drawStyleService.getOffsetY()}}get allFontStyles(){return Object.values(Pt)}getFeatureFontSize(){return this.styleModalData.fontSize?this.styleModalData.fontSize:this.data.features.length>0?this.data.features[0].properties.fontStyle.split(" ")[0].replace("px",""):"20"}getFeatureFontStyle(){return this.styleModalData.fontStyle?this.styleModalData.fontStyle:this.data.features.length>0?this.data.features[0].properties.fontStyle.substring(this.data.features[0].properties.fontStyle.indexOf(" ")+1):Pt.Arial}getFeatureFillColor(){return this.styleModalData.fillColor?this.styleModalData.fillColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)"}getFeatureStrokeColor(){return this.styleModalData.strokeColor?this.styleModalData.strokeColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)"}getFeatureOffsetX(){return this.styleModalData.offsetX?this.styleModalData.offsetX:this.data.features.length>0?this.data.features[0].properties.offsetX:this.drawStyleService.getOffsetX()}getFeatureOffsetY(){return this.styleModalData.offsetY?this.styleModalData.offsetY:this.data.features.length>0?this.data.features[0].properties.offsetY:this.drawStyleService.getOffsetY()}cancelDrawing(){this.dialogRef.close()}confirm(){this.confirmFlag=!0,this.form.get("fill").value&&(this.styleModalData.fillColor=this.form.get("fill").value),this.form.get("stroke").value&&(this.styleModalData.strokeColor=this.form.get("stroke").value),this.dialogRef.close(this.styleModalData)}openPicker(){this.dialogRef.disableClose=!0}closePicker(){this.dialogRef.disableClose=!1}static \u0275fac=function(i){return new(i||l)(e.GI1(_t.yI),e.GI1(xe.KE),e.GI1(Ko),e.GI1(_t.sR))};static \u0275cmp=e.In1({type:l,selectors:[["igo-style-modal-drawing"]],inputs:{confirmFlag:"confirmFlag"},standalone:!0,features:[e.UHJ],decls:47,vars:29,consts:[["mat-dialog-title",""],["mat-dialog-content","",1,"edition-drawing",3,"hidden"],[1,"igo-form",3,"formGroup"],[1,"color-picker"],[4,"ngIf"],[1,"stroke-palette-icon"],["formControlName","stroke"],[1,"igo-input-container"],["subscriptSizing","dynamic",1,"igo-form-input-box"],["matInput","","type","number","placeholder","10","min","10","onkeydown","return event.keyCode !== 69",3,"value","input"],["testFontSize",""],["matTextSuffix",""],[3,"value","selectionChange"],["testFontStyle",""],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","onkeydown","return event.keyCode !== 69",3,"value","input"],["offsetXInput",""],["offsetYInput",""],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["formControlName","fill"],[3,"value"]],template:function(i,n){1&i&&(e.I0R(0,"h2",0),e.OEk(1),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"div",1)(4,"form",2)(5,"div",3),e.yuY(6,en,7,3,"ng-container",4),e.I0R(7,"span")(8,"mat-icon",5),e.OEk(9,"border_color "),e.C$Y(),e.OEk(10),e.wVc(11,"translate"),e.C$Y(),e.wR5(12,"igo-color-picker-form-field",6),e.C$Y(),e.I0R(13,"div",7)(14,"mat-form-field",8)(15,"mat-label"),e.OEk(16),e.wVc(17,"translate"),e.C$Y(),e.I0R(18,"input",9,10),e.qCj("input",function(v){return n.styleModalData.fontSize=v.target.value}),e.C$Y(),e.I0R(20,"span",11),e.OEk(21,"px"),e.C$Y()(),e.I0R(22,"mat-form-field",8)(23,"mat-label"),e.OEk(24),e.wVc(25,"translate"),e.C$Y(),e.I0R(26,"mat-select",12,13),e.qCj("selectionChange",function(v){return n.styleModalData.fontStyle=v.value}),e.yuY(28,Jn,2,2,"mat-option",14),e.C$Y()(),e.I0R(29,"mat-form-field",8)(30,"mat-label"),e.OEk(31),e.wVc(32,"translate"),e.C$Y(),e.I0R(33,"input",15,16),e.qCj("input",function(v){return n.styleModalData.offsetX=v.target.value}),e.C$Y()(),e.I0R(35,"mat-form-field",8)(36,"mat-label"),e.OEk(37),e.wVc(38,"translate"),e.C$Y(),e.I0R(39,"input",15,17),e.qCj("input",function(v){return n.styleModalData.offsetY=v.target.value}),e.C$Y()()()()(),e.I0R(41,"div",18)(42,"button",19),e.qCj("click",function(){return n.cancelDrawing()}),e.OEk(43),e.wVc(44,"translate"),e.C$Y(),e.I0R(45,"button",20),e.qCj("click",function(){return n.confirm()}),e.OEk(46,"OK"),e.C$Y()()),2&i&&(e.yG2(),e.oRS(" ",e.kDX(2,15,"igo.geo.style.styleModal"),"\n"),e.yG2(2),e.E7m("hidden",0===n.data.features.length),e.yG2(),e.E7m("formGroup",n.form),e.yG2(2),e.E7m("ngIf",!0!==n.linestringOnly),e.yG2(4),e.oRS(" ",e.kDX(11,17,"igo.geo.style.stroke")," "),e.yG2(6),e.cNF(e.kDX(17,19,"igo.geo.style.fontSize")),e.yG2(2),e.E7m("value",n.getFeatureFontSize()),e.yG2(6),e.cNF(e.kDX(25,21,"igo.geo.style.fontStyle")),e.yG2(2),e.E7m("value",n.getFeatureFontStyle()),e.yG2(2),e.E7m("ngForOf",n.allFontStyles),e.yG2(3),e.cNF(e.kDX(32,23,"igo.geo.style.offsetX")),e.yG2(2),e.E7m("value",n.getFeatureOffsetX()),e.yG2(4),e.cNF(e.kDX(38,25,"igo.geo.style.offsetY")),e.yG2(2),e.E7m("value",n.getFeatureOffsetY()),e.yG2(4),e.oRS(" ",e.kDX(44,27,"igo.geo.style.cancel")," "))},dependencies:[_t.WQ,_t.iU,xe.y,xe.sz,xe.ue,xe.u,xe.sl,xe.uW,xe.Wo,Ke.u_,dt.oB,dt.qL,be.Q9,yt.wb,yt.Up,yt.w5,yt.Gm,Bt.cN,Bt.yi,Gt.d5,Gt.kX,kt.I5,Ke.Iw,kt.Ax,_t.Yp,Ze.oJ,Ze.Gw,k._s,pe.sD],styles:["[_nghost-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{padding-top:16px}[_nghost-%COMP%]   .fill-field[_ngcontent-%COMP%], [_nghost-%COMP%]   .stroke-field[_ngcontent-%COMP%]{width:140px}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;align-items:center;grid-gap:16px;margin-bottom:16px}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}[_nghost-%COMP%]   .box[_ngcontent-%COMP%]{width:25px;height:25px}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-gap:16px}[_nghost-%COMP%]   .igo-form-input-box[_ngcontent-%COMP%]{width:150px}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}"]})}return l})(),Nr=(()=>{class l{dialogRef;confirmFlag=!1;constructor(t){this.dialogRef=t}cancelDrawing(){this.dialogRef.close()}confirm(t){this.confirmFlag=!0,this.dialogRef.close(t)}static \u0275fac=function(i){return new(i||l)(e.GI1(_t.yI))};static \u0275cmp=e.In1({type:l,selectors:[["igo-draw-popup-component"]],inputs:{confirmFlag:"confirmFlag"},standalone:!0,features:[e.UHJ],decls:14,vars:9,consts:[["mat-dialog-content",""],[1,"mat-typography"],[1,"example-full-width"],["matInput","",3,"placeholder"],["input",""],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(i,n){if(1&i){const p=e.KQA();e.I0R(0,"div",0)(1,"p",1),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"mat-form-field",2),e.wR5(5,"input",3,4),e.wVc(7,"translate"),e.C$Y()(),e.I0R(8,"div",5)(9,"button",6),e.qCj("click",function(){return n.cancelDrawing()}),e.OEk(10),e.wVc(11,"translate"),e.C$Y(),e.I0R(12,"button",7),e.qCj("click",function(){e.usT(p);const Y=e.Gew(6);return e.CGJ(n.confirm(Y.value))}),e.OEk(13," OK "),e.C$Y()()}2&i&&(e.yG2(2),e.oRS(" ",e.kDX(3,3,"igo.geo.draw.layer.layerDialogInstruction")," "),e.yG2(3),e._6D("placeholder",e.kDX(7,5,"igo.geo.draw.layer.title")),e.yG2(5),e.oRS(" ",e.kDX(11,7,"igo.geo.draw.cancel")," "))},dependencies:[_t.iU,yt.wb,yt.Up,Bt.cN,Bt.yi,_t.Yp,Ze.oJ,Ze.Gw,k._s,pe.sD],styles:["[_nghost-%COMP%]   .fields-container[_ngcontent-%COMP%]{display:flex}"]})}return l})();var Hr=r(85308);function yl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-radio-button",11),e.qCj("change",function(n){e.usT(t);const p=e.GaO(3);return e.CGJ(p.onLabelTypeChange(n.value))}),e.OEk(1),e.C$Y()}if(2&l){const t=m.$implicit,i=e.GaO(3);e.E7m("value",t.value)("disabled",i.optionAvailable(t.value))("checked",t.checked),e.yG2(),e.oRS(" ",i.getProperLengthLabel(t.value)," ")}}function _l(l,m){if(1&l&&(e.I0R(0,"mat-radio-group"),e.yuY(1,yl,2,4,"mat-radio-button",10),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(),e.E7m("ngForOf",t.arrayBuiltInType)}}function Cl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-checkbox",13),e.qCj("change",function(n){e.usT(t);const p=e.GaO(3);return e.CGJ(p.onLabelTypeChange(n.source.value,n.checked))}),e.OEk(1),e.C$Y()}if(2&l){const t=m.$implicit,i=e.GaO(3);e.E7m("value",t.value)("disabled",i.optionAvailable(t.value))("checked",t.checked),e.yG2(),e.oRS(" ",i.getProperLengthLabel(t.value)," ")}}function vl(l,m){if(1&l&&(e.SAx(0),e.yuY(1,Cl,2,4,"mat-checkbox",12),e.k70()),2&l){const t=e.GaO(2);e.yG2(),e.E7m("ngForOf",t.arrayBuiltInType)}}function Sl(l,m){if(1&l&&(e.I0R(0,"mat-option",5),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t," ")}}function bl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",14)(1,"mat-form-field",15)(2,"mat-label"),e.OEk(3,"(Latitude, Longitude)"),e.C$Y(),e.wR5(4,"input",16,17),e.C$Y(),e.I0R(6,"mat-form-field",18)(7,"mat-select",19),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.onChangeCoordinateUnit(n.value))}),e.yuY(8,Sl,2,2,"mat-option",20),e.C$Y()()()}if(2&l){const t=e.GaO(2);e.yG2(4),e._6D("value",t.currentCoordinates),e.yG2(3),e.E7m("value",t.coordinatesMeasureUnit),e.yG2(),e.E7m("ngForOf",t.allCoordinatesUnits)}}function Ol(l,m){if(1&l&&(e.I0R(0,"mat-option",5),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit,i=e.GaO(3);e.E7m("value",t),e.yG2(),e.oRS(" ",i.getLengthUnitEnum(t)," ")}}function Il(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",14)(1,"mat-form-field",15)(2,"mat-label"),e.OEk(3),e.C$Y(),e.wR5(4,"input",21,17),e.C$Y(),e.I0R(6,"mat-form-field",18)(7,"mat-select",19),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.onChangeLengthUnit(n.value))}),e.yuY(8,Ol,2,2,"mat-option",20),e.C$Y()()()}if(2&l){const t=e.GaO(2);e.yG2(3),e.cNF(t.lengthLabelT),e.yG2(),e._6D("placeholder",t.lengthLabelT),e._6D("value",t.currentLength),e.yG2(3),e.E7m("value",t.lengthMeasureUnit),e.yG2(),e.E7m("ngForOf",t.allLengthUnits)}}function wl(l,m){if(1&l&&(e.I0R(0,"mat-option",5),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit,i=e.GaO(3);e.E7m("value",t),e.yG2(),e.oRS(" ",i.getAreaUnitEnum(t)," ")}}function Tl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",14)(1,"mat-form-field",15)(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.wR5(5,"input",21,17),e.wVc(7,"translate"),e.C$Y(),e.I0R(8,"mat-form-field",18)(9,"mat-select",19),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.onChangeAreaUnit(n.value))}),e.yuY(10,wl,2,2,"mat-option",20),e.C$Y()()()}if(2&l){const t=e.GaO(2);e.yG2(3),e.cNF(e.kDX(4,5,"igo.geo.draw.labelType.Area")),e.yG2(2),e._6D("placeholder",e.kDX(7,7,"igo.geo.draw.labelType.Area")),e._6D("value",t.currentArea),e.yG2(4),e.E7m("value",t.areaMeasureUnit),e.yG2(),e.E7m("ngForOf",t.allAreaUnits)}}function El(l,m){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"div",2)(2,"div",3)(3,"mat-button-toggle-group",4),e.qCj("change",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onLabelTypeChange(n.value))}),e.I0R(4,"mat-button-toggle",5),e.OEk(5),e.wVc(6,"translate"),e.C$Y(),e.I0R(7,"mat-button-toggle",5),e.OEk(8),e.wVc(9,"translate"),e.C$Y()()(),e.I0R(10,"div")(11,"p"),e.OEk(12),e.wVc(13,"translate"),e.C$Y(),e.yuY(14,_l,2,1,"mat-radio-group",1)(15,vl,2,1,"ng-container",1)(16,bl,9,3,"div",6)(17,Il,9,5,"div",6)(18,Tl,11,9,"div",6),e.C$Y()(),e.I0R(19,"div",7)(20,"button",8),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.cancelDrawing())}),e.OEk(21),e.wVc(22,"translate"),e.C$Y(),e.I0R(23,"button",9),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.confirm())}),e.OEk(24),e.C$Y()(),e.k70()}if(2&l){const t=e.GaO();e.yG2(3),e.E7m("value",t.customOrPredefined),e.yG2(),e.E7m("value",t.labelType.Custom),e.yG2(),e.oRS(" ",e.kDX(6,13,"igo.geo.draw.labelType.custom")," "),e.yG2(2),e.E7m("value",t.labelType.Predefined),e.yG2(),e.oRS(" ",e.kDX(9,15,"igo.geo.draw.labelType.predefined")," "),e.yG2(4),e.oRS(" ",e.kDX(13,17,"igo.geo.draw.builtInInstructions")," "),e.yG2(2),e.E7m("ngIf","Polygon"!==t.olGeometryType),e.yG2(),e.E7m("ngIf","Polygon"===t.olGeometryType),e.yG2(),e.E7m("ngIf",t.labelFlag===t.labelType.Coordinates),e.yG2(),e.E7m("ngIf",t.labelFlag===t.labelType.Length||2===t.polygonCheck),e.yG2(),e.E7m("ngIf",t.labelFlag===t.labelType.Area||2===t.polygonCheck),e.yG2(3),e.oRS(" ",e.kDX(22,19,"igo.geo.draw.cancel")," "),e.yG2(3),e.oRS(" ",t.noLabelButton()," ")}}function xl(l,m){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"div",2)(2,"div",3)(3,"mat-button-toggle-group",4),e.qCj("change",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onLabelTypeChange(n.value))}),e.I0R(4,"mat-button-toggle",5),e.OEk(5),e.wVc(6,"translate"),e.C$Y(),e.I0R(7,"mat-button-toggle",5),e.OEk(8),e.wVc(9,"translate"),e.C$Y()()(),e.I0R(10,"p"),e.OEk(11),e.wVc(12,"translate"),e.C$Y(),e.I0R(13,"mat-form-field",22)(14,"mat-label"),e.OEk(15),e.wVc(16,"translate"),e.C$Y(),e.I0R(17,"input",23,17),e.qCj("select",function(){return!0})("input",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.getLabelLength(n.target.value))}),e.wVc(19,"translate"),e.C$Y()()(),e.I0R(20,"div",7)(21,"button",8),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.cancelDrawing())}),e.OEk(22),e.wVc(23,"translate"),e.C$Y(),e.I0R(24,"button",9),e.qCj("click",function(){e.usT(t);const n=e.Gew(18),p=e.GaO();return e.CGJ(p.confirm(n.value))}),e.OEk(25),e.C$Y()(),e.k70()}if(2&l){const t=e.GaO();e.yG2(3),e.E7m("value",t.customOrPredefined),e.yG2(),e.E7m("value",t.labelType.Custom),e.yG2(),e.oRS(" ",e.kDX(6,11,"igo.geo.draw.labelType.custom")," "),e.yG2(2),e.E7m("value",t.labelType.Predefined),e.yG2(),e.oRS(" ",e.kDX(9,13,"igo.geo.draw.labelType.predefined")," "),e.yG2(3),e.oRS(" ",e.kDX(12,15,"igo.geo.draw.dialogInstruction")," "),e.yG2(4),e.cNF(e.kDX(16,17,"igo.geo.draw.dialogTitle")),e.yG2(2),e._6D("placeholder",e.kDX(19,19,"igo.geo.draw.dialogTitle")),e._6D("value",t.currentLabel),e.yG2(5),e.oRS(" ",e.kDX(23,21,"igo.geo.draw.cancel")," "),e.yG2(3),e.oRS(" ",t.noLabelButton()," ")}}let Ml=(()=>{class l{languageService;dialogRef;data;confirmFlag=!1;labelFlag=bt.Custom;coordinatesMeasureUnit;lengthMeasureUnit;areaMeasureUnit;geometryType=Nt;labelType=bt;arrayBuiltInType=[];currentLabel;currentCoordinates;currentArea;currentLength;olGeometryType=void 0;lengthInMeters;areaInMetersSquare;coordinatesInDD;currentCoordinatesUnit;longlatDD;labelLength;polygonCheck=0;constructor(t,i,n){let p;this.languageService=t,this.dialogRef=i,this.data=n,this.currentLabel=this.data.olGeometry.get("draw"),this.labelLength=this.currentLabel?this.currentLabel.length:0;const v=this.data.map.ol.getView().getProjection();if(this.data.olGeometry instanceof $i.c)if(this.data.olGeometry.get("rad")){const Y=[this.data.olGeometry.get("longitude"),this.data.olGeometry.get("latitude")];this.olGeometryType=Nt.Circle,p=new K.c(Y,this.data.olGeometry.get("rad"))}else this.olGeometryType=this.data.olGeometry.getGeometry().getType(),p=this.data.olGeometry.get("geometry");else this.olGeometryType=this.data.olGeometry.getType(),p=this.data.olGeometry;if(this.olGeometryType===Nt.Point||this.olGeometryType===Nt.Circle){if(this.data.olGeometry instanceof $i.c){let Y=this.data.olGeometry.get("longitude"),ue=this.data.olGeometry.get("latitude");this.longlatDD=(0,Hr.uE)([Y,ue],5),this.coordinatesInDD="("+ue+", "+Y+")"}else{let Y=(0,V.AF)(this.data.olGeometry.getFlatCoordinates(),v,"EPSG:4326");this.longlatDD=(0,Hr.uE)([Y[0],Y[1]],5),this.coordinatesInDD="("+this.longlatDD[1]+", "+this.longlatDD[0]+")"}this.currentCoordinates=this.coordinatesInDD}if(this.olGeometryType===Nt.LineString)this.lengthInMeters=(0,To.cD)(p,v.getCode()).toFixed(2),this.currentLength=this.lengthInMeters;else if(this.olGeometryType===Nt.Polygon)this.lengthInMeters=(0,To.cD)(p,v.getCode()).toFixed(2),this.currentLength=this.lengthInMeters,this.areaInMetersSquare=(0,To.aS)(p,v.getCode()).toFixed(2),this.currentArea=this.areaInMetersSquare;else if(this.olGeometryType===Nt.Circle){let Y=(0,X.IH)(p,1e4);const ue=this.getRadius(Y);this.lengthInMeters=ue.toFixed(2),this.currentLength=this.lengthInMeters,this.areaInMetersSquare=(0,To.aS)(Y,v.getCode()).toFixed(2),this.currentArea=this.areaInMetersSquare}n.olGeometry.get("labelType")===bt.Coordinates?(this.onLabelTypeChange(bt.Predefined),this.onLabelTypeChange(bt.Coordinates,!0),this.coordinatesMeasureUnit=n.olGeometry.get("measureUnit")):n.olGeometry.get("labelType")===bt.Length?(this.onLabelTypeChange(bt.Predefined),this.onLabelTypeChange(bt.Length,!0),this.lengthMeasureUnit=n.olGeometry.get("measureUnit")):n.olGeometry.get("labelType")===bt.Area?(this.onLabelTypeChange(bt.Predefined),this.onLabelTypeChange(bt.Area,!0),this.areaMeasureUnit=n.olGeometry.get("measureUnit")):2===n.olGeometry.get("labelType")?.length&&(this.onLabelTypeChange(bt.Predefined),this.onLabelTypeChange(bt.Length,!0),this.onLabelTypeChange(bt.Area,!0),this.lengthMeasureUnit=n.olGeometry.get("measureUnit")[0],this.areaMeasureUnit=n.olGeometry.get("measureUnit")[1]),this.buildArrayType()}cancelDrawing(){this.dialogRef.close()}confirm(t){this.confirmFlag=!0,this.labelFlag===bt.Predefined?this.dialogRef.close():this.labelFlag===bt.Custom?this.dialogRef.close({label:t}):this.labelFlag===bt.Coordinates?this.dialogRef.close({label:this.currentCoordinates,measureUnit:this.coordinatesMeasureUnit}):this.olGeometryType===Nt.Polygon?2===this.polygonCheck?(this.labelFlag=[bt.Length,bt.Area],this.dialogRef.close({label:"P: "+this.currentLength+" "+ft.Ks[ft.K8.Meters]+"\n"+this.languageService.translate.instant("igo.geo.draw.labelType.A")+this.currentArea+" "+ft.kK[ft.Mh.SquareMeters],measureUnit:[this.lengthMeasureUnit,this.areaMeasureUnit]})):this.dialogRef.close(this.labelFlag===bt.Length?{label:"P: "+this.currentLength+" "+ft.Ks[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}:{label:this.currentArea+" "+ft.kK[this.areaMeasureUnit],measureUnit:this.areaMeasureUnit}):this.labelFlag===bt.Length?this.olGeometryType===Nt.Circle?this.dialogRef.close({label:"R: "+this.currentLength+" "+ft.Ks[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}):this.olGeometryType===Nt.LineString&&this.dialogRef.close({label:this.currentLength+" "+ft.Ks[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}):this.labelFlag===bt.Area&&this.dialogRef.close({label:this.currentArea+" "+ft.kK[this.areaMeasureUnit],measureUnit:this.areaMeasureUnit})}onLabelTypeChange(t,i){t!==bt.Predefined&&t!==bt.Custom&&this.olGeometryType===Nt.Polygon?(this.arrayBuiltInType.find(p=>p.value===t)?this.arrayBuiltInType.find(p=>p.value===t).checked=i:this.labelFlag=void 0,this.labelFlag=i?t:this.arrayBuiltInType.find(p=>p.checked)?.value):this.labelFlag=t,t===bt.Predefined?this.olGeometryType===Nt.Point?(this.labelFlag=bt.Coordinates,this.currentCoordinates=this.coordinatesInDD,this.coordinatesMeasureUnit=qi.DecimalDegree):this.olGeometryType===Nt.LineString&&(this.labelFlag=bt.Length,this.currentLength=this.lengthInMeters,this.lengthMeasureUnit=ft.K8.Meters):t===bt.Area?(this.currentArea=this.areaInMetersSquare,this.areaMeasureUnit=ft.Mh.SquareMeters):t===bt.Length?(this.currentLength=this.lengthInMeters,this.lengthMeasureUnit=ft.K8.Meters):this.labelFlag===bt.Coordinates&&(this.currentCoordinates=this.coordinatesInDD,this.coordinatesMeasureUnit=qi.DecimalDegree),this.olGeometryType===Nt.Polygon&&[this.labelType.Length,this.labelType.Area].includes(t)?i?this.polygonCheck+=1:this.polygonCheck-=1:this.polygonCheck=0}onChangeLengthUnit(t){this.lengthMeasureUnit=t,this.currentLength=(0,To.iK)(Number(this.lengthInMeters),t).toFixed(2)}onChangeAreaUnit(t){this.areaMeasureUnit=t,this.currentArea=(0,To.Ej)(Number(this.areaInMetersSquare),t).toFixed(2)}onChangeCoordinateUnit(t){this.coordinatesMeasureUnit=t;let i=vr(this.longlatDD,t);this.currentCoordinates="("+i[1]+", "+i[0]+")"}buildArrayType(){for(const t of Object.values(bt))t!==bt.Custom&&t!==bt.Predefined&&this.arrayBuiltInType.push({value:t,checked:this.selectOptions(t)||this.labelFlag===t||2===this.polygonCheck&&t!==bt.Coordinates})}noLabelButton(){return this.labelFlag===bt.Predefined||this.labelFlag===bt.Custom&&0===this.labelLength?this.languageService.translate.instant("igo.geo.draw.noLabel"):"OK"}get customOrPredefined(){return this.labelFlag===bt.Custom?bt.Custom:bt.Predefined}optionAvailable(t){switch(this.olGeometryType){case Nt.Point:return t!==bt.Coordinates;case Nt.LineString:return t!==bt.Length;case Nt.Polygon:return t===bt.Coordinates;default:return!1}}get allLengthUnits(){return Object.values(ft.K8)}getLengthUnitEnum(t){return ft.Ks[t]}get allAreaUnits(){return Object.values(ft.Mh)}get allCoordinatesUnits(){return Object.values(qi)}getAreaUnitEnum(t){return ft.kK[t]}getRadius(t){const i=(0,u.S2)(t);return Number(i/(2*Math.PI))}get lengthLabelT(){return this.languageService.translate.instant(this.olGeometryType===Nt.Polygon?"igo.geo.measure.perimeter":this.olGeometryType===Nt.Circle?"igo.geo.search.coordinates.radius":"igo.geo.draw.labelType.Length")}getLabelLength(t){this.labelLength=t.length}selectOptions(t){return this.olGeometryType===Nt.Point?t===bt.Coordinates:this.olGeometryType===Nt.LineString?t===bt.Length:void 0}getProperLengthLabel(t){return this.languageService.translate.instant(t===bt.Length?this.olGeometryType===Nt.Polygon?"igo.geo.measure.perimeter":this.olGeometryType===Nt.Circle?"igo.geo.search.coordinates.radius":"igo.geo.draw.labelType.Length":"igo.geo.draw.labelType."+t)}static \u0275fac=function(i){return new(i||l)(e.GI1(k.ov),e.GI1(_t.yI),e.GI1(_t.sR))};static \u0275cmp=e.In1({type:l,selectors:[["igo-draw-popup-component"]],inputs:{confirmFlag:"confirmFlag",labelFlag:"labelFlag",coordinatesMeasureUnit:"coordinatesMeasureUnit",lengthMeasureUnit:"lengthMeasureUnit",areaMeasureUnit:"areaMeasureUnit"},standalone:!0,features:[e.UHJ],decls:5,vars:5,consts:[["mat-dialog-title",""],[4,"ngIf"],["mat-dialog-content","",1,"geometry-type-toggle"],[1,"button-toggle-container"],[3,"value","change"],[3,"value"],["class","fields-container",4,"ngIf"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[3,"value","disabled","checked","change",4,"ngFor","ngForOf"],[3,"value","disabled","checked","change"],["class","mat-typography",3,"value","disabled","checked","change",4,"ngFor","ngForOf"],[1,"mat-typography",3,"value","disabled","checked","change"],[1,"fields-container"],[1,"readOnly-Input"],["matInput","","placeholder","(Latitude, Longitude)","readonly","",3,"value"],["input",""],[1,"unit-field"],[3,"value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","readonly","",3,"placeholder","value"],[1,"input"],["matInput","","cdkFocusInitial","",3,"placeholder","value","select","input"]],template:function(i,n){1&i&&(e.I0R(0,"h2",0),e.OEk(1),e.wVc(2,"translate"),e.C$Y(),e.yuY(3,El,25,21,"ng-container",1)(4,xl,26,23,"ng-container",1)),2&i&&(e.yG2(),e.oRS(" ",e.kDX(2,3,"igo.geo.draw.popupTitle"),"\n"),e.yG2(2),e.E7m("ngIf",n.labelFlag!==n.labelType.Custom),e.yG2(),e.E7m("ngIf",n.labelFlag===n.labelType.Custom))},dependencies:[_t.WQ,Ke.u_,_t.iU,io.ue,io.gn,io.KU,Po.yk,Po.cv,Po.cT,Ke.Iw,$t.Vn,$t.WK,yt.wb,yt.Up,yt.w5,Bt.cN,Bt.yi,Gt.d5,Gt.kX,kt.I5,kt.Ax,_t.Yp,Ze.oJ,Ze.Gw,k._s,pe.sD],styles:["[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%] ~ .mat-radio-button[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .readOnly-Input[_ngcontent-%COMP%]{width:200px!important}[_nghost-%COMP%]   .button-toggle-container[_ngcontent-%COMP%]{margin-bottom:12px}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]     .mat-mdc-form-field-infix{width:-moz-fit-content;width:fit-content}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]     .mat-mdc-select-min-line{padding-right:24px}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{position:sticky!important}[_nghost-%COMP%]   .coordinatesInputView[_ngcontent-%COMP%]{top:5em!important}[_nghost-%COMP%]   .mat-mdc-dialog-actions[_ngcontent-%COMP%]{display:flex!important;justify-content:flex-end}[_nghost-%COMP%]   .input[_ngcontent-%COMP%]{width:auto!important}[_nghost-%COMP%]   .mat-button-toggle-group[_ngcontent-%COMP%], [_nghost-%COMP%]   .mat-button-toggle[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin-right:10px}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}"]})}return l})(),Dl=(()=>{class l{svgIcon=be.Cg;static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-draw-shorcuts"]],standalone:!0,features:[e.UHJ],decls:27,vars:13,consts:[[1,"shortcut","mat-typography"],[1,"shortcut-icon"],[3,"icon"],[1,"shortcuts-close"],["mat-raised-button","","mat-dialog-close","","color","primary"]],template:function(i,n){1&i&&(e.I0R(0,"mat-dialog-content")(1,"div")(2,"span",0)(3,"mat-icon",1),e.OEk(4,"keyboard_return"),e.C$Y(),e.OEk(5),e.wVc(6,"translate"),e.C$Y()(),e.I0R(7,"div")(8,"span",0)(9,"mat-icon",1),e.OEk(10,"keyboard_backspace"),e.C$Y(),e.OEk(11),e.wVc(12,"translate"),e.C$Y()(),e.I0R(13,"div")(14,"span",0),e.wR5(15,"igo-icon",2),e.OEk(16),e.wVc(17,"translate"),e.C$Y()(),e.I0R(18,"div")(19,"span",0)(20,"mat-icon",1),e.OEk(21,"space_bar"),e.C$Y(),e.OEk(22),e.wVc(23,"translate"),e.C$Y()()(),e.I0R(24,"mat-dialog-actions",3)(25,"button",4),e.OEk(26,"OK"),e.C$Y()()),2&i&&(e.yG2(5),e.cNF(e.kDX(6,5,"igo.geo.draw.finish")),e.yG2(6),e.cNF(e.kDX(12,7,"igo.geo.draw.undo")),e.yG2(4),e.E7m("icon",n.svgIcon),e.yG2(),e.oRS(" ",e.kDX(17,9,"igo.geo.draw.abort")," "),e.yG2(6),e.cNF(e.kDX(23,11,"igo.geo.draw.move")))},dependencies:[_t.iU,dt.oB,dt.qL,_t.Yp,Ze.oJ,Ze.Gw,_t.qq,k._s,pe.sD,be.S],styles:[".shortcut[_ngcontent-%COMP%]{display:flex;align-items:center}.shortcut-icon[_ngcontent-%COMP%]{margin-right:10px}.shortcuts-close[_ngcontent-%COMP%]{display:flex;justify-content:center}"]})}return l})();const Pl=["selectedLayer"];function Fl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",5),e.qCj("change",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onToggleFreehandMode(n))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("checked",t.freehandMode)("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(2,3,"igo.geo.draw.freehandMode")," ")}}function Rl(l,m){if(1&l&&(e.I0R(0,"mat-option",2),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.measure."+t)," ")}}function Ll(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",24)(1,"mat-form-field",25),e.wR5(2,"input",26),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"mat-form-field",27)(5,"mat-select",10),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onMeasureUnitChange(n.value))}),e.yuY(6,Rl,3,4,"mat-option",12),e.C$Y()()()}if(2&l){const t=e.GaO();e.yG2(2),e._6D("placeholder",e.kDX(3,5,"igo.geo.spatialFilter.radius")),e.E7m("formControl",t.radiusFormControl)("readonly",t.freehandMode),e.yG2(3),e.E7m("value",t.measureUnit),e.yG2(),e.E7m("ngForOf",t.measureUnits)}}function Gl(l,m){if(1&l&&(e.I0R(0,"mat-option",2),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t.title," ")}}function $l(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",28),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.activeDrawingLayer.visible=!n.activeDrawingLayer.visible)}),e.wVc(1,"translate"),e.wVc(2,"translate"),e.I0R(3,"mat-icon"),e.OEk(4),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("color",t.activeDrawingLayer.visible?"primary":"default")("matTooltip",t.activeDrawingLayer.visible?e.kDX(1,3,"igo.geo.layer.hideLayer"):e.kDX(2,5,"igo.geo.layer.showLayer")),e.yG2(4),e.oRS(" ",t.activeDrawingLayer.visible?"visibility":"visibility_off"," ")}}function kl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",29),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.deleteDrawings())}),e.wVc(1,"translate"),e.wVc(2,"async"),e.I0R(3,"mat-icon"),e.OEk(4,"delete"),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.draw.delete"))("disabled",0===e.kDX(2,4,t.selectedFeatures$).length)}}function Al(l,m){if(1&l&&(e.I0R(0,"div",33),e.wR5(1,"img",34),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(),e._6D("src",t.icon,e.K6U)}}function Bl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-option",35),e.qCj("click",function(){const p=e.usT(t).$implicit,v=e.GaO(2);return e.CGJ(v.onIconChange(p))}),e.I0R(1,"div",33),e.wR5(2,"img",34),e.C$Y()()}if(2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(2),e._6D("src",t,e.K6U)}}function Ul(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field")(1,"mat-label"),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"mat-select")(5,"mat-select-trigger"),e.yuY(6,Al,2,1,"div",30),e.C$Y(),e.I0R(7,"mat-option",31),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.onIconChange())}),e.OEk(8),e.wVc(9,"translate"),e.C$Y(),e.yuY(10,Bl,3,2,"mat-option",32),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(2),e.cNF(e.kDX(3,4,"igo.geo.draw.icon")),e.yG2(4),e.E7m("ngIf",t.icon),e.yG2(2),e.cNF(e.kDX(9,6,"igo.geo.draw.noIcon")),e.yG2(2),e.E7m("ngForOf",t.icons)}}function Yl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",36),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.openStyleModalDialog())}),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.I0R(4,"mat-icon",37),e.OEk(5,"palette "),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,3,"igo.geo.style.styleModalTooltipSelected")),e.yG2(2),e.oRS(" ",e.kDX(3,5,"igo.geo.style.styleModal")," "),e.yG2(2),e.E7m("matBadge",t.selectedFeatures$.value.length)}}let Vl=(()=>{class l{languageService;formBuilder;drawStyleService;dialog;drawIconService;tableTemplate;geometryType=Nt;map;get stores(){return this._stores}set stores(t){this._stores=t}_stores=[];get drawControls(){return this._drawControls}set drawControls(t){this._drawControls=t}_drawControls=[];get activeDrawingLayer(){return this._activeDrawingLayer}set activeDrawingLayer(t){this._activeDrawingLayer=t}_activeDrawingLayer;activeLayerChange=new e._w7;drawControlsEvent=new e._w7;layersIDEvent=new e._w7;fillColor;strokeColor;strokeWidth;fontSize;fontStyle;activeStore;layerCounterID=0;draw$=new B.g({});activeDrawingLayerSource=new j.c;activeDrawControl;drawEnd$$;drawSelect$$;selectedFeatures$=new B.g([]);fillForm;strokeForm;drawControlIsDisabled=!0;drawControlIsActive=!1;labelsAreShown;freehandMode=!1;subscriptions$$=[];position="bottom";form;icons;icon;radiusFormControl=new xe.yM(1e3);measureUnit=ft.K8.Meters;radiusFormControlChange$$=new S.wH;predefinedRadius$=new B.g(void 0);radiusDrawEnd$=new B.g(void 0);get measureUnits(){return[ft.K8.Meters,ft.K8.Kilometers]}numberOfDrawings;isCreatingNewLayer=!1;currGeometryType=this.geometryType.Point;select;constructor(t,i,n,p,v){this.languageService=t,this.formBuilder=i,this.drawStyleService=n,this.dialog=p,this.drawIconService=v,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,fixedHeader:!0,tableHeight:"auto",columns:[{name:"Drawing",title:this.languageService.translate.instant("igo.geo.draw.labels"),valueAccessor:Y=>Y.properties.draw},{name:"Edition",title:"",sort:!1,valueAccessor:Y=>[{editMode:!1,icon:"edit",color:"primary",click:()=>{this.editLabelDrawing(Y)},style:"mat-icon-button"}],renderer:be.G8.ButtonGroup}]},this.buildForm(),this.fillColor=this.drawStyleService.getFillColor(),this.strokeColor=this.drawStyleService.getStrokeColor(),this.strokeWidth=this.drawStyleService.getStrokeWidth(),this.labelsAreShown=this.drawStyleService.getLabelsAreShown(),this.icons=this.drawIconService.getIcons(),this.icon=this.drawStyleService.getIcon(),this.fontSize=this.drawStyleService.getFontSize(),this.fontStyle=this.drawStyleService.getFontStyle()}ngOnInit(){this.stores.length?(this.activeStore=this.stores.find(t=>t.layer.id===this.activeDrawingLayer.id),this.activeDrawControl=this.drawControls.find(t=>t[0]===this.activeDrawingLayer.id)[1],this.deactivateDrawControl(),this.allLayers.forEach(t=>{t.id!==this.activeDrawingLayer.id&&(t.opacity=0);let i=this.stores.find(n=>n.layer.id===t.id);this.subscriptions$$.push(i.stateView.manyBy$(n=>!0===n.state.selected).pipe((0,$.K)()).subscribe(n=>{n.forEach(p=>{p.state.selected=!1})})),this.subscriptions$$.push(i.stateView.manyBy$(n=>!0===n.state.selected).pipe((0,re.s)(1)).subscribe(n=>{this.selectedFeatures$.next(n.map(p=>p.entity))})),this.subscriptions$$.push(i.count$.subscribe(n=>{this.activeStore.layer.options.showInLayerList=n>=1}))}),this.onLayerChange(this.activeDrawingLayer)):(this.activeStore=new Be.ym([],{map:this.map}),this.initStore(),this.activeDrawControl=this.createDrawControl(this.fillColor,this.strokeColor,this.strokeWidth),this.activeDrawControl.setGeometryType(this.geometryType.Point),this.toggleDrawControl(),this.stores.push(this.activeStore),this.drawControls.push([this.activeDrawingLayer.id,this.activeDrawControl]),this.drawControlsEvent.emit(this.drawControls),this.layersIDEvent.emit(this.activeDrawingLayer.id),this.onLayerChange(this.activeDrawingLayer)),this.radiusFormControlChange$$=this.radiusFormControl.valueChanges.subscribe(t=>{this.activeDrawControl.ispredefinedRadius$.getValue()&&this.changeRadius(t)})}ngOnDestroy(){this.allLayers.forEach(t=>t.opacity=1),this.activeStore.state.updateAll({selected:!1}),this.deactivateDrawControl(),this.subscriptions$$.map(t=>t.unsubscribe()),this.radiusFormControlChange$$.unsubscribe()}createDrawControl(t,i,n){return new Ct.i({geometryType:void 0,drawingLayerSource:this.activeDrawingLayerSource,drawingLayerStyle:new $o.cp({}),interactionStyle:ur(t,i,n)})}initStore(t,i){this.createLayer(t,i),this.subscriptions$$.push(this.activeStore.stateView.manyBy$(n=>!0===n.state.selected).pipe((0,re.s)(1)).subscribe(n=>{this.selectedFeatures$.next(n.map(p=>p.entity))})),this.subscriptions$$.push(this.activeStore.count$.subscribe(n=>{this.activeStore.layer.options.showInLayerList=n>=1}))}openStyleModalDialog(){setTimeout(()=>{const t=this.dialog.open(dr,{disableClose:!1,data:{features:this.selectedFeatures$.getValue(),icons:this.icons,icon:this.icon},autoFocus:!1});t.afterClosed().subscribe(i=>{t.componentInstance.confirmFlag&&(this.onFontChange(this.labelsAreShown,i.fontSize,i.fontStyle),this.onColorChange(this.labelsAreShown,!!this.icon,i.fillColor,i.strokeColor),this.onOffsetLabelChange(this.labelsAreShown,i.offsetX,i.offsetY))})},250)}openDrawDialog(t,i){setTimeout(()=>{const n=this.dialog.open(Ml,{disableClose:!1,data:{olGeometry:t,map:this.map}});n.afterClosed().subscribe(p=>{n.componentInstance.confirmFlag?(this.updateLabelOfOlGeometry(t,p.label),this.updateLabelType(t,n.componentInstance.labelFlag),this.updateMeasureUnit(t,p.measureUnit),t instanceof $i.c||(this.updateFontSizeAndStyle(t,"15",Pt.Arial),this.updateFillAndStrokeColor(t,"rgba(255,255,255,0.4)","rgba(143,7,7,1)"),this.updateOffset(t,0,t instanceof J.c?-15:0)),i?this.onDrawEnd(t):this.onSelectDraw(t,p.label,[n.componentInstance.labelFlag,p.measureUnit]),this.updateHeightTable()):this.activeDrawingLayerSource.getFeatures().forEach(v=>{const Y=v.getGeometry();t===Y&&this.activeDrawingLayerSource.removeFeature(v)})})},250)}onDrawEnd(t,i){this.addFeatureToStore(t,i),this.clearLabelsOfOlGeometry(t),this.activeStore.layer.ol.getSource().refresh()}onModifyDraw(t){this.activeStore.all().forEach(n=>{if(n.properties.id===t.ol_uid){if(n.properties.labelType===bt.Coordinates){let Y=vr([n.properties.longitude,n.properties.latitude],n.properties.measureUnit);this.updateLabelOfOlGeometry(t,"("+Y[1]+", "+Y[0]+")")}else if(n.properties.labelType===bt.Length)if(t instanceof K.c){let Y=(0,X.IH)(t,1e4);const ue=(0,To.iK)(this.getRadius(Y),n.properties.measureUnit),ye=ft.Ks[n.properties.measureUnit],Ee="R: "+ue.toFixed(2).toString()+" "+ye;this.updateLabelOfOlGeometry(t,Ee)}else{let ue,Y=(0,To.cD)(t,this.map.ol.getView().getProjection().getCode());ue=ft.Ks[n.properties.measureUnit],Y=(0,To.iK)(Y,n.properties.measureUnit);let Ee=t instanceof X.cp?"P: "+Y.toFixed(2).toString()+" "+ue:Y.toFixed(2).toString()+" "+ue;this.updateLabelOfOlGeometry(t,Ee)}else if(n.properties.labelType===bt.Area)if(t instanceof K.c){let Y=(0,X.IH)(t,1e4),ue=(0,To.aS)(Y,this.map.ol.getView().getProjection().getCode());const ye=ft.kK[n.properties.measureUnit];ue=(0,To.Ej)(ue,n.properties.measureUnit);const we=ue.toFixed(2).toString()+" "+ye;this.updateLabelOfOlGeometry(t,we)}else{let ue,Y=(0,To.aS)(t,this.map.ol.getView().getProjection().getCode());ue=ft.kK[n.properties.measureUnit],Y=(0,To.Ej)(Y,n.properties.measureUnit);const Ee=Y.toFixed(2).toString()+" "+ue;this.updateLabelOfOlGeometry(t,Ee)}else this.updateLabelOfOlGeometry(t,n.properties.draw);this.updateLabelType(t,n.properties.labelType),this.updateMeasureUnit(t,n.properties.measureUnit),this.updateFontSizeAndStyle(t,n.properties.fontStyle.split(" ")[0].replace("px",""),n.properties.fontStyle.substring(n.properties.fontStyle.indexOf(" ")+1)),this.updateFillAndStrokeColor(t,n.properties.drawingStyle.fill,n.properties.drawingStyle.stroke),this.updateOffset(t,n.properties.offsetX,n.properties.offsetY),this.replaceFeatureInStore(n,t)}})}onSelectDraw(t,i,n){const p=this.activeStore.all(),v=t.getGeometry();v.ol_uid=t.get("id");const Y=JSON.stringify(v.getCoordinates()[0]);p.forEach(ue=>{const ye=JSON.stringify(ue.geometry.coordinates[0]);if(Y===ye){const Ee=t.get("fontStyle").split(" ")[0].replace("px",""),we=t.get("fontStyle").substring(t.get("fontStyle").indexOf(" ")+1),Le=t.get("drawingStyle").fill,Xe=t.get("drawingStyle").stroke,Ge=t.get("offsetX"),tt=t.get("offsetY"),pt=ue.properties.rad?ue.properties.rad:void 0;this.updateLabelOfOlGeometry(v,i),this.updateFontSizeAndStyle(v,Ee,we),this.updateFillAndStrokeColor(v,Le,Xe),this.updateOffset(v,Ge,tt),this.updateLabelType(v,n[0]),this.updateMeasureUnit(v,n[1]),this.replaceFeatureInStore(ue,v,pt)}})}addFeatureToStore(t,i,n){let p,v,Y,ue,ye;const Ee=n?n.properties.id:t.ol_uid,we=this.map.ol.getView().getProjection(),Le=(new Z.c).writeGeometryObject(t,{featureProjection:we,dataProjection:we});if(t instanceof K.c||i)if(i)p=i;else{Le.type="Point",Le.coordinates=t.getCenter();const Xe=(0,V.AF)([t.getFlatCoordinates()[2],t.getFlatCoordinates()[3]],we,"EPSG:4326");v=(0,V.AF)([t.getFlatCoordinates()[0],t.getFlatCoordinates()[1]],we,"EPSG:4326"),ue=v[0],ye=v[1],p=(0,u.c$)(v,Xe),this.radiusFormControl.setValue(Math.round(p))}this.activeDrawControl.radiusDrawEnd$.getValue()&&(p=this.activeDrawControl.radiusDrawEnd$.getValue()),t instanceof J.c&&(Y=(0,V.AF)(t.getFlatCoordinates(),we,"EPSG:4326"),ue=Y[0],ye=Y[1]),this.activeStore.update({type:Be.Yf,geometry:Le,projection:we.getCode(),properties:{id:Ee,draw:t.get("_label"),longitude:ue||null,latitude:ye||null,rad:p||null,fontStyle:t.get("fontStyle_"),drawingStyle:{fill:t.get("fillColor_"),stroke:t.get("strokeColor_")},offsetX:t.get("offsetX_"),offsetY:t.get("offsetY_"),labelType:t.get("labelType_"),measureUnit:t.get("measureUnit_")},meta:{id:Ee}}),this.activeStore.setLayerExtent(),this.activeDrawControl.predefinedRadius$.next(void 0),this.activeDrawControl.radiusDrawEnd$.next(void 0)}buildForm(){this.form=this.formBuilder.group({fill:[""],stroke:[""]})}setupLayer(t){setTimeout(()=>{const i=this.dialog.open(Nr,{disableClose:!1});i.afterClosed().subscribe(n=>{i.componentInstance.confirmFlag?(this.activeStore.state.updateAll({selected:!1}),this.activeStore=new Be.ym([],{map:this.map}),this.activeDrawingLayerSource=new j.c,this.activeDrawingLayer.opacity=0,this.deactivateDrawControl(),this.initStore(n,t),this.activeDrawControl=this.createDrawControl(this.fillColor,this.strokeColor,this.strokeWidth),this.activeDrawControl.setGeometryType(this.currGeometryType),this.toggleDrawControl(),this.stores.push(this.activeStore),this.drawControls.push([this.activeDrawingLayer.id,this.activeDrawControl]),this.drawControlsEvent.emit(this.drawControls),this.layersIDEvent.emit(this.activeDrawingLayer.id),this.isCreatingNewLayer=!1,this.labelsAreShown||this.onToggleLabels(),this.activeLayerChange.emit(this.activeDrawingLayer)):(this.select.value=this.activeDrawingLayer,this.select.selectionChange.emit(this.activeDrawingLayer))})},250)}editLabelDrawing(t){const i=(0,Be.K6)(t,this.map.ol.getView().getProjection().getCode());this.openDrawDialog(i,!1)}openShorcutsDialog(){this.dialog.open(Dl)}deleteDrawings(){this.activeStore.deleteMany(this.selectedFeatures$.value),this.selectedFeatures$.value.forEach(t=>{this.activeDrawingLayerSource.getFeatures().forEach(i=>{const n=i.getGeometry();t.properties.id===n.ol_uid&&this.activeDrawingLayerSource.removeFeature(i)})}),this.updateHeightTable(),this.activeStore.setLayerExtent()}onToggleLabels(){this.drawStyleService.toggleLabelsAreShown(),this.labelsAreShown=!this.labelsAreShown,this.elementStyle(this.labelsAreShown,!!this.icon),this.createDrawControl()}onToggleDrawControl(t){t?this.toggleDrawControl():this.deactivateDrawControl()}onToggleFreehandMode(t){this.isCircle()&&!t.checked?(this.activeDrawControl.ispredefinedRadius$.next(!0),this.changeRadius(this.radiusFormControl.value)):(this.activeDrawControl.setOlInteractionStyle(ur(this.fillColor,this.strokeColor,this.strokeWidth)),this.activeDrawControl.ispredefinedRadius$.next(!1)),this.freehandMode=t.checked,this.activeDrawControl.freehand$.next(t.checked),this.toggleDrawControl()}onLayerChange(t){t?(this.activeStore.state.updateAll({selected:!1}),this.isCreatingNewLayer=!1,this.activeDrawingLayer.opacity=0,this.activeDrawingLayer=t,this.activeDrawingLayer.opacity=1,this.deactivateDrawControl(),this.labelsAreShown||this.onToggleLabels(),this.activeStore=this.stores.find(i=>i.layer.id===this.activeDrawingLayer.id),this.activeDrawControl=this.drawControls.find(i=>i[0]===this.activeDrawingLayer.id)[1],this.activeDrawingLayerSource=this.activeDrawControl.olDrawingLayerSource,this.activeDrawControl.setGeometryType(this.currGeometryType),this.toggleDrawControl()):this.setupLayer(!0),this.activeLayerChange.emit(this.activeDrawingLayer)}createLayer(t,i){for(const n of this.allLayers){let p=Number(n.id.replace("igo-draw-layer",""));this.layerCounterID=Math.max(p,this.layerCounterID)}this.activeDrawingLayer=new vt.M({isIgoInternalLayer:!0,id:"igo-draw-layer"+ ++this.layerCounterID,title:i?t:this.languageService.translate.instant("igo.geo.draw.drawing"),zIndex:200,source:new ve.E,style:(n,p)=>this.drawStyleService.createIndividualElementStyle(n,p,this.labelsAreShown,n.get("fontStyle"),n.get("drawingStyle").fill,n.get("drawingStyle").stroke,n.get("offsetX"),n.get("offsetY"),this.map.projection,this.icon),showInLayerList:!0,exportable:!0,browsable:!1,workspace:{enabled:!1}}),(0,rt.m)(this.activeStore,this.activeDrawingLayer),(0,Be.sf)(this.activeStore,new Be.E9({motion:Be.Su.None})),(0,Be.Uz)(this.activeStore,new Be.kj({map:this.map,motion:Be.Su.None,many:!0})),this.activeStore.layer.visible=!0,this.activeStore.source.ol.on("removefeature",n=>{const p=n.feature.getGeometry();this.clearLabelsOfOlGeometry(p)})}onColorChange(t,i,n,p){this.selectedFeatures$.value.length>0&&!i&&this.selectedFeatures$.value.forEach(v=>{let Y=(0,Be.K6)(v,this.map.ol.getView().getProjection().getCode());this.updateFillAndStrokeColor(Y,n,p);const ue=this.activeStore.all().find(ye=>ye.meta.id===Y.getId());ue.properties.drawingStyle.fill=Y.get("fillColor_"),ue.properties.drawingStyle.stroke=Y.get("strokeColor_"),this.activeStore.update(ue)}),this.elementStyle(t,i),this.createDrawControl()}onFontChange(t,i,n){this.selectedFeatures$.value.length>0&&(this.selectedFeatures$.value.forEach(p=>{let v=(0,Be.K6)(p,this.map.ol.getView().getProjection().getCode());this.updateFontSizeAndStyle(v,i,n);const Y=this.activeStore.all().find(ue=>ue.meta.id===v.getId());Y.properties.fontStyle=v.get("fontStyle_"),this.activeStore.update(Y),v=this.activeStore.layer.ol.getSource().getFeatures().find(ue=>ue.getId()===Y.meta.id),v.setProperties({fontStyle:Y.properties.fontStyle}),v.changed()}),this.fontSize=i,this.fontStyle=n,this.drawStyleService.setFontSize(i),this.drawStyleService.setFontStyle(n),this.elementStyle(t))}onOffsetLabelChange(t,i,n){this.selectedFeatures$.value.length>0&&(this.selectedFeatures$.value.forEach(p=>{let v=(0,Be.K6)(p,this.map.ol.getView().getProjection().getCode());this.updateOffset(v,i,n);const Y=this.activeStore.all().find(ue=>ue.meta.id===v.getId());Y.properties.offsetX=v.get("offsetX_"),Y.properties.offsetY=v.get("offsetY_"),this.activeStore.update(Y),v=this.activeStore.layer.ol.getSource().getFeatures().find(ue=>ue.getId()===Y.meta.id),v.setProperties({offsetX:Y.properties.offsetX,offsetY:Y.properties.offsetY}),v.changed()}),this.elementStyle(t))}onIconChange(t){this.icon=t,this.drawStyleService.setIcon(this.icon),this.elementStyle(!0,this.icon)}onGeometryTypeChange(t){this.currGeometryType=t,this.activeDrawControl.setGeometryType(t),this.onToggleFreehandMode(this.freehandMode?{checked:!0}:{checked:!1}),this.toggleDrawControl()}updateLabelOfOlGeometry(t,i){t.setProperties({_label:i},!0)}updateFontSizeAndStyle(t,i,n){t.setProperties({fontStyle_:`${i}px ${n}`},!0)}updateFillAndStrokeColor(t,i,n){t.setProperties({fillColor_:i,strokeColor_:n},!0)}updateOffset(t,i,n){t.setProperties({offsetX_:i,offsetY_:n},!0)}updateLabelType(t,i){t.setProperties({labelType_:i},!0)}updateMeasureUnit(t,i){t.setProperties({measureUnit_:i},!0)}getFeatureFontSize(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.fontStyle.split(" ")[0].replace("px",""):"15"}getFeatureFontStyle(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.fontStyle.substring(this.selectedFeatures$.value[0].properties.fontStyle.indexOf(" ")+1):Pt.Arial}getFeatureFillColor(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)"}getFeatureStrokeColor(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)"}getFeatureOffsetX(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.offsetX:this.drawStyleService.getOffsetX()}getFeatureOffsetY(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.offsetY:"0"}get allFontStyles(){return Object.values(Pt)}get allLayers(){return this.map.layers.filter(t=>String(t.id).includes("igo-draw-layer"))}updateHeightTable(){this.numberOfDrawings=this.activeStore.count$.getValue(),this.tableTemplate.tableHeight=this.numberOfDrawings>10?"35vh":"auto"}updateActiveLayer(){return this.allLayers.find(i=>i.title===this.activeDrawingLayer.title)||this.allLayers[0]}toggleDrawControl(){this.deactivateDrawControl(),this.activateDrawControl()}clearLabelsOfOlGeometry(t){(0,To.aK)(t).forEach(i=>{i&&i.getMap()&&this.map.ol.removeOverlay(i)})}replaceFeatureInStore(t,i,n){this.activeStore.delete(t),this.onDrawEnd(i,n)}deactivateDrawControl(){this.activeDrawControl&&(this.drawEnd$$&&this.drawEnd$$.unsubscribe(),this.activeDrawControl.setOlMap(void 0),this.drawControlIsActive=!1)}activateDrawControl(){this.drawControlIsDisabled=!1,this.drawControlIsActive=!0,this.drawEnd$$=this.activeDrawControl.end$.subscribe(t=>{this.openDrawDialog(t,!0)}),this.activeDrawControl.modify$.subscribe(t=>{this.onModifyDraw(t)}),this.drawSelect$$||(this.drawSelect$$=this.activeDrawControl.select$.subscribe(t=>{this.openDrawDialog(t,!1)})),this.activeDrawControl.setOlMap(this.map.ol,!0)}isPoint(){return this.activeDrawControl.getGeometryType()===this.geometryType.Point}isLineString(){return this.activeDrawControl.getGeometryType()===this.geometryType.LineString}isPolygon(){return this.activeDrawControl.getGeometryType()===this.geometryType.Polygon}isCircle(){return this.activeDrawControl.getGeometryType()===this.geometryType.Circle}changeRadius(t){let i;i=t?this.measureUnit===ft.K8.Meters?t:1e3*t:void 0,this.activeDrawControl.setOlInteractionStyle((p,v)=>{const Y=p.getGeometry(),ue=V.AF(Y.getCoordinates(),this.map.projection,"EPSG:4326"),ye=i/Math.cos(Math.PI/180*ue[1])/v;return this.activeDrawControl.predefinedRadius$.next(i),new $o.cp({image:new Gi.c({radius:ye,stroke:new yo.c({width:1,color:"rgba(143,7,7,1)"}),fill:new _o.c({color:"rgba(255,255,255,0.4)"})})})}),this.toggleDrawControl()}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.radiusFormControl.setValue(this.measureUnit===ft.K8.Meters?1e3*this.radiusFormControl.value:this.radiusFormControl.value/1e3))}elementStyle(t,i){this.activeStore.layer.ol.setStyle(i?(n,p)=>this.drawStyleService.createIndividualElementStyle(n,p,t,n.get("fontStyle"),n.get("drawingStyle").fill,n.get("drawingStyle").stroke,n.get("offsetX"),n.get("offsetY"),this.map.projection,this.icon):(n,p)=>this.drawStyleService.createIndividualElementStyle(n,p,t,n.get("fontStyle"),n.get("drawingStyle").fill,n.get("drawingStyle").stroke,n.get("offsetX"),n.get("offsetY"),this.map.projection))}getRadius(t){const i=(0,u.S2)(t);return Number(i/(2*Math.PI))}static \u0275fac=function(i){return new(i||l)(e.GI1(k.ov),e.GI1(xe.KE),e.GI1(Ko),e.GI1(_t.qW),e.GI1(_r))};static \u0275cmp=e.In1({type:l,selectors:[["igo-draw"]],viewQuery:function(i,n){if(1&i&&e.CC$(Pl,5),2&i){let p;e.wto(p=e.Gqi())&&(n.select=p.first)}},inputs:{map:"map",stores:"stores",drawControls:"drawControls",activeDrawingLayer:"activeDrawingLayer"},outputs:{activeLayerChange:"activeLayerChange",drawControlsEvent:"drawControlsEvent",layersIDEvent:"layersIDEvent",fillColor:"fillColor",strokeColor:"strokeColor",strokeWidth:"strokeWidth",fontSize:"fontSize",fontStyle:"fontStyle"},standalone:!0,features:[e.UHJ],decls:51,vars:47,consts:[[1,"geometry-type-toggle","mat-typography"],[3,"value","change"],[3,"value"],[1,"draw-options","mat-typography"],[3,"disabled","checked","labelPosition","change"],[3,"checked","labelPosition","change"],[3,"checked","labelPosition","change",4,"ngIf"],["class","radius-unit",4,"ngIf"],[1,"layer-select-container"],["subscriptSizing","dynamic",1,"layer-select"],[3,"value","selectionChange"],["selectedLayer",""],[3,"value",4,"ngFor","ngForOf"],["id","createNewLayer"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","deleteBtn","mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","click",4,"ngIf"],[1,"table-compact",3,"store","template"],["table",""],[1,"icon-options"],[4,"ngIf"],[1,"actions-container"],["mat-icon-button","","color","accent","disableRipple","true",3,"click"],["tooltip-position","below","matTooltipShowDelay","500",1,"shortcuts-icon",3,"matTooltip"],["mat-raised-button","","color","primary",3,"matTooltip","click",4,"ngIf"],[1,"radius-unit"],[1,"radius"],["matInput","","type","number","min","0",3,"placeholder","formControl","readonly"],[1,"unit-field"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"deleteBtn",3,"matTooltip","disabled","click"],["class","box",4,"ngIf"],["value","",3,"click"],[3,"value","click",4,"ngFor","ngForOf"],[1,"box"],[3,"src"],[3,"value","click"],["mat-raised-button","","color","primary",3,"matTooltip","click"],["aria-hidden","false","iconPositionEnd","","matBadgeColor","warn","matBadgeSize","medium",1,"style-icon",3,"matBadge"]],template:function(i,n){if(1&i){const p=e.KQA();e.I0R(0,"div")(1,"div",0)(2,"mat-button-toggle-group",1),e.qCj("change",function(Y){return n.onGeometryTypeChange(Y.value)}),e.I0R(3,"mat-button-toggle",2),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.I0R(6,"mat-button-toggle",2),e.OEk(7),e.wVc(8,"translate"),e.C$Y(),e.I0R(9,"mat-button-toggle",2),e.OEk(10),e.wVc(11,"translate"),e.C$Y(),e.I0R(12,"mat-button-toggle",2),e.OEk(13),e.wVc(14,"translate"),e.C$Y()()(),e.I0R(15,"div",3)(16,"mat-slide-toggle",4),e.qCj("change",function(Y){return n.onToggleDrawControl(Y.checked)}),e.OEk(17),e.wVc(18,"translate"),e.C$Y(),e.I0R(19,"mat-slide-toggle",5),e.qCj("change",function(){return n.onToggleLabels()}),e.OEk(20),e.wVc(21,"translate"),e.C$Y(),e.yuY(22,Fl,3,5,"mat-slide-toggle",6)(23,Ll,7,7,"div",7),e.C$Y(),e.wR5(24,"mat-divider"),e.I0R(25,"div",8)(26,"mat-form-field",9)(27,"mat-label"),e.OEk(28),e.wVc(29,"translate"),e.C$Y(),e.I0R(30,"mat-select",10,11),e.qCj("selectionChange",function(){e.usT(p);const Y=e.Gew(31);return e.CGJ(n.onLayerChange(Y.value))}),e.yuY(32,Gl,2,2,"mat-option",12),e.I0R(33,"mat-option",13),e.OEk(34),e.wVc(35,"translate"),e.C$Y()()(),e.yuY(36,$l,5,7,"button",14),e.C$Y(),e.wR5(37,"mat-divider"),e.I0R(38,"div"),e.yuY(39,kl,5,6,"button",15),e.I0R(40,"div"),e.wR5(41,"igo-entity-table",16,17),e.C$Y()(),e.I0R(43,"div",18),e.yuY(44,Ul,11,8,"mat-form-field",19),e.C$Y(),e.I0R(45,"div",20)(46,"button",21),e.qCj("click",function(){return n.openShorcutsDialog()}),e.I0R(47,"mat-icon",22),e.wVc(48,"translate"),e.OEk(49,"keyboard "),e.C$Y()(),e.yuY(50,Yl,6,7,"button",23),e.C$Y()()}2&i&&(e.yG2(2),e.E7m("value",n.geometryType.Point),e.yG2(),e.E7m("value",n.geometryType.Point),e.yG2(),e.oRS(" ",e.kDX(5,29,"igo.geo.draw."+n.geometryType.Point)," "),e.yG2(2),e.E7m("value",n.geometryType.LineString),e.yG2(),e.oRS(" ",e.kDX(8,31,"igo.geo.draw."+n.geometryType.LineString)," "),e.yG2(2),e.E7m("value",n.geometryType.Polygon),e.yG2(),e.oRS(" ",e.kDX(11,33,"igo.geo.draw."+n.geometryType.Polygon)," "),e.yG2(2),e.E7m("value",n.geometryType.Circle),e.yG2(),e.oRS(" ",e.kDX(14,35,"igo.geo.draw."+n.geometryType.Circle)," "),e.yG2(3),e.E7m("disabled",n.drawControlIsDisabled)("checked",n.drawControlIsActive)("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(18,37,"igo.geo.draw.drawControl")," "),e.yG2(2),e.E7m("checked",n.labelsAreShown)("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(21,39,"igo.geo.draw.toggleMapTooltips")," "),e.yG2(2),e.E7m("ngIf",!n.isPoint()),e.yG2(),e.E7m("ngIf",n.isCircle()),e.yG2(5),e.cNF(e.kDX(29,41,"igo.geo.draw.layer.title")),e.yG2(2),e.E7m("value",n.updateActiveLayer()),e.yG2(2),e.E7m("ngForOf",n.allLayers),e.yG2(2),e.oRS(" ",e.kDX(35,43,"igo.geo.draw.layer.createNewLayer")," "),e.yG2(2),e.E7m("ngIf",n.activeDrawingLayer),e.yG2(3),e.E7m("ngIf",n.activeStore.count$.getValue()>0),e.yG2(2),e.E7m("store",n.activeStore)("template",n.tableTemplate),e.yG2(3),e.E7m("ngIf",n.icons.length>=1),e.yG2(3),e.E7m("matTooltip",e.kDX(48,45,"igo.geo.draw.shortcuts")),e.yG2(3),e.E7m("ngIf",n.selectedFeatures$.value.length))},dependencies:[io.ue,io.gn,io.KU,co.GE,co.cP,Ke.u_,yt.wb,yt.Up,yt.w5,Bt.cN,Bt.yi,xe.y,xe.ot,xe.O4,xe.ue,xe.Gu,xe.sl,xe.ug,Gt.d5,Gt.kX,Gt.gl,kt.I5,Ke.Iw,kt.Ax,to.U,to.k,Ze.oJ,Ze.Gw,Ze.um,ht.KO,ht.a4,dt.oB,dt.qL,be.Eh,st.g,st.S,Ke.a,k._s,pe.sD],styles:["[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:25%}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .icon-options[_ngcontent-%COMP%]{margin:5px 5px 0}[_nghost-%COMP%]   .deleteBtn[_ngcontent-%COMP%]{margin-left:16px}[_nghost-%COMP%]   .edition-drawing[_ngcontent-%COMP%]{padding:10px 0}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .deleteBtn[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .storeTable[_ngcontent-%COMP%]{height:auto!important}[_nghost-%COMP%]   .layer-select[_ngcontent-%COMP%]{flex:1;margin-right:8px}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]{padding:10px}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:25%}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{left:8px;bottom:10px}[_nghost-%COMP%]   .radius[_ngcontent-%COMP%]{flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{flex:1;margin-left:8px}[_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:100%;padding:4px 8px}[_nghost-%COMP%]     igo-entity-table td:last-child{text-align:right!important}[_nghost-%COMP%]     igo-entity-table td:last-child button{margin:0%!important}[_nghost-%COMP%]   .layer-select-container[_ngcontent-%COMP%]{margin:16px 8px}[_nghost-%COMP%]   .actions-container[_ngcontent-%COMP%], [_nghost-%COMP%]   .layer-select-container[_ngcontent-%COMP%]{display:flex;align-items:center}"],data:{animation:[(0,Ci.gV)("openClose",[(0,Ci.K2)("open",(0,Ci.wb)({opacity:1})),(0,Ci.K2)("closed",(0,Ci.wb)({opacity:0})),(0,Ci.aK)("open => closed",[(0,Ci.Cs)("600ms ease")]),(0,Ci.aK)("closed => open",[(0,Ci.Cs)("800ms ease")])])]},changeDetection:0})}return l})();var jl=r(28276),Kl=r(53156),ao=r(49312),ua=r(48908),da=r(36124);function Wl(l,m){}let zr=(()=>{class l{cdRef;ngControl;olOverlayLayer;olGeoJSON=new Z.c;ready=!1;drawControl;modifyControl;defaultDrawStyleRadius;olGeometryEnds$$;olGeometryChanges$$;olTooltip=this.createMeasureTooltip();activeControl;map;set geometryType(t){this._geometryType=t,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())}get geometryType(){return this._geometryType}_geometryType;drawGuide=null;measure=!1;get drawControlIsActive(){return this._drawControlIsActive}set drawControlIsActive(t){if(this._drawControlIsActive=t,!1!==this.ready){if(this.deactivateControl(),!this._drawControlIsActive)return;this.toggleControl()}}_drawControlIsActive=!0;get freehandDrawIsActive(){return this._freehandDrawIsActive}set freehandDrawIsActive(t){this._freehandDrawIsActive=t,this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),!1!==this.ready&&this.drawControlIsActive&&this.toggleControl()}_freehandDrawIsActive;get predefinedRadius(){return this._predefinedRadius}set predefinedRadius(t){this._predefinedRadius=t,this.drawControl.ispredefinedRadius$.next(t)}_predefinedRadius;controlOptions={};set drawStyle(t){void 0===t&&(t=(0,da.gD)()),this._drawStyle=t;const i=this.getGuideStyleFromDrawStyle(t);this.defaultDrawStyleRadius=void 0!==i?i.getRadius():null,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())}get drawStyle(){return this._drawStyle}_drawStyle;set overlayStyle(t){this._overlayStyle=t}get overlayStyle(){return this._overlayStyle}_overlayStyle;set value(t){this._value=t,!1!==this.ready&&(t?this.addGeoJSONToOverlay(t):this.olOverlaySource.clear(!0),this.onChange(t),this.toggleControl(),this.cdRef.detectChanges())}get value(){return this._value}_value;get olOverlaySource(){return this.olOverlayLayer.getSource()}set radius(t){if(!1!==this.ready&&(this.modifyControl.getSource()&&this.modifyControl.getSource().refresh(),this.freehandDrawIsActive)){let i;setTimeout(()=>{i=this.modifyControl.olModifyInteraction,i&&i.features_&&(i.features_.clear(),this.addGeoJSONToOverlay(this.value))},0)}}constructor(t,i){this.cdRef=t,this.ngControl=i,void 0!==this.ngControl&&(this.ngControl.valueAccessor=this)}ngOnInit(){void 0===this.drawStyle&&(this.drawStyle=(0,da.gD)()),void 0===this.overlayStyle&&(this.overlayStyle=this.drawStyle),this.addOlOverlayLayer(),this.createDrawControl(),this.createModifyControl(),this.value&&this.addGeoJSONToOverlay(this.value),this.toggleControl(),this.ready=!0}ngOnDestroy(){this.ready=!1,this.deactivateControl(),this.olOverlaySource.clear(),this.map.ol.removeLayer(this.olOverlayLayer)}registerOnChange(t){this.onChange=t}onChange=()=>{};registerOnTouched(t){this.onTouched=t}onTouched=()=>{};writeValue(t){this.value=t}addOlOverlayLayer(){this.olOverlayLayer=new Kl.c({source:new j.c,zIndex:500,style:null}),this.map.ol.addLayer(this.olOverlayLayer)}createDrawControl(){const t=Object.assign({},this.controlOptions,{geometryType:this.geometryType||"Point",drawingLayer:this.olOverlayLayer,interactionStyle:"function"==typeof this.drawStyle?this.drawStyle:(i,n)=>{const p=this.drawStyle;return this.updateDrawStyleWithDrawGuide(p,n),p}});this.drawControl=new ua.i4(t)}createModifyControl(){const t=Object.assign({},this.controlOptions,{layer:this.olOverlayLayer,drawStyle:"function"==typeof this.drawStyle?this.drawStyle:(i,n)=>{const p=this.drawStyle;return this.updateDrawStyleWithDrawGuide(p,n),p}});this.modifyControl=new ua.Up(t)}toggleControl(){let t;t=!this.value&&this.geometryType?this.drawControl:this.modifyControl,t!==this.activeControl&&(this.deactivateControl(),this.activateControl(t))}activateControl(t){this.activeControl=t,this.olGeometryEnds$$=t.end$.subscribe(i=>this.onOlGeometryEnds(i)),!0===this.measure&&t===this.drawControl&&(this.olGeometryChanges$$=t.changes$.subscribe(i=>this.onOlGeometryChanges(i))),t.setOlMap(this.map.ol,!1)}deactivateControl(){this.removeMeasureTooltip(),void 0!==this.activeControl&&this.activeControl.setOlMap(void 0),void 0!==this.olGeometryEnds$$&&this.olGeometryEnds$$.unsubscribe(),void 0!==this.olGeometryChanges$$&&this.olGeometryChanges$$.unsubscribe(),this.activeControl=void 0}onOlGeometryEnds(t){this.removeMeasureTooltip(),this.setOlGeometry(t)}onOlGeometryChanges(t){"Point"!==t.getType()&&this.updateMeasureTooltip(t)}setOlGeometry(t){let i;void 0!==t&&("Circle"===t.getType()&&(t=this.circleToPoint(t)),i=this.olGeoJSON.writeGeometryObject(t,{featureProjection:this.map.projection,dataProjection:"EPSG:4326"}),t.get("radius")&&(i.radius=t.get("radius"),t.set("radius",i.radius)),this.writeValue(i))}circleToPoint(t){const i=t.getCenter(),n=V.AF(i,this.map.projection,"EPSG:4326"),p=Math.round(t.getRadius()*Math.cos(Math.PI/180*n[1]));return(t=new J.c(i)).set("radius",p,!0),t}addGeoJSONToOverlay(t){const i=this.olGeoJSON.readGeometry(t,{dataProjection:"EPSG:4326",featureProjection:this.map.projection}),n=new $i.c({geometry:i});n.setStyle(this.overlayStyle),this.olOverlaySource.clear(),this.olOverlaySource.addFeature(n)}createMeasureTooltip(){return new jl.c({element:document.createElement("div"),offset:[-30,-10],className:["igo-map-tooltip","igo-map-tooltip-measure"].join(" "),stopEvent:!1})}updateMeasureTooltip(t){const n=(0,ao.ox)(t,this.map.projection).lengths,p="Polygon"===t.getType()?n.length-2:n.length-1,v=n[p],Y=(0,ao.ie)(t),ue=Y[p];if(0===Y.length||void 0===ue)return void this.removeMeasureTooltip();this.olTooltip.setPosition(ue.getFlatCoordinates());const ye=(0,ao.wP)(v,{decimal:1,unit:ao.K8.Meters,unitAbbr:!0,locale:"fr"});this.olTooltip.getElement().innerHTML=ye,void 0===this.olTooltip.getMap()&&this.map.ol.addOverlay(this.olTooltip)}removeMeasureTooltip(){this.olTooltip.getMap&&void 0!==this.olTooltip.getMap()&&(this.map.ol.removeOverlay(this.olTooltip),this.olTooltip.setMap(void 0))}updateDrawStyleWithDrawGuide(t,i){const n=this.getGuideStyleFromDrawStyle(t);if(void 0===n)return;const p=this.drawGuide;let v;v=!p||p<0?this.defaultDrawStyleRadius:p>0?p/i:p,n.setRadius(v)}getGuideStyleFromDrawStyle(t){let i,n;return i=Array.isArray(t)?t[0]:t,"function"==typeof i.getImage&&(i=i.getImage()),"function"==typeof i.setRadius&&(n=i),n}static \u0275fac=function(i){return new(i||l)(e.GI1(e.kD9),e.GI1(xe.eq,10))};static \u0275cmp=e.In1({type:l,selectors:[["igo-geometry-form-field-input"]],inputs:{map:"map",geometryType:"geometryType",drawGuide:"drawGuide",measure:"measure",drawControlIsActive:"drawControlIsActive",freehandDrawIsActive:"freehandDrawIsActive",predefinedRadius:"predefinedRadius",controlOptions:"controlOptions",drawStyle:"drawStyle",overlayStyle:"overlayStyle",value:"value",radius:"radius"},standalone:!0,features:[e.UHJ],decls:1,vars:0,template:function(i,n){1&i&&e.yuY(0,Wl,0,0,"ng-template")},encapsulation:2,changeDetection:0})}return l})();var oo=r(99228);function Nl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",17),e.qCj("change",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.onDrawControlChange())}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("checked",t.drawControlIsActive)("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(2,3,"igo.geo.spatialFilter.drawControl")," ")}}function Hl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",17),e.qCj("change",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.onfreehandControlChange())}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("checked",t.freehandDrawIsActive)("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(2,3,"igo.geo.spatialFilter.freehandControl")," ")}}function zl(l,m){if(1&l&&(e.I0R(0,"mat-option",6),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.measure."+t)," ")}}function Xl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",18)(1,"mat-form-field",19),e.wR5(2,"input",20),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"mat-form-field",21)(5,"mat-select",22),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onMeasureUnitChange(n.value))}),e.yuY(6,zl,3,4,"mat-option",23),e.C$Y()()()}if(2&l){const t=e.GaO();e.yG2(2),e._6D("placeholder",e.kDX(3,6,"igo.geo.spatialFilter.buffer")),e.E7m("formControl",t.bufferFormControl)("value",0)("readonly",null===t.formControl.value),e.yG2(3),e.E7m("value",t.measureUnit),e.yG2(),e.E7m("ngForOf",t.measureUnits)}}function Jl(l,m){if(1&l&&(e.I0R(0,"mat-option",6),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.measure."+t)," ")}}function Ql(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",24)(1,"mat-form-field",25)(2,"input",26),e.qCj("input",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.getRadius())}),e.wVc(3,"translate"),e.C$Y()(),e.I0R(4,"mat-form-field",21)(5,"mat-select",22),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onMeasureUnitChange(n.value))}),e.yuY(6,Jl,3,4,"mat-option",23),e.C$Y()()()}if(2&l){const t=e.GaO();e.yG2(2),e._6D("placeholder",e.kDX(3,6,"igo.geo.spatialFilter.radius")),e.E7m("formControl",t.radiusFormControl)("value",1e3)("readonly",t.freehandDrawIsActive&&null===t.formControl.value),e.yG2(3),e.E7m("value",t.measureUnit),e.yG2(),e.E7m("ngForOf",t.measureUnits)}}function Zl(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-radio-button",27),e.qCj("change",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onItemTypeChange(n))}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.spatialFilter."+t)," ")}}function ql(l,m){1&l&&(e.I0R(0,"mat-header-cell",38),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.cNF(e.kDX(2,1,"igo.geo.spatialFilter.Thematics")))}function ec(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-header-cell",39)(1,"mat-checkbox",40),e.qCj("change",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(n?p.masterToggle():null)}),e.C$Y()()}if(2&l){const t=e.GaO(2);e.yG2(),e.E7m("checked",t.isAllSelected())("indeterminate",t.selectedThematics.hasValue()&&!t.isAllSelected())}}function tc(l,m){1&l&&e.wR5(0,"mat-header-row")}function oc(l,m){1&l&&e.wR5(0,"mat-row")}function ic(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-tree-node",41)(1,"li",42),e.wR5(2,"button",43),e.OEk(3),e.I0R(4,"mat-checkbox",44),e.qCj("click",function(n){return n.stopPropagation()})("change",function(n){const v=e.usT(t).$implicit,Y=e.GaO(2);return e.CGJ(n?Y.onToggleChange(v):null)}),e.C$Y()()()}if(2&l){const t=m.$implicit,i=e.GaO(2);e.yG2(3),e.oRS(" ",t.name," "),e.yG2(),e.E7m("checked",i.selectedThematics.isSelected(t))}}function nc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-nested-tree-node")(1,"div",42)(2,"button",45),e.qCj("click",function(){const p=e.usT(t).$implicit,v=e.GaO(2);return e.CGJ(v.onToggleClick(p))}),e.I0R(3,"mat-icon"),e.OEk(4),e.C$Y()(),e.OEk(5),e.I0R(6,"mat-checkbox",46),e.qCj("change",function(n){const v=e.usT(t).$implicit,Y=e.GaO(2);return e.CGJ(n?Y.childrensToggle(v):null)}),e.C$Y()(),e.I0R(7,"ul",47),e.C_f(8,48),e.C$Y()()}if(2&l){const t=m.$implicit,i=e.GaO(2);e.yG2(4),e.cNF(i.treeControl.isExpanded(t)?"expand_more":"chevron_right"),e.yG2(),e.oRS(" ",t.name," "),e.yG2(),e.E7m("checked",i.isAllSelected(t))("indeterminate",i.hasChildrenSelected(t)&&!i.isAllSelected(t)),e.yG2(),e.eAK("example-tree-invisible",!i.treeControl.isExpanded(t))}}function rc(l,m){if(1&l&&(e.I0R(0,"div",28)(1,"mat-table"),e.SAx(2,29),e.yuY(3,ql,3,3,"mat-header-cell",30),e.k70(),e.SAx(4,31),e.yuY(5,ec,2,2,"mat-header-cell",32),e.k70(),e.yuY(6,tc,1,0,"mat-header-row",33)(7,oc,1,0,"mat-row",34),e.C$Y(),e.I0R(8,"mat-tree",35),e.yuY(9,ic,5,2,"mat-tree-node",36)(10,nc,9,6,"mat-nested-tree-node",37),e.C$Y()()),2&l){const t=e.GaO();e.yG2(6),e.E7m("matHeaderRowDef",t.displayedColumns),e.yG2(),e.E7m("matRowDefColumns",t.displayedColumns),e.yG2(),e.E7m("dataSource",t.dataSource)("treeControl",t.treeControl),e.yG2(2),e.E7m("matTreeNodeDefWhen",t.hasChild)}}function sc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",49),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.clearSearch())}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("disabled",t.disabledClearSearch()),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.spatialFilter.clearSearch")," ")}}function ac(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",50),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.clearDrawZone())}),e.OEk(1),e.wVc(2,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("disabled",null===t.formControl.value),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.spatialFilter.clearForm")," ")}}function lc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",51),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleVisibleList())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"expand_more"),e.C$Y()()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.spatialFilter.showSearchResults"))}function cc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",55),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.toggleVisibleList())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"expand_less"),e.C$Y()()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.spatialFilter.hideSearchResults"))}function uc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",52),e.yuY(1,cc,4,3,"button",53),e.I0R(2,"igo-entity-table",54),e.qCj("entitySelectChange",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.entityChange.emit(n))}),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",t.listIsVisible),e.yG2(),e.E7m("template",t.tableTemplate)("store",t.store)}}let Xr=(()=>{class l{cdRef;spatialFilterService;messageService;languageService;map;get type(){return this._type}set type(t){this._type=t;const i=this.geometryTypes.findIndex(n=>n===this.type);if(this.geometryType=this.geometryTypes[i],this.formControl.reset(),this.radius=void 0,this.drawGuide$.next(null),this.drawStyle$.next(void 0),this.type===Xt.Predefined&&this.formControl.setValue({type:"Point",coordinates:""}),this.type===Xt.Point)this.radius=1e3,this.radiusFormControl.setValue(this.radius),this.PointStyle=(n,p)=>{const v=n.getGeometry(),Y=V.AF(v.getCoordinates(),this.map.projection,"EPSG:4326");return new $o.cp({image:new Gi.c({radius:this.radius/Math.cos(Math.PI/180*Y[1])/p,stroke:new yo.c({width:2,color:"rgba(0, 153, 255)"}),fill:new _o.c({color:"rgba(0, 153, 255, 0.2)"})})})},this.overlayStyle=this.PointStyle,this.drawStyle$.next(this.overlayStyle);else{this.radius=void 0,this.PolyStyle=()=>new $o.cp({stroke:new yo.c({width:2,color:"rgba(0, 153, 255)"}),fill:new _o.c({color:"rgba(0, 153, 255, 0.2)"})});const n=[0,153,255],p=()=>new $o.cp({image:new Gi.c({radius:8,stroke:new yo.c({width:2,color:"rgba(0, 153, 255)"}),fill:new _o.c({color:"rgba(0, 153, 255, 0.2)"})}),stroke:new yo.c({color:n.concat([1]),width:2}),fill:new _o.c({color:n.concat([.2])})});this.overlayStyle=this.PolyStyle,this.drawStyle$.next(p)}this.overlayStyle$.next(this.overlayStyle)}_type;queryType;zone;loading;get store(){return this._store}set store(t){this._store=t,this._store.entities$.subscribe(()=>{this.cdRef.detectChanges()})}_store;get measureUnits(){return[ao.K8.Meters,ao.K8.Kilometers]}layers=[];allLayers=[];get thematicLength(){return this._thematicLength}set thematicLength(t){this._thematicLength=t}_thematicLength;toggleSearch=new e._w7;itemTypeChange=new e._w7;thematicChange=new e._w7;drawZoneEvent=new e._w7;bufferEvent=new e._w7;zoneWithBufferChange=new e._w7;measureUnitChange=new e._w7;radiusEvent=new e._w7;freehandControl=new e._w7;predefinedRadius=new e._w7;clearButtonEvent=new e._w7;clearSearchEvent=new e._w7;export=new e._w7;openWorkspace=new e._w7;entityChange=new e._w7;itemType=[De.Address,De.Thematics];selectedItemType=De.Address;selectedSourceAddress;treeControl=new jr.Mb(t=>t.children);displayedColumns=["name","select"];childrens=[];groups=[];thematics=[];dataSource=new _i.wD;selectedThematics=new Vr.e2(!0,[]);value$=new B.g(void 0);drawGuide$=new B.g(null);overlayStyle$=new B.g(void 0);drawStyle$=new B.g(void 0);value$$;radiusChanges$$;bufferChanges$$;formControl=new xe.yM;geometryType;geometryTypeField=!1;geometryTypes=[Nt.Point,Nt.Polygon];drawGuideField=!1;drawGuide=null;drawGuidePlaceholder="";measure=!1;drawControlIsActive=!0;freehandDrawIsActive=!1;drawStyle;drawZone;overlayStyle;PointStyle;PolyStyle;radius;buffer=0;radiusFormControl=new xe.yM;bufferFormControl=new xe.yM;measureUnit=ao.K8.Meters;zoneWithBuffer;listIsVisible=!0;tableTemplate;constructor(t,i,n,p){this.cdRef=t,this.spatialFilterService=i,this.messageService=n,this.languageService=p}ngOnInit(){this.spatialFilterService.loadThematicsList().subscribe(n=>{for(const v of n)this.childrens.push(v),this.childrens.sort((Y,ue)=>Y.name.localeCompare(ue.name));this.groups.push(this.languageService.translate.instant("igo.geo.terrapi.limites"));const p={name:this.groups[0],children:[]};this.thematics.push(p),this.childrens.forEach(v=>{v.group&&-1===this.groups.indexOf(v.group)&&(this.groups.push(v.group),this.thematics.push({name:v.group,children:[]})),v.group||(v.name===this.languageService.translate.instant("igo.geo.terrapi.AdmRegion")||v.name===this.languageService.translate.instant("igo.geo.terrapi.Mun")||v.name===this.languageService.translate.instant("igo.geo.terrapi.Arrond")||v.name===this.languageService.translate.instant("igo.geo.terrapi.CircFed")||v.name===this.languageService.translate.instant("igo.geo.terrapi.CircProv")||v.name===this.languageService.translate.instant("igo.geo.terrapi.DirReg")||v.name===this.languageService.translate.instant("igo.geo.terrapi.MRC")||v.name===this.languageService.translate.instant("igo.geo.terrapi.RegTour")?v.group=p.name:v.name===this.languageService.translate.instant("igo.geo.terrapi.routes")?v.group=this.languageService.translate.instant("igo.geo.spatialFilter.group.transport"):this.thematics.push({name:v.name,children:[],source:v.source})),this.thematics.sort((Y,ue)=>Y.name.localeCompare(ue.name))}),this.thematics.forEach(v=>{for(const Y of this.childrens)Y.group===v.name&&v.children.push(Y)})}),this.dataSource.data=this.thematics,this.drawGuide$.next(null),this.value$.next(this.formControl.value?this.formControl.value:void 0),this.value$$=this.formControl.valueChanges.subscribe(n=>{n?(this.value$.next(n),this.drawZone=this.formControl.value,0!==this.buffer&&(this.drawZoneEvent.emit(this.drawZone),this.bufferFormControl.setValue(this.buffer))):(this.value$.next(void 0),this.drawZone=void 0)}),this.value$.subscribe(()=>{this.getRadius(),this.cdRef.detectChanges()}),this.radiusChanges$$=this.radiusFormControl.valueChanges.subscribe(()=>{this.getRadius(),this.cdRef.detectChanges()}),this.bufferChanges$$=this.bufferFormControl.valueChanges.pipe((0,fo.o)(500)).subscribe(n=>{this.measureUnit===ao.K8.Meters&&n>0&&n<=1e5?(this.buffer=n,this.bufferEvent.emit(n),this.spatialFilterService.loadBufferGeometry(this.drawZone,Xt.Polygon,n).subscribe(p=>{this.zoneWithBuffer=p,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):this.measureUnit===ao.K8.Kilometers&&n>0&&n<=100?(this.buffer=n,this.bufferEvent.emit(n),this.spatialFilterService.loadBufferGeometry(this.drawZone,Xt.Polygon,1e3*n).subscribe(p=>{this.zoneWithBuffer=p,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):0===n?(this.buffer=n,this.bufferEvent.emit(n),this.drawZoneEvent.emit(this.drawZone)):(n<0||this.measureUnit===ao.K8.Meters&&n>1e5||this.measureUnit===ao.K8.Kilometers&&n>100)&&(this.bufferFormControl.setValue(0),this.buffer=0,this.messageService.alert("igo.geo.spatialFilter.bufferAlert","igo.geo.spatialFilter.warning"))});const t=new be.xx({}),i=new Be.kj({layer:new oo.Md({zIndex:300,source:new Mo.EB,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1}),map:this.map,hitTolerance:15,motion:Be.Su.Default,many:!0,dragBox:!0});this.store.addStrategy(i,!0),this.store.addStrategy(t,!1)}ngOnDestroy(){this.value$$.unsubscribe(),this.radiusChanges$$.unsubscribe(),this.bufferChanges$$.unsubscribe(),this.cdRef.detach(),this.radiusChanges$$&&this.radiusChanges$$.unsubscribe(),this.value$$&&this.value$$.unsubscribe()}onItemTypeChange(t){this.selectedItemType=t.value,this.itemTypeChange.emit(this.selectedItemType)}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.measureUnitChange.emit(this.measureUnit),this.isPolygon()?this.bufferFormControl.setValue(this.measureUnit===ao.K8.Meters?1e3*this.bufferFormControl.value:this.bufferFormControl.value/1e3):this.isPoint()&&this.radiusFormControl.setValue(this.measureUnit===ao.K8.Meters?1e3*this.radiusFormControl.value:this.radiusFormControl.value/1e3))}isPredefined(){return this.type===Xt.Predefined}isPolygon(){return this.type===Xt.Polygon}isPoint(){return this.type===Xt.Point}hasChild(t,i){return!!i.children&&i.children.length}onToggleClick(t){this.treeControl.isExpanded(t)?this.treeControl.collapse(t):this.treeControl.expand(t)}isAllSelected(t){let i,n=0;return t?(i=t.children.length,t.children.forEach(p=>{this.selectedThematics.selected.find(v=>v===p)&&n++})):(i=this.selectedThematics.selected.length,this.thematics.forEach(p=>{-1===this.groups.indexOf(p.name)&&n++}),this.childrens.forEach(p=>{this.thematics.find(v=>v.source===p.source)||n++})),n>=1&&i===n}hasChildrenSelected(t){let i=!1;return t.children.forEach(n=>{this.selectedThematics.selected.find(p=>p.source===n.source)&&(i=!0)}),i}masterToggle(){this.isAllSelected()?this.selectedThematics.clear():this.selectAll();const t=[];for(const i of this.selectedThematics.selected)t.push(i);this.isAllSelected()?this.thematics.forEach(i=>{this.hasChild(0,i)&&this.treeControl.expand(i)}):this.thematics.forEach(i=>{this.hasChild(0,i)&&this.treeControl.collapse(i)}),this.thematicChange.emit(t)}selectAll(t){t?this.hasChild(0,t)&&t.children.forEach(i=>this.selectedThematics.select(i)):(this.thematics.forEach(i=>{-1===this.groups.indexOf(i.name)&&this.selectedThematics.select(i)}),this.childrens.forEach(i=>{this.selectedThematics.selected.find(n=>n.source===i.source)||this.selectedThematics.select(i)}))}childrensToggle(t){this.isAllSelected(t)?t.children.forEach(n=>this.selectedThematics.deselect(n)):this.selectAll(t);const i=[];for(const n of this.selectedThematics.selected)i.push(n);this.treeControl.expand(t),this.thematicChange.emit(i)}onToggleChange(t){let i=!1;void 0!==this.selectedThematics.selected.find(p=>p.source===t.source)&&(i=!0),this.childrens.forEach(p=>{p===t&&!1===i&&this.selectedThematics.select(p),p===t&&!0===i&&this.selectedThematics.deselect(p)}),this.thematics.forEach(p=>{p===t&&!1===i&&this.selectedThematics.select(p),p===t&&!0===i&&this.selectedThematics.deselect(p)});const n=[];for(const p of this.selectedThematics.selected)n.push(p);this.thematicChange.emit(n)}onDrawControlChange(){this.drawControlIsActive=!this.drawControlIsActive}onfreehandControlChange(){this.freehandDrawIsActive=!this.freehandDrawIsActive,this.freehandControl.emit(this.freehandDrawIsActive),this.isPoint()?(this.predefinedRadius.emit(!this.freehandDrawIsActive),this.freehandDrawIsActive&&(this.overlayStyle$.next(void 0),this.drawStyle$.next(void 0))):this.predefinedRadius.emit(!1)}toggleSearchButton(){this.isPredefined()||(this.buffer>0?(this.zoneWithBuffer.meta={id:void 0,title:"Zone"},this.zoneWithBuffer.properties={nom:"Zone",type:this.type},this.drawZoneEvent.emit(this.zoneWithBuffer)):(this.drawZone.meta={id:void 0,title:"Zone"},this.drawZone.properties={nom:"Zone",type:this.type},this.drawZoneEvent.emit(this.drawZone))),this.isPoint()?this.radiusEvent.emit(this.radius):this.isPolygon()&&this.bufferEvent.emit(this.buffer),this.toggleSearch.emit(),this.store.entities$.pipe((0,fo.o)(500)).subscribe(t=>{t.length&&this.layers.length===this.thematicLength+1&&(this.openWorkspace.emit(),this.createTableTemplate())})}clearButton(){this.loading=!0,this.store&&this.store.clear(),(this.isPoint()||this.isPolygon())&&(this.drawZone=void 0,this.formControl.reset()),this.bufferFormControl.setValue(0),this.buffer=0,this.bufferEvent.emit(0),this.clearButtonEvent.emit(),this.loading=!1,this.tableTemplate=void 0}clearDrawZone(){this.formControl.reset(),this.bufferFormControl.setValue(0),this.buffer=0}clearSearch(){this.selectedThematics.clear(),this.bufferFormControl.setValue(0),this.buffer=0,this.bufferEvent.emit(0),this.thematicChange.emit([]),this.clearSearchEvent.emit()}disableSearchButton(){if(this.type===Xt.Predefined){if(this.selectedItemType===De.Address&&void 0!==this.queryType&&void 0!==this.zone)return this.loading;if(this.selectedItemType===De.Thematics&&void 0!==this.queryType&&void 0!==this.zone&&this.selectedThematics.selected.length>0)return this.loading}if(this.type===Xt.Polygon||this.type===Xt.Point){if(this.selectedItemType===De.Address&&null!==this.formControl.value)return this.loading;if(this.selectedItemType===De.Thematics&&this.selectedThematics.selected.length>0&&null!==this.formControl.value)return this.loading}return!0}disabledClearSearch(){let t=!0;return t=this.selectedItemType===De.Address?void 0===this.queryType:void 0===this.queryType&&0===this.selectedThematics.selected.length,t}getRadius(){let t;if(t=null!==this.formControl.value?this.measureUnit===ao.K8.Meters?this.formControl.value.radius:this.formControl.value.radius/1e3:void 0,this.type===Xt.Point){if(this.freehandDrawIsActive){if(t){if(t>=1e5)return this.messageService.alert("igo.geo.spatialFilter.radiusAlert","igo.geo.spatialFilter.warning"),void this.formControl.reset();if(t!==this.radiusFormControl.value)return void this.radiusFormControl.setValue(t)}}else if(this.radiusFormControl.value<0||this.measureUnit===ao.K8.Meters&&this.radiusFormControl.value>=1e5||this.measureUnit===ao.K8.Kilometers&&this.radiusFormControl.value>=100)return this.messageService.alert("igo.geo.spatialFilter.radiusAlert","igo.geo.spatialFilter.warning"),this.radius=1e3,this.radiusFormControl.setValue(this.measureUnit===ao.K8.Meters?this.radius:this.radius/1e3),void this.drawGuide$.next(this.radius);this.measureUnit===ao.K8.Meters?(this.radius=this.radiusFormControl.value,this.drawGuide$.next(this.radius)):(this.radius=1e3*this.radiusFormControl.value,this.drawGuide$.next(1e3*this.radius)),this.overlayStyle$.next(this.PointStyle),this.drawStyle$.next(this.PointStyle)}}toggleVisibleList(){this.listIsVisible=!this.listIsVisible}createTableTemplate(){const t={name:"meta.title",title:this.languageService.translate.instant("igo.geo.spatialFilter.type"),renderer:be.G8.UnsanitizedHTML},i={name:"properties.nom",title:this.languageService.translate.instant("igo.geo.spatialFilter.searchResults"),renderer:be.G8.UnsanitizedHTML};this.tableTemplate={selection:!0,sort:!0,columns:[t,i]}}static \u0275fac=function(i){return new(i||l)(e.GI1(e.kD9),e.GI1(et),e.GI1(Ht.mi),e.GI1(k.ov))};static \u0275cmp=e.In1({type:l,selectors:[["igo-spatial-filter-item"]],inputs:{map:"map",type:"type",queryType:"queryType",zone:"zone",loading:"loading",store:"store",layers:"layers",allLayers:"allLayers",thematicLength:"thematicLength"},outputs:{toggleSearch:"toggleSearch",itemTypeChange:"itemTypeChange",thematicChange:"thematicChange",drawZoneEvent:"drawZoneEvent",bufferEvent:"bufferEvent",zoneWithBufferChange:"zoneWithBufferChange",measureUnitChange:"measureUnitChange",radiusEvent:"radiusEvent",freehandControl:"freehandControl",predefinedRadius:"predefinedRadius",clearButtonEvent:"clearButtonEvent",clearSearchEvent:"clearSearchEvent",export:"export",openWorkspace:"openWorkspace",entityChange:"entityChange"},standalone:!0,features:[e.UHJ],decls:29,vars:43,consts:[[3,"formControl","map","geometryType","drawGuide","measure","drawControlIsActive","freehandDrawIsActive","drawStyle","overlayStyle","radius","predefinedRadius"],[1,"header"],[3,"checked","labelPosition","change",4,"ngIf"],["class","buffer-unit",4,"ngIf"],["class","radius-unit",4,"ngIf"],[1,"title","mat-typography"],[3,"value"],[3,"value","change",4,"ngFor","ngForOf"],["class","thematics",4,"ngIf"],[1,"buttons"],["mat-raised-button","","class","clear-search-button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","class","clear-form-button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary",1,"search-button",3,"disabled","click"],["mat-raised-button","",1,"remove-button",3,"disabled","click"],["mat-raised-button","",1,"export-button",3,"disabled","click"],["class","expand-more","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["class","results",4,"ngIf"],[3,"checked","labelPosition","change"],[1,"buffer-unit"],[1,"buffer"],["type","number","matInput","",3,"placeholder","formControl","value","readonly"],[1,"unit-field"],[3,"value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"radius-unit"],[1,"radius"],["type","number","matInput","",3,"placeholder","formControl","value","readonly","input"],[3,"value","change"],[1,"thematics"],["matColumnDef","name"],["class","thematics-header",4,"matHeaderCellDef"],["matColumnDef","select"],["class","checks-header",4,"matHeaderCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[3,"dataSource","treeControl"],["matTreeNodeToggle","",4,"matTreeNodeDef"],[4,"matTreeNodeDef","matTreeNodeDefWhen"],[1,"thematics-header"],[1,"checks-header"],[3,"checked","indeterminate","change"],["matTreeNodeToggle",""],[1,"mat-tree-node"],["mat-icon-button","","disabled",""],[1,"tree-check",3,"checked","click","change"],["mat-icon-button","",3,"click"],[1,"tree-check-2",3,"checked","indeterminate","change"],[1,"tree-ul"],["matTreeNodeOutlet",""],["mat-raised-button","",1,"clear-search-button",3,"disabled","click"],["mat-raised-button","",1,"clear-form-button",3,"disabled","click"],["mat-icon-button","","matTooltipShowDelay","500",1,"expand-more",3,"matTooltip","click"],[1,"results"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],[1,"results-list",3,"template","store","entitySelectChange"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click"]],template:function(i,n){1&i&&(e.wR5(0,"igo-geometry-form-field-input",0),e.wVc(1,"async"),e.wVc(2,"async"),e.wVc(3,"async"),e.I0R(4,"div",1),e.yuY(5,Nl,3,5,"mat-slide-toggle",2)(6,Hl,3,5,"mat-slide-toggle",2),e.C$Y(),e.yuY(7,Xl,7,8,"div",3)(8,Ql,7,8,"div",4),e.I0R(9,"mat-label",5),e.OEk(10),e.wVc(11,"translate"),e.C$Y(),e.I0R(12,"mat-radio-group",6),e.yuY(13,Zl,3,4,"mat-radio-button",7),e.C$Y(),e.yuY(14,rc,11,5,"div",8),e.I0R(15,"div",9),e.yuY(16,sc,3,4,"button",10)(17,ac,3,4,"button",11),e.I0R(18,"button",12),e.qCj("click",function(){return n.toggleSearchButton()}),e.OEk(19),e.wVc(20,"translate"),e.C$Y(),e.I0R(21,"button",13),e.qCj("click",function(){return n.clearButton()}),e.OEk(22),e.wVc(23,"translate"),e.C$Y(),e.I0R(24,"button",14),e.qCj("click",function(){return n.export.emit()}),e.OEk(25),e.wVc(26,"translate"),e.C$Y()(),e.yuY(27,lc,4,3,"button",15)(28,uc,3,3,"div",16)),2&i&&(e.E7m("formControl",n.formControl)("map",n.map)("geometryType",n.geometryType)("drawGuide",e.kDX(1,29,n.drawGuide$))("measure",n.measure)("drawControlIsActive",n.drawControlIsActive)("freehandDrawIsActive",n.freehandDrawIsActive)("drawStyle",e.kDX(2,31,n.drawStyle$))("overlayStyle",e.kDX(3,33,n.overlayStyle$))("radius",n.radius)("predefinedRadius",n.predefinedRadius),e.yG2(5),e.E7m("ngIf",!n.isPredefined()),e.yG2(),e.E7m("ngIf",!n.isPredefined()),e.yG2(),e.E7m("ngIf",n.isPolygon()),e.yG2(),e.E7m("ngIf",n.isPoint()),e.yG2(2),e.oRS("",e.kDX(11,35,"igo.geo.spatialFilter.search")," :\n"),e.yG2(2),e.E7m("value",n.selectedItemType),e.yG2(),e.E7m("ngForOf",n.itemType),e.yG2(),e.E7m("ngIf","Thematics"===n.selectedItemType&&!n.tableTemplate||"Thematics"===n.selectedItemType&&n.tableTemplate&&!n.listIsVisible),e.yG2(2),e.E7m("ngIf",n.isPredefined()),e.yG2(),e.E7m("ngIf",n.isPolygon()||n.isPoint()),e.yG2(),e.E7m("disabled",n.disableSearchButton()),e.yG2(),e.oRS(" ",e.kDX(20,37,"igo.geo.spatialFilter.goSearch")," "),e.yG2(2),e.E7m("disabled",0===n.allLayers.length),e.yG2(),e.oRS(" ",e.kDX(23,39,"igo.geo.spatialFilter.removeLayer")," "),e.yG2(2),e.E7m("disabled",!n.store.entities$.getValue().length),e.yG2(),e.oRS(" ",e.kDX(26,41,"igo.geo.spatialFilter.exportLayer")," "),e.yG2(2),e.E7m("ngIf",n.store.all().length&&n.tableTemplate&&!n.listIsVisible),e.yG2(),e.E7m("ngIf",n.store.all().length&&n.tableTemplate&&n.listIsVisible))},dependencies:[zr,xe.y,xe.ot,xe.O4,xe.ue,xe.sl,xe.ug,Ke.u_,co.GE,co.cP,yt.wb,yt.Up,yt.w5,Bt.cN,Bt.yi,Gt.d5,Gt.kX,kt.I5,Ke.Iw,kt.Ax,Po.yk,Po.cv,Po.cT,Qo.If,Qo.wL,Qo.ie,Qo.aG,Qo.Af,Qo.gx,Qo.qC,Qo.yC,Qo._I,$t.Vn,$t.WK,_i.qC,_i.kJ,_i.S_,_i.BN,_i.BD,_i.kB,_i.Mx,Ze.oJ,Ze.Gw,Ze.um,dt.oB,dt.qL,ht.KO,ht.a4,be.Eh,Ke.a,k._s,pe.sD],styles:["[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{margin-top:5px;width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{padding:5px;width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{margin-left:5px;font-size:initial}[_nghost-%COMP%]   .mat-mdc-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%]{display:inline-flex;position:relative;margin-left:12px}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{margin-top:5px}[_nghost-%COMP%]   .mat-column-select[_ngcontent-%COMP%]{overflow:auto}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin:16px 0}[_nghost-%COMP%]   .thematics[_ngcontent-%COMP%]{max-height:35%;overflow:auto;margin-top:5px;width:98%}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]{overflow:auto;max-height:250px;width:98%}[_nghost-%COMP%]   .mat-column-typeResults[_ngcontent-%COMP%]{max-width:100px;margin-right:5px}[_nghost-%COMP%]   .buffer-unit[_ngcontent-%COMP%], [_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:100%;padding:5px;box-sizing:border-box}[_nghost-%COMP%]   .radius[_ngcontent-%COMP%], [_nghost-%COMP%]   .buffer[_ngcontent-%COMP%]{flex-flow:column nowrap;flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{flex:1;margin-left:8px}[_nghost-%COMP%]   .example-tree-invisible[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .tree-ul[_ngcontent-%COMP%]{margin:0;padding:0 0 0 20px;list-style-type:none}[_nghost-%COMP%]   .tree-check[_ngcontent-%COMP%], [_nghost-%COMP%]   .tree-check-2[_ngcontent-%COMP%]{position:relative;margin-left:auto;margin-right:5px}[_nghost-%COMP%]   .thematics-header[_ngcontent-%COMP%]{max-width:250px}[_nghost-%COMP%]   .checks-header[_ngcontent-%COMP%]{padding:none;max-width:calc(100% - 316px);overflow:hidden}[_nghost-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{padding:5px}[_nghost-%COMP%]   .mat-tree-node[_ngcontent-%COMP%]{position:relative;min-height:42px;width:280px}[_nghost-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{height:56px}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]{max-height:45%;width:98%}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]   igo-entity-table[_ngcontent-%COMP%]     div.table-container{overflow:unset}"],changeDetection:0})}return l})();var dc=r(11484),tn=r(45076);function pc(l,m){if(1&l&&(e.I0R(0,"mat-option",12),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t.properties.nom," ")}}function mc(l,m){if(1&l&&(e.I0R(0,"mat-option",12),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.measure."+t)," ")}}let Jr=(()=>{class l{spatialFilterService;messageService;get store(){return this._store}set store(t){this._store=t}_store;get queryType(){return this._queryType}set queryType(t){this.formControl.setValue(""),this._queryType=t}_queryType;get zone(){return this._zone}set zone(t){this._zone=t,t||(this.zoneWithBuffer=void 0,this.bufferFormControl.setValue(0))}_zone;layers=[];zoneWithBuffer;selectedZone;measureUnit=tn.K8.Meters;formControl=new xe.yM;bufferFormControl=new xe.yM;get measureUnits(){return[tn.K8.Meters,tn.K8.Kilometers]}zoneChange=new e._w7;zoneWithBufferChange=new e._w7;bufferChange=new e._w7;measureUnitChange=new e._w7;formValueChanges$$;bufferValueChanges$$;constructor(t,i){this.spatialFilterService=t,this.messageService=i}ngOnInit(){this.formValueChanges$$=this.formControl.valueChanges.subscribe(t=>{t.length&&this.store.view.filter(i=>{const n=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return i.properties.nom.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(n)})}),this.bufferValueChanges$$=this.bufferFormControl.valueChanges.pipe((0,fo.o)(500),(0,dc.a)()).subscribe(t=>{this.measureUnit===tn.K8.Meters&&t>0&&t<=1e5?(this.bufferChange.emit(t),this.spatialFilterService.loadBufferGeometry(this.selectedZone,Xt.Predefined,t,this.queryType).subscribe(i=>{this.zoneWithBuffer=i,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):this.measureUnit===tn.K8.Kilometers&&t>0&&t<=100?(this.bufferChange.emit(t),this.spatialFilterService.loadBufferGeometry(this.selectedZone,Xt.Predefined,1e3*t,this.queryType).subscribe(i=>{this.zoneWithBuffer=i,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):0===t&&this.layers.length>0?(this.bufferChange.emit(t),this.zoneWithBufferChange.emit(this.selectedZone)):(t<0||this.measureUnit===tn.K8.Meters&&t>1e5||this.measureUnit===tn.K8.Kilometers&&t>100)&&(this.bufferFormControl.setValue(0),this.messageService.alert("igo.geo.spatialFilter.bufferAlert","igo.geo.spatialFilter.warning"))})}ngOnDestroy(){this.formValueChanges$$.unsubscribe()}displayFn(t){return t?t.properties.nom:void 0}onZoneChange(t){t&&this.queryType&&this.spatialFilterService.loadItemById(t,this.queryType).subscribe(i=>{this.selectedZone=i,this.zoneChange.emit(i)})}onMeasureUnitChange(t){t!==this.measureUnit&&(this.measureUnit=t,this.measureUnitChange.emit(this.measureUnit),this.bufferFormControl.setValue(this.measureUnit===tn.K8.Meters?1e3*this.bufferFormControl.value:this.bufferFormControl.value/1e3))}static \u0275fac=function(i){return new(i||l)(e.GI1(et),e.GI1(Ht.mi))};static \u0275cmp=e.In1({type:l,selectors:[["igo-spatial-filter-list"]],inputs:{store:"store",queryType:"queryType",zone:"zone",layers:"layers"},outputs:{zoneChange:"zoneChange",zoneWithBufferChange:"zoneWithBufferChange",bufferChange:"bufferChange",measureUnitChange:"measureUnitChange"},standalone:!0,features:[e.UHJ],decls:23,vars:23,consts:[[1,"form-list"],[1,"zone-list"],["type","text","matInput","",3,"placeholder","formControl","matAutocomplete"],["input",""],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"buffer-div"],[1,"buffer"],["type","number","matInput","",3,"placeholder","formControl","value","readonly"],[1,"unit-field"],[3,"value","selectionChange"],[3,"value"]],template:function(i,n){if(1&i&&(e.I0R(0,"div",0)(1,"mat-form-field",1)(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.wR5(5,"input",2,3),e.wVc(7,"translate"),e.I0R(8,"mat-autocomplete",4,5),e.qCj("optionSelected",function(v){return n.onZoneChange(v.option.value)}),e.yuY(10,pc,2,2,"mat-option",6),e.wVc(11,"async"),e.C$Y()(),e.I0R(12,"div")(13,"div",7)(14,"mat-form-field",8)(15,"mat-label"),e.OEk(16),e.wVc(17,"translate"),e.C$Y(),e.wR5(18,"input",9),e.wVc(19,"translate"),e.C$Y(),e.I0R(20,"mat-form-field",10)(21,"mat-select",11),e.qCj("selectionChange",function(v){return n.onMeasureUnitChange(v.value)}),e.yuY(22,mc,3,4,"mat-option",6),e.C$Y()()()()()),2&i){const p=e.Gew(9);e.yG2(3),e.cNF(e.kDX(4,13,"igo.geo.spatialFilter.listLabel")),e.yG2(2),e._6D("placeholder",e.kDX(7,15,"igo.geo.spatialFilter.listLabel")),e.E7m("formControl",n.formControl)("matAutocomplete",p),e.yG2(3),e.E7m("displayWith",n.displayFn),e.yG2(2),e.E7m("ngForOf",e.kDX(11,17,n.store.view.all$())),e.yG2(6),e.cNF(e.kDX(17,19,"igo.geo.spatialFilter.buffer")),e.yG2(2),e._6D("placeholder",e.kDX(19,21,"igo.geo.spatialFilter.buffer")),e.E7m("formControl",n.bufferFormControl)("value",0)("readonly",!n.zone),e.yG2(3),e.E7m("value",n.measureUnit),e.yG2(),e.E7m("ngForOf",n.measureUnits)}},dependencies:[yt.wb,yt.Up,yt.w5,Bt.cN,Bt.yi,xe.y,xe.ot,xe.O4,xe.ue,mo.U1,mo.e,kt.I5,mo.cG,xe.sl,xe.ug,Ke.Iw,kt.Ax,Gt.d5,Gt.kX,Ke.a,k._s,pe.sD],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   .buffer-div[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .zone-list[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .buffer[_ngcontent-%COMP%]{flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{flex:1;margin-left:8px}"],changeDetection:0})}return l})();var Qr=r(18268);function gc(l,m){if(1&l&&(e.I0R(0,"mat-option",8),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.terrapi."+t)," ")}}let Zr=(()=>{class l{get store(){return this._store}set store(t){this._store=t}_store;queryType=["Arrond","CircFed","CircProv","DirReg","Mun","MRC","AdmRegion","RegTour"];selectedTypeIndex=new xe.yM(0);spatialType=Xt;activeDrawType=this.spatialType.Polygon;selectedQueryType;zone;layers=[];type;eventType=new e._w7;eventQueryType=new e._w7;zoneChange=new e._w7;zoneWithBufferChange=new e._w7;bufferChange=new e._w7;measureUnitChange=new e._w7;constructor(){}ngOnInit(){0===this.selectedTypeIndex.value&&(this.type=this.spatialType.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)}onTypeChange(t){0===this.selectedTypeIndex.value&&(this.type=Xt.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)}onDrawTypeChange(t){this.activeDrawType=t,this.eventType.emit(this.activeDrawType)}onSelectionChange(){this.eventQueryType.emit(this.selectedQueryType),this.zoneChange.emit(void 0)}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-spatial-filter-type"]],inputs:{store:"store",selectedQueryType:"selectedQueryType",zone:"zone",layers:"layers"},outputs:{eventType:"eventType",eventQueryType:"eventQueryType",zoneChange:"zoneChange",zoneWithBufferChange:"zoneWithBufferChange",bufferChange:"bufferChange",measureUnitChange:"measureUnitChange"},standalone:!0,features:[e.UHJ],decls:22,vars:25,consts:[[3,"selectedIndex","selectedIndexChange","selectedTabChange"],[3,"label"],[3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"store","queryType","zone","layers","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange"],[1,"spatial-type-toggle"],[3,"value","change"],[3,"value","matTooltip"],[3,"value"]],template:function(i,n){1&i&&(e.I0R(0,"mat-tab-group",0),e.qCj("selectedIndexChange",function(v){return n.selectedTypeIndex.setValue(v)})("selectedTabChange",function(v){return n.onTypeChange(v)}),e.I0R(1,"mat-tab",1),e.wVc(2,"translate"),e.I0R(3,"mat-form-field")(4,"mat-label"),e.OEk(5),e.wVc(6,"translate"),e.C$Y(),e.I0R(7,"mat-select",2),e.qCj("selectionChange",function(){return n.onSelectionChange()}),e.iHE("valueChange",function(v){return e.kNx(n.selectedQueryType,v)||(n.selectedQueryType=v),v}),e.yuY(8,gc,3,4,"mat-option",3),e.C$Y()(),e.I0R(9,"igo-spatial-filter-list",4),e.qCj("zoneChange",function(v){return n.zoneChange.emit(v)})("zoneWithBufferChange",function(v){return n.zoneWithBufferChange.emit(v)})("bufferChange",function(v){return n.bufferChange.emit(v)})("measureUnitChange",function(v){return n.measureUnitChange.emit(v)}),e.C$Y()(),e.I0R(10,"mat-tab",1),e.wVc(11,"translate"),e.I0R(12,"div",5)(13,"mat-button-toggle-group",6),e.qCj("change",function(v){return n.onDrawTypeChange(v.value)}),e.I0R(14,"mat-button-toggle",7),e.wVc(15,"translate"),e.I0R(16,"mat-icon"),e.OEk(17,"pentagon"),e.C$Y()(),e.I0R(18,"mat-button-toggle",7),e.wVc(19,"translate"),e.I0R(20,"mat-icon"),e.OEk(21,"circle"),e.C$Y()()()()()()),2&i&&(e.E7m("selectedIndex",n.selectedTypeIndex.value),e.yG2(),e.E7m("label",e.kDX(2,15,"igo.geo.spatialFilter.predefined")),e.yG2(4),e.cNF(e.kDX(6,17,"igo.geo.spatialFilter.searchLabel")),e.yG2(2),e.OKB("value",n.selectedQueryType),e.yG2(),e.E7m("ngForOf",n.queryType),e.yG2(),e.E7m("store",n.store)("queryType",n.selectedQueryType)("zone",n.zone)("layers",n.layers),e.yG2(),e.E7m("label",e.kDX(11,19,"igo.geo.spatialFilter.draw")),e.yG2(3),e.E7m("value",n.activeDrawType),e.yG2(),e.E7m("value",n.spatialType.Polygon)("matTooltip",e.kDX(15,21,"igo.geo.spatialFilter.drawPolygon")),e.yG2(4),e.E7m("value",n.spatialType.Point)("matTooltip",e.kDX(19,23,"igo.geo.spatialFilter.drawCircle")))},dependencies:[Qr.WG,Qr.aJ,Qr._q,yt.wb,yt.Up,yt.w5,Gt.d5,Gt.kX,kt.I5,Ke.Iw,kt.Ax,Jr,io.ue,io.gn,io.KU,ht.KO,ht.a4,dt.oB,dt.qL,k._s,pe.sD],styles:["[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-label{padding:10px}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-body-wrapper{margin-top:5px}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}"],changeDetection:0})}return l})();var Sr=r(6056);function hc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",3)(1,"mat-form-field"),e.wR5(2,"mat-datetimepicker-toggle",4)(3,"mat-datetimepicker",5,6),e.I0R(5,"input",7),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(2);return e.kNx(p.date,n)||(p.date=n),e.CGJ(n)}),e.qCj("dateChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.handleDateChange(n))}),e.wVc(6,"translate"),e.C$Y()()()}if(2&l){const t=e.Gew(4),i=e.GaO(2);e.yG2(2),e.E7m("for",t),e.yG2(),e.E7m("type",i.type)("openOnFocus",!0)("timeInterval",5),e.yG2(2),e._6D("placeholder",e.kDX(6,9,"igo.geo.timeFilter.date")),e.E7m("matDatetimepicker",t),e.OKB("ngModel",i.date),e.E7m("min",i.min)("max",i.max)}}function fc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div")(1,"div",8)(2,"mat-form-field"),e.wR5(3,"mat-datetimepicker-toggle",4)(4,"mat-datetimepicker",5,9),e.I0R(6,"input",10),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(2);return e.kNx(p.startDate,n)||(p.startDate=n),e.CGJ(n)}),e.qCj("input",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.startDate)})("dateChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.handleDateChange(n))}),e.wVc(7,"translate"),e.C$Y()()(),e.I0R(8,"div",8)(9,"mat-form-field"),e.wR5(10,"mat-datetimepicker-toggle",4)(11,"mat-datetimepicker",5,11),e.I0R(13,"input",7),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(2);return e.kNx(p.endDate,n)||(p.endDate=n),e.CGJ(n)}),e.qCj("dateChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.handleDateChange(n))}),e.wVc(14,"translate"),e.C$Y()()()()}if(2&l){const t=e.Gew(5),i=e.Gew(12),n=e.GaO(2);e.yG2(3),e.E7m("for",t),e.yG2(),e.E7m("type",n.type)("openOnFocus",!0)("timeInterval",5),e.yG2(2),e._6D("placeholder",e.kDX(7,18,"igo.geo.timeFilter.startDate")),e.E7m("matDatetimepicker",t),e.OKB("ngModel",n.startDate),e.E7m("min",n.min)("max",n.getRangeMaxDate()),e.yG2(4),e.E7m("for",i),e.yG2(),e.E7m("type",n.type)("openOnFocus",!0)("timeInterval",5),e.yG2(2),e._6D("placeholder",e.kDX(14,20,"igo.geo.timeFilter.endDate")),e.E7m("matDatetimepicker",i),e.OKB("ngModel",n.endDate),e.E7m("min",n.getRangeMinDate())("max",n.max)}}function yc(l,m){if(1&l&&(e.I0R(0,"div"),e.yuY(1,hc,7,11,"div",2)(2,fc,15,22,"div",0),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",!t.isRange),e.yG2(),e.E7m("ngIf",t.isRange)}}function _c(l,m){if(1&l&&(e.I0R(0,"mat-option",14),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function Cc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",3)(1,"mat-form-field")(2,"mat-select",12),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(2);return e.kNx(p.year,n)||(p.year=n),e.CGJ(n)}),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.handleYearChange(n))}),e.wVc(3,"translate"),e.yuY(4,_c,2,2,"mat-option",13),e.C$Y()()()}if(2&l){const t=e.GaO(2);e.yG2(2),e._6D("placeholder",e.kDX(3,3,"igo.geo.timeFilter.date")),e.OKB("ngModel",t.year),e.yG2(2),e.E7m("ngForOf",t.listYears)}}function vc(l,m){if(1&l&&(e.I0R(0,"mat-option",14),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function Sc(l,m){if(1&l&&(e.I0R(0,"mat-option",14),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.cNF(t)}}function bc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div")(1,"div",8)(2,"mat-form-field")(3,"mat-select",12),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(2);return e.kNx(p.startYear,n)||(p.startYear=n),e.CGJ(n)}),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.handleYearChange(n))}),e.wVc(4,"translate"),e.yuY(5,vc,2,2,"mat-option",13),e.C$Y()()(),e.I0R(6,"div",8)(7,"mat-form-field")(8,"mat-select",12),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(2);return e.kNx(p.endYear,n)||(p.endYear=n),e.CGJ(n)}),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.handleYearChange(n))}),e.wVc(9,"translate"),e.yuY(10,Sc,2,2,"mat-option",13),e.C$Y()()()()}if(2&l){const t=e.GaO(2);e.yG2(3),e._6D("placeholder",e.kDX(4,6,"igo.geo.timeFilter.startDate")),e.OKB("ngModel",t.startYear),e.yG2(2),e.E7m("ngForOf",t.startListYears),e.yG2(3),e._6D("placeholder",e.kDX(9,8,"igo.geo.timeFilter.endDate")),e.OKB("ngModel",t.endYear),e.yG2(2),e.E7m("ngForOf",t.endListYears)}}function Oc(l,m){if(1&l&&(e.I0R(0,"div"),e.yuY(1,Cc,5,5,"div",2)(2,bc,11,10,"div",0),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",!t.isRange),e.yG2(),e.E7m("ngIf",t.isRange)}}function Ic(l,m){if(1&l&&(e.I0R(0,"p",25),e.OEk(1),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(),e.cNF(t.year)}}function wc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",15)(1,"span"),e.OEk(2),e.C$Y(),e.I0R(3,"mat-slider",16,17)(5,"input",18,19),e.qCj("input",function(){e.usT(t);const n=e.Gew(6),p=e.Gew(4),v=e.GaO();return e.CGJ(v.handleSliderYearChange({source:n,parent:p,value:n.value}))})("change",function(){e.usT(t);const n=e.Gew(6),p=e.Gew(4),v=e.GaO();return e.CGJ(v.handleSliderYearChange({source:n,parent:p,value:n.value}))}),e.C$Y()(),e.I0R(7,"span"),e.OEk(8),e.C$Y(),e.yuY(9,Ic,2,1,"p",20),e.I0R(10,"div",21,22)(12,"mat-slide-toggle",23),e.qCj("change",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleFilterState())}),e.wVc(13,"translate"),e.C$Y(),e.I0R(14,"button",24),e.qCj("click",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.playYear(n))}),e.I0R(15,"mat-icon"),e.OEk(16),e.C$Y()(),e.I0R(17,"button",24),e.qCj("click",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.resetFilter(n))}),e.I0R(18,"mat-icon"),e.OEk(19),e.C$Y()()()()}if(2&l){const t=e.GaO();e.yG2(2),e.cNF(t.startYear),e.yG2(),e._6D("step",t.step),e.E7m("min",t.startYear)("max",t.endYear)("color",t.color)("disabled",!t.options.enabled||!t.layer.visible),e.yG2(2),e.E7m("value",t.handleSliderValue()),e.yG2(3),e.cNF(t.endYear),e.yG2(),e.E7m("ngIf",t.options.enabled),e.yG2(3),e.E7m("matTooltip",e.kDX(13,17,"igo.geo.filter.toggleFilterState"))("color",t.color)("checked",t.options.enabled)("disabled",!t.layer.visible),e.yG2(2),e.E7m("disabled",!t.options.enabled||!t.layer.visible),e.yG2(2),e.cNF(t.playIcon),e.yG2(),e.E7m("disabled",!t.options.enabled||!t.layer.visible),e.yG2(2),e.cNF(t.resetIcon)}}function Tc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",3)(1,"mat-slider",26,17),e.qCj("selectionChange",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.handleSliderDateChange(n))}),e.I0R(3,"input",27,19),e.qCj("input",function(){e.usT(t);const n=e.Gew(4),p=e.Gew(2),v=e.GaO();return e.CGJ(v.handleSliderDateChange({source:n,parent:p,value:n.value}))}),e.C$Y()(),e.I0R(5,"p",25),e.OEk(6),e.C$Y(),e.I0R(7,"button",28),e.qCj("click",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.playFilter(n))}),e.I0R(8,"mat-icon"),e.OEk(9),e.C$Y()()()}if(2&l){const t=e.GaO();e.yG2(),e._6D("step",t.step),e.E7m("min",t.dateToNumber(t.min))("max",t.dateToNumber(t.max)),e.yG2(2),e.E7m("value",t.handleSliderValue()),e.yG2(3),e.cNF(t.handleSliderTooltip()),e.yG2(3),e.cNF(t.playIcon)}}let qr=(()=>{class l{dateAdapter;layer;options;color="primary";date;startDate;endDate;year;startYear;endYear;initStartYear;initEndYear;listYears=[];startListYears=[];endListYears=[];set currentValue(t){if(t&&this.type!==Lt.U.YEAR){const i=t.split("/");if(i.length>0){const n=new Date(i[0]),p=new Date(i[1]);isNaN(n.valueOf())||(this.startDate=n),isNaN(p.valueOf())||(this.endDate=p)}}}interval;playIcon="play_circle";resetIcon="replay";change=new e._w7;yearChange=new e._w7;mySlider;get type(){return void 0===this.options.type?Lt.U.DATE:this.options.type}get isRange(){return void 0!==this.options.range&&this.options.style!==Lt.D.SLIDER&&this.options.range}get style(){return void 0===this.options.style?Lt.D.SLIDER:this.options.style}get step(){let t=108e5;if(void 0===this.options.step)switch(this.type){case Lt.U.DATE:case Lt.U.DATETIME:t=108e5;break;case Lt.U.TIME:t=36e5;break;case Lt.U.YEAR:t=31536e6;break;default:t=108e5}else t=this.getStepDefinition(this.options.step);return t}get timeInterval(){return void 0===this.options.timeInterval?2e3:this.options.timeInterval}get min(){if(this.options.min){const t=new Date(this.options.min);return new Date(t.getTime()+6e4*t.getTimezoneOffset())}}get max(){if(this.options.max){const t=new Date(this.options.max);return new Date(t.getTime()+6e4*t.getTimezoneOffset())}}get is(){return void 0!==this.options.range&&this.options.range}constructor(t){this.dateAdapter=t,this.dateAdapter.setLocale("fr")}ngOnInit(){if(void 0===this.startDate&&(this.startDate=new Date(this.min)),void 0===this.endDate&&(this.endDate=new Date(this.max)),void 0===this.startYear&&(this.startYear=new Date(this.startDate).getFullYear(),this.initStartYear=this.startYear),void 0===this.endYear&&(this.endYear=new Date(this.endDate).getFullYear(),this.initEndYear=this.endYear),this.isRange){for(let t=this.startYear;t<this.endYear;t++)this.startListYears.push(t);for(let t=this.startYear+1;t<=this.endYear;t++)this.endListYears.push(t)}else for(let t=this.startYear;t<=this.endYear+1;t++)this.listYears.push(t);this.options.enabled=void 0===this.options.enabled||this.options.enabled,this.checkFilterValue(),this.options.enabled?!this.isRange&&"slider"===this.style&&"year"===this.type&&this.yearChange.emit(this.year):(this.storeCurrentFilterValue(),this.yearChange.emit(void 0))}storeCurrentFilterValue(){!this.isRange&&this.style===Lt.D.SLIDER&&this.type===Lt.U.YEAR&&(this.options.value=this.year.toString())}checkFilterValue(){const i=this.layer.dataSource.ol.getParams().TIME;if(this.isRange||this.style!==Lt.D.SLIDER||this.type!==Lt.U.YEAR){if(this.isRange&&this.style===Lt.D.CALENDAR&&this.type===Lt.U.YEAR&&i){this.startYear=parseInt(i.substr(0,4),10),this.endYear=parseInt(i.substr(5,4),10);const n=[],p=[];for(let v=this.initStartYear;v<this.endYear;v++)n.push(v);for(let v=this.startYear+1;v<=this.initEndYear;v++)p.push(v);this.startListYears=n,this.endListYears=p}}else this.year=i?new Date(i.toString()).getFullYear()+1:this.options.value?new Date(this.options.value.toString()).getFullYear()+1:new Date(this.min).getFullYear()+1}handleDateChange(t){this.setupDateOutput(),this.applyTypeChange(),this.change.emit(this.isRange?[this.startDate,this.endDate]:this.startDate)}handleYearChange(t){if(this.isRange){this.endListYears=[];for(let i=this.startYear+1;i<=this.initEndYear;i++)this.endListYears.push(i);this.startListYears=[];for(let i=this.initStartYear+1;i<this.endYear;i++)this.startListYears.push(i);this.yearChange.emit([this.startYear,this.endYear])}else this.yearChange.emit(this.year)}handleListYearChange(t){this.handleYearChange([this.startYear,this.endYear])}handleListYearStartChange(t){this.change.emit([this.startDate,this.endDate])}dateToNumber(t){let i;return i=t?new Date(t):new Date(this.min),i.getTime()}setSliderThumbLabel(t){const i=this.findThumbLabel(this.mySlider._elementRef.nativeElement.childNodes);i&&(i.textContent=t)}findThumbLabel(t){let i;return t.forEach(n=>{"mat-slider-thumb-label-text"===n.className&&(i=n),n.children.length>0&&!i&&(i=this.findThumbLabel(n.childNodes))},this),i}toggleFilterState(){this.options.enabled=!this.options.enabled,this.options.enabled?!this.isRange&&Lt.D.SLIDER&&this.type===Lt.U.YEAR&&this.yearChange.emit(this.year):(this.stopFilter(),this.storeCurrentFilterValue(),this.change.emit(void 0))}resetFilter(t){this.date=new Date(this.min),this.year=this.date.getFullYear(),!this.isRange&&Lt.D.SLIDER&&this.type===Lt.U.YEAR?this.yearChange.emit(this.year):(this.setupDateOutput(),this.change.emit(void 0))}playFilter(t){this.interval?this.stopFilter():(this.playIcon="pause_circle",this.interval=setInterval(i=>{let n;const p=new Date(i.max);n=void 0===i.date?i.min.getTime():i.date.getTime(),n+=i.mySlider.step,i.date=new Date(n),n>p.getTime()&&i.stopFilter(),i.handleDateChange({value:i.date,date:i.date})},this.timeInterval,this))}playYear(t){this.year+this.mySlider.step>this.max.getFullYear()+this.mySlider.step&&(this.stopFilter(),this.resetFilter(t)),this.interval?this.stopFilter():(this.playIcon="pause_circle",this.interval=setInterval(()=>{this.year+this.mySlider.step>this.max.getFullYear()?this.stopFilter():this.year=this.year+this.mySlider.step,this.yearChange.emit(this.year)},this.timeInterval,this))}stopFilter(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play_circle"}handleSliderDateChange(t){this.date=new Date(t.value),this.setSliderThumbLabel(this.handleSliderTooltip()),this.handleDateChange(t)}handleSliderYearChange(t){this.year=t.value,this.yearChange.emit(this.year)}handleSliderValue(){return!0!==this.options.current&&this.min||(this.date=this.getRoundedDate(new Date)),this.type===Lt.U.YEAR?this.year:void 0===this.date?this.min.getTime():this.date.getTime()}handleSliderTooltip(){let t;switch(this.type){case Lt.U.DATE:t=void 0===this.date?this.min.toDateString():this.date.toDateString();break;case Lt.U.TIME:t=void 0===this.date?this.min.toTimeString():this.date.toTimeString();break;default:t=void 0===this.date?this.min.toUTCString():this.date.toUTCString()}return t}setupDateOutput(){this.style===Lt.D.SLIDER?(this.startDate=new Date(this.date),this.startDate.setSeconds(-this.step/1e3),this.endDate=new Date(this.startDate),this.endDate.setSeconds(this.step/1e3)):!this.isRange&&this.date?(this.endDate=new Date(this.date),this.startDate=new Date(this.date)):(!this.isRange||!this.date&&this.date)&&this.date||(this.startDate=void 0===this.startDate?new Date(this.min):this.startDate,this.endDate=void 0===this.endDate?new Date(this.max):this.endDate)}applyTypeChange(){switch(this.type){case Lt.U.DATE:(void 0!==this.startDate||void 0!==this.endDate)&&(this.startDate.setHours(0),this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setHours(23),this.endDate.setMinutes(59),this.endDate.setSeconds(59));break;case Lt.U.TIME:if(this.style===Lt.D.CALENDAR){if(this.startDate.getDay()!==this.min.getDay()){const t=this.startDate.getHours(),i=this.startDate.getMinutes();this.startDate=this.min,this.startDate.setHours(t),this.startDate.setMinutes(i)}if(this.endDate.getDay()!==this.min.getDay()){const t=this.endDate.getHours(),i=this.endDate.getMinutes();this.endDate=this.min,this.endDate.setHours(t),this.endDate.setMinutes(i)}}!this.isRange&&this.step>36e5&&(this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setMinutes(59),this.endDate.setSeconds(59))}}getRangeMinDate(){return void 0===this.startDate?this.min:this.startDate}getRangeMaxDate(){return void 0===this.endDate?this.max:this.endDate}getRoundedDate(t,i=10){const n=6e4*i;return new Date(Math.round(t.getTime()/n)*n)}getStepDefinition(t){return at().duration(t).asMilliseconds()}static \u0275fac=function(i){return new(i||l)(e.GI1(kt.Wu))};static \u0275cmp=e.In1({type:l,selectors:[["igo-time-filter-form"]],viewQuery:function(i,n){if(1&i&&e.CC$(Jt.Cg,5),2&i){let p;e.wto(p=e.Gqi())&&(n.mySlider=p.first)}},inputs:{layer:"layer",options:"options",currentValue:"currentValue"},outputs:{change:"change",yearChange:"yearChange"},standalone:!0,features:[e.UHJ],decls:5,vars:4,consts:[[4,"ngIf"],["class","igo-col igo-col-100 igo-col-100-m mat-typography",4,"ngIf"],["class","igo-col igo-col-100 igo-col-100-m",4,"ngIf"],[1,"igo-col","igo-col-100","igo-col-100-m"],["matSuffix","",1,"time-filter-mat-datetimepicker-toggle",3,"for"],[3,"type","openOnFocus","timeInterval"],["datetimePicker",""],["matInput","","autocomplete","false","readonly","readonly",3,"placeholder","matDatetimepicker","ngModel","min","max","ngModelChange","dateChange"],[1,"igo-col","igo-col-100"],["minDatetimePicker",""],["matInput","","autocomplete","false","readonly","readonly",3,"placeholder","matDatetimepicker","ngModel","min","max","ngModelChange","input","dateChange"],["maxDatetimePicker",""],[3,"placeholder","ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"igo-col","igo-col-100","igo-col-100-m","mat-typography"],["id","time-slider","thumbLabel","",3,"step","min","max","color","disabled"],["ngSlider",""],["matSliderThumb","",3,"value","input","change"],["ngSliderThumb","matSliderThumb"],["class","date-below",4,"ngIf"],[1,"igo-layer-actions-container"],["actions",""],["tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","checked","disabled","change"],["mat-icon-button","","color","primary",3,"disabled","click"],[1,"date-below"],["id","time-slider","thumbLabel","",3,"step","min","max","selectionChange"],["matSliderThumb","",3,"value","input"],["mat-icon-button","","color","primary",3,"click"]],template:function(i,n){1&i&&(e.yuY(0,yc,3,2,"div",0)(1,Oc,3,2,"div",0),e.wR5(2,"br"),e.yuY(3,wc,20,19,"div",1)(4,Tc,10,6,"div",2)),2&i&&(e.E7m("ngIf","calendar"===n.style&&"year"!==n.type),e.yG2(),e.E7m("ngIf","calendar"===n.style&&"year"===n.type),e.yG2(2),e.E7m("ngIf",!n.isRange&&"slider"===n.style&&"year"===n.type),e.yG2(),e.E7m("ngIf","slider"===n.style&&"year"!==n.type))},dependencies:[Ke.u_,yt.wb,yt.Up,yt.Gm,Sr._W,Sr.yA,Sr.eO,Sr.MH,kt.Ko,Bt.cN,Bt.yi,xe.y,xe.ot,xe.ue,xe._G,Gt.d5,Gt.kX,kt.I5,Ke.Iw,kt.Ax,Jt.yO,Jt.Cg,Jt._s,co.GE,co.cP,ht.KO,ht.a4,Ze.oJ,Ze.um,dt.oB,dt.qL,k._s,pe.sD],styles:["[_nghost-%COMP%]   .igo-layer-filters-container[_ngcontent-%COMP%]{padding-left:5px}[_nghost-%COMP%]   #time-slider[_ngcontent-%COMP%]{width:70%}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   #time-slider[_ngcontent-%COMP%]{width:60%}}[_nghost-%COMP%]   .date-below[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .igo-layer-actions-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}"]})}return l})();const Ec=l=>({disabled:l});function xc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",10),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.layer.visible=!n.layer.visible)}),e.wVc(1,"translate"),e.wVc(2,"translate"),e.I0R(3,"mat-icon",11),e.wVc(4,"async"),e.OEk(5),e.C$Y()()}if(2&l){const t=e.GaO(2);e.E7m("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.kDX(1,4,"igo.geo.layer.hideLayer"):e.kDX(2,6,"igo.geo.layer.showLayer")),e.yG2(3),e.E7m("ngClass",e.S45(10,Ec,!1===e.kDX(4,8,t.inResolutionRange$))),e.yG2(2),e.oRS("",t.layer.visible?"visibility":"visibility_off"," ")}}const Mc=l=>({cursor:l});function Dc(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-list-item")(1,"mat-icon",7),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleFiltersCollapsed())}),e.OEk(2," expand_less "),e.C$Y(),e.I0R(3,"span",8),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleLegendOnClick())}),e.OEk(4),e.C$Y(),e.yuY(5,xc,6,12,"button",9),e.C$Y()}if(2&l){const t=e.GaO(),i=e.Gew(2);e.yG2(),e.E7m("target",i)("collapsed",t.filtersCollapsed),e.yG2(2),e.E7m("ngStyle",e.S45(5,Mc,t.filtersCollapsed?"default":"pointer")),e.yG2(),e.cNF(t.layer.title),e.yG2(),e.E7m("ngIf",t.header)}}function Pc(l,m){if(1&l&&e.wR5(0,"igo-layer-legend",12),2&l){const t=e.GaO();e.E7m("layer",t.layer)}}let pr=(()=>{class l{timeFilterService;color="primary";showLegend$=new B.g(!1);inResolutionRange$=new B.g(!0);resolution$$;filtersCollapsed=!1;header=!0;layer;get datasource(){return this.layer.dataSource}constructor(t){this.timeFilterService=t}ngOnInit(){this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.inResolutionRange$.next(this.layer.isInResolutionsRange)})}ngOnDestroy(){this.resolution$$.unsubscribe()}handleYearChange(t){this.timeFilterService.filterByYear(this.datasource,t)}handleDateChange(t){this.timeFilterService.filterByDate(this.datasource,t)}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)}setVisible(){this.layer.visible=!0}toggleFiltersCollapsed(){this.filtersCollapsed=!this.filtersCollapsed}static \u0275fac=function(i){return new(i||l)(e.GI1(Ro))};static \u0275cmp=e.In1({type:l,selectors:[["igo-time-filter-item"]],inputs:{header:"header",layer:"layer"},standalone:!0,features:[e.M5G([Ro]),e.UHJ],decls:8,vars:7,consts:[[4,"ngIf"],[1,"igo-datasource-filters-container"],["filters",""],[1,"igo-layer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],[3,"layer","options","currentValue","change","yearChange"],["matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"target","collapsed","click"],["matListItemTitle","",3,"ngStyle","click"],["mat-icon-button","","matListItemMeta","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["mat-icon-button","","matListItemMeta","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],[3,"ngClass"],[3,"layer"]],template:function(i,n){1&i&&(e.yuY(0,Dc,6,7,"mat-list-item",0),e.I0R(1,"div",1,2)(3,"div",3,4),e.yuY(5,Pc,1,1,"igo-layer-legend",5),e.wVc(6,"async"),e.C$Y(),e.I0R(7,"igo-time-filter-form",6),e.qCj("change",function(v){return n.handleDateChange(v)})("yearChange",function(v){return n.handleYearChange(v)}),e.C$Y()()),2&i&&(e.E7m("ngIf",n.header),e.yG2(5),e.E7m("ngIf",e.kDX(6,5,n.showLegend$)),e.yG2(2),e.E7m("layer",n.layer)("options",n.datasource.options.timeFilter)("currentValue",n.datasource.options.params.TIME))},dependencies:[Ke.u_,Ot.iI,Ot.g9,Ot.Y1,Ot.UV,Ot.At,dt.oB,dt.qL,be.mK,Ke.Qt,Ze.oJ,Ze.um,ht.KO,ht.a4,Ke.QF,Ao,qr,Ke.a,k._s,pe.sD],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-datasource-filters-container[_ngcontent-%COMP%]{text-align:center;width:100%;display:inline-block;padding-top:5px}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:1.125em;width:calc(100% - 18px)}"]})}return l})();function Fc(l,m){if(1&l&&(e.I0R(0,"button",2),e.wVc(1,"translate"),e.I0R(2,"mat-icon",3),e.OEk(3,"history"),e.C$Y()()),2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,3,"igo.geo.filter.filterBy"))("color",t.color),e.yG2(2),e.E7m("matBadge",t.badge)}}function Rc(l,m){if(1&l&&e.wR5(0,"igo-time-filter-item",7),2&l){const t=e.GaO(2);e.E7m("header",!1)("layer",t.layer)}}function Lc(l,m){if(1&l&&(e.I0R(0,"div",4,5),e.yuY(2,Rc,1,2,"igo-time-filter-item",6),e.C$Y()),2&l){const t=e.GaO();e.yG2(2),e.E7m("ngIf",t.timeFilterCollapse&&t.options.timeFilter)}}let es=(()=>{class l{options;get badge(){const t=this.options.timeFilter;if(t&&t.enabled)return 1}get layer(){return this._layer}set layer(t){this._layer=t,t&&(this.options=this.layer.dataSource.options)}_layer;map;color="primary";header=!0;timeFilterCollapse=!1;constructor(){}ngOnInit(){this.options=this.layer.dataSource.options}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-time-filter-button"]],inputs:{layer:"layer",map:"map",color:"color",header:"header"},standalone:!0,features:[e.UHJ],decls:2,vars:2,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["class","igo-layer-actions-container",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium",3,"matBadge"],[1,"igo-layer-actions-container"],["ogcFilter",""],["igoListItem","",3,"header","layer",4,"ngIf"],["igoListItem","",3,"header","layer"]],template:function(i,n){1&i&&e.yuY(0,Fc,4,5,"button",0)(1,Lc,3,1,"div",1),2&i&&(e.E7m("ngIf",n.header&&n.options.timeFilterable&&n.options.timeFilter),e.yG2(),e.E7m("ngIf",n.header&&n.options.timeFilterable&&n.options.timeFilter))},dependencies:[Ke.u_,Ze.oJ,Ze.um,ht.KO,ht.a4,dt.oB,dt.qL,st.g,st.S,pr,be.qU,k._s,pe.sD],changeDetection:0})}return l})();function Gc(l,m){if(1&l&&e.wR5(0,"igo-time-filter-item",2),2&l){const t=m.$implicit;e.E7m("header",!0)("layer",t)}}let br=(()=>{class l{cdRef;get layers(){return this._layers}set layers(t){this._layers=t,this.cdRef.detectChanges()}_layers=[];constructor(t){this.cdRef=t}static \u0275fac=function(i){return new(i||l)(e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-time-filter-list"]],inputs:{layers:"layers"},standalone:!0,features:[e.UHJ],decls:3,vars:6,consts:[[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["igoListItem","",3,"header","layer"]],template:function(i,n){1&i&&(e.I0R(0,"igo-list",0),e.yuY(1,Gc,1,2,"ng-template",1),e.wVc(2,"filterableDataSource"),e.C$Y()),2&i&&(e.E7m("navigation",!1)("selection",!1),e.yG2(),e.E7m("ngForOf",e.g7$(2,3,n.layers,"time")))},dependencies:[be.yM,Ke.Iw,pr,be.qU,Eo],encapsulation:2,changeDetection:0})}return l})(),ts=(()=>{class l{mapService;component;layers$$;constructor(t,i){this.mapService=i,this.component=t}ngOnInit(){this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(t=>{this.component.layers=t})}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(i){return new(i||l)(e.GI1(br,2),e.GI1(Xn.u))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoTimeFilterListBinding",""]],standalone:!0})}return l})();function $c(l,m){if(1&l&&(e.I0R(0,"button",1),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"file_save"),e.C$Y()()),2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.download.action"))("color",t.color)}}let pa=(()=>{class l{get layer(){return this._layer}set layer(t){this._layer=t}_layer;get color(){return this._color}set color(t){this._color=t}_color="primary";constructor(){}get options(){if(this.layer)return this.layer.dataSource.options}layerIsExportable(){return!!(this.layer instanceof oo.Md&&!0===this.layer.exportable||this.layer.dataSource.options.download&&this.layer.dataSource.options.download.url||this.layer.options.workspace?.enabled&&this.layer.options.workspace?.workspaceId!==this.layer.id)}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-export-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[e.UHJ],decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"]],template:function(i,n){1&i&&e.yuY(0,$c,4,4,"button",0),2&i&&e.E7m("ngIf",n.layerIsExportable())},dependencies:[Ke.u_,Ze.oJ,Ze.um,ht.KO,ht.a4,dt.oB,dt.qL,k._s,pe.sD],changeDetection:0})}return l})();var Gn=r(53404),os=r(93176),Or=r(7036),ma=r(39732);let is=(()=>{class l{styleList={};httpClient;constructor(t){this.httpClient=new fe.KK(t)}getStyleList(t){return ae.Yv.resolve(this.styleList,t)}load(t){const i=t.default||{};return t.path?new Promise((n,p)=>{this.httpClient.get(t.path).pipe((0,se.a)(v=>(console.log(`StyleList file ${t.path} could not be read`),n(!0),(0,ma.c)(v.error||"Server error")))).subscribe(v=>{this.styleList=ae.Yv.mergeDeep(i,v),n(!0)})}):(this.styleList=i,!0)}static \u0275fac=function(i){return new(i||l)(e.CoB(fe.m))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var mr=r(82048),kc=r(83900),Ac=r(52280);class ga extends Error{}class ns extends ga{constructor(){super("Invalid file"),Object.setPrototypeOf(this,ns.prototype)}}class Ir extends ga{constructor(){super("Nothing to export"),Object.setPrototypeOf(this,Ir.prototype)}}const wt=(0,ae.GC)(["URL","GeoJSON","GML","GPX","KML","Shapefile","CSVcomma","CSVsemicolon"]),Zo=(0,ae.GC)(["UTF8","LATIN1"]);let wr=(()=>{class l{config;static ogreFormats={GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"ESRI Shapefile",CSVcomma:"CSVcomma",CSVsemicolon:"CSVsemicolon"};static noOgreFallbacks=["GML","GPX","KML"];ogreUrl;aggregateInComment=!0;constructor(t){this.config=t,this.ogreUrl=this.config.getConfig("importExport.url");const i=this.config.getConfig("importExport.gpxAggregateInComment");void 0!==i&&(this.aggregateInComment=i)}export(t,i,n,p,v="EPSG:4326",Y="EPSG:4326"){const ue=this.generateFeature(t,i,"_featureStore");return this.exportAsync(ue,i,n,p,v,Y)}generateFeature(t,i,n="_"){return i===wt.GPX&&this.aggregateInComment?this.generateAggregatedFeature(t):t.map(p=>{const Y=p.getKeys().filter(ue=>!ue.startsWith(n)).reduce((ue,ye)=>(ue[ye]=p.get(ye),ue),{geometry:p.getGeometry()});return new $i.c(Y)})}generateAggregatedFeature(t){return t.map(i=>{const n=i.getKeys().filter(ue=>!ue.startsWith("_"));let p="";const v=n.reduce((ue,ye)=>(ye&&"geometry"!==ye&&("id"===ye&&i.get("draw")?p+=ye+":"+i.get("draw")+"   \r\n":p+=ye+":"+i.get(ye)+"   \r\n"),ue[ye]=i.get(ye),ue),{geometry:i.getGeometry()}),Y=new $i.c(v);return Y.set("name",i.getId()),Y.set("cmt",p),Y})}exportAsync(t,i,n,p,v,Y){return new c._(ye=>{if(this.nothingToExport(t,i))ye.error(new Ir);else if(Object.keys(l.ogreFormats).indexOf(i)>=0){if(!this.ogreUrl)return void(l.noOgreFallbacks.indexOf(i)>=0?this.exportToFile(t,ye,i,n,v,Y):ye.error(new ns));this.exportWithOgre(t,ye,i,n,p,v,Y)}else this.exportToFile(t,ye,i,n,v,Y)})}exportToFile(t,i,n,p,v,Y){const ye=(new kc[n]).writeFeatures(t,{dataProjection:Y,featureProjection:v,featureType:"feature",featureNS:"http://example.com/feature"}),Ee=`${p}.${n.toLowerCase()}`;(0,ae.We)(ye,"attachment/plain;charset=utf-8",Ee),i.complete()}exportWithOgre(t,i,n,p,v,Y,ue){let ye=(new Z.c).writeFeatures(t,{dataProjection:ue,featureProjection:Y});const Ee=`${this.ogreUrl}/convertJson`,we=document.createElement("form");if(we.style.display="none",document.body.appendChild(we),we.setAttribute("method","post"),we.setAttribute("target","_blank"),we.setAttribute("action",Ee),v===Zo.UTF8)we.acceptCharset="UTF-8",we.enctype="application/x-www-form-urlencoded; charset=utf-8;";else if(v===Zo.LATIN1){const Tt="ISO-8859-1",jt=JSON.parse(ye);jt.features.map(Wo=>{const er=String.fromCharCode.apply(null,(0,Ac.OW)(JSON.stringify(Wo.properties),{mode:"replacement"}));Wo.properties=JSON.parse(er)}),ye=JSON.stringify(jt);const Co=document.createElement("input");Co.setAttribute("type","hidden"),Co.setAttribute("name","encoding"),Co.setAttribute("value",Tt),we.appendChild(Co)}if("CSVsemicolon"===n){const Tt=document.createElement("input");Tt.setAttribute("type","hidden"),Tt.setAttribute("name","lco"),Tt.setAttribute("value","SEPARATOR=SEMICOLON"),we.appendChild(Tt)}const Le=document.createElement("input");Le.setAttribute("type","hidden"),Le.setAttribute("name","json"),Le.setAttribute("value",ye),we.appendChild(Le);const Xe=document.createElement("input");let Ge="Shapefile"===n?`${p}.zip`:`${p}.${n.toLowerCase()}`;("CSVcomma"===n||"CSVsemicolon"===n)&&(Ge=`${p}.csv`),Ge=Ge.replace(" ","_"),Ge=Ge.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\u2019/g,"'"),Xe.setAttribute("type","hidden"),Xe.setAttribute("name","outputName"),Xe.setAttribute("value",Ge),we.appendChild(Xe);let tt=l.ogreFormats[n];("CSVcomma"===n||"CSVsemicolon"===n)&&(tt="CSV");const pt=document.createElement("input");pt.setAttribute("type","hidden"),pt.setAttribute("name","format"),pt.setAttribute("value",tt),we.appendChild(pt),we.submit(),document.body.removeChild(we),i.complete()}nothingToExport(t,i){return 0===t.length||"GPX"===i&&void 0===t.find(p=>["Point","LineString","MultiLineString"].indexOf(p.getGeometry().getType())>=0)}static \u0275fac=function(i){return new(i||l)(e.CoB(A.aW))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var ha=r(17439),fa=r(51176),ya=r(79084);class Qn extends Error{}class Tr extends Qn{constructor(){super("Invalid file"),Object.setPrototypeOf(this,Tr.prototype)}}class $n extends Qn{constructor(){super("Failed to read file"),Object.setPrototypeOf(this,$n.prototype)}}class Er extends Qn{constructor(){super("Nothing to import"),Object.setPrototypeOf(this,Er.prototype)}}class Vc extends Qn{constructor(){super("File is too large"),Object.setPrototypeOf(this,Er.prototype)}}class jc extends Qn{constructor(){super("Invalid SRS definition"),Object.setPrototypeOf(this,Er.prototype)}}class rs extends Qn{constructor(){super("Error 500 with OGRE"),Object.setPrototypeOf(this,rs.prototype)}}var gr=r(14672),xr=r(59800);function Mr(l){return l.toString().padStart(2,"0")}function Dr(l,m,t,i,n,p,v,Y,ue){if(0===m.length)return void function Xc(l,m){m.error("igo.geo.dropGeoFile.empty.text","igo.geo.dropGeoFile.empty.title",void 0,{value:l.name,mimeType:l.type})}(l,n);let ye=ss(l);(v?v.open("igo.geo.import.promptStoreToIdb"):(0,z.of)(!1)).pipe((0,$.K)()).subscribe(we=>{const Le=new Date,Xe=[Le.getFullYear(),Mr(Le.getMonth()+1),Mr(Le.getDate())].join("/")+" "+[Mr(Le.getHours()),Mr(Le.getMinutes())].join(":");ye=we?`${ye} (${Xe})`:ye,Y?function Wc(l,m,t,i,n,p,v,Y,ue=!0){const ye=l.map(Ge=>(0,gr.K6)(Ge,m.projection));let Ee,we,Le;if(i.getStyleList(t.toString()+".styleByAttribute")){const Ge=i.getStyleList(t.toString()+".styleByAttribute");Ee=(tt,pt)=>n.createStyleByAttribute(tt,Ge,pt)}else if(i.getStyleList(t.toString()+".clusterStyle")){const Ge=i.getStyleList(t.toString()+".clusterParam");we=i.getStyleList(t.toString()+".distance"),Ee=(tt,pt)=>{const Tt=n.createStyle(i.getStyleList(t.toString()+".clusterStyle"),tt,pt);return n.createClusterStyle(tt,pt,Ge,Tt)}}else if(i.getStyleList(t.toString()+".style"))Ee=(Ge,tt)=>n.createStyle(i.getStyleList(t.toString()+".style"),Ge,tt);else if(i.getStyleList("default.clusterStyle")&&"Point"===l[0].geometry.type){const Ge=i.getStyleList("default.clusterParam");we=i.getStyleList("default.distance"),Ee=(tt,pt)=>{const Tt=n.createStyle(i.getStyleList("default.clusterStyle"),tt,pt);return n.createClusterStyle(tt,pt,Ge,Tt)}}else Ee=(Ge,tt)=>n.createStyle(i.getStyleList("default.style"),Ge,tt);i.getStyleList(t.toString()+".clusterStyle")?(Le=new os.a(Object.assign({distance:we,type:"cluster",queryable:!0},v)),Le.ol.source.addFeatures(ye)):i.getStyleList(t.toString())?(Le=new ve.E(Object.assign({type:"vector",queryable:!0},v)),Le.ol.addFeatures(ye)):i.getStyleList("default.clusterStyle")&&"Point"===l[0].geometry.type?(Le=new os.a(Object.assign({distance:we,type:"cluster",queryable:!0},v)),Le.ol.source.addFeatures(ye)):(Le=new ve.E(Object.assign({type:"vector",queryable:!0},v)),Le.ol.addFeatures(ye));const Xe=new vt.M(Object.assign({title:t,id:p||(0,ae.uq)(),isIgoInternalLayer:!0,source:Le,style:Ee},Y));m.addLayer(Xe),ue&&(0,gr.QX)(m.viewController,ye)}(m,t,ye,Y,ue):function Kc(l,m,t,i,n,p=!1){const v=l.map(Xe=>(0,gr.K6)(Xe,m.projection)),Y=(0,ae.uq)(),ye=new ve.E({id:Y,type:"vector",queryable:!0});ye.ol.addFeatures(v);let Ee,we=!1;v[0].getKeys().includes("_style")||v[0].getKeys().includes("_mapTitle")?Ee=(0,xr.M4)():(Ee=(0,xr.Cy)(),we=!0);const Le=n.createLayer({id:Y,title:i,workspace:{enabled:!0,searchIndexEnabled:!0},isIgoInternalLayer:!0,source:ye,igoStyle:{editable:we},idbInfo:{firstLoad:!0,storeToIdb:p,contextUri:t||"*"},style:Ee});Le.setExtent((0,gr.q1)(v,m.viewProjection)),m.addLayer(Le),(0,gr.QX)(m.viewController,v)}(m,t,i,ye,p,we),n.success("igo.geo.dropGeoFile.success.text","igo.geo.dropGeoFile.success.title",void 0,{value:ye})})}function Nc(l,m,t){t.error("igo.geo.dropGeoFile.invalid.text","igo.geo.dropGeoFile.invalid.title",void 0,{value:l.name,mimeType:l.type})}function Hc(l,m,t){t.error("igo.geo.dropGeoFile.unreadable.text","igo.geo.dropGeoFile.unreadable.title",void 0,{value:l.name})}function zc(l,m,t,i){t.error("igo.geo.dropGeoFile.tooLarge.text","igo.geo.dropGeoFile.tooLarge.title",void 0,{value:l.name,size:i})}function Jc(l,m){m.error("igo.geo.dropGeoFile.invalidSRS.text","igo.geo.dropGeoFile.invalidSRS.title",void 0,{value:l.name,mimeType:l.type})}function Qc(l,m,t){t.error("igo.geo.dropGeoFile.ogreServer.text","igo.geo.dropGeoFile.ogreServer.title")}function Ca(l){return l.name.split(".").pop().toLowerCase()}function ss(l){return l.name.substr(0,l.name.lastIndexOf("."))}let va=(()=>{class l{http;config;static formatExtensionAssociation={GeoJSON:"geojson",GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"zip"};static allowedMimeTypes=["application/gml+xml","application/vnd.google-earth.kml+xml","application/gpx+xml","application/json"];static allowedZipMimeTypes=["application/zip","application/x-zip-compressed","application/x-zip"];static allowedExtensions=["geojson","kml","gpx","json","gml","zip"];ogreUrl;clientSideFileSizeMax;constructor(t,i){this.http=t,this.config=i;const n=this.config.getConfig("importExport");this.ogreUrl=n.url,this.clientSideFileSizeMax=(n.clientSideFileSizeMaxMb||30)*Math.pow(1024,2),n.formats&&(l.allowedExtensions=n.formats.map(v=>l.formatExtensionAssociation[v]).filter(v=>v),l.allowedExtensions.includes("geojson")&&l.allowedExtensions.push("json"))}import(t,i="EPSG:4326",n="EPSG:4326"){return this.importAsync(t,i,n)}getFileImporter(t){const i=Ca(t),n=l.allowedExtensions;let p=[];n.includes("zip")&&(p=l.allowedZipMimeTypes);const v=t.type;if(!([...l.allowedMimeTypes,...p].indexOf(v)<0&&n.indexOf(i)<0)){if("application/json"===v||["json","geojson","kml","gpx"].indexOf(i)>=0)return this.importFile;if(void 0!==this.ogreUrl)return this.importFileWithOgre}}importAsync(t,i,n){return new c._(v=>{if(t.size>=this.clientSideFileSizeMax)return void v.error(new Vc);const Y=this.getFileImporter(t);void 0!==Y?Y.call(this,t,v,i,n):v.error(new Tr)})}importFile(t,i,n,p){const v=new FileReader;v.onload=Y=>{try{const ue=this.parseFeaturesFromFile(t,Y.target.result,n,p);i.next(ue)}catch{i.error(new $n)}i.complete()},v.onerror=Y=>{i.error(new $n)},v.readAsText(t,"UTF-8")}importFileWithOgre(t,i,n,p){const v=`${this.ogreUrl}/convert`,Y=new FormData;Y.append("upload",t),Y.append("sourceSrs",n),Y.append("targetSrs",p),Y.append("formatOutput","GEOJSON"),Y.append("skipFailures",""),this.http.post(v,Y,{headers:new fe.UD}).subscribe(ue=>{if(null!==ue)if((ue.errors||[]).length>0)i.error(new $n);else{const Ee=this.parseFeaturesFromGeoJSON(t,ue,p);i.next(Ee),i.complete()}else i.error(new $n)},ue=>{ue.error.caught=!0;const ye=ue.error.msg||"";"No valid files found"===ye?i.error(new Tr):ye&&ye.startWith("ERROR 1: Failed to process SRS definition")?i.error(new jc):i.error(500===ue.status?new rs:new $n)})}parseFeaturesFromFile(t,i,n,p){const v=Ca(t),Y=t.type,ue=new Z.c;let ye;if("application/vnd.google-earth.kml+xml"===Y)ye=new ha.cp;else if("application/gml+xml"===Y)ye=new fa.c;else if("application/gpx+xml"===Y)ye=new ya.c;else switch(v){case"kml":ye=new ha.cp;break;case"gpx":ye=new ya.c;break;case"gml":ye=new fa.c;break;default:ye=ue}return ye.readFeatures(i,{dataProjection:n,featureProjection:p}).map(Le=>Object.assign(ue.writeFeatureObject(Le),{projection:p,meta:{id:(0,ae.uq)(),title:ss(t)}}))}parseFeaturesFromGeoJSON(t,i,n){const p=new Z.c;return p.readFeatures(i).map(ue=>Object.assign(p.writeFeatureObject(ue),{projection:n,meta:{id:(0,ae.uq)(),title:ss(t)}}))}static \u0275fac=function(i){return new(i||l)(e.CoB(fe.KK),e.CoB(A.aW))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function Zc(l,m){if(1&l&&(e.I0R(0,"p",16),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=e.GaO().$implicit;e.yG2(),e.oRS(" ",e.g7$(2,1,"igo.geo.importExportForm.projections."+t.translateKey,t)," ")}}function qc(l,m){if(1&l&&(e.I0R(0,"p",16),e.OEk(1),e.C$Y()),2&l){const t=e.GaO().$implicit;e.yG2(),e.oRS(" ",t.alias," ")}}function eu(l,m){if(1&l&&(e.I0R(0,"mat-option",14),e.qCj("click",function(i){return i.stopPropagation()}),e.yuY(1,Zc,3,4,"p",15)(2,qc,2,1,"p",15),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.E7m("ngIf",t.translateKey),e.yG2(),e.E7m("ngIf",!t.translateKey)}}function tu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"form",5)(1,"div",6)(2,"mat-form-field")(3,"mat-label"),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.I0R(6,"mat-select",7),e.iHE("valueChange",function(n){e.usT(t);const p=e.GaO();return e.kNx(p.inputProj,n)||(p.inputProj=n),e.CGJ(n)}),e.yuY(7,eu,3,3,"mat-option",8),e.wVc(8,"async"),e.C$Y()()(),e.I0R(9,"div",9),e.wVc(10,"translate"),e.wVc(11,"translate"),e.I0R(12,"button",10),e.qCj("click",function(){e.usT(t);const n=e.Gew(19);return e.CGJ(n.click())}),e.wVc(13,"async"),e.OEk(14),e.wVc(15,"translate"),e.C$Y(),e.wR5(16,"igo-spinner",11),e.wVc(17,"async"),e.I0R(18,"input",12,13),e.qCj("click",function(){e.usT(t);const n=e.Gew(19);return e.CGJ(n.value=null)})("change",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.importFiles(n.target.files))}),e.C$Y()()()}if(2&l){const t=e.GaO();e.E7m("formGroup",t.importForm),e.yG2(4),e.cNF(e.kDX(5,10,"igo.geo.importExportForm.importProjPlaceholder")),e.yG2(2),e.OKB("value",t.inputProj),e.yG2(),e.E7m("ngForOf",e.kDX(8,12,t.projections$)),e.yG2(2),e.E7m("matTooltip",t.importForm.invalid?e.kDX(10,14,"igo.geo.importExportForm.projections.choose"):e.kDX(11,16,"igo.geo.importExportForm.importButton")),e.yG2(3),e.E7m("disabled",t.importForm.invalid||e.kDX(13,18,t.loading$)),e.yG2(2),e.oRS(" ",e.kDX(15,20,"igo.geo.importExportForm.importButton")," "),e.yG2(2),e.E7m("shown",e.kDX(17,22,t.loading$)),e.yG2(2),e.m4B("display","none")}}const ou=l=>({size:l});function iu(l,m){if(1&l&&(e.I0R(0,"div")(1,"h4"),e.OEk(2),e.wVc(3,"translate"),e.C$Y(),e.I0R(4,"ul")(5,"li"),e.OEk(6),e.wVc(7,"translate"),e.C$Y(),e.I0R(8,"li"),e.OEk(9),e.wVc(10,"translate"),e.C$Y(),e.I0R(11,"li"),e.OEk(12),e.wVc(13,"translate"),e.C$Y()()()),2&l){const t=e.GaO(2);e.yG2(2),e.cNF(e.kDX(3,4,"igo.geo.importExportForm.importClarifications")),e.yG2(4),e.oRS(" ",e.g7$(7,6,"igo.geo.importExportForm.importSizeMax",e.S45(13,ou,t.fileSizeMb))," "),e.yG2(3),e.oRS(" ",e.kDX(10,9,"igo.geo.importExportForm.importFormatAuthorized")," "),e.yG2(3),e.cNF(e.kDX(13,11,"igo.geo.importExportForm.importShpZip"))}}function nu(l,m){if(1&l&&e.wR5(0,"igo-custom-html",20),2&l){const t=e.GaO(2);e.E7m("html",t.importHtmlClarifications)}}function ru(l,m){if(1&l&&(e.I0R(0,"section",17),e.yuY(1,iu,14,15,"div",18)(2,nu,1,1,"igo-custom-html",19),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",""===t.importHtmlClarifications),e.yG2(),e.E7m("ngIf",""!==t.importHtmlClarifications)}}function su(l,m){1&l&&(e.I0R(0,"section",17)(1,"h4"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()),2&l&&(e.yG2(2),e.cNF(e.kDX(3,1,"igo.geo.importExportForm.exportNoLayersExportable")))}function au(l,m){if(1&l&&(e.I0R(0,"span",31),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=e.GaO(2);e.yG2(),e.CAO(" (+",t.layers.length-1," ",e.kDX(2,2,2===(null==t.layers?null:t.layers.length)?"igo.geo.importExportForm.other":"igo.geo.importExportForm.others"),") ")}}function lu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",34),e.qCj("click",function(n){e.usT(t);const p=e.GaO().$implicit,v=e.GaO(2);return e.CGJ(v.onlySelectedClick(n,p.id))})("checked",function(){e.usT(t);const n=e.GaO().$implicit,p=e.GaO(2);return e.CGJ(p.inLayersIdToExportSelectionOnly(n))})("change",function(n){e.usT(t);const p=e.GaO().$implicit,v=e.GaO(2);return e.CGJ(v.onlySelected(n,p.id))}),e.I0R(1,"small"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()}2&l&&(e.yG2(2),e.cNF(e.kDX(3,1,"igo.geo.importExportForm.exportSelectedFeature")))}const cu=l=>({"igo-export-layer-mat-option":l});function uu(l,m){if(1&l&&(e.I0R(0,"mat-option",32),e.qCj("click",function(i){return i.stopPropagation()}),e.I0R(1,"p",16),e.OEk(2),e.C$Y(),e.I0R(3,"p",16),e.yuY(4,lu,4,3,"mat-slide-toggle",33),e.C$Y()()),2&l){const t=m.$implicit,i=e.GaO(2);e.E7m("ngClass",e.S45(4,cu,i.layerHasSelectedFeatures(t)))("value",t.id),e.yG2(2),e.cNF(t.title),e.yG2(2),e.E7m("ngIf",i.layerHasSelectedFeatures(t))}}function du(l,m){if(1&l&&(e.I0R(0,"mat-option",2),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.export.format."+t.value)," ")}}function pu(l,m){if(1&l&&(e.SAx(0),e.yuY(1,du,3,4,"mat-option",35),e.wVc(2,"keyvalue"),e.wVc(3,"async"),e.k70()),2&l){const t=e.GaO(2);e.yG2(),e.E7m("ngForOf",e.kDX(2,1,e.kDX(3,3,t.formats$)))}}function mu(l,m){1&l&&(e.I0R(0,"mat-option",36),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.export.noFormat.title")," "))}function gu(l,m){1&l&&(e.I0R(0,"div",6)(1,"mat-form-field"),e.wR5(2,"input",37),e.wVc(3,"translate"),e.C$Y()()),2&l&&(e.yG2(2),e._6D("placeholder",e.kDX(3,1,"igo.geo.importExportForm.exportFileNamePlaceholder")))}function hu(l,m){if(1&l&&(e.I0R(0,"mat-option",2),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.export.encoding."+t.value)," ")}}function fu(l,m){if(1&l&&(e.SAx(0),e.yuY(1,hu,3,4,"mat-option",35),e.wVc(2,"keyvalue"),e.wVc(3,"async"),e.k70()),2&l){const t=e.GaO(3);e.yG2(),e.E7m("ngForOf",e.kDX(2,1,e.kDX(3,3,t.encodings$)))}}function yu(l,m){if(1&l&&(e.I0R(0,"div",6)(1,"mat-form-field")(2,"mat-label"),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"mat-select",38),e.yuY(6,fu,4,5,"ng-container",18),e.wVc(7,"async"),e.C$Y()()()),2&l){const t=e.GaO(2);e.yG2(3),e.cNF(e.kDX(4,2,"igo.geo.importExportForm.encodingPlaceholder")),e.yG2(3),e.E7m("ngIf",0!==e.kDX(7,4,t.encodings$).length)}}function _u(l,m){1&l&&(e.I0R(0,"div",39)(1,"mat-slide-toggle",40),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()),2&l&&(e.yG2(),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(3,2,"igo.geo.importExportForm.exportCombineResults")," "))}function Cu(l,m){1&l&&(e.I0R(0,"div",41)(1,"mat-slide-toggle",42),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()),2&l&&(e.yG2(),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(3,2,"igo.geo.importExportForm.exportSeparator")," "))}function vu(l,m){1&l&&(e.I0R(0,"div",43)(1,"mat-slide-toggle",44),e.OEk(2),e.wVc(3,"translate"),e.C$Y()()),2&l&&(e.yG2(),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(3,2,"igo.geo.importExportForm.exportFeatureInExtent")," "))}function Su(l,m){if(1&l&&e.wR5(0,"igo-custom-html",20),2&l){const t=e.GaO(2);e.E7m("html",t.exportHtmlClarifications)}}function bu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"form",5)(1,"div",6)(2,"mat-form-field")(3,"mat-label"),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.I0R(6,"mat-select",21),e.iHE("valueChange",function(n){e.usT(t);const p=e.GaO();return e.kNx(p.layers,n)||(p.layers=n),e.CGJ(n)}),e.I0R(7,"mat-select-trigger"),e.OEk(8),e.yuY(9,au,3,4,"span",22),e.C$Y(),e.yuY(10,uu,5,6,"mat-option",23),e.wVc(11,"async"),e.C$Y()()(),e.I0R(12,"div",6)(13,"mat-form-field")(14,"mat-label"),e.OEk(15),e.wVc(16,"translate"),e.C$Y(),e.I0R(17,"mat-select",24),e.yuY(18,pu,4,5,"ng-container",18),e.wVc(19,"async"),e.yuY(20,mu,3,3,"mat-option",25),e.wVc(21,"async"),e.C$Y()()(),e.yuY(22,gu,4,3,"div",26)(23,yu,8,6,"div",26)(24,_u,4,4,"div",27)(25,Cu,4,4,"div",28)(26,vu,4,4,"div",29),e.I0R(27,"div",30)(28,"button",10),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.handleExportFormSubmit(n.form.value))}),e.wVc(29,"async"),e.OEk(30),e.wVc(31,"translate"),e.wVc(32,"translate"),e.wVc(33,"translate"),e.C$Y(),e.wR5(34,"igo-spinner",11),e.wVc(35,"async"),e.C$Y(),e.yuY(36,Su,1,1,"igo-custom-html",19),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("formGroup",t.form),e.yG2(4),e.cNF(e.kDX(5,18,"igo.geo.importExportForm.exportLayerPlaceholder")),e.yG2(2),e.OKB("value",t.layers),e.yG2(2),e.oRS(" ",t.layers.length?t.getLayerTitleById(t.layers[0]):""," "),e.yG2(),e.E7m("ngIf",t.layers.length>1),e.yG2(),e.E7m("ngForOf",e.kDX(11,20,t.exportableLayers$)),e.yG2(5),e.cNF(e.kDX(16,22,"igo.geo.importExportForm.exportFormatPlaceholder")),e.yG2(3),e.E7m("ngIf",0!==e.kDX(19,24,t.formats$).length),e.yG2(2),e.E7m("ngIf",0===e.kDX(21,26,t.formats$).length),e.yG2(2),e.E7m("ngIf",t.forceNaming&&"URL"!==t.form.value.format),e.yG2(),e.E7m("ngIf","CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format),e.yG2(),e.E7m("ngIf",t.layers.length>1&&("CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format)),e.yG2(),e.E7m("ngIf",t.layers.length>1&&("CSVcomma"===t.form.value.format||"CSVsemicolon"===t.form.value.format)&&t.form.value.combineLayers),e.yG2(),e.E7m("ngIf","URL"!==t.form.value.format),e.yG2(2),e.E7m("disabled",!t.form.valid||e.kDX(29,28,t.loading$)),e.yG2(2),e.oRS(" ","URL"!==t.form.value.format?e.kDX(31,30,"igo.geo.importExportForm.exportButton"):t.form.value.layers.length>1?e.kDX(32,32,"igo.geo.importExportForm.exportButtonLinks"):e.kDX(33,34,"igo.geo.importExportForm.exportButtonLink")," "),e.yG2(4),e.E7m("shown",e.kDX(35,36,t.loading$)),e.yG2(2),e.E7m("ngIf",""!==t.exportHtmlClarifications)}}let Sa=(()=>{class l{importService;exportService;languageService;messageService;styleListService;styleService;formBuilder;config;cdRef;storageService;downloadService;layerService;confirmDialogService;form;importForm;formats$=new B.g(void 0);encodings$=new B.g(void 0);exportableLayers$=new B.g([]);loading$=new B.g(!1);forceNaming=!1;controlFormat="format";layers$$;exportableLayers$$;formats$$;encodings$$;formLayer$$;exportOptions$$;importHtmlClarifications;exportHtmlClarifications;espgCodeRegex=new RegExp("^\\d{4,6}");clientSideFileSizeMax;fileSizeMb;projections$=new B.g([]);projectionsConstraints;popupChecked=!1;previousLayerSpecs$=new B.g(void 0);selectFirstProj=!1;map;contextUri;_projectionsLimitations={};set projectionsLimitations(t){this._projectionsLimitations=t,this.computeProjections()}get projectionsLimitations(){return this._projectionsLimitations||{}}store;selectedMode="import";selectMode=new e._w7;exportOptions$=new B.g(void 0);exportOptionsChange=new e._w7;get layers(){return this.form.get("layers").value}set layers(t){this.form.patchValue({layers:t})}get inputProj(){return this.importForm.get("inputProj").value}set inputProj(t){this.importForm.patchValue({inputProj:t})}get popupAllowed(){return this.storageService.get("importExportPopupAllowed")||!1}set popupAllowed(t){this.storageService.set("importExportPopupAllowed",t)}constructor(t,i,n,p,v,Y,ue,ye,Ee,we,Le,Xe,Ge){this.importService=t,this.exportService=i,this.languageService=n,this.messageService=p,this.styleListService=v,this.styleService=Y,this.formBuilder=ue,this.config=ye,this.cdRef=Ee,this.storageService=we,this.downloadService=Le,this.layerService=Xe,this.confirmDialogService=Ge,this.loadConfig(),this.buildForm(),this.computeProjections(),this.importHtmlClarifications=this.languageService.translate.instant("igo.geo.importExportForm.importHtmlClarifications"),this.exportHtmlClarifications=this.languageService.translate.instant("igo.geo.importExportForm.exportHtmlClarifications")}ngOnInit(){this.layers$$=this.map.layers$.subscribe(i=>{this.exportableLayers$.next(i.filter(n=>n instanceof vt.M&&!0===n.exportable||n.dataSource.options.download&&n.dataSource.options.download.url))});const t=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(t||30)*Math.pow(1024,2),this.fileSizeMb=this.clientSideFileSizeMax/Math.pow(1024,2),this.exportOptions$$=this.exportOptions$.pipe((0,Gn.O)(i=>!i)).subscribe(i=>{this.form.patchValue(i,{emitEvent:!0}),i.layers&&this.computeFormats(i.layers.map(n=>this.map.getLayerById(n)))}),this.formLayer$$=this.form.get("format").valueChanges.subscribe(i=>{const n=Object.keys(wr.ogreFormats);!this.popupChecked&&this.form.get("layers").value?.length>1&&(n.indexOf(i)>=0||i===wt.URL)&&(this.handlePopup(!0)||this.form.patchValue({format:void 0},{emitEvent:!1}))}),this.formLayer$$=this.form.get("layers").valueChanges.subscribe(i=>{this.handlePreviousLayerSpecs();const n=i instanceof Array?i:[i];this.form.patchValue({layers:n},{emitEvent:!1});const p=n.map(Y=>this.map.getLayerById(Y));this.computeFormats(p),-1===Object.keys(this.formats$.value).indexOf(this.form.value.format)&&this.form.patchValue({format:void 0}),this.loading$.next(!0);const v=[];p.forEach(Y=>{Y instanceof vt.M&&0===Y.dataSource.ol.getFeatures().length&&(v.push({id:Y.id,visible:Y.visible,opacity:Y.opacity,queryable:Y.queryable}),Y.opacity=0,Y.visible=!0)}),this.previousLayerSpecs$.next(v),setTimeout(()=>{this.loading$.next(!1)},500)}),this.formats$$=this.formats$.pipe((0,Gn.O)(i=>!i)).subscribe(i=>{1===Object.keys(i).length&&this.form.patchValue({format:i[Object.keys(i)[0]]})}),this.encodings$$=this.encodings$.pipe((0,Gn.O)(i=>!i)).subscribe(i=>{1===Object.keys(i).length&&this.form.patchValue({encoding:i[Object.keys(i)[0]]})}),this.exportableLayers$$=this.exportableLayers$.pipe((0,Gn.O)(i=>!i)).subscribe(i=>{1===i.length&&this.form.patchValue({layers:i[0].id})}),this.form.controls[this.controlFormat].valueChanges.subscribe(i=>{this.form.patchValue(i===wt.CSVcomma||i===wt.CSVsemicolon?{encoding:Zo.LATIN1}:{encoding:Zo.UTF8}),this.cdRef.detectChanges()}),this.importForm.patchValue(this.selectFirstProj?0===this.projections$.value.length?{inputProj:{translateKey:"nad83",alias:"NAD83",code:"EPSG:4326",zone:""}}:{inputProj:this.projections$.value[0]}:{inputProj:void 0})}computeProjections(){this.projectionsConstraints=(0,Hr.KG)(this.projectionsLimitations);const t=[];if(this.projectionsConstraints.nad83&&t.push({translateKey:"nad83",alias:"NAD83",code:"EPSG:4269",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.wgs84&&t.push({translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.webMercator&&t.push({translateKey:"webMercator",alias:"Web Mercator",code:"EPSG:3857",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.mtm){const p=this.projectionsConstraints.mtmZone.maxZone;for(let v=this.projectionsConstraints.mtmZone.minZone;v<=p;v++)t.push({translateKey:"mtm",alias:`MTM ${v}`,code:v<10?`EPSG:3218${v}`:`EPSG:321${80+v}`,zone:`${v}`,extent:void 0,def:void 0})}if(this.projectionsConstraints.utm){const p=this.projectionsConstraints.utmZone.maxZone;for(let v=this.projectionsConstraints.utmZone.minZone;v<=p;v++)t.push({translateKey:"utm",alias:`UTM ${v}`,code:v<10?`EPSG:3260${v}`:`EPSG:326${v}`,zone:`${v}`,extent:void 0,def:void 0})}let i=[];this.projectionsConstraints.projFromConfig&&(i=this.config.getConfig("projections")||[]),this.projections$.next(i.concat(t))}getWorkspaceByLayerId(t){const i=this.store.all().find(n=>n.layer.id===t);if(i)return i}getLayerTitleById(t){return this.map.getLayerById(t)?.title}layerHasSelectedFeatures(t){const i=this.getWorkspaceByLayerId(t.id);if(i)return!!i.entityStore.stateView.firstBy(p=>!0===p.state.selected)}onlySelected(t,i){let n=this.form.value.layersWithSelection;t.checked?n.push(i):n=n.filter(p=>p!==i),this.form.patchValue({layersWithSelection:n})}onlySelectedClick(t,i){this.form.value.layers.find(n=>n===i)&&t.stopPropagation()}inLayersIdToExportSelectionOnly(t){return!!this.form.value.layersWithSelection.find(i=>i===t.id)}ngOnDestroy(){this.layers$$.unsubscribe(),this.exportableLayers$$.unsubscribe(),this.formats$$.unsubscribe(),this.encodings$$.unsubscribe(),this.formLayer$$.unsubscribe(),this.exportOptions$$&&this.exportOptions$$.unsubscribe(),this.exportOptionsChange.emit(this.form.value),this.handlePreviousLayerSpecs()}handlePreviousLayerSpecs(){const t=this.previousLayerSpecs$.value;t&&t.length&&t.forEach(i=>{const n=this.map.getLayerById(i.id);n.visible=i.visible,n.opacity=i.opacity,n.queryable=i.queryable}),this.previousLayerSpecs$.next(void 0)}importFiles(t){let i=this.inputProj.code;this.espgCodeRegex.test(i)&&(i=`EPSG:${i}`),this.loading$.next(!0);for(const n of t)this.importService.import(n,i).subscribe(p=>this.onFileImportSuccess(n,p),p=>this.onFileImportError(n,p),()=>{this.loading$.next(!1)})}handlePopup(t=!0){window.open("","popup","width=1, height=1").close();const n=window.open("","popup","width=1, height=1");return!n||n.closed||typeof n.closed>"u"||null===n?(this.onPopupBlockedError(t),this.popupAllowed=!1):(n.close(),this.popupAllowed=!0,this.popupChecked=!0),this.popupAllowed}handleExportFormSubmit(t){this.loading$.next(!0);const i=Object.keys(wr.ogreFormats);!this.popupChecked&&t.layers.length>1&&(i.indexOf(t.format)>=0||t.format===wt.URL)&&!this.popupAllowed&&this.handlePopup();let n=[],p=[],v="";for(const[Y,ue]of t.layers.entries()){const ye=this.map.getLayerById(ue);t.format!==wt.CSVsemicolon&&t.format!==wt.CSVcomma||!t.combineLayers||1===t.layers.length?(v=ye.title,t.name&&(v=t.name)):v=this.languageService.translate.instant("igo.geo.export.combinedLayers");const Ee=ye.dataSource.options;if(t.format===wt.URL&&Ee.download&&(Ee.download.url||Ee.download.dynamicUrl))return void setTimeout(()=>{const Ge=Ee.download.url||Ee.download.dynamicUrl;Ge.match(/service=wfs/gi)?this.downloadService.open(ye):window.open(Ge,"_blank"),this.loading$.next(!1)},500);const we=this.getWorkspaceByLayerId(ue);let Le;if(we&&we.entityStore&&we.entityStore.stateView.all().length)Le=-1!==t.layersWithSelection.indexOf(ue)&&t.featureInMapExtent?we.entityStore.stateView.all().filter(Ge=>Ge.state.inMapExtent&&Ge.state.selected).map(Ge=>Ge.entity.ol):-1===t.layersWithSelection.indexOf(ue)||t.featureInMapExtent?t.featureInMapExtent?we.entityStore.stateView.all().filter(Ge=>Ge.state.inMapExtent).map(Ge=>Ge.entity.ol):we.entityStore.stateView.all().map(Ge=>Ge.entity.ol):we.entityStore.stateView.all().filter(Ge=>Ge.state.selected).map(Ge=>Ge.entity.ol);else{const Ge=ye.dataSource.ol;Le=t.featureInMapExtent?Ge.getFeaturesInExtent(ye.map.viewController.getExtent()):Ge.getFeatures(),ye.dataSource instanceof os.a&&(Le=Le.flatMap(tt=>tt.get("features")))}let Xe=[];if(t.format===wt.Shapefile||t.format===wt.GPX?Le.forEach(Ge=>{const tt=Ge.getGeometry().getType(),pt=Xe.find(Tt=>Tt.geometryType===tt);pt?pt.features.push(Ge):Xe.push({geometryType:tt,features:[Ge]})}):Xe=[{geometryType:"",features:Le}],Xe.forEach(Ge=>{Ge.features.forEach(tt=>{const pt=tt.get("rad");if(pt){const Tt=[tt.get("longitude"),tt.get("latitude")],jt=(0,X.e8)(Tt,pt,500);jt.transform("EPSG:4326",tt.get("_projection")),tt.setGeometry(jt)}})}),t.format===wt.GPX){const Ge=Xe.length;Xe=Xe.filter(pt=>["LineString","Point"].includes(pt.geometryType)),Ge>Xe.length&&this.messageService.error("igo.geo.export.gpx.error.poly.text","igo.geo.export.gpx.error.poly.title",{timeOut:2e4})}else if((t.format===wt.CSVsemicolon||t.format===wt.CSVcomma)&&t.combineLayers){if(Xe.forEach(Ge=>n.push(Ge)),Y!==t.layers.length-1)continue;{let Ge;n.forEach(tt=>{tt.features.forEach(pt=>{if(t.separator)if(Ge){if(pt.get("_featureStore").layer.options.title!==Ge.get("_featureStore").layer.options.title){const Tt=this.createTitleEmptyRows(Ge,pt);p.push(Tt[2]),p.push(Tt[0]),p.push(Tt[1])}}else{const Tt=this.createTitleEmptyRows(pt,pt);p.push(Tt[0])}p.push(pt),Ge=pt})})}}0===Xe.length?(this.loading$.next(!1),this.messageService.error("igo.geo.export.nothing.text","igo.geo.export.nothing.title",{timeOut:2e4})):(t.format!==wt.CSVsemicolon&&t.format!==wt.CSVcomma||!t.combineLayers)&&Xe.map(Ge=>this.exportService.export(Ge.features,t.format,v+Ge.geometryType,t.encoding,this.map.projection).subscribe(()=>{},tt=>this.onFileExportError(tt),()=>{this.onFileExportSuccess(),Ge.features.forEach(tt=>{this.circleToPoint(tt)}),this.loading$.next(!1)}))}(t.format===wt.CSVsemicolon||t.format===wt.CSVcomma)&&t.combineLayers&&this.exportService.export(p,t.format,v,t.encoding,this.map.projection).subscribe(()=>{},Y=>this.onFileExportError(Y),()=>{this.onFileExportSuccess(),p.forEach(Y=>{this.circleToPoint(Y)}),this.loading$.next(!1)})}createTitleEmptyRows(t,i){const n=i.clone(),p=i.clone(),v=i.clone(),Y=t.getKeys();let ue="";for(const Ge in Y)if("geometry"!==Y[Ge]){ue=Y[Ge];break}const ye=i.getKeys();let Ee="";for(const Ge in ye)if("geometry"!==ye[Ge]){Ee=ye[Ge];break}const we=i.getKeys();Y.forEach(Ge=>{we.includes(Ge)&&Ge!==ue&&we.push(Ge)}),we.unshift(ue);let Le="";for(const Ge in we)if("geometry"!==we[Ge]){Le=we[Ge];break}return we.forEach(Ge=>{const tt=Y.length===ye.length&&Y.every((pt,Tt)=>pt===ye[Tt]);Ge!==Le||tt?Ge===Le&&tt||Ge===Ee?(n.set(Ge,i.get("_featureStore").layer.options.title,!0),p.set(Ge,Ge,!0),v.unset(Ge,!0)):"geometry"!==Ge?(n.unset(Ge,!0),p.set(Ge,Ge,!0),v.unset(Ge,!0)):(n.unset(Ge,!0),v.unset(Ge,!0)):(n.set(Ge,i.get("_featureStore").layer.options.title+" ===============>",!0),p.set(Ge,Ge,!0),v.unset(Ge,!0)),ye.includes(Ge)||p.unset(Ge,!0)}),[n,p,v]}circleToPoint(t){if(t.get("rad")){const n=new J.c([t.get("longitude"),t.get("latitude")]);n.transform("EPSG:4326",t.get("_projection")),t.setGeometry(n)}}buildForm(){this.importForm=this.formBuilder.group({inputProj:["",[xe.AQ.required]]}),this.form=this.formBuilder.group(this.forceNaming?{format:["",[xe.AQ.required]],layers:[[],[xe.AQ.required]],layersWithSelection:[[]],encoding:[Zo.UTF8,[xe.AQ.required]],combineLayers:[!0,[xe.AQ.required]],separator:[!1,[xe.AQ.required]],featureInMapExtent:[!1,[xe.AQ.required]],name:["",[xe.AQ.required]]}:{format:["",[xe.AQ.required]],layers:[[],[xe.AQ.required]],layersWithSelection:[[]],encoding:[Zo.UTF8,[xe.AQ.required]],combineLayers:[!0,[xe.AQ.required]],separator:[!1,[xe.AQ.required]],featureInMapExtent:[!1,[xe.AQ.required]]})}onFileImportSuccess(t,i){const n=this.config.getConfig("importExport"),p=n?.allowToStoreLayer?this.confirmDialogService:void 0;n?.importWithStyle?Dr(t,i,this.map,this.contextUri,this.messageService,this.layerService,p,this.styleListService,this.styleService):Dr(t,i,this.map,this.contextUri,this.messageService,this.layerService,p)}onFileImportError(t,i){this.loading$.next(!1),function _a(l,m,t,i){({"Invalid file":Nc,"File is too large":zc,"Failed to read file":Hc,"Invalid SRS definition":Jc,"Error 500 with OGRE":Qc})[m.message](l,m,t,i=i||30)}(t,i,this.messageService,this.fileSizeMb)}onPopupBlockedError(t=!0){this.loading$.next(!1),this.messageService.error("igo.geo.export.popupBlocked.text","igo.geo.export.popupBlocked.title",{timeOut:2e4},{extraMessage:t?"igo.geo.export.popupBlocked.selectAgain":"igo.geo.export.popupBlocked.retry"})}onFileExportError(t){this.loading$.next(!1),function Bc(l,m){l instanceof Ir?function Yc(l){l.error("igo.geo.export.nothing.text","igo.geo.export.nothing.title")}(m):m.error("igo.geo.export.failed.text","igo.geo.export.failed.title")}(t,this.messageService)}loadConfig(){const t=this.config.getConfig("importExport.forceNaming");this.forceNaming=void 0!==t&&t,this.computeFormats(),this.loadEncodings()}encodingDefaultValue(t){return t===wt.CSVcomma||t===wt.CSVsemicolon?(this.form.patchValue({encoding:Zo.LATIN1}),Zo.LATIN1):(this.form.patchValue({encoding:Zo.UTF8}),Zo.UTF8)}loadEncodings(){this.encodings$.next(Zo)}computeFormats(t){let i=Object.keys(wt);const n={onlyUrl:!1,onlyVector:!1,vectorAndUrl:!1,customList:!1},p=[];if(t&&t.length)if(t.forEach(Y=>{Y&&(Y.dataSource.options.download?.allowedFormats?(n.customList=!0,p.push({layer:Y.title,formats:this.validateListFormat(Y.dataSource.options.download.allowedFormats)})):Y instanceof vt.M||!Y.dataSource.options.download||!Y.dataSource.options.download.url?Y.dataSource.options.download&&(Y.dataSource.options.download.url||Y.dataSource.options.download.dynamicUrl)?n.vectorAndUrl=!0:Y instanceof vt.M&&(n.onlyVector=!0):n.onlyUrl=!0)}),!0===n.onlyUrl&&!1===n.onlyVector)i=["URL"];else if(!0===n.onlyVector&&!1===n.onlyUrl)this.computeFormats(),wt.URL in this.formats$.value&&(i=Object.keys(this.formats$.value).filter(ue=>"URL"!==ue));else if(!0===n.vectorAndUrl&&!1===n.onlyUrl&&!1===n.onlyVector&&(this.computeFormats(),!(wt.URL in this.formats$.value))){const Y=Object.keys(this.formats$.value);Y.push("URL"),i=Y}const v=this.config.getConfig("importExport.formats");if(v){const Y=this.validateListFormat(v);i=i.filter(ue=>Y.includes(ue))}if(n.customList){let Y;const ue=[];let ye=p[0].formats;p.map(we=>{ue.push(we.layer),Y=we.formats.filter(Le=>ye.includes(Le)),ye=we.formats});const Ee=Y.filter(we=>i.includes(we));Ee.length>0?(this.formats$.next((0,ae.GC)(Ee)),t&&t.length&&t.length>1&&this.messageService.alert("igo.geo.export.customList.text","igo.geo.export.customList.title",void 0,{value:ue.join()})):(this.formats$.next([]),this.messageService.alert("igo.geo.export.noFormat.text","igo.geo.export.noFormat.title"))}else this.formats$.next((0,ae.GC)(i))}validateListFormat(t){return t.filter(i=>{if(i.toUpperCase()===wt.CSVcomma.toUpperCase()||i.toUpperCase()===wt.CSVsemicolon.toUpperCase()||i.toUpperCase()===wt.GML.toUpperCase()||i.toUpperCase()===wt.GPX.toUpperCase()||i.toUpperCase()===wt.GeoJSON.toUpperCase()||i.toUpperCase()===wt.KML.toUpperCase()||i.toUpperCase()===wt.Shapefile.toUpperCase()||i.toUpperCase()===wt.URL.toUpperCase())return i}).map(i=>i.toUpperCase()===wt.CSVcomma.toUpperCase()?i=wt.CSVcomma:i.toUpperCase()===wt.CSVsemicolon.toUpperCase()?i=wt.CSVsemicolon:i.toUpperCase()===wt.GML.toUpperCase()?i=wt.GML:i.toUpperCase()===wt.GPX.toUpperCase()?i=wt.GPX:i.toUpperCase()===wt.GeoJSON.toUpperCase()?i=wt.GeoJSON:i.toUpperCase()===wt.KML.toUpperCase()?i=wt.KML:i.toUpperCase()===wt.Shapefile.toUpperCase()?i=wt.Shapefile:i.toUpperCase()===wt.URL.toUpperCase()?i=wt.URL:void 0)}modeChanged(t){this.selectMode.emit(t)}onFileExportSuccess(){!function Uc(l){l.success("igo.geo.export.success.text","igo.geo.export.success.title")}(this.messageService)}onImportExportChange(t){this.selectedMode=t.value}static \u0275fac=function(i){return new(i||l)(e.GI1(va),e.GI1(wr),e.GI1(k.ov),e.GI1(Ht.mi),e.GI1(is),e.GI1(mr.U),e.GI1(xe.KE),e.GI1(A.aW),e.GI1(e.kD9),e.GI1(W.yQ),e.GI1(he),e.GI1(Or.I),e.GI1(be.Ex))};static \u0275cmp=e.In1({type:l,selectors:[["igo-import-export"]],inputs:{selectFirstProj:"selectFirstProj",map:"map",contextUri:"contextUri",projectionsLimitations:"projectionsLimitations",store:"store",selectedMode:"selectedMode",exportOptions$:"exportOptions$"},outputs:{selectMode:"selectMode",exportOptionsChange:"exportOptionsChange"},standalone:!0,features:[e.M5G([be.Ex]),e.UHJ],decls:14,vars:17,consts:[[1,"import-export-toggle","mat-typography"],[3,"value","change"],[3,"value"],["class","igo-form",3,"formGroup",4,"ngIf"],["class","mat-typography",4,"ngIf"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],[3,"value","valueChange"],[3,"value","click",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500",1,"igo-form-button-group",3,"matTooltip"],["mat-raised-button","","type","button",3,"disabled","click"],[3,"shown"],["hidden","","type","file",3,"click","change"],["fileInput",""],[3,"value","click"],["matListItemTitle","",4,"ngIf"],["matListItemTitle",""],[1,"mat-typography"],[4,"ngIf"],["class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"],["multiple","",3,"value","valueChange"],["class","export-select-trigger",4,"ngIf"],[3,"ngClass","value","click",4,"ngFor","ngForOf"],["formControlName","format"],["disabled","true",4,"ngIf"],["class","igo-input-container",4,"ngIf"],["class","export-combine-layers mat-typography",4,"ngIf"],["class","export-separator mat-typography",4,"ngIf"],["class","export-options mat-typography",4,"ngIf"],[1,"igo-form-button-group"],[1,"export-select-trigger"],[3,"ngClass","value","click"],[3,"click","checked","change",4,"ngIf"],[3,"click","checked","change"],[3,"value",4,"ngFor","ngForOf"],["disabled","true"],["matInput","","formControlName","name",3,"placeholder"],["formControlName","encoding"],[1,"export-combine-layers","mat-typography"],["formControlName","combineLayers",3,"labelPosition"],[1,"export-separator","mat-typography"],["formControlName","separator",3,"labelPosition"],[1,"export-options","mat-typography"],["formControlName","featureInMapExtent",3,"labelPosition"]],template:function(i,n){1&i&&(e.I0R(0,"div",0)(1,"mat-button-toggle-group",1),e.qCj("change",function(v){return n.onImportExportChange(v)}),e.I0R(2,"mat-button-toggle",2),e.OEk(3),e.wVc(4,"translate"),e.C$Y(),e.I0R(5,"mat-button-toggle",2),e.OEk(6),e.wVc(7,"translate"),e.C$Y()()(),e.yuY(8,tu,20,24,"form",3)(9,ru,3,2,"section",4)(10,su,4,3,"section",4),e.wVc(11,"async"),e.yuY(12,bu,37,38,"form",3),e.wVc(13,"async")),2&i&&(e.yG2(),e.E7m("value",n.selectedMode),e.yG2(),e.E7m("value","import"),e.yG2(),e.oRS(" ",e.kDX(4,9,"igo.geo.importExportForm.importTabTitle")," "),e.yG2(2),e.E7m("value","export"),e.yG2(),e.oRS(" ",e.kDX(7,11,"igo.geo.importExportForm.exportTabTitle")," "),e.yG2(2),e.E7m("ngIf","import"===n.selectedMode),e.yG2(),e.E7m("ngIf","import"===n.selectedMode),e.yG2(),e.E7m("ngIf",0===e.kDX(11,13,n.exportableLayers$).length&&"export"===n.selectedMode),e.yG2(2),e.E7m("ngIf",e.kDX(13,15,n.exportableLayers$).length>0&&"export"===n.selectedMode))},dependencies:[io.ue,io.gn,io.KU,Ke.u_,xe.y,xe.sz,xe.ot,xe.ue,xe.u,xe.sl,xe.uW,xe.Wo,yt.wb,yt.Up,yt.w5,Gt.d5,Gt.kX,Gt.gl,kt.I5,Ke.Iw,kt.Ax,ht.KO,ht.a4,Ze.oJ,Ze.Gw,be.is,be.YM,Ke.QF,co.GE,co.cP,Bt.cN,Bt.yi,Ke.a,Ke.uq,k._s,pe.sD],styles:["[_nghost-%COMP%]   mat-option.igo-export-layer-mat-option[_ngcontent-%COMP%]{height:5em;line-height:1em}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   h4[_ngcontent-%COMP%]{padding:0 5px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:15px 5px}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}[_nghost-%COMP%]   igo-spinner[_ngcontent-%COMP%]{position:absolute;padding-left:10px}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%], [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%], [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field, [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field, [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label, [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label, [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .export-select-trigger[_ngcontent-%COMP%]{opacity:.75;font-size:.75em}"]})}return l})();var ba=r(39882),Ou=r(17400),Ai=r(68252);function Iu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-checkbox",10),e.qCj("change",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.check())}),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("checked",t.layerCheck)}}const Oa=l=>({disabled:l});function wu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",11),e.qCj("click",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.toggleVisibility(n))}),e.wVc(1,"translate"),e.I0R(2,"mat-icon",12),e.wVc(3,"async"),e.wVc(4,"async"),e.OEk(5),e.wVc(6,"async"),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("color",t.layer.visible?"primary":"default")("matTooltip",e.kDX(1,5,t.eyeTooltip)),e.yG2(2),e.E7m("matBadgeHidden",e.kDX(3,7,t.queryBadgeHidden$))("ngClass",e.S45(13,Oa,!1===e.kDX(4,9,t.inResolutionRange$))),e.yG2(3),e.oRS("",e.kDX(6,11,t.layer.visible$)?"visibility":"visibility_off"," ")}}function Tu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",13),e.qCj("click",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.toggleVisibility(n))}),e.wVc(1,"translate"),e.wVc(2,"translate"),e.I0R(3,"mat-icon",12),e.wVc(4,"async"),e.wVc(5,"async"),e.OEk(6),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("color",t.layer.visible?"primary":"default")("matTooltip",t.layer.visible?e.kDX(1,5,"igo.geo.layer.hideLayer"):e.kDX(2,7,"igo.geo.layer.showLayer")),e.yG2(3),e.E7m("matBadgeHidden",e.kDX(4,9,t.queryBadgeHidden$))("ngClass",e.S45(13,Oa,!1===e.kDX(5,11,t.inResolutionRange$))),e.yG2(3),e.oRS("",t.layer.visible?"visibility":"visibility_off"," ")}}function Eu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",14),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleLayerTool())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"more_horiz"),e.C$Y()()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.layer.moreOptions"))}function xu(l,m){if(1&l&&e.wR5(0,"igo-layer-legend",15),2&l){const t=e.GaO();e.E7m("layer",t.layer)("updateLegendOnResolutionChange",t.updateLegendOnResolutionChange)}}let Ia=(()=>{class l{networkService;renderer;elRef;cdRef;focusedCls="igo-layer-item-focused";get activeLayer(){return this._activeLayer}set activeLayer(t){t&&this.layer&&t.id===this.layer.id&&!this.selectionMode?(this.layerTool$.next(!0),this.renderer.addClass(this.elRef.nativeElement,this.focusedCls)):this.renderer.removeClass(this.elRef.nativeElement,this.focusedCls)}_activeLayer;layerTool$=new B.g(!1);showLegend$=new B.g(!0);inResolutionRange$=new B.g(!0);queryBadgeHidden$=new B.g(!0);tooltipText;state;get selectAll(){return this._selectAll}set selectAll(t){this._selectAll=t,!0===t&&(this.layerCheck=!0)}_selectAll=!1;layerCheck;resolution$$;network$$;layers$$;layers$=new B.g(void 0);get layer(){return this._layer}set layer(t){this._layer=t,this.layers$.next(t)}_layer;toggleLegendOnVisibilityChange=!1;expandLegendIfVisible=!1;updateLegendOnResolutionChange=!1;orderable=!0;lowerDisabled=!1;raiseDisabled=!1;queryBadge=!1;selectionMode;changeDetection;get opacity(){return 100*this.layer.opacity}set opacity(t){this.layer.opacity=t/100}get eyeTooltip(){return!1===this.inResolutionRange$.getValue()?"igo.geo.layer.notInResolution":this.layer.visible?"igo.geo.layer.hideLayer":"igo.geo.layer.showLayer"}action=new e._w7(void 0);checkbox=new e._w7;constructor(t,i,n,p){this.networkService=t,this.renderer=i,this.elRef=n,this.cdRef=p}ngOnInit(){this.layer.visible&&this.expandLegendIfVisible&&!0===this.layer.firstLoadComponent&&(this.layer.firstLoadComponent=!1,this.layer.legendCollapsed=!1),this.toggleLegend(this.layer.legendCollapsed),this.updateQueryBadge(),this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.network$$=this.networkService.currentState().subscribe(i=>{this.state=i,this.onResolutionChange()}),this.layers$$=this.layers$.subscribe(()=>{this.layer&&this.layer.options.active&&(this.layerTool$.next(!0),this.renderer.addClass(this.elRef.nativeElement,this.focusedCls))}),this.changeDetection&&this.changeDetection.subscribe(()=>this.cdRef.detectChanges())}ngOnDestroy(){this.resolution$$.unsubscribe(),this.network$$.unsubscribe(),this.layers$$.unsubscribe()}toggleLegend(t){this.layer.legendCollapsed=t,this.showLegend$.next(!t)}toggleLegendOnClick(){this.toggleLegend(this.showLegend$.value)}toggleVisibility(t){t.stopPropagation(),this.layer.visible=!this.layer.visible,this.toggleLegendOnVisibilityChange&&this.toggleLegend(!this.layer.visible),this.updateQueryBadge()}computeTooltip(){const t=this.layer.options;if(!t.tooltip)return this.layer.title;const i=t.tooltip,n=t.metadata;switch(t.tooltip.type){case Ai.w.TITLE:return this.layer.title;case Ai.w.ABSTRACT:return n&&n.abstract?n.abstract:this.layer.title;case Ai.w.CUSTOM:return i&&i.text?i.text:this.layer.title;default:return this.layer.title}}onResolutionChange(){const t=this.layer.isInResolutionsRange;!1===t&&!0===this.updateLegendOnResolutionChange&&this.toggleLegend(!0),this.inResolutionRange$.next(t)}updateQueryBadge(){const t=!1===this.queryBadge||!1===this.layer.visible||!(0,Ou.wd)(this.layer);this.queryBadgeHidden$.next(t)}toggleLayerTool(){this.layerTool$.next(!this.layerTool$.getValue()),!0===this.layerTool$.getValue()?this.renderer.addClass(this.elRef.nativeElement,this.focusedCls):this.renderer.removeClass(this.elRef.nativeElement,this.focusedCls),this.action.emit(this.layer)}check(){this.layerCheck=!this.layerCheck,this.checkbox.emit({layer:this.layer,check:this.layerCheck})}static \u0275fac=function(i){return new(i||l)(e.GI1(ba.u),e.GI1(e.q87),e.GI1(e.GMv),e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-item"]],inputs:{activeLayer:"activeLayer",selectAll:"selectAll",layerCheck:"layerCheck",layer:"layer",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendIfVisible:"expandLegendIfVisible",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",orderable:"orderable",lowerDisabled:"lowerDisabled",raiseDisabled:"raiseDisabled",queryBadge:"queryBadge",selectionMode:"selectionMode",changeDetection:"changeDetection"},outputs:{action:"action",checkbox:"checkbox"},standalone:!0,features:[e.UHJ],decls:12,vars:9,consts:[[1,"igo-layer-list-item"],["class","layerCheck","matListItemIcon","",3,"checked","change",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-layer-title",3,"matTooltip","click"],["matListItemMeta",""],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","selection-eye","mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","actions-button","tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",3,"matTooltip","click",4,"ngIf"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer","updateLegendOnResolutionChange",4,"ngIf"],["matListItemIcon","",1,"layerCheck",3,"checked","change"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click"],["aria-hidden","false","matBadge","?","matBadgeColor","accent","matBadgeSize","small","matBadgePosition","after",3,"matBadgeHidden","ngClass"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",1,"selection-eye",3,"color","matTooltip","click"],["tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",1,"actions-button",3,"matTooltip","click"],[3,"layer","updateLegendOnResolutionChange"]],template:function(i,n){1&i&&(e.I0R(0,"mat-list-item",0),e.yuY(1,Iu,1,1,"mat-checkbox",1),e.I0R(2,"span",2),e.qCj("click",function(){return n.toggleLegendOnClick()}),e.OEk(3),e.C$Y(),e.I0R(4,"div",3),e.yuY(5,wu,7,15,"button",4)(6,Tu,7,15,"button",5)(7,Eu,4,3,"button",6),e.C$Y()(),e.I0R(8,"div",7,8),e.yuY(10,xu,1,2,"igo-layer-legend",9),e.wVc(11,"async"),e.C$Y()),2&i&&(e.yG2(),e.E7m("ngIf",n.selectionMode),e.yG2(),e.E7m("matTooltip",n.tooltipText),e.yG2(),e.oRS(" ",n.layer.title," "),e.yG2(2),e.E7m("ngIf",!n.selectionMode),e.yG2(),e.E7m("ngIf",n.selectionMode),e.yG2(),e.E7m("ngIf",!n.selectionMode),e.yG2(3),e.E7m("ngIf",e.kDX(11,7,n.showLegend$)))},dependencies:[Ot.iI,Ot.g9,Ot.Y1,Ot.UV,Ot.At,Ke.u_,$t.Vn,$t.WK,ht.KO,ht.a4,Ze.oJ,Ze.um,dt.oB,dt.qL,st.g,st.S,Ke.QF,Ao,Ke.a,k._s,pe.sD],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]     .igo-layer-title{display:block;width:100%;cursor:pointer}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px)}[_nghost-%COMP%]   mat-icon[matBadge][_ngcontent-%COMP%]     .mat-badge-content{font-size:12px}[_nghost-%COMP%]   .layerCheck[_ngcontent-%COMP%]{align-self:baseline;width:16px;padding-right:0}"],changeDetection:0})}return l})(),wa=(()=>{class l{networkService;inResolutionRange$=new B.g(!0);tooltipText;state;resolution$$;network$$;layer;updateLegendOnResolutionChange=!1;constructor(t){this.networkService=t}ngOnInit(){this.resolution$$=this.layer.map.viewController.resolution$.subscribe(()=>{this.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.network$$=this.networkService.currentState().subscribe(i=>{this.state=i,this.onResolutionChange()})}ngOnDestroy(){this.resolution$$.unsubscribe(),this.network$$.unsubscribe()}computeTooltip(){const t=this.layer.options;if(!t.tooltip)return this.layer.title;const i=t.tooltip,n=t.metadata;switch(t.tooltip.type){case Ai.w.TITLE:return this.layer.title;case Ai.w.ABSTRACT:return n&&n.abstract?n.abstract:this.layer.title;case Ai.w.CUSTOM:return i&&i.text?i.text:this.layer.title;default:return this.layer.title}}onResolutionChange(){this.inResolutionRange$.next(this.layer.isInResolutionsRange)}static \u0275fac=function(i){return new(i||l)(e.GI1(ba.u))};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-legend-item"]],inputs:{layer:"layer",updateLegendOnResolutionChange:"updateLegendOnResolutionChange"},standalone:!0,features:[e.UHJ],decls:6,vars:4,consts:[[1,"igo-layer-list-item"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-layer-title",3,"matTooltip"],[1,"igo-layer-legend-container"],["legend",""],[3,"layer","updateLegendOnResolutionChange"]],template:function(i,n){1&i&&(e.I0R(0,"mat-list-item",0)(1,"span",1),e.OEk(2),e.C$Y()(),e.I0R(3,"div",2,3),e.wR5(5,"igo-layer-legend",4),e.C$Y()),2&i&&(e.yG2(),e.E7m("matTooltip",n.tooltipText),e.yG2(),e.cNF(n.layer.title),e.yG2(3),e.E7m("layer",n.layer)("updateLegendOnResolutionChange",n.updateLegendOnResolutionChange))},dependencies:[Ot.iI,Ot.g9,Ot.UV,ht.KO,ht.a4,Ao],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-layer-list-item[_ngcontent-%COMP%]{height:48px;clear:both}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px)}"],changeDetection:0})}return l})();var Ta=r(23680),Pr=r(54584),Ea=r(43451),xa=r(25376);function Mu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-slide-toggle",6),e.qCj("change",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.toggleShowAllLegends(n.checked))}),e.wVc(1,"translate"),e.OEk(2),e.wVc(3,"translate"),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,4,"igo.geo.layer.legend.showAll"))("checked",t.showAllLegendsValue)("labelPosition","before"),e.yG2(2),e.oRS(" ",e.kDX(3,6,"igo.geo.layer.legend.showAll")," ")}}function Du(l,m){1&l&&e.wR5(0,"mat-divider")}function Pu(l,m){if(1&l&&e.wR5(0,"igo-layer-legend-item",8),2&l){const t=e.GaO().$implicit,i=e.GaO();e.E7m("layer",t)("updateLegendOnResolutionChange",i.updateLegendOnResolutionChange)}}function Fu(l,m){if(1&l&&e.yuY(0,Pu,1,2,"igo-layer-legend-item",7),2&l){const t=m.$implicit,i=e.GaO();e.E7m("ngIf",!(i.excludeBaseLayers&&t.baseLayer))}}function Ru(l,m){1&l&&(e.I0R(0,"p",9),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLayersVisibleWithShowAllButton")," "))}function Lu(l,m){1&l&&(e.I0R(0,"p",9),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom")," "))}function Gu(l,m){1&l&&(e.I0R(0,"p",9),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLayersVisible")," "))}function $u(l,m){1&l&&(e.I0R(0,"p",9),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l&&(e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.layer.legend.noLayersVisibleButZoom")," "))}let as=(()=>{class l{orderable=!0;hasVisibleOrInRangeLayers$=new B.g(!0);hasVisibleAndNotInRangeLayers$=new B.g(!0);layersInUi$=new B.g([]);layers$=new B.g([]);showAllLegend=!1;change$=new Ta.o(1);change$$;set layers(t){this._layers=t,this.next()}get layers(){return this._layers}_layers;excludeBaseLayers=!1;updateLegendOnResolutionChange=!1;allowShowAllLegends=!1;showAllLegendsValue=!1;allLegendsShown=new e._w7(!1);constructor(){}ngOnInit(){this.change$$=this.change$.pipe((0,xa.C)(()=>0===this.layers.length?Pr.k:(0,Ea.k)(50))).subscribe(()=>{const t=this.computeShownLayers(this.layers.slice(0));this.layers$.next(t),this.hasVisibleOrInRangeLayers$.next(this.layers.slice(0).filter(i=>!0!==i.baseLayer).filter(i=>i.visible$.value&&i.isInResolutionsRange$.value).length>0),this.hasVisibleAndNotInRangeLayers$.next(this.layers.slice(0).filter(i=>!0!==i.baseLayer).filter(i=>i.visible$.value&&!i.isInResolutionsRange$.value).length>0),this.layersInUi$.next(this.layers.slice(0).filter(i=>!(!1===i.showInLayerList||this.excludeBaseLayers&&i.baseLayer)))})}ngOnDestroy(){this.change$$.unsubscribe()}next(){this.change$.next()}computeShownLayers(t){let i=t.filter(n=>n.visible&&n.isInResolutionsRange);return this.showAllLegendsValue&&(i=t),this.sortLayersByZindex(i)}sortLayersByZindex(t){return t.sort((i,n)=>n.zIndex-i.zIndex)}toggleShowAllLegends(t){this.showAllLegendsValue=t,this.next(),this.allLegendsShown.emit(t)}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-legend-list"]],inputs:{layers:"layers",excludeBaseLayers:"excludeBaseLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue"},outputs:{allLegendsShown:"allLegendsShown"},standalone:!0,features:[e.UHJ],decls:24,vars:39,consts:[[1,"layer-legend-list-container"],["tooltip-position","above","matTooltipShowDelay","500","class","mat-typography",3,"matTooltip","checked","labelPosition","change",4,"ngIf"],[4,"ngIf"],[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["class","layers-empty mat-typography",4,"ngIf"],["tooltip-position","above","matTooltipShowDelay","500",1,"mat-typography",3,"matTooltip","checked","labelPosition","change"],["igoListItem","",3,"layer","updateLegendOnResolutionChange",4,"ngIf"],["igoListItem","",3,"layer","updateLegendOnResolutionChange"],[1,"layers-empty","mat-typography"]],template:function(i,n){1&i&&(e.I0R(0,"div",0),e.yuY(1,Mu,4,8,"mat-slide-toggle",1),e.wVc(2,"async"),e.yuY(3,Du,1,0,"mat-divider",2),e.wVc(4,"async"),e.I0R(5,"igo-list",3),e.yuY(6,Fu,1,1,"ng-template",4),e.wVc(7,"async"),e.C$Y(),e.yuY(8,Ru,3,3,"p",5),e.wVc(9,"async"),e.wVc(10,"async"),e.wVc(11,"async"),e.yuY(12,Lu,3,3,"p",5),e.wVc(13,"async"),e.wVc(14,"async"),e.wVc(15,"async"),e.yuY(16,Gu,3,3,"p",5),e.wVc(17,"async"),e.wVc(18,"async"),e.wVc(19,"async"),e.yuY(20,$u,3,3,"p",5),e.wVc(21,"async"),e.wVc(22,"async"),e.wVc(23,"async"),e.C$Y()),2&i&&(e.yG2(),e.E7m("ngIf",e.kDX(2,9,n.layersInUi$).length&&n.allowShowAllLegends),e.yG2(2),e.E7m("ngIf",e.kDX(4,11,n.layersInUi$).length&&n.allowShowAllLegends),e.yG2(2),e.E7m("navigation",!1)("selection",!1),e.yG2(),e.E7m("ngForOf",e.kDX(7,13,n.layers$)),e.yG2(2),e.E7m("ngIf",!n.showAllLegendsValue&&e.kDX(9,15,n.layersInUi$).length&&!1===e.kDX(10,17,n.hasVisibleOrInRangeLayers$)&&!1===e.kDX(11,19,n.hasVisibleAndNotInRangeLayers$)&&n.allowShowAllLegends),e.yG2(4),e.E7m("ngIf",!n.showAllLegendsValue&&e.kDX(13,21,n.layersInUi$).length&&!1===e.kDX(14,23,n.hasVisibleOrInRangeLayers$)&&e.kDX(15,25,n.hasVisibleAndNotInRangeLayers$)&&n.allowShowAllLegends),e.yG2(4),e.E7m("ngIf",e.kDX(17,27,n.layersInUi$).length&&!1===e.kDX(18,29,n.hasVisibleOrInRangeLayers$)&&!1===e.kDX(19,31,n.hasVisibleAndNotInRangeLayers$)&&!n.allowShowAllLegends),e.yG2(4),e.E7m("ngIf",e.kDX(21,33,n.layersInUi$).length&&!1===e.kDX(22,35,n.hasVisibleOrInRangeLayers$)&&e.kDX(23,37,n.hasVisibleAndNotInRangeLayers$)&&!n.allowShowAllLegends))},dependencies:[Ke.u_,co.GE,co.cP,ht.KO,ht.a4,to.U,to.k,be.yM,Ke.Iw,wa,be.qU,Ke.a,k._s,pe.sD],styles:["[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{display:contents}[_nghost-%COMP%]   .layers-empty[_ngcontent-%COMP%]{text-align:justify;margin:10px}[_nghost-%COMP%]   .layer-legend-list-container[_ngcontent-%COMP%]{max-height:100%;overflow:auto}"],changeDetection:0})}return l})();function ku(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",8),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.clearTerm())}),e.I0R(1,"mat-icon"),e.OEk(2,"close"),e.C$Y()()}}let Ma=(()=>{class l{onlyVisible$=new B.g(!1);sortAlpha$=new B.g(!1);term$=new B.g(void 0);onlyVisible$$;sortAlpha$$;term$$;layersAreAllVisible=!0;floatLabel="auto";set onlyVisible(t){this.onlyVisible$.next(t)}get onlyVisible(){return this.onlyVisible$.value}set sortAlpha(t){this.sortAlpha$.next(t)}get sortAlpha(){return this.sortAlpha$.value}set term(t){this.term$.next(t)}get term(){return this.term$.value}selectionMode=!1;appliedFilterAndSort=new e._w7;selection=new e._w7;ngOnInit(){this.term$$=this.term$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:t,onlyVisible:this.onlyVisible,sortAlpha:this.sortAlpha})}),this.onlyVisible$$=this.onlyVisible$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:this.term,onlyVisible:t,sortAlpha:this.sortAlpha})}),this.sortAlpha$$=this.sortAlpha$.subscribe(t=>{this.appliedFilterAndSort.emit({keyword:this.term,onlyVisible:this.onlyVisible,sortAlpha:t})})}ngOnDestroy(){this.onlyVisible$$.unsubscribe(),this.sortAlpha$$.unsubscribe(),this.term$$.unsubscribe()}clearTerm(){this.term=void 0}toggleSortAlpha(){this.sortAlpha=!this.sortAlpha}toggleOnlyVisible(){this.onlyVisible=!this.onlyVisible}toggleSelectionMode(){this.selectionMode=!this.selectionMode,this.selection.emit(this.selectionMode)}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-list-tool"]],inputs:{layersAreAllVisible:"layersAreAllVisible",floatLabel:"floatLabel",onlyVisible:"onlyVisible",sortAlpha:"sortAlpha",term:"term"},outputs:{appliedFilterAndSort:"appliedFilterAndSort",selection:"selection"},standalone:!0,features:[e.UHJ],decls:21,vars:33,consts:[[1,"inputFilter",3,"floatLabel"],["matInput","","matTooltipShowDelay","500","type","text",3,"placeholder","matTooltip","ngModel","ngModelChange"],["matSuffix","","mat-icon-button","","aria-label","Clear","color","warn",3,"click",4,"ngIf"],[1,"actions-container"],["mat-icon-button","","matTooltipShowDelay","500",1,"sort-alpha",3,"color","matTooltip","click"],["mat-icon-button","","matTooltipShowDelay","500",1,"only-visible",3,"disabled","color","matTooltip","click"],["aria-hidden","false","matBadge","icon","igoMatBadgeIcon","visibility",3,"igoMatBadgeInverseColor","igoMatBadgeInheritColor"],["mat-icon-button","","color","primary","matTooltipShowDelay","500",1,"selection-mode",3,"matTooltip","click"],["matSuffix","","mat-icon-button","","aria-label","Clear","color","warn",3,"click"]],template:function(i,n){1&i&&(e.I0R(0,"mat-form-field",0)(1,"input",1),e.iHE("ngModelChange",function(v){return e.kNx(n.term,v)||(n.term=v),v}),e.wVc(2,"translate"),e.wVc(3,"translate"),e.C$Y(),e.yuY(4,ku,3,0,"button",2),e.C$Y(),e.I0R(5,"div",3)(6,"button",4),e.qCj("click",function(){return n.toggleSortAlpha()}),e.wVc(7,"translate"),e.wVc(8,"translate"),e.I0R(9,"mat-icon"),e.OEk(10,"sort_by_alpha"),e.C$Y()(),e.I0R(11,"button",5),e.qCj("click",function(){return n.toggleOnlyVisible()}),e.wVc(12,"translate"),e.wVc(13,"translate"),e.I0R(14,"mat-icon",6),e.OEk(15),e.C$Y()(),e.I0R(16,"button",7),e.qCj("click",function(){return n.toggleSelectionMode()}),e.wVc(17,"translate"),e.wVc(18,"translate"),e.I0R(19,"mat-icon"),e.OEk(20),e.C$Y()()()),2&i&&(e.E7m("floatLabel",n.floatLabel),e.yG2(),e.E7m("placeholder",e.kDX(2,17,"igo.geo.layer.filterPlaceholder"))("matTooltip",e.kDX(3,19,"igo.geo.layer.subsetLayersListKeyword")),e.OKB("ngModel",n.term),e.yG2(3),e.E7m("ngIf",n.term),e.yG2(2),e.eAK("--active",n.sortAlpha),e.E7m("color",n.sortAlpha?"warn":"primary")("matTooltip",n.sortAlpha?e.kDX(7,21,"igo.geo.layer.sortMapOrder"):e.kDX(8,23,"igo.geo.layer.sortAlphabetically")),e.yG2(5),e.E7m("disabled",n.layersAreAllVisible&&!n.onlyVisible)("color",n.onlyVisible?"warn":"primary")("matTooltip",n.onlyVisible?e.kDX(12,25,"igo.geo.layer.resetLayersList"):e.kDX(13,27,"igo.geo.layer.subsetLayersListOnlyVisible")),e.yG2(3),e.E7m("igoMatBadgeInverseColor",!0)("igoMatBadgeInheritColor",!0),e.yG2(),e.oRS(" ",n.onlyVisible?"filter_alt_off":"filter_alt"," "),e.yG2(),e.E7m("matTooltip",n.selectionMode?e.kDX(17,29,"igo.geo.layer.deactivateSelectionMode"):e.kDX(18,31,"igo.geo.layer.activateSelectionMode")),e.yG2(4),e.cNF(n.selectionMode?"library_add_check":"filter_none"))},dependencies:[yt.wb,yt.Up,yt.Gm,Bt.cN,Bt.yi,xe.y,xe.ot,xe.ue,xe._G,ht.KO,ht.a4,Ke.u_,Ze.oJ,Ze.um,dt.oB,dt.qL,st.g,st.S,be.qS,k._s,pe.sD],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px 12px}[_nghost-%COMP%]   .inputFilter[_ngcontent-%COMP%]{width:calc(100% - 100px);max-width:200px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .inputFilter[_ngcontent-%COMP%]{width:50%}}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}.sort-alpha.--active[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:red}"],changeDetection:0})}return l})();var ls=r(87848),kn=r(94448),Da=r(89888),cs=r(19724),hr=function(l){return l.always="always",l.never="never",l.default="default",l}(hr||{}),Zn=function(l){return l.ALL_VISIBLE="ALL_VISIBLE",l.ALL_HIDDEN="ALL_HIDDEN",l.MIXED="MIXED",l.NULL="NULL",l}(Zn||{}),Fr=function(l){return l.Raise="raise",l.Lower="lower",l}(Fr||{});const Au=["igoLayerItemToolbar"];function Bu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"igo-layer-list-tool",6),e.qCj("appliedFilterAndSort",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onAppliedFilterAndSortChange(n))})("selection",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.toggleSelectionMode(n))}),e.C$Y()}if(2&l){const t=e.GaO();e.E7m("layersAreAllVisible",t.layersAreAllVisible)("term",t.layerFilterAndSortOptions.keyword)("onlyVisible",t.layerFilterAndSortOptions.onlyVisible)("sortAlpha",t.layerFilterAndSortOptions.sortAlpha)}}function Uu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",7)(1,"mat-checkbox",8),e.qCj("change",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.selectAll())}),e.OEk(2),e.wVc(3,"translate"),e.wVc(4,"translate"),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("color",!t.selectAllCheck&&t.layersChecked.length>0?"accent":"primary")("checked",t.selectAllCheck)("indeterminate",!t.selectAllCheck&&t.layersChecked.length>0),e.yG2(),e.oRS(" ",t.selectAllCheck?e.kDX(3,4,"igo.geo.layer.deselectAll"):e.kDX(4,6,"igo.geo.layer.selectAll")," ")}}function Yu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"igo-layer-item",10),e.qCj("action",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.toggleLayerTool(n))})("checkbox",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.layersCheck(n))}),e.C$Y()}if(2&l){const t=e.GaO().$implicit,i=e.GaO();e.E7m("layer",t)("activeLayer",i.activeLayer)("orderable",i.orderable&&!t.baseLayer)("lowerDisabled",i.getLowerLayer().id===t.id)("raiseDisabled",i.getUpperLayer().id===t.id)("queryBadge",i.queryBadge)("expandLegendIfVisible",i.expandLegendOfVisibleLayers)("updateLegendOnResolutionChange",i.updateLegendOnResolutionChange)("toggleLegendOnVisibilityChange",i.toggleLegendOnVisibilityChange)("selectionMode",i.selection)("selectAll",i.selectAllCheck)("layerCheck",t.options.check)("changeDetection",i.layerItemChangeDetection$)}}function Vu(l,m){if(1&l&&e.yuY(0,Yu,1,13,"igo-layer-item",9),2&l){const t=m.$implicit,i=e.GaO();e.E7m("ngIf",!(i.excludeBaseLayers&&t.baseLayer))}}function ju(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",27),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.removeLayers())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"delete"),e.C$Y()()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.layer.removeLayer"))}function Ku(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",28),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.zoomLayerExtents(n.activeLayer))}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",29),e.C$Y()}if(2&l){const t=e.GaO(2);e.E7m("matTooltip",e.kDX(1,2,"igo.geo.layer.zoomLayer")),e.yG2(2),e.E7m("svgIcon",t.magnifyIcon.name)}}const Wu=l=>({layer:l});function Nu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"igo-panel",11)(1,"div",12),e.yuY(2,ju,4,3,"button",13),e.I0R(3,"button",14),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.moveActiveLayer(n.activeLayer,n.layerListDisplacement.Lower,!0))}),e.wVc(4,"translate"),e.wVc(5,"translate"),e.I0R(6,"mat-icon",15),e.OEk(7,"arrow_downward"),e.C$Y()(),e.I0R(8,"button",16),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.moveActiveLayer(n.activeLayer,n.layerListDisplacement.Raise,!0))}),e.wVc(9,"translate"),e.wVc(10,"translate"),e.I0R(11,"mat-icon",15),e.OEk(12,"arrow_upward"),e.C$Y()(),e.I0R(13,"button",17),e.wVc(14,"translate"),e.I0R(15,"mat-icon",18),e.OEk(16,"opacity"),e.C$Y()(),e.I0R(17,"mat-menu",19,20)(19,"mat-slider",21,22),e.qCj("click",function(n){return n.stopPropagation()}),e.wVc(21,"translate"),e.I0R(22,"input",23,24),e.qCj("input",function(){e.usT(t);const n=e.Gew(23),p=e.Gew(20),v=e.GaO();return e.CGJ(v.changeOpacity({source:n,parent:p,value:n.value}))}),e.C$Y()()(),e.yuY(24,Ku,3,4,"button",25),e.C_f(25,26),e._Xx(26),e.C$Y()()}if(2&l){const t=e.Gew(18),i=e.GaO();e.E7m("title",i.activeLayer.title),e.yG2(2),e.E7m("ngIf",i.isLayerRemovable(i.activeLayer)),e.yG2(),e.E7m("matTooltip",i.sortAlpha||i.onlyVisible||i.keyword?e.kDX(4,20,"igo.geo.layer.filterLowerLayer"):e.kDX(5,22,"igo.geo.layer.lowerLayer"))("disabled",i.lowerDisabled),e.yG2(3),e.E7m("matBadge",i.sortAlpha||i.onlyVisible||i.keyword?"!":"")("matBadgeHidden",i.lowerDisabled),e.yG2(2),e.E7m("matTooltip",i.sortAlpha||i.onlyVisible||i.keyword?e.kDX(9,24,"igo.geo.layer.filterRaiseLayer"):e.kDX(10,26,"igo.geo.layer.raiseLayer"))("disabled",i.raiseDisabled),e.yG2(3),e.E7m("matBadge",i.sortAlpha||i.onlyVisible||i.keyword?"!":"")("matBadgeHidden",i.raiseDisabled),e.yG2(2),e.E7m("matMenuTriggerFor",t)("matTooltip",e.kDX(14,28,"igo.geo.layer.opacity")),e.yG2(2),e.E7m("matBadge",i.badgeOpacity),e.yG2(4),e.E7m("min",0)("max",100)("matTooltip",e.kDX(21,30,"igo.geo.layer.opacity")),e.yG2(3),e.E7m("value",i.opacity),e.yG2(2),e.E7m("ngIf",i.activeLayerExtentIsValid(i.activeLayer)),e.yG2(),e.E7m("ngTemplateOutlet",i.templateLayerToolbar)("ngTemplateOutletContext",e.S45(32,Wu,i.activeLayer))}}function Hu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-slider",37),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO(2);return e.kNx(p.checkOpacity,n)||(p.checkOpacity=n),e.CGJ(n)}),e.qCj("click",function(n){return n.stopPropagation()}),e.wVc(1,"translate"),e.wR5(2,"input",38),e.C$Y()}if(2&l){const t=e.GaO(2);e.E7m("min",0)("max",100),e.OKB("ngModel",t.checkOpacity),e.E7m("matTooltip",e.kDX(1,4,"igo.geo.layer.opacity"))}}function zu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",28),e.qCj("click",function(){e.usT(t);const n=e.GaO(2);return e.CGJ(n.zoomLayersExtents(n.layersChecked))}),e.wVc(1,"translate"),e.wR5(2,"mat-icon",39),e.C$Y()}if(2&l){const t=e.GaO(2);e.E7m("matTooltip",e.kDX(1,2,"igo.geo.layer.zoomLayers")),e.yG2(2),e.E7m("svgIcon",t.magnifyIcon.name)}}function Xu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"igo-panel",11),e.wVc(1,"translate"),e.I0R(2,"div",30)(3,"button",31),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.removeLayers(n.layersChecked))}),e.wVc(4,"translate"),e.wVc(5,"translate"),e.I0R(6,"mat-icon",15),e.OEk(7,"delete"),e.C$Y()(),e.I0R(8,"button",32),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleVisibility(n.layersChecked))}),e.wVc(9,"translate"),e.wVc(10,"translate"),e.I0R(11,"mat-icon"),e.OEk(12),e.C$Y()(),e.I0R(13,"button",14),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.lowerLayers(n.layersChecked))}),e.wVc(14,"translate"),e.wVc(15,"translate"),e.I0R(16,"mat-icon",15),e.OEk(17,"arrow_downward"),e.C$Y()(),e.I0R(18,"button",16),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.raiseLayers(n.layersChecked))}),e.wVc(19,"translate"),e.wVc(20,"translate"),e.I0R(21,"mat-icon",15),e.OEk(22,"arrow_upward"),e.C$Y()(),e.I0R(23,"button",33),e.wVc(24,"translate"),e.I0R(25,"mat-icon"),e.OEk(26,"opacity"),e.C$Y()(),e.I0R(27,"mat-menu",34,20)(29,"div",35),e.yuY(30,Hu,3,6,"mat-slider",36),e.C$Y()(),e.yuY(31,zu,3,4,"button",25),e.C$Y()()}if(2&l){const t=e.Gew(28),i=e.GaO();e.E7m("title",e.kDX(1,21,"igo.geo.layer.tools")),e.yG2(3),e.E7m("disabled",0===i.layersChecked.length)("matTooltip",i.isAllLayersRemovable(i.layersChecked)?e.kDX(4,23,"igo.geo.layer.removeSelectedLayers"):e.kDX(5,25,"igo.geo.layer.removeSelectedLayersRestriction")),e.yG2(3),e.E7m("matBadge","!")("matBadgeHidden",i.isAllLayersRemovable(i.layersChecked)),e.yG2(2),e.E7m("disabled",0===i.layersChecked.length)("matTooltip","ALL_HIDDEN"===i.statusSelectedLayersCheck?e.kDX(9,27,"igo.geo.layer.showSelectedLayers"):e.kDX(10,29,"igo.geo.layer.hideSelectedLayers")),e.yG2(4),e.cNF("ALL_HIDDEN"===i.statusSelectedLayersCheck?"visibility_off":"visibility"),e.yG2(),e.E7m("matTooltip",i.sortAlpha||i.onlyVisible||i.keyword?e.kDX(14,31,"igo.geo.layer.filterLowerLayer"):e.kDX(15,33,"igo.geo.layer.lowerLayer"))("disabled",i.lowerDisabledSelection),e.yG2(3),e.E7m("matBadge",i.sortAlpha||i.onlyVisible||i.keyword?"!":"")("matBadgeHidden",i.lowerDisabledSelection),e.yG2(2),e.E7m("matTooltip",i.sortAlpha||i.onlyVisible||i.keyword?e.kDX(19,35,"igo.geo.layer.filterRaiseLayer"):e.kDX(20,37,"igo.geo.layer.raiseLayer"))("disabled",i.raiseDisabledSelection),e.yG2(3),e.E7m("matBadge",i.sortAlpha||i.onlyVisible||i.keyword?"!":"")("matBadgeHidden",i.raiseDisabledSelection),e.yG2(2),e.E7m("disabled",0===i.layersChecked.length)("matMenuTriggerFor",t)("matTooltip",e.kDX(24,39,"igo.geo.layer.opacity")),e.yG2(7),e.E7m("ngIf",i.layersChecked.length),e.yG2(),e.E7m("ngIf",0!==i.layersChecked.length&&i.activeLayersExtentAreValid(i.layersChecked))}}const Ju=[[["","igoLayerItemToolbar",""]]],Qu=["[igoLayerItemToolbar]"];let us=(()=>{class l{elRef;iconService;orderable=!0;thresholdToFilterAndSort=5;layers$=new B.g([]);change$=new Ta.o(1);showToolbar$=new B.g(!1);layerTool;hideSelectedLayers=!0;activeLayer$=new B.g(void 0);layersChecked=[];selection;change$$;layers$$;layerItemChangeDetection$=new B.g(void 0);templateLayerToolbar;layersAreAllVisible=!0;ogcButton=!0;timeButton=!0;get map(){return this._map}set map(t){this._map=t}_map;set layers(t){this._layers=this.removeProblemLayerInList(t),this.next()}get layers(){return this._layers}_layers;set activeLayer(t){this._activeLayer=t,this.activeLayer$.next(t)}get activeLayer(){return this._activeLayer}_activeLayer;floatLabel="auto";layerFilterAndSortOptions={};excludeBaseLayers=!1;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;queryBadge=!1;appliedFilterAndSort=new e._w7;get keyword(){return this._keyword}set keyword(t){this._keyword=t,this.next()}_keyword=void 0;get onlyVisible(){return this._onlyVisible}set onlyVisible(t){this._onlyVisible=t,this.next()}_onlyVisible=!1;get sortAlpha(){return this._sortedAlpha}set sortAlpha(t){this._sortedAlpha=t,this.next()}_sortedAlpha=!1;get opacity(){return Math.round(100*this.activeLayer$.getValue().opacity)}set opacity(t){this.activeLayer$.getValue().opacity=t/100}get badgeOpacity(){if(100!==this.opacity)return this.opacity}get raiseDisabled(){return!(this.orderable&&!this.activeLayer.baseLayer&&this.getUpperLayer().id!==this.activeLayer.id&&!this.isUpperBaselayer(this.activeLayer))}get lowerDisabled(){return!(this.orderable&&!this.activeLayer.baseLayer&&this.getLowerLayer().id!==this.activeLayer.id&&!this.isLowerBaselayer(this.activeLayer))}get raiseDisabledSelection(){return 0===this.layersChecked.length||!this.orderable||!this.raisableLayers(this.layersChecked)||!0===this.selectAllCheck}get lowerDisabledSelection(){return 0===this.layersChecked.length||!this.orderable||!this.lowerableLayers(this.layersChecked)||!0===this.selectAllCheck}get checkOpacity(){return 100*this.layersCheckedOpacity()}set checkOpacity(t){for(const i of this.layersChecked)i.opacity=t/100}get layerListDisplacement(){return Fr}toggleOpacity=!1;selectAllCheck;selectAllCheck$=new B.g(void 0);selectAllCheck$$;magnifyIcon=be.qW;constructor(t,i){this.elRef=t,this.iconService=i,this.iconService.registerSvg(this.magnifyIcon)}ngOnInit(){this.change$$=this.change$.pipe((0,xa.C)(()=>0===this.layers.length?Pr.k:(0,Ea.k)(50))).subscribe(()=>{this.showToolbar$.next(this.computeShowToolbar()),this.layers$.next(this.computeLayers(this.layers.slice(0))),this.appliedFilterAndSort.emit({keyword:this.keyword,sortAlpha:this.sortAlpha,onlyVisible:this.onlyVisible})}),this.selectAllCheck$$=this.selectAllCheck$.subscribe(t=>{this.selectAllCheck=t}),this.layers$$=this.layers$.subscribe(()=>{if(this.layers){let t=0;for(const i of this.layers)i.status$.subscribe(n=>{0===n&&this.map.removeLayer(i)}),i.options.active&&(this.activeLayer=i,this.layerTool=!0),i.options.check&&(t+=1);this.selectAllCheck=this.excludeBaseLayers?t===this.layers.filter(i=>!0!==i.baseLayer&&i.showInLayerList).length:t===this.layers.filter(i=>i.showInLayerList).length}})}ngOnDestroy(){this.change$$.unsubscribe(),this.selectAllCheck$$.unsubscribe(),this.layers$$.unsubscribe()}activeLayerExtentIsValid(t){let i=!1;if(!1===t.options.showButtonZoomToExtent)return!1;const n=t.options.extent,p=this.map.viewController.maxLayerZoomExtent;return n&&(i=!p||kn.cP(p,n)),i}activeLayersExtentAreValid(t){let i=!1;const n=kn.Gu(),p=this.map.viewController.maxLayerZoomExtent;for(const v of t){const Y=v.options.extent;Y&&!Y.includes(1/0)&&kn.SU(n,Y)}return kn.t7(n)||(i=!p||kn.cP(p,n)),i}zoomLayerExtents(t){this.map.viewController.zoomToExtent(t.options.extent)}zoomLayersExtents(t){const i=kn.Gu();for(const n of t){const p=n.options.extent;p&&kn.SU(i,p)}this.map.viewController.zoomToExtent(i)}changeOpacity(t){this.opacity=t.value}clearKeyword(){this.keyword=void 0}getLowerLayer(){return this.layers.filter(t=>!t.baseLayer).reduce((t,i)=>t.zIndex<i.zIndex?t:i,{zIndex:void 0,id:void 0})}isLowerBaselayer(t){const i=this.layers.findIndex(n=>t.id===n.id);return!(!this.layers||!this.layers[i+1]||!0!==this.layers[i+1].baseLayer)}getUpperLayer(){return this.layers.filter(t=>!t.baseLayer).reduce((t,i)=>t.zIndex>i.zIndex?t:i,{zIndex:void 0,id:void 0})}isUpperBaselayer(t){const i=this.layers.findIndex(n=>t.id===n.id);return!(!this.layers||!this.layers[i-1]||!0!==this.layers[i-1].baseLayer)}moveActiveLayer(t,i,n=!1){const p=[];(0,cs.UR)(this.map,t,Ai.a.ZINDEX);let v=(0,cs.UR)(this.map,t,Ai.a.ZINDEX);v||(v=t);const Y=[v];(0,cs.m)(this.map,v,Y,Ai.a.ZINDEX),this.layers.map(ue=>{-1!==Y.indexOf(ue)&&p.push(ue)}),i===Fr.Raise?this.raiseLayers(p,n):i===Fr.Lower&&this.lowerLayers(p,n)}raisableLayers(t){let i=!1,n=0;for(const p of t){const v=this.layers.findIndex(ye=>p.id===ye.id),Y=this.layers[v];Y.baseLayer&&(n+=1);const ue=this.layers[v-1];ue&&!0!==ue.baseLayer&&!t.find(ye=>ue.id===ye.id)&&!0!==Y.baseLayer&&(i=!0)}return(1===this.layersChecked.length&&this.layersChecked[0].baseLayer||n===this.layersChecked.length)&&(i=!1),i}raisableLayer(t){return!(t<1)&&(!this.layers[t-1].options.check||this.raisableLayer(t-1))}raiseLayers(t,i=!0){const n=[];for(const p of t){const v=this.layers.findIndex(Y=>Y.id===p.id);this.raisableLayer(v)&&n.push(p)}this.map.raiseLayers(n),i&&setTimeout(()=>{const p=this.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked"),v=this.elRef.nativeElement.getElementsByClassName("igo-layer-item-focused");let Y;p.length&&(Y=p[0]),v.length&&(Y=v[0]),Y&&(0,Da.c)(Y,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})},100)}lowerableLayers(t){let i=!1,n=0;for(const p of t){const v=this.layers.findIndex(ye=>p.id===ye.id);this.layers[v].baseLayer&&(n+=1);const ue=this.layers[v+1];ue&&!0!==ue.baseLayer&&!t.find(ye=>ue.id===ye.id)&&(i=!0)}return(1===this.layersChecked.length&&this.layersChecked[0].baseLayer||n===this.layersChecked.length)&&(i=!1),i}lowerableLayer(t){return!(t>this.layers.filter(i=>!0!==i.baseLayer).length-2)&&(!this.layers[t+1].options.check||this.lowerableLayer(t+1))}lowerLayers(t,i=!0){const n=[];for(const p of t){const v=this.layers.findIndex(Y=>Y.id===p.id);this.lowerableLayer(v)&&n.push(p)}this.map.lowerLayers(n),i&&setTimeout(()=>{const p=this.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked"),v=this.elRef.nativeElement.getElementsByClassName("igo-layer-item-focused");let Y;p.length&&(Y=p[p.length-1]),v.length&&(Y=v[0]),Y&&(0,Da.c)(Y,{scrollMode:"if-needed",behavior:"smooth",block:"end",inline:"nearest"})},100)}next(){this.change$.next()}computeLayers(t){let i=this.filterLayers(t);return i=this.sortAlpha?this.sortLayersByTitle(i):this.sortLayersByZindex(i),i}onKeywordChange(t){this.keyword=t}onAppliedFilterAndSortChange(t){this.keyword=t.keyword,this.onlyVisible=t.onlyVisible,this.sortAlpha=t.sortAlpha}filterLayers(t){if(this.layerFilterAndSortOptions.showToolbar===hr.never||!this.keyword&&!this.onlyVisible)return t;const i=t.map(n=>n.id);return t.forEach(n=>{const v=n.dataSource.options||{},ye=(((n.options||{}).metadata||{}).keywordList||[]).map(Ee=>Ee.normalize("NFD").replace(/[\u0300-\u036f]/g,""));if(this.keyword&&n.title){const Ee=this.keyword.normalize("NFD").replace(/[\u0300-\u036f]/g,""),we=n.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),Le=v.type||"",Xe=new RegExp(Ee,"gi"),Ge=void 0!==ye.find(tt=>Xe.test(tt));if(!Xe.test(we)&&this.keyword.toLowerCase()!==Le.toLowerCase()&&!Ge){const tt=i.indexOf(n.id);tt>-1&&i.splice(tt,1)}}if(this.onlyVisible&&!1===n.visible){const Ee=i.indexOf(n.id);Ee>-1&&i.splice(Ee,1)}}),t.filter(n=>-1!==i.indexOf(n.id))}sortLayersByZindex(t){return t.sort((i,n)=>n.zIndex-i.zIndex)}sortLayersByTitle(t){return t.sort((i,n)=>this.normalize(i.title)<this.normalize(n.title)?-1:this.normalize(i.title)>this.normalize(n.title)?1:0)}normalize(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}computeShowToolbar(){switch(this.layerFilterAndSortOptions.showToolbar){case hr.always:return!0;case hr.never:return!1;default:return!!(this.layers.length>=this.thresholdToFilterAndSort||this.keyword||this.onlyVisible)}}toggleLayerTool(t){this.toggleOpacity=!1,this.layerTool=!this.layerTool||t!==this.activeLayer;for(const i of this.layers)i.options.active=!1;t.options.active=!0,this.activeLayer=t}removeLayers(t){if(t&&t.length>0){this.layersChecked=[];for(const i of t)!1!==i.options.removable?i.map.removeLayer(i):this.layersChecked.push(i)}else!t&&!1!==this.activeLayer.options.removable&&(this.activeLayer.map.removeLayer(this.activeLayer),this.layerTool=!1)}toggleVisibility(t){if(t&&t.length>0)for(const i of t)i.visible=this.hideSelectedLayers;this.layerItemChangeDetection$.next(!0)}isLayerRemovable(t){return!1!==t.options.removable}isAllLayersRemovable(t){return t.every(i=>this.isLayerRemovable(i))}get statusSelectedLayersCheck(){let t=Zn.NULL,i=!1,n=!1;if(0===this.layersChecked.length)t=Zn.NULL;else{t=Zn.MIXED,this.hideSelectedLayers=!1;for(const p of this.layersChecked)!0===p.visible&&(i=!0),!1===p.visible&&(n=!0);!0===i&&!1===n&&(t=Zn.ALL_VISIBLE),!1===i&&!0===n&&(t=Zn.ALL_HIDDEN,this.hideSelectedLayers=!0)}return t}layersCheck(t){if(t.layer.options.check=t.check,!0===t.check){const i=this.layers.findIndex(n=>t.layer.id===n.id);for(const n of this.layersChecked)if(i<this.layers.findIndex(v=>n.id===v.id))return this.layersChecked.splice(this.layersChecked.findIndex(v=>n.id===v.id),0,t.layer),void(this.excludeBaseLayers?this.selectAllCheck=this.layersChecked.length===this.layers.filter(v=>!0!==v.baseLayer&&v.showInLayerList).length:this.excludeBaseLayers||(this.selectAllCheck=this.layersChecked.length===this.layers.filter(v=>v.showInLayerList).length));this.layersChecked.push(t.layer)}else{const i=this.layersChecked.findIndex(n=>t.layer.id===n.id);this.layersChecked.splice(i,1)}this.excludeBaseLayers?this.selectAllCheck=this.layersChecked.length===this.layers.filter(i=>!0!==i.baseLayer&&i.showInLayerList).length:this.excludeBaseLayers||(this.selectAllCheck=this.layersChecked.length===this.layers.filter(i=>i.showInLayerList).length)}toggleSelectionMode(t){if(this.selection=t,this.activeLayer=void 0,!0===t){this.layerTool=!1;for(const i of this.layers)i.options.check&&this.layersChecked.push(i)}}layersCheckedOpacity(){if(this.layersChecked.length>1)return 1;{const t=[];for(const i of this.layersChecked)t.push(i.opacity);return t}}selectAll(){if(this.selectAllCheck){for(const t of this.layers)t.options.check=!1;this.layersChecked=[],this.selectAllCheck$.next(!1)}else{for(const t of this.layers)(this.excludeBaseLayers&&!0!==t.baseLayer&&t.showInLayerList||!this.excludeBaseLayers&&t.showInLayerList)&&(t.options.check=!0,this.layersChecked.push(t));this.selectAllCheck$.next(!0)}}isScrolledIntoView(t,i){const n=t.scrollTop,v=i.offsetTop;return v+i.clientHeight<=n+t.clientHeight&&v>=n}removeProblemLayerInList(t){for(const i of t)!0===i.olLoadingProblem&&this.map.removeLayer(i);return t}static \u0275fac=function(i){return new(i||l)(e.GI1(e.GMv),e.GI1(be.IL))};static \u0275cmp=e.In1({type:l,selectors:[["igo-layer-list"]],contentQueries:function(i,n,p){if(1&i&&e.szK(p,Au,5),2&i){let v;e.wto(v=e.Gqi())&&(n.templateLayerToolbar=v.first)}},inputs:{layersAreAllVisible:"layersAreAllVisible",ogcButton:"ogcButton",timeButton:"timeButton",map:"map",layers:"layers",floatLabel:"floatLabel",layerFilterAndSortOptions:"layerFilterAndSortOptions",excludeBaseLayers:"excludeBaseLayers",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",queryBadge:"queryBadge"},outputs:{appliedFilterAndSort:"appliedFilterAndSort"},standalone:!0,features:[e.UHJ],ngContentSelectors:Qu,decls:10,vars:11,consts:[["floatLabel","auto",3,"layersAreAllVisible","term","onlyVisible","sortAlpha","appliedFilterAndSort","selection",4,"ngIf"],["class","select-all",4,"ngIf"],[3,"navigation","selection"],["igoList",""],["ngFor","",3,"ngForOf"],["class","igo-layer-actions-container",3,"title",4,"ngIf"],["floatLabel","auto",3,"layersAreAllVisible","term","onlyVisible","sortAlpha","appliedFilterAndSort","selection"],[1,"select-all"],[1,"select-all-checkbox",3,"color","checked","indeterminate","change"],["igoListItem","",3,"layer","activeLayer","orderable","lowerDisabled","raiseDisabled","queryBadge","expandLegendIfVisible","updateLegendOnResolutionChange","toggleLegendOnVisibilityChange","selectionMode","selectAll","layerCheck","changeDetection","action","checkbox",4,"ngIf"],["igoListItem","",3,"layer","activeLayer","orderable","lowerDisabled","raiseDisabled","queryBadge","expandLegendIfVisible","updateLegendOnResolutionChange","toggleLegendOnVisibilityChange","selectionMode","selectAll","layerCheck","changeDetection","action","checkbox"],[1,"igo-layer-actions-container",3,"title"],[1,"igo-layer-button-group"],["class","delete-button","mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"down-button",3,"matTooltip","disabled","click"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium",3,"matBadge","matBadgeHidden"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"up-button",3,"matTooltip","disabled","click"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"opacity-button",3,"matMenuTriggerFor","matTooltip"],["aria-hidden","false","matBadgeColor","primary","matBadgeSize","medium",3,"matBadge"],[1,"panel-opacity-menu"],["opacityMenu","matMenu"],["id","opacity-slider","color","primary","discrete","","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","matTooltip","click"],["ngSlider",""],["matSliderThumb","",3,"value","input"],["ngSliderThumb","matSliderThumb"],["class","zoomLayer-button","color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["igoLayerItemToolbar","",3,"ngTemplateOutlet","ngTemplateOutletContext"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"delete-button",3,"matTooltip","click"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"zoomLayer-button",3,"matTooltip","click"],["matBadgeColor","primary","matBadgeSize","medium",3,"svgIcon"],[1,"actions-buttons-multi"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"delete-button",3,"disabled","matTooltip","click"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"eye-button",3,"disabled","matTooltip","click"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"opacity-button",3,"disabled","matMenuTriggerFor","matTooltip"],[1,"mat-menu-opacity-slider"],["id","opacity-menu"],["id","opacity-slider","color","primary","thumbLabel","","showTickMarks","","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","ngModel","matTooltip","ngModelChange","click",4,"ngIf"],["id","opacity-slider","color","primary","thumbLabel","","showTickMarks","","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"min","max","ngModel","matTooltip","ngModelChange","click"],["matSliderThumb",""],[3,"svgIcon"]],template:function(i,n){1&i&&(e.kPM(Ju),e.yuY(0,Bu,1,4,"igo-layer-list-tool",0),e.wVc(1,"async"),e.yuY(2,Uu,5,8,"div",1),e.wR5(3,"mat-divider"),e.I0R(4,"igo-list",2,3),e.yuY(6,Vu,1,1,"ng-template",4),e.wVc(7,"async"),e.C$Y(),e.yuY(8,Nu,27,34,"igo-panel",5)(9,Xu,32,41,"igo-panel",5)),2&i&&(e.E7m("ngIf",e.kDX(1,7,n.showToolbar$)),e.yG2(2),e.E7m("ngIf",n.selection),e.yG2(2),e.E7m("navigation",!1)("selection",!1),e.yG2(2),e.E7m("ngForOf",e.kDX(7,9,n.layers$)),e.yG2(2),e.E7m("ngIf",!n.selection&&n.layerTool&&n.activeLayer),e.yG2(),e.E7m("ngIf",n.selection&&n.layers.length>0))},dependencies:[Ke.u_,Ma,$t.Vn,$t.WK,to.U,to.k,be.yM,Ke.Iw,Ia,be.qU,be.cP,Ze.oJ,Ze.um,ht.KO,ht.a4,dt.oB,dt.qL,st.g,st.S,ls._A,ls.aM,ls.yG,Jt.yO,Jt.Cg,Jt._s,Ke.XV,xe.y,xe.ue,xe._G,Ke.a,k._s,pe.sD],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{flex:1;padding-top:8px}[_nghost-%COMP%]   mat-form-field.inputFilter[_ngcontent-%COMP%]{width:calc(100% - 100px);max-width:200px}[_nghost-%COMP%]   .igo-layer-actions-container[_ngcontent-%COMP%]{padding:0 6px 0 4px}[_nghost-%COMP%]   .igo-layer-actions-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__content{margin-bottom:10px}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%], [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row-reverse;overflow-x:auto;overflow-y:hidden}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar{height:4px}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-track, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover, [_nghost-%COMP%]   .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]{padding-top:5px}[_nghost-%COMP%]   igo-panel[_ngcontent-%COMP%]{height:unset}[_nghost-%COMP%]   .select-all[_ngcontent-%COMP%]{display:flex;align-items:center;height:48px;padding:0 16px}  .panel-opacity-menu{overflow:visible!important}  .panel-opacity-menu #opacity-slider{margin:0 16px}"],changeDetection:0})}return l})();function Zu(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",1),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.toggleTrackFeature())}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"my_location"),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.layer.trackFeature"))("color",t.color)}}let Pa=(()=>{class l{layer;trackFeature=!1;get options(){if(this.layer)return this.layer.options}color="primary";constructor(){}ngOnInit(){this.color=this.trackFeature?"primary":"basic"}toggleTrackFeature(){this.trackFeature?(this.layer.disableTrackFeature(this.layer.options.trackFeature),this.color="basic"):(this.layer.enableTrackFeature(this.layer.options.trackFeature),this.color="primary"),this.trackFeature=!this.trackFeature}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-track-feature-button"]],inputs:{layer:"layer",trackFeature:"trackFeature"},standalone:!0,features:[e.UHJ],decls:1,vars:1,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"]],template:function(i,n){1&i&&e.yuY(0,Zu,4,4,"button",0),2&i&&e.E7m("ngIf",n.options.trackFeature)},dependencies:[Ke.u_,Ze.oJ,Ze.um,ht.KO,ht.a4,dt.oB,dt.qL,k._s,pe.sD],changeDetection:0})}return l})(),qu=(()=>{class l{constructor(){}open(t){t.extern&&window.open(t.url,"_blank")}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function ed(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",1),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.openMetadata(n.options.metadata))}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"info"),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.metadata.show"))("color",t.color)}}function td(l,m){if(1&l&&(e.I0R(0,"mat-dialog-content",3)(1,"h3"),e.OEk(2),e.C$Y()()),2&l){const t=e.GaO();e.yG2(2),e.cNF(t.data.abstract)}}function od(l,m){if(1&l&&(e.I0R(0,"mat-dialog-content",3),e.wR5(1,"h3",4),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("innerHTML",t.data.abstract,e.E3n)}}let ds=(()=>{class l{metadataService;dialog;get layer(){return this._layer}set layer(t){this._layer=t}_layer;get color(){return this._color}set color(t){this._color=t}_color="primary";constructor(t,i){this.metadataService=t,this.dialog=i}openMetadata(t){t.extern?!t.url&&t.abstract?this.dialog.open(ps,{data:{layerTitle:this.layer.title,abstract:t.abstract,type:t.type}}):t.url&&this.metadataService.open(t):!t.extern&&t.abstract&&this.dialog.open(ps,{data:{layerTitle:this.layer.title,abstract:t.abstract,type:t.type}})}get options(){if(this.layer)return this.layer.options}static \u0275fac=function(i){return new(i||l)(e.GI1(qu),e.GI1(_t.qW))};static \u0275cmp=e.In1({type:l,selectors:[["igo-metadata-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[e.UHJ],decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"]],template:function(i,n){1&i&&e.yuY(0,ed,4,4,"button",0),2&i&&e.E7m("ngIf",n.options&&n.options.metadata&&n.options.metadata.url||n.options&&n.options.metadata&&n.options.metadata.abstract)},dependencies:[Ke.u_,Ze.oJ,Ze.um,ht.KO,ht.a4,dt.oB,dt.qL,k._s,pe.sD,_t.sr],changeDetection:0})}return l})(),ps=(()=>{class l{data;constructor(t){this.data=t}static \u0275fac=function(i){return new(i||l)(e.GI1(_t.sR))};static \u0275cmp=e.In1({type:l,selectors:[["igo-metadata-abstract"]],standalone:!0,features:[e.UHJ],decls:6,vars:3,consts:[["mat-dialog-title",""],["mat-button","","mat-dialog-close","",1,"close-button"],["class","mat-typography",4,"ngIf"],[1,"mat-typography"],[3,"innerHTML"]],template:function(i,n){1&i&&(e.I0R(0,"h2",0),e.OEk(1),e.C$Y(),e.I0R(2,"button",1),e.OEk(3,"X"),e.C$Y(),e.yuY(4,td,3,1,"mat-dialog-content",2)(5,od,2,1,"mat-dialog-content",2)),2&i&&(e.yG2(),e.cNF(n.data.layerTitle),e.yG2(3),e.E7m("ngIf","arcgisrest"!==n.data.type),e.yG2(),e.E7m("ngIf","arcgisrest"===n.data.type))},dependencies:[_t.WQ,Ze.oJ,Ze.Gw,_t.qq,Ke.u_,_t.iU],styles:[":host{position:relative;display:block}:host .close-button{top:5px;right:5px;padding:7px;line-height:10px;position:absolute!important;min-width:auto}\n"],encapsulation:2})}return l})(),Fa=(()=>{class l extends x.i{static id="map";static type=b.Y;constructor(t){super(t)}getId(){return l.id}getType(){return l.type}getDefaultOptions(){return{title:"Carte"}}static \u0275fac=function(i){return new(i||l)(e.CoB("options"))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();function id(l){return new Fa(l.getConfig(`searchSources.${Fa.id}`)||{})}var rd=r(93199);let sd=(()=>{class l{static forRoot(){return{ngModule:l,providers:[{provide:x.i,useFactory:id,multi:!0,deps:[A.aW]}]}}static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({providers:[rd.E],imports:[Ke.MD,Ht.UD]})}return l})();new e.UbH("styleListOptions");var fr=r(82736);function ld(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",11)(1,"span")(2,"mat-icon",6),e.OEk(3,"format_color_fill"),e.C$Y(),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.I0R(6,"igo-color-picker-form-field",12),e.qCj("colorChange",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.setLayerFillColor(n))}),e.C$Y()()}2&l&&(e.yG2(4),e.oRS(" ",e.kDX(5,1,"igo.geo.style.fill")," "))}let cd=(()=>{class l{dialogRef;formBuilder;data;confirmFlag=!1;form;styleModalData;linestringOnly;initialValues;defaultValues={fillColor:"rgba(255,255,255,0.4)",strokeColor:"rgba(143,7,7,1)"};get layerOlStyle(){const t=this.data.layer.ol.getStyle();return t instanceof Function?void 0:t.clone()}constructor(t,i,n){this.dialogRef=t,this.formBuilder=i,this.data=n}ngOnInit(){this.linestringOnly=!0;for(const t of this.data.layer.ol.getSource().getFeatures())"LineString"!==t.getGeometry()?.getType()&&(this.linestringOnly=!1);this.buildStyleData(),this.buildForm()}buildForm(){this.form=this.formBuilder.group({fill:[this.getLayerFillColor()],stroke:[this.getLayerStrokeColor()]})}buildStyleData(){this.styleModalData={fillColor:this.getLayerFillColor(),strokeColor:this.getLayerStrokeColor()},this.initialValues={fillColor:this.getLayerFillColor(),strokeColor:this.getLayerStrokeColor()}}getLayerFillColor(){let t=this.defaultValues.fillColor;const i=this.layerOlStyle;if(i?.getFill()?.getColor()){const n=i.getFill().getColor();t=`rgba(${n[0]},${n[1]},${n[2]},${n[3]||.4})`}return t}getLayerStrokeColor(){let t=this.defaultValues.strokeColor;const i=this.layerOlStyle;if(i?.getStroke()?.getColor()){const n=i.getStroke().getColor();t=`rgba(${n[0]},${n[1]},${n[2]},${n[3]||1})`}return t}setLayerFillColor(t){const i=(0,fr.f4)(t),n=this.layerOlStyle.clone();n.getImage().getFill().setColor(i),n.getFill().setColor(i),this.data.layer.ol.setStyle(n),this.styleModalData.fillColor=t}setLayerStrokeColor(t){const i=(0,fr.f4)(t),n=this.layerOlStyle.clone();n.getImage().getStroke().setColor(i),n.getStroke().setColor(i),this.data.layer.ol.setStyle(n),this.styleModalData.strokeColor=t}cancel(){this.dialogRef.close(),this.setLayerFillColor(this.initialValues.fillColor),this.setLayerStrokeColor(this.initialValues.strokeColor)}confirm(){this.confirmFlag=!0,this.form.get("fill").value&&(this.styleModalData.fillColor=this.form.get("fill").value),this.form.get("stroke").value&&(this.styleModalData.strokeColor=this.form.get("stroke").value),this.dialogRef.close(this.styleModalData)}openPicker(){this.dialogRef.disableClose=!0}closePicker(){this.dialogRef.disableClose=!1}static \u0275fac=function(i){return new(i||l)(e.GI1(_t.yI),e.GI1(xe.KE),e.GI1(_t.sR))};static \u0275cmp=e.In1({type:l,selectors:[["igo-style-modal-layer"]],inputs:{confirmFlag:"confirmFlag"},standalone:!0,features:[e.UHJ],decls:20,vars:11,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content",""],[1,"edition-drawing","mat-typography"],[1,"igo-form",3,"formGroup"],["class","fill-color-picker mat-typography",4,"ngIf"],[1,"stroke-color-picker","mat-typography"],[1,"stroke-palette-icon"],["formControlName","stroke",3,"colorChange"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"fill-color-picker","mat-typography"],["formControlName","fill",3,"colorChange"]],template:function(i,n){1&i&&(e.I0R(0,"h2",0),e.OEk(1),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"div",1)(4,"div",2)(5,"form",3),e.yuY(6,ld,7,3,"div",4),e.I0R(7,"div",5)(8,"span")(9,"mat-icon",6),e.OEk(10,"border_color"),e.C$Y(),e.OEk(11),e.wVc(12,"translate"),e.C$Y(),e.I0R(13,"igo-color-picker-form-field",7),e.qCj("colorChange",function(v){return n.setLayerStrokeColor(v)}),e.C$Y()()()()(),e.I0R(14,"div",8)(15,"button",9),e.qCj("click",function(){return n.cancel()}),e.OEk(16),e.wVc(17,"translate"),e.C$Y(),e.I0R(18,"button",10),e.qCj("click",function(){return n.confirm()}),e.OEk(19,"OK"),e.C$Y()()),2&i&&(e.yG2(),e.oRS(" ",e.kDX(2,5,"igo.geo.style.styleModal"),"\n"),e.yG2(4),e.E7m("formGroup",n.form),e.yG2(),e.E7m("ngIf",!0!==n.linestringOnly),e.yG2(5),e.oRS(" ",e.kDX(12,7,"igo.geo.style.stroke")," "),e.yG2(5),e.oRS(" ",e.kDX(17,9,"igo.geo.style.cancel")," "))},dependencies:[_t.WQ,_t.iU,xe.y,xe.sz,xe.ue,xe.u,xe.sl,xe.uW,xe.Wo,Ke.u_,dt.oB,dt.qL,be.Q9,_t.Yp,Ze.oJ,Ze.Gw,k._s,pe.sD],styles:["h2[_ngcontent-%COMP%]{font-weight:700;font-size:large}.igo-form[_ngcontent-%COMP%]{padding:10px}.fill-field[_ngcontent-%COMP%], .stroke-field[_ngcontent-%COMP%]{width:130px}.fill-color-picker[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:relative;top:7px}.fill-color-picker[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{left:8px}.stroke-color-picker[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:relative;top:7px}.stroke-color-picker[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{left:35px}.box[_ngcontent-%COMP%]{width:25px;height:25px}.edition-drawing[_ngcontent-%COMP%]{padding:10px 0}.igo-input-container[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%] + .mat-form-field[_ngcontent-%COMP%]{margin-left:8px}.igo-form-input-box[_ngcontent-%COMP%]{width:150px}button[_ngcontent-%COMP%]{margin-right:5px}"]})}return l})(),ud=(()=>{class l{dialog;layer;constructor(t){this.dialog=t}openStyleModalDialog(){setTimeout(()=>{this.dialog.open(cd,{disableClose:!1,data:{layer:this.layer},autoFocus:!1})},250)}static \u0275fac=function(i){return new(i||l)(e.GI1(_t.qW))};static \u0275cmp=e.In1({type:l,selectors:[["igo-style-modal-layer-button"]],inputs:{layer:"layer"},standalone:!0,features:[e.UHJ],decls:4,vars:3,consts:[["mat-icon-button","","color","primary",3,"matTooltip","click"],[1,"style-icon"]],template:function(i,n){1&i&&(e.I0R(0,"button",0),e.qCj("click",function(){return n.openStyleModalDialog()}),e.wVc(1,"translate"),e.I0R(2,"mat-icon",1),e.OEk(3,"palette "),e.C$Y()()),2&i&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.style.styleModalTooltipLayer"))},dependencies:[Ze.oJ,Ze.um,ht.KO,ht.a4,dt.oB,dt.qL,k._s,pe.sD],changeDetection:0})}return l})();r(28616);let La=(()=>{class l{cdRef;layer;map;complete=new e._w7;cancel=new e._w7;constructor(t){this.cdRef=t}onUpdateInputs(){this.cdRef.detectChanges()}onClose(){this.cancel.emit()}static \u0275fac=function(i){return new(i||l)(e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-ogc-filter"]],inputs:{layer:"layer",map:"map"},outputs:{complete:"complete",cancel:"cancel"},standalone:!0,features:[e.UHJ],decls:1,vars:3,consts:[["igoListItem","",3,"layer","header","map"]],template:function(i,n){1&i&&e.wR5(0,"igo-ogc-filterable-item",0),2&i&&e.E7m("layer",n.layer)("header",!1)("map",n.map)},dependencies:[jo],changeDetection:0})}return l})(),Ga=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[La]})}return l})();const $a=new e.UbH("OgcFilterWidget");function dd(l){return l.create(La)}function pd(){return{provide:$a,useFactory:dd,deps:[be.cx]}}let md=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({})}return l})(),gd=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({providers:[pd()],imports:[be.Se,Ga,md,_t.sr,Ga]})}return l})();var ms=r(3360),An=r(47864),po=function(l){return l.Layer="layer",l.Group="group",l}(po||{}),Vt=function(l){return l[l.wms=0]="wms",l[l.wmts=1]="wmts",l[l.baselayers=2]="baselayers",l[l.arcgisrest=3]="arcgisrest",l[l.tilearcgisrest=4]="tilearcgisrest",l[l.imagearcgisrest=5]="imagearcgisrest",l[l.composite=6]="composite",l}(Vt||{});class qn{id;title;url;removable;externalProvider;abstract;forcedProperties;items;type;version;matrixSet;requestEncoding;regFilters;groupImpose;groupSeparator;timeFilter;queryFormat;queryHtmlTarget;queryParams;sourceOptions;count;tooltipType;sortDirection;setCrossOriginAnonymous;showLegend;profils;constructor(m){Object.assign(this,m)}}class hd extends qn{_collectCatlogItems;constructor(m,t){super(m),this._collectCatlogItems=t,this.type=Vt[Vt[Vt.wms]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class fd extends qn{_collectCatlogItems;constructor(m,t){super(m),this._collectCatlogItems=t,this.type=Vt[Vt[Vt.wmts]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class yd extends qn{_collectCatlogItems;constructor(m,t){super(m),this._collectCatlogItems=t,this.type=Vt[Vt[Vt.baselayers]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class _d extends qn{_collectCatlogItems;constructor(m,t){super(m),this._collectCatlogItems=t,this.type=Vt[Vt[Vt.arcgisrest]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class ka extends qn{_collectCatlogItems;constructor(m,t,i){super(m),this._collectCatlogItems=t,this.type=Vt[Vt[i]]}collectCatalogItems(){return this._collectCatlogItems(this)}}class Cd extends qn{_collectCatlogItems;constructor(m,t){super(m),this._collectCatlogItems=t,this.type=Vt[Vt[Vt.composite]],this.url=null}collectCatalogItems(){return this._collectCatlogItems(this)}}let vd=(()=>{class l{http;config;languageService;messageService;capabilitiesService;constructor(t,i,n,p,v){this.http=t,this.config=i,this.languageService=n,this.messageService=p,this.capabilitiesService=v}loadCatalogs(){const t=this.config.getConfig("context")||{},i=this.config.getConfig("catalog")||{},n=i.url||t.url,p=i.sources||[],v=[];if(n){if(i.baselayers){const Ee=[{id:"catalog.baselayers",title:this.languageService.translate.instant("igo.geo.catalog.baseLayers"),url:`${n}/baselayers`,type:"baselayers"}];v.push((0,z.of)(Ee))}const Y=this.http.get(`${n}/catalogs`).pipe((0,oe.k)(ue=>ue.map(ye=>Object.assign(ye,ye.options))),(0,se.a)(ue=>Pr.k));v.push(Y)}return p.length>0&&v.push((0,z.of)(p).pipe((0,oe.k)(Y=>Y.map(ue=>(ue.id||(ue.id=(0,ae.uq)()),ue))))),(0,ms.E)(...v).pipe((0,oe.k)(Y=>[].concat.apply([],Y)))}loadCatalogItems(t){let i;return i=Aa.createInstanceCatalog(t,this),i.collectCatalogItems()}loadCatalogBaseLayerItems(t){return this.getCatalogBaseLayersOptions(t).pipe((0,oe.k)(i=>{const n=i.map(p=>({id:(0,An.KC)(p.sourceOptions),title:p.title,type:po.Layer,externalProvider:t.externalProvider,options:p}));return[{id:"catalog.group.baselayers",type:po.Group,externalProvider:t.externalProvider,title:t.title,items:n}]}))}getCatalogBaseLayersOptions(t){return this.http.get(t.url)}loadCatalogWMSLayerItems(t){return this.getCatalogCapabilities(t).pipe((0,oe.k)(i=>{const n=[];if(!i)return n;i.Service&&i.Service.Abstract&&i.Service.Abstract.length&&(t.abstract=i.Service.Abstract);const p=[];this.flattenWmsCapabilities(i.Capability.Layer,0,p,t.groupSeparator);const v=Object.assign({},i.Capability.Layer);return v.Layer=p.filter(Y=>0!==Y.Layer.length),this.includeRecursiveItems(t,v,n),n}),(0,se.a)(()=>(this.messageService.error("igo.geo.catalog.unavailable","igo.geo.catalog.unavailableTitle",void 0,{value:t.title}),Pr.k)))}flattenWmsCapabilities(t,i=0,n,p=" / "){if(!n.includes(t.Title)){const v=Object.assign({},t);v.Layer=[],n.push(v)}for(const v of t.Layer){const Y=Object.assign({},v);i>0&&(Y.Title=t.Title+p+v.Title),v.Layer?this.flattenWmsCapabilities(Y,i+1,n,p):n.find(ue=>ue.Title===t.Title).Layer.push(v)}}loadCatalogWMTSLayerItems(t){return this.getCatalogCapabilities(t).pipe((0,oe.k)(i=>this.getWMTSItems(t,i)))}loadCatalogArcGISRestItems(t){return this.getCatalogCapabilities(t).pipe((0,oe.k)(i=>this.getArcGISRESTItems(t,i)))}loadCatalogCompositeLayerItems(t){const i=t.composite,n=[];i.map(Le=>{Le.sortDirection=t.sortDirection,n.push(Aa.createInstanceCatalog(Le,this))});const p=[];n.map(Le=>p.push(Le.collectCatalogItems()));let v=[];function Y(Le){return Le.reduce((Xe,Ge)=>Xe.concat(Ge.type===po.Group?Y(Ge.items):Ge),[])}if(Object.keys(i).find(Le=>i[Le].groupImpose)){const Le=(Xe,Ge)=>{const tt=n[Ge],pt=Object.assign({},tt.groupImpose);pt.address=tt.id,pt.type=po.Group,pt.externalProvider=tt.externalProvider,void 0===pt.sortDirection&&(pt.sortDirection=tt.sortDirection),pt.items=[];const Tt=Y(Xe);return Tt.map(jt=>jt.address=`${pt.address}.${pt.id}`),pt.items=Tt,pt};v=p.map((Xe,Ge)=>Xe.pipe((0,oe.k)(tt=>i[Ge].groupImpose?Le(tt,Ge):tt)))}else v=p;const ue=(0,ms.E)(...v).pipe((0,oe.k)(Le=>[].concat(...Le))),Ee=(Le,Xe)=>Le.reduce((Ge,tt,pt,Tt)=>{const jt=Xe(tt),Co=Object.assign({},tt);if(tt.type===po.Layer){const Wo=[],er=[];if(Tt.filter((No,vi)=>{let tr=!1;return No.title===jt&&No.type===po.Layer&&(vi!==pt&&No.address!==tt.address&&(tr=!0),Wo.push(vi)),tr}).length>0){let No=Wo.findIndex(vi=>vi===pt)+1;Co.title=`${tt.title} (${No})`,No=er.findIndex(vi=>vi===pt)+1,Co.newMetadataUrl=`${tt.newMetadataUrl} (${No})`}Ge.find(No=>No.title===Co.title&&No.type===po.Layer)||(Ge[Ge.length]=Co)}else tt.type===po.Group&&(Co.items=Ee(tt.items,Wo=>Wo.title),Ge[Ge.length]=Co);return Ge},[]);return ue.pipe((0,oe.k)(Le=>((Le,Xe)=>Le.reduce((Ge,tt)=>{const pt=(Xe=>Xe.id)(tt),Tt=Ge.find(jt=>jt.id===pt);if(Tt){const jt=Ge.indexOf(Tt);-1===Ge[jt].address.split("|").indexOf(tt.address)&&(Ge[jt].address=`${Ge[jt].address}|${tt.address}`),Ge[jt].items.push(...tt.items)}else Ge[Ge.length]=tt;return Ge},[]))(Le)),(0,oe.k)(Le=>[].concat(...Le)),(0,oe.k)(Le=>Ee(Le,Xe=>Xe.title)))}getCatalogCapabilities(t){return this.capabilitiesService.getCapabilities(Vt[t.type],t.url,t.version).pipe((0,se.a)(n=>(this.messageService.error(t.title?"igo.geo.catalog.unavailable":"igo.geo.catalog.someUnavailable","igo.geo.catalog.unavailableTitle",void 0,t.title?{value:t.title}:void 0),console.error(n),(0,z.of)(void 0))))}computeForcedProperties(t,i){if(!i||0===i.length)return;const n={layerName:t,title:void 0,metadataUrl:void 0,metadataAbstract:void 0,metadataAbstractAll:void 0,metadataUrlAll:void 0},p=i.find(v=>"*"===v.layerName);return p&&(p.metadataAbstractAll&&(n.metadataAbstractAll=p.metadataAbstractAll),p.metadataUrlAll&&(n.metadataUrlAll=p.metadataUrlAll)),i.map(v=>{t===v.layerName&&(v.title&&(n.title=v.title),v.metadataUrl&&(n.metadataUrl=v.metadataUrl),v.metadataAbstract&&(n.metadataAbstract=v.metadataAbstract))}),n}prepareCatalogItemLayer(t,i,n,p){const v=this.retrieveLayerInfoFormat(t.Name,n),Y=p.showLegend&&t.Style?this.capabilitiesService.getStyle(t.Style):void 0,ue=Object.assign({},p.queryParams,{LAYERS:t.Name,VERSION:p.version}),ye={type:"wms",url:p.url,crossOrigin:p.setCrossOriginAnonymous?"anonymous":void 0,queryFormat:v,queryHtmlTarget:v===lt.s5.HTML||v===lt.s5.HTMLGML2?"iframe":void 0,optionsFromCapabilities:!0},Ee=Object.assign({},ye,p.sourceOptions,{params:ue}),we=this.computeForcedProperties(t.Name,p.forcedProperties);let Le,Xe=!0;t.Abstract?Le=t.Abstract:!t.Abstract&&p.abstract&&(Le=p.abstract);const Ge=t?.DataURL&&t?.DataURL.length>0?t?.DataURL[0].OnlineResource:void 0;let tt=we?.metadataUrl||we?.metadataUrlAll||Ge,pt=we?.metadataAbstract||we?.metadataAbstractAll||Le;!we?.metadataUrl&&!we?.metadataUrlAll&&(we?.metadataAbstract||we?.metadataAbstractAll)&&(Xe=!1),we?.metadataAbstract&&we?.metadataUrlAll&&(Xe=!1);const Tt={id:(0,An.KC)(Ee),type:po.Layer,title:we?.title?we.title:t.Title,address:i,externalProvider:p.externalProvider||!1,options:{maxResolution:(0,G.bg)(t.MaxScaleDenominator),minResolution:(0,G.bg)(t.MinScaleDenominator),metadata:{url:tt,extern:Xe,abstract:pt,type:ye.type},legendOptions:Y,tooltip:{type:p.tooltipType},sourceOptions:Ee}};return ae.Yv.removeUndefined(Tt)}prepareCatalogItemGroup(t,i,n,p,v){return{id:n,type:po.Group,title:t.Title,address:v.id,externalProvider:v.externalProvider||!1,sortDirection:v.sortDirection,items:t.Layer.reduce((ue,ye)=>{if(void 0!==ye.Layer){const we=this.prepareCatalogItemGroup(ye,i,n+`.group.${ye.Name||ye.Layer[0].Name}`,p,v);ue.push(we)}else{if(!1===this.testLayerRegexes(ye.Name,i))return ue;const Ee=this.prepareCatalogItemLayer(ye,n,p,v);ue.push(Ee)}return ue},[])}}includeRecursiveItems(t,i,n,p=0){const v=(t.regFilters||[]).map(Y=>new RegExp(Y));if(i.Layer)for(const Y of i.Layer){if(void 0!==Y.Layer){this.includeRecursiveItems(t,Y,n,p+1);continue}const ue=this.findCatalogInfoFormat(t);if(0!==p){const Ee=this.prepareCatalogItemGroup(i,v,`catalog.group.${i.Name||Y.Name}`,ue,t);0!==Ee.items.length&&n.push(Ee);break}if(!1!==this.testLayerRegexes(Y.Name,v)){const ye=this.prepareCatalogItemLayer(Y,t.id,ue,t);n.push(ye)}}}getWMTSItems(t,i){if(!i)return[];const n=i.Contents.Layer,p=(t.regFilters||[]).map(v=>new RegExp(v));return i.ServiceIdentification&&i.ServiceIdentification.Abstract&&i.ServiceIdentification.Abstract.length&&(t.abstract=i.ServiceIdentification.Abstract),n.map(v=>{const Y=this.computeForcedProperties(v.Title,t.forcedProperties);let ue=!0,ye=Y?.metadataUrl||Y?.metadataUrlAll,Ee=Y?.metadataAbstract||Y?.metadataAbstractAll||t.abstract;if(!Y?.metadataUrl&&!Y?.metadataUrlAll&&(Y?.metadataAbstract||Y?.metadataAbstractAll)&&(ue=!1),Y?.metadataAbstract&&Y?.metadataUrlAll&&(ue=!1),!1===this.testLayerRegexes(v.Identifier,p))return;const we=Object.assign({},t.queryParams,{version:"1.0.0"}),Le={type:"wmts",url:t.url,crossOrigin:t.setCrossOriginAnonymous?"anonymous":void 0,layer:v.Identifier,matrixSet:t.matrixSet,optionsFromCapabilities:!0,requestEncoding:t.requestEncoding||"KVP",style:"default"},Xe=Object.assign({},Le,t.sourceOptions,{params:we});return ae.Yv.removeUndefined({id:(0,An.KC)(Xe),type:po.Layer,title:Y?.title?Y.title:v.Title,address:t.id,externalProvider:t.externalProvider,options:{sourceOptions:Xe,metadata:{url:ye,extern:ue,abstract:Ee,type:Le.type}}})}).filter(v=>void 0!==v)}getArcGISRESTItems(t,i){if(!i||!i.layers)return this.messageService.error("igo.geo.catalog.someUnavailable","igo.geo.catalog.unavailableTitle"),[];const n=i.layers?i.layers.filter(we=>we.subLayerIds):[],p=i.layers?i.layers.filter(we=>!we.type||we.type===cr.I.FeatureLayer||we.type===cr.I.RasterLayer):[],v=(t.regFilters||[]).map(we=>new RegExp(we));let Y;i.serviceDescription&&i.serviceDescription.length&&(Y=i.serviceDescription.replace(/(<([^>]+)>)/gi,""));const ue=p.map(we=>{const Le=this.computeForcedProperties(we.name,t.forcedProperties);let Xe=t.abstract,Ge=!0,tt=Le?.metadataUrl||Le?.metadataUrlAll,pt=Le?.metadataAbstract||Le?.metadataAbstractAll||Xe;if(!Le?.metadataUrl&&!Le?.metadataUrlAll&&(Le?.metadataAbstract||Le?.metadataAbstractAll)&&(Ge=!1),Le?.metadataAbstract&&Le?.metadataUrlAll&&(Ge=!1),!1===this.testLayerRegexes(we.id.toString(),v))return;const Tt={type:Vt[t.type],url:t.url,layer:we.id.toString(),queryable:!0,queryFormat:lt.s5.ESRIJSON,optionsFromCapabilities:!0},jt=Object.assign({},Tt,t.sourceOptions);return ae.Yv.removeUndefined({id:(0,An.KC)(jt),type:po.Layer,title:Le?.title?Le.title:we.name,externalProvider:t.externalProvider,options:{sourceOptions:jt,minResolution:(0,G.bg)(we.maxScale),maxResolution:(0,G.bg)(we.minScale),metadata:{url:tt,extern:Ge,abstract:pt,type:t.type}}})}).filter(we=>void 0!==we),ye=[],Ee=n.map(we=>({options:void 0,address:`catalog.group.${we.name}`,id:`catalog.group.${we.name}`,type:po.Group,externalProvider:t.externalProvider,sortDirection:t.sortDirection,title:we.name,items:ue.filter(Le=>we.subLayerIds.map(Ge=>Ge.toString()).includes(Le.options.sourceOptions.layer)).map(Le=>(ye.push(Le.id),Object.assign({},Le,{address:`catalog.group.${we.name}`})))})).filter(we=>we.items.length);if(n){const we=t.title||t.id,Le=ue.filter(Xe=>!ye.includes(Xe.id)).map(Xe=>Object.assign({},Xe,{address:`catalog.group.${we}`}));Le.length&&Ee.push({options:void 0,address:`catalog.group.${we}`,id:`catalog.group.${we}`,type:po.Group,externalProvider:t.externalProvider,sortDirection:t.sortDirection,title:we,items:Le})}return n?Ee:ue}testLayerRegexes(t,i){return 0===i.length||void 0!==i.find(n=>n.test(t))}retrieveLayerInfoFormat(t,i){const n=i.find(Y=>Y.layer===t),p=i.find(Y=>"*"===Y.layer);let v;return n?v=n.queryFormat:p&&(v=p.queryFormat),v}findCatalogInfoFormat(t){const i=[];return t.queryFormat&&Object.keys(t.queryFormat).forEach(n=>{t.queryFormat[n]instanceof Array?t.queryFormat[n].forEach(p=>{i.find(v=>v.layer===p)||i.push({layer:p,queryFormat:n})}):i.find(p=>p.layer===t.queryFormat[n])||i.push({layer:t.queryFormat[n],queryFormat:n})}),i}static \u0275fac=function(i){return new(i||l)(e.CoB(fe.KK),e.CoB(A.aW),e.CoB(k.ov),e.CoB(Ht.mi),e.CoB(zo.S))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();class Aa{static createInstanceCatalog(m,t){let i;return i=m.hasOwnProperty("composite")?new Cd(m,n=>t.loadCatalogCompositeLayerItems(n)):m.type===Vt[Vt.baselayers]?new yd(m,n=>t.loadCatalogBaseLayerItems(n)):m.type===Vt[Vt.arcgisrest]?new _d(m,n=>t.loadCatalogArcGISRestItems(n)):m.type===Vt[Vt.tilearcgisrest]?new ka(m,n=>t.loadCatalogArcGISRestItems(n),Vt.tilearcgisrest):m.type===Vt[Vt.imagearcgisrest]?new ka(m,n=>t.loadCatalogArcGISRestItems(n),Vt.imagearcgisrest):m.type===Vt[Vt.wmts]?new fd(m,n=>t.loadCatalogWMTSLayerItems(n)):new hd(m,n=>t.loadCatalogWMSLayerItems(n)),i}}var gs=r(56708);function Sd(l,m){1&l&&e.wR5(0,"mat-icon",10)}function bd(l,m){1&l&&(e.I0R(0,"button",11)(1,"mat-icon",12),e.qCj("click",function(i){return i.stopPropagation()}),e.wVc(2,"translate"),e.OEk(3," public "),e.C$Y()()),2&l&&(e.yG2(),e.E7m("matTooltip",e.kDX(2,1,"igo.geo.catalog.externalProvider.layer")))}function Od(l,m){if(1&l&&(e.wR5(0,"igo-layer-legend",4),e.wVc(1,"async")),2&l){const t=e.GaO();e.E7m("layer",e.kDX(1,1,t.igoLayer$))}}let Ba=(()=>{class l{layerService;inRange$=new B.g(!0);isPreview$=new B.g(!1);isVisible$=new B.g(!1);isPreview$$;resolution$$;layers$$;lastTimeoutRequest;layerLegendShown$=new B.g(!1);igoLayer$=new B.g(void 0);mouseInsideAdd=!1;resolution;catalogAllowLegend=!1;layer;map;added=!1;addedChange=new e._w7;addedLayerIsPreview=new e._w7;get title(){return(0,be.YB)(this.layer)}get icon(){return(0,be.sH)(this.layer)||"layers"}constructor(t){this.layerService=t}ngOnInit(){this.isPreview$$=this.isPreview$.subscribe(t=>this.addedLayerIsPreview.emit(t)),this.layers$$=this.map.layers$.subscribe(()=>{this.isVisible()}),this.resolution$$=this.map.viewController.resolution$.subscribe(t=>{this.isInResolutionsRange(t),this.isVisible()})}ngOnDestroy(){this.isPreview$$.unsubscribe(),this.resolution$$.unsubscribe(),this.layers$$.unsubscribe()}computeTitleTooltip(){const t=this.layer.options;if(!t.tooltip)return(0,be.YB)(this.layer);const i=t.tooltip,n=t.metadata;switch(t.tooltip.type){case gs.wL.TITLE:return this.layer.title;case gs.wL.ABSTRACT:return n&&n.abstract?n.abstract:this.layer.title;case gs.wL.CUSTOM:return i&&i.text?i.text:this.layer.title;default:return this.layer.title}}onMouseEvent(t){this.onToggleClick(t)}askForLegend(t){this.layerLegendShown$.next(!this.layerLegendShown$.value),this.layerService.createAsyncLayer(this.layer.options).pipe((0,$.K)()).subscribe(i=>this.igoLayer$.next(i))}onToggleClick(t){if(typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest),"mouseenter"!==t.type||!this.mouseInsideAdd)switch(t.type){case"click":this.isPreview$.value||(this.added?this.remove(t):this.add(t)),this.isPreview$.next(!1);break;case"mouseenter":!this.isPreview$.value&&!this.added&&(this.lastTimeoutRequest=setTimeout(()=>{this.add(t),this.isPreview$.next(!0)},500)),this.mouseInsideAdd=!0;break;case"mouseleave":this.isPreview$.value&&(this.remove(t),this.isPreview$.next(!1)),this.mouseInsideAdd=!1}}add(t){this.added||(this.added=!0,this.addedChange.emit({added:!0,layer:this.layer,event:t}))}remove(t){this.added&&(this.added=!1,this.addedChange.emit({added:!1,layer:this.layer,event:t}))}haveGroup(){return!(!this.layer.address||1===this.layer.address.split(".").length)}isInResolutionsRange(t){const i=!this.layer.options.minResolution||Number.isNaN(this.layer.options.minResolution)?0:this.layer.options.minResolution,n=!this.layer.options.maxResolution||Number.isNaN(this.layer.options.maxResolution)?1/0:this.layer.options.maxResolution;this.inRange$.next(t>=i&&t<=n)}isVisible(){if(this.layer?.id){const t=this.map.getLayerById(this.layer?.id);this.isVisible$.next(!!t&&t.visible)}}getBadgeIcon(){return this.inRange$.getValue()&&this.isVisible$.getValue()?"":"visibility_off"}computeTooltip(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?this.isVisible$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapNotVisible":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"}static \u0275fac=function(i){return new(i||l)(e.GI1(Or.I))};static \u0275cmp=e.In1({type:l,selectors:[["igo-catalog-browser-layer"]],inputs:{resolution:"resolution",catalogAllowLegend:"catalogAllowLegend",layer:"layer",map:"map",added:"added"},outputs:{addedChange:"addedChange",addedLayerIsPreview:"addedLayerIsPreview"},standalone:!0,features:[e.UHJ],decls:24,vars:36,consts:[["class","catalog-browser-layer-carret","matListItemIcon","",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"ngClass","matTooltip","click"],["matListItemMeta",""],["disabled","true","mat-icon-button","",4,"ngIf"],[3,"layer"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click"],["aria-hidden","false","matBadge","icon","igoMatBadgeColor","rgba(0,0,0,0.87)","igoMatBadgeBackgroundColor","none","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeIcon","igoMatBadgeInverseColor","matBadgeHidden","matBadgeDisabled"],[1,"igo-cataloglayer-legend-container"],["legend",""],[3,"layer",4,"ngIf"],["matListItemIcon","",1,"catalog-browser-layer-carret"],["disabled","true","mat-icon-button",""],["tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"igo-cataloglayer-external-icon",3,"matTooltip","click"]],template:function(i,n){1&i&&(e.I0R(0,"mat-list-item"),e.yuY(1,Sd,1,0,"mat-icon",0),e.I0R(2,"span",1),e.qCj("click",function(v){return n.askForLegend(v)}),e.OEk(3),e.C$Y(),e.I0R(4,"div",2),e.yuY(5,bd,4,3,"button",3),e.wR5(6,"igo-metadata-button",4),e.I0R(7,"button",5),e.qCj("mouseenter",function(v){return n.onMouseEvent(v)})("mouseleave",function(v){return n.onMouseEvent(v)})("click",function(v){return n.onToggleClick(v)}),e.wVc(8,"translate"),e.wVc(9,"async"),e.I0R(10,"mat-icon",6),e.wVc(11,"async"),e.wVc(12,"async"),e.wVc(13,"async"),e.wVc(14,"async"),e.wVc(15,"async"),e.wVc(16,"async"),e.OEk(17),e.wVc(18,"async"),e.C$Y()()()(),e.I0R(19,"div",7,8),e.yuY(21,Od,2,3,"igo-layer-legend",9),e.wVc(22,"async"),e.wVc(23,"async"),e.C$Y()),2&i&&(e.yG2(),e.E7m("ngIf",n.haveGroup()),e.yG2(),e.E7m("ngClass",n.catalogAllowLegend?"igo-cataloglayer-title":"")("matTooltip",n.computeTitleTooltip()),e.yG2(),e.oRS(" ",n.title," "),e.yG2(2),e.E7m("ngIf",n.layer.externalProvider),e.yG2(),e.E7m("layer",n.layer),e.yG2(),e.E7m("matTooltip",e.kDX(8,14,n.computeTooltip()))("color",e.kDX(9,16,n.isPreview$)?"":n.added?"warn":""),e.yG2(3),e.E7m("igoMatBadgeIcon",n.getBadgeIcon())("igoMatBadgeInverseColor",!0)("matBadgeHidden",e.kDX(11,18,n.inRange$)&&!0===e.kDX(12,20,n.isVisible$)||e.kDX(13,22,n.inRange$)&&!n.added||e.kDX(14,24,n.inRange$)&&e.kDX(15,26,n.isPreview$))("matBadgeDisabled",!1===e.kDX(16,28,n.inRange$)),e.yG2(7),e.oRS(" ",e.kDX(18,30,n.isPreview$)?"plus":n.added?"delete":"add"," "),e.yG2(4),e.E7m("ngIf",e.kDX(22,32,n.layerLegendShown$)&&e.kDX(23,34,n.igoLayer$)&&n.catalogAllowLegend))},dependencies:[Ot.iI,Ot.g9,Ot.Y1,Ot.UV,Ot.At,Ke.u_,dt.oB,dt.qL,Ke.QF,ht.KO,ht.a4,Ze.oJ,Ze.um,ds,st.g,st.S,be.qS,Ao,Ke.a,k._s,pe.sD],styles:[".igo-cataloglayer-title[_ngcontent-%COMP%]{cursor:pointer}.catalog-browser-layer-carret[_ngcontent-%COMP%]{margin-right:16px}.igo-cataloglayer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px);margin-left:40px}.igo-cataloglayer-external-icon[_ngcontent-%COMP%]{cursor:help}[_nghost-%COMP%]   .mdc-list-item__end[_ngcontent-%COMP%], [_nghost-%COMP%]   .mdc-list-item__start[_ngcontent-%COMP%]{color:#000}"],changeDetection:0})}return l})();function Id(l,m){1&l&&(e.I0R(0,"mat-icon",10),e.qCj("click",function(i){return i.stopPropagation()}),e.wVc(1,"translate"),e.OEk(2," public "),e.C$Y()),2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.catalog.externalProvider.group"))}function wd(l,m){if(1&l&&(e.I0R(0,"button",8),e.yuY(1,Id,3,3,"mat-icon",9),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.E7m("ngIf",t.group.externalProvider)}}function Td(l,m){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"button",11),e.qCj("click",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onToggleClick(n))}),e.wVc(2,"translate"),e.wVc(3,"async"),e.I0R(4,"mat-icon"),e.OEk(5,"delete"),e.C$Y()(),e.k70()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("matTooltip",e.kDX(2,2,"igo.geo.catalog.group.removeFromMap"))("disabled",e.kDX(3,4,t.disabled$))}}function Ed(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",12),e.qCj("click",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.onToggleClick(n))}),e.wVc(1,"translate"),e.wVc(2,"async"),e.I0R(3,"mat-icon"),e.OEk(4,"add"),e.C$Y()()}if(2&l){const t=e.GaO();e.E7m("matTooltip",e.kDX(1,2,"igo.geo.catalog.group.addToMap"))("disabled",e.kDX(2,4,t.disabled$))}}function xd(l,m){1&l&&e.C_f(0)}function Md(l,m){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"igo-catalog-browser-layer",14),e.qCj("addedLayerIsPreview",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.onLayerPreview(n))})("addedChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.onLayerAddedChange(n))}),e.C$Y(),e.k70()}if(2&l){const t=e.GaO().$implicit,i=e.GaO();e.yG2(),e.E7m("layer",t)("resolution",i.resolution)("map",i.map)("catalogAllowLegend",i.catalogAllowLegend)("added",i.state.get(t).added)}}function Dd(l,m){if(1&l&&e.yuY(0,xd,1,0,"ng-container",13)(1,Md,2,5,"ng-container",13),2&l){const t=m.$implicit,i=e.GaO();e.E7m("ngIf",i.isGroup(t)),e.yG2(),e.E7m("ngIf",i.isLayer(t))}}let Pd=(()=>{class l{store=new be.qc([]);added$=new B.g(!1);preview$=new B.g(!1);disabled$=new B.g(!1);catalog;group;map;collapsed=!0;resolution;catalogAllowLegend=!1;toggleCollapsed=!0;state;addedChange=new e._w7;layerAddedChange=new e._w7;get title(){return this.group.title}ngOnInit(){this.store.load(this.group.items),this.evaluateAdded(),this.evaluateDisabled(this.collapsed),void 0!==this.group.sortDirection&&this.store.view.sort({direction:this.group.sortDirection,valueAccessor:t=>t.title})}ngOnDestroy(){this.store.destroy()}isGroup(t){return t.type===po.Group}isLayer(t){return t.type===po.Layer}onToggleClick(t){this.added$.value?this.remove(t):this.add(t)}onToggleCollapsed(t){this.evaluateDisabled(t)}onLayerAddedChange(t){this.layerAddedChange.emit(t),this.tryToggleGroup(t)}add(t){this.added$.next(!0),this.addedChange.emit({added:!0,group:this.group,event:t})}remove(t){this.added$.next(!1),this.addedChange.emit({added:!1,group:this.group,event:t})}onLayerPreview(t){this.preview$.next(t)}tryToggleGroup(t){const i=t.added,n=t.layer;this.store.view.all().filter(v=>v.id!==n.id).map(v=>this.state.get(v).added||!1).every(v=>v===i)?i?this.add(t.event):this.remove(t.event):!0===this.added$.value&&this.added$.next(!1)}evaluateAdded(){const t=this.store.all().every(i=>!0===(this.state.get(i).added||!1));this.added$.next(t)}evaluateDisabled(t){let i=!1;!1===this.toggleCollapsed&&(i=t),this.disabled$.next(i)}onTitleClick(){this.collapsed=!this.collapsed}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-catalog-browser-group"]],inputs:{catalog:"catalog",group:"group",map:"map",collapsed:"collapsed",resolution:"resolution",catalogAllowLegend:"catalogAllowLegend",toggleCollapsed:"toggleCollapsed",state:"state"},outputs:{addedChange:"addedChange",layerAddedChange:"layerAddedChange"},standalone:!0,features:[e.UHJ],decls:16,vars:14,consts:[["matListItemIcon","","igoCollapse","",1,"igo-chevron","catalog-browser-group-carret",3,"target","collapsed","toggle"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-catalog-group-title",3,"matTooltip","click"],["matListItemMeta",""],["disabled","true","mat-icon-button","",4,"ngIf"],[4,"ngIf","ngIfElse"],["notadded",""],["items",""],["ngFor","",3,"ngForOf"],["disabled","true","mat-icon-button",""],["class","igo-cataloggroup-external-icon","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"igo-cataloggroup-external-icon",3,"matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","disabled","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","click"],[4,"ngIf"],["igoListItem","",3,"layer","resolution","map","catalogAllowLegend","added","addedLayerIsPreview","addedChange"]],template:function(i,n){if(1&i&&(e.I0R(0,"mat-list-item")(1,"mat-icon",0),e.qCj("toggle",function(v){return n.onToggleCollapsed(v)}),e.OEk(2," expand_less "),e.C$Y(),e.I0R(3,"span",1),e.qCj("click",function(){return n.onTitleClick()}),e.OEk(4),e.C$Y(),e.I0R(5,"div",2),e.yuY(6,wd,2,1,"button",3)(7,Td,6,6,"ng-container",4),e.wVc(8,"async"),e.wVc(9,"async"),e.yuY(10,Ed,5,6,"ng-template",null,5,e.gJz),e.C$Y()(),e.I0R(12,"div",null,6),e.yuY(14,Dd,2,2,"ng-template",7),e.wVc(15,"async"),e.C$Y()),2&i){const p=e.Gew(11),v=e.Gew(13);e.yG2(),e.E7m("target",v)("collapsed",n.collapsed),e.yG2(2),e.E7m("matTooltip",n.title),e.yG2(),e.cNF(n.title),e.yG2(2),e.E7m("ngIf",n.group.externalProvider),e.yG2(),e.E7m("ngIf",e.kDX(8,8,n.added$)&&!1===e.kDX(9,10,n.preview$))("ngIfElse",p),e.yG2(7),e.E7m("ngForOf",e.kDX(15,12,n.store.view.all$()))}},dependencies:[Ot.iI,Ot.g9,Ot.Y1,Ot.UV,Ot.At,dt.oB,dt.qL,be.mK,ht.KO,ht.a4,Ke.u_,Ze.oJ,Ze.um,Ke.Iw,Ba,be.qU,Ke.a,k._s,pe.sD],styles:[".igo-catalog-group-title[_ngcontent-%COMP%]{cursor:pointer}.igo-cataloggroup-external-icon[_ngcontent-%COMP%]{cursor:help}.catalog-browser-group-carret[_ngcontent-%COMP%]{margin-right:16px}.igo-catalog-group-title[_ngcontent-%COMP%]{font-weight:500}[_nghost-%COMP%]   .mdc-list-item__end[_ngcontent-%COMP%], [_nghost-%COMP%]   .mdc-list-item__start[_ngcontent-%COMP%]{color:#000}"],changeDetection:0})}return l})();function Fd(l,m){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"igo-catalog-browser-group",3),e.qCj("addedChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.onGroupAddedChange(n))})("layerAddedChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.onLayerAddedChange(n))}),e.wVc(2,"async"),e.C$Y(),e.k70()}if(2&l){const t=e.GaO().$implicit,i=e.GaO();e.yG2(),e.E7m("catalog",i.catalog)("group",t)("map",i.map)("state",i.store.state)("resolution",e.kDX(2,8,i.resolution$))("catalogAllowLegend",i.catalogAllowLegend)("collapsed",1!==i.store.count)("toggleCollapsed",i.toggleCollapsedGroup)}}function Rd(l,m){if(1&l){const t=e.KQA();e.SAx(0),e.I0R(1,"igo-catalog-browser-layer",4),e.qCj("addedChange",function(n){e.usT(t);const p=e.GaO(2);return e.CGJ(p.onLayerAddedChange(n))}),e.wVc(2,"async"),e.C$Y(),e.k70()}if(2&l){const t=e.GaO().$implicit,i=e.GaO();e.yG2(),e.E7m("layer",t)("map",i.map)("resolution",e.kDX(2,5,i.resolution$))("catalogAllowLegend",i.catalogAllowLegend)("added",i.store.state.get(t).added)}}function Ld(l,m){if(1&l&&e.yuY(0,Fd,3,10,"ng-container",2)(1,Rd,3,7,"ng-container",2),2&l){const t=m.$implicit,i=e.GaO();e.E7m("ngIf",i.isGroup(t)),e.yG2(),e.E7m("ngIf",i.isLayer(t))}}let Ua=(()=>{class l{layerService;cdRef;watcher;get resolution$(){return this.map.viewController.resolution$}catalogAllowLegend=!1;catalog;store;map;toggleCollapsedGroup=!0;constructor(t,i){this.layerService=t,this.cdRef=i}ngOnInit(){const t=this.map.layers.map(n=>({id:n.options.source.id,title:n.title,type:po.Layer}));this.store.state.updateMany(t,{added:!0},!0),this.catalog&&void 0!==this.catalog.sortDirection&&this.store.view.sort({direction:this.catalog.sortDirection,valueAccessor:n=>n.title}),this.catalogAllowLegend=!!this.catalog&&this.catalog.showLegend||this.catalogAllowLegend,this.watcher=new be.YX(this.store,this.cdRef)}ngOnDestroy(){this.watcher.destroy()}isGroup(t){return t.type===po.Group}isLayer(t){return t.type===po.Layer}onLayerAddedChange(t){const i=t.layer;this.store.state.update(i,{added:t.added},!1),t.added?this.addLayerToMap(i,t):this.removeLayerFromMap(i)}onGroupAddedChange(t){const i=t.group;this.store.state.update(i,{added:t.added},!1),t.added?this.addGroupToMap(i,t):this.removeGroupFromMap(i)}addLayerToMap(t,i){this.addLayersToMap([t],i)}removeLayerFromMap(t){this.removeLayersFromMap([t])}addLayersToMap(t,i){const n=t.map(p=>(p.options.sourceOptions.optionsFromApi||(p.options.sourceOptions.optionsFromApi=!0),this.catalog.profils?.length&&(p.options.security={profils:this.catalog.profils}),this.layerService.createAsyncLayer(p.options)));(0,ms.E)(...n).subscribe(p=>{"click"===i.event.type&&i.added&&this.map.layersAddedByClick$.next(p),this.store.state.updateMany(p,{added:!0}),this.map.addLayers(p)})}removeLayersFromMap(t){t.forEach(i=>{if(this.store.state.update(i,{added:!1}),!0===i.options.baseLayer){const n=this.map.getLayerById(i.options.id);void 0!==n&&this.map.removeLayer(n)}else{const n=this.map.getLayerById(i.id);void 0!==n&&this.map.removeLayer(n)}})}sortCatalogItemsByTitle(t,i){const n=t.sort((p,v)=>{const Y=p.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),ue=v.title.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return Y<ue?-1:Y>ue?1:0});switch(i){case"asc":return n;case"desc":return n.reverse();default:return t}}addGroupToMap(t,i){let n=t.items.filter(p=>{const v=this.store.state.get(p).added||!1;return this.isLayer(p)&&!1===v});void 0!==t.sortDirection&&(n=this.sortCatalogItemsByTitle(n,t.sortDirection)),this.addLayersToMap(n.reverse(),i)}removeGroupFromMap(t){const i=t.items.filter(n=>{const p=this.store.state.get(n).added||!1;return this.isLayer(n)&&!0===p});this.removeLayersFromMap(i)}static \u0275fac=function(i){return new(i||l)(e.GI1(Or.I),e.GI1(e.kD9))};static \u0275cmp=e.In1({type:l,selectors:[["igo-catalog-browser"]],inputs:{catalogAllowLegend:"catalogAllowLegend",catalog:"catalog",store:"store",map:"map",toggleCollapsedGroup:"toggleCollapsedGroup"},standalone:!0,features:[e.UHJ],decls:3,vars:5,consts:[[3,"navigation","selection"],["ngFor","",3,"ngForOf"],[4,"ngIf"],[3,"catalog","group","map","state","resolution","catalogAllowLegend","collapsed","toggleCollapsed","addedChange","layerAddedChange"],["igoListItem","",3,"layer","map","resolution","catalogAllowLegend","added","addedChange"]],template:function(i,n){1&i&&(e.I0R(0,"igo-list",0),e.yuY(1,Ld,2,2,"ng-template",1),e.wVc(2,"async"),e.C$Y()),2&i&&(e.E7m("navigation",!1)("selection",!1),e.yG2(),e.E7m("ngForOf",e.kDX(2,3,n.store.view.all$())))},dependencies:[be.yM,Ke.Iw,Ke.u_,Pd,Ba,be.qU,Ke.a],encapsulation:2,changeDetection:0})}return l})();function Gd(l,m){if(1&l&&(e.I0R(0,"mat-option",17),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("matTooltip",t.title)("value",t),e.yG2(),e.oRS(" ",t.title," ")}}function $d(l,m){if(1&l&&(e.I0R(0,"mat-option",17),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("matTooltip",t.url)("value",t),e.yG2(),e.oRS(" ",t.url," ")}}function kd(l,m){if(1&l&&(e.I0R(0,"mat-option",18),e.qCj("click",function(i){return i.stopPropagation()}),e.I0R(1,"p",19),e.OEk(2),e.C$Y()()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(2),e.cNF(t)}}const Ad=(l,m)=>({value:l,email:m});function Bd(l,m){if(1&l&&(e.I0R(0,"span")(1,"p",20),e.OEk(2),e.C$Y()()),2&l){const t=e.GaO();e.yG2(2),e.oRS(" ",t.languageService.translate.instant("igo.geo.catalog.externalProvider.unavailableWithEmail",e.IBC(1,Ad,t.addedCatalog.url,t.emailAddress))," ")}}const Ud=l=>({value:l});function Yd(l,m){if(1&l&&(e.I0R(0,"span")(1,"p",20),e.OEk(2),e.C$Y()()),2&l){const t=e.GaO();e.yG2(2),e.oRS(" ",t.languageService.translate.instant("igo.geo.catalog.unavailable",e.S45(1,Ud,t.addedCatalog.url))," ")}}let Ya=(()=>{class l{formBuilder;languageService;configService;dialogRef;data;form;defaultAddedCatalogType="wms";addedCatalogType$$;predefinedCatalogsList$=new B.g([]);typeCapabilities;predefinedCatalogs=[];store;error=!1;addedCatalog;emailAddress;storeViewAll$$;constructor(t,i,n,p,v){this.formBuilder=t,this.languageService=i,this.configService=n,this.dialogRef=p,this.data=v,this.store=v.store,this.predefinedCatalogs=v.predefinedCatalogs,this.error=v.error,this.addedCatalog=v.addedCatalog,this.form=this.formBuilder.group({id:["",[]],title:["",[]],url:["",[xe.AQ.required]],type:[this.defaultAddedCatalogType,[xe.AQ.required]]})}ngOnInit(){this.store.state.clear(),this.typeCapabilities=Object.keys(cr.S),this.addedCatalogType$$=this.form.get("type").valueChanges.subscribe(t=>{"wmts"===t?this.form.get("title").setValidators(xe.AQ.required):this.form.get("title").setValidators([]),this.form.get("title").updateValueAndValidity()}),this.computePredefinedCatalogList(),this.storeViewAll$$=this.store.view.all$().subscribe(()=>this.computePredefinedCatalogList()),this.emailAddress=this.configService.getConfig("emailAddress")}ngOnDestroy(){this.addedCatalogType$$.unsubscribe(),this.storeViewAll$$.unsubscribe()}changeUrlOrTitle(t){this.form.patchValue(t),this.error=!1,this.computePredefinedCatalogList()}computePredefinedCatalogList(){this.predefinedCatalogsList$.next(this.predefinedCatalogs.filter(t=>!this.store.get(t.id)))}addCatalog(t){this.error=!1,this.dialogRef.close(t)}cancel(){this.error=!1,this.dialogRef.close()}static \u0275fac=function(i){return new(i||l)(e.GI1(xe.KE),e.GI1(k.ov),e.GI1(A.aW),e.GI1(_t.yI),e.GI1(_t.sR,8))};static \u0275cmp=e.In1({type:l,selectors:[["igo-add-catalog-dialog"]],standalone:!0,features:[e.UHJ],decls:34,vars:25,consts:[["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],["type","text","formControlName","title","matInput","",3,"placeholder","matAutocomplete"],[3,"optionSelected"],["auto2","matAutocomplete"],["matTooltipShowDelay","500",3,"matTooltip","value",4,"ngFor","ngForOf"],["type","text","formControlName","url","placeholder","URL","matInput","",3,"matAutocomplete"],["auto","matAutocomplete"],["formControlName","type","placeholder","Type"],[3,"value","click",4,"ngFor","ngForOf"],[4,"ngIf"],["mat-dialog-actions","",2,"justify-content","center"],[1,"igo-form-button-group","add-catalog-button-top-padding"],["mat-raised-button","","type","button",3,"click"],["id","addCatalogBtnDialog","mat-raised-button","","type","button","color","primary",3,"disabled","click"],["matTooltipShowDelay","500",3,"matTooltip","value"],[3,"value","click"],["matListItemTitle",""],[1,"error"]],template:function(i,n){if(1&i&&(e.I0R(0,"h1",0),e.OEk(1),e.wVc(2,"translate"),e.C$Y(),e.I0R(3,"div",1)(4,"form",2)(5,"div",3)(6,"mat-form-field"),e.wR5(7,"input",4),e.wVc(8,"translate"),e.I0R(9,"mat-autocomplete",5,6),e.qCj("optionSelected",function(v){return n.changeUrlOrTitle(v.option.value)}),e.yuY(11,Gd,2,3,"mat-option",7),e.wVc(12,"async"),e.C$Y()()(),e.I0R(13,"div",3)(14,"mat-form-field"),e.wR5(15,"input",8),e.I0R(16,"mat-autocomplete",5,9),e.qCj("optionSelected",function(v){return n.changeUrlOrTitle(v.option.value)}),e.yuY(18,$d,2,3,"mat-option",7),e.wVc(19,"async"),e.C$Y()()(),e.I0R(20,"div",3)(21,"mat-form-field")(22,"mat-select",10),e.yuY(23,kd,3,2,"mat-option",11),e.C$Y()()()(),e.yuY(24,Bd,3,4,"span",12)(25,Yd,3,3,"span",12),e.C$Y(),e.I0R(26,"div",13)(27,"div",14)(28,"button",15),e.qCj("click",function(){return n.cancel()}),e.OEk(29),e.wVc(30,"translate"),e.C$Y(),e.I0R(31,"button",16),e.qCj("click",function(){return n.addCatalog(n.form.value)}),e.OEk(32),e.wVc(33,"translate"),e.C$Y()()()),2&i){const p=e.Gew(10),v=e.Gew(17);e.yG2(),e.oRS(" ",e.kDX(2,13,"igo.geo.catalog.library.addTitle"),"\n"),e.yG2(3),e.E7m("formGroup",n.form),e.yG2(3),e._6D("placeholder",e.kDX(8,15,"igo.geo.printForm.title")),e.E7m("matAutocomplete",p),e.yG2(4),e.E7m("ngForOf",e.kDX(12,17,n.predefinedCatalogsList$)),e.yG2(4),e.E7m("matAutocomplete",v),e.yG2(3),e.E7m("ngForOf",e.kDX(19,19,n.predefinedCatalogsList$)),e.yG2(5),e.E7m("ngForOf",n.typeCapabilities),e.yG2(),e.E7m("ngIf",n.error&&n.addedCatalog&&n.emailAddress),e.yG2(),e.E7m("ngIf",n.error&&n.addedCatalog&&!n.emailAddress),e.yG2(4),e.oRS(" ",e.kDX(30,21,"igo.geo.catalog.library.cancel")," "),e.yG2(2),e.E7m("disabled",!n.form.valid),e.yG2(),e.oRS(" ",e.kDX(33,23,"igo.geo.catalog.library.add")," ")}},dependencies:[_t.WQ,_t.iU,xe.y,xe.sz,xe.ot,xe.ue,xe.u,xe.sl,xe.uW,xe.Wo,yt.wb,yt.Up,Bt.cN,Bt.yi,mo.U1,mo.e,kt.I5,mo.cG,Ke.Iw,kt.Ax,ht.KO,ht.a4,Gt.d5,Gt.kX,Ot.iI,Ot.UV,Ke.u_,_t.Yp,Ze.oJ,Ze.Gw,Ke.a,k._s,pe.sD],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}.add-catalog-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}.igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center}button[_ngcontent-%COMP%]{cursor:pointer}button#addCatalogBtnDialog[disabled=true][_ngcontent-%COMP%]{cursor:default;background-color:#0000001f;color:#00000042}.error[_ngcontent-%COMP%]{color:red}"]})}return l})();var Va=r(11772);function Vd(l,m){1&l&&(e.I0R(0,"mat-icon",5),e.qCj("click",function(i){return i.stopPropagation()}),e.wVc(1,"translate"),e.OEk(2," public "),e.C$Y()),2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.catalog.externalProvider.catalog"))}function jd(l,m){if(1&l){const t=e.KQA();e.I0R(0,"button",6),e.qCj("click",function(n){e.usT(t);const p=e.GaO();return e.CGJ(p.removeCatalogFromLibrary(n))}),e.wVc(1,"translate"),e.I0R(2,"mat-icon"),e.OEk(3,"delete"),e.C$Y()()}2&l&&e.E7m("matTooltip",e.kDX(1,1,"igo.geo.catalog.library.remove"))}function Kd(l,m){1&l&&(e.I0R(0,"button",7),e.wR5(1,"mat-icon"),e.C$Y())}let Wd=(()=>{class l{catalog;map;catalogRemove=new e._w7;get title(){return(0,be.YB)(this.catalog)}removeCatalogFromLibrary(t){t.stopPropagation(),this.catalogRemove.emit()}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=e.In1({type:l,selectors:[["igo-catalog-library-item"]],inputs:{catalog:"catalog",map:"map"},outputs:{catalogRemove:"catalogRemove"},standalone:!0,features:[e.UHJ],decls:7,vars:4,consts:[["matListItemTitle",""],["matListItemMeta",""],["matListItemIcon","","class","igo-external-provider","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["class","igo-blank","disabled","true","mat-icon-button","",4,"ngIf"],["matListItemIcon","","tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"igo-external-provider",3,"matTooltip","click"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click"],["disabled","true","mat-icon-button","",1,"igo-blank"]],template:function(i,n){1&i&&(e.I0R(0,"mat-list-item")(1,"span",0),e.OEk(2),e.C$Y(),e.I0R(3,"div",1),e.yuY(4,Vd,3,3,"mat-icon",2)(5,jd,4,3,"button",3)(6,Kd,2,0,"button",4),e.C$Y()()),2&i&&(e.yG2(2),e.oRS(" ",n.title," "),e.yG2(2),e.E7m("ngIf",n.catalog.externalProvider),e.yG2(),e.E7m("ngIf",n.catalog.removable),e.yG2(),e.E7m("ngIf",!n.catalog.removable))},dependencies:[Ot.iI,Ot.g9,Ot.Y1,Ot.UV,Ot.At,Ke.u_,dt.oB,dt.qL,ht.KO,ht.a4,Ze.oJ,Ze.um,k._s,pe.sD],styles:[".igo-blank[_ngcontent-%COMP%]{cursor:pointer}.igo-external-provider[_ngcontent-%COMP%]{cursor:help}"],changeDetection:0})}return l})();function Nd(l,m){if(1&l){const t=e.KQA();e.I0R(0,"igo-catalog-library-item",3),e.qCj("catalogRemove",function(){const p=e.usT(t).$implicit,v=e.GaO();return e.CGJ(v.onCatalogRemove(p))})("select",function(){const p=e.usT(t).$implicit,v=e.GaO();return e.CGJ(v.onCatalogSelect(p))}),e.C$Y()}if(2&l){const t=m.$implicit,i=e.GaO();e.E7m("map",i.map)("catalog",t)}}function Hd(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",4)(1,"button",5),e.qCj("click",function(){e.usT(t);const n=e.GaO();return e.CGJ(n.addCatalogDialog())}),e.wVc(2,"translate"),e.OEk(3),e.wVc(4,"translate"),e.wR5(5,"mat-icon",6),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("matTooltip",e.kDX(2,3,"igo.geo.catalog.library.addBtn")),e.yG2(2),e.oRS(" ",e.kDX(4,5,"igo.geo.catalog.library.addBtn")," "),e.yG2(2),e.E7m("svgIcon",t.layerPlusIcon.name)}}let ja=(()=>{class l{capabilitiesService;messageService;storageService;dialog;iconService;store;map;addCatalogAllowed=!1;predefinedCatalogs=[];catalogSelectChange=new e._w7;submitDisabled=!0;layerPlusIcon=be.er;addingCatalog$$;get addedCatalogs(){return this.storageService.get("addedCatalogs")||[]}set addedCatalogs(t){this.storageService.set("addedCatalogs",t)}constructor(t,i,n,p,v){this.capabilitiesService=t,this.messageService=i,this.storageService=n,this.dialog=p,this.iconService=v,this.iconService.registerSvg(this.layerPlusIcon)}ngOnInit(){this.store.state.clear(),this.predefinedCatalogs=this.predefinedCatalogs.map(t=>(t.id=Va.Cy.hashStr((t.type||"wms")+(0,An.iL)(t.url)),t.title=""!==t.title&&t.title?t.title:t.url,t))}getCatalogs(){return this.store.view.all$()}onCatalogSelect(t){this.store.state.update(t,{selected:!0,focused:!0},!0),this.catalogSelectChange.emit({selected:!0,catalog:t})}unsubscribeAddingCatalog(){this.addingCatalog$$&&this.addingCatalog$$.unsubscribe()}addCatalog(t){if(!t)return;let i=Va.Cy.hashStr(t.type+(0,An.iL)(t.url));const n=this.predefinedCatalogs.find(p=>p.id===t.id);n&&(t.version=n.version,t.externalProvider=n.externalProvider,i=n.id),this.store.get(i)?this.messageService.alert("igo.geo.catalog.library.inlist.message","igo.geo.catalog.library.inlist.title"):(this.unsubscribeAddingCatalog(),this.addingCatalog$$=this.capabilitiesService.getCapabilities(t.type,t.url,t.version).pipe((0,se.a)(p=>{if(p.error)return this.addCatalogDialog(!0,t),p.error.caught=!0,p;throw this.messageService.error("igo.geo.catalog.unavailable","igo.geo.catalog.unavailableTitle",void 0,{value:t.url}),p})).subscribe(p=>{let v,Y;switch(t.type){case"wms":v=t.title||p.Service.Title,Y=t.version||p.version;break;case"arcgisrest":case"imagearcgisrest":case"tilearcgisrest":v=t.title||p.mapName;break;case"wmts":v=t.title||p.ServiceIdentification.ServiceType;break;default:v=t.title}const ue=ae.Yv.removeUndefined(Object.assign({},n,ae.Yv.removeUndefined({id:i,title:v,url:t.url,type:t.type||"wms",externalProvider:t.externalProvider||!1,removable:!0,version:Y})));this.store.insert(ue);const ye=this.addedCatalogs.slice(0);ye.push(ue),this.addedCatalogs=ye,this.unsubscribeAddingCatalog()}))}ngOnDestroy(){this.unsubscribeAddingCatalog()}onCatalogRemove(t){this.store.delete(t),this.addedCatalogs=this.addedCatalogs.slice(0).filter(i=>i.id!==t.id)}addCatalogDialog(t,i){this.dialog.open(Ya,{width:"700px",data:{predefinedCatalogs:this.predefinedCatalogs,store:this.store,error:t,addedCatalog:i}}).afterClosed().subscribe(p=>{this.addCatalog(p)})}static \u0275fac=function(i){return new(i||l)(e.GI1(zo.S),e.GI1(Ht.mi),e.GI1(W.yQ),e.GI1(_t.qW),e.GI1(be.IL))};static \u0275cmp=e.In1({type:l,selectors:[["igo-catalog-library"]],inputs:{store:"store",map:"map",addCatalogAllowed:"addCatalogAllowed",predefinedCatalogs:"predefinedCatalogs"},outputs:{catalogSelectChange:"catalogSelectChange"},standalone:!0,features:[e.UHJ],decls:4,vars:5,consts:[[3,"navigation"],["ngFor","",3,"ngForOf"],["class","btnAddCatalog",4,"ngIf"],["igoListItem","","color","accent",3,"map","catalog","catalogRemove","select"],[1,"btnAddCatalog"],["mat-raised-button","","matTooltipPosition","above","color","primary",3,"matTooltip","click"],[3,"svgIcon"]],template:function(i,n){1&i&&(e.I0R(0,"igo-list",0),e.yuY(1,Nd,1,2,"ng-template",1),e.wVc(2,"async"),e.C$Y(),e.yuY(3,Hd,6,7,"div",2)),2&i&&(e.E7m("navigation",!1),e.yG2(),e.E7m("ngForOf",e.kDX(2,3,n.getCatalogs())),e.yG2(2),e.E7m("ngIf",n.addCatalogAllowed))},dependencies:[be.yM,Ke.Iw,Wd,be.qU,Ke.u_,Ze.oJ,Ze.Gw,ht.KO,ht.a4,dt.oB,dt.qL,Ke.a,k._s,pe.sD],styles:["[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .btnAddCatalog[_ngcontent-%COMP%]{justify-content:center;display:flex;margin:30px 0}"],changeDetection:0})}return l})();function zd(l,m){if(1&l){const t=e.KQA();e.I0R(0,"div",3)(1,"mat-button-toggle-group",4),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO();return e.kNx(p.geometryType,n)||(p.geometryType=n),e.CGJ(n)}),e.wVc(2,"async"),e.I0R(3,"mat-button-toggle",5),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.I0R(6,"mat-button-toggle",6),e.OEk(7),e.wVc(8,"translate"),e.C$Y(),e.I0R(9,"mat-button-toggle",7),e.OEk(10),e.wVc(11,"translate"),e.C$Y()()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("disabled",void 0!==e.kDX(2,8,t.value$)),e.OKB("ngModel",t.geometryType),e.yG2(2),e.E7m("disabled",t.geometryTypes.indexOf("Point")<0),e.yG2(),e.oRS(" ",e.kDX(5,10,"igo.geo.geometry.point")," "),e.yG2(2),e.E7m("disabled",t.geometryTypes.indexOf("LineString")<0),e.yG2(),e.oRS(" ",e.kDX(8,12,"igo.geo.geometry.line")," "),e.yG2(2),e.E7m("disabled",t.geometryTypes.indexOf("Polygon")<0),e.yG2(),e.oRS(" ",e.kDX(11,14,"igo.geo.geometry.polygon")," ")}}function Xd(l,m){if(1&l){const t=e.KQA();e.I0R(0,"mat-form-field",8)(1,"input",9),e.iHE("ngModelChange",function(n){e.usT(t);const p=e.GaO();return e.kNx(p.drawGuide,n)||(p.drawGuide=n),e.CGJ(n)}),e.C$Y(),e.I0R(2,"mat-icon",10),e.OEk(3,"adjust "),e.C$Y(),e.I0R(4,"span",11),e.OEk(5),e.wVc(6,"translate"),e.C$Y()()}if(2&l){const t=e.GaO();e.yG2(),e.E7m("placeholder",t.drawGuidePlaceholder),e.OKB("ngModel",t.drawGuide),e.yG2(),e.E7m("color","primary"),e.yG2(3),e.cNF(e.kDX(6,4,"igo.geo.measure.meters"))}}r(86464),r(72432);let hs=class Ds{cdRef;value$=new B.g(void 0);value$$;set drawControlIsActive(m){this._drawControlIsActive=m,this.cdRef.detectChanges()}get drawControlIsActive(){return this._drawControlIsActive}_drawControlIsActive=!0;set freehandDrawIsActive(m){this._freehandDrawIsActive=m,this.cdRef.detectChanges()}get freehandDrawIsActive(){return this._freehandDrawIsActive}_freehandDrawIsActive=!1;formControl;map;set geometryType(m){this.geometryType$.next(m)}get geometryType(){return this.geometryType$.value}geometryType$=new B.g(void 0);geometryTypeField=!1;geometryTypes=["Point","LineString","Polygon"];drawGuideField=!1;set drawGuide(m){this.drawGuide$.next(m)}get drawGuide(){return this.drawGuide$.value}drawGuide$=new B.g(0);drawGuidePlaceholder="";measure=!1;controlOptions={};drawStyle;overlayStyle;constructor(m){this.cdRef=m}ngOnInit(){this.value$.next(this.formControl.value?this.formControl.value:void 0),this.value$$=this.formControl.valueChanges.subscribe(m=>{this.value$.next(m||void 0)})}ngOnDestroy(){this.value$$.unsubscribe()}static \u0275fac=function(t){return new(t||Ds)(e.GI1(e.kD9))};static \u0275cmp=e.In1({type:Ds,selectors:[["igo-geometry-form-field"]],inputs:{formControl:"formControl",map:"map",geometryType:"geometryType",geometryTypeField:"geometryTypeField",geometryTypes:"geometryTypes",drawGuideField:"drawGuideField",drawGuide:"drawGuide",drawGuidePlaceholder:"drawGuidePlaceholder",measure:"measure",controlOptions:"controlOptions",drawStyle:"drawStyle",overlayStyle:"overlayStyle"},standalone:!0,features:[e.UHJ],decls:5,vars:16,consts:[[3,"formControl","map","geometryType","drawGuide","measure","drawControlIsActive","freehandDrawIsActive","controlOptions","drawStyle","overlayStyle"],["class","geometry-type-toggle",4,"ngIf"],["class","draw-guide-field",4,"ngIf"],[1,"geometry-type-toggle"],[3,"disabled","ngModel","ngModelChange"],["value","Point",3,"disabled"],["value","LineString",3,"disabled"],["value","Polygon",3,"disabled"],[1,"draw-guide-field"],["matInput","","type","number",3,"placeholder","ngModel","ngModelChange"],["matPrefix","",3,"color"],["matSuffix","",1,"draw-guide-units"]],template:function(t,i){1&t&&(e.wR5(0,"igo-geometry-form-field-input",0),e.wVc(1,"async"),e.wVc(2,"async"),e.yuY(3,zd,12,16,"div",1)(4,Xd,7,6,"mat-form-field",2)),2&t&&(e.E7m("formControl",i.formControl)("map",i.map)("geometryType",e.kDX(1,12,i.geometryType$))("drawGuide",e.kDX(2,14,i.drawGuide$))("measure",i.measure)("drawControlIsActive",i.drawControlIsActive)("freehandDrawIsActive",i.freehandDrawIsActive)("controlOptions",i.controlOptions)("drawStyle",i.drawStyle)("overlayStyle",i.overlayStyle),e.yG2(3),e.E7m("ngIf",i.geometryTypeField),e.yG2(),e.E7m("ngIf",i.drawGuideField))},dependencies:[zr,xe.y,xe.ot,xe.O4,xe.ue,xe._G,xe.sl,xe.ug,Ke.u_,io.ue,io.gn,io.KU,yt.wb,yt.Up,yt.is,yt.Gm,Bt.cN,Bt.yi,dt.oB,dt.qL,Ke.a,k._s,pe.sD],styles:["[_nghost-%COMP%]{display:block;width:100%}.geometry-type-toggle[_ngcontent-%COMP%], .draw-guide-field[_ngcontent-%COMP%]{width:100%}.geometry-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.draw-guide-field[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin:0 10px}.draw-guide-units[_ngcontent-%COMP%]{padding:10px}"],changeDetection:0})};hs=(0,te.UN)([(0,be.wr)("geometry"),(0,te.YR)("design:paramtypes",[e.kD9])],hs);var Ka=r(48920),Wa=(r(60192),r(42860)),Na=r(34419),fs=(r(94440),r(9364)),Ha=(r(55452),r(78416)),za=r(65972),Xa=r(76332),Ja=(r(87159),r(50056),r(55760),r(72124),r(50208)),Qa=r(75872);let ip=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=e.a4G({type:l});static \u0275inj=e.s3X({imports:[Qa.q,Wa.c,Na.e,Xa.i,Ka.Q,za.I,Ja.w,Ha.a]})}return l})();r(79280);var np=r(9588),qt=r(47580);const rp=l=>({column:l,value:130});function sp(l,m){1&l&&(e.I0R(0,"mat-error"),e.OEk(1),e.wVc(2,"translate"),e.wVc(3,"translate"),e.C$Y()),2&l&&(e.yG2(),e.cNF(e.g7$(2,1,"igo.geo.formValidation.maxLength",e.S45(6,rp,e.kDX(3,4,"igo.geo.printForm.title")))))}const ap=l=>({column:l,value:120});function lp(l,m){1&l&&(e.I0R(0,"mat-error"),e.OEk(1),e.wVc(2,"translate"),e.wVc(3,"translate"),e.C$Y()),2&l&&(e.yG2(),e.cNF(e.g7$(2,1,"igo.geo.formValidation.maxLength",e.S45(6,ap,e.kDX(3,4,"igo.geo.printForm.subtitle")))))}const cp=(l,m)=>({column:l,value:m});function up(l,m){if(1&l&&(e.I0R(0,"mat-error"),e.OEk(1),e.wVc(2,"translate"),e.wVc(3,"translate"),e.C$Y()),2&l){const t=e.GaO();e.yG2(),e.cNF(e.g7$(2,1,"igo.geo.formValidation.maxLength",e.IBC(6,cp,e.kDX(3,4,"igo.geo.printForm.comment"),t.maxLength)))}}function dp(l,m){if(1&l&&(e.SAx(0),e.OEk(1),e.wVc(2,"translate"),e.k70()),2&l){const t=e.GaO().$implicit;e.yG2(),e.oRS(" ",e.kDX(2,1,"igo.geo.printForm.legendPositions."+t.value)," ")}}function pp(l,m){if(1&l&&(e.SAx(0),e.OEk(1),e.wVc(2,"translate"),e.k70()),2&l){const t=e.GaO(2);e.yG2(),e.oRS(" ",e.kDX(2,1,"Pdf"===t.outputFormat?"igo.geo.printForm.legendPositions.newpage":"igo.geo.printForm.legendPositions.newimage")," ")}}const Za=()=>["newpage","newimage"];function mp(l,m){if(1&l&&(e.I0R(0,"mat-option",20),e.yuY(1,dp,3,3,"ng-container",3)(2,pp,3,3,"ng-container",3),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.key),e.yG2(),e.E7m("ngIf",!e.q4q(3,Za).includes(t.value)),e.yG2(),e.E7m("ngIf",e.q4q(4,Za).includes(t.value))}}function gp(l,m){if(1&l&&(e.I0R(0,"mat-option",20),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",t.value," ")}}function hp(l,m){if(1&l&&(e.I0R(0,"mat-option",20),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.printForm.paperFormats."+t.value)," ")}}function fp(l,m){if(1&l&&(e.I0R(0,"mat-option",20),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",t.value," ")}}function yp(l,m){if(1&l&&(e.I0R(0,"mat-option",20),e.OEk(1),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t),e.yG2(),e.oRS(" ",t," ")}}function _p(l,m){if(1&l&&(e.I0R(0,"mat-option",20),e.OEk(1),e.wVc(2,"translate"),e.C$Y()),2&l){const t=m.$implicit;e.E7m("value",t.key),e.yG2(),e.oRS(" ",e.kDX(2,2,"igo.geo.printForm."+t.value)," ")}}let Cp=(()=>{class l{formBuilder;mediaService;form;outputFormats=qt.wf;paperFormats=qt.QH;orientations=qt.qp;resolutions=[...qt.wR];imageFormats=qt.mw;legendPositions=qt.ID;isPrintService=!0;disabled$;get imageFormat(){return this.imageFormatField.value}set imageFormat(t){this.imageFormatField.setValue(t||qt.mw.Jpeg,{onlySelf:!0})}get outputFormat(){return this.outputFormatField.value}set outputFormat(t){this.outputFormatField.setValue(t||qt.wf.Pdf,{onlySelf:!0})}get paperFormat(){return this.paperFormatField.value}set paperFormat(t){this.paperFormatField.setValue(t||qt.QH.Letter,{onlySelf:!0})}get orientation(){return this.orientationField.value}set orientation(t){this.orientationField.setValue(t||qt.qp.landscape,{onlySelf:!0})}get resolution(){return this.resolutionField.value}set resolution(t){this.resolutionField.setValue(t||"96",{onlySelf:!0})}get legendPosition(){return this.legendPositionField.value}set legendPosition(t){this.legendPositionField.setValue(t||qt.ID.none,{onlySelf:!0})}get title(){return this.titleField.value}set title(t){this.titleField.setValue(t,{onlySelf:!0})}get subtitle(){return this.subtitleField.value}set subtitle(t){this.subtitleField.setValue(t,{onlySelf:!0})}get comment(){return this.commentField.value}set comment(t){this.commentField.setValue(t,{onlySelf:!0})}get showProjection(){return this.showProjectionField.value}set showProjection(t){this.showProjectionField.setValue(t,{onlySelf:!0})}get showScale(){return this.showScaleField.value}set showScale(t){this.showScaleField.setValue(t,{onlySelf:!0})}get showLegend(){return this.showLegendField.value}set showLegend(t){this.showLegendField.setValue(t,{onlySelf:!0})}get doZipFile(){return this.doZipFileField.value}set doZipFile(t){this.doZipFileField.setValue(t,{onlySelf:!0})}get outputFormatField(){return this.form.controls.outputFormat}get paperFormatField(){return this.form.controls.paperFormat}get imageFormatField(){return this.form.controls.imageFormat}get orientationField(){return this.form.controls.orientation}get resolutionField(){return this.form.controls.resolution}get commentField(){return this.form.controls.comment}get showProjectionField(){return this.form.controls.showProjection}get showScaleField(){return this.form.controls.showScale}get showLegendField(){return this.form.controls.showLegend}get doZipFileField(){return this.form.controls.doZipFile}get titleField(){return this.form.controls.title}get subtitleField(){return this.form.controls.subtitle}get legendPositionField(){return this.form.controls.legendPosition}submit=new e._w7;maxLength=180;constructor(t,i){this.formBuilder=t,this.mediaService=i,this.form=this.formBuilder.group({title:["",[xe.AQ.minLength(0),xe.AQ.maxLength(130)]],subtitle:["",[xe.AQ.minLength(0),xe.AQ.maxLength(120)]],comment:["",[xe.AQ.minLength(0),xe.AQ.maxLength(this.maxLength)]],outputFormat:["",[xe.AQ.required]],paperFormat:["",[xe.AQ.required]],imageFormat:["",[xe.AQ.required]],resolution:["",[xe.AQ.required]],orientation:["",[xe.AQ.required]],legendPosition:["",[xe.AQ.required]],showProjection:!1,showScale:!1,showLegend:!1,doZipFile:[{hidden:this.isPrintService}]})}ngOnInit(){this.doZipFileField.setValue(!1),this.mediaService.isMobile()&&(this.resolutions=this.resolutions.filter(t=>"300"!==t))}handleFormSubmit(t,i){t.isPrintService=this.isPrintService,i&&this.submit.emit(t)}toggleImageSaveProp(){"Image"===this.outputFormatField.value?(this.isPrintService=!1,this.commentField.clearValidators(),this.commentField.updateValueAndValidity()):this.isPrintService=!0}changeCommentLength(){switch(this.paperFormat){case qt.QH.A0:this.maxLength=this.orientation===qt.qp.landscape?900:600;break;case qt.QH.A1:this.maxLength=this.orientation===qt.qp.landscape?600:400;break;case qt.QH.A2:this.maxLength=this.orientation===qt.qp.landscape?400:300;break;case qt.QH.A3:this.maxLength=this.orientation===qt.qp.landscape?300:200;break;case qt.QH.A4:this.maxLength=this.orientation===qt.qp.landscape?200:100;break;case qt.QH.A5:this.maxLength=this.orientation===qt.qp.landscape?120:80;break;case qt.QH.Letter:this.maxLength=this.orientation===qt.qp.landscape?180:140;break;default:this.maxLength=this.orientation===qt.qp.landscape?200:140}this.commentField.setValidators([xe.AQ.maxLength(this.maxLength)]),this.commentField.updateValueAndValidity()}static \u0275fac=function(i){return new(i||l)(e.GI1(xe.KE),e.GI1(np.QB))};static \u0275cmp=e.In1({type:l,selectors:[["igo-print-form"]],inputs:{disabled$:"disabled$",imageFormat:"imageFormat",outputFormat:"outputFormat",paperFormat:"paperFormat",orientation:"orientation",resolution:"resolution",legendPosition:"legendPosition",title:"title",subtitle:"subtitle",comment:"comment",showProjection:"showProjection",showScale:"showScale",showLegend:"showLegend",doZipFile:"doZipFile"},outputs:{submit:"submit"},standalone:!0,features:[e.UHJ],decls:95,vars:103,consts:[[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],["matInput","","formControlName","title",3,"placeholder"],[4,"ngIf"],["matInput","","formControlName","subtitle",3,"placeholder"],["matInput","","formControlName","comment",3,"placeholder"],[1,"igo-input-container","slide-toggle-container"],[1,"print-slide-toggle-container"],["formControlName","showProjection",1,"print-option",3,"labelPosition"],["formControlName","showScale",1,"print-option",3,"labelPosition"],["formControlName","doZipFile",1,"print-option",3,"labelPosition"],["formControlName","legendPosition",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["formControlName","outputFormat",3,"placeholder","selectionChange"],["formControlName","paperFormat",3,"placeholder","selectionChange"],["formControlName","imageFormat",3,"placeholder"],["formControlName","resolution",3,"placeholder"],["formControlName","orientation",3,"placeholder","selectionChange"],[1,"igo-form-button-group","print-button-top-padding"],["mat-raised-button","","type","button",3,"disabled","click"],[3,"value"]],template:function(i,n){1&i&&(e.I0R(0,"form",0)(1,"div",1)(2,"mat-form-field")(3,"mat-label"),e.OEk(4),e.wVc(5,"translate"),e.C$Y(),e.wR5(6,"input",2),e.wVc(7,"translate"),e.yuY(8,sp,4,8,"mat-error",3),e.C$Y()(),e.I0R(9,"div",1)(10,"mat-form-field")(11,"mat-label"),e.OEk(12),e.wVc(13,"translate"),e.C$Y(),e.wR5(14,"input",4),e.wVc(15,"translate"),e.yuY(16,lp,4,8,"mat-error",3),e.C$Y()(),e.I0R(17,"div",1)(18,"mat-form-field")(19,"mat-label"),e.OEk(20),e.wVc(21,"translate"),e.C$Y(),e.wR5(22,"input",5),e.wVc(23,"translate"),e.yuY(24,up,4,9,"mat-error",3),e.C$Y()(),e.I0R(25,"div",6)(26,"div",7)(27,"mat-slide-toggle",8),e.OEk(28),e.wVc(29,"translate"),e.C$Y(),e.I0R(30,"mat-slide-toggle",9),e.OEk(31),e.wVc(32,"translate"),e.C$Y(),e.I0R(33,"mat-slide-toggle",10),e.OEk(34),e.wVc(35,"translate"),e.C$Y()()(),e.I0R(36,"div",1)(37,"mat-form-field")(38,"mat-label"),e.OEk(39),e.wVc(40,"translate"),e.C$Y(),e.I0R(41,"mat-select",11),e.wVc(42,"translate"),e.yuY(43,mp,3,5,"mat-option",12),e.wVc(44,"keyvalue"),e.C$Y()()(),e.I0R(45,"div",1)(46,"mat-form-field")(47,"mat-label"),e.OEk(48),e.wVc(49,"translate"),e.C$Y(),e.I0R(50,"mat-select",13),e.qCj("selectionChange",function(){return n.toggleImageSaveProp()}),e.wVc(51,"translate"),e.yuY(52,gp,2,2,"mat-option",12),e.wVc(53,"keyvalue"),e.C$Y()()(),e.I0R(54,"div",1)(55,"mat-form-field")(56,"mat-label"),e.OEk(57),e.wVc(58,"translate"),e.C$Y(),e.I0R(59,"mat-select",14),e.qCj("selectionChange",function(){return n.changeCommentLength()}),e.wVc(60,"translate"),e.yuY(61,hp,3,4,"mat-option",12),e.wVc(62,"keyvalue"),e.C$Y()()(),e.I0R(63,"div",1)(64,"mat-form-field")(65,"mat-label"),e.OEk(66),e.wVc(67,"translate"),e.C$Y(),e.I0R(68,"mat-select",15),e.wVc(69,"translate"),e.yuY(70,fp,2,2,"mat-option",12),e.wVc(71,"keyvalue"),e.C$Y()()(),e.I0R(72,"div",1)(73,"mat-form-field")(74,"mat-label"),e.OEk(75),e.wVc(76,"translate"),e.wVc(77,"translate"),e.C$Y(),e.I0R(78,"mat-select",16),e.wVc(79,"translate"),e.yuY(80,yp,2,2,"mat-option",12),e.C$Y()()(),e.I0R(81,"div",1)(82,"mat-form-field")(83,"mat-label"),e.OEk(84),e.wVc(85,"translate"),e.C$Y(),e.I0R(86,"mat-select",17),e.qCj("selectionChange",function(){return n.changeCommentLength()}),e.wVc(87,"translate"),e.yuY(88,_p,3,4,"mat-option",12),e.wVc(89,"keyvalue"),e.C$Y()()(),e.I0R(90,"div",18)(91,"button",19),e.qCj("click",function(){return n.handleFormSubmit(n.form.value,n.form.valid)}),e.wVc(92,"async"),e.OEk(93),e.wVc(94,"translate"),e.C$Y()()()),2&i&&(e.E7m("formGroup",n.form),e.yG2(4),e.cNF(e.kDX(5,45,"igo.geo.printForm.title")),e.yG2(2),e._6D("placeholder",e.kDX(7,47,"igo.geo.printForm.title")),e.yG2(2),e.E7m("ngIf",null==n.titleField.errors?null:n.titleField.errors.maxlength),e.yG2(4),e.cNF(e.kDX(13,49,"igo.geo.printForm.subtitle")),e.yG2(2),e._6D("placeholder",e.kDX(15,51,"igo.geo.printForm.subtitle")),e.yG2(2),e.E7m("ngIf",null==n.subtitleField.errors?null:n.subtitleField.errors.maxlength),e.yG2(4),e.cNF(e.kDX(21,53,"igo.geo.printForm.comment")),e.yG2(2),e._6D("placeholder",e.kDX(23,55,"igo.geo.printForm.comment")),e.yG2(2),e.E7m("ngIf",null==n.commentField.errors?null:n.commentField.errors.maxlength),e.yG2(3),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(29,57,"igo.geo.printForm.showProjection")," "),e.yG2(2),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(32,59,"igo.geo.printForm.showScale")," "),e.yG2(2),e.m4B("display",n.isPrintService?"none":""),e.E7m("labelPosition","before"),e.yG2(),e.oRS(" ",e.kDX(35,61,"igo.geo.printForm.doZipFile")," "),e.yG2(5),e.cNF(e.kDX(40,63,"igo.geo.printForm.legendPosition")),e.yG2(2),e._6D("placeholder",e.kDX(42,65,"igo.geo.printForm.legendPosition")),e.yG2(2),e.E7m("ngForOf",e.kDX(44,67,n.legendPositions)),e.yG2(5),e.cNF(e.kDX(49,69,"igo.geo.printForm.outputFormat")),e.yG2(2),e._6D("placeholder",e.kDX(51,71,"igo.geo.printForm.outputFormat")),e.yG2(2),e.E7m("ngForOf",e.kDX(53,73,n.outputFormats)),e.yG2(2),e.m4B("display",n.isPrintService?"block":"none"),e.yG2(3),e.cNF(e.kDX(58,75,"igo.geo.printForm.paperFormat")),e.yG2(2),e._6D("placeholder",e.kDX(60,77,"igo.geo.printForm.paperFormat")),e.yG2(2),e.E7m("ngForOf",e.kDX(62,79,n.paperFormats)),e.yG2(2),e.m4B("display",n.isPrintService?"none":"block"),e.yG2(3),e.cNF(e.kDX(67,81,"igo.geo.printForm.imageFormat")),e.yG2(2),e._6D("placeholder",e.kDX(69,83,"igo.geo.printForm.imageFormat")),e.yG2(2),e.E7m("ngForOf",e.kDX(71,85,n.imageFormats)),e.yG2(5),e.CAO("",e.kDX(76,87,"igo.geo.printForm.resolution")," (",e.kDX(77,89,"igo.geo.printForm.resolutionUnit"),")"),e.yG2(3),e._6D("placeholder",e.kDX(79,91,"igo.geo.printForm.resolution")),e.yG2(2),e.E7m("ngForOf",n.resolutions),e.yG2(),e.m4B("display",n.isPrintService?"block":"none"),e.yG2(3),e.cNF(e.kDX(85,93,"igo.geo.printForm.orientation")),e.yG2(2),e._6D("placeholder",e.kDX(87,95,"igo.geo.printForm.orientation")),e.yG2(2),e.E7m("ngForOf",e.kDX(89,97,n.orientations)),e.yG2(3),e.E7m("disabled",!n.form.valid||e.kDX(92,99,n.disabled$)),e.yG2(2),e.oRS(" ",e.kDX(94,101,"igo.geo.printForm.saveBtn")," "))},dependencies:[xe.y,xe.sz,xe.ot,xe.ue,xe.u,xe.sl,xe.uW,xe.Wo,yt.wb,yt.Up,yt.w5,yt.wJ,Bt.cN,Bt.yi,Ke.u_,co.GE,co.cP,Gt.d5,Gt.kX,kt.I5,Ke.Iw,kt.Ax,Ze.oJ,Ze.Gw,Ke.a,Ke.uq,k._s,pe.sD],styles:["[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .slide-toggle-container[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:0 8px}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .print-option[_ngcontent-%COMP%]{display:block;margin-bottom:12px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center}"]})}return l})();var Rr=r(37496),vp=r(29272);let Sp=(()=>{class l{printService;disabled$=new B.g(!1);get map(){return this._map}set map(t){this._map=t}_map;get outputFormat(){return this._outputFormat}set outputFormat(t){this._outputFormat=t}_outputFormat;get paperFormat(){return this._paperFormat}set paperFormat(t){this._paperFormat=t}_paperFormat;get orientation(){return this._orientation}set orientation(t){this._orientation=t}_orientation;get imageFormat(){return this._imageFormat}set imageFormat(t){this._imageFormat=t}_imageFormat;get legendPosition(){return this._legendPosition}set legendPosition(t){this._legendPosition=t}_legendPosition;get resolution(){return this._resolution}set resolution(t){this._resolution=t}_resolution;constructor(t){this.printService=t}handleFormSubmit(t){if(this.disabled$.next(!0),!0===t.isPrintService)this.printService.print(this.map,t).pipe((0,Rr.U)(1)).subscribe(()=>{this.disabled$.next(!1)});else{let i=1;t.showLegend&&i++,"tiff"===t.imageFormat.toLowerCase()&&i++,"newpage"===t.legendPosition&&i++,this.printService.defineNbFileToProcess(i),this.printService.downloadMapImage(this.map,t.resolution,t.imageFormat,t.showProjection,t.showScale,t.title,t.subtitle,t.comment,t.doZipFile,t.legendPosition).pipe((0,Rr.U)(1)).subscribe(()=>{this.disabled$.next(!1)})}}static \u0275fac=function(i){return new(i||l)(e.GI1(vp.K))};static \u0275cmp=e.In1({type:l,selectors:[["igo-print"]],inputs:{map:"map",outputFormat:"outputFormat",paperFormat:"paperFormat",orientation:"orientation",imageFormat:"imageFormat",legendPosition:"legendPosition",resolution:"resolution"},standalone:!0,features:[e.UHJ],decls:1,vars:7,consts:[[3,"outputFormat","paperFormat","orientation","imageFormat","resolution","legendPosition","disabled$","submit"]],template:function(i,n){1&i&&(e.I0R(0,"igo-print-form",0),e.qCj("submit",function(v){return n.handleFormSubmit(v)}),e.C$Y()),2&i&&e.E7m("outputFormat",n.outputFormat)("paperFormat",n.paperFormat)("orientation",n.orientation)("imageFormat",n.imageFormat)("resolution",n.resolution)("legendPosition",n.legendPosition)("disabled$",n.disabled$)},dependencies:[Cp],encapsulation:2})}return l})();r(43940);var Lr=r(72156),qa=r(9452),el=r(96580);class on extends el.U{http;config;get enabled(){return!1!==this.options.enabled}set enabled(m){this.options.enabled=m}static _name="OSRM Qu\xe9bec";directionsUrl="https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/";options;constructor(m,t){super(),this.http=m,this.config=t,this.options=this.config.getConfig("directionsSources.osrm")||{},this.directionsUrl=this.options.url||this.directionsUrl}getName(){return on._name}route(m,t={}){const i=this.getRouteParams(t);return this.getRoute(m,i)}getRoute(m,t){return this.http.get(this.directionsUrl+m.join(";"),{params:t}).pipe((0,oe.k)(i=>this.extractRoutesData(i)))}extractRoutesData(m){const t=[];return m.routes.forEach(i=>{t.push(this.formatRoute(i,m.waypoints))}),t}getRouteParams(m={}){return m.alternatives=void 0===m.alternatives||m.alternatives,m.steps=void 0===m.steps||m.steps,m.geometries=void 0!==m.geometries?m.geometries:"geojson",m.overview=void 0!==m.overview&&m.overview,m.continue_straight=void 0!==m.continue_straight&&m.continue_straight,new fe.i4({fromObject:{alternatives:m.alternatives?"true":"false",overview:m.overview?"simplified":"full",steps:m.steps?"true":"false",geometries:m.geometries?m.geometries:"geojson",continue_straight:m.continue_straight?"true":"false"}})}formatRoute(m,t){const i=[];return m.legs.forEach(n=>{n.steps.forEach(p=>{i.push(p)})}),{id:(0,ae.uq)(),title:m.legs[0].summary,source:on._name,sourceType:qa.g1.Route,order:1,format:qa.Yn.GeoJSON,icon:"directions",projection:"EPSG:4326",waypoints:t,distance:m.distance,duration:m.duration,geometry:m.geometry,legs:m.legs,steps:i,weight:m.weight,weight_name:m.weight_name}}static \u0275fac=function(t){return new(t||on)(e.CoB(fe.KK),e.CoB(A.aW))};static \u0275prov=e.wxM({token:on,factory:on.\u0275fac})}function bp(l,m){return new on(l,m)}function Op(){return{provide:el.U,useFactory:bp,multi:!0,deps:[fe.KK,A.aW]}}(0,te.UN)([(0,I.w)({maxCacheCount:20,cacheHasher:ae.EB}),(0,te.YR)("design:type",Function),(0,te.YR)("design:paramtypes",[Array,fe.i4]),(0,te.YR)("design:returntype",c._)],on.prototype,"getRoute",null);var Ip=r(41912);r(10211),r(7700);var Gr=r(35876);let tl=(()=>{class l{mapService;component;layersOrResolutionChange$$;layersVisibility$$;constructor(t,i){this.mapService=i,this.component=t}ngOnInit(){this.component.layers=[],this.layersOrResolutionChange$$=(0,Gr.E)([this.mapService.getMap().layers$,this.mapService.getMap().viewController.resolution$]).pipe((0,fo.o)(10)).subscribe(t=>{const i=t[0].filter(n=>!0===n.showInLayerList);this.component.layers=i,this.layersVisibility$$=(0,Gr.E)(i.map(n=>n.visible$)).subscribe(n=>{this.component.change$.next()})})}ngOnDestroy(){this.layersOrResolutionChange$$.unsubscribe(),void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0)}static \u0275fac=function(i){return new(i||l)(e.GI1(as,2),e.GI1(Xn.u))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoLayerLegendListBinding",""]],standalone:!0})}return l})();var Ep=r(84112);let ol=(()=>{class l{mapService;route;component;layersOrResolutionChange$$;layersVisibility$$;constructor(t,i,n){this.mapService=i,this.route=n,this.component=t}ngOnInit(){this.layersOrResolutionChange$$=(0,Gr.E)([this.mapService.getMap().layers$,this.mapService.getMap().viewController.resolution$]).pipe((0,fo.o)(10)).subscribe(t=>{const i=t[0].filter(n=>!0===n.showInLayerList);this.component.layers=i,this.setLayersVisibilityStatus(i,this.component.excludeBaseLayers)})}setLayersVisibilityStatus(t,i){void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0),this.layersVisibility$$=(0,Gr.E)(t.filter(n=>n.baseLayer!==i).map(n=>n.visible$)).pipe((0,oe.k)(n=>n.every(Boolean))).subscribe(n=>this.component.layersAreAllVisible=n)}ngOnDestroy(){this.layersOrResolutionChange$$.unsubscribe(),void 0!==this.layersVisibility$$&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0)}static \u0275fac=function(i){return new(i||l)(e.GI1(us,2),e.GI1(Xn.u),e.GI1(Ep.k$,8))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoLayerListBinding",""]],standalone:!0})}return l})();r(29632),r(48004),r(84052),r(96659),r(31112),r(97104),r(39532),r(36404);var ys=function(l){return l[l.None=0]="None",l[l.Move=1]="Move",l[l.Zoom=2]="Zoom",l[l.ZoomIfOutMapExtent=3]="ZoomIfOutMapExtent",l}(ys||{});let Mp=(()=>{class l{features$=new B.g([[],void 0]);constructor(){}setFeatures(t,i=ys.None){this.features$.next([t,i])}clear(){this.features$.next([[],ys.None])}static \u0275fac=function(i){return new(i||l)};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),Dp=(()=>{class l{component;overlayService;features$$;format=new Z.c;get map(){return this.component.map}constructor(t,i){this.component=t,this.overlayService=i}ngOnInit(){this.features$$=this.overlayService.features$.subscribe(t=>this.handleFeatures(t[0],t[1]))}ngOnDestroy(){this.features$$.unsubscribe()}handleFeatures(t,i){}static \u0275fac=function(i){return new(i||l)(e.GI1(fs.q,2),e.GI1(Mp))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoOverlay",""]],standalone:!0})}return l})();r(25607),r(87048);r(29220);r(71320);class Bn extends x.i{http;languageService;static id="cadastre";static type=b.Y;constructor(m,t,i,n){super(n,i),this.http=m,this.languageService=t}getId(){return Bn.id}getType(){return Bn.type}getDefaultOptions(){return{title:"Cadastre (Qu\xe9bec)",searchUrl:"https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?"}}search(m,t){m=(m=(m=(m=m.replace(/ /g,"")).replace(/,+/g,",")).endsWith(",")?m.slice(0,-1):m).startsWith(",")?m.substr(1):m;const i=this.computeSearchRequestParams(m,t||{});return i.get("numero")&&i.get("numero").match(/^[0-9,]+$/g)?this.getCadastre(m,i):(0,z.of)([])}getCadastre(m,t){return this.http.get(this.searchUrl,{params:t,responseType:"text"}).pipe((0,oe.k)(i=>this.extractResults(i,m)))}computeSearchRequestParams(m,t){return new fe.i4({fromObject:Object.assign({numero:m,epsg:"4326"},this.params,t.params||{})})}extractResults(m,t){return m.split("<br />").filter(i=>i.length>0).map(i=>this.dataToResult(i,t))}dataToResult(m,t){const i=m.split(";"),n=i[0],v=this.computeGeometry(i[7]),Y={NoLot:n,Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"},ue=[this.getId(),"cadastre",n].join(".");return{source:this,meta:{dataType:b.Y,id:ue,title:n,score:(0,me.Un)(t.trim(),n),icon:"location_on"},data:{type:b.Y,projection:"EPSG:4326",geometry:v,properties:Y,meta:{id:ue,title:n}}}}computeGeometry(m){const t=(new ho.c).readFeature(m,{dataProjection:"EPSG:4326",featureProjection:"EPSG:4326"});return{type:t.getGeometry().getType(),coordinates:t.getGeometry().getCoordinates()}}static \u0275fac=function(t){return new(t||Bn)(e.CoB(fe.KK),e.CoB(k.ov),e.CoB(W.yQ),e.CoB("options"))};static \u0275prov=e.wxM({token:Bn,factory:Bn.\u0275fac})}(0,te.UN)([(0,I.w)({maxCacheCount:20,cacheHasher:ae.EB}),(0,te.YR)("design:type",Function),(0,te.YR)("design:paramtypes",[String,fe.i4]),(0,te.YR)("design:returntype",c._)],Bn.prototype,"getCadastre",null);class Un extends x.i{http;static id="nominatim";static type=b.Y;constructor(m,t,i){super(t,i),this.http=m}getId(){return Un.id}getType(){return Un.type}getDefaultOptions(){return{title:"Nominatim (OSM)",searchUrl:"https://nominatim.openstreetmap.org/search",settings:[{type:"checkbox",title:"results type",name:"amenity",values:[{title:"igo.geo.search.nominatim.type.food",value:"bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant",enabled:!1},{title:"igo.geo.search.nominatim.type.health",value:"baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary",enabled:!1},{title:"igo.geo.search.nominatim.type.entertainment",value:"arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium                           ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe",enabled:!1},{title:"igo.geo.search.nominatim.type.finance",value:"atm,bank,bureau_de_change",enabled:!1}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"10",value:10,enabled:!0},{title:"20",value:20,enabled:!1},{title:"50",value:50,enabled:!1}]},{type:"radiobutton",title:"restrictExtent",name:"countrycodes",values:[{title:"igo.geo.search.nominatim.country.canada",value:"CA",enabled:!0},{title:"igo.geo.search.nominatim.country.all",value:null,enabled:!1}]},{type:"radiobutton",title:"multiple object",name:"dedupe",values:[{title:"igo.geo.search.searchSources.settings.true",value:0,enabled:!1},{title:"igo.geo.search.searchSources.settings.false",value:1,enabled:!0}]}]}}search(m,t){const i=this.computeSearchRequestParams(m,t||{});return i.get("q")?this.getSearch(m,i):(0,z.of)([])}getSearch(m,t){return this.http.get(this.searchUrl,{params:t}).pipe((0,oe.k)(i=>this.extractResults(i,m)))}computeSearchRequestParams(m,t){return new fe.i4({fromObject:Object.assign({q:this.computeTerm(m),format:"json"},this.params,t.params||{})})}extractResults(m,t){return m.map(i=>this.dataToResult(i,t))}dataToResult(m,t){const i=this.computeProperties(m),n=this.computeGeometry(m),p=this.computeExtent(m),v=[this.getId(),"place",m.place_id].join(".");return{source:this,meta:{dataType:b.Y,id:v,title:m.display_name,icon:"location_on",score:(0,me.Un)(t.trim(),m.display_name)},data:{type:b.Y,projection:"EPSG:4326",geometry:n,extent:p,properties:i,meta:{id:v,title:m.display_name}}}}computeProperties(m){return{display_name:m.display_name,place_id:m.place_id,osm_type:m.osm_type,class:m.class,type:m.type}}computeGeometry(m){return{type:"Point",coordinates:[parseFloat(m.lon),parseFloat(m.lat)]}}computeExtent(m){return[parseFloat(m.boundingbox[2]),parseFloat(m.boundingbox[0]),parseFloat(m.boundingbox[3]),parseFloat(m.boundingbox[1])]}computeTerm(m){return this.computeTermTags(m)}computeTermTags(m){const t=super.getHashtagsValid(m,"amenity");return t?t.length?(m=m.replace(/(#[^\s]*)/g,""),t.forEach(i=>{m+="+["+i+"]"}),m):null:this.computeTermSettings(m)}computeTermSettings(m){return this.options.settings.forEach(t=>{"amenity"===t.name&&t.values.forEach(i=>{i.enabled&&"string"==typeof i.value&&i.value.split(",").forEach(p=>{m+="+["+p+"]"})})}),m}static \u0275fac=function(t){return new(t||Un)(e.CoB(fe.KK),e.CoB("options"),e.CoB(W.yQ))};static \u0275prov=e.wxM({token:Un,factory:Un.\u0275fac})}(0,te.UN)([(0,I.w)({maxCacheCount:20,cacheHasher:ae.EB}),(0,te.YR)("design:type",Function),(0,te.YR)("design:paramtypes",[String,fe.i4]),(0,te.YR)("design:returntype",c._)],Un.prototype,"getSearch",null);var il=r(11544);class nn extends x.i{http;languageService;static id="storedqueries";static type=b.Y;static propertiesBlacklist=["boundedBy","id","coord_x","coord_y"];resultTitle;storedQueriesOptions;multipleFieldsQuery;constructor(m,t,i,n){if(super(n,i),this.http=m,this.languageService=t,this.storedQueriesOptions=n,!this.storedQueriesOptions||this.storedQueriesOptions.available){if(this.storedQueriesOptions||(console.log(" No configuration for this search source (storedqueries). You will use the default values"),this.storedQueriesOptions={storedquery_id:"rtss",fields:[{name:"rtss",defaultValue:"-99"},{name:"chainage",defaultValue:"0",splitPrefix:"\\+"}],outputformat:"text/xml; subtype=gml/3.1.1",srsname:"EPSG:4326",resultTitle:"title"},this.resultTitle="title",console.log("Default values",this.storedQueriesOptions)),!this.storedQueriesOptions.storedquery_id)throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"');if(!this.storedQueriesOptions.fields)throw new Error('Stored Queries :You have to set "fields" into options. ex: fields: {"name": "rtss", "defaultValue": "-99"}');if(this.storedQueriesOptions.outputformat=this.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",this.storedQueriesOptions.srsname=this.storedQueriesOptions.srsname||"EPSG:4326",this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")&&this.storedQueriesOptions.outputformat.toLowerCase().includes("getfeaturebyid")){let we="You must set a geojson format for your stored query. This is due to an openlayers issue)";throw we+=" (wfs 1.1.0 & gml 3.1.1 limitation)",new Error(we)}this.storedQueriesOptions.fields instanceof Array||(this.storedQueriesOptions.fields=[this.storedQueriesOptions.fields]),this.multipleFieldsQuery=this.storedQueriesOptions.fields.length>1,this.storedQueriesOptions.fields.forEach((we,Le)=>{if(this.multipleFieldsQuery&&!we.splitPrefix&&0!==Le)throw new Error("Stored Queries :You must set a field spliter into your field definition (optional for the first one!)");if(!we.defaultValue)throw new Error("Stored Queries :You must set a field default value into your field definition")}),this.storedQueriesOptions.resultTitle=this.storedQueriesOptions.resultTitle||this.resultTitle}}getId(){return nn.id}getType(){return nn.type}getDefaultOptions(){return{title:"Stored Queries",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}}search(m,t){const i=this.termSplitter(m,this.storedQueriesOptions.fields),n=this.computeRequestParams(t||{},i);return this.options.params=this.options.params?this.options.params:{},this.options.params.page=t.page?String(t.page):"1",this.getSearch(m,n)}getSearch(m,t){return new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:t,responseType:"text"}).pipe((0,oe.k)(i=>{let n=this.extractResults(this.extractWFSData(i),m);if(n.sort((p,v)=>p.meta.score>v.meta.score||p.meta.score===v.meta.score&&p.meta.titleHtml<v.meta.titleHtml?1:-1),n.reverse(),n.length>Number(this.options.params.limit)){const p=Number(this.options.params.limit)*Number(this.options.params.page),v=n.length;n=n.slice(0,p),n[n.length-1].meta.nextPage=p<v}return n})):this.http.get(this.searchUrl,{params:t}).pipe((0,oe.k)(i=>this.extractResults(this.extractWFSData(i),m)))}getFormatFromOptions(){let m;const t=this.storedQueriesOptions.outputformat,i=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(m=Z.c),i.test(t)&&(m=il.c),new m}extractWFSData(m){const t=this.getFormatFromOptions(),i=Z.c,n=t.readFeatures(m);return JSON.parse((new i).writeFeatures(n))}termSplitter(m,t){const i={};let n=m,p=0;return t.forEach(Y=>{i[Y.name]=Y.defaultValue;const ue=new RegExp(Y.splitPrefix+"(.+)","i");ue.test(n)&&(p=Y.splitPrefix?p+=1:p,n=n.split(ue)[1])}),0===p?(i[t[0].name]=m,i):(n=m,[...t].reverse().forEach(Y=>{const ue=new RegExp(Y.splitPrefix||"(.+)","i");if(n||""!==n){const ye=n.split(ue);n=ye[0],ye[1]&&(i[Y.name]=ye[1].trim())}}),i)}computeRequestParams(m,t){const i=this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")?"2.0.0":"1.1.0";return new fe.i4({fromObject:Object.assign({service:"wfs",version:i,request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},t,this.params,m.params||{})})}extractResults(m,t){return m.features.map(i=>this.dataToResult(i,t))}dataToResult(m,t){const i=this.computeProperties(m),n=[this.getId(),i.type,m.id].join("."),p=m.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:b.Y,projection:"EPSG:4326",geometry:m.geometry,properties:i,meta:{id:n,title:m.properties[p]}},meta:{dataType:b.Y,id:n,title:m.properties.title,titleHtml:m.properties[p],icon:"location_on",score:(0,me.Un)(t.trim(),m.properties.title?m.properties.title:m.properties[p])}}}computeProperties(m){return Object.assign({},ae.Yv.removeKeys(m.properties,nn.propertiesBlacklist),{Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"})}static \u0275fac=function(t){return new(t||nn)(e.CoB(fe.KK),e.CoB(k.ov),e.CoB(W.yQ),e.CoB("options"))};static \u0275prov=e.wxM({token:nn,factory:nn.\u0275fac})}(0,te.UN)([(0,I.w)({maxCacheCount:20,cacheHasher:ae.EB}),(0,te.YR)("design:type",Function),(0,te.YR)("design:paramtypes",[String,fe.i4]),(0,te.YR)("design:returntype",c._)],nn.prototype,"getSearch",null);class rn extends x.i{http;languageService;static id="storedqueriesreverse";static type=b.Y;static propertiesBlacklist=[];resultTitle;storedQueriesOptions;multipleFieldsQuery;constructor(m,t,i,n){if(super(n,i),this.http=m,this.languageService=t,this.storedQueriesOptions=n,this.storedQueriesOptions&&(!this.storedQueriesOptions||this.storedQueriesOptions.available)){if(!this.storedQueriesOptions.storedquery_id)throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"');if(!this.storedQueriesOptions.longField)throw new Error('Stored Queries :You have to set "longField" to map the longitude coordinate to the query params.');if(!this.storedQueriesOptions.latField)throw new Error('Stored Queries :You have to set "latField" to map the latitude coordinate to the query params.');this.storedQueriesOptions.outputformat=this.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",this.storedQueriesOptions.srsname=this.storedQueriesOptions.srsname||"EPSG:4326",this.storedQueriesOptions.resultTitle=this.storedQueriesOptions.resultTitle||this.resultTitle}}getId(){return rn.id}getType(){return rn.type}getDefaultOptions(){return{title:"Stored Queries (reverse)",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}}reverseSearch(m,t){const i=this.computeRequestParams(m,t||{});return this.getReverseSearch(i)}getReverseSearch(m){return(new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:m,responseType:"text"}):this.http.get(this.searchUrl,{params:m})).pipe((0,oe.k)(n=>this.extractResults(this.extractWFSData(n))))}getFormatFromOptions(){let m;const t=this.storedQueriesOptions.outputformat,i=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(m=Z.c),i.test(t)&&(m=il.c),new m}extractWFSData(m){const t=this.getFormatFromOptions(),i=Z.c,n=t.readFeatures(m);return JSON.parse((new i).writeFeatures(n))}computeRequestParams(m,t){const i={};return i[this.storedQueriesOptions.longField]=m[0],i[this.storedQueriesOptions.latField]=m[1],new fe.i4({fromObject:Object.assign({service:"WFS",version:"1.1.0",request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},i,this.params,t.params||{})})}extractResults(m){return m.features.map(t=>this.dataToResult(t))}dataToResult(m){const t=this.computeProperties(m),i=[this.getId(),t.type,m.id].join("."),n=m.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:b.Y,projection:"EPSG:4326",geometry:m.geometry,properties:t,meta:{id:i,title:m.properties[n]}},meta:{dataType:b.Y,id:i,title:m.properties[n],icon:"location_on"}}}computeProperties(m){const t=ae.Yv.removeKeys(m.properties,rn.propertiesBlacklist),i={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign(t,{type:m.properties.doc_type},i)}static \u0275fac=function(t){return new(t||rn)(e.CoB(fe.KK),e.CoB(k.ov),e.CoB(W.yQ),e.CoB("options"))};static \u0275prov=e.wxM({token:rn,factory:rn.\u0275fac})}(0,te.UN)([(0,I.w)({maxCacheCount:20,cacheHasher:ae.EB}),(0,te.YR)("design:type",Function),(0,te.YR)("design:paramtypes",[fe.i4]),(0,te.YR)("design:returntype",c._)],rn.prototype,"getReverseSearch",null);let nl=(()=>{class l extends x.i{languageService;static id="workspace";static type=b.Y;title$=new B.g("");get title(){return this.title$.getValue()}constructor(t,i,n){super(n,i),this.languageService=t,this.languageService.translate.get(this.options.title).subscribe(p=>this.title$.next(p))}getId(){return l.id}getType(){return l.type}getDefaultOptions(){return{title:"igo.geo.search.workspace.name",searchUrl:void 0,settings:[{type:"checkbox",title:"datasets",name:"datasets",values:[]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:!1},{title:"5",value:5,enabled:!0},{title:"10",value:10,enabled:!1},{title:"25",value:25,enabled:!1},{title:"50",value:50,enabled:!1}]}]}}search(t,i){const p=this.settings.find(we=>"limit"===we.name).values.find(we=>we.enabled).value||5;this.options.params.limit=p.toLocaleString();const v=[];this.options.params.page=(i.page||1).toLocaleString();const Y=i.page||1,ue=this.options.params.datasets.split(",");this.featureStoresWithIndex.filter(we=>we.searchDocument&&ue.includes(we.layer.title)).map(we=>{const Le=t;we.searchDocument.search(Le,{limit:Y*p}).map(Xe=>{const Ge=Xe.field;Xe.result.map(tt=>{const pt=we.index.get(tt),Tt=(0,me.Un)(Le.trim(),pt.properties[Ge]);v.push({index:tt,feature:pt,layer:we.layer,field:Ge,score:Tt})})})}),v.sort((we,Le)=>we.score>Le.score?-1:1);const ye=[],Ee=[];return v.map(we=>{ye.includes(we.index)||(ye.push(we.index),Ee.push(we))}),(0,z.of)(this.extractResults(Ee.sort((we,Le)=>we.score>Le.score?-1:1).slice(0,Y*p)))}extractResults(t){return t.map(i=>this.dataToResult(i,t.length))}dataToResult(t,i){const n=this.computeProperties(t),p=[this.getId(),n.type,t.index].join("."),v=t.feature.properties[t.field],Y="<br><small> "+t.layer.title+"</small>";return{source:this,data:{type:b.Y,projection:"EPSG:4326",geometry:t.feature.geometry,extent:t.feature.extent,properties:n,meta:{id:p,title:t.feature.properties[t.field],alias:this.getAllowedFieldsAndAlias(t.layer)}},meta:{dataType:b.Y,id:p,title:t.feature.meta.title,titleHtml:v+Y,icon:"location_on",score:t.score,nextPage:i%+this.options.params.limit==0&&+this.options.params.page<10}}}getAllowedFieldsAndAlias(t){let i;return t.options?.source?.options?.sourceFields&&t.options.source.options.sourceFields.length>=1&&(i={},t.options.source.options.sourceFields.forEach(n=>{i[n.name]=n.alias?n.alias:n.name})),i}computeProperties(t){if(!t.feature.geometry)return Object.assign({type:t.layer.title+"."+t.field},t.feature.properties);const i={GoogleMaps:""};let n;if("Point"===t.feature.geometry.type)n=D.getGoogleMapsCoordLink(t.feature.geometry.coordinates[0],t.feature.geometry.coordinates[1]);else{const v=(0,le.c)(t.feature.geometry);n=D.getGoogleMapsCoordLink(v.geometry.coordinates[0],v.geometry.coordinates[1])}i.GoogleMaps="<a href="+n+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByCoord")+"</a>","Point"===t.feature.geometry.type&&(i.GoogleStreetView=D.getGoogleStreetViewLink(t.feature.geometry.coordinates[0],t.feature.geometry.coordinates[1]));const p={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign({type:t.feature.sourceId},t.feature.properties,i,p)}static \u0275fac=function(i){return new(i||l)(e.CoB(k.ov),e.CoB(W.yQ),e.CoB("options"))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac})}return l})();function kp(l,m,t){return new nl(l,m,t.getConfig(`searchSources.${nl.id}`))}function Ap(){return{provide:x.i,useFactory:kp,multi:!0,deps:[k.ov,W.yQ,A.aW]}}r(88824);var rl=r(47572),Bp=r(52756);function $r({feature:l,markerColor:m=[0,161,222],markerOpacity:t=1,markerOutlineColor:i=[0,255,255],fillColor:n,fillOpacity:p=.15,strokeColor:v=[0,255,255],strokeOpacity:Y=.5,strokeWidth:ue=4}){return sl({feature:l,markerColor:m,markerOpacity:t,markerOutlineColor:i,fillColor:n,fillOpacity:p,strokeColor:v,strokeOpacity:Y,strokeWidth:ue})}function sl({feature:l,markerColor:m=[0,161,222],markerOpacity:t=.5,markerOutlineColor:i,fillColor:n=[0,161,222],fillOpacity:p=.15,strokeColor:v=[0,161,222],strokeOpacity:Y=.5,strokeWidth:ue=2}){const ye=l instanceof $i.c;let Ee,we;ye?Ee=l.getGeometry():(Ee=l.geometry,we=l.meta.mapTitle);const Le=ye?Ee.getType():Ee.type;if(Ee&&"Point"!==Le){const Xe=(0,fr.f4)(n).slice(0),Ge=(0,fr.f4)(v).slice(0);return 4===Xe.length&&("string"!=typeof n||/^#[0-9A-F]{8}$/i.test(n))||(Xe[3]=p),4===Ge.length&&("string"!=typeof v||/^#[0-9A-F]{8}$/i.test(v))||(Ge[3]=Y),(0,Bp.B)({text:we,strokeWidth:ue,strokeColor:Ge,fillColor:Xe})}{const Xe=(0,fr.f4)(m).slice(0),Ge=Xe.slice(0,3);return 4===Xe.length&&("string"!=typeof m||/^#[0-9A-F]{8}$/i.test(m))&&(t=Xe[3]),(0,rl.o)({text:we,opacity:t,markerOutlineColor:i,markerColor:Ge})}}let Up=(()=>{class l{config;options;constructor(t){this.config=t,this.options=this.config.getConfig("regex")}getAll(){return this.options}get(t){if(this.options)return this.options[t]}static \u0275fac=function(i){return new(i||l)(e.CoB(A.aW))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),_s=(()=>{class l{regexService;geoServiceRegexes=[];constructor(t){this.regexService=t,this.geoServiceRegexes=this.getGeoServiceRegexes()}getPropertyType(t){return typeof t}isUrl(t){return/^https?:\/\//.test(t.toString())}isGeoService(t){let i=!1;if(this.isUrl){for(const n of this.geoServiceRegexes)if(new RegExp(n.url).test(t)){i=!0;break}return i}}getGeoService(t,i){if(!this.isGeoService(t))return;let n;for(const p of this.geoServiceRegexes)if(new RegExp(p.url).test(t)&&(n=i.filter(ue=>p.propertiesForLayerName.includes(ue))?p:void 0,n))break;return n}getGeoServiceRegexes(){return this.regexService.get("geoservice")||[]}static \u0275fac=function(i){return new(i||l)(e.CoB(Up))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();class Cs extends be.ec{options;inResolutionRange$=new B.g(!0);get layer(){return this.options.layer}get map(){return this.options.map}constructor(m){super(m),this.options=m,this.map.viewController.resolution$.subscribe(t=>{this.inResolutionRange$.next(t>this.layer.minResolution&&t<this.layer.maxResolution)})}getLayerWksOptionTabQuery(){return void 0===this.layer.options.workspace.queryOptions?.tabQuery||this.layer.options.workspace.queryOptions.tabQuery}getLayerWksOptionMapQuery(){return void 0===this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab||this.layer.options.workspace.queryOptions.mapQueryOnOpenTab}getInResolutionRange(){return this.inResolutionRange$.value}}var Yt=r(76572);function Yp(l){return l.entityStore.getStrategyOfType(be.qq).active$.pipe((0,oe.k)(m=>m?"igo.geo.workspace.inMapExtent.active.tooltip":"igo.geo.workspace.inMapExtent.inactive.tooltip"))}function Vp(l){return l.entityStore.stateView.manyBy$(m=>!0===m.state.selected).pipe((0,oe.k)(m=>m.length>=1))}function al(l,m,t,i,n,p){const v=ae.Yv.removeUndefined({sourceOptions:{type:i,url:t,optionsFromCapabilities:!0,optionsFromApi:!0,params:{LAYERS:"wms"===i?n:void 0,LAYER:"wms"===i?void 0:n}}});if("add"===l)p.createAsyncLayer(v).subscribe(Y=>{m.layersAddedByClick$.next([Y]),m.addLayer(Y)});else if("remove"===l){const Y=(0,An.KC)(v.sourceOptions);m.removeLayer(m.layers.find(ue=>ue.id===Y))}}function vs(l,m,t,i){const n=function jp(l,m){return[{name:"geoServiceAction",title:void 0,tooltip:"",renderer:be.G8.ButtonGroup,valueAccessor:(i,n)=>{let p=n.state.geoService;return p&&p.haveGeoServiceProperties&&p.url&&p.layerName?p.added?[{icon:"delete",color:"warn",click:(v,Y)=>{al("remove",l.map,Y.state.geoService.url,Y.state.geoService.type,Y.state.geoService.layerName,m),p.added=!1}}]:[{icon:"add",color:"primary",click:(v,Y)=>{al("add",l.map,Y.state.geoService.url,Y.state.geoService.type,Y.state.geoService.layerName,m),p.added=!0}}]:[]}}]}(l,t),p=m.dataSource.options.sourceFields||[],v=m.dataSource.options.relations||[];if(0===p.length)return void l.entityStore.entities$.pipe((0,Gn.O)(ye=>0===ye.length),(0,Rr.U)(1)).subscribe(ye=>{const Ee=ye[0].ol,we=Ee.getKeys().filter(Le=>!Le.startsWith("_")&&"geometry"!==Le&&Le!==Ee.getGeometryName()&&!Le.match(/boundedby/gi)).map(Le=>({name:`properties.${Le}`,title:Le,renderer:be.G8.UnsanitizedHTML}));we.unshift(...n),l.meta.tableTemplate={selection:!0,sort:!0,columns:we,tableHeight:"100%"}});const Y=p.map(ye=>({name:`properties.${ye.name}`,title:ye.alias?ye.alias:ye.name,renderer:be.G8.UnsanitizedHTML,tooltip:ye.tooltip,cellClassFunc:()=>{const Ee={};if(ye.type)return Ee[`class_${ye.type}`]=!0,Ee}})),ue=v.map(ye=>({name:`properties.${ye.name}`,title:ye.alias?ye.alias:ye.name,renderer:be.G8.Icon,icon:ye.icon,parent:ye.parent,type:"relation",tooltip:ye.tooltip,onClick:()=>{i.next(ye.title)},cellClassFunc:()=>({class_icon:!0})}));Y.push(...ue),Y.unshift(...n),l.meta.tableTemplate={selection:!0,sort:!0,columns:Y,tableHeight:"100%"}}function kr(){return new be.qq({filterClauseFunc:m=>!0===m.state.inMapExtent&&!0===m.state.inMapResolution})}let Kp=(()=>{class l{storageService;configService;layerService;propertyTypeDetectorService;capabilitiesService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new B.g(void 0);constructor(t,i,n,p,v){this.storageService=t,this.configService=i,this.layerService=n,this.propertyTypeDetectorService=p,this.capabilitiesService=v}createWorkspace(t,i){if(!1===t.options.workspace?.enabled||t.dataSource.options.edition)return;t.options.workspace=Object.assign({},t.options.workspace,{srcId:t.id,workspaceId:t.id,enabled:!0});const n=new Cs({id:t.id,title:t.title,layer:t,map:i,entityStore:this.createFeatureStore(t,i),actionStore:new be.MF([]),meta:{tableTemplate:void 0}});return vs(n,t,this.layerService,this.ws$),n}createFeatureStore(t,i){const n=new Yt.ym([],{map:i});n.bindLayer(t);const p=new Yt._c({}),v=new Yt.IV({}),Y=new Yt.eu({map:i},this.propertyTypeDetectorService,this.capabilitiesService),ue=new Yt.CE({}),ye=new be.xx({}),Ee=this.configService.getConfig("queryOverlayStyle"),we=new Yt.kj({layer:new oo.Md({zIndex:300,source:new Mo.EB,style:Le=>$r(Object.assign({},{feature:Le},Ee?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:i,hitTolerance:15,motion:this.zoomAuto?Yt.Su.Default:Yt.Su.None,many:!0,dragBox:!0});return n.addStrategy(p,!0),n.addStrategy(v,!0),n.addStrategy(Y,!0),n.addStrategy(ue,!0),n.addStrategy(we,!0),n.addStrategy(ye,!1),n.addStrategy(kr(),!0),n}static \u0275fac=function(i){return new(i||l)(e.CoB(W.yQ),e.CoB(A.aW),e.CoB(oo.IZ),e.CoB(_s),e.CoB(zo.S))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();class ll extends be.ec{options;inResolutionRange$=new B.g(!0);get layer(){return this.options.layer}get map(){return this.options.map}constructor(m){super(m),this.options=m,this.map.viewController.resolution$.subscribe(t=>{this.inResolutionRange$.next(t>this.layer.minResolution&&t<this.layer.maxResolution)})}getLayerWksOptionTabQuery(){return void 0===this.layer.options.workspace.queryOptions?.tabQuery||this.layer.options.workspace.queryOptions.tabQuery}getLayerWksOptionMapQuery(){return void 0===this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab||this.layer.options.workspace.queryOptions.mapQueryOnOpenTab}getInResolutionRange(){return this.inResolutionRange$.value}}let Wp=(()=>{class l{storageService;configService;layerService;propertyTypeDetectorService;capabilitiesService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new B.g(void 0);constructor(t,i,n,p,v){this.storageService=t,this.configService=i,this.layerService=n,this.propertyTypeDetectorService=p,this.capabilitiesService=v}createWorkspace(t,i){if(!1===t.options.workspace?.enabled||t.dataSource.options.edition)return;t.options.workspace=Object.assign({},t.options.workspace,{srcId:t.id,workspaceId:t.id,enabled:!0});const n=new ll({id:t.id,title:t.title,layer:t,map:i,entityStore:this.createFeatureStore(t,i),actionStore:new be.MF([]),meta:{tableTemplate:void 0}});return vs(n,t,this.layerService,this.ws$),n}createFeatureStore(t,i){const n=new Yt.ym([],{map:i});n.bindLayer(t);const p=new Yt._c({}),v=new Yt.oJ({percentDistinctValueRatio:2,sourceFields:t.dataSource.options.sourceFields}),Y=new Yt.IV({}),ue=new Yt.eu({map:i},this.propertyTypeDetectorService,this.capabilitiesService),ye=new Yt.CE({}),Ee=new be.xx({}),we=this.configService.getConfig("queryOverlayStyle"),Le=new Yt.kj({layer:new oo.Md({zIndex:300,source:new Mo.EB,style:Xe=>$r(Object.assign({},{feature:Xe},we?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:i,hitTolerance:15,motion:this.zoomAuto?Yt.Su.Default:Yt.Su.None,many:!0,dragBox:!0});return t.options.workspace?.searchIndexEnabled&&n.addStrategy(v,!0),n.addStrategy(p,!0),n.addStrategy(Y,!0),n.addStrategy(ue,!0),n.addStrategy(ye,!0),n.addStrategy(Le,!0),n.addStrategy(Ee,!1),n.addStrategy(kr(),!0),n}static \u0275fac=function(i){return new(i||l)(e.CoB(W.yQ),e.CoB(A.aW),e.CoB(oo.IZ),e.CoB(_s),e.CoB(zo.S))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var Np=r(14512),Hp=r(99376);let zp=(()=>{class l{dialogRef;languageService;data;constructor(t,i,n){this.dialogRef=t,this.languageService=i,this.data=n}cancelAction(){this.data.cancel=!0,this.dialogRef.close(this.data.cancel)}confirmedAction(){this.data.cancel=!1,this.dialogRef.close(this.data.cancel)}static \u0275fac=function(i){return new(i||l)(e.GI1(_t.yI),e.GI1(k.ov),e.GI1(_t.sR))};static \u0275cmp=e.In1({type:l,selectors:[["igo-confirmation-popup-component"]],standalone:!0,features:[e.UHJ],decls:8,vars:2,consts:[["mat-dialog-content",""],[1,"mat-typography"],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"]],template:function(i,n){1&i&&(e.I0R(0,"div",0)(1,"p",1),e.OEk(2),e.C$Y()(),e.I0R(3,"div",2)(4,"button",3),e.qCj("click",function(){return n.confirmedAction()}),e.OEk(5," Ok "),e.C$Y(),e.I0R(6,"button",4),e.qCj("click",function(){return n.cancelAction()}),e.OEk(7),e.C$Y()()),2&i&&(e.yG2(2),e.oRS(" ",n.languageService.translate.instant("add"===n.data.type?"igo.geo.workspace.addConfirmation":"igo.geo.workspace.deleteConfirmation")," "),e.yG2(5),e.oRS(" ",n.languageService.translate.instant("igo.geo.workspace.cancel")," "))},dependencies:[_t.iU,_t.Yp,Ze.oJ,Ze.Gw],styles:["div.mat-mdc-dialog-actions[_ngcontent-%COMP%]{justify-content:center}"]})}return l})();class cl extends be.ec{dialog;configService;adding$;getDomainValues;options;inResolutionRange$=new B.g(!0);get layer(){return this.options.layer}get map(){return this.options.map}drawControl;drawEnd$$;olDrawingLayerSource=new j.c;olDrawingLayer;geometryType=Nt;modify;modifyStyle=new $o.cp({stroke:new yo.c({color:"rgba(255,255,255,1)",width:1}),fill:new _o.c({color:"rgba(0,161,222,1)"}),image:new Gi.c({radius:7,stroke:new yo.c({color:"rgba(255,255,255,1)",width:1}),fill:new _o.c({color:"rgba(0,161,222,1)"})})});newFeaturefilterClauseFunc=m=>!0===m.state.newFeature;editFeaturefilterClauseFunc=m=>!0===m.state.edit;fillColor;strokeColor;strokeWidth;constructor(m,t,i,n,p){super(p),this.dialog=m,this.configService=t,this.adding$=i,this.getDomainValues=n,this.options=p,this.map.viewController.resolution$.subscribe(v=>{this.inResolutionRange$.next(v>this.layer.minResolution&&v<this.layer.maxResolution)}),this.drawControl=this.createDrawControl(),this.drawControl.setGeometryType(this.geometryType.Point),this.map.removeLayer(this.olDrawingLayer),this.olDrawingLayer=new oo.Md({id:"igo-draw-layer",title:"edition",zIndex:300,source:new Mo.EB,showInLayerList:!1,exportable:!1,browsable:!1,workspace:{enabled:!1}})}deleteFeature(m,t){setTimeout(()=>{this.dialog.open(zp,{disableClose:!1,data:{type:"delete"}}).afterClosed().subscribe(n=>{if(!1===n){let p,v;const Y=t.layer.dataSource.options.edition.baseUrl,ue=t.layer.dataSource.options.edition.deleteUrl;v=Y.length?this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+Y+"?"+ue:Y+"?"+ue:this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+ue:ue;for(const ye of t.meta.tableTemplate.columns)for(const Ee in m.properties){let we=ye.name;we.includes("properties.")&&(we=we.split(".")[1]),we===Ee&&!0===ye.primary&&(p=m.properties[Ee])}v&&(v+=p,this.deleteFeature(t,v))}})},250)}editFeature(m,t){m.edition=!0;let i,n=!1;const p=t.layer.dataSource.options.edition;for(const v of t.meta.tableTemplate.columns)if(("list"===v.type||"autocomplete"===v.type)&&this.getDomainValues(v.relation).subscribe(Y=>{v.domainValues=Y}),!1===n)for(const Y in m.properties){let ue=v.name;if(ue.includes("properties.")&&(ue=ue.split(".")[1]),ue===Y&&!0===v.primary){i=m.properties[Y],n=!0;break}}i?(m.original_properties=JSON.parse(JSON.stringify(m.properties)),m.original_geometry=m.geometry,m.idkey=i,t.entityStore.state.updateAll({edit:!1}),t.entityStore.stateView.filter(this.editFeaturefilterClauseFunc),this.addFeatureToStore(m,t)):!m.newFeature&&p.geomType&&(m.newFeature=!0,this.adding$.next(!0),t.entityStore.state.updateAll({newFeature:!1}),t.entityStore.stateView.filter(this.newFeaturefilterClauseFunc),p.addWithDraw?this.onGeometryTypeChange(p.geomType,m,t):(t.entityStore.insert(m),t.entityStore.state.update(m,{newFeature:!0},!0)))}createDrawControl(m,t,i){return new Ip.i4({geometryType:void 0,drawingLayerSource:this.olDrawingLayerSource,drawingLayerStyle:new $o.cp({}),interactionStyle:ur(m,t,i)})}onGeometryTypeChange(m,t,i){this.drawControl.setGeometryType(m),this.toggleDrawControl(t,i)}toggleDrawControl(m,t){this.deactivateDrawControl(),this.activateDrawControl(m,t)}deactivateDrawControl(){this.drawControl&&(this.drawEnd$$&&this.drawEnd$$.unsubscribe(),this.drawControl.setOlMap(void 0))}activateDrawControl(m,t){this.drawEnd$$=this.drawControl.end$.subscribe(i=>{this.addFeatureToStore(m,t,i)}),this.drawControl.setOlMap(this.map.ol,!0)}addFeatureToStore(m,t,i){const n=this.map.ol.getView().getProjection();let p=m.geometry;i?(t.entityStore.insert(m),t.entityStore.state.update(m,{newFeature:!0},!0),p=(new Z.c).writeGeometryObject(i,{featureProjection:n,dataProjection:"EPSG:4326"}),m.geometry=p):t.entityStore.state.update(m,{edit:!0},!0),m.projection="EPSG:4326";const v=(0,Yt.K6)(m,n.getCode());this.olDrawingLayer.dataSource.ol.clear(),this.olDrawingLayer.dataSource.ol.addFeature(v),this.map.addLayer(this.olDrawingLayer),this.deactivateDrawControl(),this.createModifyInteraction(v,m,t)}deleteDrawings(){this.map.removeLayer(this.olDrawingLayer),this.olDrawingLayerSource.clear(),this.map.ol.removeInteraction(this.modify)}createModifyInteraction(m,t,i){this.map.ol.removeInteraction(this.modify);const n=new Np.c([m],{unique:!0});this.modify=new Hp.c({features:n}),this.map.ol.addInteraction(this.modify),n.forEach(p=>{p.setStyle(this.modifyStyle)}),this.modify.on("modifyend",p=>{const v=p.features.getArray()[0]?.getGeometry();v&&this.addFeatureToStore(t,i,v)})}}let Xp=(()=>{class l{layerService;storageService;configService;messageService;http;dialog;styleService;authInterceptor;ws$=new B.g(void 0);adding$=new B.g(!1);relationLayers$=new B.g(void 0);rowsInMapExtentCheckCondition$=new B.g(!0);loading=!1;wktFormat=new ho.c;geoJsonFormat=new Z.c;get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(t,i,n,p,v,Y,ue,ye){this.layerService=t,this.storageService=i,this.configService=n,this.messageService=p,this.http=v,this.dialog=Y,this.styleService=ue,this.authInterceptor=ye}createWorkspace(t,i){if(!0!==t.options.workspace?.enabled||!0!==t.dataSource.options.edition.enabled)return;let n;n=t.options.workspace?t.options.workspace:{},n.srcId=t.id,n.workspaceId=t.id,n.enabled=!0,n.pageSize=t.options.workspace?.pageSize,n.pageSizeOptions=t.options.workspace?.pageSizeOptions;const p=t.dataSource,v=t.id+".WmsWorkspaceTableSrc",Y=t.id+".WfsWorkspaceTableDest";t.options.linkedLayers||(t.options.linkedLayers={linkId:v,links:[]});const ue={syncedDelete:!0,linkedIds:[Y],properties:[oo.aG.ZINDEX,oo.aG.VISIBLE]};t.options.workspace?.minResolution||ue.properties.push(oo.aG.MINRESOLUTION);let ye=!1;p.options.ogcFilters?.enabled&&(ue.properties.push(oo.aG.OGCFILTERS),ye=!0),t.options.workspace?.maxResolution||ue.properties.push(oo.aG.MAXRESOLUTION);let we,Ee=[];return t.options.linkedLayers.links&&(Ee=JSON.parse(JSON.stringify(t.options.linkedLayers.links))),Ee.push(ue),t.options.linkedLayers.linkId=t.options.linkedLayers.linkId?t.options.linkedLayers.linkId:v,t.options.linkedLayers.links=Ee,this.layerService.createAsyncLayer({id:Y,linkedLayers:{linkId:Y},workspace:{srcId:t.id,workspaceId:void 0,enabled:!1,queryOptions:{mapQueryOnOpenTab:t.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:!1},pageSize:t.options.workspace?.pageSize,pageSizeOptions:t.options.workspace?.pageSizeOptions},showInLayerList:!1,opacity:0,title:t.title,minResolution:t.options.workspace?.minResolution||t.minResolution||0,maxResolution:t.options.workspace?.maxResolution||t.maxResolution||1/0,style:this.styleService.createStyle({fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},circle:{fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},radius:5}}),sourceOptions:{download:p.options.download,type:"wfs",url:p.options.urlWfs||p.options.url,queryable:!0,relations:p.options.relations,queryTitle:p.options.queryTitle,params:p.options.paramsWFS,ogcFilters:Object.assign({},p.ogcFilters,{enabled:ye}),sourceFields:p.options.sourceFields||void 0,edition:p.options.edition}}).subscribe(Le=>(i.addLayer(Le),t.ol.setProperties({linkedLayers:{linkId:t.options.linkedLayers.linkId,links:Ee}},!1),Le.dataSource.ol.refresh(),we=new cl(this.dialog,this.configService,this.adding$,Xe=>this.getDomainValues(Xe),{id:t.id,title:t.title,layer:Le,map:i,entityStore:this.createFeatureStore(Le,i),actionStore:new be.MF([]),meta:{tableTemplate:void 0}}),this.createTableTemplate(we,Le),Le.options.workspace.workspaceId=Le.id,t.options.workspace=Object.assign({},t.options.workspace,{wksConfig:n}),delete p.options.download,we)),we}createFeatureStore(t,i){const n=new Yt.ym([],{map:i});n.bindLayer(t);const p=new Yt._c({}),v=new Yt.IV({}),Y=new Yt.CE({}),ue=new be.xx({}),ye=new Yt.kj({layer:new oo.Md({zIndex:300,source:new ve.E,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1}),map:i,hitTolerance:15,motion:this.zoomAuto?Yt.Su.Default:Yt.Su.None,many:!0,dragBox:!0});return n.addStrategy(p,!0),n.addStrategy(v,!0),n.addStrategy(Y,!0),n.addStrategy(ye,!0),n.addStrategy(ue,!1),n.addStrategy(kr(),!0),n}createTableTemplate(t,i){const n=i.dataSource.options.sourceFields||[],p=i.dataSource.options.relations||[];let v=be.G8.UnsanitizedHTML,Y=[],ue=[],ye=[];Y=[{name:"edition",title:void 0,renderer:be.G8.ButtonGroup,primary:!1,valueAccessor:()=>[{editMode:!1,icon:"edit",color:"primary",disabled:!1===i.dataSource.options.edition.modifyButton,click:Ee=>{t.editFeature(Ee,t)}},{editMode:!1,icon:"delete",color:"warn",disabled:!1===i.dataSource.options.edition.deleteButton,click:Ee=>{t.deleteFeature(Ee,t)}},{editMode:!0,icon:"check",color:"primary",disabled:this.loading,click:Ee=>{this.saveFeature(Ee,t)}},{editMode:!0,icon:"close",color:"primary",disabled:this.loading,click:Ee=>{this.cancelEdit(t,Ee)}}]}],0!==n.length?(ue=n.map(Ee=>{let we={name:`properties.${Ee.name}`,title:Ee.alias?Ee.alias:Ee.name,renderer:v,valueAccessor:void 0,cellClassFunc:()=>{const Le={};if(Ee.type)return Le[`class_${Ee.type}`]=!0,Le},primary:!0===Ee.primary,visible:Ee.visible,validation:Ee.validation,linkColumnForce:Ee.linkColumnForce,type:Ee.type,domainValues:void 0,relation:void 0,multiple:Ee.multiple,step:Ee.step,tooltip:Ee.tooltip};return("list"===Ee.type||"autocomplete"===Ee.type)&&this.getDomainValues(Ee.relation).subscribe(Le=>{we.domainValues=Le,we.relation=Ee.relation}),we}),ye=p.map(Ee=>({name:`properties.${Ee.name}`,title:Ee.alias?Ee.alias:Ee.name,renderer:be.G8.Icon,icon:Ee.icon,parent:Ee.parent,type:"relation",tooltip:Ee.tooltip,onClick:()=>{!1===this.adding$.getValue()&&this.ws$.next(Ee.title)},cellClassFunc:()=>({class_icon:!0})})),ue.push(...ye),ue.push(...Y),t.meta.tableTemplate={selection:!1,sort:!0,columns:ue}):t.entityStore.entities$.pipe((0,Gn.O)(Ee=>0===Ee.length),(0,Rr.U)(1)).subscribe(Ee=>{const we=Ee[0].ol,Le=we.getKeys().filter(Xe=>!Xe.startsWith("_")&&"geometry"!==Xe&&Xe!==we.getGeometryName()&&!Xe.match(/boundedby/gi)).map(Xe=>({name:`properties.${Xe}`,title:Xe,renderer:v}));t.meta.tableTemplate={selection:!1,sort:!0,columns:Le}})}saveFeature(t,i){if(!this.validateFeature(t,i))return!1;this.sanitizeParameter(t,i);const n=i.layer.dataSource.options.edition.baseUrl;let p=this.configService.getConfig("edition.url");if(p?p+=n||"":p=n,t.newFeature){p+=i.layer.dataSource.options.edition.addUrl;const Y=new fe.UD(i.layer.dataSource.options.edition.addHeaders);this.addFeature(t,i,p,Y)}else{p+="post"!==i.layer.dataSource.options.edition.modifyProtocol?"?"+i.layer.dataSource.options.edition.modifyUrl+t.idkey:i.layer.dataSource.options.edition.modifyUrl;const v=i.layer.dataSource.options.edition.modifyProtocol,ue=new fe.UD(i.layer.dataSource.options.edition.modifyHeaders);this.modifyFeature(t,i,p,ue,v)}}addFeature(t,i,n,p){if(i.layer.dataSource.options.edition.hasGeometry){const v=i.layer.options.sourceOptions.edition.geomDatabaseProj;t.properties[i.layer.dataSource.options.params.fieldNameGeometry]="SRID="+v.replace("EPSG:","")+";"+this.wktFormat.writeGeometry(this.geoJsonFormat.readFeature(t.geometry).getGeometry().transform("EPSG:4326",v),{dataProjection:v})}for(const v in t.properties)for(const Y of i.layer.dataSource.options.sourceFields)(Y.name===v&&Y.validation?.readonly||Y.name===v&&!1===Y.validation?.send)&&delete t.properties[v];this.loading=!0,this.http.post(`${n}`,t.properties,{headers:p}).subscribe(()=>{this.loading=!1,i.entityStore.stateView.clear(),i.deleteDrawings(),i.entityStore.delete(t),this.messageService.success("igo.geo.workspace.addSuccess"),this.refreshMap(i.layer,i.layer.map),this.adding$.next(!1),this.rowsInMapExtentCheckCondition$.next(!0)},v=>{this.loading=!1,v.error.caught=!0;const Y=i.layer.dataSource.options.edition.messages;if(Y){let ue;Y.forEach(ye=>{const Ee=Object.keys(ye)[0];v.error.message.includes(Ee)&&(ue=ye[Ee],this.messageService.error(ue))}),ue||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}deleteFeature(t,i){this.loading=!0,this.http.delete(`${i}`,{}).subscribe(()=>{this.loading=!1,this.messageService.success("igo.geo.workspace.deleteSuccess"),this.refreshMap(t.layer,t.layer.map);for(const n of t.layer.options.sourceOptions.relations)t.map.layers.forEach(p=>{p.title===n.title&&p.dataSource.ol.refresh()})},n=>{this.loading=!1,n.error.caught=!0;const p=t.layer.dataSource.options.edition.messages;if(p){let v;p.forEach(Y=>{const ue=Object.keys(Y)[0];n.error.message.includes(ue)&&(v=Y[ue],this.messageService.error(v))}),v||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}modifyFeature(t,i,n,p,v="patch"){if(i.layer.dataSource.options.edition.hasGeometry){const Y=i.layer.options.sourceOptions.edition.geomDatabaseProj;t.geometry.coordinates=ul(t.geometry.coordinates),t.properties[i.layer.dataSource.options.params.fieldNameGeometry]="SRID="+Y.replace("EPSG:","")+";"+this.wktFormat.writeGeometry(this.geoJsonFormat.readFeature(t.geometry).getGeometry().transform("EPSG:4326",Y),{dataProjection:Y})}for(const Y in t.properties)for(const ue of i.layer.dataSource.options.sourceFields)(ue.name===Y&&ue.validation?.readonly||ue.name===Y&&!1===ue.validation?.send||"boundedBy"===Y)&&delete t.properties[Y];this.loading=!0,this.http[v](`${n}`,t.properties,{headers:p}).subscribe(()=>{this.loading=!1,this.cancelEdit(i,t,!0),this.messageService.success("igo.geo.workspace.modifySuccess"),this.refreshMap(i.layer,i.layer.map);let Y=[];for(const ue of i.layer.options.sourceOptions.relations)i.map.layers.forEach(ye=>{ye.title===ue.title&&(Y.push(ye),ye.dataSource.ol.refresh())});this.relationLayers$.next(Y)},Y=>{this.loading=!1,Y.error.caught=!0;const ue=i.layer.dataSource.options.edition.messages;if(ue){let ye;ue.forEach(Ee=>{const we=Object.keys(Ee)[0];Y.error.message.includes(we)&&(ye=Ee[we],this.messageService.error(ye))}),ye||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}cancelEdit(t,i,n=!1){i.edition=!1,this.adding$.next(!1),t.deleteDrawings(),t.entityStore.stateView.clear(),i.newFeature?(t.entityStore.delete(i),t.deactivateDrawControl(),this.rowsInMapExtentCheckCondition$.next(!0)):(n||(i.properties=i.original_properties,i.geometry=i.original_geometry),delete i.original_properties,delete i.original_geometry)}getDomainValues(t){let i=t.url;return i||(i=this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+t.table:t.table),this.http.get(i).pipe((0,oe.k)(n=>n),(0,se.a)(n=>(n.error.caught=!0,(0,ma.c)(n))))}refreshMap(t,i){const n=t.dataSource.ol;n.setLoader((v,Y,ue,ye,Ee)=>{t.customWFSLoader(t.ol.getSource(),t.options.sourceOptions,this.authInterceptor,v,Y,ue,ye,Ee,!0)}),n.refresh();for(const v of i.layers)if(v.id!==t.id&&v.options.linkedLayers?.linkId.includes(t.id.substr(0,t.id.indexOf(".")-1))&&v.options.linkedLayers?.linkId.includes("WmsWorkspaceTableSrc")){const Y=v.dataSource.ol;let ue=Y.getParams();ue._t=(new Date).getTime(),Y.updateParams(ue)}}validateFeature(t,i){let p,v=!0;return i.meta.tableTemplate.columns.forEach(Y=>{Y.hasOwnProperty("validation")&&Y.validation&&(p=Ar(Y.name),Object.keys(Y.validation).forEach(ue=>{switch(ue){case"mandatory":Y.validation[ue]&&(!t.properties.hasOwnProperty(p)||!t.properties[p])&&(v=!1,this.messageService.error("igo.geo.formValidation.mandatory",void 0,void 0,{column:Y.title}));break;case"minValue":t.properties.hasOwnProperty(p)&&t.properties[p]&&t.properties[p]<Y.validation[ue]&&(v=!1,this.messageService.error("igo.geo.formValidation.minValue",void 0,void 0,{column:Y.title,value:Y.validation[ue]}));break;case"maxValue":t.properties.hasOwnProperty(p)&&t.properties[p]&&t.properties[p]>Y.validation[ue]&&(v=!1,this.messageService.error("igo.geo.formValidation.maxValue",void 0,void 0,{column:Y.title,value:Y.validation[ue]}));break;case"minLength":t.properties.hasOwnProperty(p)&&t.properties[p]&&t.properties[p].length<Y.validation[ue]&&(v=!1,this.messageService.error("igo.geo.formValidation.minLength",void 0,void 0,{column:Y.title,value:Y.validation[ue]}));break;case"maxLength":t.properties.hasOwnProperty(p)&&t.properties[p]&&t.properties[p].length>Y.validation[ue]&&(v=!1,this.messageService.error("igo.geo.formValidation.maxLength",void 0,void 0,{column:Y.title,value:Y.validation[ue]}))}}))}),v}sanitizeParameter(t,i){i.meta.tableTemplate.columns.forEach(n=>{"list"===n.type&&t.properties[Ar(n.name)]&&(t.properties[Ar(n.name)]=t.properties[Ar(n.name)].toString())})}static \u0275fac=function(i){return new(i||l)(e.CoB(oo.IZ),e.CoB(W.yQ),e.CoB(A.aW),e.CoB(Ht.mi),e.CoB(fe.KK),e.CoB(_t.qW),e.CoB(mr.U),e.CoB(Se.kT))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function Ar(l){return l.includes("properties.")?l.split(".")[1]:l}function ul(l){return 0===l.length?l:"number"==typeof l[0]?l.slice(0,2):l.map(ul)}var Jp=r(33436);let Qp=(()=>{class l{layerService;storageService;capabilitiesService;styleService;configService;propertyTypeDetectorService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new B.g(void 0);constructor(t,i,n,p,v,Y){this.layerService=t,this.storageService=i,this.capabilitiesService=n,this.styleService=p,this.configService=v,this.propertyTypeDetectorService=Y}createWorkspace(t,i){if(!t.options.workspace||i.layers.find(Le=>Le.id===t.id+".WfsWorkspaceTableDest")||t.dataSource.options.edition)return;const n=t.dataSource,p=t.id+".WmsWorkspaceTableSrc",v=t.id+".WfsWorkspaceTableDest";t.options.linkedLayers||(t.options.linkedLayers={linkId:p,links:[]});const Y={syncedDelete:!0,linkedIds:[v],properties:[oo.aG.ZINDEX,oo.aG.VISIBLE]};t.options.workspace?.minResolution||Y.properties.push(oo.aG.MINRESOLUTION);let ue=!1;n.options.ogcFilters?.enabled&&(Y.properties.push(oo.aG.OGCFILTERS),ue=!0),t.options.workspace?.maxResolution||Y.properties.push(oo.aG.MAXRESOLUTION);let Ee,ye=[];return t.options.linkedLayers.links&&(ye=JSON.parse(JSON.stringify(t.options.linkedLayers.links))),ye.push(Y),t.options.linkedLayers.linkId=t.options.linkedLayers.linkId?t.options.linkedLayers.linkId:p,t.options.linkedLayers.links=ye,this.layerService.createAsyncLayer({isIgoInternalLayer:!0,id:v,linkedLayers:{linkId:v},workspace:{printable:t.options.workspace?.printable,srcId:t.id,workspaceId:void 0,enabled:!1,queryOptions:{mapQueryOnOpenTab:t.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:t.options.workspace?.queryOptions?.tabQuery},pageSize:t.options.workspace?.pageSize,pageSizeOptions:t.options.workspace?.pageSizeOptions},showInLayerList:!1,opacity:0,title:t.title,minResolution:t.options.workspace?.minResolution||t.minResolution||0,maxResolution:t.options.workspace?.maxResolution||t.maxResolution||1/0,style:this.styleService.createStyle({fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},circle:{fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},radius:5}}),sourceOptions:{download:n.options.download,type:"wfs",url:n.options.urlWfs||n.options.url,queryable:!0,relations:n.options.relations,queryTitle:n.options.queryTitle,queryFormatAsWms:!t.options.workspace?.enabled||n.options.queryFormatAsWms,params:n.options.paramsWFS,ogcFilters:Object.assign({},n.ogcFilters,{enabled:ue}),sourceFields:n.options.sourceFields||void 0}}).subscribe(Le=>{if(i.addLayer(Le),t.ol.setProperties({linkedLayers:{linkId:t.options.linkedLayers.linkId,links:ye}},!1),Le.dataSource.ol.refresh(),t.options.workspace?.enabled)return Ee=new Cs({id:t.id,title:t.title,layer:Le,map:i,entityStore:this.createFeatureStore(Le,i),actionStore:new be.MF([]),meta:{tableTemplate:void 0}}),vs(Ee,Le,this.layerService,this.ws$),Le.options.workspace.workspaceId=Le.id,t.options.workspace=Object.assign({},t.options.workspace,{enabled:!0,srcId:t.id,workspaceId:Le.id,queryOptions:{mapQueryOnOpenTab:t.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:t.options.workspace?.queryOptions?.tabQuery},pageSize:t.options.workspace?.pageSize,pageSizeOptions:t.options.workspace?.pageSizeOptions}),delete n.options.download,Ee}),Ee}createFeatureStore(t,i){const n=new Yt.ym([],{map:i});n.bindLayer(t);const p=new Yt._c({}),v=new Yt.IV({}),Y=new Yt.eu({map:i},this.propertyTypeDetectorService,this.capabilitiesService),ue=new Yt.CE({}),ye=new be.xx({}),Ee=this.configService.getConfig("queryOverlayStyle"),we=new Yt.kj({layer:new oo.Md({zIndex:300,source:new ve.E,style:Le=>$r(Object.assign({},{feature:Le},Ee?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:i,hitTolerance:15,motion:this.zoomAuto?Yt.Su.Default:Yt.Su.None,many:!0,dragBox:!0});return n.addStrategy(p,!0),n.addStrategy(v,!0),n.addStrategy(Y,!0),n.addStrategy(ue,!0),n.addStrategy(we,!0),n.addStrategy(ye,!1),n.addStrategy(kr(),!0),n}static \u0275fac=function(i){return new(i||l)(e.CoB(oo.IZ),e.CoB(W.yQ),e.CoB(zo.S),e.CoB(mr.U),e.CoB(A.aW),e.CoB(_s))};static \u0275prov=e.wxM({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),Zp=(()=>{class l{component;wfsWorkspaceService;wmsWorkspaceService;editionWorkspaceService;featureWorkspaceService;layers$$;entities$$=[];map;changeWorkspace=new e._w7;disableSwitch=new e._w7;relationLayers=new e._w7;rowsInMapExtentCheckCondition=new e._w7;get workspaceStore(){return this.component.store}constructor(t,i,n,p,v){this.component=t,this.wfsWorkspaceService=i,this.wmsWorkspaceService=n,this.editionWorkspaceService=p,this.featureWorkspaceService=v}ngOnInit(){this.layers$$=this.map.layers$.pipe((0,fo.o)(50)).subscribe(t=>this.onLayersChange(t)),this.featureWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.wmsWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.wfsWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.editionWorkspaceService.ws$.subscribe(t=>{this.changeWorkspace.emit(t)}),this.editionWorkspaceService.adding$.subscribe(t=>{this.disableSwitch.emit(t)}),this.editionWorkspaceService.relationLayers$.subscribe(t=>{this.relationLayers.emit(t)}),this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe(t=>{this.rowsInMapExtentCheckCondition.emit(t)})}ngOnDestroy(){this.layers$$.unsubscribe(),this.entities$$.map(t=>t.unsubscribe())}onLayersChange(t){const i=t.filter(Y=>this.layerIsEditable(Y)),n=i.map(Y=>Y.id),p=i.map(Y=>this.getOrCreateWorkspace(Y)).filter(Y=>void 0!==Y),v=this.workspaceStore.all().filter(Y=>n.indexOf(Y.id)<0);v.length>0&&(v.forEach(Y=>{Y.entityStore.deactivateStrategyOfType(Jp.I),Y.deactivate()}),this.workspaceStore.state.updateMany(v,{active:!1,selected:!1}),this.workspaceStore.deleteMany(v)),p.length>0&&this.workspaceStore.insertMany(p)}getOrCreateWorkspace(t){if(void 0===this.workspaceStore.get(t.id)){if(t.dataSource instanceof Mo.ak&&!0!==t.dataSource.options.edition?.enabled)return this.wfsWorkspaceService.createWorkspace(t,this.map);if(t.dataSource instanceof Mo.CK&&!0!==t.dataSource.options.edition?.enabled){if(!t.dataSource.options.paramsWFS)return;const n=this.wmsWorkspaceService.createWorkspace(t,this.map);return n?.inResolutionRange$.subscribe(p=>{t.dataSource.options.queryable=!p,n.layer.dataSource.options.queryable=p}),n}if(t.dataSource instanceof Mo.EB&&!0===t.exportable&&!0!==t.dataSource.options.edition?.enabled)return this.featureWorkspaceService.createWorkspace(t,this.map);if(t.dataSource instanceof Mo.CK&&!0===t.dataSource.options.edition?.enabled)return this.editionWorkspaceService.createWorkspace(t,this.map)}}layerIsEditable(t){const i=t.dataSource;return i instanceof Mo.ak||i instanceof Mo.EB||i instanceof Mo.CK&&((i.options||{}).ogcFilters?.enabled||void 0!==i.options.paramsWFS?.featureTypes)}static \u0275fac=function(i){return new(i||l)(e.GI1(be.uF),e.GI1(Kp),e.GI1(Qp),e.GI1(Xp),e.GI1(Wp))};static \u0275dir=e.Sc5({type:l,selectors:[["","igoWorkspaceSelector",""]],inputs:{map:"map"},outputs:{changeWorkspace:"changeWorkspace",disableSwitch:"disableSwitch",relationLayers:"relationLayers",rowsInMapExtentCheckCondition:"rowsInMapExtentCheckCondition"},standalone:!0})}return l})()},43168:(Fe,ce,r)=>{"use strict";r.d(ce,{Q1:()=>e,OI:()=>a,_D:()=>h,C3:()=>O,U3:()=>F,UD:()=>w,Yv:()=>W,eU:()=>T,qM:()=>b,WO:()=>G,EB:()=>L,We:()=>A,ym:()=>X,GC:()=>te,sX:()=>f,uq:()=>z});let e=(()=>class D{static PADCHAR="=";static ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";static getByte(U,M){return U.charCodeAt(M)}static getByte64(U,M){return this.ALPHA.indexOf(U.charAt(M))}static decode(U){let H,s,M=0,ie=U.length,de=[];if(U=String(U),0===ie)return U;for(U.charAt(ie-1)===this.PADCHAR&&(M=1,U.charAt(ie-2)===this.PADCHAR&&(M=2),ie-=4),H=0;H<ie;H+=4)s=this.getByte64(U,H)<<18|this.getByte64(U,H+1)<<12|this.getByte64(U,H+2)<<6|this.getByte64(U,H+3),de.push(String.fromCharCode(s>>16,s>>8&255,255&s));switch(M){case 1:s=this.getByte64(U,H)<<18|this.getByte64(U,H+1)<<12|this.getByte64(U,H+2)<<6,de.push(String.fromCharCode(s>>16,s>>8&255));break;case 2:s=this.getByte64(U,H)<<18|this.getByte64(U,H+1)<<12,de.push(String.fromCharCode(s>>16))}return de.join("")}static encode(U){let M,H,s=[],ie=(U=String(U)).length-U.length%3;if(0===U.length)return U;for(M=0;M<ie;M+=3)H=this.getByte(U,M)<<16|this.getByte(U,M+1)<<8|this.getByte(U,M+2),s.push(this.ALPHA.charAt(H>>18)),s.push(this.ALPHA.charAt(H>>12&63)),s.push(this.ALPHA.charAt(H>>6&63)),s.push(this.ALPHA.charAt(63&H));switch(U.length-ie){case 1:H=this.getByte(U,M)<<16,s.push(this.ALPHA.charAt(H>>18)+this.ALPHA.charAt(H>>12&63)+this.PADCHAR+this.PADCHAR);break;case 2:H=this.getByte(U,M)<<16|this.getByte(U,M+1)<<8,s.push(this.ALPHA.charAt(H>>18)+this.ALPHA.charAt(H>>12&63)+this.ALPHA.charAt(H>>6&63)+this.PADCHAR)}return s.join("")}})();var d=r(33712);function L(D){return D.map(g=>g instanceof d.i4?g.toString():void 0!==g?JSON.parse(JSON.stringify(g)):g)}var P=r(68916);const f=r.n(P)().getParser(window.navigator.userAgent);class h{static copy(g){let U=!1;if("string"==typeof g){const M=h.createTextArea(g);h.selectText(M),U=h.copyTextToClipboard(),h.destroyTextArea(M)}else h.selectText(g),U=h.copyTextToClipboard();return U}static createTextArea(g){const U=document.createElement("textArea");return U.value=g,document.body.appendChild(U),U}static destroyTextArea(g){document.body.removeChild(g)}static selectText(g){if("iOS"===f.getOSName()){const U=g.contentEditable,M=g.readOnly,H=document.createRange(),s=window.getSelection();g.contenteditable=!0,g.readonly=!1,H.selectNodeContents(g),s.removeAllRanges(),s.addRange(H),g.setSelectionRange(0,999999),g.contentEditable=U,g.readOnly=M}else g.select()}static copyTextToClipboard(){return("iOS"!==f.getOSName()||!f.compareVersion("<10"))&&document.execCommand("copy")}}var R=r(21296);function y(D,g,U){return D>>g&(1<<U)-1}class O{base64Index=new Map;indexBase64=new Map;constructor(){this.generateBase64Index()}generateBase64Index(){for(let g=0;g<26;g++)this.base64Index.set(String.fromCharCode(65+g),g),this.indexBase64.set(g,String.fromCharCode(65+g));for(let g=0;g<26;g++)this.base64Index.set(String.fromCharCode(97+g),g+26),this.indexBase64.set(g+26,String.fromCharCode(97+g));for(let g=0;g<10;g++)this.base64Index.set(String.fromCharCode(48+g),g+52),this.indexBase64.set(g+52,String.fromCharCode(48+g));this.base64Index.set("+",62),this.base64Index.set("/",63),this.indexBase64.set(62,"+"),this.indexBase64.set(63,"/")}compressBlob(g){return g?new R._(M=>{const H=new FileReader;H.readAsDataURL(g),H.onload=()=>{const s=H.result.valueOf(),ie=s.substr(s.indexOf(",")+1),de=this.compressStringBase64(ie);M.next({length:ie.length,type:g.type,object:de})}}):void 0}decompressBlob(g){const H=this.decompressStringBase64(g.object,g.length),s=atob(H),ie=new Array(s.length);for(let Se=0;Se<s.length;Se++)ie[Se]=s.charCodeAt(Se);const de=new Uint8Array(ie);return new Blob([de],{type:g.type})}compressStringBase64(g){let U="",M=16,H=0,s=0;for(const ie of g){const de=this.base64Index.get(ie);M>6?(M-=6,H+=de<<M):(s=6-M,H+=de>>s,U+=String.fromCharCode(H),H=de<<16-s,M=16-s)}return g.length%8!=0&&(U+=String.fromCharCode(H)),"\u2603"+U}decompressStringBase64(g,U){if(!g)return;if(9731!==g.charCodeAt(0))return g;let M=0,H=0,s=16,ie="",de=1,fe=g.charCodeAt(de);for(let Se=0;Se<U;Se++)s>6?(s-=6,M=y(fe,s,6),ie+=this.indexBase64.get(M)):(H=6-s,M=y(fe,0,s)<<H,fe=g.charCodeAt(++de),M+=y(fe,16-H,H),ie+=this.indexBase64.get(M),s=16-H);return ie}}var x=function(D){return D.ADDED="added",D.DELETED="deleted",D.MODIFIED="modified",D}(x||{});class T{static diff(g,U,M=4){if(!g&&!U)return"";if(!g)return'<span class="inserted">'+U+"</span>";if(!U)return'<span class="deleted">'+g+"</span>";g=g.toString(),U=U.toString();const H=T.getChanges(g,U,"",M),s=U.slice(H.mtc.length+H.ins.length+H.sbs.length),ie=g.slice(H.mtc.length+H.del.length+H.sbs.length);let de="";return H.del.length>0&&(H.del='<span class="deleted">'+H.del+"</span>"),H.ins.length>0&&(H.ins='<span class="inserted">'+H.ins+"</span>"),de=H.mtc+H.del+H.ins+H.sbs,de+=""!==ie||""!==s?T.diff(ie,s,M):"",de}static getMatchingSubstring(g,U,M){let H=0,s=!1;const ie=g.length,de={fis:ie,mtc:M,sbs:""};for(;H<ie;)U[H]===g[H]?s?de.sbs+=g[H]:(s=!0,de.fis=H,de.sbs=g[H]):s&&(H=ie),++H;return de}static getChanges(g,U,M,H){const s=g.length>=g.length;let[ie,de]=s?[g,U]:[U,g],fe=0;for(;de[fe]===ie[fe]&&fe<de.length;)++fe;ie=ie.split("").slice(fe),de=de.slice(fe);const Se=ie.length;let ae={fis:de.length,fil:Se,sbs:"",mtc:M+U.slice(0,fe)},le={sbs:""};if(""!==de)for(let oe=0;oe<Se&&le.sbs.length<H;oe++)le=T.getMatchingSubstring(de,T.rotateArray(ie,oe),ae.mtc),le.fil=oe<Se-le.fis?le.fis+oe:le.fis-Se+oe,le.sbs.length>ae.sbs.length&&(ae=le);return[ae.del,ae.ins]=s?[ie.slice(0,ae.fil).join(""),de.slice(0,ae.fis)]:[de.slice(0,ae.fis),ie.slice(0,ae.fil).join("")],-1===ae.del.indexOf(" ")||-1===ae.ins.indexOf(" ")||""===ae.del||""===ae.ins||""===ae.sbs?ae:T.getChanges(ae.del,ae.ins,ae.mtc,H)}static rotateArray(g,U){const M=g.length,H=new Array(g.length);if(U%M==0)return g.slice();for(let s=0;s<M;s++)H[s]=g[(s+(M+U%M))%M];return H}static isValidNumber(g){return!isNaN(Number(g))}static isOctalNumber(g){return T.isValidNumber(g)&&g.startsWith("0")&&g.length>1}}class a{static findChanges(g,U,M=[]){const H={added:[],deleted:[],modified:[]};if(!g||!U)return H;const s=[...g],ie=[...U];for(const de of s){const fe=ie.findIndex(se=>se.id===de.id);if(-1===fe){H.deleted.push({change:{type:x.DELETED},value:de});continue}const Se=ie.splice(fe,1)[0],ae=JSON.parse(JSON.stringify(de)),le=JSON.parse(JSON.stringify(Se)),oe=a.compareObject(ae,le,void 0,M);oe.length&&H.modified.push({change:{type:x.MODIFIED,keysChanged:oe},value:ae,oldValue:de,newValue:Se})}return H.added=ie.map(de=>({change:{type:x.ADDED},value:de})),H}static compareObject(g,U,M,H=[]){const s=JSON.parse(JSON.stringify(g)),ie=JSON.parse(JSON.stringify(U)),de=new Set([...Object.keys(g),...Object.keys(U)]);let fe=[];return de.forEach(Se=>{const ae=M?`${M}.${Se}`:Se;-1===H.indexOf(ae)&&(Array.isArray(g[Se])&&(g[Se]=g[Se].join(",<br>")),Array.isArray(U[Se])&&(U[Se]=U[Se].join(",<br>")),"object"==typeof g[Se]&&"object"==typeof U[Se]&&null!==g[Se]&&null!==U[Se]?fe=fe.concat(this.compareObject(g[Se],U[Se],ae)):g[Se]!==U[Se]&&(fe.push({key:ae,oldValue:s[Se],newValue:ie[Se]}),g[Se]=T.diff(g[Se],U[Se])))}),fe}}class F{static create(g,U,M){const H=g.createElement(U);for(const s in M)H[s]=M[s];return H}static remove(g){g.parentNode&&g.parentNode.removeChild(g)}}function A(D,g,U){!function k(D,g){const U=document.createElement("a");U.setAttribute("href",D),U.setAttribute("download",g),U.style.display="none",document.body.appendChild(U),U.click(),document.body.removeChild(U)}(`data:${g},${encodeURIComponent(D)}`,U)}class W{static resolve(g,U){const M=U.replace(/\[/g,".").replace(/\]/g,"").split(".");let H=g;for(;M.length;){if("object"!=typeof H)return;H=H[M.shift()]}return H}static isObject(g){return g&&"object"==typeof g&&!Array.isArray(g)&&null!==g&&!(g instanceof Date)}static mergeDeep(g,U,M=!1){const H=Object.assign({},g);return W.isObject(g)&&W.isObject(U)&&Object.keys(U).filter(s=>!M||void 0!==U[s]).forEach(s=>{W.isObject(U[s])?s in g?H[s]=W.mergeDeep(g[s],U[s],M):Object.assign(H,{[s]:U[s]}):Object.assign(H,{[s]:U[s]})}),H}static copyDeep(g){const U=Array.isArray(g)?[]:{};for(const M in g)if(g.hasOwnProperty(M)){const H=g[M];U[M]=H&&"object"==typeof H?this.copyDeep(H):H}return U}static removeDuplicateCaseInsensitive(g){const U={},M={},H=[];for(const s in g)if(g.hasOwnProperty(s)){const ie=s.toUpperCase();U.hasOwnProperty(ie)?U[ie].push({[s]:g[s]}):U[ie]=[{[s]:g[s]}],H.push({key:s,count:s.replace(/[^A-Z]/g,"").length})}for(const s in U)if(U.hasOwnProperty(s)&&U.hasOwnProperty(s)){const ie=U[s];if(1===ie.length){const de=ie[0];M[s]=de[Object.keys(de)[0]]}else if(ie.length>1){const de=H.filter(fe=>fe.key.toLowerCase()===s.toLowerCase()).reduce((fe,Se)=>fe.y<Se.y?fe:Se);M[de.key.toUpperCase()]=g[de.key]}}for(const s in g)g.hasOwnProperty(s)&&delete g[s];for(const s in M)M.hasOwnProperty(s)&&(g[s]=M[s])}static removeUndefined(g){const U={};return W.isObject(g)?(Object.keys(g).filter(M=>void 0!==g[M]).forEach(M=>{U[M]=W.isObject(g[M])||Array.isArray(g[M])?W.removeUndefined(g[M]):g[M]}),U):Array.isArray(g)?g.map(M=>W.removeUndefined(M)):g}static removeNull(g){const U={};return W.isObject(g)?(Object.keys(g).filter(M=>null!==g[M]).forEach(M=>{U[M]=W.isObject(g[M])||Array.isArray(g[M])?W.removeNull(g[M]):g[M]}),U):Array.isArray(g)?g.map(M=>W.removeNull(M)):g}static naturalCompare(g,U,M="asc",H){if("desc"===M&&(U=[g,g=U][0]),null===g||""===g||void 0===g||null===U||""===U||void 0===U){const de=g===U?0:void 0===g?3:void 0===U?-3:null===g?2:null===U?-2:""===g?1:-1;return"desc"===M?!1!==H?de:-1*de:!0===H?-1*de:de}const s=[],ie=[];for(U=""+U,(g=""+g).replace(/(\d+)|(\D+)/g,(de,fe,Se)=>{s.push([fe||1/0,Se||""])}),U.replace(/(\d+)|(\D+)/g,(de,fe,Se)=>{ie.push([fe||1/0,Se||""])});s.length&&ie.length;){const de=s.shift(),fe=ie.shift(),Se=de[0]-fe[0]||de[1].localeCompare(fe[1]);if(Se)return Se}return s.length-ie.length}static objectsAreEquivalent(g,U){if(g===U)return!0;const M=Object.getOwnPropertyNames(g),H=Object.getOwnPropertyNames(U);if(M.length!==H.length)return!1;for(const s of M)if(g[s]!==U[s])return!1;return!0}static removeKeys(g,U){return Object.keys(g).filter(H=>U.indexOf(H)<0).reduce((H,s)=>(H[s]=g[s],H),{})}static isEmpty(g){return 0===Object.keys(g).length}}class w{static roundToNDecimal(g,U=3){const M=Math.pow(10,U);return Math.round(g*M)/M}}function te(D){return D.reduce((g,U)=>(g[U]=U,g),Object.create(null))}const Z="assets/igo2/core/theming/prebuilt-themes",K="theme-styles";function X(D,g,U=Z){const M=`${U}/${g}.css`,H=D.getElementsByTagName("head")[0];let s=D.getElementById(K);s?s.href=M:function V(D,g,U){const M=F.create(D,"link",{id:K,rel:"stylesheet",href:g});U.appendChild(M)}(D,M,H)}function B(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function z(){return`${B()}${B()}-${B()}-${B()}-${B()}-${B()}${B()}${B()}`.toLowerCase()}var c=r(61616),I=r(11484),b=function(D){return D[D.Error=0]="Error",D[D.Done=1]="Done",D[D.Working=2]="Working",D[D.Waiting=3]="Waiting",D}(b||{});class G{status$=new c.E;status$$;get status(){return this._status}set status(g){this._status=g,this.status$.next(g)}_status;subscribe(g,U){this.watch(),this.status$$=this.status$.pipe((0,I.a)()).subscribe(M=>{this.handleStatusChange(M),g.call(U,this)})}unsubscribe(){this.unwatch(),void 0!==this.status$$&&(this.status$$.unsubscribe(),this.status$$=void 0),this.status=b.Waiting}handleStatusChange(g){}}},70116:(Fe,ce,r)=>{"use strict";r.r(ce),r.d(ce,{routes:()=>lt});var C=r(65056),e=r(71904),d=r(34672),L=r(50244),P=r(32328),o=r(42536),f=r(94204),h=r(34896),R=r(58752),y=r(24708),O=r(72584);function x(Me,ct){if(1&Me){const Oe=h.KQA();h.I0R(0,"button",8),h.qCj("click",function(){h.usT(Oe);const ze=h.GaO();return h.CGJ(ze.loginAnonymous())}),h.OEk(1),h.wVc(2,"translate"),h.C$Y()}2&Me&&(h.yG2(),h.oRS(" ",h.kDX(2,1,"igo.auth.accessAnonymous")," "))}function T(Me,ct){if(1&Me&&(h.I0R(0,"div"),h.wR5(1,"br"),h.I0R(2,"font",9),h.OEk(3),h.C$Y()()),2&Me){const Oe=h.GaO();h.yG2(3),h.cNF(Oe.error)}}function a(Me,ct){1&Me&&(h.I0R(0,"div",10),h.wR5(1,"mat-spinner",11),h.C$Y()),2&Me&&(h.yG2(),h.E7m("diameter",40))}let F=(()=>{class Me{auth;languageService;get allowAnonymous(){return this._allowAnonymous}set allowAnonymous(Oe){this._allowAnonymous=Oe}_allowAnonymous=!0;error="";form;loading=!1;login=new h._w7;constructor(Oe,He,ze){this.auth=Oe,this.languageService=He,this.form=ze.group({username:["",e.AQ.required],password:["",e.AQ.required]})}loginUser(Oe){return this.loading=!0,this.auth.login(Oe.username,Oe.password).subscribe(()=>{this.login.emit(!0),this.loading=!1},He=>{try{this.languageService.translate.get("igo.auth.error."+He.error.message).subscribe(ze=>this.error=ze)}catch{this.error=He.error.message}this.loading=!1}),!1}loginAnonymous(){this.auth.loginAnonymous().subscribe(()=>{this.login.emit(!0)})}static \u0275fac=function(He){return new(He||Me)(h.GI1(R.oj),h.GI1(y.ov),h.GI1(e.KE))};static \u0275cmp=h.In1({type:Me,selectors:[["igo-auth-intern"]],inputs:{allowAnonymous:"allowAnonymous"},outputs:{login:"login"},standalone:!0,features:[h.UHJ],decls:21,vars:19,consts:[["role","form",3,"formGroup","ngSubmit"],[1,"full-width"],["matInput","","required","","formControlName","username",3,"placeholder"],["matInput","","required","","type","password","formControlName","password",3,"placeholder"],["mat-raised-button","","type","submit"],["mat-raised-button","","class","anonymous","type","button",3,"click",4,"ngIf"],[4,"ngIf"],["class","loading-container",4,"ngIf"],["mat-raised-button","","type","button",1,"anonymous",3,"click"],["size","3","color","red"],[1,"loading-container"],[3,"diameter"]],template:function(He,ze){1&He&&(h.I0R(0,"form",0),h.qCj("ngSubmit",function(){return ze.loginUser(ze.form.value)}),h.I0R(1,"div")(2,"mat-form-field",1)(3,"mat-label"),h.OEk(4),h.wVc(5,"translate"),h.C$Y(),h.wR5(6,"input",2),h.wVc(7,"translate"),h.C$Y()(),h.I0R(8,"div")(9,"mat-form-field",1)(10,"mat-label"),h.OEk(11),h.wVc(12,"translate"),h.C$Y(),h.wR5(13,"input",3),h.wVc(14,"translate"),h.C$Y()(),h.I0R(15,"button",4),h.OEk(16),h.wVc(17,"translate"),h.C$Y(),h.yuY(18,x,3,3,"button",5)(19,T,4,1,"div",6),h.C$Y(),h.yuY(20,a,2,1,"div",7)),2&He&&(h.E7m("formGroup",ze.form),h.yG2(4),h.cNF(h.kDX(5,9,"igo.auth.user")),h.yG2(2),h._6D("placeholder",h.kDX(7,11,"igo.auth.user")),h.yG2(5),h.cNF(h.kDX(12,13,"igo.auth.password")),h.yG2(2),h._6D("placeholder",h.kDX(14,15,"igo.auth.password")),h.yG2(3),h.oRS(" ",h.kDX(17,17,"igo.auth.login")," "),h.yG2(2),h.E7m("ngIf",ze.allowAnonymous),h.yG2(),h.E7m("ngIf",ze.error),h.yG2(),h.E7m("ngIf",ze.loading))},dependencies:[e.y,e.sz,e.ot,e.ue,e.u,e.eJ,e.sl,e.uW,e.Wo,L.wb,L.Up,L.w5,o.cN,o.yi,d.oJ,d.Gw,f.cm,C.u_,y._s,O.sD],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.anonymous[_ngcontent-%COMP%]{margin-left:10px}.loading-container[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:1000;top:0;left:0;padding:24px;box-sizing:border-box}"]})}return Me})();var A=r(9204),k=r(35392),W=r(53e3),w=r(38460),te=r(28452),Z=r(85696),K=r(98988),X=r(61616),V=r(6560),B=r(94364);let z=(()=>{class Me{authService;config;appRef;msalService;msalGuardConfig;options;_destroying$=new X.E;login=new h._w7;broadcastService;svgIcon=W.Ue;constructor(Oe,He,ze,Rt,Ft){this.authService=Oe,this.config=He,this.appRef=ze,this.msalService=Rt,this.msalGuardConfig=Ft,this.options=this.config.getConfig("auth.microsoft"),this.msalService.instance=new te.u({auth:this.options,cache:{cacheLocation:"sessionStorage"}}),this.broadcastService=new w.K2(this.msalService.instance,this.msalService),this.options?.clientId?this.broadcastService.inProgress$.pipe((0,V.I)(Et=>Et===Z.Yz.None),(0,B.a)(this._destroying$)).subscribe(()=>{this.checkAccount()}):console.warn('Microsoft authentification needs "clientId" option')}loginMicrosoft(){this.msalService.loginPopup({...this.getConf().authRequest}).subscribe(Oe=>{this.msalService.instance.setActiveAccount(Oe.account),this.checkAccount()})}checkAccount(){var Oe=this;this.msalService.instance.acquireTokenSilent(this.getConf().authRequest).then(He=>{this.authService.loginWithToken(He.accessToken,"microsoft",{tokenId:He.idToken}).subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}).catch(function(){var He=(0,k.c)(function*(ze){if(ze instanceof K.uw)return Oe.msalService.acquireTokenPopup(Oe.getConf().authRequest);console.log(ze)});return function(ze){return He.apply(this,arguments)}}()).catch(He=>{console.log("Silent token fails")})}getConf(){return this.msalGuardConfig.filter(Oe=>"add"===Oe.type)[0]}static \u0275fac=function(He){return new(He||Me)(h.GI1(R.oj),h.GI1(A.aW),h.GI1(h.Swk),h.GI1(w.xX),h.GI1(w.mg))};static \u0275cmp=h.In1({type:Me,selectors:[["igo-auth-microsoft"]],outputs:{login:"login"},standalone:!0,features:[h.UHJ],decls:4,vars:4,consts:[["mat-raised-button","",1,"microsoft-login-button",3,"click"],[3,"icon"]],template:function(He,ze){1&He&&(h.I0R(0,"button",0),h.qCj("click",function(){return ze.loginMicrosoft()}),h.wR5(1,"igo-icon",1),h.OEk(2),h.wVc(3,"translate"),h.C$Y()),2&He&&(h.yG2(),h.E7m("icon",ze.svgIcon),h.yG2(),h.oRS(" ",h.kDX(3,2,"igo.auth.microsoft.login"),"\n"))},dependencies:[d.oJ,d.Gw,y._s,O.sD,W.S],styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-15px}[_nghost-%COMP%] > button[_ngcontent-%COMP%]{font-size:15px;height:40px;width:265px}mat-icon[_ngcontent-%COMP%]{margin-right:10px}"],changeDetection:0})}return Me})();var c=r(31752),I=r(54844),b=r(7080);let G=(()=>{class Me{instance;location;redirectHash;logger;name="@azure/msal-angular";version="2.0.0-beta.2";constructor(Oe,He){this.instance=Oe,this.location=He;const ze=this.location.path(!0).split("#").pop();ze&&(this.redirectHash=`#${ze}`),this.instance.initializeWrapperLibrary(Z.Lm.Angular,this.version)}initialize(){return(0,b.Q)(this.instance.initialize())}acquireTokenPopup(Oe){return(0,b.Q)(this.instance.acquireTokenPopup(Oe))}acquireTokenRedirect(Oe){return(0,b.Q)(this.instance.acquireTokenRedirect(Oe))}acquireTokenSilent(Oe){return(0,b.Q)(this.instance.acquireTokenSilent(Oe))}handleRedirectObservable(Oe){return(0,b.Q)(this.instance.handleRedirectPromise(Oe||this.redirectHash))}loginPopup(Oe){return(0,b.Q)(this.instance.loginPopup(Oe))}loginRedirect(Oe){return(0,b.Q)(this.instance.loginRedirect(Oe))}logout(Oe){return(0,b.Q)(this.instance.logout(Oe))}logoutRedirect(Oe){return(0,b.Q)(this.instance.logoutRedirect(Oe))}logoutPopup(Oe){return(0,b.Q)(this.instance.logoutPopup(Oe))}ssoSilent(Oe){return(0,b.Q)(this.instance.ssoSilent(Oe))}getLogger(){return this.logger||(this.logger=this.instance.getLogger().clone(this.name,this.version)),this.logger}setLogger(Oe){this.logger=Oe.clone(this.name,this.version),this.instance.setLogger(Oe)}static \u0275fac=function(He){return new(He||Me)(h.CoB(w.IN),h.CoB(C.oB))};static \u0275prov=h.wxM({token:Me,factory:Me.\u0275fac})}return Me})(),D=(()=>{class Me{msalInstance;authService;_msalSubject;msalSubject$;_inProgress;inProgress$;constructor(Oe,He){this.msalInstance=Oe,this.authService=He,this._msalSubject=new X.E,this.msalSubject$=this._msalSubject.asObservable(),this._inProgress=new I.g(Z.Yz.Startup),this.inProgress$=this._inProgress.asObservable(),this.msalInstance.addEventCallback(ze=>{this._msalSubject.next(ze);const Rt=c.M.getInteractionStatusFromEvent(ze);null!==Rt&&(this.authService.getLogger().verbose(`BroadcastService - ${ze.eventType} results in setting inProgress to ${Rt}`),this._inProgress.next(Rt))})}static \u0275fac=function(He){return new(He||Me)(h.CoB(w.IN),h.CoB(G))};static \u0275prov=h.wxM({token:Me,factory:Me.\u0275fac})}return Me})(),g=(()=>{class Me{authService;config;appRef;msalService;msalGuardConfig;options;_destroying$=new X.E;login=new h._w7;broadcastService;svgIcon=W.Ue;constructor(Oe,He,ze,Rt,Ft){this.authService=Oe,this.config=He,this.appRef=ze,this.msalService=Rt,this.msalGuardConfig=Ft,this.options=this.config.getConfig("auth.microsoftb2c")||{},this.msalService.instance=new te.u({auth:this.options.browserAuthOptions,cache:{cacheLocation:"sessionStorage"}}),this.broadcastService=new D(this.msalService.instance,this.msalService),this.options.browserAuthOptions.clientId?this.broadcastService.inProgress$.pipe((0,V.I)(Et=>Et===Z.Yz.None),(0,B.a)(this._destroying$)).subscribe(()=>{this.checkAccount()}):console.warn('Microsoft authentification needs "clientId" option')}loginMicrosoftb2c(){this.msalService.loginPopup({...this.getConf().authRequest}).subscribe(Oe=>{this.msalService.instance.setActiveAccount(Oe.account),this.checkAccount()})}checkAccount(){var Oe=this;this.msalService.instance.acquireTokenSilent(this.getConf().authRequest).then(He=>{this.authService.loginWithToken(He.idToken,"microsoftb2c").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}).catch(function(){var He=(0,k.c)(function*(ze){if(ze instanceof K.uw)return Oe.msalService.acquireTokenPopup(Oe.getConf().authRequest)});return function(ze){return He.apply(this,arguments)}}()).catch(He=>{console.log("Silent token fails")})}getConf(){return this.msalGuardConfig.filter(Oe=>"b2c"===Oe.type)[0]}static \u0275fac=function(He){return new(He||Me)(h.GI1(R.oj),h.GI1(A.aW),h.GI1(h.Swk),h.GI1(G),h.GI1(w.mg))};static \u0275cmp=h.In1({type:Me,selectors:[["igo-auth-microsoftb2c"]],outputs:{login:"login"},standalone:!0,features:[h.M5G([G]),h.UHJ],decls:4,vars:4,consts:[["mat-raised-button","",1,"microsoft-login-button",3,"click"],[3,"icon"]],template:function(He,ze){1&He&&(h.I0R(0,"button",0),h.qCj("click",function(){return ze.loginMicrosoftb2c()}),h.wR5(1,"igo-icon",1),h.OEk(2),h.wVc(3,"translate"),h.C$Y()),2&He&&(h.yG2(),h.E7m("icon",ze.svgIcon),h.yG2(),h.oRS(" ",h.kDX(3,2,"igo.auth.microsoftb2c.login"),"\n"))},dependencies:[d.oJ,d.Gw,y._s,O.sD,W.S],styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-15px}[_nghost-%COMP%] > button[_ngcontent-%COMP%]{font-size:15px;height:40px;width:265px}mat-icon[_ngcontent-%COMP%]{margin-right:10px}"],changeDetection:0})}return Me})();var fe=r(57880);let Se=(()=>{class Me{authService;config;appRef;options;login=new h._w7;constructor(Oe,He,ze){this.authService=Oe,this.config=He,this.appRef=ze,this.options=this.config.getConfig("auth.facebook"),this.options?.appId?this.loadSDKFacebook():console.warn('Facebook authentification needs "appId" option')}subscribeEvents(){window.FB.Event.subscribe("auth.statusChange",Oe=>{this.statusChangeCallback(Oe)})}statusChangeCallback(Oe){"connected"===Oe.status&&this.loginFacebook(Oe.authResponse.accessToken)}loginFacebook(Oe){this.authService.loginWithToken(Oe,"facebook").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}loadSDKFacebook(){if(document.getElementById("facebook-jssdk"))return;const He=document.getElementsByTagName("script")[0],ze=document.createElement("script");ze.id="facebook-jssdk",ze.src=`https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9&appId=${this.options?.appId}`,ze.onload=()=>{this.subscribeEvents()},He.parentNode.insertBefore(ze,He)}static \u0275fac=function(He){return new(He||Me)(h.GI1(R.oj),h.GI1(A.aW),h.GI1(h.Swk))};static \u0275cmp=h.In1({type:Me,selectors:[["igo-auth-facebook"]],outputs:{login:"login"},standalone:!0,features:[h.UHJ],decls:1,vars:0,consts:[["scope","public_profile,email","data-max-rows","1","data-size","large","data-button-type","login_with","data-show-faces","false","data-auto-logout-link","false","data-use-continue-as","false",1,"fb-login-button"]],template:function(He,ze){1&He&&h.wR5(0,"div",0)},styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block;position:relative;top:-3px}"],changeDetection:0})}return Me})(),ae=(()=>{class Me{authService;config;languageService;appRef;options;login=new h._w7;constructor(Oe,He,ze,Rt){this.authService=Oe,this.config=He,this.languageService=ze,this.appRef=Rt,this.options=this.config.getConfig("auth.google"),this.options?.apiKey&&this.options?.clientId?(this.loadSDKGoogle(),this.loadPlatform()):console.warn('Google authentification needs "apiKey" and "clientId" options')}handleSignInClick(){window.gapi.auth2.getAuthInstance().signIn()}handleSignOutClick(){window.gapi.auth2.getAuthInstance().signOut()}handleClientLoad(){window.gapi.load("client:auth2",()=>this.initClient())}initClient(){window.gapi.client.init({apiKey:this.options?.apiKey,clientId:this.options?.clientId,discoveryDocs:["https://people.googleapis.com/$discovery/rest?version=v1"],scope:"profile"}).then(()=>{this.handleSignOutClick(),this.updateTextButton(),window.gapi.auth2.getAuthInstance().isSignedIn.listen(Oe=>{this.updateSigninStatus(Oe)})})}updateSigninStatus(Oe){this.updateTextButton(),Oe&&this.loginGoogle(window.gapi.client.getToken().access_token)}updateTextButton(){const Oe=document.querySelector('span[id^="not_signed_"]');Oe&&"en"!==this.languageService.getLanguage()&&("Sign in with Google"===Oe.innerHTML?Oe.innerHTML=this.languageService.translate.instant("igo.auth.google.login"):"Signed in with Google"===Oe.innerHTML&&(Oe.innerHTML=this.languageService.translate.instant("igo.auth.google.logged")))}loginGoogle(Oe){this.authService.loginWithToken(Oe,"google").subscribe(()=>{this.appRef.tick(),this.login.emit(!0)})}loadSDKGoogle(){const Oe=document.getElementsByTagName("script")[0],He=document.createElement("script");He.id="google-jssdk",He.src="https://apis.google.com/js/api.js",He.onload=()=>{this.handleClientLoad()},Oe.parentNode.insertBefore(He,Oe)}loadPlatform(){const Oe=document.getElementsByTagName("script")[0],He=document.createElement("script");He.id="google-platform",He.src="https://apis.google.com/js/platform.js",Oe.parentNode.insertBefore(He,Oe)}static \u0275fac=function(He){return new(He||Me)(h.GI1(R.oj),h.GI1(A.aW),h.GI1(y.ov),h.GI1(h.Swk))};static \u0275cmp=h.In1({type:Me,selectors:[["igo-auth-google"]],outputs:{login:"login"},standalone:!0,features:[h.UHJ],decls:1,vars:0,consts:[["data-height","40","data-width","265","data-longtitle","true",1,"g-signin2","google-login-button"]],template:function(He,ze){1&He&&h.wR5(0,"div",0)},styles:["[_nghost-%COMP%]{padding:10px 10px 10px 0;display:inline-block}.google-login-button[_ngcontent-%COMP%]     .abcRioButton{color:#000000de}"],changeDetection:0})}return Me})();function le(Me,ct){1&Me&&h.wR5(0,"div",3)}function oe(Me,ct){if(1&Me){const Oe=h.KQA();h.I0R(0,"igo-auth-google",7),h.qCj("login",function(){h.usT(Oe);const ze=h.GaO(3);return h.CGJ(ze.onLogin())}),h.C$Y()}}function se(Me,ct){if(1&Me){const Oe=h.KQA();h.I0R(0,"igo-auth-microsoft",7),h.qCj("login",function(){h.usT(Oe);const ze=h.GaO(3);return h.CGJ(ze.onLogin())}),h.C$Y()}}function me(Me,ct){if(1&Me){const Oe=h.KQA();h.I0R(0,"igo-auth-microsoftb2c",7),h.qCj("login",function(){h.usT(Oe);const ze=h.GaO(3);return h.CGJ(ze.onLogin())}),h.C$Y()}}function be(Me,ct){if(1&Me){const Oe=h.KQA();h.I0R(0,"igo-auth-facebook",7),h.qCj("login",function(){h.usT(Oe);const ze=h.GaO(3);return h.CGJ(ze.onLogin())}),h.C$Y()}}function ke(Me,ct){if(1&Me){const Oe=h.KQA();h.I0R(0,"igo-auth-intern",8),h.qCj("login",function(){h.usT(Oe);const ze=h.GaO(3);return h.CGJ(ze.onLogin())}),h.C$Y()}if(2&Me){const Oe=h.GaO(3);h.E7m("allowAnonymous",Oe.options.allowAnonymous)}}function qe(Me,ct){if(1&Me&&(h.I0R(0,"div",4)(1,"h1"),h.OEk(2),h.wVc(3,"translate"),h.C$Y(),h.yuY(4,oe,1,0,"igo-auth-google",5)(5,se,1,0,"igo-auth-microsoft",5)(6,me,1,0,"igo-auth-microsoftb2c",5)(7,be,1,0,"igo-auth-facebook",5)(8,ke,1,1,"igo-auth-intern",6),h.C$Y()),2&Me){const Oe=h.GaO(2);h.yG2(2),h.cNF(h.kDX(3,6,"igo.auth.connection")),h.yG2(2),h.E7m("ngIf",Oe.options.google&&!1!==Oe.options.google.enabled),h.yG2(),h.E7m("ngIf",Oe.options.microsoft&&!1!==Oe.options.microsoft.enabled),h.yG2(),h.E7m("ngIf",Oe.options.microsoftb2c&&!1!==Oe.options.microsoftb2c.enabled),h.yG2(),h.E7m("ngIf",Oe.options.facebook&&!1!==Oe.options.facebook.enabled),h.yG2(),h.E7m("ngIf",!Oe.options.intern||!1!==Oe.options.intern.enabled)}}function nt(Me,ct){if(1&Me){const Oe=h.KQA();h.I0R(0,"div",4)(1,"p"),h.OEk(2),h.wVc(3,"translate"),h.C$Y(),h.I0R(4,"button",9),h.qCj("click",function(){h.usT(Oe);const ze=h.GaO(2);return h.CGJ(ze.logout())}),h.OEk(5),h.wVc(6,"translate"),h.C$Y()()}if(2&Me){const Oe=h.GaO(2);h.yG2(2),h.cNF(h.g7$(3,2,"igo.auth.welcome",Oe.user)),h.yG2(3),h.oRS(" ",h.kDX(6,5,"igo.auth.signOut")," ")}}function Ue(Me,ct){if(1&Me){const Oe=h.KQA();h.I0R(0,"button",9),h.qCj("click",function(){h.usT(Oe);const ze=h.GaO(3);return h.CGJ(ze.home())}),h.OEk(1),h.wVc(2,"translate"),h.C$Y()}2&Me&&(h.yG2(),h.oRS(" ",h.kDX(2,1,"igo.auth.home")," "))}function St(Me,ct){if(1&Me&&(h.I0R(0,"div",4)(1,"p"),h.OEk(2),h.wVc(3,"translate"),h.C$Y(),h.yuY(4,Ue,3,3,"button",10),h.C$Y()),2&Me){const Oe=h.GaO(2);h.yG2(2),h.cNF(h.kDX(3,2,"igo.auth.deconnection")),h.yG2(2),h.E7m("ngIf",Oe.options.homeRoute)}}function Ae(Me,ct){if(1&Me&&(h.I0R(0,"div"),h.yuY(1,le,1,0,"div",1)(2,qe,9,8,"div",2)(3,nt,7,7,"div",2)(4,St,5,4,"div",2),h.C$Y()),2&Me){const Oe=h.GaO();h.yG2(),h.E7m("ngIf",!Oe.auth.logged&&Oe.backgroundDisable),h.yG2(),h.E7m("ngIf",!Oe.auth.logged&&Oe.showLoginDiv),h.yG2(),h.E7m("ngIf",Oe.auth.logged&&Oe.showAlreadyConnectedDiv),h.yG2(),h.E7m("ngIf",Oe.showLogoutDiv)}}let Qe=(()=>{class Me{auth;config;router;get backgroundDisable(){return!this.isLogoutRoute&&!this.isLogoutRoute&&this._backgroundDisable}set backgroundDisable(Oe){this._backgroundDisable="true"===Oe.toString()}_backgroundDisable=!0;get hasAlreadyConnectedDiv(){return this._hasAlreadyConnectedDiv}set hasAlreadyConnectedDiv(Oe){this._hasAlreadyConnectedDiv="true"===Oe.toString()}_hasAlreadyConnectedDiv=!0;get hasLogoutDiv(){return this._hasLogoutDiv}set hasLogoutDiv(Oe){this._hasLogoutDiv="true"===Oe.toString()}_hasLogoutDiv=!0;get showAlreadyConnectedDiv(){return this.isLogoutRoute?this.hasAlreadyConnectedDiv:this._showAlreadyConnectedDiv}set showAlreadyConnectedDiv(Oe){this._showAlreadyConnectedDiv="true"===Oe.toString()}_showAlreadyConnectedDiv=!1;get showLogoutDiv(){return this.isLogoutRoute?this.hasLogoutDiv:this._showLogoutDiv}set showLogoutDiv(Oe){this._showLogoutDiv="true"===Oe.toString()}_showLogoutDiv=!1;get showLoginDiv(){if(!this.isLogoutRoute)return!0}login=new h._w7;options;user;visible=!0;isLogoutRoute;constructor(Oe,He,ze){this.auth=Oe,this.config=He,this.router=ze,this.options=this.config.getConfig("auth"),this.visible=0!==Object.getOwnPropertyNames(this.options).length}ngOnInit(){this.analyzeRoute(),this.getName()}onLogin(){this.auth.goToRedirectUrl(),this.getName(),this.login.emit(!0)}logout(){this.auth.logout().subscribe(()=>{this.user=void 0,this.router&&(this.options?.logoutRoute?this.router.navigate([this.options?.logoutRoute]):this.options?.homeRoute&&this.router.navigate([this.options?.homeRoute]))})}home(){this.router&&this.options?.homeRoute&&this.router.navigate([this.options?.homeRoute])}getName(){const Oe=this.auth.decodeToken();Oe&&(this.user={name:Oe.user.firstName||Oe.user.sourceId})}analyzeRoute(){this.router&&this.router.events.pipe((0,V.I)(Oe=>Oe instanceof fe.Qx)).subscribe(Oe=>{if(Oe.url){const He=Oe.url,ze=this.options?.logoutRoute;this.isLogoutRoute=He===ze,this.isLogoutRoute&&this.auth.logout()}})}static \u0275fac=function(He){return new(He||Me)(h.GI1(R.oj),h.GI1(A.aW),h.GI1(fe.E5,8))};static \u0275cmp=h.In1({type:Me,selectors:[["igo-auth-form"]],inputs:{backgroundDisable:"backgroundDisable",hasAlreadyConnectedDiv:"hasAlreadyConnectedDiv",hasLogoutDiv:"hasLogoutDiv",showAlreadyConnectedDiv:"showAlreadyConnectedDiv",showLogoutDiv:"showLogoutDiv"},outputs:{login:"login"},standalone:!0,features:[h.UHJ],decls:1,vars:1,consts:[[4,"ngIf"],["class","backgroundDisable",4,"ngIf"],["class","login center-block",4,"ngIf"],[1,"backgroundDisable"],[1,"login","center-block"],[3,"login",4,"ngIf"],[3,"allowAnonymous","login",4,"ngIf"],[3,"login"],[3,"allowAnonymous","login"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button",3,"click",4,"ngIf"]],template:function(He,ze){1&He&&h.yuY(0,Ae,5,4,"div",0),2&He&&h.E7m("ngIf",ze.visible)},dependencies:[C.u_,ae,z,g,Se,F,d.oJ,d.Gw,y._s,O.sD],styles:["[_nghost-%COMP%]{z-index:999}div.login[_ngcontent-%COMP%]{z-index:200;width:90%;min-width:360px;max-width:600px;padding:25px 50px;border:1px solid;background-color:#fff;border-color:#888}.center-block[_ngcontent-%COMP%]{position:fixed;top:20%;left:50%;transform:translate(-50%)}.backgroundDisable[_ngcontent-%COMP%]{position:fixed;top:0;left:0;background:#000;opacity:.8;z-index:100;height:100%;width:100%}"]})}return Me})(),_e=(()=>{class Me{static \u0275fac=function(He){return new(He||Me)};static \u0275mod=h.a4G({type:Me});static \u0275inj=h.s3X({imports:[C.MD,e.sl,L.wb,o.cN,P.oB,f.kB,d.oJ,y._s,w.IL,Qe,F,z,g]})}return Me})();var Ie=r(32688),je=r(51100);const Ve=()=>["ConfigService","LanguageService"],lt=[{path:"",redirectTo:"form",pathMatch:"full"},{title:"Authentification",path:"form",component:(()=>{class Me{constructor(){}static \u0275fac=function(He){return new(He||Me)};static \u0275cmp=h.In1({type:Me,selectors:[["app-auth-form"]],standalone:!0,features:[h.UHJ],decls:4,vars:2,consts:[["title","Authentification","subtitle","Auth",3,"dependencies"],["codeFolder","auth/auth-form","configFolder","environments"]],template:function(He,ze){1&He&&(h.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1),h.OEk(2," The dialog opens automatically if you are not logged in "),h.C$Y()(),h.wR5(3,"igo-auth-form")),2&He&&h.E7m("dependencies",h.q4q(1,Ve))},dependencies:[Ie.u,je.I,_e,Qe],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return Me})()}]},17312:(Fe,ce,r)=>{"use strict";r.r(ce),r.d(ce,{routes:()=>Se});var C=r(53e3),e=r(9588),d=r(54844),L=r(32688),P=r(51100),o=r(34896),f=r(23416);let h=(()=>{class ae{overlay;mediaService;store=new C.MF([]);added$=new d.g(!1);get actionbarMode(){return this.mediaService.media$.value===e.oZ.Desktop&&this.mediaService.orientation$.value===e.cz.Landscape?C.m0.Dock:C.m0.Overlay}constructor(oe,se){this.overlay=oe,this.mediaService=se}ngOnInit(){this.store.load([{id:"add",title:"Add",icon:"add",tooltip:"Add Tooltip",handler:()=>{alert("Add!"),this.added$.next(!0)}},{id:"edit",title:"Edit",icon:"edit",tooltip:"Edit Tooltip",args:["1"],handler:oe=>{alert(`Edit item ${oe}!`)},availability:()=>this.added$},{id:"delete",title:"Delete",tooltip:"Delete Tooltip",icon:"delete",handler:()=>{alert("Delete!"),this.added$.next(!1)},availability:()=>this.added$}])}ngOnDestroy(){this.store.destroy()}static \u0275fac=function(se){return new(se||ae)(o.GI1(f.mc),o.GI1(e.QB))};static \u0275cmp=o.In1({type:ae,selectors:[["app-action"]],standalone:!0,features:[o.UHJ],decls:3,vars:5,consts:[["title","Action","subtitle","Common"],["title","Action Bar","codeFolder","common/action"],[3,"store","withIcon","withTitle","horizontal","mode"]],template:function(se,me){1&se&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1),o.wR5(2,"igo-actionbar",2),o.C$Y()()),2&se&&(o.yG2(2),o.E7m("store",me.store)("withIcon",!0)("withTitle","overlay"===me.actionbarMode)("horizontal",!0)("mode",me.actionbarMode))},dependencies:[L.u,P.I,C.AI],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return ae})();var R=r(71904),y=r(34672),O=r(75180),x=r(64080);let T=(()=>{class ae{confirmDialogService;selectValueDialogService;jsonDialogService;formDialogService;constructor(oe,se,me,be){this.confirmDialogService=oe,this.selectValueDialogService=se,this.jsonDialogService=me,this.formDialogService=be}confirm(){this.confirmDialogService.open("Do you want to continue?").subscribe(oe=>{alert(`Your choice is: ${oe}`)})}yesno(){this.confirmDialogService.open("Is the sky blue today? ",{modeYesNo:!0}).subscribe(oe=>{alert(`Your choice is: ${oe}`)})}select(oe){this.selectValueDialogService.open([{value:"1",title:"Chocolate"},{value:"2",title:"Candy"},{value:3,title:"Cake"}],{type:oe}).subscribe(me=>{me?.choices&&(me.choices.length>1?alert(`Your choice(s) are: ${me.choices}`):alert(`Your choice is: ${me.choices}`))})}check(){this.select(x.H.Checkbox)}radio(){this.select(x.H.Radio)}json(){this.jsonDialogService.open("A JSON viewer",{isbn:"123-456-222",author:{lastname:"Doe",firstname:"Jane"},editor:{lastname:"Smith",firstname:"Jane"},title:"The Ultimate Database Study Guide",category:["Non-Fiction","Technology"]},["category"])}form(){this.formDialogService.open({formFieldConfigs:[{name:"country",title:"Country",options:{cols:1}}],formGroupsConfigs:[{name:"country",formFieldConfigs:[{name:"city",title:"City",options:{cols:1}}]},{name:"city",formFieldConfigs:[{name:"id",title:"ID",options:{cols:1,validator:R.AQ.required}},{name:"name",title:"Name",options:{cols:1,validator:R.AQ.required}},{name:"status",title:"Status",type:"select",options:{cols:2},inputs:{choices:[{value:1,title:"Single"},{value:2,title:"Married"}]}}]}]},{minWidth:"50vh"}).subscribe(ke=>{ke&&alert(JSON.stringify(ke))})}email(){const oe=[{name:"email",title:"Email",options:{cols:2,validator:R.AQ.compose([R.AQ.required,R.AQ.email])}},{name:"password",title:"Password",options:{cols:2,validator:R.AQ.required},inputs:{isPassword:!0}}];this.formDialogService.open({formFieldConfigs:oe}).subscribe(se=>{se&&(se.password="\xb0\xb0\xb0\xb0\xb0\xb0\xb0\xb0\xb0\xb0",alert(JSON.stringify(se)))})}static \u0275fac=function(se){return new(se||ae)(o.GI1(C.Ex),o.GI1(C.hj),o.GI1(C.gl),o.GI1(C.AB))};static \u0275cmp=o.In1({type:ae,selectors:[["app-dialog"]],standalone:!0,features:[o.UHJ],decls:35,vars:0,consts:[["title","Various dialogs","subtitle","Common"],["codeFolder","common/dialog"],[1,"example-label"],[1,"example-button-row"],["mat-flat-button","","type","button","color","primary",3,"click"]],template:function(se,me){1&se&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"section")(3,"div",2),o.OEk(4,"Confirmation"),o.C$Y(),o.I0R(5,"div",3)(6,"button",4),o.qCj("click",function(){return me.confirm()}),o.OEk(7," Base dialog "),o.C$Y(),o.I0R(8,"button",4),o.qCj("click",function(){return me.yesno()}),o.OEk(9," Yes/no confirm dialog "),o.C$Y()()(),o.wR5(10,"mat-divider"),o.I0R(11,"section")(12,"div",2),o.OEk(13,"Custom selectors"),o.C$Y(),o.I0R(14,"div",3)(15,"button",4),o.qCj("click",function(){return me.check()}),o.OEk(16," Open a dialog to select values by checkboxes "),o.C$Y(),o.I0R(17,"button",4),o.qCj("click",function(){return me.radio()}),o.OEk(18," Open a dialog to select values by radio buttons "),o.C$Y()()(),o.wR5(19,"mat-divider"),o.I0R(20,"section")(21,"div",2),o.OEk(22,"Form based"),o.C$Y(),o.I0R(23,"div",3)(24,"button",4),o.qCj("click",function(){return me.form()}),o.OEk(25," Basic form "),o.C$Y(),o.I0R(26,"button",4),o.qCj("click",function(){return me.email()}),o.OEk(27," Email "),o.C$Y()()(),o.wR5(28,"mat-divider"),o.I0R(29,"section")(30,"div",2),o.OEk(31,"Renderer"),o.C$Y(),o.I0R(32,"div",3)(33,"button",4),o.qCj("click",function(){return me.json()}),o.OEk(34," Open a dialog to open a json "),o.C$Y()()()()())},dependencies:[L.u,P.I,C.uK,C.Gq,C.OE,C.YN,y.oJ,y.Gw,O.U,O.k],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}.example-label[_ngcontent-%COMP%]{display:table-cell;font-size:14px;margin-left:8px;min-width:120px}.example-button-row[_ngcontent-%COMP%]{display:table-cell;max-width:600px}.example-button-row[_ngcontent-%COMP%]   .mat-mdc-button-base[_ngcontent-%COMP%]{margin:8px 8px 8px 0}"]})}return ae})(),a=(()=>{class ae{cdRef;name;constructor(oe){this.cdRef=oe}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(se){return new(se||ae)(o.GI1(o.kD9))};static \u0275cmp=o.In1({type:ae,selectors:[["app-salutation-component"]],inputs:{name:"name"},standalone:!0,features:[o.UHJ],decls:2,vars:1,template:function(se,me){1&se&&(o.I0R(0,"p"),o.OEk(1),o.C$Y()),2&se&&(o.yG2(),o.oRS("Hello, my name is ",me.name,"."))},encapsulation:2,changeDetection:0})}return ae})(),F=(()=>{class ae{cdRef;constructor(oe){this.cdRef=oe}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(se){return new(se||ae)(o.GI1(o.kD9))};static \u0275cmp=o.In1({type:ae,selectors:[["app-explanation-component"]],standalone:!0,features:[o.UHJ],decls:2,vars:0,template:function(se,me){1&se&&(o.I0R(0,"p"),o.OEk(1,"I am a dynamic component, rendered into an IgoDynamicOutlet."),o.C$Y())},encapsulation:2,changeDetection:0})}return ae})(),A=(()=>{class ae{component=a;inputs={name:"Bob"};toggleComponent(){this.component=this.component===a?F:a}static \u0275fac=function(se){return new(se||ae)};static \u0275cmp=o.In1({type:ae,selectors:[["app-dynamic-component"]],standalone:!0,features:[o.UHJ],decls:5,vars:2,consts:[["title","Dynamic Component","subtitle","Common"],["codeFolder","common/dynamic-component"],[3,"component","inputs"],["mat-flat-button","","color","primary",3,"click"]],template:function(se,me){1&se&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1),o.wR5(2,"igo-dynamic-outlet",2),o.I0R(3,"button",3),o.qCj("click",function(){return me.toggleComponent()}),o.OEk(4," Toggle Component "),o.C$Y()()()),2&se&&(o.yG2(2),o.E7m("component",me.component)("inputs",me.inputs))},dependencies:[L.u,P.I,C.qm,y.oJ,y.Gw],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return ae})();var k=r(65056);function W(ae,le){if(1&ae&&(o.I0R(0,"div")(1,"p"),o.OEk(2),o.wVc(3,"async"),o.C$Y(),o.I0R(4,"p"),o.OEk(5),o.wVc(6,"async"),o.C$Y(),o.I0R(7,"p"),o.OEk(8,"Description: "),o.wR5(9,"span",4),o.wVc(10,"async"),o.C$Y()()),2&ae){const oe=o.GaO();o.yG2(2),o.oRS("ID: ",o.kDX(3,3,oe.selectedEntity$).id,""),o.yG2(3),o.oRS("Name: ",o.kDX(6,5,oe.selectedEntity$).name,""),o.yG2(4),o.E7m("innerHtml",o.kDX(10,7,oe.selectedEntity$).description,o.E3n)}}let w=(()=>{class ae{store=new C.qc([]);selectedEntity$=new d.g(void 0);entityIsSelected;constructor(){}ngOnInit(){this.store.load([{id:"2",name:"Name 2",description:"<b>Description 2</b>"},{id:"1",name:"Name 1",description:"<b>Description 1</b>"},{id:"3",name:"Name 3",description:"<b>Description 3</b>"}])}ngOnDestroy(){this.store.destroy()}getTitle(oe){return oe.name}onSelectedChange(oe){this.entityIsSelected=!!oe.value.id,this.selectedEntity$.next(oe.value)}static \u0275fac=function(se){return new(se||ae)};static \u0275cmp=o.In1({type:ae,selectors:[["app-entity-selector"]],standalone:!0,features:[o.UHJ],decls:4,vars:5,consts:[["title","Entity Selector","subtitle","Common"],["codeFolder","common/entity-selector"],[3,"store","titleAccessor","emptyText","placeholder","selectedChange"],[4,"ngIf"],[3,"innerHtml"]],template:function(se,me){1&se&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-entity-selector",2),o.qCj("selectedChange",function(ke){return me.onSelectedChange(ke)}),o.C$Y(),o.yuY(3,W,11,9,"div",3),o.C$Y()()),2&se&&(o.yG2(2),o.E7m("store",me.store)("titleAccessor",me.getTitle)("emptyText","")("placeholder","Select an entity"),o.yG2(),o.E7m("ngIf",me.entityIsSelected))},dependencies:[L.u,P.I,C.sh,k.u_,k.a],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return ae})(),te=(()=>{class ae{store=new C.qc([]);paginator;entitySortChange$=new d.g(!1);paginatorOptions={pageSize:10};template={selection:!0,selectionCheckbox:!0,selectMany:!0,sort:!0,valueAccessor:(oe,se)=>(0,C.u6)(oe,se),columns:[{name:"selected",title:"Selected",valueAccessor:oe=>this.store.state.get(oe).selected?"radio_button_checked":"radio_button_unchecked",renderer:C.G8.Icon},{name:"id",title:"ID"},{name:"name",title:"Name"},{name:"description",title:"Description",renderer:C.G8.HTML},{name:"date",title:"Date",type:"date"},{name:"url",title:"Hyperlink"},{name:"image",title:"Image"},{name:"action",title:"",valueAccessor:()=>[{icon:"home",color:"warn",click:oe=>{console.log(oe)}}],renderer:C.G8.ButtonGroup}]};constructor(){}ngOnInit(){const se=[2,1,3,4,5,6,7,8,9,10,11,12,13].map(me=>3===me?{id:me,name:`Name ${me}`,description:`<b>Description ${me}</b>`,date:new Date,url:"https://igouverte.org",image:"https://www.igouverte.org/assets/img/NONEXISTINGIMAGE.png"}:{id:me,name:`Name ${me}`,description:`<b>Description ${me}</b>`,date:new Date,url:"https://igouverte.org",image:"https://www.igouverte.org/assets/img/Igo_logoavec.png"});this.store.load(se)}entitySortChange(){this.entitySortChange$.next(!0)}paginatorChange(oe){this.paginator=oe}ngOnDestroy(){this.store.destroy()}static \u0275fac=function(se){return new(se||ae)};static \u0275cmp=o.In1({type:ae,selectors:[["app-entity-table"]],standalone:!0,features:[o.UHJ],decls:3,vars:4,consts:[["title","Entity Table","subtitle","Common"],["codeFolder","common/entity-table"],[3,"store","withPaginator","paginatorOptions","template","entitySortChange"]],template:function(se,me){1&se&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-entity-table",2),o.qCj("entitySortChange",function(){return me.entitySortChange()}),o.C$Y()()()),2&se&&(o.yG2(2),o.E7m("store",me.store)("withPaginator",!0)("paginatorOptions",me.paginatorOptions)("template",me.template))},dependencies:[L.u,P.I,C.Eh],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return ae})();function Z(ae,le){if(1&ae){const oe=o.KQA();o.I0R(0,"igo-form",3),o.qCj("submitForm",function(me){o.usT(oe);const be=o.GaO();return o.CGJ(be.onSubmit(me))}),o.wVc(1,"async"),o.wR5(2,"igo-form-group",4),o.I0R(3,"div",5)(4,"button",6),o.qCj("click",function(){o.usT(oe);const me=o.GaO();return o.CGJ(me.fillForm())}),o.OEk(5," Fill Form "),o.C$Y(),o.I0R(6,"button",6),o.qCj("click",function(){o.usT(oe);const me=o.GaO();return o.CGJ(me.clearForm())}),o.OEk(7," Clear Form "),o.C$Y(),o.I0R(8,"button",7),o.OEk(9," Submit "),o.C$Y()()()}if(2&ae){const oe=le.ngIf,se=o.GaO();o.E7m("form",oe)("formData",o.kDX(1,4,se.data$)),o.yG2(2),o.E7m("group",oe.groups[0]),o.yG2(6),o.E7m("disabled",se.submitDisabled)}}let K=(()=>{class ae{formService;form$=new d.g(void 0);data$=new d.g(void 0);submitDisabled=!0;valueChanges$$;constructor(oe){this.formService=oe}ngOnInit(){const se=[{name:"id",title:"ID",options:{cols:1,validator:R.AQ.required}},{name:"name",title:"Name",options:{cols:1,validator:R.AQ.required}},{name:"status",title:"Status",type:"select",options:{cols:2},inputs:{choices:[{value:1,title:"Single"},{value:2,title:"Married"}]}}].map(be=>this.formService.field(be)),me=this.formService.form([],[this.formService.group({name:"info"},se)]);this.valueChanges$$=me.control.valueChanges.subscribe(()=>{this.submitDisabled=!me.control.valid}),this.form$.next(me)}ngOnDestroy(){this.valueChanges$$.unsubscribe()}fillForm(){this.data$.next({id:1,name:"Bob",status:2})}clearForm(){this.form$.value.control.reset()}onSubmit(oe){alert(JSON.stringify(oe))}static \u0275fac=function(se){return new(se||ae)(o.GI1(C.eO))};static \u0275cmp=o.In1({type:ae,selectors:[["app-form"]],standalone:!0,features:[o.UHJ],decls:4,vars:3,consts:[["title","Form","subtitle","Common"],["codeFolder","common/form"],[3,"form","formData","submitForm",4,"ngIf"],[3,"form","formData","submitForm"],[3,"group"],["formButtons","",1,"actions-container"],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"]],template:function(se,me){1&se&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1),o.yuY(2,Z,10,6,"igo-form",2),o.wVc(3,"async"),o.C$Y()()),2&se&&(o.yG2(2),o.E7m("ngIf",o.kDX(3,1,me.form$)))},dependencies:[L.u,P.I,k.u_,C.Yl,C.O8,y.oJ,y.Gw,k.a],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}[_nghost-%COMP%]   igo-form[_ngcontent-%COMP%]{max-width:500px}"]})}return ae})();var X=r(50244),V=r(42536);let B=(()=>{class ae{exampleIndexHtml=z;exampleStyleVariable=c;exampleProvider=I;nameControl=new R.Ku("shopping_cart_checkout");static \u0275fac=function(se){return new(se||ae)};static \u0275cmp=o.In1({type:ae,selectors:[["app-icon"]],standalone:!0,features:[o.UHJ],decls:49,vars:5,consts:[["title","Icon","subtitle","Common"],["href","https://fonts.google.com/icons","target","_blank"],["title","Icon","codeFolder","common/icon"],[1,"field-container"],["subscriptSizing","dynamic"],["matInput","","type","text",3,"formControl"],["icon","equal",1,"m-h-12"],[3,"icon"]],template:function(se,me){1&se&&(o.I0R(0,"app-doc-viewer",0)(1,"section")(2,"p"),o.OEk(3," The "),o.I0R(4,"code"),o.OEk(5,"icon"),o.C$Y(),o.OEk(6," is a core concept for many packages of the IGO2 library. The icon system is base on "),o.I0R(7,"a",1),o.OEk(8,"Google Font - Material Symbol"),o.C$Y(),o.OEk(9," who use font ligature to configure the icon "),o.C$Y()(),o.I0R(10,"section")(11,"h3"),o.OEk(12,"Getting started"),o.C$Y(),o.I0R(13,"ol")(14,"li"),o.OEk(15," In your "),o.I0R(16,"code"),o.OEk(17,"index.html"),o.C$Y(),o.OEk(18," file, add the variable font stylesheet request to your head tag and "),o.I0R(19,"pre")(20,"code"),o.OEk(21),o.C$Y()()(),o.I0R(22,"li"),o.OEk(23," Then add the current class with variable axes configuration to icons in your "),o.I0R(24,"code"),o.OEk(25,"style.scss"),o.C$Y(),o.OEk(26," file. "),o.I0R(27,"pre")(28,"code"),o.OEk(29),o.C$Y()()(),o.I0R(30,"li"),o.OEk(31," Finally, add the icon provider configuration in your main file "),o.I0R(32,"code"),o.OEk(33,"main.ts"),o.C$Y(),o.I0R(34,"pre")(35,"code"),o.OEk(36),o.C$Y()()()()(),o.I0R(37,"app-example-viewer",2)(38,"p"),o.OEk(39," Enter a name from the "),o.I0R(40,"a",1),o.OEk(41,"Google Font - Material Symbol"),o.C$Y()(),o.I0R(42,"div",3)(43,"mat-form-field",4)(44,"mat-label"),o.OEk(45,"Icon Name"),o.C$Y(),o.wR5(46,"input",5),o.C$Y(),o.wR5(47,"igo-icon",6)(48,"igo-icon",7),o.C$Y()()()),2&se&&(o.yG2(21),o.cNF(me.exampleIndexHtml),o.yG2(8),o.cNF(me.exampleStyleVariable),o.yG2(7),o.cNF(me.exampleProvider),o.yG2(10),o.E7m("formControl",me.nameControl),o.yG2(2),o.E7m("icon",me.nameControl.value))},dependencies:[L.u,P.I,C.S,X.wb,X.Up,X.w5,R.sl,R.ot,R.ue,R.ug,V.cN,V.yi],styles:[".field-container[_ngcontent-%COMP%]{display:flex;align-items:center}"]})}return ae})();const z='<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />',c=".material-symbols-outlined {\n  font-variation-settings:\n  'FILL' 0,\n  'wght' 400,\n  'GRAD' 0,\n  'opsz' 24\n}",I="import { provideIcon } from '@igo2/common';\n\nbootstrapApplication(AppComponent, {\n  providers: [\n    provideIcon(),\n  ]\n})\n";let b=(()=>{class ae{database;model={columns:[{name:"id",title:"ID",sortable:!1,filterable:!0},{name:"name",title:"Name",sortable:!0,filterable:!0},{name:"description",title:"Description",sortable:!0,filterable:!0}],actions:[{icon:"description",color:C.ys.primary,click:oe=>this.showName(oe.name)}],selectionCheckbox:!0};constructor(){}ngOnInit(){this.database=new C.Iv([{id:"2",name:"Name 2",description:"Hello 2"},{id:"1",name:"Name 1",description:"Bonjour 1"},{id:"3",name:"Name 3",description:"Hola 3"}])}showName(oe){alert(oe)}handleSelect(oe){console.log(oe)}static \u0275fac=function(se){return new(se||ae)};static \u0275cmp=o.In1({type:ae,selectors:[["app-table"]],standalone:!0,features:[o.UHJ],decls:3,vars:3,consts:[["title","Table","subtitle","Common"],["codeFolder","common/table"],[3,"database","model","hasFilterInput","select"]],template:function(se,me){1&se&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-table",2),o.qCj("select",function(ke){return me.handleSelect(ke)}),o.C$Y()()()),2&se&&(o.yG2(2),o.E7m("database",me.database)("model",me.model)("hasFilterInput",!0))},dependencies:[L.u,P.I,C.oz],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return ae})();var G=r(21124),D=r(32328);function g(ae,le){if(1&ae){const oe=o.KQA();o.I0R(0,"button",7),o.qCj("click",function(){o.usT(oe);const me=o.GaO();return o.CGJ(me.toolbox.activatePreviousTool())}),o.I0R(1,"mat-icon"),o.OEk(2,"arrow_back"),o.C$Y()()}}function U(ae,le){if(1&ae){const oe=o.KQA();o.I0R(0,"button",8),o.qCj("click",function(){o.usT(oe);const me=o.GaO();return o.CGJ(me.toolbox.deactivateTool())}),o.I0R(1,"mat-icon"),o.OEk(2,"menu"),o.C$Y()()}}let M=class Ps{cdRef;name;constructor(le){this.cdRef=le}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(oe){return new(oe||Ps)(o.GI1(o.kD9))};static \u0275cmp=o.In1({type:Ps,selectors:[["app-salutation-tool"]],inputs:{name:"name"},standalone:!0,features:[o.UHJ],decls:2,vars:1,template:function(oe,se){1&oe&&(o.I0R(0,"p"),o.OEk(1),o.C$Y()),2&oe&&(o.yG2(),o.oRS("Hello, my name is ",se.name,"."))},encapsulation:2,changeDetection:0})};M=(0,G.UN)([(0,C.aA)({name:"demo-salutation",title:"Salutation",icon:"person",options:{name:"Jack"}}),(0,G.YR)("design:paramtypes",[o.kD9])],M);let H=class Fs{static \u0275fac=function(oe){return new(oe||Fs)};static \u0275cmp=o.In1({type:Fs,selectors:[["app-about-tool"]],standalone:!0,features:[o.UHJ],decls:2,vars:0,template:function(oe,se){1&oe&&(o.I0R(0,"p"),o.OEk(1,"I'm a tool inside a toolbox."),o.C$Y())},encapsulation:2,changeDetection:0})};H=(0,G.UN)([(0,C.aA)({name:"demo-about",title:"About",icon:"information"})],H);let s=(()=>{class ae{toolService;toolbox=new C.Eb;get activeTool$(){return this.toolbox.activeTool$}get panelTitle(){return this.activeTool$.value?this.activeTool$.value.title:"Toolbox"}constructor(oe){this.toolService=oe}ngOnInit(){this.toolbox.setToolbar(["demo-salutation","demo-about"]),this.toolbox.setTools(this.toolService.getTools())}ngOnDestroy(){this.toolbox.destroy()}activateSalutationTool(){this.toolbox.activateTool("demo-salutation",{name:"Bob"})}static \u0275fac=function(se){return new(se||ae)(o.GI1(C.IF))};static \u0275cmp=o.In1({type:ae,selectors:[["app-tool"]],standalone:!0,features:[o.UHJ],decls:10,vars:9,consts:[["title","Tool","subtitle","Common"],["codeFolder","common/tool"],[3,"title"],["mat-icon-button","","panelLeftButton","",3,"click",4,"ngIf"],["mat-icon-button","","panelRightButton","",3,"click",4,"ngIf"],["color","primary",3,"toolbox","animate"],["mat-flat-button","","type","button","color","primary",3,"click"],["mat-icon-button","","panelLeftButton","",3,"click"],["mat-icon-button","","panelRightButton","",3,"click"]],template:function(se,me){1&se&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-panel",2),o.yuY(3,g,3,0,"button",3),o.wVc(4,"async"),o.yuY(5,U,3,0,"button",4),o.wVc(6,"async"),o.wR5(7,"igo-toolbox",5),o.C$Y(),o.I0R(8,"button",6),o.qCj("click",function(){return me.activateSalutationTool()}),o.OEk(9," Activate Salutation Tool "),o.C$Y()()()),2&se&&(o.yG2(2),o.E7m("title",me.panelTitle),o.yG2(),o.E7m("ngIf",o.kDX(4,5,me.activeTool$)),o.yG2(2),o.E7m("ngIf",o.kDX(6,7,me.activeTool$)),o.yG2(2),o.E7m("toolbox",me.toolbox)("animate",!0))},dependencies:[L.u,P.I,C.cP,k.u_,y.oJ,y.Gw,y.um,D.oB,D.qL,C.cT,k.a],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return ae})();var ie=r(26431);let de=(()=>{class ae{cdRef;name;complete=new o._w7;cancel=new o._w7;constructor(oe){this.cdRef=oe}onUpdateInputs(){this.cdRef.detectChanges()}static \u0275fac=function(se){return new(se||ae)(o.GI1(o.kD9))};static \u0275cmp=o.In1({type:ae,selectors:[["app-salutation-widget"]],inputs:{name:"name"},outputs:{complete:"complete",cancel:"cancel"},standalone:!0,features:[o.UHJ],decls:6,vars:1,consts:[["mat-flat-button","",3,"click"]],template:function(se,me){1&se&&(o.I0R(0,"p"),o.OEk(1),o.C$Y(),o.I0R(2,"button",0),o.qCj("click",function(){return me.complete.emit(me.name)}),o.OEk(3," Nice to meet you "),o.C$Y(),o.I0R(4,"button",0),o.qCj("click",function(){return me.cancel.emit(me.name)}),o.OEk(5,"Dismiss"),o.C$Y()),2&se&&(o.yG2(),o.oRS("Hello, my name is ",me.name,"."))},dependencies:[y.oJ,y.Gw],encapsulation:2,changeDetection:0})}return ae})();const Se=[{path:"",redirectTo:"action",pathMatch:"full"},{title:"Action",path:"action",component:h},{title:"Dialogs",path:"dialog",component:T},{title:"Dynamic Component",path:"dynamic-component",component:A},{title:"Entity Table",path:"entity-table",component:te},{title:"Entity Selector",path:"entity-selector",component:w},{title:"Form",path:"form",component:K},{title:"Icon",path:"icon",component:B},{title:"Table",path:"table",component:b},{title:"Tool",path:"tool",component:s},{title:"Widget",path:"widget",component:(()=>{class ae{widgetService;widget;inputs={name:"Bob"};constructor(oe){this.widgetService=oe,this.widget=this.widgetService.create(de)}onWidgetComplete(oe){alert(`${oe} emitted event 'complete' then got automatically destroyed.`)}onWidgetCancel(){alert("Widget emitted event 'cancel' then got automatically destroyed.")}static \u0275fac=function(se){return new(se||ae)(o.GI1(C.cx))};static \u0275cmp=o.In1({type:ae,selectors:[["app-widget"]],standalone:!0,features:[o.UHJ],decls:3,vars:2,consts:[["title","Widget","subtitle","Common"],["codeFolder","common/widget"],[3,"widget","inputs","complete","cancel"]],template:function(se,me){1&se&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-widget-outlet",2),o.qCj("complete",function(ke){return me.onWidgetComplete(ke)})("cancel",function(){return me.onWidgetCancel()}),o.C$Y()()()),2&se&&(o.yG2(2),o.E7m("widget",me.widget)("inputs",me.inputs))},dependencies:[L.u,P.I,C.iA,ie.A],styles:["pre[_ngcontent-%COMP%], code[_ngcontent-%COMP%]{font-family:monospace,monospace}pre[_ngcontent-%COMP%]{overflow:auto}pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}"]})}return ae})()}]},32688:(Fe,ce,r)=>{"use strict";r.d(ce,{u:()=>o});var C=r(65056),e=r(34896);function d(f,h){if(1&f&&(e.I0R(0,"li"),e.OEk(1),e.C$Y()),2&f){const R=h.$implicit;e.yG2(),e.cNF(R)}}function L(f,h){if(1&f&&(e.SAx(0),e.I0R(1,"label",3),e.OEk(2,"Dependencies:"),e.C$Y(),e.I0R(3,"ul"),e.yuY(4,d,2,1,"li",4),e.C$Y(),e.k70()),2&f){const R=e.GaO();e.yG2(4),e.E7m("ngForOf",R.dependencies)}}const P=["*"];let o=(()=>{class f{title;subtitle;dependencies;static \u0275fac=function(y){return new(y||f)};static \u0275cmp=e.In1({type:f,selectors:[["app-doc-viewer"]],inputs:{title:"title",subtitle:"subtitle",dependencies:"dependencies"},standalone:!0,features:[e.UHJ],ngContentSelectors:P,decls:7,vars:3,consts:[[1,"mat-subtitle-2","m-b-0"],[1,"mat-body-1"],[4,"ngIf"],["for",""],[4,"ngFor","ngForOf"]],template:function(y,O){1&y&&(e.kPM(),e.I0R(0,"h6",0),e.OEk(1),e.C$Y(),e.I0R(2,"h2"),e.OEk(3),e.C$Y(),e.I0R(4,"div",1),e.yuY(5,L,5,1,"ng-container",2),e._Xx(6),e.C$Y()),2&y&&(e.yG2(),e.cNF(O.subtitle),e.yG2(2),e.cNF(O.title),e.yG2(2),e.E7m("ngIf",null==O.dependencies?null:O.dependencies.length))},dependencies:[C.u_,C.Iw],styles:["[_nghost-%COMP%]{display:block;padding:16px 48px}@media (max-width: 599px){[_nghost-%COMP%]{padding:16px}}[_nghost-%COMP%]     pre{background:#00000003;border:.5px solid rgba(0,0,0,.2);border-radius:5px;display:block;margin:16px auto;overflow-x:auto;padding:20px;white-space:pre-wrap}[_nghost-%COMP%]     pre code{background:transparent}[_nghost-%COMP%]     code{background:#00000008;padding:3px;font-size:90%}[_nghost-%COMP%]     section{margin-bottom:42px}"]})}return f})()},51100:(Fe,ce,r)=>{"use strict";r.d(ce,{I:()=>x});var C=r(65056),e=r(34672),d=r(48512),L=r(75180),P=r(32328),o=r(27e3),f=r(34896);function h(T,a){if(1&T&&(f.I0R(0,"a",6)(1,"mat-icon"),f.OEk(2,"code-tags"),f.C$Y()()),2&T){const F=f.GaO();f.E7m("href",F.codeUrl,f.K6U)}}function R(T,a){if(1&T&&(f.I0R(0,"a",7)(1,"mat-icon"),f.OEk(2,"settings"),f.C$Y()()),2&T){const F=f.GaO();f.E7m("href",F.configUrl,f.K6U)}}const y=["*"],O="https://github.com/infra-geo-ouverte/igo2-lib/tree/master/projects/demo/src";let x=(()=>{class T{title;codeFolder;configFolder;get codeUrl(){return`${O}/app/${this.codeFolder}`}get configUrl(){return`${O}/${this.configFolder}`}static \u0275fac=function(A){return new(A||T)};static \u0275cmp=f.In1({type:T,selectors:[["app-example-viewer"]],inputs:{title:"title",codeFolder:"codeFolder",configFolder:"configFolder"},standalone:!0,features:[f.UHJ],ngContentSelectors:y,decls:10,vars:3,consts:[["appearance","outlined"],[1,"actions"],["mat-icon-button","","target","_blank","matTooltip","View code example",3,"href",4,"ngIf"],["mat-icon-button","","target","_blank","matTooltip","View config example",3,"href",4,"ngIf"],[1,"m-b-16"],[1,"mat-body-1"],["mat-icon-button","","target","_blank","matTooltip","View code example",3,"href"],["mat-icon-button","","target","_blank","matTooltip","View config example",3,"href"]],template:function(A,k){1&A&&(f.kPM(),f.I0R(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-subtitle"),f.OEk(3),f.C$Y(),f.I0R(4,"div",1),f.yuY(5,h,3,1,"a",2)(6,R,3,1,"a",3),f.C$Y()(),f.wR5(7,"mat-divider",4),f.I0R(8,"mat-card-content",5),f._Xx(9),f.C$Y()()),2&A&&(f.yG2(3),f.oRS(" ",k.title," "),f.yG2(2),f.E7m("ngIf",k.codeFolder),f.yG2(),f.E7m("ngIf",k.configFolder))},dependencies:[d.NR,d.SM,d.WK,d.Uc,d.uK,C.u_,e.oJ,e.cP,o.KO,o.a4,P.oB,P.qL,L.U,L.k],styles:["[_nghost-%COMP%]{display:block;margin-top:24px}[_nghost-%COMP%]   mat-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 8px 0 16px;margin-bottom:0}[_nghost-%COMP%]     .mat-mdc-card-header-text{display:flex;align-items:center}[_nghost-%COMP%]   mat-card-subtitle[_ngcontent-%COMP%]{font-size:16px}"]})}return T})()},87124:(Fe,ce,r)=>{"use strict";r.r(ce),r.d(ce,{routes:()=>O});var C=r(52072),e=r(53e3),d=r(37240),L=r(58776),P=r(32688),o=r(51100),f=r(34896);function h(x,T){1&x&&f.wR5(0,"igo-metadata-button",18),2&x&&f.E7m("layer",T.layer)}const R=()=>["HttpClientModule"],O=[{path:"",redirectTo:"context",pathMatch:"full"},{title:"Context",path:"context",component:(()=>{class x{mapService;contextService;map=new L.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};constructor(a,F){this.mapService=a,this.contextService=F,this.mapService.setMap(this.map),this.contextService.loadDefaultContext(),this.contextService.loadContexts()}static \u0275fac=function(F){return new(F||x)(f.GI1(L.u00),f.GI1(d.M9))};static \u0275cmp=f.In1({type:x,selectors:[["app-context"]],standalone:!0,features:[f.UHJ],decls:22,vars:12,consts:[["title","Context","subtitle","Context",3,"dependencies"],["codeFolder","context/context","configFolder","contexts"],["cols","2","rowHeight","500px","gutterSize","16px"],["igoMapContext","","igoLayerContext","",3,"map","view"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"],[1,"flex","flex-col","align-start","h-100","w-100"],["title","Contexts list",1,"h-100","w-100"],["igoContextListBinding","",3,"map"],["title","Layers",1,"h-100","w-100"],["igoLayerListBinding","",3,"map"],["igoLayerItemToolbar",""],["title","Import/Export context","codeFolder","context/context","configFolder","contexts"],[3,"map"],[3,"layer"]],template:function(F,A){1&F&&(f.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),f.wR5(6,"div",5)(7,"igo-rotation-button",6),f.C$Y(),f.I0R(8,"div",7),f.wR5(9,"igo-home-extent-button",8)(10,"igo-geolocate-button",8)(11,"igo-zoom-button",9),f.C$Y()()(),f.I0R(12,"mat-grid-tile")(13,"div",10)(14,"igo-panel",11),f.wR5(15,"igo-context-list",12),f.C$Y(),f.I0R(16,"igo-panel",13)(17,"igo-layer-list",14),f.yuY(18,h,1,1,"ng-template",null,15,f.gJz),f.C$Y()()()()()(),f.I0R(20,"app-example-viewer",16),f.wR5(21,"igo-context-import-export",17),f.C$Y()()),2&F&&(f.E7m("dependencies",f.q4q(11,R)),f.yG2(4),f.E7m("map",A.map)("view",A.view),f.yG2(3),f.E7m("showIfNoRotation",!0)("map",A.map),f.yG2(2),f.E7m("map",A.map),f.yG2(),f.E7m("map",A.map),f.yG2(),f.E7m("map",A.map),f.yG2(4),f.E7m("map",A.map),f.yG2(2),f.E7m("map",A.map),f.yG2(4),f.E7m("map",A.map))},dependencies:[P.u,o.I,C.CQ,C.ae,C.cn,L.cdH,L.eqy,L.q2F,L.i6P,L.qcl,d.W2,d.AX,d.k5,d.Mb,e.cP,L.m2U,L.Ult,L.Idw,d.kP]})}return x})()}]},61536:(Fe,ce,r)=>{"use strict";r.r(ce),r.d(ce,{routes:()=>nt});var C=r(34672),e=r(53e3),d=r(23302),L=r(32688),P=r(51100),o=r(34896);let f=(()=>{class Ue{activityService;idsActivity=[];constructor(Ae){this.activityService=Ae}register(){this.idsActivity.push(this.activityService.register())}unregister(){this.activityService.unregister(this.idsActivity.pop())}get counter(){return this.activityService.counter$.value}static \u0275fac=function(Qe){return new(Qe||Ue)(o.GI1(d.U9))};static \u0275cmp=o.In1({type:Ue,selectors:[["app-activity"]],standalone:!0,features:[o.UHJ],decls:23,vars:1,consts:[["title","Activity","subtitle","Core"],["codeFolder","core/activity"],[1,"d-flex","actions-container"],["mat-raised-button","",3,"click"],[1,"mat-body-1","sub-content"],["igoSpinnerActivity",""]],template:function(Qe,_e){1&Qe&&(o.I0R(0,"app-doc-viewer",0)(1,"p"),o.OEk(2,"Register activities in service. Use to display a loading icon"),o.C$Y(),o.I0R(3,"li"),o.OEk(4," Import "),o.I0R(5,"code"),o.OEk(6,"IgoActivityModule"),o.C$Y(),o.OEk(7," only if you want register HTTP calls "),o.C$Y(),o.I0R(8,"li"),o.OEk(9,"Import "),o.I0R(10,"code"),o.OEk(11,"IgoActivityModule"),o.C$Y(),o.OEk(12," only once"),o.C$Y(),o.I0R(13,"app-example-viewer",1)(14,"div",2)(15,"button",3),o.qCj("click",function(){return _e.register()}),o.OEk(16,"Register"),o.C$Y(),o.I0R(17,"button",3),o.qCj("click",function(){return _e.unregister()}),o.OEk(18,"Unregister"),o.C$Y()(),o.I0R(19,"div",4)(20,"p"),o.OEk(21),o.C$Y(),o.wR5(22,"igo-spinner",5),o.C$Y()()()),2&Qe&&(o.yG2(21),o.oRS("Counter: ",_e.counter,""))},dependencies:[L.u,P.I,e.is,C.oJ,C.Gw],styles:["[_nghost-%COMP%]   .sub-content[_ngcontent-%COMP%]{margin-top:12px}"]})}return Ue})();var h=r(65056),R=r(9204);let y=(()=>{class Ue{configService;configLanguage;constructor(Ae){this.configService=Ae,this.configLanguage=this.configService.getConfig("language")}static \u0275fac=function(Qe){return new(Qe||Ue)(o.GI1(R.aW))};static \u0275cmp=o.In1({type:Ue,selectors:[["app-config"]],standalone:!0,features:[o.UHJ],decls:12,vars:3,consts:[["title","Config","subtitle","Core"],["title","Simple config","codeFolder","core/config","configFolder","environments"],[1,"mat-body-1"]],template:function(Qe,_e){1&Qe&&(o.I0R(0,"app-doc-viewer",0)(1,"p"),o.OEk(2,"Load config in your angular application"),o.C$Y(),o.I0R(3,"li"),o.OEk(4,"Import "),o.I0R(5,"code"),o.OEk(6,"IgoConfigModule"),o.C$Y(),o.OEk(7," only once"),o.C$Y(),o.I0R(8,"app-example-viewer",1)(9,"p",2),o.OEk(10),o.wVc(11,"json"),o.C$Y()()()),2&Qe&&(o.yG2(10),o.oRS("Config language: ",o.kDX(11,1,_e.configLanguage),""))},dependencies:[L.u,P.I,h.ED]})}return Ue})();var O=r(24708),x=r(72584);let T=(()=>{class Ue{languageService;app={title:"IGO"};constructor(Ae){this.languageService=Ae}changeLanguage(Ae){this.languageService.setLanguage(Ae),console.log(this.languageService)}static \u0275fac=function(Qe){return new(Qe||Ue)(o.GI1(O.ov))};static \u0275cmp=o.In1({type:Ue,selectors:[["app-language"]],standalone:!0,features:[o.UHJ],decls:21,vars:4,consts:[["title","Language","subtitle","Core"],["href","https://github.com/infra-geo-ouverte/igo2-lib/tree/master/projects/demo/src/locale"],["codeFolder","core/language"],[1,"d-flex","actions-container"],["mat-raised-button","",3,"click"],[1,"m-t-12"]],template:function(Qe,_e){1&Qe&&(o.I0R(0,"app-doc-viewer",0)(1,"p"),o.OEk(2,"Translate your angular application"),o.C$Y(),o.I0R(3,"li"),o.OEk(4,"Import "),o.I0R(5,"code"),o.OEk(6,"IgoLanguageModule"),o.C$Y(),o.OEk(7," only once"),o.C$Y(),o.I0R(8,"li"),o.OEk(9," Configure the "),o.I0R(10,"a",1),o.OEk(11,"locale files"),o.C$Y()(),o.I0R(12,"app-example-viewer",2)(13,"div",3)(14,"button",4),o.qCj("click",function(){return _e.changeLanguage("en")}),o.OEk(15,"English"),o.C$Y(),o.I0R(16,"button",4),o.qCj("click",function(){return _e.changeLanguage("fr")}),o.OEk(17,"Fran\xe7ais"),o.C$Y()(),o.I0R(18,"div",5),o.OEk(19),o.wVc(20,"translate"),o.C$Y()()()),2&Qe&&(o.yG2(19),o.oRS(" ",o.g7$(20,1,"welcome",_e.app)," "))},dependencies:[L.u,P.I,C.oJ,C.Gw,O._s,x.sD]})}return Ue})();var a=r(9588);let F=(()=>{class Ue{mediaService;constructor(Ae){this.mediaService=Ae}get media(){return this.mediaService.getMedia()}get orientation(){return this.mediaService.getOrientation()}get isTouchScreen(){return this.mediaService.isTouchScreen()}static \u0275fac=function(Qe){return new(Qe||Ue)(o.GI1(a.QB))};static \u0275cmp=o.In1({type:Ue,selectors:[["app-media"]],standalone:!0,features:[o.UHJ],decls:10,vars:3,consts:[["title","Media","subtitle","Core"],["codeFolder","core/media"]],template:function(Qe,_e){1&Qe&&(o.I0R(0,"app-doc-viewer",0)(1,"p"),o.OEk(2,"Detect type of media (mobile, tablet, desktop)"),o.C$Y(),o.I0R(3,"app-example-viewer",1)(4,"p"),o.OEk(5),o.C$Y(),o.I0R(6,"p"),o.OEk(7),o.C$Y(),o.I0R(8,"p"),o.OEk(9),o.C$Y()()()),2&Qe&&(o.yG2(5),o.oRS("Current media: ",_e.media,""),o.yG2(2),o.oRS("Current orientation: ",_e.orientation,""),o.yG2(2),o.oRS(" Device mode: ",_e.isTouchScreen?"Touch device":"Not a touch device "," "))},dependencies:[L.u,P.I]})}return Ue})();var A=r(93020);let k=(()=>{class Ue{messageService;constructor(Ae){this.messageService=Ae}success(){this.messageService.success("Congratulations","Success")}info(){this.messageService.info("Welcome to IGO","Info")}alert(){this.messageService.alert("Warning","Alert")}error(){this.messageService.error("There is a bug","Error")}static \u0275fac=function(Qe){return new(Qe||Ue)(o.GI1(A.mi))};static \u0275cmp=o.In1({type:Ue,selectors:[["app-message"]],standalone:!0,features:[o.UHJ],decls:20,vars:0,consts:[["title","Message","subtitle","Core"],["codeFolder","core/message"],[1,"d-flex","m-t-16","actions-container"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(Qe,_e){1&Qe&&(o.I0R(0,"app-doc-viewer",0)(1,"p"),o.OEk(2,"Show message to user."),o.C$Y(),o.I0R(3,"li"),o.OEk(4,"Import "),o.I0R(5,"code"),o.OEk(6,"IgoMessageModule"),o.C$Y(),o.OEk(7," only once"),o.C$Y(),o.I0R(8,"li"),o.OEk(9,"Dependencies: BrowserAnimationsModule"),o.C$Y(),o.I0R(10,"app-example-viewer",1)(11,"div",2)(12,"button",3),o.qCj("click",function(){return _e.success()}),o.OEk(13,"Success message"),o.C$Y(),o.I0R(14,"button",4),o.qCj("click",function(){return _e.info()}),o.OEk(15," Info message "),o.C$Y(),o.I0R(16,"button",5),o.qCj("click",function(){return _e.alert()}),o.OEk(17," Alert message "),o.C$Y(),o.I0R(18,"button",6),o.qCj("click",function(){return _e.error()}),o.OEk(19," Error message "),o.C$Y()()()())},dependencies:[L.u,P.I,C.oJ,C.Gw]})}return Ue})();var W=r(11687);const w=Ue=>Ue.enableTracing||!!Ue.tracesSampleRate||!!Ue.tracesSampler;var Z=r(57880),K=r(25556),X=r(51540),V=r(75848),B=r(68123);const b=new o.UbH("monitoring.options");function G(Ue){if(!Ue)return[];const St=[{provide:b,useValue:Ue}];return"sentry"===Ue.provider&&St.push(...(Ue=>{if(void 0!==Ue.enabled&&!Ue.enabled)return[];(Ue=>{if((0,X.WS)().getClient())return;const Ae=w(Ue),Qe={dsn:Ue.dsn,environment:Ue.environment,release:Ue.release,integrations:[Ae&&new V.CC({routingInstrumentation:K.CI}),Ue.enableReplay&&new B.SQ].filter(Boolean)};(0,K._6)(Qe)})(Ue);const Ae=w(Ue);return[{provide:o.eAe,useFactory:()=>(Ue=>(0,K.W4)({logErrors:Ue.logErrors,...Ue.errorHandlerOptions??{}}))(Ue)},Ae&&{provide:K.a4,deps:[Z.E5]},Ae&&{provide:o.kZF,useFactory:()=>()=>{},deps:[K.a4],multi:!0}].filter(Boolean)})(Ue)),St}var U=r(58752),M=r(83680),H=r(19432);let s=(()=>{class Ue{configService;monitoringOptions;injector;authService;constructor(Ae,Qe,_e){this.configService=Ae,this.monitoringOptions=Qe,this.injector=_e,this.monitoringOptions?.identifyUser&&this.configService.isLoaded$.pipe((0,M.K)(Ie=>Ie),(0,H.G)(()=>(this.authService=this.injector.get(U.oj),this.authService?.authenticate$))).subscribe(Ie=>{this._identifyUser(Ie?this.authService.user:null)})}_identifyUser(Ae){"sentry"===this.monitoringOptions.provider&&(Ue=>{(0,W.u6)(Ue?{id:Ue.id,username:`${Ue.firstName} ${Ue.lastName}`,email:Ue.email}:null)})(Ae)}static \u0275fac=function(Qe){return new(Qe||Ue)(o.CoB(R.aW),o.CoB(b,8),o.CoB(o.zZn))};static \u0275prov=o.wxM({token:Ue,factory:Ue.\u0275fac,providedIn:"root"})}return Ue})();function ie(Ue){return Ue?[{provide:s,useClass:s,deps:[R.aW,b,o.zZn]},{provide:o.kZF,useFactory:()=>()=>{},deps:[s],multi:!0}]:[]}var de=r(12445);let fe=(()=>{class Ue{options;json;exampleProviderCode=Se;constructor(Ae,Qe){this.options=Ae,this.json=Qe}throwTestError(){throw new Error("Sentry Test Error")}getBasicConfigExample(){const Ae=`{"igo": {"monitoring": ${JSON.stringify(this.options,null,2)}}}`;return this.json.transform(JSON.parse(Ae))}static \u0275fac=function(Qe){return new(Qe||Ue)(o.GI1(b),o.GI1(h.ED))};static \u0275cmp=o.In1({type:Ue,selectors:[["app-monitoring"]],standalone:!0,features:[o.M5G([h.ED,...G(de.O.igo.monitoring),...ie(de.O.igo.monitoring)]),o.UHJ],decls:58,vars:2,consts:[["title","Monitoring","subtitle","Core"],["href","https://docs.sentry.io/platforms/javascript/configuration/options","target","_blank"],["href","https://docs.sentry.io/platforms/javascript/guides/angular/sourcemaps/","target","_blank"],[3,"innerHTML"],["title","Sentry","codeFolder","core/monitoring","configFolder","environments"],[1,"mat-body-1"],["mat-raised-button","","color","warn",3,"click"]],template:function(Qe,_e){1&Qe&&(o.I0R(0,"app-doc-viewer",0)(1,"section")(2,"p"),o.OEk(3," The "),o.I0R(4,"code"),o.OEk(5,"monitoring"),o.C$Y(),o.OEk(6," package provides a set of configuration for managing application monitoring "),o.C$Y(),o.I0R(7,"ul")(8,"li"),o.OEk(9,"Error montioring, report application exception"),o.C$Y(),o.I0R(10,"li"),o.OEk(11,"Custom event reporting, like tracking use of code deprecation"),o.C$Y()()(),o.I0R(12,"section")(13,"h3"),o.OEk(14,"Getting started"),o.C$Y(),o.I0R(15,"p"),o.OEk(16," Start by configure the monitoring options in your "),o.I0R(17,"code"),o.OEk(18,"environnment.ts"),o.C$Y(),o.OEk(19," file. You can complement this configuration with your provider options. To get the basic options, for Sentry consult the "),o.I0R(20,"a",1),o.OEk(21,"documentation"),o.C$Y()(),o.I0R(22,"pre")(23,"code"),o.OEk(24),o.C$Y()()(),o.I0R(25,"section")(26,"h3"),o.OEk(27,"Identify user information with the event"),o.C$Y(),o.I0R(28,"p"),o.OEk(29," If you yant to identify the user with the monitoring event, you need to configure "),o.I0R(30,"code"),o.OEk(31,"identifyUser"),o.C$Y(),o.OEk(32," to true in the monitoring options. Then import the "),o.I0R(33,"code"),o.OEk(34,"provideAuthUserMonitoring"),o.C$Y(),o.OEk(35," to your main file. "),o.C$Y()(),o.I0R(36,"section")(37,"h3"),o.OEk(38,"Add Readable Stack Traces to Errors for your application"),o.C$Y(),o.I0R(39,"p"),o.OEk(40," Follow the instruction "),o.I0R(41,"a",2),o.OEk(42,"Sentry - Source Maps"),o.C$Y()()(),o.I0R(43,"section")(44,"h3"),o.OEk(45,"Initialize monitoring"),o.C$Y(),o.I0R(46,"p"),o.OEk(47," Then import the "),o.I0R(48,"code"),o.OEk(49,"provideMonitoring"),o.C$Y(),o.OEk(50," providers into your main file "),o.C$Y(),o.I0R(51,"pre"),o.wR5(52,"code",3),o.C$Y()(),o.I0R(53,"app-example-viewer",4)(54,"p",5),o.OEk(55," Trigger a test error somewhere in your Angular app, for example in your main app component. Once triggered, an error event should be sent on your Sentry application "),o.C$Y(),o.I0R(56,"button",6),o.qCj("click",function(){return _e.throwTestError()}),o.OEk(57," Throw Test Error "),o.C$Y()()()),2&Qe&&(o.yG2(24),o.cNF(_e.getBasicConfigExample()),o.yG2(28),o.E7m("innerHTML",_e.exampleProviderCode,o.E3n))},dependencies:[L.u,P.I,C.oJ,C.Gw]})}return Ue})();const Se="bootstrapApplication(AppComponent, {\n  providers: [\n    ...provideMonitoring(environment.igo.monitoring),\n\n    // Provide the authentication user monitoring if you want to identify your user (id, fullname, email) in the error logging \n    ...provideAuthUserMonitoring(environment.igo.monitoring)\n  ]\n})\n";var ae=r(33712);let le=(()=>{class Ue{http;languageService;constructor(Ae,Qe){this.http=Ae,this.languageService=Qe}callHttp(){this.http.get("https://geoegl.msp.gouv.qc.ca/apis/icherche/info").subscribe(Qe=>{console.log(Qe)})}callHttpError(){this.http.get("404").subscribe(Qe=>{console.log(Qe)})}static \u0275fac=function(Qe){return new(Qe||Ue)(o.GI1(ae.KK),o.GI1(O.ov))};static \u0275cmp=o.In1({type:Ue,selectors:[["app-request"]],standalone:!0,features:[o.UHJ],decls:21,vars:0,consts:[["title","Request","subtitle","Core"],["codeFolder","core/core"],[1,"actions-container"],["mat-raised-button","",3,"click"]],template:function(Qe,_e){1&Qe&&(o.I0R(0,"app-doc-viewer",0)(1,"p"),o.OEk(2,"Register http calls in console"),o.C$Y(),o.I0R(3,"li"),o.OEk(4," Import "),o.I0R(5,"code"),o.OEk(6,"IgoLoggingModule"),o.C$Y(),o.OEk(7," only if you want register HTTP calls in console "),o.C$Y(),o.I0R(8,"li"),o.OEk(9," Import "),o.I0R(10,"code"),o.OEk(11,"IgoErrorModule"),o.C$Y(),o.OEk(12," only if you want register errors from HTTP calls in console "),o.C$Y(),o.I0R(13,"li"),o.OEk(14,"Import modules only once"),o.C$Y(),o.I0R(15,"app-example-viewer",1)(16,"div",2)(17,"button",3),o.qCj("click",function(){return _e.callHttp()}),o.OEk(18,"Log"),o.C$Y(),o.I0R(19,"button",3),o.qCj("click",function(){return _e.callHttpError()}),o.OEk(20,"Error"),o.C$Y()()()())},dependencies:[L.u,P.I,C.oJ,C.Gw]})}return Ue})();var oe=r(46176),se=r(50244),me=r(77872),be=r(43168);function ke(Ue,St){if(1&Ue&&(o.I0R(0,"mat-option",6),o.OEk(1),o.C$Y()),2&Ue){const Ae=St.$implicit;o.E7m("value",Ae.value),o.yG2(),o.oRS(" ",Ae.title," ")}}const nt=[{path:"",redirectTo:"activity",pathMatch:"full"},{title:"Activity",path:"activity",component:f},{title:"Config",path:"config",component:y},{title:"Language",path:"language",component:T},{title:"Media",path:"media",component:F},{title:"Message",path:"message",component:k},{title:"Monitoring",path:"monitoring",component:fe},{title:"Request",path:"request",component:le},{title:"Themes",path:"theme",component:(()=>{class Ue{languageService;renderer;isDark;themes=[{value:"blue",title:"Blue"},{value:"bluedark",title:"Blue-dark"},{value:"bluedq",title:"Donn\xe9es Qu\xe9bec"},{value:"bluegrey",title:"Blue grey"},{value:"dark",title:"Dark"},{value:"deeppurple",title:"Purple"},{value:"indigo",title:"Indigo"},{value:"orange",title:"Orange"},{value:"teal",title:"Teal"}];constructor(Ae,Qe){this.languageService=Ae,this.renderer=Qe}loadTheme(Ae){if("dark-demo-test"===Ae.value)return this.isDark=!0,void this.renderer.addClass(document.body,"dark-theme");this.isDark&&this.renderer.removeClass(document.body,"dark-theme"),(0,be.ym)(window.document,Ae.value+"-theme")}static \u0275fac=function(Qe){return new(Qe||Ue)(o.GI1(O.ov),o.GI1(o.q87))};static \u0275cmp=o.In1({type:Ue,selectors:[["app-theme"]],standalone:!0,features:[o.UHJ],decls:10,vars:1,consts:[["title","Theme","subtitle","Core"],["codeFolder","core/theme"],[1,"actions-container"],["placeholder","Select a theme",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["value","dark-demo-test"],[3,"value"]],template:function(Qe,_e){1&Qe&&(o.I0R(0,"app-doc-viewer",0)(1,"p"),o.OEk(2,"Change the app theme"),o.C$Y(),o.I0R(3,"app-example-viewer",1)(4,"div",2)(5,"mat-form-field")(6,"mat-select",3),o.qCj("selectionChange",function(je){return _e.loadTheme(je)}),o.yuY(7,ke,2,2,"mat-option",4),o.I0R(8,"mat-option",5),o.OEk(9," Dark theme "),o.C$Y()()()()()()),2&Qe&&(o.yG2(7),o.E7m("ngForOf",_e.themes))},dependencies:[L.u,P.I,se.wb,se.Up,me.d5,me.kX,oe.I5,h.Iw,oe.Ax]})}return Ue})()}]},10128:(Fe,ce,r)=>{"use strict";r.r(ce),r.d(ce,{routes:()=>$i});var C=r(53e3),e=r(21720),d=r(58776),L=r(32688),P=r(51100),o=r(34896);const f=()=>["ConfigService","LanguageService"];let h=(()=>{class J{layerService;catalogService;storageService;mapService;catalog;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};catalogStore=new C.qc([]);catalogItemStore=new C.qc([]);constructor(u,S,$,re){this.layerService=u,this.catalogService=S,this.storageService=$,this.mapService=re}ngOnInit(){this.layerService.createAsyncLayer({title:"OSM",baseLayer:!0,visible:!0,sourceOptions:{type:"osm"}}).subscribe(u=>this.map.addLayer(u)),this.loadCatalogs(),this.mapService.setMap(this.map),this.catalogStore.stateView.firstBy$(u=>!0===u.state.selected).subscribe(u=>{u&&u.entity&&(this.catalog=u.entity)})}onCatalogSelectChange(u){this.loadCatalogItems(u.catalog)}loadCatalogs(){this.catalogService.loadCatalogs().subscribe(u=>{this.catalogStore.clear(),this.catalogStore.load(u.concat(this.storageService.get("addedCatalogs")||[]))})}loadCatalogItems(u){this.catalogService.loadCatalogItems(u).subscribe(S=>{this.catalogItemStore.clear(),this.catalogItemStore.load(S)})}static \u0275fac=function(S){return new(S||J)(o.GI1(d.IZ6),o.GI1(d.oxI),o.GI1(e.yQ),o.GI1(d.u00))};static \u0275cmp=o.In1({type:J,selectors:[["app-catalog"]],standalone:!0,features:[o.UHJ],decls:9,vars:9,consts:[["title","Catalog","subtitle","Geo",3,"dependencies"],["codeFolder","geo/catalog"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["title","Catalog Library"],[3,"store","catalogSelectChange"],["title","Catalog Browser"],[3,"catalog","store","map"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.I0R(5,"igo-panel",5)(6,"igo-catalog-library",6),o.qCj("catalogSelectChange",function(ve){return $.onCatalogSelectChange(ve)}),o.C$Y()(),o.I0R(7,"igo-panel",7),o.wR5(8,"igo-catalog-browser",8),o.C$Y()()()),2&S&&(o.E7m("dependencies",o.q4q(8,f)),o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(2),o.E7m("store",$.catalogStore),o.yG2(2),o.E7m("catalog",$.catalog)("store",$.catalogItemStore)("map",$.map))},dependencies:[L.u,P.I,d.q2F,d.qcl,C.cP,d.kvX,d.iOV],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]})}return J})();var R=r(52072),y=r(61616),O=r(62747);const x=()=>["LanguageService"];let T=(()=>{class J{layerService;mapService;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:9,geolocate:!1};stopsStore=new d.SYK([]);stopsFeatureStore=new d.czr([],{map:this.map});stepFeatureStore=new d.qM$([],{map:this.map});routesFeatureStore=new d.aWp([],{map:this.map});zoomToActiveRoute$=new y.E;constructor(u,S){this.layerService=u,this.mapService=S,this.mapService.setMap(this.map),this.layerService.createAsyncLayer({title:"OSM",baseLayer:!0,visible:!0,sourceOptions:{type:"osm"}}).subscribe($=>this.map.addLayer($))}static \u0275fac=function(S){return new(S||J)(o.GI1(d.IZ6),o.GI1(d.u00))};static \u0275cmp=o.In1({type:J,selectors:[["app-directions"]],standalone:!0,features:[o.UHJ],decls:15,vars:14,consts:[["title","Directions","subtitle","Geo",3,"dependencies"],["codeFolder","geo/directions"],["cols","2","rowHeight","600px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100","overflow-y-auto"],[1,"w-100",3,"stopsStore","stopsFeatureStore","stepFeatureStore","routesFeatureStore","zoomToActiveRoute$"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"div",5)(7,"igo-rotation-button",6),o.C$Y(),o.I0R(8,"div",7),o.wR5(9,"igo-home-extent-button",8)(10,"igo-geolocate-button",8)(11,"igo-zoom-button",9),o.C$Y()()(),o.I0R(12,"mat-grid-tile")(13,"div",10),o.wR5(14,"igo-directions",11),o.C$Y()()()()()),2&S&&(o.E7m("dependencies",o.q4q(13,x)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(3),o.E7m("showIfNoRotation",!0)("map",$.map),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(3),o.E7m("stopsStore",$.stopsStore)("stopsFeatureStore",$.stopsFeatureStore)("stepFeatureStore",$.stepFeatureStore)("routesFeatureStore",$.routesFeatureStore)("zoomToActiveRoute$",$.zoomToActiveRoute$))},dependencies:[L.u,P.I,R.CQ,R.ae,R.cn,d.cdH,d.eqy,d.q2F,d.i6P,d.qcl,d.aw9,O.U,d.Oy$]})}return J})();const a=()=>["LanguageService"];let F=(()=>{class J{dataSourceService;layerService;mapService;map=new d.yGW({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:6,projection:"EPSG:3857"};stores=[];constructor(u,S,$){this.dataSourceService=u,this.layerService=S,this.mapService=$,this.mapService.setMap(this.map),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(re=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:re,baseLayer:!0,visible:!0}))})}static \u0275fac=function(S){return new(S||J)(o.GI1(d.OEM),o.GI1(d.IZ6),o.GI1(d.u00))};static \u0275cmp=o.In1({type:J,selectors:[["app-draw"]],standalone:!0,features:[o.UHJ],decls:6,vars:7,consts:[["title","Draw","subtitle","Geo",3,"dependencies"],["codeFolder","geo/draw"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[3,"stores","map"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.wR5(5,"igo-draw",5),o.C$Y()()),2&S&&(o.E7m("dependencies",o.q4q(6,a)),o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("stores",$.stores)("map",$.map))},dependencies:[d.q2F,d.qcl,d.Se2,L.u,P.I],styles:["[_nghost-%COMP%]   igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]})}return J})(),A=(()=>{class J{dataSourceService;layerService;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};tableTemplate={selection:!0,selectMany:!0,sort:!0,columns:[{name:"properties.id",title:"ID"},{name:"properties.name",title:"Name"},{name:"properties.description",title:"Description"}]};store=new d.ym_([],{map:this.map});constructor(u,S){this.dataSourceService=u,this.layerService=S}ngOnInit(){const u=new d.E9g({});this.store.addStrategy(u);const S=new d.kj0({map:this.map,motion:d.Suj.Default});this.store.addStrategy(S),this.store.load([{meta:{id:1},type:"Feature",geometry:{type:"Point",coordinates:[-72,47.8]},projection:"EPSG:4326",properties:{id:1,name:"Name 1",description:"Description 1"}},{meta:{id:4},type:"Feature",geometry:{type:"Point",coordinates:[-71,46.8]},projection:"EPSG:4326",properties:{id:4,name:"Name 4",description:"Description 4"}},{meta:{id:5},type:"Feature",geometry:{type:"Point",coordinates:[-73,45.8]},projection:"EPSG:4326",properties:{id:5,name:"Name 5",description:"Description 5"}},{meta:{id:2},type:"Feature",geometry:{type:"LineString",coordinates:[[-72,47.8],[-73.5,47.4],[-72.4,48.6]]},projection:"EPSG:4326",properties:{id:2,name:"Name 2",description:"Description 2"}},{meta:{id:3},type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71,46.8],[-73,47],[-71.2,46.6]]]},projection:"EPSG:4326",properties:{id:3,name:"Name 3",description:"Description 3"}}]),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",baseLayer:!0,visible:!0,source:$}))}),this.dataSourceService.createAsyncDataSource({type:"vector"}).subscribe($=>{const re=this.layerService.createLayer({title:"Vector Layer",source:$,animation:{duration:2e3},igoStyle:{mapboxStyle:{url:"assets/mapboxStyleExample-feature.json",source:"source_nameX"}}});this.map.addLayer(re),this.store.bindLayer(re),u.activate(),S.activate()})}ngOnDestroy(){this.store.destroy()}static \u0275fac=function(S){return new(S||J)(o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-feature"]],standalone:!0,features:[o.UHJ],decls:6,vars:5,consts:[["title","Feature","subtitle","Geo"],["codeFolder","geo/feature"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[3,"store","template"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.wR5(5,"igo-entity-table",5),o.C$Y()()),2&S&&(o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("store",$.store)("template",$.tableTemplate))},dependencies:[L.u,P.I,d.q2F,d.qcl,C.Eh],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]})}return J})();var k=r(65056),W=r(71904),w=r(34672),te=r(54776),Z=r(45212),K=r(88872),X=r(87544),V=r(54844);function B(J,j){if(1&J){const u=o.KQA();o.I0R(0,"igo-form",7),o.qCj("submitForm",function($){o.usT(u);const re=o.GaO();return o.CGJ(re.onSubmit($))}),o.wVc(1,"async"),o.wR5(2,"igo-form-group",8),o.I0R(3,"div",9)(4,"button",10),o.qCj("click",function(){o.usT(u);const $=o.GaO();return o.CGJ($.fillForm())}),o.OEk(5," Fill Form "),o.C$Y(),o.I0R(6,"button",10),o.qCj("click",function(){o.usT(u);const $=o.GaO();return o.CGJ($.clearForm())}),o.OEk(7," Clear Form "),o.C$Y(),o.I0R(8,"button",11),o.OEk(9," Submit "),o.C$Y()()()}if(2&J){const u=j.ngIf,S=o.GaO();o.E7m("form",u)("formData",o.kDX(1,4,S.data$)),o.yG2(2),o.E7m("group",u.groups[0]),o.yG2(6),o.E7m("disabled",S.submitDisabled)}}let z=(()=>{class J{formService;dataSourceService;layerService;map=new d.yGW({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:15};form$=new V.g(void 0);data$=new V.g(void 0);submitDisabled=!0;valueChanges$$;constructor(u,S,$){this.formService=u,this.dataSourceService=S,this.layerService=$}ngOnInit(){this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(re=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:re,baseLayer:!0,visible:!0}))});const S=[{name:"geometry",title:"Geometry",options:{validator:W.AQ.required},type:"geometry",inputs:{map:this.map,geometryTypeField:!0,geometryType:"Polygon",drawGuideField:!0,drawGuide:50,drawGuidePlaceholder:"Draw Guide",drawStyle:new te.cp({stroke:new Z.c({color:[255,0,0,1],width:2}),fill:new K.c({color:[255,0,0,.2]}),image:new X.c({radius:8,stroke:new Z.c({color:[255,0,0,1]}),fill:new K.c({color:[255,0,0,.2]})})})}},{name:"name",title:"Name",options:{validator:W.AQ.required}}].map(re=>this.formService.field(re)),$=this.formService.form([],[this.formService.group({name:"info"},S)]);this.valueChanges$$=$.control.valueChanges.subscribe(()=>{this.submitDisabled=!$.control.valid}),this.form$.next($)}ngOnDestroy(){this.valueChanges$$.unsubscribe()}fillForm(){this.data$.next({name:"Place",geometry:JSON.stringify({type:"Polygon",coordinates:[[[-106,42],[-107,31],[-81,32],[-82,42],[-106,42]]]})})}clearForm(){this.form$.value.control.reset()}onSubmit(u){alert(JSON.stringify(u))}static \u0275fac=function(S){return new(S||J)(o.GI1(C.eO),o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-geometry"]],standalone:!0,features:[o.UHJ],decls:8,vars:6,consts:[["title","Geometry Form","subtitle","Geo"],["codeFolder","geo/geometry"],[1,"container"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[3,"form","formData","submitForm",4,"ngIf"],[3,"form","formData","submitForm"],[3,"group"],["formButtons","",1,"actions-container"],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"div",2)(3,"igo-map-browser",3)(4,"div",4),o.wR5(5,"igo-zoom-button",5),o.C$Y()(),o.yuY(6,B,10,6,"igo-form",6),o.wVc(7,"async"),o.C$Y()()()),2&S&&(o.yG2(3),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("ngIf",o.kDX(7,4,$.form$)))},dependencies:[L.u,P.I,d.q2F,d.qcl,k.u_,C.Yl,C.O8,w.oJ,w.Gw,k.a],styles:["[_nghost-%COMP%]   pre[_ngcontent-%COMP%], [_nghost-%COMP%]   code[_ngcontent-%COMP%]{font-family:monospace,monospace}[_nghost-%COMP%]   pre[_ngcontent-%COMP%]{overflow:auto}[_nghost-%COMP%]   pre[_ngcontent-%COMP%] > code[_ngcontent-%COMP%]{display:block;padding:1rem;word-wrap:normal}[_nghost-%COMP%]   igo-map-browser[_ngcontent-%COMP%]{flex:1;height:500px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{display:flex;gap:16px}"]})}return J})();var c=r(9588),I=r(9364),b=r(75872),G=r(42860),D=r(34419),g=r(76332),U=r(87159);const M=()=>["LanguageService"];let H=(()=>{class J{dataSourceService;layerService;mediaService;pointerCoordDelay=0;pointerHoverFeatureDelay=0;map=new d.yGW({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:8,projection:"EPSG:3857"};get media(){return this.mediaService.getMedia()}get isTouchScreen(){return this.mediaService.isTouchScreen()}constructor(u,S,$){this.dataSourceService=u,this.layerService=S,this.mediaService=$,this.layerService.createAsyncLayer({title:"Quebec Base Map",baseLayer:!0,visible:!0,sourceOptions:{type:"xyz",url:"https://geoegl.msp.gouv.qc.ca/carto/tms/1.0.0/carte_gouv_qc_public@EPSG_3857/{z}/{x}/{-y}.png"}}).subscribe(ve=>this.map.addLayer(ve)),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",params:{featureTypes:"MSP_CASERNE_PUBLIC",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"shp"}}).subscribe(ve=>{this.map.addLayer(this.layerService.createLayer({title:"Casernes",visible:!0,source:ve,igoStyle:{styleByAttribute:{attribute:"en_caserne",data:["true","false"],stroke:["red","blue"],fill:["#ffffff","#ffffff"],radius:[7,7],width:[2,2]},hoverStyle:{label:{attribute:"Caserne: ${no_caserne}\xa0\nMun: ${nom_ssi}",style:{textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:{color:"#000"},backgroundFill:{color:"rgba(255, 255, 255, 0.5)"},backgroundStroke:{color:"rgba(200, 200, 200, 0.75)",width:2},stroke:{color:"#fff",width:3},overflow:!0,offsetX:20,offsetY:10,padding:[2.5,2.5,2.5,2.5]}},baseStyle:{circle:{stroke:{color:"orange",width:5},radius:15}}}}}))})}static \u0275fac=function(S){return new(S||J)(o.GI1(d.OEM),o.GI1(d.IZ6),o.GI1(c.QB))};static \u0275cmp=o.In1({type:J,selectors:[["app-hover"]],standalone:!0,features:[o.UHJ],decls:10,vars:11,consts:[["title","Hover","subtitle","Geo",3,"dependencies"],["codeFolder","geo/hover"],["igoHoverFeature","",3,"map","view","igoHoverFeatureDelay","igoHoverFeatureEnabled"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"div",4)(5,"igo-rotation-button",5),o.C$Y(),o.I0R(6,"div",6),o.wR5(7,"igo-home-extent-button",7)(8,"igo-geolocate-button",7)(9,"igo-zoom-button",8),o.C$Y()()()()),2&S&&(o.E7m("dependencies",o.q4q(10,M)),o.yG2(2),o.E7m("map",$.map)("view",$.view)("igoHoverFeatureDelay",$.pointerHoverFeatureDelay)("igoHoverFeatureEnabled",!0),o.yG2(3),o.E7m("showIfNoRotation",!0)("map",$.map),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map))},dependencies:[L.u,P.I,d.SET,I.q,b.q,G.c,D.e,g.i,U.C],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:500px}"]})}return J})();const s=()=>["LanguageService"];let ie=(()=>{class J{layerService;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:9};store=new C.cr([]);constructor(u){this.layerService=u,this.layerService.createAsyncLayer({title:"OSM",baseLayer:!0,visible:!0,sourceOptions:{type:"osm"}}).subscribe(S=>this.map.addLayer(S))}static \u0275fac=function(S){return new(S||J)(o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-import-export"]],standalone:!0,features:[o.UHJ],decls:10,vars:7,consts:[["title","Import / Export","subtitle","Geo",3,"dependencies"],["codeFolder","geo/import-export"],["cols","2","rowHeight","500px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100"],[1,"w-100",3,"store","map"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"igo-zoom-button",5),o.C$Y()()(),o.I0R(7,"mat-grid-tile")(8,"div",6),o.wR5(9,"igo-import-export",7),o.C$Y()()()()()),2&S&&(o.E7m("dependencies",o.q4q(6,s)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(3),o.E7m("store",$.store)("map",$.map))},dependencies:[L.u,P.I,R.CQ,R.ae,R.cn,d.q2F,d.qcl,d.OrO]})}return J})();function de(J,j){if(1&J&&o.wR5(0,"igo-metadata-button",10)(1,"igo-download-button",10)(2,"igo-ogc-filter-button",11)(3,"igo-time-filter-button",11)(4,"igo-track-feature-button",12),2&J){const u=j.layer;o.E7m("layer",u),o.yG2(),o.E7m("layer",u),o.yG2(),o.E7m("header",!0)("layer",u),o.yG2(),o.E7m("header",!0)("layer",u),o.yG2(),o.E7m("layer",u)("trackFeature",!0)}}const fe=()=>["LanguageService"];let Se=(()=>{class J{dataSourceService;layerService;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],maxLayerZoomExtent:[-11e6,45e5,-45e5,1e7],zoom:7};constructor(u,S){this.dataSourceService=u,this.layerService=S,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(ve=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",baseLayer:!0,visible:!0,source:ve}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:"geojson",srsName:"EPSG:32198",outputFormatDownload:"shp"},ogcFilters:{enabled:!0,editable:!1,filters:{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"12072"}},formatOptions:{dataProjection:"EPSG:32198"}}).subscribe(ve=>{this.map.addLayer(this.layerService.createLayer({title:"WFS (Custom EPSG)",visible:!0,source:ve,removable:!1}))}),this.layerService.createAsyncLayer({title:"Parcs routiers",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"parc_routier",VERSION:"1.3.0"}}}).subscribe(ve=>this.map.addLayer(ve)),this.layerService.createAsyncLayer({title:"R\xe9seau routier",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"bgr_v_sous_route_res_sup_act",VERSION:"1.3.0"}}}).subscribe(ve=>this.map.addLayer(ve)),this.layerService.createAsyncLayer({title:"Lieux habit\xe9s",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"lieuhabite",VERSION:"1.3.0"}}}).subscribe(ve=>this.map.addLayer(ve)),this.layerService.createAsyncLayer({title:"Direction du vent",visible:!1,legendOptions:{stylesAvailable:[{name:"WDIR6-LINEAR",title:"WDIR6-LINEAR"},{name:"WDIR6",title:"WDIR6"},{name:"WDIR3-LINEAR",title:"WDIR3-LINEAR"},{name:"WDIR3",title:"WDIR3"}]},sourceOptions:{type:"wms",url:"https://geo.weather.gc.ca/geomet?lang=fr",params:{LAYERS:"HRDPS.CONTINENTAL_WD",VERSION:"1.3.0"}}}).subscribe(ve=>this.map.addLayer(ve)),this.layerService.createAsyncLayer({title:"District \xe9cologique",visible:!1,sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",params:{LAYERS:"sh_dis_eco",VERSION:"1.3.0"}}}).subscribe(ve=>this.map.addLayer(ve)),this.layerService.createAsyncLayer({title:"Avertissements routiers",visible:!1,sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"evenements",VERSION:"1.3.0"}}}).subscribe(ve=>this.map.addLayer(ve)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",refreshIntervalSec:15,params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"}}).subscribe(ve=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles",source:ve,metadata:{url:"https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp",extern:!0}}))})}static \u0275fac=function(S){return new(S||J)(o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-layer"]],standalone:!0,features:[o.UHJ],decls:13,vars:10,consts:[["title","Layer","subtitle","Geo",3,"dependencies"],["codeFolder","geo/layer"],["cols","2","rowHeight","600px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100"],["title","Layers",1,"w-100"],[3,"map","layers","expandLegendOfVisibleLayers","queryBadge","excludeBaseLayers"],["igoLayerItemToolbar",""],[3,"layer"],[3,"header","layer"],[3,"layer","trackFeature"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"igo-zoom-button",5),o.C$Y()()(),o.I0R(7,"mat-grid-tile")(8,"div",6)(9,"igo-panel",7)(10,"igo-layer-list",8),o.yuY(11,de,5,8,"ng-template",null,9,o.gJz),o.C$Y()()()()()()()),2&S&&(o.E7m("dependencies",o.q4q(9,fe)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(4),o.E7m("map",$.map)("layers",$.map.layers)("expandLegendOfVisibleLayers",!1)("queryBadge",!0)("excludeBaseLayers",!0))},dependencies:[L.u,P.I,R.CQ,R.ae,R.cn,d.q2F,d.qcl,C.cP,d.m2U,d.ktW,d.Idw,d.YdQ,d.eM$,d.Ga$]})}return J})();const ae=()=>["LanguageService"];let le=(()=>{class J{dataSourceService;layerService;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};constructor(u,S){this.dataSourceService=u,this.layerService=S,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(re=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",visible:!0,baseLayer:!0,source:re}))}),this.layerService.createAsyncLayer({title:"Legend with display: false",legendOptions:{display:!1},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",params:{LAYERS:"sh_dis_eco",VERSION:"1.3.0"}}}).subscribe(re=>this.map.addLayer(re)),this.layerService.createAsyncLayer({title:"Legend with html param",legendOptions:{html:'<h2 style="background-color: blue;">HTML legend</h2>'},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",params:{LAYERS:"sh_sreg_eco",VERSION:"1.3.0"}}}).subscribe(re=>this.map.addLayer(re)),this.layerService.createAsyncLayer({title:"Legend with url param",legendOptions:{url:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxASEhUQEBISFRUVFRAQFRUQFRUVFRAPFRUWFhUVFRUYHSggGBolGxUVITEiJSkrLi4uFx8zODMsNygtLisBCgoKDg0OGhAQGy0dHyUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tKy0tLS0tLS0tLf/AABEIAKgBLAMBIgACEQEDEQH/xAAbAAABBQEBAAAAAAAAAAAAAAACAQMEBQYAB//EADwQAAIBAwEGAwYFAgUEAwAAAAECAAMEESEFEjFBUWETInEGFDKBkaFCscHR8FJyFSNTYoIzQ5LxFqLh/8QAGQEAAwEBAQAAAAAAAAAAAAAAAAECAwQF/8QAJREBAQACAgEFAAEFAAAAAAAAAAECERIhAwQTMUFRYRQiI3Gh/9oADAMBAAIRAxEAPwB0QhAEMTFQhCEEQhACEIQRFEYEIQgiEIAU6IIsAWLEnQAp0KmBqSdFBY+g5D1OBGD4nxYBHQafQzLPzTDLVbYeHLObh2LARwwyD+4PQiFNJZZuMrLLqlnRJ0ZFiTp0A6KEOM4OITuF8q4L8ydVp9sc2+0atrlw/hVGLBw2MnO66gsMdBpjHeYZeoxmXGOjH0+Vx5UsSLEm7ndEM6IYAhgmEYJgCGCYRgmIBMEwjAJgAmAYRgkwAGjTxxjGniBipGo5UjcAthCEAGEIwMQhAEIGAHFEERcxgYiiBmEDADzFgAxcwA50HMXMANh5H/tA+rrJhXy8JDXJDAcSpx6jB/SE18u6uuhGnqeU4vPP8m7+PR9N34tT9V20FZD4ifMcmHSSra5V1DKdD9Qeh7yLd1d4HAOJm7W9q27NlWKE55cOozzleLLTPz4b7bPM7MrbXbC1AFRQGb4d84OemP17Rk7YYsUREJUn8XxhfjI7gzp5xyXGrjMj3l5uYVfjYeX/AGrzb15D5mRau0N0Bt3e3uAVhoO56ympms1Z6lTtgaaDHAdgBiZZ+Tc1G3i8fe60FsN0AZ1iLUzXpDTRifqpHGVh2ioGMP8AIQtm3G9WUdmbX+04nNw3Y7+Wsb/peRJ0Qz0HkOMQzokQcTBM4xCYBxgGKTBJgCEwTFJgEwBCYBMUmCTABaMvHGMacxGZeNw3jUCWwMIGNAwgYwdBhAxoGEDAHAYQMbBigwBzMIGNAwgYA4DFzGwYWYwPMXMbzCBgD1PjxxylRUuEpv4J0PDXPx9BLNDrI17bMtd2PmVgrNngHwNdZzeeTqur02dm4RquAWK4A111yOxme2tXZicaAcuZGf3/ADl7UrFtRwA68x69jM/eVGffZcBkyxA0bdAGZHjna/Jl0pKdJmuFUN8A3ufyA+UGz3jVABIOWBOez5z05fWSrxs0qV2g1DbrY/pJAx35H6yMoxWDjhq2Ou8Dp/5GdDmBYsy7yF87rnGpx/NZfWd4yrg65JGeJHM6SjpjcthUK+apUI7glifyMnUKhV9zPH4vpjT7yMpteF0tL6qwAK6j0zr6x72YY1HLlQNwNnHMnQfrIyVAujHThx0lt7MhQKqjj5W/46iRjO42zyvG6XGYhMSJmdLjdmITOJgkwBSYJMQmITAOJgkziYJMA4mATOJgEwDiYBM4mATAOYxpzCJjTGIG3MbzFcwMwCzBhAxpQekPdPSPVLcOAwgYzgxd6GjPAwsxkNFDQB7MUNGhnpDCGPVLcOAxQY3unpFzA9nQYoMaBhAxBO2bS3qijvk+g1kXbFVqlY0qWAB56jHn0EnbPfw1ZzngeExu3L2qRu0iVNVtWGclQPyyZz+T+7LTfx9Y7XdfaNvRQh2ydFAXBJY6AADhrjjMlW2jRSqCyVFLb2vlO8uobKjQj9oT2lMUmpHILbp8TGSHU6b2OIzIVwtVt1moFmUEK9IhlI7a9esMJB5Ll9L1dnqLUCk29TJJ05KSfuAT9BK/w/PpodBwGdOGny9NInsrfstSpQq+UMDuqdd0jj+hkg4Fbf5Zzj7Qm5bKq9yWHLq1QUEeqd1UffAxx5LpzPDSU9G/pl2dKTnd0YlgCfly4R72huHqV6dKjhgi4wdBvEfY6SOthUGfFZKYbG8KZLVHA5Y5SsZNdoz3vpate0agXdyuQG3X4gH85P8AZ2p4dfdfmCgP+08P0lNcW3jDK090IMIc6jHAd47sWuxanv8AEFR8wZOuul7beoMEiBmFVyTnrGjmdHbmKTBJiZnYgCExCYpWAYg4mAWiEwC0AItAJiFoBaAKTAJiFoJMA5jGnMJjG2gDTmDmKwMHBhomsFsI4trLJLaP07aepxjjtqmNn2jbWA6TRi1gNbCK4Y0TLJnvch0hrZdpc+COkcShJ4YnyyVVOzjwtO0tVoiOCkJWoXalNnANl2l74U4UIaxPtRe59oq2faXvgTnTAJ0+gkZSKm2M9pK2F8NSQeOnT9pQJbFqbVq9ZRpujGm4O2ect/amoynLZ3dfh00PUzMW9AK2uMH4S3mHbAPOeLbvderJrUO+IHXcRqjqOBekx9QGUg4+RjKW1VGyhK9cAjP/ABM0lihGFqPT64Ua/wD1kza9gXVGViMHOFpv59eBMmZ96O4xjaNBxVNTdw7ndXPEA8TIj3JBPE68wdZtKeyvGTB31ZSSrqGTB5EZOT85namyqu97rk+Lx8TAx4e98Weu7p1zNMcti46VtrSZnFRR5hkH04D6ayStlU1YAknJydSPU/WaB9jigoCbxYnLMys28Txzidsy2KKcsxzyKFQO2WzFzK4M8XXIR9/e0KsWA83TdXQQrOo6VlBXy7+8OfHiJZ7QsS2rboA1UhRnI4a6SHswO9dd4g6jkVOnYiPG7icpp6LTtwVB7RDajpBt78DRvvH/AH1ZvPPYxvilR/dlne7iSPGUwHdYf1U/C9j+TDWwgGzzHGrATkuR1mmPqML8xN8GU+Ki1LDtGv8ADzLujWUyQKAM6Zhhe3PblOmaNlBNjNT7oOkZqW4j9vEuVZr3CC1oJoDbxipZw4Q+VULUBGzb9polsIZsBF7cHJmPdD0ie5zTe4RPcu0qeKJudaJbacaMaW9ne9TH3m3tnRTMUWxMKjWllQIMfvUe3FctnFNsZdLTE40BF7lPhFL7tE92ls9CR3oGL3aOEREoR8W8NaZEdEPdo4REa2kPaFLdQky33pA2yM0mHaTl5bqqmE2yF8ErJgg4xxI4ntnjMc9N0yppgINTUYjyjkWc8PQYlvR2luVGSrndUgZ6k8FH3k7aNrTqqoqaLxWmuSSepxr+vpPPn8uxmLFwrb9Niyg6u5O4D0A+Jzrw9Jq7C/p1BuFjjucHeHHOD3GnLnrpMnteg4ICEBVyCyjSmnMKvXlnnnAwDqxb3wUhcYxhDg5wF1K/fB6lm7StS9lu/bf+5Mo8gU548vrxMpG2NW8fxd8cMbpXQjP1kKx2zcAZVsjjg8DrJr+0tXnTXPDOsXU+D+Vi1uxH+YFUDnnOR+kp9pbVpou4nDUZ46+n8/SQ7zaNWpjeY45gcBKa+vV1GBk/U6/nz/8AcJjunbqHql+w1NUlTwHEHtrofQiFb3qrh38nJQOHqU5fKV1FN3LvjH9J4N0P84QqVJqzg/g7jgOhmmmdu2pvr1t1cZ1Gc/hP04SGu2WQ7rR2nWVk3AVwowN7OCZn9s13yKemBqMYixm+itaVdtA8DJ9ttANznm4uWXnLSy2lgZzDLx/gmbZ3lbTIMrqN6d7GZWU9rqeJkb3vLgrFMP1VybaxdidJorJmHGUGwwzAEiX7XAAwY/H5ssPhOfjmS0R1Mbq0hK1nIGQY5bXe8NTOvH1Eyc98OkoUYnu8RLgR9amZtM2dxAtvOahJIEBjK5xPFEqUwJBeprJt3UAEzdzdeY6zPLzaOePbcps9e0L/AA4dJW09o1BxWSKe1+oM5OUdXE89liAodYX+KrOF6hj5wcTyXhHGODaYkZipgG3Uw5jinC/U84a3APOVhsl6wDa9GMXKjiuBVWGMGUPgVOTSXRFQcY5kNLTwRIm0LfyH0MEXbDiI1dbSBUiPotMNtawR8OOKZO7nAL/zny5a6jF3l/cU3L587ZHDRKY00HLJ4dh3mr2lvhjVpkFMtvr1A79ZE8ajcDBAD8xzHQZ+k5rdNpNswdsOiDxBlm1HLGuhx24/MSDUuVxvU9NBkdcgZ/naX+1dj7zDGCNEHYAfw/OUd7sKoDoDz4fQSsbiLMg0L9eRZTofLwJ5nEsVvSQMEHn007zPvs6qOXI4wOcdt7e4A3TqOGvDMu4xPKrK8r1GGE0zrK0lE1Ygtr9ZEqUq+8QoYZ5dPST9mbHz56p0HIx6khbtqRs62asByAz5Tkj+cZZ3VZKaGjTxvt9usgXF+f8Ap0RjGBnkO8C2UJlmbLccnv0zJ190966iws3VFwQGxqe31lZcMu8TjGekds7nVmYZz5cc4l5bEciM8MjEufKag3FvkZWQDvLLClX3TumSXtlaVtOlNTZidJodhW53gWjFCgqydZVSGzIzvS8Me29s75KaY5yBd7Wzw+0qQ5PGMuxBnJa6pjFqu1anDlJFLaeBrKRq2kAVsysUZRa0/aDdfBOk0uydso/AzynajkHIh7P2g9MhgSJ1Y7nbmuq9sN0McZWXe1FHEiZq22m1ZNG+kS22O1U5ZjD3h7azvdrKRoZlbi5JYnM1dD2YTmWPzjh2BRGm4PpJ7vdPUnw0NGgx+IYhtbCW7UpFqWy88iGhtULa68ZKS1XtHfcFJyHM6tZNyePUG3NZ9DGXsao+FozVsq/4XEVLW6/1F+kWv4Dmo3A6GMV2uRwUH5yZv3K8d0wm2qy/HSPy1ho0K2vao+ND8pY09rrzBHqIFLbFBtOB7x2rbpUGVIilB9b6mw4iQ7w02U4xwMYr7PbGglXWsXXJ1Eq5CRQ1qLGk3hnO4xGP9szW6lQgklH+IngSM66GW3+IFC6qMgtu4P4uWgme2xc+bygZGpI7Hh9dJGrs9xOb3mm3HfGOXEAc+8JNsgndIKnkCMcOEpBt5kwTjQa4568B9oR21Tc+dRoQo7aZOvpF7d+4rnPqr1LpSQB3PXGRgfpGGZs4ABGn01IP86SppIh1QkajTPLOknWTMjEE59f6c4+uknjpUy2kJqx0Hy5aZlZtO6GoB04a8AeklOzZYKJQ3jK2jNjtLwxRlkb97J8qDA4EnnOe4Pwrr8v3nF6IGCfl1hU95x/lKFX+o8Zqz2KgAmrnXiB0mh9/NWhlk0XTMzFeg40G8x68pK2O1Viafhs2RoADmFn2UokUE4IkqpSKiC9AqcEFSDqDxEnOuV1itVIrLepvHEuLeljUyBQoYOZNNWZZ1rhE4NOqtI9N51SpMuDbloDVI2z44Rlt5jhQT/aM/lJFLZF2w0oVPmMfnNJGWWSDdJvSFd6LiXjez17/AKLfMr+8hXexrofFRf5YP5TWVjew+z+0igmq2f7UAYXHGU+xvZhviqndHTnLC62Va6qr+YDkRmZZZY29LmOWu24ttpBlGCIFVWJ4mZT2c2dVQ5Z/T0mqLGLnvo+Om4DwWAPKMLCDTfbLTmtUPLEaOzRyJj2/6wg8Ogrq+yHPwuZCqbGuR8NQ/OX+8YYc9fyhqBl22Rd/6sae0vV/Eh9QZqKtZxwUn+3EHxcjJRvprFYcrJVEqf8AdoBu6a/Yxmnof8moyH+ipn9ZsPBzqAV9RKu+2dVbiiOv0Mjirki2ntCVIS4XHLe5H5y2uHpumQRqJm721qoMeE7pzUgkj+085SJfvRPlLGm3JshkPTBi3Z8nqX4RtpWtKmlR6jYPiNu4x5RMlV2Z4qnwgxUebI54zgA8M/vNPV2OtxVFWuc0qYyFzoWJzrJVrWp1AapA8FDu00XgzD8Rx3hy0VxYil7NVCm8FJAIAAGdSAePPlIdXZaqPMCOJJweWh/Oenrf1ar+HTUIAN9ieRI8oA689eEZuEWoDSuAjZ47vlA7b2fN8oTy/o4fjzZaCqcjTHCPVr8annqPUHj+8l7Z2HUouSgLodQVGcfIcJR1mA0PPryM11Kjek6zqkNkNnXnKe8phqrdznEstnWdWq2KSlsfTHrNLsj2URH8W4IJ4hAeJ7mFymI1az+yNg75B0A5F8y7q0UoEK64HBWOCra6AGLta7u97IUIg0AQ4wO3IwrfaAqLuVNQ2hBBAJ7f0kdpF3e1TU6NeDSqkKh3W6/hbtkcD2jaq1u281XXBwFVgQegbGD9Yxf7JqU8VKJ38fhPxYGvz/PSS6hS5okjRlBOD8SkcQecc/4VDWvKdUZyS3VskyOwPIymt3K1N09cazTWNMtooLHoNZVx0UyRKNJzyku12RVqHyAn0ms2T7Lu2GqkAdBrNTQtqNEYAGn84CRdLlrIbO9i3YDxHx2XUy+tfY61p6shc/7tf/yWr7RxooP/AIn8sSK+0UY+YVVPZTg/XSLo7s74NOmMU6aL6LGffQ3lzg+kYN1RByXYf8WB9eOPtHqN5bVPxjPDJGDJCsudpVkbcYadeokG6vqg83FTx04TV07ZOJdHXln9JL8OnjAVT2wBCSj4YY12chcZzoMSds72NtUqeNVyznXU6D5cJqVorn/poMcMYMSuBzXP7R446K3Y1taOBhRpwkKvbrn4BCNUE+Rs9uYjqk8xH0O04Oen3hmQaVxHQ8pKauOs7HeRd4wlJ6wCSSP/AFBL9MxsRcmAPo/Uzt8dzGgIYWMONbtAas3yhPpIdZzHsaSTV7/eMXNJXGHVWHRgD+cbWqOAEcCdY52FTfbCouhRVZAcE+G3T1z9pSXexqlNadOnh0Vt473kxrkZHMCbMiRquDpJuMPahegtOmFGMsxZyPxdsyjvL2lTfKrvMRrnXHp0mpvLEOMA4lDtL2WqMd5GGnUcfpMbhdtJlNKOl7TVN4gBR2lXdWdC8rA1PIx0O7oGMXbOzqlFt90I5EjUGVlglZ6quadUIuSCqnX7TTDH7ic7GztLBLVXRMKgAJJ1Zmmd2rdMy75JGuF5GOUPfXfd3SygkgucEjlkTrzYl61QOyAqOQPOTwvLsTKadTu2NMipwA4HnGNneEy7yjUHjnOnTEtP/itzVQhmCZ+ZxFs/YitSXcVxgnU45RzHorlNoV9cimA3MlcfvHqQtCQ7O9NyDnChlIP9XD85p7T2ctwAKi75HNjmHfez1vU0A3ca+XT6yuPSeW2HX2cUtvU7iiykg+clGHyOn3m02PbW9BQDUTqSGBLH5cpW3fskRqnm7DQ/aV52Qy6MHHqTC205I2F17UUlG7SBbvwEz9z7Q12/Hx5KMYjVts4D8DH6mFb7IqbxCocciREfR+32rWHmZyf1k239oXPHQyPU2DXOuAOgzGDs9wQCsCae020rDDYj1SiG1plfRgCJkLi2qLjcU9TLjZVZ9CYocy0sjQdf+zSz/tHGLb+Lzor8s/vJi3MJLnJ0jvRy7O0Cw/CAPU/vHDUx3iUzn4sQXccBHpBqqik7w0PUfr1jxRzqpGO/WNEQPFxwMVitomHzHkqHrEnQkI5TrmOi4nTpRDW5jouDOnRmIV2jq3ESdFQJ68YJJnToASkLqZFr7S1wonTobBErMRrG3M6dEAKxkynV0nTowi3Qpt8QBi0FpcAonToEbr2VPO9gQhTUjAnTpROWniGyTp0ZK+uwBgb/AEE6dIqofpEwy4X4hn1nToqccbxQMhRH7a7zyAnToYlXVq0ZVA3ETp0mnB1LVcaxilQXOAIk6HxSSjSAEra+8moiTppZuJnRy3vAeJklWXOQZ06R8KO+IesBlnTo7Q//2Q=="},sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi",params:{LAYERS:"sh_reg_eco",VERSION:"1.3.0"}}}).subscribe(re=>this.map.addLayer(re)),this.layerService.createAsyncLayer({title:"Commissions scolaires anglophones",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",params:{LAYERS:"WMS_MEQ_CS_ANGLO",VERSION:"1.3.0"}}}).subscribe(re=>this.map.addLayer(re)),this.layerService.createAsyncLayer({title:"R\xe9seau routier",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"bgr_v_sous_route_res_sup_act",VERSION:"1.3.0"}}}).subscribe(re=>this.map.addLayer(re)),this.layerService.createAsyncLayer({title:"Lieux habit\xe9s",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"lieuhabite",VERSION:"1.3.0"}}}).subscribe(re=>this.map.addLayer(re)),this.layerService.createAsyncLayer({title:"Avertissements routiers",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"evenements",VERSION:"1.3.0"}}}).subscribe(re=>this.map.addLayer(re)),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",refreshIntervalSec:15,params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"}}).subscribe(re=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles",source:re,metadata:{url:"https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp",extern:!0}}))})}static \u0275fac=function(S){return new(S||J)(o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-legend"]],standalone:!0,features:[o.UHJ],decls:7,vars:10,consts:[["title","Simple Map with a legend list","subtitle","Geo",3,"dependencies"],["codeFolder","geo/legend"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["title","Legends"],[3,"layers","excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.I0R(5,"igo-panel",5),o.wR5(6,"igo-layer-legend-list",6),o.C$Y()()()),2&S&&(o.E7m("dependencies",o.q4q(9,ae)),o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(2),o.E7m("layers",$.map.layers)("excludeBaseLayers",!0)("allowShowAllLegends",!0)("updateLegendOnResolutionChange",!1)("showAllLegendsValue",!1))},dependencies:[L.u,P.I,d.q2F,d.qcl,C.cP,d.wSE],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]})}return J})();const oe=()=>["LanguageService"];let se=(()=>{class J{dataSourceService;layerService;map=new d.yGW({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:6,projection:"EPSG:3857"};store=new d.ym_([],{map:this.map});constructor(u,S){this.dataSourceService=u,this.layerService=S,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:$,baseLayer:!0,visible:!0}))})}static \u0275fac=function(S){return new(S||J)(o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-measure"]],standalone:!0,features:[o.UHJ],decls:6,vars:7,consts:[["title","Measure","subtitle","Geo",3,"dependencies"],["codeFolder","geo/measure"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[3,"store","map"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.wR5(5,"igo-measurer",5),o.C$Y()()),2&S&&(o.E7m("dependencies",o.q4q(6,oe)),o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("store",$.store)("map",$.map))},dependencies:[L.u,P.I,d.q2F,d.qcl,d.yaV],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-measurer[_ngcontent-%COMP%]     mat-divider{position:inherit!important;left:inherit!important;width:160px!important}"]})}return J})();const me=()=>["LanguageService"];let be=(()=>{class J{dataSourceService;layerService;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};constructor(u,S){this.dataSourceService=u,this.layerService=S,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(Pt=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:Pt,baseLayer:!0,visible:!0}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"code_municipalite",alias:"# de la municipalit\xe9e"},{name:"date_observation",excludeFromOgcFilters:!0},{name:"urgence",values:["imm\xe9diate","inconnue"]}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:d.w35.All,filters:{logical:"Or",filters:[{operator:"PropertyIsEqualTo",propertyName:"code_municipalite",expression:"10043"},{operator:"Intersects",geometryName:"the_geom",wkt_geometry:"MULTIPOLYGON(((\n              -8379441.158019895 5844447.897707146,\n              -8379441.158019895 5936172.331649357,\n              -8134842.66750733 5936172.331649357,\n              -8134842.66750733 5844447.897707146,\n              -8379441.158019895 5844447.897707146\n            ), (\n              -8015003 5942074,\n              -8015003 5780349,\n              -7792364 5780349,\n              -7792364 5942074,\n              -8015003 5942074\n            )))"}]}}}).subscribe(Pt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (PropertyIsEqualTo OR Intersects polygon)",source:Pt,style:new te.cp({image:new X.c({radius:5,fill:new K.c({color:"white"}),stroke:new Z.c({color:"orange",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:d.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-21T00:00:00-05:00",end:"2016-01-26T00:00:00-05:00"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2016-02-10T00:00:00-05:00",stepDate:"P2D"}).subscribe(Pt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Step: P2D)",id:"1",source:Pt,style:new te.cp({image:new X.c({radius:5,fill:new K.c({color:"white"}),stroke:new Z.c({color:"red",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:d.w35.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:d.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01T04:00:00-05:00",end:"2016-01-12T16:00:00-05:00"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2016-02-14T20:00:00-05:00",stepDate:"PT4H"}).subscribe(Pt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Step: PT4H)",id:"2",source:Pt,style:new te.cp({image:new X.c({radius:5,fill:new K.c({color:"white"}),stroke:new Z.c({color:"blue",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:d.w35.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:d.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01T00:00:00-05:00",end:"2016-03-31T00:00:00-05:00",displayFormat:"MMMM"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2018-12-31T00:00:00-05:00",stepDate:"P1M"}).subscribe(Pt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Step: P1M)",id:"3",source:Pt,style:new te.cp({image:new X.c({radius:5,fill:new K.c({color:"white"}),stroke:new Z.c({color:"yellow",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:d.w35.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:d.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"2014-01-01T00:00:00-05:00",end:"2019-12-31T00:00:00-05:00",displayFormat:"YYYY"}},minDate:"2014-01-01T00:00:00-05:00",maxDate:"2019-12-31T00:00:00-05:00",stepDate:"P1Y"}).subscribe(Pt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Step: P1Y)",id:"4",source:Pt,style:new te.cp({image:new X.c({radius:5,fill:new K.c({color:"white"}),stroke:new Z.c({color:"green",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:d.w35.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:d.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"today - 2 days",end:"today"}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2025-12-31T00:00:00-05:00",stepDate:"P1D"}).subscribe(Pt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, Interval from Now, Step: P1D)",id:"5",source:Pt,style:new te.cp({image:new X.c({radius:5,fill:new K.c({color:"white"}),stroke:new Z.c({color:"black",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{featureTypes:"vg_observation_v_autre_wmst",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"2.0.0",outputFormat:void 0,outputFormatDownload:"SHP"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:d.w35.Time}],ogcFilters:{enabled:!0,editable:!0,allowedOperatorsType:d.w35.All,filters:{operator:"During",propertyName:"date_observation",begin:"2019-01-01 00:00:00",restrictToStep:!0}},minDate:"2016-01-01T00:00:00-05:00",maxDate:"2025-12-31T00:00:00-05:00",stepDate:"P1M"}).subscribe(Pt=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles (During, RestrictToStep, Step: P1M)",id:"6",source:Pt,style:new te.cp({image:new X.c({radius:5,fill:new K.c({color:"black"}),stroke:new Z.c({color:"red",width:1})})})}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",optionsFromCapabilities:!1,params:{LAYERS:"vg_observation_v_autre_wmst",VERSION:"1.3.0"},sourceFields:[{name:"date_observation",alias:"Date de l'observation",allowedOperatorsType:d.w35.Time}],ogcFilters:{enabled:!0,editable:!0,filters:{operator:"During",propertyName:"date_observation",begin:"2016-01-01 00:00:00",end:"2020-01-01 00:00:00"},allowedOperatorsType:d.w35.Time}}).subscribe(Pt=>{this.map.addLayer(this.layerService.createLayer({title:"Inondations (During)",source:Pt}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",urlWfs:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{LAYERS:"radars_photos",VERSION:"1.3.0"},ogcFilters:{enabled:!0,editable:!0,pushButtons:{selectorType:"pushButton",order:2,groups:[{title:"Nom du group1 - push",name:"1 - push",ids:["id1"]}],bundles:[{id:"id1",title:"R\xe9gions",logical:"Or",vertical:!0,selectors:[{title:"Montr\xe9al & Laval",enabled:!1,tooltip:"Here a tooltip explaining ...",filters:{logical:"Or",filters:[{operator:"PropertyIsEqualTo",propertyName:"region",expression:"Montr\xe9al"},{operator:"PropertyIsEqualTo",propertyName:"region",expression:"Laval"}]}},{title:"Outside Montr\xe9al & Laval",enabled:!1,tooltip:"Here a tooltip explaining ...",filters:{logical:"And",filters:[{operator:"PropertyIsNotEqualTo",propertyName:"region",expression:"Montr\xe9al"},{operator:"PropertyIsNotEqualTo",propertyName:"region",expression:"Laval"}]}}]}]},checkboxes:{selectorType:"checkbox",order:1,groups:[{title:"Nom du group1 - checkbox",name:"1 - checkbox",ids:["id1"]}],bundles:[{id:"id1",title:"Type de radar photo",logical:"Or",selectors:[{title:"Radar photo fixe",enabled:!0,tooltip:"Here a tooltip explaining ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo fixe"}},{title:"Radar photo mobile",enabled:!1,tooltip:"Here a tooltip explaining ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo mobile"}},{title:"Radar photo fixe + feu rouge",enabled:!1,color:"0,200,0",tooltip:"Here a tooltip explaining ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Radar photo fixe et surveillance au feu rouge"}},{title:"Radar feu rouge",enabled:!1,color:"255,0,0",tooltip:"Here a tooltip explaining ...",filters:{operator:"PropertyIsEqualTo",propertyName:"typeAppareil",expression:"Appareil de surveillance au feu rouge"}}]}]},allowedOperatorsType:d.w35.Basic},paramsWFS:{featureTypes:"radars_photos",fieldNameGeometry:"geometry",maxFeatures:1e4,version:"1.1.0",outputFormat:"geojson",outputFormatDownload:"shp"}}).subscribe(Pt=>{this.map.addLayer(this.layerService.createLayer({title:"Filterable WMS layers with predefined filters (push buttons)",source:Pt}))})}static \u0275fac=function(S){return new(S||J)(o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-ogc-filter"]],standalone:!0,features:[o.UHJ],decls:11,vars:7,consts:[["title","Ogc filter","subtitle","Geo",3,"dependencies"],["codeFolder","geo/ogc-filter"],["cols","2","rowHeight","600px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100","overflow-y-auto"],["title","Layers"],[3,"map","layers"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"igo-zoom-button",5),o.C$Y()()(),o.I0R(7,"mat-grid-tile")(8,"div",6)(9,"igo-panel",7),o.wR5(10,"igo-ogc-filterable-list",8),o.C$Y()()()()()()),2&S&&(o.E7m("dependencies",o.q4q(6,me)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(4),o.E7m("map",$.map)("layers",$.map.layers))},dependencies:[L.u,P.I,R.CQ,R.ae,R.cn,d.q2F,d.qcl,C.cP,d.isy]})}return J})(),ke=(()=>{class J{dataSourceService;layerService;map=new d.yGW({overlay:!0,controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};constructor(u,S){this.dataSourceService=u,this.layerService=S}ngOnInit(){this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(u=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:u,baseLayer:!0,visible:!0}))})}ngAfterViewInit(){this.map.overlay.setFeatures([{type:d.YfI,projection:"EPSG:4326",meta:{id:1},properties:{},geometry:{type:"Point",coordinates:[-73,46.6]}},{type:d.YfI,projection:"EPSG:4326",meta:{id:2},properties:{},geometry:{type:"LineString",coordinates:[[-72,47.8],[-73.5,47.4],[-72.4,48.6]]}},{type:d.YfI,projection:"EPSG:4326",meta:{id:3},properties:{},geometry:{type:"Polygon",coordinates:[[[-71,46.8],[-73,47],[-71.2,46.6]]]}}],d.Suj.None)}static \u0275fac=function(S){return new(S||J)(o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-overlay"]],standalone:!0,features:[o.UHJ],decls:5,vars:3,consts:[["title","Overlay","subtitle","Geo"],["codeFolder","geo/overlay"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()()()()),2&S&&(o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map))},dependencies:[L.u,P.I,d.q2F,d.qcl],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}"]})}return J})();const qe=()=>["LanguageService"];let nt=(()=>{class J{layerService;map=new d.yGW({controls:{attribution:{collapsed:!1}}});view={center:[-73,47.2],zoom:9};constructor(u){this.layerService=u,this.layerService.createAsyncLayer({title:"Quebec Base Map",baseLayer:!0,visible:!0,sourceOptions:{type:"xyz",url:"https://geoegl.msp.gouv.qc.ca/carto/tms/1.0.0/carte_gouv_qc_public@EPSG_3857/{z}/{x}/{-y}.png",crossOrigin:"anonymous"}}).subscribe(S=>this.map.addLayer(S)),this.layerService.createAsyncLayer({title:"Emb\xe2cles",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(S=>this.map.addLayer(S)),this.layerService.createAsyncLayer({title:"Radar m\xe9t\xe9o",sourceOptions:{type:"wms",url:"https://geo.meteo.gc.ca/geomet?lang=fr",params:{LAYERS:"RADAR_1KM_RRAI",VERSION:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(S=>this.map.addLayer(S)),this.layerService.createAsyncLayer({title:"A\xe9roports",sourceOptions:{type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq?",params:{layers:"aeroport",version:"1.3.0"},crossOrigin:"anonymous"}}).subscribe(S=>this.map.addLayer(S))}static \u0275fac=function(S){return new(S||J)(o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-print"]],standalone:!0,features:[o.UHJ],decls:14,vars:10,consts:[["title","Print","subtitle","Geo",3,"dependencies"],["codeFolder","geo/print"],["cols","2","rowHeight","800px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"],[3,"map"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"div",5)(7,"igo-rotation-button",6),o.C$Y(),o.I0R(8,"div",7),o.wR5(9,"igo-home-extent-button",8)(10,"igo-geolocate-button",8)(11,"igo-zoom-button",9),o.C$Y()()(),o.I0R(12,"mat-grid-tile"),o.wR5(13,"igo-print",10),o.C$Y()()()()),2&S&&(o.E7m("dependencies",o.q4q(9,qe)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(3),o.E7m("showIfNoRotation",!0)("map",$.map),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(2),o.E7m("map",$.map))},dependencies:[L.u,P.I,R.CQ,R.ae,R.cn,d.cdH,d.eqy,d.q2F,d.i6P,d.qcl,d.eAF],styles:["[_nghost-%COMP%]   igo-print[_ngcontent-%COMP%]{overflow-y:auto;width:100%;height:100%}"]})}return J})();var Ue=r(58264),St=r(62808),Ae=r(80848),Qe=r(36752),_e=r(61252),Ie=r(87048);function je(J,j){if(1&J&&(o.I0R(0,"div")(1,"h1"),o.OEk(2," Query Title : "),o.I0R(3,"span",8),o.OEk(4),o.C$Y()(),o.wR5(5,"igo-feature-details",9),o.C$Y()),2&J){const u=j.$implicit,S=o.GaO(2);o.yG2(4),o.cNF(S.getTitle(u)),o.yG2(),o.E7m("feature",u)}}function Ve(J,j){if(1&J&&(o.SAx(0),o.yuY(1,je,6,2,"div",7),o.k70()),2&J){const u=j.ngIf;o.yG2(),o.E7m("ngForOf",u)}}const ot=()=>[];let lt=(()=>{class J{dataSourceService;layerService;features$=new V.g([]);map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};constructor(u,S){this.dataSourceService=u,this.layerService=S,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:$,baseLayer:!0,visible:!0}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryable:!0,params:{layers:"bgr_v_sous_route_res_sup_act",version:"1.3.0"}}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"WMS",source:$}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryable:!0,queryFormat:d.s5H.HTMLGML2,queryHtmlTarget:d.IlJ.IFRAME,params:{layers:"aeroport",version:"1.3.0"}}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"WMS html with a pre call in GML",source:$}))}),this.layerService.createAsyncLayer({title:"WMS with different query url",sourceOptions:{type:"wms",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",queryable:!0,queryFormat:d.s5H.HTMLGML2,queryHtmlTarget:d.IlJ.IFRAME,queryUrls:[{url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&BBOX={bbox}&CRS=EPSG%3A3857&WIDTH=900&HEIGHT=632&LAYERS=SDA_REGION_S_20K&STYLES=&FORMAT=image%2Fpng&QUERY_LAYERS=SDA_REGION_S_20K&INFO_FORMAT=text%2Fhtml&I=467&J=493"}],queryLayerFeatures:!1,params:{layers:"SDA_MUNIC_S_20K",version:"1.3.0"}}}).subscribe($=>this.map.addLayer($)),this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0,sourceFields:[{name:"name",alias:"Alias name"},{name:"description",alias:"Alias description"}]}).subscribe($=>{this.map.addLayer(this.layerService.createLayer({title:"Vector layer",source:$})),this.addFeatures($)}),this.layerService.createAsyncLayer({title:"Vector tile with different query url",sourceOptions:{type:"mvt",url:"https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf",queryable:!0,queryFormat:d.s5H.HTMLGML2,queryHtmlTarget:d.IlJ.IFRAME,queryUrls:[{url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&BBOX={bbox}&CRS=EPSG%3A3857&WIDTH=900&HEIGHT=632&LAYERS=SDA_REGION_S_20K&STYLES=&FORMAT=image%2Fpng&QUERY_LAYERS=SDA_REGION_S_20K&INFO_FORMAT=text%2Fhtml&I=467&J=493"}],queryLayerFeatures:!1},mapboxStyle:{url:"assets/mapboxStyleExample-vectortile.json",source:"ahocevar"}}).subscribe($=>this.map.addLayer($))}addFeatures(u){const S=new Ue.c({name:"feature1",geometry:new St.c([_e.AF([-72,47.8],"EPSG:4326","EPSG:3857"),_e.AF([-73.5,47.4],"EPSG:4326","EPSG:3857"),_e.AF([-72.4,48.6],"EPSG:4326","EPSG:3857")])}),$=new Ue.c({name:"feature2",geometry:new Ae.c(_e.AF([-73,46.6],"EPSG:4326","EPSG:3857"))}),re=new Ue.c({name:"feature3",geometry:new Qe.cp([[_e.AF([-71,46.8],"EPSG:4326","EPSG:3857"),_e.AF([-73,47],"EPSG:4326","EPSG:3857"),_e.AF([-71.2,46.6],"EPSG:4326","EPSG:3857")]])});u.ol.addFeatures([S,$,re])}handleQueryResults(u){const S=u.features;S.length&&S[0]&&(this.features$.next(S),this.map.queryResultsOverlay.setFeatures(S,d.Suj.None))}getTitle(u){return(0,C.YB)(u)}static \u0275fac=function(S){return new(S||J)(o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-query"]],standalone:!0,features:[o.UHJ],decls:8,vars:9,consts:[["title","Query","subtitle","Geo",3,"dependencies"],["codeFolder","geo/query"],["igoOverlay","","igoQuery","",3,"map","view","queryFeatures","query"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["title","Details"],[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"background-color","#e0e0e0"],[3,"feature"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),o.qCj("query",function(ve){return $.handleQueryResults(ve)}),o.I0R(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.I0R(5,"igo-panel",5),o.yuY(6,Ve,2,1,"ng-container",6),o.wVc(7,"async"),o.C$Y()()()),2&S&&(o.E7m("dependencies",o.q4q(8,ot)),o.yG2(2),o.E7m("map",$.map)("view",$.view)("queryFeatures",!0),o.yG2(2),o.E7m("map",$.map),o.yG2(2),o.E7m("ngIf",o.kDX(7,6,$.features$)))},dependencies:[L.u,P.I,d.q2F,d.qcl,d.Iz2,d.G_h,Ie.s,C.cP,k.u_,k.Iw,d.wP$,k.a],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}"]})}return J})();var Me=r(21124),ct=r(33712),Oe=r(32328),He=r(87848),ze=r(27e3),Rt=r(58752),Ft=r(9204),Et=r(24708),ko=r(1296),so=r(72584);function Si(J,j){if(1&J){const u=o.KQA();o.I0R(0,"button",7),o.qCj("click",function(){o.usT(u);const $=o.GaO();return o.CGJ($.openGuide())}),o.wVc(1,"translate"),o.I0R(2,"span"),o.OEk(3),o.wVc(4,"translate"),o.C$Y(),o.I0R(5,"mat-icon"),o.OEk(6,"description"),o.C$Y()()}if(2&J){const u=o.GaO();o.E7m("disabled",u.loading)("matTooltip",o.kDX(1,3,"igo.integration.aboutTool.trainingGuideTooltip")),o.yG2(3),o.cNF(o.kDX(4,5,"igo.integration.aboutTool.trainingGuide"))}}function bi(J,j){if(1&J&&(o.I0R(0,"button",8),o.wVc(1,"translate"),o.I0R(2,"span"),o.OEk(3),o.wVc(4,"translate"),o.C$Y(),o.I0R(5,"mat-icon"),o.OEk(6,"description"),o.C$Y()()),2&J){const u=o.GaO(),S=o.Gew(5);o.E7m("disabled",u.loading)("matTooltip",o.kDX(1,4,"igo.integration.aboutTool.trainingGuideTooltip"))("matMenuTriggerFor",S),o.yG2(3),o.cNF(o.kDX(4,6,"igo.integration.aboutTool.trainingGuide"))}}function Bi(J,j){if(1&J){const u=o.KQA();o.I0R(0,"button",9),o.qCj("click",function(){const re=o.usT(u).$implicit,ve=o.GaO();return o.CGJ(ve.openGuide(re))}),o.OEk(1),o.C$Y()}if(2&J){const u=j.$implicit,S=o.GaO();o.yG2(),o.oRS(" ",S.formatFileName(u)," ")}}function Ke(J,j){if(1&J&&(o.wR5(0,"igo-custom-html",6),o.wVc(1,"translate")),2&J){const u=o.GaO();o.E7m("html",o.kDX(1,1,u.headerHtml))}}const Ze=J=>({version:J});let dt=class Rs{configService;auth;http;cdRef;languageService;configOptions;get headerHtml(){return this._headerHtml}set headerHtml(j){this._headerHtml=Array.isArray(j)?j.join("\n"):j}get html(){return this._html}set html(j){this._html=Array.isArray(j)?j.join("\n"):j}_discoverTitleInLocale="IGO";discoverTitleInLocale$=(0,ko.of)(this._discoverTitleInLocale);get discoverTitleInLocale(){return this._discoverTitleInLocale}set discoverTitleInLocale(j){this._discoverTitleInLocale=j,this.discoverTitleInLocale$=(0,ko.of)(j)}trainingGuideURLs;effectiveVersion;_html="igo.integration.aboutTool.html";_headerHtml;baseUrlProfil;baseUrlGuide;loading=!1;constructor(j,u,S,$,re){this.configService=j,this.auth=u,this.http=S,this.cdRef=$,this.languageService=re,this.headerHtml=this.languageService.translate.instant("igo.integration.aboutTool.headerHtml"),this.configOptions=this.configService.getConfigs();const ve=this.configOptions.version;this.effectiveVersion=ve?.app||ve?.lib||Ft.WU.lib,this.baseUrlProfil=this.configOptions.storage?.url,this.baseUrlGuide=this.configOptions.depot?.url+this.configOptions.depot?.guideUrl}ngOnInit(){this.auth.authenticated&&this.configOptions.context?.url?this.http.get(this.baseUrlProfil).subscribe(j=>{this.trainingGuideURLs=j.guides,this.cdRef.detectChanges()}):this.auth.authenticated&&!this.configOptions.context?.url&&this.configOptions.depot?.trainingGuides&&(this.trainingGuideURLs=this.configOptions.depot?.trainingGuides)}openGuide(j){this.loading=!0;const u=j?this.baseUrlGuide+j+"?":this.baseUrlGuide+this.trainingGuideURLs[0]+"?";this.http.get(u,{responseType:"blob"}).subscribe(()=>{this.loading=!1,window.open(u,"_blank"),this.cdRef.detectChanges()})}formatFileName(j){const u=(j=j.split("_").join(" ")).indexOf(".");return j.slice(0,u)}static \u0275fac=function(u){return new(u||Rs)(o.GI1(Ft.aW),o.GI1(Rt.oj),o.GI1(ct.KK),o.GI1(o.kD9),o.GI1(Et.ov))};static \u0275cmp=o.In1({type:Rs,selectors:[["igo-about-tool"]],inputs:{headerHtml:"headerHtml",html:"html",discoverTitleInLocale:"discoverTitleInLocale",trainingGuideURLs:"trainingGuideURLs"},standalone:!0,features:[o.UHJ],decls:10,vars:11,consts:[["mat-raised-button","","tourToStart","global","menuIsOpen","true","styleButton","raised",3,"discoverTitleInLocale$"],["class","training-guide-button","mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click",4,"ngIf"],["class","training-guide-button","mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["class","mat-typography",3,"html",4,"ngIf"],[1,"mat-typography",3,"html"],["mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",1,"training-guide-button",3,"disabled","matTooltip","click"],["mat-raised-button","","tooltip-position","below","matTooltipShowDelay","500",1,"training-guide-button",3,"disabled","matTooltip","matMenuTriggerFor"],["mat-menu-item","",3,"click"]],template:function(u,S){1&u&&(o.wR5(0,"p")(1,"igo-interactive-tour",0),o.yuY(2,Si,7,7,"button",1)(3,bi,7,8,"button",2),o.I0R(4,"mat-menu",null,3),o.yuY(6,Bi,2,1,"button",4),o.C$Y(),o.yuY(7,Ke,2,3,"igo-custom-html",5),o.wR5(8,"igo-custom-html",6),o.wVc(9,"translate")),2&u&&(o.yG2(),o.E7m("discoverTitleInLocale$",S.discoverTitleInLocale$),o.yG2(),o.E7m("ngIf",S.auth.authenticated&&S.trainingGuideURLs&&1===S.trainingGuideURLs.length),o.yG2(),o.E7m("ngIf",S.auth.authenticated&&S.trainingGuideURLs&&S.trainingGuideURLs.length>1),o.yG2(3),o.E7m("ngForOf",S.trainingGuideURLs),o.yG2(),o.E7m("ngIf",""!==S.headerHtml),o.yG2(),o.E7m("html",o.g7$(9,6,S.html,o.S45(9,Ze,S.effectiveVersion))))},dependencies:[C.Er,k.u_,w.oJ,w.Gw,ze.KO,ze.a4,Oe.oB,Oe.qL,He._A,He.aM,He.OQ,He.yG,k.Iw,C.YM,Et._s,so.sD],styles:["igo-interactive-tour[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:20px}.training-guide-button[_ngcontent-%COMP%]{margin-left:5px;background-color:#1976d2;color:#fff;padding:0 12px}"]})};dt=(0,Me.UN)([(0,C.aA)({name:"about",title:"igo.integration.tools.about",icon:"help"}),(0,Me.YR)("design:paramtypes",[Ft.aW,Rt.oj,ct.KK,o.kD9,Et.ov])],dt);var lo=r(35876),Ht=r(37496);let mt=(()=>{class J{mapService;projectionService;storageService;configService;get showAllLegendsValue(){return this._legendToolShowAll}set showAllLegendsValue(u){this._legendToolShowAll=u}_legendToolShowAll;get map(){return this._map}_map;constructor(u,S,$,re){this.mapService=u,this.projectionService=S,this.storageService=$,this.configService=re,this._map=new d.yGW({controls:{scaleLine:!0,attribution:{collapsed:!0}}},this.storageService,this.configService),this.mapService.setMap(this.map)}static \u0275fac=function(S){return new(S||J)(o.CoB(d.u00),o.CoB(d.qME),o.CoB(e.yQ),o.CoB(Ft.aW))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),Eo=(()=>{class J{get catalogStore(){return this._catalogStore}_catalogStore;catalogItemsStores=new Map;constructor(u){this._catalogStore=new C.qc([]),u.authenticate$.subscribe(()=>{this.clearCatalogItemsStores()})}getCatalogItemsStore(u){return this.catalogItemsStores.get(u.id)}setCatalogItemsStore(u,S){this.catalogItemsStores.set(u.id,S)}clearCatalogItemsStores(){this.catalogItemsStores.clear()}static \u0275fac=function(S){return new(S||J)(o.CoB(Rt.oj))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();function Lt(J,j){if(1&J&&o.wR5(0,"igo-catalog-browser",1),2&J){const u=j.ngIf,S=o.GaO();o.E7m("catalog",S.catalog)("store",u)("map",S.map)("toggleCollapsedGroup",S.toggleCollapsedGroup)}}let Ho=class Ls{catalogService;catalogState;mapState;authService;catalog;store$=new V.g(void 0);catalog$$;toggleCollapsedGroup=!0;get map(){return this.mapState.map}constructor(j,u,S,$){this.catalogService=j,this.catalogState=u,this.mapState=S,this.authService=$}ngOnInit(){const u=this.catalogState.catalogStore.stateView.firstBy$($=>!0===$.state.selected);this.catalog$$=(0,lo.E)([u,this.authService.authenticate$]).subscribe(([$,re])=>{this.catalog=$.entity,this.loadCatalogItems(this.catalog)})}ngOnDestroy(){this.catalog$$.unsubscribe()}loadCatalogItems(j){let u=this.catalogState.getCatalogItemsStore(j);void 0===u?(u=new C.qc([]),this.catalogState.setCatalogItemsStore(j,u),this.catalogService.loadCatalogItems(j).pipe((0,Ht.U)(1)).subscribe(S=>{u.load(S),this.store$.next(u)})):this.store$.next(u)}static \u0275fac=function(u){return new(u||Ls)(o.GI1(d.oxI),o.GI1(Eo),o.GI1(mt),o.GI1(Rt.oj))};static \u0275cmp=o.In1({type:Ls,selectors:[["igo-catalog-browser-tool"]],inputs:{toggleCollapsedGroup:"toggleCollapsedGroup"},standalone:!0,features:[o.UHJ],decls:2,vars:3,consts:[[3,"catalog","store","map","toggleCollapsedGroup",4,"ngIf"],[3,"catalog","store","map","toggleCollapsedGroup"]],template:function(u,S){1&u&&(o.yuY(0,Lt,1,4,"igo-catalog-browser",0),o.wVc(1,"async")),2&u&&o.E7m("ngIf",o.kDX(1,1,S.store$))},dependencies:[k.u_,d.iOV,k.a],encapsulation:2,changeDetection:0})};Ho=(0,Me.UN)([(0,C.aA)({name:"catalogBrowser",title:"igo.integration.tools.catalog",parent:"catalog"}),(0,Me.YR)("design:paramtypes",[d.oxI,Eo,mt,Rt.oj])],Ho);var Ro=function(J){return J.layer="layer",J.context="context",J}(Ro||{}),xt=function(J){return J.import="import",J.export="export",J}(xt||{});let zt=(()=>{class J{importExportType$=new V.g(Ro.layer);selectedMode$=new V.g(xt.import);exportOptions$=new V.g(void 0);setImportExportType(u){this.importExportType$.next(u)}setMode(u){this.selectedMode$.next(u)}setsExportOptions(u){this.exportOptions$.next(u)}static \u0275fac=function(S){return new(S||J)};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),Ut=(()=>{class J{toolService;importExportState;get toolbox(){return this.toolService.toolbox}openSidenav$=new V.g(void 0);constructor(u,S){this.toolService=u,this.importExportState=S}toolToActivateFromOptions(u){if(u){if("importExport"===u.tool){let S=this.importExportState.exportOptions$.value;S?(S.layers=u.options.layers,S.featureInMapExtent=u.options.featureInMapExtent):S={layers:u.options.layers,featureInMapExtent:u.options.featureInMapExtent},this.importExportState.setsExportOptions(S),this.importExportState.setMode(xt.export)}this.toolbox.getTool(u.tool)&&(this.toolbox.activateTool(u.tool),this.openSidenav$.next(!0))}}static \u0275fac=function(S){return new(S||J)(o.CoB(C.IF),o.CoB(zt))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),ei=class Gs{catalogService;catalogState;toolState;storageService;get store(){return this.catalogState.catalogStore}addCatalogAllowed=!1;predefinedCatalogs=[];constructor(j,u,S,$){this.catalogService=j,this.catalogState=u,this.toolState=S,this.storageService=$}ngOnInit(){0===this.store.count&&this.loadCatalogs()}onCatalogSelectChange(j){!1!==j.selected&&this.toolState.toolbox.activateTool("catalogBrowser")}loadCatalogs(){this.catalogService.loadCatalogs().pipe((0,Ht.U)(1)).subscribe(j=>{this.store.clear(),this.store.load(j.concat(this.storageService.get("addedCatalogs")||[]))})}static \u0275fac=function(u){return new(u||Gs)(o.GI1(d.oxI),o.GI1(Eo),o.GI1(Ut),o.GI1(e.yQ))};static \u0275cmp=o.In1({type:Gs,selectors:[["igo-catalog-library-tool"]],inputs:{addCatalogAllowed:"addCatalogAllowed",predefinedCatalogs:"predefinedCatalogs"},standalone:!0,features:[o.UHJ],decls:1,vars:3,consts:[[3,"predefinedCatalogs","addCatalogAllowed","store","catalogSelectChange"]],template:function(u,S){1&u&&(o.I0R(0,"igo-catalog-library",0),o.qCj("catalogSelectChange",function(re){return S.onCatalogSelectChange(re)}),o.C$Y()),2&u&&o.E7m("predefinedCatalogs",S.predefinedCatalogs)("addCatalogAllowed",S.addCatalogAllowed)("store",S.store)},dependencies:[d.kvX],encapsulation:2,changeDetection:0})};ei=(0,Me.UN)([(0,C.aA)({name:"catalog",title:"igo.integration.tools.catalog",icon:C.er}),(0,Me.YR)("design:paramtypes",[d.oxI,Eo,Ut,e.yQ])],ei);var et=r(37240);let he=class $s{toolState;constructor(j){this.toolState=j}submitSuccessed(){this.toolState.toolbox.activatePreviousTool()}static \u0275fac=function(u){return new(u||$s)(o.GI1(Ut))};static \u0275cmp=o.In1({type:$s,selectors:[["igo-context-editor-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:0,consts:[["igoContextEditBinding","",3,"submitSuccessed"]],template:function(u,S){1&u&&(o.I0R(0,"igo-context-edit",0),o.qCj("submitSuccessed",function(){return S.submitSuccessed()}),o.C$Y())},dependencies:[et.cl,et.SS],encapsulation:2})};he=(0,Me.UN)([(0,C.aA)({name:"contextEditor",title:"igo.integration.tools.contexts",icon:"star",parent:"contextManager"}),(0,Me.YR)("design:paramtypes",[Ut])],he);let pe=class ks{toolState;mapState;toolToOpenOnContextChange="mapTools";get map(){return this.mapState.map}constructor(j,u){this.toolState=j,this.mapState=u}editContext(){this.toolState.toolbox.activateTool("contextEditor")}managePermissions(){this.toolState.toolbox.activateTool("contextPermissionManager")}static \u0275fac=function(u){return new(u||ks)(o.GI1(Ut),o.GI1(mt))};static \u0275cmp=o.In1({type:ks,selectors:[["igo-context-manager-tool"]],inputs:{toolToOpenOnContextChange:"toolToOpenOnContextChange"},standalone:!0,features:[o.UHJ],decls:1,vars:1,consts:[["igoContextListBinding","",3,"map","edit","managePermissions"]],template:function(u,S){1&u&&(o.I0R(0,"igo-context-list",0),o.qCj("edit",function(){return S.editContext()})("managePermissions",function(){return S.managePermissions()}),o.C$Y()),2&u&&o.E7m("map",S.map)},dependencies:[et.W2,et.AX],encapsulation:2})};pe=(0,Me.UN)([(0,C.aA)({name:"contextManager",title:"igo.integration.tools.contexts",icon:"star"}),(0,Me.YR)("design:paramtypes",[Ut,mt])],pe);let Pe=class As{static \u0275fac=function(u){return new(u||As)};static \u0275cmp=o.In1({type:As,selectors:[["igo-context-permission-manager-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:0,consts:[["igoContextPermissionsBinding",""]],template:function(u,S){1&u&&o.wR5(0,"igo-context-permissions",0)},dependencies:[et.KS,et.Sm],encapsulation:2})};Pe=(0,Me.UN)([(0,C.aA)({name:"contextPermissionManager",title:"igo.integration.tools.contexts",icon:"star",parent:"contextManager"})],Pe);let $e=(()=>{class J{keyword$=new V.g("");sortAlpha$=new V.g(void 0);onlyVisible$=new V.g(void 0);selectedTab$=new V.g(void 0);setKeyword(u){this.keyword$.next(u)}setSortAlpha(u){this.sortAlpha$.next(u)}setOnlyVisible(u){this.onlyVisible$.next(u)}setSelectedTab(u){this.selectedTab$.next(u)}getLayerListControls(){return{keyword:this.keyword$.value,onlyVisible:this.onlyVisible$.value,sortAlpha:this.sortAlpha$.value}}static \u0275fac=function(S){return new(S||J)};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),ut=class Bs{mapState;layerListToolState;get map(){return this.mapState.map}get layerListControls(){return this.layerListToolState.getLayerListControls()}constructor(j,u){this.mapState=j,this.layerListToolState=u}static \u0275fac=function(u){return new(u||Bs)(o.GI1(mt),o.GI1($e))};static \u0275cmp=o.In1({type:Bs,selectors:[["igo-context-share-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:1,consts:[[3,"map"]],template:function(u,S){1&u&&o.wR5(0,"igo-share-map",0),2&u&&o.E7m("map",S.map)},dependencies:[et.mE],encapsulation:2})};ut=(0,Me.UN)([(0,C.aA)({name:"shareMap",title:"igo.integration.tools.shareMap",icon:"share"}),(0,Me.YR)("design:paramtypes",[mt,$e])],ut);let st=(()=>{class J{contextService;toolService;toolState;languageService;context$=new V.g(void 0);constructor(u,S,$,re){this.contextService=u,this.toolService=S,this.toolState=$,this.languageService=re,this.contextService.context$.subscribe(ve=>{this.onContextChange(ve)}),this.contextService.toolsChanged$.subscribe(ve=>{this.updateTools(ve)})}setContext(u){this.updateTools(u),this.context$.next(u)}updateTools(u){const S=this.toolState.toolbox,$=[];(u.tools||[]).forEach(ve=>{const Be=this.toolService.getTool(ve.name);if(void 0===Be)return;const rt=Object.assign({},Be.options||{},ve.options||{}),Ct=Object.assign({},Be,ve,{options:rt});$.push(Ct)}),$.forEach(ve=>{if(ve.parent){const Be=$.findIndex(rt=>rt.name===ve.parent);-1!==Be&&($[Be].children=[],$[Be].children.push(ve.name))}}),S.setTools($),S.setToolbar(u.toolbar||[]),this.contextService.setTools([].concat($)),this.contextService.setToolbar(u.toolbar||[])}onContextChange(u){void 0!==u&&this.setContext(u)}static \u0275fac=function(S){return new(S||J)(o.CoB(et.M9),o.CoB(C.IF),o.CoB(Ut),o.CoB(Et.ov))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();var $t=r(93020);let to=(()=>{class J{mapState;zoomToActiveRoute$=new y.E;stopsStore=new d.SYK([]);stopsFeatureStore;routesFeatureStore;stepFeatureStore;debounceTime=200;constructor(u){this.mapState=u,this.stopsFeatureStore=new d.czr([],{map:this.mapState.map}),this.routesFeatureStore=new d.aWp([],{map:this.mapState.map}),this.stepFeatureStore=new d.qM$([],{map:this.mapState.map}),this.mapState.map.ol.once("rendercomplete",()=>{this.stopsFeatureStore.empty$.subscribe(S=>{this.stopsFeatureStore.layer?.options&&(this.stopsFeatureStore.layer.options.showInLayerList=!S)}),this.routesFeatureStore.empty$.subscribe(S=>{this.routesFeatureStore.layer?.options&&(this.routesFeatureStore.layer.options.showInLayerList=!S)})}),this.mapState.map.layers$.subscribe(()=>{this.mapState.map.getLayerById("igo-direction-stops-layer")||(this.stopsStore.deleteMany(this.stopsStore.all()),this.stopsFeatureStore.deleteMany(this.stopsFeatureStore.all())),this.mapState.map.getLayerById("igo-direction-route-layer")||this.routesFeatureStore.deleteMany(this.routesFeatureStore.all())})}static \u0275fac=function(S){return new(S||J)(o.CoB(mt))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),Ot=class Us{directionState;mapState;languageService;messageService;storageService;contextState;authService;currentContextUri;get stopsStore(){return this.directionState.stopsStore}get debounceTime(){return this.directionState.debounceTime}get stopsFeatureStore(){return this.directionState.stopsFeatureStore}get routesFeatureStore(){return this.directionState.routesFeatureStore}get stepFeatureStore(){return this.directionState.stepFeatureStore}get zoomToActiveRoute$(){return this.directionState.zoomToActiveRoute$}get map(){return this.mapState.map}constructor(j,u,S,$,re,ve,Be){this.directionState=j,this.mapState=u,this.languageService=S,this.messageService=$,this.storageService=re,this.contextState=ve,this.authService=Be}ngOnInit(){this.storageService.get("direction.warning.shown")||(this.messageService.info("igo.integration.directions.warning.message","igo.integration.directions.warning.title",{timeOut:2e4}),this.storageService.set("direction.warning.shown",!0,e.Ab.SESSION)),this.contextState.context$.subscribe(u=>{this.authService.authenticated||(this.currentContextUri=u.uri)})}static \u0275fac=function(u){return new(u||Us)(o.GI1(to),o.GI1(mt),o.GI1(Et.ov),o.GI1($t.mi),o.GI1(e.yQ),o.GI1(st),o.GI1(Rt.oj))};static \u0275cmp=o.In1({type:Us,selectors:[["igo-directions-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:7,consts:[[3,"contextUri","debounce","stopsStore","stopsFeatureStore","stepFeatureStore","routesFeatureStore","zoomToActiveRoute$"]],template:function(u,S){1&u&&o.wR5(0,"igo-directions",0),2&u&&o.E7m("contextUri",S.currentContextUri)("debounce",S.debounceTime)("stopsStore",S.stopsStore)("stopsFeatureStore",S.stopsFeatureStore)("stepFeatureStore",S.stepFeatureStore)("routesFeatureStore",S.routesFeatureStore)("zoomToActiveRoute$",S.zoomToActiveRoute$)},dependencies:[d.aw9,O.U],encapsulation:2})};Ot=(0,Me.UN)([(0,C.aA)({name:"directions",title:"igo.integration.tools.directions",icon:"directions"}),(0,Me.YR)("design:paramtypes",[to,mt,Et.ov,$t.mi,e.yQ,st,Rt.oj])],Ot);let yt=(()=>{class J{mapState;stores=[];layersID=[];drawControls=[];activeDrawingLayer;constructor(u){this.mapState=u,this.mapState.map.layers$.subscribe(()=>{this.layersID.forEach(S=>{if(!this.mapState.map.getLayerById(S)){let $=this.stores.find(ve=>ve.layer.id===S);$.deleteMany($.all()),this.stores.splice(this.stores.indexOf($,0),1),this.layersID.splice(this.layersID.indexOf(S,0),1);let re=this.drawControls.findIndex(ve=>ve[0]===S);this.drawControls.splice(re,1)}})});for(let S of this.stores)S=new d.ym_([],{map:this.mapState.map})}static \u0275fac=function(S){return new(S||J)(o.CoB(mt))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),Gt=class Ys{drawState;mapState;get stores(){return this.drawState.stores}get map(){return this.mapState.map}get layersID(){return this.drawState.layersID}get drawControls(){return this.drawState.drawControls}set drawControls(j){this.drawState.drawControls=j}get activeDrawingLayer(){return this.drawState.activeDrawingLayer}set activeDrawingLayer(j){this.drawState.activeDrawingLayer=j}addLayersID(j){this.layersID.push(j)}addDrawControls(j){this.drawControls=j}constructor(j,u){this.drawState=j,this.mapState=u}static \u0275fac=function(u){return new(u||Ys)(o.GI1(yt),o.GI1(mt))};static \u0275cmp=o.In1({type:Ys,selectors:[["igo-drawing-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:4,consts:[[3,"stores","map","activeDrawingLayer","drawControls","layersIDEvent","drawControlsEvent","activeLayerChange"]],template:function(u,S){1&u&&(o.I0R(0,"igo-draw",0),o.qCj("layersIDEvent",function(re){return S.addLayersID(re)})("drawControlsEvent",function(re){return S.addDrawControls(re)})("activeLayerChange",function(re){return S.activeDrawingLayer=re}),o.C$Y()),2&u&&o.E7m("stores",S.stores)("map",S.map)("activeDrawingLayer",S.activeDrawingLayer)("drawControls",S.drawControls)},dependencies:[d.Se2],encapsulation:2,changeDetection:0})};Gt=(0,Me.UN)([(0,C.aA)({name:"draw",title:"igo.integration.tools.draw",icon:"stylus_note"}),(0,Me.YR)("design:paramtypes",[yt,mt])],Gt);var vo=r(53291);function sn(J="300ms",j="ease-in-out"){return(0,vo.gV)("toolSlideInOut",[(0,vo.K2)("enter",(0,vo.wb)({transform:"translateX(100%)"})),(0,vo.aK)("void => enter",(0,vo.Cs)(J+" "+j))])}let Oi=class Vs{mapState;get map(){return this.mapState.map}get layer(){for(const j of this.map.layers)if(!0===j.options.active)return j}animate="enter";constructor(j){this.mapState=j}static \u0275fac=function(u){return new(u||Vs)(o.GI1(mt))};static \u0275cmp=o.In1({type:Vs,selectors:[["igo-active-ogc-filter-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:4,consts:[[3,"map","layer","header"]],template:function(u,S){1&u&&o.wR5(0,"igo-ogc-filterable-item",0),2&u&&o.E7m("map",S.map)("layer",S.layer)("header",!1)("@toolSlideInOut",S.animate)},dependencies:[d.__k],encapsulation:2,data:{animation:[sn()]}})};function an(J="300ms",j="ease-in-out"){return(0,vo.gV)("toolSlideInOut",[(0,vo.K2)("enter",(0,vo.wb)({transform:"translateX(100%)"})),(0,vo.aK)("void => enter",(0,vo.Cs)(J+" "+j))])}Oi=(0,Me.UN)([(0,C.aA)({name:"activeOgcFilter",title:"igo.integration.tools.ogcFilter",icon:"filter",parent:"mapTools"}),(0,Me.YR)("design:paramtypes",[mt])],Oi);let ti=class js{mapState;get map(){return this.mapState.map}get layer(){for(const j of this.map.layers)if(!0===j.options.active)return j}animate="enter";constructor(j){this.mapState=j}static \u0275fac=function(u){return new(u||js)(o.GI1(mt))};static \u0275cmp=o.In1({type:js,selectors:[["igo-active-time-filter-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:3,consts:[[3,"layer","header"]],template:function(u,S){1&u&&o.wR5(0,"igo-time-filter-item",0),2&u&&o.E7m("layer",S.layer)("header",!1)("@toolSlideInOut",S.animate)},dependencies:[d.gpx],encapsulation:2,data:{animation:[an()]}})};ti=(0,Me.UN)([(0,C.aA)({name:"activeTimeFilter",title:"igo.integration.tools.timeFilter",icon:"history",parent:"mapTools"}),(0,Me.YR)("design:paramtypes",[mt])],ti);let oi=class Ks{constructor(){}static \u0275fac=function(u){return new(u||Ks)};static \u0275cmp=o.In1({type:Ks,selectors:[["igo-ogc-filter-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:0,consts:[["igoOgcFilterableListBinding",""]],template:function(u,S){1&u&&o.wR5(0,"igo-ogc-filterable-list",0)},dependencies:[d.isy,d.E9h],encapsulation:2})};oi=(0,Me.UN)([(0,C.aA)({name:"ogcFilter",title:"igo.integration.tools.ogcFilter",icon:"filter"}),(0,Me.YR)("design:paramtypes",[])],oi);var ii=r(12396),ni=r(91088),ri=r(44816),Lo=r(94364),si=r(78600),Ii=r(53404);let wi=(()=>{class J{igoStorageService;get storageService(){return this.igoStorageService}constructor(u){this.igoStorageService=u}static \u0275fac=function(S){return new(S||J)(o.CoB(e.yQ))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();var Ui=r(864),mo=(r(32256),r(30816)),Bt=r.n(mo),ho=r(40604);function ai(J,j){J.entityStore.getStrategyOfType(d.kj0).setMotion(j.get("zoomAuto")?d.Suj.Default:d.Suj.None)}function Ti(J,j,u,S,$,re,ve,Be,rt,Ct){const vt=[{id:"zoomAuto",checkbox:!0,title:"igo.integration.workspace.zoomAuto.title",tooltip:"igo.integration.workspace.zoomAuto.tooltip",checkCondition:$,handler:()=>{ai(J,ve),ve.set("zoomAuto",!ve.get("zoomAuto"))}},{id:"filterInMapExtent",checkbox:!0,title:"igo.integration.workspace.inMapExtent.title",tooltip:(0,d.wvY)(J),checkCondition:j,handler:()=>j.next(!j.value)},{id:"selectedOnly",checkbox:!0,title:"igo.integration.workspace.selected.title",tooltip:"igo.integration.workspace.selected.tooltip",checkCondition:u,handler:()=>u.next(!u.value)},{id:"clearselection",icon:"deselect",title:"igo.integration.workspace.clearSelection.title",tooltip:"igo.integration.workspace.clearSelection.tooltip",handler:ft=>{ft.entityStore.state.updateMany(ft.entityStore.view.all(),{selected:!1})},args:[J],availability:ft=>(0,d.UfW)(ft)},{id:"featureDownload",icon:"file_save",title:"igo.integration.workspace.download.title",tooltip:"igo.integration.workspace.download.tooltip",handler:ft=>{const Pt=ft.entityStore.getStrategyOfType(C.qq),Do=ft.entityStore.getStrategyOfType(C.xx).active?[ft.layer.id]:[];Ct.toolToActivateFromOptions({tool:"importExport",options:{layers:[ft.layer.id],featureInMapExtent:Pt.active,layersWithSelection:Do}})},args:[J]},{id:"ogcFilter",icon:"filter_alt",title:"igo.integration.workspace.ogcFilter.title",tooltip:"igo.integration.workspace.ogcFilter.tooltip",handler:(ft,Pt)=>{Pt.activateWidget(ft,{map:Pt.map,layer:Pt.layer})},args:[S,J]},{id:"maximize",title:Be.translate.instant("igo.integration.workspace.maximize"),tooltip:Be.translate.instant("igo.integration.workspace.maximizeTooltip"),icon:"resize",display:()=>re.pipe((0,ho.k)(ft=>!ft&&!rt.isMobile())),handler:()=>{rt.isMobile()||re.next(!0)}},{id:"standardExtent",title:Be.translate.instant("igo.integration.workspace.standardExtent"),tooltip:Be.translate.instant("igo.integration.workspace.standardExtentTooltip"),icon:"resize",display:()=>re.pipe((0,ho.k)(ft=>ft&&!rt.isMobile())),handler:()=>{re.next(!1)}},{id:"print",icon:"print",title:"igo.integration.workspace.print.title",tooltip:"igo.integration.workspace.print.tooltip",handler:ft=>{const Pt=`${ft.layer.title} (${function Bo(J,j){return Bt()(J).format(j)}(new Date,"YYYY-MM-DD-HH_mm")})`,_t=new Ui.default("landscape"),Do="{total_pages_count_string}";_t.text(Pt,14,20),_t.autoTable({startY:25,tableWidth:"wrap",html:"#currentWorkspaceTable",horizontalPageBreak:!0,styles:{cellPadding:.5,minCellWidth:20,fontSize:6},didDrawPage:ki=>{let Ko="Page "+_t.internal.getNumberOfPages();"function"==typeof _t.putTotalPages&&(Ko=Ko+" / "+Do),_t.setFontSize(6);const en=_t.internal.pageSize,Jn=en.height?en.height:en.getHeight();_t.text(Ko,ki.settings.margin.left,Jn-10)}}),"function"==typeof _t.putTotalPages&&_t.putTotalPages(Do),_t.save(`${Pt}.pdf`)},args:[J]}];let Kt=J.layer.dataSource.options.ogcFilters?.enabled?vt:vt.filter(ft=>"ogcFilter"!==ft.id);return Kt=!1!==J.layer.options.workspace.printable?vt:vt.filter(ft=>"print"!==ft.id),Kt}let co=(()=>{class J{ogcFilterWidget;storageState;languageService;mediaService;toolState;maximize$;zoomAuto$=new V.g(!1);storageChange$$;get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(u,S,$,re,ve){this.ogcFilterWidget=u,this.storageState=S,this.languageService=$,this.mediaService=re,this.toolState=ve,this.maximize$=new V.g(this.storageService.get("workspaceMaximize"))}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(u,S,$){const re=this.buildActions(u,S,$);u.actionStore.load(re)}buildActions(u,S,$){return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Ii.O)(re=>"zoomAuto"!==re?.key||re?.event===e.Om.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),ai(u,this.storageService)}),Ti(u,S,$,this.ogcFilterWidget,this.zoomAuto$,this.maximize$,this.storageService,this.languageService,this.mediaService,this.toolState)}static \u0275fac=function(S){return new(S||J)(o.CoB(d.Kwu),o.CoB(wi),o.CoB(Et.ov),o.CoB(c.QB),o.CoB(Ut))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),Yi=(()=>{class J{storageState;languageService;toolState;mediaService;maximize$;zoomAuto$=new V.g(!1);storageChange$$;get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(u,S,$,re){this.storageState=u,this.languageService=S,this.toolState=$,this.mediaService=re,this.maximize$=new V.g(this.storageService.get("workspaceMaximize"))}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(u,S,$){const re=this.buildActions(u,S,$);u.actionStore.load(re)}buildActions(u,S,$){return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Ii.O)(re=>"zoomAuto"!==re?.key||re?.event===e.Om.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),ai(u,this.storageService)}),Ti(u,S,$,void 0,this.zoomAuto$,this.maximize$,this.storageService,this.languageService,this.mediaService,this.toolState)}static \u0275fac=function(S){return new(S||J)(o.CoB(wi),o.CoB(Et.ov),o.CoB(Ut),o.CoB(c.QB))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),at=(()=>{class J{ogcFilterWidget;storageState;languageService;mediaService;toolState;maximize$;selectOnlyCheckCondition$=new V.g(!1);zoomAuto$=new V.g(!1);storageChange$$;get storageService(){return this.storageState.storageService}get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(u,S,$,re,ve){this.ogcFilterWidget=u,this.storageState=S,this.languageService=$,this.mediaService=re,this.toolState=ve,this.maximize$=new V.g(this.storageService.get("workspaceMaximize"))}ngOnDestroy(){this.storageChange$$&&this.storageChange$$.unsubscribe()}loadActions(u,S,$){const re=this.buildActions(u,S,$);u.actionStore.load(re)}buildActions(u,S,$){return this.zoomAuto$.next(this.zoomAuto),this.storageChange$$=this.storageService.storageChange$.pipe((0,Ii.O)(re=>"zoomAuto"!==re?.key||re?.event===e.Om.CLEARED)).subscribe(()=>{this.zoomAuto$.next(this.zoomAuto),ai(u,this.storageService)}),Ti(u,S,$,this.ogcFilterWidget,this.zoomAuto$,this.maximize$,this.storageService,this.languageService,this.mediaService,this.toolState)}static \u0275fac=function(S){return new(S||J)(o.CoB(d.Kwu),o.CoB(wi),o.CoB(Et.ov),o.CoB(c.QB),o.CoB(Ut))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),go=(()=>{class J{featureActionsService;wfsActionsService;editionActionsService;storageService;workspacePanelExpanded=!1;workspaceEnabled$=new V.g(!1);rowsInMapExtentCheckCondition$=new V.g(!0);selectOnlyCheckCondition$=new V.g(!1);workspaceMaximize$;actionMaximize$$=[];rowsInMapExtentCheckCondition$$;selectOnlyCheckCondition$$;activeWorkspace$$;activeWorkspaceWidget$$;activeWorkspaceWidget$=new V.g(void 0);workspace$=new V.g(void 0);get store(){return this._store}_store;get workspaceSelection(){return this.workspace$.value?this.workspace$.value?.entityStore.stateView.manyBy(u=>!0===u.state.selected):[]}get workspaceSelection$(){return this.workspace$.value?this.workspace$.value?.entityStore?.stateView.manyBy$(u=>!0===u.state.selected):(0,ko.of)([])}constructor(u,S,$,re){this.featureActionsService=u,this.wfsActionsService=S,this.editionActionsService=$,this.storageService=re,this.workspaceMaximize$=new V.g(this.storageService.get("workspaceMaximize")),this.initWorkspaces()}initWorkspaces(){this._store=new C.cr([]),this._store.stateView.firstBy$(u=>!0===u.state.active).subscribe(u=>{this.workspace$.next(u?u.entity:void 0)}),this._store.stateView.all$().subscribe(u=>{u.map(S=>{S.entity.actionStore.empty&&(S.entity instanceof d.MrZ?this.wfsActionsService.loadActions(S.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$):S.entity instanceof d.Wwb?this.featureActionsService.loadActions(S.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$):S.entity instanceof d.gLH&&this.editionActionsService.loadActions(S.entity,this.rowsInMapExtentCheckCondition$,this.selectOnlyCheckCondition$))})}),this.actionMaximize$$.push(this.featureActionsService.maximize$.subscribe(u=>{this.setWorkspaceIsMaximized(u)})),this.actionMaximize$$.push(this.wfsActionsService.maximize$.subscribe(u=>{this.setWorkspaceIsMaximized(u)})),this.actionMaximize$$.push(this.editionActionsService.maximize$.subscribe(u=>{this.setWorkspaceIsMaximized(u)})),this.activeWorkspace$$=this.workspace$.subscribe(u=>{void 0!==this.activeWorkspaceWidget$$&&(this.activeWorkspaceWidget$$.unsubscribe(),this.activeWorkspaceWidget$$=void 0),void 0!==u&&(this.activeWorkspaceWidget$$=u.widget$.subscribe(S=>this.activeWorkspaceWidget$.next(S)))}),this.rowsInMapExtentCheckCondition$$=this.rowsInMapExtentCheckCondition$.subscribe(u=>{this._store.stateView.all().map(S=>{if(!S.entity.actionStore.empty){const $=S.entity.entityStore.getStrategyOfType(C.qq);$&&(u?$.activate():$.deactivate())}})}),this.selectOnlyCheckCondition$$=this.selectOnlyCheckCondition$.subscribe(u=>{this._store.stateView.all().map(S=>{if(!S.entity.actionStore.empty){const $=S.entity.entityStore.getStrategyOfType(C.xx);$&&(u?$.activate():$.deactivate())}})})}setWorkspaceIsMaximized(u){this.storageService.set("workspaceMaximize",u),this.workspaceMaximize$.next(u)}setActiveWorkspaceById(u){const S=this.store.all().find($=>$.id===u);S&&this.store.activateWorkspace(S)}setActiveWorkspaceByTitle(u){const S=this.store.all().find($=>$.title===u);S&&this.store.activateWorkspace(S)}ngOnDestroy(){this.teardownWorkspaces(),this.actionMaximize$$.map(u=>u.unsubscribe()),this.rowsInMapExtentCheckCondition$$&&this.selectOnlyCheckCondition$$.unsubscribe(),this.selectOnlyCheckCondition$$&&this.selectOnlyCheckCondition$$.unsubscribe()}teardownWorkspaces(){this.store.clear(),void 0!==this.activeWorkspaceWidget$$&&this.activeWorkspaceWidget$$.unsubscribe(),void 0!==this.activeWorkspace$$&&this.activeWorkspace$$.unsubscribe()}static \u0275fac=function(S){return new(S||J)(o.CoB(Yi),o.CoB(at),o.CoB(co),o.CoB(e.yQ))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();function Jt(J,j){if(1&J&&(o.SAx(0),o.wR5(1,"igo-feature-details",3),o.k70()),2&J){const u=j.ngIf;o.yG2(),o.E7m("feature",u)}}let So=class Ws{matIconRegistry;spatialFilterService;dataSourceService;layerService;mapState;messageService;languageService;importExportState;toolState;workspaceState;cdRef;get map(){return this.mapState.map}type;itemType=d.c97.Address;freehandDrawIsActive;layers=[];activeLayers=[];queryType;thematics;zone;zoneWithBuffer;buffer=0;iterator=1;selectedFeature$=new V.g(void 0);format=new ii.c;store=new C.qc([]);spatialListStore=new C.qc([]);loading=!1;thematicLength=0;measureUnit=d.K88.Meters;unsubscribe$=new y.E;moveendKey;defaultStyle;constructor(j,u,S,$,re,ve,Be,rt,Ct,vt,Kt){this.matIconRegistry=j,this.spatialFilterService=u,this.dataSourceService=S,this.layerService=$,this.mapState=re,this.messageService=ve,this.languageService=Be,this.importExportState=rt,this.toolState=Ct,this.workspaceState=vt,this.cdRef=Kt}ngOnInit(){for(const j of this.map.layers)j.title&&j.title.includes(this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"))&&this.layers.push(j)}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}getOutputType(j){this.type=j,this.queryType=void 0}getOutputQueryType(j){this.queryType=j,this.queryType&&this.loadFilterList()}activateExportTool(){const j=[],u=new RegExp("^Zone \\d+");for(const S of this.layers)S.title.match(u)||j.push(S.id);this.importExportState.setMode(xt.export),this.importExportState.setsExportOptions({layers:j}),this.toolState.toolbox.activateTool("importExport")}activateWorkspace(j){let u;this.workspaceState.store.entities$.pipe((0,Lo.a)(this.unsubscribe$)).subscribe(()=>{if(!j&&this.activeLayers.length&&this.workspaceState.store.all().length>1){if(this.itemType===d.c97.Thematics){for(const S of this.thematics)if(!S.zeroResults){u=this.activeLayers.find($=>$.title.includes(S.name+" "+this.iterator.toString()));break}}else{const S="Adresses "+this.iterator.toString();this.activeLayers.forEach($=>{$.title.includes(S)&&(u=$)})}u&&(this.workspaceState.workspacePanelExpanded=!0,this.workspaceState.setActiveWorkspaceById(u.id))}else j&&this.activeLayers.length&&this.workspaceState.store.all().length>1&&(this.selectWorkspaceEntity(j),this.moveendKey=this.map.ol.on("moveend",()=>{this.selectWorkspaceEntity(j)}))})}selectWorkspaceEntity(j){this.workspaceState.store.all().forEach(u=>{u.entityStore.state.updateAll({selected:!1}),u.title.includes(j.added[0].meta.title)&&(this.workspaceState.setActiveWorkspaceById(u.id),u.entityStore.state.updateMany(j.added,{selected:!0}))})}loadFilterList(){this.spatialFilterService.loadFilterList(this.queryType).pipe((0,Lo.a)(this.unsubscribe$)).subscribe(j=>{j.sort((u,S)=>u.properties.nom<S.properties.nom?-1:u.properties.nom>S.properties.nom?1:0),this.spatialListStore.clear(),this.spatialListStore.load(j)})}getOutputToggleSearch(){this.loadThematics()}getOutputClearSearch(){this.zone=void 0,this.queryType=void 0}clearMap(){this.map.removeLayers(this.layers),this.layers=[],this.activeLayers=[],this.thematicLength=0,this.iterator=1,this.type===d._cQ.Predefined&&(this.zone=void 0,this.queryType=void 0)}loadThematics(){this.loading=!0;let u,j=!0;(0===this.buffer||this.type===d._cQ.Point)&&this.tryAddFeaturesToMap([this.zone]),u=this.itemType!==d.c97.Thematics?[{name:""}]:this.thematics,this.measureUnit===d.K88.Kilometers&&this.type!==d._cQ.Point&&(this.buffer=1e3*this.buffer),this.type===d._cQ.Polygon&&(this.buffer=0);const S=[];u.forEach($=>{S.push(this.spatialFilterService.loadFilterItem(this.zone,this.itemType,this.queryType,$,this.buffer).pipe((0,si.y)(re=>{this.store.insertMany(re);const ve=[],Be=[];let rt,Ct;re.forEach(vt=>{"Point"===vt.geometry.type?(vt.properties.longitude=vt.geometry.coordinates[0],vt.properties.latitude=vt.geometry.coordinates[1],ve.push(vt),rt=vt.meta.id):(Be.push(vt),Ct=vt.meta.id)}),this.tryAddPointToMap(ve,rt),this.tryAddLayerToMap(Be,Ct),re.length?(j=!1,this.thematicLength+=1,$.zeroResults=!1,this.cdRef.detectChanges()):$.zeroResults=!0,re.length>=1e4&&this.messageService.alert("igo.geo.spatialFilter.maxSizeAlert","igo.geo.spatialFilter.warning",{timeOut:1e4})})))}),(0,ri.y)(S).pipe((0,Lo.a)(this.unsubscribe$)).subscribe(()=>{this.loading=!1,j&&this.messageService.alert("igo.geo.spatialFilter.zeroResults","igo.geo.spatialFilter.warning",{timeOut:1e4})})}onZoneChange(j,u){this.zone=j,j&&(u?this.tryAddFeaturesToMap([j],!0):this.tryAddFeaturesToMap([j]),this.zoomToFeatureExtent(j))}tryAddFeaturesToMap(j,u){let S=1;for(const $ of j){if(this.type===d._cQ.Predefined)for(const re of this.layers){if(re.options._internal&&re.options._internal.code===$.properties.code&&!u){if(!re.title?.startsWith("Zone")){const ve=this.layers.indexOf(re);this.layers.splice(ve,1)}return}if(re.title?.startsWith("Zone")){this.activeLayers=[];const ve=this.layers.indexOf(re);this.layers.splice(ve,1),this.map.removeLayer(re)}}else{if(u)for(const re of this.activeLayers)if(1===this.activeLayers.length&&re.title?.startsWith("Zone")){const ve=this.layers.indexOf(re);this.layers.splice(ve,1),this.map.removeLayer(re)}this.activeLayers=[]}for(const re of this.layers)re.title?.startsWith("Zone")&&S++;this.defaultStyle=(re,ve)=>{const Be=j[0].coordinates;return new te.cp({image:new X.c({radius:Be?this.buffer/Math.cos(Math.PI/180*Be[1])/ve:void 0,fill:new K.c({color:"rgba(200, 200, 20, 0.2)"}),stroke:new Z.c({width:1,color:"orange"})}),stroke:new Z.c({width:1,color:"orange"}),fill:new K.c({color:"rgba(200, 200, 20, 0.2)"})})},this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,Ht.U)(1)).subscribe(re=>{const ve=this.layerService.createLayer({isIgoInternalLayer:!0,title:"Zone "+S+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),workspace:{enabled:!0},_internal:{code:this.type===d._cQ.Predefined?$.properties.code:void 0},source:re,visible:!0}),Be=j.map(Ct=>(0,d.K6O)(Ct,this.map.projection));if(this.type!==d._cQ.Predefined){const Ct=this.type===d._cQ.Point?"Cercle":"Polygone";Be[0].set("nom","Zone",!0),Be[0].set("type",Ct,!0)}re.ol.addFeatures(Be),ve.ol.setStyle(this.defaultStyle),this.map.addLayer(ve),this.layers.push(ve),this.activeLayers.push(ve),this.cdRef.detectChanges()})}}tryAddPointToMap(j,u){let S=1;if(j.length){if(void 0===this.map)return;for(const $ of this.layers)$.title?.startsWith(j[0].meta.title)&&S++;this.dataSourceService.createAsyncDataSource({type:"cluster",id:u,queryable:!0,distance:120,meta:{title:"Cluster"}}).pipe((0,Ht.U)(1)).subscribe($=>{const re=j[0].meta.icon;let ve;ve=re&&this.createSvgIcon(re)||(0,d.o5m)();const Be=this.layerService.createLayer({isIgoInternalLayer:!0,title:j[0].meta.title+" "+S+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:$,visible:!0,style:ve}),rt=j.map(vt=>(0,d.K6O)(vt,this.map.projection));$.ol.getSource().addFeatures(rt),this.layers.find(vt=>vt.id===Be.id)&&(this.map.removeLayer(this.layers.find(vt=>vt.id===Be.id)),S-=1,Be.title=j[0].meta.title+" "+S+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),Be.options.title=Be.title),this.iterator=S,this.map.addLayer(Be),this.layers.push(Be),this.pushLayer(Be),this.cdRef.detectChanges()})}}createSvgIcon(j){let u;return this.matIconRegistry.getNamedSvgIcon(j).subscribe(S=>{const $=new XMLSerializer;S.setAttribute("width","30"),S.setAttribute("height","30"),S.setAttribute("fill","rgba(0, 128, 255)"),S.setAttribute("stroke","white");const re=$.serializeToString(S);u=new te.cp({image:new ni.c({src:"data:image/svg+xml;utf8,"+re})})}),u}tryAddLayerToMap(j,u){let S=1;if(j.length){if(void 0===this.map)return;for(const $ of this.layers)$.title?.startsWith(j[0].meta.title)&&S++;this.dataSourceService.createAsyncDataSource({type:"vector",id:u,queryable:!0}).pipe((0,Ht.U)(1)).subscribe($=>{const re=this.layerService.createLayer({isIgoInternalLayer:!0,title:j[0].meta.title+" "+S+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:$,visible:!0}),ve=j.map(rt=>(0,d.K6O)(rt,this.map.projection));$.ol.addFeatures(ve),this.layers.find(rt=>rt.id===re.id)&&(this.map.removeLayer(this.layers.find(rt=>rt.id===re.id)),S-=1,re.title=j[0].meta.title+" "+S+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),re.options.title=re.title),this.map.addLayer(re),this.layers.push(re),this.pushLayer(re),this.cdRef.detectChanges()})}}zoomToFeatureExtent(j){if(j){const u=this.format.readFeature(j,{dataProjection:j.projection,featureProjection:this.map.projection});(0,d.QX5)(this.map.viewController,[u],d.Suj.Zoom)}}pushLayer(j){for(const u of this.activeLayers)if(u.id===j.id)return;this.activeLayers.push(j)}static \u0275fac=function(u){return new(u||Ws)(o.GI1(Oe.iK),o.GI1(d.kjd),o.GI1(d.OEM),o.GI1(d.IZ6),o.GI1(mt),o.GI1($t.mi),o.GI1(Et.ov),o.GI1(zt),o.GI1(Ut),o.GI1(go),o.GI1(o.kD9))};static \u0275cmp=o.In1({type:Ws,selectors:[["igo-spatial-filter-tool"]],inputs:{type:"type",itemType:"itemType",freehandDrawIsActive:"freehandDrawIsActive"},standalone:!0,features:[o.UHJ],decls:4,vars:16,consts:[[3,"store","selectedQueryType","zone","layers","eventType","eventQueryType","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange"],[3,"type","queryType","map","zone","loading","store","layers","allLayers","thematicLength","radiusEvent","bufferEvent","measureUnitChange","freehandControl","drawZoneEvent","zoneWithBufferChange","itemTypeChange","thematicChange","toggleSearch","clearButtonEvent","clearSearchEvent","export","openWorkspace","entityChange"],[4,"ngIf"],[3,"feature"]],template:function(u,S){1&u&&(o.I0R(0,"igo-spatial-filter-type",0),o.qCj("eventType",function(re){return S.getOutputType(re)})("eventQueryType",function(re){return S.getOutputQueryType(re)})("zoneChange",function(re){return S.onZoneChange(re)})("zoneWithBufferChange",function(re){return S.onZoneChange(re,!0)})("bufferChange",function(re){return S.buffer=re})("measureUnitChange",function(re){return S.measureUnit=re}),o.C$Y(),o.I0R(1,"igo-spatial-filter-item",1),o.qCj("radiusEvent",function(re){return S.buffer=re})("bufferEvent",function(re){return S.buffer=re})("measureUnitChange",function(re){return S.measureUnit=re})("freehandControl",function(re){return S.freehandDrawIsActive=re})("drawZoneEvent",function(re){return S.zone=re})("zoneWithBufferChange",function(re){return S.onZoneChange(re,!0)})("itemTypeChange",function(re){return S.itemType=re})("thematicChange",function(re){return S.thematics=re})("toggleSearch",function(){return S.getOutputToggleSearch()})("clearButtonEvent",function(){return S.clearMap()})("clearSearchEvent",function(){return S.getOutputClearSearch()})("export",function(){return S.activateExportTool()})("openWorkspace",function(){return S.activateWorkspace()})("entityChange",function(re){return S.activateWorkspace(re)}),o.C$Y(),o.yuY(2,Jt,2,1,"ng-container",2),o.wVc(3,"async")),2&u&&(o.E7m("store",S.spatialListStore)("selectedQueryType",S.queryType)("zone",S.zone)("layers",S.activeLayers),o.yG2(),o.E7m("type",S.type)("queryType",S.queryType)("map",S.map)("zone",S.zone)("loading",S.loading)("store",S.store)("layers",S.activeLayers)("allLayers",S.layers)("thematicLength",S.thematicLength),o.yG2(),o.E7m("ngIf",o.kDX(3,14,S.selectedFeature$)))},dependencies:[d.K4n,d.uu$,d.wP$,k.u_,k.a],styles:["[_nghost-%COMP%]   igo-spatial-filter-item[_ngcontent-%COMP%]{display:block;padding:0 12px}[_nghost-%COMP%]     .mat-mdc-tab-body-wrapper{margin-top:12px;padding:0 12px}"],changeDetection:0})};So=(0,Me.UN)([(0,C.aA)({name:"spatialFilter",title:"igo.integration.tools.spatialFilter",icon:C.yC}),(0,Me.YR)("design:paramtypes",[Oe.iK,d.kjd,d.OEM,d.IZ6,mt,$t.mi,Et.ov,zt,Ut,go,o.kD9])],So);let Xo=class Ns{constructor(){}static \u0275fac=function(u){return new(u||Ns)};static \u0275cmp=o.In1({type:Ns,selectors:[["igo-time-filter-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:0,consts:[["igoTimeFilterListBinding",""]],template:function(u,S){1&u&&o.wR5(0,"igo-time-filter-list",0)},dependencies:[d.gho,d.eAs],encapsulation:2})};Xo=(0,Me.UN)([(0,C.aA)({name:"timeFilter",title:"igo.integration.tools.timeFilter",icon:"history"}),(0,Me.YR)("design:paramtypes",[])],Xo);var bo=r(18268);function Uo(J,j){if(1&J){const u=o.KQA();o.I0R(0,"mat-tab-group")(1,"mat-tab",3),o.wVc(2,"translate"),o.I0R(3,"igo-import-export",4),o.qCj("selectMode",function($){o.usT(u);const re=o.GaO();return o.CGJ(re.modeChanged($))})("exportOptionsChange",function($){o.usT(u);const re=o.GaO();return o.CGJ(re.exportOptionsChange($))}),o.wVc(4,"async"),o.wVc(5,"async"),o.C$Y()(),o.I0R(6,"mat-tab",3),o.wVc(7,"translate"),o.wR5(8,"igo-context-import-export",5),o.C$Y()()}if(2&J){const u=o.GaO();o.yG2(),o.E7m("label",o.kDX(2,10,"igo.integration.importExportTool.importExportData")),o.yG2(2),o.E7m("contextUri",o.kDX(4,12,u.contextState.context$).uri)("map",u.map)("selectFirstProj",u.selectFirstProj)("projectionsLimitations",u.projectionsLimitations)("store",u.workspaceStore)("selectedMode",o.kDX(5,14,u.importExportState.selectedMode$))("exportOptions$",u.importExportState.exportOptions$),o.yG2(3),o.E7m("label",o.kDX(7,16,"igo.integration.importExportTool.importExportContext")),o.yG2(2),o.E7m("map",u.map)}}function Oo(J,j){if(1&J){const u=o.KQA();o.I0R(0,"igo-import-export",6),o.qCj("selectMode",function($){o.usT(u);const re=o.GaO();return o.CGJ(re.modeChanged($))})("exportOptionsChange",function($){o.usT(u);const re=o.GaO();return o.CGJ(re.exportOptionsChange($))}),o.wVc(1,"async"),o.wVc(2,"async"),o.C$Y()}if(2&J){const u=o.GaO();o.E7m("contextUri",o.kDX(1,5,u.contextState.context$).uri)("map",u.map)("store",u.workspaceStore)("selectedMode",o.kDX(2,7,u.importExportState.selectedMode$))("exportOptions$",u.importExportState.exportOptions$)}}function ln(J,j){if(1&J&&o.wR5(0,"igo-context-import-export",5),2&J){const u=o.GaO();o.E7m("map",u.map)}}let Vi=class Hs{mapState;importExportState;workspaceState;contextState;projectionsLimitations;selectFirstProj=!1;get map(){return this.mapState.map}get workspaceStore(){return this.workspaceState.store}importExportType=Ro.layer;importExportShowBothType=!0;constructor(j,u,S,$){this.mapState=j,this.importExportState=u,this.workspaceState=S,this.contextState=$}ngOnInit(){this.selectType(),this.selectMode()}selectType(){this.importExportType&&this.importExportState.importExportType$.next(this.importExportType);const j=this.importExportState.importExportType$.value;this.importExportState.setImportExportType(void 0!==j?j:Ro.layer)}selectMode(){const j=this.importExportState.selectedMode$.value;this.importExportState.setMode(void 0!==j?j:xt.import)}modeChanged(j){this.importExportState.setMode(j)}exportOptionsChange(j){this.importExportState.setsExportOptions(j)}importExportTypeChange(j){this.importExportType=j.value}static \u0275fac=function(u){return new(u||Hs)(o.GI1(mt),o.GI1(zt),o.GI1(go),o.GI1(st))};static \u0275cmp=o.In1({type:Hs,selectors:[["igo-import-export-tool"]],inputs:{projectionsLimitations:"projectionsLimitations",selectFirstProj:"selectFirstProj",importExportType:"importExportType",importExportShowBothType:"importExportShowBothType"},standalone:!0,features:[o.UHJ],decls:3,vars:3,consts:[[4,"ngIf"],[3,"contextUri","map","store","selectedMode","exportOptions$","selectMode","exportOptionsChange",4,"ngIf"],[3,"map",4,"ngIf"],[3,"label"],[3,"contextUri","map","selectFirstProj","projectionsLimitations","store","selectedMode","exportOptions$","selectMode","exportOptionsChange"],[3,"map"],[3,"contextUri","map","store","selectedMode","exportOptions$","selectMode","exportOptionsChange"]],template:function(u,S){1&u&&o.yuY(0,Uo,9,18,"mat-tab-group",0)(1,Oo,3,9,"igo-import-export",1)(2,ln,1,1,"igo-context-import-export",2),2&u&&(o.E7m("ngIf",S.importExportShowBothType),o.yG2(),o.E7m("ngIf",!S.importExportShowBothType&&"layer"===S.importExportType),o.yG2(),o.E7m("ngIf",!S.importExportShowBothType&&"context"===S.importExportType))},dependencies:[k.u_,bo.WG,bo.aJ,bo._q,d.OrO,et.kP,k.a,Et._s,so.sD],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}"],changeDetection:0})};Vi=(0,Me.UN)([(0,C.aA)({name:"importExport",title:"igo.integration.tools.importExport",icon:"file_save"}),(0,Me.YR)("design:paramtypes",[mt,zt,go,st])],Vi);var li=r(75180),Yo=r(43424),xi=r(46176),Io=r(50244),ci=r(42536),Vo=r(77872),ui=r(43168),xo=r(24112);function ji(J,j){if(1&J&&(o.I0R(0,"mat-form-field",12)(1,"mat-label"),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.wR5(4,"textarea",13,14),o.wVc(6,"translate"),o.C$Y()),2&J){const u=o.GaO();o.yG2(2),o.cNF(o.kDX(3,3,"igo.integration.advanced-map-tool.advanced-coordinates.lon")),o.yG2(2),o.E7m("placeholder",o.kDX(6,5,"igo.integration.advanced-map-tool.advanced-coordinates.lon"))("value",u.coordinates[0])}}function cn(J,j){if(1&J&&(o.I0R(0,"mat-form-field",12),o.wR5(1,"textarea",13,14),o.wVc(3,"translate"),o.C$Y()),2&J){const u=o.GaO();o.yG2(),o.E7m("placeholder",o.kDX(3,2,"igo.integration.advanced-map-tool.advanced-coordinates.est"))("value",u.coordinates[0])}}function un(J,j){if(1&J&&(o.I0R(0,"mat-form-field",12)(1,"mat-label"),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.wR5(4,"textarea",13,14),o.wVc(6,"translate"),o.C$Y()),2&J){const u=o.GaO();o.yG2(2),o.cNF(o.kDX(3,3,"igo.integration.advanced-map-tool.advanced-coordinates.lat")),o.yG2(2),o.E7m("placeholder",o.kDX(6,5,"igo.integration.advanced-map-tool.advanced-coordinates.lat"))("value",u.coordinates[1])}}function dn(J,j){if(1&J&&(o.I0R(0,"mat-form-field",12),o.wR5(1,"textarea",13,14),o.wVc(3,"translate"),o.C$Y()),2&J){const u=o.GaO();o.yG2(),o.E7m("placeholder",o.kDX(3,2,"igo.integration.advanced-map-tool.advanced-coordinates.nord"))("value",u.coordinates[1])}}function pn(J,j){if(1&J&&(o.I0R(0,"mat-option",15),o.qCj("click",function(S){return S.stopPropagation()}),o.OEk(1),o.C$Y()),2&J){const u=j.$implicit;o.E7m("value",u),o.yG2(),o.oRS(" ",u.translatedValue||u.alias," ")}}let mn=(()=>{class J{mapState;languageService;messageService;cdRef;storageService;config;formBuilder;formattedScale$=new V.g("");projections$=new V.g([]);form;coordinates;currentCenterDefaultProj;center;inMtmZone=!0;inLambert2={32198:!0,3798:!0};mapState$$;_projectionsLimitations={};projectionsConstraints;defaultProj;currentZones={utm:void 0,mtm:void 0};units=!0;get map(){return this.mapState.map}get inputProj(){return this.form.get("inputProj").value}set inputProj(u){this.form.patchValue({inputProj:u})}get projectionsLimitations(){return this._projectionsLimitations||{}}set projectionsLimitations(u){this._projectionsLimitations=u}constructor(u,S,$,re,ve,Be,rt){this.mapState=u,this.languageService=S,this.messageService=$,this.cdRef=re,this.storageService=ve,this.config=Be,this.formBuilder=rt,this.defaultProj={translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.wgs84",{code:"EPSG:4326"}),translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:"",def:void 0,extent:void 0},this.center=this.storageService.get("centerToggle"),this.computeProjections(),this.buildForm()}ngOnInit(){this.mapState$$=this.map.viewController.state$.pipe((0,xo.o)(50)).subscribe(()=>{this.setScaleValue(this.map),this.currentCenterDefaultProj=this.map.viewController.getCenter(this.defaultProj.code);const S=(0,d.ETi)(this.currentCenterDefaultProj[0]),$=(0,d.KMH)(this.currentCenterDefaultProj[0]);!this.inMtmZone&&S!==this.currentZones.mtm&&this.back2quebec();let re=!1;S!==this.currentZones.mtm&&(this.currentZones.mtm=S,re=!0),$!==this.currentZones.utm&&(this.currentZones.utm=$,re=!0),re&&this.updateProjectionsZoneChange(),this.checkLambert(this.currentCenterDefaultProj),this.coordinates=this.getCoordinates(),this.cdRef.detectChanges(),this.storageService.set("currentProjection",this.inputProj,e.Ab.SESSION)});const u=this.storageService.get("currentProjection");if(this.inputProj=this.projections$.value[0],null!==u){const S=this.positionInList(u);this.inputProj=this.projections$.value[S],this.updateZoneMtmUtm()}this.map.mapCenter$.next(this.center),this.coordinates=this.getCoordinates(),this.currentCenterDefaultProj=this.map.viewController.getCenter(this.defaultProj.code)}ngOnDestroy(){this.map.mapCenter$.next(!1),this.mapState$$.unsubscribe()}setScaleValue(u){this.formattedScale$.next(": ~ 1 / "+(0,d.rEB)(u.viewController.getScale()))}getCoordinates(){let u;this.currentZones.mtm=(0,d.ETi)(this.currentCenterDefaultProj[0]),this.currentZones.utm=(0,d.KMH)(this.currentCenterDefaultProj[0]);const S=this.inputProj.code;let $=2;return(S.includes("EPSG:4326")||S.includes("EPSG:4269"))&&($=5),this.units="EPSG:4326"===S||"EPSG:4269"===S,u=this.map.viewController.getCenter(S).map(re=>re.toFixed($)),u}copyTextToClipboard(){ui._D.copy(this.coordinates.toString())&&this.messageService.success("igo.integration.advanced-map-tool.advanced-coordinates.copyMsg","igo.integration.advanced-map-tool.advanced-coordinates.copyTitle")}displayCenter(u){this.center=u,this.map.mapCenter$.next(u),this.storageService.set("centerToggle",u,e.Ab.SESSION)}buildForm(){this.form=this.formBuilder.group({inputProj:["",[W.AQ.required]]})}updateProjectionsZoneChange(){let u=this.projections$.value;const S=this.languageService.translate;u.map($=>{if("mtm"===$.translateKey){const re=(0,d.ETi)(this.currentCenterDefaultProj[0]);if(re){const ve=re<10?`EPSG:3218${re}`:`EPSG:321${80+re}`;$.alias=`MTM ${re}`,$.code=ve,$.zone=`${re}`,$.translatedValue=S.instant("igo.geo.importExportForm.projections.mtm",$)}else $.alias="",this.inMtmZone=!1,"mtm"===this.inputProj.translateKey&&(this.inputProj=this.projections$.value[0])}if("utm"===$.translateKey){const re=(0,d.KMH)(this.currentCenterDefaultProj[0]),ve=`EPSG:326${re}`;$.alias=`UTM ${re}`,$.code=ve,$.zone=`${re}`,$.translatedValue=S.instant("igo.geo.importExportForm.projections.utm",$)}}),u=u.filter($=>""!==$.alias),this.projections$.next(u)}computeProjections(){this.projectionsConstraints=(0,d.KGf)(this.projectionsLimitations);const u=[];this.currentCenterDefaultProj||(this.currentCenterDefaultProj=this.map.viewController.getCenter(this.defaultProj.code));const S=this.languageService.translate;if(this.projectionsConstraints.wgs84&&u.push({translatedValue:S.instant("igo.geo.importExportForm.projections.wgs84",{code:"EPSG:4326"}),translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:"",def:void 0,extent:void 0}),this.projectionsConstraints.nad83&&u.push({translatedValue:S.instant("igo.geo.importExportForm.projections.nad83",{code:"EPSG:4269"}),translateKey:"nad83",alias:"NAD83",code:"EPSG:4269",zone:"",def:void 0,extent:void 0}),this.projectionsConstraints.webMercator&&u.push({translatedValue:S.instant("igo.geo.importExportForm.projections.webMercator",{code:"EPSG:3857"}),translateKey:"webMercator",alias:"Web Mercator",code:"EPSG:3857",zone:"",def:void 0,extent:void 0}),this.projectionsConstraints.mtm){const re=(0,d.ETi)(this.currentCenterDefaultProj[0]);if(re){this.inMtmZone=!0;const ve=re<10?`EPSG:3218${re}`:`EPSG:321${80+re}`;u.splice(3,0,{translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.mtm",{code:ve,zone:re}),translateKey:"mtm",alias:`MTM ${re}`,code:ve,zone:`${re}`,def:void 0,extent:void 0})}else this.inMtmZone=!1}if(this.projectionsConstraints.utm){const re=this.inMtmZone?4:3,ve=(0,d.KMH)(this.currentCenterDefaultProj[0]),Be=ve<10?`EPSG:3260${ve}`:`EPSG:326${ve}`;u.splice(re,0,{translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.utm",{code:Be,zone:ve}),translateKey:"utm",alias:`UTM ${ve}`,code:Be,zone:`${ve}`,def:void 0,extent:void 0})}let $=[];this.projectionsConstraints.projFromConfig&&($=this.config.getConfig("projections")||[]),this.projections$.next($.concat(u))}pushMtm(u){if(this.projectionsConstraints.mtm){const S=(0,d.ETi)(this.currentCenterDefaultProj[0]),$=S<10?`EPSG:3218${S}`:`EPSG:321${80+S}`;u.splice(3,0,{translatedValue:this.languageService.translate.instant("igo.geo.importExportForm.projections.mtm",{code:$,zone:S}),translateKey:"mtm",alias:`MTM ${S}`,code:$,zone:`${S}`,def:void 0,extent:void 0})}}back2quebec(){this.pushMtm(this.projections$.value),this.inMtmZone=!0}updateZoneMtmUtm(){if("mtm"===this.inputProj.translateKey){const u=(0,d.ETi)(this.currentCenterDefaultProj[0]);this.inputProj.alias=`MTM ${u}`;const S=u<10?`EPSG:3218${u}`:`EPSG:321${80+u}`;this.inputProj.code=S,this.inputProj.zone=`${u}`,this.inputProj.translatedValue=this.languageService.translate.instant("igo.geo.importExportForm.projections.mtm",{code:S,zone:u})}if("utm"===this.inputProj.translateKey){const u=(0,d.KMH)(this.currentCenterDefaultProj[0]);this.inputProj.alias=`UTM ${u}`;const S=u<10?`EPSG:3260${u}`:`EPSG:326${u}`;this.inputProj.code=S,this.inputProj.zone=`${u}`,this.inputProj.translatedValue=this.languageService.translate.instant("igo.geo.importExportForm.projections.utm",{code:S,zone:u})}}positionInList(u){const S=u.translateKey,$=u.alias;let re,ve=0;return this.projections$.value.map(Be=>{S?S===Be.translateKey&&(re=ve):$===Be.alias&&(re=ve),ve++}),re=re||0,re}checkLambert(u){(this.config.getConfig("projections")||[]).forEach($=>{let re=this.projections$.value;const ve=$.extent,Be=$.code.match(/\d+/),rt=_e.W0(ve,$.code,this.defaultProj.code);u[0]<rt[0]||u[0]>rt[2]||u[1]<rt[1]||u[1]>rt[3]?(this.inLambert2[Be]=!1,this.inputProj.alias===$.alias&&(this.inputProj=this.projections$.value[0]),re=re.filter(Ct=>Ct.alias!==$.alias),this.projections$.next(re)):this.inLambert2[Be]||(this.projections$.next(re.concat($)),this.inLambert2[Be]=!0)})}static \u0275fac=function(S){return new(S||J)(o.GI1(mt),o.GI1(Et.ov),o.GI1($t.mi),o.GI1(o.kD9),o.GI1(e.yQ),o.GI1(Ft.aW),o.GI1(W.KE))};static \u0275cmp=o.In1({type:J,selectors:[["igo-advanced-coordinates"]],inputs:{projectionsLimitations:"projectionsLimitations"},standalone:!0,features:[o.UHJ],decls:36,vars:37,consts:[[1,"advanced-coordinates__coordinates-container"],[1,"advanced-coordinates__coordinates-container__inner"],["subscriptSizing","dynamic",4,"ngIf","ngIfElse"],["elseBlock",""],["elseBlock2",""],["mat-icon-button","",1,"igo-form-button-group","advanced-coordinates__copy-coordinates",3,"click"],[1,"igo-form","advanced-coordinates__form",3,"formGroup"],["subscriptSizing","dynamic",1,"igo-input-container"],[3,"value","valueChange"],["matTooltipShowDelay","500",3,"value","click",4,"ngFor","ngForOf"],[1,"center-toggle","mat-typography",3,"checked","labelPosition","change"],[1,"igo-zoom","mat-typography"],["subscriptSizing","dynamic"],["matInput","","readonly","","rows","1",3,"placeholder","value"],["textArea",""],["matTooltipShowDelay","500",3,"value","click"]],template:function(S,$){if(1&S&&(o.I0R(0,"div",0)(1,"div",1),o.yuY(2,ji,7,7,"mat-form-field",2)(3,cn,4,4,"ng-template",null,3,o.gJz)(5,un,7,7,"mat-form-field",2)(6,dn,4,4,"ng-template",null,4,o.gJz),o.I0R(8,"button",5),o.qCj("click",function(){return $.copyTextToClipboard()}),o.wVc(9,"translate"),o.I0R(10,"mat-icon"),o.OEk(11,"content_copy"),o.C$Y()()(),o.I0R(12,"form",6)(13,"div",1)(14,"mat-form-field",7)(15,"mat-label"),o.OEk(16),o.wVc(17,"translate"),o.C$Y(),o.I0R(18,"mat-select",8),o.iHE("valueChange",function(ve){return o.kNx($.inputProj,ve)||($.inputProj=ve),ve}),o.yuY(19,pn,2,2,"mat-option",9),o.wVc(20,"async"),o.C$Y()()(),o.I0R(21,"div",1)(22,"mat-slide-toggle",10),o.qCj("change",function(ve){return $.displayCenter(ve.checked)}),o.OEk(23),o.wVc(24,"translate"),o.C$Y()()(),o.I0R(25,"p",11),o.OEk(26),o.wVc(27,"translate"),o.C$Y(),o.I0R(28,"p",11),o.OEk(29),o.wVc(30,"translate"),o.wVc(31,"async"),o.C$Y(),o.I0R(32,"p",11),o.OEk(33),o.wVc(34,"translate"),o.wVc(35,"number"),o.C$Y()()),2&S){const re=o.Gew(4),ve=o.Gew(7);o.yG2(2),o.E7m("ngIf",$.units)("ngIfElse",re),o.yG2(3),o.E7m("ngIf",$.units)("ngIfElse",ve),o.yG2(3),o.e48("aria-label",o.kDX(9,18,"igo.integration.advanced-map-tool.advanced-coordinates.copy")),o.yG2(4),o.E7m("formGroup",$.form),o.yG2(4),o.cNF(o.kDX(17,20,"igo.integration.advanced-map-tool.advanced-coordinates.coordSystem")),o.yG2(2),o.OKB("value",$.inputProj),o.yG2(),o.E7m("ngForOf",o.kDX(20,22,$.projections$)),o.yG2(3),o.E7m("checked",$.center)("labelPosition","before"),o.yG2(),o.oRS(" ",o.kDX(24,24,"igo.integration.advanced-map-tool.advanced-coordinates.center")," "),o.yG2(3),o.CAO(" ",o.kDX(27,26,"igo.integration.advanced-map-tool.advanced-coordinates.zoom")," ",$.map.viewController.getZoom()," "),o.yG2(3),o.CAO(" ",o.kDX(30,28,"igo.integration.advanced-map-tool.advanced-coordinates.scale")," ",o.kDX(31,30,$.formattedScale$)," "),o.yG2(4),o.CAO(" ",o.kDX(34,32,"igo.integration.advanced-map-tool.advanced-coordinates.resolution")," ",o.g7$(35,34,$.map.viewController.getResolution(),"1.0-0")," ")}},dependencies:[k.u_,Io.wb,Io.Up,Io.w5,ci.cN,ci.yi,w.oJ,w.um,Oe.oB,Oe.qL,W.y,W.sz,W.u,W.sl,W.uW,Vo.d5,Vo.kX,xi.I5,k.Iw,xi.Ax,Yo.GE,Yo.cP,k.a,k.hl,Et._s,so.sD],styles:["[_nghost-%COMP%]{padding:12px 0}textarea[_ngcontent-%COMP%]{resize:none}.advanced-coordinates__coordinates-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;padding:12px 0}.advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:16px}.advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]:not(:first-child), .advanced-coordinates__coordinates-container__inner[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(:first-child){margin-left:8px}.advanced-coordinates__form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.advanced-coordinates__form[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{flex:1}.advanced-coordinates__form[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{display:flex;justify-content:space-between}.advanced-coordinates__form[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{flex:1}"]})}return J})();var Zt=r(63916);function gn(J,j){if(1&J){const u=o.KQA();o.I0R(0,"mat-option",5),o.qCj("click",function(){o.usT(u),o.GaO();const $=o.Gew(8),re=o.GaO();return o.CGJ(re.applyNewLayers($))}),o.OEk(1),o.C$Y()}if(2&J){const u=j.$implicit;o.E7m("value",u),o.yG2(),o.cNF(u.title)}}function hn(J,j){if(1&J){const u=o.KQA();o.I0R(0,"div",2)(1,"form",3)(2,"mat-form-field")(3,"mat-label"),o.OEk(4),o.wVc(5,"translate"),o.C$Y(),o.I0R(6,"mat-select",4)(7,"mat-option",5,6),o.qCj("click",function(){o.usT(u);const $=o.Gew(8),re=o.GaO();return o.CGJ(re.selectAll($))}),o.OEk(9),o.wVc(10,"translate"),o.C$Y(),o.wR5(11,"mat-divider"),o.yuY(12,gn,2,2,"mat-option",7),o.C$Y()(),o.I0R(13,"mat-slide-toggle",8),o.qCj("change",function($){o.usT(u);const re=o.GaO();return o.CGJ(re.startSwipe($.checked))}),o.OEk(14),o.wVc(15,"translate"),o.C$Y()()()}if(2&J){const u=o.GaO();o.yG2(),o.E7m("formGroup",u.form),o.yG2(3),o.cNF(o.kDX(5,8,"igo.integration.advanced-map-tool.advanced-swipe.swipe-select")),o.yG2(3),o.E7m("value",1),o.yG2(2),o.oRS(" ",o.kDX(10,10,"igo.integration.advanced-map-tool.advanced-swipe.selectAll")," "),o.yG2(3),o.E7m("ngForOf",u.userControlledLayerList),o.yG2(),o.E7m("checked",u.swipe)("labelPosition","before"),o.yG2(),o.oRS(" ",o.kDX(15,12,"igo.integration.advanced-map-tool.advanced-swipe.swipe")," ")}}function Wn(J,j){if(1&J){const u=o.KQA();o.I0R(0,"mat-list")(1,"p",9),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.I0R(4,"p",9),o.OEk(5),o.wVc(6,"translate"),o.C$Y(),o.I0R(7,"mat-list-item")(8,"mat-icon",10),o.OEk(9,"search"),o.C$Y(),o.I0R(10,"span",11),o.qCj("click",function(){o.usT(u);const $=o.GaO();return o.CGJ($.searchEmit())}),o.OEk(11),o.wVc(12,"translate"),o.C$Y()(),o.I0R(13,"mat-list-item"),o.wR5(14,"igo-icon",12),o.I0R(15,"span",13),o.qCj("click",function(){o.usT(u);const $=o.GaO();return o.CGJ($.catalogEmit())}),o.OEk(16),o.wVc(17,"translate"),o.C$Y()(),o.I0R(18,"mat-list-item")(19,"mat-icon",10),o.OEk(20,"star"),o.C$Y(),o.I0R(21,"span",14),o.qCj("click",function(){o.usT(u);const $=o.GaO();return o.CGJ($.contextEmit())}),o.OEk(22),o.wVc(23,"translate"),o.C$Y()()()}if(2&J){const u=o.GaO();o.yG2(2),o.oRS(" ",o.kDX(3,6,"igo.integration.advanced-map-tool.advanced-swipe.empty")," "),o.yG2(3),o.oRS(" ",o.kDX(6,8,"igo.integration.advanced-map-tool.advanced-swipe.customize")," "),o.yG2(6),o.oRS(" ",o.kDX(12,10,"igo.integration.advanced-map-tool.advanced-swipe.search-tool")," "),o.yG2(3),o.E7m("icon",u.layerPlusIcon),o.yG2(2),o.oRS(" ",o.kDX(17,12,"igo.integration.advanced-map-tool.advanced-swipe.catalog-tool")," "),o.yG2(6),o.oRS(" ",o.kDX(23,14,"igo.integration.advanced-map-tool.advanced-swipe.context-tool")," ")}}let Ki=(()=>{class J{mapState;contextService;formBuilder;toolState;swipe=!1;layerList;userControlledLayerList;form;layers;res;listForSwipe;layerPlusIcon=C.er;get map(){return this.mapState.map}constructor(u,S,$,re){this.mapState=u,this.contextService=S,this.formBuilder=$,this.toolState=re,this.buildForm()}ngOnInit(){this.map.layers$.subscribe(u=>this.userControlledLayerList=u.filter(S=>!S.baseLayer&&S.showInLayerList&&S.displayed))}ngOnDestroy(){this.swipe=!1,this.map.swipeEnabled$.next(this.swipe)}buildForm(){this.form=this.formBuilder.group({layers:["",[W.AQ.required]]})}startSwipe(u){this.swipe=u,this.map.swipeEnabled$.next(u),this.listForSwipe=[];for(const S of this.form.value.layers)this.listForSwipe.push(S);this.map.selectedFeatures$.next(this.listForSwipe)}applyNewLayers(u){this.startSwipe(!1),this.startSwipe(!0),u._selected&&(u._selected=!1),this.form.controls.layers.value.length===this.userControlledLayerList.length&&(u._selected=!0)}selectAll(u){u._selected?(this.form.controls.layers.setValue(this.userControlledLayerList),u._selected=!0):this.form.controls.layers.setValue([]),this.startSwipe(!1),this.startSwipe(!0)}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}static \u0275fac=function(S){return new(S||J)(o.GI1(mt),o.GI1(et.M9),o.GI1(W.KE),o.GI1(Ut))};static \u0275cmp=o.In1({type:J,selectors:[["igo-advanced-swipe"]],standalone:!0,features:[o.UHJ],decls:3,vars:2,consts:[["class","igo-swipe-select-container",4,"ngIf","ngIfElse"],["noLayersBlock",""],[1,"igo-swipe-select-container"],[1,"igo-form",3,"formGroup"],["formControlName","layers","multiple",""],[3,"value","click"],["e",""],[3,"value","click",4,"ngFor","ngForOf"],[1,"swipe-toggle","mat-typography",3,"checked","labelPosition","change"],[1,"map-empty","mat-typography"],["matListItemIcon",""],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["matListItemIcon","",3,"icon"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(S,$){if(1&S&&o.yuY(0,hn,16,14,"div",0)(1,Wn,24,16,"ng-template",null,1,o.gJz),2&S){const re=o.Gew(2);o.E7m("ngIf",$.userControlledLayerList.length)("ngIfElse",re)}},dependencies:[k.u_,W.y,W.sz,W.ue,W.u,W.sl,W.uW,W.Wo,Io.wb,Io.Up,Io.w5,Vo.d5,Vo.kX,xi.I5,xi.Ax,li.U,li.k,k.Iw,Yo.GE,Yo.cP,Zt.iI,Zt.oL,Zt.g9,Zt.Y1,Zt.UV,Oe.oB,Oe.qL,Et._s,so.sD,C.S],styles:["[_nghost-%COMP%]{padding:12px 0}[_nghost-%COMP%]   .igo-swipe-select-container[_ngcontent-%COMP%]{padding:12px 0}[_nghost-%COMP%]   .igo-swipe-select-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{display:flex;justify-content:space-between}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{flex:1}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:4px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{padding:12px 0;text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   .advanced-tool-line[_ngcontent-%COMP%]{height:2px;background-color:gray}"]})}return J})(),Mi=class zs{mapState;get tracking$(){return this.mapState.map.geolocationController.tracking$}get followPosition$(){return this.mapState.map.geolocationController.followPosition$}constructor(j){this.mapState=j}toggleTracking(j){this.mapState.map.geolocationController.tracking=j}toggleFollow(j){this.mapState.map.geolocationController.followPosition=j}static \u0275fac=function(u){return new(u||zs)(o.GI1(mt))};static \u0275cmp=o.In1({type:zs,selectors:[["igo-advanced-map-tool"]],standalone:!0,features:[o.UHJ],decls:24,vars:26,consts:[[1,"nameOfTool"],[1,"advanced-tool-line"],[1,"igo-input-container"],[1,"geolocation-slide-toggle-container"],[1,"geolocation-option",3,"checked","labelPosition","change"],[1,"geolocation-option",3,"disabled","labelPosition","checked","change"]],template:function(u,S){1&u&&(o.I0R(0,"h4",0),o.OEk(1),o.wVc(2,"translate"),o.C$Y(),o.wR5(3,"igo-advanced-swipe")(4,"mat-divider",1),o.I0R(5,"h4",0),o.OEk(6),o.wVc(7,"translate"),o.C$Y(),o.wR5(8,"igo-advanced-coordinates")(9,"mat-divider",1),o.I0R(10,"h4",0),o.OEk(11),o.wVc(12,"translate"),o.C$Y(),o.I0R(13,"div",2)(14,"div",3)(15,"mat-slide-toggle",4),o.qCj("change",function(re){return S.toggleTracking(re.checked)}),o.wVc(16,"async"),o.OEk(17),o.wVc(18,"translate"),o.C$Y(),o.I0R(19,"mat-slide-toggle",5),o.qCj("change",function(re){return S.toggleFollow(re.checked)}),o.wVc(20,"async"),o.wVc(21,"async"),o.OEk(22),o.wVc(23,"translate"),o.C$Y()()()),2&u&&(o.yG2(),o.oRS(" ",o.kDX(2,10,"igo.integration.advanced-map-tool.advanced-swipe.swipe-tool"),"\n"),o.yG2(5),o.oRS(" ",o.kDX(7,12,"igo.integration.advanced-map-tool.advanced-coordinates.coordinates"),"\n"),o.yG2(5),o.oRS(" ",o.kDX(12,14,"igo.integration.advanced-map-tool.geolocation.title"),"\n"),o.yG2(4),o.E7m("checked",o.kDX(16,16,S.tracking$))("labelPosition","before"),o.yG2(2),o.oRS(" ",o.kDX(18,18,"igo.integration.advanced-map-tool.geolocation.tracking")," "),o.yG2(2),o.E7m("disabled",!0!==o.kDX(20,20,S.tracking$))("labelPosition","before")("checked",o.kDX(21,22,S.followPosition$)),o.yG2(3),o.oRS(" ",o.kDX(23,24,"igo.integration.advanced-map-tool.geolocation.follow")," "))},dependencies:[Ki,li.U,li.k,mn,Yo.GE,Yo.cP,k.a,Et._s,so.sD],styles:["[_nghost-%COMP%]{display:block;padding:0 16px 12px}.nameOfTool[_ngcontent-%COMP%]{text-align:center;font-weight:700;font-size:small;margin:12px 0 8px}.advanced-tool-line[_ngcontent-%COMP%]{height:2px;background-color:gray}.geolocation-slide-toggle-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:12px 0}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{flex:1}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]:not(:last-child){margin-bottom:16px}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{display:flex;justify-content:space-between}.geolocation-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{flex:1}mat-divider[_ngcontent-%COMP%]{margin:0 -16px}"]})};function fn(J,j){if(1&J){const u=o.KQA();o.I0R(0,"button",1),o.qCj("click",function(){o.usT(u);const $=o.GaO();return o.CGJ($.activateWorkspace())}),o.wVc(1,"translate"),o.I0R(2,"mat-icon"),o.OEk(3,"table"),o.C$Y()()}if(2&J){const u=o.GaO();o.E7m("matTooltip",o.kDX(1,2,"igo.integration.workspace.toggleWorkspace"))("color",u.color)}}Mi=(0,Me.UN)([(0,C.aA)({name:"advancedMap",title:"igo.integration.tools.advancedMap",icon:"home_repair_service"}),(0,Me.YR)("design:paramtypes",[mt])],Mi);let Go=(()=>{class J{workspaceState;hasWorkspace$=new V.g(!1);hasWorkspace$$;_layer;layer$=new V.g(void 0);set layer(u){this._layer=u,this.layer$.next(this._layer)}get layer(){return this._layer}color="primary";constructor(u){this.workspaceState=u}ngOnInit(){this.hasWorkspace$$=(0,lo.E)([this.workspaceState.workspaceEnabled$,this.layer$]).subscribe(u=>this.hasWorkspace$.next(u[0]&&u[1]?.options.workspace?.enabled))}ngOnDestroy(){this.hasWorkspace$$.unsubscribe()}activateWorkspace(){this.workspaceState.workspace$.value&&this.workspaceState.workspace$.value.layer.id===this.layer.id&&this.workspaceState.workspacePanelExpanded?this.workspaceState.workspacePanelExpanded=!1:(this.workspaceState.workspacePanelExpanded=!0,this.workspaceState.setActiveWorkspaceById(this.layer.id))}static \u0275fac=function(S){return new(S||J)(o.GI1(go))};static \u0275cmp=o.In1({type:J,selectors:[["igo-workspace-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[o.UHJ],decls:2,vars:3,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click"]],template:function(S,$){1&S&&(o.yuY(0,fn,4,4,"button",0),o.wVc(1,"async")),2&S&&o.E7m("ngIf",o.kDX(1,1,$.hasWorkspace$))},dependencies:[k.u_,w.oJ,w.um,ze.KO,ze.a4,Oe.oB,Oe.qL,k.a,Et._s,so.sD],changeDetection:0})}return J})();function yn(J,j){if(1&J){const u=o.KQA();o.wR5(0,"igo-workspace-button",4),o.I0R(1,"igo-export-button",5),o.qCj("click",function(){const re=o.usT(u).layer,ve=o.GaO(2);return o.CGJ(ve.activateExport(re))}),o.C$Y(),o.wR5(2,"igo-ogc-filter-button",6)(3,"igo-time-filter-button",6)(4,"igo-track-feature-button",7)(5,"igo-metadata-button",4)}if(2&J){const u=j.layer,S=o.GaO(2);o.E7m("layer",u),o.yG2(),o.E7m("layer",u),o.yG2(),o.E7m("header",S.ogcButton)("layer",u),o.yG2(),o.E7m("header",S.timeButton)("layer",u),o.yG2(),o.E7m("trackFeature",!0)("layer",u),o.yG2(),o.E7m("layer",u)}}function Wi(J,j){if(1&J&&(o.I0R(0,"igo-layer-list",2),o.yuY(1,yn,6,9,"ng-template",null,3,o.gJz),o.C$Y()),2&J){const u=o.GaO();o.E7m("map",u.map)("excludeBaseLayers",u.excludeBaseLayers)("layerFilterAndSortOptions",u.layerFilterAndSortOptions)("expandLegendOfVisibleLayers",u.expandLegendOfVisibleLayers)("toggleLegendOnVisibilityChange",u.toggleLegendOnVisibilityChange)("updateLegendOnResolutionChange",u.updateLegendOnResolutionChange)("queryBadge",u.queryBadge)}}function Di(J,j){1&J&&(o.I0R(0,"p",9),o.OEk(1),o.wVc(2,"translate"),o.C$Y()),2&J&&(o.yG2(),o.oRS(" ",o.kDX(2,1,"igo.integration.mapTool.customize")," "))}function _n(J,j){if(1&J){const u=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",11),o.S2Z(),o.I0R(2,"svg",12),o.wR5(3,"path",13),o.C$Y()(),o.gRP(),o.I0R(4,"span",14),o.qCj("click",function(){o.usT(u);const $=o.GaO(3);return o.CGJ($.searchEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.search-tool")," "))}function Cn(J,j){if(1&J){const u=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",11),o.S2Z(),o.I0R(2,"svg",12),o.wR5(3,"path",15),o.C$Y()(),o.gRP(),o.I0R(4,"span",16),o.qCj("click",function(){o.usT(u);const $=o.GaO(3);return o.CGJ($.catalogEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.catalog-tool")," "))}function vn(J,j){if(1&J){const u=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",11),o.S2Z(),o.I0R(2,"svg",12),o.wR5(3,"path",17),o.C$Y()(),o.gRP(),o.I0R(4,"span",18),o.qCj("click",function(){o.usT(u);const $=o.GaO(3);return o.CGJ($.contextEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.context-tool")," "))}function or(J,j){if(1&J&&(o.I0R(0,"mat-list")(1,"p",9),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.yuY(4,Di,3,3,"p",10)(5,_n,7,3,"mat-list-item",8)(6,Cn,7,3,"mat-list-item",8)(7,vn,7,3,"mat-list-item",8),o.C$Y()),2&J){const u=o.GaO(2);o.yG2(2),o.oRS(" ",o.kDX(3,5,"igo.integration.mapTool.empty")," "),o.yG2(2),o.E7m("ngIf",u.layerAdditionAllowed&&(u.searchToolInToolbar||u.catalogToolInToolbar||u.contextToolInToolbar)),o.yG2(),o.E7m("ngIf",u.layerAdditionAllowed&&u.searchToolInToolbar),o.yG2(),o.E7m("ngIf",u.layerAdditionAllowed&&u.catalogToolInToolbar),o.yG2(),o.E7m("ngIf",u.layerAdditionAllowed&&u.contextToolInToolbar)}}function Ni(J,j){if(1&J&&o.yuY(0,or,8,7,"mat-list",8),2&J){const u=o.GaO();o.E7m("ngIf",u.delayedShowEmptyMapContent)}}let Hi=class Xs{mapState;toolState;searchSourceService;cdRef;importExportState;delayedShowEmptyMapContent=!1;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;ogcButton=!0;timeButton=!0;layerListControls={};queryBadge=!1;layerAdditionAllowed=!0;get map(){return this.mapState.map}get layers$(){return this.map.layers$.pipe((0,ho.k)(j=>j.filter(u=>!(!1===u.showInLayerList||this.excludeBaseLayers&&u.baseLayer))))}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get layerFilterAndSortOptions(){const j=Object.assign({showToolbar:d.g7B.default},this.layerListControls);switch(this.layerListControls.showToolbar){case d.g7B.always:j.showToolbar=d.g7B.always;break;case d.g7B.never:j.showToolbar=d.g7B.never}return j}get searchToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("searchResults")&&this.searchSourceService.getSources().filter(d.ayN).filter(j=>j.available&&"Layer"===j.getType()).length>0}get catalogToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("catalog")}get contextToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("contextManager")}constructor(j,u,S,$,re){this.mapState=j,this.toolState=u,this.searchSourceService=S,this.cdRef=$,this.importExportState=re}ngOnInit(){setTimeout(()=>{this.delayedShowEmptyMapContent=!0,this.cdRef.detectChanges()},250)}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}activateExport(j){let u=j.id;j.options.workspace?.workspaceId&&(u=j.options.workspace.workspaceId!==j.id?j.options.workspace.workspaceId:j.id),this.importExportState.setsExportOptions({layers:[u]}),this.importExportState.setMode(xt.export),this.toolState.toolbox.activateTool("importExport")}static \u0275fac=function(u){return new(u||Xs)(o.GI1(mt),o.GI1(Ut),o.GI1(d.i6q),o.GI1(o.kD9),o.GI1(zt))};static \u0275cmp=o.In1({type:Xs,selectors:[["igo-map-details-tool"]],inputs:{toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",ogcButton:"ogcButton",timeButton:"timeButton",layerListControls:"layerListControls",queryBadge:"queryBadge",layerAdditionAllowed:"layerAdditionAllowed"},standalone:!0,features:[o.UHJ],decls:4,vars:4,consts:[["class","mapDetailsList","igoLayerListBinding","",3,"map","excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge",4,"ngIf","ngIfElse"],["empty",""],["igoLayerListBinding","",1,"mapDetailsList",3,"map","excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge"],["igoLayerItemToolbar",""],[3,"layer"],[3,"layer","click"],[3,"header","layer"],[3,"trackFeature","layer"],[4,"ngIf"],[1,"map-empty","mat-typography"],["class","map-empty mat-typography",4,"ngIf"],["matListItemIcon",""],["viewBox","0 0 24 24","fit","","height","100%","width","100%","preserveAspectRatio","xMidYMid meet","focusable","false"],["d","M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["d","M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["d","M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(u,S){if(1&u&&(o.yuY(0,Wi,3,7,"igo-layer-list",0),o.wVc(1,"async"),o.yuY(2,Ni,1,1,"ng-template",null,1,o.gJz)),2&u){const $=o.Gew(3);o.E7m("ngIf",o.kDX(1,2,S.layers$).length)("ngIfElse",$)}},dependencies:[k.u_,d.m2U,d.Ult,Go,d.O_6,d.Ga$,d.eM$,d.ktW,d.Idw,Zt.iI,Zt.oL,Zt.g9,Zt.Y1,Zt.UV,Oe.oB,Oe.qL,k.a,Et._s,so.sD],styles:["[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   mat-list.mat-mdc-list-base[_ngcontent-%COMP%]   mat-list-item.mat-mdc-list-item[_ngcontent-%COMP%]     div.mdc-list-item__content div.mdc-list-item__primary-text{padding-left:5px}[_nghost-%COMP%]   .mapDetailsList[_ngcontent-%COMP%]{overflow:hidden}"]})};Hi=(0,Me.UN)([(0,C.aA)({name:"mapDetails",title:"igo.integration.tools.map",icon:"map"}),(0,Me.YR)("design:paramtypes",[mt,Ut,d.i6q,o.kD9,zt])],Hi);var zi=r(23680);function Sn(J,j){if(1&J){const u=o.KQA();o.I0R(0,"igo-layer-legend-list",4),o.qCj("allLegendsShown",function($){o.usT(u);const re=o.GaO();return o.CGJ(re.onShowAllLegends($))}),o.wVc(1,"async"),o.C$Y()}if(2&J){const u=o.GaO();o.E7m("excludeBaseLayers",u.excludeBaseLayers)("allowShowAllLegends",u.allowShowAllLegends)("updateLegendOnResolutionChange",u.updateLegendOnResolutionChange)("showAllLegendsValue",o.kDX(1,4,u.showAllLegendsValue$))}}function di(J,j){}function Pi(J,j){1&J&&o.yuY(0,di,0,0,"ng-template")}function io(J,j){if(1&J&&(o.I0R(0,"p",5),o.OEk(1),o.wVc(2,"async"),o.wVc(3,"translate"),o.wVc(4,"translate"),o.C$Y()),2&J){const u=o.GaO();o.yG2(),o.oRS(" ",o.kDX(2,1,u.visibleLayers$).length?o.kDX(3,3,"igo.integration.mapTool.noLayersInRange"):o.kDX(4,5,"igo.integration.mapTool.noLayersVisible"),"\n")}}function Po(J,j){1&J&&(o.I0R(0,"p",5),o.OEk(1),o.wVc(2,"translate"),o.C$Y()),2&J&&(o.yG2(),o.oRS(" ",o.kDX(2,1,"igo.integration.mapTool.customize")," "))}function fo(J,j){if(1&J){const u=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",7),o.S2Z(),o.I0R(2,"svg",8),o.wR5(3,"path",9),o.C$Y()(),o.gRP(),o.I0R(4,"span",10),o.qCj("click",function(){o.usT(u);const $=o.GaO(3);return o.CGJ($.searchEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.search-tool")," "))}function Fi(J,j){if(1&J){const u=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",7),o.S2Z(),o.I0R(2,"svg",8),o.wR5(3,"path",11),o.C$Y()(),o.gRP(),o.I0R(4,"span",12),o.qCj("click",function(){o.usT(u);const $=o.GaO(3);return o.CGJ($.catalogEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.catalog-tool")," "))}function bn(J,j){if(1&J){const u=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",7),o.S2Z(),o.I0R(2,"svg",8),o.wR5(3,"path",13),o.C$Y()(),o.gRP(),o.I0R(4,"span",14),o.qCj("click",function(){o.usT(u);const $=o.GaO(3);return o.CGJ($.contextEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.context-tool")," "))}function Xi(J,j){if(1&J&&(o.I0R(0,"mat-list")(1,"p",5),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.yuY(4,Po,3,3,"p",2)(5,fo,7,3,"mat-list-item",6)(6,Fi,7,3,"mat-list-item",6)(7,bn,7,3,"mat-list-item",6),o.C$Y()),2&J){const u=o.GaO(2);o.yG2(2),o.oRS(" ",o.kDX(3,5,"igo.integration.mapTool.empty")," "),o.yG2(2),o.E7m("ngIf",u.layerAdditionAllowed&&(u.searchToolInToolbar||u.catalogToolInToolbar||u.contextToolInToolbar)),o.yG2(),o.E7m("ngIf",u.layerAdditionAllowed&&u.searchToolInToolbar),o.yG2(),o.E7m("ngIf",u.layerAdditionAllowed&&u.catalogToolInToolbar),o.yG2(),o.E7m("ngIf",u.layerAdditionAllowed&&u.contextToolInToolbar)}}function Ri(J,j){if(1&J&&o.yuY(0,Xi,8,7,"mat-list",6),2&J){const u=o.GaO();o.E7m("ngIf",u.delayedShowEmptyMapContent)}}let pi=class Js{mapState;toolState;searchSourceService;cdRef;delayedShowEmptyMapContent=!1;layers$=new V.g([]);showAllLegendsValue$=new V.g(!1);change$=new zi.o(1);resolution$$;visibleOrInRangeLayers$$;updateLegendOnResolutionChange=!1;layerAdditionAllowed=!0;allowShowAllLegends=!1;showAllLegendsValue=!1;layerListControls={};get map(){return this.mapState.map}get visibleOrInRangeLayers$(){return this.layers$.pipe((0,ho.k)(j=>j.filter(u=>u.visible$.value&&u.isInResolutionsRange$.value)))}get visibleLayers$(){return this.layers$.pipe((0,ho.k)(j=>j.filter(u=>u.visible$.value)))}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get searchToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("searchResults")&&this.searchSourceService.getSources().filter(d.ayN).filter(j=>j.available&&"Layer"===j.getType()).length>0}get catalogToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("catalog")}get contextToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("contextManager")}constructor(j,u,S,$){this.mapState=j,this.toolState=u,this.searchSourceService=S,this.cdRef=$}ngOnInit(){this.resolution$$=(0,lo.E)([this.map.layers$,this.map.viewController.resolution$]).pipe((0,xo.o)(10)).subscribe(j=>{this.layers$.next(j[0].filter(u=>!(!1===u.showInLayerList||this.excludeBaseLayers&&u.baseLayer)))}),this.allowShowAllLegends?(this.mapState.showAllLegendsValue=void 0!==this.mapState.showAllLegendsValue?this.mapState.showAllLegendsValue:this.showAllLegendsValue||!1,this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue)):this.showAllLegendsValue$.next(!1),setTimeout(()=>{this.delayedShowEmptyMapContent=!0,this.cdRef.detectChanges()},250)}onShowAllLegends(j){this.mapState.showAllLegendsValue=j,this.showAllLegendsValue$.next(j)}showAllLegend(){if(0===this.layers$.getValue().length)return!1;if(0!==this.layers$.getValue().length&&!1===this.allowShowAllLegends){let j;if(this.visibleOrInRangeLayers$$=this.visibleOrInRangeLayers$.subscribe(u=>{j=0!==u.length}),!1===j)return!1}return!0}ngOnDestroy(){this.resolution$$.unsubscribe(),this.visibleOrInRangeLayers$$&&this.visibleOrInRangeLayers$$.unsubscribe()}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}static \u0275fac=function(u){return new(u||Js)(o.GI1(mt),o.GI1(Ut),o.GI1(d.i6q),o.GI1(o.kD9))};static \u0275cmp=o.In1({type:Js,selectors:[["igo-map-legend-tool"]],inputs:{updateLegendOnResolutionChange:"updateLegendOnResolutionChange",layerAdditionAllowed:"layerAdditionAllowed",allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue",layerListControls:"layerListControls"},standalone:!0,features:[o.UHJ],decls:8,vars:10,consts:[["igoLayerLegendListBinding","",3,"excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue","allLegendsShown",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","map-empty mat-typography",4,"ngIf"],["emptyLayers",""],["igoLayerLegendListBinding","",3,"excludeBaseLayers","allowShowAllLegends","updateLegendOnResolutionChange","showAllLegendsValue","allLegendsShown"],[1,"map-empty","mat-typography"],[4,"ngIf"],["matListItemIcon",""],["viewBox","0 0 24 24","fit","","height","100%","width","100%","preserveAspectRatio","xMidYMid meet","focusable","false"],["d","M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["d","M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["d","M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(u,S){if(1&u&&(o.yuY(0,Sn,2,6,"igo-layer-legend-list",0)(1,Pi,1,0,null,1),o.wVc(2,"async"),o.yuY(3,io,5,7,"p",2),o.wVc(4,"async"),o.wVc(5,"async"),o.yuY(6,Ri,1,1,"ng-template",null,3,o.gJz)),2&u){const $=o.Gew(7);o.E7m("ngIf",S.showAllLegend()),o.yG2(),o.E7m("ngIf",0!==o.kDX(2,4,S.layers$).length)("ngIfElse",$),o.yG2(2),o.E7m("ngIf",!S.allowShowAllLegends&&0!==o.kDX(4,6,S.layers$).length&&0===o.kDX(5,8,S.visibleOrInRangeLayers$).length)}},dependencies:[k.u_,d.wSE,d.ApN,Zt.iI,Zt.oL,Zt.g9,Zt.Y1,Zt.UV,Oe.oB,Oe.qL,k.a,Et._s,so.sD],styles:["[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   mat-list.mat-mdc-list-base[_ngcontent-%COMP%]   mat-list-item.mat-mdc-list-item[_ngcontent-%COMP%]     div.mdc-list-item__content div.mdc-list-item__primary-text{padding-left:5px}"]})};pi=(0,Me.UN)([(0,C.aA)({name:"mapLegend",title:"igo.integration.tools.legend",icon:"format_list_bulleted"}),(0,Me.YR)("design:paramtypes",[mt,Ut,d.i6q,o.kD9])],pi);var mi=r(21232),On=r(53156),In=r(51712);let gi=(()=>{class J{mapState;storageService;defaultProximityRadiusValue=30;enabled$=new V.g(!1);proximityRadiusValue$;proximitylocationType$=new V.g("geolocation");proximityFeatureStore;subs$$=[];currentPositionCoordinate$=new V.g(void 0);get map(){return this.mapState.map}constructor(u,S){this.mapState=u,this.storageService=S,this.proximityFeatureStore=new d.ym_([],{map:this.mapState.map}),this.proximityRadiusValue$=new V.g(this.storageService.get("mapProximityRadius")||this.defaultProximityRadiusValue),this.mapState.map.ol.once("rendercomplete",()=>{this.subscribeProximityMonitor()})}subscribeProximityMonitor(){this.subs$$.push((0,lo.E)([this.enabled$,this.proximitylocationType$,this.proximityRadiusValue$,(0,In.I)(5e3),this.map.geolocationController.position$]).pipe((0,xo.o)(750)).subscribe(u=>{this.proximityFeatureStore.clear();const S=u[0],$=this.map.layers,re=this.map.geolocationController.position$.value,ve=u[1],Be=u[2];if(this.storageService.set("mapProximityRadius",Be||this.defaultProximityRadiusValue),!S)return;let rt;if("geolocation"===ve){if(!re||!re.position)return;rt=_e.AF(re.position,re.projection,this.map.projection),this.map.mapCenter$.next(!1)}else rt=this.map.viewController.getCenter(),this.map.mapCenter$.next(!0);const Ct=_e.AF(rt,this.map.projection,"EPSG:4269"),vt=(0,d.uEw)(Ct,6);this.currentPositionCoordinate$.next(vt),$.filter(ft=>ft.ol instanceof On.c&&ft.dataSource.options.queryable&&ft.visible&&ft.isInResolutionsRange).map(ft=>{const Pt=ft.ol.getSource(),_t=Pt.getFeaturesAtCoordinate(rt);if(_t&&_t.length)_t.map(Do=>{const ki=(0,d.qKz)(Do,this.map.projection);let Ko=this.getQueryTitle(ki,ft);this.addFeatureToStore(ft,rt,ki,Ko,0)});else{const Do=Pt.getClosestFeatureToCoordinate(rt);if(Do){const ki=Do.getGeometry(),Ko=(0,d.qKz)(Do,this.map.projection),en=ki.getClosestPoint(rt),Jn=new St.c([rt,en]),dr=(0,d.cDV)(Jn,"EPSG:3857");if(dr<=Be){let Nr=this.getQueryTitle(Ko,ft);this.addFeatureToStore(ft,rt,Ko,Nr,dr)}}}})}))}addFeatureToStore(u,S,$,re,ve){const Be=(0,ui.uq)(),rt=this.map.ol.getView().getProjection(),Ct=$.ol.getGeometry(),vt=(new ii.c).writeGeometryObject(Ct,{featureProjection:rt,dataProjection:rt});this.proximityFeatureStore.update({type:d.YfI,geometry:vt,projection:rt.getCode(),properties:{...$.properties,id:Be,element:re,distance:ve,coordFromCalculatedDistance:S,layerSrcId:u.id,layerSrcTitle:u.title},meta:{id:Be}})}getQueryTitle(u,S){let $;if(S.options?.source?.options){const re=S.options.source.options;re.queryTitle&&($=this.getLabelMatch(u,re.queryTitle))}return $}getLabelMatch(u,S){let $=S;const re=Array.from(S.matchAll(/\$\{([^\{\}]+)\}/g));return re.forEach(ve=>{$=$.replace(ve[0],u.properties[ve[1]])}),0===re.length&&$===S&&($=u.properties[S]||S),$}static \u0275fac=function(S){return new(S||J)(o.CoB(mt),o.CoB(e.yQ))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();const wn=["table"];function Tn(J,j){if(1&J&&(o.I0R(0,"mat-form-field",14),o.wR5(1,"textarea",15,16),o.wVc(3,"translate"),o.C$Y()),2&J){const u=j.ngIf;o.yG2(),o.E7m("placeholder",o.kDX(3,2,"igo.integration.map-proximity-tool.lon"))("value",u[0])}}function En(J,j){if(1&J&&(o.I0R(0,"mat-form-field",17),o.wR5(1,"textarea",15,16),o.wVc(3,"translate"),o.C$Y()),2&J){const u=j.ngIf;o.yG2(),o.E7m("placeholder",o.kDX(3,2,"igo.integration.map-proximity-tool.lat"))("value",u[1])}}function ne(J,j){if(1&J){const u=o.KQA();o.I0R(0,"button",18),o.qCj("click",function(){o.usT(u);const $=o.GaO();return o.CGJ($.copyTextToClipboard())}),o.I0R(1,"mat-icon"),o.OEk(2,"content_copy"),o.C$Y()()}}let We=class Qs{mapState;mapProximityState;languageService;messageService;subs$$=[];table;get maxDistance(){return this.mapProximityState.proximityRadiusValue$.value}set maxDistance(j){this.mapProximityState.proximityRadiusValue$.next(j)}get map(){return this.mapState.map}userDefinedMapCenter;userDefinedFollowPosition;tableTemplate;constructor(j,u,S,$){this.mapState=j,this.mapProximityState=u,this.languageService=S,this.messageService=$,this.tableTemplate={selection:!0,selectMany:!1,selectionCheckbox:!1,sort:!0,columns:[{name:"element",title:this.languageService.translate.instant("igo.integration.map-proximity-tool.feature"),valueAccessor:re=>re.properties.element},{name:"distance",title:this.languageService.translate.instant("igo.integration.map-proximity-tool.distance"),valueAccessor:re=>`${ui.UD.roundToNDecimal(re.properties.distance,1)}m`}]}}ngOnInit(){this.mapProximityState.enabled$.next(!0),this.userDefinedFollowPosition=!0===this.map.geolocationController.followPosition,this.userDefinedMapCenter=!0===this.map.mapCenter$.value,this.subs$$.push(this.mapProximityState.proximitylocationType$.subscribe(j=>{this.map.mapCenter$.next("geolocation"!==j),this.map.geolocationController.followPosition="geolocation"===j}))}ngOnDestroy(){this.mapProximityState.enabled$.next(!1),this.map.mapCenter$.next(this.userDefinedMapCenter),this.subs$$.map(j=>j.unsubscribe()),this.map.geolocationController.followPosition=this.userDefinedFollowPosition}onLocationTypeChange(j){this.mapProximityState.proximitylocationType$.next(j.value)}copyTextToClipboard(){ui._D.copy(this.mapProximityState.currentPositionCoordinate$?.value.toString())&&this.messageService.success("igo.integration.map-proximity-tool.copyMsg","igo.integration.map-proximity-tool.copyTitle")}static \u0275fac=function(u){return new(u||Qs)(o.GI1(mt),o.GI1(gi),o.GI1(Et.ov),o.GI1($t.mi))};static \u0275cmp=o.In1({type:Qs,selectors:[["igo-map-proximity-tool"]],viewQuery:function(u,S){if(1&u&&o.CC$(wn,7),2&u){let $;o.wto($=o.Gqi())&&(S.table=$.first)}},standalone:!0,features:[o.UHJ],decls:31,vars:35,consts:[[1,"table-compact",3,"store","template"],["table",""],["class","coordinates",4,"ngIf"],["class","coordinates2",4,"ngIf"],["mat-icon-button","",3,"click",4,"ngIf"],[1,"title-container"],[1,"title","mat-typography"],[1,"igo-input-container","mat-typography"],[3,"change"],["value","geolocation",3,"checked"],["value","mapCenter",3,"checked"],[1,"radius-unit"],["floatLabel","always",1,"radius-field"],["type","number","pattern","[0-9]*","matInput","",3,"ngModel","placeholder","ngModelChange"],[1,"coordinates"],["matInput","","readonly","","rows","1",3,"placeholder","value"],["textArea",""],[1,"coordinates2"],["mat-icon-button","",3,"click"]],template:function(u,S){1&u&&(o.wR5(0,"igo-entity-table",0,1)(2,"br"),o.yuY(3,Tn,4,4,"mat-form-field",2),o.wVc(4,"async"),o.yuY(5,En,4,4,"mat-form-field",3),o.wVc(6,"async"),o.yuY(7,ne,3,0,"button",4),o.wVc(8,"async"),o.wVc(9,"async"),o.I0R(10,"div",5)(11,"mat-label",6),o.OEk(12),o.wVc(13,"translate"),o.C$Y()(),o.I0R(14,"div",7)(15,"mat-radio-group",8),o.qCj("change",function(re){return S.onLocationTypeChange(re)}),o.I0R(16,"mat-radio-button",9),o.wVc(17,"async"),o.OEk(18),o.wVc(19,"translate"),o.C$Y(),o.I0R(20,"mat-radio-button",10),o.wVc(21,"async"),o.OEk(22),o.wVc(23,"translate"),o.C$Y()()(),o.I0R(24,"div",11)(25,"mat-form-field",12)(26,"mat-label"),o.OEk(27),o.wVc(28,"translate"),o.C$Y(),o.I0R(29,"input",13),o.iHE("ngModelChange",function(re){return o.kNx(S.maxDistance,re)||(S.maxDistance=re),re}),o.wVc(30,"translate"),o.C$Y()()()),2&u&&(o.E7m("store",S.mapProximityState.proximityFeatureStore)("template",S.tableTemplate),o.yG2(3),o.E7m("ngIf",o.kDX(4,13,S.mapProximityState.currentPositionCoordinate$)),o.yG2(2),o.E7m("ngIf",o.kDX(6,15,S.mapProximityState.currentPositionCoordinate$)),o.yG2(2),o.E7m("ngIf",o.kDX(8,17,S.mapProximityState.currentPositionCoordinate$)&&o.kDX(9,19,S.mapProximityState.currentPositionCoordinate$).length),o.yG2(5),o.cNF(o.kDX(13,21,"igo.integration.map-proximity-tool.method")),o.yG2(4),o.E7m("checked","geolocation"===o.kDX(17,23,S.mapProximityState.proximitylocationType$)),o.yG2(2),o.cNF(o.kDX(19,25,"igo.integration.map-proximity-tool.geolocation")),o.yG2(2),o.E7m("checked","mapCenter"===o.kDX(21,27,S.mapProximityState.proximitylocationType$)),o.yG2(2),o.cNF(o.kDX(23,29,"igo.integration.map-proximity-tool.mapCenter")),o.yG2(5),o.cNF(o.kDX(28,31,"igo.integration.map-proximity-tool.radiusM")),o.yG2(2),o._6D("placeholder",o.kDX(30,33,"igo.integration.map-proximity-tool.radiusM")),o.OKB("ngModel",S.maxDistance))},dependencies:[C.Eh,k.u_,Io.wb,Io.Up,Io.w5,ci.cN,ci.yi,w.oJ,w.um,Oe.oB,Oe.qL,mi.yk,mi.cv,mi.cT,W.y,W.ot,W.O4,W.ue,W.E1,W._G,k.a,Et._s,so.sD],styles:["[_nghost-%COMP%]   .table-compact[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .table-compact[_ngcontent-%COMP%]     .mat-mdc-header-cell.mat-column-selectionCheckbox{width:52px}[_nghost-%COMP%]   textarea[_ngcontent-%COMP%]{resize:none}[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{padding:10px 15px}[_nghost-%COMP%]   mat-form-field.coordinates[_ngcontent-%COMP%]{width:110px}[_nghost-%COMP%]   mat-form-field.coordinates2[_ngcontent-%COMP%]{width:100px;padding:0 10px 0 3px}[_nghost-%COMP%]   mat-form-field.igo-input-container[_ngcontent-%COMP%]{width:60%;padding:0 15px}[_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:90%;margin-left:2px;padding:5px}[_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]   mat-form-field.radius-field[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;width:100%}[_nghost-%COMP%]   .title-container[_ngcontent-%COMP%]{padding:10px}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{margin-left:5px;font-size:initial}[_nghost-%COMP%]   .mat-mdc-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%]{display:inline-flex;position:relative;margin-left:12px}"]})};function _(J,j){if(1&J){const u=o.KQA();o.wR5(0,"igo-workspace-button",4),o.I0R(1,"igo-export-button",5),o.qCj("click",function(){const re=o.usT(u).layer,ve=o.GaO();return o.CGJ(ve.activateExport(re))}),o.C$Y(),o.wR5(2,"igo-ogc-filter-button",6)(3,"igo-time-filter-button",6)(4,"igo-track-feature-button",7)(5,"igo-metadata-button",4)}if(2&J){const u=j.layer,S=o.GaO();o.E7m("layer",u),o.yG2(),o.E7m("layer",u),o.yG2(),o.E7m("header",S.ogcButton)("layer",u),o.yG2(),o.E7m("header",S.timeButton)("layer",u),o.yG2(),o.E7m("trackFeature",!0)("layer",u),o.yG2(),o.E7m("layer",u)}}We=(0,Me.UN)([(0,C.aA)({name:"map-proximity",title:"igo.integration.tools.closestFeature",icon:"output_circle"}),(0,Me.YR)("design:paramtypes",[mt,gi,Et.ov,$t.mi])],We);let N=class Zs{mapState;toolState;importExportState;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;ogcButton=!0;timeButton=!0;layerListControls={};queryBadge=!1;get map(){return this.mapState.map}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get layerFilterAndSortOptions(){const j=Object.assign({showToolbar:d.g7B.default},this.layerListControls);switch(this.layerListControls.showToolbar){case d.g7B.always:j.showToolbar=d.g7B.always;break;case d.g7B.never:j.showToolbar=d.g7B.never}return j}constructor(j,u,S){this.mapState=j,this.toolState=u,this.importExportState=S}activateExport(j){let u=j.id;j.options.workspace?.workspaceId&&(u=j.options.workspace.workspaceId!==j.id?j.options.workspace.workspaceId:j.id),this.importExportState.setsExportOptions({layers:[u]}),this.importExportState.setMode(xt.export),this.toolState.toolbox.activateTool("importExport")}static \u0275fac=function(u){return new(u||Zs)(o.GI1(mt),o.GI1(Ut),o.GI1(zt))};static \u0275cmp=o.In1({type:Zs,selectors:[["igo-map-tool"]],inputs:{toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",ogcButton:"ogcButton",timeButton:"timeButton",layerListControls:"layerListControls",queryBadge:"queryBadge"},standalone:!0,features:[o.UHJ],decls:9,vars:13,consts:[[3,"label"],["igoLayerListBinding","",3,"map","excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge"],["igoLayerItemToolbar",""],["igoContextListBinding",""],[3,"layer"],[3,"layer","click"],[3,"header","layer"],[3,"trackFeature","layer"]],template:function(u,S){1&u&&(o.I0R(0,"mat-tab-group")(1,"mat-tab",0),o.wVc(2,"translate"),o.I0R(3,"igo-layer-list",1),o.yuY(4,_,6,9,"ng-template",null,2,o.gJz),o.C$Y()(),o.I0R(6,"mat-tab",0),o.wVc(7,"translate"),o.wR5(8,"igo-context-list",3),o.C$Y()()),2&u&&(o.yG2(),o.E7m("label",o.kDX(2,9,"igo.integration.tools.map")),o.yG2(2),o.E7m("map",S.map)("excludeBaseLayers",S.excludeBaseLayers)("layerFilterAndSortOptions",S.layerFilterAndSortOptions)("expandLegendOfVisibleLayers",S.expandLegendOfVisibleLayers)("toggleLegendOnVisibilityChange",S.toggleLegendOnVisibilityChange)("updateLegendOnResolutionChange",S.updateLegendOnResolutionChange)("queryBadge",S.queryBadge),o.yG2(3),o.E7m("label",o.kDX(7,11,"igo.integration.tools.contexts")))},dependencies:[bo.WG,bo.aJ,bo._q,d.m2U,d.Ult,Go,d.O_6,d.Ga$,d.eM$,d.ktW,d.Idw,et.W2,et.AX,Et._s,so.sD],styles:["[_nghost-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden}"],changeDetection:0})};N=(0,Me.UN)([(0,C.aA)({name:"map",title:"igo.integration.tools.map",icon:"map"}),(0,Me.YR)("design:paramtypes",[mt,Ut,zt])],N);const Q=["tabGroup"];function Ce(J,j){if(1&J&&o.wR5(0,"igo-style-modal-layer-button",11),2&J){const u=o.GaO().layer;o.E7m("layer",u)}}function Te(J,j){if(1&J){const u=o.KQA();o.I0R(0,"igo-time-filter-button",15),o.qCj("click",function(){o.usT(u);const $=o.GaO(3);return o.CGJ($.activateTimeFilter())}),o.C$Y()}if(2&J){const u=o.GaO().layer,S=o.GaO(2);o.E7m("header",S.timeButton)("layer",u)}}function Ne(J,j){if(1&J){const u=o.KQA();o.I0R(0,"igo-ogc-filter-button",15),o.qCj("click",function(){o.usT(u);const $=o.GaO(3);return o.CGJ($.activateOgcFilter())}),o.C$Y()}if(2&J){const u=o.GaO().layer,S=o.GaO(2);o.E7m("header",S.ogcButton)("layer",u)}}function gt(J,j){if(1&J){const u=o.KQA();o.I0R(0,"igo-export-button",16),o.qCj("click",function(){o.usT(u);const $=o.GaO().layer,re=o.GaO(2);return o.CGJ(re.activateExport($))}),o.C$Y()}if(2&J){const u=o.GaO().layer;o.E7m("layer",u)}}function It(J,j){if(1&J&&(o.yuY(0,Ce,1,1,"igo-style-modal-layer-button",10),o.wR5(1,"igo-metadata-button",11)(2,"igo-track-feature-button",12),o.yuY(3,Te,1,2,"igo-time-filter-button",13)(4,Ne,1,2,"igo-ogc-filter-button",13)(5,gt,1,1,"igo-export-button",14),o.wR5(6,"igo-workspace-button",11)),2&J){const u=j.layer,S=o.GaO(2);o.E7m("ngIf",S.isStyleEditButton(u)),o.yG2(),o.E7m("layer",u),o.yG2(),o.E7m("trackFeature",!0)("layer",u),o.yG2(),o.E7m("ngIf",S.isTimeFilterButton(u)),o.yG2(),o.E7m("ngIf",S.isOGCFilterButton(u)),o.yG2(),o.E7m("ngIf",S.isExportButton(u)),o.yG2(),o.E7m("layer",u)}}function it(J,j){if(1&J){const u=o.KQA();o.I0R(0,"igo-layer-list",8),o.qCj("appliedFilterAndSort",function($){o.usT(u);const re=o.GaO();return o.CGJ(re.onLayerListChange($))}),o.yuY(1,It,7,8,"ng-template",null,9,o.gJz),o.C$Y()}if(2&J){const u=o.GaO();o.E7m("excludeBaseLayers",u.excludeBaseLayers)("layerFilterAndSortOptions",u.layerFilterAndSortOptions)("expandLegendOfVisibleLayers",u.expandLegendOfVisibleLayers)("toggleLegendOnVisibilityChange",u.toggleLegendOnVisibilityChange)("updateLegendOnResolutionChange",u.updateLegendOnResolutionChange)("queryBadge",u.queryBadge)("map",u.map)}}function At(J,j){if(1&J){const u=o.KQA();o.I0R(0,"igo-layer-legend-list",17),o.qCj("allLegendsShown",function($){o.usT(u);const re=o.GaO();return o.CGJ(re.onShowAllLegends($))}),o.wVc(1,"async"),o.C$Y()}if(2&J){const u=o.GaO();o.E7m("allowShowAllLegends",u.allowShowAllLegends)("showAllLegendsValue",o.kDX(1,4,u.showAllLegendsValue$))("excludeBaseLayers",u.excludeBaseLayers)("updateLegendOnResolutionChange",u.updateLegendOnResolutionChange)}}function Dt(J,j){}function eo(J,j){1&J&&o.yuY(0,Dt,0,0,"ng-template")}function Qt(J,j){if(1&J&&(o.I0R(0,"p",18),o.OEk(1),o.wVc(2,"async"),o.wVc(3,"translate"),o.wVc(4,"translate"),o.C$Y()),2&J){const u=o.GaO();o.yG2(),o.oRS(" ",o.kDX(2,1,u.visibleLayers$).length?o.kDX(3,3,"igo.integration.mapTool.noLayersInRange"):o.kDX(4,5,"igo.integration.mapTool.noLayersVisible")," ")}}function wo(J,j){1&J&&(o.I0R(0,"p",18),o.OEk(1),o.wVc(2,"translate"),o.C$Y()),2&J&&(o.yG2(),o.oRS(" ",o.kDX(2,1,"igo.integration.mapTool.customize")," "))}function Jo(J,j){if(1&J){const u=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",20),o.S2Z(),o.I0R(2,"svg",21),o.wR5(3,"path",22),o.C$Y()(),o.gRP(),o.I0R(4,"span",23),o.qCj("click",function(){o.usT(u);const $=o.GaO(3);return o.CGJ($.searchEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.search-tool")," "))}function xn(J,j){if(1&J){const u=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",20),o.S2Z(),o.I0R(2,"svg",21),o.wR5(3,"path",24),o.C$Y()(),o.gRP(),o.I0R(4,"span",25),o.qCj("click",function(){o.usT(u);const $=o.GaO(3);return o.CGJ($.catalogEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.catalog-tool")," "))}function hi(J,j){if(1&J){const u=o.KQA();o.I0R(0,"mat-list-item")(1,"mat-icon",20),o.S2Z(),o.I0R(2,"svg",21),o.wR5(3,"path",26),o.C$Y()(),o.gRP(),o.I0R(4,"span",27),o.qCj("click",function(){o.usT(u);const $=o.GaO(3);return o.CGJ($.contextEmit())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y()()}2&J&&(o.yG2(5),o.oRS(" ",o.kDX(6,1,"igo.integration.mapTool.context-tool")," "))}function Mn(J,j){if(1&J&&(o.I0R(0,"mat-list")(1,"p",18),o.OEk(2),o.wVc(3,"translate"),o.C$Y(),o.yuY(4,wo,3,3,"p",6)(5,Jo,7,3,"mat-list-item",19)(6,xn,7,3,"mat-list-item",19)(7,hi,7,3,"mat-list-item",19),o.C$Y()),2&J){const u=o.GaO(2);o.yG2(2),o.oRS(" ",o.kDX(3,5,"igo.integration.mapTool.empty")," "),o.yG2(2),o.E7m("ngIf",u.layerAdditionAllowed&&(u.searchToolInToolbar||u.catalogToolInToolbar||u.contextToolInToolbar)),o.yG2(),o.E7m("ngIf",u.layerAdditionAllowed&&u.searchToolInToolbar),o.yG2(),o.E7m("ngIf",u.layerAdditionAllowed&&u.catalogToolInToolbar),o.yG2(),o.E7m("ngIf",u.layerAdditionAllowed&&u.contextToolInToolbar)}}function Dn(J,j){if(1&J&&o.yuY(0,Mn,8,7,"mat-list",19),2&J){const u=o.GaO();o.E7m("ngIf",u.delayedShowEmptyMapContent)}}let Li=class qs{layerListToolState;toolState;mapState;searchSourceService;importExportState;layers$=new V.g([]);showAllLegendsValue$=new V.g(!1);resolution$$;visibleOrInRangeLayers$$;delayedShowEmptyMapContent=!1;allowShowAllLegends=!1;showAllLegendsValue=!1;toggleLegendOnVisibilityChange=!1;expandLegendOfVisibleLayers=!1;updateLegendOnResolutionChange=!1;selectedTabAtOpening;ogcButton=!0;timeButton=!0;layerAdditionAllowed=!0;get layerListControls(){return this._layerListControls}set layerListControls(j){const u=this.layerListToolState.getLayerListControls(),S=u.keyword,$=u.onlyVisible,re=u.sortAlpha;j.keyword=""!==S?S:j.keyword,j.onlyVisible=void 0!==$?$:j.onlyVisible,j.sortAlpha=void 0!==re?re:j.sortAlpha,j.onlyVisible=void 0!==j.onlyVisible&&j.onlyVisible,j.sortAlpha=void 0!==j.sortAlpha&&j.sortAlpha,this._layerListControls=j}_layerListControls={};get map(){return this.mapState.map}queryBadge=!1;get visibleOrInRangeLayers$(){return this.layers$.pipe((0,ho.k)(j=>j.filter(u=>u.visible$.value&&u.isInResolutionsRange$.value)))}get visibleLayers$(){return this.layers$.pipe((0,ho.k)(j=>j.filter(u=>u.visible$.value)))}get excludeBaseLayers(){return this.layerListControls.excludeBaseLayers||!1}get layerFilterAndSortOptions(){const j=Object.assign({showToolbar:d.g7B.default},this.layerListControls);switch(this.layerListControls.showToolbar){case d.g7B.always:j.showToolbar=d.g7B.always;break;case d.g7B.never:j.showToolbar=d.g7B.never}return j}tabGroup;get searchToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("searchResults")&&this.searchSourceService.getSources().filter(d.ayN).filter(j=>j.available&&"Layer"===j.getType()).length>0}get catalogToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("catalog")}get contextToolInToolbar(){return-1!==this.toolState.toolbox.getToolbar().indexOf("contextManager")}constructor(j,u,S,$,re){this.layerListToolState=j,this.toolState=u,this.mapState=S,this.searchSourceService=$,this.importExportState=re}ngOnInit(){this.selectedTab(),this.resolution$$=(0,lo.E)([this.map.layers$,this.map.viewController.resolution$]).pipe((0,xo.o)(10)).subscribe(j=>{this.layers$.next(j[0].filter(u=>!(!1===u.showInLayerList||this.excludeBaseLayers&&u.baseLayer)))}),this.allowShowAllLegends?(this.mapState.showAllLegendsValue=void 0!==this.mapState.showAllLegendsValue?this.mapState.showAllLegendsValue:this.showAllLegendsValue||!1,this.showAllLegendsValue$.next(this.mapState.showAllLegendsValue)):this.showAllLegendsValue$.next(!1),setTimeout(()=>this.delayedShowEmptyMapContent=!0,250)}ngOnDestroy(){this.resolution$$.unsubscribe(),this.visibleOrInRangeLayers$$&&this.visibleOrInRangeLayers$$.unsubscribe()}onShowAllLegends(j){this.mapState.showAllLegendsValue=j,this.showAllLegendsValue$.next(j)}selectedTab(){const j=this.layerListToolState.selectedTab$.value;this.layerListToolState.setSelectedTab(void 0!==j?j:"legend"===this.selectedTabAtOpening?1:0)}tabChanged(j){this.layerListToolState.setSelectedTab(j.index),this.layers$.next(this.map.layers.filter(u=>!(!1===u.showInLayerList||this.excludeBaseLayers&&u.baseLayer)))}onLayerListChange(j){this.layerListToolState.setKeyword(j.keyword),this.layerListToolState.setSortAlpha(j.sortAlpha),this.layerListToolState.setOnlyVisible(j.onlyVisible)}showAllLegend(){if(0===this.layers$.getValue().length)return!1;if(0!==this.layers$.getValue().length&&!1===this.allowShowAllLegends){let j;if(this.visibleOrInRangeLayers$$=this.visibleOrInRangeLayers$.subscribe(u=>{j=0!==u.length}),!1===j)return!1}return!0}activateExport(j){let u=j.id;j.options.workspace?.workspaceId&&(u=j.options.workspace.workspaceId!==j.id?j.options.workspace.workspaceId:j.id),this.importExportState.setsExportOptions({layers:[u]}),this.importExportState.setMode(xt.export),this.toolState.toolbox.activateTool("importExport")}activateTimeFilter(){this.toolState.toolbox.activateTool("activeTimeFilter")}activateOgcFilter(){this.toolState.toolbox.activateTool("activeOgcFilter")}searchEmit(){this.toolState.toolbox.activateTool("searchResults")}catalogEmit(){this.toolState.toolbox.activateTool("catalog")}contextEmit(){this.toolState.toolbox.activateTool("contextManager")}isTimeFilterButton(j){const u=j.dataSource.options;return this.timeButton&&u.timeFilterable&&u.timeFilter}isOGCFilterButton(j){const u=j.dataSource.options;return this.ogcButton&&u.ogcFilters&&u.ogcFilters.enabled&&(u.ogcFilters.pushButtons||u.ogcFilters.checkboxes||u.ogcFilters.radioButtons||u.ogcFilters.select||u.ogcFilters.autocomplete||u.ogcFilters.editable)}isExportButton(j){return!!(j instanceof d.Mdo&&!0===j.exportable||j.dataSource.options.download&&j.dataSource.options.download.url||j.options.workspace?.enabled&&j.options.workspace?.workspaceId!==j.id)}isStyleEditButton(j){return!!(j instanceof d.Mdo&&j.options?.igoStyle?.editable)}static \u0275fac=function(u){return new(u||qs)(o.GI1($e),o.GI1(Ut),o.GI1(mt),o.GI1(d.i6q),o.GI1(zt))};static \u0275cmp=o.In1({type:qs,selectors:[["igo-map-tools"]],viewQuery:function(u,S){if(1&u&&o.CC$(Q,7),2&u){let $;o.wto($=o.Gqi())&&(S.tabGroup=$.first)}},inputs:{allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue",toggleLegendOnVisibilityChange:"toggleLegendOnVisibilityChange",expandLegendOfVisibleLayers:"expandLegendOfVisibleLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",selectedTabAtOpening:"selectedTabAtOpening",ogcButton:"ogcButton",timeButton:"timeButton",layerAdditionAllowed:"layerAdditionAllowed",layerListControls:"layerListControls",queryBadge:"queryBadge"},standalone:!0,features:[o.UHJ],decls:17,vars:23,consts:[[3,"selectedIndex","selectedTabChange"],["tabGroup",""],[3,"label"],["igoLayerListBinding","",3,"excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge","map","appliedFilterAndSort",4,"ngIf","ngIfElse"],["igoLayerLegendListBinding","",3,"allowShowAllLegends","showAllLegendsValue","excludeBaseLayers","updateLegendOnResolutionChange","allLegendsShown",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","map-empty mat-typography",4,"ngIf"],["emptyLayers",""],["igoLayerListBinding","",3,"excludeBaseLayers","layerFilterAndSortOptions","expandLegendOfVisibleLayers","toggleLegendOnVisibilityChange","updateLegendOnResolutionChange","queryBadge","map","appliedFilterAndSort"],["igoLayerItemToolbar",""],[3,"layer",4,"ngIf"],[3,"layer"],[3,"trackFeature","layer"],[3,"header","layer","click",4,"ngIf"],[3,"layer","click",4,"ngIf"],[3,"header","layer","click"],[3,"layer","click"],["igoLayerLegendListBinding","",3,"allowShowAllLegends","showAllLegendsValue","excludeBaseLayers","updateLegendOnResolutionChange","allLegendsShown"],[1,"map-empty","mat-typography"],[4,"ngIf"],["matListItemIcon",""],["viewBox","0 0 24 24","fit","","height","100%","width","100%","preserveAspectRatio","xMidYMid meet","focusable","false"],["d","M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"],["matListItemTitle","",1,"search-tool","mat-typography",3,"click"],["d","M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z"],["matListItemTitle","",1,"catalog-tool","mat-typography",3,"click"],["d","M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"],["matListItemTitle","",1,"context-tool","mat-typography",3,"click"]],template:function(u,S){if(1&u&&(o.I0R(0,"mat-tab-group",0,1),o.qCj("selectedTabChange",function(re){return S.tabChanged(re)}),o.wVc(2,"async"),o.I0R(3,"mat-tab",2),o.wVc(4,"translate"),o.yuY(5,it,3,7,"igo-layer-list",3),o.wVc(6,"async"),o.C$Y(),o.I0R(7,"mat-tab",2),o.wVc(8,"translate"),o.yuY(9,At,2,6,"igo-layer-legend-list",4)(10,eo,1,0,null,5),o.wVc(11,"async"),o.yuY(12,Qt,5,7,"p",6),o.wVc(13,"async"),o.wVc(14,"async"),o.C$Y(),o.yuY(15,Dn,1,1,"ng-template",null,7,o.gJz),o.C$Y()),2&u){const $=o.Gew(16);o.E7m("selectedIndex",o.kDX(2,9,S.layerListToolState.selectedTab$)),o.yG2(3),o.E7m("label",o.kDX(4,11,"igo.integration.tools.layers")),o.yG2(2),o.E7m("ngIf",0!==o.kDX(6,13,S.layers$).length)("ngIfElse",$),o.yG2(2),o.E7m("label",o.kDX(8,15,"igo.integration.tools.legend")),o.yG2(2),o.E7m("ngIf",S.showAllLegend()),o.yG2(),o.E7m("ngIf",0!==o.kDX(11,17,S.layers$).length)("ngIfElse",$),o.yG2(2),o.E7m("ngIf",!S.allowShowAllLegends&&0!==o.kDX(13,19,S.layers$).length&&0===o.kDX(14,21,S.visibleOrInRangeLayers$).length)}},dependencies:[bo.WG,bo.aJ,bo._q,k.u_,d.m2U,d.Ult,d.iOO,d.Idw,d.ktW,d.eM$,d.Ga$,d.O_6,Go,d.wSE,d.ApN,Zt.iI,Zt.oL,Zt.g9,Zt.Y1,Zt.UV,Oe.oB,Oe.qL,k.a,Et._s,so.sD],styles:["[_nghost-%COMP%]   mat-tab-group[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]     .mat-mdc-tab-body-wrapper{flex:1}[_nghost-%COMP%]     .mat-tab-body{margin-top:8px}[_nghost-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%], [_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .map-empty[_ngcontent-%COMP%]{text-align:justify}[_nghost-%COMP%]   .search-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .catalog-tool[_ngcontent-%COMP%], [_nghost-%COMP%]   .context-tool[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]     .mdc-list-item__primary-text{font-size:smaller}[_nghost-%COMP%]   mat-list.mat-mdc-list-base[_ngcontent-%COMP%]   mat-list-item.mat-mdc-list-item[_ngcontent-%COMP%]     div.mdc-list-item__content div.mdc-list-item__primary-text{padding-left:5px}"],changeDetection:0})};Li=(0,Me.UN)([(0,C.aA)({name:"mapTools",title:"igo.integration.tools.map",icon:"map"}),(0,Me.YR)("design:paramtypes",[$e,Ut,mt,d.i6q,zt])],Li);let Qi=(()=>{class J{mapState;store;constructor(u){this.mapState=u,this.store=new d.ym_([],{map:this.mapState.map}),this.mapState.map.layers$.subscribe(S=>{0===S.filter($=>$.id?.startsWith("igo-measures-")).length&&(this.store.deleteMany(this.store.all()),this.mapState.map.ol.getOverlays().getArray().filter($=>$.options.className.includes("igo-map-tooltip")).map($=>this.mapState.map.ol.removeOverlay($)))})}static \u0275fac=function(S){return new(S||J)(o.CoB(mt))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})(),Zi=class ea{measureState;mapState;get store(){return this.measureState.store}get map(){return this.mapState.map}constructor(j,u){this.measureState=j,this.mapState=u}static \u0275fac=function(u){return new(u||ea)(o.GI1(Qi),o.GI1(mt))};static \u0275cmp=o.In1({type:ea,selectors:[["igo-measurer-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:2,consts:[[3,"store","map"]],template:function(u,S){1&u&&o.wR5(0,"igo-measurer",0),2&u&&o.E7m("store",S.store)("map",S.map)},dependencies:[d.yaV],encapsulation:2,changeDetection:0})};Zi=(0,Me.UN)([(0,C.aA)({name:"measurer",title:"igo.integration.tools.measurer",icon:"square_foot"}),(0,Me.YR)("design:paramtypes",[Qi,mt])],Zi);let fi=class ta{mapState;get map(){return this.mapState.map}constructor(j){this.mapState=j}static \u0275fac=function(u){return new(u||ta)(o.GI1(mt))};static \u0275cmp=o.In1({type:ta,selectors:[["igo-print-tool"]],standalone:!0,features:[o.UHJ],decls:1,vars:1,consts:[[3,"map"]],template:function(u,S){1&u&&o.wR5(0,"igo-print",0),2&u&&o.E7m("map",S.map)},dependencies:[d.eAF],encapsulation:2})};fi=(0,Me.UN)([(0,C.aA)({name:"print",title:"igo.integration.tools.print",icon:"print"}),(0,Me.YR)("design:paramtypes",[mt])],fi);var no=r(50032),ir=r(12472);let Fn=(()=>{class J{searchSourceService;storageService;workspaceState;configService;mapState;searchLayerStores=[];searchOverlayStyle={};searchOverlayStyleSelection={};searchOverlayStyleFocus={};focusedOrResolution$$;selectedOrResolution$$;featureMotion={selected:d.Suj.Default,focus:d.Suj.None};searchTermSplitter$=new V.g("|");searchTerm$=new V.g(void 0);searchType$=new V.g(void 0);searchDisabled$=new V.g(!1);searchResultsGeometryEnabled$=new V.g(!1);searchSettingsChange$=new V.g(void 0);selectedResult$=new V.g(void 0);store=new C.qc([]);get searchTypes(){return this.searchSourceService.getEnabledSources().map(u=>u.constructor.type)}constructor(u,S,$,re,ve){this.searchSourceService=u,this.storageService=S,this.workspaceState=$,this.configService=re,this.mapState=ve;const Be=this.configService.getConfig("searchOverlayStyle");Be&&(this.searchOverlayStyle=Be.base,this.searchOverlayStyleSelection=Be.selection,this.searchOverlayStyleFocus=Be.focus);const rt=this.storageService.get("searchResultsGeometryEnabled");rt&&this.searchResultsGeometryEnabled$.next(rt),this.store.addStrategy(this.createCustomFilterTermStrategy(),!1);const Ct=this.searchSourceService.getSources().find(vt=>"workspace"===vt.getId());Ct&&this.workspaceState.store.entities$.subscribe(vt=>{const Kt=vt.filter(ft=>ft instanceof d.Wwb&&ft.layer.options.workspace.searchIndexEnabled);this.searchSourceService.setWorkspaces(Ct,Kt)}),this.monitorLayerDeletion()}monitorLayerDeletion(){this.mapState.map.layers$.subscribe(u=>{this.searchLayerStores.forEach(S=>{if(!u.find(re=>re.id===S.layer.id)){const re=this.searchLayerStores.indexOf(S);this.searchLayerStores.splice(re,1)}})})}createCustomFilterTermStrategy(){return new C.qq({filterClauseFunc:S=>100===S.entity.meta.score})}activateCustomFilterTermStrategy(){const u=this.store.getStrategyOfType(C.qq);void 0!==u&&u.activate()}deactivateCustomFilterTermStrategy(){const u=this.store.getStrategyOfType(C.qq);void 0!==u&&u.deactivate()}enableSearch(){this.searchDisabled$.next(!1)}disableSearch(){this.searchDisabled$.next(!0)}setSearchTerm(u){this.searchTerm$.next(u)}setSearchType(u){this.searchSourceService.enableSourcesByType(u),this.searchType$.next(u)}setSearchSettingsChange(){this.searchSettingsChange$.next(!0)}setSelectedResult(u){this.selectedResult$.next(u)}setSearchResultsGeometryStatus(u){this.storageService.set("searchResultsGeometryEnabled",u),this.searchResultsGeometryEnabled$.next(u)}static \u0275fac=function(S){return new(S||J)(o.CoB(d.i6q),o.CoB(e.yQ),o.CoB(go),o.CoB(Ft.aW),o.CoB(mt))};static \u0275prov=o.wxM({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();function Rn(J,j){1&J&&(o.I0R(0,"div",2)(1,"section",3)(2,"h4")(3,"strong"),o.OEk(4),o.wVc(5,"translate"),o.C$Y()(),o.I0R(6,"p")(7,"strong"),o.OEk(8),o.wVc(9,"translate"),o.C$Y()(),o.wR5(10,"div",4),o.wVc(11,"sanitizeHtml"),o.wVc(12,"translate"),o.C$Y()()),2&J&&(o.yG2(4),o.cNF(o.kDX(5,3,"igo.integration.searchResultsTool.noResults")),o.yG2(4),o.cNF(o.kDX(9,5,"igo.integration.searchResultsTool.doSearch")),o.yG2(2),o.E7m("innerHTML",o.kDX(11,7,o.kDX(12,9,"igo.integration.searchResultsTool.examples")),o.E3n))}function rr(J,j){if(1&J&&o.wR5(0,"igo-search-add-button",12),2&J){const u=j.result,S=o.GaO(2);o.E7m("map",S.map)("store",S.store)("stores",S.stores)("layer",u)("saveSearchResultInLayer",S.saveSearchResultInLayer)}}function sr(J,j){if(1&J){const u=o.KQA();o.I0R(0,"button",17),o.qCj("click",function(){o.usT(u);const $=o.GaO(3);return o.CGJ($.zoomToFeatureExtent())}),o.wVc(1,"translate"),o.wVc(2,"async"),o.I0R(3,"mat-icon",18),o.wVc(4,"async"),o.wVc(5,"async"),o.OEk(6,"zoom_in"),o.C$Y()()}if(2&J){const u=o.GaO(3);o.E7m("matTooltip",o.kDX(1,3,o.kDX(2,5,u.isSelectedResultOutOfView$)?"igo.integration.searchResultsTool.zoomOnFeatureTooltipOutOfView":"igo.integration.searchResultsTool.zoomOnFeatureTooltip")),o.yG2(3),o.E7m("matBadge",o.kDX(4,7,u.isSelectedResultOutOfView$)?"!":"")("matBadgeHidden",!1===o.kDX(5,9,u.isSelectedResultOutOfView$))}}function ar(J,j){if(1&J){const u=o.KQA();o.I0R(0,"igo-panel",13),o.qCj("click",function($){o.usT(u);const re=o.GaO(2);return o.CGJ(re.toggleTopPanel($))}),o.I0R(1,"button",14),o.qCj("click",function(){o.usT(u);const $=o.GaO(2);return o.CGJ($.toggleTopPanel())}),o.I0R(2,"mat-icon"),o.OEk(3),o.wVc(4,"async"),o.C$Y()(),o.yuY(5,sr,7,11,"button",15),o.I0R(6,"igo-feature-details",16),o.qCj("routingEvent",function(){o.usT(u);const $=o.GaO(2);return o.CGJ($.getRoute())}),o.wVc(7,"async"),o.C$Y()()}if(2&J){const u=o.GaO(2);o.E7m("title",u.featureTitle)("cursorPointer",!0),o.yG2(3),o.cNF("collapsed"===o.kDX(4,7,u.topPanelState$)?"arrow_upward":"arrow_downward"),o.yG2(2),o.E7m("ngIf",u.feature.geometry),o.yG2(),o.E7m("feature",o.kDX(7,9,u.feature$))("map",u.map)("toolbox",u.toolState.toolbox)}}function Hn(J,j){if(1&J){const u=o.KQA();o.I0R(0,"igo-flexible",5,6),o.wVc(2,"async"),o.I0R(3,"div",7)(4,"igo-search-results",8),o.qCj("resultFocus",function($){o.usT(u);const re=o.GaO();return o.CGJ(re.onResultFocus($))})("resultSelect",function($){o.usT(u);const re=o.GaO();return o.CGJ(re.onResultSelect($))})("resultUnfocus",function($){o.usT(u);const re=o.GaO();return o.CGJ(re.onResultUnfocus($))})("resultMouseenter",function($){o.usT(u);const re=o.GaO();return o.CGJ(re.onResultFocus($))})("resultMouseleave",function($){o.usT(u);const re=o.GaO();return o.CGJ(re.onResultUnfocus($))})("moreResults",function($){o.usT(u);const re=o.GaO();return o.CGJ(re.onSearch($))}),o.yuY(5,rr,1,5,"ng-template",null,9,o.gJz),o.C$Y()(),o.I0R(7,"div",10),o.yuY(8,ar,8,11,"igo-panel",11),o.wVc(9,"async"),o.C$Y()()}if(2&J){const u=o.GaO();o.E7m("state",o.kDX(2,8,u.feature$)?u.topPanelState:"initial"),o.yG2(4),o.E7m("store",u.store)("showIcons",u.showIcons)("term",u.term)("termSplitter",u.termSplitter)("settingsChange$",u.settingsChange$)("map",u.map),o.yG2(4),o.E7m("ngIf",o.kDX(9,10,u.feature$))}}let q=class oa{mapState;searchState;elRef;toolState;directionState;showIcons=!0;topPanelStateDefault="expanded";hasFeatureEmphasisOnSelection=!1;saveSearchResultInLayer=!1;showResultsGeometries$$;getRoute$$;shownResultsGeometries=[];shownResultsEmphasisGeometries=[];focusedResult$=new V.g(void 0);isSelectedResultOutOfView$=new V.g(!1);isSelectedResultOutOfView$$;abstractFocusedResult;abstractSelectedResult;debouncedEmpty$=new V.g(!0);debouncedEmpty$$;get store(){return this.searchState.store}get map(){return this.mapState.map}get featureTitle(){return this.feature?(0,C.YB)(this.feature):void 0}get feature$(){return this.store.stateView.firstBy$(j=>j.state.focused).pipe((0,ho.k)(j=>this.feature=j?j.entity.data:void 0))}feature;term="";searchTerm$$;settingsChange$=new V.g(void 0);topPanelState$=new V.g("initial");topPanelState$$;set topPanelState(j){this.topPanelState$.next(j)}get topPanelState(){return this.topPanelState$.value}get termSplitter(){return this.searchState.searchTermSplitter$.value}format=new ii.c;get stores(){return this.searchState.searchLayerStores}constructor(j,u,S,$,re,ve){this.mapState=j,this.searchState=u,this.elRef=S,this.toolState=$,this.directionState=re,this.hasFeatureEmphasisOnSelection=ve.getConfig("hasFeatureEmphasisOnSelection"),this.saveSearchResultInLayer=ve.getConfig("saveSearchResultInLayer")}ngOnInit(){this.searchTerm$$=this.searchState.searchTerm$.subscribe(j=>{null!=j&&""!==j?(this.term=j,this.debouncedEmpty$.next(!1)):""===j&&this.debouncedEmpty$.next(!0)});for(const j of this.store.stateView.all$().value)!0===this.store.state.get(j.entity).selected&&(this.topPanelState="expanded");this.searchState.searchSettingsChange$.subscribe(()=>{this.settingsChange$.next(!0)}),this.topPanelState$$=this.topPanelState$.subscribe(()=>{const j=this.computeElementRef()[0],u=this.computeElementRef()[1];u&&setTimeout(()=>{this.isScrolledIntoView(j,u)||this.adjustTopPanel(j,u)},C.Kg.transitionTime+50)}),this.hasFeatureEmphasisOnSelection&&(this.searchState.focusedOrResolution$$||(this.searchState.focusedOrResolution$$=(0,lo.E)([this.focusedResult$,this.map.viewController.resolution$]).subscribe(j=>this.buildResultEmphasis(j[0],"focused"))),this.searchState.selectedOrResolution$$||(this.searchState.selectedOrResolution$$=(0,lo.E)([this.searchState.selectedResult$,this.map.viewController.resolution$]).subscribe(j=>this.buildResultEmphasis(j[0],"selected")))),this.monitorResultOutOfView(),this.showResultsGeometries$$=(0,lo.E)([this.searchState.searchResultsGeometryEnabled$,this.store.stateView.all$(),this.focusedResult$,this.searchState.selectedResult$,this.searchState.searchTerm$,this.map.viewController.resolution$]).subscribe(j=>{const u=j[0],S=j[1];this.hasFeatureEmphasisOnSelection&&this.clearFeatureEmphasis("shown"),this.shownResultsGeometries.map(re=>this.map.queryResultsOverlay.removeFeature(re)),S.filter(re=>re.entity.meta.dataType===d.YfI&&re.entity.data.geometry&&!re.state.selected&&!re.state.focused).map(re=>{u&&(re.entity.data.meta.style=(0,d.IvV)(Object.assign({},{feature:re.entity.data},this.searchState.searchOverlayStyle,re.entity.style?.base?re.entity.style.base:{})),this.shownResultsGeometries.push(re.entity.data),this.map.queryResultsOverlay.addFeature(re.entity.data,d.Suj.None),this.hasFeatureEmphasisOnSelection&&this.buildResultEmphasis(re.entity,"shown"))})}),this.debouncedEmpty$$=this.store.stateView.empty$.pipe((0,xo.o)(1500)).subscribe(j=>this.debouncedEmpty$.next(j))}monitorResultOutOfView(){this.isSelectedResultOutOfView$$=(0,lo.E)([this.map.viewController.state$,this.searchState.selectedResult$]).pipe((0,xo.o)(100)).subscribe(j=>{const u=j[1];if(u){if(u.data.geometry){const S=(0,d.K6O)(u.data,this.map.projection),$=(0,d.q17)([S],this.map.viewController.getOlProjection());this.isSelectedResultOutOfView$.next((0,d.Ki0)(this.map.getExtent(),$))}}else this.isSelectedResultOutOfView$.next(!1)})}buildResultEmphasis(j,u){if("shown"!==u&&this.clearFeatureEmphasis(u),!j||!j.data.geometry)return;const $=(0,d.K6O)(j.data,this.map.projection).getGeometry();if((0,d.Yvl)(this.map.viewController,$.getExtent(),.0025)){const re=$.getExtent(),rt=new Ue.c({name:`${u}AbstractResult'`,geometry:new Ae.c([re[0]+(re[2]-re[0])/2,re[1]+(re[3]-re[1])/2])}),Ct=(0,d.qKz)(rt,this.map.projection);let vt,Kt=0;switch(u){case"focused":vt=(0,d._aW)(Object.assign({},{feature:Ct},this.searchState.searchOverlayStyleFocus,j.style?.focus?j.style.focus:{})),Kt=2;break;case"shown":vt=(0,d.IvV)(Object.assign({},{feature:Ct},this.searchState.searchOverlayStyle,j.style?.base?j.style.base:{}));break;case"selected":vt=(0,d._aW)(Object.assign({},{feature:Ct},this.searchState.searchOverlayStyleSelection,j.style?.selection?j.style.selection:{})),Kt=1}Ct.meta.style=vt,Ct.meta.style.setZIndex(2e3+Kt),this.map.searchResultsOverlay.addFeature(Ct,this.searchState.featureMotion.focus),"focused"===u&&(this.abstractFocusedResult=Ct),"selected"===u&&(this.abstractSelectedResult=Ct),"shown"===u&&this.shownResultsEmphasisGeometries.push(Ct)}else this.clearFeatureEmphasis(u)}clearFeatureEmphasis(j){"focused"===j&&this.abstractFocusedResult&&(this.map.searchResultsOverlay.removeFeature(this.abstractFocusedResult),this.abstractFocusedResult=void 0),"selected"===j&&this.abstractSelectedResult&&(this.map.searchResultsOverlay.removeFeature(this.abstractSelectedResult),this.abstractSelectedResult=void 0),"shown"===j&&(this.shownResultsEmphasisGeometries.map(u=>this.map.searchResultsOverlay.removeFeature(u)),this.shownResultsEmphasisGeometries=[])}ngOnDestroy(){this.topPanelState$$.unsubscribe(),this.searchTerm$$.unsubscribe(),this.isSelectedResultOutOfView$$&&this.isSelectedResultOutOfView$$.unsubscribe(),this.showResultsGeometries$$&&this.showResultsGeometries$$.unsubscribe(),this.getRoute$$&&this.getRoute$$.unsubscribe(),this.debouncedEmpty$$&&this.debouncedEmpty$$.unsubscribe()}onResultFocus(j){if(this.focusedResult$.next(j),j.meta.dataType===d.YfI&&j.data.geometry){j.data.meta.style=(0,d._aW)(Object.assign({},{feature:j.data},this.searchState.searchOverlayStyleFocus,j.style?.focus?j.style.focus:{}));const u=this.map.searchResultsOverlay.dataSource.ol.getFeatureById(j.meta.id);if(u)return void u.setStyle(j.data.meta.style);this.map.searchResultsOverlay.addFeature(j.data,this.searchState.featureMotion.focus)}}onResultUnfocus(j){if(this.focusedResult$.next(void 0),j.meta.dataType===d.YfI){if(!0===this.store.state.get(j).selected){const u=this.map.searchResultsOverlay.dataSource.ol.getFeatureById(j.meta.id);if(u){const S=(0,d._aW)(Object.assign({},{feature:j.data},this.searchState.searchOverlayStyleFocus,j.style?.focus?j.style.focus:{}));u.setStyle(S)}return}this.map.searchResultsOverlay.removeFeature(j.data)}}onResultSelect(j){if(this.map.searchResultsOverlay.dataSource.ol.clear(),this.tryAddFeatureToMap(j,this.searchState.featureMotion.selected),this.searchState.setSelectedResult(j),"initial"===this.topPanelState&&(this.topPanelState="collapsed"!==this.topPanelStateDefault?"expanded":"collapsed"),"expanded"===this.topPanelState){const u=this.computeElementRef()[0],S=this.computeElementRef()[1];this.isScrolledIntoView(u,S)||this.adjustTopPanel(u,S)}}onSearch(j){const u=j.results,S=this.store.entities$.value.filter($=>$.source!==j.research.source).concat(u);this.store.load(S);for(const $ of this.store.all())!0===this.store.state.get($).focused&&!0!==this.store.state.get($).selected&&this.store.state.update($,{focused:!1},!0);setTimeout(()=>{const $=this.elRef.nativeElement.querySelector("igo-list");let re;j.research.request.subscribe(ve=>{re=ve[0]&&ve[0].source?"icherche"===ve[0].source.getId()?$.querySelector(".icherche .moreResults"):"ilayer"===ve[0].source.getId()?$.querySelector(".ilayer .moreResults"):"nominatim"===ve[0].source.getId()?$.querySelector(".nominatim .moreResults"):$.querySelector("."+ve[0].source.getId()+" .moreResults"):null,null!==re&&!this.isScrolledIntoView($,re)&&($.scrollTop=re.offsetTop+re.offsetHeight-$.clientHeight)})},250)}computeElementRef(){const j=document.getElementsByTagName("igo-search-results-item"),u=this.elRef.nativeElement.getElementsByTagName("igo-list")[0];let S;for(let $=0;$<j.length;$++)j[$].className.includes("igo-list-item-selected")&&(S=j[$]);return[u,S]}adjustTopPanel(j,u){this.isScrolledIntoView(j,u)||(j.scrollTop=u.offsetTop+u.children[0].offsetHeight-j.clientHeight)}toggleTopPanel(j){j&&"igo-panel-title"!==j.target?.className||(this.topPanelState="expanded"===this.topPanelState?"collapsed":"expanded")}zoomToFeatureExtent(){if(this.feature.geometry){const j=this.format.readFeature(this.feature,{dataProjection:this.feature.projection,featureProjection:this.map.projectionCode});(0,d.QX5)(this.map.viewController,[j],d.Suj.Zoom)}}tryAddFeatureToMap(j,u=d.Suj.Default){if(j.meta.dataType!==d.YfI)return;const S=j.data;S.geometry&&(S.meta.style=(0,d._aW)(Object.assign({},{feature:S},this.searchState.searchOverlayStyleSelection,j.style?.selection?j.style.selection:{})),this.map.searchResultsOverlay.addFeature(S,u))}isScrolledIntoView(j,u){const $=j.scrollTop,ve=u.offsetTop;return ve+u.clientHeight+6<=$+j.clientHeight&&ve>=$}getRoute(){this.toolState.toolbox.activateTool("directions"),this.directionState.stopsStore.clearStops(),setTimeout(()=>{let j=!1;this.getRoute$$&&this.getRoute$$.unsubscribe(),this.getRoute$$=this.directionState.stopsStore.storeInitialized$.subscribe(u=>{if(this.directionState.stopsStore.storeInitialized$.value&&!j){j=!0;const S=this.directionState.stopsStore.all().find(re=>1===re.position);let $;if(this.feature.geometry)if("Point"===this.feature.geometry.type)$=[this.feature.geometry.coordinates[0],this.feature.geometry.coordinates[1]];else{const re=(0,ir.c)(this.feature.geometry);$=[re.geometry.coordinates[0],re.geometry.coordinates[1]]}if(S.text=this.featureTitle,S.coordinates=$,this.directionState.stopsStore.update(S),this.map.geolocationController.position$.value){const re=this.map.geolocationController.position$.value,ve=this.directionState.stopsStore.all().find(Ct=>0===Ct.position),Be=_e.AF(re.position,re.projection,"EPSG:4326"),rt=(0,d.uEw)([Be[0],Be[1]],6);ve.text=rt.join(","),ve.coordinates=rt,this.directionState.stopsStore.update(ve)}}})},250)}static \u0275fac=function(u){return new(u||oa)(o.GI1(mt),o.GI1(Fn),o.GI1(o.GMv),o.GI1(Ut),o.GI1(to),o.GI1(Ft.aW))};static \u0275cmp=o.In1({type:oa,selectors:[["igo-search-results-tool"]],inputs:{showIcons:"showIcons",topPanelStateDefault:"topPanelStateDefault",topPanelState:"topPanelState"},standalone:!0,features:[o.UHJ],decls:4,vars:6,consts:[["style","margin: 10px",4,"ngIf"],["initial","100%","initialMobile","100%","collapsed","calc(100% - 58px)","collapsedMobile","calc(100% - 58px)","expanded","60%","expandedMobile","60%",3,"state",4,"ngIf"],[2,"margin","10px"],[1,"mat-typography"],[3,"innerHTML"],["initial","100%","initialMobile","100%","collapsed","calc(100% - 58px)","collapsedMobile","calc(100% - 58px)","expanded","60%","expandedMobile","60%",3,"state"],["topPanel",""],[1,"igo-content"],["placeholder","false",3,"store","showIcons","term","termSplitter","settingsChange$","map","resultFocus","resultSelect","resultUnfocus","resultMouseenter","resultMouseleave","moreResults"],["igoSearchItemToolbar",""],["igoFlexibleFill","",1,"igo-content"],[3,"title","cursorPointer","click",4,"ngIf"],[3,"map","store","stores","layer","saveSearchResultInLayer"],[3,"title","cursorPointer","click"],["mat-icon-button","","panelLeftButton","",1,"igo-icon-button",3,"click"],["mat-icon-button","","panelRightButton","","class","igo-icon-button","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["igoFeatureDetailsDirective","",3,"feature","map","toolbox","routingEvent"],["mat-icon-button","","panelRightButton","","matTooltipShowDelay","500",1,"igo-icon-button",3,"matTooltip","click"],["aria-hidden","false","matBadgeColor","accent","matBadgeSize","small",3,"matBadge","matBadgeHidden"]],template:function(u,S){1&u&&(o.yuY(0,Rn,13,11,"div",0),o.wVc(1,"async"),o.yuY(2,Hn,10,12,"igo-flexible",1),o.wVc(3,"async")),2&u&&(o.E7m("ngIf",(!S.store||S.store.stateView.empty)&&o.kDX(1,2,S.debouncedEmpty$)),o.yG2(2),o.E7m("ngIf",!1===o.kDX(3,4,S.debouncedEmpty$)))},dependencies:[k.u_,C.Kg,d.kBh,d.qE2,C.cP,w.oJ,w.um,Oe.oB,Oe.qL,ze.KO,ze.a4,no.g,no.S,d.wP$,k.a,Et._s,so.sD,C.Ux],encapsulation:2,changeDetection:0})};q=(0,Me.UN)([(0,C.aA)({name:"searchResults",title:"igo.integration.tools.searchResults",icon:"search"}),(0,Me.YR)("design:paramtypes",[mt,Fn,o.GMv,Ut,to,Ft.aW])],q);var ge=r(58136),Ye=r(87004);function Je(J,j){1&J&&o.wR5(0,"igo-form-field",8),2&J&&o.E7m("field",j.$implicit)}function ro(J,j){if(1&J&&(o.I0R(0,"div",6),o.yuY(1,Je,1,1,"igo-form-field",7),o.C$Y()),2&J){const u=o.GaO().ngIf;o.yG2(),o.E7m("ngForOf",u.fields)}}function yi(J,j){if(1&J){const u=o.KQA();o.I0R(0,"igo-form",1),o.qCj("submitForm",function($){o.usT(u);const re=o.GaO();return o.CGJ(re.onSubmit($))}),o.wVc(1,"async"),o.yuY(2,ro,2,1,"div",2),o.I0R(3,"div",3)(4,"button",4),o.qCj("click",function(){o.usT(u);const $=o.GaO();return o.CGJ($.clearForm())}),o.OEk(5),o.wVc(6,"translate"),o.C$Y(),o.I0R(7,"button",5),o.OEk(8),o.wVc(9,"translate"),o.C$Y()()()}if(2&J){const u=j.ngIf,S=o.GaO();o.E7m("form",u)("formData",o.kDX(1,6,S.data$)),o.yG2(2),o.E7m("ngIf",u.fields.length),o.yG2(3),o.oRS(" ",o.kDX(6,8,"igo.integration.dataIssueReporterTool.reset.button")," "),o.yG2(2),o.E7m("disabled",S.submitDisabled),o.yG2(),o.oRS(" ",o.kDX(9,10,"igo.integration.dataIssueReporterTool.submit.button")," ")}}let Fo=class ia{mapState;formService;languageService;messageService;httpClient;url;get map(){return this.mapState.map}form$=new V.g(void 0);data$=new V.g(void 0);submitDisabled=!0;valueChanges$$;constructor(j,u,S,$,re){this.mapState=j,this.formService=u,this.languageService=S,this.messageService=$,this.httpClient=re}ngOnInit(){(0,lo.E)([this.languageService.language$,this.map.layers$]).subscribe(([j,u])=>{const S=u.filter(Be=>Be.baseLayer||Be.showInLayerList).map(Be=>({value:`${Be.title}-${Be.id}`,title:Be.title})),re=[{name:"geometry",title:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.geometry"),type:"geometry",inputs:{map:this.map,geometryTypeField:!0,geometryType:"Polygon",drawGuideField:!1,drawGuide:0,drawGuidePlaceholder:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.drawGuidePlaceholder"),drawStyle:new te.cp({stroke:new Z.c({color:[255,0,0,1],width:2}),fill:new K.c({color:[255,0,0,.2]}),image:new X.c({radius:8,stroke:new Z.c({color:[255,0,0,1]}),fill:new K.c({color:[255,0,0,.2]})})}),overlayStyle:new te.cp({stroke:new Z.c({color:[0,255,0,1],width:2}),fill:new K.c({color:[0,255,0,.2]}),image:new X.c({radius:8,stroke:new Z.c({color:[0,255,0,1]}),fill:new K.c({color:[0,255,0,.2]})})})}},{name:"layer",title:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.layer"),type:"select",options:{cols:2},inputs:{choices:S}},{name:"desc",title:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.description"),type:"textarea",options:{validator:W.AQ.required}},{name:"email",title:this.languageService.translate.instant("igo.integration.dataIssueReporterTool.email"),options:{validator:W.AQ.email}}].map(Be=>this.formService.field(Be)),ve=this.formService.form(re,[]);this.valueChanges$$=ve.control.valueChanges.subscribe(()=>{this.submitDisabled=!ve.control.valid}),this.form$.next(ve)})}ngOnDestroy(){this.valueChanges$$.unsubscribe()}clearForm(){this.form$.value.control.reset()}onSubmit(j){const u="igo.integration.dataIssueReporterTool.submit.title";this.url?(this.httpClient.post(this.url,j).subscribe(()=>{this.messageService.success("igo.integration.dataIssueReporterTool.submit.message",u)}),this.clearForm()):(this.messageService.alert("igo.integration.dataIssueReporterTool.submit.setupMessage",u),alert(JSON.stringify(j)))}static \u0275fac=function(u){return new(u||ia)(o.GI1(mt),o.GI1(C.eO),o.GI1(Et.ov),o.GI1($t.mi),o.GI1(ct.KK))};static \u0275cmp=o.In1({type:ia,selectors:[["igo-issue-reporter-tool"]],inputs:{url:"url"},decls:2,vars:3,consts:[[3,"form","formData","submitForm",4,"ngIf"],[3,"form","formData","submitForm"],["class","form-container",4,"ngIf"],["formButtons","",1,"actions-container"],["mat-stroked-button","","type","button","color","primary",3,"click"],["mat-flat-button","","type","submit","color","primary",3,"disabled"],[1,"form-container"],[3,"field",4,"ngFor","ngForOf"],[3,"field"]],template:function(u,S){1&u&&(o.yuY(0,yi,10,12,"igo-form",0),o.wVc(1,"async")),2&u&&o.E7m("ngIf",o.kDX(1,1,S.form$))},dependencies:[k.ay,k.u_,w.Gw,ge._,Ye.Y,k.a,so.sD],styles:["[_nghost-%COMP%]   .actions-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(:last-child){margin-right:8px}[_nghost-%COMP%]   .form-container[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .form-container[_ngcontent-%COMP%]   igo-form-field[_ngcontent-%COMP%]{display:block;height:auto}"]})};Fo=(0,Me.UN)([(0,C.aA)({name:"dataIssueReporter",title:"igo.integration.tools.dataIssueReporter",icon:"feedback"}),(0,Me.YR)("design:paramtypes",[mt,C.eO,Et.ov,$t.mi,ct.KK])],Fo);var zn=r(8636),Xn=r(69800),lr=r(8408),Vr=r(71320);const jr=["mapBrowser"];function Qo(J,j){if(1&J&&(o.I0R(0,"span",12),o.OEk(1),o.C$Y()),2&J){const u=o.GaO();o.yG2(),o.oRS(" Pointer activated: ",u.igoSearchPointerSummaryEnabled," (F2 activate/deactivate the pointer location). ")}}function _i(J,j){if(1&J&&o.wR5(0,"igo-search-add-button",13),2&J){const u=j.result,S=o.GaO();o.E7m("map",S.map)("layer",u)}}function $o(J,j){if(1&J&&(o.I0R(0,"igo-panel",12),o.wR5(1,"igo-feature-details",14),o.C$Y()),2&J){const u=o.GaO();o.yG2(),o.E7m("feature",u.selectedFeature)}}function Gi(J,j){if(1&J&&o.wR5(0,"igo-actionbar",15),2&J){const u=o.GaO();o.E7m("store",u.store)("withIcon",!1)("horizontal",!0)("mode",u.actionBarMode)}}const yo=()=>["ConfigService","LanguageService"];let _o=(()=>{class J{mapService;layerService;searchState;mediaService;storageService;store=new C.MF([]);actionBarMode=C.m0.Context;igoSearchPointerSummaryEnabled=!1;termSplitter="|";map=new d.yGW({overlay:!0,controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};mapBrowser;lonlat;mapProjection;term;settingsChange$=new V.g(void 0);get searchStore(){return this.searchState.store}get isTouchScreen(){return this.mediaService.isTouchScreen()}selectedFeature;igoReverseSearchCoordsFormatEnabled;constructor(u,S,$,re,ve){this.mapService=u,this.layerService=S,this.searchState=$,this.mediaService=re,this.storageService=ve,this.mapService.setMap(this.map),this.layerService.createAsyncLayer({title:"OSM",baseLayer:!0,visible:!0,sourceOptions:{type:"osm"}}).subscribe(Be=>this.map.addLayer(Be)),this.igoReverseSearchCoordsFormatEnabled=!!this.storageService.get("reverseSearchCoordsFormatEnabled")||!1}onPointerSummaryStatusChange(u){this.igoSearchPointerSummaryEnabled=u}onSearchTermChange(u){this.term=u,this.searchState.setSearchTerm(u),u.replace(/(#[^\s]*)/g,"").trim().length<2&&(this.searchStore.clear(),this.selectedFeature=void 0)}onSearch(u){const S=u.results;this.searchStore.state.updateAll({focused:!1,selected:!1});const $=this.searchStore.entities$.value.filter(re=>re.source!==u.research.source).concat(S);this.searchStore.updateMany($)}onReverseCoordsFormatStatusChange(u){this.storageService.set("reverseSearchCoordsFormatEnabled",u),this.igoReverseSearchCoordsFormatEnabled=u}onSearchSettingsChange(){this.settingsChange$.next(!0)}onResultFocus(u){this.tryAddFeatureToMap(u,this.searchState.featureMotion.focus),this.selectedFeature=u.data}onResultSelect(u){this.tryAddFeatureToMap(u,this.searchState.featureMotion.selected),this.selectedFeature=u.data}tryAddFeatureToMap(u,S=d.Suj.Default){u.meta.dataType===d.YfI&&void 0!==u.data.geometry&&this.map.searchResultsOverlay.setFeatures([u.data],S)}ngOnInit(){this.store.load([{id:"coordinates",title:"coordinates",handler:()=>this.searchCoordinate(this.lonlat)},{id:"googleMaps",title:"googleMap",handler:()=>this.openGoogleMaps(this.lonlat)},{id:"googleStreetView",title:"googleStreetView",handler:()=>this.openGoogleStreetView(this.lonlat)}])}ngOnDestroy(){this.store.destroy()}removeFeatureFromMap(){this.map.searchResultsOverlay.clear()}onContextMenuOpen(u){const S=this.mapPosition(u),$=this.mapService.getMap().ol.getCoordinateFromPixel(S);this.mapProjection=this.mapService.getMap().projectionCode,this.lonlat=_e.AF($,this.mapProjection,"EPSG:4326")}mapPosition(u){const S=u;return S.y=S.y-this.mapBrowser.nativeElement.getBoundingClientRect().top+window.scrollY,S.x=S.x-this.mapBrowser.nativeElement.getBoundingClientRect().left+window.scrollX,[S.x,S.y]}searchCoordinate(u){this.searchStore.clear(),this.term=this.igoReverseSearchCoordsFormatEnabled?u.reverse().map(S=>S.toFixed(6)).join(", "):u.map(S=>S.toFixed(6)).join(", ")}openGoogleMaps(u){window.open(d.s9F.getGoogleMapsCoordLink(u[0],u[1]))}openGoogleStreetView(u){window.open(d.s9F.getGoogleStreetViewLink(u[0],u[1]))}static \u0275fac=function(S){return new(S||J)(o.GI1(d.u00),o.GI1(d.IZ6),o.GI1(Fn),o.GI1(c.QB),o.GI1(e.yQ))};static \u0275cmp=o.In1({type:J,selectors:[["app-search"]],viewQuery:function(S,$){if(1&S&&o.CC$(jr,7,o.GMv),2&S){let re;o.wto(re=o.Gqi())&&($.mapBrowser=re.first)}},standalone:!0,features:[o.M5G([d._wi,(0,d.qED)(),(0,d.iew)(),(0,d.yCe)(),(0,d.kzx)()]),o.UHJ],decls:15,vars:19,consts:[["title","Search","subtitle","Geo",3,"dependencies"],["codeFolder","geo/search","configFolder","environments"],["title","Details",4,"ngIf"],["igoOverlay","","igoLongPress","","igoSearchPointerSummary","",3,"map","view","igoContextMenu","igoSearchPointerSummaryDelay","igoSearchPointerSummaryEnabled","menuPosition"],["mapBrowser",""],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["title","Search"],[3,"term","searchSettings","store","termSplitter","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchTermChange","search","clearFeature","searchSettingsChange","reverseSearchCoordsFormatStatus"],["placeholder","false",3,"store","term","termSplitter","settingsChange$","resultFocus","resultSelect","moreResults"],["igoSearchItemToolbar",""],["actionbarMenu",""],["title","Details"],[3,"map","layer"],[3,"feature"],[3,"store","withIcon","horizontal","mode"]],template:function(S,$){if(1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1),o.yuY(2,Qo,2,1,"span",2),o.I0R(3,"igo-map-browser",3,4),o.qCj("menuPosition",function(ve){return $.onContextMenuOpen(ve)}),o.I0R(5,"div",5),o.wR5(6,"igo-zoom-button",6),o.C$Y()(),o.I0R(7,"igo-panel",7)(8,"igo-search-bar",8),o.qCj("pointerSummaryStatus",function(ve){return $.onPointerSummaryStatusChange(ve)})("searchTermChange",function(ve){return $.onSearchTermChange(ve)})("search",function(ve){return $.onSearch(ve)})("clearFeature",function(){return $.removeFeatureFromMap()})("searchSettingsChange",function(){return $.onSearchSettingsChange()})("reverseSearchCoordsFormatStatus",function(ve){return $.onReverseCoordsFormatStatusChange(ve)}),o.C$Y(),o.I0R(9,"igo-search-results",9),o.qCj("resultFocus",function(ve){return $.onResultFocus(ve)})("resultSelect",function(ve){return $.onResultSelect(ve)})("moreResults",function(ve){return $.onSearch(ve)}),o.yuY(10,_i,1,2,"ng-template",null,10,o.gJz),o.C$Y()(),o.yuY(12,$o,2,1,"igo-panel",2)(13,Gi,1,4,"ng-template",null,11,o.gJz),o.C$Y()()),2&S){const re=o.Gew(14);o.E7m("dependencies",o.q4q(18,yo)),o.yG2(2),o.E7m("ngIf",!$.isTouchScreen),o.yG2(),o.E7m("map",$.map)("view",$.view)("igoContextMenu",re)("igoSearchPointerSummaryDelay",500)("igoSearchPointerSummaryEnabled",$.igoSearchPointerSummaryEnabled),o.yG2(3),o.E7m("map",$.map),o.yG2(2),o.E7m("term",$.term)("searchSettings",!0)("store",$.searchStore)("termSplitter",$.termSplitter)("reverseSearchCoordsFormatEnabled",$.igoReverseSearchCoordsFormatEnabled),o.yG2(),o.E7m("store",$.searchStore)("term",$.term)("termSplitter",$.termSplitter)("settingsChange$",$.settingsChange$),o.yG2(3),o.E7m("ngIf",$.selectedFeature)}},dependencies:[L.u,P.I,k.u_,d.q2F,d.qcl,C.L0,C.SM,d.Oy$,zn.A,Xn.T,lr.q,Vr.k,C.cP,C.AI,d.wP$],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{height:100%;width:100%;padding-top:10px}"]})}return J})();function Mo(J,j){if(1&J&&(o.I0R(0,"p"),o.OEk(1),o.C$Y()),2&J){const u=o.GaO();o.yG2(),o.cNF(u.pointerCoord)}}const Kr=()=>["LanguageService"];let cr=(()=>{class J{dataSourceService;layerService;mediaService;pointerCoord;pointerCoordDelay=0;map=new d.yGW({controls:{attribution:{collapsed:!0},scaleLine:!0}});view={center:[-73,47.2],zoom:6,rotation:.75};get media(){return this.mediaService.getMedia()}get isTouchScreen(){return this.mediaService.isTouchScreen()}constructor(u,S,$){this.dataSourceService=u,this.layerService=S,this.mediaService=$,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(re=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:re,visible:!0,baseLayer:!0}))})}onPointerMove(u){this.pointerCoord=u}static \u0275fac=function(S){return new(S||J)(o.GI1(d.OEM),o.GI1(d.IZ6),o.GI1(c.QB))};static \u0275cmp=o.In1({type:J,selectors:[["app-simple-map"]],standalone:!0,features:[o.UHJ],decls:13,vars:12,consts:[["title","Simple Map","subtitle","Geo",3,"dependencies"],["codeFolder","geo/simple-map"],["igoPointerPosition","",3,"map","view","pointerPositionDelay","pointerPositionCoord"],[3,"infoContent"],[1,"map-actions","--vertical","--top","--right"],[1,"spinner-spacer"],["color","primary",1,"mat-elevation-z2",3,"showIfNoRotation","map"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",1,"mat-elevation-z2",3,"map"],["color","primary",3,"map"],[4,"ngIf"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2),o.qCj("pointerPositionCoord",function(ve){return $.onPointerMove(ve)}),o.wR5(3,"igo-info-section",3),o.I0R(4,"div",4),o.wR5(5,"div",5)(6,"igo-rotation-button",6),o.C$Y(),o.I0R(7,"div",7),o.wR5(8,"igo-home-extent-button",8)(9,"igo-wake-lock-button")(10,"igo-geolocate-button",8)(11,"igo-zoom-button",9),o.C$Y()(),o.yuY(12,Mo,2,1,"p",10),o.C$Y()()),2&S&&(o.E7m("dependencies",o.q4q(11,Kr)),o.yG2(2),o.E7m("map",$.map)("view",$.view)("pointerPositionDelay",$.pointerCoordDelay),o.yG2(),o.E7m("infoContent",null==$.pointerCoord?null:$.pointerCoord.toString()),o.yG2(3),o.E7m("showIfNoRotation",!0)("map",$.map),o.yG2(2),o.E7m("map",$.map),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("map",$.map),o.yG2(),o.E7m("ngIf",!$.isTouchScreen))},dependencies:[L.u,P.I,d.cdH,d.eqy,d.Y1E,d.q2F,d.knT,d.i6P,d.w16,d.qcl,k.u_],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:350px}"]})}return J})();function Wr(J,j){if(1&J&&(o.SAx(0),o.wR5(1,"igo-feature-details",11),o.k70()),2&J){const u=j.ngIf;o.yG2(),o.E7m("feature",u)}}const aa=()=>["LanguageService"];let Nt=(()=>{class J{matIconRegistry;spatialFilterService;dataSourceService;layerService;messageService;languageService;cdRef;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:6};type;itemType=d.c97.Address;freehandDrawIsActive;layers=[];activeLayers=[];queryType;thematics;zone;zoneWithBuffer;buffer=0;iterator=1;selectedFeature$=new V.g(void 0);format=new ii.c;store=new C.qc([]);spatialListStore=new C.qc([]);loading=!1;thematicLength=0;measureUnit=d.K88.Meters;unsubscribe$=new y.E;defaultStyle;constructor(u,S,$,re,ve,Be,rt){this.matIconRegistry=u,this.spatialFilterService=S,this.dataSourceService=$,this.layerService=re,this.messageService=ve,this.languageService=Be,this.cdRef=rt,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(Ct=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:Ct,baseLayer:!0,visible:!0}))})}ngOnInit(){for(const u of this.map.layers)u.title&&u.title.includes(this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"))&&this.layers.push(u)}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}getOutputType(u){this.type=u,this.queryType=void 0}getOutputQueryType(u){this.queryType=u,this.queryType&&this.loadFilterList()}loadFilterList(){this.spatialFilterService.loadFilterList(this.queryType).pipe((0,Lo.a)(this.unsubscribe$)).subscribe(u=>{u.sort((S,$)=>S.properties.nom<$.properties.nom?-1:S.properties.nom>$.properties.nom?1:0),this.spatialListStore.clear(),this.spatialListStore.load(u)})}getOutputToggleSearch(){this.loadThematics()}getOutputClearSearch(){this.zone=void 0,this.queryType=void 0}clearMap(){this.map.removeLayers(this.layers),this.layers=[],this.activeLayers=[],this.thematicLength=0,this.iterator=1,this.type===d._cQ.Predefined&&(this.zone=void 0,this.queryType=void 0)}loadThematics(){this.loading=!0;let S,u=!0;(0===this.buffer||this.type===d._cQ.Point)&&this.tryAddFeaturesToMap([this.zone]),S=this.itemType!==d.c97.Thematics?[{name:""}]:this.thematics,this.measureUnit===d.K88.Kilometers&&this.type!==d._cQ.Point&&(this.buffer=1e3*this.buffer),this.type===d._cQ.Polygon&&(this.buffer=0);const $=[];S.forEach(re=>{$.push(this.spatialFilterService.loadFilterItem(this.zone,this.itemType,this.queryType,re,this.buffer).pipe((0,si.y)(ve=>{this.store.insertMany(ve);const Be=[],rt=[];let Ct,vt;ve.forEach(Kt=>{Kt.geometry.type===d._cQ.Point?(Kt.properties.longitude=Kt.geometry.coordinates[0],Kt.properties.latitude=Kt.geometry.coordinates[1],Be.push(Kt),Ct=Kt.meta.id):(rt.push(Kt),vt=Kt.meta.id)}),this.tryAddPointToMap(Be,Ct),this.tryAddLayerToMap(rt,vt),ve.length?(u=!1,this.thematicLength+=1,re.zeroResults=!1,this.cdRef.detectChanges()):re.zeroResults=!0,ve.length>=1e4&&this.messageService.alert("igo.geo.spatialFilter.maxSizeAlert","igo.geo.spatialFilter.warning",{timeOut:1e4})})))}),(0,ri.y)($).pipe((0,Lo.a)(this.unsubscribe$)).subscribe(()=>{this.loading=!1,u&&this.messageService.alert("igo.geo.spatialFilter.zeroResults","igo.geo.spatialFilter.warning",{timeOut:1e4})})}onZoneChange(u,S){this.zone=u,u&&(S?this.tryAddFeaturesToMap([u],!0):this.tryAddFeaturesToMap([u]),this.zoomToFeatureExtent(u))}tryAddFeaturesToMap(u,S){let $=1;for(const re of u){if(this.type===d._cQ.Predefined)for(const ve of this.layers){if(ve.options._internal&&ve.options._internal.code===re.properties.code&&!S){if(!ve.title?.startsWith("Zone")){const Be=this.layers.indexOf(ve);this.layers.splice(Be,1)}return}if(ve.title?.startsWith("Zone")){this.activeLayers=[];const Be=this.layers.indexOf(ve);this.layers.splice(Be,1),this.map.removeLayer(ve)}}else{if(S)for(const ve of this.activeLayers)if(1===this.activeLayers.length&&ve.title?.startsWith("Zone")){const Be=this.layers.indexOf(ve);this.layers.splice(Be,1),this.map.removeLayer(ve)}this.activeLayers=[]}for(const ve of this.layers)ve.title?.startsWith("Zone")&&$++;this.defaultStyle=(ve,Be)=>{const rt=u[0].geometry.coordinates;return new te.cp({image:new X.c({radius:rt?this.buffer/Math.cos(Math.PI/180*rt[1])/Be:void 0,fill:new K.c({color:"rgba(200, 200, 20, 0.2)"}),stroke:new Z.c({width:1,color:"orange"})}),stroke:new Z.c({width:1,color:"orange"}),fill:new K.c({color:"rgba(200, 200, 20, 0.2)"})})},this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe((0,Ht.U)(1)).subscribe(ve=>{const Be=this.layerService.createLayer({isIgoInternalLayer:!0,title:"Zone "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),workspace:{enabled:!0},_internal:{code:this.type===d._cQ.Predefined?re.properties.code:void 0},source:ve,visible:!0}),rt=u.map(vt=>(0,d.K6O)(vt,this.map.projectionCode));if(this.type!==d._cQ.Predefined){const vt=this.type===d._cQ.Point?"Cercle":"Polygone";rt[0].set("nom","Zone",!0),rt[0].set("type",vt,!0)}ve.ol.addFeatures(rt),Be.ol.setStyle(this.defaultStyle),this.map.addLayer(Be),this.layers.push(Be),this.activeLayers.push(Be),this.cdRef.detectChanges()})}}tryAddPointToMap(u,S){let $=1;if(u.length){if(void 0===this.map)return;for(const re of this.layers)re.title?.startsWith(u[0].meta.title)&&$++;this.dataSourceService.createAsyncDataSource({type:"cluster",id:S,queryable:!0,distance:120,meta:{title:"Cluster"}}).pipe((0,Ht.U)(1)).subscribe(re=>{const ve=u[0].meta.icon;let Be;Be=ve&&this.createSvgIcon(ve)||(0,d.o5m)();const rt=this.layerService.createLayer({isIgoInternalLayer:!0,title:u[0].meta.title+" "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:re,visible:!0,style:Be}),Ct=u.map(Kt=>(0,d.K6O)(Kt,this.map.projectionCode));re.ol.getSource().addFeatures(Ct),this.layers.find(Kt=>Kt.id===rt.id)&&(this.map.removeLayer(this.layers.find(Kt=>Kt.id===rt.id)),$-=1,rt.title=u[0].meta.title+" "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),rt.options.title=rt.title),this.iterator=$,this.map.addLayer(rt),this.layers.push(rt),this.pushLayer(rt),this.cdRef.detectChanges()})}}createSvgIcon(u){let S;return this.matIconRegistry.getNamedSvgIcon(u).subscribe($=>{const re=new XMLSerializer;$.setAttribute("width","30"),$.setAttribute("height","30"),$.setAttribute("fill","rgba(0, 128, 255)"),$.setAttribute("stroke","white");const ve=re.serializeToString($);S=new te.cp({image:new ni.c({src:"data:image/svg+xml;utf8,"+ve})})}),S}tryAddLayerToMap(u,S){let $=1;if(u.length){if(void 0===this.map)return;for(const re of this.layers)re.title?.startsWith(u[0].meta.title)&&$++;this.dataSourceService.createAsyncDataSource({type:"vector",id:S,queryable:!0}).pipe((0,Ht.U)(1)).subscribe(re=>{const ve=this.layerService.createLayer({isIgoInternalLayer:!0,title:u[0].meta.title+" "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),source:re,visible:!0}),Be=u.map(Ct=>(0,d.K6O)(Ct,this.map.projectionCode));re.ol.addFeatures(Be),this.layers.find(Ct=>Ct.id===ve.id)&&(this.map.removeLayer(this.layers.find(Ct=>Ct.id===ve.id)),$-=1,ve.title=u[0].meta.title+" "+$+" - "+this.languageService.translate.instant("igo.geo.spatialFilter.spatialFilter"),ve.options.title=ve.title),this.map.addLayer(ve),this.layers.push(ve),this.pushLayer(ve),this.cdRef.detectChanges()})}}zoomToFeatureExtent(u){if(u){const S=this.format.readFeature(u,{dataProjection:u.projection,featureProjection:this.map.projectionCode});(0,d.QX5)(this.map.viewController,[S],d.Suj.Zoom)}}pushLayer(u){for(const S of this.activeLayers)if(S.id===u.id)return;this.activeLayers.push(u)}static \u0275fac=function(S){return new(S||J)(o.GI1(Oe.iK),o.GI1(d.kjd),o.GI1(d.OEM),o.GI1(d.IZ6),o.GI1($t.mi),o.GI1(Et.ov),o.GI1(o.kD9))};static \u0275cmp=o.In1({type:J,selectors:[["app-spatial-filter"]],inputs:{type:"type",itemType:"itemType",freehandDrawIsActive:"freehandDrawIsActive"},standalone:!0,features:[o.UHJ],decls:15,vars:22,consts:[["title","Spatial Filter","subtitle","Geo",3,"dependencies"],["codeFolder","geo/spatial-filter"],["cols","2","rowHeight","500px","gutterSize","16px"],["igoOverlay","","igoQuery","",3,"map","view","queryFeatures"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","flex-col","align-start","h-100","w-100","overflow-y-auto"],[1,"w-100"],[3,"store","selectedQueryType","zone","layers","eventType","eventQueryType","zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange"],[3,"type","queryType","map","zone","loading","store","layers","allLayers","thematicLength","radiusEvent","bufferEvent","measureUnitChange","freehandControl","drawZoneEvent","zoneWithBufferChange","itemTypeChange","thematicChange","toggleSearch","clearButtonEvent","clearSearchEvent"],[4,"ngIf"],[3,"feature"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"igo-zoom-button",5),o.C$Y()()(),o.I0R(7,"mat-grid-tile")(8,"div",6)(9,"igo-panel",7)(10,"igo-spatial-filter-type",8),o.qCj("eventType",function(ve){return $.getOutputType(ve)})("eventQueryType",function(ve){return $.getOutputQueryType(ve)})("zoneChange",function(ve){return $.onZoneChange(ve)})("zoneWithBufferChange",function(ve){return $.onZoneChange(ve,!0)})("bufferChange",function(ve){return $.buffer=ve})("measureUnitChange",function(ve){return $.measureUnit=ve}),o.C$Y(),o.I0R(11,"igo-spatial-filter-item",9),o.qCj("radiusEvent",function(ve){return $.buffer=ve})("bufferEvent",function(ve){return $.buffer=ve})("measureUnitChange",function(ve){return $.measureUnit=ve})("freehandControl",function(ve){return $.freehandDrawIsActive=ve})("drawZoneEvent",function(ve){return $.zone=ve})("zoneWithBufferChange",function(ve){return $.onZoneChange(ve,!0)})("itemTypeChange",function(ve){return $.itemType=ve})("thematicChange",function(ve){return $.thematics=ve})("toggleSearch",function(){return $.getOutputToggleSearch()})("clearButtonEvent",function(){return $.clearMap()})("clearSearchEvent",function(){return $.getOutputClearSearch()}),o.C$Y()(),o.I0R(12,"igo-panel",7),o.yuY(13,Wr,2,1,"ng-container",10),o.wVc(14,"async"),o.C$Y()()()()()()),2&S&&(o.E7m("dependencies",o.q4q(21,aa)),o.yG2(4),o.E7m("map",$.map)("view",$.view)("queryFeatures",!0),o.yG2(2),o.E7m("map",$.map),o.yG2(4),o.E7m("store",$.spatialListStore)("selectedQueryType",$.queryType)("zone",$.zone)("layers",$.activeLayers),o.yG2(),o.E7m("type",$.type)("queryType",$.queryType)("map",$.map)("zone",$.zone)("loading",$.loading)("store",$.store)("layers",$.activeLayers)("allLayers",$.layers)("thematicLength",$.thematicLength),o.yG2(2),o.E7m("ngIf",o.kDX(14,19,$.selectedFeature$)))},dependencies:[L.u,P.I,R.CQ,R.ae,R.cn,d.q2F,d.qcl,d.G_h,Ie.s,C.cP,d.K4n,d.uu$,k.u_,d.wP$,k.a],styles:["[_nghost-%COMP%]   igo-form[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   igo-spatial-filter-item[_ngcontent-%COMP%]     .thematics-header{max-width:225px}"],changeDetection:0})}return J})();const bt=()=>["LanguageService"];let qi=(()=>{class J{dataSourceService;layerService;map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-73,47.2],zoom:7};constructor(u,S){this.dataSourceService=u,this.layerService=S,this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(re=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",baseLayer:!0,visible:!0,source:re}))}),this.dataSourceService.createAsyncDataSource({type:"wms",url:"https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi",params:{LAYERS:"vg_observation_v_inondation_embacle_wmst",VERSION:"1.3.0"},timeFilterable:!0,timeFilter:{min:"2013",max:"2019",range:!1,type:d.U3K.YEAR,style:d.DCK.SLIDER,step:1}}).subscribe(re=>{this.map.addLayer(this.layerService.createLayer({title:"Emb\xe2cles",source:re}))})}static \u0275fac=function(S){return new(S||J)(o.GI1(d.OEM),o.GI1(d.IZ6))};static \u0275cmp=o.In1({type:J,selectors:[["app-time-filter"]],standalone:!0,features:[o.UHJ],decls:11,vars:6,consts:[["title","Time filter","subtitle","Geo",3,"dependencies"],["codeFolder","geo/time-filter"],["cols","2","rowHeight","500px","gutterSize","16px"],[3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],[1,"flex","align-start","h-100","w-100"],["title","Layers",1,"w-100"],[3,"layers"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"mat-grid-list",2)(3,"mat-grid-tile")(4,"igo-map-browser",3)(5,"div",4),o.wR5(6,"igo-zoom-button",5),o.C$Y()()(),o.I0R(7,"mat-grid-tile")(8,"div",6)(9,"igo-panel",7),o.wR5(10,"igo-time-filter-list",8),o.C$Y()()()()()()),2&S&&(o.E7m("dependencies",o.q4q(5,bt)),o.yG2(4),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(4),o.E7m("layers",$.map.layers))},dependencies:[L.u,P.I,R.CQ,R.ae,R.cn,d.q2F,d.qcl,C.cP,d.gho]})}return J})();var _r=r(48512);function To(J,j){if(1&J){const u=o.KQA();o.I0R(0,"igo-entity-table-paginator",8),o.qCj("paginatorChange",function($){o.usT(u);const re=o.GaO(2);return o.CGJ(re.paginatorChange($))}),o.C$Y()}if(2&J){const u=o.GaO().ngIf,S=o.GaO();o.E7m("store",u.entityStore)("paginatorOptions",S.paginatorOptions)("entitySortChange$",S.entitySortChange$)}}function ur(J,j){if(1&J&&(o.SAx(0),o.yuY(1,To,1,3,"igo-entity-table-paginator",7),o.wVc(2,"async"),o.k70()),2&J){const u=j.ngIf;o.yG2(),o.E7m("ngIf",o.kDX(2,1,u.inResolutionRange$))}}function la(J,j){if(1&J&&o.wR5(0,"igo-actionbar",12),2&J){const u=o.GaO().ngIf,S=o.GaO();o.E7m("store",u.actionStore)("horizontal",!0)("withToggleButton",!0)("withTitle",!0)("mode",S.actionbarMode)}}function ca(J,j){if(1&J&&o.wR5(0,"igo-entity-table",13),2&J){const u=o.GaO().ngIf,S=o.GaO();o.E7m("paginator",S.workspacePaginator)("scrollBehavior",S.scrollBehavior)("store",u.entityStore)("template",u.meta.tableTemplate)}}function Cr(J,j){1&J&&(o.I0R(0,"mat-card-content"),o.OEk(1," No data available at this scale. Please zoom in. "),o.C$Y())}function vr(J,j){if(1&J&&(o.SAx(0),o.yuY(1,la,1,5,"igo-actionbar",9)(2,ca,1,4,"igo-entity-table",10),o.wVc(3,"async"),o.yuY(4,Cr,2,0,"mat-card-content",6),o.wVc(5,"async"),o.wR5(6,"igo-workspace-widget-outlet",11),o.k70()),2&J){const u=j.ngIf;o.yG2(),o.E7m("ngIf",u.actionStore),o.yG2(),o.E7m("ngIf",u.entityStore&&u.meta&&u.meta.tableTemplate&&o.kDX(3,4,u.inResolutionRange$)),o.yG2(2),o.E7m("ngIf",!1===o.kDX(5,6,u.inResolutionRange$)),o.yG2(2),o.E7m("workspace",u)}}const $i=[{path:"",redirectTo:"activity",pathMatch:"full"},{title:"Simple map",path:"simple-map",component:cr},{title:"Layer",path:"layer",component:Se},{title:"Legend",path:"legend",component:le},{title:"Overlay",path:"overlay",component:ke},{title:"Geometry",path:"geometry",component:z},{title:"Feature",path:"feature",component:A},{title:"Hover",path:"hover",component:H},{title:"Measure",path:"measure",component:se},{title:"Draw",path:"draw",component:F},{title:"Query",path:"query",component:lt},{title:"Catalog",path:"catalog",component:h},{title:"Search",path:"search",component:_o},{title:"Print",path:"print",component:nt},{title:"Import/Export",path:"import-export",component:ie},{title:"Directions",path:"directions",component:T},{title:"Time Filter",path:"time-filter",component:qi},{title:"OGC Filter",path:"ogc-filter",component:be},{title:"Spatial Filter",path:"spatial-filter",component:Nt},{title:"Workspace",path:"workspace",component:(()=>{class J{dataSourceService;layerService;workspaceState;workspacePaginator;entitySortChange$=new V.g(!1);paginatorOptions={pageSize:5,pageSizeOptions:[1,5,10,15,30,50,100],showFirstLastButtons:!0};map=new d.yGW({controls:{attribution:{collapsed:!0}}});view={center:[-72,47.2],zoom:5};get workspaceStore(){return this.workspaceState.store}selectedWorkspace$;actionbarMode=C.m0.Overlay;scrollBehavior=C.qK.Instant;constructor(u,S,$){this.dataSourceService=u,this.layerService=S,this.workspaceState=$}ngOnInit(){this.selectedWorkspace$=this.workspaceStore.stateView.firstBy$(S=>!0===S.state.selected).pipe((0,ho.k)(S=>{const $=void 0===S?void 0:S.entity;return $&&$.actionStore.view.filter(re=>"wfsDownload"!==re.id),$})),this.dataSourceService.createAsyncDataSource({type:"osm"}).subscribe(S=>{this.map.addLayer(this.layerService.createLayer({title:"OSM",source:S,baseLayer:!0,visible:!0}))}),this.dataSourceService.createAsyncDataSource({type:"wfs",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",params:{featureTypes:"etablissement_mtq",fieldNameGeometry:"geometry",version:"2.0.0",outputFormat:"geojson"},sourceFields:[{name:"idetablis",alias:"ID"},{name:"nometablis",alias:"Name"},{name:"typetablis",alias:"Type"}]}).subscribe(S=>{this.map.addLayer(this.layerService.createLayer({title:"Simple WFS ",maxResolution:3e3,visible:!0,source:S}))})}paginatorChange(u){this.workspacePaginator=u}static \u0275fac=function(S){return new(S||J)(o.GI1(d.OEM),o.GI1(d.IZ6),o.GI1(go))};static \u0275cmp=o.In1({type:J,selectors:[["app-workspace"]],standalone:!0,features:[o.UHJ],decls:10,vars:11,consts:[["title","Workspace","subtitle","Geo"],["codeFolder","geo/workspace"],[1,"m-b-16",3,"map","view"],[1,"map-actions","--vertical","--bottom","--right"],["color","primary",3,"map"],["igoWorkspaceSelector","",3,"store","map"],[4,"ngIf"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange",4,"ngIf"],[3,"store","paginatorOptions","entitySortChange$","paginatorChange"],[3,"store","horizontal","withToggleButton","withTitle","mode",4,"ngIf"],["class","table-compact table-centered",3,"paginator","scrollBehavior","store","template",4,"ngIf"],[3,"workspace"],[3,"store","horizontal","withToggleButton","withTitle","mode"],[1,"table-compact","table-centered",3,"paginator","scrollBehavior","store","template"]],template:function(S,$){1&S&&(o.I0R(0,"app-doc-viewer",0)(1,"app-example-viewer",1)(2,"igo-map-browser",2)(3,"div",3),o.wR5(4,"igo-zoom-button",4),o.C$Y()(),o.wR5(5,"igo-workspace-selector",5),o.yuY(6,ur,3,3,"ng-container",6),o.wVc(7,"async"),o.yuY(8,vr,7,8,"ng-container",6),o.wVc(9,"async"),o.C$Y()()),2&S&&(o.yG2(2),o.E7m("map",$.map)("view",$.view),o.yG2(2),o.E7m("map",$.map),o.yG2(),o.E7m("store",$.workspaceStore)("map",$.map),o.yG2(),o.E7m("ngIf",o.kDX(7,7,$.selectedWorkspace$)),o.yG2(2),o.E7m("ngIf",o.kDX(9,9,$.selectedWorkspace$)))},dependencies:[k.a,L.u,P.I,C.Eh,C.AI,C.I7,d.ach,d.q2F,d.qcl,C.uF,d.WQ3,C.Qv,_r.NR,_r.WK,k.u_],styles:["igo-map-browser[_ngcontent-%COMP%]{width:100%;height:300px}igo-panel[_ngcontent-%COMP%]{width:100%;padding-top:10px}igo-entity-table[_ngcontent-%COMP%]{height:400px}igo-actionbar[_ngcontent-%COMP%]{height:48px}"]})}return J})()}]},12445:(Fe,ce,r)=>{"use strict";r.d(ce,{O:()=>e});const e={production:!0,igo:{projections:[{code:"EPSG:32198",alias:"Quebec Lambert",def:"+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs",extent:[-886251.0296,180252.9126,897177.3418,2106143.8139]}],auth:{tokenKey:"testIgo2Lib",intern:{enabled:!0},allowAnonymous:!0},interactiveTour:{tourInMobile:!0,activateInteractiveTour:!0},importExport:{url:"https://geoegl.msp.gouv.qc.ca/apis/ogre"},language:{prefix:"./locale/"},catalog:{sources:[{id:"Gououvert",title:"Gouvouvert",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi"},{id:"DefiningInfoFormat",title:"Defining info_format",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",queryFormat:{html:"*",json:["stations_meteoroutieres","histo_stations_meteoroutieres"]},queryHtmlTarget:"iframe",count:30},{id:"catalogwithregex",title:"Filtered catalog by regex",url:"https://ws.mapserver.transports.gouv.qc.ca/swtq",regFilters:["zpegt"]},{id:"catalogwithtooltipcontrol",title:"Controling tooltip format",url:"https://geoegl.msp.gouv.qc.ca/apis/wss/complet.fcgi",tooltipType:r(58776).wL1.ABSTRACT}]},monitoring:{provider:"sentry",dsn:"https://examplePublicKey@o0.ingest.sentry.io/0",identifyUser:!0},searchSources:{storedqueriesreverse:{enabled:!1},nominatim:{enabled:!1},icherche:{searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",order:2,enabled:!0,params:{limit:"8"},showAdvancedSettings:!0},coordinatesreverse:{showInPointerSummary:!0},icherchereverse:{showInPointerSummary:!0,searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",order:3,enabled:!0},ilayer:{searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",order:4,enabled:!0,params:{limit:"5"}}}}}},74092:(Fe,ce,r)=>{"use strict";var C=r(33712),e=r(34896),d=r(34672),L=r(50244),P=r(32328),o=r(63916),f=r(18200),h=r(4872),R=r(27e3),y=r(50168),O=r(4786),x=r(57880),T=r(58752),a=r(53e3),F=r(65056),A=r(23302),k=r(9204),W=r(24708),w=r(93020),te=r(39732),Z=r(51672),K=r(20968);let X=(()=>{class Ie{messageService;constructor(Ve){this.messageService=Ve}intercept(Ve,ot){const lt=Ve.headers.get("interceptError"),Me=Ve.clone({headers:Ve.headers.delete("interceptError")});if("false"===lt)return ot.handle(Me);const ct={httpError:void 0};return ot.handle(Me).pipe((0,Z.a)(Oe=>this.handleError(Oe,ct)),(0,K.U)(()=>{const Oe=ct.httpError;Oe&&(Oe.error.toDisplay?this.handleCaughtError(Oe):Oe.error.caught||this.handleUncaughtError(Oe))}))}handleError(Ve,ot){if(Ve instanceof C.gj){const lt="object"===Ve.error?Ve.error:{};lt.message=Ve.error?.message||Ve.statusText,lt.caught=!1,Ve=new C.gj({error:lt,headers:Ve.headers,status:Ve.status,statusText:Ve.statusText,url:Ve.url})}return ot.httpError=Ve,(0,te.c)(Ve)}handleCaughtError(Ve){Ve.error.caught=!0,this.messageService.error(Ve.error.message,Ve.error.title,{progressBar:!1})}handleUncaughtError(Ve){Ve.error.caught=!0,this.messageService.error("igo.core.errors.uncaught.message","igo.core.errors.uncaught.title",{progressBar:!1})}static \u0275fac=function(ot){return new(ot||Ie)(e.CoB(w.mi))};static \u0275prov=e.wxM({token:Ie,factory:Ie.\u0275fac,providedIn:"root"})}return Ie})(),V=(()=>{class Ie{static forRoot(){return{ngModule:Ie,providers:[{provide:C.So,useClass:X,multi:!0}]}}constructor(Ve){if(Ve)throw new Error("IgoErrorModule is already loaded. Import it in the AppModule only")}static \u0275fac=function(ot){return new(ot||Ie)(e.CoB(Ie,12))};static \u0275mod=e.a4G({type:Ie});static \u0275inj=e.s3X({})}return Ie})();var B=r(96832);r(12044);const c={name:"igo2DB",version:2,objectStoresMeta:[{store:"geoData",storeConfig:{keyPath:"url",autoIncrement:!1},storeSchema:[{name:"regionID",keypath:"regionID",options:{unique:!1}}]},{store:"layerData",storeConfig:{keyPath:"layerId",autoIncrement:!1},storeSchema:[{name:"layerOptions",keypath:"layerOptions",options:{unique:!1}},{name:"sourceOptions",keypath:"sourceOptions",options:{unique:!1}}]}]};let I=(()=>{class Ie{static forRoot(Ve={}){return{ngModule:Ie,providers:[(0,k.sh)(Ve),(0,W.MV)()]}}constructor(){}static \u0275fac=function(ot){return new(ot||Ie)};static \u0275mod=e.a4G({type:Ie});static \u0275inj=e.s3X({imports:[F.MD,C.SU,A.YP.forRoot(),V.forRoot(),w.UD,B.Qr.forRoot(c),A.YP,V,W._s,w.UD]})}return Ie})();var b=r(58776),G=r(6016),D=r(43168),g=r(83680),U=r(2924),M=r(70116),H=r(17312),s=r(87124),ie=r(61536),de=r(10128),fe=r(32688),Se=r(880);const le=[{title:"Home",path:"home",component:(()=>{class Ie{interactiveTourService;constructor(Ve){this.interactiveTourService=Ve}startTour(){this.interactiveTourService.startTour("global")}static \u0275fac=function(ot){return new(ot||Ie)(e.GI1(a.In))};static \u0275cmp=e.In1({type:Ie,selectors:[["app-home"]],standalone:!0,features:[e.UHJ],decls:58,vars:0,consts:[[2,"text-align","center"],["id","igo-title"],["width","180","src","assets/igo2/core/logo.png",1,"igo-logo"],["tourToStart","global","menuIsOpen","true","styleButton","raised"],[1,"mat-body-1"],["target","_blank","rel","noopener","href","https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation"],["target","_blank","rel","noopener","href","https://angular.io/docs"]],template:function(ot,lt){1&ot&&(e.I0R(0,"app-doc-viewer")(1,"div",0)(2,"h1",1),e.OEk(3,"Welcome to IGO"),e.C$Y(),e.wR5(4,"img",2),e.C$Y(),e.I0R(5,"p"),e.wR5(6,"igo-interactive-tour",3),e.C$Y(),e.I0R(7,"p",4),e.OEk(8," IGO2 library contains many components and services that may benefit any web application. "),e.wR5(9,"br"),e.OEk(10," IGO2 library is open source project using Angular, Angular Material and OpenLayers. "),e.C$Y(),e.I0R(11,"h3"),e.OEk(12,"IGO2 library is divided into several elements:"),e.C$Y(),e.I0R(13,"ul",4)(14,"li")(15,"b"),e.OEk(16,"@igo2/utils"),e.C$Y(),e.OEk(17," : Basic utilies without dependency (ex: base64, clipboard, uuid) "),e.C$Y(),e.I0R(18,"li")(19,"b"),e.OEk(20,"@igo2/core"),e.C$Y(),e.OEk(21," : Element affecting the core of the application (ex: config, language, message, media, request) "),e.C$Y(),e.I0R(22,"li")(23,"b"),e.OEk(24,"@igo2/common"),e.C$Y(),e.OEk(25," : Library containing reusable components (ex: clickout, drag-drop, list, panel, spinner, table) "),e.C$Y(),e.I0R(26,"li")(27,"b"),e.OEk(28,"@igo2/auth"),e.C$Y(),e.OEk(29," : Library grouping the authentication and security module "),e.C$Y(),e.I0R(30,"li")(31,"b"),e.OEk(32,"@igo2/geo"),e.C$Y(),e.OEk(33," : Library containing the geomatic components. Depends on Openlayers. "),e.C$Y(),e.I0R(34,"li")(35,"b"),e.OEk(36,"@igo2/context"),e.C$Y(),e.OEk(37," : Library of components uniting @igo2/geo and @igo2/auth "),e.C$Y(),e.I0R(38,"li")(39,"b"),e.OEk(40,"@igo2/integration"),e.C$Y(),e.OEk(41," : Library integrate basic components"),e.C$Y()(),e.I0R(42,"h2"),e.OEk(43,"Here are some links to help you start:"),e.C$Y(),e.I0R(44,"ul")(45,"li")(46,"h2")(47,"a",5),e.OEk(48,"Installation"),e.C$Y()()(),e.I0R(49,"li")(50,"h2")(51,"a",6),e.OEk(52,"Angular Documentation"),e.C$Y()()()(),e.I0R(53,"span",4),e.OEk(54,"*** Modules in "),e.I0R(55,"code"),e.OEk(56,"@igo2/core"),e.C$Y(),e.OEk(57," must be imported only once"),e.C$Y()())},dependencies:[fe.u,a.bQ,Se.E]})}return Ie})()},{title:"Auth",path:"auth",loadChildren:()=>Promise.resolve().then(r.bind(r,70116)).then(Ie=>Ie.routes)},{title:"Common",path:"common",loadChildren:()=>Promise.resolve().then(r.bind(r,17312)).then(Ie=>Ie.routes)},{title:"Context",path:"context",loadChildren:()=>Promise.resolve().then(r.bind(r,87124)).then(Ie=>Ie.routes)},{title:"Core",path:"core",loadChildren:()=>Promise.resolve().then(r.bind(r,61536)).then(Ie=>Ie.routes)},{title:"Geo",path:"geo",loadChildren:()=>Promise.resolve().then(r.bind(r,10128)).then(Ie=>Ie.routes)},{path:"**",redirectTo:"/home"}],oe=[{title:"Home",path:"home",redirectTo:"/home",pathMatch:"full"},{title:"Core",path:"core",children:se(ie.routes)},{title:"Auth",path:"auth",children:se(M.routes)},{title:"Common",path:"common",children:se(H.routes)},{title:"Geo",path:"geo",children:se(de.routes)},{title:"Context",path:"context",children:se(s.routes)}];function se(Ie){return Ie.filter(je=>je.title).sort((je,Ve)=>je.title.localeCompare(Ve.title))}var me=r(73192),be=r(75180);const ke=()=>({exact:!0});function qe(Ie,je){if(1&Ie&&(e.SAx(0),e.I0R(1,"mat-nav-list")(2,"a",11),e.OEk(3),e.C$Y()(),e.wR5(4,"mat-divider"),e.k70()),2&Ie){const Ve=e.GaO().$implicit;e.yG2(2),e.E7m("routerLink",Ve.path)("routerLinkActiveOptions",e.q4q(3,ke)),e.yG2(),e.cNF(Ve.title)}}function nt(Ie,je){if(1&Ie&&(e.I0R(0,"a",14),e.OEk(1),e.C$Y()),2&Ie){const Ve=je.$implicit,ot=e.GaO(2).$implicit;e.E7m("routerLink",ot.path+"/"+Ve.path),e.yG2(),e.cNF(Ve.title)}}function Ue(Ie,je){if(1&Ie&&(e.I0R(0,"mat-expansion-panel",12)(1,"mat-expansion-panel-header")(2,"mat-panel-title"),e.OEk(3),e.C$Y()(),e.I0R(4,"mat-nav-list"),e.yuY(5,nt,2,2,"a",13),e.C$Y()(),e.wR5(6,"mat-divider")),2&Ie){const Ve=e.GaO().$implicit;e.yG2(3),e.oRS(" ",Ve.title," "),e.yG2(2),e.E7m("ngForOf",Ve.children)}}function St(Ie,je){if(1&Ie&&(e.SAx(0),e.yuY(1,qe,5,4,"ng-container",9)(2,Ue,7,2,"ng-template",null,10,e.gJz),e.k70()),2&Ie){const Ve=je.$implicit,ot=e.Gew(3);e.yG2(),e.E7m("ngIf",!Ve.children)("ngIfElse",ot)}}let Ae=(()=>{class Ie{document;changeDetectorRef;media;router;mobileQuery;routesConfig=oe;title="IGO";version=k.WU;_mobileQueryListener;constructor(Ve,ot,lt,Me){this.document=Ve,this.changeDetectorRef=ot,this.media=lt,this.router=Me,this.mobileQuery=this.media.matchMedia("(max-width: 600px)"),this._mobileQueryListener=()=>this.changeDetectorRef.detectChanges(),this.mobileQuery.addEventListener("change",this._mobileQueryListener),this.detectOldBrowser()}ngOnInit(){this.handleSplashScreen()}handleSplashScreen(){this.router.events.pipe((0,g.K)(Ve=>Ve instanceof x.MT),(0,U.o)(300)).subscribe(()=>{this._removeSplashScreen()})}_removeSplashScreen(){const Ve=this.document.getElementById("splash-screen");if(!Ve)return;Ve.classList.add("is-destroying");const lt=this.document.getElementById("splash-screen-stylesheet");setTimeout(()=>{D.U3.remove(Ve),D.U3.remove(lt)},300)}ngOnDestroy(){this.mobileQuery.removeEventListener("change",this._mobileQueryListener)}detectOldBrowser(){D.sX.satisfies({ie:"<=11",chrome:"<64",firefox:"<60"})&&console.log("Very old browser ! ",D.sX.getBrowser())}static \u0275fac=function(ot){return new(ot||Ie)(e.GI1(F.Ud),e.GI1(e.kD9),e.GI1(me.iG),e.GI1(x.E5))};static \u0275cmp=e.In1({type:Ie,selectors:[["app-root"]],standalone:!0,features:[e.UHJ],decls:16,vars:9,consts:[[1,"example-container"],["color","primary",1,"example-toolbar","mat-elevation-z6"],["mat-icon-button","",3,"click"],[1,"mat-subtitle-1","m-b-0"],[1,"example-sidenav-container"],["opened","true","fixedTopGap","48",3,"mode","fixedInViewport"],["snav",""],["displayMode","flat","multi",""],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["routeWithChildren",""],["mat-list-item","","routerLinkActive","active-link",1,"p-h-24","m-t-8",3,"routerLink","routerLinkActiveOptions"],["expanded",""],["mat-list-item","","routerLinkActive","active-link",3,"routerLink",4,"ngFor","ngForOf"],["mat-list-item","","routerLinkActive","active-link",3,"routerLink"]],template:function(ot,lt){if(1&ot){const Me=e.KQA();e.I0R(0,"div",0)(1,"mat-toolbar",1)(2,"button",2),e.qCj("click",function(){e.usT(Me);const Oe=e.Gew(11);return e.CGJ(Oe.toggle())}),e.I0R(3,"mat-icon"),e.OEk(4,"menu"),e.C$Y()(),e.I0R(5,"h1"),e.OEk(6),e.C$Y(),e.I0R(7,"h5",3),e.OEk(8),e.C$Y()(),e.I0R(9,"mat-sidenav-container",4)(10,"mat-sidenav",5,6)(12,"mat-accordion",7),e.yuY(13,St,4,2,"ng-container",8),e.C$Y()(),e.I0R(14,"mat-sidenav-content"),e.wR5(15,"router-outlet"),e.C$Y()()()}2&ot&&(e.eAK("example-is-mobile",lt.mobileQuery.matches),e.yG2(6),e.cNF(lt.title),e.yG2(2),e.cNF(lt.version.lib),e.yG2(),e.m4B("margin-top",lt.mobileQuery.matches?48:0,"px"),e.yG2(),e.E7m("mode",lt.mobileQuery.matches?"over":"side")("fixedInViewport",lt.mobileQuery.matches),e.yG2(3),e.E7m("ngForOf",lt.routesConfig))},dependencies:[F.Iw,F.u_,G.CU,G._2,G._s,G.nm,G.CM,h.Gm,h.EZ,d.oJ,d.um,P.oB,P.qL,f.sb,f.Ar,f.WS,f.Uq,o.iI,o.G2,o.g9,be.k,x.ER,x.LC,x.cP],styles:[".example-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:absolute;inset:0}.example-toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;z-index:2}.example-toolbar[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0}mat-panel-title[_ngcontent-%COMP%]{font-size:14px}mat-nav-list[_ngcontent-%COMP%]{padding:0}mat-expansion-panel[_ngcontent-%COMP%]{box-shadow:unset!important}mat-expansion-panel[_ngcontent-%COMP%]     .mat-expansion-panel-body{padding:0 8px 16px}.active-link[_ngcontent-%COMP%]     span{font-weight:700}.example-is-mobile[_ngcontent-%COMP%]   .example-toolbar[_ngcontent-%COMP%]{position:fixed;z-index:2}.example-sidenav-container[_ngcontent-%COMP%]{flex:1}.example-is-mobile[_ngcontent-%COMP%]   .example-sidenav-container[_ngcontent-%COMP%]{flex:1 0 auto}.example-is-mobile[_ngcontent-%COMP%]   mat-sidenav[_ngcontent-%COMP%]{background-color:#fff}mat-sidenav-content[_ngcontent-%COMP%]{box-sizing:border-box}"]})}return Ie})();var Qe=r(12445);Qe.O.production&&(0,e.agy)(),(0,y._g)(Ae,{providers:[(0,e.ai8)(I,y.iE,y.rQ,d.oJ,P.oB,o.iI,f.sb,h.Gm,b.ach,b.aw9),(0,C.UP)((0,C.i8)()),(0,x.kn)(le,(0,x.wj)(x.eu)),(0,O.OE)(),(0,k.sh)({default:Qe.O.igo}),(0,W.MV)(),(0,T.qi)(),(0,b.QPw)(),(0,b.A7Y)(),(0,b.oN0)(),(0,a.I9)(),{provide:L.uY,useValue:{appearance:"outline"}},{provide:R.gY,useValue:{showDelay:500,hideDelay:0,touchendHideDelay:0,disableTooltipInteractivity:!0}}]}).catch(Ie=>console.log(Ie))},92348:(Fe,ce,r)=>{var C={"./af":22408,"./af.js":22408,"./ar":83632,"./ar-dz":20944,"./ar-dz.js":20944,"./ar-kw":59628,"./ar-kw.js":59628,"./ar-ly":60764,"./ar-ly.js":60764,"./ar-ma":8087,"./ar-ma.js":8087,"./ar-ps":84152,"./ar-ps.js":84152,"./ar-sa":36932,"./ar-sa.js":36932,"./ar-tn":97064,"./ar-tn.js":97064,"./ar.js":83632,"./az":78216,"./az.js":78216,"./be":90432,"./be.js":90432,"./bg":54440,"./bg.js":54440,"./bm":45340,"./bm.js":45340,"./bn":91936,"./bn-bd":43392,"./bn-bd.js":43392,"./bn.js":91936,"./bo":11440,"./bo.js":11440,"./br":51592,"./br.js":51592,"./bs":15056,"./bs.js":15056,"./ca":25992,"./ca.js":25992,"./cs":15944,"./cs.js":15944,"./cv":60928,"./cv.js":60928,"./cy":86160,"./cy.js":86160,"./da":22112,"./da.js":22112,"./de":6456,"./de-at":44712,"./de-at.js":44712,"./de-ch":29100,"./de-ch.js":29100,"./de.js":6456,"./dv":28776,"./dv.js":28776,"./el":91928,"./el.js":91928,"./en-au":67528,"./en-au.js":67528,"./en-ca":20736,"./en-ca.js":20736,"./en-gb":13976,"./en-gb.js":13976,"./en-ie":41600,"./en-ie.js":41600,"./en-il":53344,"./en-il.js":53344,"./en-in":24072,"./en-in.js":24072,"./en-nz":46264,"./en-nz.js":46264,"./en-sg":7816,"./en-sg.js":7816,"./eo":51920,"./eo.js":51920,"./es":82808,"./es-do":2772,"./es-do.js":2772,"./es-mx":83368,"./es-mx.js":83368,"./es-us":48288,"./es-us.js":48288,"./es.js":82808,"./et":33892,"./et.js":33892,"./eu":35736,"./eu.js":35736,"./fa":68544,"./fa.js":68544,"./fi":83640,"./fi.js":83640,"./fil":24616,"./fil.js":24616,"./fo":27128,"./fo.js":27128,"./fr":50552,"./fr-ca":59120,"./fr-ca.js":59120,"./fr-ch":17980,"./fr-ch.js":17980,"./fr.js":50552,"./fy":7912,"./fy.js":7912,"./ga":34464,"./ga.js":34464,"./gd":98864,"./gd.js":98864,"./gl":32056,"./gl.js":32056,"./gom-deva":75804,"./gom-deva.js":75804,"./gom-latn":98648,"./gom-latn.js":98648,"./gu":76036,"./gu.js":76036,"./he":14e3,"./he.js":14e3,"./hi":48800,"./hi.js":48800,"./hr":55176,"./hr.js":55176,"./hu":192,"./hu.js":192,"./hy-am":94840,"./hy-am.js":94840,"./id":78240,"./id.js":78240,"./is":23608,"./is.js":23608,"./it":56816,"./it-ch":25136,"./it-ch.js":25136,"./it.js":56816,"./ja":17272,"./ja.js":17272,"./jv":83248,"./jv.js":83248,"./ka":4768,"./ka.js":4768,"./kk":93624,"./kk.js":93624,"./km":48168,"./km.js":48168,"./kn":69372,"./kn.js":69372,"./ko":37088,"./ko.js":37088,"./ku":63357,"./ku-kmr":54068,"./ku-kmr.js":54068,"./ku.js":63357,"./ky":3672,"./ky.js":3672,"./lb":43592,"./lb.js":43592,"./lo":16096,"./lo.js":16096,"./lt":92672,"./lt.js":92672,"./lv":69056,"./lv.js":69056,"./me":63280,"./me.js":63280,"./mi":95037,"./mi.js":95037,"./mk":48600,"./mk.js":48600,"./ml":93795,"./ml.js":93795,"./mn":19288,"./mn.js":19288,"./mr":63656,"./mr.js":63656,"./ms":71744,"./ms-my":92804,"./ms-my.js":92804,"./ms.js":71744,"./mt":28536,"./mt.js":28536,"./my":21764,"./my.js":21764,"./nb":64752,"./nb.js":64752,"./ne":82948,"./ne.js":82948,"./nl":49572,"./nl-be":5900,"./nl-be.js":5900,"./nl.js":49572,"./nn":14904,"./nn.js":14904,"./oc-lnc":57328,"./oc-lnc.js":57328,"./pa-in":81496,"./pa-in.js":81496,"./pl":25928,"./pl.js":25928,"./pt":85764,"./pt-br":91248,"./pt-br.js":91248,"./pt.js":85764,"./ro":37168,"./ro.js":37168,"./ru":97904,"./ru.js":97904,"./sd":68448,"./sd.js":68448,"./se":29244,"./se.js":29244,"./si":65696,"./si.js":65696,"./sk":77120,"./sk.js":77120,"./sl":83544,"./sl.js":83544,"./sq":71544,"./sq.js":71544,"./sr":53696,"./sr-cyrl":33444,"./sr-cyrl.js":33444,"./sr.js":53696,"./ss":32504,"./ss.js":32504,"./sv":39011,"./sv.js":39011,"./sw":74144,"./sw.js":74144,"./ta":81280,"./ta.js":81280,"./te":90504,"./te.js":90504,"./tet":36472,"./tet.js":36472,"./tg":77024,"./tg.js":77024,"./th":69872,"./th.js":69872,"./tk":63364,"./tk.js":63364,"./tl-ph":25164,"./tl-ph.js":25164,"./tlh":60048,"./tlh.js":60048,"./tr":86976,"./tr.js":86976,"./tzl":4224,"./tzl.js":4224,"./tzm":64316,"./tzm-latn":72264,"./tzm-latn.js":72264,"./tzm.js":64316,"./ug-cn":18984,"./ug-cn.js":18984,"./uk":25152,"./uk.js":25152,"./ur":57068,"./ur.js":57068,"./uz":47880,"./uz-latn":7400,"./uz-latn.js":7400,"./uz.js":47880,"./vi":35368,"./vi.js":35368,"./x-pseudo":71252,"./x-pseudo.js":71252,"./yo":98595,"./yo.js":98595,"./zh-cn":23036,"./zh-cn.js":23036,"./zh-hk":59944,"./zh-hk.js":59944,"./zh-mo":94952,"./zh-mo.js":94952,"./zh-tw":8240,"./zh-tw.js":8240};function e(L){var P=d(L);return r(P)}function d(L){if(!r.o(C,L)){var P=new Error("Cannot find module '"+L+"'");throw P.code="MODULE_NOT_FOUND",P}return C[L]}e.keys=function(){return Object.keys(C)},e.resolve=d,Fe.exports=e,e.id=92348}},Fe=>{Fe.O(0,[968],()=>Fe(Fe.s=74092)),Fe.O()}]);
//# sourceMappingURL=main.6db5a691205549a5.js.map