{"version":3,"mappings":"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ACnDA,iBAA6CA,2BAAcA,QAC3DA,iBAAwCA,sBAASA,QAEjDA,eAEAA,iBAAsCA,oBAAOA,QAE/CA,QACFA,QAEAA,gCACEA,0BACFA,QAEFA,QACFA,cAtE+BA,iDAGvBA,wBACAA,8BAGmDA,6DACtBA,2DAA8C,mwBDQtEqB,EAAb,GE+FaiiJ,GAAb,eAAMjiJ,EACJ0H,WAAY5I,EAAkCC,aAC5CD,EAAgBojJ,cACdnjJ,EAAak3F,+BACX,mFAJKj2F,GAASrB,kDAATqB,EAASmiJ,WAFRZ,kCAtDH,CACPhjJ,KACA6jJ,KACAC,KACAC,KACA73H,KACA/rB,KACAksB,KAEAob,GACAG,GACAkC,GACAI,GACAE,GACAE,GACAI,GAEAG,GACAK,GACAI,GACAG,GACAY,GACAM,GACAM,GACAI,GAEA0M,GAEA61F,GACAE,GACAE,GACAE,GACAK,GACAE,GACAI,GACAE,GACAE,GACAI,GACAK,GACAkO,GACAU,GACAE,GACAM,GACAG,GACAE,GACAgB,GACAK,GAEAE,GAEAI,GAEA9iJ,SAISyB,EAAb,YCvGIomC,kBACFznC,SAGFJ,OACGgkJ,gBAAgBN,IADnB1jJ,MAESyB,mBAAO6K,QAAQC,IAAI9K,4BCd5B,OACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,YACA,eACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,sBACA,mBACA,sBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,eACA,kBACA,gBACA,aACA,gBACA,WACA,cACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,YACA,eACA,YACA,eACA,YACA,eACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,iBACA,oBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,cACA,iBACA,aACA,gBACA,cACA,iBACA,cACA,mBACA,sBACA,iBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,mBACA,sBACA,aACA,gBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,oBAIA,cACA,WACA,YAEA,cACA,cACA,8CACA,gCACAtB,EAEA,YAEAC,kBACA,uBAEAA,YACAF,YACAE","names":["Le","Vt","oe","S","e","lp","getByte","t","o","charCodeAt","this","ALPHA","indexOf","charAt","n","s","a","length","l","String","PADCHAR","getByte64","push","fromCharCode","join","i","ti","sp","window","navigator","userAgent","copy","r","St","createTextArea","selectText","copyTextToClipboard","destroyTextArea","document","createElement","value","body","appendChild","removeChild","getOSName","contentEditable","readOnly","createRange","getSelection","contenteditable","readonly","selectNodeContents","removeAllRanges","addRange","setSelectionRange","select","compareVersion","execCommand","Do","diff","arguments","toString","getChanges","slice","mtc","ins","sbs","del","fis","_ref2","c","split","u","p","fil","d","g","getMatchingSubstring","rotateArray","_ref4","Array","oi","ADDED","findChanges","added","deleted","modified","_step","_iterator","findIndex","h","id","change","type","DELETED","splice","JSON","parse","stringify","Gr","compareObject","MODIFIED","keysChanged","oldValue","newValue","_loop","map","Set","Object","keys","_toConsumableArray","forEach","isArray","concat","key","resolve","replace","shift","Date","assign","k","isObject","filter","mergeDeep","hasOwnProperty","copyDeep","toUpperCase","count","toLowerCase","reduce","y","_loop2","removeUndefined","removeNull","localeCompare","getOwnPropertyNames","_step2","ii","roundToNDecimal","Math","pow","round","create","random","substring","bo","ae","constructor","Me","_status","status$","next","subscribe","watch","status$$","pipe","Oo","handleStatusChange","call","unsubscribe","unwatch","status","Waiting","Ri","register","Fe","ids","counter$","unregister","factory","ɵfac","up","intercept","headers","get","clone","handle","activityService","ja","Hr","forRoot","ngModule","providers","provide","$","useClass","multi","Ga","lib","releaseDate","B","getConfig","config","load","path","injector","Promise","ce","console","log","Qr","error","version","Ya","useValue","qn","zr","useFactory","pp","deps","getTranslation","v","V","prefix","http","suffix","Ve","Z","gp","M","Ha","translateService","langs","Error","substr","X","mp","missingTranslationHandler","hp","Bi","defaultOptions","_options","timeOut","hasCloseIcon","showProgressBar","pauseOnHover","clickToClose","maxLength","maxStack","preventDuplicates","selectors","Co","m","Yr","L","translate","getBrowserLang","getLanguage","setDefaultLang","language","match","setLanguage","use","reloadLang","ko","ERROR","pe","options","configService","showError","caught","message","title","messages$","from","to","handleTemplate","text","notificationService","html","icon","theClass","addIcon","success","SUCCESS","info","INFO","alert","ALERT","remove","removeAllAreNotError","_step3","template","_p","httpError","handleError","handleCaughtError","handleUncaughtError","statusText","url","toDisplay","messageService","instant","Vr","za","ni","centerKey","zoomKey","projectionKey","contextKey","searchKey","visibleOnLayersKey","visibleOffLayersKey","directionsCoordKey","directionsOptionsKey","toolKey","wmsUrlKey","wmsLayersKey","wmtsUrlKey","wmtsLayersKey","arcgisUrlKey","arcgisLayersKey","iarcgisUrlKey","iarcgisLayersKey","tarcgisUrlKey","tarcgisLayersKey","vectorKey","decodeURIComponent","location","search","includes","_s$map2","router","navigate","queryParams","route","Ft","Mobile","Xt","Portrait","at","observe","xo","matches","media$","orientation$","Landscape","Tablet","Desktop","getMedia","getOrientation","isTouchScreen","documentElement","isMobile","isDesktop","ye","SESSION","lo","ne","sessionStorage","getItem","LOCAL","localStorage","set","setItem","storageChange$","scope","event","previousValue","currentValue","removeItem","REMOVED","clear","CLEARED","Rn","connection","onLine","checkNetworkState","onlineSubscription","ao","state","emitEvent","offlineSubscription","stateChangeEventEmitter","emit","ngOnDestroy","currentState","_e","rp","_t","Default","si","Auto","Ui","None","Wr","safeObject","meta","Eo","idProperty","titleProperty","iconProperty","wp","Map","Ji","store","getKey","Ni","index","size","setMany","setAll","update","updateMany","updateManyExclusive","reverse","reverseMany","reverseChanges","updateAll","getAllKeys","some","entries","_o2","change$","getKey$","count$","empty$","_index","all","values$","all$","firstBy","find","firstBy$","manyBy","manyBy$","sort","destroy","values$$","createIndex","lifted","joins","filter$","addFilter","filterIndex","filters$","values","removeFilter","sort$","lift","liftJoinedSource","liftSource","ri","_o3","processValues","setValues","source$","source","_t2","computeJoinedValue","filterValues","sortValues","every","valueAccessor","direction","nullsFirst","generateIndex","getProperty","createStateManager","view","createDataView","stateView","createStateView","_pristine","entities$","softClear","updateCount","insert","insertMany","delete","deleteMany","addStrategy","strategies","bindStore","activate","removeStrategy","unbindStore","getStrategyOfType","activateStrategyOfType","deactivateStrategyOfType","deactivate","Xa","entity","statesAreTheSame","revision","ref","setChangeDetector","setStore","teardownObservers","innerStateIndex","setupObservers","detectChanges","cdRef","entities$$","onEntitiesChange","state$$","onStateChange","_i2","qo","active$","active","doDeactivate","doActivate","stores","super","filterStore","unfilterStore","filterAll","unfilterAll","filters","filterClauseFunc","has","selected","Ka","Ot","ngOnInit","watcher","ji","selected$$","onSelectFromStore","onSelectionChange","multiSelectValue","emptyValue","selectedChange","selected$","updateMultiToggleWithEntities","multiText$","multiNoneText","multiAllText","Qi","onClick","stopPropagation","Fp","scroll","_selected","selection","toggleSelected","selectOnClick","addCls","selectedCls","highlightSelection","highlightedCls","removeCls","bp","el","nativeElement","scrollMode","behavior","block","inline","renderer","addClass","removeClass","paginationLabelTranslation$$","languageService","max","min","ngOnChanges","unsubscribeAll","count$$","emitPaginator","entitySortChange$$","entitySortChange$","paginator","firstPage","initPaginatorOptions","translateLabels","disabled","paginatorOptions","pageIndex","pageSize","pageSizeOptions","mediaService","showFirstLastButtons","hidePageSize","_intl","firstPageLabel","getRangeLabel","rangeLabel","itemsPerPageLabel","lastPageLabel","nextPageLabel","previousPageLabel","paginatorChange","Bn","Un","transform","activityInterceptor","responseType","vp","tt","FileReader","readAsDataURL","onloadend","result","complete","pure","G","Zt","maxCacheCount","os","_sanitizer","bypassSecurityTrustHtml","Gi","ue","_paginator","dataSource","columns","visible","name","selectionCheckbox","selectMany","fixedHeader","handleDatasource","unsubscribeStore","selection$$","floor","selectionState$","computeSelectionState","dataSource$$","data","getTrackByFunction","refresh","onSort","getValue","sortNullsFirst","entitySortChange","column","onRowClick","lastRecordCheckedKey","entityClick","onRowSelect","entitySelectChange","onToggleRows","onToggleRow","onShiftToggleRow","selectNode","target","stopImmediatePropagation","All","Some","columnIsSortable","rowIsSelected","isImg","isUrl","pop","getColumnRenderer","getTableClass","getHeaderClass","headerClassFunc","Function","getRowClass","rowClassFunc","getCellClass","cellClassFunc","onButtonClick","co","Dock","oxw","action","bd","disabled$","noDisplay$","args","ngClass","ngClass$$","updateNgClass","Xr","icon$$","updateIcon","checkCondition","checkCondition$$","updateCheckCondition","tooltip","tooltip$$","updateTooltip","availability","availability$$","disabled$$","display","display$$","noDisplay","noDisplay$$","trigger","ngClass$","tooltip$","checkCondition$","icon$","Yi","handler","collapsed","_overlayClass","withTitle","withIcon","horizontal","elRef","scrollActive","clientHeight","scrollHeight","scrollTop","positionConditionLow","onTriggerAction","scrollDown","scrollBy","scrollUp","Nn","C","F","we","P","b","Ne","is","imports","ns","matIconRegistry","getNamedSvgIcon","svg","updateSvg","hidden","updateHidden","updateDisabled","inverseColor","updateColor","inheritColor","querySelector","badge","style","alignItems","justifyContent","innerHTML","color","background","getComputedStyle","getPropertyValue","originalColor","jn","lt","Od","handleMouseClick","contains","clickout","Dd","li","_target","_collapsed","collapseTarget","expandTarget","toggle","click","rs","_title","ci","Pd","ss","open","dialog","disableClose","componentInstance","confirmMessage","afterClosed","tl","J","ol","onContextMenu","x","close","preventDefault","menuPosition","overlayRef","overlay","position","flexibleConnectedTo","withPositions","originX","originY","overlayX","overlayY","positionStrategy","scrollStrategy","scrollStrategies","attach","xp","menuContext","viewContainerRef","$implicit","sub","Po","overlayElement","ot","elementRef","dispose","il","as","H","qd","setTarget","componentRef","createComponent","componentFactory","updateInputs","inputs","updateSubscribers","subscribers","unobserveAllInputs","instance","propName","unobserveInput","observeInput","setInputValue","onUpdateInputs","getPrototypeOf","getOwnPropertyDescriptor","outputs","subscriptions","inputs$$","ls","resolver","resolveComponentFactory","nl","Qn","component","dynamicComponent","dynamicComponentService","renderComponent","cs","us","ps","ds","buttons","children","formData","setData","onSubmit","submitForm","getData","groups","fields","form","updateDataWithFormField","control","setValue","reset","zd","f","gs","formBuilder","group","addControl","getValidators","validator","setValidators","field","extendFieldConfig","getValidator","ms","getFieldByType","Wd","getFieldComponent","formFieldService","getFieldInputs","fieldInputs","fieldOptions","errors","placeholder","disableSwitch","formControl","required","getFieldSubscribers","fieldSubscribers","hs","I","re","sl","getFieldColSpan","cols","getFieldNgClass","getErrorMessage","al","zi","fs","zn","_s","ys","Vi","$o","cg","ll","jsonURL","getPathToConfigFile","loadConfigTour","getJSON","allToursOptions","getTourOptionData","vs","isAppHaveTour","interactiveTourLoader","isToolHaveTourConfig","disabledTourButton","conditions","_step4","isTourDisplayInMobile","getButtons","classes","getAction","addProgress","setInterval","getCurrentStep","attachTo","element","cancel","clearInterval","getElement","querySelectorAll","classList","add","steps","className","innerText","insertBefore","checkNext","_setupModal","show","executeAction","condition","executeActionPromise","waitFor","maxWait","getShepherdSteps","on","popperOptions","modifiers","offset","beforeShowPromise","previousStep","beforeChange","beforeShow","noBackButton","highlightClass","scrollTo","scrollToElement","canClickTarget","disableInteraction","when","onShow","hide","onHide","startTour","shepherdService","defaultStepOptions","cancelIcon","enabled","modal","confirmCancel","addSteps","tourObject","start","je","setToolbar","toolbar","initStore","activeTool$$","getTool","getTools","setTools","getToolbar","toolbar$","activateTool","activatePreviousTool","activeToolHistory","deactivateTool","_this$activeToolHisto2","clearActiveToolHistory","setActiveTool","activeTool$","Wi","cl","toolbox","tools","ul","getClass","styleButton","toolService","getTourToStart","tourToStart","activeToolName","isActiveTool","isToolHaveTour","interactiveTourService","startInteractiveTour","pl","Ro","ui","Tt","_color","_focused","beforeFocus","beforeUnfocus","toggleFocusedClass","focus","unfocus","beforeSelect","beforeUnselect","toggleSelectedClass","unselect","_disabled","beforeDisable","beforeEnable","toggleDisabledClass","disable","enable","getOffsetTop","offsetTop","focused","focusedCls","disabledCls","uo","_navigation","_selection","_selectedItem","focusedItem","_focusedItem","handleKeyboardEvent","navigationEnabled","enableNavigation","ngAfterViewInit","listItems","init","listItems$$","changes","focusNext","toArray","getFocusedIndex","isScrolledIntoView","offsetHeight","focusPrevious","selectedItem","navigation","disableNavigation","scrollToItem","findSelectedItem","findFocusedItem","handleItemBeforeSelect","handleItemSelect","handleItemBeforeFocus","handleItemFocus","Bo","yt","_withHeader","pt","Vn","shown$","shown","Lg","counter$$","spinner","Wn","Va","_filterChange","connect","_database","Kr","dataChange","_sort","sortChange","getFilteredData","getSortedData","disconnect","_model","filterable","ts","Xi","Yg","_hasFIlterInput","dl","database","model","displayedColumns","displayed","unshift","actions","changed","getActionColor","isAllSelected","masterToggle","handleClickAction","Hg","Sp","pi","White","se","Kg","Jo","Grey","Primary","toolbar$$","onToolbarChange","onActiveToolChange","actionStore","onAnimationStart","animating$","onAnimationComplete","getToolInputs","animate","onAnimate","animation$","parent","unAnimate","animating$$","zg","changeDetection","em","tm","gl","onCancel","onComplete","destroyWidget","getEffectiveSubscribers","baseSubscribers","widget","xs","Cs","ml","hl","getWorkspaceTitle","onSelectedChange","activateWorkspace","im","rm","workspace","widget$","widgetInputs$","widgetSubscribers$","onWidgetCancel","deactivateWidget","onWidgetComplete","sm","am","activeWorkspace$","deactivateWorkspace","fl","entityStore","activateWidget","pm","z","dm","mm","idsActivity","hm","Ss","production","igo","projections","code","alias","def","extent","auth","intern","allowAnonymous","interactiveTour","tourInMobile","importExport","catalog","sources","queryFormat","queryHtmlTarget","regFilters","tooltipType","searchSources","nominatim","icherche","searchUrl","order","params","limit","coordinatesreverse","showInPointerSummary","icherchereverse","ilayer","_m","configLanguage","ym","default","bm","changeLanguage","xm","Sm","Tm","Mm","Am","Fm","callHttp","callHttpError","Zm","Dm","added$","km","Ts","Pm","Em","toggleComponent","qm","Bm","description","image","Jm","jm","getTitle","Qm","Hm","choices","formService","valueChanges$$","valueChanges","submitDisabled","valid","form$","fillForm","data$","clearForm","zm","Wm","sortable","showName","lm","handleSelect","Xm","di","Ae","gi","oh","activateSalutationTool","ih","nh","sh","widgetService","ah","ws","tokenKey","decode","ch","isExpired","getTime","exp","Pe","authenticate$","authenticated","logged$","login","username","password","encodePassword","loginCall","loginWithToken","token","typeConnection","infosUser","loginAnonymous","anonymous","post","Ki","tokenService","logout","isAuthenticated","getToken","decodeToken","goToRedirectUrl","redirectUrl","loginRoute","navigateByUrl","homeRoute","getUserInfo","getProfils","updateUser","patch","isAnonymous","user","isAdmin","locale","ph","apiKey","clientId","loadSDKGoogle","loadPlatform","warn","handleSignInClick","gapi","auth2","getAuthInstance","signIn","handleSignOutClick","signOut","handleClientLoad","initClient","client","discoveryDocs","then","updateTextButton","isSignedIn","listen","updateSigninStatus","loginGoogle","access_token","authService","appRef","tick","getElementsByTagName","src","onload","parentNode","dh","msalService","Xn","cache","cacheLocation","broadcastService","Dt","inProgress$","mi","Uo","_destroying$","checkAccount","loginMicrosoft","loginPopup","getConf","authRequest","setActiveAccount","account","acquireTokenSilent","accessToken","tokenId","idToken","_l","acquireTokenPopup","msalGuardConfig","Ms","redirectHash","initializeWrapperLibrary","Kt","acquireTokenRedirect","handleRedirectObservable","handleRedirectPromise","loginRedirect","logoutRedirect","logoutPopup","ssoSilent","getLogger","logger","setLogger","gh","_msalSubject","msalSubject$","asObservable","_inProgress","msalInstance","addEventCallback","uh","verbose","eventType","mh","browserAuthOptions","loginMicrosoftb2c","hh","appId","loadSDKFacebook","subscribeEvents","FB","Event","statusChangeCallback","loginFacebook","authResponse","getElementById","yh","_allowAnonymous","loginUser","loading","As","backgroundDisable","isLogoutRoute","_backgroundDisable","hasAlreadyConnectedDiv","_hasAlreadyConnectedDiv","hasLogoutDiv","_hasLogoutDiv","showAlreadyConnectedDiv","_showAlreadyConnectedDiv","showLogoutDiv","_showLogoutDiv","showLoginDiv","analyzeRoute","getName","onLogin","logoutRoute","home","firstName","sourceId","events","isLoginRoute","Ls","hostname","handleHostsWithCredentials","handleHostsAuthByKey","withCredentials","refreshToken","href","host","trustHosts","eo","interceptXhr","setRequestHeader","alterUrlWithKeyAuth","hostsWithCredentials","_step6","RegExp","domainRegFilters","test","hostsWithAuthByKey","_step7","keyProperty","keyValue","refreshInProgress","redirectUri","authority","interactionType","scopes","loginHint","Ih","Dh","Zh","Oh","kh","preference","_i3","mergePreference","_i4","Fs","yl","Eh","qh","bf","extern","bi","_layer","openMetadata","metadataService","Tf","layerTitle","layer","abstract","Go","K","Y","handleLoadStart","handleLoadEnd","handleLoadError","un","__watchers__","loaded","params_","LAYERS","qi","We","OPACITY","kt","TITLE","wms","Mf","wmts","Af","xyz","Lf","feature","Ff","wfs","Zf","arcgisrest","qs","imagearcgisrest","tilearcgisrest","osm","tiledebug","Rs","wo","featureTypes","origin","generateId","createOlSource","pn","getLegend","legend","setLegend","De","BasicNumericOperator","O","BBOX","moment","an","PropertyIsEqualTo","spatial","fieldRestrict","PropertyIsNotEqualTo","PropertyIsLike","PropertyIsGreaterThan","PropertyIsGreaterThanOrEqualTo","PropertyIsLessThan","PropertyIsLessThanOrEqualTo","PropertyIsBetween","During","PropertyIsNull","Intersects","Within","Contains","defineOgcFiltersDefaultOptions","editable","geometryName","advancedOgcFilters","pushButtons","checkboxes","radioButtons","buildFilter","it","getCode","checkIgoFiltersProperties","srsName","featureNS","featurePrefix","bundleFilter","outputFormat","jo","writeGetFeature","XMLSerializer","serializeToString","createFilter","operator","logical","logicalArray","D","propertyName","pattern","matchCase","wildCard","singleChar","escapeChar","lowerBoundary","upperBoundary","_","wkt_geometry","T","w","parseFilterOptionDate","begin","minDate","A","end","maxDate","q","expression","olFormatWKT","readGeometry","dataProjection","featureProjection","And","Or","Not","defineInterfaceFilterSequence","filterSequence","addInterfaceFilter","computeAllowedOperators","allowedOperatorsType","Spatial","BasicAndSpatial","operators","Basic","Time","filterid","step","sliderOptions","igoSpatialSelector","igoSNRC","geometry","parentLogical","level","addFilterProperties","rebuiltIgoOgcFilterObjectFromSequence","computeIgoSelector","computedSelectors","bundles","selectorType","handleOgcFiltersAppliedValue","ogcFilters","_step8","formatGroupAndFilter","_step9","_step10","verifyMultipleEnableds","_iterator10","_step11","_iterator11","formatProcessedOgcFilter","multiple","isValid","Ze","GML2","$t","Qt","IFRAME","El","xi","Bs","Rl","paramsWFS","Js","wt","xmlFilter","download","dynamicUrl","urlWfs","maxFeatures","R","sourceFields","ze","Ue","fieldNameGeometry","et","he","Ie","OlFormat","formatOptions","gmlFormat","Ps","Hh","wl","zh","DPI","MAP_RESOLUTION","FORMAT_OPTIONS","refreshIntervalSec","Jl","buildDynamicDownloadUrlFromParamsWFS","wfsService","getSourceFieldsFromWFS","FILTER","setOgcFilters","timeFilterable","timeFilter","setTimeFilter","queryTitle","mapLabel","BLANK","updateParams","igoRefresh","jh","ratio","ogcFilters$","timeFilter$","scale","projection","contentDependentLegend","VERSION","currentStyle","onUnwatch","Pt","ogcFilterWriter","transferCommonProperties","ogcFilters$$","transferOgcFiltersProperties","timeFilter$$","transferTimeFilterProperties","syncChildLayers","hi","layers","linkedLayers","links","properties","VISIBLE","opacity","MINRESOLUTION","minResolution","MAXRESOLUTION","OGCFILTERS","TIMEFILTER","getProperties","linkId","linkedIds","visible$","bidirectionnal","sourceOptions","getSource","viewController","getOlProjection","getParams","Et","TIME","Ul","tile","be","format","getSourceFormatFromOptions","olSourceVector","formatType","ir","de","Gt","Ml","getUrl","fe","Te","ro","Lo","vo","$n","Pi","En","$i","ei","Ei","W","Nr","Ua","so","xA","ip","np","CA","jr","toLocaleUpperCase","trim","Fo","parseFloat","Mo","Number","_Q$vs","Q","_Q$vs2","_Q$vs3","_Q$vs4","lonLat","radius","conf","forceNA","SA","VF","abs","parseInt","originalEvent","altKey","Vh","metaKey","ctrlKey","shiftKey","isInResolutionsRange$","createOlLayer","zIndex","baseLayer","maxResolution","bt","maxScaleDenom","minScaleDenom","legendOptions","legendCollapsed","getZIndex","setZIndex","setOpacity","updateInResolutionsRange","getMaxResolution","setMaxResolution","getMinResolution","setMinResolution","setVisible","hasBeenVisible$","isInResolutionsRange","showInLayerList","setMap","unobserveResolution","observeResolution","layerSyncWatcher","Of","hasBeenVisible$$","messages","resolution$$","resolution$","getResolution","xe","kf","_assertThisInitialized","browsable","exportable","animation","flash","bind","trackFeature","enableTrackFeature","olLayerVector","customWFSLoader","authInterceptor","customLoader","setLoader","nn","frameState","getGeometry","time","duration","yi","ColorAsArray","getStyleFunction","getImage","getType","getRadius","setRadius","getStroke","setColor","setWidth","getWidth","getFill","setText","setStyle","drawGeometry","Ee","render","stopAnimation","trackFeatureListenerId","centerMapOnFeature","getFeatureById","getView","setCenter","getCoordinates","getId","disableTrackFeature","vi","Bl","getFeatures","XMLHttpRequest","removeLoadedExtent","onerror","responseText","getFormat","readFeatures","addFeatures","send","rn","responseXML","DOMParser","parseFromString","response","readProjection","cr","Wh","Xh","Us","strategy","Al","Uf","defineFieldAndValuefromWFS","wfsGetFeature","er","getKeys","getGeometryName","built_properties_value","boundedBy","_loop4","getExtent","extentGetWidth","Kh","extentGetTopLeft","resolutions","matrixIds","tileGrid","Nf","Ll","crossOrigin","ef","items","_i5","cartocss","layer_name","nr","attributions","overlaps","encodeURIComponent","customParams","olloadingstrategy","legendInfo","layerId","_step12","label","renderingRule","tf","_step13","nf","_step14","sf","rf","createWebSocket","_get","WebSocket","onmessage","onMessage","onclose","onClose","onError","onopen","onOpen","readFeature","removeFeature","addFeature","featureClass","Fl","af","_converters","esriPMS","ke","_convertEsriPMS","esriSFS","_convertEsriSFS","esriSLS","_convertEsriSLS","esriSMS","_convertEsriSMS","esriTS","_convertEsriTS","_renderers","uniqueValue","_renderUniqueValue","simple","_renderSimple","classBreaks","_renderClassBreaks","_convertLabelingInfo","labelExpression","symbol","maxScale","minScale","_getResolutionForScale","getText","defaultSymbol","classBreakInfos","classMinValue","minValue","classMaxValue","field1","uniqueValueInfos","generateStyle","drawingInfo","labelingInfo","_transformAngle","angle","E","gt","fill","j","_transformColor","font","weight","family","textBaseline","verticalAlignment","textAlign","horizontalAlignment","offsetX","_convertPointToPixel","xoffset","offsetY","yoffset","rotation","contentType","imageData","fi","outline","_convertOutline","stroke","U","lineDash","width","PI","ve","_i","points","radius2","Re","DATE","ht","CALENDAR","qt","getMap","Si","pr","Gh","Yh","esriJSON","getWMSOptions","getCapabilities","parseWMSOptions","getWMTSOptions","parseWMTSOptions","getCartoOptions","jsonp","mapId","parseCartoOptions","getArcgisOptions","po","parseArcgisOptions","getImageArcgisOptions","parseTileOrImageArcgisOptions","getTileArcgisOptions","fromObject","request","service","parsers","read","findDataSourceInCapabilities","Capability","Layer","DataURL","Abstract","KeywordList","queryable","getTimeFilter","Style","getStyle","EX_GeographicBoundingBox","mapService","GEOJSON","GEOJSON2","GML3","HTML","Request","GetFeatureInfo","Format","_i6","_layerOptionsFromSource","Title","MaxScaleDenominator","MinScaleDenominator","metadata","OnlineResource","keywordList","stepDate","Contents","Identifier","layer_definition","units","tr","copyrightText","timeInfo","timeExtent","setTime","toUTCString","range","DATETIME","serviceDescription","displayField","Name","Dimension","stylesAvailable","gn","registerProjection","Is","xl","setExtent","dt","createAsyncDataSource","createOSMDataSource","createFeatureDataSource","createWFSDataSource","createWMSDataSource","createWMTSDataSource","createXYZDataSource","createTileDebugDataSource","createCartoDataSource","createArcGISRestDataSource","createArcGISRestImageDataSource","createWebSocketDataSource","createMVTDataSource","createTileArcGISRestDataSource","createClusterDataSource","datasources$","Ql","Yl","Ci","wfsDataSourceService","optionsFromCapabilities","capabilitiesService","optionsService","optionsFromApi","js","Ns","Gl","ur","getArcgisRestOptions","Qs","Gs","dn","Ys","OlFormatGeoJSON","setId","Jn","startsWith","writeGeometryObject","excludeAttribute","excludeAttributeOffline","idColumn","mapTitle","getRevision","$e","_$e$ap2","Vl","Zoom","zoomToExtent","Move","moveToExtent","getZoom","bindLayer","addLayer","setLayerFeatures","checkLayer","Rt","setLayerOlFeatures","setStoreOlFeatures","mn","clearLayer","removeOlFeaturesFromLayer","addOlFeaturesToLayer","Yt","watchStore","empty$$","jt","updateEntitiesInExtent","unwatchStore","unwatchAll","stores$$","states$$","state$","inMapExtent","updateEntitiesInResolution","inMapResolution","setMotion","motion","onFeaturesChange","selectMotion","viewScale","areaRatio","getFeatureId","pristine","onSourceChanges","flatMap","Zl","_overlayStore","createOverlayStore","unselectAll","overlayStore","deactivateSelection","unlistenToMapClick","removeDragBoxInteraction","addOverlayLayer","listenToMapClick","dragBox","addDragBoxInteraction","watchAll","removeOverlayLayer","mapClickListener","onMapClick","lr","getFeaturesAtPixel","pixel","hitTolerance","layerFilter","onSelectFromMap","getInteractions","getArray","_step15","dr","addInteraction","olDragSelectInteraction","olDragSelectInteractionEndKey","onDragBoxEnd","removeInteraction","mapBrowserEvent","apply","getFeaturesInExtent","groupFeaturesByStore","unselectAllFeaturesFromStore","selectFeaturesFromStore","createOverlayLayer","xt","removeLayer","Bt","At","_ref8","_ref8$opacity","markerColor","_ref8$markerColor","markerOutlineColor","_ref8$markerOutlineCo","imgSize","anchor","overflow","Ho","createStyle","parseStyle","Ti","getOlCls","getOlKey","Nh","createStyleByAttribute","guessTypeFeature","attribute","baseStyle","getLabel","OlFeature","createClusterStyle","clusterRanges","_step16","minRadius","maxRadius","showRange","dynamicRadius","image_","radiusCalc","matchAll","_ref9","_ref9$strokeWidth","strokeWidth","fillColor","_ref9$fillColor","strokeColor","_ref9$strokeColor","Vf","setFeatures","_step17","removeOlFeature","addOlFeatures","addOlFeature","removeFeatures","unwatchLayer","watchLayer","wi","stateHistory","olView","olMap","setOlMap","observerKeys","onMoveEnd","extent$$","extent$","getProjection","getCenter","calculateExtent","getSize","getScale","getUnits","zoomIn","zoomTo","zoomOut","cancelAnimations","zoom","easing","getRotation","resetRotation","hasPreviousState","states","stateIndex","hasNextState","previousState","setStateIndex","nextState","clearStateHistory","setInitialState","sqrt","maxZoomOnExtent","fit","maxZoom","padding","callback","setState","resolution","center","trunc","getOlMap","controls","attribution","layerWatcher","Xf","layers$","olControlAttribution","scaleLine","bl","interactions","altShiftDragRotate","doubleClickZoom","keyboard","mouseWheelZoom","shiftDragZoom","dragPan","pinchRotate","pinchZoom","Rh","olinteraction","setView","e_","gr","queryResultsOverlay","searchResultsOverlay","buffer","updateView","constrainResolution","Bh","unsubscribeGeolocate","maxLayerZoomExtent","geolocate","alwaysTracking","updateControls","getControls","removeControl","changeBaseLayer","getBaseLayers","setMinZoom","minZoom","setMaxZoom","getLayerById","getLayerByAlias","getLayerByOlUId","ol_uid","addLayers","doAddLayer","setLayers","removeLayers","handleLinkedLayersDeletion","doRemoveLayer","syncedDelete","removeAllLayers","raiseLayer","getLayerIndex","moveLayer","raiseLayers","_step19","lowerLayer","lowerLayers","_step20","sortLayersByZIndex","geolocation$$","geolocation","getTracking","startGeolocation","geolocation$","getAccuracy","getPosition","olPoint","getAccuracyGeometry","geolocationPositionFeature","geolocationAccuracyFeature","bufferFeature","Qe","positionFollower","bufferRadius","bufferGeom","olCircle","bufferStroke","bufferFill","showBufferRadius","setZoom","stopGeolocation","setTracking","Jh","trackingOptions","enableHighAccuracy","tracking","onOfflineToggle","offlineButtonToggle$","ge","_view","_controls","activityId","o_","listenToMapPointerMove","unlistenToMapPointerMove","pointerMoveListener","onPointerEvent","pointerPositionDelay","dragging","lastTimeoutRequest","clearTimeout","coordinate","mapProjection","setTimeout","pointerPositionCoord","wf","olLoadingProblem","uf","setImageLoadFunction","abort","Uint8Array","TextDecoder","Blob","URL","createObjectURL","pf","setTileLoadFunction","Ol","onLoad","r_","mouseout","subscribeToPointerStore","layers$$","Yo","oc","unsubscribeToPointerStore","unlistenToMapSingleClick","store$$","pointerHoverFeatureStore","entitiesToPointerOverlay","addFeatureOverlay","onMapEvent","singleClickMapListener","onMapSingleClickEvent","igoHoverFeatureEnabled","getPixelFromCoordinate","forEachFeatureAtPixel","setLayerStyleFromOptions","igoHoverFeatureDelay","getSameFeatureNeighbour","lf","hoverFeatureId","hoverSummary","getHoverSummary","styleByAttribute","hoverStyle","styleService","_i7","_Object$entries$_i","getOrientedFlatCoordinates","Oe","go","backgroundFill","backgroundStroke","Xe","getMinZoom","getMaxZoom","yn","_map","d_","useStaticIcon","_baseLayers","collapseOrExpand","expand","baseLayers","height","Ce","createLayer","createTileLayer","createVectorLayer","createImageLayer","createVectorTileLayer","createAsyncLayer","dataSourceService","i_","n_","clusterBaseStyle","clusterParam","applyMapboxStyle","tc","mapboxStyle","getMapboxGlStyle","df","sc","Be","_baseLayer","handleBaseLayerChanged","handleMainMapViewChange","basemap","setResolution","setRotation","layerService","handleLinkedBaseLayer","vn","_showIfNoRotation","rotationStyle","Ke","le","catalogService","__","collectCatalogItems","loadCatalogWMSLayerItems","Ai","y_","loadCatalogWMTSLayerItems","v_","baselayers","loadCatalogBaseLayerItems","b_","loadCatalogArcGISRestItems","ac","composite","loadCatalogCompositeLayerItems","createInstanceCatalog","x_","Vs","query","queryLayer","getQueryUrl","HTMLGML2","vl","mergeGML","extractData","Sl","cf","Il","getQueryParams","bbox","appendLineString","appendPolygon","coordinates","convexHull","cross","_step21","getAllowedFieldsAndAlias","extractGML3Data","extractGeoJSONData","ESRIJSON","extractEsriJSONData","TEXT","extractTextData","extractHtmlData","extractGML2Data","_step22","createGeometryFromUrlClick","_iterator22","getQueryTitle","sourceTitle","sn","featureToResult","features","crs","srs","lastIndexOf","gf","GEOMETRIE","shape","SHAPE","the_geom","geom","queryUrl","getCustomQueryUrl","INFO_FORMAT","getMimeInfoFormat","QUERY_LAYERS","FEATURE_COUNT","getFeatureInfoUrl","sql","queryPrecision","getLabelMatch","bn","queryFeature","cc","cancelOngoingQueries","queryService","queryEnabled","queryFeatures","doQueryFeatures","waitForAllQueries","queries$$","Kn","_ref11","values_","_step23","nom","id_","_icon","mf","getEnds","getFlatCoordinates","Os","queryFeaturesHitTolerance","queryFeaturesCondition","S_","forEachFeatureIntersectingExtent","_step24","rt","storageService","getDefaultOptions","settings","setParamFromSetting","available","showInSettings","getHashtagsValid","getSettingsValues","normalize","hashtags","uc","getGoogleMapsCoordLink","encodeURI","getOpenStreetMapLink","Xs","loadCatalogs","No","loadCatalogItems","lc","getCatalogBaseLayersOptions","externalProvider","Group","getCatalogCapabilities","Service","flattenWmsCapabilities","groupSeparator","includeRecursiveItems","_step25","getWMTSItems","getArcGISRESTItems","sortDirection","groupImpose","address","_ref12","Se","_ref13","prepareCatalogItemLayer","retrieveLayerInfoFormat","showLegend","setCrossOriginAnonymous","forcedProperties","_step26","layerName","prepareCatalogItemGroup","testLayerRegexes","_step27","findCatalogInfoFormat","ServiceIdentification","_step28","matrixSet","requestEncoding","_step29","Ks","catalogAllowLegend","isGroup","isLayer","onLayerAddedChange","addLayerToMap","removeLayerFromMap","onGroupAddedChange","addGroupToMap","removeGroupFromMap","addLayersToMap","removeLayersFromMap","sortCatalogItemsByTitle","Cn","styles","listStyles","STYLES","updateLegendOnResolutionChange","onViewControllerStateChange","legendItems$","_step30","getLegendGraphic","currentItemTitle","legendGraphic","toggleLegendItem","transfertToggleLegendItem","computeItemTitle","updateLegend","_step31","onChangeStyle","onLoadImage","renderedLegends","first","imagesHeight","pc","isPreview$$","isPreview$","addedLayerIsPreview","computeTitleTooltip","ABSTRACT","CUSTOM","onMouseEvent","onToggleClick","askForLegend","layerLegendShown$","igoLayer$","mouseInsideAdd","addedChange","haveGroup","inRange$","computeTooltip","K_","evaluateAdded","evaluateDisabled","onToggleCollapsed","layerAddedChange","tryToggleGroup","onLayerPreview","preview$","toggleCollapsed","onTitleClick","ey","gc","_activeLayer","selectionMode","layerTool$","_selectAll","layerCheck","expandLegendIfVisible","firstLoadComponent","toggleLegend","updateQueryBadge","onResolutionChange","tooltipText","network$$","networkService","showLegend$","toggleLegendOnClick","toggleVisibility","toggleLegendOnVisibilityChange","inResolutionRange$","queryBadge","queryBadgeHidden$","toggleLayerTool","check","checkbox","Ge","always","Ao","ALL_VISIBLE","Li","Raise","zo","_layers","removeProblemLayerInList","activeLayer$","_keyword","_onlyVisible","_sortedAlpha","orderable","activeLayer","getUpperLayer","isUpperBaselayer","getLowerLayer","isLowerBaselayer","layersChecked","raisableLayers","selectAllCheck","lowerDisabledSelection","lowerableLayers","checkOpacity","layersCheckedOpacity","change$$","tn","en","showToolbar$","computeShowToolbar","computeLayers","appliedFilterAndSort","keyword","sortAlpha","onlyVisible","selectAllCheck$$","selectAllCheck$","_step33","_iterator33","layerTool","excludeBaseLayers","activeLayerIsValid","activeLayersAreValid","_step34","zoomLayerExtents","zoomLayersExtents","_step35","changeOpacity","clearKeyword","moveActiveLayer","getLinkedLayers","Lower","ZINDEX","_loop7","raisableLayer","_iterator37","_step37","_loop8","computeElementRef","offsetParent","_loop9","lowerableLayer","_iterator39","_step39","_loop10","filterLayers","sortLayersByTitle","sortLayersByZindex","onKeywordChange","onAppliedFilterAndSortChange","layerFilterAndSortOptions","showToolbar","never","thresholdToFilterAndSort","toggleOpacity","_step41","removable","hideSelectedLayers","layerItemChangeDetection$","isLayerRemovable","isAllLayersRemovable","NULL","MIXED","_step43","ALL_HIDDEN","layersCheck","_step44","_iterator44","toggleSelectionMode","_step45","_step46","_iterator46","selectAll","_step48","getElementsByClassName","_step49","Cy","onlyVisible$","sortAlpha$","term$","term$$","onlyVisible$$","term","sortAlpha$$","clearTerm","toggleSortAlpha","toggleOnlyVisible","mr","layersOrResolutionChange$$","setLayersVisibilityStatus","layersVisibility$$","Boolean","layersAreAllVisible","Sn","computeShownLayers","hasVisibleOrInRangeLayers$","hasVisibleAndNotInRangeLayers$","layersInUi$","showAllLegendsValue","toggleShowAllLegends","allLegendsShown","hr","toggleTrackFeature","hc","Vo","st","nt","Qo","fc","Ry","predefinedCatalogs","addedCatalog","defaultAddedCatalogType","typeCapabilities","addedCatalogType$$","updateValueAndValidity","computePredefinedCatalogList","storeViewAll$$","emailAddress","changeUrlOrTitle","patchValue","predefinedCatalogsList$","addCatalog","dialogRef","ea","getCatalogs","onCatalogSelect","catalogSelectChange","unsubscribeAddingCatalog","addingCatalog$$","addCatalogDialog","mapName","ServiceType","addedCatalogs","onCatalogRemove","Qy","removeCatalogFromLibrary","catalogRemove","_c","vt","yc","vc","isTimeFilterable","isOgcFilterable","bc","filterByDate","reformatDateTime","filterByYear","getFullYear","getMonth","getUTCDate","getUTCHours","getUTCMinutes","ta","filterByOgc","setOgcWFSFiltersOptions","interfaceOgcFilters","setOgcWMSFiltersOptions","filtered","me","Predefined","ut","Address","Tn","AdmRegion","Arrond","CircFed","CircProv","DirReg","MRC","Mun","RegTour","bornes","hydro","routes","baseUrl","getKeyByValue","loadFilterList","urlFilterList","loadThematicsList","loadFilterItem","bufferInput","simplified","loc","loadItemById","loadBufferGeometry","bufferOutput","xc","outputFormatDownload","Hy","openDownload","downloadService","fr","Wo","unsubscribe$","_source","_feature","selectFeature","ready","urlSanitizer","sanitizer","bypassSecurityTrustResourceUrl","isHtmlDisplay","htmlDisplayEvent","htmlSanitizer","filterFeatureProperties","Route","_r","Point","olDrawingLayer","drawingLayer","createOlInnerOverlayLayer","olGeometryType","geometryType","olDrawingLayerSource","clearOlInnerOverlaySource","removeOlInnerOverlayLayer","removeOlInteractions","addOlInnerOverlayLayer","addOlInteractions","setGeometryType","drawingLayerSource","oo","drawingLayerStyle","freehand$","rr","maxPoints","freehand","stopClick","interactionStyle","freehandCondition","olDrawInteraction","onDrawStartKey","onDrawStart","onDrawEndKey","onDrawEnd","kl","olModifyInteraction","olSelectInteraction","Zs","Pl","onSelect","unsubscribeKeyDown","onDrawKey","start$","mousePosition","ra","changes$","subscribeKeyDown","modify$","end$","select$","keyDown$$","removeLastPoint","finishDrawing","abortDrawing","mv","noLabel","hv","Lt","Length","ee","Meters","sa","Kilometers","Miles","Feet","Je","SquareMeters","Tc","SquareKilometers","SquareMiles","SquareFeet","Hectares","Acres","fv","yv","_v","vv","bv","xv","Cv","Sv","decimal","toLocaleString","minimumFractionDigits","maximumFractionDigits","toFixed","unit","unitAbbr","olGetLength","wc","olGetArea","area","lengths","Mc","getCoordinateAt","setCoordinates","or","Ac","removeOverlay","$l","stopEvent","setPosition","Olstyle","Dv","getFillColor","setFillColor","getStrokeColor","setStrokeColor","getStrokeWidth","getLabelsAreShown","labelsAreShown","toggleLabelsAreShown","setIcon","getIcon","createDrawingLayerStyle","flatCoordinates","OlStyle","cos","kv","getIconsList","getIcons","icons","getPath","Ic","draw","buildForm","drawStyleService","drawIconService","drawControl","createDrawControl","toggleDrawControl","subscriptions$$","wn","Ov","onGeometryTypeChange","fn","Kl","many","clearLabelsOfOlGeometry","selectedFeatures$","onColorChange","strokeForm","onToggleDrawControl","deactivateDrawControl","activateDrawControl","openDialog","currentLabel","updateLabelOfOlGeometry","onSelectDraw","drawControlIsDisabled","drawControlIsActive","drawEnd$$","onModifyDraw","drawSelect$$","addFeatureToStore","replaceFeatureInStore","rad","$s","longitude","latitude","deleteDrawings","ua","onToggleLabels","setProperties","_label","onIconChange","openShorcutsDialog","Oc","qe","Dl","pa","Bv","mo","modify","olOverlayLayer","olLinearRingsLayer","createOlLinearRingsLayer","olOverlaySource","removeOlModifyInteraction","removeOlTranslateInteraction","removeOlDrawInteraction","addOlDrawInteraction","addOlTranslateInteraction","activateTranslateInteraction","addOlModifyInteraction","activateModifyInteraction","setOlGeometry","olFeature","layerStyle","Sc","addOlLinearRingsLayer","removeOlLinearRingsLayer","clearOlLinearRingsSource","olLinearRingsSource","drawStyle","deactivateModifyInteraction","olModifyInteractionIsActive","onModifyStartKey","onModifyStart","onModifyEndKey","onModifyEnd","onModifyKey","item","subscribeToKeyDown","unsubscribeToKeyDown","Cl","olTranslateInteraction","deactivateTranslateInteraction","olTranslateInteractionIsActive","onTranslateStartKey","onTranslateStart","onTranslateEndKey","onTranslateEnd","onTranslateKey","olOuterGeometry","getOlGeometry","intersectsCoordinate","subscribeToDrawKeyDown","drawKeyDown$$","unsubscribeToDrawKeyDown","subscribeToDrawKeyUp","activateDrawInteraction","drawKeyUp$$","unsubscribeToDrawKeyUp","deactivateDrawInteraction","olDrawInteractionIsActive","removedOlInteractions","getLinearRing","addLinearRingToOlGeometry","updateLinearRingOfOlGeometry","appendLinearRing","hf","getLinearRings","Ln","Pc","onNoClick","da","activeLengthUnit","An","Mn","measure","activeAreaUnit","yr","_activeMeasureType","setActiveMeasureType","activeDrawControl","createDrawLineControl","createDrawPolygonControl","createModifyControl","updateTooltipsOfOlSource","checkDistanceAreaToggle","deactivateModifyControl","freezeStore","onMeasureTypeChange","activeMeasureType","onToggleMeasureUnitsAuto","measureUnitsAuto","onToggleDisplayDistance","displayDistance","onDisplayDistance","onToggleDisplayLines","displayLines","onDisplayLines","onToggleDisplayAreas","displayAreas","onDisplayAreas","onLengthUnitChange","table","activeOlGeometry","updateTooltipsOfOlGeometry","onAreaUnitChange","onCalculateClick","perimeter","onDeleteClick","olDrawSource","onModifyClick","modifyControl","activateModifyControl","clearTooltipsOfOlGeometry","onFeatureAddedKey","updateMeasureOfOlGeometry","onFeatureRemovedKey","selectedFeatures$$","hasArea$","hasLine$","drawLineControl","aa","drawPolygonControl","kc","Area","drawStart$$","drawChanges$$","onDrawChanges","clearTooltipsOfOlSource","clearMeasures","finalizeMeasureOfOlGeometry","la","measure$","modifyStart$$","modifyEnd$$","modifyChanges$$","onModifyChanges","_measure","ca","Fc","updateOlTooltip","olGetCenter","showTooltipsOfOlGeometry","shouldShowTooltip","addOverlay","forEachFeature","showTooltipsOfOlSource","_unit","_type","computeTooltipInnerHTML","showTooltips","minSegmentLength","$c","Ec","createMeasureTooltip","ngControl","toggleControl","_geometryType","deactivateControl","freehandDrawIsActive","_drawControlIsActive","_freehandDrawIsActive","_drawStyle","Cc","getGuideStyleFromDrawStyle","defaultDrawStyleRadius","_overlayStyle","_value","addGeoJSONToOverlay","onChange","features_","overlayStyle","addOlOverlayLayer","registerOnChange","registerOnTouched","onTouched","writeValue","controlOptions","updateDrawStyleWithDrawGuide","activeControl","activateControl","olGeometryEnds$$","onOlGeometryEnds","olGeometryChanges$$","onOlGeometryChanges","removeMeasureTooltip","updateMeasureTooltip","circleToPoint","olGeoJSON","olTooltip","drawGuide","isStyleWithRadius","qc","ga","Fn","b1","dateAdapter","setLocale","YEAR","isNaN","valueOf","startDate","endDate","SLIDER","getStepDefinition","timeInterval","getTimezoneOffset","startYear","initStartYear","endYear","initEndYear","isRange","startListYears","endListYears","listYears","checkFilterValue","yearChange","year","storeCurrentFilterValue","handleDateChange","setupDateOutput","applyTypeChange","handleYearChange","handleListYearChange","handleListYearStartChange","dateToNumber","setSliderThumbLabel","findThumbLabel","mySlider","_elementRef","childNodes","textContent","toggleFilterState","stopFilter","resetFilter","date","playFilter","interval","playIcon","playYear","handleSliderDateChange","handleSliderTooltip","handleSliderYearChange","handleSliderValue","current","getRoundedDate","toDateString","toTimeString","setSeconds","setHours","setMinutes","getDay","getHours","getMinutes","getRangeMinDate","getRangeMaxDate","asMilliseconds","vr","timeFilterService","datasource","filtersCollapsed","toggleFiltersCollapsed","br","L1","wktToFeature","extentToWkt","roundCoordinateArray","wktPoly","wktLine","wktMultiPoints","roundArray","snrcToWkt","Rc","allOgcFilterOperators","ogcFilterOperators$","igoSpatialSelectors","_snrc","currentFilter","allowedOperators","fields$","excludeFromOgcFilters","updateFieldsList","selectedField$","updateValuesList","currentFilterIsSpatial","filteredFields$","_filterFields","changeField","filteredValues$","_filterValues","changeProperty","clearSelectedField","clearProperty","isClearable","detectProperty","checked","refreshFilters","deleteFilter","changeLogical","changeOperator","currentFilterIsSpatial$","changeSpatialSelector","changeCaseSensitive","changeNumericProperty","changeMapExtentGeometry","changeSNRC","snrc","changeSNRCGeometry","wktService","isTemporalOperator","ogcFilterOperator","Bc","Zn","hasSelector","ogcFilterService","lastRunOgcFilter","hasActiveSpatialFilter","filtersAreEditable","addFilterToSequence","defaultLogicalParent","isAdvancedOgcFilters","addFilterDisabled","changeOgcFiltersAdvancedOgcFilters","changeOgcFilterType","xr","In","ma","stepMillisecond","defaultStepMillisecond","stepIsYearDuration","years","months","weeks","days","hours","minutes","stepIsMonthDuration","stepIsWeekDuration","stepIsDayDuration","stepIsHourDuration","stepIsMinuteDuration","ho","addStep","toDate","subtractStep","subtract","Jc","_currentFilter","pushButtonsGroup","checkboxesGroup","radioButtonsGroup","selectGroup","enabled$","applyFiltersTimeout","currentSelectGroup","applyFilters","enableds$","getPushButtonsGroups","getCheckboxesGroups","getRadioButtonsGroups","getSelectGroups","currentPushButtonsGroup","currentCheckboxesGroup","currentRadioButtonsGroup","getSelectEnabled","onPushButtonsChangeGroup","onCheckboxesChangeGroup","onRadioButtonsChangeGroup","onSelectChangeGroup","enableds","getToolTip","getButtonColor","bundleIsVertical","vertical","emptyRadioButtons","emptySelect","toggleAllSelection","sel","allSelected","deselect","optionClick","_i8","isMoreResults","radioButtonsIndex","checkboxesIndex","displayMoreResults","isLessResults","baseIndex","displayLessResults","ha","spatialType","Polygon","_store","selectedTypeIndex","activeDrawType","onTypeChange","onDrawTypeChange","eventQueryType","selectedQueryType","zoneChange","o0","_queryType","_zone","zoneWithBuffer","bufferFormControl","formValueChanges$$","bufferValueChanges$$","measureUnit","bufferChange","spatialFilterService","selectedZone","queryType","zoneWithBufferChange","displayFn","onZoneChange","onMeasureUnitChange","measureUnitChange","fa","Thematics","ff","To","geometryTypes","drawGuide$","drawStyle$","radiusFormControl","PointStyle","olStyle","PolyStyle","overlayStyle$","_thematicLength","_step52","childrens","thematics","_step53","value$","value$$","drawZone","drawZoneEvent","radiusChanges$$","bufferChanges$$","bufferEvent","detach","onItemTypeChange","selectedItemType","itemTypeChange","isPolygon","isPoint","isPredefined","hasChild","treeControl","isExpanded","collapse","selectedThematics","hasChildrenSelected","_step54","thematicChange","childrensToggle","_step55","onToggleChange","_step56","onDrawControlChange","onfreehandControlChange","freehandControl","toggleSearchButton","radiusEvent","toggleSearch","thematicLength","openWorkspace","clearButton","clearButtonEvent","clearDrawZone","clearSearch","clearSearchEvent","disableSearchButton","zone","disabledClearSearch","_a","_beginValue","_endValue","sliderInterval","_defaultMax","displayFormat","_defaultDisplayFormat","_defaultSliderModeEnabled","beginValue","parseFilter","handleMin","endValue","handleMax","onlyYearBegin","getUTCFullYear","onlyYearEnd","calendarTypeYear","isCalendarYearMode","updateHoursMinutesArray","updateValues","calendarModeYear","setUTCFullYear","endOf","changeTemporalProperty","getDateTime","calendarType","sliderMode","restrictedToStep","ogcFilterTimeService","stepMilliseconds","toISOString","pos","refreshFilter","handleDate","yearOnlyInputChange","yearSelected","startOf","monthSelected","calendarView","dateFilter","te","asYears","asMonths","asWeeks","asDays","asHours","beginHourFormControl","beginMinuteFormControl","endHourFormControl","endMinuteFormControl","handleMinuteIncrement","handleHourIncrement","fullBeginHoursArray","beginHours","fullEndHoursArray","endHours","fullBeginMinutesArray","beginMinutes","fullEndMinutesArray","endMinutes","restrictToStep","_defaultMin","changePropertyByPass","modeChange","ft","q0","sliderDisplayWith","_defaultSliderInterval","calculateStep","handleSliderInput","beginMillisecond","slider","calculatedStep","_increment","_emitInputEvent","maxMillisecond","fo","N","ct","mt","ar","ln","setPrototypeOf","va","prototype","Uc","Cr","ie","Wt","Ht","ba","ogreUrl","aggregateInComment","export","generateFeature","exportAsync","GPX","generateAggregatedFeature","nothingToExport","ogreFormats","noOgreFallbacks","exportToFile","exportWithOgre","setAttribute","writeFeatures","featureType","UTF8","acceptCharset","enctype","LATIN1","submit","GML","KML","Shapefile","CSVcomma","CSVsemicolon","xa","getStyleList","distance","mimeType","Fi","Tr","Xo","wr","Ca","Qc","clientSideFileSizeMax","import","importAsync","getFileImporter","jc","allowedMimeTypes","allowedZipMimeTypes","allowedExtensions","importFile","importFileWithOgre","W0","parseFeaturesFromFile","readAsText","FormData","append","parseFeaturesFromGeoJSON","msg","startWith","X0","ks","Tl","Ds","writeFeatureObject","Mr","styleList","Gc","loadConfig","computeProjections","_projectionsLimitations","importForm","inputProj","exportableLayers$","fileSizeMb","exportOptions$$","exportOptions$","computeFormats","formLayer$$","popupChecked","handlePopup","handlePreviousLayerSpecs","formats$","loading$","previousLayerSpecs$","formats$$","encodings$$","encodings$","encoding","exportableLayers$$","controlFormat","selectFirstProj","projections$","translateKey","projectionsConstraints","mtmZone","utmZone","projFromConfig","nad83","wgs84","webMercator","utm","mtm","minZone","maxZone","projectionsLimitations","getWorkspaceByLayerId","getLayerTitleById","layerHasSelectedFeatures","onlySelected","layersWithSelection","onlySelectedClick","inLayersIdToExportSelectionOnly","exportOptionsChange","importFiles","espgCodeRegex","importService","onFileImportSuccess","onFileImportError","closed","onPopupBlockedError","popupAllowed","handleExportFormSubmit","featureInMapExtent","setGeometry","exportService","onFileExportError","onFileExportSuccess","forceNaming","Sr","styleListService","Q0","Y0","G0","z0","V0","extraMessage","loadEncodings","encodingDefaultValue","onlyUrl","onlyVector","vectorAndUrl","customList","allowedFormats","formats","validateListFormat","GeoJSON","modeChanged","selectMode","onImportExportChange","selectedMode","Yc","zc","Hc","vx","Ar","Ye","Cx","_auto","toggleAutoUnit","measureType","measure$$","computeBestMeasureUnit","Vc","Wc","On","Sa","features$","Sx","olFormatGeoJSON","features$$","overlayService","handleFeatures","Lr","Tx","print","paperFormat","orientation","_f","internal","getTitleSize","addTitle","subtitle","getSubTitleSize","addSubTitle","showProjection","showScale","addProjScale","comment","addComment","addMap","_context3","addScale","handleMeasureLayer","legendPosition","addLegendSamePage","addLegend","saveDoc","getOverlayContainer","cn","backgroundColor","addCanvas","getLayersLegendHtml","_step58","_step59","getDataImage","rxMap","getLayersLegendImage","toPromise","top","timeout","useCORS","generateCanvaFileToZip","saveCanvasImageAsFile","setFont","getTextWidth","getStringUnitWidth","scaleFactor","setFontSize","jl","addPage","toDataURL","addImage","getOverlayContainerStopEvent","_i9","allowTaint","defineNbFileToProcess","nbFileToProcess","getImageSizeToFitPdf","rect","once","getViewport","_step60","renderMap","_step61","downloadMapImage","getContext","measureText","ceil","fillStyle","fillRect","fillText","drawImage","getWorldFileInformation","addFileToZip","Es","saveFileProcessing","renderSync","updateSize","save","returnPromise","getHeight","msSaveBlob","msToBlob","toBlob","zipFile","vf","file","getZipFile","generateAsync","Xc","Kc","eu","tu","ou","iu","Ix","imageFormat","doZipFile","isPrintService","imageFormatField","Jpeg","onlySelf","outputFormatField","Pdf","paperFormatField","Letter","orientationField","landscape","resolutionField","legendPositionField","none","titleField","subtitleField","commentField","showProjectionField","showScaleField","showLegendField","doZipFileField","handleFormSubmit","toggleImageSaveProp","nu","_outputFormat","_paperFormat","_orientation","_imageFormat","_legendPosition","_resolution","printService","Ta","Dn","Ox","Ma","Fr","Zr","Ko","Coord","_o","Stop","yo","Start","Intermediate","End","relativePosition","Ir","Aa","aggregatedDirection","translatedModifier","translatedDirection","coma","exit","cntSuffix","instruction","cssClass","Xx","unlistenMapSingleClick","onStopEnter","stopWithHover","onStopLeave","getOptionText","chooseProposal","option","sr","stopsStore","setStopText","clearStop","validateTerm","keyIsValid","invalidKeys","getNgClass","getPlaceholder","removeStop","drop","moveStops","previousIndex","currentIndex","onInputFocus","stopInputHasFocus","listenMapSingleClick","stopsFeatureStore","Mt","olProj","coordRoundedDecimals","onMapClickEventKeys","Kx","directionsSourceService","routeSource","reverseSearch","lu","getSources","getEnabledSources","enableSourcesByType","Ii","termIsValid","Nl","getEnabledOnly","searchSourceService","searchType","kn","Za","au","reverseSearchSources","nC","routesFeatureStore","resetStops","clearStops","addStop","La","copyLinkToClipboard","zoomRoute","zoomToActiveRoute$","copyDirectionsToClipboard","directionsToText","activeRoute","ru","formatStep","su","maneuver","modifier","bearing_after","pathname","uC","directions","activeDirection","changeRoute","formatDistance","formatDuration","onStepsListBlur","stepFeatureStore","showSegment","showRouteSegmentGeometry","olGeom","Vertex","cu","initEntityStores","Fa","initOlInteraction","storeEmpty$$","storeChange$$","routesQueries$$","zoomRoute$$","freezeStores","selectStopInteraction","translateStop","selectedRoute","monitorEmptyEntityStore","monitorEntityStoreChange","monitorActiveRouteZoom","isTranslating","executeStopTranslation","focusOnStop","onStopInputHasFocusChange","getLength","storeInitialized$","debounce","handleStopDiff","handleStopsFeature","getRoutes","cancelSearch","searchs$$","previousStops","searchService","searchProposals","Text","results","addStopOverlay","directionsService","overview","alternatives","continue_straight","stopText","stopColor","stopOpacity","stop","Ia","kx","wa","zt","Dr","formatResult","encodeKey","encodeValue","decodeKey","decodeValue","uu","title$","getAllowedTypes","ecmax","computeRequestParams","page","extractResults","hashtagsLieuxToKeep","computeOptionsParam","computeTerm","_o$extent","encoder","gC","formatter","dataToResult","computeProperties","dataType","titleHtml","highlight","title2","title3","score","Zi","nextPage","propertiesBlacklist","GoogleMaps","Jt","getGoogleMapsNameLink","municipalite","GoogleStreetView","getGoogleStreetViewLink","pu","getSubtitle","computeExtent","du","gu","coord","igo2CoordFormat","writeGeometry","OpenStreetMap","T_","kr","_slicedToArray","_l13","mu","computeSearchRequestParams","computeLayerOptions","groupTitle","extractQueryParamsFromSourceUrl","metadataUrl","urls","_i10","hu","FC","searchType$","setSearchType","searchType$$","onSetSearchType","onSearchTypeChange","getSearchTypeTitle","searchTypeChange","Oa","JC","now","pointerSummaryEnabled","pointerSummaryStatus","hasPointerReverseSearchSource","hasReverseSearchSourcesForPointerSummary","getSearchSources","computeSourcesCheckAllBehavior","settingsValueCheckedCheckbox","searchSourceChange","computeSettingCheckAllBehavior","allEnabled","searchSourcesAllEnabled","checkUncheckAll","checkUncheckAllSources","settingsValueCheckedRadioButton","onCheckSearchSource","getAvailableValues","getAvailableHashtagsValues","changePointerReverseSearch","changeSearchResultsGeometry","searchResultsGeometryEnabled","searchResultsGeometryStatus","Da","ka","setTerm","stream$$","stream$","onSetTerm","handlePlaceholder","onKeyup","onClearButtonClick","clearFeature","onSearchSettingsChange","doSearch","searchSettingsChange","minLength","input","searchTermChange","placeholder$","researches$$","termSplitter","onResearchCompleted","research","fu","oS","titleHtmlProperty","onZoomHandler","resultFocus","resultUnfocus","Pn","Grouped","yu","_term","pageIterator","_results$","liftResults","settingsChange$$","settingsChange$","computeGroupTitle","onResultSelect","resultSelect","groupResults","sortByOrder","displayOrder","Nt","moreResults","vu","layersSubcriptions","bu","mS","hS","ngAfterContentChecked","unsubscribeReverseSearch","pointerSearchStore","computeSummaryClosestFeature","addPointerOverlay","reverseSearch$$","igoSearchPointerSummaryEnabled","onSearchCoordinate","igoSearchPointerSummaryDelay","onSearch","_loop14","searchPointerSummaryFeatureId","pointerSummary","Pr","pC","mC","bC","TC","vS","xu","Cu","Su","createWorkspace","srcId","workspaceId","Pa","createFeatureStore","tableTemplate","createTableTemplate","zs","hn","Hs","ai","zoomAuto","createFilterInMapExtentOrResolutionStrategy","Tu","Mu","wu","CS","onLayersChange","layerIsEditable","getOrCreateWorkspace","workspaceStore","wfsWorkspaceService","wmsWorkspaceService","featureWorkspaceService","Au","Lu","Fu","bS","TS","directionsUrl","_name","getRouteParams","extractRoutesData","formatRoute","waypoints","geometries","legs","summary","sourceType","weight_name","ku","endsWith","numero","epsg","computeGeometry","NoLot","Pu","place_id","display_name","osm_type","class","lon","lat","boundingbox","computeTermTags","computeTermSettings","$u","storedQueriesOptions","storedquery_id","defaultValue","splitPrefix","outputformat","srsname","resultTitle","multipleFieldsQuery","extractWFSData","getFormatFromOptions","Eu","longField","latField","doc_type","ES","onPointerMove","pointerCoord","qS","JS","US","jS","QS","YS","HS","WS","geometryTypeField","drawGuideField","drawGuidePlaceholder","XS","eT","tT","iT","circle","media","nT","sT","aT","cT","uT","gT","handleQueryResults","feature$","mT","fT","onCatalogSelectChange","catalogStore","catalogItemStore","_T","Ct","io","ours","basePath","contextListFile","defaultContextUri","readParamsFromRoute","hasAuthService","contexts$","handleContextsChange","loadContexts","_defaultContextUri","getById","getDetails","getDefault","defaultContextId$","getProfilByUser","setDefault","defaultContextId","hideContext","showContext","importedContext","permission","write","addToolAssociation","toolId","deleteToolAssociation","getPermissions","addPermissionAssociation","profil","typePermission","deletePermissionAssociation","getLocalContexts","getLocalContext","base","loadDefaultContext","uri","addContextToList","setContext","loadContext","context$","getContextByUri","handleContextMessage","keepCurrentView","mapViewFromRoute","loadEditedContext","setEditedContext","editedContext$","getContextFromMap","_step62","layerOptions","global","getContextFromLayers","extraFeatures","contextMessage","_i11","imported","getContextLayers","findContext","toolsChanged$","_i12","Ea","Ju","context$$","contextService","handleContextChange","minWidth","Uu","removeLayersOnContextChange","contextLayers","yT","computeLayerVisibilityFromUrl","Oi","Nu","KT","_context","_default","context","favoriteClick","favorite","edit","manageTools","managePermissions","Br","contextsInitial","shared","public","_contexts","_selectedContext","_defaultContextId","contexts","filterContextsList","createContext","sortedAlpha","sortContextsList","showFilter","showContextFilter","thresholdToFilter","toggleSort","clearFilter","empty","getPermission","permissions","userSelection","indeterminate","_step63","_iterator63","childs","_step64","filterPermissionsChanged","showHidden","qa","onEdit","onSave","onFavorite","onManageTools","onManagePermissions","onDelete","confirmDialogService","onClone","onCreate","_step65","showHiddenContexts","onShowContext","onHideContext","contexts$$","defaultContextId$$","selectedContext$$","selectedContext","users","_step66","_step67","Gu","Yu","Ra","Di","no","ki","setImportExportType","importExportType$","setMode","selectedMode$","setsExportOptions","Ut","toolToActivateFromOptions","tool","importExportState","openSidenav$","ep","igoStorageService","u2","storageState","storageChange$$","loadActions","buildActions","zoomAuto$","Jr","qu","Ru","toolState","maximize$","p2","ogcFilterWidget","Ur","initWorkspaces","cm","workspace$","wfsActionsService","rowsInMapExtentCheckCondition$","selectOnlyCheckCondition$","featureActionsService","actionMaximize$$","setWorkspaceIsMaximized","activeWorkspace$$","activeWorkspaceWidget$$","activeWorkspaceWidget$","rowsInMapExtentCheckCondition$$","selectOnlyCheckCondition$$","workspaceMaximize$","setActiveWorkspaceById","teardownWorkspaces","Ja","searchOverlayStyle","searchOverlayStyleSelection","searchOverlayStyleFocus","searchResultsGeometryEnabled$","createCustomFilterTermStrategy","activateCustomFilterTermStrategy","deactivateCustomFilterTermStrategy","enableSearch","searchDisabled$","disableSearch","setSearchTerm","searchTerm$","setSearchSettingsChange","searchSettingsChange$","setSelectedResult","selectedResult$","setSearchResultsGeometryStatus","gM","vM","op","EM","osmLayer","searchState","onPointerSummaryStatusChange","onSearchTermChange","searchStore","selectedFeature","onResultFocus","tryAddFeatureToMap","onOpenGoogleMaps","onOpenGoogleStreetView","removeFeatureFromMap","onContextMenuOpen","mapPosition","getCoordinateFromPixel","lonlat","mapBrowser","getBoundingClientRect","scrollY","left","scrollX","onPointerSearch","_loop15","qM","CC","AS","fC","MC","FS","yC","IS","DS","BM","JM","NM","jM","GM","Zu","Iu","Du","Ou","YM","wS","zM","VM","XM","KM","oA","getOutputType","getOutputQueryType","spatialListStore","getOutputToggleSearch","loadThematics","getOutputClearSearch","tryAddFeaturesToMap","itemType","tryAddPointToMap","tryAddLayerToMap","zoomToFeatureExtent","_step69","_internal","selectedFeature$","iA","pA","workspaceState","selectedWorkspace$","workspacePaginator","dA","hA","fA","_A","redirectTo","pathMatch","yA","useHash","vA","mobileQuery","matchMedia","_mobileQueryListener","addEventListener","themeClass","detectOldBrowser","removeEventListener","chrome","firefox","bA","addSvgIconSet","bootstrap","Zo","Io","Na","bootstrapModule"],"sources":["webpack:///$_lazy_route_resources|lazy|groupOptions:%20%7B%7D|namespace%20object","webpack:///dist/core/locale|sync|/^/.*/.json$","webpack:///packages/utils/src/lib/base64.ts","webpack:///packages/utils/src/lib/user-agent.ts","webpack:///packages/utils/src/lib/clipboard.ts","webpack:///packages/utils/src/lib/string-utils.ts","webpack:///packages/utils/src/lib/change.interface.ts","webpack:///packages/utils/src/lib/change.ts","webpack:///packages/utils/src/lib/object-utils.ts","webpack:///packages/utils/src/lib/number-utils.ts","webpack:///packages/utils/src/lib/strenum.ts","webpack:///packages/utils/src/lib/uuid.ts","webpack:///packages/utils/src/lib/watcher.ts","webpack:///packages/core/src/lib/activity/activity.service.ts","webpack:///packages/core/src/lib/activity/activity.interceptor.ts","webpack:///packages/core/src/lib/activity/activity.module.ts","webpack:///packages/core/src/lib/config/version.ts","webpack:///packages/core/src/lib/config/config.service.ts","webpack:///packages/core/src/lib/config/config.provider.ts","webpack:///packages/core/src/lib/config/config.module.ts","webpack:///packages/core/src/lib/language/shared/language.loader.ts","webpack:///packages/core/src/lib/language/shared/language.provider.ts","webpack:///packages/core/src/lib/language/shared/missing-translation.guard.ts","webpack:///packages/core/src/lib/language/language.module.ts","webpack:///packages/core/src/lib/message/message-center/message-center.component.ts","webpack:///packages/core/src/lib/message/message-center/message-center.component.html","webpack:///packages/core/src/lib/message/message.module.ts","webpack:///packages/core/src/lib/language/shared/language.service.ts","webpack:///packages/core/src/lib/message/shared/message.enum.ts","webpack:///packages/core/src/lib/message/shared/message.service.ts","webpack:///packages/core/src/lib/request/error.interceptor.ts","webpack:///packages/core/src/lib/request/error.module.ts","webpack:///packages/core/src/lib/route/route.service.ts","webpack:///packages/core/src/lib/media/media.enum.ts","webpack:///packages/core/src/lib/media/media.service.ts","webpack:///packages/core/src/lib/storage/storage.interface.ts","webpack:///packages/core/src/lib/storage/storage.service.ts","webpack:///packages/core/src/lib/network/network.service.ts","webpack:///packages/common/src/lib/entity/shared/entity.enums.ts","webpack:///packages/common/src/lib/entity/shared/entity.utils.ts","webpack:///packages/common/src/lib/entity/shared/state.ts","webpack:///packages/common/src/lib/entity/shared/view.ts","webpack:///packages/common/src/lib/entity/shared/store.ts","webpack:///packages/common/src/lib/entity/shared/watcher.ts","webpack:///packages/common/src/lib/entity/shared/strategies/strategy.ts","webpack:///packages/common/src/lib/entity/shared/strategies/filter-custom-function.ts","webpack:///packages/common/src/lib/entity/shared/strategies/filter-selection.ts","webpack:///packages/common/src/lib/entity/entity-selector/entity-selector.component.html","webpack:///packages/common/src/lib/entity/entity-selector/entity-selector.component.ts","webpack:///packages/common/src/lib/stop-propagation/stop-propagation.directive.ts","webpack:///packages/common/src/lib/entity/entity-table/entity-table-row.directive.ts","webpack:///packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.component.ts","webpack:///packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.component.html","webpack:///packages/common/src/lib/image/secure-image.pipe.ts","webpack:///packages/common/src/lib/custom-html/custom-html.pipe.ts","webpack:///packages/common/src/lib/entity/entity-table/entity-table.component.html","webpack:///packages/common/src/lib/entity/entity-table/entity-table.component.ts","webpack:///packages/common/src/lib/action/shared/action.enums.ts","webpack:///packages/common/src/lib/action/actionbar/actionbar-item.component.html","webpack:///packages/common/src/lib/action/actionbar/actionbar-item.component.ts","webpack:///packages/common/src/lib/action/actionbar/actionbar.component.html","webpack:///packages/common/src/lib/action/actionbar/actionbar.component.ts","webpack:///packages/common/src/lib/action/actionbar/actionbar.module.ts","webpack:///packages/common/src/lib/action/action.module.ts","webpack:///packages/common/src/lib/badge-icon/badge-icon.directive.ts","webpack:///packages/common/src/lib/badge-icon/badge-icon.module.ts","webpack:///packages/common/src/lib/clickout/clickout.directive.ts","webpack:///packages/common/src/lib/clickout/clickout.module.ts","webpack:///packages/common/src/lib/collapsible/collapse.directive.ts","webpack:///packages/common/src/lib/collapsible/collapsible.component.ts","webpack:///packages/common/src/lib/collapsible/collapsible.component.html","webpack:///packages/common/src/lib/collapsible/collapsible.module.ts","webpack:///packages/common/src/lib/confirm-dialog/confirm-dialog.component.ts","webpack:///packages/common/src/lib/confirm-dialog/confirm-dialog.component.html","webpack:///packages/common/src/lib/confirm-dialog/confirm-dialog.service.ts","webpack:///packages/common/src/lib/confirm-dialog/confirm-dialog.module.ts","webpack:///packages/common/src/lib/context-menu/context-menu.directive.ts","webpack:///packages/common/src/lib/context-menu/context-menu.module.ts","webpack:///packages/common/src/lib/custom-html/custom-html.module.ts","webpack:///packages/common/src/lib/drag-drop/drag-drop.module.ts","webpack:///packages/common/src/lib/dynamic-component/shared/dynamic-component.ts","webpack:///packages/common/src/lib/dynamic-component/shared/dynamic-component.service.ts","webpack:///packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.component.ts","webpack:///packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.component.html","webpack:///packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.module.ts","webpack:///packages/common/src/lib/dynamic-component/dynamic-component.module.ts","webpack:///packages/common/src/lib/flexible/flexible.module.ts","webpack:///packages/common/src/lib/form/form/form.component.ts","webpack:///packages/common/src/lib/form/shared/form.utils.ts","webpack:///packages/common/src/lib/form/form/form.component.html","webpack:///packages/common/src/lib/form/form/form.module.ts","webpack:///packages/common/src/lib/form/shared/form.service.ts","webpack:///packages/common/src/lib/form/shared/form-field.service.ts","webpack:///packages/common/src/lib/form/form-field/form-field.component.html","webpack:///packages/common/src/lib/form/form-field/form-field.component.ts","webpack:///packages/common/src/lib/form/form-field/form-field.module.ts","webpack:///packages/common/src/lib/form/form-group/form-group.component.html","webpack:///packages/common/src/lib/form/form-group/form-group.component.ts","webpack:///packages/common/src/lib/form/form-group/form-group.module.ts","webpack:///packages/common/src/lib/form/form.module.ts","webpack:///packages/common/src/lib/entity/entity-selector/entity-selector.module.ts","webpack:///packages/common/src/lib/stop-propagation/stop-propagation.module.ts","webpack:///packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.module.ts","webpack:///packages/common/src/lib/image/image.module.ts","webpack:///packages/common/src/lib/entity/entity-table/entity-table.module.ts","webpack:///packages/common/src/lib/entity/entity.module.ts","webpack:///packages/common/src/lib/interactive-tour/interactive-tour.loader.ts","webpack:///packages/common/src/lib/interactive-tour/interactive-tour.service.ts","webpack:///packages/common/src/lib/tool/shared/toolbox.ts","webpack:///packages/common/src/lib/tool/shared/tool.service.ts","webpack:///packages/common/src/lib/interactive-tour/interactive-tour.component.html","webpack:///packages/common/src/lib/interactive-tour/interactive-tour.component.ts","webpack:///packages/common/src/lib/interactive-tour/interactive-tour.module.ts","webpack:///packages/common/src/lib/keyvalue/keyvalue.pipe.ts","webpack:///packages/common/src/lib/keyvalue/keyvalue.module.ts","webpack:///packages/common/src/lib/list/list-item.directive.ts","webpack:///packages/common/src/lib/list/list.component.ts","webpack:///packages/common/src/lib/list/list.component.html","webpack:///packages/common/src/lib/list/list.module.ts","webpack:///packages/common/src/lib/panel/panel.component.html","webpack:///packages/common/src/lib/panel/panel.component.ts","webpack:///packages/common/src/lib/panel/panel.module.ts","webpack:///packages/common/src/lib/spinner/spinner.component.ts","webpack:///packages/common/src/lib/spinner/spinner.component.html","webpack:///packages/common/src/lib/spinner/spinner-activity.directive.ts","webpack:///packages/common/src/lib/spinner/spinner.module.ts","webpack:///packages/common/src/lib/table/table-datasource.ts","webpack:///packages/common/src/lib/table/table-action-color.enum.ts","webpack:///packages/common/src/lib/table/table.component.html","webpack:///packages/common/src/lib/table/table.component.ts","webpack:///packages/common/src/lib/table/table.module.ts","webpack:///packages/common/src/lib/action/shared/store.ts","webpack:///packages/common/src/lib/tool/shared/toolbox.enums.ts","webpack:///packages/common/src/lib/tool/toolbox/toolbox.animation.ts","webpack:///packages/common/src/lib/tool/toolbox/toolbox.component.html","webpack:///packages/common/src/lib/tool/toolbox/toolbox.component.ts","webpack:///packages/common/src/lib/tool/toolbox/toolbox.module.ts","webpack:///packages/common/src/lib/tool/tool.module.ts","webpack:///packages/common/src/lib/widget/widget-outlet/widget-outlet.component.html","webpack:///packages/common/src/lib/widget/widget-outlet/widget-outlet.component.ts","webpack:///packages/common/src/lib/widget/widget-outlet/widget-outlet.module.ts","webpack:///packages/common/src/lib/widget/shared/widget.service.ts","webpack:///packages/common/src/lib/widget/widget.module.ts","webpack:///packages/common/src/lib/workspace/workspace-selector/workspace-selector.component.ts","webpack:///packages/common/src/lib/workspace/workspace-selector/workspace-selector.component.html","webpack:///packages/common/src/lib/workspace/workspace-selector/workspace-selector.module.ts","webpack:///packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.component.html","webpack:///packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.component.ts","webpack:///packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.module.ts","webpack:///packages/common/src/lib/workspace/workspace.module.ts","webpack:///packages/common/src/lib/table/table-database.ts","webpack:///packages/common/src/lib/tool/shared/tool-component.ts","webpack:///packages/common/src/lib/workspace/shared/store.ts","webpack:///packages/common/src/lib/workspace/shared/workspace.ts","webpack:///demo/src/app/core/home/home-routing.module.ts","webpack:///demo/src/app/core/home/home.component.ts","webpack:///demo/src/app/core/home/home.component.html","webpack:///demo/src/app/core/home/home.module.ts","webpack:///demo/src/app/core/activity/activity-routing.module.ts","webpack:///demo/src/app/core/activity/activity.component.ts","webpack:///demo/src/app/core/activity/activity.component.html","webpack:///demo/src/app/core/activity/activity.module.ts","webpack:///demo/src/environments/environment.prod.ts","webpack:///demo/src/app/core/config/config-routing.module.ts","webpack:///demo/src/app/core/config/config.component.ts","webpack:///demo/src/app/core/config/config.component.html","webpack:///demo/src/app/core/config/config.module.ts","webpack:///demo/src/app/core/language/language-routing.module.ts","webpack:///demo/src/app/core/language/language.component.ts","webpack:///demo/src/app/core/language/language.component.html","webpack:///demo/src/app/core/language/language.module.ts","webpack:///demo/src/app/core/media/media-routing.module.ts","webpack:///demo/src/app/core/media/media.component.ts","webpack:///demo/src/app/core/media/media.component.html","webpack:///demo/src/app/core/media/media.module.ts","webpack:///demo/src/app/core/message/message-routing.module.ts","webpack:///demo/src/app/core/message/message.component.ts","webpack:///demo/src/app/core/message/message.component.html","webpack:///demo/src/app/core/message/message.module.ts","webpack:///demo/src/app/core/request/request-routing.module.ts","webpack:///demo/src/app/core/request/request.component.ts","webpack:///demo/src/app/core/request/request.component.html","webpack:///demo/src/app/core/request/request.module.ts","webpack:///demo/src/app/common/action/action.component.html","webpack:///demo/src/app/common/action/action-routing.module.ts","webpack:///demo/src/app/common/action/action.component.ts","webpack:///demo/src/app/common/action/action.module.ts","webpack:///demo/src/app/common/dynamic-component/dynamic-component.component.ts","webpack:///demo/src/app/common/dynamic-component/dynamic-component-routing.module.ts","webpack:///demo/src/app/common/dynamic-component/dynamic-component.component.html","webpack:///demo/src/app/common/dynamic-component/dynamic-component.module.ts","webpack:///demo/src/app/common/entity-table/entity-table-routing.module.ts","webpack:///demo/src/app/common/entity-table/entity-table.component.ts","webpack:///demo/src/app/common/entity-table/entity-table.component.html","webpack:///demo/src/app/common/entity-table/entity-table.module.ts","webpack:///demo/src/app/common/entity-selector/entity-selector.component.html","webpack:///demo/src/app/common/entity-selector/entity-selector-routing.module.ts","webpack:///demo/src/app/common/entity-selector/entity-selector.component.ts","webpack:///demo/src/app/common/entity-selector/entity-selector.module.ts","webpack:///demo/src/app/common/form/form.component.html","webpack:///demo/src/app/common/form/form-routing.module.ts","webpack:///demo/src/app/common/form/form.component.ts","webpack:///demo/src/app/common/form/form.module.ts","webpack:///demo/src/app/common/table/table-routing.module.ts","webpack:///demo/src/app/common/table/table.component.ts","webpack:///demo/src/app/common/table/table.component.html","webpack:///demo/src/app/common/table/table.module.ts","webpack:///demo/src/app/common/tool/tool.component.html","webpack:///demo/src/app/common/tool/tool.component.ts","webpack:///demo/src/app/common/tool/tool-routing.module.ts","webpack:///demo/src/app/common/tool/tool.module.ts","webpack:///demo/src/app/common/widget/widget.component.ts","webpack:///demo/src/app/common/widget/widget-routing.module.ts","webpack:///demo/src/app/common/widget/widget.component.html","webpack:///demo/src/app/common/widget/widget.module.ts","webpack:///packages/auth/src/lib/shared/token.service.ts","webpack:///packages/auth/src/lib/shared/auth.service.ts","webpack:///packages/auth/src/lib/auth-form/auth-google.component.ts","webpack:///packages/auth/src/lib/auth-form/auth-google.component.html","webpack:///packages/auth/src/lib/auth-form/auth-microsoft.component.ts","webpack:///packages/auth/src/lib/auth-form/auth-microsoft.component.html","webpack:///packages/auth/src/lib/shared/auth-msalServiceb2c.service..ts","webpack:///packages/auth/src/lib/shared/auth-msalBroadcastServiceb2c.service.ts","webpack:///packages/auth/src/lib/auth-form/auth-microsoftb2c.component.ts","webpack:///packages/auth/src/lib/auth-form/auth-microsoftb2c.component.html","webpack:///packages/auth/src/lib/auth-form/auth-facebook.component.ts","webpack:///packages/auth/src/lib/auth-form/auth-facebook.component.html","webpack:///packages/auth/src/lib/auth-form/auth-intern.component.html","webpack:///packages/auth/src/lib/auth-form/auth-intern.component.ts","webpack:///packages/auth/src/lib/auth-form/auth-form.component.html","webpack:///packages/auth/src/lib/auth-form/auth-form.component.ts","webpack:///packages/auth/src/lib/shared/auth.interceptor.ts","webpack:///packages/auth/src/lib/shared/auth-microsoft.provider.ts","webpack:///packages/auth/src/lib/shared/storage.service.ts","webpack:///packages/auth/src/lib/auth.module.ts","webpack:///demo/src/app/auth/auth-form/auth-form-routing.module.ts","webpack:///demo/src/app/auth/auth-form/auth-form.component.ts","webpack:///demo/src/app/auth/auth-form/auth-form.component.html","webpack:///demo/src/app/auth/auth-form/auth-form.module.ts","webpack:///packages/geo/src/lib/metadata/shared/metadata.service.ts","webpack:///packages/geo/src/lib/metadata/metadata-button/metadata-button.component.html","webpack:///packages/geo/src/lib/metadata/metadata-button/metadata-abstract.component.html","webpack:///packages/geo/src/lib/metadata/metadata-button/metadata-button.component.ts","webpack:///packages/geo/src/lib/metadata/metadata.module.ts","webpack:///packages/geo/src/lib/feature/shared/feature.enums.ts","webpack:///packages/geo/src/lib/layer/utils/image-watcher.ts","webpack:///packages/geo/src/lib/layer/shared/layers/layer.interface.ts","webpack:///packages/geo/src/lib/utils/id-generator.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/datasource.ts","webpack:///packages/geo/src/lib/filter/shared/ogc-filter.enum.ts","webpack:///packages/geo/src/lib/filter/shared/ogc-filter.ts","webpack:///packages/geo/src/lib/query/shared/query.enums.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/wms-wfs.utils.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/wms-datasource.ts","webpack:///packages/geo/src/lib/layer/utils/layerSync-watcher.ts","webpack:///packages/geo/src/lib/layer/utils/tile-watcher.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/feature-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/cluster-datasource.ts","webpack:///packages/geo/src/lib/layer/utils/vector-watcher.ts","webpack:///packages/geo/src/lib/map/shared/map.utils.ts","webpack:///packages/geo/src/lib/layer/shared/layers/layer.ts","webpack:///packages/geo/src/lib/layer/shared/layers/vector-layer.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/osm-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/xyz-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/wfs-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/wfs.service.ts","webpack:///packages/geo/src/lib/datasource/utils/tilegrid.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/wmts-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/carto-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/arcgisrest-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/imagearcgisrest-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/tilearcgisrest-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/tiledebug-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/websocket-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/mvt-datasource.ts","webpack:///packages/geo/src/lib/datasource/utils/esri-style-generator.ts","webpack:///packages/geo/src/lib/filter/shared/time-filter.enum.ts","webpack:///packages/geo/src/lib/map/shared/map.service.ts","webpack:///packages/geo/src/lib/datasource/shared/capabilities.service.ts","webpack:///packages/geo/src/lib/map/shared/projection.service.ts","webpack:///packages/geo/src/lib/datasource/shared/datasource.service.ts","webpack:///packages/geo/src/lib/feature/shared/feature.utils.ts","webpack:///packages/geo/src/lib/feature/shared/store.ts","webpack:///packages/geo/src/lib/feature/shared/strategies/in-map-extent.ts","webpack:///packages/geo/src/lib/feature/shared/strategies/in-map-resolution.ts","webpack:///packages/geo/src/lib/feature/shared/strategies/loading.ts","webpack:///packages/geo/src/lib/feature/shared/strategies/loading-layer.ts","webpack:///packages/geo/src/lib/feature/shared/strategies/selection.ts","webpack:///packages/geo/src/lib/feature/shared/strategies.utils.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay-marker-style.utils.ts","webpack:///packages/geo/src/lib/layer/shared/style.service.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay.utils.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay.ts","webpack:///packages/geo/src/lib/map/utils/layer-watcher.ts","webpack:///packages/geo/src/lib/map/shared/map.enums.ts","webpack:///packages/geo/src/lib/map/shared/controllers/view.ts","webpack:///packages/geo/src/lib/map/shared/controllers/controller.ts","webpack:///packages/geo/src/lib/map/shared/map.ts","webpack:///packages/geo/src/lib/map/map-browser/map-browser.component.ts","webpack:///packages/geo/src/lib/map/map-browser/map-browser.component.html","webpack:///packages/geo/src/lib/map/shared/map-pointer-position.directive.ts","webpack:///packages/geo/src/lib/layer/shared/layers/image-layer.ts","webpack:///packages/geo/src/lib/layer/shared/layers/tile-layer.ts","webpack:///packages/geo/src/lib/layer/shared/layers/vectortile-layer.ts","webpack:///packages/geo/src/lib/map/shared/hover-feature.directive.ts","webpack:///packages/geo/src/lib/map/zoom-button/zoom-button.component.ts","webpack:///packages/geo/src/lib/map/zoom-button/zoom-button.component.html","webpack:///packages/geo/src/lib/map/geolocate-button/geolocate-button.component.ts","webpack:///packages/geo/src/lib/map/geolocate-button/geolocate-button.component.html","webpack:///packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.html","webpack:///packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.ts","webpack:///packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.animation.ts","webpack:///packages/geo/src/lib/layer/shared/layer.service.ts","webpack:///packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.html","webpack:///packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.ts","webpack:///packages/geo/src/lib/map/rotation-button/rotation-button.component.html","webpack:///packages/geo/src/lib/map/rotation-button/rotation-button.component.ts","webpack:///packages/geo/src/lib/catalog/shared/catalog.enum.ts","webpack:///packages/geo/src/lib/catalog/shared/catalog.abstract.ts","webpack:///packages/geo/src/lib/query/shared/query.service.ts","webpack:///packages/geo/src/lib/query/shared/query.utils.ts","webpack:///packages/geo/src/lib/query/shared/query.directive.ts","webpack:///packages/geo/src/lib/search/shared/sources/source.ts","webpack:///packages/geo/src/lib/query/shared/query-search-source.ts","webpack:///packages/geo/src/lib/utils/googleLinks.ts","webpack:///packages/geo/src/lib/utils/osmLinks.ts","webpack:///packages/geo/src/lib/catalog/shared/catalog.service.ts","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.html","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.ts","webpack:///packages/geo/src/lib/layer/layer-legend/layer-legend.component.html","webpack:///packages/geo/src/lib/layer/layer-legend/layer-legend.component.ts","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.html","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.ts","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.html","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.ts","webpack:///packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.service.ts","webpack:///packages/geo/src/lib/layer/layer-item/layer-item.component.html","webpack:///packages/geo/src/lib/layer/layer-item/layer-item.component.ts","webpack:///packages/geo/src/lib/layer/layer-list/layer-list.enum.ts","webpack:///packages/geo/src/lib/layer/layer-list/layer-list.component.html","webpack:///packages/geo/src/lib/layer/layer-list/layer-list.component.ts","webpack:///packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.html","webpack:///packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.ts","webpack:///packages/geo/src/lib/layer/layer-list/layer-list-binding.directive.ts","webpack:///packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.html","webpack:///packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.ts","webpack:///packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.html","webpack:///packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.ts","webpack:///packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.ts","webpack:///packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.html","webpack:///packages/geo/src/lib/layer/layer.module.ts","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser.module.ts","webpack:///packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.html","webpack:///packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.ts","webpack:///packages/geo/src/lib/catalog/catalog-library/catalog-library.component.html","webpack:///packages/geo/src/lib/catalog/catalog-library/catalog-library.component.ts","webpack:///packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.html","webpack:///packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.ts","webpack:///packages/geo/src/lib/catalog/catalog-library/catalog-library.module.ts","webpack:///packages/geo/src/lib/catalog/catalog.module.ts","webpack:///packages/geo/src/lib/filter/shared/filterable-datasource.pipe.ts","webpack:///packages/geo/src/lib/filter/shared/time-filter.service.ts","webpack:///packages/geo/src/lib/filter/shared/ogc-filter.service.ts","webpack:///packages/geo/src/lib/filter/shared/spatial-filter.enum.ts","webpack:///packages/geo/src/lib/filter/shared/spatial-filter.service.ts","webpack:///packages/geo/src/lib/download/shared/download.service.ts","webpack:///packages/geo/src/lib/download/download-button/download-button.component.html","webpack:///packages/geo/src/lib/download/download-button/download-button.component.ts","webpack:///packages/geo/src/lib/download/download.module.ts","webpack:///packages/geo/src/lib/feature/feature-details/feature-details.component.html","webpack:///packages/geo/src/lib/feature/feature-details/feature-details.component.ts","webpack:///packages/geo/src/lib/draw/shared/draw.enum.ts","webpack:///packages/geo/src/lib/geometry/shared/geometry.utils.ts","webpack:///packages/geo/src/lib/geometry/shared/geometry.errors.ts","webpack:///packages/geo/src/lib/geometry/shared/controls/draw.ts","webpack:///packages/geo/src/lib/draw/draw/draw-popup.component.ts","webpack:///packages/geo/src/lib/draw/draw/draw-popup.component.html","webpack:///packages/geo/src/lib/draw/draw/draw-shorcuts.component.ts","webpack:///packages/geo/src/lib/draw/draw/draw-shorcuts.component.html","webpack:///packages/geo/src/lib/measure/shared/measure.enum.ts","webpack:///packages/geo/src/lib/measure/shared/measure.utils.ts","webpack:///packages/geo/src/lib/draw/shared/draw.utils.ts","webpack:///packages/geo/src/lib/draw/shared/draw-style.service.ts","webpack:///packages/geo/src/lib/draw/shared/draw-icon.service.ts","webpack:///packages/geo/src/lib/draw/draw/draw.component.html","webpack:///packages/geo/src/lib/draw/draw/draw.component.ts","webpack:///packages/geo/src/lib/draw/draw/draw.module.ts","webpack:///packages/geo/src/lib/feature/feature-details/feature-details.module.ts","webpack:///packages/geo/src/lib/feature/feature-form/feature-form.module.ts","webpack:///packages/geo/src/lib/feature/feature.module.ts","webpack:///packages/geo/src/lib/geometry/shared/controls/modify.ts","webpack:///packages/geo/src/lib/layer/shared/layer.enums.ts","webpack:///packages/geo/src/lib/measure/measurer/measurer-dialog.component.html","webpack:///packages/geo/src/lib/measure/measurer/measurer-dialog.component.ts","webpack:///packages/geo/src/lib/measure/measurer/measurer.component.html","webpack:///packages/geo/src/lib/measure/measurer/measurer.component.ts","webpack:///packages/geo/src/lib/measure/measurer/measure-format.pipe.ts","webpack:///packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.ts","webpack:///packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.html","webpack:///packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.module.ts","webpack:///packages/geo/src/lib/geometry/geometry.module.ts","webpack:///packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.html","webpack:///packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.ts","webpack:///packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.html","webpack:///packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.ts","webpack:///packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.html","webpack:///packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.ts","webpack:///packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.html","webpack:///packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.ts","webpack:///packages/geo/src/lib/wkt/shared/wkt.service.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.html","webpack:///packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.html","webpack:///packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.html","webpack:///packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.html","webpack:///packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.html","webpack:///packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.ts","webpack:///packages/geo/src/lib/filter/shared/ogc-filter-time.service.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.html","webpack:///packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.ts","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.html","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.ts","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.html","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.ts","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.html","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.html","webpack:///packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.html","webpack:///packages/geo/src/lib/filter/filter.module.ts","webpack:///packages/geo/src/lib/import-export/shared/export.errors.ts","webpack:///packages/geo/src/lib/import-export/shared/export.type.ts","webpack:///packages/geo/src/lib/import-export/shared/export.service.ts","webpack:///packages/utils/src/lib/file.ts","webpack:///packages/geo/src/lib/import-export/shared/import.utils.ts","webpack:///packages/geo/src/lib/import-export/shared/import.errors.ts","webpack:///packages/geo/src/lib/import-export/shared/import.service.ts","webpack:///packages/geo/src/lib/import-export/style-list/style-list.service.ts","webpack:///packages/geo/src/lib/import-export/import-export/import-export.component.html","webpack:///packages/geo/src/lib/import-export/import-export/import-export.component.ts","webpack:///packages/geo/src/lib/map/shared/projection.utils.ts","webpack:///packages/geo/src/lib/import-export/shared/export.utils.ts","webpack:///packages/geo/src/lib/import-export/style-list/style-list.provider.ts","webpack:///packages/geo/src/lib/import-export/style-list/style-list.module.ts","webpack:///packages/geo/src/lib/import-export/import-export.module.ts","webpack:///packages/geo/src/lib/map/map.module.ts","webpack:///packages/geo/src/lib/measure/measurer/measurer-item.component.html","webpack:///packages/geo/src/lib/measure/measurer/measurer-item.component.ts","webpack:///packages/geo/src/lib/measure/measurer/measurer.module.ts","webpack:///packages/geo/src/lib/measure/measure.module.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay.enum.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay.service.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay.directive.ts","webpack:///packages/geo/src/lib/overlay/overlay.module.ts","webpack:///packages/geo/src/lib/print/shared/print.service.ts","webpack:///packages/geo/src/lib/layer/utils/outputLegend.ts","webpack:///packages/geo/src/lib/print/shared/print.type.ts","webpack:///packages/geo/src/lib/print/print-form/print-form.component.html","webpack:///packages/geo/src/lib/print/print-form/print-form.component.ts","webpack:///packages/geo/src/lib/print/print/print.component.ts","webpack:///packages/geo/src/lib/print/print/print.component.html","webpack:///packages/geo/src/lib/print/print.module.ts","webpack:///packages/geo/src/lib/query/shared/query-search-source.providers.ts","webpack:///packages/geo/src/lib/query/query.module.ts","webpack:///packages/geo/src/lib/directions/shared/directions-source.service.ts","webpack:///packages/geo/src/lib/directions/shared/directions.enum.ts","webpack:///packages/geo/src/lib/directions/shared/directions.utils.ts","webpack:///packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.html","webpack:///packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.ts","webpack:///packages/geo/src/lib/directions/shared/directions.service.ts","webpack:///packages/geo/src/lib/search/shared/search.utils.ts","webpack:///packages/geo/src/lib/search/shared/search-source.service.ts","webpack:///packages/geo/src/lib/search/shared/search.service.ts","webpack:///packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.html","webpack:///packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.ts","webpack:///packages/geo/src/lib/directions/directions-results/directions-results.component.html","webpack:///packages/geo/src/lib/directions/directions-results/directions-results.component.ts","webpack:///packages/geo/src/lib/directions/directions.component.ts","webpack:///packages/geo/src/lib/directions/directions.component.html","webpack:///packages/geo/src/lib/directions/directions.module.ts","webpack:///packages/geo/src/lib/search/shared/search-source-service.providers.ts","webpack:///packages/geo/src/lib/search/shared/sources/icherche.ts","webpack:///packages/geo/src/lib/search/shared/sources/icherche.providers.ts","webpack:///packages/geo/src/lib/search/shared/sources/coordinates.ts","webpack:///packages/geo/src/lib/search/shared/sources/coordinates.providers.ts","webpack:///packages/geo/src/lib/search/shared/sources/ilayer.ts","webpack:///packages/geo/src/lib/search/shared/sources/ilayer.providers.ts","webpack:///packages/geo/src/lib/search/shared/search.enums.ts","webpack:///packages/geo/src/lib/search/search-selector/search-selector.component.html","webpack:///packages/geo/src/lib/search/search-selector/search-selector.component.ts","webpack:///packages/geo/src/lib/search/search-selector/search-selector.module.ts","webpack:///packages/geo/src/lib/search/search-settings/search-settings.component.html","webpack:///packages/geo/src/lib/search/search-settings/search-settings.component.ts","webpack:///packages/geo/src/lib/search/search-settings/search-settings.module.ts","webpack:///packages/geo/src/lib/search/search-bar/search-bar.component.html","webpack:///packages/geo/src/lib/search/search-bar/search-bar.component.ts","webpack:///packages/geo/src/lib/search/search-bar/search-bar.module.ts","webpack:///packages/geo/src/lib/search/search-results/search-results-item.component.html","webpack:///packages/geo/src/lib/search/search-results/search-results-item.component.ts","webpack:///packages/geo/src/lib/search/search-results/search-results.component.html","webpack:///packages/geo/src/lib/search/search-results/search-results.component.ts","webpack:///packages/geo/src/lib/search/search-results/search-results-add-button.component.html","webpack:///packages/geo/src/lib/search/search-results/search-results-add-button.component.ts","webpack:///packages/geo/src/lib/search/search-results/search-results.module.ts","webpack:///packages/geo/src/lib/search/shared/search-pointer-summary.directive.ts","webpack:///packages/geo/src/lib/search/search.module.ts","webpack:///packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.ts","webpack:///packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.html","webpack:///packages/geo/src/lib/workspace/widgets/widgets.ts","webpack:///packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.module.ts","webpack:///packages/geo/src/lib/workspace/shared/wfs-workspace.ts","webpack:///packages/geo/src/lib/workspace/shared/wfs-workspace.service.ts","webpack:///packages/geo/src/lib/workspace/shared/wms-workspace.service.ts","webpack:///packages/geo/src/lib/workspace/shared/feature-workspace.ts","webpack:///packages/geo/src/lib/workspace/shared/feature-workspace.service.ts","webpack:///packages/geo/src/lib/workspace/workspace-selector/workspace-selector.directive.ts","webpack:///packages/geo/src/lib/workspace/workspace-selector/workspace-selector.module.ts","webpack:///packages/geo/src/lib/workspace/workspace-updator/workspace-updator.module.ts","webpack:///packages/geo/src/lib/workspace/workspace.module.ts","webpack:///packages/geo/src/lib/directions/shared/store.ts","webpack:///packages/geo/src/lib/directions/directions-sources/osrm-directions-source.ts","webpack:///packages/geo/src/lib/directions/directions-sources/directions-source.provider.ts","webpack:///packages/geo/src/lib/search/shared/sources/cadastre.ts","webpack:///packages/geo/src/lib/search/shared/sources/cadastre.providers.ts","webpack:///packages/geo/src/lib/search/shared/sources/nominatim.ts","webpack:///packages/geo/src/lib/search/shared/sources/nominatim.providers.ts","webpack:///packages/geo/src/lib/search/shared/sources/storedqueries.ts","webpack:///packages/geo/src/lib/search/shared/sources/storedqueries.providers.ts","webpack:///packages/geo/src/lib/workspace/shared/workspace.utils.ts","webpack:///demo/src/app/geo/simple-map/simple-map.component.html","webpack:///demo/src/app/geo/simple-map/simple-map-routing.module.ts","webpack:///demo/src/app/geo/simple-map/simple-map.component.ts","webpack:///demo/src/app/geo/simple-map/simple-map.module.ts","webpack:///demo/src/app/geo/layer/layer.component.html","webpack:///demo/src/app/geo/layer/layer-routing.module.ts","webpack:///demo/src/app/geo/layer/layer.component.ts","webpack:///demo/src/app/geo/layer/layer.module.ts","webpack:///demo/src/app/geo/legend/legend-routing.module.ts","webpack:///demo/src/app/geo/legend/legend.component.ts","webpack:///demo/src/app/geo/legend/legend.component.html","webpack:///demo/src/app/geo/legend/legend.module.ts","webpack:///demo/src/app/geo/overlay/overlay-routing.module.ts","webpack:///demo/src/app/geo/overlay/overlay.component.ts","webpack:///demo/src/app/geo/overlay/overlay.component.html","webpack:///demo/src/app/geo/overlay/overlay.module.ts","webpack:///demo/src/app/geo/geometry/geometry.component.html","webpack:///demo/src/app/geo/geometry/geometry-routing.module.ts","webpack:///demo/src/app/geo/geometry/geometry.component.ts","webpack:///demo/src/app/geo/geometry/geometry.module.ts","webpack:///demo/src/app/geo/feature/feature-routing.module.ts","webpack:///demo/src/app/geo/feature/feature.component.ts","webpack:///demo/src/app/geo/feature/feature.component.html","webpack:///demo/src/app/geo/feature/feature.module.ts","webpack:///demo/src/app/geo/hover/hover-routing.module.ts","webpack:///demo/src/app/geo/hover/hover.component.ts","webpack:///demo/src/app/geo/hover/hover.component.html","webpack:///demo/src/app/geo/hover/hover.module.ts","webpack:///demo/src/app/geo/measure/measure-routing.module.ts","webpack:///demo/src/app/geo/measure/measure.component.ts","webpack:///demo/src/app/geo/measure/measure.component.html","webpack:///demo/src/app/geo/measure/measure.module.ts","webpack:///demo/src/app/geo/draw/draw-routing.module.ts","webpack:///demo/src/app/geo/draw/draw.component.ts","webpack:///demo/src/app/geo/draw/draw.component.html","webpack:///demo/src/app/geo/draw/draw.module.ts","webpack:///demo/src/app/geo/query/query.component.html","webpack:///demo/src/app/geo/query/query-routing.module.ts","webpack:///demo/src/app/geo/query/query.component.ts","webpack:///demo/src/app/geo/query/query.module.ts","webpack:///demo/src/app/geo/catalog/catalog-routing.module.ts","webpack:///demo/src/app/geo/catalog/catalog.component.ts","webpack:///demo/src/app/geo/catalog/catalog.component.html","webpack:///demo/src/app/geo/catalog/catalog.module.ts","webpack:///packages/context/src/lib/context-import-export/shared/context-export.errors.ts","webpack:///packages/context/src/lib/context-import-export/shared/context-import.errors.ts","webpack:///packages/context/src/lib/context-manager/shared/context.enum.ts","webpack:///packages/context/src/lib/context-manager/shared/context.service.ts","webpack:///packages/context/src/lib/context-import-export/context-import-export.module.ts","webpack:///packages/context/src/lib/context-manager/shared/map-context.directive.ts","webpack:///packages/context/src/lib/context-manager/shared/layer-context.directive.ts","webpack:///packages/context/src/lib/context-import-export/shared/context-import.utils.ts","webpack:///packages/context/src/lib/context-manager/context-list/context-list.enum.ts","webpack:///packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.ts","webpack:///packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.html","webpack:///packages/context/src/lib/context-manager/context-item/context-item.component.html","webpack:///packages/context/src/lib/context-manager/context-item/context-item.component.ts","webpack:///packages/context/src/lib/context-manager/context-list/context-list.component.html","webpack:///packages/context/src/lib/context-manager/context-list/context-list.component.ts","webpack:///packages/context/src/lib/context-manager/context-list/context-list-binding.directive.ts","webpack:///packages/context/src/lib/context-map-button/poi-button/shared/poi.service.ts","webpack:///packages/context/src/lib/context-map-button/context-map-button.module.ts","webpack:///packages/context/src/lib/context-manager/context-manager.module.ts","webpack:///packages/integration/src/lib/import-export/import-export.state.ts","webpack:///packages/integration/src/lib/tool/tool.state.ts","webpack:///packages/integration/src/lib/workspace/shared/workspace.utils.ts","webpack:///packages/integration/src/lib/storage/storage.state.ts","webpack:///packages/integration/src/lib/workspace/shared/feature-actions.service.ts","webpack:///packages/integration/src/lib/workspace/shared/wfs-actions.service.ts","webpack:///packages/integration/src/lib/workspace/workspace.state.ts","webpack:///packages/integration/src/lib/search/search.state.ts","webpack:///packages/integration/src/lib/search/search-bar/search-bar.module.ts","webpack:///packages/integration/src/lib/search/search-results-tool/search-results-tool.module.ts","webpack:///packages/integration/src/lib/search/search.module.ts","webpack:///demo/src/app/geo/search/search.component.html","webpack:///demo/src/app/geo/search/search-routing.module.ts","webpack:///demo/src/app/geo/search/search.component.ts","webpack:///demo/src/app/geo/search/search.module.ts","webpack:///demo/src/app/geo/print/print-routing.module.ts","webpack:///demo/src/app/geo/print/print.component.ts","webpack:///demo/src/app/geo/print/print.component.html","webpack:///demo/src/app/geo/print/print.module.ts","webpack:///demo/src/app/geo/import-export/import-export-routing.module.ts","webpack:///demo/src/app/geo/import-export/import-export.component.ts","webpack:///demo/src/app/geo/import-export/import-export.component.html","webpack:///demo/src/app/geo/import-export/import-export.module.ts","webpack:///demo/src/app/geo/directions/directions-routing.module.ts","webpack:///demo/src/app/geo/directions/directions.component.ts","webpack:///demo/src/app/geo/directions/directions.component.html","webpack:///demo/src/app/geo/directions/directions.module.ts","webpack:///demo/src/app/geo/time-filter/time-filter-routing.module.ts","webpack:///demo/src/app/geo/time-filter/time-filter.component.ts","webpack:///demo/src/app/geo/time-filter/time-filter.component.html","webpack:///demo/src/app/geo/time-filter/time-filter.module.ts","webpack:///demo/src/app/geo/ogc-filter/ogc-filter-routing.module.ts","webpack:///demo/src/app/geo/ogc-filter/ogc-filter.component.ts","webpack:///demo/src/app/geo/ogc-filter/ogc-filter.component.html","webpack:///demo/src/app/geo/ogc-filter/ogc-filter.module.ts","webpack:///demo/src/app/geo/spatial-filter/spatial-filter.component.html","webpack:///demo/src/app/geo/spatial-filter/spatial-filter-routing.module.ts","webpack:///demo/src/app/geo/spatial-filter/spatial-filter.component.ts","webpack:///demo/src/app/geo/spatial-filter/spatial-filter.module.ts","webpack:///demo/src/app/geo/workspace/workspace.component.html","webpack:///demo/src/app/geo/workspace/workspace-routing.module.ts","webpack:///demo/src/app/geo/workspace/workspace.component.ts","webpack:///demo/src/app/geo/workspace/workspace.module.ts","webpack:///demo/src/app/context/context/context.component.html","webpack:///demo/src/app/context/context/context-routing.module.ts","webpack:///demo/src/app/context/context/context.component.ts","webpack:///demo/src/app/context/context/context.module.ts","webpack:///demo/src/app/app-routing.module.ts","webpack:///demo/src/app/app.component.ts","webpack:///demo/src/app/app.component.html","webpack:///demo/src/app/app.module.ts","webpack:///demo/src/main.ts","webpack:///node_modules/moment/locale|sync|/^/.*$"],"sourcesContent":["function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 98255;\nmodule.exports = webpackEmptyAsyncContext;","var map = {\n\t\"./en.auth.json\": 50257,\n\t\"./en.common.json\": 35488,\n\t\"./en.context.json\": 88952,\n\t\"./en.core.json\": 63154,\n\t\"./en.geo.json\": 10711,\n\t\"./en.integration.json\": 32766,\n\t\"./en.json\": 10503,\n\t\"./fr.auth.json\": 8555,\n\t\"./fr.common.json\": 20551,\n\t\"./fr.context.json\": 68079,\n\t\"./fr.core.json\": 5415,\n\t\"./fr.geo.json\": 27268,\n\t\"./fr.integration.json\": 63031,\n\t\"./fr.json\": 65962\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 36438;","/* eslint-disable */\n\nconst ALPHA =\n  'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\nexport class Base64 {\n  private static PADCHAR: string = '=';\n  private static ALPHA: string = ALPHA;\n\n  private static getByte(s: string, i: number): number {\n    const x = s.charCodeAt(i);\n    return x;\n  }\n\n  private static getByte64(s: string, i: number): number {\n    const idx = this.ALPHA.indexOf(s.charAt(i));\n    return idx;\n  }\n\n  public static decode(s: string): string {\n    let pads = 0,\n      i,\n      b10,\n      imax = s.length,\n      x = [];\n\n    s = String(s);\n\n    if (imax === 0) {\n      return s;\n    }\n\n    if (s.charAt(imax - 1) === this.PADCHAR) {\n      pads = 1;\n      if (s.charAt(imax - 2) === this.PADCHAR) {\n        pads = 2;\n      }\n      imax -= 4;\n    }\n\n    for (i = 0; i < imax; i += 4) {\n      b10 =\n        (this.getByte64(s, i) << 18) |\n        (this.getByte64(s, i + 1) << 12) |\n        (this.getByte64(s, i + 2) << 6) |\n        this.getByte64(s, i + 3);\n      x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255, b10 & 255));\n    }\n\n    switch (pads) {\n      case 1:\n        b10 =\n          (this.getByte64(s, i) << 18) |\n          (this.getByte64(s, i + 1) << 12) |\n          (this.getByte64(s, i + 2) << 6);\n        x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255));\n        break;\n      case 2:\n        b10 = (this.getByte64(s, i) << 18) | (this.getByte64(s, i + 1) << 12);\n        x.push(String.fromCharCode(b10 >> 16));\n        break;\n    }\n\n    return x.join('');\n  }\n\n  public static encode(s: string): string {\n    s = String(s);\n\n    let i,\n      b10,\n      x = [],\n      imax = s.length - s.length % 3;\n\n    if (s.length === 0) {\n      return s;\n    }\n\n    for (i = 0; i < imax; i += 3) {\n      b10 =\n        (this.getByte(s, i) << 16) |\n        (this.getByte(s, i + 1) << 8) |\n        this.getByte(s, i + 2);\n      x.push(this.ALPHA.charAt(b10 >> 18));\n      x.push(this.ALPHA.charAt((b10 >> 12) & 63));\n      x.push(this.ALPHA.charAt((b10 >> 6) & 63));\n      x.push(this.ALPHA.charAt(b10 & 63));\n    }\n\n    switch (s.length - imax) {\n      case 1:\n        b10 = this.getByte(s, i) << 16;\n        x.push(\n          this.ALPHA.charAt(b10 >> 18) +\n            this.ALPHA.charAt((b10 >> 12) & 63) +\n            this.PADCHAR +\n            this.PADCHAR\n        );\n        break;\n      case 2:\n        b10 = (this.getByte(s, i) << 16) | (this.getByte(s, i + 1) << 8);\n        x.push(\n          this.ALPHA.charAt(b10 >> 18) +\n            this.ALPHA.charAt((b10 >> 12) & 63) +\n            this.ALPHA.charAt((b10 >> 6) & 63) +\n            this.PADCHAR\n        );\n        break;\n    }\n\n    return x.join('');\n  }\n}\n","import * as Bowser from 'bowser';\n\nexport interface UserAgent extends Bowser.Parser.Parser {\n  compareVersion: (version: string) => boolean;\n}\n\nexport const userAgent = Bowser.getParser(\n  window.navigator.userAgent\n) as UserAgent;\n","import { userAgent } from './user-agent';\n\nexport class Clipboard {\n  static copy(element: HTMLTextAreaElement | string): boolean {\n    let successful = false;\n    if (typeof element === 'string') {\n      const textArea = Clipboard.createTextArea(element);\n      Clipboard.selectText(textArea);\n      successful = Clipboard.copyTextToClipboard();\n      Clipboard.destroyTextArea(textArea);\n    } else {\n      Clipboard.selectText(element);\n      successful = Clipboard.copyTextToClipboard();\n    }\n    return successful;\n  }\n\n  private static createTextArea(text: string): HTMLTextAreaElement {\n    const textArea = document.createElement('textArea') as HTMLTextAreaElement;\n    textArea.value = text;\n    document.body.appendChild(textArea);\n    return textArea;\n  }\n\n  private static destroyTextArea(textArea) {\n    document.body.removeChild(textArea);\n  }\n\n  private static selectText(textArea) {\n    if (userAgent.getOSName() === 'iOS') {\n      const oldContentEditable = textArea.contentEditable;\n      const oldReadOnly = textArea.readOnly;\n      const range = document.createRange();\n      const selection = window.getSelection();\n\n      textArea.contenteditable = true;\n      textArea.readonly = false;\n      range.selectNodeContents(textArea);\n      selection.removeAllRanges();\n      selection.addRange(range);\n      textArea.setSelectionRange(0, 999999);\n      textArea.contentEditable = oldContentEditable;\n      textArea.readOnly = oldReadOnly;\n    } else {\n      textArea.select();\n    }\n  }\n\n  private static copyTextToClipboard(): boolean {\n    if (!(userAgent.getOSName() === 'iOS' && userAgent.compareVersion('<10'))) {\n      return document.execCommand('copy');\n    }\n    return false;\n  }\n}\n","export class StringUtils {\n  static diff(s1: string, s2: string, p = 4): string {\n    if (!s1 && !s2) {\n      return '';\n    }\n    if (!s1) {\n      return '<span class=\"inserted\">' + s2 + '</span>';\n    }\n    if (!s2) {\n      return '<span class=\"deleted\">' + s1 + '</span>';\n    }\n    s1 = s1.toString();\n    s2 = s2.toString();\n    const changeData = StringUtils.getChanges(s1, s2, '', p);\n    const nextS = s2.slice(\n      changeData.mtc.length + changeData.ins.length + changeData.sbs.length\n    ); // remaining part of \"s\"\n    const nextThis = s1.slice(\n      changeData.mtc.length + changeData.del.length + changeData.sbs.length\n    ); // remaining part of \"this\"\n    let result = ''; // the glorious result\n    if (changeData.del.length > 0) {\n      changeData.del = '<span class=\"deleted\">' + changeData.del + '</span>';\n    }\n    if (changeData.ins.length > 0) {\n      changeData.ins = '<span class=\"inserted\">' + changeData.ins + '</span>';\n    }\n    result = changeData.mtc + changeData.del + changeData.ins + changeData.sbs;\n    result +=\n      nextThis !== '' || nextS !== ''\n        ? StringUtils.diff(nextThis, nextS, p)\n        : '';\n    return result;\n  }\n\n  private static getMatchingSubstring(s, l, m) {\n    // returns the first matching substring in-between the two strings\n    let i = 0;\n    let match = false;\n    const slen = s.length;\n    const o = { fis: slen, mtc: m, sbs: '' }; // temporary object used to construct the cd (change data) object\n\n    while (i < slen) {\n      l[i] === s[i]\n        ? match\n          ? (o.sbs += s[i]) // o.sbs holds the matching substring itsef\n          : ((match = true), (o.fis = i), (o.sbs = s[i]))\n        : match\n          ? (i = slen) // stop after the first found substring\n          : (i = i);\n      ++i;\n    }\n    return o;\n  }\n\n  private static getChanges(s1, s2, m, p) {\n    const isThisLonger = s1.length >= s1.length ? true : false;\n    let [longer, shorter] = isThisLonger ? [s1, s2] : [s2, s1]; // assignment of longer and shorter by es6 destructuring\n    let bi = 0; // base index designating the index of first mismacthing character in both strings\n\n    while (shorter[bi] === longer[bi] && bi < shorter.length) {\n      ++bi;\n    } // make bi the index of first mismatching character\n    longer = longer.split('').slice(bi); // as the longer string will be rotated it is converted into array\n    shorter = shorter.slice(bi); // shorter and longer now starts from the first mismatching character\n\n    const len = longer.length; // length of the longer string\n    let cd: any = {\n      fis: shorter.length, // the index of matching string in the shorter string\n      fil: len, // the index of matching string in the longer string\n      sbs: '', // the matching substring itself\n      mtc: m + s2.slice(0, bi)\n    }; // if exists mtc holds the matching string at the front\n    let sub: any = { sbs: '' }; // returned substring per 1 character rotation of the longer string\n\n    if (shorter !== '') {\n      for (let rc = 0; rc < len && sub.sbs.length < p; rc++) {\n        // rc -> rotate count, p -> precision factor\n        sub = StringUtils.getMatchingSubstring(\n          shorter,\n          StringUtils.rotateArray(longer, rc),\n          cd.mtc\n        ); // rotate longer string 1 char and get substring\n        sub.fil =\n          rc < len - sub.fis\n            ? sub.fis + rc // mismatch is longer than the mismatch in short\n            : sub.fis - len + rc; // mismatch is shorter than the mismatch in short\n        if (sub.sbs.length > cd.sbs.length) {\n          cd = sub; // only keep the one with the longest substring.\n        }\n      }\n    }\n    // insert the mismatching delete subsrt and insert substr to the cd object and attach the previous substring\n    [cd.del, cd.ins] = isThisLonger\n      ? [longer.slice(0, cd.fil).join(''), shorter.slice(0, cd.fis)]\n      : [shorter.slice(0, cd.fis), longer.slice(0, cd.fil).join('')];\n    return cd.del.indexOf(' ') === -1 ||\n      cd.ins.indexOf(' ') === -1 ||\n      cd.del === '' ||\n      cd.ins === '' ||\n      cd.sbs === ''\n      ? cd\n      : StringUtils.getChanges(cd.del, cd.ins, cd.mtc, p);\n  }\n\n  private static rotateArray(array, n) {\n    const len = array.length;\n    const res = new Array(array.length);\n    if (n % len === 0) {\n      return array.slice();\n    } else {\n      for (let i = 0; i < len; i++) {\n        res[i] = array[(i + (len + (n % len))) % len];\n      }\n    }\n    return res;\n  }\n}\n","export enum ChangeType {\n  ADDED = 'added',\n  DELETED = 'deleted',\n  MODIFIED = 'modified'\n}\n\nexport interface Change {\n  type: ChangeType;\n  keysChanged?: {\n    key: string;\n    newValue: any;\n    oldValue: any;\n  }[];\n}\n\nexport interface GroupingChanges {\n  added: ChangeItem[];\n  deleted: ChangeItem[];\n  modified: ChangeItem[];\n}\n\nexport interface ChangeItem {\n  change: Change;\n  value: any;\n  oldValue?: any;\n  newValue?: any;\n}\n","import { StringUtils } from './string-utils';\nimport { GroupingChanges, ChangeType } from './change.interface';\n\nexport class ChangeUtils {\n  static findChanges(\n    obj1: any[],\n    obj2: any[],\n    ignoreKeys: string[] = []\n  ): GroupingChanges {\n    const items: GroupingChanges = {\n      added: [],\n      deleted: [],\n      modified: []\n    };\n\n    if (!obj1 || !obj2) {\n      return items;\n    }\n\n    const obj1Clone: any = [...obj1];\n    const obj2Clone: any = [...obj2];\n\n    for (const fromItem of obj1Clone) {\n      const index = obj2Clone.findIndex(s => s.id === fromItem.id);\n\n      if (index === -1) {\n        items.deleted.push({\n          change: { type: ChangeType.DELETED },\n          value: fromItem\n        });\n        continue;\n      }\n\n      const toItem = obj2Clone.splice(index, 1)[0];\n      const fromItemClone = JSON.parse(JSON.stringify(fromItem));\n      const toItemClone = JSON.parse(JSON.stringify(toItem));\n\n      const keysChanged = ChangeUtils.compareObject(\n        fromItemClone,\n        toItemClone,\n        undefined,\n        ignoreKeys\n      );\n\n      if (keysChanged.length) {\n        items.modified.push({\n          change: {\n            type: ChangeType.MODIFIED,\n            keysChanged\n          },\n          value: fromItemClone,\n          oldValue: fromItem,\n          newValue: toItem\n        });\n      }\n    }\n\n    items.added = obj2Clone.map(itemAdded => {\n      return {\n        change: { type: ChangeType.ADDED },\n        value: itemAdded\n      };\n    });\n\n    return items;\n  }\n\n  private static compareObject(fromItem, toItem, baseKey?, ignoreKeys = []) {\n    const fromItemClone = JSON.parse(JSON.stringify(fromItem));\n    const toItemClone = JSON.parse(JSON.stringify(toItem));\n\n    const keys: any = new Set([\n      ...Object.keys(fromItem),\n      ...Object.keys(toItem)\n    ]);\n    let keysChanged = [];\n    keys.forEach(key => {\n      const keyString = baseKey ? `${baseKey}.${key}` : key;\n      if (ignoreKeys.indexOf(keyString) !== -1) {\n        return;\n      }\n\n      if (Array.isArray(fromItem[key])) {\n        fromItem[key] = fromItem[key].join(',<br>');\n      }\n      if (Array.isArray(toItem[key])) {\n        toItem[key] = toItem[key].join(',<br>');\n      }\n\n      if (\n        typeof fromItem[key] === 'object' &&\n        typeof toItem[key] === 'object' &&\n        fromItem[key] !== null &&\n        toItem[key] !== null\n      ) {\n        keysChanged = keysChanged.concat(\n          this.compareObject(fromItem[key], toItem[key], keyString)\n        );\n      } else {\n        if (fromItem[key] !== toItem[key]) {\n          keysChanged.push({\n            key: keyString,\n            oldValue: fromItemClone[key],\n            newValue: toItemClone[key]\n          });\n          fromItem[key] = StringUtils.diff(fromItem[key], toItem[key]);\n        }\n      }\n    });\n\n    return keysChanged;\n  }\n}\n","export class ObjectUtils {\n  static resolve(obj: object, key: string): any {\n    const keysArray = key\n      .replace(/\\[/g, '.')\n      .replace(/\\]/g, '')\n      .split('.');\n    let current = obj;\n    while (keysArray.length) {\n      if (typeof current !== 'object') {\n        return undefined;\n      }\n      current = current[keysArray.shift()];\n    }\n\n    return current;\n  }\n\n  static isObject(item: object) {\n    return (\n      item &&\n      typeof item === 'object' &&\n      !Array.isArray(item) &&\n      item !== null &&\n      !(item instanceof Date)\n    );\n  }\n\n  static mergeDeep(\n    target: object,\n    source: object,\n    ignoreUndefined = false\n  ): any {\n    const output = Object.assign({}, target);\n    if (ObjectUtils.isObject(target) && ObjectUtils.isObject(source)) {\n      Object.keys(source)\n        .filter(key => !ignoreUndefined || source[key] !== undefined)\n        .forEach(key => {\n          if (ObjectUtils.isObject(source[key])) {\n            if (!(key in target)) {\n              Object.assign(output, { [key]: source[key] });\n            } else {\n              output[key] = ObjectUtils.mergeDeep(\n                target[key],\n                source[key],\n                ignoreUndefined\n              );\n            }\n          } else {\n            Object.assign(output, { [key]: source[key] });\n          }\n        });\n    }\n    return output;\n  }\n\n  static copyDeep(src): any {\n    const target = Array.isArray(src) ? [] : {};\n    for (const prop in src) {\n      if (src.hasOwnProperty(prop)) {\n        const value = src[prop];\n        if (value && typeof value === 'object') {\n          target[prop] = this.copyDeep(value);\n        } else {\n          target[prop] = value;\n        }\n      }\n    }\n    return target;\n  }\n\n  static removeDuplicateCaseInsensitive(obj: object) {\n    const summaryCapitalizeObject = {};\n    const capitalizeObject = {};\n    const upperCaseCount = [];\n\n    for (const property in obj) {\n      if (obj.hasOwnProperty(property)) {\n        const upperCaseProperty = property.toUpperCase();\n        if (!summaryCapitalizeObject.hasOwnProperty(upperCaseProperty)) {\n          summaryCapitalizeObject[upperCaseProperty] = [\n            { [property]: obj[property] }\n          ];\n        } else {\n          summaryCapitalizeObject[upperCaseProperty].push({\n            [property]: obj[property]\n          });\n        }\n        // counting the number of uppercase lettersMna\n        upperCaseCount.push({\n          key: property,\n          count: property.replace(/[^A-Z]/g, '').length\n        });\n      }\n    }\n    for (const capitalizedProperty in summaryCapitalizeObject) {\n      if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\n        if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\n          const capitalizedPropertyObject =\n            summaryCapitalizeObject[capitalizedProperty];\n          if (capitalizedPropertyObject.length === 1) {\n            // for single params (no duplicates)\n            const singlePossibility = capitalizedPropertyObject[0];\n            capitalizeObject[capitalizedProperty] =\n              singlePossibility[Object.keys(singlePossibility)[0]];\n          } else if (capitalizedPropertyObject.length > 1) {\n            // defining the closest to lowercase property\n            const paramClosestToLowercase = upperCaseCount\n              .filter(\n                f => f.key.toLowerCase() === capitalizedProperty.toLowerCase()\n              )\n              .reduce((prev, current) => {\n                return prev.y < current.y ? prev : current;\n              });\n            capitalizeObject[paramClosestToLowercase.key.toUpperCase()] =\n              obj[paramClosestToLowercase.key];\n          }\n        }\n      }\n    }\n    for (const property in obj) {\n      if (obj.hasOwnProperty(property)) {\n        delete obj[property];\n      }\n    }\n\n    for (const property in capitalizeObject) {\n      if (capitalizeObject.hasOwnProperty(property)) {\n        obj[property] = capitalizeObject[property];\n      }\n    }\n  }\n\n  static removeUndefined(obj: object): any {\n    const output = {};\n    if (ObjectUtils.isObject(obj)) {\n      Object.keys(obj)\n        .filter(key => obj[key] !== undefined)\n        .forEach(key => {\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\n            output[key] = ObjectUtils.removeUndefined(obj[key]);\n          } else {\n            output[key] = obj[key];\n          }\n        });\n\n      return output;\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map(o => ObjectUtils.removeUndefined(o));\n    }\n\n    return obj;\n  }\n\n  static removeNull(obj: object): any {\n    const output = {};\n    if (ObjectUtils.isObject(obj)) {\n      Object.keys(obj)\n        .filter(key => obj[key] !== null)\n        .forEach(key => {\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\n            output[key] = ObjectUtils.removeNull(obj[key]);\n          } else {\n            output[key] = obj[key];\n          }\n        });\n\n      return output;\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map(o => ObjectUtils.removeNull(o));\n    }\n\n    return obj;\n  }\n\n  static naturalCompare(a, b, direction = 'asc', nullsFirst?: boolean) {\n    if (direction === 'desc') {\n      b = [a, (a = b)][0];\n    }\n\n    // nullsFirst = undefined : end if direction = 'asc', first if direction = 'desc'\n    // nullsFirst = true : always first\n    // nullsFirst = false : always end\n    if (\n      a === null ||\n      a === '' ||\n      a === undefined ||\n      b === null ||\n      b === '' ||\n      b === undefined\n    ) {\n      const nullScore =\n        a === b\n          ? 0\n          : a === undefined\n          ? 3\n          : b === undefined\n          ? -3\n          : a === null\n          ? 2\n          : b === null\n          ? -2\n          : a === ''\n          ? 1\n          : -1;\n      if (direction === 'desc') {\n        return nullsFirst !== false ? nullScore : nullScore * -1;\n      }\n      return nullsFirst === true ? nullScore * -1 : nullScore;\n    }\n\n    const ax = [];\n    const bx = [];\n    a = '' + a;\n    b = '' + b;\n\n    a.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\n      ax.push([$1 || Infinity, $2 || '']);\n    });\n\n    b.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\n      bx.push([$1 || Infinity, $2 || '']);\n    });\n\n    while (ax.length && bx.length) {\n      const an = ax.shift();\n      const bn = bx.shift();\n      const nn = an[0] - bn[0] || an[1].localeCompare(bn[1]);\n      if (nn) {\n        return nn;\n      }\n    }\n\n    return ax.length - bx.length;\n  }\n\n  /**\n   * Return true if two object are equivalent.\n   * Objects are considered equivalent if they have the same properties and\n   * if all of their properties (first-level only) share the same value.\n   * @param obj1 First object\n   * @param obj2 Second object\n   * @returns Whether two objects arer equivalent\n   */\n  static objectsAreEquivalent(obj1: object, obj2: object): boolean {\n    if (obj1 === obj2) {\n      return true;\n    }\n\n    const obj1Props = Object.getOwnPropertyNames(obj1);\n    const obj2Props = Object.getOwnPropertyNames(obj2);\n    if (obj1Props.length !== obj2Props.length) {\n      return false;\n    }\n\n    for (const prop of obj1Props) {\n      if (obj1[prop] !== obj2[prop]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Return a new object with an array of keys removed\n   * @param obj Source object\n   * @param keys Keys to remove\n   * @returns A new object\n   */\n  static removeKeys(obj: object, keys: string[]): object {\n    const newObj = Object.keys(obj)\n      .filter(key => keys.indexOf(key) < 0)\n      .reduce((_obj, key) => {\n        _obj[key] = obj[key];\n        return _obj;\n      }, {});\n\n    return newObj;\n  }\n}\n","export class NumberUtils {\n    static roundToNDecimal(num: number, decimal: number = 3): number {\n        const roundFactor = Math.pow(10, decimal);\n        return Math.round((num) * roundFactor) / roundFactor;\n    }\n}\n","/** Utility function to create a K:V from a list of strings */\nexport function strEnum<T extends string>(o: Array<T>): { [K in T]: K } {\n  return o.reduce((res, key) => {\n    res[key] = key;\n    return res;\n  }, Object.create(null));\n}\n","export function S4() {\n  // eslint-disable-next-line no-bitwise\n  return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n}\n\nexport function uuid() {\n  const id = `${S4()}${S4()}-${S4()}-${S4()}-${S4()}-${S4()}${S4()}${S4()}`;\n  return id.toLowerCase();\n}\n","import { Subject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nexport enum SubjectStatus {\n  Error = 0,\n  Done = 1,\n  Working = 2,\n  Waiting = 3\n}\n\nexport abstract class Watcher {\n  public status$ = new Subject<SubjectStatus>();\n  protected status$$: Subscription;\n\n  get status(): SubjectStatus {\n    return this._status;\n  }\n  set status(value: SubjectStatus) {\n    this._status = value;\n    this.status$.next(value);\n  }\n  private _status: SubjectStatus;\n\n  protected abstract watch();\n\n  protected abstract unwatch();\n\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  subscribe(callback: Function, scope?: any) {\n    this.watch();\n\n    this.status$$ = this.status$\n      .pipe(distinctUntilChanged())\n      .subscribe((status: SubjectStatus) => {\n        this.handleStatusChange(status);\n        callback.call(scope, this);\n      });\n  }\n\n  unsubscribe() {\n    this.unwatch();\n    if (this.status$$ !== undefined) {\n      this.status$$.unsubscribe();\n      this.status$$ = undefined;\n    }\n    this.status = SubjectStatus.Waiting;\n  }\n\n  protected handleStatusChange(status: SubjectStatus) {}\n}\n","import { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { uuid } from '@igo2/utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ActivityService {\n  public counter$ = new BehaviorSubject<number>(0);\n\n  private ids: string[] = [];\n\n  constructor() {}\n\n  register(): string {\n    const id = uuid();\n    this.ids.push(id);\n    this.counter$.next(this.ids.length);\n\n    return id;\n  }\n\n  unregister(id: string) {\n    const index = this.ids.indexOf(id);\n    if (index === -1) {\n      return;\n    }\n    this.ids.splice(index, 1);\n\n    this.counter$.next(this.ids.length);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport {\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpRequest\n} from '@angular/common/http';\n\nimport { Observable } from 'rxjs';\nimport { finalize } from 'rxjs/operators';\n\nimport { ActivityService } from './activity.service';\n\n@Injectable()\nexport class ActivityInterceptor implements HttpInterceptor {\n  constructor(private activityService: ActivityService) {}\n\n  intercept(\n    req: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const activity = req.headers.get('activityInterceptor');\n    if (activity) {\n      const actReq = req.clone({\n        headers: req.headers.delete('activityInterceptor')\n      });\n      if (activity === 'false') {\n        return next.handle(actReq);\n      }\n    }\n\n    const id = this.activityService.register();\n\n    return next.handle(req).pipe(\n      finalize(() => {\n        this.activityService.unregister(id);\n      })\n    );\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\n\nimport { ActivityInterceptor } from './activity.interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoActivityModule {\n  static forRoot(): ModuleWithProviders<IgoActivityModule> {\n    return {\n      ngModule: IgoActivityModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: ActivityInterceptor,\n          multi: true\n        }\n      ]\n    };\n  }\n}\n","export interface Version {\n  lib: string;\n  releaseDate: number;\n}\n\nexport const version: Version = {\n  lib: '1.9.4',\n  releaseDate: 1637005418583\n};\n","import { Injectable, Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { ConfigOptions } from './config.interface';\nimport { version } from './version';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ConfigService {\n  private config: object = {};\n\n  constructor(private injector: Injector) {}\n\n  /**\n   * Use to get the data found in config file\n   */\n  public getConfig(key: string): any {\n    return ObjectUtils.resolve(this.config, key);\n  }\n\n  /**\n   * This method loads \"[path]\" to get all config's variables\n   */\n  public load(options: ConfigOptions) {\n    const baseConfig = options.default || {};\n    if (!options.path) {\n      this.config = baseConfig;\n      return true;\n    }\n\n    const http = this.injector.get(HttpClient);\n\n    return new Promise((resolve, _reject) => {\n      http\n        .get(options.path)\n        .pipe(\n          catchError((error: any): any => {\n            console.log(`Configuration file ${options.path} could not be read`);\n            resolve(true);\n            return throwError(error.error || 'Server error');\n          })\n        )\n        .subscribe((configResponse: object) => {\n          this.config = ObjectUtils.mergeDeep(\n            ObjectUtils.mergeDeep({ version }, baseConfig),\n            configResponse\n          );\n          resolve(true);\n        });\n    });\n  }\n}\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\n\nimport { ConfigService } from './config.service';\nimport { ConfigOptions } from './config.interface';\n\nexport let CONFIG_OPTIONS = new InjectionToken<ConfigOptions>('configOptions');\n\nexport function provideConfigOptions(options: ConfigOptions) {\n  return {\n    provide: CONFIG_OPTIONS,\n    useValue: options\n  };\n}\n\nexport function configFactory(\n  configService: ConfigService,\n  options: ConfigOptions\n) {\n  return () => configService.load(options);\n}\n\nexport function provideConfigLoader() {\n  return {\n    provide: APP_INITIALIZER,\n    useFactory: configFactory,\n    multi: true,\n    deps: [ConfigService, CONFIG_OPTIONS]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { provideConfigOptions, provideConfigLoader } from './config.provider';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoConfigModule {\n  static forRoot(): ModuleWithProviders<IgoConfigModule> {\n    return {\n      ngModule: IgoConfigModule,\n      providers: [provideConfigOptions({}), provideConfigLoader()]\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { of, combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { TranslateLoader } from '@ngx-translate/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { ConfigService } from '../../config/config.service';\n\ndeclare function require(arg: string): any;\n\nexport class LanguageLoader implements TranslateLoader {\n  constructor(\n    private http: HttpClient,\n    private prefix?: string | string[],\n    private suffix: string = '.json',\n    private config?: ConfigService\n  ) {}\n\n  public getTranslation(lang: string): any {\n    const translation = require(`../locale/${lang}.json`);\n    const igoLocale$ = of(translation);\n\n    if (this.config && !this.prefix) {\n      const prefix = this.config.getConfig('language.prefix');\n      this.prefix = !prefix || Array.isArray(prefix) ? prefix : [prefix];\n    }\n\n    if (!this.prefix || this.prefix.length === 0) {\n      return igoLocale$;\n    }\n\n    const appLocale$ = (this.prefix as string[]).map((prefix) =>\n      this.http.get(`${prefix}${lang}${this.suffix}`)\n    );\n\n    const locale$ = combineLatest([igoLocale$, ...appLocale$]);\n\n    return locale$.pipe(\n      map((translations) => {\n        return translations.reduce(\n          (acc, current) => ObjectUtils.mergeDeep(acc, current),\n          {}\n        );\n      })\n    );\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { TranslateLoader } from '@ngx-translate/core';\n\nimport { ConfigService } from '../../config/config.service';\nimport { LanguageLoader } from './language.loader';\n\nexport function defaultLanguageLoader(\n  http: HttpClient,\n  config?: ConfigService\n) {\n  return new LanguageLoader(http, undefined, undefined, config);\n}\n\nexport function provideLanguageLoader(loader?) {\n  return {\n    provide: TranslateLoader,\n    useFactory: loader || defaultLanguageLoader,\n    deps: [HttpClient]\n  };\n}\n\nexport function provideDefaultLanguageLoader(loader?) {\n  return {\n    provide: TranslateLoader,\n    useFactory: loader || defaultLanguageLoader,\n    deps: [HttpClient, ConfigService]\n  };\n}\n","import {\n  MissingTranslationHandler,\n  MissingTranslationHandlerParams\n} from '@ngx-translate/core';\n\nexport class IgoMissingTranslationHandler implements MissingTranslationHandler {\n  handle(params: MissingTranslationHandlerParams) {\n    if (!params.translateService.langs.length) {\n      const error =\n        'Translations are not yet loaded. \\\n         Check that the LanguageService is injected.';\n      throw new Error(error);\n    }\n\n    if (params.key.substr(0, 4) === 'igo.') {\n      throw new Error(`The Key \"${params.key}\" is missing in locale file.`);\n    } else {\n      return params.key;\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport {\n  TranslateModule,\n  MissingTranslationHandler\n} from '@ngx-translate/core';\n\nimport { provideDefaultLanguageLoader } from './shared/language.provider';\nimport { IgoMissingTranslationHandler } from './shared/missing-translation.guard';\n\n@NgModule({\n  imports: [\n    TranslateModule.forRoot({\n      missingTranslationHandler: {\n        provide: MissingTranslationHandler,\n        useClass: IgoMissingTranslationHandler\n      }\n    })\n  ],\n  declarations: [],\n  exports: [TranslateModule]\n})\nexport class IgoLanguageModule {\n  static forRoot(): ModuleWithProviders<IgoLanguageModule> {\n    return {\n      ngModule: IgoLanguageModule,\n      providers: [provideDefaultLanguageLoader()]\n    };\n  }\n}\n","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'igo-message-center',\n  templateUrl: './message-center.component.html',\n  styleUrls: ['./message-center.component.scss']\n})\nexport class MessageCenterComponent {\n  static defaultOptions = {\n    timeOut: 5000,\n    hasCloseIcon: false,\n    showProgressBar: true,\n    pauseOnHover: true,\n    clickToClose: true,\n    maxLength: 100,\n    maxStack: 3,\n    preventDuplicates: true\n  };\n\n  @Input()\n  get options(): any {\n    return Object.assign(\n      {},\n      MessageCenterComponent.defaultOptions,\n      this._options\n    );\n  }\n  set options(value: any) {\n    this._options = value;\n  }\n  private _options: any = {};\n\n  constructor() {}\n}\n","<simple-notifications\n  class=\"mat-typography\"\n  [ngClass]=\"{closeIcon: options.hasCloseIcon}\"\n  [options]=\"options\">\n</simple-notifications>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { SimpleNotificationsModule } from '@igo2/angular2-notifications';\n\nimport { MessageCenterComponent } from './message-center/message-center.component';\n\n@NgModule({\n  imports: [CommonModule, SimpleNotificationsModule.forRoot()],\n  declarations: [MessageCenterComponent],\n  exports: [MessageCenterComponent]\n})\nexport class IgoMessageModule {\n  static forRoot(): ModuleWithProviders<IgoMessageModule> {\n    return {\n      ngModule: IgoMessageModule,\n      providers: []\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LanguageService {\n  private language: string = this.translate.getBrowserLang();\n\n  constructor(public translate: TranslateService) {\n    const lang = this.getLanguage();\n    this.translate.setDefaultLang(lang);\n  }\n\n  public getLanguage(): string {\n    return this.language.match(/en|fr/) ? this.language : 'en';\n  }\n\n  public setLanguage(language: string) {\n    this.language = language.match(/en|fr/) ? language : 'en';\n    this.translate.use(this.language);\n    this.translate.reloadLang(this.language);\n  }\n}\n","export enum MessageType {\n  ERROR = 'error',\n  ALERT = 'alert',\n  INFO = 'info',\n  SUCCESS = 'success'\n}\n","import { Injectable } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BehaviorSubject } from 'rxjs';\nimport {\n  Notification,\n  NotificationsService,\n  NotificationType\n} from '@igo2/angular2-notifications';\n\nimport { ConfigService } from '../../config/config.service';\n\nimport { Message, MessageOptions } from './message.interface';\nimport { MessageType } from './message.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MessageService {\n  public messages$ = new BehaviorSubject<Message[]>([]);\n  private options: MessageOptions;\n\n  constructor(\n    private notificationService: NotificationsService,\n    private configService: ConfigService\n  ) {\n    this.options = this.configService.getConfig('message') || {};\n  }\n\n  showError(httpError: HttpErrorResponse) {\n    httpError.error.caught = true;\n    return this.error(httpError.error.message, httpError.error.title);\n  }\n\n  message(message: Message) {\n    this.messages$.next(this.messages$.value.concat([message]));\n\n    message.options = message.options || {} as MessageOptions;\n    const currentDate = new Date();\n\n    message.options.from = message.options.from ? message.options.from : new Date('1 jan 1900');\n    message.options.to = message.options.to ? message.options.to : new Date('1 jan 3000');\n    if (typeof message.options.from === 'string') {\n      message.options.from = new Date(Date.parse(message.options.from.replace(/-/g, ' ')));\n    }\n    if (typeof message.options.to === 'string') {\n      message.options.to = new Date(Date.parse(message.options.to.replace(/-/g, ' ')));\n    }\n    if (\n      currentDate > message.options.from && currentDate < message.options.to) {\n\n      message = this.handleTemplate(message);\n\n      let notification: Notification;\n      if (message.text) {\n        notification = this.notificationService.create(\n          message.title,\n          message.text,\n          (message.type as any) as NotificationType,\n          message.options\n        );\n      } else if (message.html) {\n        if (!message.icon) {\n          message.options.theClass = message.options.theClass\n            ? message.options.theClass + ' noIcon'\n            : 'noIcon';\n        }\n\n        notification = this.notificationService.html(\n          message.html,\n          (message.type as any) as NotificationType,\n          message.options\n        );\n      } else {\n        return;\n      }\n\n      if (message.icon !== undefined) {\n        this.addIcon(notification, message.icon);\n      }\n      message.options.id = notification.id;\n      return notification;\n    }\n    return;\n  }\n\n  success(text: string, title?: string, options: any = {}) {\n    return this.message({\n      text,\n      title,\n      icon: options.icon || 'check',\n      options,\n      type: MessageType.SUCCESS\n    });\n  }\n\n  error(text: string, title?: string, options: any = {}) {\n    return this.message({\n      text,\n      title,\n      icon: options.icon || 'error_outline',\n      options,\n      type: MessageType.ERROR\n    });\n  }\n\n  info(text: string, title?: string, options: any = {}) {\n    return this.message({\n      text,\n      title,\n      icon: options.icon || 'info_outline',\n      options,\n      type: MessageType.INFO\n    });\n  }\n\n  alert(text: string, title?: string, options: any = {}) {\n    return this.message({\n      text,\n      title,\n      icon: options.icon || 'access_alarm',\n      options,\n      type: MessageType.ALERT\n    });\n  }\n\n  remove(id?: string) {\n    this.notificationService.remove(id);\n  }\n\n  removeAllAreNotError() {\n    for (const mess of this.messages$.value) {\n      if (mess.type !== 'error') {\n        this.remove(mess.options.id);\n      }\n    }\n  }\n\n  private addIcon(notification: Notification, icon: string) {\n    // There is no way to add an icon to a notification when reating\n    // it so we simply set it on the notification directly.\n    // See https://github.com/flauc/angular2-notifications/issues/165\n    notification.icon = `\n      <mat-icon class=\"material-icons mat-icon mat-list-avatar\" svgIcon=\"${icon}\">\n      </mat-icon>`;\n  }\n\n  private handleTemplate(message: Message): Message {\n    if (!this.options.template || message.html) {\n      return message;\n    }\n\n    let html = this.options.template;\n    html = html.replace('${text}', message.text);\n    html = html.replace('${title}', message.title);\n    html = html.replace('${icon}', message.icon);\n\n    message.html = html;\n    message.text = undefined;\n    message.title = undefined;\n    message.icon = undefined;\n    return message;\n  }\n}\n","import { Injectable, Injector } from '@angular/core';\nimport {\n  HttpInterceptor,\n  HttpHandler,\n  HttpRequest,\n  HttpEvent,\n  HttpErrorResponse\n} from '@angular/common/http';\n\nimport { Observable, throwError } from 'rxjs';\nimport { catchError, finalize } from 'rxjs/operators';\n\nimport { MessageService } from '../message/shared/message.service';\nimport { LanguageService } from '../language/shared/language.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ErrorInterceptor implements HttpInterceptor {\n  constructor(\n    private messageService: MessageService,\n    private injector: Injector\n  ) {}\n\n  intercept(\n    req: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const errorContainer = { httpError: undefined };\n    return next.handle(req).pipe(\n      catchError(error => this.handleError(error, errorContainer)),\n      finalize(() => {\n        this.handleCaughtError(errorContainer);\n        this.handleUncaughtError(errorContainer);\n      })\n    );\n  }\n\n  private handleError(\n    httpError: HttpErrorResponse,\n    errorContainer: { httpError: HttpErrorResponse }\n  ) {\n    if (httpError instanceof HttpErrorResponse) {\n      const errorObj = httpError.error === 'object' ? httpError.error : {};\n      errorObj.message = httpError.error.message || httpError.statusText;\n      errorObj.caught = false;\n\n      httpError = new HttpErrorResponse({\n        error: errorObj,\n        headers: httpError.headers,\n        status: httpError.status,\n        statusText: httpError.statusText,\n        url: httpError.url\n      });\n    }\n\n    errorContainer.httpError = httpError;\n    return throwError(httpError);\n  }\n\n  private handleCaughtError(errorContainer: { httpError: HttpErrorResponse }) {\n    const httpError = errorContainer.httpError;\n    if (httpError && httpError.error.toDisplay) {\n      httpError.error.caught = true;\n      this.messageService.error(httpError.error.message, httpError.error.title);\n    }\n  }\n\n  private handleUncaughtError(errorContainer: {\n    httpError: HttpErrorResponse;\n  }) {\n    const httpError = errorContainer.httpError;\n    if (httpError && !httpError.error.caught) {\n      const translate = this.injector.get(LanguageService).translate;\n      const message = translate.instant('igo.core.errors.uncaught.message');\n      const title = translate.instant('igo.core.errors.uncaught.title');\n      httpError.error.caught = true;\n      this.messageService.error(message, title);\n    }\n  }\n}\n","import {\n  NgModule,\n  ModuleWithProviders,\n  Optional,\n  SkipSelf\n} from '@angular/core';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\n\nimport { ErrorInterceptor } from './error.interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoErrorModule {\n  static forRoot(): ModuleWithProviders<IgoErrorModule> {\n    return {\n      ngModule: IgoErrorModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: ErrorInterceptor,\n          multi: true\n        }\n      ]\n    };\n  }\n\n  constructor(@Optional() @SkipSelf() parentModule: IgoErrorModule) {\n    if (parentModule) {\n      throw new Error(\n        'IgoErrorModule is already loaded. Import it in the AppModule only'\n      );\n    }\n  }\n}\n","import { Injectable, Inject, InjectionToken, Optional } from '@angular/core';\nimport { ActivatedRoute, Params, Router } from '@angular/router';\nimport { Observable } from 'rxjs';\n\nimport { RouteServiceOptions } from './route.interface';\n\nexport let ROUTE_SERVICE_OPTIONS = new InjectionToken<RouteServiceOptions>(\n  'routeServiceOptions'\n);\n\nexport function provideRouteServiceOptions(options: RouteServiceOptions) {\n  return {\n    provide: ROUTE_SERVICE_OPTIONS,\n    useValue: options\n  };\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RouteService {\n  public options: RouteServiceOptions;\n\n  constructor(\n    private router: Router,\n    public route: ActivatedRoute,\n    @Inject(ROUTE_SERVICE_OPTIONS)\n    @Optional()\n    options: RouteServiceOptions\n  ) {\n    const defaultOptions = {\n      centerKey: 'center',\n      zoomKey: 'zoom',\n      projectionKey: 'projection',\n      contextKey: 'context',\n      searchKey: 'search',\n      visibleOnLayersKey: 'visiblelayers',\n      visibleOffLayersKey: 'invisiblelayers',\n      directionsCoordKey: 'routing',\n      directionsOptionsKey: 'routingOptions',\n      toolKey: 'tool',\n      wmsUrlKey: 'wmsUrl',\n      wmsLayersKey:  'wmsLayers',\n      wmtsUrlKey: 'wmtsUrl',\n      wmtsLayersKey:  'wmtsLayers',\n      arcgisUrlKey: 'arcgisUrl',\n      arcgisLayersKey:  'arcgisLayers',\n      iarcgisUrlKey: 'iarcgisUrl',\n      iarcgisLayersKey:  'iarcgisLayers',\n      tarcgisUrlKey: 'tarcgisUrl',\n      tarcgisLayersKey:  'tarcgisLayers',\n      vectorKey: 'vector'\n    };\n    this.options = Object.assign({}, defaultOptions, options);\n  }\n\n  get queryParams(): Observable<Params> {\n    let url = decodeURIComponent(location.search);\n    if (url.includes('¢er=')) {\n      url = url.replace('¢er', '&center');\n      const queryParams: any = url\n      .slice(1)\n      .split('&')\n      .map(p => p.split('='))\n      .reduce((obj, pair) => {\n        const [key, value] = pair.map(decodeURIComponent);\n        obj[key] = value;\n        return obj;\n      }, {});\n      this.router.navigate([], { queryParams });\n    }\n    return this.route.queryParams;\n  }\n}\n","export enum Media {\n  Mobile = 'mobile',\n  Tablet = 'tablet',\n  Desktop = 'desktop'\n}\n\nexport enum MediaOrientation {\n  Portrait = 'portrait',\n  Landscape = 'landscape'\n}\n","import { Injectable } from '@angular/core';\nimport { Breakpoints, BreakpointObserver } from '@angular/cdk/layout';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Media, MediaOrientation } from './media.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MediaService {\n  public media$ = new BehaviorSubject<Media>(undefined);\n  public orientation$ = new BehaviorSubject<MediaOrientation>(undefined);\n\n  constructor(breakpointObserver: BreakpointObserver) {\n    breakpointObserver\n      .observe([Breakpoints.HandsetLandscape])\n      .subscribe(res => {\n        if (res.matches) {\n          this.media$.next(Media.Mobile);\n          this.orientation$.next(MediaOrientation.Landscape);\n        }\n      });\n\n    breakpointObserver.observe([Breakpoints.HandsetPortrait]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Mobile);\n        this.orientation$.next(MediaOrientation.Portrait);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.TabletLandscape]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Tablet);\n        this.orientation$.next(MediaOrientation.Landscape);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.TabletPortrait]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Tablet);\n        this.orientation$.next(MediaOrientation.Portrait);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.WebLandscape]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Desktop);\n        this.orientation$.next(MediaOrientation.Landscape);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.WebPortrait]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Desktop);\n        this.orientation$.next(MediaOrientation.Portrait);\n      }\n    });\n  }\n\n  getMedia(): Media {\n    return this.media$.value;\n  }\n\n  getOrientation(): MediaOrientation {\n    return this.orientation$.value;\n  }\n\n  isTouchScreen(): boolean {\n    return 'ontouchstart' in document.documentElement ? true : false;\n  }\n\n  isMobile(): boolean {\n    const media = this.getMedia();\n    return media === 'mobile';\n  }\n\n  isDesktop(): boolean {\n    const media = this.getMedia();\n    return media === 'desktop';\n  }\n}\n","export enum StorageScope {\n  SESSION = 'Session',\n  LOCAL = 'Local'\n}\n\nexport interface StorageOptions {\n  key: string;\n}\n\nexport interface StorageServiceEvent {\n  key?: string;\n  scope: StorageScope;\n  event: StorageServiceEventEnum;\n  previousValue?: any;\n  currentValue?: any;\n}\n\nexport enum StorageServiceEventEnum {\n  ADDED = 'Added',\n  MODIFIED = 'Modified',\n  REMOVED = 'Removed',\n  CLEARED = 'Cleared'\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '../config/config.service';\nimport { StorageScope, StorageOptions, StorageServiceEvent, StorageServiceEventEnum } from './storage.interface';\nimport { BehaviorSubject } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageService {\n  protected options: StorageOptions;\n\n  public storageChange$: BehaviorSubject<StorageServiceEvent> = new BehaviorSubject(undefined);\n\n  constructor(private config: ConfigService) {\n    this.options = this.config.getConfig('storage') || { key: 'igo' };\n  }\n  /**\n   * Use to get the data found in storage file\n   */\n  get(key: string, scope?: StorageScope): string | object | boolean | number {\n    let value: any;\n\n    if (!scope || scope === StorageScope.SESSION) {\n      value = sessionStorage.getItem(`${this.options.key}.${key}`);\n    }\n\n    if (scope === StorageScope.LOCAL || (!value && !scope)) {\n      value = localStorage.getItem(`${this.options.key}.${key}`);\n    }\n\n    if (value) {\n      try {\n        value = JSON.parse(value);\n      } catch {\n        value = value;\n      }\n    }\n\n    return value;\n  }\n\n  set(\n    key: string,\n    value: string | object | boolean | number,\n    scope: StorageScope = StorageScope.LOCAL\n  ) {\n    const previousValue = this.get(key, scope);\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.setItem(\n        `${this.options.key}.${key}`,\n        JSON.stringify(value)\n      );\n    } else {\n      localStorage.setItem(`${this.options.key}.${key}`, JSON.stringify(value));\n    }\n    const currentValue = this.get(key, scope);\n\n    if (currentValue !== previousValue) {\n      this.storageChange$.next({\n        key, scope,\n        event: previousValue !== undefined ? StorageServiceEventEnum.MODIFIED : StorageServiceEventEnum.ADDED,\n        previousValue,\n        currentValue\n      });\n    }\n  }\n\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\n    const previousValue = this.get(key, scope);\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.removeItem(`${this.options.key}.${key}`);\n    } else {\n      localStorage.removeItem(`${this.options.key}.${key}`);\n    }\n    this.storageChange$.next({key, scope, event: StorageServiceEventEnum.REMOVED, previousValue });\n  }\n\n  clear(scope: StorageScope = StorageScope.LOCAL) {\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.clear();\n    } else {\n      localStorage.clear();\n    }\n    this.storageChange$.next({scope, event: StorageServiceEventEnum.CLEARED });\n  }\n}\n","import { Injectable, EventEmitter, OnDestroy, Injector } from '@angular/core';\nimport { Observable, Subscription, fromEvent } from 'rxjs';\nimport { debounceTime, startWith } from 'rxjs/operators';\n\nimport { MessageService } from '../message/shared/message.service';\nimport { LanguageService } from '../language/shared/language.service';\nimport { ConnectionState } from './network.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NetworkService implements OnDestroy {\n  private stateChangeEventEmitter = new EventEmitter<ConnectionState>();\n  private onlineSubscription: Subscription;\n  private offlineSubscription: Subscription;\n\n  private state: ConnectionState = {\n    connection: window.navigator.onLine\n  };\n\n  constructor(\n    private messageService: MessageService,\n    private injector: Injector\n  ) {\n      this.checkNetworkState();\n  }\n\n  private checkNetworkState() {\n    this.onlineSubscription = fromEvent(window, 'online').subscribe(() => {\n      const translate = this.injector.get(LanguageService).translate;\n      const message = translate.instant('igo.core.network.online.message');\n      const title = translate.instant('igo.core.network.online.title');\n      this.messageService.info(message, title);\n      this.state.connection = true;\n      this.emitEvent();\n    });\n\n    this.offlineSubscription = fromEvent(window, 'offline').subscribe(() => {\n      const translate = this.injector.get(LanguageService).translate;\n      const message = translate.instant('igo.core.network.offline.message');\n      const title = translate.instant('igo.core.network.offline.title');\n      this.messageService.info(message, title);\n      this.state.connection = false;\n      this.emitEvent();\n    });\n  }\n\n  private emitEvent() {\n    this.stateChangeEventEmitter.emit(this.state);\n  }\n\n  ngOnDestroy(): void {\n    try {\n      this.offlineSubscription.unsubscribe();\n      this.onlineSubscription.unsubscribe();\n    } catch (e) {}\n  }\n\n  currentState(reportState = true): Observable<ConnectionState> {\n    return reportState\n      ? this.stateChangeEventEmitter.pipe(\n          debounceTime(300),\n          startWith(this.state)\n        )\n      : this.stateChangeEventEmitter.pipe(debounceTime(300));\n  }\n}\n","export enum EntityOperationType {\n  Insert = 'Insert',\n  Update = 'Update',\n  Delete = 'Delete'\n}\n\nexport enum EntityTableColumnRenderer {\n  Default = 'Default',\n  HTML = 'HTML',\n  UnsanitizedHTML = 'UnsanitizedHTML',\n  Icon = 'Icon',\n  ButtonGroup = 'ButtonGroup'\n}\n\nexport enum EntityTableScrollBehavior {\n  Auto = 'auto',\n  Instant = 'instant',\n  Smooth = 'smooth'\n}\n\nexport enum EntityTableSelectionState {\n  None = 'None',\n  All = 'All',\n  Some = 'Some'\n}\n","import t from 'typy';\n\nimport { EntityKey } from './entity.interfaces';\n\n/**\n * Get an entity's named property. Nested properties are supported\n * with the dotted notation. (i.e 'author.name')\n *\n * Note: this method is a 'best attempt' at getting an entity's property.\n * It fits the most common cases but you might need to explicitely define\n * a property getter when using an EntityStore, for example.\n * @param entity Entity\n * @param property Property name\n * @returns Property value\n */\nexport function getEntityProperty(entity: object, property: string): any {\n  return t(entity, property).safeObject;\n}\n\n/**\n * Get an entity's id. An entity's id can be one of:\n * 'entity.meta.id', 'entity.meta.idProperty' or 'entity.id'.\n *\n * Note: See the note in the 'getEntityProperty' documentation.\n * @param entity Entity\n * @returns Entity id\n */\nexport function getEntityId(entity: object): EntityKey {\n  const meta = (entity as any).meta || {};\n  return meta.id ? meta.id : getEntityProperty(entity, meta.idProperty || 'id');\n}\n\n/**\n * Get an entity's title. An entity's title can be one of:\n * 'entity.meta.title', 'entity.meta.titleProperty' or 'entity.title'.\n * @param entity Entity\n * @returns Entity title\n */\nexport function getEntityTitle(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.title ? meta.title : getEntityProperty(entity, meta.titleProperty || 'title');\n}\n\n/**\n * Get an entity's HTML title. An entity's HTML title can be one of:\n * 'entity.meta.titleHtml', 'entity.meta.titleHtmlProperty' or 'entity.titleHtml'.\n * @param entity Entity\n * @returns Entity HTML title\n */\nexport function getEntityTitleHtml(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.titleHtml ? meta.titleHtml : getEntityProperty(entity, meta.titleHtmlProperty || 'titleHtml');\n}\n\n/**\n * Get an entity's icon. An entity's icon can be one of:\n * 'entity.meta.icon', 'entity.meta.iconProperty' or 'entity.icon'.\n * @param entity Entity\n * @returns Entity icon\n */\nexport function getEntityIcon(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.icon ? meta.icon : getEntityProperty(entity, meta.iconProperty || 'icon');\n}\n\n/**\n * Get an entity's revision.\n * @param entity Entity\n * @returns Entity revision\n */\nexport function getEntityRevision(entity: object): number {\n  const meta = (entity as any).meta || {};\n  return meta.revision || 0;\n}\n","import { ReplaySubject } from 'rxjs';\n\nimport { EntityKey, EntityState, EntityStateManagerOptions } from './entity.interfaces';\nimport { getEntityId } from './entity.utils';\nimport { EntityStore } from './store';\n\n/**\n * This class is used to track a store's entities state\n */\nexport class EntityStateManager<E extends object, S extends EntityState = EntityState> {\n\n  /**\n   * State index\n   */\n  readonly index = new Map<EntityKey, S>();\n\n  /**\n   * Change emitter\n   */\n  readonly change$ = new ReplaySubject<void>(1);\n\n  /**\n   * Method to get an entity's id\n   */\n  readonly getKey: (E) => EntityKey;\n\n  private store: EntityStore<object> | undefined;\n\n  constructor(options: EntityStateManagerOptions = {}) {\n    this.store = options.store ? options.store : undefined;\n    this.getKey = options.getKey\n      ? options.getKey\n      : (this.store ? this.store.getKey : getEntityId);\n    this.next();\n  }\n\n  /**\n   * Clear state\n   */\n  clear() {\n    if (this.index.size > 0) {\n      this.index.clear();\n      this.next();\n    }\n  }\n\n  /**\n   * Get an entity's state\n   * @param entity Entity\n   * @returns State\n   */\n  get(entity: E): S {\n    return (this.index.get(this.getKey(entity)) || {}) as S;\n  }\n\n  /**\n   * Set an entity's state\n   * @param entity Entity\n   * @param state State\n   */\n  set(entity: E, state: S) {\n    this.setMany([entity], state);\n  }\n\n  /**\n   * Set many entitie's state\n   * @param entitie Entities\n   * @param state State\n   */\n  setMany(entities: E[], state: S) {\n    entities.forEach((entity: E) => {\n      this.index.set(this.getKey(entity), Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Set state of all entities that already have a state. This is not\n   * the same as setting the state of all the store's entities.\n   * @param state State\n   */\n  setAll(state: S) {\n    Array.from(this.index.keys()).forEach((key: EntityKey) => {\n      this.index.set(key, Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Update an entity's state\n   * @param entity Entity\n   * @param changes State changes\n   */\n  update(entity: E, changes: Partial<S>, exclusive = false) {\n    this.updateMany([entity], changes, exclusive);\n  }\n\n  /**\n   * Update many entitie's state\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  updateMany(entities: E[], changes: Partial<S>, exclusive = false) {\n    if (exclusive === true) {\n      return this.updateManyExclusive(entities, changes);\n    }\n\n    entities.forEach((entity: E) => {\n      const state = Object.assign({}, this.get(entity), changes);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Reversee an entity's state\n   * @param entity Entity\n   * @param keys State keys to reverse\n   */\n  reverse(entity: E, keys: string[]) {\n    this.reverseMany([entity], keys);\n  }\n\n  /**\n   * Reverse many entitie's state\n   * @param entitie Entities\n   * @param keys State keys to reverse\n   */\n  reverseMany(entities: E[], keys: string[]) {\n    entities.forEach((entity: E) => {\n      const currentState = this.get(entity);\n      const changes = keys.reduce((acc: {[key: string]: boolean}, key: string) => {\n        acc[key] = currentState[key] || false;\n        return acc;\n      }, {}) as Partial<S>;\n      const reversedChanges = this.reverseChanges(changes);\n      const state = Object.assign({}, currentState, reversedChanges);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Update state of all entities that already have a state. This is not\n   * the same as updating the state of all the store's entities.\n   * @param changes State\n   */\n  updateAll(changes: Partial<S>) {\n    const allKeys = this.getAllKeys();\n    Array.from(allKeys).forEach((key: EntityKey) => {\n      const state = Object.assign({}, this.index.get(key), changes);\n      this.index.set(key, state);\n    });\n    this.next();\n  }\n\n  /**\n   * When some state changes are flagged as 'exclusive', reverse\n   * the state of all other entities. Changes are reversable when\n   * they are boolean.\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  private updateManyExclusive(entities: E[], changes: Partial<S>) {\n    const reverseChanges = this.reverseChanges(changes);\n\n    const keys = entities.map((entity: E) => this.getKey(entity));\n    const allKeys = new Set(keys.concat(Array.from(this.getAllKeys())));\n    allKeys.forEach((key: EntityKey) => {\n      const state = this.index.get(key) || {} as S;\n\n      if (keys.indexOf(key) >= 0) {\n        this.index.set(key, Object.assign({}, state, changes));\n      } else {\n        // Update only if the reverse changes would modify\n        // a key already present in the current state\n        const shouldUpdate = Object.keys(reverseChanges).some((changeKey: string) => {\n          return state[changeKey] !== undefined &&\n            state[changeKey] !== reverseChanges[changeKey];\n        });\n        if (shouldUpdate === true) {\n          this.index.set(key, Object.assign({}, state, reverseChanges));\n        }\n      }\n    });\n\n    this.next();\n  }\n\n  /**\n   * Compute a 'reversed' version of some state changes.\n   * Changes are reversable when they are boolean.\n   * @param changes State changes\n   * @returns Reversed state changes\n   */\n  private reverseChanges(changes: Partial<S>): Partial<S> {\n    return Object.entries(changes).reduce((reverseChanges: Partial<S>, bunch: [string, any]) => {\n      const [changeKey, value] = bunch;\n      if (typeof value === typeof true) {\n        (reverseChanges as object)[changeKey] = !value;\n      }\n      return reverseChanges;\n    }, {});\n  }\n\n  /**\n   * Return all the keys in that state and in the store it's bound to, if any.\n   * @returns Set of keys\n   */\n  private getAllKeys(): Set<EntityKey> {\n    const storeKeys = this.store ? Array.from(this.store.index.keys()) : [];\n    return new Set(Array.from(this.index.keys()).concat(storeKeys));\n  }\n\n  /**\n   * Emit 'change' event\n   */\n  private next() {\n    this.change$.next();\n  }\n\n}\n","import { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\nimport { debounceTime, map, skip } from 'rxjs/operators';\n\nimport { ObjectUtils, uuid } from '@igo2/utils';\nimport {\n  EntityKey,\n  EntityFilterClause,\n  EntitySortClause,\n  EntityJoinClause\n} from './entity.interfaces';\n\n/**\n * An entity view streams entities from an observable source. These entities\n * can be filtered or sorted without affecting the source. A view can also\n * combine data from multiple sources, joined together.\n */\nexport class EntityView<E extends object, V extends object = E> {\n\n  /**\n   * Observable stream of values\n   */\n  readonly values$ = new BehaviorSubject<V[]>([]);\n\n  /**\n   * Subscription to the source (and joined sources) values\n   */\n  private values$$: Subscription;\n\n  /**\n   * Whether this view has been lifted\n   */\n  private lifted = false;\n\n  /**\n   * Join clauses\n   */\n  private joins: EntityJoinClause[] = [];\n\n  /**\n   * Observable of a filter clause\n   */\n  private filter$ = new BehaviorSubject(undefined);\n\n  /**\n   * Observable of filter clauses\n   */\n  private filters$: BehaviorSubject<EntityFilterClause[]> = new BehaviorSubject([]);\n\n  /**\n   * Filters index\n   */\n  private filterIndex: Map<string, EntityFilterClause> = new Map();\n\n  /**\n   * Observable of a sort clause\n   */\n  private sort$ = new BehaviorSubject(undefined);\n\n  /**\n   * Method for indexing\n   */\n  get getKey(): (V) => EntityKey { return this.getKey$.value; }\n  private getKey$: BehaviorSubject<(V) => EntityKey> = new BehaviorSubject(undefined);\n\n  /**\n   * Number of entities\n   */\n  readonly count$ = new BehaviorSubject<number>(0);\n  get count(): number { return this.count$.value; }\n\n  /**\n   * Whether the store is empty\n   */\n  readonly empty$ = new BehaviorSubject<boolean>(true);\n  get empty(): boolean { return this.empty$.value; }\n\n  /**\n   * Store index\n   */\n  get index(): Map<EntityKey, V> { return this._index; }\n  private _index: Map<EntityKey, V>;\n\n  constructor(private source$: BehaviorSubject<E[]>) {}\n\n  /**\n   * Get a value from the view by key\n   * @param key Key\n   * @returns Value\n   */\n  get(key: EntityKey): V {\n    if (this._index === undefined) {\n      throw new Error('This view has no index, therefore, this method is unavailable.');\n    }\n    return this.index.get(key);\n  }\n\n  /**\n   * Get all the values\n   * @returns Array of values\n   */\n  all(): V[] {\n    return this.values$.value;\n  }\n\n  /**\n   * Observe all the values\n   * @returns Observable of values\n   */\n  all$(): BehaviorSubject<V[]> {\n    return this.values$;\n  }\n\n  /**\n   * Get the first value that respects a criteria\n   * @returns A value\n   */\n  firstBy(clause: EntityFilterClause<V>): V {\n    return this.values$.value.find(clause);\n  }\n\n  /**\n   * Observe the first value that respects a criteria\n   * @returns Observable of a value\n   */\n  firstBy$(clause: EntityFilterClause<V>): Observable<V> {\n    return this.values$.pipe(map((values: V[]) => values.find(clause)));\n  }\n\n  /**\n   * Get all the values that respect a criteria\n   * @returns Array of values\n   */\n  manyBy(clause: EntityFilterClause<V>): V[] {\n    return this.values$.value.filter(clause);\n  }\n\n  /**\n   * Observe all the values that respect a criteria\n   * @returns Observable of values\n   */\n  manyBy$(clause: EntityFilterClause<V>): Observable<V[]> {\n    return this.values$.pipe(map((values: V[]) => values.filter(clause)));\n  }\n\n  /**\n   * Clear the filter and sort and unsubscribe from the source\n   */\n  clear() {\n    this.filter(undefined);\n    this.sort(undefined);\n  }\n\n  destroy() {\n    if (this.values$$ !== undefined) {\n      this.values$$.unsubscribe();\n    }\n    this.clear();\n  }\n\n  /**\n   * Create an index\n   * @param getKey Method to get a value's id\n   * @returns The view\n   */\n  createIndex(getKey: (E) => EntityKey): EntityView<E, V> {\n    this._index = new Map();\n    this.getKey$.next(getKey);\n    return this;\n  }\n\n  /**\n   * Join another source to the stream (chainable)\n   * @param clause Join clause\n   * @returns The view\n   */\n  join(clause: EntityJoinClause): EntityView<E, V> {\n    if (this.lifted === true) {\n      throw new Error('This view has already been lifted, therefore, no join is allowed.');\n    }\n    this.joins.push(clause);\n    return this;\n  }\n\n  /**\n   * Filter values (chainable)\n   * @param clause Filter clause\n   * @returns The view\n   */\n  filter(clause: EntityFilterClause<V>): EntityView<E, V> {\n    this.filter$.next(clause);\n    return this;\n  }\n\n  /**\n   * @param clause Filter clause\n   * @returns The filter id\n   */\n  addFilter(clause: EntityFilterClause<V>): string {\n    const id = uuid();\n    this.filterIndex.set(id, clause);\n    this.filters$.next(Array.from(this.filterIndex.values()));\n    return id;\n  }\n\n  /**\n   * Remove a filter by id\n   * @param clause Filter clause\n   */\n  removeFilter(id: string) {\n    this.filterIndex.delete(id);\n    this.filters$.next(Array.from(this.filterIndex.values()));\n  }\n\n  /**\n   * Sort values (chainable)\n   * @param clauseSort clause\n   * @returns The view\n   */\n  sort(clause: EntitySortClause<V>): EntityView<E, V> {\n    this.sort$.next(clause);\n    return this;\n  }\n\n  /**\n   * Create the final observable\n   * @returns Observable\n   */\n  lift() {\n    this.lifted = true;\n    const source$ = this.joins.length > 0 ? this.liftJoinedSource() : this.liftSource();\n    const observables$ = [\n      source$,\n      this.filters$,\n      this.filter$,\n      this.sort$,\n      this.getKey$\n    ];\n\n    this.values$$ = combineLatest(observables$)\n      .pipe(skip(1), debounceTime(5))\n      .subscribe((bunch: [V[], EntityFilterClause[], EntityFilterClause, EntitySortClause, (V) => EntityKey]) => {\n        const [_values, filters, filter, sort, getKey] = bunch;\n        const values = this.processValues(_values, filters, filter, sort);\n        const generateIndex = getKey !== undefined;\n        this.setValues(values, generateIndex);\n      });\n  }\n\n  /**\n   * Create the source observable when no joins are defined\n   * @returns Observable\n   */\n  private liftSource(): Observable<V[]> {\n    return this.source$ as any as Observable<V[]>;\n  }\n\n  /**\n   * Create the source observable when joins are defined\n   * @returns Observable\n   */\n  private liftJoinedSource(): Observable<V[]> {\n    const sources$ = [this.source$, combineLatest(\n      this.joins.map((join: EntityJoinClause) => join.source)\n    )];\n\n    return combineLatest(sources$)\n      .pipe(\n        map((bunch: [E[], any[]]) => {\n          const [entities, joinData] = bunch;\n          return entities.reduce((values: V[], entity: E) => {\n            const value = this.computeJoinedValue(entity, joinData);\n            if (value !== undefined) {\n              values.push(value);\n            }\n            return values;\n          }, []);\n        })\n      );\n  }\n\n  /**\n   * Apply joins to a source's entity and return the final value\n   * @returns Final value\n   */\n  private computeJoinedValue(entity: E, joinData: any[]): V | undefined {\n    let value = entity as Partial<V>;\n    let joinIndex = 0;\n    while (value !== undefined && joinIndex < this.joins.length) {\n      value = this.joins[joinIndex].reduce(value, joinData[joinIndex]);\n      joinIndex += 1;\n    }\n    return value as V;\n  }\n\n  /**\n   * Filter and sort values before streaming them\n   * @param values Values\n   * @param filters Filter clauses\n   * @param filter Filter clause\n   * @param sort Sort clause\n   * @returns Filtered and sorted values\n   */\n  private processValues(\n    values: V[], filters: EntityFilterClause[], filter: EntityFilterClause, sort: EntitySortClause\n  ): V[] {\n    values = values.slice(0);\n    values = this.filterValues(values, filters.concat([filter]));\n    values = this.sortValues(values, sort);\n    return values;\n  }\n\n  /**\n   * Filter values\n   * @param values Values\n   * @param filters Filter clauses\n   * @returns Filtered values\n   */\n  private filterValues(values: V[], clauses: EntityFilterClause[]): V[] {\n    if (clauses.length === 0) { return values; }\n\n    return values\n      .filter((value: V) => {\n        return clauses\n          .filter((clause: EntityFilterClause) => clause !== undefined)\n          .every((clause: EntityFilterClause) => clause(value));\n      });\n  }\n\n  /**\n   * Sort values\n   * @param values Values\n   * @param sort Sort clause\n   * @returns Sorted values\n   */\n  private sortValues(values: V[], clause: EntitySortClause): V[] {\n    if (clause === undefined) { return values; }\n    return values.sort((v1: V, v2: V) => {\n      return ObjectUtils.naturalCompare(\n        clause.valueAccessor(v1),\n        clause.valueAccessor(v2),\n        clause.direction,\n        clause.nullsFirst\n      );\n    });\n  }\n\n  /**\n   * Set value and optionally generate an index\n   * @param values Values\n   * @param generateIndex boolean\n   */\n  private setValues(values: V[], generateIndex: boolean) {\n    if (generateIndex === true) {\n      this._index = this.generateIndex(values);\n    }\n\n    this.values$.next(values);\n\n    const count = values.length;\n    const empty = count === 0;\n    this.count$.next(count);\n    this.empty$.next(empty);\n  }\n\n  /**\n   * Generate a complete index of all the values\n   * @param entities Entities\n   * @returns Index\n   */\n  private generateIndex(values: V[]): Map<EntityKey, V> {\n    const entries = values.map((value: V) => [this.getKey(value), value]);\n    return new Map(entries as [EntityKey, V][]);\n  }\n}\n","import { BehaviorSubject } from 'rxjs';\n\nimport { EntityStateManager } from './state';\nimport { EntityView } from './view';\nimport { EntityKey, EntityState, EntityRecord, EntityStoreOptions } from './entity.interfaces';\nimport { getEntityId, getEntityProperty } from './entity.utils';\nimport { EntityStoreStrategy } from './strategies/strategy';\n\n/**\n * An entity store class holds any number of entities\n * as well as their state. It can be observed, filtered and sorted and\n * provides methods to insert, update or delete entities.\n */\nexport class EntityStore<E extends object = object, S extends EntityState = EntityState> {\n\n  /**\n   * Observable of the raw entities\n   */\n  readonly entities$ = new BehaviorSubject<E[]>([]);\n\n  /**\n   * Number of entities\n   */\n  readonly count$ = new BehaviorSubject<number>(0);\n  get count(): number { return this.count$.value; }\n\n  /**\n   * Whether the store is empty\n   */\n  readonly empty$ = new BehaviorSubject<boolean>(true);\n  get empty(): boolean { return this.empty$.value; }\n\n  /**\n   * Entity store state\n   */\n  readonly state: EntityStateManager<E, S>;\n\n  /**\n   * View of all the entities\n   */\n  readonly view: EntityView<E>;\n\n  /**\n   * View of all the entities and their state\n   */\n  readonly stateView: EntityView<E, EntityRecord<E, S>>;\n\n  /**\n   * Method to get an entity's id\n   */\n  readonly getKey: (E) => EntityKey;\n\n  /**\n   * Method to get an entity's named property\n   */\n  readonly getProperty: (E, prop: string) => any;\n\n  /**\n   * Store index\n   */\n  get index(): Map<EntityKey, E> { return this._index; }\n  private _index: Map<EntityKey, E>;\n\n  /**\n   * Store index\n   */\n  get pristine(): boolean { return this._pristine; }\n  private _pristine: boolean = true;\n\n  /**\n   * Strategies\n   */\n  private strategies: EntityStoreStrategy[] = [];\n\n  constructor(entities: E[], options: EntityStoreOptions = {}) {\n    this.getKey = options.getKey ? options.getKey : getEntityId;\n    this.getProperty = options.getProperty ? options.getProperty : getEntityProperty;\n\n    this.state = this.createStateManager();\n    this.view = this.createDataView();\n    this.stateView = this.createStateView();\n\n    this.view.lift();\n    this.stateView.lift();\n\n    if (entities.length > 0) {\n      this.load(entities);\n    } else {\n      this._index = this.generateIndex(entities);\n    }\n  }\n\n  /**\n   * Get an entity from the store by key\n   * @param key Key\n   * @returns Entity\n   */\n  get(key: EntityKey): E {\n    return this.index.get(key);\n  }\n\n  /**\n   * Get all entities in the store\n   * @returns Array of entities\n   */\n  all(): E[] {\n    return this.entities$.value;\n  }\n\n  /**\n   * Set this store's entities\n   * @param entities Entities\n   */\n  load(entities: E[], pristine: boolean = true) {\n    this._index = this.generateIndex(entities);\n    this._pristine = pristine;\n    this.next();\n  }\n\n  /**\n   * Clear the store's entities but keep the state and views intact.\n   * Views won't return any data but future data will be subject to the\n   * current views filter and sort\n   */\n  softClear() {\n    if (this.index && this.index.size > 0) {\n      this.index.clear();\n      this._pristine = true;\n      this.next();\n    } else if (this.index) {\n      this.updateCount();\n    }\n  }\n\n  /**\n   * Clear the store's entities, state and views\n   */\n  clear() {\n    this.stateView.clear();\n    this.view.clear();\n    this.state.clear();\n    this.softClear();\n  }\n\n  destroy() {\n    this.stateView.destroy();\n    this.view.destroy();\n    this.clear();\n  }\n\n  /**\n   * Insert an entity into the store\n   * @param entity Entity\n   */\n  insert(entity: E) {\n    this.insertMany([entity]);\n  }\n\n  /**\n   * Insert many entities into the store\n   * @param entities Entities\n   */\n  insertMany(entities: E[]) {\n    entities.forEach((entity: E) => this.index.set(this.getKey(entity), entity));\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Update or insert an entity into the store\n   * @param entity Entity\n   */\n  update(entity: E) {\n    this.updateMany([entity]);\n  }\n\n  /**\n   * Update or insert many entities into the store\n   * @param entities Entities\n   */\n  updateMany(entities: E[]) {\n    entities.forEach((entity: E) => this.index.set(this.getKey(entity), entity));\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Delete an entity from the store\n   * @param entity Entity\n   */\n  delete(entity: E) {\n    this.deleteMany([entity]);\n  }\n\n  /**\n   * Delete many entities from the store\n   * @param entities Entities\n   */\n  deleteMany(entities: E[]) {\n    entities.forEach((entity: E) => this.index.delete(this.getKey(entity)));\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Add a strategy to this store\n   * @param strategy Entity store strategy\n   * @returns Entity store\n   */\n  addStrategy(strategy: EntityStoreStrategy, activate: boolean = false): EntityStore {\n    const existingStrategy = this.strategies.find((_strategy: EntityStoreStrategy) => {\n      return strategy.constructor === _strategy.constructor;\n    });\n    if (existingStrategy !== undefined) {\n      throw new Error('A strategy of this type already exists on that EntityStore.');\n    }\n\n    this.strategies.push(strategy);\n    strategy.bindStore(this);\n\n    if (activate === true) {\n      strategy.activate();\n    }\n\n    return this;\n  }\n\n  /**\n   * Remove a strategy from this store\n   * @param strategy Entity store strategy\n   * @returns Entity store\n   */\n  removeStrategy(strategy: EntityStoreStrategy): EntityStore {\n    const index = this.strategies.indexOf(strategy);\n    if (index >= 0) {\n      this.strategies.splice(index, 1);\n      strategy.unbindStore(this);\n    }\n    return this;\n  }\n\n  /**\n   * Return strategies of a given type\n   * @param type Entity store strategy class\n   * @returns Strategies\n   */\n  getStrategyOfType(type: typeof EntityStoreStrategy): EntityStoreStrategy {\n    return this.strategies.find((strategy: EntityStoreStrategy) => {\n      return strategy instanceof type;\n    });\n  }\n\n  /**\n   * Activate strategies of a given type\n   * @param type Entity store strategy class\n   */\n  activateStrategyOfType(type: typeof EntityStoreStrategy) {\n    const strategy = this.getStrategyOfType(type);\n    if (strategy !== undefined) {\n      strategy.activate();\n    }\n  }\n\n  /**\n   * Deactivate strategies of a given type\n   * @param type Entity store strategy class\n   */\n  deactivateStrategyOfType(type: typeof EntityStoreStrategy) {\n    const strategy = this.getStrategyOfType(type);\n    if (strategy !== undefined) {\n      strategy.deactivate();\n    }\n  }\n\n  /**\n   * Generate a complete index of all the entities\n   * @param entities Entities\n   * @returns Index\n   */\n  private generateIndex(entities: E[]): Map<EntityKey, E> {\n    const entries = entities.map((entity: E) => [this.getKey(entity), entity]);\n    return new Map(entries as [EntityKey, E][]);\n  }\n\n  /**\n   * Push the index's entities into the entities$ observable\n   */\n  private next() {\n    this.entities$.next(Array.from(this.index.values()));\n    this.updateCount();\n  }\n\n  /**\n   * Update the store's count and empty\n   */\n  private updateCount() {\n    const count = this.index.size;\n    const empty = count === 0;\n    this.count$.next(count);\n    this.empty$.next(empty);\n  }\n\n  /**\n   * Create the entity state manager\n   * @returns EntityStateManager\n   */\n  private createStateManager() {\n    return new EntityStateManager<E, S>({store: this});\n  }\n\n  /**\n   * Create the data view\n   * @returns EntityView<E>\n   */\n  private createDataView() {\n    return new EntityView<E>(this.entities$);\n  }\n\n  /**\n   * Create the state view\n   * @returns EntityView<EntityRecord<E>>\n   */\n  private createStateView() {\n    return new EntityView<E, EntityRecord<E, S>>(this.view.all$())\n      .join({\n        source: this.state.change$,\n        reduce: (entity: E): EntityRecord<E, S> => {\n          const key = this.getKey(entity);\n          const state = this.state.get(entity);\n          const currentRecord = this.stateView.get(key);\n\n          if (\n            currentRecord !== undefined &&\n            currentRecord.entity === entity &&\n            this.statesAreTheSame(currentRecord.state, state)\n          ) {\n            return currentRecord;\n          }\n\n          const revision = currentRecord ? currentRecord.revision + 1 : 1;\n          const ref = `${key}-${revision}`;\n          return {entity, state, revision, ref};\n        }\n      })\n      .createIndex((record: EntityRecord<E, S>) => this.getKey(record.entity));\n  }\n\n  private statesAreTheSame(currentState: S, newState: S): boolean {\n    if (currentState === newState) {\n      return true;\n    }\n\n    const currentStateIsEmpty = Object.keys(currentState).length === 0;\n    const newStateIsEmpty = Object.keys(newState).length === 0;\n    return currentStateIsEmpty && newStateIsEmpty;\n  }\n\n}\n","import { ChangeDetectorRef } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { skip } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { EntityKey } from './entity.interfaces';\n\nimport { EntityStore } from './store';\n\n/**\n * This class is used to synchronize a component's changes\n * detection with an EntityStore changes. For example, it is frequent\n * to have a component subscribe to a store's selected entity and, at the same time,\n * this component provides a way to select an entity with, let's say, a click.\n *\n * This class automatically handles those case and triggers the compoent's\n * change detection when needed.\n *\n * Note: If the component observes the store's stateView, a workspace is\n * probably not required because the stateView catches any changes to the\n * entities and their state.\n */\nexport class EntityStoreWatcher<E extends object> {\n\n  /**\n   * Component change detector\n   */\n  private cdRef: ChangeDetectorRef;\n\n  /**\n   * Entity store\n   */\n  private store: EntityStore<E>;\n\n  /**\n   * Component inner state\n   */\n  private innerStateIndex = new Map<EntityKey, {[key: string]: any}>();\n\n  /**\n   * Subscription to the store's entities\n   */\n  private entities$$: Subscription;\n\n  /**\n   * Subscription to the store's state\n   */\n  private state$$: Subscription;\n\n  constructor(store?: EntityStore<E>, cdRef?: ChangeDetectorRef) {\n    this.setChangeDetector(cdRef);\n    this.setStore(store);\n  }\n\n  destroy() {\n    this.setChangeDetector(undefined);\n    this.setStore(undefined);\n  }\n\n  /**\n   * Bind this workspace to a store and start watching for changes\n   * @param store Entity store\n   */\n  setStore(store?: EntityStore<E>) {\n    if (store === undefined) {\n      this.teardownObservers();\n      this.innerStateIndex.clear();\n      this.store = undefined;\n      return;\n    }\n\n    this.setStore(undefined);\n    this.store = store;\n    this.setupObservers();\n    this.detectChanges();\n  }\n\n  /**\n   * Bind this workspace to a component's change detector\n   * @param cdRef Change detector\n   */\n  setChangeDetector(cdRef?: ChangeDetectorRef) {\n    this.cdRef = cdRef;\n  }\n\n  /**\n   * Set up observers on a store's entities and their state\n   * @param store Entity store\n   */\n  private setupObservers() {\n    this.teardownObservers();\n\n    this.entities$$ = this.store.entities$\n      .subscribe((entities: E[]) => this.onEntitiesChange(entities));\n\n    this.state$$ = this.store.state.change$\n      .pipe(skip(1))\n      .subscribe(() => this.onStateChange());\n  }\n\n  /**\n   * Teardown store observers\n   */\n  private teardownObservers() {\n    if (this.entities$$ !== undefined) {\n      this.entities$$.unsubscribe();\n    }\n    if (this.state$$ !== undefined) {\n      this.state$$.unsubscribe();\n    }\n    this.entities$$ = undefined;\n    this.state$$ = undefined;\n  }\n\n  /**\n   * When the entities change, always trigger the changes detection\n   */\n  private onEntitiesChange(entities: E[]) {\n    this.detectChanges();\n  }\n\n  /**\n   * When the entities state change, trigger the change detection\n   * only if the component has not handled these changes yet. For example,\n   * the component might have initiated thoses changes itself.\n   */\n  private onStateChange() {\n    let changesDetected = false;\n    const storeIndex = this.store.state.index;\n    const innerIndex = this.innerStateIndex;\n\n    if (storeIndex.size !== innerIndex.size) {\n      changesDetected = this.detectChanges();\n    }\n\n    const storeKeys = Array.from(storeIndex.keys());\n    for (const key of storeKeys) {\n      const storeValue = storeIndex.get(key);\n      const innerValue = innerIndex.get(key);\n      if (changesDetected === false) {\n        if (innerValue === undefined) {\n          changesDetected = this.detectChanges();\n        } else if (!ObjectUtils.objectsAreEquivalent(storeValue, innerValue)) {\n          changesDetected = this.detectChanges();\n        }\n      }\n\n      this.innerStateIndex.set(key, Object.assign({}, storeValue));\n    }\n  }\n\n  /**\n   * Trigger the change detection of the workspace is bound to a change detector\n   */\n  private detectChanges() {\n    if (this.cdRef !== undefined) {\n      this.cdRef.detectChanges();\n    }\n    return true;\n  }\n\n}\n","import { BehaviorSubject } from 'rxjs';\n\nimport { EntityStoreStrategyOptions } from '../entity.interfaces';\nimport { EntityStore } from '../store';\n\n/**\n * Entity store strategies. They can do pretty much anything during a store's\n * lifetime. For example, they may act as triggers when something happens.\n * Sharing a strategy is a good idea when multiple strategies would have\n * on cancelling effect on each other.\n *\n * At creation, strategy is inactive and needs to be manually activated.\n */\nexport class EntityStoreStrategy {\n\n  /**\n   * Feature store\n   * @internal\n   */\n  protected stores: EntityStore[] = [];\n\n  /**\n   * Whether this strategy is active\n   * @internal\n   */\n  get active(): boolean { return this.active$.value; }\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  constructor(protected options: EntityStoreStrategyOptions = {}) {\n    this.options = options;\n  }\n\n  /**\n   * Activate the strategy. If it's already active, it'll be deactivated\n   * and activated again.\n   */\n  activate() {\n    if (this.active === true) {\n      this.doDeactivate();\n    }\n    this.active$.next(true);\n    this.doActivate();\n  }\n\n  /**\n   * Activate the strategy. If it's already active, it'll be deactivated\n   * and activated again.\n   */\n  deactivate() {\n    this.active$.next(false);\n    this.doDeactivate();\n  }\n\n  /**\n   * Bind this strategy to a store\n   * @param store Feature store\n   */\n  bindStore(store: EntityStore) {\n    if (this.stores.indexOf(store) < 0) {\n      this.stores.push(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from store\n   * @param store Feature store\n   */\n  unbindStore(store: EntityStore) {\n    const index = this.stores.indexOf(store);\n    if (index >= 0) {\n      this.stores.splice(index, 1);\n    }\n  }\n\n  /**\n   * Do the stataegy activation\n   * @internal\n   */\n  protected doActivate() {}\n\n  /**\n   * Do the strategy deactivation\n   * @internal\n   */\n  protected doDeactivate() {}\n\n}\n","import { EntityStoreStrategyFuncOptions } from '../entity.interfaces';\nimport { EntityStore } from '../store';\nimport { EntityStoreStrategy } from './strategy';\n\n/**\n * When active, this strategy filters a store's stateView to return\n * selected entities only.\n */\nexport class EntityStoreFilterCustomFuncStrategy extends EntityStoreStrategy {\n\n  constructor(protected options: EntityStoreStrategyFuncOptions) {\n    super(options);\n  }\n\n  /**\n   * Store / filter ids map\n   */\n  private filters: Map<EntityStore, string> = new Map();\n\n  /**\n   * Bind this strategy to a store and start filtering it\n   * @param store Entity store\n   */\n  bindStore(store: EntityStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.filterStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop filtering it\n   * @param store Entity store\n   */\n  unbindStore(store: EntityStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unfilterStore(store);\n    }\n  }\n\n  /**\n   * Start filtering all stores\n   * @internal\n   */\n  protected doActivate() {\n    this.filterAll();\n  }\n\n  /**\n   * Stop filtering all stores\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unfilterAll();\n  }\n\n  /**\n   * Filter all stores\n   */\n  private filterAll() {\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\n  }\n\n  /**\n   * Unfilter all stores\n   */\n  private unfilterAll() {\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\n  }\n\n  /**\n   * Filter a store and add it to the filters map\n   */\n  private filterStore(store: EntityStore) {\n    this.filters.set(store, store.stateView.addFilter(this.options.filterClauseFunc));\n  }\n\n  /**\n   * Unfilter a store and delete it from the filters map\n   */\n  private unfilterStore(store: EntityStore) {\n    const filterId = this.filters.get(store);\n    if (filterId === undefined) {\n      return;\n    }\n\n    store.stateView.removeFilter(filterId);\n    this.filters.delete(store);\n  }\n}\n","import { EntityRecord } from '../entity.interfaces';\nimport { EntityStore } from '../store';\nimport { EntityStoreStrategy } from './strategy';\n\n/**\n * When active, this strategy filters a store's stateView to return\n * selected entities only.\n */\nexport class EntityStoreFilterSelectionStrategy extends EntityStoreStrategy {\n\n  /**\n   * Store / filter ids map\n   */\n  private filters: Map<EntityStore, string> = new Map();\n\n  /**\n   * Bind this strategy to a store and start filtering it\n   * @param store Entity store\n   */\n  bindStore(store: EntityStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.filterStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop filtering it\n   * @param store Entity store\n   */\n  unbindStore(store: EntityStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unfilterStore(store);\n    }\n  }\n\n  /**\n   * Start filtering all stores\n   * @internal\n   */\n  protected doActivate() {\n    this.filterAll();\n  }\n\n  /**\n   * Stop filtering all stores\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unfilterAll();\n  }\n\n  /**\n   * Filter all stores\n   */\n  private filterAll() {\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\n  }\n\n  /**\n   * Unfilter all stores\n   */\n  private unfilterAll() {\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\n  }\n\n  /**\n   * Filter a store and add it to the filters map\n   */\n  private filterStore(store: EntityStore) {\n    if (this.filters.has(store)) {\n      return;\n    }\n\n    const filter = (record: EntityRecord<object>) => {\n      return record.state.selected === true;\n    };\n    this.filters.set(store, store.stateView.addFilter(filter));\n  }\n\n  /**\n   * Unfilter a store and delete it from the filters map\n   */\n  private unfilterStore(store: EntityStore) {\n    const filterId = this.filters.get(store);\n    if (filterId === undefined) {\n      return;\n    }\n\n    store.stateView.removeFilter(filterId);\n    this.filters.delete(store);\n  }\n}\n","<mat-form-field class=\"igo-entity-selector\">\n  <mat-select\n    [disabled]=\"disabled\"\n    [value]=\"selected$ | async\"\n    [multiple]=\"multi\"\n    [placeholder]=\"placeholder\"\n    (selectionChange)=\"onSelectionChange($event)\">\n    <mat-option *ngIf=\"emptyText !== undefined && multi === false\" [value]=\"emptyValue\">{{emptyText}}</mat-option>\n    <mat-option *ngIf=\"multi === true\" [value]=\"multiSelectValue\">{{multiText$ | async}}</mat-option>\n    <ng-template ngFor let-record [ngForOf]=\"store.stateView.all$() | async\">\n      <mat-option [value]=\"record.entity\">\n        {{titleAccessor(record.entity)}}\n      </mat-option>\n    </ng-template>\n  </mat-select>\n</mat-form-field>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { EntityRecord } from '../shared/entity.interfaces';\nimport { EntityStore } from '../shared/store';\nimport { EntityStoreWatcher } from '../shared/watcher';\nimport { getEntityTitle } from '../shared/entity.utils';\n\n@Component({\n  selector: 'igo-entity-selector',\n  templateUrl: './entity-selector.component.html',\n  styleUrls: ['./entity-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class EntitySelectorComponent implements OnInit, OnDestroy {\n\n  /**\n   * The selected entity\n   * @internal\n   */\n  readonly selected$ = new BehaviorSubject<object>(undefined);\n\n  /**\n   * The current multi select option text\n   * @internal\n   */\n  readonly multiText$ = new BehaviorSubject<string>(undefined);\n\n  readonly multiSelectValue = {id: 'IGO_MULTI_SELECT'};\n\n  readonly emptyValue = {id: 'IGO_EMPTY_SELECT'};\n\n  /**\n   * Subscription to the selected entity\n   */\n  private selected$$: Subscription;\n\n  /**\n   * Store watcher\n   */\n  private watcher: EntityStoreWatcher<object>;\n\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Title accessor\n   */\n  @Input() titleAccessor: (object) => string = getEntityTitle;\n\n  /**\n   * Text to display when nothing is selected\n   */\n  @Input() emptyText: string = undefined;\n\n  /**\n   * Wheter selecting many entities is allowed\n   */\n  @Input() multi: boolean = false;\n\n  /**\n   * Text to display for the select all option\n   */\n  @Input() multiAllText: string = 'All';\n\n  /**\n   * Text to display for the select none option\n   */\n  @Input() multiNoneText: string = 'None';\n\n  /**\n   * Field placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Wheter the selector is disabled or not\n   */\n  @Input() disabled: boolean = false;\n\n  /**\n   * Event emitted when the selection changes\n   */\n  @Output() selectedChange = new EventEmitter<{\n    selected: boolean;\n    value: object | object[];\n  }>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Create a store watcher and subscribe to the selected entity\n   * @internal\n   */\n  ngOnInit() {\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n    this.selected$$ = this.store.stateView\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\n      .subscribe((records: EntityRecord<object>[]) => {\n        const entities = records.map((record: EntityRecord<object>) => record.entity);\n        this.onSelectFromStore(entities);\n      });\n  }\n\n  /**\n   * Unsubscribe to the selected entity and destroy the store watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n    this.selected$$.unsubscribe();\n  }\n\n  /**\n   * On selection change, update the store's state and emit an event\n   * @internal\n   */\n  onSelectionChange(event: {value: object | undefined}) {\n    const values = event.value instanceof Array ? event.value : [event.value];\n\n    const multiSelect = values.find((_value: object) => _value === this.multiSelectValue);\n    let entities = values.filter((_value: object) => _value !== this.multiSelectValue);\n    if (multiSelect !== undefined) {\n      if (entities.length === this.store.count) {\n        entities = [];\n      } else if (entities.length < this.store.count) {\n        entities = this.store.all();\n      }\n    }\n\n    entities = entities.filter((entity: object) => entity !== this.emptyValue);\n    if (entities.length === 0) {\n      this.store.state.updateAll({selected: false});\n    } else {\n      this.store.state.updateMany(entities, {selected: true}, true);\n    }\n\n    const value = this.multi ? entities : event.value;\n    this.selectedChange.emit({selected: true, value});\n  }\n\n  private onSelectFromStore(entities: object[]) {\n    if (this.multi === true) {\n      this.selected$.next(entities);\n    } else {\n      const entity = entities.length > 0 ? entities[0] : undefined;\n      this.selected$.next(entity);\n    }\n\n    this.updateMultiToggleWithEntities(entities);\n  }\n\n  private updateMultiToggleWithEntities(entities: object[]) {\n    if (entities.length === this.store.count && this.multiText$.value !== this.multiNoneText) {\n      this.multiText$.next(this.multiNoneText);\n    } else if (entities.length < this.store.count && this.multiText$.value !== this.multiAllText) {\n      this.multiText$.next(this.multiAllText);\n    }\n  }\n\n}\n","import { Directive, HostListener } from '@angular/core';\n\n@Directive({\n  selector: '[igoStopPropagation]'\n})\nexport class StopPropagationDirective {\n  @HostListener('click', ['$event'])\n  public onClick(event: any): void {\n    event.stopPropagation();\n  }\n}\n","import {\n  Directive,\n  Input,\n  ElementRef,\n  Renderer2,\n  EventEmitter,\n  Output,\n  HostListener\n} from '@angular/core';\n\nimport scrollIntoView from 'scroll-into-view-if-needed';\n\nimport { EntityTableScrollBehavior } from '../shared/entity.enums';\n\n/**\n * Directive that handles an entity table row click and selection.\n */\n@Directive({\n  selector: '[igoEntityTableRow]'\n})\nexport class EntityTableRowDirective {\n\n  /**\n   * Class added to a selected row\n   */\n  static selectedCls = 'igo-entity-table-row-selected';\n\n  /**\n   * Class added to a highlighted row\n   */\n  static highlightedCls = 'igo-entity-table-row-highlighted';\n\n  /**\n   * Whether a row supports selection\n   */\n  @Input() selection = false;\n\n  /**\n   * Whether clicking a row should select it (if selection is true)\n   */\n  @Input() selectOnClick: boolean = true;\n\n  /**\n   * Whether the selected row should be highlighted\n   */\n  @Input() highlightSelection: boolean = true;\n\n  /**\n   * Whether a row is selected\n   */\n  @Input()\n  set selected(value: boolean) {\n    if (this.selection === false) { return; }\n    if (value === this._selected) { return; }\n\n    this.toggleSelected(value);\n    this.scroll();\n  }\n  get selected(): boolean {\n    return this._selected;\n  }\n  private _selected = false;\n\n  /**\n   * Scroll behavior on selection\n   */\n  @Input()\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\n\n  /**\n   * Event emitted when a row is selected\n   */\n  @Output() select = new EventEmitter<EntityTableRowDirective>();\n\n  /**\n   * When a row is clicked, select it if it's supported\n   * @ignore\n   */\n  @HostListener('click')\n  onClick() {\n    if (this.selection === false || this.selectOnClick === false) {\n      return;\n    }\n\n    this.toggleSelected(true);\n    this.select.emit(this);\n  }\n\n  constructor(private renderer: Renderer2, private el: ElementRef) {}\n\n  /**\n   * Select a row and add or remove the selected class from it\n   * @param selected Whether the row should be selected\n   */\n  private toggleSelected(selected: boolean) {\n    this._selected = selected;\n    if (selected === true) {\n      this.addCls(EntityTableRowDirective.selectedCls);\n      if (this.highlightSelection === true) {\n        this.addCls(EntityTableRowDirective.highlightedCls);\n      }\n    } else {\n      this.removeCls(EntityTableRowDirective.selectedCls);\n      this.removeCls(EntityTableRowDirective.highlightedCls);\n    }\n  }\n\n  /**\n   * Scroll to the selected row\n   */\n  private scroll() {\n    if (this._selected === true) {\n      scrollIntoView(this.el.nativeElement, {\n        scrollMode: 'if-needed',\n        behavior: 'smooth',\n        block: 'end',\n        inline: 'nearest'\n      });\n    }\n  }\n\n  /**\n   * Add the selected CSS class\n   */\n  private addCls(cls: string) {\n    this.renderer.addClass(this.el.nativeElement, cls);\n  }\n\n  /**\n   * Remove the selected CSS class\n   */\n  private removeCls(cls: string) {\n    this.renderer.removeClass(this.el.nativeElement, cls);\n  }\n}\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnChanges,\n  ViewChild,\n  Output,\n  EventEmitter,\n  OnDestroy\n} from '@angular/core';\n\nimport {\n  EntityStore\n} from '../shared';\nimport { MatPaginator, PageEvent } from '@angular/material/paginator';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LanguageService, MediaService } from '@igo2/core';\nimport { EntityTablePaginatorOptions } from './entity-table-paginator.interface';\n\n@Component({\n  selector: 'igo-entity-table-paginator',\n  templateUrl: './entity-table-paginator.component.html',\n  styleUrls: ['./entity-table-paginator.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class EntityTablePaginatorComponent implements OnChanges, OnDestroy {\n\n  public disabled: boolean = false;\n  public hidePageSize: boolean = false;\n  public pageIndex: number = 0;\n  public pageSize: number = 50;\n  public pageSizeOptions: number[] = [5, 10, 20, 50, 100, 200];\n  public showFirstLastButtons: boolean = true;\n  private count$$: Subscription;\n  private entitySortChange$$: Subscription;\n  private paginationLabelTranslation$$: Subscription[] = [];\n\n  @Input() entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Paginator options\n   */\n  @Input()\n  paginatorOptions: EntityTablePaginatorOptions;\n\n  /**\n   * Event emitted when the paginator changes the page size or page index.\n   */\n  @Output() page: EventEmitter<PageEvent>;\n\n  public length: number = 0;\n\n  /**\n   * Paginator emitted.\n   */\n  @Output() paginatorChange: EventEmitter<MatPaginator> = new EventEmitter<MatPaginator>();\n\n  constructor(private languageService: LanguageService, private mediaService: MediaService) {}\n\n  @ViewChild(MatPaginator, { static: true }) paginator: MatPaginator;\n\n  ngOnChanges() {\n    this.unsubscribeAll();\n    this.count$$ = this.store.stateView.count$.subscribe((count) => {\n      this.length = count;\n      this.emitPaginator();\n    });\n    this.entitySortChange$$ = this.entitySortChange$.subscribe(() => {\n      if (this.paginator) {\n        this.paginator.firstPage();\n      }\n    });\n    this.initPaginatorOptions();\n    this.translateLabels();\n  }\n\n  initPaginatorOptions() {\n    this.disabled = this.paginatorOptions?.disabled || this.disabled;\n    this.pageIndex = this.paginatorOptions?.pageIndex || this.pageIndex;\n    this.pageSize = this.paginatorOptions?.pageSize || this.pageSize;\n    this.pageSizeOptions = this.paginatorOptions?.pageSizeOptions || this.pageSizeOptions;\n    if (this.mediaService.isMobile()) {\n      this.showFirstLastButtons = false;\n      this.hidePageSize = true;\n    } else {\n      this.showFirstLastButtons = this.paginatorOptions?.showFirstLastButtons || this.showFirstLastButtons;\n      this.hidePageSize = this.paginatorOptions?.hidePageSize || this.hidePageSize;\n    }\n  }\n\n  translateLabels() {\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.firstPageLabel').subscribe((label: string) => {\n        this.paginator._intl.firstPageLabel = label;\n      }));\n\n    this.paginator._intl.getRangeLabel = this.rangeLabel;\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.itemsPerPageLabel').subscribe((label: string) => {\n        this.paginator._intl.itemsPerPageLabel = label;\n      }));\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.lastPageLabel').subscribe((label: string) => {\n        this.paginator._intl.lastPageLabel = label;\n      }));\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.nextPageLabel').subscribe((label: string) => {\n        this.paginator._intl.nextPageLabel = label;\n      }));\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.previousPageLabel').subscribe((label: string) => {\n        this.paginator._intl.previousPageLabel = label;\n      }));\n  }\n\n  rangeLabel = (page: number, pageSize: number, length: number) => {\n    const of: BehaviorSubject<string> = new BehaviorSubject('');\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.of').subscribe((label: string) => {\n        of.next(label);\n      }));\n    if (length === 0 || pageSize === 0) { return `0 ${of.value} ${length}`; }\n    length = Math.max(length, 0);\n    const startIndex = page * pageSize;\n    const endIndex = startIndex < length ?\n        Math.min(startIndex + pageSize, length) :\n        startIndex + pageSize;\n    return `${startIndex + 1} - ${endIndex} ${of.value} ${length}`;\n  }\n\n  private unsubscribeAll() {\n    this.paginationLabelTranslation$$.map(sub => sub.unsubscribe());\n    if (this.count$$) { this.count$$.unsubscribe(); }\n    if (this.entitySortChange$$) { this.entitySortChange$$.unsubscribe(); }\n  }\n\n  ngOnDestroy(): void {\n    this.unsubscribeAll();\n  }\n\n  emitPaginator() {\n    this.paginatorChange.emit(this.paginator);\n  }\n}\n","<mat-paginator \n  [disabled]=\"disabled\"\n  [hidePageSize]=\"hidePageSize\"\n  [length]=\"length\"\n  [pageIndex]=\"pageIndex\"\n  [pageSize]=\"pageSize\"\n  [pageSizeOptions]=\"pageSizeOptions\"\n  [showFirstLastButtons]=\"showFirstLastButtons\"\n  (page)=\"emitPaginator()\">\n</mat-paginator>\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\n\nimport { Cacheable } from 'ts-cacheable';\nimport { Observable } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\n\n@Pipe({\n  name: 'secureImage'\n})\nexport class SecureImagePipe implements PipeTransform {\n  constructor(private http: HttpClient) {}\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  transform(url: string): Observable<string> {\n    const headers = new HttpHeaders({\n      'Content-Type': 'text/plain',\n      activityInterceptor: 'false'\n    });\n\n    return this.http\n      .get(url, {\n        headers,\n        responseType: 'blob'\n      })\n      .pipe(\n        switchMap((blob) => {\n          return new Observable((observer) => {\n            const reader = new FileReader();\n            reader.readAsDataURL(blob);\n            reader.onloadend = () => {\n              observer.next(reader.result);\n              observer.complete();\n            };\n          });\n        })\n      ) as Observable<string>;\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml } from '@angular/platform-browser';\n\n@Pipe({ name: 'sanitizeHtml' })\nexport class SanitizeHtmlPipe implements PipeTransform {\n  constructor(private _sanitizer: DomSanitizer) {\n  }\n  transform(v: string): SafeHtml {\n    return this._sanitizer.bypassSecurityTrustHtml(v);\n  }\n}\n","<div class=\"table-container\">\n  <table\n    mat-table\n    matSort\n    [ngClass]=\"getTableClass()\"\n    [dataSource]=\"dataSource\"\n    [trackBy]=\"getTrackByFunction()\"\n    (matSortChange)=\"onSort($event)\">\n\n    <ng-container matColumnDef=\"selectionCheckbox\" class=\"mat-cell-checkbox\">\n      <th mat-header-cell *matHeaderCellDef>\n        <ng-container *ngIf=\"selectMany\">\n          <ng-container *ngIf=\"selectionState$ | async as selectionState\">\n            <mat-checkbox (change)=\"onToggleRows($event.checked)\"\n                          [checked]=\"selectionState === entityTableSelectionState.All\"\n                          [indeterminate]=\"selectionState === entityTableSelectionState.Some\">\n            </mat-checkbox>\n          </ng-container>\n        </ng-container>\n      </th>\n      <td mat-cell *matCellDef=\"let record\">\n        <mat-checkbox (mousedown)=\"$event.shiftKey ? $event.preventDefault() : null\"\n                      (click)=\"$event.shiftKey ? onShiftToggleRow(!rowIsSelected(record), record, $event) : $event.stopPropagation()\"\n                      (change)=\"onToggleRow($event.checked, record)\"\n                      [checked]=\"rowIsSelected(record)\">\n        </mat-checkbox>\n      </td>\n    </ng-container>\n\n    <ng-container [matColumnDef]=\"column.name\" *ngFor=\"let column of template.columns\">\n      <ng-container *ngIf=\"columnIsSortable(column)\">\n        <th mat-header-cell *matHeaderCellDef mat-sort-header>\n          {{column.title}}\n        </th>\n      </ng-container>\n\n      <ng-container *ngIf=\"!columnIsSortable(column)\">\n        <th mat-header-cell *matHeaderCellDef>\n          {{column.title}}\n        </th>\n      </ng-container>\n\n      <ng-container *ngIf=\"getColumnRenderer(column) as columnRenderer\">\n        <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.Default\">\n            <ng-container *matCellDef=\"let record\">\n              <td mat-cell class=\"mat-cell-text\" *ngIf=\"!isUrl(getValue(record, column));else isAnUrlDefault\"\n                [ngClass]=\"getCellClass(record, column)\">\n                {{getValue(record, column)}}\n              </td>\n              <ng-template #isAnUrlDefault>\n                <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                  <a href=\"{{getValue(record, column)}}\" target='_blank' rel=\"noopener noreferrer\" (click)=\"$event.stopPropagation()\">\n                    <img *ngIf=\"isImg(getValue(record, column));else notImg\" src=\"{{(getValue(record, column) | secureImage) | async}}\" width=\"50\" heigth=\"auto\">\n                    <ng-template #notImg><span>{{ 'igo.common.entity-table.targetHtmlUrl' | translate }} </span></ng-template>\n                  </a>\n                </td>\n              </ng-template>\n            </ng-container>\n          </ng-container>\n          <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.HTML\">\n            <ng-container *matCellDef=\"let record\">\n              <td mat-cell class=\"mat-cell-text\" *ngIf=\"!isUrl(getValue(record, column));else isAnUrlHTML\"\n                [ngClass]=\"getCellClass(record, column)\"\n                [innerHTML]=\"getValue(record, column)\">\n              </td>\n              <ng-template #isAnUrlHTML>\n                <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                  <a href=\"{{getValue(record, column)}}\" target='_blank' rel=\"noopener noreferrer\" (click)=\"$event.stopPropagation()\">\n                    <img *ngIf=\"isImg(getValue(record, column));else notImg\" src=\"{{(getValue(record, column) | secureImage) | async}}\" width=\"50\" heigth=\"auto\">\n                    <ng-template #notImg><span>{{ 'igo.geo.targetHtmlUrl' | translate }} </span></ng-template>\n                  </a>\n                </td>\n              </ng-template>\n            </ng-container>\n          </ng-container>\n          <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.UnsanitizedHTML\">\n            <ng-container *matCellDef=\"let record\">\n              <td mat-cell class=\"mat-cell-text\" *ngIf=\"!isUrl(getValue(record, column));else isAnUrlUnsanitizedHTML\"\n                [ngClass]=\"getCellClass(record, column)\"\n                [innerHTML]=\"getValue(record, column) | sanitizeHtml\">\n              </td>\n              <ng-template #isAnUrlUnsanitizedHTML>\n                <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                  <a href=\"{{getValue(record, column)}}\" target='_blank' rel=\"noopener noreferrer\" (click)=\"$event.stopPropagation()\">\n                    <img *ngIf=\"isImg(getValue(record, column));else notImg\" src=\"{{(getValue(record, column) | secureImage) | async}}\" width=\"50\" heigth=\"auto\">\n                    <ng-template #notImg><span>{{ 'igo.geo.targetHtmlUrl' | translate }} </span></ng-template>\n                  </a>\n                </td>\n              </ng-template>\n            </ng-container>\n          </ng-container>\n          <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.Icon\">\n            <td mat-cell *matCellDef=\"let record\" class=\"mat-cell-text\"\n              [ngClass]=\"getCellClass(record, column)\">\n              <mat-icon svgIcon=\"{{getValue(record, column)}}\"></mat-icon>\n            </td>\n          </ng-container>\n          <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.ButtonGroup\">\n            <td mat-cell *matCellDef=\"let record\" class=\"mat-cell-text\"\n              [ngClass]=\"getCellClass(record, column)\">\n              <span *ngFor=\"let button of getValue(record, column)\">\n                <button *ngIf=\"button.style === 'mat-icon-button'\"\n                  igoStopPropagation\n                  mat-icon-button\n                  [color]=\"button.color\"\n                  (click)=\"onButtonClick(button.click, record)\">\n                  <mat-icon svgIcon=\"{{button.icon}}\"></mat-icon>\n                </button>\n                <button *ngIf=\"button.style !== 'mat-icon-button'\"\n                  igoStopPropagation\n                  mat-mini-fab\n                  [color]=\"button.color\"\n                  (click)=\"onButtonClick(button.click, record)\">\n                  <mat-icon svgIcon=\"{{button.icon}}\"></mat-icon>\n                </button>\n              </span>\n            </td>\n          </ng-container>\n      </ng-container>\n    </ng-container>\n\n    <tr\n      mat-header-row\n      *matHeaderRowDef=\"headers; sticky: fixedHeader;\"\n      [ngClass]=\"getHeaderClass()\">\n    </tr>\n    <tr\n      mat-row\n      igoEntityTableRow\n      *matRowDef=\"let record; columns: headers;\"\n      [scrollBehavior]=\"scrollBehavior\"\n      [ngClass]=\"getRowClass(record)\"\n      [selection]=\"selection\"\n      [selected]=\"rowIsSelected(record)\"\n      (select)=\"onRowSelect(record)\"\n      (click)=\"onRowClick(record)\">\n    </tr>\n  </table>\n  <igo-entity-table-paginator *ngIf=\"withPaginator\"\n    [store]=\"store\"\n    [paginatorOptions]=\"paginatorOptions\"\n    [entitySortChange$]=\"entitySortChange$\"\n    (paginatorChange)=\"paginatorChange($event)\">\n  </igo-entity-table-paginator>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy,\n  OnChanges,\n  SimpleChanges\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport {\n  EntityKey,\n  EntityRecord,\n  EntityState,\n  EntityStore,\n  EntityTableTemplate,\n  EntityTableColumn,\n  EntityTableColumnRenderer,\n  EntityTableSelectionState,\n  EntityTableScrollBehavior\n} from '../shared';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { MatTableDataSource } from '@angular/material/table';\nimport { EntityTablePaginatorOptions } from '../entity-table-paginator/entity-table-paginator.interface';\n\n@Component({\n  selector: 'igo-entity-table',\n  templateUrl: './entity-table.component.html',\n  styleUrls: ['./entity-table.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class EntityTableComponent implements OnInit, OnChanges, OnDestroy {\n\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Reference to the column renderer types\n   * @internal\n   */\n  entityTableColumnRenderer = EntityTableColumnRenderer;\n\n  /**\n   * Reference to the selection's state\n   * @internal\n   */\n  entityTableSelectionState = EntityTableSelectionState;\n\n  /**\n   * Observable of the selection,s state\n   * @internal\n   */\n  readonly selectionState$: BehaviorSubject<EntityTableSelectionState> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the store's selection\n   */\n  private selection$$: Subscription;\n\n  /**\n   * Subscription to the dataSource\n   */\n  private dataSource$$: Subscription;\n\n  /**\n   * The last record checked. Useful for selecting\n   * multiple records by holding the shift key and checking\n   * checkboxes.\n   */\n  private lastRecordCheckedKey: EntityKey;\n\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Table paginator\n   */\n  @Input() set paginator(value: MatPaginator) {\n    this._paginator = value;\n    this.dataSource.paginator = value;\n  }\n\n  get paginator(): MatPaginator {\n    return this._paginator;\n  }\n  private _paginator: MatPaginator;\n\n  /**\n   * Table template\n   */\n  @Input() template: EntityTableTemplate;\n\n  /**\n   * Scroll behavior on selection\n   */\n  @Input()\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\n\n  /**\n   * Whether nulls should be first when sorting\n   */\n  @Input()\n  sortNullsFirst: boolean = false;\n\n  /**\n   * Show the table paginator or not. False by default.\n   */\n  @Input()\n  withPaginator: boolean = false;\n\n  /**\n   * Paginator options\n   */\n  @Input()\n  paginatorOptions: EntityTablePaginatorOptions;\n\n  /**\n   * Event emitted when an entity (row) is clicked\n   */\n  @Output() entityClick = new EventEmitter<object>();\n\n  /**\n   * Event emitted when an entity (row) is selected\n   */\n  @Output() entitySelectChange = new EventEmitter<{\n    added: object[];\n  }>();\n\n  /**\n   * Event emitted when the table sort is changed.\n   */\n  @Output() entitySortChange: EventEmitter<{column: EntityTableColumn, direction: string}> = new EventEmitter(undefined);\n\n  /**\n   * Table headers\n   * @internal\n   */\n  get headers(): string[] {\n    let columns = this.template.columns\n      .filter((column: EntityTableColumn) => column.visible !== false)\n      .map((column: EntityTableColumn) => column.name);\n\n    if (this.selectionCheckbox === true) {\n      columns = ['selectionCheckbox'].concat(columns);\n    }\n\n    return columns;\n  }\n\n  /**\n   * Data source consumable by the underlying material table\n   * @internal\n   */\n  dataSource = new MatTableDataSource<object>();\n\n  /**\n   * Whether selection is supported\n   * @internal\n   */\n  get selection(): boolean { return this.template.selection || false; }\n\n  /**\n   * Whether a selection checkbox should be displayed\n   * @internal\n   */\n  get selectionCheckbox(): boolean { return this.template.selectionCheckbox || false; }\n\n  /**\n   * Whether selection many entities should eb supported\n   * @internal\n   */\n  get selectMany(): boolean { return this.template.selectMany || false; }\n\n  /**\n   * Whether selection many entities should eb supported\n   * @internal\n   */\n  get fixedHeader(): boolean { return this.template.fixedHeader === undefined ? true : this.template.fixedHeader; }\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Track the selection state to properly display the selection checkboxes\n   * @internal\n   */\n  ngOnInit() {\n    this.handleDatasource();\n    this.dataSource.paginator = this.paginator;\n  }\n\n  /**\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const store = changes.store;\n    if (store && store.currentValue !== store.previousValue) {\n      this.handleDatasource();\n    }\n  }\n\n  private handleDatasource() {\n    this.unsubscribeStore();\n    this.selection$$ = this.store.stateView\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\n      .subscribe((records: EntityRecord<object>[]) => {\n        const firstSelected = records[0];\n        const firstSelectedStateviewPosition = this.store.stateView.all().indexOf(firstSelected);\n        const pageMax = this.paginator ? this.paginator.pageSize * (this.paginator.pageIndex + 1) : 0;\n        const pageMin = this.paginator ? pageMax - this.paginator.pageSize : 0;\n\n        if (\n          this.paginator &&\n          (firstSelectedStateviewPosition < pageMin ||\n          firstSelectedStateviewPosition >= pageMax)) {\n          const pageToReach = Math.floor(firstSelectedStateviewPosition / this.paginator.pageSize);\n          this.dataSource.paginator.pageIndex = pageToReach;\n        }\n        this.selectionState$.next(this.computeSelectionState(records));\n      });\n    this.dataSource$$ = this.store.stateView.all$().subscribe((all) => {\n      this.dataSource.data = all;\n    });\n\n  }\n\n  /**\n   * Unbind the store watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unsubscribeStore();\n  }\n\n  private unsubscribeStore() {\n    if (this.selection$$) {\n      this.selection$$.unsubscribe();\n    }\n    if (this.dataSource$$) {\n      this.dataSource$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Trackby function\n   * @param record Record\n   * @param index Record index\n   * @internal\n   */\n  getTrackByFunction() {\n    return (index: number, record: EntityRecord<object, EntityState>) => {\n      return record.ref;\n    };\n  }\n\n  /**\n   * Trigger a refresh of thre table. This can be useful when\n   * the data source doesn't emit a new value but for some reason\n   * the records need an update.\n   * @internal\n   */\n  refresh() {\n    this.cdRef.detectChanges();\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.paginator = event;\n  }\n\n  /**\n   * On sort, sort the store\n   * @param event Sort event\n   * @internal\n   */\n  onSort(event: {active: string, direction: string}) {\n    const direction = event.direction;\n    const column = this.template.columns\n      .find((c: EntityTableColumn) => c.name === event.active);\n\n    if (direction === 'asc' || direction === 'desc') {\n      this.store.stateView.sort({\n        valueAccessor: (record: EntityRecord<object>) => this.getValue(record, column),\n        direction,\n        nullsFirst: this.sortNullsFirst\n      });\n      this.entitySortChange.emit({column, direction});\n      this.entitySortChange$.next(true);\n    } else {\n      this.store.stateView.sort(undefined);\n    }\n  }\n\n  /**\n   * When an entity is clicked, emit an event\n   * @param record Record\n   * @internal\n   */\n  onRowClick(record: EntityRecord<object>) {\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n    this.entityClick.emit(record.entity);\n  }\n\n  /**\n   * When an entity is selected, select it in the store and emit an event. Even if\n   * \"many\" is set to true, this method always select a single, exclusive row. Selecting\n   * multiple rows should be achieved by using the checkboxes.\n   * @param record Record\n   * @internal\n   */\n  onRowSelect(record: EntityRecord<object>) {\n    if (this.selection === false) { return; }\n\n    const entity = record.entity;\n    this.store.state.update(entity, {selected: true}, true);\n    this.entitySelectChange.emit({added: [entity]});\n  }\n\n  /**\n   * Select or unselect all rows at once. On select, emit an event.\n   * @param toggle Select or unselect\n   * @internal\n   */\n  onToggleRows(toggle: boolean) {\n    if (this.selection === false) { return; }\n\n    this.store.state.updateAll({selected: toggle});\n    if (toggle === true) {\n      const entities = this.store.stateView\n        .all()\n        .map((record: EntityRecord<object>) => record.entity);\n      this.entitySelectChange.emit({added: [entities]});\n    }\n  }\n\n  /**\n   * When an entity is toggled, select or unselect it in the store. On select,\n   * emit an event.\n   * @param toggle Select or unselect\n   * @param record Record\n   * @internal\n   */\n  onToggleRow(toggle: boolean, record: EntityRecord<object>) {\n    if (this.selection === false) { return; }\n\n    const entity = record.entity;\n    const exclusive = toggle === true && !this.selectMany;\n    this.store.state.update(entity, {selected: toggle}, exclusive);\n    if (toggle === true) {\n      this.entitySelectChange.emit({added: [entity]});\n    }\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n  }\n\n  /**\n   * When an entity is toggled, select or unselect it in the store. On select,\n   * emit an event.\n   * @param toggle Select or unselect\n   * @param record Record\n   * @internal\n   */\n  onShiftToggleRow(toggle: boolean, record: EntityRecord<object>, event: MouseEvent) {\n    if (this.selection === false) { return; }\n\n    if (this.selectMany === false || this.lastRecordCheckedKey === undefined) {\n      this.onToggleRow(toggle, record);\n      return;\n    }\n\n    // This is a workaround mat checkbox wrong behavior\n    // when the shift key is held.\n    // See https://github.com/angular/components/issues/6232\n    const range = window.document.createRange();\n    range.selectNode(event.target as HTMLElement);\n    window.getSelection().removeAllRanges();\n    window.getSelection().addRange(range);\n    event.stopImmediatePropagation();\n\n    const records = this.store.stateView.all();\n    const recordIndex = records.indexOf(record);\n    const lastRecordChecked = this.store.stateView.get(this.lastRecordCheckedKey);\n    const lastRecordIndex = records.indexOf(lastRecordChecked);\n    const indexes = [recordIndex, lastRecordIndex];\n    const selectRecords = records.slice(Math.min(...indexes), Math.max(...indexes) + 1);\n\n    const entities = selectRecords.map((_record: EntityRecord<object>) => _record.entity);\n    this.store.state.updateMany(entities, {selected: toggle});\n    if (toggle === true) {\n      this.entitySelectChange.emit({added: entities});\n    }\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n  }\n\n  /**\n   * Compute the selection state\n   * @returns Whether all, some or no rows are selected\n   * @internal\n   */\n  private computeSelectionState(selectedRecords: EntityRecord<object>[]): EntityTableSelectionState {\n    const states = EntityTableSelectionState;\n    const selectionCount = selectedRecords.length;\n    return selectionCount === 0 ?\n      states.None :\n      (selectionCount === this.store.stateView.count ? states.All : states.Some);\n  }\n\n  /**\n   * Whether a column is sortable\n   * @param column Column\n   * @returns True if a column is sortable\n   * @internal\n   */\n  columnIsSortable(column: EntityTableColumn): boolean {\n    let sortable = column.sort;\n    if (sortable === undefined) {\n      sortable = this.template.sort === undefined ? false : this.template.sort;\n    }\n    return sortable;\n  }\n\n  /**\n   * Whether a row is should be selected based on the underlying entity state\n   * @param record Record\n   * @returns True if a row should be selected\n   * @internal\n   */\n  rowIsSelected(record: EntityRecord<object>): boolean {\n    const state = record.state;\n    return state.selected ? state.selected : false;\n  }\n\n  isImg(value) {\n    if (this.isUrl(value)) {\n      return (\n        ['jpg', 'png', 'gif'].indexOf(value.split('.').pop().toLowerCase()) !== -1\n      );\n    } else {\n      return false;\n    }\n  }\n\n  isUrl(value) {\n    if (typeof value === 'string') {\n      return (\n        value.slice(0, 8) === 'https://' || value.slice(0, 7) === 'http://'\n      );\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Method to access an entity's values\n   * @param record Record\n   * @param column Column\n   * @returns Any value\n   * @internal\n   */\n  getValue(record: EntityRecord<object>, column: EntityTableColumn): any {\n    const entity = record.entity;\n    if (column.valueAccessor !== undefined) {\n      return column.valueAccessor(entity, record);\n    }\n    if (this.template.valueAccessor !== undefined) {\n      return this.template.valueAccessor(entity, column.name, record);\n    }\n    return this.store.getProperty(entity, column.name);\n  }\n\n  /**\n   * Return the type of renderer of a column\n   * @param column Column\n   * @returns Renderer type\n   * @internal\n   */\n  getColumnRenderer(column: EntityTableColumn): EntityTableColumnRenderer {\n    if (column.renderer !== undefined) {\n      return column.renderer;\n    }\n    return EntityTableColumnRenderer.Default;\n  }\n\n  /**\n   * Return the table ngClass\n   * @returns ngClass\n   * @internal\n   */\n  getTableClass(): {[key: string]: boolean} {\n    return {\n      'igo-entity-table-with-selection': this.selection\n    };\n  }\n\n  /**\n   * Return a header ngClass\n   * @returns ngClass\n   * @internal\n   */\n  getHeaderClass(): {[key: string]: boolean} {\n    const func = this.template.headerClassFunc;\n    if (func instanceof Function) {\n      return func();\n    }\n    return {};\n  }\n\n  /**\n   * Return a row ngClass\n   * @param record Record\n   * @returns ngClass\n   * @internal\n   */\n  getRowClass(record: EntityRecord<object>): {[key: string]: boolean} {\n    const entity = record.entity;\n    const func = this.template.rowClassFunc;\n    if (func instanceof Function) {\n      return func(entity, record);\n    }\n    return {};\n  }\n\n  /**\n   * Return a row ngClass\n   * @param record Record\n   * @param column Column\n   * @returns ngClass\n   * @internal\n   */\n  getCellClass(record: EntityRecord<object>, column: EntityTableColumn): {[key: string]: boolean} {\n    const entity = record.entity;\n    const cls = {};\n\n    const tableFunc = this.template.cellClassFunc;\n    if (tableFunc instanceof Function) {\n      Object.assign(cls, tableFunc(entity, column, record));\n    }\n\n    const columnFunc = column.cellClassFunc;\n    if (columnFunc instanceof Function) {\n      Object.assign(cls, columnFunc(entity, record));\n    }\n\n    return cls;\n  }\n\n  /**\n   * When a button is clicked\n   * @param func Function\n   * @param record Record\n   * @internal\n   */\n  onButtonClick(\n    clickFunc: (entity: object, record?: EntityRecord<object>) => void,\n    record: EntityRecord<object>\n  ) {\n    if (typeof clickFunc === 'function') {\n      clickFunc(record.entity, record);\n    }\n  }\n\n}\n","export enum ActionbarMode {\n  Dock = 'dock',\n  Overlay = 'overlay',\n  Context = 'context'\n}\n","<mat-list-item *ngIf=\"!action.checkbox\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\"\n  (click)=\"onClick()\">\n  <button *ngIf=\"withIcon\"\n    mat-list-avatar\n    mat-icon-button\n    [color]=\"color\"\n    [disabled]=\"disabled$ | async\">\n    <mat-icon *ngIf=\"withIcon\" svgIcon=\"{{icon$ | async}}\"></mat-icon>\n  </button>\n  <h4 *ngIf=\"withTitle\" matLine>{{title | translate}}</h4>\n</mat-list-item>\n\n<mat-list-item class=\"item-checkbox\" *ngIf=\"action.checkbox\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\">\n  <mat-checkbox *ngIf=\"withTitle\"\n      (change)=\"action.handler()\"\n      [checked]=\"checkCondition$ | async\">\n      {{title | translate}}\n  </mat-checkbox>\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription, isObservable } from 'rxjs';\n\nimport { Action } from '../shared/action.interfaces';\n\n /**\n  * An action button\n  */\n@Component({\n  selector: 'igo-actionbar-item',\n  templateUrl: './actionbar-item.component.html',\n  styleUrls: ['./actionbar-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ActionbarItemComponent implements OnInit, OnDestroy {\n\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly checkCondition$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly tooltip$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly noDisplay$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly ngClass$: BehaviorSubject<{[key: string]: boolean}> = new BehaviorSubject({});\n\n  private ngClass$$: Subscription;\n\n  private disabled$$: Subscription;\n\n  private availability$$: Subscription;\n\n  private icon$$: Subscription;\n\n  private checkCondition$$: Subscription;\n\n  private tooltip$$: Subscription;\n\n  private noDisplay$$: Subscription;\n\n  private display$$: Subscription;\n\n  /**\n   * Action\n   */\n  @Input() action: Action;\n\n  /**\n   * Color\n   */\n  @Input() color = 'default';\n\n  /**\n   * Whether the action title is displayed\n   */\n  @Input() withTitle = true;\n\n  /**\n   * Whether the action icon is displayed\n   */\n  @Input() withIcon = true;\n\n  /**\n   * Whether a tooltip should be shown\n   */\n  @Input() withTooltip = true;\n\n  /**\n   * Whether the action is disabled\n   */\n  @Input()\n  set disabled(value: boolean) { this.disabled$.next(value); }\n  get disabled(): boolean { return this.disabled$.value; }\n\n  /**\n   * Whether the action is display or not\n   */\n  @Input()\n  set noDisplay(value: boolean) { this.noDisplay$.next(value); }\n  get noDisplay(): boolean { return this.noDisplay$.value; }\n\n  /**\n   * Event emitted when the action button is clicked\n   */\n  @Output() trigger: EventEmitter<Action> = new EventEmitter();\n\n  /**\n   * @internal\n   */\n  get title(): string { return this.action.title; }\n\n  constructor() {}\n\n  ngOnInit() {\n    const args = this.action.args || [];\n\n    if (this.action.ngClass !== undefined) {\n      this.ngClass$$ = this.action.ngClass(...args)\n        .subscribe((ngClass: {[key: string]: boolean}) => this.updateNgClass(ngClass));\n    }\n\n    if (isObservable(this.action.icon)) {\n      this.icon$$ = this.action.icon\n        .subscribe((icon: string) => this.updateIcon(icon));\n    } else {\n      this.updateIcon(this.action.icon);\n    }\n\n    if (isObservable(this.action.checkCondition)) {\n      this.checkCondition$$ = this.action.checkCondition\n        .subscribe((checkCondition: boolean) => this.updateCheckCondition(checkCondition));\n    } else {\n      this.updateCheckCondition(this.action.checkCondition);\n    }\n\n    if (isObservable(this.action.tooltip)) {\n      this.tooltip$$ = this.action.tooltip\n        .subscribe((tooltip: string) => this.updateTooltip(tooltip));\n    } else {\n      this.updateTooltip(this.action.tooltip);\n    }\n\n    if (this.action.availability !== undefined) {\n      this.availability$$ = this.action.availability(...args)\n        .subscribe((available: boolean) => this.disabled = !available);\n    }\n\n    this.disabled$$ = this.disabled$\n      .subscribe((disabled: boolean) => this.updateNgClass({'igo-actionbar-item-disabled': disabled}));\n\n    if (this.action.display !== undefined) {\n      this.display$$ = this.action.display(...args)\n        .subscribe((display: boolean) => this.noDisplay = !display);\n    }\n\n    this.noDisplay$$ = this.noDisplay$\n      .subscribe((noDisplay: boolean) => this.updateNgClass({'igo-actionbar-item-no-display': noDisplay}));\n  }\n\n  ngOnDestroy() {\n    if (this.ngClass$$ !== undefined) {\n      this.ngClass$$.unsubscribe();\n      this.ngClass$$ = undefined;\n    }\n\n    if (this.availability$$ !== undefined) {\n      this.availability$$.unsubscribe();\n      this.availability$$ = undefined;\n    }\n\n    if (this.display$$ !== undefined) {\n      this.display$$.unsubscribe();\n      this.display$$ = undefined;\n    }\n\n    if (this.checkCondition$$ !== undefined) {\n      this.checkCondition$$.unsubscribe();\n      this.checkCondition$$ = undefined;\n    }\n\n    if (this.icon$$ !== undefined) {\n      this.icon$$.unsubscribe();\n      this.icon$$ = undefined;\n    }\n\n    if (this.tooltip$$ !== undefined) {\n      this.tooltip$$.unsubscribe();\n      this.tooltip$$ = undefined;\n    }\n\n    this.disabled$$.unsubscribe();\n    this.noDisplay$$.unsubscribe();\n  }\n\n  /**\n   * When the action button is clicked, emit the 'trigger' event but don't\n   * invoke the action handler. This is handled by the parent component.\n   * @internal\n   */\n  onClick() {\n    if (this.disabled === true) {\n      return;\n    }\n    this.trigger.emit(this.action);\n  }\n\n  private updateNgClass(ngClass: {[key: string]: boolean}) {\n    this.ngClass$.next(Object.assign({}, this.ngClass$.value, ngClass));\n  }\n\n  private updateTooltip(tooltip: string) {\n    this.tooltip$.next(tooltip);\n  }\n\n  private updateCheckCondition(checkCondition: boolean) {\n    this.checkCondition$.next(checkCondition);\n  }\n\n  private updateIcon(icon: string) {\n    this.icon$.next(icon);\n  }\n}\n","<mat-list *ngIf=\"mode === actionbarMode.Dock\">\n\n    <div *ngIf=\"heightCondition && positionConditionTop && isDesktop\"\n      id=\"topChevron\">\n      <button\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.common.actionbar.scrollUp' | translate\"\n        (click)=\"scrollUp()\">\n        <mat-icon svgIcon=\"chevron-up\"></mat-icon>\n      </button>\n    </div>\n\n    <igo-actionbar-item\n      *ngIf=\"withToggleButton\"\n      color=\"accent\"\n      [withTitle]=\"false\"\n      [withIcon]=\"true\"\n      [color]=\"color\"\n      [disabled]=\"store.view.empty\"\n      [action]=\"toggleCollapseAction\"\n      (trigger)=\"onTriggerAction(toggleCollapseAction)\">\n    </igo-actionbar-item>\n\n    <ng-template #buttonContent *ngIf=\"!collapsed\" ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n      <igo-actionbar-item\n        color=\"accent\"\n        [withTitle]=\"withTitle\"\n        [withIcon]=\"withIcon\"\n        [withTooltip]=\"withTooltip\"\n        [color]=\"color\"\n        [disabled]=\"store.state.get(action).disabled\"\n        [action]=\"action\"\n        (trigger)=\"onTriggerAction(action)\">\n      </igo-actionbar-item>\n    </ng-template>\n\n    <div *ngIf=\"heightCondition && positionConditionLow && isDesktop\"\n      id=\"lowChevron\">\n      <button\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.common.actionbar.scrollDown' | translate\"\n        (click)=\"scrollDown()\">\n        <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n      </button>\n    </div>\n\n</mat-list>\n\n<div *ngIf=\"mode === actionbarMode.Overlay\">\n  <button class=\"buttonOverlay\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.common.actionbar.icon' | translate\"\n    [matMenuTriggerFor]=\"actionbarMenu\"\n    [disabled]=\"store.view.empty\"\n    [color]=\"iconColor\">\n    <mat-icon [svgIcon]=\"icon\"></mat-icon>\n  </button>\n\n  <mat-menu\n    #actionbarMenu=\"matMenu\"\n    class=\"igo-compact-menu igo-no-min-width-menu\"\n    overlapTrigger=\"true\"\n    [xPosition]=\"xPosition\"\n    [yPosition]=\"yPosition\"\n    [class]=\"overlayClass\">\n\n    <mat-list>\n      <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n        <igo-actionbar-item\n          color=\"accent\"\n          [withTitle]=\"withTitle\"\n          [withIcon]=\"withIcon\"\n          [color]=\"color\"\n          [action]=\"action\"\n          (trigger)=\"onTriggerAction(action)\">\n        </igo-actionbar-item>\n      </ng-template>\n    </mat-list>\n  </mat-menu>\n</div>\n<mat-card *ngIf=\"mode === actionbarMode.Context\" class=\"context-menu-card mat-elevation-z4\">\n  <mat-list>\n      <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n          <igo-actionbar-item\n            color=\"accent\"\n            [withTitle]=\"withTitle\"\n            [withIcon]=\"withIcon\"\n            [color]=\"color\"\n            [action]=\"action\"\n            (trigger)=\"onTriggerAction(action)\">\n          </igo-actionbar-item>\n        <br/>\n      </ng-template>\n  </mat-list>\n</mat-card>\n","import {\n  Component,\n  Input,\n  HostBinding,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy,\n  OnChanges,\n  OnDestroy,\n  SimpleChanges,\n  ElementRef\n} from '@angular/core';\n\nimport { MediaService, Media } from '@igo2/core';\nimport { EntityStoreWatcher } from '../../entity';\nimport { Action } from '../shared/action.interfaces';\nimport { ActionbarMode } from '../shared/action.enums';\nimport { ActionStore } from '../shared/store';\nimport { Overlay } from '@angular/cdk/overlay';\nimport { BehaviorSubject } from 'rxjs';\n\n/**\n * A list of action buttons.\n * This component can be displayed in one of two way: 'dock' or 'overlay'\n */\n@Component({\n  selector: 'igo-actionbar',\n  templateUrl: './actionbar.component.html',\n  styleUrls: ['./actionbar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ActionbarComponent implements OnDestroy, OnChanges {\n\n  /**\n   * Reference to the ActionbarMode enum for use in the template\n   * @internal\n   */\n  actionbarMode = ActionbarMode;\n\n  /**\n   * Whether the actionbar is collapsed (Dock mode)\n   * @internal\n   */\n  collapsed = false;\n\n  /**\n   * Toggle collapse action (Dock)\n   * @internal\n   */\n  toggleCollapseAction = {\n    id: 'actionbar_toggle',\n    icon: 'dots-vertical',\n    handler: () => {\n      this.collapsed = !this.collapsed;\n    }\n  };\n\n  /**\n   * Action store watcher\n   * @internal\n   */\n  private watcher: EntityStoreWatcher<Action>;\n\n  /**\n   * Height Condition for scroll button\n   */\n  heightCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n\n  /**\n   * Position Condition for top scroll button\n   */\n  positionConditionTop$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(true);\n\n  /**\n   * Position Condition for low scroll button\n   */\n  positionConditionLow$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(true);\n\n  /**\n   * Action store\n   */\n  @Input() store: ActionStore;\n\n  /**\n   * Actionbar mode\n   */\n  @Input() mode: ActionbarMode = ActionbarMode.Dock;\n\n  /**\n   * Whether a toggle button should be displayed (Dock mode)\n   */\n  @Input() withToggleButton = false;\n\n  /**\n   * Whether a the actionbar should display buttons horizontally\n   */\n  @Input() horizontal = false;\n\n  /**\n   * Color\n   */\n  @Input() color = 'default';\n\n  /**\n   * Color of the button if action mode === overlay\n   */\n  @Input() iconColor = 'default';\n\n  /**\n   * Whether action titles are displayed\n   */\n  @Input() withTitle = true;\n\n  /**\n   * Whether action tooltips are displayed\n   */\n  @Input() withTooltip = true;\n\n  /**\n   * Whether action titles are displayed (condition for scroll button)\n   */\n  @Input() scrollActive = true;\n\n  /**\n   * Whether action icons are displayed\n   */\n  @Input() withIcon = true;\n\n  /**\n   * Which icon want to be shown\n   */\n  @Input() icon = 'dots-horizontal';\n\n  /**\n   * Overlay X position\n   */\n  @Input() xPosition = 'before';\n\n  /**\n   * Overlay Y position\n   */\n  @Input() yPosition = 'above';\n\n  /**\n   * Class to add to the actionbar overlay\n   */\n  @Input()\n  set overlayClass(value: string) {\n    this._overlayClass = value;\n  }\n  get overlayClass(): string {\n    return [this._overlayClass, 'igo-actionbar-overlay'].join(' ');\n  }\n  private _overlayClass = '';\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.with-title')\n  get withTitleClass() {\n    return this.withTitle;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.with-icon')\n  get withIconClass() {\n    return this.withIcon;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.horizontal')\n  get horizontalClass() {\n    return this.horizontal;\n  }\n\n  get heightCondition(): boolean {\n    const el = this.elRef.nativeElement;\n    if (this.scrollActive === false) {\n      if (el.clientHeight < el.scrollHeight) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  get positionConditionTop(): boolean {\n    if (this.elRef.nativeElement.scrollTop === 0) {\n      return false;\n    }\n    return true;\n  }\n\n  get positionConditionLow(): boolean {\n    const el = this.elRef.nativeElement;\n    if (el.scrollTop >= (el.scrollHeight - el.clientHeight)) {\n      return false;\n    }\n    return true;\n  }\n\n  get isDesktop(): boolean {\n    return this.mediaService.getMedia() === Media.Desktop;\n  }\n\n  constructor(\n    public overlay: Overlay,\n    private elRef: ElementRef,\n    private cdRef: ChangeDetectorRef,\n    public mediaService: MediaService) {}\n\n  /**\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const store = changes.store;\n    if (store && store.currentValue !== store.previousValue) {\n      if (this.watcher !== undefined) {\n        this.watcher.destroy();\n      }\n      this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n    }\n  }\n\n  /**\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n  }\n\n  /**\n   * Invoke the action handler\n   * @internal\n   */\n  onTriggerAction(action: Action) {\n    const args = action.args || [];\n    action.handler(...args);\n  }\n\n  scrollDown() {\n    this.elRef.nativeElement.scrollBy(0, 52);\n  }\n\n  scrollUp() {\n    this.elRef.nativeElement.scrollBy(0, -52);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { ActionbarComponent } from './actionbar.component';\nimport { ActionbarItemComponent } from './actionbar-item.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatMenuModule,\n    MatListModule,\n    MatCardModule,\n    MatCheckboxModule\n  ],\n  exports: [ActionbarComponent],\n  declarations: [ActionbarComponent, ActionbarItemComponent]\n})\nexport class IgoActionbarModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoActionbarModule } from './actionbar/actionbar.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoActionbarModule\n  ],\n  exports: [\n    IgoActionbarModule\n  ],\n  declarations: [],\n  providers: []\n})\nexport class IgoActionModule {}\n","import { Directive, Input, ElementRef, OnInit } from '@angular/core';\nimport { MatIconRegistry } from '@angular/material/icon';\n\n\n/**\n * This directive allow to add an icon inside a matBadge.\n * A value must be set into the matBadge directive ex: matBadge=\"icon\".\n * The badge content will be overrided by this current directive.\n */\n@Directive({\n  selector: '[igoMatBadgeIcon]'\n})\nexport class IgoBadgeIconDirective implements OnInit {\n  @Input()\n  set igoMatBadgeIcon(value: string) {\n    this.matIconRegistry.getNamedSvgIcon(value).subscribe((svgObj) => {\n      this.svg = svgObj;\n      this.updateSvg();\n    });\n  }\n  private svg: SVGElement;\n\n  @Input()\n  set matBadgeHidden(value: boolean) {\n    this.hidden = value;\n    this.updateHidden();\n  }\n  private hidden = false;\n\n  @Input()\n  set matBadgeDisabled(value: boolean) {\n    this.disabled = value;\n    this.updateDisabled();\n  }\n  private disabled = false;\n\n  @Input()\n  set igoMatBadgeInverseColor(value: boolean) {\n    this.inverseColor = value;\n    this.updateColor();\n  }\n  private inverseColor = false;\n\n  @Input()\n  set igoMatBadgeInheritColor(value: boolean) {\n    this.inheritColor = value;\n    this.updateColor();\n  }\n  private inheritColor = false;\n\n  get badge() {\n    return this.el.nativeElement.querySelector('.mat-badge-content');\n  }\n\n  private originalColor: string;\n\n  constructor(\n    private el: ElementRef,\n    private matIconRegistry: MatIconRegistry\n  ) {}\n\n  ngOnInit() {\n    this.badge.style.alignItems = 'center';\n    this.badge.style.justifyContent = 'center';\n\n    this.updateHidden();\n    this.updateColor();\n    this.updateSvg();\n  }\n\n  private updateSvg() {\n    if (!this.badge) {\n      return;\n    }\n    this.badge.innerHTML = '';\n    if (this.svg) {\n      this.badge.appendChild(this.svg);\n    }\n  }\n  private updateColor() {\n    if (!this.badge) {\n      return;\n    }\n\n    if (this.inheritColor) {\n      if (this.inverseColor) {\n        this.badge.style.color = 'currentColor';\n        this.badge.style.background = 'none';\n      } else {\n        this.badge.style.color = '';\n        this.badge.style.background = 'currentColor';\n      }\n    } else {\n      if (this.inverseColor) {\n        this.badge.style.color = window\n          .getComputedStyle(this.badge, null)\n          .getPropertyValue('background-color');\n        this.badge.style.background = 'none';\n      } else {\n        this.badge.style.color = '';\n        this.badge.style.background = '';\n      }\n    }\n    this.originalColor = this.badge.style.color;\n    this.updateDisabled();\n  }\n\n  private updateHidden() {\n    if (!this.badge) {\n      return;\n    }\n    this.badge.style.display = this.hidden ? 'none' : 'flex';\n  }\n\n  private updateDisabled() {\n    if (!this.badge || !this.inverseColor) {\n      return;\n    }\n    if (this.disabled) {\n      this.originalColor = this.badge.style.color;\n      this.badge.style.color = '#b9b9b9';\n    } else {\n      this.badge.style.color = this.originalColor;\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { IgoBadgeIconDirective } from './badge-icon.directive';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatIconModule } from '@angular/material/icon';\n\n@NgModule({\n  imports: [MatBadgeModule, MatIconModule],\n  declarations: [IgoBadgeIconDirective],\n  exports: [MatBadgeModule, IgoBadgeIconDirective]\n})\nexport class IgoMatBadgeIconModule {\n  static forRoot(): ModuleWithProviders<IgoMatBadgeIconModule> {\n    return {\n      ngModule: IgoMatBadgeIconModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Output\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoClickout]'\n})\nexport class ClickoutDirective {\n  @Output() clickout = new EventEmitter<MouseEvent>();\n\n  @HostListener('document:click', ['$event', '$event.target'])\n  handleMouseClick(event: MouseEvent, target: HTMLElement) {\n    if (!target) {\n      return;\n    }\n\n    if (!this.el.nativeElement.contains(target)) {\n      this.clickout.emit(event);\n    }\n  }\n\n  constructor(private el: ElementRef) {}\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { ClickoutDirective } from './clickout.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [ClickoutDirective],\n  exports: [ClickoutDirective]\n})\nexport class IgoClickoutModule {\n  static forRoot(): ModuleWithProviders<IgoClickoutModule> {\n    return {\n      ngModule: IgoClickoutModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  HostListener,\n  ElementRef,\n  Renderer2\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoCollapse]'\n})\nexport class CollapseDirective {\n  @Input()\n  get target() {\n    return this._target;\n  }\n  set target(value: Element) {\n    this._target = value;\n  }\n  private _target: Element;\n\n  @Input()\n  get collapsed(): boolean {\n    return this._collapsed;\n  }\n  set collapsed(collapsed: boolean) {\n    collapsed ? this.collapseTarget() : this.expandTarget();\n    this._collapsed = collapsed;\n    this.toggle.emit(collapsed);\n  }\n  private _collapsed = false;\n\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\n\n  @HostListener('click')\n  click() {\n    this.collapsed = !this.collapsed;\n  }\n\n  constructor(private renderer: Renderer2, private el: ElementRef) {}\n\n  private collapseTarget() {\n    this.renderer.addClass(this.target, 'igo-collapsed');\n    this.renderer.addClass(this.el.nativeElement, 'collapsed');\n  }\n\n  private expandTarget() {\n    this.renderer.removeClass(this.target, 'igo-collapsed');\n    this.renderer.removeClass(this.el.nativeElement, 'collapsed');\n  }\n}\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\n\n@Component({\n  selector: 'igo-collapsible',\n  templateUrl: './collapsible.component.html',\n  styleUrls: ['./collapsible.component.scss']\n})\nexport class CollapsibleComponent {\n  @Input()\n  get title() {\n    return this._title;\n  }\n  set title(value: string) {\n    this._title = value;\n  }\n  private _title = '';\n\n  @Input()\n  get collapsed() {\n    return this._collapsed;\n  }\n  set collapsed(value: boolean) {\n    this._collapsed = value;\n    this.toggle.emit(value);\n  }\n  private _collapsed = false;\n\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\n}\n","<mat-list-item>\n  <mat-icon\n    svgIcon=\"chevron-up\" \n    class=\"igo-chevron\"\n    mat-list-avatar\n    igoCollapse\n    [target]=\"content\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"collapsed = $event\">\n  </mat-icon>\n  <h4 matLine>{{title}}</h4>\n</mat-list-item>\n\n<div #content>\n  <ng-content></ng-content>\n</div>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { CollapseDirective } from './collapse.directive';\nimport { CollapsibleComponent } from './collapsible.component';\n\n@NgModule({\n  imports: [MatIconModule, MatListModule],\n  declarations: [CollapsibleComponent, CollapseDirective],\n  exports: [CollapsibleComponent, CollapseDirective]\n})\nexport class IgoCollapsibleModule {\n  static forRoot(): ModuleWithProviders<IgoCollapsibleModule> {\n    return {\n      ngModule: IgoCollapsibleModule,\n      providers: []\n    };\n  }\n}\n","import { Component } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\n@Component({\n  selector: 'igo-confirm-dialog',\n  templateUrl: './confirm-dialog.component.html',\n  styleUrls: ['./confirm-dialog.component.scss']\n})\nexport class ConfirmDialogComponent {\n  public confirmMessage: string;\n\n  constructor(public dialogRef: MatDialogRef<ConfirmDialogComponent>) {}\n}\n","<h2 mat-dialog-title class=\"mat-typography\">{{'igo.common.confirmDialog.title' | translate}}</h2>\n<div mat-dialog-content class=\"mat-typography\">{{confirmMessage}}</div>\n<div mat-dialog-actions>\n  <button mat-button color=\"primary\" (click)=\"dialogRef.close(true)\">{{'igo.common.confirmDialog.confirmBtn' | translate}}</button>\n  <button mat-button (click)=\"dialogRef.close(false)\">{{'igo.common.confirmDialog.cancelBtn' | translate}}</button>\n</div>\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { Observable } from 'rxjs';\n\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\n\n@Injectable()\nexport class ConfirmDialogService {\n  constructor(private dialog: MatDialog) {}\n\n  public open(message: string): Observable<any> {\n    const dialogRef = this.dialog.open(ConfirmDialogComponent, {\n      disableClose: false\n    });\n    dialogRef.componentInstance.confirmMessage = message;\n\n    return dialogRef.afterClosed();\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\nimport { ConfirmDialogService } from './confirm-dialog.service';\n\n@NgModule({\n  imports: [MatButtonModule, MatDialogModule, IgoLanguageModule],\n  declarations: [ConfirmDialogComponent],\n  exports: [ConfirmDialogComponent],\n  providers: [ConfirmDialogService]\n})\nexport class IgoConfirmDialogModule {\n  static forRoot(): ModuleWithProviders<IgoConfirmDialogModule> {\n    return {\n      ngModule: IgoConfirmDialogModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Input,\n  Output,\n  ViewContainerRef\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { TemplatePortal } from '@angular/cdk/portal';\nimport { fromEvent, Subscription } from 'rxjs';\nimport { filter, take } from 'rxjs/operators';\nimport { Overlay, OverlayRef } from '@angular/cdk/overlay';\n\n@Directive({\n  selector: '[igoContextMenu]'\n})\nexport class ContextMenuDirective {\n  private overlayRef: OverlayRef | null;\n  private sub: Subscription;\n\n  @Input('igoContextMenu') menuContext: TemplateRef<any>;\n  @Output() menuPosition = new EventEmitter<{ x: number; y: number }>();\n\n  constructor(\n    public overlay: Overlay,\n    public viewContainerRef: ViewContainerRef,\n    private elementRef: ElementRef\n  ) {}\n\n  @HostListener('contextmenu', ['$event'])\n  public onContextMenu(e: MouseEvent): void {\n    const {x, y} = e;\n    this.close();\n    e.preventDefault();\n    this.menuPosition.emit({ x, y });\n    this.overlayRef = null;\n    const positionStrategy = this.overlay\n      .position()\n      .flexibleConnectedTo({ x, y })\n      .withPositions([\n        {\n          originX: 'end',\n          originY: 'bottom',\n          overlayX: 'start',\n          overlayY: 'top'\n        }\n      ]);\n    this.overlayRef = this.overlay.create({\n      positionStrategy,\n      scrollStrategy: this.overlay.scrollStrategies.close()\n    });\n    this.overlayRef.attach(\n      new TemplatePortal(this.menuContext, this.viewContainerRef, {\n        $implicit: undefined\n      })\n    );\n\n    this.sub = fromEvent<MouseEvent>(document, 'click')\n      .pipe(\n        filter(event => {\n          const clickTarget = event.target as HTMLElement;\n          this.close();\n          return (\n            !!this.overlayRef &&\n            !this.overlayRef.overlayElement.contains(clickTarget)\n          );\n        }),\n        take(1)\n      )\n      .subscribe(() => this.close());\n\n    this.sub = fromEvent<MouseEvent>(document, 'contextmenu')\n      .pipe(\n        filter(event => {\n          const clickTarget = event.target as HTMLElement;\n          if (\n            clickTarget &&\n            !this.elementRef.nativeElement.contains(clickTarget) &&\n            !this.overlayRef.overlayElement.contains(clickTarget)\n          ) {\n            return true;\n          } else {\n            event.preventDefault();\n          }\n        }),\n        take(1)\n      )\n      .subscribe(() => this.close());\n  }\n\n  close() {\n    if (this.overlayRef) {\n      this.overlayRef.dispose();\n      this.overlayRef = null;\n    }\n    if (this.sub) {\n      this.sub.unsubscribe();\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { ContextMenuDirective } from './context-menu.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [ContextMenuDirective],\n  exports: [ContextMenuDirective]\n})\nexport class IgoContextMenuModule {\n  static forRoot(): ModuleWithProviders<IgoContextMenuModule> {\n    return {\n      ngModule: IgoContextMenuModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { CustomHtmlComponent } from './custom-html.component';\nimport { SanitizeHtmlPipe } from './custom-html.pipe';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatInputModule,\n    MatButtonModule,\n    IgoLanguageModule\n  ],\n  exports: [SanitizeHtmlPipe, CustomHtmlComponent],\n  declarations: [SanitizeHtmlPipe, CustomHtmlComponent]\n})\nexport class IgoCustomHtmlModule {\n  static forRoot(): ModuleWithProviders<IgoCustomHtmlModule> {\n    return {\n      ngModule: IgoCustomHtmlModule\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { DragAndDropDirective } from './drag-drop.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [DragAndDropDirective],\n  exports: [DragAndDropDirective]\n})\nexport class IgoDrapDropModule {\n  static forRoot(): ModuleWithProviders<IgoDrapDropModule> {\n    return {\n      ngModule: IgoDrapDropModule,\n      providers: []\n    };\n  }\n}\n","import {\n  ComponentFactory,\n  ComponentRef,\n  ViewContainerRef\n} from '@angular/core';\n\nimport { Observable, Subscription } from 'rxjs';\n\n/**\n * This class is used in the DynamicComponentOutlet component. It holds\n * a reference to a component factory and can render that component\n * in a target element on demand. It's also possible to set inputs\n * and to subscribe to outputs.\n */\nexport class DynamicComponent<C> {\n\n  /**\n   * Component reference\n   */\n  private componentRef: ComponentRef<C>;\n\n  /**\n   * Subscriptions to the component's outputs. Those need\n   * to be unsubscribed when the component is destroyed.\n   */\n  private subscriptions: Subscription[] = [];\n\n  /**\n   * Component target element\n   */\n  private target: ViewContainerRef;\n\n  /**\n   * Component inputs\n   */\n  private inputs: {[key: string]: any} = {};\n\n  /**\n   * Subscriptions to the component's async inputs\n   */\n  private inputs$$: {[key: string]: Subscription} = {};\n\n  /**\n   * Subscribers to the component's outputs\n   */\n  private subscribers: {[key: string]: (event: any) => void} = {};\n\n  constructor(private componentFactory: ComponentFactory<C>) {}\n\n  /**\n   * Render the component to a target element.\n   * Set it's inputs and subscribe to it's outputs.\n   * @param target Target element\n   */\n  setTarget(target: ViewContainerRef) {\n    this.target = target;\n    this.componentRef = target.createComponent(this.componentFactory);\n    this.updateInputs(this.inputs);\n    this.updateSubscribers(this.subscribers);\n  }\n\n  /**\n   * Destroy this component. That means, removing from it's target\n   * element and unsubscribing to it's outputs.\n   */\n  destroy() {\n    if (this.target !== undefined) {\n      this.target.clear();\n    }\n    if (this.componentRef !== undefined) {\n      this.componentRef.destroy();\n      this.componentRef = undefined;\n    }\n    this.unobserveAllInputs();\n    this.unsubscribeAll();\n  }\n\n  /**\n   * Update the component inputs. This is an update so any\n   * key not defined won't be overwritten.\n   */\n  updateInputs(inputs: {[key: string]: any}) {\n    this.inputs = inputs;\n    if (this.componentRef === undefined) {\n      return;\n    }\n\n    const instance = this.componentRef.instance;\n    const allowedInputs = this.componentFactory.inputs;\n    allowedInputs.forEach((value: {propName: string; templateName: string; }) => {\n      const key = value.propName;\n\n      this.unobserveInput(key);\n\n      const inputValue = inputs[key];\n      if (inputs.hasOwnProperty(key)) {\n        if (inputValue instanceof Observable) {\n          this.observeInput(key, inputValue);\n        } else {\n          this.setInputValue(instance, key, inputValue);\n        }\n      }\n    });\n\n    if (typeof (instance as any).onUpdateInputs === 'function') {\n      (instance as any).onUpdateInputs();\n    }\n  }\n\n  /**\n   * Set an instance's input value\n   * @param instance Component instance\n   * @param key Input key\n   * @param value Input value\n   */\n  private setInputValue(instance: C, key: string, value: any) {\n    const currentValue = instance[key];\n    if (value === currentValue) {\n      return;\n    }\n\n    const prototype = Object.getPrototypeOf(instance);\n    const descriptor = Object.getOwnPropertyDescriptor(prototype, key);\n    if (descriptor !== undefined && descriptor.set !== undefined) {\n      descriptor.set.call(instance, value);\n    } else {\n      instance[key] = value;\n    }\n  }\n\n  /**\n   * Update the component subscribers. This is an update so any\n   * key not defined won't be overwritten.\n   */\n  updateSubscribers(subscribers: {[key: string]: (event: any) => void}) {\n    this.subscribers = subscribers;\n    if (this.componentRef === undefined) {\n      return;\n    }\n\n    const instance = this.componentRef.instance;\n    const allowedSubscribers = this.componentFactory.outputs;\n    allowedSubscribers.forEach((value: {propName: string; templateName: string; }) => {\n      const key = value.propName;\n      if (subscribers.hasOwnProperty(key)) {\n        const emitter = instance[key];\n        const subscriber = subscribers[key];\n        if (Array.isArray(subscriber)) {\n          subscriber.forEach((_subscriber) => {\n            this.subscriptions.push(emitter.subscribe(_subscriber));\n          });\n        } else {\n          this.subscriptions.push(emitter.subscribe(subscriber));\n        }\n      }\n    });\n  }\n\n  /**\n   * Subscribe to an observable input and update the component's input value\n   * accordingly\n   * @param key Input key\n   * @param observable Observable\n   */\n  private observeInput(key: string, observable: Observable<any>) {\n    this.inputs$$[key] = observable.subscribe((value: any) => {\n      const instance = this.componentRef.instance;\n      this.setInputValue(instance, key, value);\n\n      if (typeof (instance as any).onUpdateInputs === 'function') {\n        (instance as any).onUpdateInputs();\n      }\n    });\n  }\n\n  /**\n   * Unsubscribe to an observable input\n   * @param key Input key\n   */\n  private unobserveInput(key: string) {\n    if (this.inputs$$[key] !== undefined) {\n      this.inputs$$[key].unsubscribe();\n      this.inputs$$[key] = undefined;\n    }\n  }\n\n  /**\n   * Unsubscribe to all outputs.\n   */\n  private unobserveAllInputs() {\n    Object.values(this.inputs$$).forEach((s: Subscription | undefined) => {\n      if (s !== undefined) {\n        s.unsubscribe();\n      }\n    });\n    this.inputs$$ = {};\n  }\n\n  /**\n   * Unsubscribe to all outputs.\n   */\n  private unsubscribeAll() {\n    this.subscriptions.forEach((s: Subscription) => s.unsubscribe());\n    this.subscriptions = [];\n  }\n\n}\n","import {\n  ComponentFactoryResolver,\n  Injectable\n} from '@angular/core';\n\nimport { DynamicComponent } from './dynamic-component';\n\n/**\n * Service to creates DynamicComponent instances from base component classes\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DynamicComponentService {\n\n  constructor(private resolver: ComponentFactoryResolver) {}\n\n  /**\n   * Creates a DynamicComponent instance from a base component class\n   * @param componentCls The component class\n   * @returns DynamicComponent instance\n   */\n  create(componentCls: any): DynamicComponent<any> {\n    const factory = this.resolver.resolveComponentFactory(componentCls as any);\n    return new DynamicComponent<typeof componentCls>(factory);\n  }\n}\n","import {\n  Input,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy,\n  Component,\n  OnChanges,\n  OnDestroy,\n  SimpleChanges,\n  ViewContainerRef,\n  ViewChild\n} from '@angular/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { DynamicComponent } from '../shared/dynamic-component';\nimport { DynamicComponentService } from '../shared/dynamic-component.service';\n\n@Component({\n  selector: 'igo-dynamic-outlet',\n  templateUrl: 'dynamic-outlet.component.html',\n  styleUrls: ['dynamic-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DynamicOutletComponent implements OnChanges, OnDestroy {\n  /**\n   * The dynamic component base class or the dynamic component itself\n   */\n  @Input() component: DynamicComponent<any> | any;\n\n  /**\n   * The dynamic component inputs\n   */\n  @Input() inputs: { [key: string]: any } = {};\n\n  /**\n   * The subscribers to the dynamic component outputs\n   */\n  @Input() subscribers: { [key: string]: (event: any) => void } = {};\n\n  /**\n   * The dynamic component\n   */\n  private dynamicComponent: DynamicComponent<any>;\n\n  /**\n   * The view element to render the component to\n   * @ignore\n   */\n  @ViewChild('target', { read: ViewContainerRef, static: true })\n  private target: ViewContainerRef;\n\n  constructor(\n    private dynamicComponentService: DynamicComponentService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * If the dynamic component changes, create it.\n   * If the inputs or subscribers change, update the current component's\n   * inputs or subscribers.\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const component = changes.component;\n    const inputs = changes.inputs;\n    const subscribers = changes.subscribers;\n    const eq = ObjectUtils.objectsAreEquivalent;\n\n    if (component && component.currentValue !== component.previousValue) {\n      this.createComponent(component.currentValue);\n    } else {\n      const inputsAreEquivalents =\n        inputs && eq(inputs.currentValue || {}, inputs.previousValue || {});\n      const subscribersAreEquivalents =\n        subscribers &&\n        eq(subscribers.currentValue || {}, subscribers.previousValue || {});\n\n      if (inputsAreEquivalents === false) {\n        this.updateInputs();\n      }\n\n      if (subscribersAreEquivalents === false) {\n        this.updateSubscribers();\n      }\n    }\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * Destroy the dynamic component and all it's subscribers\n   * @internal\n   */\n  ngOnDestroy() {\n    if (this.dynamicComponent) {\n      this.dynamicComponent.destroy();\n    }\n  }\n\n  /**\n   * Create a  DynamicComponent out of the component class and render it.\n   * @internal\n   */\n  private createComponent(component: DynamicComponent<any> | any) {\n    if (this.dynamicComponent !== undefined) {\n      this.dynamicComponent.destroy();\n    }\n    this.dynamicComponent =\n      component instanceof DynamicComponent\n        ? component\n        : this.dynamicComponentService.create(component);\n    this.renderComponent();\n  }\n\n  /**\n   * Create and render the dynamic component. Set it's inputs and subscribers\n   * @internal\n   */\n  private renderComponent() {\n    this.updateInputs();\n    this.updateSubscribers();\n    this.dynamicComponent.setTarget(this.target);\n  }\n\n  /**\n   * Update the dynamic component inputs. This is an update so any\n   * key not defined won't be overwritten.\n   * @internal\n   */\n  private updateInputs() {\n    this.dynamicComponent.updateInputs(this.inputs);\n  }\n\n  /**\n   * Update the dynamic component subscribers. This is an update so any\n   * key not defined won't be overwritten.\n   * @internal\n   */\n  private updateSubscribers() {\n    this.dynamicComponent.updateSubscribers(this.subscribers);\n  }\n}\n","<ng-template #target></ng-template>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { DynamicOutletComponent } from './dynamic-outlet.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    DynamicOutletComponent\n  ],\n  declarations: [\n    DynamicOutletComponent\n  ]\n})\nexport class IgoDynamicOutletModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoDynamicOutletModule } from './dynamic-outlet/dynamic-outlet.module';\nimport { DynamicComponentService } from './shared/dynamic-component.service';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoDynamicOutletModule\n  ],\n  exports: [\n    IgoDynamicOutletModule\n  ],\n  providers: [\n    DynamicComponentService\n  ]\n})\nexport class IgoDynamicComponentModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { FlexibleComponent } from './flexible.component';\n\n@NgModule({\n  imports: [],\n  declarations: [FlexibleComponent],\n  exports: [FlexibleComponent]\n})\nexport class IgoFlexibleModule {\n  static forRoot(): ModuleWithProviders<IgoFlexibleModule> {\n    return {\n      ngModule: IgoFlexibleModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  OnChanges,\n  SimpleChanges,\n  ChangeDetectionStrategy,\n  ViewChild,\n  ElementRef\n} from '@angular/core';\n\nimport t from 'typy';\n\nimport { Form, FormField, FormFieldGroup } from '../shared/form.interfaces';\nimport { getAllFormFields } from '../shared/form.utils';\n\n/**\n * A configurable form\n */\n@Component({\n  selector: 'igo-form',\n  templateUrl: './form.component.html',\n  styleUrls: ['./form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormComponent implements OnChanges {\n\n  /**\n   * Form\n   */\n  @Input() form: Form;\n\n  /**\n   * Input data\n   */\n  @Input() formData: { [key: string]: any};\n\n  /**\n   * Form autocomplete\n   */\n  @Input() autocomplete: string = 'off';\n\n  /**\n   * Event emitted when the form is submitted\n   */\n  @Output() submitForm = new EventEmitter<{[key: string]: any}>();\n\n  @ViewChild('buttons', { static: true }) buttons: ElementRef;\n\n  get hasButtons(): boolean {\n    return this.buttons.nativeElement.children.length !== 0;\n  }\n\n  constructor() {}\n\n  /**\n   * Is the entity or the template change, recreate the form or repopulate it.\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const formData = changes.formData;\n    if (formData && formData.currentValue !== formData.previousValue) {\n      if (formData.currentValue === undefined) {\n        this.clear();\n      } else {\n        this.setData(formData.currentValue);\n      }\n    }\n  }\n\n  /**\n   * Transform the form data to a feature and emit an event\n   * @param event Form submit event\n   * @internal\n   */\n  onSubmit() {\n    this.submitForm.emit(this.getData());\n  }\n\n  getData(): { [key: string]: any} {\n    const data = {};\n    getAllFormFields(this.form).forEach((field: FormField) => {\n      this.updateDataWithFormField(data, field);\n    });\n    return data;\n  }\n\n  private setData(data: {[key: string]: any}) {\n    this.form.fields.forEach((field: FormField) => {\n      field.control.setValue(t(data, field.name).safeObject);\n    });\n\n    this.form.groups.forEach((group: FormFieldGroup) => {\n      group.fields.forEach((field: FormField) => {\n        field.control.setValue(t(data, field.name).safeObject);\n      });\n    });\n  }\n\n  private updateDataWithFormField(data: { [key: string]: any}, field: FormField) {\n    const control = field.control;\n    if (!control.disabled) {\n      data[field.name] = control.value;\n    }\n  }\n\n  /**\n   * Clear form\n   */\n  private clear() {\n    this.form.control.reset();\n  }\n\n}\n","import { AbstractControl } from '@angular/forms';\n\nimport { Form, FormField, FormFieldGroup } from './form.interfaces';\n\nexport function formControlIsRequired(control: AbstractControl): boolean {\n  if (control.validator) {\n    const validator = control.validator({} as AbstractControl);\n    if (validator && validator.required) {\n      return true;\n    }\n  }\n\n  if ((control as any).controls) {\n    const requiredControl = Object.keys((control as any).controls).find((key: string) => {\n      return formControlIsRequired((control as any).controls[key]);\n    });\n    return requiredControl !== undefined;\n  }\n\n  return false;\n}\n\nexport function getDefaultErrorMessages(): {[key: string]: string} {\n  return {\n    required: 'igo.common.form.errors.required'\n  };\n}\n\nexport function getControlErrorMessage(control: AbstractControl, messages: {[key: string]: string}): string {\n  const errors = control.errors || {};\n  const errorKeys = Object.keys(errors);\n  const errorMessages = errorKeys\n    .map((key: string) => messages[key])\n    .filter((message: string) => message !== undefined);\n  return errorMessages.length > 0 ? errorMessages[0] : '';\n}\n\nexport function getAllFormFields(form: Form): FormField[] {\n  return form.groups.reduce((acc: FormField[], group: FormFieldGroup) => {\n    return acc.concat(group.fields);\n  }, [].concat(form.fields));\n}\n\nexport function getFormFieldByName(form: Form, name: string): FormField {\n  const fields = getAllFormFields(form);\n  return fields.find((field: FormField) => {\n    return field.name === name;\n  });\n}\n","\n<form\n  [autocomplete]=\"autocomplete\"\n  [formGroup]=\"form.control\"\n  (ngSubmit)=\"onSubmit()\">\n  <div class=\"igo-form-body\" [ngClass]=\"{'igo-form-body-with-buttons': hasButtons}\">\n    <div class=\"igo-form-content\">\n      <ng-content></ng-content>\n    </div>\n    <div #buttons class=\"igo-form-buttons\">\n      <ng-content select=\"[formButtons]\"></ng-content>\n    </div>\n  </div>\n</form>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { FormComponent } from './form.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule\n  ],\n  exports: [\n    FormComponent,\n    FormsModule,\n    ReactiveFormsModule\n  ],\n  declarations: [\n    FormComponent\n  ]\n})\nexport class IgoFormFormModule {}\n","import { Injectable } from '@angular/core';\nimport { FormBuilder, Validators, ValidatorFn } from '@angular/forms';\n\nimport {\n  Form,\n  FormField,\n  FormFieldConfig,\n  FormFieldGroup,\n  FormFieldGroupConfig\n} from './form.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FormService {\n\n  constructor(private formBuilder: FormBuilder) {}\n\n  form(fields: FormField[], groups: FormFieldGroup[]): Form {\n    const control = this.formBuilder.group({});\n    fields.forEach((field: FormField) => {\n      control.addControl(field.name, field.control);\n    });\n    groups.forEach((group: FormFieldGroup) => {\n      control.addControl(group.name, group.control);\n    });\n\n    return {fields, groups, control};\n  }\n\n  group(config: FormFieldGroupConfig, fields: FormField[]): FormFieldGroup {\n    const options = config.options || {};\n    const control = this.formBuilder.group({});\n    fields.forEach((field: FormField) => {\n      control.addControl(field.name, field.control);\n    });\n\n    const validators = this.getValidators(options.validator); // convert string to actual validator\n    control.setValidators(validators);\n\n    return Object.assign({}, config, {fields, control}) as FormFieldGroup;\n  }\n\n  field(config: FormFieldConfig): FormField {\n    const options = config.options || {};\n    const state = {\n      value: '',\n      disabled: options.disabled\n    };\n    const control = this.formBuilder.control(state);\n\n    const validators = this.getValidators(options.validator); // convert string to actual validator\n    control.setValidators(validators);\n\n    return Object.assign({type: 'text'}, config, {control}) as FormField;\n  }\n\n  extendFieldConfig(config: FormFieldConfig, partial: Partial<FormFieldConfig>): FormFieldConfig {\n    const options = Object.assign({}, config.options || {}, partial.options || {});\n    const inputs = Object.assign({}, config.inputs || {}, partial.inputs || {});\n    const subscribers = Object.assign({}, config.subscribers || {}, partial.subscribers || {});\n    return Object.assign({}, config, {options, inputs, subscribers});\n  }\n\n  private getValidators(validatorOption: string | string[] | ValidatorFn): ValidatorFn | ValidatorFn[] {\n    if (Array.isArray(validatorOption)) {\n      return validatorOption.map((validatorStr) => {\n        return this.getValidator(validatorStr);\n      });\n    }\n\n    return this.getValidator(validatorOption);\n  }\n\n  private getValidator(validatorStr: string | ValidatorFn): ValidatorFn {\n    if (typeof validatorStr !== 'string') {\n      return validatorStr;\n    }\n\n    // regex pattern to extract arguments from string for e.g applying on \"minLength(8)\" would extract 8\n    const re = /^([a-zA-Z]{3,15})\\((.{0,20})\\)$/;\n    const match = validatorStr.match(re);\n\n    if (!match) {\n      return Validators[validatorStr];\n    }\n\n    const name = match[1];\n    const args = match[2];\n    return Validators[name](args);\n  }\n\n}\n","import { Injectable } from '@angular/core';\n\n/**\n * Service where all available form fields are registered.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class FormFieldService {\n\n  static fields: {[key: string]: any} = {};\n\n  static register(type: string, component: any) {\n    FormFieldService.fields[type] = component;\n  }\n\n  constructor() {}\n\n  /**\n   * Return field component by type\n   * @param type Field type\n   * @returns Field component\n   */\n  getFieldByType(type: string): any {\n    return FormFieldService.fields[type];\n  }\n\n}\n","\n\n<ng-container *ngIf=\"field !== undefined\">\n  <igo-dynamic-outlet\n    [component]=\"getFieldComponent()\"\n    [inputs]=\"getFieldInputs()\"\n    [subscribers]=\"getFieldSubscribers()\">\n  </igo-dynamic-outlet>\n</ng-container>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { FormField, FormFieldInputs, FormFieldOptions } from '../shared/form.interfaces';\nimport { FormFieldService } from '../shared/form-field.service';\nimport { getDefaultErrorMessages } from '../shared';\n\n/**\n * This component renders the proper form input based on\n * the field configuration it receives.\n */\n@Component({\n  selector: 'igo-form-field',\n  templateUrl: './form-field.component.html',\n  styleUrls: ['./form-field.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormFieldComponent {\n\n  /**\n   * Field configuration\n   */\n  @Input() field: FormField;\n\n  /**\n   * Field inputs cache\n   */\n  private fieldInputs: FormFieldInputs = undefined;\n\n  /**\n   * Field subscribers cache\n   */\n  private fieldSubscribers: {[key: string]: ({field: FormField, control: FormControl}) => void } = undefined;\n\n  get fieldOptions(): FormFieldOptions {\n    return this.field.options || {};\n  }\n\n  constructor(private formFieldService: FormFieldService) {}\n\n  getFieldComponent(): any {\n    return this.formFieldService.getFieldByType(this.field.type || 'text');\n  }\n\n  getFieldInputs(): FormFieldInputs {\n    if (this.fieldInputs !== undefined) {\n      return this.fieldInputs;\n    }\n\n    const errors = this.fieldOptions.errors || {};\n    this.fieldInputs = Object.assign(\n      {\n        placeholder: this.field.title,\n        disableSwitch: this.fieldOptions.disableSwitch || false\n      },\n      Object.assign({}, this.field.inputs || {}),\n      {\n        formControl: this.field.control,\n        errors: Object.assign({}, getDefaultErrorMessages(), errors)\n      }\n    );\n    return this.fieldInputs;\n  }\n\n  getFieldSubscribers(): {[key: string]: ({field: FormField, control: FormControl}) => void } {\n    if (this.fieldSubscribers !== undefined) {\n      return this.fieldSubscribers;\n    }\n\n    this.fieldSubscribers = Object.assign({}, this.field.subscribers || {});\n    return this.fieldSubscribers;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoDynamicOutletModule } from '../../dynamic-component/dynamic-outlet/dynamic-outlet.module';\n\nimport { FormFieldComponent } from './form-field.component';\nimport { FormFieldSelectComponent } from './form-field-select.component';\nimport { FormFieldTextComponent } from './form-field-text.component';\nimport { FormFieldTextareaComponent } from './form-field-textarea.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    IgoLanguageModule,\n    IgoDynamicOutletModule\n  ],\n  exports: [\n    FormFieldComponent,\n    FormFieldSelectComponent,\n    FormFieldTextComponent,\n    FormFieldTextareaComponent\n  ],\n  declarations: [\n    FormFieldComponent,\n    FormFieldSelectComponent,\n    FormFieldTextComponent,\n    FormFieldTextareaComponent\n  ]\n})\nexport class IgoFormFieldModule {}\n","<div\n  *ngIf=\"group && group.fields.length > 0\"\n  class=\"igo-form-group-fields\">\n  <div\n    *ngFor=\"let field of group.fields\"\n    class=\"igo-form-field-wrapper\"\n    [ngClass]=\"getFieldNgClass(field)\">\n    <igo-form-field [field]=\"field\"></igo-form-field>\n  </div>\n</div>\n\n<div class=\"igo-form-group-extra-content\">\n  <ng-content></ng-content>\n</div>\n\n<mat-error *ngIf=\"formControl.errors\">{{getErrorMessage() | translate}}</mat-error>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { FormGroup } from '@angular/forms';\n\nimport { getControlErrorMessage } from '../shared/form.utils';\nimport { FormField, FormFieldGroup } from '../shared/form.interfaces';\n\n/**\n * A configurable form, optionnally bound to an entity\n * (for example in case of un update). Submitting that form\n * emits an event with the form data but no other operation is performed.\n */\n@Component({\n  selector: 'igo-form-group',\n  templateUrl: './form-group.component.html',\n  styleUrls: ['./form-group.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormGroupComponent {\n\n  /**\n   * Form field group\n   */\n  @Input() group: FormFieldGroup;\n\n  /**\n   * Field placeholder\n   */\n  @Input() errors: {[key: string]: string};\n\n  /**\n   * Form group control\n   */\n  get formControl(): FormGroup { return this.group.control; }\n\n  constructor() {}\n\n  /**\n   * Return the number of columns a field should occupy.\n   * The maximum allowed is 2, even if the field config says more.\n   * @param field Field\n   * @returns Number of columns\n   * @internal\n   */\n  getFieldColSpan(field: FormField): number {\n    let colSpan = 2;\n    const options = field.options || {};\n    if (options.cols && options.cols > 0) {\n      colSpan = Math.min(options.cols, 2);\n    }\n\n    return colSpan;\n  }\n\n  /**\n   * Return the number of columns a field should occupy.\n   * The maximum allowed is 2, even if the field config says more.\n   * @param field Field\n   * @returns Number of columns\n   * @internal\n   */\n  getFieldNgClass(field: FormField): {[key: string]: boolean} {\n    const colspan = this.getFieldColSpan(field);\n    return {[`igo-form-field-colspan-${colspan}`]: true};\n  }\n\n  /**\n   * Get error message\n   */\n  getErrorMessage(): string {\n    const options = this.group.options || {};\n    return getControlErrorMessage(this.formControl, options.errors || {});\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatFormFieldModule } from '@angular/material/form-field';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoFormFieldModule } from '../form-field/form-field.module';\nimport { FormGroupComponent } from './form-group.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatFormFieldModule,\n    IgoLanguageModule,\n    IgoFormFieldModule\n  ],\n  exports: [\n    FormGroupComponent\n  ],\n  declarations: [\n    FormGroupComponent\n  ]\n})\nexport class IgoFormGroupModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFormFormModule } from './form/form.module';\nimport { IgoFormGroupModule } from './form-group/form-group.module';\nimport { IgoFormFieldModule } from './form-field/form-field.module';\nimport { FormService } from './shared/form.service';\nimport { FormFieldService } from './shared/form-field.service';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoFormGroupModule,\n    IgoFormFieldModule\n  ],\n  exports: [\n    IgoFormFormModule,\n    IgoFormGroupModule,\n    IgoFormFieldModule\n  ],\n  declarations: [],\n  providers: [\n    FormService,\n    FormFieldService\n  ]\n})\nexport class IgoFormModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { EntitySelectorComponent } from './entity-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    MatSelectModule\n  ],\n  exports: [EntitySelectorComponent],\n  declarations: [EntitySelectorComponent]\n})\nexport class IgoEntitySelectorModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { StopDropPropagationDirective } from './stop-drop-propagation.directive';\nimport { StopPropagationDirective } from './stop-propagation.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [StopDropPropagationDirective, StopPropagationDirective],\n  exports: [StopDropPropagationDirective, StopPropagationDirective]\n})\nexport class IgoStopPropagationModule {\n  static forRoot(): ModuleWithProviders<IgoStopPropagationModule> {\n    return {\n      ngModule: IgoStopPropagationModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { EntityTablePaginatorComponent } from './entity-table-paginator.component';\nimport { MatPaginatorModule } from '@angular/material/paginator';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    MatPaginatorModule,\n  ],\n  exports: [\n    EntityTablePaginatorComponent\n  ],\n  declarations: [\n    EntityTablePaginatorComponent,\n  ]\n})\nexport class IgoEntityTablePaginatorModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { SecureImagePipe } from './secure-image.pipe';\n\n@NgModule({\n  imports: [],\n  declarations: [SecureImagePipe],\n  exports: [SecureImagePipe]\n})\nexport class IgoImageModule {\n  static forRoot(): ModuleWithProviders<IgoImageModule> {\n    return {\n      ngModule: IgoImageModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSortModule } from '@angular/material/sort';\nimport { MatTableModule } from '@angular/material/table';\n\nimport { IgoStopPropagationModule } from '../../stop-propagation/stop-propagation.module';\nimport { IgoCustomHtmlModule } from '../../custom-html/custom-html.module';\nimport { EntityTableRowDirective } from './entity-table-row.directive';\nimport { EntityTableComponent } from './entity-table.component';\nimport { MatPaginatorModule } from '@angular/material/paginator';\nimport { IgoEntityTablePaginatorModule } from '../entity-table-paginator/entity-table-paginator.module';\nimport { IgoImageModule } from '../../image/image.module';\nimport { IgoLanguageModule } from '@igo2/core';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatTableModule,\n    MatSortModule,\n    MatIconModule,\n    MatButtonModule,\n    MatCheckboxModule,\n    MatPaginatorModule,\n    IgoStopPropagationModule,\n    IgoCustomHtmlModule,\n    IgoEntityTablePaginatorModule,\n    IgoImageModule,\n    IgoLanguageModule\n  ],\n  exports: [\n    EntityTableComponent\n  ],\n  declarations: [\n    EntityTableComponent,\n    EntityTableRowDirective\n  ]\n})\nexport class IgoEntityTableModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoEntitySelectorModule } from './entity-selector/entity-selector.module';\nimport { IgoEntityTableModule } from './entity-table/entity-table.module';\nimport { IgoEntityTablePaginatorModule } from './entity-table-paginator/entity-table-paginator.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoEntitySelectorModule,\n    IgoEntityTableModule,\n    IgoEntityTablePaginatorModule\n  ],\n  declarations: []\n})\nexport class IgoEntityModule {}\n","import { catchError } from 'rxjs/operators';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { Injectable } from '@angular/core';\nimport { InteractiveTourOptions } from './interactive-tour.interface';\nimport { ConfigService } from '@igo2/core';\n\n@Injectable()\nexport class InteractiveTourLoader {\n  private jsonURL: string;\n  private allToursOptions;\n\n  constructor(private http: HttpClient, private configService: ConfigService) {\n    this.jsonURL = this.getPathToConfigFile();\n  }\n\n   public loadConfigTour() {\n      this.getJSON()\n        .subscribe(\n          (data) => {\n            this.allToursOptions = data;\n          },\n          (err) => {\n            throw new Error(`Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.`);\n          }\n        );\n   }\n\n  public getPathToConfigFile(): string {\n    return (\n      this.configService.getConfig('interactiveTour.pathToConfigFile') ||\n      './config/interactiveTour.json'\n    );\n  }\n\n  public getJSON(): Observable<any> {\n    return this.http.get(this.jsonURL).pipe(\n      catchError((e) => {\n        e.error.caught = true;\n        throw e;\n      })\n    );\n  }\n\n  public getTourOptionData(toolName): InteractiveTourOptions {\n    if (this.allToursOptions === undefined) {\n      return undefined;\n    }\n    let nameInConfigFile = toolName;\n    nameInConfigFile = nameInConfigFile.replace(/\\s/g, '');\n    return this.allToursOptions[nameInConfigFile];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { ShepherdService } from 'angular-shepherd';\n\nimport { ConfigService, MediaService, LanguageService } from '@igo2/core';\nimport { InteractiveTourLoader } from './interactive-tour.loader';\nimport {\n  InteractiveTourOptions,\n  InteractiveTourStep,\n  InteractiveTourAction\n} from './interactive-tour.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class InteractiveTourService {\n  private previousStep: InteractiveTourStep;\n  private nextIndex = 1;\n\n  constructor(\n    private configService: ConfigService,\n    private mediaService: MediaService,\n    private languageService: LanguageService,\n    private interactiveTourLoader: InteractiveTourLoader,\n    private shepherdService: ShepherdService\n  ) {\n    if (this.isAppHaveTour()) {\n      this.interactiveTourLoader.loadConfigTour();\n    }\n  }\n\n  public isAppHaveTour() {\n    const haveTour = this.configService.getConfig('interactiveTour.activateInteractiveTour');\n    if (haveTour === undefined) {\n      return true;\n    } else {\n      return haveTour;\n    }\n  }\n\n  public isToolHaveTourConfig(toolName: string): boolean {\n    const checkTourActiveOptions = this.interactiveTourLoader.getTourOptionData(\n      toolName\n    );\n    if (checkTourActiveOptions === undefined) {\n      return false;\n    } else {\n      return true;\n    }\n  }\n\n  public disabledTourButton(toolName: string): boolean {\n    const stepConfig: InteractiveTourOptions = this.interactiveTourLoader.getTourOptionData(\n      toolName\n    );\n\n    if (stepConfig?.conditions) {\n      for (const condition of stepConfig?.conditions) {\n        if (document.querySelector(condition) === null) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  public isMobile(): boolean {\n    return this.mediaService.isMobile();\n  }\n\n  public isTourDisplayInMobile(): boolean {\n    const showInMobile = this.configService.getConfig(\n      'interactiveTour.tourInMobile'\n    );\n    if (showInMobile === undefined) {\n      return true;\n    }\n    return this.configService.getConfig('interactiveTour.tourInMobile');\n  }\n\n  private getButtons(buttonKind?: 'first' | 'last' | 'noBackButton') {\n    if (buttonKind === 'noBackButton') {\n      return [\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.nextButton'\n          ),\n          type: 'next'\n        }\n      ];\n    }\n    if (buttonKind === 'first') {\n      return [\n        {\n          classes: 'shepherd-button-secondary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.exitButton'\n          ),\n          type: 'cancel'\n        },\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.nextButton'\n          ),\n          type: 'next'\n        }\n      ];\n    }\n\n    if (buttonKind === 'last') {\n      return [\n        {\n          classes: 'shepherd-button-secondary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.backButton'\n          ),\n          type: 'back'\n        },\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.exitButton'\n          ),\n          type: 'cancel'\n        }\n      ];\n    }\n\n    return [\n      {\n        classes: 'shepherd-button-secondary',\n        text: this.languageService.translate.instant(\n          'igo.common.interactiveTour.backButton'\n        ),\n        type: 'back'\n      },\n      {\n        classes: 'shepherd-button-primary',\n        text: this.languageService.translate.instant(\n          'igo.common.interactiveTour.nextButton'\n        ),\n        type: 'next'\n      }\n    ];\n  }\n\n  private getAction(actionName: string) {\n    const action = {\n      click: 'click'\n    };\n    return action[actionName.toLowerCase()];\n  }\n\n  private addProgress() {\n    const self = this as any;\n    let nbTry = 0;\n    const maxTry = 21;\n    const checkExist = setInterval(() => {\n      if (self.getCurrentStep()) {\n        if (self.getCurrentStep().options.attachTo.element && !document.querySelector(self.getCurrentStep().options.attachTo.element)) {\n          self.cancel();\n          clearInterval(checkExist);\n          return;\n        } else {\n          const currentStepElement = self.getCurrentStep().getElement();\n          if (currentStepElement) {\n            const shepherdList = currentStepElement.querySelectorAll('.shepherd-content, .shepherd-text');\n            shepherdList.forEach(element => {\n              element.classList.add('mat-typography');\n            });\n          }\n          const header = currentStepElement\n            ? currentStepElement.querySelector('.shepherd-header')\n            : undefined;\n\n          nbTry++;\n          if (header || nbTry > maxTry) {\n            clearInterval(checkExist);\n          }\n\n          if (header) {\n            const stepsArray = self.steps;\n            const progress = document.createElement('span');\n            progress.className = 'shepherd-progress';\n            progress.innerText = `${\n              stepsArray.indexOf(self.getCurrentStep()) + 1\n            }/${stepsArray.length}`;\n            header.insertBefore(\n              progress,\n              currentStepElement.querySelector('.shepherd-cancel-icon')\n            );\n          }\n        }\n      }\n    }, 100);\n  }\n\n  private checkNext(index, tour, service) {\n    if (tour.getCurrentStep()) {\n      if (tour.getCurrentStep().options.attachTo.element && document.querySelector(tour.getCurrentStep().options.attachTo.element)) {\n        tour.complete();\n        return;\n      }\n\n      if (index.index === tour.steps.length - 1) {\n        tour.complete();\n        return;\n      }\n\n      tour.steps.splice(index.index, 1);\n      const nextStep = tour.steps[index.index];\n      if (nextStep.options.attachTo.element && !document.querySelector(nextStep.options.attachTo.element)) {\n        service.checkNext(index, tour, service);\n      } else {\n        tour._setupModal();\n        tour.show(nextStep.id);\n      }\n    }\n  }\n\n  private executeAction(\n    step: InteractiveTourStep,\n    actionConfig: InteractiveTourAction\n  ) {\n    if (!actionConfig) {\n      return;\n    }\n\n    if (\n      actionConfig.condition &&\n      ((actionConfig.condition.charAt(0) === '!' &&\n        document.querySelector(actionConfig.condition.slice(1))) ||\n        (actionConfig.condition.charAt(0) !== '!' &&\n          !document.querySelector(actionConfig.condition)))\n    ) {\n      return;\n    }\n\n    const element: HTMLElement = document.querySelector(\n      actionConfig.element || step.element\n    ) as HTMLElement;\n    const action = this.getAction(actionConfig.action);\n    if (element && action) {\n      element[action]();\n    }\n  }\n\n  private executeActionPromise(\n    step: InteractiveTourStep,\n    actionConfig: InteractiveTourAction\n  ) {\n    return new Promise<void>((resolve) => {\n      this.executeAction(step, actionConfig);\n      if (!actionConfig || !actionConfig.waitFor) {\n        resolve();\n        return;\n      }\n      let nbTry = 0;\n      const maxTry = actionConfig.maxWait ? actionConfig.maxWait / 100 : 20;\n      const checkExist = setInterval(() => {\n        nbTry++;\n        if (nbTry > maxTry || document.querySelector(actionConfig.waitFor)) {\n          clearInterval(checkExist);\n          resolve();\n        }\n      }, 100);\n    });\n  }\n\n  private getShepherdSteps(stepConfig: InteractiveTourOptions) {\n    const shepherdSteps = [];\n\n    let i = 0;\n    for (const step of stepConfig.steps) {\n      shepherdSteps.push({\n        attachTo: {\n          element: step.element,\n          on: step.position || stepConfig.position\n        },\n        popperOptions: {\n          modifiers: [{ name: 'offset', options: { offset: [0, 15] } }]\n        },\n        beforeShowPromise: () => {\n          return Promise.all([\n            this.executeActionPromise(\n              this.previousStep,\n              this.previousStep ? this.previousStep.beforeChange : undefined\n            ),\n            this.executeActionPromise(step, step.beforeShow)\n          ]);\n        },\n        buttons: this.getButtons(\n          i === 0\n            ? 'first'\n            : i + 1 === stepConfig.steps.length\n            ? 'last'\n            : stepConfig.steps[i].noBackButton\n            ? 'noBackButton'\n            : undefined\n        ),\n        classes: step.class,\n        highlightClass: step.highlightClass,\n        scrollTo: step.scrollToElement || stepConfig.scrollToElement || true,\n        canClickTarget: step.disableInteraction\n          ? !step.disableInteraction\n          : undefined,\n        title: this.languageService.translate.instant(\n          step.title || stepConfig.title\n        ),\n        text: [this.languageService.translate.instant(step.text)],\n        when: {\n          show: () => {\n            this.executeAction(step, step.onShow);\n          },\n          hide: () => {\n            this.previousStep = step;\n            this.executeAction(step, step.onHide);\n          }\n        }\n      });\n      i++;\n    }\n\n    return shepherdSteps;\n  }\n\n  public startTour(toolName: string) {\n    const stepConfig: InteractiveTourOptions = this.interactiveTourLoader.getTourOptionData(\n      toolName\n    );\n\n    this.shepherdService.defaultStepOptions = {\n      classes: stepConfig.class,\n      highlightClass: stepConfig.highlightClass,\n      canClickTarget: stepConfig.disableInteraction\n        ? !stepConfig.disableInteraction\n        : true,\n      cancelIcon: {\n        enabled: true\n      }\n    };\n\n    const shepherdSteps = this.getShepherdSteps(stepConfig);\n\n    this.shepherdService.modal = true;\n    this.shepherdService.confirmCancel = false;\n    this.shepherdService.addSteps(shepherdSteps);\n\n    this.shepherdService.tourObject.on('show', this.addProgress);\n    this.shepherdService.tourObject.on('cancel', (index) => {\n      this.checkNext(index, this.shepherdService.tourObject, this);\n    });\n\n    this.shepherdService.start();\n  }\n}\n","import { EntityRecord, EntityStore } from '../../entity';\nimport { Tool, ToolboxOptions } from './tool.interface';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n/**\n * Service where all available tools and their component are registered.\n */\nexport class Toolbox {\n  /**\n   * Observable of the active tool\n   */\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\n\n  /**\n   * Ordered list of tool names to display in a toolbar\n   */\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\n\n  /**\n   * Observable of the active tool\n   */\n  private activeTool$$: Subscription;\n\n  /**\n   * Active tool history. Useful for activating the previous tool.\n   */\n  private activeToolHistory: string[] = [];\n\n  /**\n   * Tool store\n   */\n  private store = new EntityStore<Tool>([], {\n    getKey: (tool: Tool) => tool.name\n  });\n\n  get tools$(): BehaviorSubject<Tool[]> {\n    return this.store.entities$;\n  }\n\n  constructor(private options: ToolboxOptions = {}) {\n    this.setToolbar(options.toolbar);\n    this.initStore();\n  }\n\n  /**\n   * Destroy the toolbox\n   */\n  destroy() {\n    this.activeTool$$.unsubscribe();\n    this.store.destroy();\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return this.store.get(name);\n  }\n\n  /**\n   * Return all tools\n   * @returns Array of tools\n   */\n  getTools(): Tool[] {\n    return this.store.all();\n  }\n\n  /**\n   * Set tool configurations\n   * @param tools Tools\n   */\n  setTools(tools: Tool[]) {\n    this.store.load(tools);\n  }\n\n  /**\n   * Get toolbar\n   * @returns Toolbar value\n   */\n  getToolbar(): string[] {\n    return this.toolbar$.getValue();\n  }\n\n  /**\n   * Set toolbar\n   * @param toolbar A list of tool names\n   */\n  setToolbar(toolbar: string[]) {\n    this.toolbar$.next(toolbar || []);\n  }\n\n  /**\n   * Activate a tool (and deactivate other tools)\n   * @param name Tool name\n   * @param options Tool options\n   */\n  activateTool(name: string, options: { [key: string]: any } = {}) {\n    const tool = this.getTool(name);\n    if (tool === undefined) {\n      return;\n    }\n\n    this.store.state.update(tool, { active: true, options }, true);\n  }\n\n  /**\n   * Activate the previous tool, if any\n   */\n  activatePreviousTool() {\n    if (this.activeToolHistory.length <= 1) {\n      this.deactivateTool();\n      return;\n    }\n    const [previous, current] = this.activeToolHistory.splice(-2, 2);\n    this.activateTool(previous);\n  }\n\n  /**\n   * Activate the tool below, if any\n   */\n  /* activateBelowTool() {\n    const arrayTools = this.getToolbar();\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\n    if (arrayTools[index + 1] !== undefined) {\n      this.deactivateTool();\n      const below = arrayTools[index + 1];\n      this.activateTool(below);\n    } else {\n      this.deactivateTool();\n      const below = arrayTools[0];\n      this.activateTool(below);\n    }\n  } */\n\n  /**\n   * Activate the tool above, if any\n   */\n  /* activateAboveTool() {\n    const arrayTools = this.getToolbar();\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\n    if (arrayTools[index - 1] !== undefined) {\n      this.deactivateTool();\n      const above = arrayTools[index - 1];\n      this.activateTool(above);\n    } else {\n      this.deactivateTool();\n      const above = arrayTools[arrayTools.length - 1];\n      this.activateTool(above);\n    }\n  } */\n\n  /**\n   * Deactivate the active tool\n   */\n  deactivateTool() {\n    this.clearActiveToolHistory();\n    this.store.state.updateAll({ active: false });\n  }\n\n  /**\n   * Initialize the tool store and start observing the active tool\n   */\n  private initStore() {\n    this.store = new EntityStore<Tool>([], {\n      getKey: (entity: Tool) => entity.name\n    });\n\n    this.activeTool$$ = this.store.stateView\n      .firstBy$((record: EntityRecord<Tool>) => record.state.active === true)\n      .subscribe((record: EntityRecord<Tool>) => {\n        if (record === undefined) {\n          this.setActiveTool(undefined);\n          return;\n        }\n\n        const tool = record.entity;\n        const options = Object.assign(\n          {},\n          tool.options || {},\n          record.state.options || {}\n        );\n        this.setActiveTool(Object.assign({}, tool, { options }));\n      });\n  }\n\n  /**\n   * Set the active tool and update the tool history\n   * @param tool Tool\n   */\n  private setActiveTool(tool: Tool | undefined) {\n    this.activeTool$.next(tool);\n    if (tool === undefined) {\n      this.clearActiveToolHistory();\n    } else {\n      this.activeToolHistory = this.activeToolHistory\n        .filter((name: string) => name !== tool.name)\n        .concat([tool.name]);\n    }\n  }\n\n  /**\n   * Clear the tool history\n   */\n  private clearActiveToolHistory() {\n    this.activeToolHistory = [];\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { Tool } from './tool.interface';\nimport { Toolbox } from './toolbox';\n\n/**\n * Service where runtime tool configurations are registered\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ToolService {\n  static tools: { [key: string]: Tool } = {};\n\n  /**\n   * Toolbox that holds main tools\n   */\n  public toolbox: Toolbox = new Toolbox();\n\n  static register(tool: Tool) {\n    ToolService.tools[tool.name] = tool;\n  }\n\n  constructor() {\n    this.toolbox.setTools(this.getTools());\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return ToolService.tools[name];\n  }\n\n  /**\n   * Return all tools\n   * @returns tTols\n   */\n  getTools(): Tool[] {\n    return Object.values(ToolService.tools);\n  }\n}\n","<button *ngIf=\"showTourButton\"\n  (click) = \"startInteractiveTour()\"\n  [ngClass]=\"getClass()\"\n  mat-raised-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [disabled]=disabledTourButton>\n  <span class=\"interactive-tour-button-title\">{{'igo.common.interactiveTour.buttonTitle' | translate}} {{(discoverTitleInLocale$ | async) | translate}}</span>\n  <mat-icon\n    svgIcon=\"presentation-play\"\n    [matTooltip]=\"disabledTourButton ?\n    ('igo.common.interactiveTour.disaledTooltipTourToolButton' | translate) :\n    ('igo.common.interactiveTour.tooltipTourToolButton' | translate)\">\n  </mat-icon>\n</button>\n","import { Component, ViewEncapsulation, Input } from '@angular/core';\nimport { InteractiveTourService } from './interactive-tour.service';\nimport { ToolService } from '../tool/shared/tool.service';\nimport { Observable, of } from 'rxjs';\n\n@Component({\n  selector: 'igo-interactive-tour',\n  templateUrl: './interactive-tour.component.html',\n  styleUrls: ['./interactive-tour.component.scss'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class InteractiveTourComponent {\n  /**\n   * Toolbox that holds main tools\n   */\n  @Input() tourToStart: string = '';\n  @Input() styleButton: string;\n  @Input() discoverTitleInLocale$: Observable<string> = of('IGO');\n\n  getClass() {\n    return {\n      'tour-button-tool-icon': this.styleButton === 'icon',\n      'tour-button-tool': this.styleButton === 'raised'\n    };\n  }\n\n  get toolbox() {\n    return this.toolService.toolbox;\n  }\n\n  getTourToStart() {\n    if (this.tourToStart) {\n      return this.tourToStart;\n    } else {\n      return this.activeToolName;\n    }\n  }\n\n  get activeToolName() {\n    if (this.toolbox) {\n      if (this.isActiveTool) {\n        return this.toolbox.activeTool$.getValue().name;\n      } else {\n        return 'global';\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  get isActiveTool(): boolean {\n    if (this.toolbox) {\n      return this.toolbox.activeTool$.getValue() !== undefined;\n    } else {\n      return undefined;\n    }\n  }\n\n  get isToolHaveTour(): boolean {\n    if (this.activeToolName === 'about' && !this.tourToStart) {\n      return false;\n    }\n    return this.interactiveTourService.isToolHaveTourConfig(\n      this.getTourToStart()\n    );\n  }\n\n  get showTourButton(): boolean {\n    // 2 conditions to show: have Tour on tool in Config file and if we are in mobile displayInMobile= true\n    let haveTour: boolean;\n    haveTour = this.isToolHaveTour;\n    if (haveTour === false) {\n      return false;\n    }\n\n    let inMobileAndShow: boolean;\n    if (this.interactiveTourService.isMobile()) {\n      inMobileAndShow = this.isTourDisplayInMobile;\n      if (inMobileAndShow === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  get isTourDisplayInMobile(): boolean {\n    return this.interactiveTourService.isTourDisplayInMobile();\n  }\n\n  get disabledTourButton(): boolean {\n    return this.interactiveTourService.disabledTourButton(this.activeToolName);\n  }\n\n  constructor(\n    private interactiveTourService: InteractiveTourService,\n    private toolService: ToolService\n  ) {}\n\n  startInteractiveTour() {\n    const tour = this.getTourToStart();\n    if (tour) {\n      this.interactiveTourService.startTour(tour);\n    } else {\n      return;\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { InteractiveTourService } from './interactive-tour.service';\nimport { InteractiveTourComponent } from './interactive-tour.component';\nimport { InteractiveTourLoader } from './interactive-tour.loader';\n\n@NgModule({\n  declarations: [InteractiveTourComponent],\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule\n  ],\n  providers: [InteractiveTourService, InteractiveTourLoader],\n  exports: [InteractiveTourComponent]\n})\nexport class IgoInteractiveTourModule {}\n","import { Pipe, PipeTransform } from '@angular/core';\n\n@Pipe({\n  name: 'keyvalue'\n})\nexport class KeyValuePipe implements PipeTransform {\n  transform(value: any, args?: any): any {\n    const keyValues = [];\n    Object.getOwnPropertyNames(value).forEach((key: string) =>\n      keyValues.push({ key, value: value[key] })\n    );\n\n    return keyValues;\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { KeyValuePipe } from './keyvalue.pipe';\n\n@NgModule({\n  imports: [],\n  declarations: [KeyValuePipe],\n  exports: [KeyValuePipe]\n})\nexport class IgoKeyValueModule {\n  static forRoot(): ModuleWithProviders<IgoKeyValueModule> {\n    return {\n      ngModule: IgoKeyValueModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  ElementRef,\n  Renderer2,\n  HostListener,\n  EventEmitter\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoListItem]'\n})\nexport class ListItemDirective {\n\n  static focusedCls = 'igo-list-item-focused';\n  static selectedCls = 'igo-list-item-selected';\n  static disabledCls = 'igo-list-item-disabled';\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  @Input()\n  get focused() {\n    return this._focused;\n  }\n  set focused(value: boolean) {\n    if (value === this._focused) {\n      return;\n    }\n    if (this.disabled) {\n      return;\n    }\n\n    value ? this.beforeFocus.emit(this) : this.beforeUnfocus.emit(this);\n\n    this._focused = value;\n    if (this.selected !== true) {\n      this.toggleFocusedClass();\n    }\n\n    value ? this.focus.emit(this) : this.unfocus.emit(this);\n  }\n  private _focused = false;\n\n  @Input()\n  get selected() {\n    return this._selected;\n  }\n  set selected(value: boolean) {\n    if (value === this._selected) {\n      return;\n    }\n    if (this.disabled) {\n      return;\n    }\n\n    value ? this.beforeSelect.emit(this) : this.beforeUnselect.emit(this);\n\n    this._selected = value;\n    this._focused = value;\n    this.toggleSelectedClass();\n\n    value ? this.select.emit(this) : this.unselect.emit(this);\n  }\n  private _selected = false;\n\n  @Input()\n  get disabled() {\n    return this._disabled;\n  }\n  set disabled(value: boolean) {\n    if (value === this._disabled) {\n      return;\n    }\n\n    if (value === true) {\n      this.selected = false;\n    }\n\n    value ? this.beforeDisable.emit(this) : this.beforeEnable.emit(this);\n\n    this._disabled = value;\n    this.toggleDisabledClass();\n\n    value ? this.disable.emit(this) : this.enable.emit(this);\n  }\n  private _disabled = false;\n\n  @Output() beforeSelect = new EventEmitter<ListItemDirective>();\n  @Output() beforeFocus = new EventEmitter<ListItemDirective>();\n  @Output() beforeUnselect = new EventEmitter<ListItemDirective>();\n  @Output() beforeUnfocus = new EventEmitter<ListItemDirective>();\n  @Output() beforeDisable = new EventEmitter<ListItemDirective>();\n  @Output() beforeEnable = new EventEmitter<ListItemDirective>();\n  @Output() focus = new EventEmitter<ListItemDirective>();\n  @Output() unfocus = new EventEmitter<ListItemDirective>();\n  @Output() select = new EventEmitter<ListItemDirective>();\n  @Output() unselect = new EventEmitter<ListItemDirective>();\n  @Output() disable = new EventEmitter<ListItemDirective>();\n  @Output() enable = new EventEmitter<ListItemDirective>();\n\n  @HostListener('click')\n  onClick() {\n    this.selected = true;\n  }\n\n  constructor(public renderer: Renderer2, public el: ElementRef) {}\n\n  getOffsetTop(): number {\n    const padding = 5;\n\n    return this.el.nativeElement.offsetTop - padding;\n  }\n\n  private toggleFocusedClass() {\n    if (this.focused) {\n      this.addCls(ListItemDirective.focusedCls);\n    } else {\n      this.removeCls(ListItemDirective.focusedCls);\n    }\n  }\n\n  private toggleSelectedClass() {\n    if (this.selected) {\n      this.addCls(ListItemDirective.selectedCls);\n      this.removeCls(ListItemDirective.focusedCls);\n    } else {\n      this.removeCls(ListItemDirective.selectedCls);\n    }\n  }\n\n  private toggleDisabledClass() {\n    if (this.disabled) {\n      this.addCls(ListItemDirective.disabledCls);\n    } else {\n      this.removeCls(ListItemDirective.disabledCls);\n    }\n  }\n\n  private addCls(cls: string) {\n    this.renderer.addClass(this.el.nativeElement, cls);\n  }\n\n  private removeCls(cls: string) {\n    this.renderer.removeClass(this.el.nativeElement, cls);\n  }\n}\n","import {\n  Component,\n  AfterViewInit,\n  OnInit,\n  OnDestroy,\n  Input,\n  ContentChildren,\n  HostListener,\n  ElementRef\n} from '@angular/core';\nimport type { QueryList } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport { ListItemDirective } from './list-item.directive';\n\n@Component({\n  selector: 'igo-list',\n  templateUrl: './list.component.html',\n  styleUrls: ['./list.component.scss']\n})\nexport class ListComponent implements AfterViewInit, OnInit, OnDestroy {\n  @Input()\n  get navigation() {\n    return this._navigation;\n  }\n  set navigation(value: boolean) {\n    this._navigation = value;\n  }\n  private _navigation = true;\n\n  @Input()\n  get selection() {\n    return this._selection;\n  }\n  set selection(value: boolean) {\n    this._selection = value;\n  }\n  private _selection = true;\n\n  get selectedItem() {\n    return this._selectedItem;\n  }\n  set selectedItem(value: ListItemDirective) {\n    this.focusedItem = value;\n    this._selectedItem = value;\n  }\n  private _selectedItem: ListItemDirective;\n\n  get focusedItem() {\n    return this._focusedItem;\n  }\n  set focusedItem(value: ListItemDirective) {\n    this._focusedItem = value;\n  }\n  private _focusedItem: ListItemDirective;\n\n  private navigationEnabled: boolean;\n  private listItems$$: Subscription;\n  private subscriptions: Subscription[] = [];\n\n  @ContentChildren(ListItemDirective, { descendants: true })\n  listItems: QueryList<ListItemDirective>;\n\n  @HostListener('document:keydown', ['$event'])\n  @HostListener('document:enter', ['$event'])\n  handleKeyboardEvent(event: KeyboardEvent) {\n    // It would be nice to be able to unsubscribe to the event\n    // completely but until ES7 this won't be possible because\n    // document events are not observables\n    if (this.navigationEnabled) {\n      if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {\n        event.preventDefault();\n        this.navigate(event.key);\n      } else if (event.key === 'Enter') {\n        this.select(this.focusedItem);\n      }\n    }\n  }\n\n  constructor(private el: ElementRef) {}\n\n  ngOnInit() {\n    this.enableNavigation();\n  }\n\n  ngAfterViewInit() {\n    if (this.listItems.length) {\n      this.init();\n    }\n\n    this.listItems$$ = this.listItems.changes.subscribe(\n      (items: ListItemDirective[]) => this.init()\n    );\n  }\n\n  ngOnDestroy() {\n    this.listItems$$.unsubscribe();\n  }\n\n  focus(item?: ListItemDirective) {\n    if (!this.selection) {\n      return;\n    }\n\n    this.unfocus();\n\n    // We need to make this check because dynamic\n    // lists such as in the search results list may fail\n    if (item !== undefined) {\n      item.focused = true;\n    }\n  }\n\n  unfocus() {\n    if (this.focusedItem !== undefined) {\n      this.focusedItem.focused = false;\n    }\n\n    this.focusedItem = undefined;\n  }\n\n  focusNext() {\n    const items = this.listItems.toArray();\n    let item;\n    const igoList = this.el.nativeElement;\n    let disabled = true;\n    let index = this.getFocusedIndex();\n    if (index === undefined) {\n      index = -1;\n    }\n\n    while (disabled && index < items.length - 1) {\n      index += 1;\n      item = items[index];\n      disabled = item.disabled;\n    }\n\n    if (item !== undefined) {\n      this.focus(item);\n    }\n\n    if (!items[index + 1]) {\n      igoList.scrollTop = igoList.scrollHeight - igoList.clientHeight;\n      return;\n    }\n\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\n      igoList.scrollTop =\n        item.el.nativeElement.offsetTop +\n        item.el.nativeElement.children[0].offsetHeight -\n        igoList.clientHeight;\n    }\n  }\n\n  focusPrevious() {\n    const items = this.listItems.toArray();\n    let item: ListItemDirective;\n    const igoList = this.el.nativeElement;\n    let disabled = true;\n    let index = this.getFocusedIndex();\n\n    while (disabled && index > 0) {\n      index -= 1;\n      item = items[index];\n      disabled = item.disabled;\n    }\n\n    if (item !== undefined) {\n      this.focus(item);\n    }\n\n    if (!items[index - 1]) {\n      igoList.scrollTop = 0;\n      return;\n    }\n\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\n      const padding = 3;\n      igoList.scrollTop = item.el.nativeElement.offsetTop - padding;\n    }\n  }\n\n  select(item?: ListItemDirective) {\n    if (!this.selection) {\n      return;\n    }\n\n    this.unselect();\n\n    if (item !== undefined) {\n      item.selected = true;\n    }\n  }\n\n  unselect() {\n    this.unfocus();\n\n    if (this.selectedItem !== undefined) {\n      this.selectedItem.selected = false;\n    }\n\n    this.selectedItem = undefined;\n  }\n\n  enableNavigation() {\n    if (this.navigation) {\n      this.navigationEnabled = true;\n    }\n  }\n\n  disableNavigation() {\n    this.navigationEnabled = false;\n  }\n\n  scrollToItem(item: ListItemDirective) {\n    this.el.nativeElement.scrollTop = item.getOffsetTop();\n  }\n\n  isScrolledIntoView(elem) {\n    const docViewTop =\n      this.el.nativeElement.scrollTop + this.el.nativeElement.offsetTop;\n    const docViewBottom = docViewTop + this.el.nativeElement.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.children[0].offsetHeight;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  private init() {\n    this.subscribe();\n\n    this.selectedItem = this.findSelectedItem();\n    this.focusedItem = this.findFocusedItem();\n\n    this.enableNavigation();\n  }\n\n  private subscribe() {\n    this.unsubscribe();\n\n    this.listItems.toArray().forEach(item => {\n      this.subscriptions.push(\n        item.beforeSelect.subscribe((item2: ListItemDirective) =>\n          this.handleItemBeforeSelect(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.select.subscribe((item2: ListItemDirective) =>\n          this.handleItemSelect(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.beforeFocus.subscribe((item2: ListItemDirective) =>\n          this.handleItemBeforeFocus(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.focus.subscribe((item2: ListItemDirective) =>\n          this.handleItemFocus(item2)\n        )\n      );\n    }, this);\n  }\n\n  private unsubscribe() {\n    this.subscriptions.forEach((sub: Subscription) => sub.unsubscribe());\n    this.subscriptions = [];\n  }\n\n  private handleItemBeforeFocus(item: ListItemDirective) {\n    if (item !== this.focusedItem) {\n      this.unfocus();\n    }\n  }\n\n  private handleItemFocus(item: ListItemDirective) {\n    this.focusedItem = item;\n  }\n\n  private handleItemBeforeSelect(item: ListItemDirective) {\n    if (item !== this.focusedItem) {\n      this.unselect();\n    }\n  }\n\n  private handleItemSelect(item: ListItemDirective) {\n    this.selectedItem = item;\n  }\n\n  private findSelectedItem() {\n    return this.listItems.toArray().find(item => item.selected);\n  }\n\n  private findFocusedItem() {\n    return this.listItems.toArray().find(item => item.focused);\n  }\n\n  private getFocusedIndex() {\n    return this.listItems\n      .toArray()\n      .findIndex(item => item === this.focusedItem);\n  }\n\n  private navigate(key: string) {\n    switch (key) {\n      case 'ArrowUp':\n        this.focusPrevious();\n        break;\n      case 'ArrowDown':\n        this.focusNext();\n        break;\n      default:\n        break;\n    }\n  }\n}\n","<mat-list\n  igoClickout\n  [ngClass]=\"{'selectable': selection}\"\n  (clickout)=\"disableNavigation()\"\n  (click)=\"enableNavigation()\">\n  <ng-content></ng-content>\n</mat-list>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { IgoClickoutModule } from '../clickout/clickout.module';\n\nimport { ListItemDirective } from './list-item.directive';\nimport { ListComponent } from './list.component';\n\n@NgModule({\n  imports: [CommonModule, MatIconModule, MatListModule, IgoClickoutModule],\n  declarations: [ListItemDirective, ListComponent],\n  exports: [ListItemDirective, ListComponent]\n})\nexport class IgoListModule {\n  static forRoot(): ModuleWithProviders<IgoListModule> {\n    return {\n      ngModule: IgoListModule,\n      providers: []\n    };\n  }\n}\n","<div *ngIf=\"withHeader\" class=\"igo-panel-header mat-typography\" title=\"\">\n  <h3>\n    <ng-content select=\"[panelLeftButton]\"></ng-content>\n    <div class=\"igo-panel-title\">\n      {{ title }}\n      <ng-content select=\"[panelHeader]\"></ng-content>\n    </div>\n    <ng-content select=\"[panelRightButton]\"></ng-content>\n  </h3>\n</div>\n<div class=\"igo-panel-content\" title=\"\">\n  <ng-content></ng-content>\n</div>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  HostBinding\n} from '@angular/core';\n\n@Component({\n  selector: 'igo-panel',\n  templateUrl: './panel.component.html',\n  styleUrls: ['./panel.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PanelComponent {\n  @Input()\n  get title() {\n    return this._title;\n  }\n  set title(value: string) {\n    this._title = value;\n  }\n  private _title: string;\n\n  @Input()\n  @HostBinding('class.igo-panel-with-header')\n  get withHeader(): boolean {\n    return this._withHeader;\n  }\n  set withHeader(value: boolean) {\n    this._withHeader = value;\n  }\n  private _withHeader = true;\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { PanelComponent } from './panel.component';\n\n@NgModule({\n  imports: [CommonModule],\n  exports: [PanelComponent],\n  declarations: [PanelComponent]\n})\nexport class IgoPanelModule {}\n","import { Component, Input } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'igo-spinner',\n  templateUrl: './spinner.component.html',\n  styleUrls: ['./spinner.component.scss']\n})\nexport class SpinnerComponent {\n\n  public shown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  @Input()\n  set shown(value: boolean) { this.shown$.next(value); }\n  get shown(): boolean { return this.shown$.value; }\n\n  constructor() {}\n\n  show() {\n    this.shown = true;\n  }\n\n  hide() {\n    this.shown = false;\n  }\n}\n","<div\n  [ngClass]=\"{'igo-spinner-container': true, 'igo-spinner-shown': (shown$ | async)}\">\n  <div class=\"igo-spinner-background\"></div>\n  <mat-progress-spinner diameter=\"40\" mode=\"indeterminate\"></mat-progress-spinner>\n</div>\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { ActivityService } from '@igo2/core';\nimport { SpinnerComponent } from './spinner.component';\n\n/**\n * A directive to bind a SpinnerComponent to the activity service.\n * The activity service tracks any HTTP request and this directive\n * will display the spinner it's attached to when the activity counter\n * is greater than 0.\n */\n@Directive({\n  selector: '[igoSpinnerActivity]'\n})\nexport class SpinnerActivityDirective implements OnInit, OnDestroy {\n  /**\n   * Subscription to the activity service counter\n   */\n  private counter$$: Subscription;\n\n  constructor(\n    @Self() private spinner: SpinnerComponent,\n    private activityService: ActivityService\n  ) {}\n\n  /**\n   * Subscribe to the activity service counter and display the spinner\n   * when it's is greater than 0.\n   * @internal\n   */\n  ngOnInit() {\n    this.counter$$ = this.activityService.counter$\n      .pipe(debounceTime(50))\n      .subscribe((count: number) => {\n        count > 0 ? this.spinner.show() : this.spinner.hide();\n      });\n  }\n\n  /**\n   * Unsubcribe to the activity service counter.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.counter$$.unsubscribe();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\n\nimport { SpinnerActivityDirective } from './spinner-activity.directive';\nimport { SpinnerComponent } from './spinner.component';\n\n@NgModule({\n  imports: [CommonModule, MatProgressSpinnerModule],\n  declarations: [SpinnerActivityDirective, SpinnerComponent],\n  exports: [SpinnerActivityDirective, SpinnerComponent]\n})\nexport class IgoSpinnerModule {}\n","import { DataSource } from '@angular/cdk/table';\nimport { MatSort } from '@angular/material/sort';\n\nimport { Observable, BehaviorSubject, merge } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { TableDatabase, TableModel } from './index';\n\nexport class TableDataSource extends DataSource<any> {\n  get filter(): string {\n    return this._filterChange.value;\n  }\n  set filter(filter: string) {\n    this._filterChange.next(filter);\n  }\n  private _filterChange = new BehaviorSubject('');\n\n  constructor(\n    private _database: TableDatabase,\n    private _model: TableModel,\n    private _sort: MatSort\n  ) {\n    super();\n  }\n\n  // Connect function called by the table to retrieve one stream containing\n  // the data to render.\n  connect(): Observable<any[]> {\n    if (!this._database) {\n      return merge([]);\n    }\n    const displayDataChanges = [\n      this._database.dataChange,\n      this._filterChange,\n      this._sort.sortChange\n    ];\n\n    return merge(...displayDataChanges).pipe(\n      map(() => {\n        return this.getFilteredData(this._database.data);\n      }),\n      map(data => {\n        return this.getSortedData(data);\n      })\n    );\n  }\n\n  disconnect() {}\n\n  getFilteredData(data): any[] {\n    if (!this.filter) {\n      return data;\n    }\n    return data.slice().filter((item: any) => {\n      const searchStr: string = this._model.columns\n        .filter(c => c.filterable)\n        .map(c => ObjectUtils.resolve(item, c.name))\n        .join(' ')\n        .toLowerCase();\n\n      return searchStr.indexOf(this.filter.toLowerCase()) !== -1;\n    });\n  }\n\n  getSortedData(data): any[] {\n    if (!this._sort.active || this._sort.direction === '') {\n      return data;\n    }\n\n    return data.sort((a, b) => {\n      const propertyA: number | string = ObjectUtils.resolve(\n        a,\n        this._sort.active\n      );\n      const propertyB: number | string = ObjectUtils.resolve(\n        b,\n        this._sort.active\n      );\n\n      return ObjectUtils.naturalCompare(\n        propertyB,\n        propertyA,\n        this._sort.direction\n      );\n    });\n  }\n}\n","export enum TableActionColor {\n  primary,\n  accent,\n  warn\n}\n","<div class='table-box'>\n  <div class='table-header' *ngIf=\"hasFilterInput\">\n    <mat-form-field floatPlaceholder='never'>\n      <input matInput #filter [placeholder]=\"'igo.common.table.filter' | translate\">\n    </mat-form-field>\n  </div>\n\n  <div class='table-container'>\n    <table mat-table #table [dataSource]='dataSource' matSort>\n\n      <!-- Checkbox Column -->\n      <ng-container matColumnDef=\"selectionCheckbox\">\n        <th mat-header-cell *matHeaderCellDef>\n          <mat-checkbox (change)=\"$event ? masterToggle() : null\"\n                        [checked]=\"selection.hasValue() && isAllSelected()\"\n                        [indeterminate]=\"selection.hasValue() && !isAllSelected()\">\n          </mat-checkbox>\n        </th>\n        <td mat-cell *matCellDef=\"let row\">\n          <mat-checkbox (click)=\"$event.stopPropagation()\"\n                        (change)=\"$event ? selection.toggle(row) : null\"\n                        [checked]=\"selection.isSelected(row)\">\n          </mat-checkbox>\n        </td>\n      </ng-container>\n\n      <ng-container [matColumnDef]='column.name' *ngFor='let column of model.columns'>\n        <ng-container *ngIf='column.sortable'>\n          <th mat-header-cell *matHeaderCellDef mat-sort-header> {{column.title}} </th>\n        </ng-container>\n\n        <ng-container *ngIf='!column.sortable'>\n          <th mat-header-cell *matHeaderCellDef> {{column.title}} </th>\n        </ng-container>\n\n        <ng-container *ngIf=\"!column.html; else cellHTML\">\n          <td mat-cell *matCellDef='let row' class=\"mat-cell-text\"\n            [ngClass]=\"model.cellClassFunc ? model.cellClassFunc(row, column) : {}\">\n            {{getValue(row, column.name)}}\n          </td>\n        </ng-container>\n\n        <ng-template #cellHTML>\n          <td mat-cell *matCellDef='let row' class=\"mat-cell-text\"\n            [ngClass]=\"model.cellClassFunc ? model.cellClassFunc(row, column) : {}\"\n            [innerHTML]=\"getValue(row, column.name)\">\n          </td>\n        </ng-template>\n      </ng-container>\n\n      <!-- Action Column -->\n      <ng-container matColumnDef='action'>\n        <th mat-header-cell *matHeaderCellDef></th>\n        <td mat-cell *matCellDef='let row'>\n          <button *ngFor='let action of model.actions'\n          mat-mini-fab\n          [color]='getActionColor(action.color)'\n          (click)='handleClickAction($event, action, row)'>\n            <mat-icon svgIcon=\"{{action.icon}}\"></mat-icon>\n          </button>\n        </td>\n      </ng-container>\n\n      <tr mat-header-row *matHeaderRowDef='displayedColumns;'></tr>\n      <tr mat-row\n        *matRowDef='let row; columns: displayedColumns;'\n        [ngClass]=\"model.rowClassFunc ? model.rowClassFunc(row) : {}\"\n        (click)=\"selection.toggle(row)\">\n      </tr>\n\n    </table>\n  </div>\n\n</div>\n","import {\n  Component,\n  ElementRef,\n  ViewChild,\n  Input,\n  Output,\n  OnChanges,\n  OnInit,\n  AfterViewInit,\n  EventEmitter\n} from '@angular/core';\nimport { MatSort } from '@angular/material/sort';\nimport { SelectionModel } from '@angular/cdk/collections';\n\nimport { debounceTime, distinctUntilChanged } from 'rxjs/operators';\nimport { fromEvent } from 'rxjs';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { TableModel } from './table-model.interface';\nimport { TableDatabase } from './table-database';\nimport { TableDataSource } from './table-datasource';\nimport { TableActionColor } from './table-action-color.enum';\n\n@Component({\n  selector: 'igo-table',\n  templateUrl: './table.component.html',\n  styleUrls: ['./table.component.scss']\n})\nexport class TableComponent implements OnChanges, OnInit, AfterViewInit {\n  @Input()\n  get database(): TableDatabase {\n    return this._database;\n  }\n  set database(value: TableDatabase) {\n    this._database = value;\n  }\n  private _database: TableDatabase;\n\n  @Input()\n  get model(): TableModel {\n    return this._model;\n  }\n  set model(value: TableModel) {\n    this._model = value;\n  }\n  private _model: TableModel;\n\n  @Input()\n  get hasFilterInput(): boolean {\n    return this._hasFIlterInput;\n  }\n  set hasFilterInput(value: boolean) {\n    this._hasFIlterInput = value;\n  }\n  private _hasFIlterInput = true;\n\n  public displayedColumns;\n  public dataSource: TableDataSource | null;\n  public selection = new SelectionModel<any>(true, []);\n\n  @Output()\n  select = new EventEmitter<{\n    added: any[];\n    removed: any[];\n    source: SelectionModel<any>;\n  }>();\n\n  @ViewChild('filter') filter: ElementRef;\n  @ViewChild(MatSort, { static: true }) sort: MatSort;\n\n  ngOnInit() {\n    this.dataSource = new TableDataSource(this.database, this.model, this.sort);\n\n    if (this.model) {\n      this.displayedColumns = this.model.columns\n        .filter(c => c.displayed !== false)\n        .map(c => c.name);\n\n      if (this.model.selectionCheckbox) {\n        this.displayedColumns.unshift('selectionCheckbox');\n      }\n      if (this.model.actions && this.model.actions.length) {\n        this.displayedColumns.push('action');\n      }\n    }\n\n    this.selection.changed.subscribe(e => this.select.emit(e));\n  }\n\n  ngAfterViewInit() {\n    if (this.filter) {\n      fromEvent(this.filter.nativeElement, 'keyup')\n        .pipe(\n          debounceTime(150),\n          distinctUntilChanged()\n        )\n        .subscribe(() => {\n          if (!this.dataSource) {\n            return;\n          }\n          this.dataSource.filter = this.filter.nativeElement.value;\n        });\n    }\n  }\n\n  ngOnChanges(change) {\n    if (change.database) {\n      this.dataSource = new TableDataSource(\n        this.database,\n        this.model,\n        this.sort\n      );\n      this.selection.clear();\n    }\n  }\n\n  getActionColor(colorId: number): string {\n    return TableActionColor[colorId];\n  }\n\n  getValue(row, key) {\n    return ObjectUtils.resolve(row, key);\n  }\n\n  /** Whether the number of selected elements matches the total number of rows. */\n  isAllSelected() {\n    const numSelected = this.selection.selected.length;\n    const numRows = this.database.data.length;\n    return numSelected === numRows;\n  }\n\n  /** Selects all rows if they are not all selected; otherwise clear selection. */\n  masterToggle() {\n    this.isAllSelected()\n      ? this.selection.clear()\n      : this.database.data.forEach(row => this.selection.select(row));\n  }\n\n  handleClickAction(event, action, row) {\n    event.stopPropagation();\n    action.click(row);\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { CdkTableModule } from '@angular/cdk/table';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSortModule } from '@angular/material/sort';\nimport { MatTableModule } from '@angular/material/table';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { TableComponent } from './table.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    CdkTableModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTableModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSortModule,\n    MatCheckboxModule,\n    IgoLanguageModule\n  ],\n  declarations: [TableComponent],\n  exports: [TableComponent]\n})\nexport class IgoTableModule {\n  static forRoot(): ModuleWithProviders<IgoTableModule> {\n    return {\n      ngModule: IgoTableModule,\n      providers: []\n    };\n  }\n}\n","import { EntityStore } from '../../entity';\nimport { Action } from './action.interfaces';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * actions.\n */\nexport class ActionStore extends EntityStore<Action> {\n\n}\n","export enum ToolboxColor {\n  White = 'white',\n  Grey = 'grey',\n  Primary = 'primary'\n}\n","import {\n  trigger,\n  state,\n  style,\n  transition,\n  animate,\n  AnimationTriggerMetadata\n} from '@angular/animations';\n\nexport function toolSlideInOut(\n  speed = '300ms',\n  type = 'ease-in-out'\n): AnimationTriggerMetadata {\n  return trigger('toolSlideInOut', [\n    state(\n      'enter',\n      style({\n        transform: 'translate3d(0, 0, 0)'\n      })\n    ),\n    transition('void => enter', animate(speed + ' ' + type))\n  ]);\n}\n","<igo-actionbar\n  *ngIf=\"(toolbar$ | async).length > 0\"\n  [store]=\"actionStore\"\n  [withIcon]=\"true\"\n  [withTitle]=\"toolbarWithTitle$ | async\"\n  [withTooltip]=\"(toolbarWithTitle$ | async) === false\"\n  [scrollActive]=\"toolbarWithTitle$ | async\"\n  [horizontal]=\"false\">\n</igo-actionbar>\n\n<div\n  *ngIf=\"activeTool$ | async as tool\"\n  class=\"igo-tool-container\"\n  [ngClass]=\"{'igo-tool-container-with-toolbar': !actionStore.empty, 'igo-tool-container-with-animation': animate}\"\n  [@toolSlideInOut]=\"animation$ | async\"\n  (@toolSlideInOut.start)=\"onAnimationStart()\"\n  (@toolSlideInOut.done)=\"onAnimationComplete()\">\n\n  <igo-dynamic-outlet\n    [component]=\"tool.component\"\n    [inputs]=\"getToolInputs(tool)\">\n  </igo-dynamic-outlet>\n\n</div>\n","import {\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  HostBinding,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { Subscription, BehaviorSubject, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Action, ActionStore } from '../../action';\nimport { Tool } from '../shared/tool.interface';\nimport { ToolboxColor } from '../shared/toolbox.enums';\nimport { Toolbox } from '../shared/toolbox';\nimport { toolSlideInOut } from './toolbox.animation';\n\n@Component({\n  selector: 'igo-toolbox',\n  templateUrl: 'toolbox.component.html',\n  styleUrls: ['toolbox.component.scss'],\n  animations: [toolSlideInOut()],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ToolboxComponent implements OnInit, OnDestroy {\n  /**\n   * Observable of the active tool\n   */\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\n\n  /**\n   * Store of actions that toggle tools\n   */\n  actionStore: ActionStore = new ActionStore([]);\n\n  /**\n   * Observable of he anmation state\n   */\n  animation$: BehaviorSubject<string> = new BehaviorSubject('none');\n\n  /**\n   * Observable of the toolbar\n   */\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\n\n  /**\n   * Whether the Toolbar should display actions' titles\n   */\n  toolbarWithTitle$: Observable<boolean> = this.activeTool$.pipe(\n    map((tool: Tool | undefined) => tool === undefined)\n  );\n\n  /**\n   * Subscription to the active tool\n   */\n  private activeTool$$: Subscription;\n\n  /**\n   * Subscription to the toolbar\n   */\n  private toolbar$$: Subscription;\n\n  /**\n   * Observable of the ongoing animation. This is useful when\n   * multiple animations are triggered at once i.e. when the user clicks\n   * too fast on different actions\n   */\n  private animating$ = new BehaviorSubject<boolean>(false);\n\n  /**\n   * Subscription to the ongoing animation\n   */\n  private animating$$: Subscription;\n\n  /**\n   * Toolbox\n   */\n  @Input() toolbox: Toolbox;\n\n  /**\n   * Whether the toolbox should animate the first tool entering\n   */\n  @Input() animate: boolean = false;\n\n  /**\n   * Color of Toolbox\n   */\n  @Input() color: ToolboxColor = ToolboxColor.White;\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.color-grey')\n  get classColorGrey() {\n    return this.color === ToolboxColor.Grey;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.color-primary')\n  get classColorPrimary() {\n    return this.color === ToolboxColor.Primary;\n  }\n\n  /**\n   * Initialize the toolbar and subscribe to the active tool\n   * @internal\n   */\n  ngOnInit() {\n    this.toolbar$$ = this.toolbox.toolbar$.subscribe((toolbar: string[]) =>\n      this.onToolbarChange(toolbar)\n    );\n    this.activeTool$$ = this.toolbox.activeTool$.subscribe((tool: Tool) =>\n      this.onActiveToolChange(tool)\n    );\n  }\n\n  /**\n   * Unsubscribe to the active tool and destroy the action store\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toolbar$$.unsubscribe();\n    this.activeTool$$.unsubscribe();\n    this.actionStore.destroy();\n  }\n\n  /**\n   * Track the starting animation\n   * @internal\n   */\n  onAnimationStart() {\n    this.animating$.next(true);\n  }\n\n  /**\n   * Untrack the completed animation\n   * @internal\n   */\n  onAnimationComplete() {\n    this.animating$.next(false);\n  }\n\n  /**\n   * Return a tool's inputs\n   * @param tool Tool\n   * @returns Tool inputs\n   * @internal\n   */\n  getToolInputs(tool: Tool): { [key: string]: any } {\n    return tool.options || {};\n  }\n\n  /**\n   * Initialize an action store\n   * @param toolbar Toolbar\n   */\n  private onToolbarChange(toolbar: string[]) {\n    this.setToolbar(toolbar);\n  }\n\n  /**\n   * Activate a tool and trigger an animation or not\n   * @param tool Tool to activate\n   */\n  private onActiveToolChange(tool: Tool) {\n    if (!this.animate) {\n      this.setActiveTool(tool);\n      return;\n    }\n    this.onAnimate(() => this.setActiveTool(tool));\n  }\n\n  /**\n   * Set the active tool\n   * @param tool Tool to activate\n   */\n  private setActiveTool(tool: Tool | undefined) {\n    if (tool === undefined) {\n      this.actionStore.state.updateAll({ active: false });\n    } else {\n      const action = this.actionStore.get(tool.name);\n      if (action !== undefined) {\n        this.actionStore.state.update(action, { active: true }, true);\n      }\n    }\n\n    this.activeTool$.next(tool);\n    if (this.animate) {\n      this.animation$.next('enter');\n    }\n  }\n\n  /**\n   * Initialize the toolbar\n   */\n  private setToolbar(toolbar: string[]) {\n    const actions = toolbar.reduce((acc: Action[], toolName: string) => {\n      const tool = this.toolbox.getTool(toolName);\n      if (tool === undefined) {\n        return acc;\n      }\n\n      acc.push({\n        id: tool.name,\n        title: tool.title,\n        icon: tool.icon,\n        // iconImage: tool.iconImage,\n        tooltip: tool.tooltip,\n        args: [tool, this.toolbox],\n        handler: (_tool: Tool, _toolbox: Toolbox) => {\n          _toolbox.activateTool(_tool.name);\n        },\n        ngClass: (_tool: Tool, _toolbox: Toolbox) => {\n          return this.toolbox.activeTool$.pipe(\n            map((activeTool: Tool) => {\n              let toolActivated = false;\n              if (activeTool !== undefined && _tool.name === activeTool.name) {\n                toolActivated = true;\n              }\n\n              let childrenToolActivated = false;\n              if (\n                activeTool !== undefined &&\n                _tool.name === activeTool.parent\n              ) {\n                childrenToolActivated = true;\n              }\n\n              return {\n                'tool-activated': toolActivated,\n                'children-tool-activated': childrenToolActivated\n              };\n            })\n          );\n        }\n      });\n      return acc;\n    }, []);\n    this.actionStore.load(actions);\n    this.toolbar$.next(toolbar);\n  }\n\n  /**\n   * Observe the ongoing animation and ignore any incoming animation\n   * while one is still ongoing.\n   * @param callback Callback to execute when the animation completes\n   */\n  private onAnimate(callback: () => void) {\n    this.unAnimate();\n    this.animating$$ = this.animating$.subscribe((animation: boolean) => {\n      if (!animation) {\n        callback.call(this);\n        this.unAnimate();\n      }\n    });\n  }\n\n  /**\n   * Stop observing an animation when it's complete\n   */\n  private unAnimate() {\n    if (this.animating$$) {\n      this.animating$$.unsubscribe();\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoActionModule } from '../../action/action.module';\nimport {\n    IgoDynamicComponentModule\n} from '../../dynamic-component/dynamic-component.module';\n\nimport { ToolboxComponent } from './toolbox.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoActionModule,\n    IgoDynamicComponentModule\n  ],\n  exports: [\n    ToolboxComponent\n  ],\n  declarations: [\n    ToolboxComponent\n  ]\n})\nexport class IgoToolboxModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { ToolService } from './shared/tool.service';\nimport { IgoToolboxModule } from './toolbox/toolbox.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoToolboxModule\n  ],\n  declarations: []\n})\nexport class IgoToolModule {\n  static forRoot(): ModuleWithProviders<IgoToolModule> {\n    return {\n      ngModule: IgoToolModule,\n      providers: [\n        ToolService\n      ]\n    };\n  }\n}\n","<igo-dynamic-outlet\n  *ngIf=\"widget\"\n  [component]=\"widget\"\n  [inputs]=\"inputs\"\n  [subscribers]=\"getEffectiveSubscribers()\">\n</igo-dynamic-outlet>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnDestroy\n} from '@angular/core';\n\nimport { DynamicComponent } from '../../dynamic-component';\n\nimport { WidgetComponent } from '../shared/widget.interfaces';\n\n/**\n * This component dynamically renders a widget. It also subscribes\n * to the widget's 'cancel' and 'complete' events and destroys it\n * when any of those event is emitted.\n */\n@Component({\n  selector: 'igo-widget-outlet',\n  templateUrl: './widget-outlet.component.html',\n  styleUrls: ['./widget-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WidgetOutletComponent implements OnDestroy {\n\n  /**\n   * Widget subscribers to 'cancel' and 'complete'\n   * @internal\n   */\n  private baseSubscribers = {\n    cancel: (event: any) => this.onCancel(event),\n    complete: (event: any) => this.onComplete(event)\n  };\n\n  /**\n   * Widget\n   */\n  @Input() widget: DynamicComponent<WidgetComponent>;\n\n  /**\n   * Widget inputs\n   */\n  @Input() inputs: {[key: string]: any};\n\n  /**\n   * Widget subscribers\n   */\n  @Input() subscribers: {[key: string]: (event: any) => void} = {};\n\n  /**\n   * Event emitted when the widget emits 'complete'\n   */\n  @Output() complete = new EventEmitter<any>();\n\n  /**\n   * Event emitted when the widget emits 'cancel'\n   */\n  @Output() cancel = new EventEmitter<any>();\n\n  constructor() {}\n\n  /**\n   * Destroy the current widget and all it's inner subscriptions\n   * @internal\n   */\n  ngOnDestroy() {\n    this.destroyWidget();\n  }\n\n  /**\n   * Get the effective subscribers. That means a combination of the base\n   * subscribers and any subscriber given as input.\n   * @returns Combined subscribers\n   * @internal\n   */\n  getEffectiveSubscribers(): {[key: string]: (event: any) => void} {\n    const subscribers = Object.assign({}, this.subscribers);\n\n    // Base subscribers\n    Object.keys(this.baseSubscribers).forEach((key: string) => {\n      const subscriber = subscribers[key];\n      const baseSubscriber = this.baseSubscribers[key];\n      if (subscriber !== undefined) {\n        subscribers[key] = (event: any) => {\n          subscriber(event);\n          baseSubscriber(event);\n        };\n      } else {\n        subscribers[key] = baseSubscriber;\n      }\n    });\n\n    return subscribers;\n  }\n\n  /**\n   * When the widget emits 'cancel', propagate that event and destroy\n   * the widget\n   */\n  private onCancel(event: any) {\n    this.cancel.emit(event);\n    this.destroyWidget();\n  }\n\n  /**\n   * When the widget emits 'complete', propagate that event and destroy\n   * the widget\n   */\n  private onComplete(event: any) {\n    this.complete.emit(event);\n    this.destroyWidget();\n  }\n\n  /**\n   * Destroy the current widget\n   */\n  private destroyWidget() {\n    if (this.widget !== undefined) {\n      this.widget.destroy();\n    }\n    this.widget = undefined;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport {\n  IgoDynamicComponentModule\n} from '../../dynamic-component/dynamic-component.module';\n\nimport { WidgetOutletComponent } from './widget-outlet.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoDynamicComponentModule\n  ],\n  exports: [\n    WidgetOutletComponent\n  ],\n  declarations: [\n    WidgetOutletComponent\n  ]\n})\nexport class IgoWidgetOutletModule {}\n","import { Injectable } from '@angular/core';\n\nimport { DynamicComponentService } from '../../dynamic-component/shared/dynamic-component.service';\n\nimport { Widget } from './widget';\nimport { WidgetComponent } from './widget.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WidgetService {\n\n  constructor(private dynamicComponentService: DynamicComponentService) {}\n\n  create(widgetCls: any): Widget {\n    return this.dynamicComponentService.create(widgetCls as WidgetComponent);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoWidgetOutletModule } from './widget-outlet/widget-outlet.module';\nimport { WidgetService } from './shared/widget.service';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoWidgetOutletModule\n  ],\n  exports: [\n    IgoWidgetOutletModule\n  ],\n  declarations: [],\n  providers: [\n    WidgetService\n  ]\n})\nexport class IgoWidgetModule {}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { getEntityTitle } from '../../entity';\nimport { Workspace } from '../shared/workspace';\nimport { WorkspaceStore } from '../shared/store';\n\n/**\n * Drop list that activates the selected workspace emit an event.\n */\n@Component({\n  selector: 'igo-workspace-selector',\n  templateUrl: './workspace-selector.component.html',\n  styleUrls: ['./workspace-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WorkspaceSelectorComponent {\n\n  /**\n   * Store that holds the available workspaces.\n   */\n  @Input() store: WorkspaceStore;\n\n  /**\n   * Event emitted when an workspace is selected or unselected\n   */\n  @Output() selectedChange = new EventEmitter<{\n    selected: boolean;\n    value: Workspace;\n  }>();\n\n  /**\n   * @internal\n   */\n  getWorkspaceTitle(workspace: Workspace): string {\n    return getEntityTitle(workspace);\n  }\n\n  /**\n   * When an workspace is manually selected, select it into the\n   * store and emit an event.\n   * @internal\n   * @param event The selection change event\n   */\n  onSelectedChange(event: {value: Workspace}) {\n    const workspace = event.value;\n    this.store.activateWorkspace(workspace);\n    this.selectedChange.emit({selected: true, value: workspace});\n  }\n\n}\n","<igo-entity-selector\n  [store]=\"store\"\n  [multi]=\"false\"\n  [titleAccessor]=\"getWorkspaceTitle\"\n  (selectedChange)=\"onSelectedChange($event)\">\n</igo-entity-selector>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoEntitySelectorModule } from '../../entity/entity-selector/entity-selector.module';\nimport { WorkspaceSelectorComponent } from './workspace-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoEntitySelectorModule\n  ],\n  exports: [\n    WorkspaceSelectorComponent\n  ],\n  declarations: [\n    WorkspaceSelectorComponent\n  ]\n})\nexport class IgoWorkspaceSelectorModule {}\n","<ng-container *ngIf=\"widget$ | async as widget\">\n  <igo-widget-outlet\n    [widget]=\"widget\"\n    [inputs]=\"widgetInputs$ | async\"\n    [subscribers]=\"widgetSubscribers$ | async\"\n    (cancel)=\"onWidgetCancel(widget)\"\n    (complete)=\"onWidgetComplete(widget)\">\n  </igo-widget-outlet>\n</ng-container>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Widget } from '../../widget';\nimport { Workspace } from '../shared/workspace';\n\n/**\n * This component dynamically render an Workspace's active widget.\n * It also deactivate that widget whenever the widget's component\n * emit the 'cancel' or 'complete' event.\n */\n@Component({\n  selector: 'igo-workspace-widget-outlet',\n  templateUrl: './workspace-widget-outlet.component.html',\n  styleUrls: ['./workspace-widget-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WorkspaceWidgetOutletComponent {\n\n  /**\n   * Workspace\n   */\n  @Input() workspace: Workspace;\n\n  /**\n   * Event emitted when a widget is deactivate which happens\n   * when the widget's component emits the 'cancel' or 'complete' event.\n   */\n  @Output() deactivateWidget = new EventEmitter<Widget>();\n\n  /**\n   * Observable of the workspace's active widget\n   * @internal\n   */\n  get widget$(): BehaviorSubject<Widget> { return this.workspace.widget$; }\n\n  /**\n   * Observable of the workspace's widget inputs\n   * @internal\n   */\n  get widgetInputs$(): BehaviorSubject<{[key: string]: any}> {\n    return this.workspace.widgetInputs$;\n  }\n\n  /**\n   * Observable of the workspace's widget inputs\n   * @internal\n   */\n  get widgetSubscribers$(): BehaviorSubject<{[key: string]: (event: any) => void}> {\n    return this.workspace.widgetSubscribers$;\n  }\n\n  constructor() {}\n\n  /**\n   * When a widget's component emit the 'cancel' event,\n   * deactivate that widget and emit the 'deactivateWidget' event.\n   * @param widget Widget\n   * @internal\n   */\n  onWidgetCancel(widget: Widget) {\n    this.workspace.deactivateWidget();\n    this.deactivateWidget.emit(widget);\n  }\n\n  /**\n   * When a widget's component emit the 'cancel' event,\n   * deactivate that widget and emit the 'deactivateWidget' event.\n   * @param widget Widget\n   * @internal\n   */\n  onWidgetComplete(widget: Widget) {\n    this.workspace.deactivateWidget();\n    this.deactivateWidget.emit(widget);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoWidgetOutletModule } from '../../widget/widget-outlet/widget-outlet.module';\n\nimport { WorkspaceWidgetOutletComponent } from './workspace-widget-outlet.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoWidgetOutletModule\n  ],\n  exports: [\n    WorkspaceWidgetOutletComponent\n  ],\n  declarations: [\n    WorkspaceWidgetOutletComponent\n  ]\n})\nexport class IgoWorkspaceWidgetOutletModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\nimport { IgoWorkspaceWidgetOutletModule } from './workspace-widget-outlet/workspace-widget-outlet.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceWidgetOutletModule\n  ],\n  declarations: []\n})\nexport class IgoWorkspaceModule {}\n","import { BehaviorSubject } from 'rxjs';\n\nexport class TableDatabase {\n  /** Stream that emits whenever the data has been modified. */\n  dataChange: BehaviorSubject<any[]> = new BehaviorSubject<any[]>([]);\n  get data(): any[] {\n    return this.dataChange.value;\n  }\n\n  constructor(data?) {\n    if (data) {\n      this.dataChange.next(data);\n    }\n  }\n\n  set(data) {\n    this.dataChange.next(data);\n  }\n\n  add(item) {\n    const copiedData = this.data.slice();\n    copiedData.push(item);\n    this.set(copiedData);\n  }\n\n  remove(item) {\n    const copiedData = this.data.slice();\n    const index = copiedData.indexOf(item);\n    copiedData.splice(index, 1);\n    this.set(copiedData);\n  }\n}\n","import { Tool } from './tool.interface';\nimport { ToolService } from './tool.service';\n\nexport function ToolComponent(tool: Partial<Tool>): (cls: any) => any {\n  return (compType: any) => {\n    ToolService.register(Object.assign({}, tool, {\n      component: compType\n    } as Tool));\n  };\n}\n","import { EntityStore } from '../../entity';\nimport { Workspace } from './workspace';\nimport { BehaviorSubject } from 'rxjs';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * workspaces.\n */\nexport class WorkspaceStore extends EntityStore<Workspace> {\n\n  activeWorkspace$: BehaviorSubject<Workspace> = new BehaviorSubject(undefined);\n\n  /**\n   * Activate the an workspace workspace and deactivate the one currently active\n   * @param workspace Workspace\n   */\n  activateWorkspace(workspace: Workspace) {\n    const active = this.activeWorkspace$.value;\n    if (active !== undefined) {\n      active.deactivate();\n    }\n\n    this.deactivateWorkspace();\n    if (workspace !== undefined) {\n      this.state.update(workspace, {active: true, selected: true}, true);\n      this.activeWorkspace$.next(workspace);\n      workspace.activate();\n    }\n  }\n\n  /**\n   * Deactivate the current workspace\n   * @param workspace Workspace\n   */\n  deactivateWorkspace() {\n    const active = this.activeWorkspace$.value;\n    if (active !== undefined) {\n      active.deactivate();\n      this.activeWorkspace$.next(undefined);\n    }\n  }\n\n}\n","import { Subscription, BehaviorSubject, Subject } from 'rxjs';\n\nimport { ActionStore } from '../../action';\nimport { Widget } from '../../widget';\nimport { EntityStore } from '../../entity';\n\nimport { WorkspaceOptions } from './workspace.interfaces';\n\n/**\n * This class is responsible of managing the relations between\n * entities and the actions that consume them. It also defines an\n * entity table template that may be used by an entity table component.\n */\nexport class Workspace<E extends object = object> {\n\n  /**\n   * Observable of the selected widget\n   */\n  readonly widget$ = new BehaviorSubject<Widget>(undefined);\n\n  /**\n   * Observable of the selected widget's inputs\n   */\n  readonly widgetInputs$ = new BehaviorSubject<{[key: string]: any}>({});\n\n  /**\n   * Observable of the selected widget's subscribers\n   */\n  readonly widgetSubscribers$ = new BehaviorSubject<{[key: string]: (event: any) => void}>({});\n\n  /**\n   * Subscription to the selected entity\n   */\n  private entities$$: Subscription;\n\n  /**\n   * State change that trigger an update of the actions availability\n   */\n  private change: Subject<void> = new Subject();\n\n  /**\n   * Subscription to state changes\n   */\n  private change$: Subscription;\n\n  /**\n   * Workspace id\n   */\n  get id(): string { return this.options.id; }\n\n  /**\n   * Workspace title\n   */\n  get title(): string { return this.options.title; }\n\n  /**\n   * Workspace title\n   */\n  get meta(): {[key: string]: any} { return this.options.meta || {}; }\n\n  /**\n   * Entities store\n   */\n  get entityStore(): EntityStore<E> { return this.options.entityStore as EntityStore<E>; }\n\n  /**\n   * Actions store (some actions activate a widget)\n   */\n  get actionStore(): ActionStore { return this.options.actionStore; }\n\n  /**\n   * Selected widget\n   */\n  get widget(): Widget { return this.widget$.value; }\n\n  /**\n   * Whether a widget is selected\n   */\n  get hasWidget(): boolean { return this.widget !== undefined; }\n\n  constructor(protected options: WorkspaceOptions) {}\n\n  /**\n   * Whether this strategy is active\n   * @internal\n   */\n  get active(): boolean { return this.active$.value; }\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Activate the workspace. By doing that, the workspace will observe\n   * the selected entity (from the store) and update the actions availability.\n   * For example, some actions require an entity to be selected.\n   */\n  activate() {\n    if (this.active === true) {\n      this.deactivate();\n    }\n    this.active$.next(true);\n\n    if (this.entityStore !== undefined) {\n      this.entities$$ = this.entityStore.stateView.all$()\n        .subscribe(() => this.onStateChange());\n    }\n\n    this.change.next();\n  }\n\n  /**\n   * Deactivate the workspace. Unsubcribe to the selected entity.\n   */\n  deactivate() {\n    this.active$.next(false);\n    this.deactivateWidget();\n\n    if (this.entities$$ !== undefined) {\n      this.entities$$.unsubscribe();\n    }\n    if (this.change$ !== undefined) {\n      this.change$.unsubscribe();\n    }\n  }\n\n  /**\n   * Activate a widget. In itself, activating a widget doesn't render it but,\n   * if an WorkspaceWidgetOutlet component is bound to this workspace, the widget will\n   * show up.\n   * @param widget Widget\n   * @param inputs Inputs the widget will receive\n   */\n  activateWidget(\n    widget: Widget,\n    inputs: {[key: string]: any} = {},\n    subscribers: {[key: string]: (event: any) => void} = {}\n  ) {\n    this.widget$.next(widget);\n    this.widgetInputs$.next(inputs);\n    this.widgetSubscribers$.next(subscribers);\n    this.change.next();\n  }\n\n  /**\n   * Deactivate a widget.\n   */\n  deactivateWidget() {\n    this.widget$.next(undefined);\n    this.change.next();\n  }\n\n  /**\n   * When the state changes, update the actions availability.\n   */\n  private onStateChange() {\n    this.change.next();\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppHomeComponent } from './home.component';\n\nconst routes: Routes = [\n  {\n    path: 'home',\n    component: AppHomeComponent\n  }\n];\n\nexport const AppHomeRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\nimport { InteractiveTourService } from '@igo2/common';\n\n@Component({\n  selector: 'app-home',\n  templateUrl: './home.component.html',\n  styleUrls: ['./home.component.scss']\n})\nexport class AppHomeComponent {\n  constructor(private interactiveTourService: InteractiveTourService) {}\n\n  startTour() {\n    this.interactiveTourService.startTour('global');\n  }\n}\n","<div style=\"text-align:center\">\n  <h1 id=\"igo-title\">\n    Welcome to IGO\n  </h1>\n  <img  class=\"igo-logo\" width=\"180\" src=\"assets/igo2/core/logo.png\">\n</div>\n\n<p>\n  <igo-interactive-tour\n    tourToStart = \"global\"\n    menuIsOpen = true\n    styleButton = \"raised\">\n  </igo-interactive-tour>\n</p>\n\n<p>\n  IGO2 library contains many components and services that may benefit any web application. <br>\n  IGO2 library is open source project using Angular, Angular Material and OpenLayers.\n</p>\n\n<h3>IGO2 library is divided into several elements: </h3>\n<ul>\n  <li><b>@igo2/utils</b> : Basic utilies without dependency (ex: base64, clipboard, uuid)</li>\n  <li><b>@igo2/core</b> : Element affecting the core of the application (ex: config, language, message, media, request)</li>\n  <li><b>@igo2/common</b> : Library containing reusable components (ex: clickout, drag-drop, list, panel, spinner, table)</li>\n  <li><b>@igo2/auth</b> : Library grouping the authentication and security module</li>\n  <li><b>@igo2/geo</b> : Library containing the geomatic components. Depends on Openlayers.</li>\n  <li><b>@igo2/context</b> : Library of components uniting @igo2/geo and @igo2/auth</li>\n  <li><b>@igo2/integration</b> : Library integrate basic components</li>\n</ul>\n\n<h2>Here are some links to help you start: </h2>\n<ul>\n  <li>\n    <h2><a target=\"_blank\" rel=\"noopener\" href=\"https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation\">Installation</a></h2>\n  </li>\n  <li>\n    <h2><a target=\"_blank\" rel=\"noopener\" href=\"https://angular.io/docs\">Angular Documentation</a></h2>\n  </li>\n</ul>\n\n*** Modules in <code>@igo2/core</code> must be imported only once\n","import { NgModule } from '@angular/core';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { AppHomeComponent } from './home.component';\nimport { AppHomeRoutingModule } from './home-routing.module';\nimport { IgoInteractiveTourModule } from '@igo2/common';\n\n@NgModule({\n  declarations: [AppHomeComponent],\n  imports: [\n    AppHomeRoutingModule,\n    IgoInteractiveTourModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule\n  ],\n  exports: [AppHomeComponent]\n})\nexport class AppHomeModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppActivityComponent } from './activity.component';\n\nconst routes: Routes = [\n  {\n    path: 'activity',\n    component: AppActivityComponent\n  }\n];\n\nexport const AppActivityRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { ActivityService } from '@igo2/core';\n\n@Component({\n  selector: 'app-activity',\n  templateUrl: './activity.component.html',\n  styleUrls: ['./activity.component.scss']\n})\nexport class AppActivityComponent {\n  private idsActivity: string[] = [];\n\n  constructor(private activityService: ActivityService) {}\n\n  register() {\n    this.idsActivity.push(this.activityService.register());\n  }\n\n  unregister() {\n    this.activityService.unregister(this.idsActivity.pop());\n  }\n\n  get counter() {\n    return this.activityService.counter$.value;\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>Activity</mat-card-title>\n  <mat-card-content>\n    <p>Register activities in service. Use to display a loading icon</p>\n\n    <li>Import <code>IgoActivityModule</code> only if you want register http calls</li>\n    <li>Import <code>IgoActivityModule</code> only once</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/activity\"> code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <mat-card-actions>\n    <button mat-raised-button (click)=\"register()\">Register</button>\n    <button mat-raised-button (click)=\"unregister()\">Unregister</button>\n  </mat-card-actions>\n  <p>Counter: {{counter}}</p>\n\n  <igo-spinner igoSpinnerActivity></igo-spinner>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoActivityModule } from '@igo2/core';\nimport { IgoSpinnerModule } from '@igo2/common';\n\nimport { AppActivityComponent } from './activity.component';\nimport { AppActivityRoutingModule } from './activity-routing.module';\n\n@NgModule({\n  declarations: [AppActivityComponent],\n  imports: [\n    AppActivityRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoActivityModule.forRoot(), // Only if you want register http calls\n    IgoSpinnerModule\n  ],\n  exports: [AppActivityComponent]\n})\nexport class AppActivityModule {}\n","interface Environment {\n  production: boolean;\n  igo: any;\n}\n\nexport const environment: Environment = {\n  production: true,\n  igo: {\n    projections: [\n      {\n        code: 'EPSG:32198',\n        alias: 'Quebec Lambert',\n        def:\n          '+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs',\n        extent: [-886251.0296, 180252.9126, 897177.3418, 2106143.8139]\n      }\n    ],\n    auth: {\n      intern: {\n        enabled: true\n      },\n      allowAnonymous: true\n    },\n    interactiveTour: {\n      tourInMobile: true\n    },\n    importExport: {\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ogre'\n    },\n    language: {\n      prefix: './locale/'\n    },\n    catalog: {\n      sources: [\n        {\n          id: 'Gououvert',\n          title: 'Gouvouvert',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi'\n        },\n        {\n          id: 'DefiningInfoFormat',\n          title: 'Defining info_format',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          queryFormat: {\n            html: '*',\n            'application/json': [\n              'stations_meteoroutieres',\n              'histo_stations_meteoroutieres'\n            ]\n          },\n          queryHtmlTarget: 'iframe',\n          count: 30\n        },\n        {\n          id: 'catalogwithregex',\n          title: 'Filtered catalog by regex',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          regFilters: ['zpegt']\n        },\n        {\n          id: 'catalogwithtooltipcontrol',\n          title: 'Controling tooltip format',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          tooltipType: 'abstract' // or title\n        }\n      ]\n    },\n    searchSources: {\n      nominatim: {\n        enabled: false\n      },\n      icherche: {\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\n        order: 2,\n        enabled: true,\n        params: {\n          limit: '8'\n        }\n      },\n      coordinatesreverse: {\n        showInPointerSummary: true\n      },\n      icherchereverse: {\n        showInPointerSummary: true,\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\n        order: 3,\n        enabled: true\n      },\n      ilayer: {\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\n        order: 4,\n        enabled: true,\n        params: {\n          limit: '5'\n        }\n      }\n    }\n  }\n};\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppConfigComponent } from './config.component';\n\nconst routes: Routes = [\n  {\n    path: 'config',\n    component: AppConfigComponent\n  }\n];\n\nexport const AppConfigRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\nimport { ConfigService, LanguageOptions } from '@igo2/core';\n\n@Component({\n  selector: 'app-config',\n  templateUrl: './config.component.html',\n  styleUrls: ['./config.component.scss']\n})\nexport class AppConfigComponent {\n  public configLanguage: LanguageOptions;\n\n  constructor(private configService: ConfigService) {\n    this.configLanguage = this.configService.getConfig('language');\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>config</mat-card-title>\n  <mat-card-content>\n    <p>Load config in your angular application</p>\n\n    <li>Import <code>IgoConfigModule</code> only once</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/config\"> code of this example</a> <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\n    <hr>\n  </mat-card-content>\n\n  <p>Config language: {{configLanguage | json }}<p>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoConfigModule, provideConfigOptions } from '@igo2/core';\n\nimport { environment } from '../../../environments/environment';\nimport { AppConfigComponent } from './config.component';\nimport { AppConfigRoutingModule } from './config-routing.module';\n\n@NgModule({\n  declarations: [AppConfigComponent],\n  imports: [\n    AppConfigRoutingModule,\n    CommonModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoConfigModule.forRoot()\n  ],\n  exports: [AppConfigComponent],\n  providers: [\n    provideConfigOptions({\n      default: environment.igo\n    })\n  ]\n})\nexport class AppConfigModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppLanguageComponent } from './language.component';\n\nconst routes: Routes = [\n  {\n    path: 'language',\n    component: AppLanguageComponent\n  }\n];\n\nexport const AppLanguageRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-language',\n  templateUrl: './language.component.html',\n  styleUrls: ['./language.component.scss']\n})\nexport class AppLanguageComponent {\n  public app = {\n    title: 'IGO'\n  };\n  constructor(private languageService: LanguageService) {}\n\n  changeLanguage(language: string) {\n    this.languageService.setLanguage(language);\n    console.log(this.languageService);\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>language</mat-card-title>\n  <mat-card-content>\n    <p>Translate your angular application</p>\n\n    <li>Import <code>IgoLanguageModule</code> only once</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/language\">code of this example</a><br>\n    See language section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a><br>\n    See <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/locale\">locale files</a>\n    <hr>\n  </mat-card-content>\n\n  <mat-card-actions>\n    <button mat-raised-button (click)=\"changeLanguage('en')\">English</button>\n    <button mat-raised-button (click)=\"changeLanguage('fr')\">Français</button>\n  </mat-card-actions>\n\n  <p>{{'welcome' | translate: app}}<p>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { AppLanguageComponent } from './language.component';\nimport { AppLanguageRoutingModule } from './language-routing.module';\n\n@NgModule({\n  declarations: [AppLanguageComponent],\n  imports: [\n    AppLanguageRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoLanguageModule.forRoot()\n  ],\n  exports: [AppLanguageComponent]\n})\nexport class AppLanguageModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppMediaComponent } from './media.component';\n\nconst routes: Routes = [\n  {\n    path: 'media',\n    component: AppMediaComponent\n  }\n];\n\nexport const AppMediaRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { MediaService } from '@igo2/core';\n\n@Component({\n  selector: 'app-media',\n  templateUrl: './media.component.html',\n  styleUrls: ['./media.component.scss']\n})\nexport class AppMediaComponent {\n  constructor(private mediaService: MediaService) {}\n\n  get media() {\n    return this.mediaService.getMedia();\n  }\n\n  get orientation() {\n    return this.mediaService.getOrientation();\n  }\n\n  get isTouchScreen() {\n    return this.mediaService.isTouchScreen();\n  }\n\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>Media</mat-card-title>\n  <mat-card-content>\n    <p>Detect type of media (mobile, tablet, desktop)</p>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/media\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <p>Current media: {{media}}</p>\n  <p>Current orientation: {{orientation}}</p>\n  <p>Device mode:  {{isTouchScreen ? 'Touch device' : 'Not a touch device '}}</p>\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { AppMediaComponent } from './media.component';\nimport { AppMediaRoutingModule } from './media-routing.module';\n\n@NgModule({\n  declarations: [AppMediaComponent],\n  imports: [AppMediaRoutingModule, MatCardModule],\n  exports: [AppMediaComponent]\n})\nexport class AppMediaModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppMessageComponent } from './message.component';\n\nconst routes: Routes = [\n  {\n    path: 'message',\n    component: AppMessageComponent\n  }\n];\n\nexport const AppMessageRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { MessageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-message',\n  templateUrl: './message.component.html',\n  styleUrls: ['./message.component.scss']\n})\nexport class AppMessageComponent {\n  constructor(private messageService: MessageService) {}\n\n  success() {\n    this.messageService.success('Congratulations', 'Success');\n  }\n\n  info() {\n    this.messageService.info('Welcome to IGO', 'Info');\n  }\n\n  alert() {\n    this.messageService.alert('Warning', 'Alert');\n  }\n  error() {\n    this.messageService.error('There is a bug', 'Error');\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>Message</mat-card-title>\n  <mat-card-content>\n    <p>Show message to user.</p>\n\n    <li>Import <code>IgoMessageModule</code> only once</li>\n    <li>Dependencies: BrowserAnimationsModule </li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/message\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <mat-card-actions>\n    <button mat-raised-button (click)=\"success()\">Success message</button>\n    <button mat-raised-button color='primary' (click)=\"info()\">Info message</button>\n    <button mat-raised-button color='accent' (click)=\"alert()\">Alert message</button>\n    <button mat-raised-button color='warn' (click)=\"error()\">Error message</button>\n  </mat-card-actions>\n</mat-card>\n\n<igo-message-center></igo-message-center>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMessageModule } from '@igo2/core';\n\nimport { AppMessageComponent } from './message.component';\nimport { AppMessageRoutingModule } from './message-routing.module';\n\n@NgModule({\n  declarations: [AppMessageComponent],\n  imports: [\n    AppMessageRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMessageModule.forRoot()\n  ],\n  exports: [AppMessageComponent]\n})\nexport class AppMessageModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppRequestComponent } from './request.component';\n\nconst routes: Routes = [\n  {\n    path: 'request',\n    component: AppRequestComponent\n  }\n];\n\nexport const AppRequestRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-request',\n  templateUrl: './request.component.html',\n  styleUrls: ['./request.component.scss']\n})\nexport class AppRequestComponent {\n  constructor(\n    private http: HttpClient,\n    public languageService: LanguageService\n  ) {}\n\n  callHttp() {\n    const url = 'https://geoegl.msp.gouv.qc.ca/apis/icherche/info';\n    this.http.get(url).subscribe(rep => {\n      console.log(rep);\n    });\n  }\n\n  callHttpError() {\n    const url = '404';\n    this.http.get(url).subscribe(rep => {\n      console.log(rep);\n    });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>Request</mat-card-title>\n  <mat-card-content>\n    <p>Register http calls in console</p>\n\n    <li>Import <code>IgoLoggingModule</code> only if you want register http calls in console</li>\n    <li>Import <code>IgoErrorModule</code> only if you want register errors from http call in console</li>\n    <li>Import modules only once</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/request\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <mat-card-actions>\n    <button mat-raised-button (click)=\"callHttp()\">Log</button>\n    <button mat-raised-button (click)=\"callHttpError()\">Error</button>\n  </mat-card-actions>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { HttpClientModule } from '@angular/common/http';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoErrorModule, IgoLanguageModule } from '@igo2/core';\n\nimport { AppRequestComponent } from './request.component';\nimport { AppRequestRoutingModule } from './request-routing.module';\n\n@NgModule({\n  declarations: [AppRequestComponent],\n  imports: [\n    AppRequestRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    HttpClientModule,\n    IgoLanguageModule.forRoot(),\n    IgoErrorModule.forRoot() // Only if you want register errors from http call in console\n    // IgoLoggingModule.forRoot() // Only if you want register http calls in console\n  ],\n  exports: [AppRequestComponent]\n})\nexport class AppRequestModule {}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Action</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/action\">code of this example</a>\n  </mat-card-content>\n\n  <igo-actionbar\n    [store]=\"store\"\n    [withIcon]=\"true\"\n    [withTitle]=\"actionbarMode === 'overlay'\"\n    [horizontal]=\"true\"\n    [mode]=\"actionbarMode\">\n  </igo-actionbar>\n\n</mat-card>\n<p></p>\n\n<mat-card [igoContextMenu]= actionbarMenu>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Action context-menu</mat-card-title>\n  <div></div>\n</mat-card>\n\n\n\n<ng-template #actionbarMenu>\n  <igo-actionbar\n    [store]=\"store\"\n    [withIcon]=\"true\"\n    [horizontal]=\"true\"\n    [mode]=\"'context'\">\n  </igo-actionbar>\n</ng-template>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppActionComponent } from './action.component';\n\nconst routes: Routes = [\n  {\n    path: 'action',\n    component: AppActionComponent\n  }\n];\n\nexport const AppActionRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport {\n  Media,\n  MediaOrientation,\n  MediaService,\n  LanguageService\n} from '@igo2/core';\nimport { ActionStore, ActionbarMode } from '@igo2/common';\nimport { Overlay } from '@angular/cdk/overlay';\n\n@Component({\n  selector: 'app-action',\n  templateUrl: './action.component.html',\n  styleUrls: ['./action.component.scss']\n})\nexport class AppActionComponent implements OnInit, OnDestroy {\n  public store = new ActionStore([]);\n\n  private added$ = new BehaviorSubject(false);\n\n  get actionbarMode(): ActionbarMode {\n    const media = this.mediaService.media$.value;\n    const orientation = this.mediaService.orientation$.value;\n    if (media === Media.Desktop && orientation === MediaOrientation.Landscape) {\n      return ActionbarMode.Dock;\n    }\n    return ActionbarMode.Overlay;\n  }\n\n  constructor(\n    public overlay: Overlay,\n    private mediaService: MediaService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    this.store.load([\n      {\n        id: 'add',\n        title: 'Add',\n        icon: 'plus',\n        tooltip: 'Add Tooltip',\n        handler: () => {\n          alert('Add!');\n          this.added$.next(true);\n        }\n      },\n      {\n        id: 'edit',\n        title: 'Edit',\n        icon: 'pencil',\n        tooltip: 'Edit Tooltip',\n        args: ['1'],\n        handler: (item: string) => {\n          alert(`Edit item ${item}!`);\n        },\n        availability: () => this.added$\n      },\n      {\n        id: 'delete',\n        title: 'Delete',\n        tooltip: 'Delete Tooltip',\n        icon: 'delete',\n        handler: () => {\n          alert('Delete!');\n          this.added$.next(false);\n        },\n        availability: () => this.added$\n      }\n    ]);\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoActionModule, IgoContextMenuModule } from '@igo2/common';\n\nimport { AppActionComponent } from './action.component';\nimport { AppActionRoutingModule } from './action-routing.module';\n\n@NgModule({\n  declarations: [AppActionComponent],\n  imports: [\n    AppActionRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoActionModule,\n    IgoContextMenuModule\n  ],\n  exports: [AppActionComponent]\n})\nexport class AppActionModule {}\n","import { Component, Input, ChangeDetectionStrategy, ChangeDetectorRef } from '@angular/core';\n\nimport { OnUpdateInputs } from '@igo2/common';\n\n@Component({\n  selector: 'app-salutation-component',\n  template: '<p>Hello, my name is {{name}}.</p>',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSalutationComponent implements OnUpdateInputs {\n\n  @Input() name: string;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n}\n\n@Component({\n  selector: 'app-explanation-component',\n  template: '<p>I am a dynamic component, rendered into an IgoDynamicOutlet.</p>',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppExplanationComponent implements OnUpdateInputs {\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n}\n\n@Component({\n  selector: 'app-dynamic-component',\n  templateUrl: './dynamic-component.component.html',\n  styleUrls: ['./dynamic-component.component.scss']\n})\nexport class AppDynamicComponentComponent {\n\n  component: any = AppSalutationComponent;\n\n  inputs = {name: 'Bob'};\n\n  toggleComponent() {\n    this.component = this.component === AppSalutationComponent ?\n      AppExplanationComponent :\n      AppSalutationComponent;\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppDynamicComponentComponent } from './dynamic-component.component';\n\nconst routes: Routes = [\n  {\n    path: 'dynamic-component',\n    component: AppDynamicComponentComponent\n  }\n];\n\nexport const AppDynamicComponentRoutingModule = RouterModule.forChild(\n  routes\n);\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Dynamic Component</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/dynamic-component\">code of this example</a>\n  </mat-card-content>\n\n  <igo-dynamic-outlet\n    [component]=\"component\"\n    [inputs]=\"inputs\">\n  </igo-dynamic-outlet>\n\n  <button mat-flat-button color=\"primary\" (click)=\"toggleComponent()\">Toggle Component</button>\n</mat-card>\n\n\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoDynamicComponentModule } from '@igo2/common';\n\nimport {\n  AppSalutationComponent,\n  AppExplanationComponent,\n  AppDynamicComponentComponent\n} from './dynamic-component.component';\nimport { AppDynamicComponentRoutingModule } from './dynamic-component-routing.module';\n\n@NgModule({\n  declarations: [\n    AppSalutationComponent,\n    AppDynamicComponentComponent,\n    AppExplanationComponent\n  ],\n  imports: [\n    AppDynamicComponentRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoDynamicComponentModule\n  ],\n  exports: [AppDynamicComponentComponent],\n  entryComponents: [\n    AppSalutationComponent,\n    AppExplanationComponent\n  ]\n})\nexport class AppDynamicComponentModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppEntityTableComponent } from './entity-table.component';\n\nconst routes: Routes = [\n  {\n    path: 'entity-table',\n    component: AppEntityTableComponent\n  }\n];\n\nexport const AppEntityTableRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  EntityStore,\n  EntityTableButton,\n  getEntityProperty,\n  EntityTableColumnRenderer,\n  EntityTablePaginatorOptions\n} from '@igo2/common';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'app-entity-table',\n  templateUrl: './entity-table.component.html',\n  styleUrls: ['./entity-table.component.scss']\n})\nexport class AppEntityTableComponent implements OnInit, OnDestroy {\n  public store = new EntityStore([]);\n  public paginator: MatPaginator;\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public paginatorOptions: EntityTablePaginatorOptions = {pageSize: 10};\n\n  public template = {\n    selection: true,\n    selectionCheckbox: true,\n    selectMany: true,\n    sort: true,\n    valueAccessor: (entity: object, name: string) => {\n      return getEntityProperty(entity, name);\n    },\n    columns: [\n      {\n        name: 'selected',\n        title: 'Selected',\n        valueAccessor: (entity: object) => {\n          return this.store.state.get(entity).selected\n            ? 'radiobox-marked'\n            : 'radiobox-blank';\n        },\n        renderer: EntityTableColumnRenderer.Icon\n      },\n      {\n        name: 'id',\n        title: 'ID'\n      },\n      {\n        name: 'name',\n        title: 'Name'\n      },\n      {\n        name: 'description',\n        title: 'Description',\n        renderer: EntityTableColumnRenderer.HTML\n      },\n      {\n        name: 'url',\n        title: 'Hyperlink'\n      },\n      {\n        name: 'image',\n        title: 'Image'\n      },\n      {\n        name: 'action',\n        title: '',\n        valueAccessor: (entity: object) => {\n          return [{\n            icon: 'home',\n            color: 'warn',\n            click: (row) => { console.log(row); }\n          }] as EntityTableButton[];\n        },\n        renderer: EntityTableColumnRenderer.ButtonGroup\n      }\n    ]\n  };\n\n  constructor(private languageService: LanguageService) {}\n\n  ngOnInit() {\n    const ids = [2, 1, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13];\n\n    const entities = ids.map(id => {\n      return { id , name: `Name ${id}`, description: `<b>Description ${id}</b>`, url: 'https://igouverte.org', image: 'https://www.igouverte.org/assets/img/Igo_logoavec.png'};\n    });\n    this.store.load(entities);\n  }\n\n  entitySortChange() {\n    this.entitySortChange$.next(true);\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.paginator = event;\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Entity Table</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/entity-table\">code of this example</a>\n  </mat-card-content>\n  <igo-entity-table\n    [store]=\"store\"\n    [withPaginator]=\"true\"\n    [paginatorOptions]=\"paginatorOptions\"\n    [template]=\"template\"\n    (entitySortChange)=\"entitySortChange()\">\n  </igo-entity-table>\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoEntityTableModule, IgoEntityTablePaginatorModule } from '@igo2/common';\n\nimport { AppEntityTableComponent } from './entity-table.component';\nimport { AppEntityTableRoutingModule } from './entity-table-routing.module';\n\n@NgModule({\n  declarations: [AppEntityTableComponent],\n  imports: [\n    AppEntityTableRoutingModule,\n    MatCardModule,\n    IgoEntityTableModule,\n    IgoEntityTablePaginatorModule\n  ],\n  exports: [AppEntityTableComponent]\n})\nexport class AppEntityTableModule {}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Entity Selector</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/entity-selector\">code of this example</a>\n  </mat-card-content>\n\n  <igo-entity-selector\n    [store]=\"store\"\n    [titleAccessor]=\"getTitle\"\n    [emptyText]=\"''\"\n    [placeholder]=\"'Select an entity'\"\n    (selectedChange)=\"onSelectedChange($event)\">\n  </igo-entity-selector>\n\n  <div *ngIf=\"selected$ | async as selected\">\n    <p>ID: {{selected.id}}</p>\n    <p>Name: {{selected.name}}</p>\n    <p>Description: <span [innerHtml]=\"selected.description\"></span></p>\n  </div>\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppEntitySelectorComponent } from './entity-selector.component';\n\nconst routes: Routes = [\n  {\n    path: 'entity-selector',\n    component: AppEntitySelectorComponent\n  }\n];\n\nexport const AppEntitySelectorRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport { EntityStore } from '@igo2/common';\n\ninterface DemoEntity {\n  id: string;\n  name: string;\n  description: string;\n}\n\n@Component({\n  selector: 'app-entity-selector',\n  templateUrl: './entity-selector.component.html',\n  styleUrls: ['./entity-selector.component.scss']\n})\nexport class AppEntitySelectorComponent implements OnInit, OnDestroy {\n\n  public store = new EntityStore([]);\n\n  public selected$ = new BehaviorSubject<DemoEntity>(undefined);\n\n  constructor(private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.store.load([\n      {id: '2', name: 'Name 2', description: '<b>Description 2</b>'},\n      {id: '1', name: 'Name 1', description: '<b>Description 1</b>'},\n      {id: '3', name: 'Name 3', description: '<b>Description 3</b>'}\n    ]);\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  getTitle(entity: DemoEntity): string {\n    return entity.name;\n  }\n\n  onSelectedChange(event: {selected: boolean; entity: DemoEntity}) {\n    this.selected$.next(event.entity);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoEntitySelectorModule } from '@igo2/common';\n\nimport { AppEntitySelectorComponent } from './entity-selector.component';\nimport { AppEntitySelectorRoutingModule } from './entity-selector-routing.module';\n\n@NgModule({\n  declarations: [AppEntitySelectorComponent],\n  imports: [\n    CommonModule,\n    AppEntitySelectorRoutingModule,\n    MatCardModule,\n    IgoEntitySelectorModule\n  ],\n  exports: [AppEntitySelectorComponent]\n})\nexport class AppEntitySelectorModule {}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Form</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/form\">code of this example</a>\n  </mat-card-content>\n\n  <igo-form\n    *ngIf=\"form$ | async as form\"\n    [form]=\"form\"\n    [formData]=\"data$ | async\"\n    (submitForm)=\"onSubmit($event)\">\n\n    <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n    <div formButtons>\n      <button\n        mat-stroked-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"fillForm()\">\n        Fill Form\n      </button>\n      <button\n        mat-stroked-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"clearForm()\">\n        Clear Form\n      </button>\n      <button\n        mat-flat-button\n        type=\"submit\"\n        color=\"primary\"\n        [disabled]=\"submitDisabled\">\n        Submit\n      </button>\n    </div>\n  </igo-form>\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppFormComponent } from './form.component';\n\nconst routes: Routes = [\n  {\n    path: 'form',\n    component: AppFormComponent\n  }\n];\n\nexport const AppFormRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport { Form, FormService } from '@igo2/common';\n\n@Component({\n  selector: 'app-form',\n  templateUrl: './form.component.html',\n  styleUrls: ['./form.component.scss']\n})\nexport class AppFormComponent implements OnInit, OnDestroy {\n\n  form$ = new BehaviorSubject<Form>(undefined);\n\n  data$ = new BehaviorSubject<{[key: string]: any}>(undefined);\n\n  submitDisabled = true;\n\n  private valueChanges$$: Subscription;\n\n  constructor(\n    private formService: FormService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    const fieldConfigs = [\n      {\n        name: 'id',\n        title: 'ID',\n        options:  {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        options:  {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'status',\n        title: 'Status',\n        type: 'select',\n        options:  {\n          cols: 2\n        },\n        inputs: {\n          choices: [\n            {value: 1, title: 'Single'},\n            {value: 2, title: 'Married'}\n          ]\n        }\n      }\n    ];\n\n    const fields = fieldConfigs.map((config) => this.formService.field(config));\n    const form = this.formService.form([], [this.formService.group({name: 'info'}, fields)]);\n\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\n      this.submitDisabled = !form.control.valid;\n    });\n\n    this.form$.next(form);\n  }\n\n  ngOnDestroy() {\n    this.valueChanges$$.unsubscribe();\n  }\n\n  fillForm() {\n    this.data$.next({\n      id: 1,\n      name: 'Bob',\n      status: 2\n    });\n  }\n\n  clearForm() {\n    this.form$.value.control.reset();\n  }\n\n  onSubmit(data: {[key: string]: any}) {\n    alert(JSON.stringify(data));\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoFormModule } from '@igo2/common';\n\nimport { AppFormComponent } from './form.component';\nimport { AppFormRoutingModule } from './form-routing.module';\n\n@NgModule({\n  declarations: [AppFormComponent],\n  imports: [\n    CommonModule,\n    AppFormRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoFormModule\n  ],\n  exports: [AppFormComponent]\n})\nexport class AppFormModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppTableComponent } from './table.component';\n\nconst routes: Routes = [\n  {\n    path: 'table',\n    component: AppTableComponent\n  }\n];\n\nexport const AppTableRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { TableDatabase, TableActionColor } from '@igo2/common';\n\n@Component({\n  selector: 'app-table',\n  templateUrl: './table.component.html',\n  styleUrls: ['./table.component.scss']\n})\nexport class AppTableComponent implements OnInit {\n  public database: TableDatabase;\n\n  public model = {\n    columns: [\n      {\n        name: 'id',\n        title: 'ID',\n        sortable: false,\n        filterable: true\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        sortable: true,\n        filterable: true\n      },\n      {\n        name: 'description',\n        title: 'Description',\n        sortable: true,\n        filterable: true\n      }\n    ],\n    actions: [\n      {\n        icon: 'file-document',\n        color: TableActionColor.primary,\n        click: row => this.showName(row.name)\n      }\n    ],\n    selectionCheckbox: true\n  };\n\n  constructor(private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.database = new TableDatabase([\n      { id: '2', name: 'Name 2', description: 'Hello 2' },\n      { id: '1', name: 'Name 1', description: 'Bonjour 1' },\n      { id: '3', name: 'Name 3', description: 'Hola 3' }\n    ]);\n  }\n\n  showName(name) {\n    alert(name);\n  }\n\n  handleSelect(rows) {\n    console.log(rows);\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Table</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/table\">code of this example</a>\n  </mat-card-content>\n\n  <igo-table\n    [database]=\"database\"\n    [model]=\"model\"\n    [hasFilterInput]=\"true\"\n    (select)=\"handleSelect($event)\">\n  </igo-table>\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoTableModule } from '@igo2/common';\n\nimport { AppTableComponent } from './table.component';\nimport { AppTableRoutingModule } from './table-routing.module';\n\n@NgModule({\n  declarations: [AppTableComponent],\n  imports: [\n    AppTableRoutingModule,\n    MatCardModule,\n    IgoTableModule\n  ],\n  exports: [AppTableComponent]\n})\nexport class AppTableModule {}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Tool</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/tool\">code of this example</a>\n  </mat-card-content>\n\n  <igo-panel [title]=\"panelTitle\">\n    <button\n      mat-icon-button\n      panelLeftButton\n      (click)=\"toolbox.activatePreviousTool()\"\n      *ngIf=\"activeTool$ | async\">\n      <mat-icon svgIcon=\"arrow-back\"></mat-icon>\n    </button>\n\n    <button\n      mat-icon-button\n      panelRightButton\n      (click)=\"toolbox.deactivateTool()\"\n      *ngIf=\"activeTool$ | async\">\n      <mat-icon svgIcon=\"menu\"></mat-icon>\n    </button>\n\n    <igo-toolbox [toolbox]=\"toolbox\" [animate]=\"true\"></igo-toolbox>\n  </igo-panel>\n\n  <button\n    mat-flat-button\n    type=\"button\"\n    color=\"primary\"\n    (click)=\"activateSalutationTool()\">\n    Activate Salutation Tool\n  </button>\n\n</mat-card>\n","import {\n  Component,\n  OnInit,\n  OnDestroy,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  OnUpdateInputs,\n  Tool,\n  Toolbox,\n  ToolComponent,\n  ToolService\n} from '@igo2/common';\n\n@ToolComponent({\n  name: 'demo-salutation',\n  title: 'Salutation',\n  icon: 'account',\n  options: {name: 'Jack'}\n})\n@Component({\n  selector: 'app-salutation-tool',\n  template: `\n    <p>Hello, my name is {{name}}.</p>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSalutationToolComponent implements OnUpdateInputs {\n\n  @Input() name: string;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n}\n\n@ToolComponent({\n  name: 'demo-about',\n  title: 'About',\n  icon: 'information'\n})\n@Component({\n  selector: 'app-about-tool',\n  template: `\n    <p>I'm a tool inside a toolbox.</p>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppAboutToolComponent {}\n\n@Component({\n  selector: 'app-tool',\n  templateUrl: './tool.component.html',\n  styleUrls: ['./tool.component.scss']\n})\nexport class AppToolComponent implements OnInit, OnDestroy {\n\n  toolbox = new Toolbox();\n\n  get activeTool$(): BehaviorSubject<Tool> {\n    return this.toolbox.activeTool$;\n  }\n\n  get panelTitle(): string {\n    return this.activeTool$.value ? this.activeTool$.value.title : 'Toolbox';\n  }\n\n  constructor(\n    private toolService: ToolService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    this.toolbox.setToolbar(['demo-salutation', 'demo-about']);\n    this.toolbox.setTools(this.toolService.getTools());\n  }\n\n  ngOnDestroy() {\n    this.toolbox.destroy();\n  }\n\n  activateSalutationTool() {\n    this.toolbox.activateTool('demo-salutation', {name: 'Bob'});\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppToolComponent } from './tool.component';\n\nconst routes: Routes = [\n  {\n    path: 'tool',\n    component: AppToolComponent\n  }\n];\n\nexport const AppToolRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoPanelModule, IgoToolModule } from '@igo2/common';\n\nimport {\n  AppToolComponent,\n  AppSalutationToolComponent,\n  AppAboutToolComponent\n} from './tool.component';\nimport { AppToolRoutingModule } from './tool-routing.module';\n\n@NgModule({\n  declarations: [\n    AppToolComponent,\n    AppSalutationToolComponent,\n    AppAboutToolComponent\n  ],\n  imports: [\n    CommonModule,\n    AppToolRoutingModule,\n    MatButtonModule,\n    MatIconModule,\n    MatCardModule,\n    IgoLanguageModule,\n    IgoPanelModule,\n    IgoToolModule.forRoot()\n  ],\n  exports: [AppToolComponent],\n  entryComponents: [\n    AppSalutationToolComponent,\n    AppAboutToolComponent\n  ]\n})\nexport class AppToolModule {}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { DynamicComponent, OnUpdateInputs, WidgetComponent, WidgetService } from '@igo2/common';\n\n@Component({\n  selector: 'app-salutation-widget',\n  template: `\n    <p>Hello, my name is {{name}}.</p>\n    <button mat-flat-button (click)=\"complete.emit(name)\">Nice to meet you</button>\n    <button mat-flat-button (click)=\"cancel.emit(name)\">Dismiss</button>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSalutationWidgetComponent implements OnUpdateInputs, WidgetComponent {\n\n  @Input() name: string;\n\n  @Output() complete = new EventEmitter<string>();\n\n  @Output() cancel = new EventEmitter<string>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n}\n\n@Component({\n  selector: 'app-widget',\n  templateUrl: './widget.component.html',\n  styleUrls: ['./widget.component.scss']\n})\nexport class AppWidgetComponent {\n\n  widget: DynamicComponent<WidgetComponent> = this.widgetService.create(AppSalutationWidgetComponent);\n\n  inputs = {name: 'Bob'};\n\n  constructor(private widgetService: WidgetService) {}\n\n  onWidgetComplete(name: string) {\n    alert(`${name} emitted event 'complete' then got automatically destroyed.`);\n  }\n\n  onWidgetCancel() {\n    alert(`Widget emitted event 'cancel' then got automatically destroyed.`);\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppWidgetComponent } from './widget.component';\n\nconst routes: Routes = [\n  {\n    path: 'widget',\n    component: AppWidgetComponent\n  }\n];\n\nexport const AppWidgetRoutingModule = RouterModule.forChild(\n  routes\n);\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Widget</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/widget\">code of this example</a>\n  </mat-card-content>\n\n  <igo-widget-outlet\n    [widget]=\"widget\"\n    [inputs]=\"inputs\"\n    (complete)=\"onWidgetComplete($event)\"\n    (cancel)=\"onWidgetCancel()\">\n  </igo-widget-outlet>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoWidgetModule } from '@igo2/common';\n\nimport {\n  AppSalutationWidgetComponent,\n  AppWidgetComponent\n} from './widget.component';\nimport { AppWidgetRoutingModule } from './widget-routing.module';\n\n@NgModule({\n  declarations: [\n    AppSalutationWidgetComponent,\n    AppWidgetComponent\n  ],\n  imports: [\n    AppWidgetRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoWidgetModule\n  ],\n  exports: [AppWidgetComponent],\n  entryComponents: [\n    AppSalutationWidgetComponent\n  ]\n})\nexport class AppWidgetModule {}\n","import { Injectable, Injector } from '@angular/core';\nimport jwtDecode from 'jwt-decode';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthOptions } from './auth.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TokenService {\n  private options: AuthOptions;\n\n  constructor(private injector: Injector) {}\n\n  set(token: string) {\n    localStorage.setItem(this.tokenKey, token);\n  }\n\n  remove() {\n    localStorage.removeItem(this.tokenKey);\n  }\n\n  get(): string {\n    return localStorage.getItem(this.tokenKey);\n  }\n\n  decode() {\n    const token = this.get();\n    if (!token) {\n      return;\n    }\n    return jwtDecode(token);\n  }\n\n  isExpired() {\n    const jwt = this.decode();\n    const currentTime = new Date().getTime() / 1000;\n    if (jwt && currentTime < jwt.exp) {\n      return false;\n    }\n    return true;\n  }\n\n  private get tokenKey() {\n    const config = this.injector.get<ConfigService>(ConfigService);\n    this.options = config.getConfig('auth') || {};\n    return this.options.tokenKey;\n  }\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Router } from '@angular/router';\n\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport { tap, catchError } from 'rxjs/operators';\nimport { globalCacheBusterNotifier } from 'ts-cacheable';\n\nimport { ConfigService, LanguageService, MessageService } from '@igo2/core';\nimport { Base64 } from '@igo2/utils';\n\nimport { User, IInfosUser } from './auth.interface';\nimport { TokenService } from './token.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  public authenticate$ = new BehaviorSubject<boolean>(undefined);\n  public logged$ = new BehaviorSubject<boolean>(undefined);\n  public redirectUrl: string;\n  private anonymous = false;\n\n  get hasAuthService() {\n    return this.config.getConfig('auth.url') !== undefined;\n  }\n\n  constructor(\n    private http: HttpClient,\n    private tokenService: TokenService,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    @Optional() private router: Router\n  ) {\n    this.authenticate$.next(this.authenticated);\n    this.authenticate$.subscribe((authenticated) => {\n      this.logged$.next(authenticated);\n      globalCacheBusterNotifier.next();\n    });\n  }\n\n  login(username: string, password: string): Observable<void> {\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\n\n    const body = {\n      username,\n      password: this.encodePassword(password)\n    };\n\n    return this.loginCall(body, myHeader);\n  }\n\n  loginWithToken(token: string, type: string, infosUser?: IInfosUser): Observable<void> {\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\n\n    const body = {\n      token,\n      typeConnection: type,\n      infosUser\n    };\n\n    return this.loginCall(body, myHeader);\n  }\n\n  loginAnonymous(): Observable<boolean> {\n    this.anonymous = true;\n    this.logged$.next(true);\n    return of(true);\n  }\n\n  refresh(): Observable<void> {\n    const url = this.config.getConfig('auth.url');\n    return this.http.post(`${url}/refresh`, {}).pipe(\n      tap((data: any) => {\n        this.tokenService.set(data.token);\n      }),\n      catchError((err) => {\n        err.error.caught = true;\n        throw err;\n      })\n    );\n  }\n\n  logout(): Observable<boolean> {\n    this.anonymous = false;\n    this.tokenService.remove();\n    this.authenticate$.next(false);\n    return of(true);\n  }\n\n  isAuthenticated(): boolean {\n    return !this.tokenService.isExpired();\n  }\n\n  getToken(): string {\n    return this.tokenService.get();\n  }\n\n  decodeToken() {\n    if (this.isAuthenticated()) {\n      return this.tokenService.decode();\n    }\n    return false;\n  }\n\n  goToRedirectUrl() {\n    if (!this.router) {\n      return;\n    }\n    const redirectUrl = this.redirectUrl || this.router.url;\n\n    const options = this.config.getConfig('auth') || {};\n    if (redirectUrl === options.loginRoute) {\n      const homeRoute = options.homeRoute || '/';\n      this.router.navigateByUrl(homeRoute);\n    } else if (redirectUrl) {\n      this.router.navigateByUrl(redirectUrl);\n    }\n  }\n\n  getUserInfo(): Observable<User> {\n    const url = this.config.getConfig('auth.url') + '/info';\n    return this.http.get<User>(url);\n  }\n\n  getProfils(): Observable<{ profils: string[] }> {\n    const url = this.config.getConfig('auth.url');\n    return this.http.get<{ profils: string[] }>(`${url}/profils`);\n  }\n\n  updateUser(user: User): Observable<User> {\n    const url = this.config.getConfig('auth.url');\n    return this.http.patch<User>(url, user);\n  }\n\n  private encodePassword(password: string) {\n    return Base64.encode(password);\n  }\n\n  // authenticated or anonymous\n  get logged(): boolean {\n    return this.authenticated || this.isAnonymous;\n  }\n\n  get isAnonymous(): boolean {\n    return this.anonymous;\n  }\n\n  get authenticated(): boolean {\n    return this.isAuthenticated();\n  }\n\n  get isAdmin(): boolean {\n    const token = this.decodeToken();\n    if (token && token.user && token.user.isAdmin) {\n      return true;\n    }\n    return false;\n  }\n\n  private loginCall(body, headers) {\n    const url = this.config.getConfig('auth.url');\n    return this.http.post(`${url}/login`, body, { headers }).pipe(\n      tap((data: any) => {\n        this.tokenService.set(data.token);\n        const tokenDecoded = this.decodeToken();\n        if (tokenDecoded && tokenDecoded.user) {\n          if (tokenDecoded.user.locale) {\n            this.languageService.setLanguage(tokenDecoded.user.locale);\n          }\n          if (tokenDecoded.user.isExpired) {\n            this.languageService.translate\n              .get('igo.auth.error.Password expired')\n              .subscribe((expiredAlert) =>\n                this.messageService.alert(expiredAlert)\n              );\n          }\n        }\n        this.authenticate$.next(true);\n      }),\n      catchError((err) => {\n        err.error.caught = true;\n        throw err;\n      })\n    );\n  }\n}\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter\n} from '@angular/core';\n\nimport { ConfigService, LanguageService } from '@igo2/core';\nimport { AuthGoogleOptions } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\n\n@Component({\n  selector: 'igo-auth-google',\n  templateUrl: './auth-google.component.html',\n  styleUrls: ['./auth-google.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthGoogleComponent {\n  private options: AuthGoogleOptions;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private appRef: ApplicationRef\n  ) {\n    this.options = this.config.getConfig('auth.google') || {};\n\n    if (this.options.apiKey && this.options.clientId) {\n      this.loadSDKGoogle();\n      this.loadPlatform();\n    } else {\n      console.warn('Google authentification needs \"apiKey\" and \"clientId\" options');\n    }\n  }\n\n  public handleSignInClick() {\n    (window as any).gapi.auth2.getAuthInstance().signIn();\n  }\n\n  public handleSignOutClick() {\n    (window as any).gapi.auth2.getAuthInstance().signOut();\n  }\n\n  private handleClientLoad() {\n    (window as any).gapi.load('client:auth2', () => this.initClient());\n  }\n\n  private initClient() {\n    (window as any).gapi.client\n      .init({\n        apiKey: this.options.apiKey,\n        clientId: this.options.clientId,\n        discoveryDocs: [\n          'https://people.googleapis.com/$discovery/rest?version=v1'\n        ],\n        scope: 'profile'\n      })\n      .then(() => {\n        this.handleSignOutClick();\n        this.updateTextButton();\n        (window as any).gapi.auth2.getAuthInstance().isSignedIn.listen(rep => {\n          this.updateSigninStatus(rep);\n        });\n      });\n  }\n\n  private updateSigninStatus(isSignedIn) {\n    this.updateTextButton();\n    if (isSignedIn) {\n      this.loginGoogle((window as any).gapi.client.getToken().access_token);\n    }\n  }\n\n  private updateTextButton() {\n    const btn = document.querySelector('span[id^=\"not_signed_\"]');\n    if (btn && this.languageService.getLanguage() !== 'en') {\n      if (btn.innerHTML === 'Sign in with Google') {\n        btn.innerHTML = this.languageService.translate.instant('igo.auth.google.login');\n      } else if (btn.innerHTML === 'Signed in with Google') {\n        btn.innerHTML = this.languageService.translate.instant('igo.auth.google.logged');\n      }\n    }\n  }\n\n  private loginGoogle(token) {\n    this.authService.loginWithToken(token, 'google').subscribe(() => {\n      this.appRef.tick();\n      this.login.emit(true);\n    });\n  }\n\n  private loadSDKGoogle() {\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'google-jssdk';\n    js.src = 'https://apis.google.com/js/api.js';\n    js.onload = () => {\n      this.handleClientLoad();\n    };\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n\n  private loadPlatform() {\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'google-platform';\n    js.src = 'https://apis.google.com/js/platform.js';\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n}\n","<div class=\"g-signin2 google-login-button\" data-height=\"40\" data-width=\"265\" data-longtitle=\"true\">\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter,\n  Inject\n} from '@angular/core';\nimport { MsalBroadcastService, MsalService, MSAL_GUARD_CONFIG} from '@azure/msal-angular';\nimport {\n  InteractionStatus,\n  AuthenticationResult,\n  PublicClientApplication,\n  PopupRequest,\n  SilentRequest,\n  InteractionRequiredAuthError\n} from '@azure/msal-browser';\nimport { ConfigService } from '@igo2/core';\nimport { AuthMicrosoftOptions, MSPMsalGuardConfiguration } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\nimport { filter, takeUntil } from 'rxjs/operators';\nimport { Subject } from 'rxjs';\n\n@Component({\n  selector: 'igo-auth-microsoft',\n  templateUrl: './auth-microsoft.component.html',\n  styleUrls: ['./auth-microsoft.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthMicrosoftComponent {\n  private options: AuthMicrosoftOptions;\n  private readonly _destroying$ = new Subject<void>();\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n  private broadcastService: MsalBroadcastService;\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef,\n    private msalService: MsalService,\n    @Inject(MSAL_GUARD_CONFIG) private msalGuardConfig: MSPMsalGuardConfiguration[],\n  ) {\n    this.options = this.config.getConfig('auth.microsoft') || {};\n\n    this.msalService.instance = new PublicClientApplication({\n      auth: this.options,\n      cache: {\n        cacheLocation: 'sessionStorage'\n      }\n    });\n\n    this.broadcastService = new MsalBroadcastService(this.msalService.instance, this.msalService);\n\n    if (this.options.clientId) {\n      this.broadcastService.inProgress$\n      .pipe(\n        filter((status: InteractionStatus) => status === InteractionStatus.None),\n        takeUntil(this._destroying$)\n      )\n      .subscribe(() => {\n        this.checkAccount();\n      });\n\n    } else {\n      console.warn('Microsoft authentification needs \"clientId\" option');\n    }\n  }\n\n  public loginMicrosoft() {\n    this.msalService.loginPopup({...this.getConf().authRequest} as PopupRequest)\n    .subscribe((response: AuthenticationResult) => {\n      this.msalService.instance.setActiveAccount(response.account);\n      this.checkAccount();\n    });\n  }\n\n  private checkAccount() {\n    this.msalService.instance\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\n      .then((response: AuthenticationResult) => {\n        const tokenAccess = response.accessToken;\n        const tokenId = response.idToken;\n        this.authService.loginWithToken(tokenAccess, 'microsoft', { tokenId } ).subscribe(() => {\n          this.appRef.tick();\n          this.login.emit(true);\n        });\n      })\n      .catch(async (error) => {\n        if (error instanceof InteractionRequiredAuthError) {\n          // fallback to interaction when silent call fails\n          return this.msalService.acquireTokenPopup(this.getConf().authRequest as SilentRequest);\n        }\n        console.log(error);\n      }).catch(error => {\n        console.log('Silent token fails');\n      });\n  }\n\n  private getConf(): MSPMsalGuardConfiguration {\n    return this.msalGuardConfig.filter(conf => conf.type === 'add')[0];\n  }\n}\n","<button class=\"microsoft-login-button\" mat-raised-button (click)=\"loginMicrosoft()\">\n  <mat-icon svgIcon=\"microsoft\"></mat-icon>\n  {{'igo.auth.microsoft.login' | translate}}\n</button>\n","/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { Inject, Injectable } from '@angular/core';\nimport { Location } from '@angular/common';\nimport {\n    IPublicClientApplication,\n    EndSessionRequest,\n    EndSessionPopupRequest,\n    AuthenticationResult,\n    RedirectRequest,\n    SilentRequest,\n    PopupRequest,\n    SsoSilentRequest,\n    Logger,\n    WrapperSKU\n} from '@azure/msal-browser';\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\nimport { Observable, from } from 'rxjs';\nimport { IMsalService } from '@azure/msal-angular';\n\n@Injectable()\nexport class MsalServiceb2c implements IMsalService {\n    private redirectHash: string;\n    private logger: Logger;\n    private name = '@azure/msal-angular';\n    private version = '2.0.0-beta.2';\n    constructor(\n        @Inject(MSAL_INSTANCE) public instance: IPublicClientApplication,\n        private location: Location\n    ) {\n        const hash = this.location.path(true).split('#').pop();\n        if (hash) {\n            this.redirectHash = `#${hash}`;\n        }\n        this.instance.initializeWrapperLibrary(WrapperSKU.Angular, this.version);\n    }\n\n    acquireTokenPopup(request: PopupRequest): Observable<AuthenticationResult> {\n        return from(this.instance.acquireTokenPopup(request));\n    }\n    acquireTokenRedirect(request: RedirectRequest): Observable<void> {\n        return from(this.instance.acquireTokenRedirect(request));\n    }\n    acquireTokenSilent(silentRequest: SilentRequest): Observable<AuthenticationResult> {\n        return from(this.instance.acquireTokenSilent(silentRequest));\n    }\n    handleRedirectObservable(hash?: string): Observable<AuthenticationResult> {\n        return from(this.instance.handleRedirectPromise(hash || this.redirectHash));\n    }\n    loginPopup(request?: PopupRequest): Observable<AuthenticationResult> {\n        return from(this.instance.loginPopup(request));\n    }\n    loginRedirect(request?: RedirectRequest): Observable<void> {\n        return from(this.instance.loginRedirect(request));\n    }\n    logout(logoutRequest?: EndSessionRequest): Observable<void> {\n        return from(this.instance.logout(logoutRequest));\n    }\n    logoutRedirect(logoutRequest?: EndSessionRequest): Observable<void> {\n        return from(this.instance.logoutRedirect(logoutRequest));\n    }\n    logoutPopup(logoutRequest?: EndSessionPopupRequest): Observable<void> {\n        return from(this.instance.logoutPopup(logoutRequest));\n    }\n    ssoSilent(request: SsoSilentRequest): Observable<AuthenticationResult> {\n        return from(this.instance.ssoSilent(request));\n    }\n    /**\n     * Gets logger for msal-angular.\n     * If no logger set, returns logger instance created with same options as msal-browser\n     */\n    getLogger(): Logger {\n        if (!this.logger) {\n            this.logger = this.instance.getLogger().clone(this.name, this.version);\n        }\n        return this.logger;\n    }\n    // Create a logger instance for msal-angular with the same options as msal-browser\n    setLogger(logger: Logger): void {\n        this.logger = logger.clone(this.name, this.version);\n        this.instance.setLogger(logger);\n    }\n\n}\n","/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { Inject, Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\nimport { EventMessage, EventMessageUtils, IPublicClientApplication, InteractionStatus } from '@azure/msal-browser';\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service.';\n\n@Injectable()\nexport class MsalBroadcastServiceb2c {\n    private _msalSubject: Subject<EventMessage>;\n    public msalSubject$: Observable<EventMessage>;\n    private _inProgress: BehaviorSubject<InteractionStatus>;\n    public inProgress$: Observable<InteractionStatus>;\n\n    constructor(\n        @Inject(MSAL_INSTANCE) private msalInstance: IPublicClientApplication,\n        private authService: MsalServiceb2c\n    ) {\n        this._msalSubject = new Subject<EventMessage>();\n        this.msalSubject$ = this._msalSubject.asObservable();\n\n        // InProgress as BehaviorSubject so most recent inProgress state will be available upon subscription\n        this._inProgress = new BehaviorSubject<InteractionStatus>(InteractionStatus.Startup);\n        this.inProgress$ = this._inProgress.asObservable();\n\n        this.msalInstance.addEventCallback((message: EventMessage) => {\n            this._msalSubject.next(message);\n            const status = EventMessageUtils.getInteractionStatusFromEvent(message);\n            if (status !== null) {\n                this.authService.getLogger().verbose(`BroadcastService - ${message.eventType} results in setting inProgress to ${status}`);\n                this._inProgress.next(status);\n            }\n        });\n    }\n}\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter,\n  Inject\n} from '@angular/core';\n\nimport { MSAL_GUARD_CONFIG } from '@azure/msal-angular';\nimport {\n  InteractionStatus,\n  AuthenticationResult,\n  PublicClientApplication,\n  PopupRequest,\n  SilentRequest,\n  InteractionRequiredAuthError\n} from '@azure/msal-browser';\nimport { ConfigService } from '@igo2/core';\nimport { AuthMicrosoftb2cOptions, MSPMsalGuardConfiguration } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\nimport { filter, takeUntil } from 'rxjs/operators';\nimport { Subject } from 'rxjs';\nimport { MsalBroadcastServiceb2c } from '../shared/auth-msalBroadcastServiceb2c.service';\nimport { MsalServiceb2c } from '../shared/auth-msalServiceb2c.service.';\n\n@Component({\n  selector: 'igo-auth-microsoftb2c',\n  templateUrl: './auth-microsoftb2c.component.html',\n  styleUrls: ['./auth-microsoftb2c.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthMicrosoftb2cComponent {\n  private options: AuthMicrosoftb2cOptions;\n  private readonly _destroying$ = new Subject<void>();\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n  private broadcastService: MsalBroadcastServiceb2c;\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef,\n    private msalService: MsalServiceb2c,\n    @Inject(MSAL_GUARD_CONFIG) private msalGuardConfig: MSPMsalGuardConfiguration[],\n  ) {\n\n    this.options = this.config.getConfig('auth.microsoftb2c') || {};\n\n    this.msalService.instance = new PublicClientApplication({\n      auth: this.options.browserAuthOptions,\n      cache: {\n        cacheLocation: 'sessionStorage'\n      }\n    });\n\n    this.broadcastService = new MsalBroadcastServiceb2c(this.msalService.instance, this.msalService);\n\n    if (this.options.browserAuthOptions.clientId) {\n      this.broadcastService.inProgress$\n      .pipe(\n        filter((status: InteractionStatus) => status === InteractionStatus.None),\n        takeUntil(this._destroying$)\n      )\n      .subscribe(() => {\n        this.checkAccount();\n      });\n\n    } else {\n      console.warn('Microsoft authentification needs \"clientId\" option');\n    }\n  }\n\n  public loginMicrosoftb2c() {\n    this.msalService.loginPopup({...this.getConf().authRequest} as PopupRequest)\n    .subscribe((response: AuthenticationResult) => {\n      this.msalService.instance.setActiveAccount(response.account);\n      this.checkAccount();\n    });\n  }\n\n  private checkAccount() {\n    this.msalService.instance\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\n      .then((response: AuthenticationResult) => {\n        const token = response.idToken;\n        this.authService.loginWithToken(token, 'microsoftb2c').subscribe(() => {\n          this.appRef.tick();\n          this.login.emit(true);\n        });\n      })\n      .catch(async (error) => {\n        if (error instanceof InteractionRequiredAuthError) {\n          // fallback to interaction when silent call fails\n          return this.msalService.acquireTokenPopup(this.getConf().authRequest as SilentRequest);\n        }\n        }).catch(error => {\n          console.log('Silent token fails');\n        });\n  }\n\n  private getConf(): MSPMsalGuardConfiguration {\n    return this.msalGuardConfig.filter(conf => conf.type === 'b2c')[0];\n  }\n}\n","<button class=\"microsoft-login-button\" mat-raised-button (click)=\"loginMicrosoftb2c()\">\n  <mat-icon svgIcon=\"microsoft\"></mat-icon>\n  {{'igo.auth.microsoftb2c.login' | translate}}\n</button>\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter\n} from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthFacebookOptions } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\n\n@Component({\n  selector: 'igo-auth-facebook',\n  templateUrl: './auth-facebook.component.html',\n  styleUrls: ['./auth-facebook.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthFacebookComponent {\n  private options: AuthFacebookOptions;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef\n  ) {\n    this.options = this.config.getConfig('auth.facebook') || {};\n\n    if (this.options.appId) {\n      this.loadSDKFacebook();\n    } else {\n      console.warn('Facebook authentification needs \"appId\" option');\n    }\n  }\n\n  private subscribeEvents() {\n    (window as any).FB.Event.subscribe('auth.statusChange', rep => {\n      this.statusChangeCallback(rep);\n    });\n  }\n\n  private statusChangeCallback(response) {\n    if (response.status === 'connected') {\n      const accessToken = response.authResponse.accessToken;\n      this.loginFacebook(accessToken);\n    }\n  }\n\n  private loginFacebook(token) {\n    this.authService.loginWithToken(token, 'facebook').subscribe(() => {\n      this.appRef.tick();\n      this.login.emit(true);\n    });\n  }\n\n  private loadSDKFacebook() {\n    if (document.getElementById('facebook-jssdk')) {\n      return;\n    }\n\n    const urlSDK =\n      'https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9';\n\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'facebook-jssdk';\n    js.src = `${urlSDK}&appId=${this.options.appId}`;\n    js.onload = () => {\n      this.subscribeEvents();\n    };\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n}\n","<div scope=\"public_profile,email\"\n     class=\"fb-login-button\" data-max-rows=\"1\" data-size=\"large\"\n     data-button-type=\"login_with\" data-show-faces=\"false\"\n     data-auto-logout-link=\"false\" data-use-continue-as=\"false\">\n</div>\n","<form [formGroup]=\"form\" role=\"form\" (ngSubmit)=\"loginUser(form.value)\">\n  <div>\n    <mat-form-field class=\"full-width\">\n      <input matInput required placeholder=\"{{'igo.auth.user' | translate}}\" formControlName=\"username\">\n    </mat-form-field>\n  </div>\n\n  <div>\n    <mat-form-field class=\"full-width\">\n      <input matInput required type=\"password\" placeholder=\"{{'igo.auth.password' | translate}}\" formControlName=\"password\">\n    </mat-form-field>\n  </div>\n\n  <button mat-raised-button type=\"submit\" [disabled]=\"!form.valid || loading\">{{'igo.auth.login' | translate}}</button>\n  <button *ngIf=\"allowAnonymous\" mat-raised-button class=\"anonymous\" type=\"button\" [disabled]=\"loading\" (click)=\"loginAnonymous()\">\n    {{'igo.auth.accessAnonymous' | translate }}\n  </button>\n  <div *ngIf=\"error\">\n    <br/>\n    <font size=\"3\" color=\"red\">{{error}}</font>\n  </div>\n</form>\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  Input,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Validators, FormGroup, FormBuilder } from '@angular/forms';\n\nimport { AuthService } from '../shared/auth.service';\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'igo-auth-intern',\n  templateUrl: './auth-intern.component.html',\n  styleUrls: ['./auth-intern.component.scss'],\n  changeDetection: ChangeDetectionStrategy.Default\n})\nexport class AuthInternComponent {\n  @Input()\n  get allowAnonymous(): boolean {\n    return this._allowAnonymous;\n  }\n  set allowAnonymous(value: boolean) {\n    this._allowAnonymous = value;\n  }\n  private _allowAnonymous = true;\n\n  public error = '';\n  public form: FormGroup;\n  public loading = false;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    public auth: AuthService,\n    private languageService: LanguageService,\n    fb: FormBuilder\n  ) {\n    this.form = fb.group({\n      username: ['', Validators.required],\n      password: ['', Validators.required]\n    });\n  }\n\n  loginUser(values: any) {\n    this.loading = true;\n    this.auth.login(values.username, values.password).subscribe(\n      () => {\n        this.login.emit(true);\n        this.loading = false;\n      },\n      (error: any) => {\n        try {\n          this.languageService.translate\n            .get('igo.auth.error.' + error.error.message)\n            .subscribe(errorMsg => (this.error = errorMsg));\n        } catch (e) {\n          this.error = error.error.message;\n        }\n        this.loading = false;\n      }\n    );\n    return false;\n  }\n\n  loginAnonymous() {\n    this.auth.loginAnonymous().subscribe(() => {\n      this.login.emit(true);\n    });\n  }\n}\n","<div *ngIf=\"visible\">\n  <div *ngIf=\"!auth.logged && backgroundDisable\" class=\"backgroundDisable\"></div>\n\n  <div *ngIf=\"!auth.logged && showLoginDiv\" class=\"login center-block\">\n    <h1>{{'igo.auth.connection' | translate}}</h1>\n\n    <igo-auth-google\n      *ngIf=\"options.google && options.google.enabled !== false\"\n      (login)=\"onLogin()\">\n    </igo-auth-google>\n    <igo-auth-microsoft\n      *ngIf=\"options.microsoft && options.microsoft.enabled !== false\"\n      (login)=\"onLogin()\">\n    </igo-auth-microsoft>\n    <igo-auth-microsoftb2c\n      *ngIf=\"options.microsoftb2c && options.microsoftb2c.enabled !== false\"\n      (login)=\"onLogin()\">\n    </igo-auth-microsoftb2c>\n    <igo-auth-facebook\n      *ngIf=\"options.facebook && options.facebook.enabled !== false\"\n      (login)=\"onLogin()\">\n    </igo-auth-facebook>\n    <igo-auth-intern\n      *ngIf=\"!options.intern || options.intern.enabled !== false\"\n      [allowAnonymous]=\"options.allowAnonymous\"\n      (login)=\"onLogin()\">\n    </igo-auth-intern>\n  </div>\n\n  <div *ngIf=\"auth.logged && showAlreadyConnectedDiv\" class=\"login center-block\">\n    <p>{{'igo.auth.welcome' | translate: user}}</p>\n    <button mat-raised-button type=\"button\" (click)=\"logout()\">{{'igo.auth.signOut' | translate}}</button>\n  </div>\n\n  <div *ngIf=\"showLogoutDiv\" class=\"login center-block\">\n    <p>{{'igo.auth.deconnection' | translate}}</p>\n    <button *ngIf=\"options.homeRoute\" mat-raised-button type=\"button\" (click)=\"home()\">{{'igo.auth.home' | translate}}</button>\n  </div>\n\n</div>\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  OnInit,\n  Input,\n  Optional,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Router, NavigationStart } from '@angular/router';\nimport { filter } from 'rxjs/operators';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthOptions } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\n\n@Component({\n  selector: 'igo-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.Default\n})\nexport class AuthFormComponent implements OnInit {\n  @Input()\n  get backgroundDisable(): boolean {\n    if (this.isLogoutRoute || this.isLogoutRoute) {\n      return false;\n    }\n    return this._backgroundDisable;\n  }\n  set backgroundDisable(value: boolean) {\n    this._backgroundDisable = value.toString() === 'true';\n  }\n  private _backgroundDisable = true;\n\n  @Input()\n  get hasAlreadyConnectedDiv(): boolean {\n    return this._hasAlreadyConnectedDiv;\n  }\n  set hasAlreadyConnectedDiv(value: boolean) {\n    this._hasAlreadyConnectedDiv = value.toString() === 'true';\n  }\n  private _hasAlreadyConnectedDiv = true;\n\n  @Input()\n  get hasLogoutDiv(): boolean {\n    return this._hasLogoutDiv;\n  }\n  set hasLogoutDiv(value: boolean) {\n    this._hasLogoutDiv = value.toString() === 'true';\n  }\n  private _hasLogoutDiv = true;\n\n  @Input()\n  get showAlreadyConnectedDiv(): boolean {\n    if (this.isLogoutRoute) {\n      return this.hasAlreadyConnectedDiv;\n    }\n    return this._showAlreadyConnectedDiv;\n  }\n  set showAlreadyConnectedDiv(value: boolean) {\n    this._showAlreadyConnectedDiv = value.toString() === 'true';\n  }\n  private _showAlreadyConnectedDiv = false;\n\n  @Input()\n  get showLogoutDiv(): boolean {\n    if (this.isLogoutRoute) {\n      return this.hasLogoutDiv;\n    }\n    return this._showLogoutDiv;\n  }\n  set showLogoutDiv(value: boolean) {\n    this._showLogoutDiv = value.toString() === 'true';\n  }\n  private _showLogoutDiv = false;\n\n  get showLoginDiv(): boolean {\n    if (!this.isLogoutRoute) {\n      return true;\n    }\n  }\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  public options: AuthOptions;\n  public user;\n\n  public visible = true;\n\n  private isLoginRoute: boolean;\n  private isLogoutRoute: boolean;\n\n  constructor(\n    public auth: AuthService,\n    private config: ConfigService,\n    @Optional() private router: Router\n  ) {\n    this.options = this.config.getConfig('auth') || {};\n    this.visible = Object.getOwnPropertyNames(this.options).length !== 0;\n  }\n\n  public ngOnInit() {\n    this.analyzeRoute();\n    this.getName();\n  }\n\n  public onLogin() {\n    this.auth.goToRedirectUrl();\n    this.getName();\n    this.login.emit(true);\n  }\n\n  public logout() {\n    this.auth.logout().subscribe(() => {\n      this.user = undefined;\n      if (this.router) {\n        if (this.options.logoutRoute) {\n          this.router.navigate([this.options.logoutRoute]);\n        } else if (this.options.homeRoute) {\n          this.router.navigate([this.options.homeRoute]);\n        }\n      }\n    });\n  }\n\n  public home() {\n    if (this.router && this.options.homeRoute) {\n      this.router.navigate([this.options.homeRoute]);\n    }\n  }\n\n  private getName() {\n    const tokenDecoded = this.auth.decodeToken();\n    if (tokenDecoded) {\n      this.user = {\n        name: tokenDecoded.user.firstName || tokenDecoded.user.sourceId\n      };\n    }\n  }\n\n  private analyzeRoute() {\n    if (!this.router) {\n      return;\n    }\n\n    this.router.events\n      .pipe(filter((event) => event instanceof NavigationStart))\n      .subscribe((changeEvent: any) => {\n        if (changeEvent.url) {\n          const currentRoute = changeEvent.url;\n          const logoutRoute = this.options.logoutRoute;\n          const loginRoute = this.options.loginRoute;\n\n          this.isLogoutRoute = currentRoute === logoutRoute;\n          this.isLoginRoute = currentRoute === loginRoute;\n\n          if (this.isLogoutRoute) {\n            this.auth.logout();\n          }\n        }\n      });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport {\n  HttpEvent,\n  HttpInterceptor,\n  HttpHandler,\n  HttpRequest\n} from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { Md5 } from 'ts-md5';\n\nimport { ConfigService } from '@igo2/core';\nimport { TokenService } from './token.service';\nimport { AuthByKeyOptions, WithCredentialsOptions } from './auth.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthInterceptor implements HttpInterceptor {\n  private refreshInProgress = false;\n\n  private get trustHosts() {\n    const trustHosts = this.config.getConfig('auth.trustHosts') || [];\n    trustHosts.push(window.location.hostname);\n    return trustHosts;\n  }\n\n  private get hostsWithCredentials(): WithCredentialsOptions[] {\n    return this.config.getConfig('auth.hostsWithCredentials') || [];\n  }\n\n  private get hostsWithAuthByKey(): AuthByKeyOptions[] {\n    return this.config.getConfig('auth.hostsByKey') || [];\n  }\n\n  constructor(\n    private config: ConfigService,\n    private tokenService: TokenService,\n    private http: HttpClient\n  ) {}\n\n  intercept(\n    originalReq: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const withCredentials = this.handleHostsWithCredentials(originalReq.url);\n    let req = originalReq.clone();\n    const hostWithKey = this.handleHostsAuthByKey(originalReq.url);\n    if (hostWithKey) {\n      req = req.clone({\n        params: req.params.set(hostWithKey.key, hostWithKey.value)\n      });\n    }\n    if (withCredentials) {\n      req = originalReq.clone({\n        withCredentials\n      });\n    }\n    this.refreshToken();\n    const token = this.tokenService.get();\n    const element = document.createElement('a');\n    element.href = req.url;\n    if (element.host === '') {\n      element.href = element.href; // FIX IE11, DO NOT REMOVE\n    }\n\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\n      return next.handle(req);\n    }\n\n    const authHeader = `Bearer ${token}`;\n    let authReq = req.clone({\n      headers: req.headers.set('Authorization', authHeader)\n    });\n\n    const tokenDecoded: any = this.tokenService.decode();\n    if (\n      authReq.params.get('_i') === 'true' &&\n      tokenDecoded &&\n      tokenDecoded.user &&\n      tokenDecoded.user.sourceId\n    ) {\n      const hashUser = Md5.hashStr(tokenDecoded.user.sourceId) as string;\n      authReq = authReq.clone({\n        params: authReq.params.set('_i', hashUser)\n      });\n    } else if (authReq.params.get('_i') === 'true') {\n      authReq = authReq.clone({\n        params: authReq.params.delete('_i')\n      });\n    }\n\n    return next.handle(authReq);\n  }\n\n  interceptXhr(xhr, url: string): boolean {\n    const withCredentials = this.handleHostsWithCredentials(url);\n    if (withCredentials) {\n       xhr.withCredentials = withCredentials;\n       return true;\n    }\n\n    this.refreshToken();\n    const element = document.createElement('a');\n    element.href = url;\n\n    const token = this.tokenService.get();\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\n      return false;\n    }\n    xhr.setRequestHeader('Authorization', 'Bearer ' + token);\n    return true;\n  }\n\n  alterUrlWithKeyAuth(url: string): string {\n    const hostWithKey = this.handleHostsAuthByKey(url);\n    let interceptedUrl = url;\n    if (hostWithKey) {\n      const urlDecomposed = interceptedUrl.split(/[?&]/);\n      let urlWithKeyAdded = urlDecomposed.shift();\n      const paramsToKeep = urlDecomposed.filter(p => p.length !== 0);\n      paramsToKeep.push(`${hostWithKey.key}=${hostWithKey.value}`);\n      if (paramsToKeep.length) {\n        urlWithKeyAdded += '?' + paramsToKeep.join('&');\n      }\n      return urlWithKeyAdded;\n    }\n    return;\n  }\n\n  private handleHostsWithCredentials(reqUrl: string) {\n    let withCredentials = false;\n    for (const hostWithCredentials of this.hostsWithCredentials) {\n      const domainRegex = new RegExp(hostWithCredentials.domainRegFilters);\n      if (domainRegex.test(reqUrl)) {\n        withCredentials = hostWithCredentials.withCredentials !== undefined ? hostWithCredentials.withCredentials : undefined;\n        break;\n      }\n    }\n    return withCredentials;\n  }\n\n  private handleHostsAuthByKey(reqUrl: string): {key: string, value: string} {\n    let hostWithKey;\n    for (const hostWithAuthByKey of this.hostsWithAuthByKey) {\n      const domainRegex = new RegExp(hostWithAuthByKey.domainRegFilters);\n      if (domainRegex.test(reqUrl)) {\n        hostWithKey = {key : hostWithAuthByKey.keyProperty, value: hostWithAuthByKey.keyValue};\n        break;\n      }\n    }\n    return hostWithKey;\n  }\n\n  refreshToken() {\n    const jwt = this.tokenService.decode();\n    const currentTime = new Date().getTime() / 1000;\n\n    if (\n      !this.refreshInProgress &&\n      jwt &&\n      currentTime < jwt.exp &&\n      currentTime > jwt.exp - 1800\n    ) {\n      this.refreshInProgress = true;\n\n      const url = this.config.getConfig('auth.url');\n      return this.http.post(`${url}/refresh`, {}).subscribe(\n        (data: any) => {\n          this.tokenService.set(data.token);\n          this.refreshInProgress = false;\n        },\n        err => {\n          err.error.caught = true;\n          return err;\n        }\n      );\n    }\n  }\n}\n","import {\n  MSAL_GUARD_CONFIG,\n  MSAL_INSTANCE,\n  MsalService,\n} from '@azure/msal-angular';\n\nimport {\n  PublicClientApplication,\n  InteractionType\n} from '@azure/msal-browser';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { BrowserAuthOptions } from '@azure/msal-browser';\n\nimport { AuthMicrosoftOptions, MSPMsalGuardConfiguration } from './auth.interface';\n\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service.';\n\nexport function MSALConfigFactory(config: ConfigService): PublicClientApplication {\n\n  const msConf: BrowserAuthOptions = config.getConfig('auth.microsoft') || {};\n\n  msConf.redirectUri = msConf.redirectUri || window.location.href;\n  msConf.authority = msConf.authority || 'https://login.microsoftonline.com/organizations';\n\n  const myMsalObj = new PublicClientApplication({\n    auth: msConf,\n    cache: {\n      cacheLocation: 'sessionStorage'\n    }\n  });\n\n  return myMsalObj;\n}\n\nexport function MSALConfigFactoryb2c(config: ConfigService): PublicClientApplication {\n\n  const msConf: BrowserAuthOptions = config.getConfig('auth.microsoftb2c.browserAuthOptions') || {};\n  msConf.redirectUri = msConf.redirectUri || window.location.href;\n  msConf.authority = msConf.authority || 'https://login.microsoftonline.com/organizations';\n\n  const myMsalObj = new PublicClientApplication({\n    auth: msConf,\n    cache: {\n      cacheLocation: 'sessionStorage'\n    }\n  });\n\n  return myMsalObj;\n}\n\nexport function MSALAngularConfigFactory(config: ConfigService): MSPMsalGuardConfiguration {\n\n  const msConf: AuthMicrosoftOptions = config.getConfig('auth.microsoft') || {};\n\n  return {\n    interactionType: InteractionType.Popup,\n    authRequest: {\n      scopes: ['user.read'],\n      loginHint: 'todo',\n    },\n    type: 'add'\n  };\n}\n\nexport function MSALAngularConfigFactoryb2c(config: ConfigService): MSPMsalGuardConfiguration {\n\n  const msConf: BrowserAuthOptions = config.getConfig('auth.microsoftb2c.browserAuthOptions') || {};\n\n  return {\n    interactionType: InteractionType.Popup,\n    authRequest: {\n      scopes: [msConf.clientId]\n    },\n    type: 'b2c'\n  };\n}\n\nexport function provideAuthMicrosoft(type?: string) {\n  if (type === 'b2c') {\n    return [\n      {\n        provide: MSAL_INSTANCE,\n        useFactory: MSALConfigFactoryb2c,\n        deps: [ConfigService]\n      },\n      {\n        provide: MSAL_GUARD_CONFIG,\n        useFactory: MSALAngularConfigFactoryb2c,\n        deps: [ConfigService],\n        multi: true\n      },\n      MsalServiceb2c\n    ];\n  } else {\n    return [\n      {\n        provide: MSAL_INSTANCE,\n        useFactory: MSALConfigFactory,\n        deps: [ConfigService]\n      },\n      {\n        provide: MSAL_GUARD_CONFIG,\n        useFactory: MSALAngularConfigFactory,\n        deps: [ConfigService],\n        multi: true\n      },\n      MsalService\n    ];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { StorageService, StorageScope, ConfigService } from '@igo2/core';\nimport { AuthService } from './auth.service';\nimport { TokenService } from './token.service';\nimport { AuthStorageOptions } from './storage.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthStorageService extends StorageService {\n  protected options: AuthStorageOptions;\n\n  constructor(\n    config: ConfigService,\n    private http: HttpClient,\n    private authService: AuthService,\n    private tokenService: TokenService\n  ) {\n    super(config);\n\n    this.authService.authenticate$.subscribe(isAuthenticated => {\n      if (isAuthenticated && this.options.url) {\n        this.http\n          .get(this.options.url)\n          .subscribe((userIgo: { preference: object }) => {\n            if (userIgo && userIgo.preference) {\n              for (const key of Object.keys(userIgo.preference)) {\n                const value = userIgo.preference[key];\n                super.set(key, value);\n              }\n            }\n          });\n      }\n    });\n  }\n\n  set(\n    key: string,\n    value: string | object | boolean | number,\n    scope: StorageScope = StorageScope.LOCAL\n  ) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      const preference = {};\n      preference[key] = value;\n      this.http.patch(this.options.url, { preference }).subscribe();\n    }\n    super.set(key, value, scope);\n  }\n\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      const preference = {};\n      preference[key] = undefined;\n      this.http.patch(this.options.url, { preference }).subscribe();\n    }\n    super.remove(key, scope);\n  }\n\n  clear(scope: StorageScope = StorageScope.LOCAL) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      this.http.patch(this.options.url, { preference: {}}, {\n        params: {\n          mergePreference: 'false'\n        }\n      }).subscribe();\n    }\n\n    let token: string;\n    if (scope === StorageScope.LOCAL) {\n      token = this.tokenService.get();\n    }\n\n    super.clear(scope);\n\n    if (token) {\n      this.tokenService.set(token);\n    }\n\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      this.http\n        .get(this.options.url)\n        .subscribe((userIgo: { preference: object }) => {\n          if (userIgo && userIgo.preference) {\n            for (const key of Object.keys(userIgo.preference)) {\n              const value = userIgo.preference[key];\n              super.set(key, value);\n            }\n          }\n        });\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MsalModule } from '@azure/msal-angular';\n\nimport { StorageService, IgoLanguageModule } from '@igo2/core';\n\nimport { AuthStorageService } from './shared/storage.service';\nimport { ProtectedDirective } from './shared/protected.directive';\nimport { AuthInterceptor } from './shared/auth.interceptor';\nimport { provideAuthMicrosoft } from './shared/auth-microsoft.provider';\n\nimport { AuthInternComponent } from './auth-form/auth-intern.component';\nimport { AuthFormComponent } from './auth-form/auth-form.component';\nimport { AuthGoogleComponent } from './auth-form/auth-google.component';\nimport { AuthFacebookComponent } from './auth-form/auth-facebook.component';\nimport { AuthMicrosoftComponent } from './auth-form/auth-microsoft.component';\nimport { AuthMicrosoftb2cComponent } from './auth-form/auth-microsoftb2c.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatIconModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    MsalModule\n  ],\n  declarations: [\n    AuthFormComponent,\n    AuthGoogleComponent,\n    AuthInternComponent,\n    AuthFacebookComponent,\n    AuthMicrosoftComponent,\n    AuthMicrosoftb2cComponent,\n    ProtectedDirective\n  ],\n  exports: [AuthFormComponent, ProtectedDirective]\n})\nexport class IgoAuthModule {\n  static forRoot(): ModuleWithProviders<IgoAuthModule> {\n    return {\n      ngModule: IgoAuthModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: AuthInterceptor,\n          multi: true\n        },\n        {\n          provide: StorageService,\n          useClass: AuthStorageService\n        },\n        ...provideAuthMicrosoft('add'),\n        ...provideAuthMicrosoft('b2c')\n      ]\n    };\n  }\n}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppAuthFormComponent } from './auth-form.component';\n\nconst routes: Routes = [\n  {\n    path: 'auth-form',\n    component: AppAuthFormComponent\n  }\n];\n\nexport const AppAuthFormRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss']\n})\nexport class AppAuthFormComponent {\n  private idsActivity: string[] = [];\n\n  constructor(private languageService: LanguageService) {}\n}\n","<mat-card>\n  <mat-card-subtitle>Auth</mat-card-subtitle>\n  <mat-card-title>Authentification</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: ConfigService, LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/auth/auth-form\">code of this example</a><br>\n    See auth section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\n  </mat-card-content>\n</mat-card>\n\n<igo-auth-form></igo-auth-form>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoAuthModule } from '@igo2/auth';\n\nimport { AppAuthFormComponent } from './auth-form.component';\nimport { AppAuthFormRoutingModule } from './auth-form-routing.module';\n\n@NgModule({\n  declarations: [AppAuthFormComponent],\n  imports: [AppAuthFormRoutingModule, MatCardModule, IgoAuthModule.forRoot()],\n  exports: [AppAuthFormComponent]\n})\nexport class AppAuthFormModule {}\n","import { Injectable } from '@angular/core';\n\nimport { MetadataOptions } from './metadata.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MetadataService {\n  constructor() {}\n\n  open(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      window.open(metadata.url, '_blank');\n    }\n  }\n}\n","<button\n  *ngIf=\"(options && options.metadata && options.metadata.url) || (options && options.metadata && options.metadata.abstract)\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.metadata.show' | translate\"\n  [color]=\"color\"\n  (click)=\"openMetadata(options.metadata)\">\n  <mat-icon svgIcon=\"information-outline\"></mat-icon>\n</button>\n","<h2 mat-dialog-title>{{ data.layerTitle }}</h2>\n<button class=\"close-button\" mat-button mat-dialog-close>X</button>\n<mat-dialog-content *ngIf=\"data.type !== 'arcgisrest'\" class=\"mat-typography\">\n  <h3>{{ data.abstract }}</h3>\n</mat-dialog-content>\n<mat-dialog-content *ngIf=\"data.type === 'arcgisrest'\" class=\"mat-typography\">\n  <h3 [innerHTML]=\"data.abstract\"></h3>\n</mat-dialog-content>\n","import { Component, Input, ChangeDetectionStrategy, Inject, ViewEncapsulation } from '@angular/core';\nimport { MatDialog, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport {\n  MetadataOptions,\n  MetadataLayerOptions\n} from '../shared/metadata.interface';\nimport { MetadataService } from '../shared/metadata.service';\n\n@Component({\n  selector: 'igo-metadata-button',\n  templateUrl: './metadata-button.component.html',\n  styleUrls: ['./metadata-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MetadataButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(\n    private metadataService: MetadataService,\n    private dialog: MatDialog) {}\n\n  openMetadata(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      this.metadataService.open(metadata);\n    } else if (!metadata.extern && metadata.abstract) {\n      this.dialog.open(MetadataAbstractComponent, {\n        data: {\n          layerTitle: this.layer.title,\n          abstract: metadata.abstract,\n          type: metadata.type\n        }\n      });\n    }\n  }\n\n  get options(): MetadataLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n}\n\n@Component({\n  selector: 'igo-metadata-abstract',\n  templateUrl: './metadata-abstract.component.html',\n  styleUrls: ['./metadata-abstract.component.scss'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class MetadataAbstractComponent {\n  constructor(@Inject(MAT_DIALOG_DATA) public data: MetadataOptions) {}\n}\n","import { MatDialogModule } from '@angular/material/dialog';\nimport { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { MetadataButtonComponent, MetadataAbstractComponent } from './metadata-button/metadata-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule,\n    MatDialogModule\n  ],\n  exports: [\n    MetadataButtonComponent,\n    MetadataAbstractComponent],\n  declarations: [\n    MetadataButtonComponent,\n    MetadataAbstractComponent]\n})\nexport class IgoMetadataModule {\n  static forRoot(): ModuleWithProviders<IgoMetadataModule> {\n    return {\n      ngModule: IgoMetadataModule,\n      providers: []\n    };\n  }\n}\n","export const FEATURE = 'Feature';\n\nexport enum FeatureMotion {\n  None,\n  Move,\n  Zoom,\n  Default\n}\n","import olSourceImage from 'ol/source/Image';\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { ImageLayer } from '../shared/layers/image-layer';\n\n\nexport class ImageWatcher extends Watcher {\n  protected id: string;\n  protected loaded = 0;\n  protected loading = 0;\n\n  private source: olSourceImage;\n\n  private messageService: MessageService;\n  private languageService: LanguageService;\n\n  constructor(layer: ImageLayer, messageService: MessageService, languageService: LanguageService) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n    this.messageService = messageService;\n    this.languageService = languageService;\n  }\n\n  protected watch() {\n    this.source.on(`imageloadstart`, e => this.handleLoadStart(e));\n    this.source.on(`imageloadend`, e => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, e => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, e => this.handleLoadError(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`imageloadstart`, e => this.handleLoadStart(e));\n    this.source.un(`imageloadend`, e => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, e => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, e => this.handleLoadError(e));\n  }\n\n  private handleLoadStart(event: any) {\n    if (!event.image.__watchers__) {\n      event.image.__watchers__ = [];\n    }\n    event.image.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.image.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.image.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.image.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n\n  private handleLoadError(event) {\n\n    if (!event.image.__watchers__) {\n      return;\n    }\n    const title = this.languageService.translate.instant(\n      'igo.geo.dataSource.unavailableTitle'\n    );\n    const message = this.languageService.translate.instant(\n      'igo.geo.dataSource.unavailable', {value: event.target.params_.LAYERS}\n    );\n\n    this.messageService.error(message, title);\n    this.loaded = -1;\n    this.loading = 0;\n    this.status = SubjectStatus.Error;\n\n  }\n}\n","import olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\nimport { Message } from '@igo2/core';\n\nimport { DataSource } from '../../../datasource/shared/datasources/datasource';\nimport { AnyDataSourceOptions } from '../../../datasource/shared/datasources/any-datasource.interface';\nimport { MapExtent, MapViewOptions } from '../../../map/shared/map.interface';\n\nexport interface LayerOptions {\n  source?: DataSource;\n  sourceOptions?: AnyDataSourceOptions;\n  title?: string;\n  id?: string;\n  alias?: string;\n  baseLayer?: boolean;\n  opacity?: number;\n  visible?: boolean;\n  extent?: MapExtent;\n  zIndex?: number;\n  messages?: Message[];\n  minResolution?: number;\n  maxResolution?: number;\n  minScaleDenom?: number;\n  maxScaleDenom?: number;\n  showInLayerList?: boolean;\n  removable?: boolean;\n  workspace?: GeoWorkspaceOptions;\n  legendOptions?: LegendOptions;\n  ol?: olLayer<olSource>;\n  tooltip?: TooltipContent;\n  _internal?: { [key: string]: string };\n  active?: boolean;\n  check?: boolean;\n  linkedLayers?: LayersLink;\n}\n\nexport interface GeoWorkspaceOptions {\n  srcId?: string;\n  workspaceId?: string;\n  minResolution?: number;\n  maxResolution?: number;\n  enabled?: boolean;\n}\n\nexport interface LayersLink {\n  linkId: string;\n  links?: LayersLinkProperties[];\n}\nexport interface LayersLinkProperties {\n  bidirectionnal?: boolean;\n  linkedIds: string[];\n  syncedDelete: boolean;\n  properties: LinkedProperties[];\n}\n\nexport enum LinkedProperties {\n  OPACITY = 'opacity',\n  VISIBLE = 'visible',\n  OGCFILTERS = 'ogcFilters',\n  MINRESOLUTION = 'minResolution',\n  MAXRESOLUTION = 'maxResolution',\n  ZINDEX = 'zIndex',\n  TIMEFILTER = 'timeFilter'\n}\n\nexport interface GroupLayers {\n  title: string;\n  layers?: LayerOptions;\n  collapsed?: boolean;\n}\n\nexport interface TooltipContent {\n  type?: TooltipType;\n  text?: string;\n}\nexport enum TooltipType {\n  TITLE = 'title',\n  ABSTRACT = 'abstract',\n  CUSTOM = 'custom'\n}\n\nexport interface LegendOptions {\n  collapsed?: boolean;\n  display?: boolean;\n  url?: string;\n  html?: string;\n  stylesAvailable?: ItemStyleOptions[];\n}\n\nexport interface LegendMapViewOptions extends MapViewOptions{\n  scale?: number;\n  size?: [number, number];\n}\n\nexport interface ItemStyleOptions {\n  name: string;\n  title?: string;\n}\n\nexport interface OutputLayerLegend {\n  title: string;\n  url: string;\n}\n","import { ArcGISRestDataSourceOptions } from './../datasource/shared/datasources/arcgisrest-datasource.interface';\nimport { Md5 } from 'ts-md5';\n\nimport { uuid } from '@igo2/utils';\n\nimport { AnyDataSourceOptions } from '../datasource/shared/datasources/any-datasource.interface';\nimport { DataSourceOptions } from '../datasource/shared/datasources/datasource.interface';\nimport { WMSDataSourceOptions } from '../datasource/shared/datasources/wms-datasource.interface';\nimport { WMTSDataSourceOptions } from '../datasource/shared/datasources/wmts-datasource.interface';\nimport { WFSDataSourceOptions } from '../datasource';\n\n/**\n * Generate a id from it's datasource options.\n * @param options Data source options\n * @returns A id\n */\nexport function generateIdFromSourceOptions(options: DataSourceOptions): string {\n  const generators = {\n    wms: generateWMSIdFromSourceOptions,\n    wmts: generateWMTSIdFromSourceOptions,\n    xyz: generateXYZIdFromSourceOptions,\n    feature: generateFeatureIdFromSourceOptions,\n    wfs: generateWfsIdFromSourceOptions,\n    arcgisrest: generateArcgisRestIdFromSourceOptions,\n    imagearcgisrest: generateArcgisRestIdFromSourceOptions,\n    tilearcgisrest: generateArcgisRestIdFromSourceOptions,\n    osm: (_options: AnyDataSourceOptions) => 'OSM',\n    tiledebug: (_options: AnyDataSourceOptions) => 'tiledebug'\n  };\n  const generator = generators[options.type] || generateId;\n  return generator(options);\n}\n\n/**\n * Generate a id from WMS data source options\n * @param options WMS data source options\n * @returns A md5 hash of the the url and layers\n */\nexport function generateWMSIdFromSourceOptions(options: WMSDataSourceOptions) {\n  const layers = options.params.LAYERS;\n  const url = standardizeUrl(options.url);\n  const chain = 'wms' + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from WMTS data source options\n * @param options WMTS data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWMTSIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  const layer = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = 'wmts' + url + layer;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from XYZ data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateXYZIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  const url = standardizeUrl(options.url);\n  const chain = 'xyz' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateFeatureIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  if (!options.url) { return generateId(options); }\n  const url = standardizeUrl(options.url);\n  const chain = 'feature' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWfsIdFromSourceOptions(options: WFSDataSourceOptions) {\n  if (!options.url || !options.params) { return generateId(options); }\n  const url = standardizeUrl(options.url);\n  const chain = 'wfs' + url + options.params.featureTypes;\n  return Md5.hashStr(chain) as string;\n}\n/**\n * Generate a id from ArcGIS Rest data source options\n * @param options ArcGIS Rest data source options\n * @returns A md5 hash of the url and layers\n */\nexport function generateArcgisRestIdFromSourceOptions(options: ArcGISRestDataSourceOptions) {\n  const layers = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = (options.type || 'arcgis') + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a unique id\n * @returns A uuid\n */\nexport function generateId(_options: AnyDataSourceOptions) {\n  return uuid();\n}\n\nexport function standardizeUrl(url: string): string {\n  const absUrl = url.charAt(0) === '/' ? window.location.origin + url : url;\n  const urlDecomposed = absUrl.split(/[?&]/);\n  let urlStandardized = urlDecomposed.shift();\n  const paramsToKeep = urlDecomposed.filter(p => p.length !== 0 && p.charAt(0) !== '_');\n  if (paramsToKeep.length) {\n    urlStandardized += '?' + paramsToKeep.join('&');\n  }\n  return urlStandardized;\n}\n","import olSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\nimport olClusterSource from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  DataSourceOptions,\n  Legend\n} from './datasource.interface';\n\nimport { DataService } from './data.service';\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\nimport { LegendMapViewOptions, LegendOptions } from '../../../layer/shared/layers/layer.interface';\n\nexport abstract class DataSource {\n\n  public id: string;\n  public ol: olSource | olVectorSource<OlGeometry> | olClusterSource ;\n  private legend: Legend[];\n\n  constructor(\n    public options: DataSourceOptions = {},\n    protected dataService?: DataService\n  ) {\n    this.options = options;\n    this.id = this.options.id || this.generateId();\n    this.ol = this.createOlSource();\n  }\n\n  protected abstract createOlSource(): olSource;\n\n  protected generateId(): string {\n    return generateIdFromSourceOptions(this.options);\n  }\n\n  public getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    return this.legend ? this.legend : [];\n  }\n\n  public setLegend(options: LegendOptions): Legend[] {\n    if (options.url) {\n      this.legend = [{ url: options.url} ];\n    } else if (options.html) {\n      this.legend = [{ html: options.html} ];\n    } else {\n      this.legend = [];\n    }\n\n    return this.legend;\n  }\n\n  protected abstract onUnwatch();\n}\n","export enum OgcFilterOperatorType {\n    BasicNumericOperator = 'basicnumericoperator',\n    Basic = 'basic',\n    BasicAndSpatial = 'basicandspatial',\n    Spatial = 'spatial',\n    All = 'all',\n    Time = 'time'\n}\n\nexport enum OgcFilterOperator {\n    BBOX = 'BBox',\n    PropertyIsBetween = 'PropertyIsBetween',\n    Contains = 'Contains',\n    During = 'During',\n    PropertyIsEqualTo = 'PropertyIsEqualTo',\n    PropertyIsGreaterThan = 'PropertyIsGreaterThan',\n    PropertyIsGreaterThanOrEqualTo = 'PropertyIsGreaterThanOrEqualTo',\n    Intersects = 'Intersects',\n    PropertyIsNull = 'PropertyIsNull',\n    PropertyIsLessThan = 'PropertyIsLessThan',\n    PropertyIsLessThanOrEqualTo = 'PropertyIsLessThanOrEqualTo',\n    PropertyIsLike = 'PropertyIsLike',\n    PropertyIsNotEqualTo = 'PropertyIsNotEqualTo',\n    Within = 'Within',\n    And = 'And',\n    Or = 'Or',\n    Not = 'Not'\n}\n","import * as olfilter from 'ol/format/filter';\nimport olFormatWKT from 'ol/format/WKT';\nimport olFormatWFS, { WriteGetFeatureOptions } from 'ol/format/WFS';\nimport olGeometry from 'ol/geom/Geometry';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { uuid, ObjectUtils } from '@igo2/utils';\n\nimport {\n  OgcFilter,\n  IgoOgcFilterObject,\n  AnyBaseOgcFilterOptions,\n  OgcInterfaceFilterOptions,\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions,\n  IgoOgcSelector,\n  SelectorGroup,\n  OgcSelectorBundle\n} from './ogc-filter.interface';\nimport { OgcFilterOperatorType, OgcFilterOperator } from './ogc-filter.enum';\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport * as moment_ from 'moment';\nconst moment = moment_;\n\nexport class OgcFilterWriter {\n  private filterSequence: OgcInterfaceFilterOptions[] = [];\n  public operators = {\n    [OgcFilterOperator.PropertyIsEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsNotEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsLike as string]: {\n      spatial: false,\n      fieldRestrict: ['string']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsBetween as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.During as string]: { spatial: false, fieldRestrict: [] },\n    [OgcFilterOperator.PropertyIsNull as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Intersects as string]: {\n      spatial: true,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Within as string]: { spatial: true, fieldRestrict: [] },\n    [OgcFilterOperator.Contains as string]: { spatial: true, fieldRestrict: [] }\n  };\n\n  defineOgcFiltersDefaultOptions(\n    ogcFiltersOptions: OgcFiltersOptions,\n    fieldNameGeometry: string,\n    srcType?: string\n  ): OgcFiltersOptions {\n    let ogcFiltersDefaultValue = true; // default values for wfs.\n    if (srcType && srcType === 'wms') {\n      ogcFiltersDefaultValue = false;\n    }\n\n    ogcFiltersOptions = ogcFiltersOptions || {};\n    ogcFiltersOptions.enabled =\n      ogcFiltersOptions.enabled === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.enabled;\n    ogcFiltersOptions.editable =\n      ogcFiltersOptions.editable === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.editable;\n    ogcFiltersOptions.geometryName = fieldNameGeometry;\n\n    ogcFiltersOptions.advancedOgcFilters = true;\n    if (ogcFiltersOptions.enabled && (ogcFiltersOptions.pushButtons || ogcFiltersOptions.checkboxes\n      || ogcFiltersOptions.radioButtons || ogcFiltersOptions.select)) {\n      ogcFiltersOptions.advancedOgcFilters = false;\n    }\n    return ogcFiltersOptions;\n  }\n\n  public buildFilter(\n    filters?: IgoOgcFilterObject,\n    extent?: [number, number, number, number],\n    proj?: olProjection,\n    fieldNameGeometry?: string,\n    options?: OgcFilterableDataSourceOptions\n  ): string {\n    let ourBboxFilter;\n    let enableBbox: boolean;\n    if (/intersects|contains|within/gi.test(JSON.stringify(filters))) {\n      enableBbox = false;\n    } else {\n      enableBbox = true;\n    }\n    if (filters) {\n      fieldNameGeometry =\n        (filters as any).geometryName !== undefined\n          ? (filters as any).geometryName\n          : fieldNameGeometry;\n    }\n    if (extent && filters) {\n      ourBboxFilter = olfilter.bbox(fieldNameGeometry, extent, proj.getCode());\n    }\n    let filterAssembly: OgcFilter;\n    if (filters) {\n      filters = this.checkIgoFiltersProperties(\n        filters,\n        fieldNameGeometry,\n        proj\n      );\n      if (extent && enableBbox) {\n        filterAssembly = olfilter.and(\n          ourBboxFilter,\n          this.bundleFilter(filters, options)\n        );\n      } else {\n        filterAssembly = this.bundleFilter(filters, options);\n      }\n    } else {\n      return 'bbox=' + extent.join(',') + ',' + proj.getCode();\n    }\n\n    const wfsOptions: WriteGetFeatureOptions = {\n      srsName: '',\n      featureNS: '',\n      featurePrefix: '',\n      featureTypes: ['featureTypes'],\n      filter: filterAssembly,\n      outputFormat: '',\n      geometryName: fieldNameGeometry\n    };\n\n    const query = new olFormatWFS().writeGetFeature(wfsOptions);\n    const str = new XMLSerializer().serializeToString(query);\n    const regexp1 = /typenames *=|typename *=\\\"featureTypes\\\" *>/gi;\n    const regexp2 = /<\\/Query><\\/GetFeature>/gi;\n\n    return 'filter=' + str.split(regexp1)[1].split(regexp2)[0];\n  }\n\n  private bundleFilter(\n    filterObject: any,\n    options?: OgcFilterableDataSourceOptions\n  ) {\n    if (filterObject instanceof Array) {\n      const logicalArray = [];\n      filterObject.forEach((element) => {\n        logicalArray.push(this.bundleFilter(element, options));\n      });\n      return logicalArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return this.createFilter(\n          {\n            operator: filterObject.logical,\n            logicalArray: this.bundleFilter(filterObject.filters, options)\n          },\n          options\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.createFilter(\n          filterObject as AnyBaseOgcFilterOptions,\n          options\n        );\n      }\n    }\n  }\n\n  private createFilter(\n    filterOptions,\n    options?: OgcFilterableDataSourceOptions\n  ): OgcFilter {\n    const operator = filterOptions.operator;\n    const logicalArray = filterOptions.logicalArray;\n\n    const wfsPropertyName = filterOptions.propertyName;\n    const wfsPattern = filterOptions.pattern;\n    const wfsMatchCase = filterOptions.matchCase\n      ? filterOptions.matchCase\n      : true;\n    const wfsWildCard = filterOptions.wildCard ? filterOptions.wildCard : '*';\n    const wfsSingleChar = filterOptions.singleChar\n      ? filterOptions.singleChar\n      : '.';\n    const wfsEscapeChar = filterOptions.escapeChar\n      ? filterOptions.escapeChar\n      : '!';\n\n    const wfsLowerBoundary = filterOptions.lowerBoundary;\n    const wfsUpperBoundary = filterOptions.upperBoundary;\n\n    const wfsGeometryName = filterOptions.geometryName;\n    const wfsExtent = filterOptions.extent;\n    const wfsWktGeometry = filterOptions.wkt_geometry;\n    const wfsSrsName = filterOptions.srsName\n      ? filterOptions.srsName\n      : 'EPSG:3857';\n\n    const wfsBegin = this.parseFilterOptionDate(\n      filterOptions.begin,\n      options ? options.minDate : undefined\n    );\n    const wfsEnd = this.parseFilterOptionDate(\n      filterOptions.end,\n      options ? options.maxDate : undefined\n    );\n\n    const wfsExpression = filterOptions.expression;\n\n    let geometry: olGeometry;\n    if (wfsWktGeometry) {\n      const wkt = new olFormatWKT();\n      geometry = wkt.readGeometry(wfsWktGeometry, {\n        dataProjection: wfsSrsName,\n        featureProjection: wfsSrsName || 'EPSG:3857'\n      });\n    }\n\n    switch (operator.toLowerCase()) {\n      case OgcFilterOperator.BBOX.toLowerCase():\n        return olfilter.bbox(wfsGeometryName, wfsExtent, wfsSrsName);\n      case OgcFilterOperator.PropertyIsBetween.toLowerCase():\n        return olfilter.between(\n          wfsPropertyName,\n          wfsLowerBoundary,\n          wfsUpperBoundary\n        );\n      case OgcFilterOperator.Contains.toLowerCase():\n        return olfilter.contains(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.During.toLowerCase():\n        return olfilter.during(wfsPropertyName, wfsBegin, wfsEnd);\n      case OgcFilterOperator.PropertyIsEqualTo.toLowerCase():\n        return olfilter.equalTo(wfsPropertyName, wfsExpression, wfsMatchCase);\n      case OgcFilterOperator.PropertyIsGreaterThan.toLowerCase():\n        return olfilter.greaterThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo.toLowerCase():\n        return olfilter.greaterThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.Intersects.toLowerCase():\n        return olfilter.intersects(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.PropertyIsNull.toLowerCase():\n        return olfilter.isNull(wfsPropertyName);\n      case OgcFilterOperator.PropertyIsLessThan.toLowerCase():\n        return olfilter.lessThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo.toLowerCase():\n        return olfilter.lessThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLike.toLowerCase():\n        return olfilter.like(\n          wfsPropertyName,\n          wfsPattern.replace(/[()_]/gi, wfsSingleChar),\n          wfsWildCard,\n          wfsSingleChar,\n          wfsEscapeChar,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.PropertyIsNotEqualTo.toLowerCase():\n        return olfilter.notEqualTo(\n          wfsPropertyName,\n          wfsExpression,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.Within.toLowerCase():\n        return olfilter.within(wfsGeometryName, geometry, wfsSrsName);\n      // LOGICAL\n      case OgcFilterOperator.And.toLowerCase():\n        return olfilter.and.apply(null, logicalArray);\n      case OgcFilterOperator.Or.toLowerCase():\n        return olfilter.or.apply(null, logicalArray);\n      case OgcFilterOperator.Not.toLowerCase():\n        return olfilter.not.apply(null, logicalArray);\n\n      default:\n        return undefined;\n    }\n  }\n\n  public defineInterfaceFilterSequence(\n    filterObject: any,\n    geometryName,\n    logical = '',\n    level = -1\n  ): OgcInterfaceFilterOptions[] {\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            element,\n            geometryName,\n            logical,\n            level\n          )\n        );\n      });\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        level = level + 1;\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            filterObject.filters,\n            geometryName,\n            filterObject.logical,\n            level\n          )\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        this.filterSequence.push(\n          this.addInterfaceFilter(filterObject, geometryName, level, logical)\n        );\n      }\n    }\n    return this.filterSequence;\n  }\n\n  public computeAllowedOperators(\n    fields?: SourceFieldsOptionsParams[],\n    propertyName?: string,\n    defaultOperatorsType?: OgcFilterOperatorType\n  ) {\n    let effectiveOperators: {} = {};\n    let allowedOperators;\n    let fieldsHasSpatialOperator: boolean;\n    let includeContains: boolean;\n\n    if (fields && propertyName) {\n      const srcField = fields.find((field) => field.name === propertyName);\n      allowedOperators =\n        srcField && srcField.allowedOperatorsType\n          ? srcField.allowedOperatorsType\n          : defaultOperatorsType;\n    }\n\n    if (fields) {\n      fields.map((field) => {\n        if (!field.allowedOperatorsType) {\n          return;\n        }\n        const allowedOperatorsType = field.allowedOperatorsType.toLowerCase();\n        if (\n          allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.Spatial.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.BasicAndSpatial.toLowerCase()\n        ) {\n          fieldsHasSpatialOperator = true;\n          if (\n            allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase()\n          ) {\n            includeContains = true;\n          }\n        }\n      });\n    }\n\n    allowedOperators = allowedOperators\n      ? allowedOperators\n      : OgcFilterOperatorType.BasicAndSpatial;\n\n    switch (allowedOperators.toLowerCase()) {\n      case OgcFilterOperatorType.All:\n        effectiveOperators = this.operators;\n        break;\n      case OgcFilterOperatorType.Spatial:\n        effectiveOperators = {\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicAndSpatial:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.Basic:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          }\n        };\n        break;\n      case OgcFilterOperatorType.Time:\n        effectiveOperators = {\n          [OgcFilterOperator.During]: { spatial: false, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicNumericOperator:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsGreaterThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          }\n        };\n        break;\n      default:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n    }\n\n    if (fieldsHasSpatialOperator) {\n      (effectiveOperators as any).Intersects = {\n        spatial: true,\n        fieldRestrict: []\n      };\n      (effectiveOperators as any).Within = { spatial: true, fieldRestrict: [] };\n      if (includeContains) {\n        (effectiveOperators as any).Contains = {\n          spatial: true,\n          fieldRestrict: []\n        };\n      }\n    }\n\n    return effectiveOperators;\n  }\n\n  public addInterfaceFilter(\n    igoOgcFilterObject?,\n    geometryName?,\n    level = 0,\n    parentLogical = 'Or'\n  ): OgcInterfaceFilterOptions {\n    if (!igoOgcFilterObject) {\n      igoOgcFilterObject = { operator: 'PropertyIsEqualTo' };\n    }\n    const f = {\n      propertyName: '',\n      operator: '',\n      active: '',\n      filterid: uuid(),\n      step: '',\n      begin: '',\n      end: '',\n      sliderOptions: {},\n      lowerBoundary: '',\n      upperBoundary: '',\n      expression: '',\n      pattern: '',\n      wildCard: '*',\n      singleChar: '.',\n      escapeChar: '!',\n      matchCase: true,\n      igoSpatialSelector: '',\n      igoSNRC: '',\n      geometryName: '',\n      geometry: '',\n      wkt_geometry: '',\n      extent: '',\n      srsName: '',\n      parentLogical: '',\n      level: 0\n    };\n\n    return Object.assign(\n      f,\n      {\n        parentLogical,\n        level,\n        geometryName\n      },\n      igoOgcFilterObject\n    );\n  }\n\n  public checkIgoFiltersProperties(\n    filterObject: any,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterArray = [];\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        filterArray.push(\n          this.checkIgoFiltersProperties(\n            element,\n            fieldNameGeometry,\n            proj,\n            active\n          )\n        );\n      });\n      return filterArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return Object.assign(\n          {},\n          {\n            logical: filterObject.logical,\n            filters: this.checkIgoFiltersProperties(\n              filterObject.filters,\n              fieldNameGeometry,\n              proj,\n              active\n            )\n          }\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.addFilterProperties(\n          filterObject as OgcInterfaceFilterOptions,\n          fieldNameGeometry,\n          proj,\n          active\n        );\n      }\n    }\n  }\n\n  private addFilterProperties(\n    igoOgcFilterObject: OgcInterfaceFilterOptions,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterid = igoOgcFilterObject.hasOwnProperty('filterid')\n      ? igoOgcFilterObject.filterid\n      : uuid();\n    const status = igoOgcFilterObject.hasOwnProperty('active')\n      ? igoOgcFilterObject.active\n      : active;\n\n    const srsName = igoOgcFilterObject.hasOwnProperty('srsName')\n      ? igoOgcFilterObject.srsName\n      : proj\n      ? proj.getCode()\n      : 'EPSG:3857';\n\n    return Object.assign(\n      {},\n      {\n        filterid,\n        active: status,\n        igoSpatialSelector: 'fixedExtent',\n        srsName\n      },\n      igoOgcFilterObject,\n      { geometryName: fieldNameGeometry }\n    );\n  }\n\n  public rebuiltIgoOgcFilterObjectFromSequence(\n    sequence: OgcInterfaceFilterOptions[]\n  ): IgoOgcFilterObject {\n    if (sequence instanceof Array) {\n      if (sequence.length >= 1) {\n        let lastParentLogical = sequence[0].parentLogical;\n        let nextElement: any;\n        let logicalArray = [];\n        let lastProcessedFilter;\n        sequence.forEach((uiFilter) => {\n          const element = Object.assign({}, uiFilter);\n          const index = sequence.indexOf(uiFilter);\n          if (index >= 0 && index < sequence.length - 1) {\n            nextElement = sequence[index + 1];\n          } else {\n            nextElement = element;\n          }\n          delete element.active;\n          delete element.filterid;\n          delete element.parentLogical;\n          logicalArray.push(element);\n\n          if (sequence.length === 1) {\n            lastProcessedFilter = element;\n          } else if (lastParentLogical !== nextElement.parentLogical) {\n            if (logicalArray.length === 1) {\n              console.log(\n                'You must set at ' +\n                  'least two operator in a logical (' +\n                  lastParentLogical +\n                  ')'\n              );\n            } else {\n              lastProcessedFilter = Object.assign(\n                {},\n                { logical: lastParentLogical, filters: logicalArray }\n              );\n              logicalArray = [lastProcessedFilter];\n              lastParentLogical = nextElement.parentLogical;\n            }\n          }\n        });\n        return lastProcessedFilter;\n      } else {\n        return undefined;\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  private computeIgoSelector(selectors: IgoOgcSelector): IgoOgcSelector {\n    if (\n      selectors.groups.every((group) => group.computedSelectors !== undefined)\n    ) {\n      return selectors;\n    }\n    let selector: IgoOgcSelector;\n    if (selectors.groups && selectors.bundles) {\n      if (!selectors.bundles.every((bundle) => bundle.id !== undefined)) {\n        throw new Error(\n          'You must set an id for each of your bundles'\n        );\n      }\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups.forEach((group) => {\n        group.title = group.title ? group.title : group.name;\n        group.enabled = group.enabled ? group.enabled : false;\n        group.computedSelectors = ObjectUtils.copyDeep(\n          selector.bundles.filter((b) => group.ids.includes(b.id))\n        );\n      });\n    } else if (!selectors.groups && selectors.bundles) {\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups = [\n        {\n          title: 'group1',\n          name: 'group1',\n          computedSelectors: ObjectUtils.copyDeep(selector.bundles)\n        } as SelectorGroup\n      ];\n    } else {\n      selector = {\n        bundles: selectors as any,\n        groups: [\n          {\n            title: 'group1',\n            name: 'group1',\n            computedSelectors: ObjectUtils.copyDeep(\n              selectors\n            ) as OgcSelectorBundle[]\n          } as SelectorGroup\n        ],\n        selectorType: selector.selectorType\n      };\n    }\n    if (!selector.groups.find((selectorGroup) => selectorGroup.enabled)) {\n      selector.groups[0].enabled = true;\n    }\n    return selector;\n  }\n\n  public handleOgcFiltersAppliedValue(\n    options: OgcFilterableDataSourceOptions,\n    fieldNameGeometry: string,\n    extent?: [number, number, number, number],\n    proj?: olProjection\n  ): string {\n    const ogcFilters = options.ogcFilters;\n    if (!ogcFilters) {\n      return;\n    }\n    const conditions = [];\n    let filterQueryStringSelector = '';\n    let filterQueryStringAdvancedFilters = '';\n    if (ogcFilters.enabled && (ogcFilters.pushButtons || ogcFilters.checkboxes || ogcFilters.radioButtons || ogcFilters.select)) {\n      let selectors;\n      if (ogcFilters.pushButtons) {\n        selectors = ogcFilters.pushButtons;\n        const pushConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of pushConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.checkboxes) {\n        selectors = ogcFilters.checkboxes;\n        const checkboxConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of checkboxConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.radioButtons) {\n        selectors = ogcFilters.radioButtons;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const radioConditions = this.formatGroupAndFilter(ogcFilters, selectorsCorr);\n        for (const condition of radioConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.select) {\n        selectors = ogcFilters.select;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const selectConditions = this.formatGroupAndFilter(ogcFilters, selectorsCorr);\n        for (const condition of selectConditions) {\n          conditions.push(condition);\n        }\n      }\n\n      if (conditions.length >= 1) {\n        filterQueryStringSelector = this.buildFilter(\n          conditions.length === 1\n            ? conditions[0]\n            : { logical: 'And', filters: conditions },\n          extent,\n          proj,\n          ogcFilters.geometryName\n        );\n      }\n    }\n    if (ogcFilters.enabled && ogcFilters.filters) {\n      ogcFilters.geometryName = ogcFilters.geometryName || fieldNameGeometry;\n      const igoFilters = ogcFilters.filters;\n      filterQueryStringAdvancedFilters = this.buildFilter(\n        igoFilters,\n        extent,\n        proj,\n        ogcFilters.geometryName,\n        options\n      );\n    }\n\n    let filterQueryString = ogcFilters.advancedOgcFilters\n      ? filterQueryStringAdvancedFilters\n      : filterQueryStringSelector;\n    if (options.type === 'wms') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.LAYERS\n      );\n    }\n    if (options.type === 'wfs') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.featureTypes\n      );\n    }\n\n    return filterQueryString;\n  }\n\n  public verifyMultipleEnableds(selectors) {\n    selectors.bundles.forEach(bundle => {\n      if (!bundle.multiple) {\n        const enableds = bundle.selectors.reduce((list, filter, index) => (filter.enabled) === true ? list.concat(index) : list, []);\n        if (enableds.length > 1) {\n          enableds.splice(0, 1);\n          enableds.forEach(index => {\n            bundle.selectors[index].enabled = false;\n          });\n        }\n      }\n    });\n    return selectors;\n  }\n\n  public formatGroupAndFilter(ogcFilters: OgcFiltersOptions, selectors) {\n    selectors = this.computeIgoSelector(\n      selectors\n    );\n    const selectorBundle = selectors.groups.find(\n      (g) => g.enabled\n    ).computedSelectors;\n    const conditions = [];\n    selectorBundle.map((bundle) => {\n      const bundleCondition = [];\n      const selectorsType = bundle.selectors as any;\n      if (!selectorsType) {\n        return;\n      }\n      selectorsType\n        .filter((ogcselector) => ogcselector.enabled === true)\n        .forEach((enabledSelector) => bundleCondition.push(enabledSelector.filters));\n      if (bundleCondition.length === 1) {\n        conditions.push(bundleCondition[0]);\n      } else if (bundleCondition.length > 1) {\n        conditions.push({\n          logical: bundle.logical,\n          filters: bundleCondition\n        });\n      }\n    });\n\n    if (selectors.selectorType === 'pushButton') {\n      ogcFilters.pushButtons = selectors;\n    } else if (selectors.selectorType === 'checkbox') {\n      ogcFilters.checkboxes = selectors;\n    } else if (selectors.selectorType === 'radioButton') {\n      ogcFilters.radioButtons = selectors;\n    } else if (selectors.selectorType === 'select') {\n      ogcFilters.select = selectors;\n    }\n    return conditions;\n  }\n\n  public formatProcessedOgcFilter(\n    processedFilter: string,\n    layersOrTypenames: string\n  ): string {\n    let appliedFilter = '';\n    if (processedFilter.length === 0 && layersOrTypenames.indexOf(',') === -1) {\n      appliedFilter = processedFilter;\n    } else {\n      layersOrTypenames.split(',').forEach((layerOrTypenames) => {\n        appliedFilter = `${appliedFilter}(${processedFilter.replace(\n          'filter=',\n          ''\n        )})`;\n      });\n    }\n    appliedFilter = appliedFilter.replace(/\\(\\)/g, '');\n    const filterValue =\n      appliedFilter.length > 0\n        ? appliedFilter.replace('filter=', '')\n        : undefined;\n    return filterValue;\n  }\n\n  public parseFilterOptionDate(value: string, defaultValue?: string): string {\n    if (!value) {\n      return defaultValue;\n    } else if (moment(value).isValid()) {\n      return value;\n    } else {\n      return undefined;\n    }\n  }\n}\n","export enum QueryFormat {\n  GML2 = 'gml2',\n  GML3 = 'gml3',\n  JSON = 'json',\n  GEOJSON = 'geojson',\n  GEOJSON2 = 'geojson2',\n  ESRIJSON = 'esrijson',\n  TEXT = 'text',\n  HTML = 'html',\n  HTMLGML2 = 'htmlgml2'\n}\n\nexport enum QueryFormatMimeType {\n  GML2 = 'application/vnd.ogc.gml',\n  GML3 = 'application/vnd.ogc.gml/3.1.1',\n  JSON = 'application/json',\n  GEOJSON = 'application/geojson',\n  GEOJSON2 = 'geojson',\n  ESRIJSON = 'application/json',\n  TEXT = 'text/plain',\n  HTML = 'text/html',\n  HTMLGML2 = 'text/html'\n}\n\nexport enum QueryHtmlTarget {\n  IFRAME = 'iframe',\n  BLANK = '_blank'\n}\n","import { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\n\nimport * as OlFormat from 'ol/format';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport olFormatGML32 from 'ol/format/GML32';\nimport olFormatOSMXML from 'ol/format/OSMXML';\nimport olProjection from 'ol/proj/Projection';\n\nexport const defaultEpsg = 'EPSG:3857';\nexport const defaultMaxFeatures = 5000;\nexport const defaultWfsVersion = '2.0.0';\nexport const defaultFieldNameGeometry = 'geometry';\nexport const gmlRegex = new RegExp(/(.*)?gml(.*)?/gi);\nexport const jsonRegex = new RegExp(/(.*)?json(.*)?/gi);\n\n\n/**\n * This method build the WFS URL based on the layer property.\n * @param options  WFSDataSourceOptions The common wfs datasource options interface\n * @param extent  An extent like array [number, number, number, number]\n * @param proj  olProjection\n * @param ogcFilters  OgcFiltersOptions\n * @returns A string representing the datasource options, based on filter and views\n */\nexport function buildUrl(options: WFSDataSourceOptions, extent, proj: olProjection, ogcFilters: OgcFiltersOptions): string {\n  const paramsWFS = options.paramsWFS;\n  const queryStringValues = formatWFSQueryString(options, undefined, options.paramsWFS.srsName);\n  let igoFilters;\n  if (ogcFilters && ogcFilters.enabled) {\n    igoFilters = ogcFilters.filters;\n  }\n  const ogcFilterWriter = new OgcFilterWriter();\n  const filterOrBox = ogcFilterWriter.buildFilter(igoFilters, extent, proj, ogcFilters.geometryName, options);\n  let filterOrPush = ogcFilterWriter.handleOgcFiltersAppliedValue(options, ogcFilters.geometryName, extent, proj);\n\n  let prefix = 'filter';\n  if (!filterOrPush) {\n    prefix = 'bbox';\n    filterOrPush = extent.join(',') + ',' + proj.getCode();\n  }\n\n  paramsWFS.xmlFilter = ogcFilters.advancedOgcFilters ? filterOrBox : `${prefix}=${filterOrPush}`;\n  let baseUrl = queryStringValues.find(f => f.name === 'getfeature').value;\n  const patternFilter = /(filter|bbox)=.*/gi;\n  baseUrl = patternFilter.test(paramsWFS.xmlFilter) ? `${baseUrl}&${paramsWFS.xmlFilter}` : baseUrl;\n  options.download = Object.assign({}, options.download, { dynamicUrl: baseUrl });\n  return baseUrl.replace(/&&/g, '&');\n}\n\n\n/**\n * This method build/standardize WFS call query params based on the layer property.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @param count  Number: Used to control the number of feature. Used to bypass whe wfs datasource options interface (maxFeatures)\n * @param epsg  String: Used to control the EPSG code (es: 'EPSG3857'). Used to bypass whe wfs datasource options interface (srsName)\n * @param properties  String: Used to control the queried fields  (WFS service).\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function formatWFSQueryString(\n  dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n  count?: number,\n  epsg?: string,\n  properties?: string,\n  startIndex: number = 0,\n  forceDefaultOutputFormat: boolean = false\n): { name: string; value: string }[] {\n  const versionWfs200 = '2.0.0'; // not the same usage as defaultWfsVersion.\n  const url = dataSourceOptions.urlWfs;\n  const paramsWFS = dataSourceOptions.paramsWFS;\n  const effectiveCount = count || defaultMaxFeatures;\n  const effectiveStartIndex = paramsWFS.version === versionWfs200 ? `startIndex=${startIndex}` : '';\n  const epsgCode = epsg || defaultEpsg;\n  let outputFormat = paramsWFS.outputFormat\n    ? `outputFormat=${paramsWFS.outputFormat}`\n    : '';\n  let version = paramsWFS.version\n    ? `version=${paramsWFS.version}`\n    : `version=${defaultWfsVersion}`;\n  const paramTypename =\n    paramsWFS.version === versionWfs200 ? 'typenames' : 'typename';\n  const featureTypes = `${paramTypename}=${paramsWFS.featureTypes}`;\n  const paramMaxFeatures =\n    paramsWFS.version === versionWfs200 ? 'count' : 'maxFeatures';\n  let cnt = count\n    ? `${paramMaxFeatures}=${effectiveCount}`\n    : paramsWFS.maxFeatures\n    ? `${paramMaxFeatures}=${paramsWFS.maxFeatures}`\n    : `${paramMaxFeatures}=${effectiveCount}`;\n  if (forceDefaultOutputFormat) {\n      outputFormat = '';\n      version = 'version=1.1.0';\n      cnt = cnt.replace('count', 'maxFeatures');\n    }\n\n  const srs = epsg\n    ? `srsname=${epsgCode}`\n    : paramsWFS.srsName\n    ? 'srsname=' + paramsWFS.srsName\n    : `srsname=${epsgCode}`;\n\n  let propertyName = '';\n  let valueReference = '';\n  if (properties) {\n    propertyName = `propertyName=${properties}`;\n    valueReference = `valueReference=${properties}`;\n  }\n  const sourceFields = dataSourceOptions.sourceFields;\n  if (!propertyName && sourceFields && sourceFields.length > 0) {\n    const fieldsNames = [];\n    dataSourceOptions.sourceFields.forEach(sourcefield => {\n      fieldsNames.push(sourcefield.name);\n    });\n    propertyName = `propertyName=${fieldsNames.join(',')},${\n      paramsWFS.fieldNameGeometry\n    }`;\n  }\n\n  const separator = url.indexOf('?') === -1 ? '?' : '&';\n  const getCapabilities = `${url}${separator}service=WFS&request=GetCapabilities&${version}`;\n  let getFeature = `${url}${separator}service=WFS&request=GetFeature&${version}&${featureTypes}&`;\n  getFeature += `${outputFormat}&${srs}&${cnt}&${propertyName}&${effectiveStartIndex}`;\n\n  let getpropertyvalue = `${url}?service=WFS&request=GetPropertyValue&version=${versionWfs200}&${featureTypes}&`;\n  getpropertyvalue += `&${cnt}&${valueReference}`;\n\n  return [\n    { name: 'outputformat', value: outputFormat },\n    { name: 'version', value: version },\n    { name: 'typename', value: featureTypes },\n    { name: 'count', value: cnt },\n    { name: 'srsname', value: srs },\n    { name: 'propertyname', value: propertyName },\n    { name: 'valuereference', value: valueReference },\n    { name: 'getcapabilities', value: getCapabilities.replace(/&&/g, '&') },\n    { name: 'getfeature', value: getFeature.replace(/&&/g, '&') },\n    { name: 'getpropertyvalue', value: getpropertyvalue.replace(/&&/g, '&') }\n  ];\n}\n\n/**\n * Validate/Modify layer's wfs options based on :\n * 1- an Openlayers's issue with GML provided from WFS. Refer to\n * https://github.com/openlayers/openlayers/pull/6400\n * 2- Set default values for optionals parameters.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function checkWfsParams(wfsDataSourceOptions, srcType?: string) {\n  if (srcType && srcType === 'wfs') {\n    // reassignation of params to paramsWFS and url to urlWFS to have a common interface with wms-wfs datasources\n    wfsDataSourceOptions.paramsWFS = wfsDataSourceOptions.params;\n  }\n\n  const paramsWFS = wfsDataSourceOptions.paramsWFS;\n  wfsDataSourceOptions.urlWfs =\n    wfsDataSourceOptions.urlWfs || wfsDataSourceOptions.url;\n\n  paramsWFS.version = paramsWFS.version || defaultWfsVersion;\n  paramsWFS.fieldNameGeometry =\n    paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n  paramsWFS.maxFeatures = paramsWFS.maxFeatures || defaultMaxFeatures;\n\n  let outputFormat;\n  if (paramsWFS.outputFormat) {\n    outputFormat = paramsWFS.outputFormat;\n  }\n\n  if (gmlRegex.test(outputFormat) || !outputFormat) {\n    paramsWFS.version = '1.1.0';\n  }\n  return Object.assign({}, wfsDataSourceOptions);\n}\n\nexport function getFormatFromOptions(\n  options: WFSDataSourceOptions | WMSDataSourceOptions\n) {\n  const wfsOptions = options as WFSDataSourceOptions;\n\n  let olFormatCls;\n  const outputFormat = wfsOptions.paramsWFS.outputFormat\n    ? wfsOptions.paramsWFS.outputFormat\n    : undefined;\n\n  if (!outputFormat) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  if (OlFormat[outputFormat]) {\n    olFormatCls = OlFormat[outputFormat];\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gml2')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ... { gmlFormat: olFormatGML2 }});\n  } else if (outputFormat.toLowerCase().match('gml32')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ... { gmlFormat: olFormatGML32 }});\n  } else if (outputFormat.toLowerCase().match('gml3')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ... { gmlFormat: olFormatGML3 }});\n  } else if (outputFormat.toLowerCase().match('topojson')) {\n    olFormatCls = OlFormat.TopoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('geojson')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('esrijson')) {\n    olFormatCls = OlFormat.EsriJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('json')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gpx')) {\n    olFormatCls = OlFormat.GPX;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('WKT')) {\n    olFormatCls = OlFormat.WKT;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('osmxml')) {\n    olFormatCls = olFormatOSMXML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('kml')) {\n    olFormatCls = OlFormat.KML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  return new olFormatCls();\n}\n","import olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { WFSService } from './wfs.service';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport { OgcFilterableDataSourceOptions, OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nimport {\n  formatWFSQueryString,\n  checkWfsParams,\n  defaultFieldNameGeometry\n} from './wms-wfs.utils';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { LegendMapViewOptions } from '../../../layer/shared/layers/layer.interface';\nimport { BehaviorSubject } from 'rxjs';\nimport { TimeFilterableDataSourceOptions, TimeFilterOptions } from '../../../filter/shared/time-filter.interface';\n\nexport class WMSDataSource extends DataSource {\n  public ol: olSourceImageWMS;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  readonly ogcFilters$: BehaviorSubject<OgcFiltersOptions> = new BehaviorSubject(undefined);\n\n  set timeFilter(value: TimeFilterOptions ) {\n    (this.options as TimeFilterableDataSourceOptions).timeFilter = value;\n  }\n  get timeFilter(): TimeFilterOptions {\n    return (this.options as TimeFilterableDataSourceOptions).timeFilter;\n  }\n  readonly timeFilter$: BehaviorSubject<TimeFilterOptions> = new BehaviorSubject(undefined);\n\n  constructor(\n    public options: WMSDataSourceOptions,\n    protected wfsService: WFSService\n  ) {\n    super(options);\n    const sourceParams: any = options.params;\n\n    const dpi = sourceParams.DPI || 96;\n    sourceParams.DPI = dpi;\n    sourceParams.MAP_RESOLUTION = dpi;\n    sourceParams.FORMAT_OPTIONS = 'dpi:' + dpi;\n\n    if (options.refreshIntervalSec && options.refreshIntervalSec > 0) {\n      setInterval(() => {\n        this.refresh();\n      }, options.refreshIntervalSec * 1000); // Convert seconds to MS\n    }\n\n    let fieldNameGeometry = defaultFieldNameGeometry;\n\n    // ####   START if paramsWFS\n    if (options.paramsWFS) {\n      const wfsCheckup = checkWfsParams(options, 'wms');\n      ObjectUtils.mergeDeep(options.paramsWFS, wfsCheckup.paramsWFS);\n\n      fieldNameGeometry =\n        options.paramsWFS.fieldNameGeometry || fieldNameGeometry;\n\n      options.download = Object.assign({}, options.download, {\n        dynamicUrl: this.buildDynamicDownloadUrlFromParamsWFS(options)\n      });\n    } //  ####   END  if paramsWFS\n\n    if (!options.sourceFields || options.sourceFields.length === 0) {\n      options.sourceFields = [];\n    } else {\n      options.sourceFields.forEach(sourceField => {\n        sourceField.alias = sourceField.alias\n          ? sourceField.alias\n          : sourceField.name;\n        // to allow only a list of sourcefield with names\n      });\n    }\n    const initOgcFilters = (options as OgcFilterableDataSourceOptions)\n      .ogcFilters;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (!initOgcFilters) {\n      (options as OgcFilterableDataSourceOptions).ogcFilters = ogcFilterWriter.defineOgcFiltersDefaultOptions(\n        initOgcFilters,\n        fieldNameGeometry,\n        'wms'\n      );\n    } else {\n      initOgcFilters.advancedOgcFilters = (initOgcFilters.pushButtons || initOgcFilters.checkboxes\n        || initOgcFilters.radioButtons || initOgcFilters.select)\n        ? false\n        : true;\n      if (initOgcFilters.pushButtons){\n        initOgcFilters.pushButtons.selectorType = 'pushButton';\n      }\n      if (initOgcFilters.checkboxes){\n        initOgcFilters.checkboxes.selectorType = 'checkbox';\n      }\n      if (initOgcFilters.radioButtons){\n        initOgcFilters.radioButtons.selectorType = 'radioButton';\n      }\n      if (initOgcFilters.select){\n        initOgcFilters.select.selectorType = 'select';\n      }\n    }\n\n    if (\n      sourceParams.LAYERS.split(',').length > 1 &&\n      initOgcFilters &&\n      initOgcFilters.enabled\n    ) {\n      console.log('*******************************');\n      console.log(\n        'BE CAREFULL, YOUR WMS LAYERS (' +\n          sourceParams.LAYERS +\n          ') MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! '\n      );\n      console.log('*******************************');\n    }\n\n    if (\n      options.paramsWFS &&\n      initOgcFilters &&\n      initOgcFilters.enabled &&\n      initOgcFilters.editable &&\n      (options.sourceFields || []).filter(sf => !sf.values).length > 0) {\n      this.wfsService.getSourceFieldsFromWFS(options);\n    }\n\n    const filterQueryString = ogcFilterWriter.handleOgcFiltersAppliedValue(\n      options,\n      fieldNameGeometry\n    );\n    sourceParams.FILTER = filterQueryString;\n    this.setOgcFilters(initOgcFilters, true);\n\n    const timeFilterableDataSourceOptions = (options as TimeFilterableDataSourceOptions);\n    if (\n      timeFilterableDataSourceOptions?.timeFilterable &&\n      timeFilterableDataSourceOptions?.timeFilter) {\n      this.setTimeFilter(timeFilterableDataSourceOptions.timeFilter, true);\n    }\n  }\n\n  refresh() {\n    this.ol.updateParams({ igoRefresh: Math.random() });\n  }\n\n  private buildDynamicDownloadUrlFromParamsWFS(asWFSDataSourceOptions) {\n    const queryStringValues = formatWFSQueryString(asWFSDataSourceOptions);\n    const downloadUrl = queryStringValues.find(f => f.name === 'getfeature')\n      .value;\n    return downloadUrl;\n  }\n\n  protected createOlSource(): olSourceImageWMS {\n    return new olSourceImageWMS(Object.assign({ratio: 1}, this.options));\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    if (triggerEvent) {\n      this.ogcFilters$.next(this.ogcFilters);\n    }\n  }\n\n  setTimeFilter(timeFilter: TimeFilterOptions, triggerEvent: boolean = false) {\n    this.timeFilter = timeFilter;\n    if (triggerEvent) {\n      this.timeFilter$.next(this.timeFilter);\n    }\n  }\n\n  getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    let legend = super.getLegend();\n    if (legend.length > 0 && (style === undefined && !view?.scale)) {\n      return legend;\n    }\n\n    let contentDependent = false;\n    let projParam;\n\n    if (view?.size && view?.extent && view?.projection && this.options.contentDependentLegend) {\n      projParam = this.params.VERSION === '1.3.0' || this.params.VERSION === undefined ? 'CRS' : 'SRS';\n      contentDependent = true;\n    }\n\n    const sourceParams = this.params;\n\n    let layers = [];\n    if (sourceParams.LAYERS !== undefined) {\n      layers = sourceParams.LAYERS.split(',');\n    }\n\n    const baseUrl = this.options.url.replace(/\\?$/, '');\n    const params = [\n      'REQUEST=GetLegendGraphic',\n      'SERVICE=WMS',\n      'FORMAT=image/png',\n      'SLD_VERSION=1.1.0',\n      `VERSION=${sourceParams.VERSION || '1.3.0'}`\n    ];\n    if (style !== undefined) {\n      params.push(`STYLE=${style}`);\n    }\n    if (view?.scale !== undefined) {\n      params.push(`SCALE=${view.scale}`);\n    }\n    if (contentDependent) {\n      params.push(`WIDTH=${view.size[0]}`);\n      params.push(`HEIGHT=${view.size[1]}`);\n      params.push(`BBOX=${view.extent.join(',')}`);\n      params.push(`${projParam}=${view.projection}`);\n    }\n\n    legend = layers.map((layer: string) => {\n      const separator = baseUrl.match(/\\?/) ? '&' : '?';\n      return {\n        url: `${baseUrl}${separator}${params.join('&')}&LAYER=${layer}`,\n        title: layers.length > 1 ? layer : undefined,\n        currentStyle: style === undefined ? undefined : style as string\n      };\n    });\n\n    return legend;\n  }\n\n  public onUnwatch() {}\n}\n","import { Watcher } from '@igo2/utils';\nimport { Layer } from '../shared/layers/layer';\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\nimport { DataSource } from '../../datasource/shared/datasources/datasource';\nimport { IgoMap } from '../../map/shared/map';\nimport { LayersLink, LinkedProperties } from '../shared/layers/layer.interface';\nimport { OgcFilterableDataSource, OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { TimeFilterableDataSource } from '../../filter/shared/time-filter.interface';\nimport { Subscription } from 'rxjs';\nimport { first } from 'rxjs/operators';\n\nexport class LayerSyncWatcher extends Watcher {\n    private ogcFilters$$: Subscription;\n    private timeFilter$$: Subscription;\n\n    private ol: olLayer<olSource>;\n    private layer: Layer;\n    private dataSource: DataSource;\n    private map: IgoMap;\n    private ogcFilterWriter;\n\n    constructor(layer: Layer, map: IgoMap) {\n        super();\n        this.ol = layer.ol;\n        this.layer = layer;\n        this.dataSource = layer.options.source;\n        this.map = map;\n        this.ogcFilterWriter = new OgcFilterWriter();\n    }\n\n    protected watch() {\n\n        this.ol.on('propertychange', evt => this.transferCommonProperties(evt));\n        if ((this.dataSource as OgcFilterableDataSource).ogcFilters$) {\n            this.ogcFilters$$ = (this.dataSource as OgcFilterableDataSource).ogcFilters$\n                .subscribe(ogcFilters => this.transferOgcFiltersProperties(ogcFilters));\n        }\n        if ((this.dataSource as TimeFilterableDataSource).timeFilter$) {\n            this.timeFilter$$ = (this.dataSource as TimeFilterableDataSource).timeFilter$\n                .subscribe(timeFilter => this.transferTimeFilterProperties(timeFilter));\n        }\n        this.syncChildLayers();\n    }\n\n    protected unwatch() {\n        this.ol.un('propertychange', evt => this.transferCommonProperties(evt));\n        if (this.ogcFilters$$) { this.ogcFilters$$.unsubscribe(); }\n        if (this.timeFilter$$) { this.timeFilter$$.unsubscribe(); }\n    }\n\n\n    private syncChildLayers() {\n        // Force the sync the child layers with parent on the first load.\n        if (!this.map) {\n            return;\n        }\n        this.map.status$\n            .pipe(first())\n            .subscribe(() => {\n                this.map.layers\n                    .filter(layer => layer.options.linkedLayers?.links)\n                    .map(layer => {\n                        layer.options.linkedLayers.links.map(link => {\n                            if (link.properties?.indexOf(LinkedProperties.VISIBLE) !== -1) {\n                                layer.ol.set('visible', !(layer.visible), false);\n                                layer.ol.set('visible', !(layer.visible), false);\n                                layer.visible = layer.visible;\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.OPACITY) !== -1) {\n                                const baseOpacity = layer.ol.get('opacity');\n                                layer.ol.set('opacity', 0, false);\n                                layer.ol.set('opacity', baseOpacity, false);\n                                layer.opacity = layer.opacity;\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.MINRESOLUTION) !== -1) {\n                                const baseMinResolution = layer.ol.get('minResolution');\n                                layer.ol.set('minResolution', 0, false);\n                                layer.ol.set('minResolution', baseMinResolution, false);\n                                layer.minResolution = layer.minResolution;\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.MAXRESOLUTION) !== -1) {\n                                const baseMaxResolution = layer.ol.get('maxResolution');\n                                layer.ol.set('maxResolution', 0, false);\n                                layer.ol.set('maxResolution', baseMaxResolution, false);\n                                layer.minResolution = layer.minResolution;\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.OGCFILTERS) !== -1) {\n                                const ogcFilters$ = (layer.dataSource as OgcFilterableDataSource).ogcFilters$;\n                                ogcFilters$.next(ogcFilters$.value);\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.TIMEFILTER) !== -1) {\n                                const timeFilter$ = (layer.dataSource as TimeFilterableDataSource).timeFilter$;\n                                timeFilter$.next(timeFilter$.value);\n                            }\n                        });\n                    });\n            });\n    }\n\n    private transferCommonProperties(layerChange) {\n        const key = layerChange.key;\n        const layerChangeProperties = layerChange.target.getProperties();\n        const newValue = layerChangeProperties[key];\n\n        if (['visible', 'opacity', 'minResolution', 'maxResolution'].indexOf(key) === -1) {\n            return;\n        }\n        const linkedLayers = layerChangeProperties.linkedLayers as LayersLink;\n        if (!linkedLayers) {\n            return;\n        }\n        const currentLinkedId = linkedLayers.linkId;\n        const currentLinks = linkedLayers.links;\n        const isParentLayer = currentLinks ? true : false;\n\n        if (isParentLayer) {\n            // search for child layers\n            const silent = true;\n            currentLinks.map(link => {\n                if (!link.properties || link.properties.indexOf(key) === -1) {\n                    return;\n                }\n                link.linkedIds.map(linkedId => {\n                    const layerToApply = this.map.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\n                    if (layerToApply) {\n                        layerToApply.ol.set(key, newValue, silent);\n                        if (key === 'visible') {\n                            layerToApply.visible$.next(newValue);\n                        }\n                    }\n                });\n            });\n        } else {\n            // search for parent layer\n            const silent = false;\n            this.map.layers.map(layer => {\n                if (layer.options.linkedLayers?.links) {\n                    layer.options.linkedLayers.links.map(l => {\n                        if (l.properties && l.properties.indexOf(key) !== -1 &&\n                            l.bidirectionnal !== false && l.linkedIds.indexOf(currentLinkedId) !== -1) {\n                            layer.ol.set(key, newValue, silent);\n                            if (key === 'visible') {\n                                layer.visible$.next(newValue);\n                            }\n                        }\n                    });\n                }\n            });\n        }\n    }\n\n    private transferOgcFiltersProperties(ogcFilters) {\n        const linkedLayers = this.ol.getProperties().linkedLayers as LayersLink;\n        if (!linkedLayers) {\n            return;\n        }\n        const currentLinkedId = linkedLayers.linkId;\n        const currentLinks = linkedLayers.links;\n        const isParentLayer = currentLinks ? true : false;\n        if (isParentLayer) {\n            // search for child layers\n            currentLinks.map(link => {\n                if (!link.properties || link.properties.indexOf(LinkedProperties.OGCFILTERS) === -1) {\n                    return;\n                }\n                link.linkedIds.map(linkedId => {\n                    const layerToApply = this.map.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\n                    if (layerToApply) {\n                        const layerType = layerToApply.ol.getProperties().sourceOptions.type;\n                        (layerToApply.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, false);\n                        if (layerType === 'wfs') {\n                            layerToApply.ol.getSource().refresh();\n                        }\n                        if (layerType === 'wms') {\n                            let appliedOgcFilter;\n                            if (this.ol.getProperties().sourceOptions.type === 'wfs') {\n                                appliedOgcFilter = this.ogcFilterWriter.handleOgcFiltersAppliedValue(\n                                    this.layer.dataSource.options as OgcFilterableDataSourceOptions,\n                                    (this.dataSource.options as any).fieldNameGeometry,\n                                    undefined,\n                                    this.map.viewController.getOlProjection()\n                                );\n                            } else if (this.ol.getProperties().sourceOptions.type === 'wms') {\n                                appliedOgcFilter = (this.dataSource as WMSDataSource).ol.getParams().FILTER;\n                            }\n                            (layerToApply.dataSource as WMSDataSource).ol.updateParams({ FILTER: appliedOgcFilter });\n                        }\n                    }\n                });\n            });\n        } else {\n            // search for parent layer\n            this.map.layers.map(layer => {\n                if (layer.options.linkedLayers?.links) {\n                    layer.options.linkedLayers.links.map(l => {\n                        if (l.properties && l.properties.indexOf(LinkedProperties.OGCFILTERS) !== -1 &&\n                            l.bidirectionnal !== false && l.linkedIds.indexOf(currentLinkedId) !== -1) {\n                            const layerType = layer.ol.getProperties().sourceOptions.type;\n                            if (layerType === 'wfs') {\n                                (layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\n                                layer.ol.getSource().refresh();\n                            }\n                            if (layerType === 'wms') {\n                                let appliedOgcFilter;\n                                if (this.ol.getProperties().sourceOptions.type === 'wfs') {\n                                    appliedOgcFilter = this.ogcFilterWriter.handleOgcFiltersAppliedValue(\n                                        layer.dataSource.options as OgcFilterableDataSourceOptions,\n                                        (this.dataSource.options as any).fieldNameGeometry,\n                                        undefined,\n                                        this.map.viewController.getOlProjection()\n                                    );\n\n                                } else if (this.ol.getProperties().sourceOptions.type === 'wms') {\n                                    appliedOgcFilter = (this.dataSource as WMSDataSource).ol.getParams().FILTER;\n                                }\n                                (layer.dataSource as WMSDataSource).ol.updateParams({ FILTER: appliedOgcFilter });\n                                (layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\n                            }\n                        }\n                    });\n                }\n            });\n        }\n    }\n\n    private transferTimeFilterProperties(timeFilter) {\n        const linkedLayers = this.ol.getProperties().linkedLayers as LayersLink;\n        if (!linkedLayers) {\n            return;\n        }\n        const currentLinkedId = linkedLayers.linkId;\n        const currentLinks = linkedLayers.links;\n        const isParentLayer = currentLinks ? true : false;\n        if (isParentLayer) {\n            // search for child layers\n            currentLinks.map(link => {\n                if (!link.properties || link.properties.indexOf(LinkedProperties.TIMEFILTER) === -1) {\n                    return;\n                }\n                link.linkedIds.map(linkedId => {\n                    const childLayer = this.map.layers.find(layer =>\n                        layer.dataSource instanceof WMSDataSource &&\n                        layer.options.linkedLayers?.linkId === linkedId);\n                    if (childLayer) {\n                        (childLayer.dataSource as TimeFilterableDataSource).setTimeFilter(timeFilter, false);\n                        const appliedTimeFilter = this.ol.get('values_').source.getParams().TIME;\n                        (childLayer.dataSource as WMSDataSource).ol.updateParams({ TIME: appliedTimeFilter });\n                    }\n                });\n            });\n        } else {\n            // search for parent layer\n            this.map.layers\n                .filter(layer => layer.dataSource instanceof WMSDataSource)\n                .map(parentLayer => {\n                    if (parentLayer.options.linkedLayers?.links) {\n                        parentLayer.options.linkedLayers.links.map(l => {\n                            if (l.properties && l.properties.indexOf(LinkedProperties.TIMEFILTER) !== -1 &&\n                                l.bidirectionnal !== false && l.linkedIds.indexOf(currentLinkedId) !== -1) {\n                                const appliedTimeFilter = this.ol.get('values_').source.getParams().TIME;\n                                (parentLayer.dataSource as WMSDataSource).ol.updateParams({ TIME: appliedTimeFilter });\n                                (parentLayer.dataSource as TimeFilterableDataSource).setTimeFilter(timeFilter, true);\n                            }\n                        });\n                    }\n                });\n        }\n    }\n}\n","import olSourceTile from 'ol/source/Tile';\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\n\nimport { TileLayer } from '../shared/layers/tile-layer';\nimport { VectorTileLayer } from '../shared/layers/vectortile-layer';\n\nexport class TileWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private source: olSourceTile;\n\n  constructor(layer: TileLayer | VectorTileLayer) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    this.source.on(`tileloadstart`, e => this.handleLoadStart(e));\n    this.source.on(`tileloadend`, e => this.handleLoadEnd(e));\n    this.source.on(`tileloaderror`, e => this.handleLoadEnd(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`tileloadstart`, e => this.handleLoadStart(e));\n    this.source.un(`tileloadend`, e => this.handleLoadEnd(e));\n    this.source.un(`tileloaderror`, e => this.handleLoadEnd(e));\n  }\n\n  private handleLoadStart(event: any) {\n    // This is to avoid increasing\n    // the number of loaded tiles if a tile was loading\n    // before subscribing to this watcher\n    if (!event.tile.__watchers__) {\n      event.tile.__watchers__ = [];\n    }\n    event.tile.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.tile.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.tile.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.tile.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import olSourceVector from 'ol/source/Vector';\nimport * as olformat from 'ol/format';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { FeatureDataSourceOptions } from './feature-datasource.interface';\n\nexport class FeatureDataSource extends DataSource {\n  public options: FeatureDataSourceOptions;\n  public ol: olSourceVector<OlGeometry>;\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const sourceOptions = {\n      format: this.getSourceFormatFromOptions(this.options)\n    };\n\n    return new olSourceVector(Object.assign(sourceOptions, this.options));\n  }\n\n  protected getSourceFormatFromOptions(options: FeatureDataSourceOptions) {\n    if (options.format) {\n      return options.format;\n    }\n    let olFormatCls;\n    const formatType = options.formatType;\n    if (!formatType) {\n      olFormatCls = olformat.GeoJSON;\n    } else {\n      olFormatCls = olformat[formatType];\n      if (olFormatCls === undefined) {\n        throw new Error('Invalid vector source format ${formatType}.');\n      }\n    }\n\n    const formatOptions = options.formatOptions;\n    let format;\n    if (formatOptions) {\n      format = new olFormatCls(formatOptions);\n    } else {\n      format = new olFormatCls();\n    }\n\n    return format;\n  }\n\n  public onUnwatch() {}\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n}\n","import olSourceCluster from 'ol/source/Cluster';\n\nimport { uuid } from '@igo2/utils';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { ClusterDataSourceOptions } from './cluster-datasource.interface';\n\nexport class ClusterDataSource extends FeatureDataSource {\n  public options: ClusterDataSourceOptions;\n  public ol: olSourceCluster;\n\n  protected createOlSource(): olSourceCluster {\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    this.options.source = super.createOlSource();\n    return new olSourceCluster(this.options);\n  }\n\n  protected generateId() {\n    return uuid();\n  }\n\n  public onUnwatch() {}\n}\n","import { uuid, Watcher, SubjectStatus } from '@igo2/utils';\n\nimport { VectorLayer } from '../shared/layers/vector-layer';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\n\nexport class VectorWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private layer: VectorLayer;\n\n  constructor(layer: VectorLayer) {\n    super();\n    this.layer = layer;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n     }\n\n    if (olSource.getUrl()) {\n      olSource.on(`featuresloadstart`, e => this.handleLoadStart(e));\n      olSource.on(`featuresloadend`, e => this.handleLoadEnd(e));\n      olSource.on(`featuresloaderror`, e => this.handleLoadEnd(e));\n    }\n\n  }\n\n  protected unwatch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n     }\n    if (olSource.getUrl()) {\n      olSource.un(`featuresloadstart`, e => this.handleLoadStart(e));\n      olSource.un(`featuresloadend`, e => this.handleLoadEnd(e));\n      olSource.un(`featuresloaderror`, e => this.handleLoadEnd(e));\n    }\n  }\n\n  private handleLoadStart(event: any) {\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event: any) {\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import * as olproj from 'ol/proj';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { MAC } from 'ol/has';\n\nimport { NumberUtils } from '@igo2/utils';\n\nimport { MapViewState } from './map.interface';\nimport { Projection } from './projection.interfaces';\n\n/**\n * This method extracts a coordinate tuple from a string.\n * @param str Any string\n * @param mapProjection string Map Projection\n * @param opts.forceNA boolean Force North America Zone\n * @returns object:\n *             lonLat: Coordinate,\n *             message: Message of error,\n *             radius: radius of the confience of coordinate,\n *             conf: confidence of the coordinate}\n */\nexport function stringToLonLat(\n  str: string,\n  mapProjection: string,\n  opts: { forceNA?: boolean } = {}\n): {\n  lonLat: [number, number] | undefined;\n  message: string;\n  radius: number | undefined;\n  conf: number | undefined;\n} {\n  let lonLat: [number, number];\n  let coordStr: string;\n  let negativeLon: string;\n  let degreesLon: string;\n  let minutesLon: string;\n  let secondsLon: string;\n  let directionLon: string;\n  let decimalLon: string;\n  let negativeLat: string;\n  let degreesLat: string;\n  let minutesLat: string;\n  let secondsLat: string;\n  let directionLat: string;\n  let decimalLat: string;\n  let zone: string;\n  let radius: string;\n  let conf: string;\n  let lon: any;\n  let lat: any;\n\n  const projectionPattern = '(\\\\s*;\\\\s*[\\\\d]{4,6})';\n  const toProjection = '4326';\n  let projectionStr: string;\n  const projectionRegex = new RegExp(projectionPattern, 'g');\n\n  const lonlatCoord = '([-+])?([\\\\d]{1,3})([,.](\\\\d+))?';\n  const lonLatPattern = `${lonlatCoord}[\\\\s,]+${lonlatCoord}`;\n  const lonLatRegex = new RegExp(`^${lonLatPattern}$`, 'g');\n\n  const dmsCoord =\n    '([0-9]{1,2})[:|°]?\\\\s*([0-9]{1,2})?[:|\\'|′|’]?\\\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\\\s*[\"|″|”]?\\\\s*';\n  const dmsCoordPattern = `${dmsCoord}([N|S|E|W|O]),?\\\\s*${dmsCoord}([N|S|E|W|O])`;\n  const dmsRegex = new RegExp(`^${dmsCoordPattern}$`, 'gi');\n\n  const patternUtm =\n    '(UTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const utmRegex = new RegExp(`^${patternUtm}`, 'gi');\n\n  const patternMtm =\n    '(MTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const mtmRegex = new RegExp(`^${patternMtm}`, 'gi');\n\n  const ddCoord = '([-+])?(\\\\d{1,3})[,.](\\\\d+)';\n  const patternDd = `${ddCoord}\\\\s*[,]?\\\\s*${ddCoord}`;\n  const ddRegex = new RegExp(`^${patternDd}`, 'g');\n\n  const dmdCoord =\n    '([-+])?(\\\\d{1,3})[\\\\s,.]{1}(\\\\d{1,2})[\\\\s,.]{1}(\\\\d{1,2})[.,]?(\\\\d{1,5})?';\n  const patternDmd = `${dmdCoord}\\\\s*[,.]?\\\\s*${dmdCoord}`;\n  const dmdRegex = new RegExp(`^${patternDmd}`, 'g');\n\n /* eslint-disable max-len */\n  const patternBELL =\n    'LAT\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,2})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*LONG\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,3})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*UNC\\\\s*[\\\\s:]?\\\\s*(\\\\d+)\\\\s*CONF\\\\s*[\\\\s:]?\\\\s*(\\\\d{1,3})';\n  const bellRegex = new RegExp(`^${patternBELL}?`, 'gi');\n\n  const mmCoord = '([-+]?\\\\d+)[,.]?(\\\\d+)?';\n  const mmPattern = `${mmCoord}[\\\\s,]+${mmCoord}`;\n  const mmRegex = new RegExp(`^${mmPattern}$`, 'g');\n\n  let isXYCoords = false;\n\n  str = str.toLocaleUpperCase().trim();\n\n  // Extract projection\n  if (projectionRegex.test(str)) {\n    [coordStr, projectionStr] = str.split(';').map(s => s.trim());\n  } else {\n    coordStr = str;\n  }\n  if (lonLatRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      lon,\n      ,\n      decimalLon,\n      negativeLat,\n      lat,\n      ,\n      decimalLat\n    ] = coordStr.match(lonLatPattern);\n\n    lon = parseFloat((negativeLon ? negativeLon : '') + lon + '.' + decimalLon);\n    lat = parseFloat((negativeLat ? negativeLat : '') + lat + '.' + decimalLat);\n  } else if (dmsRegex.test(coordStr)) {\n    [\n      ,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      directionLon,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      directionLat\n    ] = coordStr.match(dmsCoordPattern);\n\n    if (directionLon === 'S' || directionLon === 'N') {\n      degreesLon = [degreesLat, (degreesLat = degreesLon)][0];\n      minutesLon = [minutesLat, (minutesLat = minutesLon)][0];\n      secondsLon = [secondsLat, (secondsLat = secondsLon)][0];\n      directionLon = [directionLat, (directionLat = directionLon)][0];\n    }\n\n    lon = convertDMSToDD(\n      parseFloat(degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat(degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (utmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternUtm);\n    const epsgUtm = Number(zone) < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgUtm,\n      'EPSG:4326'\n    );\n  } else if (mtmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternMtm);\n    const epsgMtm =\n      Number(zone) < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + Number(zone)}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgMtm,\n      'EPSG:4326'\n    );\n  } else if (dmdRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      decimalLat\n    ] = coordStr.match(patternDmd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (ddRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      decimalLat\n    ] = coordStr.match(patternDd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (bellRegex.test(coordStr)) {\n    [\n      ,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      ,\n      directionLat,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      ,\n      directionLon,\n      radius,\n      conf\n    ] = coordStr.match(patternBELL);\n\n    // Set default value for North America\n    if (!directionLon) {\n      directionLon = 'W';\n    }\n\n    // Check if real minutes or decimals\n    if (minutesLon && minutesLon.length > 2) {\n      lon = parseFloat(\n        (negativeLon ? negativeLon : '') + degreesLon + '.' + minutesLon\n      );\n    } else {\n      lon = convertDMSToDD(\n        parseFloat(degreesLon),\n        parseFloat(minutesLon),\n        parseFloat(secondsLon),\n        directionLon\n      );\n    }\n\n    if (minutesLat && minutesLat.length > 2) {\n      lat = parseFloat(\n        (negativeLat ? negativeLat : '') + degreesLat + '.' + minutesLat\n      );\n    } else {\n      lat = convertDMSToDD(\n        parseFloat(degreesLat),\n        parseFloat(minutesLat),\n        parseFloat(secondsLat),\n        directionLat\n      );\n    }\n  } else if (mmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, lon, decimalLon, lat, decimalLat] = coordStr.match(mmPattern);\n\n    if (decimalLon) {\n      lon = parseFloat(lon + '.' + decimalLon);\n    }\n\n    if (decimalLat) {\n      lat = parseFloat(lat + '.' + decimalLat);\n    }\n  } else {\n    return {\n      lonLat: undefined,\n      message: '',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n\n  if (opts.forceNA && !isXYCoords) {\n    // Set a negative coordinate for North America zone\n    if (lon > 0 && lat > 0) {\n      if (lon > lat) {\n        lon = -lon;\n      } else {\n        lat = -lat;\n      }\n    }\n\n    // Reverse coordinate to respect lonLat convention\n    if (lon > lat) {\n      lon = [lat, (lat = lon)][0];\n    }\n  }\n\n  lonLat = [Number(lon), Number(lat)] as [number, number];\n\n  // Reproject the coordinate if projection parameter have been set and coord is not 4326\n  if (\n    (projectionStr !== undefined && projectionStr !== toProjection) ||\n    (lonLat[0] > 180 || lonLat[0] < -180) ||\n    (lonLat[1] > 90 || lonLat[1] < -90)\n  ) {\n    const source = projectionStr ? 'EPSG:' + projectionStr : mapProjection;\n    const dest = 'EPSG:' + toProjection;\n\n    try {\n      lonLat = olproj.transform(lonLat, source, dest) as [number, number];\n    } catch (e) {\n      return {\n        lonLat: undefined,\n        message: 'Projection ' + source + ' not supported',\n        radius: undefined,\n        conf: undefined\n      };\n    }\n  }\n  if (Math.abs(lonLat[0]) <= 180 && Math.abs(lonLat[1]) <= 90) {\n    return {\n      lonLat,\n      message: '',\n      radius: radius ? parseInt(radius, 10) : undefined,\n      conf: conf ? parseInt(conf, 10) : undefined\n    };\n  } else {\n    return {\n      lonLat: undefined,\n      message: 'Coordinate out of Longitude/Latitude bounds',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n}\n\n/**\n * Convert degrees minutes seconds to dd\n * @param degrees Degrees\n * @param minutes Minutes\n * @param seconds Seconds\n * @param direction Direction\n */\nfunction convertDMSToDD(\n  degrees: number,\n  minutes: number,\n  seconds: number,\n  direction: string\n) {\n  minutes = minutes || 0;\n  seconds = seconds || 0;\n\n  const neg = degrees < 0;\n  let dd = Math.abs(degrees) + minutes / 60 + seconds / 3600;\n\n  if (neg || direction === 'S' || direction === 'W') {\n    dd = -dd;\n  } // Don't do anything for N or E\n  return dd;\n}\n\n/**\n * Convert dd to degrees minutes seconds\n * @param lonLatDD longitude and latitude in dd\n * @param decimal number of decimals for seconds\n * @returns longitude and latitude in dms\n */\nexport function convertDDToDMS(\n  lonLatDD: [number, number], decimal: number = 3\n): string[] {\n  const lonLatDMS = [];\n\n  lonLatDD.forEach(dd => {\n    const degrees = dd < 0 ? Math.ceil(dd) : Math.floor(dd);\n    const int = dd < 0 ? (degrees - dd) * 60 : (dd - degrees) * 60;\n    const minutes = Math.floor(int);\n    const seconds = ((int - minutes) * 60).toFixed(decimal);\n\n    lonLatDMS.push(`${degrees}° ${minutes}' ${seconds}\"`);\n  });\n  return lonLatDMS;\n}\n\n/**\n * Return true of two view states are equal.\n * @param state1 View state\n * @param state2 View state\n * @returns True if the view states are equal\n */\nexport function viewStatesAreEqual(\n  state1: MapViewState,\n  state2: MapViewState\n): boolean {\n  if (state1 === undefined || state2 === undefined) {\n    return false;\n  }\n\n  const tolerance = 1 / 10000;\n  return (\n    state1.zoom === state2.zoom &&\n    Math.trunc(state1.center[0] / tolerance) ===\n      Math.trunc(state2.center[0] / tolerance) &&\n    Math.trunc(state1.center[1] / tolerance) ===\n      Math.trunc(state2.center[1] / tolerance)\n  );\n}\n\n/**\n * Format the scale to a human readable text\n * @param Scale of the map\n * @returns Human readable scale text\n */\nexport function formatScale(scale) {\n  scale = Math.round(scale);\n  if (scale < 10000) {\n    return scale + '';\n  }\n\n  scale = Math.round(scale / 1000);\n  if (scale < 1000) {\n    return scale + 'K';\n  }\n\n  scale = Math.round(scale / 1000);\n  return scale + 'M';\n}\n\n/**\n * Return the resolution from a scale denom\n * @param scale Scale denom\n * @param dpi DPI\n * @returns Resolution\n */\nexport function getResolutionFromScale(\n  scale: number,\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return scale / (inchesPerMeter * dpi);\n}\n\n/**\n * Return the resolution from a scale denom\n * @param Scale denom\n * @returns Resolution\n */\nexport function getScaleFromResolution(\n  resolution: number,\n  unit: string = 'm',\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return resolution * olproj.METERS_PER_UNIT[unit] * inchesPerMeter * dpi;\n}\n\n/**\n * Returns true if the CTRL key is pushed during an Ol MapBrowserPointerEvent\n * @param event OL MapBrowserPointerEvent\n * @returns Whether the CTRL key is pushed\n */\nexport function ctrlKeyDown(event: MapBrowserPointerEvent<any>): boolean {\n  const originalEvent = event.originalEvent;\n  return (\n    !originalEvent.altKey &&\n    (MAC ? originalEvent.metaKey : originalEvent.ctrlKey) &&\n    !originalEvent.shiftKey\n  );\n}\n\nexport function roundCoordTo(coord: [number, number], decimal: number = 3): [number, number] {\n  return [\n    NumberUtils.roundToNDecimal(coord[0], decimal),\n    NumberUtils.roundToNDecimal(coord[1], decimal)] as [number, number];\n}\n\n/**\n * Returns an array of converted coordinates.\n * Conversion is done for every configured projections\n * and for the current UTM zone and MTM zone.\n * @param lonLat [number, number] array of the coordinate to transform.\n * @param projections  Projection[] Array of destination projection.\n * @returns Returns an array of converted coordinates.\n */\nexport function lonLatConversion(\n  lonLat: [number, number],\n  projections: Projection[]\n): {\n  code: string;\n  alias: string;\n  coord: [number, number];\n  igo2CoordFormat: string;\n}[] {\n  const rawCoord3857 = olproj.transform(lonLat, 'EPSG:4326', 'EPSG:3857') as [number, number];\n  const convertedLonLat = [\n    {\n      code: 'EPSG:3857',\n      alias: 'Web Mercator',\n      coord: rawCoord3857,\n      igo2CoordFormat: `${roundCoordTo(rawCoord3857).join(', ')} ; 3857`\n    }\n  ];\n\n  // detect the current utm zone.\n  const utmZone = utmZoneFromLonLat(lonLat);\n  const epsgUtm = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n  const utmName = `UTM-${utmZone}`;\n  const rawCoordUtm = olproj.transform(lonLat, 'EPSG:4326', epsgUtm) as [number, number];\n  convertedLonLat.push({\n    code: epsgUtm,\n    alias: 'UTM',\n    coord: rawCoordUtm,\n    igo2CoordFormat: `${utmName} ${roundCoordTo(rawCoordUtm).join(', ')}`\n  });\n\n  // detect the current mtm zone.\n  const mtmZone = mtmZoneFromLonLat(lonLat);\n  if (mtmZone) {\n    const epsgMtm =\n      mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n    const mtmName = `MTM-${mtmZone}`;\n    const rawCoordMtm = olproj.transform(lonLat, 'EPSG:4326', epsgMtm) as [number, number];\n    convertedLonLat.push({\n      code: epsgMtm,\n      alias: 'MTM',\n      coord: rawCoordMtm,\n      igo2CoordFormat: `${mtmName} ${roundCoordTo(rawCoordMtm).join(', ')}`\n    });\n  }\n\n  projections.forEach(projection => {\n    const rawCoord = olproj.transform(lonLat, 'EPSG:4326', projection.code) as [number, number];\n    const numericEpsgCode = projection.code.split(':')[1];\n    convertedLonLat.push({\n      code: projection.code,\n      alias: projection.alias || projection.code,\n      coord: rawCoord,\n      igo2CoordFormat: `${roundCoordTo(rawCoord).join(\n        ', '\n      )} ; ${numericEpsgCode}`\n    });\n  });\n\n  return convertedLonLat;\n}\n\n/**\n * Detect the current utm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the UTM zone.\n * @returns number The UTM zone.\n */\nexport function utmZoneFromLonLat(lonLat: [number, number]) {\n  return Math.ceil((lonLat[0] + 180) / 6);\n}\n\n/**\n * Detect the current mtm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the MTM zone.\n * @returns number The MTM zone. Undefined if outside of the mtm application zone.\n */\nexport function mtmZoneFromLonLat(lonLat: [number, number]) {\n  const long = lonLat[0];\n  let mtmZone;\n  if (long < -51 && long > -54) {\n    mtmZone = 1;\n  }\n  if (long < -54 && long > -57) {\n    mtmZone = 2;\n  }\n  if (long < -57 && long > -60) {\n    mtmZone = 3;\n  }\n  if (long < -60 && long > -63) {\n    mtmZone = 4;\n  }\n  if (long < -63 && long > -66) {\n    mtmZone = 5;\n  }\n  if (long < -66 && long > -69) {\n    mtmZone = 6;\n  }\n  if (long < -69 && long > -72) {\n    mtmZone = 7;\n  }\n  if (long < -72 && long > -75) {\n    mtmZone = 8;\n  }\n  if (long < -75 && long > -78) {\n    mtmZone = 9;\n  }\n  if (long < -78 && long > -81) {\n    mtmZone = 10;\n  }\n  return mtmZone;\n}\n","import {\n  BehaviorSubject,\n  Observable,\n  Subject,\n  Subscription,\n  combineLatest\n} from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\n\nimport { AuthInterceptor } from '@igo2/auth';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { DataSource, Legend } from '../../../datasource';\nimport { IgoMap } from '../../../map/shared/map';\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\n\nimport { LayerOptions } from './layer.interface';\nimport { LayerSyncWatcher } from '../../utils/layerSync-watcher';\nimport { Message, MessageService } from '@igo2/core';\n\nexport abstract class Layer {\n  public collapsed: boolean;\n  public dataSource: DataSource;\n  public legend: Legend[];\n  public legendCollapsed: boolean = true;\n  public firstLoadComponent: boolean = true;\n  public map: IgoMap;\n  public ol: olLayer<olSource>;\n  public olLoadingProblem: boolean = false;\n  public status$: Subject<SubjectStatus>;\n  public hasBeenVisible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n  private hasBeenVisible$$: Subscription;\n  private resolution$$: Subscription;\n\n  get id(): string {\n    return this.options.id || this.dataSource.id;\n  }\n\n  get alias(): string {\n    return this.options.alias;\n  }\n\n  get title(): string {\n    return this.options.title;\n  }\n\n  set title(title: string) {\n    this.options.title = title;\n  }\n\n  get zIndex(): number {\n    return this.ol.getZIndex();\n  }\n\n  set zIndex(zIndex: number) {\n    this.ol.setZIndex(zIndex);\n  }\n\n  get baseLayer(): boolean {\n    return this.options.baseLayer;\n  }\n\n  set baseLayer(baseLayer: boolean) {\n    this.options.baseLayer = baseLayer;\n  }\n\n  get opacity(): number {\n    return this.ol.get('opacity');\n  }\n\n  set opacity(opacity: number) {\n    this.ol.setOpacity(opacity);\n  }\n\n  set isInResolutionsRange(value: boolean) {\n    this.isInResolutionsRange$.next(value);\n  }\n  get isInResolutionsRange(): boolean {\n    return this.isInResolutionsRange$.value;\n  }\n  readonly isInResolutionsRange$: BehaviorSubject<\n    boolean\n  > = new BehaviorSubject(false);\n\n  set maxResolution(value: number) {\n    this.ol.setMaxResolution(value || Infinity);\n    this.updateInResolutionsRange();\n  }\n  get maxResolution(): number {\n    return this.ol.getMaxResolution();\n  }\n\n  set minResolution(value: number) {\n    this.ol.setMinResolution(value || 0);\n    this.updateInResolutionsRange();\n  }\n  get minResolution(): number {\n    return this.ol.getMinResolution();\n  }\n\n  set visible(value: boolean) {\n    this.ol.setVisible(value);\n    this.visible$.next(value);\n    if (!this.hasBeenVisible$.value && value && this.messageService){\n      this.hasBeenVisible$.next(value);\n    }\n  }\n  get visible(): boolean {\n    return this.visible$.value;\n  }\n  readonly visible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  get displayed(): boolean {\n    return this.visible && this.isInResolutionsRange;\n  }\n  readonly displayed$: Observable<boolean> = combineLatest([\n    this.isInResolutionsRange$,\n    this.visible$\n  ]).pipe(map((bunch: [boolean, boolean]) => bunch[0] && bunch[1]));\n\n  get showInLayerList(): boolean {\n    return this.options.showInLayerList !== false;\n  }\n\n  private layerSyncWatcher: LayerSyncWatcher;\n\n  constructor(\n    public options: LayerOptions,\n    protected messageService?: MessageService,\n    protected authInterceptor?: AuthInterceptor\n  ) {\n    this.dataSource = options.source;\n\n    this.ol = this.createOlLayer();\n    if (options.zIndex !== undefined) {\n      this.zIndex = options.zIndex;\n    }\n\n    if (options.baseLayer && options.visible === undefined) {\n      options.visible = false;\n    }\n\n    this.maxResolution = options.maxResolution || getResolutionFromScale(Number(options.maxScaleDenom));\n    this.minResolution = options.minResolution || getResolutionFromScale(Number(options.minScaleDenom));\n\n    this.visible = options.visible === undefined ? true : options.visible;\n    this.opacity = options.opacity === undefined ? 1 : options.opacity;\n\n    if (\n      options.legendOptions &&\n      (options.legendOptions.url || options.legendOptions.html)\n    ) {\n      this.legend = this.dataSource.setLegend(options.legendOptions);\n    }\n\n    this.legendCollapsed = options.legendOptions\n      ? options.legendOptions.collapsed\n        ? options.legendOptions.collapsed\n        : true\n      : true;\n\n    this.ol.set('_layer', this, true);\n  }\n\n  protected abstract createOlLayer(): olLayer<olSource>;\n\n  setMap(igoMap: IgoMap | undefined) {\n    this.map = igoMap;\n\n    this.unobserveResolution();\n    if (igoMap !== undefined) {\n      this.observeResolution();\n      this.layerSyncWatcher = new LayerSyncWatcher(this, this.map);\n      this.layerSyncWatcher.subscribe(() => {});\n      this.hasBeenVisible$$ = this.hasBeenVisible$.subscribe(() => {\n        if (this.options.messages && this.visible) {\n          this.options.messages.map(message => {\n            message.title = message.title;\n            message.text = message.text;\n            this.messageService.message(message as Message);\n          });\n        }\n      });\n    } else {\n      this.layerSyncWatcher.unsubscribe();\n    }\n  }\n\n  private observeResolution() {\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(() =>\n      this.updateInResolutionsRange()\n    );\n  }\n\n  private unobserveResolution() {\n    if (this.resolution$$ !== undefined) {\n      this.resolution$$.unsubscribe();\n      this.resolution$$ = undefined;\n    }\n  }\n\n  private updateInResolutionsRange() {\n    if (this.map !== undefined) {\n      const resolution = this.map.viewController.getResolution();\n      const minResolution = this.minResolution;\n      const maxResolution = this.maxResolution === undefined ? Infinity : this.maxResolution;\n      this.isInResolutionsRange = resolution >= minResolution && resolution <= maxResolution;\n    } else {\n      this.isInResolutionsRange = false;\n    }\n  }\n}\n","import olLayerVector from 'ol/layer/Vector';\nimport olSourceVector from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { unByKey } from 'ol/Observable';\nimport { easeOut } from 'ol/easing';\nimport { asArray as ColorAsArray } from 'ol/color';\nimport { getVectorContext } from 'ol/render';\nimport FormatType from 'ol/format/FormatType';\nimport olFeature from 'ol/Feature';\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\n\nimport { FeatureDataSource } from '../../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSource } from '../../../datasource/shared/datasources/wfs-datasource';\nimport { ArcGISRestDataSource } from '../../../datasource/shared/datasources/arcgisrest-datasource';\nimport { WebSocketDataSource } from '../../../datasource/shared/datasources/websocket-datasource';\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\n\nimport { VectorWatcher } from '../../utils';\nimport { IgoMap } from '../../../map';\nimport { Layer } from './layer';\nimport { VectorLayerOptions } from './vector-layer.interface';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core';\nimport { WFSDataSourceOptions } from '../../../datasource/shared/datasources/wfs-datasource.interface';\nimport { buildUrl, defaultMaxFeatures } from '../../../datasource/shared/datasources/wms-wfs.utils';\nimport { OgcFilterableDataSourceOptions } from '../../../filter/shared/ogc-filter.interface';\nexport class VectorLayer extends Layer {\n  public dataSource:\n    | FeatureDataSource\n    | WFSDataSource\n    | ArcGISRestDataSource\n    | WebSocketDataSource\n    | ClusterDataSource;\n  public options: VectorLayerOptions;\n  public ol: olLayerVector<olSourceVector<OlGeometry>>;\n  private watcher: VectorWatcher;\n  private trackFeatureListenerId;\n\n  get browsable(): boolean {\n    return this.options.browsable !== false;\n  }\n\n  get exportable(): boolean {\n    return this.options.exportable !== false;\n  }\n\n  constructor(\n    options: VectorLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new VectorWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVector<olSourceVector<OlGeometry>> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVector<OlGeometry>\n    });\n\n    if (this.options.animation) {\n      this.dataSource.ol.on(\n        'addfeature',\n        function(e) {\n          this.flash(e.feature);\n        }.bind(this)\n      );\n    }\n\n    if (this.options.trackFeature) {\n      this.enableTrackFeature(this.options.trackFeature);\n    }\n\n    const vector = new olLayerVector(olOptions);\n    const vectorSource = vector.getSource() as olSourceVector<OlGeometry>;\n    const url = vectorSource.getUrl();\n    if (url) {\n      let loader;\n      const wfsOptions = olOptions.sourceOptions as WFSDataSourceOptions;\n      if (wfsOptions?.type === 'wfs' && (wfsOptions.params || wfsOptions.paramsWFS)) {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customWFSLoader(\n            vectorSource,\n            wfsOptions,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      } else {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customLoader(\n            vectorSource,\n            url,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      }\n      if (loader) {\n        vectorSource.setLoader(loader);\n      }\n    }\n    return vector;\n  }\n\n  protected flash(feature) {\n    const start = new Date().getTime();\n    const listenerKey = this.ol.on('postrender', animate.bind(this));\n\n    function animate(event) {\n      const vectorContext = getVectorContext(event);\n      const frameState = event.frameState;\n      const flashGeom = feature.getGeometry().clone();\n      const elapsed = frameState.time - start;\n      const elapsedRatio = elapsed / this.options.animation.duration;\n      const opacity = easeOut(1 - elapsedRatio);\n      const newColor = ColorAsArray(this.options.animation.color || 'red');\n      newColor[3] = opacity;\n      let style = this.ol\n        .getStyleFunction()\n        .call(this, feature)\n        .find((style2) => {\n          return style2.getImage();\n        });\n      if (!style) {\n        style = this.ol.getStyleFunction().call(this, feature)[0];\n      }\n      const styleClone = style.clone();\n\n      switch (feature.getGeometry().getType()) {\n        case 'Point':\n          const radius =\n            easeOut(elapsedRatio) * (styleClone.getImage().getRadius() * 3);\n          styleClone.getImage().setRadius(radius);\n          styleClone.getImage().setOpacity(opacity);\n          break;\n        case 'LineString':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getStroke().setColor(newColor);\n            styleClone\n              .getImage()\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) *\n                  (styleClone.getImage().getStroke().getWidth() * 3)\n              );\n          }\n          if (styleClone.getStroke()) {\n            styleClone.getStroke().setColor(newColor);\n            styleClone\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) * (styleClone.getStroke().getWidth() * 3)\n              );\n          }\n          break;\n        case 'Polygon':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getFill().setColor(newColor);\n          }\n          if (styleClone.getFill()) {\n            styleClone.getFill().setColor(newColor);\n          }\n          break;\n      }\n\n      styleClone.setText('');\n      vectorContext.setStyle(styleClone);\n      vectorContext.drawGeometry(flashGeom);\n\n      if (elapsed > this.options.animation.duration) {\n        unByKey(listenerKey);\n        // remove last geometry\n        // there is a little flash before feature disappear, better solution ?\n        this.map.ol.render();\n        return;\n      }\n      // tell OpenLayers to continue postcompose animation\n      this.map.ol.render();\n    }\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  public onUnwatch() {\n    this.dataSource.onUnwatch();\n    this.stopAnimation();\n  }\n\n  public stopAnimation() {\n    this.dataSource.ol.un(\n      'addfeature',\n      function(e) {\n        if (this.visible) {\n          this.flash(e.feature);\n        }\n      }.bind(this)\n    );\n  }\n\n  public enableTrackFeature(id: string | number) {\n    this.trackFeatureListenerId = this.dataSource.ol.on(\n      'addfeature',\n      this.trackFeature.bind(this, id)\n    );\n  }\n  public centerMapOnFeature(id: string | number) {\n    const feat = this.dataSource.ol.getFeatureById(id);\n    if (feat) {\n      this.map.ol.getView().setCenter(feat.getGeometry().getCoordinates());\n    }\n  }\n\n  public trackFeature(id, feat) {\n    if (feat.feature.getId() === id && this.visible) {\n      this.centerMapOnFeature(id);\n    }\n  }\n\n  public disableTrackFeature(id?: string | number) {\n    unByKey(this.trackFeatureListenerId);\n  }\n\n  /**\n   * Custom loader for a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param options olOptions from source\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param proj the projection to retrieve the data\n   * @param success success callback\n   * @param failure failure callback\n   */\n  private customWFSLoader(\n    vectorSource,\n    options,\n    interceptor,\n    extent,\n    resolution,\n    proj,\n    success,\n    failure\n  ) {\n    {\n      const paramsWFS = options.paramsWFS;\n      const wfsProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : proj;\n      const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\n      paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\n      const url = buildUrl(\n        options,\n        currentExtent,\n        wfsProj,\n        (options as OgcFilterableDataSourceOptions).ogcFilters);\n      let startIndex = 0;\n      if (paramsWFS.version === '2.0.0' && paramsWFS.maxFeatures > defaultMaxFeatures) {\n        const nbOfFeature = 1000;\n        while (startIndex < paramsWFS.maxFeatures) {\n          let alteredUrl = url.replace('count=' + paramsWFS.maxFeatures, 'count=' + nbOfFeature);\n          alteredUrl = alteredUrl.replace('startIndex=0', '0');\n          alteredUrl += '&startIndex=' + startIndex;\n          alteredUrl.replace(/&&/g, '&');\n          this.getFeatures(vectorSource, interceptor, currentExtent, wfsProj, proj, alteredUrl, nbOfFeature, success, failure);\n          startIndex += nbOfFeature;\n        }\n      } else {\n        this.getFeatures(vectorSource, interceptor, currentExtent, wfsProj, proj, url, paramsWFS.maxFeatures, success, failure);\n      }\n    }\n  }\n\n\n  /**\n   * Custom loader to get feature from a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param dataProjection the projection of the retrieved data\n   * @param featureProjection the projection of the created features\n   * @param url the url string to retrieve the data\n   * @param threshold the threshold to manage \"more features\" (TODO)\n   * @param success success callback\n   * @param failure failure callback\n   */\n  private getFeatures(\n    vectorSource: olSourceVector<OlGeometry>,\n    interceptor,\n    extent,\n    dataProjection,\n    featureProjection,\n    url: string,\n    threshold: number,\n    success, failure) {\n\n    const xhr = new XMLHttpRequest();\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', modifiedUrl);\n    if (interceptor) {\n      interceptor.interceptXhr(xhr, modifiedUrl);\n    }\n    const onError = () => {\n      vectorSource.removeLoadedExtent(extent);\n      failure();\n    };\n    xhr.onerror = onError;\n    xhr.onload = () => {\n      if (xhr.status === 200 && xhr.responseText.length > 0) {\n        const features =\n          vectorSource\n            .getFormat()\n            .readFeatures(xhr.responseText, { dataProjection, featureProjection }) as olFeature<OlGeometry>[];\n        // TODO Manage \"More feature\"\n        /*if (features.length === 0 || features.length < threshold ) {\n          console.log('No more data to download at this resolution');\n        }*/\n        vectorSource.addFeatures(features);\n        success(features);\n      } else {\n        onError();\n      }\n    };\n    xhr.send();\n  }\n\n  /**\n   * Custom loader for vector layer.\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param url the url string or function to retrieve the data\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param projection the projection to retrieve the data\n   */\n  private customLoader(\n    vectorSource,\n    url,\n    interceptor,\n    extent,\n    resolution,\n    projection,\n    success,\n    failure\n  ) {\n    const xhr = new XMLHttpRequest();\n    let modifiedUrl = url;\n    if (typeof url !== 'function') {\n      const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n      if (alteredUrlWithKeyAuth) {\n        modifiedUrl = alteredUrlWithKeyAuth;\n      }\n    } else {\n      modifiedUrl = url(extent, resolution, projection);\n    }\n    xhr.open( 'GET', modifiedUrl);\n    const format = vectorSource.getFormat();\n    if (format.getType() === FormatType.ARRAY_BUFFER) {\n      xhr.responseType = 'arraybuffer';\n    }\n    if (interceptor) {\n      interceptor.interceptXhr(xhr, modifiedUrl);\n    }\n\n    const onError = () => {\n      vectorSource.removeLoadedExtent(extent);\n      failure();\n    };\n    xhr.onerror = onError;\n    xhr.onload = () => {\n      // status will be 0 for file:// urls\n      if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\n        const type = format.getType();\n        let source;\n        if (type === FormatType.JSON || type === FormatType.TEXT) {\n          source = xhr.responseText;\n        } else if (type === FormatType.XML) {\n          source = xhr.responseXML;\n          if (!source) {\n            source = new DOMParser().parseFromString(\n              xhr.responseText,\n              'application/xml'\n            );\n          }\n        } else if (type === FormatType.ARRAY_BUFFER) {\n          source = xhr.response;\n        }\n        if (source) {\n          const features = format.readFeatures(source, { extent, featureProjection: projection });\n          vectorSource.addFeatures(features, format.readProjection(source));\n          success(features);\n        } else {\n          onError();\n        }\n      } else {\n        onError();\n      }\n    };\n    xhr.send();\n  }\n}\n","import olSourceOSM from 'ol/source/OSM';\n\nimport { DataSource } from './datasource';\nimport { OSMDataSourceOptions } from './osm-datasource.interface';\n\nexport class OSMDataSource extends DataSource {\n  public options: OSMDataSourceOptions;\n  public ol: olSourceOSM;\n\n  protected createOlSource(): olSourceOSM {\n    if (!this.options.url) {\n      this.options.url = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';\n    }\n    return new olSourceOSM(this.options);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceXYZ from 'ol/source/XYZ';\n\nimport { DataSource } from './datasource';\nimport { XYZDataSourceOptions } from './xyz-datasource.interface';\n\nexport class XYZDataSource extends DataSource {\n  public options: XYZDataSourceOptions;\n  public ol: olSourceXYZ;\n\n  protected createOlSource(): olSourceXYZ {\n    return new olSourceXYZ(this.options);\n  }\n\n  public onUnwatch() {}\n\n}\n","import olSourceVector from 'ol/source/Vector';\nimport * as OlLoadingStrategy from 'ol/loadingstrategy';\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WFSService } from './wfs.service';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport { OgcFilterableDataSourceOptions, OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\nimport {\n  defaultFieldNameGeometry,\n  checkWfsParams,\n  getFormatFromOptions,\n  buildUrl\n} from './wms-wfs.utils';\nimport { BehaviorSubject } from 'rxjs';\nimport { AuthInterceptor } from '@igo2/auth';\n\nexport class WFSDataSource extends DataSource {\n  public ol: olSourceVector<OlGeometry>;\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  readonly ogcFilters$: BehaviorSubject<OgcFiltersOptions> = new BehaviorSubject(undefined);\n\n  constructor(\n    public options: WFSDataSourceOptions,\n    protected wfsService: WFSService,\n    private authInterceptor?: AuthInterceptor\n  ) {\n    super(checkWfsParams(options, 'wfs'));\n\n    const ogcFilters = (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n    const fieldNameGeometry = this.options.paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n    const ogcFilterWriter = new OgcFilterWriter();\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters =\n      ogcFilterWriter.defineOgcFiltersDefaultOptions(ogcFilters, fieldNameGeometry);\n    if (\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.enabled &&\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.editable &&\n      (options.sourceFields || []).filter(sf => !sf.values).length > 0\n    ) {\n      this.wfsService.getSourceFieldsFromWFS(this.options);\n    }\n\n    if (ogcFilters?.pushButtons){\n      ogcFilters.pushButtons.selectorType = 'pushButton';\n    }\n    if (ogcFilters?.checkboxes){\n      ogcFilters.checkboxes.selectorType = 'checkbox';\n    }\n    if (ogcFilters?.radioButtons){\n      ogcFilters.radioButtons.selectorType = 'radioButton';\n    }\n    if (ogcFilters?.select){\n      ogcFilters.select.selectorType = 'select';\n    }\n\n    this.setOgcFilters((this.options as OgcFilterableDataSourceOptions).ogcFilters, true);\n  }\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const vectorSource = new olSourceVector({\n      format: getFormatFromOptions(this.options),\n      url: (extent, resolution, proj: olProjection) => {\n        const paramsWFS = this.options.paramsWFS;\n        const wfsProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : proj;\n        const ogcFilters = (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n        const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\n        paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\n        return buildUrl(this.options, currentExtent, wfsProj, ogcFilters);\n      },\n      strategy: OlLoadingStrategy.bbox\n    });\n    return vectorSource;\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    if (triggerEvent) {\n      this.ogcFilters$.next(this.ogcFilters);\n    }\n  }\n\n  public onUnwatch() { }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { combineLatest, Observable, of } from 'rxjs';\nimport olFeature from 'ol/Feature';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { DataService } from './data.service';\nimport { formatWFSQueryString,\n          gmlRegex,\n          defaultEpsg,\n          defaultMaxFeatures,\n          getFormatFromOptions} from './wms-wfs.utils';\nimport { concatMap } from 'rxjs/operators';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n@Injectable({\n  providedIn: 'root'\n})\nexport class WFSService extends DataService {\n  constructor(private http: HttpClient) {\n    super();\n  }\n\n  getData() {\n    console.log('This is defining a data service.');\n    return 'This is defining a data service.';\n  }\n\n  public getSourceFieldsFromWFS(dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions) {\n    if (!dataSourceOptions.sourceFields || dataSourceOptions.sourceFields.length === 0 ) {\n      dataSourceOptions.sourceFields = [];\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(getfeatureSourceField => {\n        dataSourceOptions.sourceFields = getfeatureSourceField;\n      });\n\n    } else {\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(getfeatureSourceField => {\n        dataSourceOptions.sourceFields.forEach(sourcefield => {\n          if (sourcefield.alias === undefined) {\n            sourcefield.alias = sourcefield.name; // to allow only a list of sourcefield with names\n          }\n          if (sourcefield.values === undefined || sourcefield.values.length === 0) {\n            sourcefield.values = getfeatureSourceField.find(sf => sf.name === sourcefield.name).values;\n          }\n        });\n      });\n    }\n  }\n\n  private wfsGetFeature(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n    nb: number = defaultMaxFeatures,\n    epsgCode: string = defaultEpsg,\n    propertyName?: string,\n    startIndex: number = 0,\n    forceDefaultOutputFormat: boolean = false\n  ): Observable<any> {\n    const queryStringValues = formatWFSQueryString(dataSourceOptions, nb, epsgCode, propertyName, startIndex, forceDefaultOutputFormat );\n    const baseUrl = queryStringValues.find(f => f.name === 'getfeature').value;\n    const outputFormat = dataSourceOptions.paramsWFS.outputFormat;\n    if (forceDefaultOutputFormat || gmlRegex.test(outputFormat) || !outputFormat) {\n      return this.http.get(baseUrl, { responseType: 'text' });\n    } else {\n      return this.http.get(baseUrl);\n    }\n  }\n\n  defineFieldAndValuefromWFS(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\n  ): Observable<any> {\n    return new Observable(d => {\n      const sourceFields = [];\n      let fieldList;\n      let fieldListWoGeom;\n      let fieldListWoGeomStr;\n      let olFormats;\n      let effectiveOlFormats;\n\n      olFormats = getFormatFromOptions(dataSourceOptions);\n      const gmlDataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions = JSON.parse(\n        JSON.stringify(dataSourceOptions)\n      );\n      delete gmlDataSourceOptions.paramsWFS.outputFormat;\n      delete (gmlDataSourceOptions as WFSDataSourceOptions).formatOptions;\n\n      effectiveOlFormats = getFormatFromOptions(gmlDataSourceOptions);\n      let sourceFieldsToRetrieveValues = dataSourceOptions.sourceFields?.filter(f => !f.values).map(f => f.name);\n\n      // Validate if the service manage no outputformat (wfs 1.0.0 and GML is the default return)\n      this.wfsGetFeature(dataSourceOptions, 1, undefined, undefined, 0, true).pipe(\n        concatMap(res => String(res).toLowerCase().includes('exception') ? of(false) : of(true)),\n        concatMap(allowGml => {\n          // If the service return GML (return no exception)\n          return this.wfsGetFeature(dataSourceOptions, 1).pipe(\n            concatMap(firstFeature => {\n              const features = olFormats.readFeatures(firstFeature);\n              fieldList = features[0].getKeys();\n              if (dataSourceOptions.sourceFields || dataSourceOptions.sourceFields.length === 0) {\n                sourceFieldsToRetrieveValues = fieldList;\n              }\n              fieldListWoGeom = fieldList.filter(\n                field =>\n                  sourceFieldsToRetrieveValues.includes(field) &&\n                  field !== features[0].getGeometryName() &&\n                  !field.match(/boundedby/gi)\n              );\n              fieldListWoGeomStr = fieldListWoGeom.join(',');\n              const processingArray = [];\n              let startIndex = 0;\n              // If the service do not allow gml return, dice the call in multiple\n              // calls by increment of chunkSize with the original outputFormat\n              if (\n                !allowGml && dataSourceOptions.paramsWFS.version === '2.0.0' &&\n                dataSourceOptions.paramsWFS.maxFeatures > defaultMaxFeatures) {\n                const chunkSize = 1000;\n                while (startIndex < dataSourceOptions.paramsWFS.maxFeatures) {\n                  processingArray.push(this.wfsGetFeature(\n                    dataSourceOptions,\n                    chunkSize,\n                    dataSourceOptions.paramsWFS.srsName,\n                    fieldListWoGeomStr,\n                    startIndex\n                  ));\n                  startIndex += chunkSize;\n                }\n                effectiveOlFormats = olFormats;\n              } else {\n                processingArray.push(this.wfsGetFeature(\n                  dataSourceOptions,\n                  dataSourceOptions.paramsWFS.maxFeatures || defaultMaxFeatures,\n                  dataSourceOptions.paramsWFS.srsName,\n                  fieldListWoGeomStr,\n                  0, true\n                ));\n              }\n              return combineLatest(processingArray);\n            })\n          );\n        })).subscribe((results) => {\n          let mfeatures: olFeature<OlGeometry>[] = [];\n          results.map((result) => {\n            const loopFeatures = effectiveOlFormats.readFeatures(result);\n            mfeatures = mfeatures.concat(loopFeatures);\n          });\n          this.built_properties_value(mfeatures).forEach(element => {\n            sourceFields.push(element);\n          });\n          d.next(sourceFields);\n          d.complete();\n        });\n    });\n  }\n\n  private built_properties_value(features: olFeature<OlGeometry>[]): string[] {\n    if (features.length === 0) {\n      return [];\n    }\n    const kv = Object.assign({}, features[0].getProperties());\n    delete kv[features[0].getGeometryName()];\n    delete kv.boundedBy;\n    const sourceFields = [];\n    for (const property in kv) {\n      if (kv.hasOwnProperty(property)) {\n        const fieldType =\n          typeof features[0].get(property) === 'object'\n            ? undefined\n            : typeof features[0].get(property);\n        sourceFields.push({\n          name: property,\n          alias: property,\n          type: fieldType,\n          values: [kv[property]]\n        });\n      }\n    }\n    features.every((element) => {\n      const featureProperties = element.getProperties();\n      for (const key in featureProperties) {\n        if (featureProperties.hasOwnProperty(key) && key in kv) {\n          sourceFields.filter(f => f.name === key).forEach(v => {\n            if (v.values.indexOf(featureProperties[key]) === -1) {\n              v.values.push(featureProperties[key]);\n            }\n          });\n        }\n      }\n      return true;\n    });\n    return sourceFields;\n  }\n}\n","import olTileGridWMTS from 'ol/tilegrid/WMTS';\nimport * as olproj from 'ol/proj';\nimport {\n  getTopLeft as extentGetTopLeft,\n  getWidth as extentGetWidth\n} from 'ol/extent.js';\n\nexport function createDefaultTileGrid(epsg?: string): olTileGridWMTS {\n  const projection = epsg ? olproj.get(epsg) : olproj.get('EPSG:3857');\n  const projectionExtent = projection.getExtent();\n  const size = extentGetWidth(projectionExtent) / 256;\n  const resolutions = new Array(20);\n  const matrixIds = new Array(20);\n  for (let z = 0; z < 20; ++z) {\n    resolutions[z] = size / Math.pow(2, z);\n    matrixIds[z] = z;\n  }\n\n  return new olTileGridWMTS({\n    origin: extentGetTopLeft(projectionExtent),\n    resolutions,\n    matrixIds\n  });\n}\n","import { Options } from 'ol/source/WMTS';\nimport olSourceWMTS from 'ol/source/WMTS';\n\nimport { createDefaultTileGrid } from '../../utils/tilegrid';\nimport { DataSource } from './datasource';\nimport { WMTSDataSourceOptions } from './wmts-datasource.interface';\n\nexport class WMTSDataSource extends DataSource {\n  public options: WMTSDataSourceOptions;\n  public ol: olSourceWMTS;\n\n  constructor(options: WMTSDataSourceOptions) {\n    super(options);\n  }\n\n  protected createOlSource(): olSourceWMTS {\n    const sourceOptions = Object.assign(\n      {\n        tileGrid: createDefaultTileGrid(this.options.projection as string)\n      },\n      this.options\n    ) as Options;\n\n    return new olSourceWMTS(sourceOptions);\n  }\n\n  public onUnwatch() {}\n\n}\n","import olSourceCarto from 'ol/source/CartoDB';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { CartoDataSourceOptions } from './carto-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\n\nexport class CartoDataSource extends DataSource {\n  public ol: olSourceCarto;\n  public options: CartoDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceCarto {\n    const crossOrigin = this.options.crossOrigin\n      ? this.options.crossOrigin\n      : 'anonymous';\n    const sourceOptions = Object.assign(\n      {\n        crossOrigin\n      },\n      this.options\n    );\n    return new olSourceCarto(sourceOptions);\n  }\n\n  getLegend(): Legend[] {\n    const legend = super.getLegend();\n    if (legend.length > 0) {\n      return legend;\n    }\n\n    let htmlString = '<table>';\n    if (this.options.config.layers[0].legend !== null) {\n      this.options.config.layers[0].legend.items.forEach(f => {\n        if (f.visible === true) {\n          htmlString +=\n            '<tr><td>' +\n            '<p><font size=\"5\" color=\"' +\n            f.value +\n            '\"> &#9679</font></p></td>' +\n            '<td>' +\n            f.name +\n            '</td></tr>';\n        }\n      });\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    } else {\n      // Try to build the legend from the cartocss options\n      const layerOptions = this.options.config.layers[0].options;\n      // All available cartocss style options\n      const types = [\n        'polygon-fill:',\n        'marker-fill:',\n        'shield-fill:',\n        'building-fill:',\n        'line-color:'\n      ];\n      for (const oneType of types) {\n        if (layerOptions.cartocss.includes(oneType)) {\n          const type = layerOptions.cartocss.split(oneType).pop();\n          const color = type.substr(0, type.indexOf(';'));\n          if (color.includes('ramp')) {\n            const colors = color.split(', (')[1].split(',');\n            const data = color.split(', (')[2].split(',');\n            for (let j = 0; j < colors.length; j++) {\n              colors[j] = colors[j].replace(/(\"|\\))/g, '');\n              data[j] = data[j].replace(/(\"|\\))/g, '');\n              if (data[j].replace(/\\s+/g, '') === '=') {\n                data[j] = 'Autres';\n              }\n              htmlString +=\n                '<tr><td>' +\n                '<p><font size=\"5\" color=\"' +\n                colors[j] +\n                '\"> &#9679</font></p></td>' +\n                '<td>' +\n                data[j] +\n                '</td></tr>';\n            }\n            break;\n          } else {\n            const title = layerOptions.layer_name\n              ? layerOptions.layer_name\n              : '';\n            htmlString +=\n              '<tr><td>' +\n              '<p><font size=\"5\" color=\"' +\n              color +\n              '\"> &#9679</font></p>' +\n              '</td><td>' +\n              title +\n              '</td></tr>';\n            break;\n          }\n        }\n      }\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    }\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceVector from 'ol/source/Vector';\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\nimport * as olloadingstrategy from 'ol/loadingstrategy';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { ArcGISRestDataSourceOptions } from './arcgisrest-datasource.interface';\n\nexport class ArcGISRestDataSource extends DataSource {\n  public ol: olSourceVector<OlGeometry>;\n  public options: ArcGISRestDataSourceOptions;\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const esrijsonFormat = new olFormatEsriJSON();\n    return new olSourceVector({\n      attributions: this.options.params.attributions,\n      overlaps: false,\n      format: esrijsonFormat,\n      url: function(extent, resolution, proj) {\n        const baseUrl = this.options.url + '/' + this.options.layer + '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        if (this.options.params.time) {\n          const time = `time=${this.options.params.time}`;\n          params.push(time);\n        }\n        if (this.options.params.customParams) {\n          this.options.params.customParams.forEach(element => {\n            params.push(element);\n          });\n        }\n        return `${baseUrl}?${params.join('&')}`;\n      }.bind(this),\n      strategy: olloadingstrategy.bbox\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || legend.length > 0) {\n      return legend;\n    }\n\n    const id = parseInt(this.options.layer, 10);\n    const lyr = legendInfo.layers.find(layer => layer.layerId === id);\n    if (!lyr) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const lyrLegend of lyr.legend) {\n      const modifiedUrl = this.options.url.replace(\n        'FeatureServer',\n        'MapServer'\n      );\n      const src = `${modifiedUrl}/${lyr.layerId}/images/${lyrLegend.url}`;\n      const label = lyrLegend.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td>` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import ImageArcGISRest from 'ol/source/ImageArcGISRest';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { ArcGISRestImageDataSourceOptions } from './imagearcgisrest-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nexport class ImageArcGISRestDataSource extends DataSource {\n  public ol: ImageArcGISRest;\n  public options: ArcGISRestImageDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): ImageArcGISRest {\n    const params = this.options.layer === undefined ? this.options.params : Object.assign(\n      {LAYERS: `show:${this.options.layer}`},\n      this.options.params\n    );\n\n    if (typeof params.renderingRule === 'object') {\n      params.renderingRule = JSON.stringify(params.renderingRule);\n    }\n\n    return new ImageArcGISRest({\n      ratio: 1,\n      params,\n      url: this.options.url\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.options?.legendInfo || this.params?.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || this.options.layer === undefined || legend.length > 0) {\n      return legend;\n    }\n\n    const id = parseInt(this.options.layer, 10);\n    const lyr = legendInfo.layers.find(layer => layer.layerId === id);\n    if (!lyr) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const lyrLegend of lyr.legend) {\n      const src = `${this.options.url}/${lyr.layerId}/images/${\n        lyrLegend.url\n      }`;\n      const label = lyrLegend.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td>` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceTileArcGISRest from 'ol/source/TileArcGISRest';\nimport { Options } from 'ol/source/TileArcGISRest';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { TileArcGISRestDataSourceOptions } from './tilearcgisrest-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\n\nexport class TileArcGISRestDataSource extends DataSource {\n  public ol: olSourceTileArcGISRest;\n  public options: TileArcGISRestDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceTileArcGISRest {\n    return new olSourceTileArcGISRest(this.options as Options);\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || legend.length > 0) {\n      return legend;\n    }\n\n    const id = parseInt(this.options.layer, 10);\n    const lyr = legendInfo.layers.find(layer => layer.layerId === id);\n    if (!lyr) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const lyrLegend of lyr.legend) {\n      const src = `${this.options.url}/${lyr.layerId}/images/${\n        lyrLegend.url\n      }`;\n      const label = lyrLegend.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td>` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import TileDebug from 'ol/source/TileDebug';\nimport TileGrid from 'ol/tilegrid/TileGrid';\n\nimport { DataSource } from './datasource';\nimport { TileDebugDataSourceOptions } from './tiledebug-datasource.interface';\n\nexport class TileDebugDataSource extends DataSource {\n  public options: TileDebugDataSourceOptions;\n  public ol: TileDebug;\n\n  protected createOlSource(): TileDebug {\n    const baseOptions = JSON.parse(JSON.stringify(this.options)); // to avoid to alter the original options\n    if (this.options.tileGrid) {\n      delete baseOptions.tileGrid;\n      baseOptions.tileGrid = new TileGrid(this.options.tileGrid);\n    }\n    return new TileDebug(baseOptions);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceVector from 'ol/source/Vector';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { WebSocketDataSourceOptions } from './websocket-datasource.interface';\n\nexport class WebSocketDataSource extends FeatureDataSource {\n  public ws: WebSocket;\n  public options: WebSocketDataSourceOptions;\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    this.createWebSocket();\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    return super.createOlSource();\n  }\n\n  private createWebSocket() {\n    this.ws = new WebSocket(this.options.url);\n    this.ws.onmessage = this.onMessage.bind(this);\n\n    if (this.options.onclose) {\n      this.ws.onclose = this.onClose.bind(this);\n    }\n\n    if (this.options.onerror) {\n      this.ws.onerror = this.onError.bind(this);\n    }\n\n    if (this.options.onopen) {\n      this.ws.onopen = this.onOpen.bind(this);\n    }\n  }\n\n  onMessage(event) {\n    const featureAdded = this.options.format.readFeature(event.data) as olFeature<OlGeometry>;\n\n    switch (this.options.onmessage) {\n      case 'update':\n        // ol don't add if same ID\n        const featureToRemove = this.ol.getFeatureById(featureAdded.getId());\n        if (featureToRemove) {\n          this.ol.removeFeature(featureToRemove);\n        }\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'delete':\n        this.ol.clear(true);\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'add':\n      default:\n        this.ol.addFeature(featureAdded);\n    }\n  }\n\n  onClose(event) {\n    // thrown message to user\n  }\n\n  onError(event) {\n    // thrown message to user\n  }\n\n  onOpen(event) {\n    // thrown message to user ?\n  }\n\n  public onUnwatch() {\n    this.ws.close();\n  }\n}\n","import { Md5 } from 'ts-md5';\nimport feature from 'ol/Feature';\nimport olSourceVectorTile from 'ol/source/VectorTile';\nimport olFormatMVT from 'ol/format/MVT';\n\nimport { uuid } from '@igo2/utils';\n\nimport { DataSource } from './datasource';\nimport { MVTDataSourceOptions } from './mvt-datasource.interface';\n\nexport class MVTDataSource extends DataSource {\n  public options: MVTDataSourceOptions;\n  public ol: olSourceVectorTile;\n\n  protected createOlSource(): olSourceVectorTile {\n    let mvtFormat;\n    if (this.options.featureClass === 'feature') {\n      mvtFormat = new olFormatMVT({featureClass: feature});\n    } else if (this.options.featureClass === undefined) {\n      mvtFormat = new olFormatMVT();\n    }\n    this.options.format = mvtFormat;\n    return new olSourceVectorTile(this.options);\n  }\n\n  protected generateId() {\n    if (!this.options.url) {\n        return uuid();\n    }\n    const chain = 'mvt' + this.options.url;\n    return Md5.hashStr(chain) as string;\n  }\n\n  public onUnwatch() {}\n}\n","import * as olstyle from 'ol/style';\nimport * as olproj from 'ol/proj';\n\nexport class EsriStyleGenerator {\n  public _converters: any;\n  public _renderers: any;\n\n  constructor() {\n    this._converters = {};\n    this._converters.esriPMS = EsriStyleGenerator._convertEsriPMS;\n    this._converters.esriSFS = EsriStyleGenerator._convertEsriSFS;\n    this._converters.esriSLS = EsriStyleGenerator._convertEsriSLS;\n    this._converters.esriSMS = EsriStyleGenerator._convertEsriSMS;\n    this._converters.esriTS = EsriStyleGenerator._convertEsriTS;\n    this._renderers = {};\n    this._renderers.uniqueValue = this._renderUniqueValue;\n    this._renderers.simple = this._renderSimple;\n    this._renderers.classBreaks = this._renderClassBreaks;\n  }\n  static _convertPointToPixel(point) {\n    return point / 0.75;\n  }\n  static _transformColor(color): [number, number, number, number] {\n    // alpha channel is different, runs from 0-255 but in ol3 from 0-1\n    return [color[0], color[1], color[2], color[3] / 255];\n  }\n\n  static _getResolutionForScale(scale, units) {\n    const dpi = 96;\n    const mpu = olproj.METERS_PER_UNIT[units];\n    const inchesPerMeter = 39.3701;\n    return parseFloat(scale) / (mpu * inchesPerMeter * dpi);\n  }\n\n  /* convert an Esri Text Symbol */\n  static _convertEsriTS(symbol) {\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    const text = symbol.text !== undefined ? symbol.text : undefined;\n    return new olstyle.Style({\n      text: new olstyle.Text({\n        fill: new olstyle.Fill({\n          color: EsriStyleGenerator._transformColor(symbol.color)\n        }),\n        font:\n          symbol.font.style +\n          ' ' +\n          symbol.font.weight +\n          ' ' +\n          symbol.font.size +\n          ' px ' +\n          symbol.font.family,\n        textBaseline: symbol.verticalAlignment,\n        textAlign: symbol.horizontalAlignment,\n        offsetX: EsriStyleGenerator._convertPointToPixel(symbol.xoffset),\n        offsetY: EsriStyleGenerator._convertPointToPixel(symbol.yoffset),\n        rotation,\n        text\n      })\n    });\n  }\n  /* convert an Esri Picture Marker Symbol */\n  static _convertEsriPMS(symbol) {\n    const src = 'data:' + symbol.contentType + ';base64, ' + symbol.imageData;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n\n    return new olstyle.Style({\n      image: new olstyle.Icon({\n        src,\n        rotation\n      })\n    });\n  }\n  /* convert an Esri Simple Fill Symbol */\n  static _convertEsriSFS(symbol) {\n    // there is no support in openlayers currently for fill patterns, so style is not interpreted\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    return new olstyle.Style({\n      fill,\n      stroke\n    });\n  }\n  static _convertOutline(outline) {\n    let lineDash;\n    const color = EsriStyleGenerator._transformColor(outline.color);\n    if (outline.style === 'esriSLSDash') {\n      lineDash = [5];\n    } else if (outline.style === 'esriSLSDashDot') {\n      lineDash = [5, 5, 1, 2];\n    } else if (outline.style === 'esriSLSDashDotDot') {\n      lineDash = [5, 5, 1, 2, 1, 2];\n    } else if (outline.style === 'esriSLSDot') {\n      lineDash = [1, 2];\n    } else if (outline.style === 'esriSLSNull') {\n      // line not visible, make color fully transparent\n      color[3] = 0;\n    }\n    return new olstyle.Stroke({\n      color,\n      lineDash,\n      width: EsriStyleGenerator._convertPointToPixel(outline.width)\n    });\n  }\n  /* convert an Esri Simple Line Symbol */\n  static _convertEsriSLS(symbol) {\n    return new olstyle.Style({\n      stroke: EsriStyleGenerator._convertOutline(symbol)\n    });\n  }\n  static _transformAngle(angle) {\n    if (angle === 0 || angle === undefined) {\n      return undefined;\n    }\n    const normalRad = (angle * Math.PI) / 180;\n    const ol3Rad = -normalRad + Math.PI / 2;\n    if (ol3Rad < 0) {\n      return 2 * Math.PI + ol3Rad;\n    } else {\n      return ol3Rad;\n    }\n  }\n  /* convert an Esri Simple Marker Symbol */\n  static _convertEsriSMS(symbol) {\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    const radius = EsriStyleGenerator._convertPointToPixel(symbol.size) / 2;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    if (symbol.style === 'esriSMSCircle') {\n      return new olstyle.Style({\n        image: new olstyle.Circle({\n          radius,\n          fill,\n          stroke\n        })\n      });\n    } else if (symbol.style === 'esriSMSCross') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: 0,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSDiamond') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSSquare') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSX') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSTriangle') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 3,\n          radius,\n          angle: 0,\n          rotation\n        })\n      });\n    }\n  }\n\n  _convertLabelingInfo(labelingInfo, mapUnits) {\n    const styles = [];\n    for (let i = 0, ii = labelingInfo.length; i < ii; ++i) {\n      const labelExpression = labelingInfo[i].labelExpression;\n      // only limited support for label expressions\n      const field = labelExpression.substr(\n        labelExpression.indexOf('[') + 1,\n        labelExpression.indexOf(']') - 1\n      );\n      const symbol = labelingInfo[i].symbol;\n      const maxScale = labelingInfo[i].maxScale;\n      const minScale = labelingInfo[i].minScale;\n      let minResolution = null;\n      if (maxScale !== 0) {\n        minResolution = EsriStyleGenerator._getResolutionForScale(\n          maxScale,\n          mapUnits\n        );\n      }\n      let maxResolution = null;\n      if (minScale !== 0) {\n        maxResolution = EsriStyleGenerator._getResolutionForScale(\n          minScale,\n          mapUnits\n        );\n      }\n      const style = this._converters[symbol.type].call(this, symbol);\n      styles.push(\n        (() => {\n          return function(feature, resolution) {\n            let visible = true;\n            if (this.minResolution !== null && this.maxResolution !== null) {\n              visible =\n                resolution < this.maxResolution &&\n                resolution >= this.minResolution;\n            } else if (this.minResolution !== null) {\n              visible = resolution >= this.minResolution;\n            } else if (this.maxResolution !== null) {\n              visible = resolution < this.maxResolution;\n            }\n            if (visible) {\n              const value = feature.get(this.field);\n              this.style.getText().setText(value);\n              return [this.style];\n            }\n          };\n        })().bind({\n          minResolution,\n          maxResolution,\n          field,\n          style\n        })\n      );\n    }\n    return styles;\n  }\n\n  _renderSimple(renderer) {\n    const style = this._converters[renderer.symbol.type].call(\n      this,\n      renderer.symbol\n    );\n    return (() => {\n      return () => {\n        return [style];\n      };\n    })();\n  }\n  _renderClassBreaks(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    const defaultStyle = this._converters[defaultSymbol.type].call(\n      this,\n      defaultSymbol\n    );\n    const field = renderer.field;\n    const classes = [];\n    for (let i = 0, ii = renderer.classBreakInfos.length; i < ii; ++i) {\n      const classBreakInfo = renderer.classBreakInfos[i];\n      let min;\n      if (\n        classBreakInfo.classMinValue === null ||\n        classBreakInfo.classMinValue === undefined\n      ) {\n        if (i === 0) {\n          min = renderer.minValue;\n        } else {\n          min = renderer.classBreakInfos[i - 1].classMaxValue;\n        }\n      } else {\n        min = classBreakInfo.classMinValue;\n      }\n      const max = classBreakInfo.classMaxValue;\n      const symbol = classBreakInfo.symbol;\n      const style = this._converters[symbol.type].call(this, symbol);\n      classes.push({ min, max, style });\n    }\n    return (() => {\n      return (feature) => {\n        const value = feature.get(field);\n        for (let i = 0, ii = classes.length; i < ii; ++i) {\n          let condition;\n          if (i === 0) {\n            condition = value >= classes[i].min && value <= classes[i].max;\n          } else {\n            condition = value > classes[i].min && value <= classes[i].max;\n          }\n          if (condition) {\n            return [classes[i].style];\n          }\n        }\n        return [defaultStyle];\n      };\n    })();\n  }\n  _renderUniqueValue(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    let defaultStyle = [];\n    if (defaultSymbol) {\n      defaultStyle = [\n        this._converters[defaultSymbol.type].call(this, defaultSymbol)\n      ];\n    }\n    const field = renderer.field1;\n    const infos = renderer.uniqueValueInfos;\n    const me = this;\n    return (() => {\n      const hash = {};\n      for (let i = 0, ii = infos.length; i < ii; ++i) {\n        const info = infos[i];\n        const symbol = info.symbol;\n        hash[info.value] = [me._converters[symbol.type].call(me, symbol)];\n      }\n\n      return (feature) => {\n        const style = hash[feature.get(field)];\n        return style ? style : defaultStyle;\n      };\n    })();\n  }\n  generateStyle(layerInfo, mapUnits) {\n    const drawingInfo = layerInfo.drawingInfo;\n    let styleFunctions = [];\n    const drawingInfoStyle = this._renderers[drawingInfo.renderer.type].call(\n      this,\n      drawingInfo.renderer\n    );\n    if (drawingInfoStyle !== undefined) {\n      styleFunctions.push(drawingInfoStyle);\n    }\n    if (layerInfo.labelingInfo) {\n      const labelingInfoStyleFunctions = this._convertLabelingInfo(\n        layerInfo.labelingInfo,\n        mapUnits\n      );\n      styleFunctions = styleFunctions.concat(labelingInfoStyleFunctions);\n    }\n    if (styleFunctions.length === 1) {\n      return styleFunctions[0];\n    } else {\n      return (() => {\n        return (feature, resolution) => {\n          let styles = [];\n          for (let i = 0, ii = styleFunctions.length; i < ii; ++i) {\n            const result = styleFunctions[i].call(null, feature, resolution);\n            if (result) {\n              styles = styles.concat(result);\n            }\n          }\n          return styles;\n        };\n      })();\n    }\n  }\n}\n","export enum TimeFilterType {\n    DATE = 'date',\n    TIME = 'time',\n    DATETIME = 'datetime',\n    YEAR = 'year',\n}\n\nexport enum TimeFilterStyle {\n    CALENDAR = 'calendar',\n    SLIDER = 'slider',\n}\n","import { Injectable } from '@angular/core';\n\nimport { IgoMap } from './map';\n\n/**\n * MapService\n *\n * This service tracks the IgoMap instance, if any.\n * Currently, only one map instance is supported\n * but support for multiple maps may be added in the future.\n * This will impact other services such as the OverlayService\n * because these maps won't be sharing overlayed features.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapService {\n  private map: IgoMap;\n\n  constructor() {}\n\n  getMap(): IgoMap {\n    return this.map;\n  }\n\n  setMap(map: IgoMap) {\n    this.map = map;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport {\n  HttpClient,\n  HttpParams\n} from '@angular/common/http';\nimport { Observable, forkJoin, of } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { WMSCapabilities, WMTSCapabilities, EsriJSON } from 'ol/format';\nimport { optionsFromCapabilities } from 'ol/source/WMTS.js';\nimport olAttribution from 'ol/control/Attribution';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { MapService } from '../../map/shared/map.service';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\nimport { EsriStyleGenerator } from '../utils/esri-style-generator';\nimport {\n  QueryFormat,\n  QueryFormatMimeType\n} from '../../query/shared/query.enums';\n\nimport {\n  WMTSDataSourceOptions,\n  WMSDataSourceOptions,\n  CartoDataSourceOptions,\n  ArcGISRestDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions\n} from './datasources';\nimport {\n  LegendOptions,\n  ItemStyleOptions\n} from '../../layer/shared/layers/layer.interface';\nimport {\n  TimeFilterType,\n  TimeFilterStyle\n} from '../../filter/shared/time-filter.enum';\nimport * as olproj from 'ol/proj';\n\nexport enum TypeCapabilities {\n  wms = 'wms',\n  wmts = 'wmts',\n  arcgisrest = 'esriJSON',\n  imagearcgisrest = 'esriJSON',\n  tilearcgisrest = 'esriJSON'\n}\n\nexport type TypeCapabilitiesStrings = keyof typeof TypeCapabilities;\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CapabilitiesService {\n  private parsers = {\n    wms: new WMSCapabilities(),\n    wmts: new WMTSCapabilities(),\n    esriJSON: new EsriJSON()\n  };\n\n  constructor(private http: HttpClient, private mapService: MapService) {}\n\n  getWMSOptions(\n    baseOptions: WMSDataSourceOptions\n  ): Observable<WMSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = (baseOptions.params as any).VERSION;\n\n    return this.getCapabilities('wms', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n  }\n\n  getWMTSOptions(\n    baseOptions: WMTSDataSourceOptions\n  ): Observable<WMTSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = baseOptions.version;\n\n    const options = this.getCapabilities('wmts', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMTSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n    return options;\n  }\n\n  getCartoOptions(\n    baseOptions: CartoDataSourceOptions\n  ): Observable<CartoDataSourceOptions> {\n    const baseUrl =\n      'https://' +\n      baseOptions.account +\n      '.carto.com/api/v2/viz/' +\n      baseOptions.mapId +\n      '/viz.json';\n\n    return this.http\n      .jsonp(baseUrl, 'callback')\n      .pipe(\n        map((cartoOptions: any) =>\n          this.parseCartoOptions(baseOptions, cartoOptions)\n        )\n      );\n  }\n\n  getArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const modifiedUrl = baseOptions.url.replace('FeatureServer', 'MapServer');\n    const legendUrl = modifiedUrl + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities('arcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    const legend = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Feature Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseArcgisOptions(baseOptions, res[0], res[1], res[2]);\n      })\n    );\n  }\n\n  getImageArcgisOptions(\n    baseOptions: ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const modifiedUrl = baseOptions.url.replace('FeatureServer', 'MapServer');\n    const legendUrl = modifiedUrl + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities('imagearcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    const legend = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Image Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2]);\n      })\n    );\n  }\n\n  getTileArcgisOptions(\n    baseOptions: TileArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const legendUrl = baseOptions.url + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities('tilearcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    const legendInfo = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Tile Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legendInfo, serviceCapabilities]).pipe(\n      map((res: any) =>\n        this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2])\n      )\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getCapabilities(\n    service: TypeCapabilitiesStrings,\n    baseUrl: string,\n    version?: string\n  ): Observable<any> {\n    const params = new HttpParams({\n      fromObject: {\n        request: 'GetCapabilities',\n        service: service.toUpperCase(),\n        version: version || '1.3.0',\n        _i: 'true'\n      }\n    });\n\n    let request;\n    if (TypeCapabilities[service] === 'esriJSON') {\n      request = this.http.get(baseUrl + '?f=json');\n    } else {\n      request = this.http.get(baseUrl, {\n        params,\n        responseType: 'text'\n      });\n    }\n\n    return request.pipe(\n      map((res) => {\n        if (TypeCapabilities[service] === 'esriJSON') {\n          return res as object;\n        }\n        if (\n          String(res).toLowerCase().includes('serviceexception') &&\n          String(res).toLowerCase().includes('access denied')\n        ) {\n          throw {\n            error: {\n              message: 'Service error getCapabilities: Access is denied'\n            }\n          };\n        } else {\n          return this.parsers[service].read(res);\n        }\n      }),\n      catchError((e) => {\n        if (typeof e.error !== 'undefined') {\n          e.error.caught = true;\n        }\n        throw e;\n      })\n    );\n  }\n\n  private parseWMSOptions(\n    baseOptions: WMSDataSourceOptions,\n    capabilities: any\n  ): WMSDataSourceOptions {\n    const layers = (baseOptions.params as any).LAYERS;\n    const layer = this.findDataSourceInCapabilities(\n      capabilities.Capability.Layer,\n      layers\n    );\n\n    if (!layer) {\n      throw {\n        error: {\n          message: 'Layer not found'\n        }\n      };\n    }\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\n    const abstract = layer.Abstract ? layer.Abstract : undefined;\n    const keywordList = layer.KeywordList ? layer.KeywordList : undefined;\n    let queryable = layer.queryable;\n    const timeFilter = this.getTimeFilter(layer);\n    const timeFilterable = timeFilter && Object.keys(timeFilter).length > 0;\n    const legendOptions = layer.Style ? this.getStyle(layer.Style) : undefined;\n    let isExtentInGeographic = true;\n    if (layer.EX_GeographicBoundingBox) {\n      layer.EX_GeographicBoundingBox.forEach((coord, index) => {\n        if (index < 2 && (coord > 180 || coord < -180)) {\n          isExtentInGeographic = false;\n        }\n        if (index >= 2 && (coord > 90 || coord < -90)) {\n          isExtentInGeographic = false;\n        }\n      });\n    } else {\n      isExtentInGeographic = false;\n    }\n\n    const extent = isExtentInGeographic ?\n        olproj.transformExtent(layer.EX_GeographicBoundingBox, 'EPSG:4326', this.mapService.getMap().projection) :\n        undefined;\n\n    let queryFormat: QueryFormat;\n    const queryFormatMimeTypePriority = [\n      QueryFormatMimeType.GEOJSON,\n      QueryFormatMimeType.GEOJSON2,\n      QueryFormatMimeType.GML3,\n      QueryFormatMimeType.GML2,\n      QueryFormatMimeType.JSON,\n      QueryFormatMimeType.HTML\n    ];\n\n    for (const mimeType of queryFormatMimeTypePriority) {\n      if (\n        capabilities.Capability.Request.GetFeatureInfo.Format.indexOf(\n          mimeType\n        ) !== -1\n      ) {\n        const keyEnum = Object.keys(QueryFormatMimeType).find(\n          (key) => QueryFormatMimeType[key] === mimeType\n        );\n        queryFormat = QueryFormat[keyEnum];\n        break;\n      }\n    }\n    if (!queryFormat) {\n      queryable = false;\n    }\n\n    const options: WMSDataSourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title,\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        extent,\n        metadata: {\n          url: metadata ? metadata.OnlineResource : undefined,\n          extern: metadata ? true : undefined,\n          abstract,\n          keywordList\n        },\n        legendOptions\n      },\n      queryable,\n      queryFormat,\n      timeFilter: timeFilterable ? timeFilter : undefined,\n      timeFilterable: timeFilterable ? true : undefined,\n      minDate: timeFilterable ? timeFilter.min : undefined,\n      maxDate: timeFilterable ? timeFilter.max : undefined,\n      stepDate: timeFilterable ? timeFilter.step : undefined\n    });\n\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseWMTSOptions(\n    baseOptions: WMTSDataSourceOptions,\n    capabilities: any\n  ): WMTSDataSourceOptions {\n    // Put Title source in _layerOptionsFromSource. (For source & catalog in _layerOptionsFromSource, if not already on config)\n    const layer = capabilities.Contents.Layer.find(\n      (el) => el.Identifier === baseOptions.layer\n    );\n\n    const options = optionsFromCapabilities(capabilities, baseOptions);\n\n    const ouputOptions = Object.assign(options, baseOptions);\n    const sourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title\n      }\n    });\n\n    return ObjectUtils.mergeDeep(sourceOptions, ouputOptions);\n  }\n\n  private parseCartoOptions(\n    baseOptions: CartoDataSourceOptions,\n    cartoOptions: any\n  ): CartoDataSourceOptions {\n    const layers = [];\n    const params = cartoOptions.layers[1].options.layer_definition;\n    params.layers.forEach((element) => {\n      layers.push({\n        type: element.type.toLowerCase(),\n        options: element.options,\n        legend: element.legend\n      });\n    });\n    const options = ObjectUtils.removeUndefined({\n      config: {\n        version: params.version,\n        layers\n      }\n    });\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions,\n    arcgisOptions: any,\n    serviceCapabilities: any,\n    legend?: any\n  ): ArcGISRestDataSourceOptions {\n    const title = arcgisOptions.name;\n    const legendInfo = legend.layers ? legend : undefined;\n    const styleGenerator = new EsriStyleGenerator();\n    const units = arcgisOptions.units === 'esriMeters' ? 'm' : 'degrees';\n    const style = styleGenerator.generateStyle(arcgisOptions, units);\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        legendInfo,\n        style,\n        timeFilter,\n        timeExtent,\n        attributions\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract: arcgisOptions.description || serviceCapabilities.serviceDescription\n        },\n      },\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseTileOrImageArcgisOptions(\n    baseOptions: TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions,\n    arcgisOptions: any,\n    legend: any,\n    serviceCapabilities: any\n  ): TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions {\n    const title = arcgisOptions.name;\n    const legendInfo = legend.layers ? legend : undefined;\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract: arcgisOptions.description || serviceCapabilities.serviceDescription\n        },\n      },\n      legendInfo,\n      timeFilter,\n      attributions,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private findDataSourceInCapabilities(layerArray, name): any {\n    if (Array.isArray(layerArray)) {\n      let layer;\n      layerArray.find((value) => {\n        layer = this.findDataSourceInCapabilities(value, name);\n        return layer !== undefined;\n      }, this);\n\n      return layer;\n    } else if (layerArray.Layer) {\n      return this.findDataSourceInCapabilities(layerArray.Layer, name);\n    } else {\n      if (layerArray.Name && layerArray.Name === name) {\n        return layerArray;\n      }\n      return undefined;\n    }\n  }\n\n  getTimeFilter(layer) {\n    let dimension;\n\n    if (layer.Dimension) {\n      const timeFilter: any = {};\n      dimension = layer.Dimension[0];\n\n      if (dimension.values) {\n        const minMaxDim = dimension.values.split('/');\n        timeFilter.min = minMaxDim[0] !== undefined ? minMaxDim[0] : undefined;\n        timeFilter.max = minMaxDim[1] !== undefined ? minMaxDim[1] : undefined;\n        timeFilter.step = minMaxDim[2] !== undefined ? minMaxDim[2] : undefined;\n      }\n\n      if (dimension.default) {\n        timeFilter.value = dimension.default;\n      }\n      return timeFilter;\n    }\n  }\n\n  getStyle(Style): LegendOptions {\n    const styleOptions: ItemStyleOptions[] = Style.map((style) => {\n      return {\n        name: style.Name,\n        title: style.Title\n      };\n    })\n      // Handle repeat the style \"default\" in output  (MapServer or OpenLayer)\n      .filter(\n        (item, index, self) =>\n          self.findIndex((i: ItemStyleOptions) => i.name === item.name) ===\n          index\n      );\n\n    const legendOptions: LegendOptions = {\n      stylesAvailable: styleOptions\n    } as LegendOptions;\n\n    return legendOptions;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport proj4 from 'proj4';\nimport * as olproj from 'ol/proj';\nimport * as olproj4 from 'ol/proj/proj4';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { Projection } from './projection.interfaces';\n\n/**\n * When injected, this service automatically registers and\n * projection defined in the application config. A custom projection\n * needs to be registered to be usable by OL.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ProjectionService {\n\n  constructor(private config: ConfigService) {\n    const projections = this.config.getConfig('projections') || [];\n    projections.forEach((projection: Projection) => {\n      projection.alias = projection.alias ? projection.alias : projection.code;\n      this.registerProjection(projection);\n    });\n\n    // register all utm zones\n    for (let utmZone = 1; utmZone < 61; utmZone++) {\n      const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n      const def = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;\n      const proj: Projection = { code, def, extent : undefined};\n      this.registerProjection(proj);\n    }\n\n    // register all mtm zones\n    for (let mtmZone = 1; mtmZone < 11; mtmZone++) {\n      const code = mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n      let lon0;\n      if (Number(mtmZone) <= 2) {\n        lon0 = -50 - Number(mtmZone) * 3;\n      } else if (Number(mtmZone) >= 12) {\n        lon0 = -81 - (Number(mtmZone) - 12) * 3;\n      } else {\n        lon0 = -49.5 - Number(mtmZone) * 3;\n      }\n      const def = `+proj=tmerc +lat_0=0 +lon_0=${lon0} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"`;\n      const proj: Projection = { code, def, extent : undefined};\n      this.registerProjection(proj);\n    }\n  }\n\n  /**\n   * Define a proj4 projection and register it in OL\n   * @param projection Projection\n   */\n  registerProjection(projection: Projection) {\n    proj4.defs(projection.code, projection.def);\n    olproj4.register(proj4);\n    if (projection.extent) {\n      olproj.get(projection.code).setExtent(projection.extent);\n    }\n  }\n\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { forkJoin, of, Observable, BehaviorSubject } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { CapabilitiesService } from './capabilities.service';\nimport { OptionsService } from './options/options.service';\nimport { WFSService } from './datasources/wfs.service';\nimport {\n  DataSource,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  XYZDataSource,\n  XYZDataSourceOptions,\n  TileDebugDataSource,\n  TileDebugDataSourceOptions,\n  WFSDataSource,\n  WFSDataSourceOptions,\n  WMTSDataSource,\n  WMTSDataSourceOptions,\n  WMSDataSource,\n  WMSDataSourceOptions,\n  CartoDataSource,\n  CartoDataSourceOptions,\n  ArcGISRestDataSource,\n  ArcGISRestDataSourceOptions,\n  ImageArcGISRestDataSource,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSource,\n  TileArcGISRestDataSourceOptions,\n  WebSocketDataSource,\n  AnyDataSourceOptions,\n  MVTDataSource,\n  MVTDataSourceOptions,\n  ClusterDataSource,\n  ClusterDataSourceOptions\n} from './datasources';\nimport { ObjectUtils } from '@igo2/utils';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { ProjectionService } from '../../map/shared/projection.service';\nimport { AuthInterceptor } from '@igo2/auth';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DataSourceService {\n  public datasources$ = new BehaviorSubject<DataSource[]>([]);\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    @Optional() private optionsService: OptionsService,\n    private wfsDataSourceService: WFSService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private projectionService: ProjectionService,\n    private authInterceptor?: AuthInterceptor\n  ) {}\n\n  createAsyncDataSource(context: AnyDataSourceOptions, detailedContextUri?: string): Observable<DataSource> {\n    if (!context.type) {\n      console.error(context);\n      throw new Error('Datasource needs a type');\n    }\n    let dataSource;\n    switch (context.type.toLowerCase()) {\n      case 'osm':\n        dataSource = this.createOSMDataSource(context as OSMDataSourceOptions);\n        break;\n      case 'vector':\n        dataSource = this.createFeatureDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'wfs':\n        dataSource = this.createWFSDataSource(context as WFSDataSourceOptions);\n        break;\n      case 'wms':\n        const wmsContext = context as WMSDataSourceOptions;\n        ObjectUtils.removeDuplicateCaseInsensitive(wmsContext.params);\n        dataSource = this.createWMSDataSource(wmsContext, detailedContextUri);\n        break;\n      case 'wmts':\n        dataSource = this.createWMTSDataSource(\n          context as WMTSDataSourceOptions\n        );\n        break;\n      case 'xyz':\n        dataSource = this.createXYZDataSource(context as XYZDataSourceOptions);\n        break;\n      case 'tiledebug':\n        dataSource = this.createTileDebugDataSource(context as TileDebugDataSource);\n        break;\n      case 'carto':\n        dataSource = this.createCartoDataSource(\n          context as CartoDataSourceOptions\n        );\n        break;\n      case 'arcgisrest':\n        dataSource = this.createArcGISRestDataSource(\n          context as ArcGISRestDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'imagearcgisrest':\n        dataSource = this.createArcGISRestImageDataSource(\n          context as ArcGISRestImageDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'websocket':\n        dataSource = this.createWebSocketDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'mvt':\n        dataSource = this.createMVTDataSource(context as MVTDataSourceOptions);\n        break;\n      case 'tilearcgisrest':\n        dataSource = this.createTileArcGISRestDataSource(\n          context as TileArcGISRestDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'cluster':\n        dataSource = this.createClusterDataSource(\n          context as ClusterDataSourceOptions\n        );\n        break;\n      default:\n        console.error(context);\n        throw new Error('Invalid datasource type');\n    }\n\n    this.datasources$.next(this.datasources$.value.concat([dataSource]));\n\n    return dataSource;\n  }\n\n  private createOSMDataSource(\n    context: OSMDataSourceOptions\n  ): Observable<OSMDataSource> {\n    return new Observable(d => d.next(new OSMDataSource(context)));\n  }\n\n  private createFeatureDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<FeatureDataSource> {\n    return new Observable(d => d.next(new FeatureDataSource(context)));\n  }\n\n  private createWebSocketDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<WebSocketDataSource> {\n    return new Observable(d => d.next(new WebSocketDataSource(context)));\n  }\n\n  private createWFSDataSource(\n    context: WFSDataSourceOptions\n  ): Observable<WFSDataSource> {\n    return new Observable(d =>\n      d.next(new WFSDataSource(context, this.wfsDataSourceService, this.authInterceptor))\n    );\n  }\n\n  private createWMSDataSource(context: WMSDataSourceOptions, detailedContextUri?: string): Observable<any> {\n    const observables = [];\n    if (context.optionsFromCapabilities) {\n      observables.push(\n        this.capabilitiesService.getWMSOptions(context).pipe(\n          catchError(e => {\n            const title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            const message = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailable',\n              { value: context.params.LAYERS }\n            );\n\n            this.messageService.error(message, title);\n            throw e;\n          })\n        )\n      );\n    }\n\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getWMSOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n\n    observables.push(of(context));\n\n    return forkJoin(observables).pipe(\n      map((options: WMSDataSourceOptions[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new WMSDataSource(optionsMerged, this.wfsDataSourceService);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createWMTSDataSource(\n    context: WMTSDataSourceOptions\n  ): Observable<WMTSDataSource> {\n    if (context.optionsFromCapabilities) {\n      return this.capabilitiesService.getWMTSOptions(context).pipe(\n        map((options: WMTSDataSourceOptions) => {\n          return options ? new WMTSDataSource(options) : undefined;\n        }),\n        catchError(() => {\n          const title = this.languageService.translate.instant(\n            'igo.geo.dataSource.unavailableTitle'\n          );\n          const message = this.languageService.translate.instant(\n            'igo.geo.dataSource.unavailable',\n            { value: context.layer }\n          );\n\n          this.messageService.error(message, title);\n          return of(undefined);\n        })\n      );\n    }\n\n    return new Observable(d => d.next(new WMTSDataSource(context)));\n  }\n\n  private createXYZDataSource(\n    context: XYZDataSourceOptions\n  ): Observable<XYZDataSource> {\n    return new Observable(d => d.next(new XYZDataSource(context)));\n  }\n\n  private createTileDebugDataSource(\n    context: TileDebugDataSourceOptions\n  ): Observable<TileDebugDataSource> {\n    return new Observable(d => d.next(new TileDebugDataSource(context)));\n  }\n\n  private createCartoDataSource(\n    context: CartoDataSourceOptions\n  ): Observable<CartoDataSource> {\n    if (context.mapId) {\n      return this.capabilitiesService\n        .getCartoOptions(context)\n        .pipe(\n          map((options: CartoDataSourceOptions) => new CartoDataSource(options))\n        );\n    }\n    return new Observable(d => d.next(new CartoDataSource(context)));\n  }\n\n  private createArcGISRestDataSource(\n    context: ArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestDataSource> {\n    const observables = [];\n    observables.push(this.capabilitiesService.getArcgisOptions(context).pipe(\n      catchError(e => {\n        const title = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        );\n        const message = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailable',\n          { value: context.layer }\n        );\n\n        this.messageService.error(message, title);\n        throw e;\n      })\n    ));\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createArcGISRestImageDataSource(\n    context: ArcGISRestImageDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestImageDataSourceOptions> {\n    const observables = [];\n\n    observables.push(this.capabilitiesService.getImageArcgisOptions(context).pipe(\n      catchError(e => {\n        const title = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        );\n        const message = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailable',\n          { value: context.params.LAYERS }\n        );\n\n        this.messageService.error(message, title);\n        throw e;\n      })\n    ));\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ImageArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ImageArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createTileArcGISRestDataSource(\n    context: TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<TileArcGISRestDataSource> {\n    const observables = [];\n    observables.push(this.capabilitiesService.getImageArcgisOptions(context).pipe(\n      catchError(e => {\n        const title = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        );\n        const message = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailable',\n          { value: context.params.LAYERS }\n        );\n\n        this.messageService.error(message, title);\n        throw e;\n      })\n    ));\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: TileArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new TileArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createMVTDataSource(\n    context: MVTDataSourceOptions\n  ): Observable<MVTDataSource> {\n    return new Observable(d => d.next(new MVTDataSource(context)));\n  }\n\n  private createClusterDataSource(\n    context: ClusterDataSourceOptions\n  ): Observable<ClusterDataSource> {\n    return new Observable(d => d.next(new ClusterDataSource(context)));\n  }\n}\n","import * as olextent from 'ol/extent';\nimport * as olproj from 'ol/proj';\nimport * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport OlGeometryLayout from 'ol/geom/GeometryLayout';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\nimport OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { uuid } from '@igo2/utils';\n\nimport {\n  EntityKey,\n  getEntityId,\n  getEntityTitle,\n  getEntityRevision,\n  getEntityIcon,\n  getEntityProperty\n} from '@igo2/common';\n\nimport { IgoMap } from '../../map';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource';\nimport { FEATURE, FeatureMotion } from './feature.enums';\nimport { Feature, FeatureGeometry } from './feature.interfaces';\nimport { FeatureStore } from './store';\n\n/**\n * Create an Openlayers feature object out of a feature definition.\n * The output object has a reference to the feature id.\n * @param feature Feature definition\n * @param projectionOut Feature object projection\n * @returns OpenLayers feature object\n */\nexport function featureToOl(\n  feature: Feature,\n  projectionOut: string,\n  getId?: (Feature) => EntityKey\n): OlFeature<OlGeometry> {\n  getId = getId ? getId : getEntityId;\n\n  const olFormat = new OlFormatGeoJSON();\n  const olFeature = olFormat.readFeature(feature, {\n    dataProjection: feature.projection,\n    featureProjection: projectionOut\n  });\n\n  olFeature.setId(getId(feature));\n\n  const title = getEntityTitle(feature);\n  if (title !== undefined) {\n    olFeature.set('_title', title, true);\n  }\n\n  if (feature.extent !== undefined) {\n    olFeature.set('_extent', feature.extent, true);\n  }\n\n  if (feature.projection !== undefined) {\n    olFeature.set('_projection', feature.projection, true);\n  }\n\n  const mapTitle = getEntityProperty(feature, 'meta.mapTitle');\n  if (mapTitle !== undefined) {\n    olFeature.set('_mapTitle', mapTitle, true);\n  }\n\n  olFeature.set('_entityRevision', getEntityRevision(feature), true);\n\n  const icon = getEntityIcon(feature);\n  if (icon !== undefined) {\n    olFeature.set('_icon', icon, true);\n  }\n\n  if (feature.meta && feature.meta.style) {\n    olFeature.set('_style', feature.meta.style, true);\n  }\n\n  if (feature.sourceId) {\n    olFeature.set('_sourceId', feature.sourceId, true);\n  }\n\n  return olFeature;\n}\n\nexport function renderFeatureFromOl(\n  olRenderFeature: OlRenderFeature,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let geom;\n  let title;\n  let exclude;\n  let excludeOffline;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    if (olLayer.get('sourceOptions')) {\n      exclude = olLayer.get('sourceOptions').excludeAttribute;\n      excludeOffline = olLayer.get('sourceOptions').excludeAttributeOffline;\n    }\n  } else {\n    title = olRenderFeature.get('_title');\n  }\n\n  const olFormat = new OlFormatGeoJSON();\n  const properties = olRenderFeature.getProperties();\n  const geometryType = olRenderFeature.getType();\n\n  if (geometryType === 'Polygon') {\n    const ends = olRenderFeature.getEnds() as number[];\n    geom = new OlPolygon(\n      olRenderFeature.getFlatCoordinates(),\n      OlGeometryLayout.XY,\n      ends\n    );\n  } else if (geometryType === 'Point') {\n    geom = new OlPoint(olRenderFeature.getFlatCoordinates(), OlGeometryLayout.XY);\n  } else if (geometryType === 'LineString') {\n    geom = new OlLineString(\n      olRenderFeature.getFlatCoordinates(),\n      OlGeometryLayout.XY\n    );\n  }\n\n  const geometry = olFormat.writeGeometryObject(geom, {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  const id = olRenderFeature.getId() ? olRenderFeature.getId() : uuid();\n  const mapTitle = olRenderFeature.get('_mapTitle');\n  const extent = olproj.transformExtent(olRenderFeature.getExtent(), projectionIn, projectionOut) as [number, number, number, number];\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent,\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olRenderFeature\n  };\n}\n/**\n * Create a feature object out of an OL feature\n * The output object has a reference to the feature id.\n * @param olFeature OL Feature\n * @param projectionIn OL feature projection\n * @param olLayer OL Layer\n * @param projectionOut Feature projection\n * @returns Feature\n */\nexport function featureFromOl(\n  olFeature: OlFeature<OlGeometry>,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let title;\n  let exclude;\n  let excludeOffline;\n  let idColumn; // for arcgisrest and tilearcgisrest source\n  const olFormat = new OlFormatGeoJSON();\n\n  const keys = olFeature.getKeys().filter((key: string) => {\n    return !key.startsWith('_') && key !== 'geometry';\n  });\n  const properties = keys.reduce((acc: object, key: string) => {\n    acc[key] = olFeature.get(key);\n    return acc;\n  }, {});\n\n  const geometry = olFormat.writeGeometryObject(olFeature.getGeometry(), {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    const sourceOptions = olLayer.get('sourceOptions');\n    if (sourceOptions) {\n      exclude = sourceOptions.excludeAttribute;\n      excludeOffline = sourceOptions.excludeAttributeOffline;\n      idColumn =\n        sourceOptions.idColumn ||\n        ((sourceOptions.type === 'arcgisrest' || sourceOptions.type === 'tilearcgisrest') ? 'OBJECTID' : undefined );\n    }\n  } else {\n    title = olFeature.get('_title');\n  }\n  const mapTitle = olFeature.get('_mapTitle');\n  const id = olFeature.getId() ? olFeature.getId() : olFeature.get(idColumn) ? olFeature.get(idColumn) : uuid();\n\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent: olFeature.get('_extent'),\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      revision: olFeature.getRevision(),\n      style: olFeature.get('_style'),\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olFeature\n  };\n}\n\n/**\n * Compute an OL feature extent in it's map projection\n * @param map Map\n * @param olFeature OL feature\n * @returns Extent in the map projection\n */\nexport function computeOlFeatureExtent(\n  map: IgoMap,\n  olFeature: OlFeature<OlGeometry>\n): [number, number, number, number] {\n  let olExtent = olextent.createEmpty();\n\n  const olFeatureExtent = olFeature.get('_extent');\n  const olFeatureProjection = olFeature.get('_projection');\n  if (olFeatureExtent !== undefined && olFeatureProjection !== undefined) {\n    olExtent = olproj.transformExtent(\n      olFeatureExtent,\n      olFeatureProjection,\n      map.projection\n    );\n  } else {\n    const olGeometry = olFeature.getGeometry();\n    if (olGeometry !== null) {\n      olExtent = olGeometry.getExtent();\n    }\n  }\n\n  return olExtent as [number, number, number, number];\n}\n\n/**\n * Compute a multiple OL features extent in their map projection\n * @param map Map\n * @param olFeatures OL features\n * @returns Extent in the map projection\n */\nexport function computeOlFeaturesExtent(\n  map: IgoMap,\n  olFeatures: OlFeature<OlGeometry>[]\n): [number, number, number, number] {\n  const extent = olextent.createEmpty();\n\n  olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const featureExtent = computeOlFeatureExtent(map, olFeature);\n    olextent.extend(extent, featureExtent);\n  });\n\n  return extent as [number, number, number, number];\n}\n\n/**\n * Scale an extent.\n * @param extent Extent\n * @param Scaling factors for top, right, bottom and left directions, in that order\n * @returns Scaled extent\n */\nexport function scaleExtent(\n  extent: [number, number, number, number],\n  scale: [number, number, number, number]\n): [number, number, number, number] {\n  const [width, height] = olextent.getSize(extent);\n  return [\n    scale[3] ? extent[0] - width * scale[3] : extent[0],\n    scale[2] ? extent[1] - height * scale[2] : extent[1],\n    scale[1] ? extent[2] + width * scale[1] : extent[2],\n    scale[0] ? extent[3] + height * scale[0] : extent[3]\n  ];\n}\n\n/**\n * Return true if features are out of view.\n * If features are too close to the edge, they are considered out of view.\n * We define the edge as 5% of the extent size.\n * @param map Map\n * @param featuresExtent The features's extent\n * @returns Return true if features are out of view\n */\nexport function featuresAreOutOfView(\n  map: IgoMap,\n  featuresExtent: [number, number, number, number]\n) {\n  const mapExtent = map.viewController.getExtent();\n  const edgeRatio = 0.05;\n  const scale = [-1, -1, -1, -1].map(x => x * edgeRatio);\n  const viewExtent = scaleExtent(mapExtent, scale as [\n    number,\n    number,\n    number,\n    number\n  ]);\n\n  return !olextent.containsExtent(viewExtent, featuresExtent);\n}\n\n/**\n * Return true if features are too deep into the view. This results\n * in features being too small.\n * Features are considered too small if their extent occupies less than\n * 1% of the map extent.\n * @param map Map\n * @param featuresExtent The features's extent\n * @param areaRatio The features extent to view extent acceptable ratio\n * @returns Return true if features are too deep in the view\n */\nexport function featuresAreTooDeepInView(\n  map: IgoMap,\n  featuresExtent: [number, number, number, number],\n  areaRatio?: number\n) {\n  // An area ratio of 0.004 means that the feature extent's width and height\n  // should be about 1/16 of the map extent's width and height\n  areaRatio = areaRatio ? areaRatio : 0.004;\n  const mapExtent = map.viewController.getExtent();\n  const mapExtentArea = olextent.getArea(mapExtent);\n  const featuresExtentArea = olextent.getArea(featuresExtent);\n\n  if (featuresExtentArea === 0 && map.viewController.getZoom() > 13) {\n    // In case it's a point\n    return false;\n  }\n\n  return featuresExtentArea / mapExtentArea < areaRatio;\n}\n\n/**\n * Fit view to include the features extent.\n * By default, this method will let the features occupy about 50% of the viewport.\n * @param map Map\n * @param olFeatures OL features\n * @param motion To motion to the new map view\n * @param scale If this is defined, the original view will be scaled\n *  by that factor before any logic is applied.\n */\nexport function moveToOlFeatures(\n  map: IgoMap,\n  olFeatures: OlFeature<OlGeometry>[],\n  motion: FeatureMotion = FeatureMotion.Default,\n  scale?: [number, number, number, number],\n  areaRatio?: number\n) {\n  const featuresExtent = computeOlFeaturesExtent(map, olFeatures);\n  let viewExtent = featuresExtent;\n  if (scale !== undefined) {\n    viewExtent = scaleExtent(viewExtent, scale);\n  }\n\n  if (motion === FeatureMotion.Zoom) {\n    map.viewController.zoomToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Move) {\n    map.viewController.moveToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Default) {\n    if (\n      featuresAreOutOfView(map, featuresExtent) ||\n      featuresAreTooDeepInView(map, featuresExtent, areaRatio)\n    ) {\n      map.viewController.zoomToExtent(viewExtent);\n    }\n  }\n}\n\n/**\n * Hide an OL feature\n * @param olFeature OL feature\n */\nexport function hideOlFeature(olFeature: OlFeature<OlGeometry>) {\n  olFeature.setStyle(new olstyle.Style({}));\n}\n\n/**\n * Try to bind a layer to a store if none is bound already.\n * The layer will also be added to the store's map.\n * If no layer is given to that function, a basic one will be created.\n * @param store The store to bind the layer\n * @param layer An optional VectorLayer\n */\nexport function tryBindStoreLayer(store: FeatureStore, layer?: VectorLayer) {\n  if (store.layer !== undefined) {\n    if (store.layer.map === undefined) {\n      store.map.addLayer(store.layer);\n    }\n    return;\n  }\n\n  layer = layer\n    ? layer\n    : new VectorLayer({\n        source: new FeatureDataSource()\n      });\n  store.bindLayer(layer);\n  if (store.layer.map === undefined) {\n    store.map.addLayer(store.layer);\n  }\n}\n\n/**\n * Compute a diff between a source array of Ol features and a target array\n * @param source Source array of OL features\n * @param starget Target array of OL features\n * @returns Features to add and remove\n */\nexport function computeOlFeaturesDiff(\n  source: OlFeature<OlGeometry>[],\n  target: OlFeature<OlGeometry>[]\n): {\n  add: OlFeature<OlGeometry>[];\n  remove: OlFeature<OlGeometry>[];\n} {\n  const olFeaturesMap = new Map();\n  target.forEach((olFeature: OlFeature<OlGeometry>) => {\n    olFeaturesMap.set(olFeature.getId(), olFeature);\n  });\n\n  const olFeaturesToRemove = [];\n  source.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const newOlFeature = olFeaturesMap.get(olFeature.getId());\n    if (newOlFeature === undefined) {\n      olFeaturesToRemove.push(olFeature);\n    } else if (\n      newOlFeature.get('_entityRevision') !== olFeature.get('_entityRevision')\n    ) {\n      olFeaturesToRemove.push(olFeature);\n    } else {\n      olFeaturesMap.delete(newOlFeature.getId());\n    }\n  });\n\n  const olFeaturesToAddIds = Array.from(olFeaturesMap.keys());\n  const olFeaturesToAdd = target.filter((olFeature: OlFeature<OlGeometry>) => {\n    return olFeaturesToAddIds.indexOf(olFeature.getId()) >= 0;\n  });\n\n  return {\n    add: olFeaturesToAdd,\n    remove: olFeaturesToRemove\n  };\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  getEntityId,\n  EntityKey,\n  EntityStore\n} from '@igo2/common';\n\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nimport { FeatureMotion } from './feature.enums';\nimport { Feature, FeatureStoreOptions } from './feature.interfaces';\nimport { computeOlFeaturesDiff, featureFromOl, featureToOl, moveToOlFeatures } from './feature.utils';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * features and the map layer to display them on. Synchronization\n * between the store and the layer is handled by strategies.\n */\nexport class FeatureStore<T extends Feature = Feature> extends EntityStore<T> {\n\n  /**\n   * Vector layer to display the features on\n   */\n  layer: VectorLayer;\n\n  /**\n   * The map the layer is bound to\n   */\n  readonly map: IgoMap;\n\n  /**\n   * The layer's data source\n   */\n  get source(): FeatureDataSource {\n    return this.layer ? this.layer.dataSource as FeatureDataSource : undefined;\n  }\n\n  constructor(entities: T[], options: FeatureStoreOptions) {\n    super(entities, options);\n    this.map = options.map;\n  }\n\n  /**\n   * Bind this store to a vector layer\n   * @param layer Vector layer\n   * @returns Feature store\n   */\n  bindLayer(layer: VectorLayer): FeatureStore {\n    this.layer = layer;\n    return this;\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible. Strategies\n   * make extensive use of that method.\n   * @param features Features\n   * @param motion Optional: The type of motion to perform\n   */\n  setLayerFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number,\n    getId?: (Feature) => EntityKey\n  ) {\n    getId = getId ? getId : getEntityId;\n    this.checkLayer();\n\n    const olFeatures = features\n      .map((feature: Feature) => featureToOl(feature, this.map.projection, getId));\n    this.setLayerOlFeatures(olFeatures, motion, viewScale, areaRatio);\n  }\n\n  /**\n   * Set the store's features from an array of OL features.\n   * @param olFeatures Ol features\n   */\n  setStoreOlFeatures(olFeatures: OlFeature<OlGeometry>[]) {\n    this.checkLayer();\n\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n      return featureFromOl(olFeature, this.layer.map.projection);\n    });\n    this.load(features as T[]);\n  }\n\n  /**\n   * Remove all features from the layer\n   */\n  clearLayer() {\n    this.checkLayer();\n    this.source.ol.clear();\n  }\n\n  /**\n   * Check wether a layer is bound or not and throw an error if not.\n   */\n  private checkLayer() {\n    if (this.layer === undefined) {\n      throw new Error('This FeatureStore is not bound to a layer.');\n    }\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible.\n   * @param features Openlayers feature objects\n   * @param motion Optional: The type of motion to perform\n   */\n  public setLayerOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number\n  ) {\n    const olSource = this.layer.ol.getSource();\n    const diff = computeOlFeaturesDiff(olSource.getFeatures(), olFeatures);\n    if (diff.remove.length > 0) {\n      this.removeOlFeaturesFromLayer(diff.remove);\n    }\n\n    if (diff.add.length > 0) {\n      this.addOlFeaturesToLayer(diff.add);\n    }\n\n    if (diff.add.length > 0) {\n      // If features are added, do a motion toward the newly added features\n      moveToOlFeatures(this.map, diff.add, motion, viewScale, areaRatio);\n    } else if (diff.remove.length > 0) {\n      // Else, do a motion toward all the features\n      moveToOlFeatures(this.map, olFeatures, motion, viewScale, areaRatio);\n    }\n  }\n\n  /**\n   * Add features to the the layer\n   * @param features Openlayers feature objects\n   */\n  private addOlFeaturesToLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n    });\n    this.source.ol.addFeatures(olFeatures);\n  }\n\n  /**\n   * Remove features from the the layer\n   * @param features Openlayers feature objects\n   */\n  private removeOlFeaturesFromLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      this.source.ol.removeFeature(olFeature);\n    });\n  }\n\n}\n","import * as olextent from 'ol/extent';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreInMapExtentStrategyOptions, Feature } from '../feature.interfaces';\nimport { Subscription } from 'rxjs';\nimport { skipWhile } from 'rxjs/operators';\n\n/**\n * This strategy maintain the store features updated while the map is moved.\n * The features's state inside the map are tagged inMapExtent = true;\n */\nexport class FeatureStoreInMapExtentStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private states$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapExtentStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$\n      .pipe(skipWhile((empty) => !empty))\n      .subscribe(() => this.updateEntitiesInExtent(store));\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInExtent(store);\n    this.states$$.push(store.layer.map.viewController.state$.subscribe(() => {\n      this.updateEntitiesInExtent(store);\n    }));\n  }\n\n  private updateEntitiesInExtent(store) {\n    if (store?.layer?.map?.viewController) {\n      store.state.updateAll({ inMapExtent: false });\n      const mapExtent = store.layer.map.viewController.getExtent();\n      const entitiesInMapExtent = store.entities$.value\n        .filter((entity: Feature) => olextent.intersects(entity.ol.getGeometry().getExtent(), mapExtent));\n      if (entitiesInMapExtent.length > 0) {\n        store.state.updateMany(entitiesInMapExtent, { inMapExtent: true }, true);\n      }\n    }\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.states$$.map(state => state.unsubscribe());\n    if (this.empty$$) { this.empty$$.unsubscribe(); }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreInMapResolutionStrategyOptions } from '../feature.interfaces';\nimport { Subscription } from 'rxjs';\n\n\n/**\n * This strategy maintain the store features updated while the map is scrolled.\n * The features's state inside the map's resolution are tagged inMapResolution = true;\n */\nexport class FeatureStoreInMapResolutionStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private resolution$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapResolutionStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$\n      .subscribe(() => this.updateEntitiesInResolution(store, store.layer.map.viewController.getResolution()));\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInResolution(store, store.layer.map.viewController.getResolution());\n    this.resolution$$.push(store.layer.map.viewController.resolution$.subscribe((res) => {\n      this.updateEntitiesInResolution(store, res);\n    }));\n  }\n\n  private updateEntitiesInResolution(store, mapResolution: number) {\n    if (mapResolution > store.layer.minResolution && mapResolution < store.layer.maxResolution) {\n      store.state.updateAll({ inMapResolution: true });\n    } else {\n      store.state.updateAll({ inMapResolution: false });\n    }\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.resolution$$.map(state => state.unsubscribe());\n    if (this.empty$$) { this.empty$$.unsubscribe(); }\n  }\n}\n","import { Subscription } from 'rxjs';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureMotion } from '../feature.enums';\nimport { Feature, FeatureStoreLoadingStrategyOptions } from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy loads a store's features into it's layer counterpart.\n * The store -> layer binding is a one-way binding. That means any entity\n * added to the store will be added to the layer but the opposite is false.\n *\n * Important: This strategy observes filtered entities, not raw entities. This\n * is not configurable yet.\n */\nexport class FeatureStoreLoadingStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's features\n   */\n  private stores$$ = new Map<FeatureStore, Subscription>();\n\n  private motion: FeatureMotion;\n\n  constructor(protected options: FeatureStoreLoadingStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for entities changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for entities changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Define the motion to apply on load\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for entities changes in a store.\n   * Important: Never observe a store's sorted entities. It makes no sense\n   * to display sorted entities (instead of unsorted) on a layer and it\n   * would potentially result in a lot of useless computation.\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    const subscription = store.view.all$()\n      .subscribe((features: Feature[]) => this.onFeaturesChange(features, store));\n    this.stores$$.set(store, subscription);\n  }\n\n  /**\n   * Stop watching for entities changes in a store.\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const subscription = this.stores$$.get(store);\n    if (subscription !== undefined) {\n      subscription.unsubscribe();\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for entities changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, Subscription]) => {\n      entries[1].unsubscribe();\n    });\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features into a layer or clear the layer if the array of features is empty.\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onFeaturesChange(features: Feature[], store: FeatureStore) {\n    if (features.length === 0) {\n      store.clearLayer();\n    } else {\n      store.setLayerFeatures(\n        features,\n        this.selectMotion(store),\n        this.options.viewScale,\n        this.options.areaRatio,\n        this.options.getFeatureId\n      );\n    }\n  }\n\n  /**\n   * Selects the best motion\n   * @param store A FeatureStore to apply the motion\n   * @returns The motion selected\n   */\n  private selectMotion(store: FeatureStore) {\n    if (this.motion !== undefined) { return this.motion; }\n\n    if (store.pristine === true) {\n      // If features have just been loaded into the store, move/zoom on them\n      return FeatureMotion.Default;\n    } else if (store.count > store.view.count) {\n      // If features have been filtered, move/zoom on the remaining ones\n      return FeatureMotion.Default;\n    } else {\n      // On insert, update or delete, do nothing\n      return FeatureMotion.None;\n    }\n  }\n}\n","import OlEvent from 'ol/events/Event';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreLoadingLayerStrategyOptions } from '../feature.interfaces';\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\n\n/**\n * This strategy loads a layer's features into it's store counterpart.\n * The layer -> store binding is a one-way binding. That means any OL feature\n * added to the layer will be added to the store but the opposite is false.\n *\n * Important: In it's current state, this strategy is to meant to be combined\n * with a standard Loading strategy and it would probably cause recursion issues.\n */\nexport class FeatureStoreLoadingLayerStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n\n  constructor(protected options: FeatureStoreLoadingLayerStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.onSourceChanges(store);\n    const olSource = store.layer.ol.getSource();\n    olSource.on('change', (event: OlEvent) => {\n      this.onSourceChanges(store);\n    });\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, string]) => {\n    });\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features from an OL source into a  store or clear the store if the source is empty\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onSourceChanges(store: FeatureStore) {\n    let olFeatures = store.layer.ol.getSource().getFeatures();\n\n    if (store.layer.dataSource instanceof ClusterDataSource) {\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\n        cluster.get('features')\n      );\n    }\n    if (olFeatures.length === 0) {\n      store.clear();\n    } else {\n      store.setStoreOlFeatures(olFeatures);\n    }\n  }\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlDragBoxInteraction, { DragBoxEvent } from 'ol/interaction/DragBox';\nimport { DragBoxEvent as OlDragBoxEvent } from 'ol/interaction/DragBox';\nimport { EventsKey } from 'ol/events';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\n\nimport { Subscription, combineLatest } from 'rxjs';\nimport { map, debounceTime, skip } from 'rxjs/operators';\n\nimport { EntityKey, EntityRecord, EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureDataSource } from '../../../datasource';\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../../map/shared/map';\nimport { ctrlKeyDown } from '../../../map/shared/map.utils';\n\nimport {\n  Feature,\n  FeatureStoreSelectionStrategyOptions\n} from '../feature.interfaces';\nimport { FeatureStore } from '../store';\nimport { FeatureMotion } from '../feature.enums';\n\nexport class OlDragSelectInteraction extends OlDragBoxInteraction {\n  constructor(options) {\n    super(options);\n  }\n}\n\n/**\n * This strategy synchronizes a store and a layer selected entities.\n * The store <-> layer binding is a two-way binding.\n *\n * In many cases, a single strategy bound to multiple stores\n * will yield better results that multiple strategies with each their\n * own store. In the latter scenario, a click on overlapping features\n * would trigger the strategy of each layer and they would cancel\n * each other as well as move the map view around needlessly.\n */\nexport class FeatureStoreSelectionStrategy extends EntityStoreStrategy {\n  /**\n   * Listener to the map click event that allows selecting a feature\n   * by clicking on the map\n   */\n  private mapClickListener;\n\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Subscription to all stores selected entities\n   */\n  private stores$$: Subscription;\n\n  private motion: FeatureMotion;\n\n  /**\n   * The map the layers belong to\n   */\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  /**\n   * A feature store that'll contain the selected features. It has it's own\n   * layer, shared by all the stores this staretgy is bound to.\n   */\n  get overlayStore(): FeatureStore {\n    return this._overlayStore;\n  }\n  private _overlayStore: FeatureStore;\n\n  constructor(protected options: FeatureStoreSelectionStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n    this._overlayStore = this.createOverlayStore();\n  }\n\n  /**\n   * Bind this strategy to a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Define the motion to apply on select\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Unselect all entities, from all stores\n   */\n  unselectAll() {\n    this.stores.forEach((store: FeatureStore) => {\n      store.state.updateAll({ selected: false });\n    });\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.overlayStore.source.ol.clear();\n    this.overlayStore.clear();\n  }\n\n  /**\n   * Deactivate the selection without removing the selection\n   * overlay.\n   */\n  deactivateSelection() {\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n    this.unwatchAll();\n  }\n\n  /**\n   * Add the overlay layer, setup the map click lsitener and\n   * start watching for stores selection\n   * @internal\n   */\n  protected doActivate() {\n    this.addOverlayLayer();\n    this.listenToMapClick();\n    if (this.options.dragBox === true) {\n      this.addDragBoxInteraction();\n    }\n    this.watchAll();\n  }\n\n  /**\n   * Remove the overlay layer, remove the map click lsitener and\n   * stop watching for stores selection\n   * @internal\n   */\n  protected doDeactivate() {\n    this.deactivateSelection();\n    this.removeOverlayLayer();\n  }\n\n  /**\n   * Create a single observable of all the stores. With a single observable,\n   * features can be added all at once to the overlay layer and a single\n   * motion can be performed. Multiple observable would have\n   * a cancelling effect on each other.\n   */\n  private watchAll() {\n    this.unwatchAll();\n\n    const stores$ = this.stores.map((store: FeatureStore) => {\n      return store.stateView\n        .manyBy$((record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        })\n        .pipe(\n          map((records: EntityRecord<Feature>[]) =>\n            records.map((record) => record.entity)\n          )\n        );\n    });\n    this.stores$$ = combineLatest(stores$)\n      .pipe(\n        debounceTime(5),\n        skip(1), // Skip intial selection\n        map((features: Array<Feature[]>) =>\n          features.reduce((a, b) => a.concat(b))\n        )\n      )\n      .subscribe((features: Feature[]) => this.onSelectFromStore(features));\n  }\n\n  /**\n   * Stop watching for selection in all stores.\n   */\n  private unwatchAll() {\n    if (this.stores$$ !== undefined) {\n      this.stores$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a 'singleclick' listener to the map that'll allow selecting\n   * features by clicking on the map. The selection will be performed\n   * only on the layers bound to this strategy.\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => {\n        this.onMapClick(event);\n      }\n    );\n  }\n\n  /**\n   * Remove the map click listener\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n  }\n\n  /**\n   * On map click, select feature at pixel\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onMapClick(event: MapBrowserPointerEvent<any>) {\n    const exclusive = !ctrlKeyDown(event);\n    const reverse = !exclusive;\n    const olFeatures = event.map.getFeaturesAtPixel(event.pixel, {\n      hitTolerance: this.options.hitTolerance || 0,\n      layerFilter: olLayer => {\n        const storeOlLayer = this.stores.find((store: FeatureStore) => {\n          return store.layer.ol === olLayer;\n        });\n        return storeOlLayer !== undefined;\n      }\n    }) as OlFeature<OlGeometry>[];\n    this.onSelectFromMap(olFeatures, exclusive, reverse);\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteraction;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteraction = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteraction === undefined) {\n      olDragSelectInteraction = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteraction);\n      this.olDragSelectInteraction = olDragSelectInteraction;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteraction.on(\n      'boxend',\n      (event: DragBoxEvent) => this.onDragBoxEnd(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n\n  /**\n   * On dragbox end, select features in drag box\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onDragBoxEnd(event: OlDragBoxEvent) {\n    const exclusive = !ctrlKeyDown(event.mapBrowserEvent);\n    const target = event.target as any;\n    const extent = target.getGeometry().getExtent();\n    const olFeatures = this.stores.reduce(\n      (acc: OlFeature<OlGeometry>[], store: FeatureStore) => {\n        const olSource = store.layer.ol.getSource();\n        acc.push(...olSource.getFeaturesInExtent(extent));\n        return acc;\n      },\n      []\n    );\n    this.onSelectFromMap(olFeatures, exclusive, false);\n  }\n\n  /**\n   * When features are selected from the store, add\n   * them to this startegy's overlay layer (select on map)\n   * @param features Store features\n   */\n  private onSelectFromStore(features: Feature[]) {\n    const motion = this.motion;\n    const olOverlayFeatures = this.overlayStore.layer.ol\n      .getSource()\n      .getFeatures();\n    const overlayFeaturesKeys = olOverlayFeatures.map((olFeature: OlFeature<OlGeometry>) =>\n      olFeature.getId()\n    );\n    const featuresKeys = features.map(this.overlayStore.getKey);\n\n    let doMotion;\n    if (features.length === 0) {\n      doMotion = false;\n    } else {\n      doMotion =\n        overlayFeaturesKeys.length !== featuresKeys.length ||\n        !overlayFeaturesKeys.every(\n          (key: EntityKey) => featuresKeys.indexOf(key) >= 0\n        );\n    }\n\n    this.overlayStore.setLayerFeatures(\n      features,\n      doMotion ? motion : FeatureMotion.None,\n      this.options.viewScale,\n      this.options.areaRatio,\n      this.options.getFeatureId\n    );\n  }\n\n  /**\n   * When features are selected from the map, also select them\n   * in their store.\n   * @param olFeatures OL feature objects\n   */\n  private onSelectFromMap(\n    olFeatures: OlFeature<OlGeometry>[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    const groupedFeatures = this.groupFeaturesByStore(olFeatures);\n\n    this.stores.forEach((store: FeatureStore) => {\n      const features = groupedFeatures.get(store);\n      if (features === undefined && exclusive === true) {\n        this.unselectAllFeaturesFromStore(store);\n      } else if (features === undefined && exclusive === false) {\n        // Do nothing\n      } else {\n        this.selectFeaturesFromStore(store, features, exclusive, reverse);\n      }\n    });\n  }\n\n  /**\n   * Select features in store\n   * @param store: Feature store\n   * @param features Features\n   */\n  private selectFeaturesFromStore(\n    store: FeatureStore,\n    features: Feature[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    if (reverse === true) {\n      store.state.reverseMany(features, ['selected']);\n    } else {\n      store.state.updateMany(features, { selected: true }, exclusive);\n    }\n  }\n\n  /**\n   * Unselect all features from store\n   * @param store: Feature store\n   */\n  private unselectAllFeaturesFromStore(store: FeatureStore) {\n    store.state.updateAll({ selected: false });\n  }\n\n  /**\n   * This method returns a store -> features mapping from a list\n   * of OL selected features. OL features keep a reference to the store\n   * they are from.\n   * @param olFeatures: OL feature objects\n   * @returns Store -> features mapping\n   */\n  private groupFeaturesByStore(\n    olFeatures: OlFeature<OlGeometry>[]\n  ): Map<FeatureStore, Feature[]> {\n    const groupedFeatures = new Map<FeatureStore, Feature[]>();\n    if (olFeatures === null || olFeatures === undefined) {\n      return groupedFeatures;\n    }\n\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      const store = olFeature.get('_featureStore');\n      if (store === undefined) {\n        return;\n      }\n\n      let features = groupedFeatures.get(store);\n      if (features === undefined) {\n        features = [];\n        groupedFeatures.set(store, features);\n      }\n\n      const feature = store.get(olFeature.getId());\n      if (feature !== undefined) {\n        features.push(feature);\n      }\n    });\n\n    return groupedFeatures;\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay store\n   */\n  private createOverlayStore(): FeatureStore {\n    const overlayLayer = this.options.layer\n      ? this.options.layer\n      : this.createOverlayLayer();\n    return new FeatureStore([], { map: this.map }).bindLayer(overlayLayer);\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay layer\n   */\n  private createOverlayLayer(): VectorLayer {\n    return new VectorLayer({\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      style: undefined,\n      showInLayerList: false,\n      exportable: false,\n      browsable: false\n    });\n  }\n\n  /**\n   * Add the overlay store's layer to the map to display the selected\n   * features.\n   */\n  private addOverlayLayer() {\n    if (this.overlayStore.layer.map === undefined) {\n      this.map.addLayer(this.overlayStore.layer);\n    }\n  }\n\n  /**\n   * Remove the overlay layer from the map\n   */\n  private removeOverlayLayer() {\n    this.overlayStore.source.ol.clear();\n    this.map.removeLayer(this.overlayStore.layer);\n  }\n}\n","import { FeatureStore } from './store';\nimport { FeatureStoreSelectionStrategy } from './strategies/selection';\nimport { FeatureStoreLoadingStrategy } from './strategies/loading';\n\n/**\n * Try to add a loading strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the loading strategy\n * @param strategy An optional loading strategy\n */\nexport function tryAddLoadingStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreLoadingStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreLoadingStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreLoadingStrategy);\n    return;\n  }\n\n  strategy = strategy ? strategy : new FeatureStoreLoadingStrategy({});\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n\n/**\n * Try to add a selection strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the selection strategy\n * @param [strategy] An optional selection strategy\n */\nexport function tryAddSelectionStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreSelectionStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreSelectionStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n    return;\n  }\n  strategy = strategy\n    ? strategy\n    : new FeatureStoreSelectionStrategy({\n        map: store.map\n      });\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n","import * as olstyle from 'ol/style';\nimport { asArray as ColorAsArray } from 'ol/color';\n\n/**\n * Create a marker style for points\n * @returns Style\n */\nexport function createOverlayMarkerStyle({\n  text,\n  opacity = 1,\n  markerColor = [0, 161, 222],\n  markerOutlineColor = [255, 255, 255]\n}: {\n  text?: string;\n  opacity?: number;\n  markerColor?: string | number[];\n  markerOutlineColor?: string | number[];\n} = {}): olstyle.Style {\n  let iconColor;\n  let svgIconColor;\n  let svgOutlineColor;\n  let svg;\n\n  const isIE = /msie\\s|trident\\/|edge\\//i.test(window.navigator.userAgent); // To fix IE11 svg bug (temporarly)\n\n  const newColor = ColorAsArray(markerColor).slice(0);\n  const newOutlineColor = ColorAsArray(markerOutlineColor).slice(0);\n\n  if (newColor.length === 4 && (typeof markerColor !== 'string' || /^#[0-9A-F]{8}$/i.test(markerColor as string))) {\n    opacity = newColor[3];\n  }\n\n  svgIconColor = `\"rgba(${newColor[0]},${newColor[1]},${newColor[2]},${opacity})\"`;\n  iconColor = markerColor;\n\n  svgOutlineColor = `\"rgb(${newOutlineColor[0]},${newOutlineColor[1]},${newOutlineColor[2]})\"`;\n\n  svg =\n    'data:image/svg+xml;utf8,<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" height=\"36\" width=\"36\" viewBox=\"0 0 36 36\">' +\n    '<path fill=' +\n    svgIconColor +\n    ' stroke=' +\n    svgOutlineColor +\n    ` stroke-width=\"2\" d=\"M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z\"></path>` +\n    '</svg>';\n\n  let src;\n  if (isIE) {\n    switch (markerColor) {\n      case 'blue' || [0, 161, 222] || '#00a1de':\n        iconColor = 'blue';\n        break;\n      case 'red' || '#f64139':\n        iconColor = 'red';\n        break;\n      case 'yellow' || '#ffd700':\n        iconColor = 'yellow';\n        break;\n      case 'green' || '#008000':\n        iconColor = 'green';\n        break;\n      default:\n        iconColor = 'blue';\n        break;\n    }\n    src = './assets/igo2/geo/icons/place_' + iconColor + '_36px.svg';\n  } else {\n    src = svg;\n  }\n\n  return new olstyle.Style({\n    image: new olstyle.Icon({\n      src: svg,\n      opacity,\n      imgSize: [36, 36], // for ie\n      anchor: [0.5, 0.92]\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import { Injectable } from '@angular/core';\n\nimport * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport { StyleByAttribute } from './vector-style.interface';\n\nimport { ClusterParam } from './clusterParam';\nimport { createOverlayMarkerStyle } from '../../overlay/shared/overlay-marker-style.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleService {\n  public style: olstyle.Style;\n\n  createStyle(options: { [key: string]: any }) {\n    if (!options) {\n      return createOverlayMarkerStyle();\n    }\n    if (typeof options === 'function' || options instanceof olstyle.Style) {\n      return options;\n    }\n    return this.parseStyle('style', options);\n  }\n\n  private parseStyle(key: string, value: any) {\n    const styleOptions = {};\n    const olCls = this.getOlCls(key);\n\n    if (olCls && value instanceof Object) {\n      Object.keys(value).forEach(_key => {\n        const olKey = this.getOlKey(_key);\n        styleOptions[olKey] = this.parseStyle(_key, value[_key]);\n      });\n      return new olCls(styleOptions);\n    } else {\n      return value;\n    }\n  }\n\n  private getOlKey(key: any) {\n    let olKey;\n    switch (key.toLowerCase()) {\n      case 'circle':\n      case 'regularshape':\n      case 'icon':\n        olKey = 'image';\n        break;\n      default:\n        break;\n    }\n\n    return olKey || key;\n  }\n\n  private getOlCls(key: any) {\n    let olCls = olstyle[key.charAt(0).toUpperCase() + key.slice(1)];\n    if (key === 'regularshape') {\n      olCls = olstyle.RegularShape;\n    }\n    if (key === 'backgroundFill') {\n      olCls = olstyle.Fill;\n    }\n    if (key === 'backgroundStroke') {\n      olCls = olstyle.Stroke;\n    }\n\n    return olCls;\n  }\n\n  createStyleByAttribute(feature, styleByAttribute: StyleByAttribute) {\n\n    let style;\n    const type = styleByAttribute.type ? styleByAttribute.type : this.guessTypeFeature(feature);\n    const attribute = styleByAttribute.attribute;\n    const data = styleByAttribute.data;\n    const stroke = styleByAttribute.stroke;\n    const width = styleByAttribute.width;\n    const fill = styleByAttribute.fill;\n    const radius = styleByAttribute.radius;\n    const icon = styleByAttribute.icon;\n    const scale = styleByAttribute.scale;\n    const size = data ? data.length : 0;\n    const label = styleByAttribute.label;\n    const labelStyle = label instanceof olstyle.Style ?\n      this.parseStyle('text', styleByAttribute.label) ||\n      new olstyle.Text() : undefined;\n    const baseStyle = styleByAttribute.baseStyle;\n\n    if (labelStyle) {\n      const options = {\n        text: this.getLabel(feature, label)\n      };\n\n      labelStyle instanceof olstyle.Style ? labelStyle.setText(new olstyle.Text(options)) :\n      labelStyle.setText(this.getLabel(feature, label));\n    }\n\n    if (type === 'circle') {\n      for (let i = 0; i < size; i++) {\n        const val =\n          typeof feature.get(attribute) !== 'undefined'\n            ? feature.get(attribute)\n            : '';\n        if (val === data[i] || val.toString().match(data[i])) {\n          if (icon) {\n            style = [\n              new olstyle.Style({\n                image: new olstyle.Icon({\n                  src: icon[i],\n                  scale: scale ? scale[i] : 1\n                })\n              })\n            ];\n            return style;\n          }\n          style = [\n            new olstyle.Style({\n              image: new olstyle.Circle({\n                radius: radius ? radius[i] : 4,\n                stroke: new olstyle.Stroke({\n                  color: stroke ? stroke[i] : 'black',\n                  width: width ? width[i] : 1\n                }),\n                fill: new olstyle.Fill({\n                  color: fill ? fill[i] : 'black'\n                })\n              }),\n              text: labelStyle instanceof olstyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (!feature.getStyle()) {\n        if (baseStyle) {\n          style = this.createStyle(baseStyle);\n          if (labelStyle) {\n            style.setText(labelStyle);\n          }\n          return style;\n        }\n        style = [\n          new olstyle.Style({\n            image: new olstyle.Circle({\n              radius: 4,\n              stroke: new olstyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olstyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          })\n        ];\n        return style;\n      }\n    } else if (type === 'regular') {\n      for (let i = 0; i < size; i++) {\n        const val =\n          typeof feature.get(attribute) !== 'undefined'\n            ? feature.get(attribute)\n            : '';\n        if (val === data[i] || val.toString().match(data[i])) {\n          style = [\n            new olstyle.Style({\n              stroke: new olstyle.Stroke({\n                color: stroke ? stroke[i] : 'black',\n                width: width ? width[i] : 1\n              }),\n              fill: new olstyle.Fill({\n                color: fill ? fill[i] : 'rgba(255,255,255,0.4)'\n              }),\n              text: labelStyle instanceof olstyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (feature instanceof OlFeature) {\n        if (!feature.getStyle()) {\n          if (baseStyle) {\n            style = this.createStyle(baseStyle);\n            if (labelStyle) {\n              style.setText(labelStyle);\n            }\n            return style;\n          }\n          style = [\n            new olstyle.Style({\n              stroke: new olstyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olstyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          ];\n          return style;\n        }\n      }\n    }\n  }\n\n  createClusterStyle(feature, clusterParam: ClusterParam = {}, layerStyle) {\n    let style;\n    const size = feature.get('features').length;\n    if (size !== 1) {\n      if (clusterParam.clusterRanges) {\n        for (const r of clusterParam.clusterRanges) {\n          if (\n            (!r.minRadius || r.minRadius <= size) &&\n            (!r.maxRadius || r.maxRadius >= size)\n          ) {\n            style = this.createStyle(r.style) as olstyle.Circle;\n\n            if (r.showRange) {\n              const text = new olstyle.Text({\n                text: size.toString(),\n                fill: new olstyle.Fill({\n                  color: '#fff'\n                })\n              });\n              style.setText(text);\n            }\n\n            if (r.dynamicRadius) {\n              let clusterRadius: number;\n              const radiusMin = style.getRadius();\n              clusterRadius = 5 * Math.log(size);\n              if (clusterRadius < radiusMin) {\n                clusterRadius = radiusMin;\n              }\n              style.image_.setRadius(clusterRadius);\n            }\n            break;\n          }\n        }\n      }\n\n      if (!style) {\n        let clusterRadius: number;\n        if (clusterParam.radiusCalc) {\n          clusterRadius = clusterParam.radiusCalc(size);\n        } else {\n          const radiusMin = 6;\n          clusterRadius = 5 * Math.log(size);\n          if (clusterRadius < radiusMin) {\n            clusterRadius = radiusMin;\n          }\n        }\n\n        style = [\n          new olstyle.Style({\n            image: new olstyle.Circle({\n              radius: clusterRadius,\n              stroke: new olstyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olstyle.Fill({\n                color: 'rgba(24, 134, 45, 0.5)'\n              })\n            }),\n            text: new olstyle.Text({\n              text: size.toString(),\n              fill: new olstyle.Fill({\n                color: '#fff'\n              })\n            })\n          })\n        ];\n      }\n    } else {\n      style = this.createStyle(layerStyle);\n    }\n    return style;\n  }\n\n  getLabel(feature, labelMatch): string {\n    let label = labelMatch;\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach(v => {\n      label = label.replace(v[0], feature.get(v[1]));\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.get(labelMatch) || labelMatch;\n    }\n\n    return label;\n  }\n\n  private guessTypeFeature(feature) {\n    switch (feature.getGeometry().getType()) {\n      case 'Point':\n      case 'MultiPoint':\n      case 'Circle':\n        return 'circle';\n      default:\n        return 'regular';\n    }\n  }\n}\n","import * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\n\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { createOverlayMarkerStyle } from './overlay-marker-style.utils';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n/**\n * Create an overlay layer and it's source\n * @returns Overlay layer\n */\nexport function createOverlayLayer(): VectorLayer {\n  const overlayDataSource = new FeatureDataSource();\n  return new VectorLayer({\n    title: 'Overlay',\n    zIndex: 300,\n    source: overlayDataSource,\n    style: createOverlayLayerStyle()\n  });\n}\n\n/**\n * Create an overlay style with markers for points and a basic stroke/fill\n * combination for lines and polygons\n * @returns Style function\n */\nfunction createOverlayLayerStyle(): (olFeature: OlFeature<OlGeometry>) => olstyle.Style {\n  const defaultStyle = createOverlayDefaultStyle();\n  const markerStyle = createOverlayMarkerStyle();\n\n  let style;\n\n  return (olFeature: OlFeature<OlGeometry>) => {\n    if (olFeature.getId() === 'bufferFeature') {\n      style = createBufferStyle(\n        olFeature.get('bufferStroke'),\n        2,\n        olFeature.get('bufferFill'),\n        olFeature.get('bufferText')\n      );\n      return style;\n    } else {\n      const customStyle = olFeature.get('_style');\n      if (customStyle) {\n        const styleService = new StyleService();\n        return styleService.createStyle(customStyle);\n      }\n      const geometryType = olFeature.getGeometry().getType();\n      style = geometryType === 'Point' ? markerStyle : defaultStyle;\n      style.getText().setText(olFeature.get('_mapTitle'));\n      return style;\n    }\n  };\n}\n\n/**\n * Create a basic style for lines and polygons\n * @returns Style\n */\nexport function createOverlayDefaultStyle({\n  text,\n  strokeWidth = 2,\n  fillColor = [0, 161, 222, 0.3],\n  strokeColor = [0, 161, 222, 0.9],\n}: {\n  text?: string;\n  strokeWidth?: number;\n  fillColor?: string | number[];\n  strokeColor?: string | number[];\n} = {}): olstyle.Style {\n  const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n  const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeWithOpacity\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillWithOpacity\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n\nfunction createBufferStyle(\n  strokeRGBA: [number, number, number, number] = [0, 161, 222, 1],\n  strokeWidth: number = 2,\n  fillRGBA: [number, number, number, number] = [0, 161, 222, 0.15],\n  bufferRadius?\n): olstyle.Style {\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeRGBA\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillRGBA\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      font: '12px Calibri,sans-serif',\n      text: bufferRadius,\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  Feature,\n  FeatureMotion,\n  featureToOl,\n  moveToOlFeatures\n} from '../../feature/shared';\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\n\nimport { createOverlayLayer } from './overlay.utils';\n\n/**\n * This class is simply a shortcut for adding features to a map.\n * It does nothing more than a standard layer but it's shipped with\n * a defautl style based on the geometry type of the features it contains.\n * @todo Enhance that by using a FeatureStore and strategies.\n */\nexport class Overlay {\n  /**\n   * The map to add the layer to\n   */\n  private map: IgoMap;\n\n  /**\n   * Overlay layer\n   */\n  private layer: VectorLayer;\n\n  /**\n   * Overlay layer's data source\n   */\n  get dataSource(): FeatureDataSource {\n    return this.layer.dataSource as FeatureDataSource;\n  }\n\n  constructor(map?: IgoMap) {\n    this.layer = createOverlayLayer();\n    this.setMap(map);\n  }\n\n  /**\n   * Bind this to a map and add the overlay layer to that map\n   * @param map Map\n   */\n  setMap(map: IgoMap) {\n    if (map === undefined) {\n      if (this.map !== undefined) {\n        this.map.ol.removeLayer(this.layer.ol);\n      }\n    } else {\n      map.ol.addLayer(this.layer.ol);\n    }\n    this.map = map;\n  }\n\n  /**\n   * Set the overlay features and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   * @param sourceId Optional: Remove features of certain sourceId (ex: 'Map' for query features)\n   */\n  setFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    sourceId?: string\n  ) {\n    if (sourceId) {\n      for (const olFeature of this.dataSource.ol.getFeatures()) {\n        if (olFeature.get('_sourceId') === sourceId) {\n          this.removeOlFeature(olFeature);\n        }\n      }\n    } else {\n      this.clear();\n    }\n    this.addFeatures(features, motion);\n  }\n\n  /**\n   * Add a feature to the  overlay and, optionally, move to it\n   * @param feature Feature\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addFeature(feature: Feature, motion: FeatureMotion = FeatureMotion.Default) {\n    this.addFeatures([feature], motion);\n  }\n\n  /**\n   * Add features to the  overlay and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    const olFeatures = [];\n    features.forEach((feature: Feature) => {\n      const olFeature = featureToOl(feature, this.map.projection);\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry === null) {\n        return;\n      }\n      olFeatures.push(olFeature);\n    });\n\n    this.addOlFeatures(olFeatures, motion);\n  }\n\n  /**\n   * Add a OpenLayers feature to the  overlay and, optionally, move to it\n   * @param olFeature OpenLayers Feature\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeature(\n    olFeature: OlFeature<OlGeometry>,\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.addOlFeatures([olFeature], motion);\n  }\n\n  /**\n   * Add OpenLayers features to the overlay and, optionally, move to them\n   * @param olFeatures OpenLayers Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.dataSource.ol.addFeatures(olFeatures);\n    moveToOlFeatures(this.map, olFeatures, motion);\n  }\n\n  /**\n   * Remove a feature from the overlay\n   * @param feature Feature\n   */\n  removeFeature(feature: Feature) {\n    this.removeFeatures([feature]);\n  }\n\n  /**\n   * Remove features from the overlay\n   * @param features Features\n   */\n  removeFeatures(features: Feature[]) {\n    features.forEach((feature: Feature) => {\n      if (feature.meta) {\n        if (this.dataSource.ol.getFeatureById(feature.meta.id)) {\n          this.removeOlFeature(this.dataSource.ol.getFeatureById(feature.meta.id));\n        }\n      }\n    });\n  }\n\n  /**\n   * Remove an OpenLayers feature from the overlay\n   * @param olFeature OpenLayers Feature\n   */\n  removeOlFeature(olFeature: OlFeature<OlGeometry>) {\n    this.dataSource.ol.removeFeature(olFeature);\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.dataSource.ol.clear();\n  }\n}\n","import { Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { Watcher, SubjectStatus } from '@igo2/utils';\nimport { Layer } from '../../layer/shared/layers';\n\nexport class LayerWatcher extends Watcher {\n  private loaded = 0;\n  private loading = 0;\n  private layers: Layer[] = [];\n  private subscriptions: Subscription[] = [];\n\n  constructor() {\n    super();\n  }\n\n  watch() {}\n\n  unwatch() {\n    this.layers.forEach(layer => this.unwatchLayer(layer), this);\n  }\n\n  watchLayer(layer: Layer) {\n    if (layer.status$ === undefined) {\n      return;\n    }\n\n    this.layers.push(layer);\n\n    const layer$$ = layer.status$\n      .pipe(distinctUntilChanged())\n      .subscribe(status => {\n        if (status === SubjectStatus.Error) {\n          this.loading = 0;\n          this.loaded = -1;\n        }\n        if (status === SubjectStatus.Working) {\n          this.loading += 1;\n        } else if (status === SubjectStatus.Done) {\n          this.loaded += 1;\n        }\n\n        if (this.loaded >= this.loading) {\n          this.loading = this.loaded = 0;\n          this.status = SubjectStatus.Done;\n        } else if (this.loading > 0) {\n          this.status = SubjectStatus.Working;\n        }\n      });\n\n    this.subscriptions.push(layer$$);\n  }\n\n  unwatchLayer(layer: Layer) {\n    layer.status$.next(SubjectStatus.Done);\n    const index = this.layers.indexOf(layer);\n    if (index >= 0) {\n      const status = (layer as any).watcher.status;\n      if (\n        [SubjectStatus.Working, SubjectStatus.Waiting].indexOf(status) !== -1\n      ) {\n        this.loaded += 1;\n      }\n      this.subscriptions[index].unsubscribe();\n      this.subscriptions.splice(index, 1);\n      this.layers.splice(index, 1);\n      (layer as any).watcher.unwatch();\n    }\n  }\n}\n","export enum MapViewAction {\n  Move,\n  Zoom\n}\n","import OlMap from 'ol/Map';\nimport OlMapEvent from 'ol/MapEvent';\n\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport * as oleasing from 'ol/easing';\nimport * as olproj from 'ol/proj';\nimport OlProjection from 'ol/proj/Projection';\nimport OlView from 'ol/View';\n\nimport { MapViewAction } from '../map.enums';\nimport { MapExtent, MapViewState } from '../map.interface';\nimport { getScaleFromResolution, viewStatesAreEqual } from '../map.utils';\nimport { MapController } from './controller';\nimport { EventsKey } from 'ol/events';\n\nexport interface MapViewControllerOptions {\n  stateHistory: boolean;\n}\n\n/**\n * Controller to handle map view interactions\n */\nexport class MapViewController extends MapController {\n  /**\n   * Observable of the current resolution\n   */\n  resolution$ = new BehaviorSubject<number>(undefined);\n\n  /**\n   * Observable of the current state\n   */\n  state$ = new BehaviorSubject<MapViewState>(undefined);\n\n  /**\n   * View Padding\n   */\n  padding = [0, 0, 0, 0];\n\n  /**\n   * Max zoom after set extent\n   */\n  maxZoomOnExtent = 19;\n\n  /**\n   * Max extent possible when zooming\n   */\n  maxLayerZoomExtent: MapExtent;\n\n  /**\n   * Extent stream\n   */\n  private extent$ = new Subject<{ extent: MapExtent; action: MapViewAction }>();\n\n  /**\n   * Subscription to the movement stream\n   */\n  private extent$$: Subscription;\n\n  /**\n   * History of states\n   */\n  private states: MapViewState[] = [];\n\n  /**\n   * Current state index\n   */\n  private stateIndex: number = 0;\n\n  /**\n   * Whether the view controller should keep the view's state history\n   */\n  get stateHistory(): boolean {\n    return this.options ? this.options.stateHistory === true : false;\n  }\n\n  /**\n   * OL View\n   */\n  get olView(): OlView {\n    return this.olMap.getView();\n  }\n\n  constructor(private options?: MapViewControllerOptions) {\n    super();\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    super.setOlMap(olMap);\n    this.setupObservers();\n  }\n\n  /**\n   * Observe move moveend and subscribe to the extent stream\n   */\n  setupObservers() {\n    if (this.stateHistory === true) {\n      this.observerKeys.push(\n        this.olMap.on('moveend', (event: OlMapEvent) => this.onMoveEnd(event)) as EventsKey\n      );\n    }\n\n    this.extent$$ = this.extent$\n      .pipe(debounceTime(25))\n      .subscribe((value: { extent: MapExtent; action: MapViewAction }) => {\n        this.setExtent(value.extent, value.action);\n      });\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    super.teardownObservers();\n    if (this.extent$$ !== undefined) {\n      this.extent$$.unsubscribe();\n      this.extent$$ = undefined;\n    }\n  }\n\n  /**\n   * Get the view's OL projection\n   * @returns OL projection\n   */\n  getOlProjection(): OlProjection {\n    return this.olView.getProjection();\n  }\n\n  /**\n   * Get the current map view center\n   * @param projection Output projection\n   * @returns Center\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    let center = this.olView.getCenter() as [number, number];\n    if (projection && center) {\n      center = olproj.transform(center, this.getOlProjection(), projection) as [number, number];\n    }\n    return center;\n  }\n\n  /**\n   * Get the current view extent\n   * @param projection Output projection\n   * @returns Extent\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    let extent = this.olView.calculateExtent(this.olMap.getSize());\n    if (projection && extent) {\n      extent = olproj.transformExtent(\n        extent,\n        this.getOlProjection(),\n        projection\n      );\n    }\n    return extent as [number, number, number, number];\n  }\n\n  /**\n   * Get the current scale\n   * @param dpi Dot per inches\n   * @returns View scale\n   */\n  getScale(dpi = 96) {\n    return getScaleFromResolution(\n      this.getResolution(),\n      this.getOlProjection().getUnits(),\n      dpi\n    );\n  }\n\n  /**\n   * Get the current resolution\n   * @returns Projection denominator\n   */\n  getResolution(): number {\n    return this.olView.getResolution();\n  }\n\n  /**\n   * Get the current zoom level\n   * @returns Zoom level\n   */\n  getZoom(): number {\n    return Math.round(this.olView.getZoom());\n  }\n\n  /**\n   * Zoom in\n   */\n  zoomIn() {\n    this.zoomTo(this.olView.getZoom() + 1);\n  }\n\n  /**\n   * Zoom out\n   */\n  zoomOut() {\n    this.zoomTo(this.olView.getZoom() - 1);\n  }\n\n  /**\n   * Zoom to specific zoom level\n   * @param zoom Zoom level\n   */\n  zoomTo(zoom: number) {\n    this.olView.cancelAnimations();\n    this.olView.animate({\n      zoom,\n      duration: 250,\n      easing: oleasing.easeOut\n    });\n  }\n\n  /**\n   * Move to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to move to\n   */\n  moveToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Move });\n  }\n\n  /**\n   * Zoom to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to zoom to\n   */\n  zoomToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Zoom });\n  }\n\n  /**\n   * Return the current view rotation\n   * @returns Rotation angle in degrees\n   */\n  getRotation(): number {\n    return this.olView.getRotation();\n  }\n\n  /**\n   * Reset the view rotation to 0\n   */\n  resetRotation() {\n    this.olView.animate({ rotation: 0 });\n  }\n\n  /**\n   * Whether the view has a previous state\n   * @returns True if the view has a previous state\n   */\n  hasPreviousState(): boolean {\n    return this.states.length > 1 && this.stateIndex > 0;\n  }\n\n  /**\n   * Whether the view has a next state\n   * @returns True if the view has a next state\n   */\n  hasNextState(): boolean {\n    return this.states.length > 1 && this.stateIndex < this.states.length - 1;\n  }\n\n  /**\n   * Restore the previous view state\n   */\n  previousState() {\n    if (this.hasPreviousState()) {\n      this.setStateIndex(this.stateIndex - 1);\n    }\n  }\n\n  /**\n   * Restore the next view state\n   */\n  nextState() {\n    if (this.hasNextState()) {\n      this.setStateIndex(this.stateIndex + 1);\n    }\n  }\n\n  /**\n   * Clear the state history\n   */\n  clearStateHistory() {\n    this.states = [];\n    this.stateIndex = 0;\n  }\n\n  /**\n   * Update the the view to it's intial state\n   */\n  setInitialState() {\n    if (this.states.length > 0) {\n      this.setStateIndex(0);\n    }\n  }\n\n  /**\n   * Move to the extent retrieved from the stream\n   * @param extent Extent\n   * @param action Either zoom or move\n   * @param animation With or without animation to the target extent.\n   */\n  private setExtent(\n    extent: MapExtent,\n    action: MapViewAction,\n    animation: boolean = true\n  ) {\n    const olView = this.olView;\n    olView.cancelAnimations();\n    const duration = animation ? 500 : 0;\n    const zoom = olView.getZoom();\n\n    const fromCenter = olView.getCenter();\n    const toCenter = [\n      extent[0] + (extent[2] - extent[0]) / 2,\n      extent[1] + (extent[3] - extent[1]) / 2\n    ];\n    const distCenter = Math.sqrt(\n      Math.pow(fromCenter[0] - toCenter[0], 2) +\n        Math.pow(fromCenter[1] - toCenter[1], 2)\n    );\n    const fromExtent = olView.calculateExtent();\n    const fromSize = Math.sqrt(\n      Math.pow(fromExtent[2] - fromExtent[0], 2) +\n        Math.pow(fromExtent[3] - fromExtent[1], 2)\n    );\n    const toSize = Math.sqrt(\n      Math.pow(extent[2] - extent[0], 2) + Math.pow(extent[3] - extent[1], 2)\n    );\n    const moySize = (toSize + fromSize) / 2;\n    const xSize = distCenter / moySize;\n\n    const maxZoom =\n      action === MapViewAction.Move || zoom > this.maxZoomOnExtent\n        ? zoom\n        : this.maxZoomOnExtent;\n\n    olView.fit(extent, {\n      size: this.olMap.getSize(),\n      maxZoom,\n      padding: this.padding,\n      duration: xSize > 4 ? 0 : duration,\n      callback: (isFinished: boolean) => {\n        if (!isFinished) {\n          olView.fit(extent, {\n            size: this.olMap.getSize(),\n            maxZoom,\n            padding: this.padding,\n            duration: xSize > 4 ? 0 : duration\n          });\n        }\n      }\n    });\n  }\n\n  /**\n   * Set the view state index\n   * @param index State index\n   */\n  private setStateIndex(index: number) {\n    this.stateIndex = index;\n    this.setState(this.states[index]);\n  }\n\n  /**\n   * Set the view state\n   * @param state View state\n   */\n  private setState(state: MapViewState) {\n    this.olView.animate({\n      resolution: state.resolution,\n      center: state.center,\n      duration: 0\n    });\n  }\n\n  /**\n   * On move end, get the view state and record it.\n   * @param event Map event\n   */\n  private onMoveEnd(event: OlMapEvent) {\n    const resolution = this.getResolution();\n    if (this.resolution$.value !== resolution) {\n      this.resolution$.next(resolution);\n    }\n\n    const state = {\n      resolution,\n      center: this.getCenter(),\n      zoom: this.getZoom()\n    };\n\n    if (this.stateHistory === true) {\n      const stateIndex = this.stateIndex;\n      const stateAtIndex =\n        this.states.length === 0 ? undefined : this.states[stateIndex];\n      if (!viewStatesAreEqual(state, stateAtIndex)) {\n        this.states = this.states.slice(0, stateIndex + 1).concat([state]);\n        this.stateIndex = this.states.length - 1;\n      }\n    }\n\n    this.state$.next(state);\n  }\n}\n","import { EventsKey } from 'ol/events';\nimport OlMap from 'ol/Map';\nimport { unByKey } from 'ol/Observable';\n\n/**\n * Base map controller\n */\nexport class MapController {\n\n  /**\n   * OL Map\n   */\n  protected olMap: OlMap;\n\n  /**\n   * Array of observer keys\n   */\n  protected observerKeys: EventsKey[] = [];\n\n  /**\n   * Return the OL map this controller is bound to\n   * @returns OL Map\n   */\n  getOlMap(): OlMap {\n    return this.olMap;\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap !== undefined && this.getOlMap() !== undefined) {\n      throw new Error('This controller is already bound to a map.');\n    }\n\n    if (olMap === undefined) {\n      this.teardownObservers();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    this.observerKeys.forEach((key: EventsKey) => unByKey(key));\n    this.observerKeys = [];\n  }\n\n}\n","import olMap from 'ol/Map';\nimport olView from 'ol/View';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport olGeolocation from 'ol/Geolocation';\nimport olControlAttribution from 'ol/control/Attribution';\nimport olControlScaleLine from 'ol/control/ScaleLine';\nimport * as olproj from 'ol/proj';\nimport * as olproj4 from 'ol/proj/proj4';\nimport olPoint from 'ol/geom/Point';\nimport OlProjection from 'ol/proj/Projection';\nimport * as olinteraction from 'ol/interaction';\nimport olCircle from 'ol/geom/Circle';\nimport * as olstyle from 'ol/style';\n\nimport proj4 from 'proj4';\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\n\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { Layer } from '../../layer/shared/layers';\nimport { Overlay } from '../../overlay/shared/overlay';\n\nimport { LayerWatcher } from '../utils/layer-watcher';\nimport {\n  MapViewOptions,\n  MapOptions,\n  MapAttributionOptions,\n  MapScaleLineOptions,\n  MapExtent,\n  MapControlsOptions\n} from './map.interface';\nimport { MapViewController } from './controllers/view';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\n\n// TODO: This class is messy. Clearly define it's scope and the map browser's.\n// Move some stuff into controllers.\nexport class IgoMap {\n  public ol: olMap;\n  public offlineButtonToggle$ = new BehaviorSubject<boolean>(false);\n  public layers$ = new BehaviorSubject<Layer[]>([]);\n  public status$: Subject<SubjectStatus>;\n  public alwaysTracking: boolean;\n  public positionFollower: boolean = true;\n  public geolocation$ = new BehaviorSubject<olGeolocation>(undefined);\n  public geolocationPositionFeature: olFeature<OlGeometry>;\n  public geolocationAccuracyFeature: olFeature<OlGeometry>;\n  public bufferGeom: olCircle;\n  public bufferFeature: olFeature<OlGeometry>;\n  public buffer: Overlay;\n  public overlay: Overlay;\n  public queryResultsOverlay: Overlay;\n  public searchResultsOverlay: Overlay;\n  public viewController: MapViewController;\n  public swipeEnabled$ = new BehaviorSubject<boolean>(false);\n  public mapCenter$ = new BehaviorSubject<boolean>(false);\n  public selectedFeatures$ = new BehaviorSubject<Layer[]>(null);\n\n  public bufferDataSource: FeatureDataSource;\n\n  private layerWatcher: LayerWatcher;\n  private geolocation: olGeolocation;\n  private geolocation$$: Subscription;\n\n  private options: MapOptions;\n  private defaultOptions: Partial<MapOptions> = {\n    controls: { attribution: false }\n  };\n\n  get layers(): Layer[] {\n    return this.layers$.value;\n  }\n\n  get projection(): string {\n    return this.viewController.getOlProjection().getCode();\n  }\n\n  constructor(options?: MapOptions) {\n    this.options = Object.assign({}, this.defaultOptions, options);\n    this.layerWatcher = new LayerWatcher();\n    this.status$ = this.layerWatcher.status$;\n    olproj4.register(proj4);\n    this.init();\n  }\n\n  init() {\n    const controls = [];\n    if (this.options.controls) {\n      if (this.options.controls.attribution) {\n        const attributionOpt = (this.options.controls.attribution === true\n          ? {}\n          : this.options.controls.attribution) as MapAttributionOptions;\n        controls.push(new olControlAttribution(attributionOpt));\n      }\n      if (this.options.controls.scaleLine) {\n        const scaleLineOpt = (this.options.controls.scaleLine === true\n          ? {}\n          : this.options.controls.scaleLine) as MapScaleLineOptions;\n        controls.push(new olControlScaleLine(scaleLineOpt));\n      }\n    }\n    let interactions = {};\n    if (this.options.interactions === false) {\n      interactions = {\n        altShiftDragRotate: false,\n        doubleClickZoom: false,\n        keyboard: false,\n        mouseWheelZoom: false,\n        shiftDragZoom: false,\n        dragPan: false,\n        pinchRotate: false,\n        pinchZoom: false\n      };\n    }\n\n    this.ol = new olMap({\n      interactions: olinteraction.defaults(interactions),\n      controls\n    });\n\n    this.setView(this.options.view || {});\n    this.viewController = new MapViewController({\n      stateHistory: true\n    });\n    this.viewController.setOlMap(this.ol);\n    this.overlay = new Overlay(this);\n    this.queryResultsOverlay = new Overlay(this);\n    this.searchResultsOverlay = new Overlay(this);\n    this.buffer = new Overlay(this);\n  }\n\n  setTarget(id: string) {\n    this.ol.setTarget(id);\n    if (id !== undefined) {\n      this.layerWatcher.subscribe(() => { }, null);\n    } else {\n      this.layerWatcher.unsubscribe();\n    }\n  }\n\n  updateView(options: MapViewOptions) {\n    const currentView = this.ol.getView();\n    const viewOptions = Object.assign(\n      {\n        zoom: currentView.getZoom()\n      },\n      currentView.getProperties()\n    );\n\n    this.setView(Object.assign(viewOptions, options));\n    if (options.maxZoomOnExtent) {\n      this.viewController.maxZoomOnExtent = options.maxZoomOnExtent;\n    }\n  }\n\n  /**\n   * Set the map view\n   * @param options Map view options\n   */\n  setView(options: MapViewOptions) {\n    if (this.viewController !== undefined) {\n      this.viewController.clearStateHistory();\n    }\n\n    options = Object.assign({ constrainResolution: true }, options);\n    const view = new olView(options);\n    this.ol.setView(view);\n\n    this.unsubscribeGeolocate();\n    if (options) {\n      if (options.maxLayerZoomExtent) {\n        this.viewController.maxLayerZoomExtent = options.maxLayerZoomExtent;\n      }\n\n      if (options.center) {\n        const projection = view.getProjection().getCode();\n        const center = olproj.fromLonLat(options.center, projection);\n        view.setCenter(center);\n      }\n\n      if (options.geolocate) {\n        this.geolocate(true);\n      }\n\n      if (options.alwaysTracking) {\n        this.alwaysTracking = true;\n      }\n    }\n  }\n\n  updateControls(value: MapControlsOptions) {\n    if (value === undefined) {\n      return;\n    }\n\n    const controls = [];\n    if (value.attribution) {\n      const attributionOpt = (value.attribution === true\n        ? {}\n        : value.attribution) as MapAttributionOptions;\n      controls.push(new olControlAttribution(attributionOpt));\n    }\n    if (value.scaleLine) {\n      const scaleLineOpt = (value.scaleLine === true\n        ? {}\n        : value.scaleLine) as MapScaleLineOptions;\n      controls.push(new olControlScaleLine(scaleLineOpt));\n    }\n\n    const currentControls = Object.assign([], this.ol.getControls().getArray());\n    currentControls.forEach(control => {\n      this.ol.removeControl(control);\n    });\n    controls.forEach(control => {\n      this.ol.addControl(control);\n    });\n  }\n\n  /**\n   * Deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    return this.viewController.getCenter(projection);\n  }\n\n  /**\n   * Deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    return this.viewController.getExtent(projection);\n  }\n\n  // TODO: Move to ViewController and update every place it's used\n  getZoom(): number {\n    return this.viewController.getZoom();\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (!baseLayer) {\n      return;\n    }\n\n    for (const bl of this.getBaseLayers()) {\n      bl.visible = false;\n    }\n\n    baseLayer.visible = true;\n\n    this.viewController.olView.setMinZoom(\n      baseLayer.dataSource.options.minZoom || (this.options.view || {}).minZoom\n    );\n    this.viewController.olView.setMaxZoom(\n      baseLayer.dataSource.options.maxZoom || (this.options.view || {}).maxZoom\n    );\n  }\n\n  getBaseLayers(): Layer[] {\n    return this.layers.filter((layer: Layer) => layer.baseLayer === true);\n  }\n\n  getLayerById(id: string): Layer {\n    return this.layers.find((layer: Layer) => layer.id && layer.id === id);\n  }\n\n  getLayerByAlias(alias: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => layer.alias && layer.alias === alias\n    );\n  }\n\n  getLayerByOlUId(olUId: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => (layer.ol as any).ol_uid && (layer.ol as any).ol_uid === olUId\n    );\n  }\n\n  /**\n   * Add a single layer\n   * @param layer Layer to add\n   * @param push DEPRECATED\n   */\n  addLayer(layer: Layer, push = true) {\n    this.addLayers([layer]);\n  }\n\n  /**\n   * Add many layers\n   * @param layers Layers to add\n   * @param push DEPRECATED\n   */\n  addLayers(layers: Layer[], push = true) {\n    let offsetZIndex = 0;\n    let offsetBaseLayerZIndex = 0;\n    const addedLayers = layers\n      .map((layer: Layer) => {\n        if (!layer) { return; }\n        const offset = layer.zIndex\n          ? 0\n          : layer.baseLayer\n            ? offsetBaseLayerZIndex++\n            : offsetZIndex++;\n        return this.doAddLayer(layer, offset);\n      })\n      .filter((layer: Layer | undefined) => layer !== undefined);\n    this.setLayers([].concat(this.layers, addedLayers));\n  }\n\n  /**\n   * Remove a single layer\n   * @param layer Layer to remove\n   */\n  removeLayer(layer: Layer) {\n    this.removeLayers([layer]);\n  }\n\n  /**\n   * Remove many layers\n   * @param layers Layers to remove\n   */\n  removeLayers(layers: Layer[]) {\n    const newLayers = this.layers$.value.slice(0);\n    const layersToRemove = [];\n    layers.forEach((layer: Layer) => {\n      const index = newLayers.indexOf(layer);\n      if (index >= 0) {\n        layersToRemove.push(layer);\n        newLayers.splice(index, 1);\n        this.handleLinkedLayersDeletion(layer, layersToRemove);\n        layersToRemove.map(linkedLayer => {\n          layersToRemove.push(linkedLayer);\n          const linkedIndex = newLayers.indexOf(linkedLayer);\n          if (linkedIndex >= 0) {\n            newLayers.splice(linkedIndex, 1);\n          }\n        });\n      }\n    });\n\n    layersToRemove.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.setLayers(newLayers);\n  }\n\n  /**\n   * Build a list of linked layers to delete\n   * @param srcLayer Layer that has triggered the deletion\n   * @param layersToRemove list to append the layer to delete into\n   */\n  handleLinkedLayersDeletion(srcLayer: Layer, layersToRemove: Layer[]) {\n    const linkedLayers = srcLayer.options.linkedLayers;\n    if (!linkedLayers) {\n      return;\n    }\n    const currentLinkedId = linkedLayers.linkId;\n    const currentLinks = linkedLayers.links;\n    const isParentLayer = currentLinks ? true : false;\n    if (isParentLayer) {\n      // search for child layers\n      currentLinks.map(link => {\n        if (!link.syncedDelete) {\n          return;\n        }\n        link.linkedIds.map(linkedId => {\n          const layerToApply = this.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\n          if (layerToApply) {\n            layersToRemove.push(layerToApply);\n          }\n        });\n      });\n    } else {\n      // search for parent layer\n      this.layers.map(layer => {\n        if (layer.options.linkedLayers?.links) {\n          layer.options.linkedLayers.links.map(l => {\n            if (\n              l.syncedDelete && l.bidirectionnal !== false &&\n              l.linkedIds.indexOf(currentLinkedId) !== -1) {\n              layersToRemove.push(layer);\n              this.handleLinkedLayersDeletion(layer, layersToRemove);\n            }\n          });\n        }\n      });\n    }\n  }\n\n  /**\n   * Remove all layers\n   */\n  removeAllLayers() {\n    this.layers.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.layers$.next([]);\n  }\n\n  raiseLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index > 1) {\n      this.moveLayer(layer, index, index - 1);\n    }\n  }\n\n  raiseLayers(layers: Layer[]) {\n    for (const layer of layers) {\n      this.raiseLayer(layer);\n    }\n  }\n\n  lowerLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index < this.layers.length - 1) {\n      this.moveLayer(layer, index, index + 1);\n    }\n  }\n\n  lowerLayers(layers: Layer[]) {\n    const reverseLayers = layers.reverse();\n    for (const layer of reverseLayers) {\n      this.lowerLayer(layer);\n    }\n  }\n\n  moveLayer(layer: Layer, from: number, to: number) {\n    const layerTo = this.layers[to];\n    const zIndexTo = layerTo.zIndex;\n    const zIndexFrom = layer.zIndex;\n\n    if (layerTo.baseLayer || layer.baseLayer) {\n      return;\n    }\n\n    layer.zIndex = zIndexTo;\n    layerTo.zIndex = zIndexFrom;\n\n    this.layers[to] = layer;\n    this.layers[from] = layerTo;\n    this.layers$.next(this.layers.slice(0));\n  }\n\n  /**\n   * Add a layer to the OL map and start watching. If the layer is already\n   * added to this map, make it visible but don't add it one again.\n   * @param layer Layer\n   * @returns The layer added, if any\n   */\n  private doAddLayer(layer: Layer, offsetZIndex: number) {\n    if (layer.baseLayer && layer.visible) {\n      this.changeBaseLayer(layer);\n    }\n\n    const existingLayer = this.getLayerById(layer.id);\n    if (existingLayer !== undefined) {\n      existingLayer.visible = true;\n      return;\n    }\n\n    if (!layer.baseLayer && layer.zIndex) {\n      layer.zIndex += 10;\n    }\n\n    if (layer.zIndex === undefined || layer.zIndex === 0) {\n      const maxZIndex = Math.max(\n        layer.baseLayer ? 0 : 10,\n        ...this.layers\n          .filter(\n            (l) => l.baseLayer === layer.baseLayer && l.zIndex < 200 // zIndex > 200 = system layer\n          )\n          .map((l) => l.zIndex)\n      );\n      layer.zIndex = maxZIndex + 1 + offsetZIndex;\n    }\n\n    if (layer.baseLayer && layer.zIndex > 9) {\n      layer.zIndex = 10; // baselayer must have zIndex < 10\n    }\n\n    layer.setMap(this);\n    this.layerWatcher.watchLayer(layer);\n    this.ol.addLayer(layer.ol);\n\n    return layer;\n  }\n\n  /**\n   * Remove a layer from the OL map and stop watching\n   * @param layer Layer\n   */\n  private doRemoveLayer(layer: Layer) {\n    this.layerWatcher.unwatchLayer(layer);\n    this.ol.removeLayer(layer.ol);\n    layer.setMap(undefined);\n  }\n\n  /**\n   * Update the layers observable\n   * @param layers Layers\n   */\n  private setLayers(layers: Layer[]) {\n    this.layers$.next(this.sortLayersByZIndex(layers).slice(0));\n  }\n\n  /**\n   * Sort layers by descending zIndex\n   * @param layers Array of layers\n   * @returns The original array, sorted by zIndex\n   */\n  private sortLayersByZIndex(layers: Layer[]) {\n    // Sort by descending zIndex\n    return layers.sort(\n      (layer1: Layer, layer2: Layer) => layer2.zIndex - layer1.zIndex\n    );\n  }\n\n  /**\n   * Get layer index in the map's inenr array of layers\n   * @param layer Layer\n   * @returns The layer index\n   */\n  private getLayerIndex(layer: Layer) {\n    return this.layers.findIndex((_layer: Layer) => _layer === layer);\n  }\n\n  // TODO: Create a GeolocationController with everything below\n  geolocate(track = false) {\n    let first = true;\n    if (this.geolocation$$) {\n      track = this.geolocation.getTracking();\n      this.unsubscribeGeolocate();\n    }\n    this.startGeolocation();\n\n    this.geolocation$$ = this.geolocation$.subscribe((geolocation) => {\n      if (!geolocation) {\n        return;\n      }\n      const accuracy = geolocation.getAccuracy();\n      const coordinates = geolocation.getPosition();\n      if (accuracy < 10000) {\n        const positionGeometry = coordinates ? new olPoint(coordinates) : null;\n\n        const accuracyGeometry = geolocation.getAccuracyGeometry();\n        const accuracyExtent = accuracyGeometry.getExtent();\n\n        [this.geolocationPositionFeature, this.geolocationAccuracyFeature].map(feature => {\n          if (feature && this.overlay.dataSource.ol.getFeatureById(feature.getId())) {\n            this.overlay.dataSource.ol.removeFeature(feature);\n          }\n        });\n\n        if (this.bufferFeature) {\n          this.buffer.dataSource.ol.removeFeature(this.bufferFeature);\n        }\n\n        this.geolocationPositionFeature = new olFeature({ geometry: positionGeometry });\n        this.geolocationPositionFeature.setId('geolocationPositionFeature');\n\n        this.geolocationPositionFeature.setStyle(\n          new olstyle.Style({\n            image: new olstyle.Circle({\n              radius: 6,\n              fill: new olstyle.Fill({\n                color: '#3399CC',\n              }),\n              stroke: new olstyle.Stroke({\n                color: '#fff',\n                width: 2,\n              }),\n            }),\n          })\n        );\n\n\n        this.geolocationAccuracyFeature = new olFeature({ geometry: accuracyGeometry });\n        this.geolocationAccuracyFeature.setId('geolocationAccuracyFeature');\n        if (this.alwaysTracking) {\n          [this.geolocationPositionFeature, this.geolocationAccuracyFeature].map(feature => {\n            this.overlay.addOlFeature(\n              feature,\n              this.positionFollower ? FeatureMotion.Move : FeatureMotion.None\n            );\n          });\n\n        } else {\n          [this.geolocationPositionFeature, this.geolocationAccuracyFeature].map(feature => {\n            this.overlay.addOlFeature(\n              feature\n            );\n          });\n        }\n\n        if (this.ol.getView().get('options_')?.buffer) {\n          const bufferRadius = this.ol.getView().get('options_').buffer.bufferRadius;\n          this.bufferGeom = new olCircle(coordinates, bufferRadius);\n          const bufferStroke = this.ol.getView().get('options_').buffer.bufferStroke;\n          const bufferFill = this.ol.getView().get('options_').buffer.bufferFill;\n\n          let bufferText;\n          if (this.ol.getView().get('options_').buffer.showBufferRadius) {\n            bufferText = bufferRadius.toString() + 'm';\n          } else {\n            bufferText = '';\n          }\n\n          this.bufferFeature = new olFeature(this.bufferGeom);\n          this.bufferFeature.setId('bufferFeature');\n          this.bufferFeature.set('bufferStroke', bufferStroke);\n          this.bufferFeature.set('bufferFill', bufferFill);\n          this.bufferFeature.set('bufferText', bufferText);\n          this.buffer.addOlFeature(this.bufferFeature, FeatureMotion.None);\n        }\n        if (first) {\n          this.viewController.zoomToExtent(accuracyExtent as [number, number, number, number]);\n          this.positionFollower = !this.positionFollower;\n        }\n      } else if (first) {\n        const view = this.ol.getView();\n        view.setCenter(coordinates);\n        view.setZoom(14);\n      }\n      if (track !== true && this.alwaysTracking !== true) {\n        this.unsubscribeGeolocate();\n      }\n      first = false;\n    });\n  }\n\n  unsubscribeGeolocate() {\n    this.stopGeolocation();\n    if (this.geolocation$$) {\n      this.geolocation$$.unsubscribe();\n      this.geolocation$$ = undefined;\n    }\n  }\n\n  private startGeolocation() {\n    if (!this.geolocation) {\n      this.geolocation = new olGeolocation({\n        trackingOptions: {\n          enableHighAccuracy: true\n        },\n        projection: this.projection,\n        tracking: true\n      });\n\n      this.geolocation.on('change', (evt) => {\n        this.geolocation$.next(this.geolocation);\n      });\n    } else {\n      this.geolocation.setTracking(true);\n    }\n  }\n\n  private stopGeolocation() {\n    if (this.geolocation) {\n      this.geolocation.setTracking(false);\n    }\n  }\n\n  onOfflineToggle(offline: boolean) {\n    this.offlineButtonToggle$.next(offline);\n  }\n}\n","import {\n  Component,\n  Input,\n  OnInit,\n  AfterViewInit,\n  OnDestroy\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { SubjectStatus } from '@igo2/utils';\nimport { ActivityService } from '@igo2/core';\n\nimport { IgoMap } from '../shared/map';\nimport { MapControlsOptions, MapViewOptions } from '../shared/map.interface';\n\n@Component({\n  selector: 'igo-map-browser',\n  templateUrl: './map-browser.component.html',\n  styleUrls: ['./map-browser.component.scss']\n})\nexport class MapBrowserComponent implements OnInit, AfterViewInit, OnDestroy {\n  private activityId: string;\n  private status$$: Subscription;\n\n  @Input() map: IgoMap;\n\n  @Input()\n  get view(): MapViewOptions {\n    return this._view;\n  }\n  set view(value: MapViewOptions) {\n    this._view = value;\n    if (this.map !== undefined) {\n      this.map.updateView(value);\n    }\n  }\n  private _view: MapViewOptions;\n\n  get controls(): MapControlsOptions {\n    return this._controls;\n  }\n\n  set controls(value: MapControlsOptions) {\n    this._controls = value;\n    if (this.map !== undefined) {\n      this.map.updateControls(value);\n    }\n  }\n  private _controls: MapControlsOptions;\n\n  public id = `igo-map-target-${new Date().getTime()}`;\n\n  constructor(private activityService: ActivityService) {}\n\n  ngOnInit() {\n    this.status$$ = this.map.status$.subscribe(status =>\n      this.handleStatusChange(status)\n    );\n  }\n\n  ngAfterViewInit() {\n    this.map.setTarget(this.id);\n  }\n\n  ngOnDestroy() {\n    this.map.setTarget(undefined);\n    this.activityService.unregister(this.activityId);\n    this.status$$.unsubscribe();\n  }\n\n  private handleStatusChange(status: SubjectStatus) {\n    if (status === SubjectStatus.Working && this.activityId === undefined) {\n      this.activityId = this.activityService.register();\n    } else if (status === SubjectStatus.Done && this.activityId !== undefined) {\n      this.activityService.unregister(this.activityId);\n      this.activityId = undefined;\n    }\n  }\n}\n","<div [id]=\"id\" class=\"igo-map-browser-target\"></div>\n<ng-content></ng-content>\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  Self,\n  OnInit\n} from '@angular/core';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\n\nimport { transform } from 'ol/proj';\nimport { MediaService } from '@igo2/core';\nimport { unByKey } from 'ol/Observable';\n/**\n * This directive return the pointer coordinate (on click or pointermove)\n * in [longitude, latitude], delayed by in input (pointerMoveDelay)\n * to avoid too many emitted values.\n */\n@Directive({\n  selector: '[igoPointerPosition]'\n})\nexport class PointerPositionDirective implements OnInit, OnDestroy {\n\n  private lastTimeoutRequest;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * Delay before emitting an event\n   */\n  @Input() pointerPositionDelay: number = 1000;\n\n  /**\n   * Event emitted when the pointer move, delayed by pointerMoveDelay\n   */\n  @Output() pointerPositionCoord = new EventEmitter<[number, number]>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService\n  ) { }\n\n  /**\n   * Start listening to pointermove\n   * @internal\n   */\n  ngOnInit(): void {\n    this.listenToMapPointerMove();\n    this.listenToMapClick();\n  }\n\n  /**\n   * Stop listening to pointermove\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unlistenToMapClick();\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, this.pointerPositionDelay)\n    );\n  }\n\n  /**\n   * On map click\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, 0)\n    );\n  }\n\n  /**\n   * Stop listening for map pointermove\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * emit delayed coordinate (longitude, latitude array) based on pointerMoveDelay or on click\n   * @param event OL map browser pointer event\n   */\n  private onPointerEvent(event: MapBrowserPointerEvent<any>, delay: number) {\n    if (event.dragging || this.mediaService.isTouchScreen()) {return; }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n\n    const lonlat = transform(event.coordinate, this.mapProjection, 'EPSG:4326') as [number, number];\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.pointerPositionCoord.emit(lonlat);\n    }, delay);\n  }\n}\n","import olLayerImage from 'ol/layer/Image';\nimport olSourceImage from 'ol/source/Image';\n\nimport { AuthInterceptor } from '@igo2/auth';\n\nimport { ImageWatcher } from '../../utils';\nimport { IgoMap } from '../../../map';\n\nimport { WMSDataSource } from '../../../datasource/shared/datasources/wms-datasource';\n\nimport { Layer } from './layer';\nimport { ImageLayerOptions } from './image-layer.interface';\nimport { ImageArcGISRestDataSource } from '../../../datasource/shared/datasources/imagearcgisrest-datasource';\nimport { LanguageService, MessageService } from '@igo2/core';\n\nexport class ImageLayer extends Layer {\n  public dataSource: WMSDataSource | ImageArcGISRestDataSource;\n  public options: ImageLayerOptions;\n  public ol: olLayerImage<olSourceImage>;\n\n  private watcher: ImageWatcher;\n\n  constructor(\n    options: ImageLayerOptions,\n    public messageService: MessageService,\n    private languageService: LanguageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new ImageWatcher(this, this.messageService, this.languageService);\n    this.status$ = this.watcher.status$;\n    this.status$.subscribe(valStatus => {\n      if (valStatus === 0) {\n        this.olLoadingProblem = true;\n      }\n    });\n  }\n\n  protected createOlLayer(): olLayerImage<olSourceImage> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceImage\n    });\n\n    const image = new olLayerImage(olOptions);\n    if (this.authInterceptor) {\n      (image.getSource() as any).setImageLoadFunction((tile, src) => {\n        this.customLoader(tile, src, this.authInterceptor, this.messageService, this.languageService);\n      });\n    }\n\n    return image;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  private customLoader(tile, src: string, interceptor: AuthInterceptor, messageService: MessageService, languageService: LanguageService) {\n    const xhr = new XMLHttpRequest();\n\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(src);\n    let url = src;\n    if (alteredUrlWithKeyAuth) {\n      url = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', url);\n    const intercepted = interceptor.interceptXhr(xhr, url);\n    if (!intercepted) {\n      xhr.abort();\n      tile.getImage().src = url;\n      return;\n    }\n\n    xhr.responseType = 'arraybuffer';\n\n    xhr.onload = function() {\n      const arrayBufferView = new Uint8Array((this as any).response);\n      const responseString = new TextDecoder().decode(arrayBufferView);\n      if (responseString.includes('ServiceExceptionReport')) {\n        messageService.error(languageService.translate.instant(\n          'igo.geo.dataSource.optionsApiUnavailable'\n        ),\n        languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        ));\n      }\n      const blob = new Blob([arrayBufferView], { type: 'image/png' });\n      const urlCreator = window.URL;\n      const imageUrl = urlCreator.createObjectURL(blob);\n      tile.getImage().src = imageUrl;\n    };\n    xhr.send();\n  }\n}\n","import olLayerTile from 'ol/layer/Tile';\nimport olSourceTile from 'ol/source/Tile';\nimport Tile from 'ol/Tile';\n\nimport { TileWatcher } from '../../utils';\nimport { IgoMap } from '../../../map';\n\nimport { OSMDataSource } from '../../../datasource/shared/datasources/osm-datasource';\nimport { WMTSDataSource } from '../../../datasource/shared/datasources/wmts-datasource';\nimport { XYZDataSource } from '../../../datasource/shared/datasources/xyz-datasource';\nimport { CartoDataSource } from '../../../datasource/shared/datasources/carto-datasource';\nimport { TileArcGISRestDataSource } from '../../../datasource/shared/datasources/tilearcgisrest-datasource';\nimport { TileDebugDataSource } from '../../../datasource/shared/datasources/tiledebug-datasource';\n\nimport { Layer } from './layer';\nimport { TileLayerOptions } from './tile-layer.interface';\n\nimport { MessageService } from '@igo2/core';\nimport { AuthInterceptor } from '@igo2/auth';\nexport class TileLayer extends Layer {\n  public dataSource:\n    | OSMDataSource\n    | WMTSDataSource\n    | XYZDataSource\n    | TileDebugDataSource\n    | CartoDataSource\n    | TileArcGISRestDataSource;\n  public options: TileLayerOptions;\n  public ol: olLayerTile<olSourceTile>;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: TileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor) {\n    super(options, messageService);\n\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerTile<olSourceTile> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol\n    });\n    const tileLayer = new olLayerTile(olOptions);\n    const tileSource = tileLayer.getSource();\n    tileSource.setTileLoadFunction((tile: Tile, url: string) => {\n      this.customLoader(tile, url, this.authInterceptor);\n    });\n\n    return tileLayer;\n  }\n\n  /**\n   * Custom loader for tile layer.\n   * @internal\n   * @param tile the current tile\n   * @param url the url string or function to retrieve the data\n   */\n  customLoader(tile, url: string, interceptor: AuthInterceptor ) {\n\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    tile.getImage().src = modifiedUrl;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","import olLayerVectorTile from 'ol/layer/VectorTile';\nimport olSourceVectorTile from 'ol/source/VectorTile';\n\nimport { MVTDataSource } from '../../../datasource/shared/datasources/mvt-datasource';\n\nimport { Layer } from './layer';\nimport { VectorTileLayerOptions } from './vectortile-layer.interface';\nimport { TileWatcher } from '../../utils';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { IgoMap } from '../../../map';\nimport { MessageService } from '@igo2/core';\nimport VectorTile from 'ol/VectorTile';\n\nexport class VectorTileLayer extends Layer {\n  public dataSource: MVTDataSource;\n  public options: VectorTileLayerOptions;\n  public ol: olLayerVectorTile;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: VectorTileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVectorTile {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVectorTile\n    });\n\n    const vectorTile = new olLayerVectorTile(olOptions);\n    const vectorTileSource = vectorTile.getSource() as olSourceVectorTile;\n\n    vectorTileSource.setTileLoadFunction((tile: VectorTile, url: string) => {\n      const loader = this.customLoader(url, tile.getFormat(), this.authInterceptor, tile.onLoad.bind(tile));\n      if (loader) {\n        tile.setLoader(loader);\n      }\n    }\n    );\n\n    return vectorTile;\n  }\n\n  /**\n   * Custom loader for vector tile layer. Modified from the loadFeaturesXhr function in ol\\featureloader.js\n   * @internal\n   * @param url the url string or function to retrieve the data\n   * @param format the format of the tile\n   * @param interceptor the interceptor of the data\n   * @param success On success event action to trigger\n   * @param failure On failure event action to trigger TODO\n   */\n  customLoader(url, format, interceptor, success, failure?) {\n    return ((extent, resolution, projection) => {\n      const xhr = new XMLHttpRequest();\n      let modifiedUrl = url;\n      if (typeof url !== 'function') {\n        const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n        if (alteredUrlWithKeyAuth) {\n          modifiedUrl = alteredUrlWithKeyAuth;\n        }\n      } else {\n        modifiedUrl = url(extent, resolution, projection);\n      }\n      xhr.open( 'GET', modifiedUrl);\n      if (interceptor) {\n        interceptor.interceptXhr(xhr, modifiedUrl);\n      }\n\n      if (format.getType() === 'arraybuffer') {\n        xhr.responseType = 'arraybuffer';\n      }\n      xhr.onload = (event) => {\n        if (!xhr.status || xhr.status >= 200 && xhr.status < 300) {\n          const type = format.getType();\n          let source;\n          if (type === 'json' || type === 'text') {\n            source = xhr.responseText;\n          }\n          else if (type === 'xml') {\n            source = xhr.responseXML;\n            if (!source) {\n              source = new DOMParser().parseFromString(xhr.responseText, 'application/xml');\n            }\n          }\n          else if (type === 'arraybuffer') {\n            source = xhr.response;\n          }\n          if (source) {\n            success.call(this, format.readFeatures(source, {\n              extent,\n              featureProjection: projection\n            }), format.readProjection(source));\n          }\n          else {\n            // TODO\n            failure.call(this);\n          }\n        } else {\n          // TODO\n          failure.call(this);\n        }\n      };\n      xhr.onerror = () => {\n        // TODO\n        failure.call(this);\n      };\n      xhr.send();\n    });\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","import {\n    Directive,\n    Input,\n    OnDestroy,\n    Self,\n    OnInit,\n    HostListener\n  } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport type { default as OlMapBrowserEvent } from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport olFeature from 'ol/Feature';\nimport * as olstyle from 'ol/style';\nimport * as olgeom from 'ol/geom';\nimport * as olLayer from 'ol/layer';\n\nimport { EntityStore } from '@igo2/common';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { VectorLayer, Layer } from '../../layer/shared/layers';\nimport { take } from 'rxjs/operators';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\nimport { MediaService } from '@igo2/core';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { unByKey } from 'ol/Observable';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoHoverFeature]'\n})\nexport class HoverFeatureDirective implements OnInit, OnDestroy {\n\n  public store: FeatureStore<Feature>;\n  private pointerHoverFeatureStore: EntityStore<any> = new EntityStore<any>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private singleClickMapListener;\n\n  private hoverFeatureId: string = 'hoverFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoHoverFeatureDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoHoverFeatureEnabled: boolean = false;\n\n  @HostListener('mouseout')\n  mouseout() {\n    clearTimeout(this.lastTimeoutRequest);\n    this.clearLayer();\n  }\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService,\n    private styleService: StyleService,\n  ) { }\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.listenToMapPointerMove();\n    this.subscribeToPointerStore();\n    this.listenToMapClick();\n\n    this.map.status$.pipe(take(1)).subscribe(() => {\n      this.store = new FeatureStore<Feature>([], {map: this.map});\n      this.initStore();\n    });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers: Layer[]) => {\n      if (this.store && !layers.find(l => l.id === 'hoverFeatureId')) {\n        this.initStore();\n      }\n    });\n\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore(layerSource?: Layer) {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      id : 'hoverFeatureId',\n      title: 'hoverFeature',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: hoverFeatureMarker\n    });\n    tryBindStoreLayer(store, layer);\n  }\n\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unlistenToMapSingleClick();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerHoverFeatureStore.entities$.subscribe(resultsUnderPointerPosition => {\n      this.entitiesToPointerOverlay(resultsUnderPointerPosition);\n    });\n  }\n\n  /**\n   * convert store entities to a pointer position overlay with label summary on.\n   * @param event OL map browser pointer event\n   */\n  private entitiesToPointerOverlay(resultsUnderPointerPosition: any[]) {\n\n    this.addFeatureOverlay(resultsUnderPointerPosition);\n\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: OlMapBrowserEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n   /**\n    * On map singleclick\n    */\n  private listenToMapClick() {\n    this.singleClickMapListener = this.map.ol.on(\n      'singleclick',\n      (event: OlMapBrowserEvent<any>) => this.onMapSingleClickEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map singleclick\n   * @internal\n   */\n  private unlistenToMapSingleClick() {\n    unByKey(this.singleClickMapListener);\n    this.singleClickMapListener = undefined;\n  }\n\n  /**\n   * Trigger clear layer on singleclick.\n   * @param event OL map browser singleclick event\n   */\n  private onMapSingleClickEvent(event: OlMapBrowserEvent<any>){\n    this.clearLayer();\n  }\n\n  /**\n   * Trigger hover when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: OlMapBrowserEvent<any>) {\n    if (\n      event.dragging || !this.igoHoverFeatureEnabled ||\n      this.mediaService.isTouchScreen()) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n\n    const pixel = this.map.ol.getPixelFromCoordinate(event.coordinate);\n    this.lastTimeoutRequest = setTimeout(() => {\n\n      this.map.ol.forEachFeatureAtPixel(pixel, function(f, l) {\n        if (f.get('hoverSummary') === undefined) {\n          const igoLayer: VectorLayer = this.map.getLayerByOlUId(l.ol_uid);\n          this.setLayerStyleFromOptions(igoLayer, f);\n          this.pointerHoverFeatureStore.load([{layer: igoLayer, feature: f}]);\n        }\n        return true;\n      }.bind(this));\n    }, this.igoHoverFeatureDelay);\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addFeatureOverlay(results) {\n\n    if (results.length > 0 ) {\n\n      results = results[0];\n      this.clearLayer();\n      let geom = this.getGeometry(results.feature) as any;\n\n      // si vector tile, merge avec les polygones voisins possiblement meme entité\n      if (results.layer.ol instanceof olLayer.VectorTile) {\n        geom = [geom];\n        const neighbourCollection = this.getSameFeatureNeighbour(results.feature, results.layer);\n\n        neighbourCollection.forEach( (n) => {\n          geom.push(n.getGeometry());\n        });\n      }\n\n      const feature = new olFeature({\n        geometry: geom instanceof Array ? new olgeom.GeometryCollection(geom) : geom,\n        meta: {id: this.hoverFeatureId},\n        hoverSummary: this.getHoverSummary(results.feature.getProperties())\n      });\n\n      this.store.setLayerOlFeatures([feature], FeatureMotion.None);\n    }\n  }\n\n  private setLayerStyleFromOptions(igoLayer: VectorLayer, feat) {\n    if ( igoLayer.options?.styleByAttribute?.hoverStyle) {\n      this.store.layer.ol.setStyle(this.styleService.createStyleByAttribute(feat, igoLayer.options.styleByAttribute.hoverStyle));\n    } else {\n      this.store.layer.ol.setStyle(hoverFeatureMarker);\n    }\n  }\n\n  private getHoverSummary(properties): string{\n    let summary = '';\n    for (const [key, value] of Object.entries(properties)) {\n      summary += `${key}: ${value}` + '\\n';\n    }\n    return summary;\n  }\n\n  private getGeometry(feature): olgeom.Geometry {\n    let geom;\n    if (!feature.getOrientedFlatCoordinates) {\n      geom = feature.getGeometry();\n    } else {\n\n      const coords = feature.getOrientedFlatCoordinates();\n      const flatCoords = [];\n\n      coords.forEach((c, idx) => {\n        if (idx % 2 === 0) {\n          flatCoords.push([parseFloat(coords[idx]), parseFloat(coords[idx + 1])]);\n        }\n      });\n\n      // TODO: test MultiX\n      switch (feature.getType()) {\n        case 'Point':\n          geom = new olgeom.Point(flatCoords);\n          break;\n        case 'Polygon':\n          geom = new olgeom.Polygon([flatCoords]);\n          break;\n        case 'LineString':\n          geom = new olgeom.LineString([flatCoords]);\n          break;\n      }\n    }\n\n    return geom;\n  }\n\n  private getSameFeatureNeighbour(feature, layer, neighbourCollection: olFeature<olgeom.Geometry>[] = []) {\n\n    if (neighbourCollection.length === 0) {\n      neighbourCollection.push(\n        new olFeature({\n          geometry: this.getGeometry(feature),\n          meta: {id: this.hoverFeatureId}\n        })\n      );\n    }\n\n    const toDoNeighbour = [];\n    const neighbourFeatures = layer.ol.getSource().getFeaturesInExtent(feature.getGeometry().getExtent());\n\n    neighbourFeatures.forEach(f => {\n\n      const checkIf = neighbourCollection.find(x => {\n        return x === f;\n      });\n\n      if (f.getId() === feature.getId() && !checkIf) {\n        toDoNeighbour.push(f);\n        neighbourCollection.push(f);\n      }\n    });\n\n    return neighbourCollection.map(f => {\n      return new olFeature({\n        geometry: this.getGeometry(f),\n        meta: {id: this.hoverFeatureId}\n      });\n    });\n  }\n\n  /**\n   * Clear the pointer store features\n   */\n  private clearLayer() {\n    if (this.store) {\n      this.store.clearLayer();\n    }\n  }\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function hoverFeatureMarker(feature: olFeature<olgeom.Geometry>, resolution: number): olstyle.Style[] {\n\n  const olStyleText = new olstyle.Style({\n    text: new olstyle.Text({\n      text: feature.get('hoverSummary'),\n      textAlign: 'left',\n      textBaseline: 'bottom',\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      backgroundFill: new olstyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n      backgroundStroke: new olstyle.Stroke({ color: 'rgba(200, 200, 200, 0.75)', width: 2 }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true,\n      offsetX: 10,\n      offsetY: -10,\n      padding: [2.5, 2.5, 2.5, 2.5]\n    })\n  });\n\n  const olStyle = [olStyleText];\n  switch (feature.getGeometry().getType()) {\n    case 'Point':\n      olStyle.push(new olstyle.Style({\n        image: new olstyle.Circle({\n          radius: 10,\n          stroke: new olstyle.Stroke({\n            color: 'blue',\n            width: 3\n          })\n        })\n      }));\n      break;\n    default:\n      olStyle.push(new olstyle.Style({\n        stroke: new olstyle.Stroke({\n          color: 'white',\n          width: 5\n        })\n      }));\n      olStyle.push(new olstyle.Style({\n        stroke: new olstyle.Stroke({\n          color: 'blue',\n          width: 3\n        })\n      }));\n  }\n\n  return olStyle;\n\n}\n","import { Component, Input } from '@angular/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-zoom-button',\n  templateUrl: './zoom-button.component.html',\n  styleUrls: ['./zoom-button.component.scss']\n})\nexport class ZoomButtonComponent {\n\n  @Input() map: IgoMap;\n\n  @Input() color: string;\n\n  get zoom(): number { return this.map.viewController.getZoom(); }\n\n  get minZoom(): number { return this.map.viewController.olView.getMinZoom() || 1; }\n\n  get maxZoom(): number { return this.map.viewController.olView.getMaxZoom(); }\n\n  constructor() {}\n}\n","<div class=\"igo-zoom-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomIn' | translate: {zoom: zoom + 1}\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom >= maxZoom\"\n    (click)=\"map.viewController.zoomIn()\">\n    <mat-icon svgIcon=\"plus\"></mat-icon>\n  </button>\n\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomOut' | translate: {zoom: zoom - 1}\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom <= minZoom\"\n    (click)=\"map.viewController.zoomOut()\">\n    <mat-icon svgIcon=\"minus\"></mat-icon>\n  </button>\n</div>\n","import { Component, Input } from '@angular/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-geolocate-button',\n  templateUrl: './geolocate-button.component.html',\n  styleUrls: ['./geolocate-button.component.scss']\n})\nexport class GeolocateButtonComponent {\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  constructor() {}\n}\n","<div class=\"igo-geolocate-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.geolocate' | translate\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    (click)=\"map.geolocate()\">\n    <mat-icon svgIcon=\"crosshairs-gps\"></mat-icon>\n  </button>\n</div>\n","<div *ngIf=\"baseLayers.length > 0\"\n     class=\"igo-baselayers-switcher-container\"\n     [ngClass]=\"{'container-expand': expand}\"\n     [@baseLayerSwitcherState]=\"expand ? 'expand' : useStaticIcon ? 'collapseIcon' : 'collapseMap'\"\n     (@baseLayerSwitcherState.start)=\"showButton=false\"\n     (@baseLayerSwitcherState.done)=\"showButton=true\"\n     (click)=\"collapseOrExpand()\">\n\n     <div *ngIf=\"useStaticIcon && !expand && showButton\" class=\"igo-baselayers-switcher-button-container\">\n       <button\n         mat-icon-button\n         [matTooltip]=\"'igo.geo.mapButtons.baselayerSwitcher' | translate\"\n         matTooltipPosition=\"right\"\n         color=\"primary\">\n         <mat-icon svgIcon=\"image-multiple\"></mat-icon>\n       </button>\n     </div>\n\n     <igo-mini-basemap class=\"mat-typography\" *ngFor=\"let baseLayer of baseLayers; let i = index\"\n       [map]=\"map\"\n       [baseLayer]=\"baseLayer\"\n       [title]=\"(baseLayers.length > 2 && !expand) ? ('igo.geo.baselayersSwitcher.title' | translate) : baseLayer.title\"\n       [display]=\"expand || (i === 0 && !useStaticIcon)\"\n       [disabled]=\"!expand && baseLayers.length > 1\">\n     </igo-mini-basemap>\n\n    <div class=\"more-baselayers\">\n      <mat-icon class=\"material-icons mat-icon mat-list-avatar\" color=\"primary\" svgIcon=\"menu-down\"></mat-icon>\n    </div>\n\n</div>\n","import { Component, Input, AfterViewInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { MediaService, Media } from '@igo2/core';\nimport { Layer } from '../../layer';\nimport { IgoMap } from '../shared';\nimport { baseLayersSwitcherSlideInOut } from './baselayers-switcher.animation';\n\n@Component({\n  selector: 'igo-baselayers-switcher',\n  templateUrl: './baselayers-switcher.component.html',\n  styleUrls: ['./baselayers-switcher.component.scss'],\n  animations: [baseLayersSwitcherSlideInOut()]\n})\nexport class BaseLayersSwitcherComponent implements AfterViewInit, OnDestroy {\n  @Input() map: IgoMap;\n  @Input() useStaticIcon: boolean;\n\n  public _baseLayers: Layer[] = [];\n  public expand = false;\n  public showButton = true;\n\n  private layers$$: Subscription;\n\n  constructor(private mediaService: MediaService) {\n    const media = this.mediaService.media$.value;\n    if (media === Media.Mobile && this.useStaticIcon === undefined) {\n      this.useStaticIcon = true;\n    }\n  }\n\n  ngAfterViewInit() {\n    this.layers$$ = this.map.layers$.subscribe(arrayLayers => {\n      this._baseLayers = arrayLayers.filter(l => l.baseLayer);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n\n  collapseOrExpand() {\n    if (this.baseLayers.length > 1 || this.useStaticIcon) {\n      this.expand = !this.expand;\n    } else {\n      this.expand = false;\n    }\n  }\n\n  get baseLayers(): Layer[] {\n    const mapResolution = this.map.viewController.getResolution();\n    const mapZoom = this.map.viewController.getZoom();\n\n    const bl = this._baseLayers.filter(l => {\n      return (\n        (!l.options.maxResolution ||\n          mapResolution <= l.options.maxResolution) &&\n        (!l.options.minResolution || mapResolution >= l.options.minResolution) &&\n        (!l.options.source.options.maxZoom || mapZoom <= l.options.source.options.maxZoom) &&\n        (!l.options.source.options.minZoom || mapZoom >= l.options.source.options.minZoom)\n      );\n    });\n\n    const blHidden = bl.filter(l => !l.visible);\n    return blHidden.length + 1 === bl.length ? blHidden : bl;\n  }\n}\n","import {\n  trigger,\n  state,\n  style,\n  transition,\n  animate,\n  AnimationTriggerMetadata\n} from '@angular/animations';\n\nexport function baseLayersSwitcherSlideInOut(): AnimationTriggerMetadata {\n  return trigger('baseLayerSwitcherState', [\n    state(\n      'collapseIcon',\n      style({\n        height: '40px',\n        width: '40px',\n        overflow: 'hidden'\n      })\n    ),\n    state(\n      'collapseMap',\n      style({\n        height: '85px',\n        overflow: 'hidden'\n      })\n    ),\n    state(\n      'expand',\n      style({\n        overflow: 'hidden'\n      })\n    ),\n    transition('collapse => expand', animate('200ms')),\n    transition('expand => collapse', animate('200ms'))\n  ]);\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, of } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport stylefunction from 'ol-mapbox-style/dist/stylefunction';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport {\n  OSMDataSource,\n  FeatureDataSource,\n  XYZDataSource,\n  TileDebugDataSource,\n  WFSDataSource,\n  WMTSDataSource,\n  WMSDataSource,\n  CartoDataSource,\n  ImageArcGISRestDataSource,\n  ArcGISRestDataSource,\n  TileArcGISRestDataSource,\n  WebSocketDataSource,\n  MVTDataSource,\n  ClusterDataSource\n} from '../../datasource';\n\nimport { DataSourceService } from '../../datasource/shared/datasource.service';\n\nimport {\n  Layer,\n  ImageLayer,\n  ImageLayerOptions,\n  TileLayer,\n  TileLayerOptions,\n  VectorLayer,\n  VectorLayerOptions,\n  AnyLayerOptions,\n  VectorTileLayer,\n  VectorTileLayerOptions\n} from './layers';\n\nimport { StyleService } from './style.service';\nimport { LanguageService, MessageService } from '@igo2/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerService {\n  constructor(\n    private http: HttpClient,\n    private styleService: StyleService,\n    private dataSourceService: DataSourceService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    @Optional() private authInterceptor: AuthInterceptor\n  ) {}\n\n  createLayer(layerOptions: AnyLayerOptions): Layer {\n    if (!layerOptions.source) {\n      return;\n    }\n\n    if (\n      layerOptions.source.options &&\n      layerOptions.source.options._layerOptionsFromSource\n    ) {\n      layerOptions = ObjectUtils.mergeDeep(\n        layerOptions.source.options._layerOptionsFromSource,\n        layerOptions || {}\n      );\n    }\n\n    let layer;\n    switch (layerOptions.source.constructor) {\n      case OSMDataSource:\n      case WMTSDataSource:\n      case XYZDataSource:\n      case TileDebugDataSource:\n      case CartoDataSource:\n      case TileArcGISRestDataSource:\n        layer = this.createTileLayer(layerOptions as TileLayerOptions);\n        break;\n      case FeatureDataSource:\n      case WFSDataSource:\n      case ArcGISRestDataSource:\n      case WebSocketDataSource:\n      case ClusterDataSource:\n        layer = this.createVectorLayer(layerOptions as VectorLayerOptions);\n        break;\n      case ImageArcGISRestDataSource:\n      case WMSDataSource:\n        layer = this.createImageLayer(layerOptions as ImageLayerOptions);\n        break;\n      case MVTDataSource:\n        layer = this.createVectorTileLayer(\n          layerOptions as VectorTileLayerOptions\n        );\n        break;\n      default:\n        break;\n    }\n\n    return layer;\n  }\n\n  createAsyncLayer(layerOptions: AnyLayerOptions, detailedContextUri?: string): Observable<Layer> {\n    if (layerOptions.source) {\n      return new Observable(d => d.next(this.createLayer(layerOptions)));\n    }\n\n    return this.dataSourceService\n      .createAsyncDataSource(layerOptions.sourceOptions, detailedContextUri)\n      .pipe(\n        map(source => {\n          if (source === undefined) {\n            return undefined;\n          }\n          return this.createLayer(Object.assign(layerOptions, { source }));\n        })\n      );\n  }\n\n  private createImageLayer(layerOptions: ImageLayerOptions): ImageLayer {\n    return new ImageLayer(layerOptions, this.messageService, this.languageService, this.authInterceptor);\n  }\n\n  private createTileLayer(layerOptions: TileLayerOptions): TileLayer {\n    return new TileLayer(layerOptions, this.messageService, this.authInterceptor);\n  }\n\n  private createVectorLayer(layerOptions: VectorLayerOptions): VectorLayer {\n    let style;\n    let olLayer;\n    if (layerOptions.style !== undefined) {\n      style = this.styleService.createStyle(layerOptions.style);\n    }\n\n    if (layerOptions.source instanceof ArcGISRestDataSource) {\n      const source = layerOptions.source as ArcGISRestDataSource;\n      style = source.options.params.style;\n    } else if (layerOptions.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = feature => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.styleByAttribute\n        );\n      };\n      olLayer = new VectorLayer(layerOptions, this.messageService, this.authInterceptor);\n    }\n\n    if (layerOptions.source instanceof ClusterDataSource) {\n      const serviceStyle = this.styleService;\n      const baseStyle = layerOptions.clusterBaseStyle;\n      layerOptions.style = feature => {\n        return serviceStyle.createClusterStyle(\n          feature,\n          layerOptions.clusterParam,\n          baseStyle\n        );\n      };\n      olLayer = new VectorLayer(layerOptions, this.messageService, this.authInterceptor);\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!olLayer) {\n      olLayer = new VectorLayer(layerOptionsOl, this.messageService, this.authInterceptor);\n    }\n\n    this.applyMapboxStyle(olLayer, layerOptionsOl as any);\n\n    return olLayer;\n  }\n\n  private createVectorTileLayer(\n    layerOptions: VectorTileLayerOptions\n  ): VectorTileLayer {\n    let style;\n    let olLayer;\n\n    if (layerOptions.style !== undefined) {\n      style = this.styleService.createStyle(layerOptions.style);\n    }\n\n    if (layerOptions.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = feature => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.styleByAttribute\n        );\n      };\n      olLayer = new VectorTileLayer(layerOptions, this.messageService, this.authInterceptor);\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!olLayer) {\n      olLayer = new VectorTileLayer(layerOptionsOl, this.messageService, this.authInterceptor);\n    }\n\n    this.applyMapboxStyle(olLayer, layerOptionsOl);\n    return olLayer;\n  }\n\n  private applyMapboxStyle(layer: Layer, layerOptions: VectorTileLayerOptions) {\n    if (layerOptions.mapboxStyle) {\n      this.getMapboxGlStyle(layerOptions.mapboxStyle.url).subscribe(res => {\n        stylefunction(layer.ol, res, layerOptions.mapboxStyle.source);\n      });\n    }\n  }\n\n  public getMapboxGlStyle(url: string) {\n    return this.http.get(url).pipe(\n      map((res: any) => res),\n      catchError(err => {\n        console.log('No style was found');\n        return of(err);\n      })\n    );\n  }\n}\n","<div class=\"igo-mini-basemap-container\">\n\n  <div *ngIf=\"display\" (click)=\"changeBaseLayer(baseLayer)\">\n    <igo-map-browser [map]=\"basemap\"></igo-map-browser>\n    <div *ngIf='title' class='igo-mini-basemap-title'> {{title}} </div>\n  </div>\n\n</div>\n","import {\n  Component,\n  Input,\n  AfterViewInit,\n  OnDestroy,\n  ApplicationRef\n} from '@angular/core';\n\nimport { Layer, LayerOptions } from '../../layer/shared';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { IgoMap } from '../shared';\n\nimport OlMap from 'ol/Map';\nimport OlView from 'ol/View';\n\n@Component({\n  selector: 'igo-mini-basemap',\n  templateUrl: './mini-basemap.component.html',\n  styleUrls: ['./mini-basemap.component.scss']\n})\nexport class MiniBaseMapComponent implements AfterViewInit, OnDestroy {\n\n  @Input() map: IgoMap;\n  @Input() disabled: boolean;\n  @Input() display: boolean;\n  @Input() title: string;\n\n  @Input()\n  get baseLayer(): Layer {\n    return this._baseLayer;\n  }\n  set baseLayer(value: Layer) {\n    this._baseLayer = value;\n    this.handleBaseLayerChanged(value);\n  }\n  private _baseLayer: Layer;\n\n  public basemap = new IgoMap({\n    controls: {},\n    interactions: false\n  });\n\n  constructor(\n    private layerService: LayerService,\n    private appRef: ApplicationRef\n  ) { }\n\n  ngAfterViewInit() {\n    this.handleMainMapViewChange(this.map.ol.getView());\n    this.map.viewController.olView.on('change', change => {\n      this.handleMainMapViewChange((change.target as OlView));\n    });\n    this.map.ol.on('pointerdrag', change => {\n      this.handleMainMapViewChange((change.target as OlMap).getView());\n    });\n  }\n\n  ngOnDestroy() {\n    this.map.viewController.olView.un('change', change => {\n      this.handleMainMapViewChange((change.target as OlView));\n    });\n    this.map.ol.un('pointerdrag', change => {\n      this.handleMainMapViewChange((change.target as OlMap).getView());\n    });\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (this.disabled) {\n      return;\n    }\n    this.map.changeBaseLayer(baseLayer);\n    this.appRef.tick();\n  }\n\n  private handleMainMapViewChange(mainMapView) {\n    const mainMapViewProperties = mainMapView.getProperties();\n    this.basemap.viewController.olView.setResolution(mainMapViewProperties.resolution);\n    this.basemap.viewController.olView.setRotation(mainMapViewProperties.rotation);\n    this.basemap.viewController.olView.setCenter(this.map.viewController.getCenter());\n  }\n\n  private handleBaseLayerChanged(baselayer: Layer) {\n    this.basemap.removeAllLayers();\n\n    const options: any = Object.assign(\n      Object.create(baselayer.options),\n      baselayer.options,\n      {\n        visible: true,\n        baseLayer: false\n      }\n    );\n\n    const layer = this.layerService.createLayer(options);\n    this.basemap.addLayer(layer);\n    this.handleLinkedBaseLayer(layer);\n  }\n\n  private handleLinkedBaseLayer(baselayer: Layer) {\n    const linkedLayers = baselayer.options.linkedLayers;\n    if (!linkedLayers) {\n      return;\n    }\n    const currentLinkedId = linkedLayers.linkId;\n    const currentLinks = linkedLayers.links;\n    const isParentLayer = currentLinks ? true : false;\n    if (isParentLayer && currentLinkedId === baselayer.options.linkedLayers.linkId) {\n      // search for child layers\n      currentLinks.map(link => {\n        link.linkedIds.map(linkedId => {\n          const layerToApply = this.map.layers.find(l => l.options.linkedLayers?.linkId === linkedId);\n          if (layerToApply) {\n            const linkedLayerOptions: any = Object.assign(\n              Object.create(layerToApply.options),\n              layerToApply.options,\n              {\n                zIndex: 9000,\n                visible: true,\n                baseLayer: false,\n              } as LayerOptions\n            );\n            this.basemap.addLayer(this.layerService.createLayer(linkedLayerOptions));\n          }\n        });\n      });\n    }\n  }\n}\n","<div *ngIf=\"rotated && !showIfNoRotation\" class=\"igo-rotation-button-container\"\n  [matTooltip]=\"rotated ? ('igo.geo.mapButtons.resetRotation' | translate): ('igo.geo.mapButtons.tipRotation' | translate)\"\n  matTooltipPosition=\"left\">\n  <button mat-icon-button matTooltipPosition=\"left\" [color]=\"color\" [disabled]=\"!rotated\"\n    (click)=\"map.viewController.resetRotation()\">\n    <mat-icon [ngStyle]=\"rotationStyle(map.viewController.getRotation())\" svgIcon=\"navigation\">\n    </mat-icon>\n  </button>\n</div>\n\n<div *ngIf=\"showIfNoRotation\" class=\"igo-rotation-button-container\"\n  [matTooltip]=\"rotated ? ('igo.geo.mapButtons.resetRotation' | translate): ('igo.geo.mapButtons.tipRotation' | translate)\"\n  matTooltipPosition=\"left\">\n  <button mat-icon-button matTooltipPosition=\"left\" [color]=\"color\" [disabled]=\"!rotated\"\n    (click)=\"map.viewController.resetRotation()\">\n    <mat-icon [ngStyle]=\"rotationStyle(map.viewController.getRotation())\" svgIcon=\"navigation\">\n    </mat-icon>\n  </button>\n</div>","import { Component, Input } from '@angular/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-rotation-button',\n  templateUrl: './rotation-button.component.html',\n  styleUrls: ['./rotation-button.component.scss']\n})\nexport class RotationButtonComponent {\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get showIfNoRotation(): boolean {\n    return this._showIfNoRotation;\n  }\n  set showIfNoRotation(value: boolean) {\n    this._showIfNoRotation = value;\n  }\n  private _showIfNoRotation: boolean;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  get rotated(): boolean {\n    return this.map.viewController.getRotation() !== 0;\n  }\n\n  constructor() {}\n\n  rotationStyle(radians): {} {\n    const rotation = 'rotate(' + radians + 'rad)';\n    return {\n      transform: rotation\n    };\n  }\n}\n","export enum CatalogItemType {\n  Layer = 'layer',\n  Group = 'group'\n}\n\nexport enum TypeCatalog {\n  wms, wmts, baselayers, arcgisrest, tilearcgisrest, imagearcgisrest, composite\n}\n\nexport type TypeCatalogStrings = keyof typeof TypeCatalog;\n","import { Observable } from 'rxjs';\n\nimport { TooltipType } from '../../layer';\nimport { TimeFilterOptions } from '../../filter';\nimport { QueryFormat, QueryHtmlTarget } from '../../query';\n\nimport { ICatalog, ICompositeCatalog , CatalogItem, CatalogItemGroup } from './catalog.interface';\nimport { CatalogService } from './catalog.service';\nimport { TypeCatalog, TypeCatalogStrings } from './catalog.enum';\n\nexport abstract class Catalog implements ICatalog {\n\n    // ICatalog -----------------------------\n    id: string;\n    title: string;\n    url: string;\n    removable?: boolean;\n    externalProvider?: boolean;\n    abstract?: string;\n    forcedProperties?: any[];\n    items?: CatalogItem[];\n    type?: TypeCatalogStrings;\n    version?: string;\n    matrixSet?: string;\n    requestEncoding?: string;\n    regFilters?: string[];\n    groupImpose?: CatalogItemGroup;\n    groupSeparator?: string;\n    timeFilter?: TimeFilterOptions;\n    queryFormat?: QueryFormat;\n    queryHtmlTarget?: QueryHtmlTarget;\n    queryParams?: { [key: string]: string; };\n    sourceOptions?: { [key: string]: any; };\n    count?: number;\n    tooltipType?: TooltipType.ABSTRACT | TooltipType.TITLE;\n    sortDirection?: 'asc' | 'desc';\n    setCrossOriginAnonymous?: boolean;\n    showLegend?: boolean;\n    // ICatalog -----------------------------\n\n    protected catalogService: CatalogService;\n\n    constructor(options: Catalog, service: CatalogService) {\n        Object.assign(this, options);\n        this.catalogService = service;\n    }\n\n    public abstract collectCatalogItems(): Observable<CatalogItem[]>;\n}\n\nclass WMSCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.wms];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogWMSLayerItems(this);\n    }\n}\n\nclass WMTSCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.wmts];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogWMTSLayerItems(this);\n    }\n}\n\nclass BaselayersCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.baselayers];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItemGroup[]> {\n        return this.catalogService.loadCatalogBaseLayerItems(this);\n    }\n}\n\nclass ArcGISRestCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.arcgisrest];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems() {\n        return this.catalogService.loadCatalogArcGISRestItems(this);\n    }\n}\n\nclass TileOrImageArcGISRestCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService, typeCatalog: TypeCatalog) {\n        super(options, service);\n        this.type = TypeCatalog[TypeCatalog[typeCatalog]];\n    }\n\n    public collectCatalogItems() {\n        return this.catalogService.loadCatalogArcGISRestItems(this);\n    }\n}\n\nexport class CompositeCatalog extends Catalog implements ICompositeCatalog {\n    composite: ICatalog[];\n\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.composite];\n        this.type = TypeCatalog[sType];\n        this.url = null;\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogCompositeLayerItems(this);\n    }\n}\n\nexport class CatalogFactory {\n\n    public static createInstanceCatalog(options: Catalog, service: CatalogService): Catalog {\n\n        let catalog: Catalog;\n        if (options.hasOwnProperty('composite')) {\n            catalog = new CompositeCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.baselayers]) {\n            catalog = new BaselayersCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.arcgisrest]) {\n            catalog = new ArcGISRestCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.tilearcgisrest]) {\n            catalog = new TileOrImageArcGISRestCatalog(options, service, TypeCatalog.tilearcgisrest);\n        } else if (options.type === TypeCatalog[TypeCatalog.imagearcgisrest]) {\n            catalog = new TileOrImageArcGISRestCatalog(options, service, TypeCatalog.imagearcgisrest);\n        } else if (options.type === TypeCatalog[TypeCatalog.wmts]) {\n            catalog = new WMTSCatalog(options, service);\n        } else {\n            catalog = new WMSCatalog(options, service);\n        }\n\n        return catalog;\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, of } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\n\nimport * as striptags_ from 'striptags';\n\nimport * as olformat from 'ol/format';\nimport * as olextent from 'ol/extent';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\nimport olFeature from 'ol/Feature';\nimport * as olgeom from 'ol/geom';\n\nimport { uuid } from '@igo2/utils';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport {\n  WMSDataSource,\n  CartoDataSource,\n  TileArcGISRestDataSource,\n  WMSDataSourceOptions,\n  ImageArcGISRestDataSource\n} from '../../datasource';\n\nimport {\n  QueryFormat,\n  QueryFormatMimeType,\n  QueryHtmlTarget\n} from './query.enums';\nimport {\n  QueryOptions,\n  QueryableDataSource,\n  QueryableDataSourceOptions\n} from './query.interfaces';\nimport { MapExtent } from '../../map/shared/map.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class QueryService {\n  public queryEnabled = true;\n\n  constructor(private http: HttpClient) {}\n\n  query(layers: Layer[], options: QueryOptions): Observable<Feature[]>[] {\n    return layers\n      .filter((layer: Layer) => layer.visible && layer.isInResolutionsRange)\n      .map((layer: Layer) => this.queryLayer(layer, options));\n  }\n\n  queryLayer(layer: Layer, options: QueryOptions): Observable<Feature[]> {\n    const url = this.getQueryUrl(layer.dataSource, options, false, layer.map.viewController.getExtent());\n    if (!url) {\n      return of([]);\n    }\n\n    if (\n      (layer.dataSource as QueryableDataSource).options.queryFormat ===\n      QueryFormat.HTMLGML2\n    ) {\n      const urlGml = this.getQueryUrl(layer.dataSource, options, true);\n      return this.http.get(urlGml, { responseType: 'text' }).pipe(\n        mergeMap(gmlRes => {\n          const imposedGeom = this.mergeGML(gmlRes, url);\n          return this.http\n            .get(url, { responseType: 'text' })\n            .pipe(\n              map(res =>\n                this.extractData(res, layer, options, url, imposedGeom)\n              )\n            );\n        })\n      );\n    }\n\n    const request = this.http.get(url, { responseType: 'text' });\n    return request.pipe(map(res => this.extractData(res, layer, options, url)));\n  }\n\n  private mergeGML(gmlRes, url) {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(gmlRes);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      features = wmsParser.readFeatures(gmlRes);\n    }\n    const olmline = new olgeom.MultiLineString([]);\n    let pts;\n    const ptsArray = [];\n    let olmpoly = new olgeom.MultiPolygon([]);\n    let firstFeatureType;\n    const nbFeatures = features.length;\n\n    // Check if geometry intersect bbox\n    // for geoserver getfeatureinfo response in data projection, not call projection\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const bbox = bboxRaw.split(',');\n    const bboxExtent = olextent.createEmpty();\n    olextent.extend(bboxExtent, bbox);\n    const outBboxExtent = false;\n    features.map(feature => {\n      /*  if (!feature.getGeometry().simplify(100).intersectsExtent(bboxExtent)) {\n        outBboxExtent = true;\n        // TODO: Check to project the geometry?\n      }*/\n      const featureGeometryCoordinates = feature.getGeometry().getCoordinates();\n      const featureGeometryType = feature.getGeometry().getType();\n\n      if (!firstFeatureType && !outBboxExtent) {\n        firstFeatureType = featureGeometryType;\n      }\n      if (!outBboxExtent) {\n        switch (featureGeometryType) {\n          case 'Point':\n            if (nbFeatures === 1) {\n              pts = new olgeom.Point(featureGeometryCoordinates, 'XY');\n            } else {\n              ptsArray.push(featureGeometryCoordinates);\n            }\n            break;\n          case 'LineString':\n            olmline.appendLineString(\n              new olgeom.LineString(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'Polygon':\n            olmpoly.appendPolygon(\n              new olgeom.Polygon(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'MultiPolygon':\n            olmpoly = new olgeom.MultiPolygon(featureGeometryCoordinates, 'XY');\n            break;\n          default:\n            return;\n        }\n      }\n    });\n\n    let olmpts;\n    if (ptsArray.length === 0 && pts) {\n      olmpts = {\n        type: pts.getType(),\n        coordinates: pts.getCoordinates()\n      };\n    } else {\n      olmpts = {\n        type: 'Polygon',\n        coordinates: [this.convexHull(ptsArray)]\n      };\n    }\n\n    switch (firstFeatureType) {\n      case 'LineString':\n        return {\n          type: olmline.getType(),\n          coordinates: olmline.getCoordinates()\n        };\n      case 'Point':\n        return olmpts;\n      case 'Polygon':\n        return {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n      case 'MultiPolygon':\n        return {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n      default:\n        return;\n    }\n  }\n\n  cross(a, b, o) {\n    return (a[0] - o[0]) * (b[1] - o[1]) - (a[1] - o[1]) * (b[0] - o[0]);\n  }\n\n  /**\n   * @param points An array of [X, Y] coordinates\n   * This method is use instead of turf.js convexHull because Turf needs at least 3 point to make a hull.\n   * https://en.wikibooks.org/wiki/Algorithm_Implementation/Geometry/Convex_hull/Monotone_chain#JavaScript\n   */\n  convexHull(points) {\n    points.sort((a, b) => {\n      return a[0] === b[0] ? a[1] - b[1] : a[0] - b[0];\n    });\n\n    const lower = [];\n    for (const point of points) {\n      while (\n        lower.length >= 2 &&\n        this.cross(lower[lower.length - 2], lower[lower.length - 1], point) <= 0\n      ) {\n        lower.pop();\n      }\n      lower.push(point);\n    }\n\n    const upper = [];\n    for (let i = points.length - 1; i >= 0; i--) {\n      while (\n        upper.length >= 2 &&\n        this.cross(\n          upper[upper.length - 2],\n          upper[upper.length - 1],\n          points[i]\n        ) <= 0\n      ) {\n        upper.pop();\n      }\n      upper.push(points[i]);\n    }\n\n    upper.pop();\n    lower.pop();\n    return lower.concat(upper);\n  }\n\n  private extractData(\n    res,\n    layer: Layer,\n    options: QueryOptions,\n    url: string,\n    imposedGeometry?\n  ): Feature[] {\n    const queryDataSource = layer.dataSource as QueryableDataSource;\n\n    const allowedFieldsAndAlias = this.getAllowedFieldsAndAlias(layer);\n    let features = [];\n    switch (queryDataSource.options.queryFormat) {\n      case QueryFormat.GML3:\n        features = this.extractGML3Data(\n          res,\n          layer.zIndex,\n          allowedFieldsAndAlias\n        );\n        break;\n      case QueryFormat.JSON:\n      case QueryFormat.GEOJSON:\n      case QueryFormat.GEOJSON2:\n        features = this.extractGeoJSONData(res, layer.zIndex, allowedFieldsAndAlias);\n        break;\n      case QueryFormat.ESRIJSON:\n        features = this.extractEsriJSONData(res, layer.zIndex, allowedFieldsAndAlias);\n        break;\n      case QueryFormat.TEXT:\n        features = this.extractTextData(res);\n        break;\n      case QueryFormat.HTML:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url\n        );\n        break;\n      case QueryFormat.HTMLGML2:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url,\n          imposedGeometry\n        );\n        break;\n      case QueryFormat.GML2:\n      default:\n        features = this.extractGML2Data(res, layer, allowedFieldsAndAlias);\n        break;\n    }\n\n    if (features.length > 0 && features[0].geometry === null) {\n      const geomToAdd = this.createGeometryFromUrlClick(url);\n\n      for (const feature of features) {\n        feature.geometry = geomToAdd;\n      }\n    }\n\n    return features.map((feature: Feature, index: number) => {\n      const mapLabel = feature.properties[queryDataSource.mapLabel];\n\n      let exclude;\n      if (layer.options.sourceOptions?.type === 'wms') {\n        const sourceOptions = layer.options\n          .sourceOptions as WMSDataSourceOptions;\n        exclude = sourceOptions ? sourceOptions.excludeAttribute : undefined;\n      }\n\n      let title = this.getQueryTitle(feature, layer);\n      if (!title && features.length > 1) {\n        title = `${layer.title} (${index + 1})`;\n      } else if (!title) {\n        title = layer.title;\n      }\n\n      const meta = Object.assign({}, feature.meta || {}, {\n        id: uuid(),\n        title,\n        mapTitle: mapLabel,\n        sourceTitle: layer.title,\n        order: 1000 - layer.zIndex,\n        excludeAttribute: exclude\n      });\n\n      return Object.assign(feature, {\n        meta,\n        projection:\n          queryDataSource.options.type === 'carto'\n            ? 'EPSG:4326'\n            : options.projection\n      });\n    });\n  }\n\n  private createGeometryFromUrlClick(url) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const width = parseInt(searchParams.width, 10);\n    const height = parseInt(searchParams.height, 10);\n    const xPosition = parseInt(searchParams.i || searchParams.x, 10);\n    const yPosition = parseInt(searchParams.j || searchParams.y, 10);\n\n    const bbox = bboxRaw.split(',');\n    let threshold =\n      (Math.abs(parseFloat(bbox[0])) - Math.abs(parseFloat(bbox[2]))) * 0.05;\n\n    // for context in degree (EPSG:4326,4269...)\n    if (Math.abs(parseFloat(bbox[0])) < 180) {\n      threshold = 0.045;\n    }\n    const clickx =\n      parseFloat(bbox[0]) +\n      (Math.abs(parseFloat(bbox[0]) - parseFloat(bbox[2])) * xPosition) /\n        width -\n      threshold;\n    const clicky =\n      parseFloat(bbox[1]) +\n      (Math.abs(parseFloat(bbox[1]) - parseFloat(bbox[3])) * yPosition) /\n        height -\n      threshold;\n    const clickx1 = clickx + threshold * 2;\n    const clicky1 = clicky + threshold * 2;\n\n    const wktPoly =\n      'POLYGON((' +\n      clickx +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky +\n      '))';\n\n    const format = new olformat.WKT();\n    const tenPercentWidthGeom = format.readFeature(wktPoly);\n    const f = tenPercentWidthGeom.getGeometry() as any;\n\n    const newGeom = {\n      type: f.getType(),\n      coordinates: f.getCoordinates()\n    };\n\n    return newGeom;\n  }\n\n  private extractGML2Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(res);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      try {\n        features = wmsParser.readFeatures(res);\n      } catch (e) {\n        console.warn(\n          'query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.'\n        );\n      }\n    }\n\n    return features.map(feature =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGML3Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML3();\n    let features = [];\n    try {\n      features = parser.readFeatures(res);\n    } catch (e) {\n      console.warn('query.service: GML3 is not well supported');\n    }\n    return features.map(feature =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGeoJSONData(res, zIndex, allowedFieldsAndAlias?) {\n    let features = [];\n    try {\n      features = JSON.parse(res.replace(/(\\r|\\n)/g, ' ')).features;\n    } catch (e) {\n      console.warn('query.service: Unable to parse geojson', '\\n', res);\n    }\n    features.map(feature => feature.meta = {\n      id: uuid(),\n      order: 1000 - zIndex,\n      alias: allowedFieldsAndAlias\n    });\n    return features;\n  }\n\n  private extractEsriJSONData(res, zIndex, allowedFieldsAndAlias) {\n    if (res) {\n      try {\n        if (JSON.parse(res).error) {\n          return [];\n        }\n      } catch (e) {}\n    }\n    const parser = new olFormatEsriJSON();\n    const features = parser.readFeatures(res);\n\n    return features.map(feature => this.featureToResult(feature, zIndex, allowedFieldsAndAlias));\n  }\n\n  private extractTextData(res) {\n    // TODO\n    return [];\n  }\n\n  private extractHtmlData(\n    res,\n    htmlTarget: QueryHtmlTarget,\n    url,\n    imposedGeometry?\n  ) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const projection = searchParams.crs || searchParams.srs || 'EPSG:3857';\n    const geomToAdd = this.createGeometryFromUrlClick(url);\n\n    if (\n      htmlTarget !== QueryHtmlTarget.BLANK &&\n      htmlTarget !== QueryHtmlTarget.IFRAME\n    ) {\n      htmlTarget = QueryHtmlTarget.IFRAME;\n    }\n\n    const bodyTagStart = res.toLowerCase().indexOf('<body>');\n    const bodyTagEnd = res.toLowerCase().lastIndexOf('</body>') + 7;\n    // replace \\r \\n  and ' ' with '' to validate if the body is really empty. Clear all the html tags from body\n    const striptags = striptags_;\n    const body = striptags(res.slice(bodyTagStart, bodyTagEnd).replace(/(\\r|\\n|\\s)/g, ''));\n    if (body === '' || res === '') {\n      return [];\n    }\n\n    return [\n      {\n        type: FEATURE,\n        projection,\n        properties: { target: htmlTarget, body: res, url },\n        geometry: imposedGeometry || geomToAdd\n      }\n    ];\n  }\n\n  private getQueryParams(url) {\n    const queryString = url.split('?');\n    if (!queryString[1]) {\n      return;\n    }\n    const pairs = queryString[1].split('&');\n\n    const result = {};\n    pairs.forEach(pair => {\n      pair = pair.split('=');\n      result[pair[0]] = decodeURIComponent(pair[1] || '');\n    });\n    return result;\n  }\n\n  public featureToResult(\n    featureOL: olFeature<olgeom.Geometry>,\n    zIndex: number,\n    allowedFieldsAndAlias?\n  ): Feature {\n    const featureGeometry = featureOL.getGeometry() as any;\n    const properties: any = Object.assign({}, featureOL.getProperties());\n    delete properties.geometry;\n    delete properties.GEOMETRIE;\n    delete properties.boundedBy;\n    delete properties.shape;\n    delete properties.SHAPE;\n    delete properties.the_geom;\n    delete properties.geom;\n\n    let geometry;\n    if (featureGeometry) {\n      geometry = {\n        type: featureGeometry.getType(),\n        coordinates: featureGeometry.getCoordinates()\n      };\n    }\n\n    return {\n      type: FEATURE,\n      projection: undefined,\n      properties,\n      geometry,\n      meta: {\n        id: uuid(),\n        order: 1000 - zIndex,\n        alias: allowedFieldsAndAlias\n      }\n    };\n  }\n\n  private getQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    forceGML2 = false,\n    mapExtent?: MapExtent\n  ): string {\n    let url;\n\n    if (datasource.options.queryUrl) {\n      return this.getCustomQueryUrl(datasource, options, mapExtent);\n    }\n\n    switch (datasource.constructor) {\n      case WMSDataSource:\n        const wmsDatasource = datasource as WMSDataSource;\n\n        const WMSGetFeatureInfoOptions = {\n          INFO_FORMAT:\n            wmsDatasource.params.INFO_FORMAT ||\n            this.getMimeInfoFormat(datasource.options.queryFormat),\n          QUERY_LAYERS: wmsDatasource.params.LAYERS,\n          FEATURE_COUNT: wmsDatasource.params.FEATURE_COUNT || '5'\n        };\n\n        if (forceGML2) {\n          WMSGetFeatureInfoOptions.INFO_FORMAT = this.getMimeInfoFormat(\n            QueryFormat.GML2\n          );\n        }\n\n        url = wmsDatasource.ol.getFeatureInfoUrl(\n          options.coordinates,\n          options.resolution,\n          options.projection,\n          WMSGetFeatureInfoOptions\n        );\n        // const wmsVersion =\n        //   wmsDatasource.params.VERSION ||\n        //   wmsDatasource.params.version ||\n        //   '1.3.0';\n        // if (wmsVersion !== '1.3.0') {\n        //   url = url.replace('&I=', '&X=');\n        //   url = url.replace('&J=', '&Y=');\n        // }\n        break;\n      case CartoDataSource:\n        const cartoDatasource = datasource as CartoDataSource;\n        const baseUrl =\n          'https://' +\n          cartoDatasource.options.account +\n          '.carto.com/api/v2/sql?';\n        const format = 'format=GeoJSON';\n        const sql =\n          '&q=' + cartoDatasource.options.config.layers[0].options.sql;\n        const clause =\n          ' WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(';\n        const meters = cartoDatasource.options.queryPrecision\n          ? cartoDatasource.options.queryPrecision\n          : '1000';\n        const coordinates =\n          options.coordinates[0] +\n          ',' +\n          options.coordinates[1] +\n          '),3857),' +\n          meters +\n          '))';\n\n        url = `${baseUrl}${format}${sql}${clause}${coordinates}`;\n        break;\n      case ImageArcGISRestDataSource:\n      case TileArcGISRestDataSource:\n        const tileArcGISRestDatasource = datasource as TileArcGISRestDataSource;\n        const deltaX = Math.abs(mapExtent[0] - mapExtent[2]);\n        const deltaY = Math.abs(mapExtent[1] - mapExtent[3]);\n        const maxDelta = deltaX > deltaY ? deltaX : deltaY;\n        const clickBuffer = maxDelta * 0.005;\n        const threshold = tileArcGISRestDatasource.options.queryPrecision ? tileArcGISRestDatasource.options.queryPrecision : clickBuffer;\n        const extent = olextent.buffer(\n          olextent.boundingExtent([options.coordinates]),\n          threshold\n        );\n        const serviceUrl =\n          tileArcGISRestDatasource.options.url +\n          '/' +\n          tileArcGISRestDatasource.options.layer +\n          '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        url = `${serviceUrl}?${params.join('&')}`;\n        break;\n      default:\n        break;\n    }\n\n    return url;\n  }\n\n  private getMimeInfoFormat(queryFormat: string) {\n    let mime = 'application/vnd.ogc.gml';\n    const keyEnum = Object.keys(QueryFormat).find(\n      key => QueryFormat[key] === queryFormat\n    );\n    if (keyEnum) {\n      mime = QueryFormatMimeType[keyEnum];\n    }\n\n    return mime;\n  }\n\n  getAllowedFieldsAndAlias(layer: any) {\n    let allowedFieldsAndAlias;\n    if (\n      layer.options?.source?.options?.sourceFields &&\n      layer.options.source.options.sourceFields.length >= 1\n    ) {\n      allowedFieldsAndAlias = {};\n      layer.options.source.options.sourceFields.forEach(sourceField => {\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\n        allowedFieldsAndAlias[sourceField.name] = alias;\n      });\n    }\n    return allowedFieldsAndAlias;\n  }\n\n  getQueryTitle(feature: Feature, layer: Layer): string {\n    let title;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\n      }\n    }\n\n    return title;\n  }\n\n  getLabelMatch(feature: Feature, labelMatch): string {\n    let label = labelMatch;\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach(v => {\n      label = label.replace(v[0], feature.properties[v[1]]);\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.properties[labelMatch] || labelMatch;\n    }\n\n    return label;\n  }\n\n  /**\n   * @param datasource QueryableDataSource\n   * @param options QueryOptions\n   * @mapExtent extent of the map when click event\n   *\n   */\n\n  getCustomQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    mapExtent?: MapExtent): string {\n\n      let url = datasource.options.queryUrl.replace(/\\{xmin\\}/g, mapExtent[0].toString())\n      .replace(/\\{ymin\\}/g, mapExtent[1].toString())\n      .replace(/\\{xmax\\}/g, mapExtent[2].toString())\n      .replace(/\\{ymax\\}/g, mapExtent[3].toString())\n      .replace(/\\{x\\}/g, options.coordinates[0].toString())\n      .replace(/\\{y\\}/g, options.coordinates[1].toString())\n      .replace(/\\{resolution\\}/g, options.resolution.toString())\n      .replace(/\\{srid\\}/g, options.projection.replace('EPSG:',''));\n\n      return url;\n    }\n}\n","import OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\n\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { QueryableDataSource } from './query.interfaces';\n\n/**\n * Whether a layer is queryable\n * @param layer Layer\n * @returns True if the layer s squeryable\n */\nexport function layerIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryable === true;\n}\n\n/**\n * Whether an OL layer is queryable\n * @param layer Layer\n * @returns True if the ol layer is queryable\n */\nexport function olLayerIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined ? false : layerIsQueryable(layer);\n}\n\n/**\n * Whether a layer's feature is queryable\n * @param layer Layer\n * @returns True if the layer's feature is queryable\n */\nexport function layerFeatureIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryFeature === true;\n}\n\n/**\n * Whether an OL Vector layer is queryable\n * @param layer Layer\n * @returns True if the ol vector layer is queryable\n */\nexport function olLayerFeatureIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined ? false : (layerIsQueryable(layer) && layerFeatureIsQueryable(layer));\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  AfterViewInit,\n  Self\n} from '@angular/core';\n\nimport { Subscription, Observable, of, zip } from 'rxjs';\nimport { unByKey } from 'ol/Observable';\n\nimport OlFeature from 'ol/Feature';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { EventsKey } from 'ol/events';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { renderFeatureFromOl } from '../../feature/shared/feature.utils';\nimport { featureFromOl } from '../../feature/shared/feature.utils';\nimport { QueryService } from './query.service';\nimport { layerIsQueryable, olLayerFeatureIsQueryable } from './query.utils';\nimport { ctrlKeyDown } from '../../map/shared/map.utils';\nimport { OlDragSelectInteraction } from '../../feature/shared/strategies/selection';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\n\n/**\n * This directive makes a map queryable with a click of with a drag box.\n * By default, all layers are queryable but this can ben controlled at\n * the layer level.\n */\n@Directive({\n  selector: '[igoQuery]'\n})\nexport class QueryDirective implements AfterViewInit, OnDestroy {\n  /**\n   * Subscriptions to ongoing queries\n   */\n  private queries$$: Subscription[] = [];\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * OL drag box interaction\n   */\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  /**\n   * Ol drag box \"end\" event key\n   */\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Whter to query features or not\n   */\n  @Input() queryFeatures: boolean = false;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesHitTolerance: number = 0;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesCondition: (olLayer: OlLayer<OlSource>) => boolean;\n\n  /**\n   * Whether all query should complete before emitting an event\n   */\n  @Input() waitForAllQueries: boolean = true;\n\n  /**\n   * Event emitted when a query (or all queries) complete\n   */\n  @Output() query = new EventEmitter<{\n    features: Feature[] | Feature[][];\n    event: MapBrowserPointerEvent<any>;\n  }>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return (this.component.map as any) as IgoMap;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private queryService: QueryService\n  ) {}\n\n  /**\n   * Start listening to click and drag box events\n   * @internal\n   */\n  ngAfterViewInit() {\n    this.listenToMapClick();\n    this.addDragBoxInteraction();\n  }\n\n  /**\n   * Stop listening to click and drag box events and cancel ongoind requests\n   * @internal\n   */\n  ngOnDestroy() {\n    this.cancelOngoingQueries();\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n  }\n\n  /**\n   * On map click, issue queries\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * Issue queries from a map event and emit events with the results\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    this.cancelOngoingQueries();\n    if (!this.queryService.queryEnabled) {\n      return;\n    }\n\n    const queries$ = [];\n    if (this.queryFeatures) {\n      queries$.push(this.doQueryFeatures(event));\n    }\n\n    const resolution = this.map.ol.getView().getResolution();\n    const queryLayers = this.map.layers.filter(layerIsQueryable);\n    queries$.push(\n      ...this.queryService.query(queryLayers, {\n        coordinates: event.coordinate as [number, number],\n        projection: this.map.projection,\n        resolution\n      })\n    );\n\n    if (queries$.length === 0) {\n      return;\n    }\n\n    if (this.waitForAllQueries) {\n      this.queries$$.push(\n        zip(...queries$).subscribe((results: Feature[][]) => {\n          const features = [].concat(...results);\n          this.query.emit({ features, event });\n        })\n      );\n    } else {\n      this.queries$$ = queries$.map((query$: Observable<Feature[]>) => {\n        return query$.subscribe((features: Feature[]) => {\n          this.query.emit({ features, event });\n        });\n      });\n    }\n  }\n\n  /**\n   * Query features already present on the map\n   * @param event OL map browser pointer event\n   */\n  private doQueryFeatures(\n    event: MapBrowserPointerEvent<any>\n  ): Observable<Feature[]> {\n    const clickedFeatures = [];\n\n    if (event.type === 'singleclick') {\n      this.map.ol.forEachFeatureAtPixel(\n        event.pixel,\n        (featureOL: OlFeature<OlGeometry>, layerOL: any) => {\n          const layer = this.map.getLayerById(layerOL.values_._layer.id);\n          if (featureOL) {\n            if (featureOL.get('features')) {\n              for (const feature of featureOL.get('features')) {\n                const newFeature = featureFromOl(feature, this.map.projection);\n                newFeature.meta = {\n                  title: feature.values_.nom,\n                  id: layerOL.values_._layer.id + '.' + feature.id_,\n                  icon: feature.values_._icon,\n                  sourceTitle: layerOL.values_.title,\n                  alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                  // title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n                };\n                clickedFeatures.push(newFeature);\n              }\n            } else if (featureOL instanceof OlRenderFeature) {\n              const newFeature = renderFeatureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            } else {\n              const newFeature = featureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            }\n          }\n        },\n        {\n          hitTolerance: this.queryFeaturesHitTolerance || 0,\n          layerFilter: this.queryFeaturesCondition\n            ? this.queryFeaturesCondition\n            : olLayerFeatureIsQueryable\n        }\n      );\n    } else if (event.type === 'boxend') {\n      const target = event.target as any;\n      const dragExtent = target.getGeometry().getExtent();\n      this.map.layers\n        .filter(layerIsQueryable)\n        .filter(layer => layer instanceof VectorLayer && layer.visible)\n        .map(layer => {\n          const featuresOL = layer.dataSource.ol as olVectorSource<OlGeometry>;\n          featuresOL.forEachFeatureIntersectingExtent(dragExtent, (olFeature: any) => {\n            const newFeature: Feature = featureFromOl(olFeature, this.map.projection, layer.ol);\n            newFeature.meta = {\n              id: layer.id + '.' + olFeature.getId(),\n              icon: olFeature.values_._icon,\n              sourceTitle: layer.title,\n              alias: this.queryService.getAllowedFieldsAndAlias(layer),\n              title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n            };\n            clickedFeatures.push(newFeature);\n          });\n        });\n    }\n\n\n    return of(clickedFeatures);\n  }\n\n  /**\n   * Cancel ongoing requests, if any\n   */\n  private cancelOngoingQueries() {\n    this.queries$$.forEach((sub: Subscription) => sub.unsubscribe());\n    this.queries$$ = [];\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteractionOnQuery;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteractionOnQuery = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteractionOnQuery === undefined) {\n      olDragSelectInteractionOnQuery = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteractionOnQuery);\n      this.olDragSelectInteraction = olDragSelectInteractionOnQuery;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteractionOnQuery.on(\n      'boxend',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { StorageService } from '@igo2/core';\nimport { SearchResult } from '../search.interfaces';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions,\n  SearchSourceSettings\n} from './source.interfaces';\n\n/**\n * Base search source class\n */\nexport class SearchSource {\n  /**\n   * Search source ID\n   * @internal\n   */\n  static id = '';\n\n  /**\n   * Search source type\n   * @internal\n   */\n  static type = '';\n\n  /**\n   * Search source options\n   * @internal\n   */\n  protected options: SearchSourceOptions;\n\n  /**\n   * Get search source's id\n   * @returns Search source's id\n   */\n  getId(): string {\n    throw new Error('You have to implement the method \"getId\".');\n  }\n  /**\n   * Get search source's type\n   * @returns Search source's type\n   */\n  getType(): string {\n    throw new Error('You have to implement the method \"getType\".');\n  }\n\n  /**\n   * Get search source's default options\n   * @returns Search source default options\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    throw new Error('You have to implement the method \"getDefaultOptions\".');\n  }\n\n  /**\n   * Search source's title\n   */\n  get title(): string {\n    return this.options.title;\n  }\n\n  /**\n   * Whether the search source is available\n   */\n  get available(): boolean {\n    return this.options.available !== false;\n  }\n\n  /**\n   * Whether the search source is enabled\n   */\n  set enabled(value: boolean) {\n    this.options.enabled = value;\n  }\n  get enabled(): boolean {\n    return this.available && this.options.enabled !== false;\n  }\n\n  get showInPointerSummary(): boolean {\n    const showInPointerSummary = this.options.showInPointerSummary;\n    return showInPointerSummary ? showInPointerSummary : false;\n  }\n\n  get showInSettings(): boolean {\n    const showInSettings = this.options.showInSettings;\n    return showInSettings === undefined ? true : showInSettings;\n  }\n\n  /**\n   * Search url\n   */\n  get searchUrl(): string {\n    return this.options.searchUrl;\n  }\n\n  /**\n   * Search query params\n   */\n  get params(): { [key: string]: string } {\n    return this.options.params === undefined ? {} : this.options.params;\n  }\n\n  /**\n   * Search settings\n   */\n  get settings(): SearchSourceSettings[] {\n    return this.options.settings === undefined ? [] : this.options.settings;\n  }\n\n  /**\n   * Set params from selected settings\n   */\n  setParamFromSetting(setting: SearchSourceSettings, saveInStorage = true) {\n    switch (setting.type) {\n      case 'radiobutton':\n        setting.values.forEach(conf => {\n          if (conf.enabled) {\n            this.options.params = Object.assign(this.options.params || {}, {\n              [setting.name]: conf.value\n            });\n          }\n        });\n        break;\n      case 'checkbox':\n        let confValue = '';\n        setting.values\n          .filter(s => s.available !== false)\n          .forEach(conf => {\n            if (conf.enabled) {\n              confValue += conf.value + ',';\n            }\n          });\n        confValue = confValue.slice(0, -1);\n        this.options.params = Object.assign(this.options.params || {}, {\n          [setting.name]: confValue\n        });\n        break;\n    }\n\n    if (saveInStorage && this.storageService) {\n      this.storageService.set(\n        this.getId() + '.options',\n        {params: this.options.params}\n      );\n    }\n  }\n\n  /**\n   * Search results display order\n   */\n  get displayOrder(): number {\n    return this.options.order === undefined ? 99 : this.options.order;\n  }\n\n  constructor(options: SearchSourceOptions, private storageService?: StorageService) {\n    this.options = options;\n    if (this.storageService) {\n      const storageOptions = this.storageService.get(\n        this.getId() + '.options'\n      ) as object;\n      if (storageOptions) {\n        this.options = ObjectUtils.mergeDeep(this.options, storageOptions);\n      }\n    }\n\n    this.options = ObjectUtils.mergeDeep(this.getDefaultOptions(), this.options);\n\n\n    // Set Default Params from Settings\n    this.settings.forEach(setting => {\n      this.setParamFromSetting(setting, false);\n    });\n  }\n\n  /**\n   * Get hashtags valid\n   * @param hashtag hashtag from query\n   */\n  getHashtagsValid(term: string, settingsName: string): string[] {\n    const hashtags = term.match(/(#[A-Za-z]+)/g);\n    if (!hashtags) {\n      return undefined;\n    }\n\n    const searchSourceSetting = this.getSettingsValues(settingsName);\n    const hashtagsValid = [];\n    hashtags.forEach(hashtag => {\n      searchSourceSetting.values.forEach(conf => {\n        const hashtagKey = hashtag.substring(1);\n        if (typeof conf.value === 'string') {\n          const types = conf.value\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n            .split(',');\n          const index = types.indexOf(\n            hashtagKey\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '')\n          );\n          if (index !== -1) {\n            hashtagsValid.push(types[index]);\n          }\n        }\n        if (conf.hashtags && conf.hashtags.indexOf(hashtagKey) !== -1) {\n          hashtagsValid.push(conf.value);\n        }\n      });\n    });\n\n    return hashtagsValid.filter((a, b) => hashtagsValid.indexOf(a) === b);\n  }\n\n  getSettingsValues(search: string): SearchSourceSettings {\n    return this.getDefaultOptions().settings.find(\n      (value: SearchSourceSettings) => {\n        return value.name === search;\n      }\n    );\n  }\n}\n\n/**\n * Search sources that allow searching by text implement this class\n */\nexport interface TextSearch {\n  /**\n   * Search by text\n   * @param term Text\n   * @param options Optional: TextSearchOptions\n   * @returns Observable or search results\n   */\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult[]>;\n}\n\n/**\n * Search sources that allow searching by coordinates implement this class\n */\nexport interface ReverseSearch {\n  /**\n   * Search by text\n   * @param lonLat Coordinates\n   * @param options Optional: ReverseSearchOptions\n   * @returns Observable or search results\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult[]>;\n}\n","import { Injectable, Inject } from '@angular/core';\n\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { SearchSourceOptions } from '../../search/shared/sources/source.interfaces';\n/**\n * Map search source. For now it has no search capability. All it does\n * is act as a placeholder for the map query results' \"search source\".\n */\n@Injectable()\nexport class QuerySearchSource extends SearchSource {\n  static id = 'map';\n  static type = FEATURE;\n\n  constructor(@Inject('options') options: SearchSourceOptions) {\n    super(options);\n  }\n\n  getId(): string {\n    return QuerySearchSource.id;\n  }\n\n  getType(): string {\n    return QuerySearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Carte'\n    };\n  }\n}\n","export class GoogleLinks {\n  static getGoogleMapsCoordLink(lon, lat) {\n    return 'https://www.google.com/maps?q=' + lat + ',' + lon;\n  }\n\n  static getGoogleStreetViewLink(lon, lat) {\n    return 'https://www.google.com/maps?q=&layer=c&cbll=' + lat + ',' + lon;\n  }\n\n  static getGoogleMapsNameLink(name) {\n    const encodedName = encodeURI(name);\n    return 'https://www.google.com/maps?q=' + encodedName;\n  }\n}\n","export class OsmLinks {\n  static getOpenStreetMapLink(lon, lat, zoom: number = 17) {\n    // return 'https://www.google.com/maps?q=' + lat + ',' + lon;\n    return `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=${zoom}/${lat}/${lon}`;\n  }\n\n  static getOpenStreetCamLink(lon, lat, zoom: number = 17) {\n    return `https://openstreetcam.org/map/@${lat},${lon},${zoom}z`;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { EMPTY, Observable, of, zip } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { uuid, ObjectUtils } from '@igo2/utils';\nimport { LanguageService, MessageService, ConfigService } from '@igo2/core';\nimport {\n  CapabilitiesService,\n  WMSDataSourceOptions,\n  WMSDataSourceOptionsParams,\n  WMTSDataSourceOptions,\n  ArcGISRestDataSourceOptions\n} from '../../datasource';\nimport { LayerOptions, ImageLayerOptions } from '../../layer';\nimport { getResolutionFromScale } from '../../map';\n\nimport {\n  CatalogItem,\n  CatalogItemLayer,\n  CatalogItemGroup\n} from './catalog.interface';\nimport { Catalog, CatalogFactory, CompositeCatalog } from './catalog.abstract';\nimport { CatalogItemType, TypeCatalog } from './catalog.enum';\nimport { QueryFormat } from '../../query';\nimport { generateIdFromSourceOptions } from '../../utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CatalogService {\n  constructor(\n    private http: HttpClient,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private capabilitiesService: CapabilitiesService\n  ) {}\n\n  loadCatalogs(): Observable<Catalog[]> {\n    const contextConfig = this.config.getConfig('context') || {};\n    const catalogConfig = this.config.getConfig('catalog') || {};\n    const apiUrl = catalogConfig.url || contextConfig.url;\n    const catalogsFromConfig = catalogConfig.sources || [];\n\n    const observables$ = [];\n\n    if (apiUrl) {\n      // Base layers catalog\n      if (catalogConfig.baseLayers) {\n        const translate = this.languageService.translate;\n        const title = translate.instant('igo.geo.catalog.baseLayers');\n        const baseLayersCatalog = [\n          {\n            id: 'catalog.baselayers',\n            title,\n            url: `${apiUrl}/baselayers`,\n            type: 'baselayers'\n          }\n        ];\n        observables$.push(of(baseLayersCatalog));\n      }\n\n      // Catalogs from API\n      const catalogsFromApi$ = this.http\n        .get<Catalog[]>(`${apiUrl}/catalogs`)\n        .pipe(\n          map((catalogs) =>\n            catalogs.map((c: any) => Object.assign(c, c.options))\n          ),\n          catchError((_response: HttpErrorResponse) => EMPTY)\n        );\n      observables$.push(catalogsFromApi$);\n    }\n\n    // Catalogs from config\n    if (catalogsFromConfig.length > 0) {\n      observables$.push(\n        of(catalogsFromConfig).pipe(\n          map((catalogs: Catalog[]) =>\n            catalogs.map((c) => {\n              if (!c.id) {\n                c.id = uuid();\n              }\n              return c;\n            })\n          )\n        )\n      );\n    }\n\n    return zip(...observables$).pipe(\n      map((catalogs: Catalog[][]) => [].concat.apply([], catalogs))\n    ) as Observable<Catalog[]>;\n  }\n\n  loadCatalogItems(catalog: Catalog): Observable<CatalogItem[]> {\n    let newCatalog: Catalog;\n    newCatalog = CatalogFactory.createInstanceCatalog(catalog, this);\n    return newCatalog.collectCatalogItems();\n  }\n\n  loadCatalogBaseLayerItems(catalog: Catalog): Observable<CatalogItemGroup[]> {\n    return this.getCatalogBaseLayersOptions(catalog).pipe(\n      map((layersOptions: LayerOptions[]) => {\n        const items = layersOptions.map((layerOptions: LayerOptions) => {\n          return {\n            id: generateIdFromSourceOptions(layerOptions.sourceOptions),\n            title: layerOptions.title,\n            type: CatalogItemType.Layer,\n            externalProvider: catalog.externalProvider,\n            options: layerOptions\n          } as CatalogItemLayer;\n        });\n        return [\n          {\n            id: 'catalog.group.baselayers',\n            type: CatalogItemType.Group,\n            externalProvider: catalog.externalProvider,\n            title: catalog.title,\n            items\n          }\n        ];\n      })\n    );\n  }\n\n  private getCatalogBaseLayersOptions(\n    catalog: Catalog\n  ): Observable<LayerOptions[]> {\n    return this.http.get<LayerOptions[]>(catalog.url);\n  }\n\n  loadCatalogWMSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        const items = [];\n        if (!capabilities) {\n          return items;\n        }\n        if (capabilities.Service && capabilities.Service.Abstract && capabilities.Service.Abstract.length) {\n          catalog.abstract = capabilities.Service.Abstract;\n        }\n        const finalLayers = [];\n        this.flattenWmsCapabilities(capabilities.Capability.Layer, 0, finalLayers, catalog.groupSeparator);\n        const capabilitiesCapabilityLayer = Object.assign({}, capabilities.Capability.Layer);\n        capabilitiesCapabilityLayer.Layer = finalLayers.filter(f => f.Layer.length !== 0);\n        this.includeRecursiveItems(\n          catalog,\n          capabilitiesCapabilityLayer,\n          items\n        );\n        return items;\n      })\n    );\n  }\n\n  flattenWmsCapabilities(parent, level = 0, finalLayers, separator = ' / ') {\n    if (!finalLayers.includes(parent.Title)) {\n        const modifiedParent = Object.assign({}, parent);\n        modifiedParent.Layer = [];\n        finalLayers.push(modifiedParent);\n    }\n    for (const layer of parent.Layer) {\n        const modifiedLayer = Object.assign({}, layer);\n        if (level > 0) {\n          modifiedLayer.Title = parent.Title + separator + layer.Title;\n        }\n        if (layer.Layer) {\n            this.flattenWmsCapabilities(modifiedLayer, level + 1, finalLayers, separator);\n        } else {\n            finalLayers.find(ff => ff.Title === parent.Title).Layer.push(layer);\n         }\n    }\n}\n\n  loadCatalogWMTSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => this.getWMTSItems(catalog, capabilities))\n    );\n  }\n\n  loadCatalogArcGISRestItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        return this.getArcGISRESTItems(catalog, capabilities);\n      })\n    );\n  }\n\n  loadCatalogCompositeLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    const compositeCatalog = (catalog as CompositeCatalog).composite;\n\n    const catalogsFromInstance = [] as Catalog[];\n    compositeCatalog.map((component: Catalog) => {\n      component.sortDirection = catalog.sortDirection; // propagate sortDirection with parent value\n      catalogsFromInstance.push(\n        CatalogFactory.createInstanceCatalog(component, this)\n    );\n  }\n    );\n\n    // get CatalogItems for each original Catalog-----------------------------------------------------\n    const request1$ = [];\n    catalogsFromInstance.map((component: Catalog) =>\n      request1$.push(component.collectCatalogItems())\n    );\n\n    // integrate imposed group -----------------------------------------------------\n    let request2$ = [];\n\n    function flatDeepLayer(arr) {\n      return arr.reduce(\n        (acc, val) =>\n          acc.concat(\n            val.type === CatalogItemType.Group ? flatDeepLayer(val.items) : val\n          ),\n        []\n      );\n    }\n\n    if (\n      Object.keys(compositeCatalog).find((k) => compositeCatalog[k].groupImpose)\n    ) {\n      const pushImposeGroup = (item, index) => {\n        const c = catalogsFromInstance[index];\n        const outGroupImpose = Object.assign({}, c.groupImpose);\n        outGroupImpose.address = c.id;\n        outGroupImpose.type = CatalogItemType.Group;\n        outGroupImpose.externalProvider = c.externalProvider;\n        if (outGroupImpose.sortDirection === undefined) {\n          outGroupImpose.sortDirection = c.sortDirection;\n        }\n        outGroupImpose.items = [];\n\n        const flatLayer = flatDeepLayer(item);\n        flatLayer.map(\n          (v) => (v.address = `${outGroupImpose.address}.${outGroupImpose.id}`)\n        );\n        outGroupImpose.items = flatLayer;\n\n        return outGroupImpose;\n      };\n\n      request2$ = request1$.map((obs, idx) =>\n        obs.pipe(\n          map((items) =>\n            compositeCatalog[idx].groupImpose\n              ? pushImposeGroup(items, idx)\n              : items\n          )\n        )\n      );\n    } else {\n      request2$ = request1$;\n    }\n\n    // concat Group -----------------------------------------------------\n    const request3$ = zip(...request2$).pipe(\n      map(\n        (output: CatalogItem[]) => [].concat(...output) // [].concat.apply([], result1\n      )\n    );\n\n    // merge Group (first level only) -----------------------------------------------------\n    const groupByGroupId = (data, keyFn) =>\n      data.reduce((acc, group) => {\n        const groupId = keyFn(group);\n        const ind = acc.find((x) => x.id === groupId);\n\n        if (!ind) {\n          acc[acc.length] = group;\n        } else {\n          const ix = acc.indexOf(ind);\n          if (acc[ix].address.split('|').indexOf(group.address) === -1) {\n            acc[ix].address = `${acc[ix].address}|${group.address}`;\n          }\n          acc[ix].items.push(...group.items);\n        }\n        return acc;\n      }, []);\n\n    // merge Layer for each Level (catalog, group(recursive))\n    const recursiveGroupByLayerAddress = (items, keyFn) =>\n      items.reduce((acc, item, idx, arr) => {\n        const layerTitle = keyFn(item);\n        const outItem = Object.assign({}, item);\n\n        if (item.type === CatalogItemType.Layer) {\n          // same title, same address => result: only one item is keep\n\n          // same title, address diff\n          const indicesMatchTitle = [];\n          const diffAddress = arr.filter((x, i) => {\n            let bInd = false;\n            if (x.title === layerTitle && x.type === CatalogItemType.Layer) {\n              if (i !== idx && x.address !== item.address) {\n                bInd = true;\n              }\n              indicesMatchTitle.push(i);\n            }\n            return bInd;\n          }); // $& i !== idx\n\n          if (diffAddress.length > 0) {\n            const nPosition = indicesMatchTitle.findIndex((x) => x === idx) + 1;\n            outItem.title = `${item.title} (${nPosition})`; // source: ${item.address.split('.')[0]}\n          }\n\n          const exist = acc.find(\n            (x) => x.title === outItem.title && x.type === CatalogItemType.Layer\n          );\n          if (!exist) {\n            acc[acc.length] = outItem;\n          }\n        } else if (item.type === CatalogItemType.Group) {\n          outItem.items = recursiveGroupByLayerAddress(\n            item.items,\n            (layer) => layer.title\n          );\n          acc[acc.length] = outItem;\n        }\n\n        return acc;\n      }, []);\n\n    const request4$ = request3$.pipe(\n      map((output) => groupByGroupId(output, (group) => group.id)),\n      map((output) => [].concat(...output)),\n      map((data) => recursiveGroupByLayerAddress(data, (layer) => layer.title))\n    );\n\n    return request4$;\n  }\n\n  private getCatalogCapabilities(catalog: Catalog): Observable<any> {\n    const sType: string = TypeCatalog[catalog.type as string];\n    return this.capabilitiesService\n      .getCapabilities(sType as any, catalog.url, catalog.version)\n      .pipe(\n        catchError((e) => {\n          const title = this.languageService.translate.instant(\n            'igo.geo.catalog.unavailableTitle'\n          );\n          const message =\n          catalog.title ? this.languageService.translate.instant(\n            'igo.geo.catalog.unavailable',\n            { value: catalog.title }\n          ) : this.languageService.translate.instant(\n            'igo.geo.catalog.someUnavailable'\n          );\n\n          this.messageService.error(message, title);\n          console.error(e);\n          return of(undefined);\n        })\n      );\n  }\n\n  private prepareCatalogItemLayer(layer, idParent, layersQueryFormat, catalog) {\n    const configuredQueryFormat = this.retrieveLayerInfoFormat(\n      layer.Name,\n      layersQueryFormat\n    );\n\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\n    const legendOptions =\n      catalog.showLegend && layer.Style\n        ? this.capabilitiesService.getStyle(layer.Style)\n        : undefined;\n\n    const params = Object.assign({}, catalog.queryParams, {\n      LAYERS: layer.Name,\n      VERSION: catalog.version\n    } as WMSDataSourceOptionsParams);\n\n    const baseSourceOptions = {\n      type: 'wms',\n      url: catalog.url,\n      crossOrigin: catalog.setCrossOriginAnonymous ? 'anonymous' : undefined,\n      queryFormat: configuredQueryFormat,\n      queryHtmlTarget:\n        configuredQueryFormat === QueryFormat.HTML ||\n        configuredQueryFormat === QueryFormat.HTMLGML2\n          ? 'iframe'\n          : undefined,\n      optionsFromCapabilities: true\n    };\n\n    const sourceOptions = Object.assign(\n      {},\n      baseSourceOptions,\n      catalog.sourceOptions,\n      { params }\n    ) as WMSDataSourceOptions;\n\n    let layerTitle;\n    if (catalog.forcedProperties) {\n      for (const property of catalog.forcedProperties) {\n        if (layer.Name === property.layerName && property.title) {\n          layerTitle = property.title;\n        }\n      }\n    }\n\n    let abstract;\n    if (layer.Abstract) {\n      abstract = layer.Abstract;\n    } else if (!layer.Abstract && catalog.abstract) {\n      abstract = catalog.abstract;\n    }\n\n    const layerPrepare = {\n      id: generateIdFromSourceOptions(sourceOptions),\n      type: CatalogItemType.Layer,\n      title: layerTitle !== undefined ? layerTitle : layer.Title,\n      address: idParent,\n      externalProvider: catalog.externalProvider || false,\n      options: {\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        metadata: {\n          url: metadata ? metadata.OnlineResource : undefined,\n          extern: metadata ? true : undefined,\n          abstract,\n          type: baseSourceOptions.type\n        },\n        legendOptions,\n        tooltip: { type: catalog.tooltipType },\n        sourceOptions\n      }\n    } as CatalogItem;\n\n    return ObjectUtils.removeUndefined(layerPrepare);\n  }\n\n  private prepareCatalogItemGroup(\n    itemListIn,\n    regexes,\n    idGroup,\n    layersQueryFormat,\n    catalog\n  ) {\n    const groupPrepare = {\n      id: idGroup,\n      type: CatalogItemType.Group,\n      title: itemListIn.Title,\n      address: catalog.id,\n      externalProvider: catalog.externalProvider || false,\n      sortDirection: catalog.sortDirection, // propagate sortDirection\n      items: itemListIn.Layer.reduce((items: CatalogItem[], layer: any) => {\n        if (layer.Layer !== undefined) {\n          // recursive, check next level\n          const idGroupItemNextLevel =\n            idGroup + `.group.${layer.Name || layer.Layer[0].Name}`;\n          const groupItem: CatalogItemGroup = this.prepareCatalogItemGroup(\n            layer,\n            regexes,\n            idGroupItemNextLevel,\n            layersQueryFormat,\n            catalog\n          );\n\n          items.push(groupItem);\n        } else {\n          if (this.testLayerRegexes(layer.Name, regexes) === false) {\n            return items;\n          }\n\n          const layerItem: CatalogItemLayer<ImageLayerOptions> = this.prepareCatalogItemLayer(\n            layer,\n            idGroup,\n            layersQueryFormat,\n            catalog\n          );\n\n          items.push(layerItem);\n        }\n        return items;\n      }, [])\n    };\n    return groupPrepare;\n  }\n\n  private includeRecursiveItems(\n    catalog: Catalog,\n    itemListIn: any,\n    itemsPrepare: CatalogItem[],\n    loopLevel: number = 0\n  ) {\n    // Dig all levels until last level (layer object are not defined on last level)\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n    if (!itemListIn.Layer) {\n      return;\n    }\n\n    for (const item of itemListIn.Layer) {\n      if (item.Layer !== undefined) {\n        // recursive, check next level\n        this.includeRecursiveItems(catalog, item, itemsPrepare, loopLevel + 1);\n        continue;\n      }\n\n      const layersQueryFormat = this.findCatalogInfoFormat(catalog);\n\n      // group(with layers) and layer(without group) level 1\n      if (loopLevel !== 0) {\n        // TODO: Slice that into multiple methods\n        // Define object of group layer\n        const idGroupItem = `catalog.group.${itemListIn.Name || item.Name}`;\n        const groupItem = this.prepareCatalogItemGroup(\n          itemListIn,\n          regexes,\n          idGroupItem,\n          layersQueryFormat,\n          catalog\n        );\n\n        if (groupItem.items.length !== 0) {\n          itemsPrepare.push(groupItem);\n        }\n\n        // Break the group (don't add a group of layer for each of their layer!)\n        break;\n      } else {\n        // layer without group\n        if (this.testLayerRegexes(item.Name, regexes) !== false) {\n          const layerItem = this.prepareCatalogItemLayer(\n            item,\n            catalog.id,\n            layersQueryFormat,\n            catalog\n          );\n          itemsPrepare.push(layerItem);\n        }\n      }\n    }\n  }\n\n  private getWMTSItems(\n    catalog,\n    capabilities: { [key: string]: any }\n  ): CatalogItemLayer[] {\n    if (!capabilities) {\n      return [];\n    }\n    const layers = capabilities.Contents.Layer;\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    if (\n      capabilities.ServiceIdentification &&\n      capabilities.ServiceIdentification.Abstract &&\n      capabilities.ServiceIdentification.Abstract.length) {\n      catalog.abstract = capabilities.ServiceIdentification.Abstract;\n    }\n\n    return layers\n      .map((layer: any) => {\n        let forcedTitle;\n        if (catalog.forcedProperties) {\n          for (const property of catalog.forcedProperties) {\n            if (layer.Title === property.layerName && property.title) {\n              forcedTitle = property.title;\n            }\n          }\n        }\n        if (this.testLayerRegexes(layer.Identifier, regexes) === false) {\n          return undefined;\n        }\n        const params = Object.assign({}, catalog.queryParams, {\n          version: '1.0.0'\n        });\n        const baseSourceOptions = {\n          type: 'wmts',\n          url: catalog.url,\n          crossOrigin: catalog.setCrossOriginAnonymous\n            ? 'anonymous'\n            : undefined,\n          layer: layer.Identifier,\n          matrixSet: catalog.matrixSet,\n          optionsFromCapabilities: true,\n          requestEncoding: catalog.requestEncoding || 'KVP',\n          style: 'default'\n        } as WMTSDataSourceOptions;\n        const sourceOptions = Object.assign(\n          {},\n          baseSourceOptions,\n          catalog.sourceOptions,\n          { params }\n        ) as WMTSDataSourceOptions;\n\n        return ObjectUtils.removeUndefined({\n          id: generateIdFromSourceOptions(sourceOptions),\n          type: CatalogItemType.Layer,\n          title: forcedTitle !== undefined ? forcedTitle : layer.Title,\n          address: catalog.id,\n          externalProvider: catalog.externalProvider,\n          options: {\n            sourceOptions,\n            metadata: {\n              url: undefined,\n              extern: undefined,\n              abstract: catalog.abstract,\n              type: baseSourceOptions.type\n            }\n          }\n        } as CatalogItem);\n      })\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n  }\n\n  private getArcGISRESTItems(\n    catalog,\n    capabilities\n  ): CatalogItemLayer[] {\n    if (!capabilities) {\n      return [];\n    }\n    const layers = capabilities.layers.filter(layer => !layer.type || layer.type === 'Feature Layer');\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    let abstract;\n    if (capabilities.serviceDescription && capabilities.serviceDescription.length) {\n      const regex = /(<([^>]+)>)/ig;\n      abstract = capabilities.serviceDescription.replace(regex, '');\n    }\n\n    return layers\n      .map((layer: any) => {\n        let forcedTitle;\n        if (catalog.forcedProperties) {\n          for (const property of catalog.forcedProperties) {\n            if (layer.name === property.layerName && property.title) {\n              forcedTitle = property.title;\n            }\n          }\n        }\n        if (this.testLayerRegexes(layer.id, regexes) === false) {\n          return undefined;\n        }\n        const baseSourceOptions = {\n          type: TypeCatalog[catalog.type],\n          url: catalog.url,\n          crossOrigin: catalog.setCrossOriginAnonymous\n            ? 'anonymous'\n            : undefined,\n          layer: layer.id as string,\n          queryable: true,\n          queryFormat: 'esrijson',\n          matrixSet: catalog.matrixSet,\n          optionsFromCapabilities: true,\n          style: 'default'\n        } as ArcGISRestDataSourceOptions;\n        const sourceOptions = Object.assign(\n          {},\n          baseSourceOptions,\n          catalog.sourceOptions\n        ) as ArcGISRestDataSourceOptions;\n        return ObjectUtils.removeUndefined({\n          id: generateIdFromSourceOptions(sourceOptions),\n          type: CatalogItemType.Layer,\n          title: forcedTitle !== undefined ? forcedTitle : layer.name,\n          externalProvider: catalog.externalProvider,\n          address: catalog.id,\n          options: {\n            sourceOptions,\n            minResolution: getResolutionFromScale(layer.maxScale),\n            maxResolution: getResolutionFromScale(layer.minScale),\n            metadata: {\n              url: undefined,\n              extern: undefined,\n              abstract,\n              type: baseSourceOptions.type\n            },\n            title: forcedTitle !== undefined ? forcedTitle : layer.name\n          }\n        } as CatalogItem);\n      })\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n  }\n\n  private testLayerRegexes(layerName: string, regexes: RegExp[]): boolean {\n    if (regexes.length === 0) {\n      return true;\n    }\n    return regexes.find((regex: RegExp) => regex.test(layerName)) !== undefined;\n  }\n\n  private retrieveLayerInfoFormat(\n    layerNameFromCatalog: string,\n    layersQueryFormat: { layer: string; queryFormat: QueryFormat }[]\n  ): QueryFormat {\n    const currentLayerInfoFormat = layersQueryFormat.find(\n      (f) => f.layer === layerNameFromCatalog\n    );\n    const baseInfoFormat = layersQueryFormat.find((f) => f.layer === '*');\n    let queryFormat: QueryFormat;\n    if (currentLayerInfoFormat) {\n      queryFormat = currentLayerInfoFormat.queryFormat;\n    } else if (baseInfoFormat) {\n      queryFormat = baseInfoFormat.queryFormat;\n    }\n    return queryFormat;\n  }\n\n  private findCatalogInfoFormat(\n    catalog: Catalog\n  ): { layer: string; queryFormat: QueryFormat }[] {\n    const layersQueryFormat: { layer: string; queryFormat: QueryFormat }[] = [];\n    if (!catalog.queryFormat) {\n      return layersQueryFormat;\n    }\n    Object.keys(catalog.queryFormat).forEach((configuredInfoFormat) => {\n      if (catalog.queryFormat[configuredInfoFormat] instanceof Array) {\n        catalog.queryFormat[configuredInfoFormat].forEach((layerName) => {\n          if (\n            !layersQueryFormat.find((specific) => specific.layer === layerName)\n          ) {\n            layersQueryFormat.push({\n              layer: layerName,\n              queryFormat: configuredInfoFormat as QueryFormat\n            });\n          }\n        });\n      } else {\n        if (\n          !layersQueryFormat.find(\n            (specific) =>\n              specific.layer === catalog.queryFormat[configuredInfoFormat]\n          )\n        ) {\n          layersQueryFormat.push({\n            layer: catalog.queryFormat[configuredInfoFormat],\n            queryFormat: configuredInfoFormat as QueryFormat\n          });\n        }\n      }\n    });\n    return layersQueryFormat;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <igo-catalog-browser-group\n        [catalog]=\"catalog\"\n        [group]=\"item\"\n        [state]=\"store.state\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [collapsed]=\"(store.count === 1) ? false : true\"\n        [toggleCollapsed]=\"toggleCollapsedGroup\"\n        (addedChange)=\"onGroupAddedChange($event)\"\n        (layerAddedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-group>\n    </ng-container>\n\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"item\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"store.state.get(item).added\"\n        (addedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { zip, BehaviorSubject } from 'rxjs';\n\nimport { EntityStore, EntityStoreWatcher } from '@igo2/common';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { IgoMap } from '../../map';\n\nimport {\n  Catalog,\n  CatalogItem,\n  CatalogItemLayer,\n  CatalogItemGroup,\n  CatalogItemState,\n  CatalogItemType\n} from '../shared';\n\n/**\n * Component to browse a catalog's groups and layers and display them on a map.\n */\n@Component({\n  selector: 'igo-catalog-browser',\n  templateUrl: './catalog-browser.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserComponent implements OnInit, OnDestroy {\n  /**\n   * Catalog items store watcher\n   */\n  private watcher: EntityStoreWatcher<CatalogItem>;\n\n // private resolution$$: Subscription;\n\n  get resolution$(): BehaviorSubject<number> { return this.map.viewController.resolution$; }\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Store holding the catalog's items\n   */\n  @Input() store: EntityStore<CatalogItem, CatalogItemState>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Whether a group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsedGroup: boolean = true;\n\n  constructor(\n    private layerService: LayerService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    const currentItems = this.map.layers.map((layer: Layer) => {\n      return {\n        id: layer.options.source.id,\n        title: layer.title,\n        type: CatalogItemType.Layer\n      };\n    });\n    this.store.state.updateMany(currentItems, { added: true }, true);\n    if (this.catalog && this.catalog.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.catalog.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n      });\n    }\n\n    const catalogShowLegend = this.catalog ? this.catalog.showLegend : false;\n    this.catalogAllowLegend = catalogShowLegend ? catalogShowLegend : this.catalogAllowLegend;\n\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n  }\n\n  ngOnDestroy() {\n    this.watcher.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * When a layer is added or removed, add or remove it from the map\n   * @internal\n   * @param event Layer added event\n   */\n  onLayerAddedChange(event: { added: boolean; layer: CatalogItemLayer }) {\n    const layer = event.layer;\n    this.store.state.update(layer, { added: event.added }, false);\n    event.added ? this.addLayerToMap(layer) : this.removeLayerFromMap(layer);\n  }\n\n  /**\n   * When a froup is added or removed, add or remove it from the map\n   * @internal\n   * @param event Group added event\n   */\n  onGroupAddedChange(event: { added: boolean; group: CatalogItemGroup }) {\n    const group = event.group;\n    this.store.state.update(group, { added: event.added }, false);\n    event.added ? this.addGroupToMap(group) : this.removeGroupFromMap(group);\n  }\n\n  /**\n   * Add layer to map\n   * @param layer Catalog layer\n   */\n  private addLayerToMap(layer: CatalogItemLayer) {\n    this.addLayersToMap([layer]);\n  }\n\n  /**\n   * Remove layer from map\n   * @param layer Catalog layer\n   */\n  private removeLayerFromMap(layer: CatalogItemLayer) {\n    this.removeLayersFromMap([layer]);\n  }\n\n  /**\n   * Add multiple layers to map\n   * @param layers Catalog layers\n   */\n  private addLayersToMap(layers: CatalogItemLayer[]) {\n    const layers$ = layers.map((layer: CatalogItemLayer) => {\n      if (layer.options.sourceOptions.optionsFromApi === undefined) {\n        layer.options.sourceOptions.optionsFromApi = true;\n      }\n      return this.layerService.createAsyncLayer(layer.options);\n    });\n\n    zip(...layers$).subscribe((oLayers: Layer[]) => {\n      this.store.state.updateMany(layers, { added: true });\n      this.map.addLayers(oLayers);\n    });\n  }\n\n  /**\n   * Remove multiple layers from map\n   * @param layers Catalog layers\n   */\n  private removeLayersFromMap(layers: CatalogItemLayer[]) {\n    layers.forEach((layer: CatalogItemLayer) => {\n      this.store.state.update(layer, { added: false });\n      if (layer.options.baseLayer === true) {\n        const oLayer = this.map.getLayerById(layer.options.id);\n        if (oLayer !== undefined) {\n          this.map.removeLayer(oLayer);\n        }\n      } else {\n        const oLayer = this.map.getLayerById(layer.id);\n        if (oLayer !== undefined) {\n          this.map.removeLayer(oLayer);\n        }\n      }\n    });\n  }\n\n  /**\n   * Sort the layers by title. asc or desc.\n   * @internal\n   */\n  private sortCatalogItemsByTitle(items: CatalogItem[], direction) {\n    const returnItem = items.sort((a, b) => {\n      const titleA = a.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      const titleB = b.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n\n      if (titleA < titleB) {\n        return -1;\n      }\n      if (titleA > titleB) {\n        return 1;\n      }\n      return 0;\n    });\n    switch (direction) {\n      case 'asc':\n        return returnItem;\n      case 'desc':\n        return returnItem.reverse();\n      default:\n        return items;\n    }\n  }\n\n  /**\n   * Add all the layers of a group to map\n   * @param group Catalog group\n   */\n  private addGroupToMap(group: CatalogItemGroup) {\n    let layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === false;\n    });\n    if (group.sortDirection !== undefined) {\n      layers = this.sortCatalogItemsByTitle(layers, group.sortDirection);\n    }\n    this.addLayersToMap(layers.reverse() as CatalogItemLayer[]);\n  }\n\n  /**\n   * Remove all the layers of a group from map\n   * @param group Catalog group\n   */\n  private removeGroupFromMap(group: CatalogItemGroup) {\n    const layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === true;\n    });\n    this.removeLayersFromMap(layers as CatalogItemLayer[]);\n  }\n}\n","<ng-container *ngIf=\"legendItems$ | async as items\">\n  <ng-container *ngIf=\"items.length; else noItems\">\n    <ng-container *ngFor=\"let item of items.slice().reverse()\" #renderedLegends>\n      <div *ngIf=\"getLegend; else noItems\">\n        <mat-list-item *ngIf=\"item.title\">\n          <mat-icon\n            id=\"legend-toggle\"\n            class=\"igo-chevron\"\n            mat-list-avatar\n            igoCollapse\n            [target]=\"legend\"\n            [collapsed]=\"(item.collapsed)\"\n            (toggle)=\"toggleLegendItem($event, item)\"\n            svgIcon=\"chevron-up\">\n          </mat-icon>\n          <h4 matLine>{{computeItemTitle(item) | async}} </h4>\n        </mat-list-item>\n        <div #legend class=\"igo-layer-legend\" [ngClass]=\"{'with-title': item.title}\">\n          <div *ngIf=\"currentStyle !== undefined\">\n              <mat-form-field>\n                <mat-select tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n                  [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" [(ngModel)]=\"currentStyle\"\n                  (selectionChange)=\"onChangeStyle()\">\n                  <mat-option *ngFor=\"let style of styles\" [value]=\"style.name\">{{style.title}}</mat-option>\n                </mat-select>\n            </mat-form-field>\n          </div>\n          <div *ngIf=\"!(item.collapsed)\">\n            <div *ngIf=\"item.url\">\n              <img #renderedLegend id=\"{{item.title}}\" (load)=\"onLoadImage(item.title)\"\n                src=\"{{legendGraphic[item.title]}}\"\n                alt=\"{{'igo.geo.layer.legend.loadingLegendText' | translate}}\">\n              <small *ngIf=\"imagesHeight[item.title]<16\">\n                  {{'igo.geo.layer.legend.noLegendScale' | translate}}\n              </small>\n            </div>\n            <div\n              [ngStyle]=\"item.style\"\n              [innerHTML]=\"item.html\"\n              *ngIf=\"item.html\">\n            </div>\n          </div>\n        </div>\n      </div>\n    </ng-container>\n  </ng-container>\n\n  <ng-template #noItems>\n    <small>\n      {{'igo.geo.layer.legend.noLegendText' | translate}}\n    </small>\n  </ng-template>\n\n</ng-container>\n","import { HttpClient } from '@angular/common/http';\nimport { Component, Input, OnInit, OnDestroy, ChangeDetectionStrategy, ViewChildren, ElementRef, ChangeDetectorRef } from '@angular/core';\nimport type { QueryList } from '@angular/core';\n\nimport { Subscription, BehaviorSubject, of, Observable } from 'rxjs';\n\nimport { Legend } from '../../datasource/shared/datasources/datasource.interface';\nimport { Layer, ItemStyleOptions } from '../shared/layers';\nimport { LegendMapViewOptions } from '../shared/layers/layer.interface';\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { catchError, map } from 'rxjs/operators';\nimport { LanguageService } from '@igo2/core';\nimport { WMSDataSource, WMSDataSourceOptions } from '../../datasource';\nimport { SecureImagePipe } from '@igo2/common';\n\n@Component({\n  selector: 'igo-layer-legend',\n  templateUrl: './layer-legend.component.html',\n  styleUrls: ['./layer-legend.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendComponent implements OnInit, OnDestroy {\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  /**\n   * Observable of the legend items\n   */\n  legendItems$: BehaviorSubject<Legend[]> = new BehaviorSubject([]);\n\n  /**\n   * Subscription to the map's resolution\n   */\n  private state$$: Subscription;\n\n  /**\n   * The available styles\n   */\n  public styles;\n\n  /**\n   * The style used to make the legend\n   */\n  public currentStyle;\n\n  /**\n   * The scale used to make the legend\n   */\n  private scale: number = undefined;\n\n  /**\n   * The extent used to make the legend\n   */\n  private view: LegendMapViewOptions = undefined;\n  /**\n   * Get list of images display\n   */\n  @ViewChildren('renderedLegend') renderedLegends: QueryList<ElementRef>;\n\n  /**\n   * List of size of images displayed\n   */\n  public imagesHeight: { [srcKey: string]: number } = {};\n\n  /**\n   * Layer\n   */\n  @Input() layer: Layer;\n\n  /**\n   * if getLegendGraphic is authorized\n   */\n  public getLegend = true;\n\n  /**\n   * activeLegend\n   */\n  public legendGraphic: { [srcKey: string]: string } = {};\n\n  public currentItemTitle: string;\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private languageService: LanguageService,\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * On init, subscribe to the map's resolution and update the legend accordingly\n   */\n  ngOnInit() {\n    let lastlLegend = this.layer.legend;\n    this.styles = this.listStyles();\n    const sourceOptions = this.layer.options.source.options as any;\n    if (\n      sourceOptions &&\n      sourceOptions.params &&\n      sourceOptions.params.STYLES) {\n      // if a styles is provided into the layers wms params\n      this.currentStyle = this.styles.find(style => style.name === sourceOptions.params.STYLES).name;\n    } else if (!this.layer.legend) {\n      // if no legend is manually provided\n      if (this.styles && this.styles.length > 1) {\n        this.currentStyle = this.styles[0].name;\n      }\n    } else if (this.styles && this.styles.length > 1) {\n      this.currentStyle = lastlLegend[0].currentStyle;\n    }\n    if ( typeof this.layer.options.legendOptions !== 'undefined' && this.layer.options.legendOptions.display === false) {\n      lastlLegend = [];\n    } else {\n      lastlLegend = this.layer.dataSource.getLegend(this.currentStyle, this.view);\n    }\n\n    if (this.updateLegendOnResolutionChange === true || (sourceOptions as WMSDataSourceOptions).contentDependentLegend) {\n      const state$ = this.layer.map.viewController.state$;\n      this.state$$ = state$\n      .subscribe(() => this.onViewControllerStateChange());\n    } else if (lastlLegend && lastlLegend.length !== 0) {\n      this.legendItems$.next(lastlLegend);\n      for (const legend of lastlLegend) {\n        this.getLegendGraphic(legend);\n      }\n    }\n  }\n\n  /**\n   * On destroy, unsubscribe to the map's view state\n   */\n  ngOnDestroy() {\n    if (this.state$$ !== undefined) {\n      this.state$$.unsubscribe();\n    }\n  }\n\n  getLegendGraphic(item: Legend) {\n    const secureIMG = new SecureImagePipe(this.http);\n    this.currentItemTitle = item.title;\n    secureIMG.transform(item.url).pipe(\n      catchError((err) => {\n        if (err.error) {\n          err.error.caught = true;\n          this.getLegend = false;\n          this.cdRef.detectChanges();\n          return err;\n        }\n      })\n    ).subscribe((legend: string) => {\n      this.legendGraphic[this.currentItemTitle] = legend;\n      this.cdRef.detectChanges();\n    });\n  }\n\n  toggleLegendItem(collapsed: boolean, item: Legend) {\n    item.collapsed = collapsed;\n  }\n\n  private transfertToggleLegendItem(newLegends: Legend[]): Legend[] {\n    const outLegends: Legend[] = newLegends;\n    const lastLegends = this.layer.legend;\n    for (let i = 0; i < lastLegends.length; i++) {\n      outLegends[i].collapsed = lastLegends[i].collapsed;\n   }\n    return outLegends;\n  }\n\n  computeItemTitle(layerLegend): Observable<string> {\n    const layerOptions = this.layer.dataSource.options as any;\n    if (layerOptions.type !== 'wms') {\n      return of(layerLegend.title);\n    }\n\n    const layers = layerOptions.params.LAYERS.split(',');\n    const localLayerOptions = JSON.parse(JSON.stringify(layerOptions)); // to avoid to alter the original options.\n    localLayerOptions.params.LAYERS = layers.find(layer => layer === layerLegend.title);\n    return this.capabilitiesService\n      .getWMSOptions(localLayerOptions)\n      .pipe(map(wmsDataSourceOptions => {\n        return wmsDataSourceOptions._layerOptionsFromSource.title;\n      }));\n  }\n\n  /**\n   * On resolution change, compute the effective scale level and update the\n   * legend accordingly.\n   * @param resolution Map resolution\n   */\n  private onViewControllerStateChange() {\n    this.view = {\n      resolution: this.layer.map.viewController.getResolution(),\n      extent: this.layer.map.viewController.getExtent(),\n      projection: this.layer.map.viewController.getOlProjection().getCode(),\n      scale: this.layer.map.viewController.getScale(),\n      size: this.layer.map.ol.getSize()\n    } as LegendMapViewOptions;\n    this.updateLegend();\n  }\n\n  /**\n   * Update the legend with scale level and style define\n   */\n  private updateLegend() {\n    let legendItems = this.layer.dataSource.getLegend(this.currentStyle, this.view);\n    if (this.layer.legend && this.layer.legend.length > 1) { legendItems = this.transfertToggleLegendItem(legendItems); }\n    this.layer.legend = legendItems;\n\n    if (legendItems.length === 0 && this.legendItems$.value.length === 0) {\n      return;\n    }\n    this.legendItems$.next(legendItems);\n    for (const legend of this.legendItems$.value) {\n      this.getLegendGraphic(legend);\n    }\n  }\n\n  private listStyles() {\n    const layerOptions = this.layer.options;\n    if (layerOptions && layerOptions.legendOptions) {\n      const translate = this.languageService.translate;\n      const title = translate.instant('igo.geo.layer.legend.default');\n      let stylesAvailable = [{ name: '', title } as ItemStyleOptions];\n      if (layerOptions.legendOptions.stylesAvailable) {\n        stylesAvailable = stylesAvailable.concat(layerOptions.legendOptions.stylesAvailable.filter(sA => (\n          sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !== 'default' &&\n          sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !== 'defaut')));\n      }\n      stylesAvailable.filter(sa => !sa.title).map((sa) => sa.title = sa.name);\n      stylesAvailable.map(s => s.title = s.title.charAt(0).toUpperCase() + s.title.slice(1).replace(/_/g, ' '));\n      return stylesAvailable;\n    }\n    return ;\n  }\n\n  onChangeStyle() {\n    this.updateLegend();\n    let STYLES = '';\n    if (this.layer.dataSource instanceof WMSDataSource) {\n      this.layer.dataSource.ol.getParams().LAYERS.split(',').map(layer =>\n        STYLES += this.currentStyle + ','\n      );\n      STYLES = STYLES.slice(0, -1);\n      this.layer.dataSource.ol.updateParams({ STYLES });\n    }\n  }\n\n  onLoadImage(id: string) {\n    let elemRef: HTMLImageElement;\n    if (this.renderedLegends.length === 1) {\n      elemRef = this.renderedLegends.first.nativeElement as HTMLImageElement;\n    } else {\n      elemRef = this.renderedLegends.find(renderedLegend => renderedLegend.nativeElement.id === id).nativeElement as HTMLImageElement;\n    }\n    this.imagesHeight[id] = elemRef.height;\n  }\n}\n","<mat-list-item>\n  <mat-icon *ngIf=\"haveGroup()\" mat-list-avatar svgIcon=\"blank\"></mat-icon>\n  <h4 mat-line matTooltipShowDelay=\"500\" [ngClass]=\"(catalogAllowLegend)?'igo-cataloglayer-title':''\" (click)=\"askForLegend($event)\" [matTooltip]=\"computeTitleTooltip()\">{{title}}</h4>\n\n    <button *ngIf=\"layer.externalProvider\"\n      disabled=\"true\"\n      mat-icon-button>\n    <mat-icon\n      class=\"igo-cataloglayer-external-icon\"\n      *ngIf=\"layer.externalProvider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.layer' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n      svgIcon=\"earth-arrow-right\">\n    </mat-icon>\n  </button>\n  <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n\n  <button\n    (mouseenter)=\"onMouseEvent($event)\" (mouseleave)=\"onMouseEvent($event)\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"computeTooltip() | translate\"\n    [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n    (click)=\"onToggleClick($event)\">\n    <mat-icon\n       matBadge=\"icon\"\n       igoMatBadgeIcon=\"eye-off\"\n       igoMatBadgeInverseColor=\"true\"\n       [matBadgeHidden]=\"isInResolutionsRange()\"\n       matBadgeDisabled=\"true\"\n       matBadgeSize=\"small\"\n       matBadgePosition=\"after\"\n       [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\">\n    </mat-icon>\n  </button>\n\n</mat-list-item>\n\n<div #legend class=\"igo-cataloglayer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"(layerLegendShown$ | async) && (igoLayer$ | async) && catalogAllowLegend\"\n    [layer]=\"igoLayer$ | async\">\n  </igo-layer-legend>\n</div>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\n\nimport { CatalogItemLayer } from '../shared';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { first } from 'rxjs/operators';\nimport { Layer, TooltipType } from '../../layer/shared/layers';\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\n\n/**\n * Catalog browser layer item\n */\n@Component({\n  selector: 'igo-catalog-browser-layer',\n  templateUrl: './catalog-browser-layer.component.html',\n  styleUrls: ['./catalog-browser-layer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserLayerComponent implements OnInit, OnDestroy {\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private isPreview$$: Subscription;\n  private lastTimeoutRequest;\n\n  public layerLegendShown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public igoLayer$ = new BehaviorSubject<Layer>(undefined);\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog layer\n   */\n  @Input() layer: CatalogItemLayer;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added = false;\n\n  /**\n   * Event emitted when the add/remove button is clicked\n   */\n  @Output() addedChange = new EventEmitter<{\n    added: boolean;\n    layer: CatalogItemLayer;\n  }>();\n\n  @Output() addedLayerIsPreview = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.layer);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.layer) || 'layers';\n  }\n\n  constructor(private layerService: LayerService ) {}\n\n  ngOnInit(): void {\n    this.isInResolutionsRange();\n    this.isPreview$$ = this.isPreview$.subscribe(value => this.addedLayerIsPreview.emit(value));\n  }\n\n  ngOnDestroy() {\n    this.isPreview$$.unsubscribe();\n  }\n\n  computeTitleTooltip(): string {\n      const layerOptions = this.layer.options;\n      if (!layerOptions.tooltip) {\n        return getEntityTitle(this.layer);\n      }\n      const layerTooltip = layerOptions.tooltip;\n      const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n      switch (layerOptions.tooltip.type) {\n        case TooltipType.TITLE:\n          return this.layer.title;\n        case TooltipType.ABSTRACT:\n          if (layerMetadata && layerMetadata.abstract) {\n            return layerMetadata.abstract;\n          } else {\n            return this.layer.title;\n          }\n        case TooltipType.CUSTOM:\n          if (layerTooltip && layerTooltip.text) {\n            return layerTooltip.text;\n          } else {\n            return this.layer.title;\n          }\n        default:\n          return this.layer.title;\n      }\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  askForLegend(event) {\n    this.layerLegendShown$.next(!this.layerLegendShown$.value);\n    this.layerService.createAsyncLayer(this.layer.options).pipe(first())\n    .subscribe(layer => this.igoLayer$.next(layer));\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    if (event.type === 'mouseenter' && this.mouseInsideAdd ) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove();\n          } else {\n            this.add();\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add();\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove();\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add() {\n    if (!this.added) {\n      this.added = true;\n      this.addedChange.emit({ added: true, layer: this.layer });\n    }\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private remove() {\n    if (this.added) {\n      this.added = false;\n      this.addedChange.emit({ added: false, layer: this.layer });\n    }\n  }\n\n  haveGroup(): boolean {\n    return !(!this.layer.address || this.layer.address.split('.').length === 1);\n  }\n\n  isInResolutionsRange(): boolean {\n    const minResolution = this.layer.options.minResolution || 0;\n    const maxResolution = this.layer.options.maxResolution || Infinity;\n    this.inRange$.next(\n      this.resolution >= minResolution && this.resolution <= maxResolution\n    );\n    return this.inRange$.value;\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      return this.isPreview$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : this.inRange$.value\n        ? 'igo.geo.catalog.layer.removeFromMap'\n        : 'igo.geo.catalog.layer.removeFromMapOutRange';\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n}\n","<mat-list-item>\n  <mat-icon\n    mat-list-avatar\n    svgIcon=\"chevron-up\"\n    igoCollapse\n    class=\"igo-chevron\"\n    [target]=\"items\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"onToggleCollapsed($event)\">\n  </mat-icon>\n\n  <h4 class=\"igo-catalog-group-title\" id=\"catalog-group-title\" mat-line matTooltipShowDelay=\"500\" [matTooltip]=\"title\" (click)=\"onTitleClick()\">{{title}}</h4>\n\n  <button *ngIf=\"group.externalProvider\"\n    disabled=\"true\"\n    mat-icon-button>\n    <mat-icon\n      class=\"igo-cataloggroup-external-icon\"\n      *ngIf=\"group.externalProvider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.group' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n      svgIcon=\"earth-arrow-right\">\n    </mat-icon>\n  </button>\n\n  <ng-container *ngIf=\"(added$ | async) && (preview$ | async) === false; else notadded\">\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.group.removeFromMap' | translate\"\n      color=\"warn\"\n      [disabled]=\"disabled$ | async\"\n      (click)=\"onToggleClick()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n  </ng-container>\n\n  <ng-template #notadded>\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.group.addToMap' | translate\"\n      [disabled]=\"disabled$ | async\"\n      (click)=\"onToggleClick()\">\n      <mat-icon svgIcon=\"plus\"></mat-icon>\n    </button>\n  </ng-template>\n</mat-list-item>\n\n<div #items>\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <!-- todo: add display ans manage CatalogItemGroup -->\n    </ng-container>\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"item\"\n        [resolution]=\"resolution\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"state.get(item).added\"\n        (addedLayerIsPreview)=\"onLayerPreview($event)\"\n        (addedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { EntityStore } from '@igo2/common';\nimport type { EntityStateManager } from '@igo2/common';\n\nimport {\n  Catalog,\n  CatalogItem,\n  CatalogItemGroup,\n  CatalogItemLayer,\n  CatalogItemState,\n  CatalogItemType\n} from '../shared';\n\n/**\n * Catalog browser group item\n */\n@Component({\n  selector: 'igo-catalog-browser-group',\n  templateUrl: './catalog-browser-group.component.html',\n  styleUrls: ['./catalog-browser-group.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserGroupComponent implements OnInit, OnDestroy {\n\n  /**\n   * Group's items store\n   * @internal\n   */\n  store = new EntityStore<CatalogItem, CatalogItemState>([]);\n\n  /**\n   * Whether all the layers of the group are added\n   * @internal\n   */\n  added$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  preview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Whether the toggle button is disabled\n   * @internal\n   */\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Catalog group\n   */\n  @Input() group: CatalogItemGroup;\n\n  /**\n   * Whether the group is collapsed\n   */\n  @Input() collapsed: boolean = true;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Whether the group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsed: boolean = true;\n\n  /**\n   * Parent catalog's items store state. Groups share a unique\n   * EntityState that tracks the group and it's layers state (whether they are added or not).\n   * Sharing a unique state would also allow us to expand this component to allow\n   * the selection of a layer while unselecting any layer already selected in another group.\n   * This could be useful to display some layer info before adding it, for example.\n   */\n  @Input() state: EntityStateManager<CatalogItem, CatalogItemState>;\n\n  /**\n   * Event emitted when the add/remove button of the group is clicked\n   */\n  @Output() addedChange = new EventEmitter<{\n    added: boolean;\n    group: CatalogItemGroup;\n  }>();\n\n  /**\n   * Event emitted when the add/remove button of a layer is clicked\n   */\n  @Output() layerAddedChange = new EventEmitter<{\n    added: boolean;\n    layer: CatalogItemLayer;\n  }>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return this.group.title;\n  }\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.load(this.group.items);\n    this.evaluateAdded();\n    this.evaluateDisabled(this.collapsed);\n    if (this.group.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.group.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n        });\n    }\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick() {\n    this.added$.value ? this.remove() : this.add();\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleCollapsed(collapsed: boolean) {\n    this.evaluateDisabled(collapsed);\n  }\n\n  /**\n   * When a layer is added or removed, evaluate if all the layers of the group\n   * are now added or removed. If so, consider that the group itself is added\n   * or removed.\n   * @internal\n   * @param event Layer added change event\n   */\n  onLayerAddedChange(event: { added: boolean; layer: CatalogItemLayer }) {\n    this.layerAddedChange.emit(event);\n    this.tryToggleGroup(event);\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add() {\n    this.added$.next(true);\n    this.addedChange.emit({\n      added: true,\n      group: this.group\n    });\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private remove() {\n    this.added$.next(false);\n    this.addedChange.emit({\n      added: false,\n      group: this.group\n    });\n  }\n\n  onLayerPreview(event) {\n    this.preview$.next(event);\n  }\n\n  /**\n   * If all the layers of the group added or removed, add or remove the group itself.\n   * @param event The last layer added change event to occur\n   */\n  private tryToggleGroup(event: { added: boolean; layer: CatalogItemLayer }) {\n    const added = event.added;\n    const layer = event.layer;\n\n    const layersAdded = this.store.view\n      .all()\n      .filter((item: CatalogItem) => item.id !== layer.id)\n      .map((item: CatalogItem) => this.state.get(item).added || false);\n\n    if (layersAdded.every(value => value === added)) {\n      added ? this.add() : this.remove();\n    } else if (this.added$.value === true) {\n      this.added$.next(false);\n    }\n  }\n\n  private evaluateAdded() {\n    const added = this.store.all().every((item: CatalogItem) => {\n      return (this.state.get(item).added || false) === true;\n    });\n    this.added$.next(added);\n  }\n\n  private evaluateDisabled(collapsed: boolean) {\n    let disabled = false;\n    if (this.toggleCollapsed === false) {\n      disabled = collapsed;\n    }\n    this.disabled$.next(disabled);\n  }\n\n  onTitleClick() {\n    this.collapsed = !this.collapsed;\n  }\n}\n","import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerListToolService {\n  public keyword: string;\n  public sortAlpha = false;\n  public onlyVisible = false;\n  public onlyInRange = false;\n  public keywordInitialized = false;\n  public sortedAlphaInitialized = false;\n  public onlyVisibleInitialized = false;\n  public onlyInRangeInitialized = false;\n\n  constructor() {}\n\n}\n","<mat-list-item class= \"igo-layer-list-item\">\n  <mat-checkbox *ngIf=\"selectionMode\"\n    class=\"layerCheck\"\n    mat-list-icon\n    (change)=\"check()\"\n    [checked]=\"layerCheck\">\n  </mat-checkbox>\n  <h4 (click)=\"toggleLegendOnClick()\" matLine class=\"igo-layer-title\" [matTooltip]=\"tooltipText\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n\n  <button *ngIf=\"!selectionMode\"\n    mat-icon-button\n    [color]=\"layer.visible ? 'primary' : 'default'\"\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"layer.visible ?\n                  ('igo.geo.layer.hideLayer' | translate) :\n                  ('igo.geo.layer.showLayer' | translate)\"\n    (click)=\"toggleVisibility()\">\n    <mat-icon\n      matBadge=\"?\"\n      matBadgeColor=\"accent\"\n      matBadgeSize=\"small\"\n      matBadgePosition=\"after\"\n      [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n      [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n      [svgIcon]=\"(layer.visible$ | async) ? 'eye' : 'eye-off'\">\n    </mat-icon>\n  </button>\n\n  <button *ngIf=\"selectionMode\" class=\"selection-eye\"\n  mat-icon-button\n  [color]=\"layer.visible ? 'primary' : 'default'\"\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"layer.visible ?\n                ('igo.geo.layer.hideLayer' | translate) :\n                ('igo.geo.layer.showLayer' | translate)\"\n  (click)=\"toggleVisibility()\">\n  <mat-icon\n    matBadge=\"?\"\n    matBadgeColor=\"accent\"\n    matBadgeSize=\"small\"\n    matBadgePosition=\"after\"\n    [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n    [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n    [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n  </mat-icon>\n</button>\n\n  <button *ngIf=\"!selectionMode\"\n    class=\"actions-button\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]= \"'igo.geo.layer.moreOptions' | translate\"\n    mat-icon-button\n    color=\"primary\"\n    (click)=\"toggleLayerTool()\">\n    <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\n  </button>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"showLegend$ | async\"\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n  </igo-layer-legend>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  Renderer2,\n  ElementRef,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { layerIsQueryable } from '../../query/shared/query.utils';\nimport { Layer, TooltipType } from '../shared/layers';\nimport { NetworkService, ConnectionState } from '@igo2/core';\n\n@Component({\n  selector: 'igo-layer-item',\n  templateUrl: './layer-item.component.html',\n  styleUrls: ['./layer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerItemComponent implements OnInit, OnDestroy {\n  public focusedCls = 'igo-layer-item-focused';\n\n  @Input()\n  get activeLayer() {\n    return this._activeLayer;\n  }\n  set activeLayer(value) {\n    if (value && this.layer && value.id === this.layer.id && !this.selectionMode) {\n      this.layerTool$.next(true);\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n  }\n  private _activeLayer;\n\n  layerTool$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  queryBadgeHidden$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  @Input()\n  get selectAll() {\n    return this._selectAll;\n  }\n  set selectAll(value: boolean) {\n    this._selectAll = value;\n    if (value === true) {\n      this.layerCheck = true;\n    }\n  }\n  private _selectAll = false;\n\n  @Input() layerCheck;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n  private layers$$: Subscription;\n\n  layers$: BehaviorSubject<Layer> = new BehaviorSubject<Layer>(undefined);\n\n  @Input()\n  get layer() {\n    return this._layer;\n  }\n  set layer(value) {\n    this._layer = value;\n    this.layers$.next(value);\n  }\n  private _layer;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendIfVisible: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() orderable: boolean = true;\n\n  @Input() lowerDisabled: boolean = false;\n\n  @Input() raiseDisabled: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Input() selectionMode;\n\n  @Input() changeDetection;\n\n  get opacity() {\n    return this.layer.opacity * 100;\n  }\n  set opacity(opacity: number) {\n    this.layer.opacity = opacity / 100;\n  }\n\n  @Output() action: EventEmitter<Layer> = new EventEmitter<Layer>(undefined);\n  @Output() checkbox = new EventEmitter<{\n    layer: Layer;\n    check: boolean;\n  }>();\n\n  constructor(\n    private networkService: NetworkService,\n    private renderer: Renderer2,\n    private elRef: ElementRef,\n    private cdRef: ChangeDetectorRef) {}\n\n  ngOnInit() {\n    if (\n      this.layer.visible &&\n      this.expandLegendIfVisible &&\n      this.layer.firstLoadComponent === true\n    ) {\n      this.layer.firstLoadComponent = false;\n      this.layer.legendCollapsed = false;\n    }\n    this.toggleLegend(this.layer.legendCollapsed);\n    this.updateQueryBadge();\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.state = state;\n      this.onResolutionChange();\n    });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layer && this.layer.options.active) {\n        this.layerTool$.next(true);\n        this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n      }\n    });\n\n    if (this.changeDetection) {\n      this.changeDetection.subscribe(() => this.cdRef.detectChanges());\n    }\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    this.toggleLegend(this.showLegend$.value);\n  }\n\n  toggleVisibility() {\n    this.layer.visible = !this.layer.visible;\n    if (this.toggleLegendOnVisibilityChange) {\n      this.toggleLegend(!this.layer.visible);\n    }\n    this.updateQueryBadge();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    if (\n      inResolutionRange === false &&\n      this.updateLegendOnResolutionChange === true\n    ) {\n      this.toggleLegend(true);\n    }\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n\n  private updateQueryBadge() {\n    const hidden =\n      this.queryBadge === false ||\n      this.layer.visible === false ||\n      !layerIsQueryable(this.layer);\n    this.queryBadgeHidden$.next(hidden);\n  }\n\n  toggleLayerTool() {\n    this.layerTool$.next(!this.layerTool$.getValue());\n    if (this.layerTool$.getValue() === true) {\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n    this.action.emit(this.layer);\n  }\n\n  public check() {\n    this.layerCheck = !this.layerCheck;\n    this.checkbox.emit({layer: this.layer, check: this.layerCheck});\n  }\n}\n","export enum LayerListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\nexport enum LayerListSelectVisibleEnum {\n  ALL_VISIBLE = 'ALL_VISIBLE',\n  ALL_HIDDEN = 'ALL_HIDDEN',\n  MIXED = 'MIXED',\n  NULL = 'NULL'\n}\n\nexport enum LayerListDisplacement {\n  Raise = 'raise',\n  Lower = 'lower',\n}\n","<mat-list>\n  <igo-layer-list-tool *ngIf=\"showToolbar$ | async\"\n    floatLabel=\"auto\"\n    [layersAreAllVisible]=\"layersAreAllVisible\"\n    [term]=\"layerFilterAndSortOptions.keyword\"\n    [onlyVisible]=\"layerFilterAndSortOptions.onlyVisible\"\n    [sortAlpha]=\"layerFilterAndSortOptions.sortAlpha\"\n    (appliedFilterAndSort)=\"onAppliedFilterAndSortChange($event)\"\n    (selection)=\"toggleSelectionMode($event)\">\n  </igo-layer-list-tool>\n</mat-list>\n\n<mat-list-item *ngIf=\"selection\" class=\"select-all\">\n  <mat-checkbox\n    class=\"select-all-checkbox mat-subheading-2\"\n    [color]=\"!selectAllCheck && layersChecked.length > 0 ? 'accent' : 'primary'\"\n    (change)=\"selectAll()\"\n    [checked]=\"selectAllCheck\"\n    [indeterminate]=\"!selectAllCheck && layersChecked.length > 0\"> {{selectAllCheck ? ('igo.geo.layer.deselectAll' | translate) : ('igo.geo.layer.selectAll' | translate)}}\n  </mat-checkbox>\n</mat-list-item>\n<mat-divider></mat-divider>\n\n<igo-list #igoList [ngClass]=\"{'igo-list-tools-multi': selection, 'igo-list-tools-single': (layerTool && !selection), 'igo-list-no-tools': (!layerTool && !selection)}\" [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n    <igo-layer-item *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n      igoListItem\n      [layer]=\"layer\"\n      [activeLayer]=\"activeLayer\"\n      [orderable]=\"orderable && !layer.baseLayer\"\n      [lowerDisabled]=\"getLowerLayer().id === layer.id\"\n      [raiseDisabled]=\"getUpperLayer().id === layer.id\"\n      [queryBadge]=\"queryBadge\"\n      [expandLegendIfVisible]=\"expandLegendOfVisibleLayers\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [selectionMode]=\"selection\"\n      [selectAll]=\"selectAllCheck\"\n      [layerCheck]=\"layer.options.check\"\n      [changeDetection]=\"layerItemChangeDetection$\"\n      (action)=\"toggleLayerTool($event)\"\n      (checkbox)=\"layersCheck($event)\">\n    </igo-layer-item>\n  </ng-template>\n</igo-list>\n\n<igo-panel *ngIf=\"!selection && layerTool && activeLayer\" class=\"igo-layer-actions-container\" [title]=\"activeLayer.title\">\n  <div class=\"igo-layer-button-group\">\n    <button\n      *ngIf=\"isLayerRemovable(activeLayer)\"\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.removeLayer' | translate\"\n      (click)=\"removeLayers()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterLowerLayer' | translate) : ('igo.geo.layer.lowerLayer' | translate)\"\n      [disabled]=\"lowerDisabled\"\n      (click)=\"moveActiveLayer(activeLayer,layerListDisplacement.Lower)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"lowerDisabled\"\n                svgIcon=\"arrow-down\"></mat-icon>\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterRaiseLayer' | translate) : ('igo.geo.layer.raiseLayer' | translate)\"\n      [disabled]=\"raiseDisabled\"\n      (click)=\"moveActiveLayer(activeLayer,layerListDisplacement.Raise)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"raiseDisabled\"\n                svgIcon=\"arrow-up\"></mat-icon>\n    </button>\n\n    <!-- <label>{{ 'igo.geo.layer.opacity' | translate }} </label> -->\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\">\n      <mat-icon [matBadge]=\"badgeOpacity\" matBadgeColor=\"primary\" matBadgeSize=\"medium\" svgIcon=\"opacity\"></mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\" class=\"mat-menu-opacity-slider\">\n      <div id=\"opacity-menu\">\n        <mat-slider\n          id=\"opacity-slider\"\n          color=\"primary\"\n          thumbLabel\n          tickInterval=\"5\"\n          step=\"5\"\n          [min]=\"0\"\n          [max]=\"100\"\n          [value]=\"opacity\"\n          (input)=\"changeOpacity($event)\"\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n          (click) = \"$event.stopPropagation()\"\n          matTooltipShowDelay=\"500\"\n          tooltip-position=\"below\">\n        </mat-slider>\n      </div>\n    </mat-menu>\n\n    <button\n      *ngIf=\"activeLayerIsValid(activeLayer)\"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayer' | translate\"\n      (click)=\"zoomLayerExtents(activeLayer)\">\n      <mat-icon matBadgeColor=\"primary\" matBadgeSize=\"medium\" svgIcon=\"magnify-scan\"></mat-icon>\n    </button>\n\n    <ng-container igoLayerItemToolbar\n      [ngTemplateOutlet]=\"templateLayerToolbar\"\n      [ngTemplateOutletContext]=\"{layer: activeLayer}\">\n    </ng-container>\n\n    <ng-content select=\"[igoLayerItemToolbar]\"></ng-content>\n  </div>\n</igo-panel>\n\n<igo-panel *ngIf=\"selection && layers.length > 0\" class=\"igo-layer-actions-container\" [title]=\"'igo.geo.layer.tools' | translate\">\n  <div class=\"actions-buttons-multi\">\n    <button\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"isAllLayersRemovable(layersChecked) ? ('igo.geo.layer.removeSelectedLayers' | translate) : 'igo.geo.layer.removeSelectedLayersRestriction' | translate\"\n      (click)=\"removeLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"'!'\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"isAllLayersRemovable(layersChecked)\"\n                svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"eye-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"statusSelectedLayersCheck === 'ALL_HIDDEN' ? ('igo.geo.layer.showSelectedLayers' | translate) : ('igo.geo.layer.hideSelectedLayers' | translate)\"\n      (click)=\"toggleVisibility(layersChecked)\">\n      <mat-icon\t[svgIcon]=\"(statusSelectedLayersCheck === 'ALL_HIDDEN') ? 'eye-off' : 'eye'\"></mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterLowerLayer' | translate) : ('igo.geo.layer.lowerLayer' | translate)\"\n      [disabled]=\"lowerDisabledSelection\"\n      (click)=\"lowerLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"lowerDisabledSelection\"\n                svgIcon=\"arrow-down\"></mat-icon>\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterRaiseLayer' | translate) : ('igo.geo.layer.raiseLayer' | translate)\"\n      [disabled]=\"raiseDisabledSelection\"\n      (click)=\"raiseLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"raiseDisabledSelection\"\n                svgIcon=\"arrow-up\"></mat-icon>\n    </button>\n\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\">\n      <mat-icon svgIcon=\"opacity\"></mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\"  class=\"mat-menu-opacity-slider\">\n      <div id=\"opacity-menu\">\n        <mat-slider *ngIf=\"layersChecked.length\"\n          id=\"opacity-slider\"\n          color=\"primary\"\n          thumbLabel\n          tickInterval=\"5\"\n          step=\"5\"\n          [min]=\"0\"\n          [max]=\"100\"\n          [(ngModel)]=\"checkOpacity\"\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n          matTooltipShowDelay=\"500\"\n          tooltip-position=\"below\"\n          (click) = \"$event.stopPropagation()\">\n        </mat-slider>\n      </div>\n    </mat-menu>\n\n    <button\n      *ngIf=\"layersChecked.length !== 0 && activeLayersAreValid(layersChecked)\"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayers' | translate\"\n      (click)=\"zoomLayersExtents(layersChecked)\">\n      <mat-icon svgIcon=\"magnify-scan\"></mat-icon>\n    </button>\n  </div>\n</igo-panel>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ContentChild,\n  OnInit,\n  OnDestroy,\n  Output,\n  EventEmitter,\n  ElementRef\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { LayerListControlsEnum, LayerListDisplacement } from './layer-list.enum';\nimport { LayerListSelectVisibleEnum } from './layer-list.enum';\nimport {\n  BehaviorSubject,\n  ReplaySubject,\n  Subscription,\n  EMPTY,\n  timer\n} from 'rxjs';\nimport { debounce } from 'rxjs/operators';\nimport {\n  MetadataOptions,\n  MetadataLayerOptions\n} from '../../metadata/shared/metadata.interface';\nimport { LayerListControlsOptions } from '../layer-list-tool/layer-list-tool.interface';\nimport { IgoMap } from '../../map/shared/map';\nimport { Layer } from '../shared/layers/layer';\nimport { LinkedProperties, LayersLink } from '../shared/layers/layer.interface';\nimport { MatSliderChange } from '@angular/material/slider';\nimport * as olextent from 'ol/extent';\n\n// TODO: This class could use a clean up. Also, some methods could be moved ealsewhere\n@Component({\n  selector: 'igo-layer-list',\n  templateUrl: './layer-list.component.html',\n  styleUrls: ['./layer-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerListComponent implements OnInit, OnDestroy {\n  orderable = true;\n  thresholdToFilterAndSort = 5;\n\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n\n  change$ = new ReplaySubject<void>(1);\n\n  showToolbar$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public layerTool: boolean;\n\n  public hideSelectedLayers: boolean = true;\n  activeLayer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\n\n  layersChecked: Layer[] = [];\n  public selection: boolean;\n\n  private change$$: Subscription;\n  private layers$$: Subscription;\n  public layerItemChangeDetection$ = new BehaviorSubject(undefined);\n\n  @ContentChild('igoLayerItemToolbar', /* TODO: add static flag */ {})\n  templateLayerToolbar: TemplateRef<any>;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = this.removeProblemLayerInList(value);\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n\n  set activeLayer(value: Layer) {\n    this._activeLayer = value;\n    this.activeLayer$.next(value);\n  }\n  get activeLayer(): Layer {\n    return this._activeLayer;\n  }\n  private _activeLayer: Layer;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input() layerFilterAndSortOptions: LayerListControlsOptions = {};\n\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n\n  get keyword(): string {\n    return this._keyword;\n  }\n  set keyword(value: string) {\n    this._keyword = value;\n    this.next();\n  }\n  private _keyword = undefined;\n\n  get onlyVisible(): boolean {\n    return this._onlyVisible;\n  }\n  set onlyVisible(value: boolean) {\n    this._onlyVisible = value;\n    this.next();\n  }\n  private _onlyVisible = false;\n\n  get sortAlpha(): boolean {\n    return this._sortedAlpha;\n  }\n  set sortAlpha(value: boolean) {\n    this._sortedAlpha = value;\n    this.next();\n  }\n  private _sortedAlpha = false;\n\n  get opacity() {\n    return Math.round(this.activeLayer$.getValue().opacity * 100);\n  }\n  set opacity(opacity: number) {\n    this.activeLayer$.getValue().opacity = opacity / 100;\n  }\n\n  get badgeOpacity() {\n    if (this.opacity === 100) {\n      return;\n    }\n    return this.opacity;\n  }\n\n  get raiseDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getUpperLayer().id === this.activeLayer.id ||\n      this.isUpperBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getLowerLayer().id === this.activeLayer.id ||\n      this.isLowerBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get raiseDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.raisableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.lowerableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get checkOpacity() {\n    return this.layersCheckedOpacity() * 100;\n  }\n  set checkOpacity(opacity: number) {\n    for (const layer of this.layersChecked) {\n      layer.opacity = opacity / 100;\n    }\n  }\n\n  get layerListDisplacement(): typeof LayerListDisplacement {\n    return LayerListDisplacement;\n  }\n\n  public toggleOpacity = false;\n\n  public selectAllCheck: boolean;\n  public selectAllCheck$ = new BehaviorSubject<boolean>(undefined);\n  private selectAllCheck$$: Subscription;\n\n  constructor(private elRef: ElementRef) { }\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.layers.length === 0 ? EMPTY : timer(50);\n        })\n      )\n      .subscribe(() => {\n        this.showToolbar$.next(this.computeShowToolbar());\n        this.layers$.next(this.computeLayers(this.layers.slice(0)));\n        this.appliedFilterAndSort.emit({\n          keyword: this.keyword,\n          sortAlpha: this.sortAlpha,\n          onlyVisible: this.onlyVisible\n        });\n      });\n\n    this.selectAllCheck$$ = this.selectAllCheck$.subscribe((value) => {\n      this.selectAllCheck = value;\n    });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layers) {\n        let checks = 0;\n        for (const layer of this.layers) {\n          layer.status$.subscribe(valStatus => {\n            if (valStatus === 0) {\n              this.map.removeLayer(layer);\n            }\n          });\n          if (layer.options.active) {\n            this.activeLayer = layer;\n            this.layerTool = true;\n          }\n          if (layer.options.check) {\n            checks += 1;\n          }\n        }\n        if (this.excludeBaseLayers) {\n          this.selectAllCheck =\n            checks ===\n              this.layers.filter(\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\n              ).length\n              ? true\n              : false;\n        } else {\n          this.selectAllCheck =\n            checks === this.layers.filter((lay) => lay.showInLayerList).length\n              ? true\n              : false;\n        }\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n    this.selectAllCheck$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  activeLayerIsValid(layer: Layer): boolean {\n    let valid = false;\n    const layerExtent = layer.options.extent;\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    if (layerExtent) {\n      if (maxLayerZoomExtent) {\n        valid = olextent.containsExtent(maxLayerZoomExtent, layerExtent);\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  activeLayersAreValid(layers: Layer[]): boolean {\n    let valid = false;\n    const layersExtent = olextent.createEmpty();\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent && !layerExtent.includes(Infinity)) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n\n    if (!olextent.isEmpty(layersExtent)) {\n      if (maxLayerZoomExtent) {\n        valid = (olextent.containsExtent(maxLayerZoomExtent, layersExtent));\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  zoomLayerExtents(layer: Layer) {\n    this.map.viewController.zoomToExtent(layer.options.extent);\n  }\n\n  zoomLayersExtents(layers: Layer[]) {\n    const layersExtent = olextent.createEmpty() as [number, number, number, number];\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n    this.map.viewController.zoomToExtent(layersExtent);\n  }\n\n  changeOpacity(event: MatSliderChange ){\n    this.opacity = event.value;\n  }\n\n  clearKeyword() {\n    this.keyword = undefined;\n  }\n\n  getLowerLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex < current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isLowerBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index + 1] &&\n      this.layers[index + 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  getUpperLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex > current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isUpperBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index - 1] &&\n      this.layers[index - 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  moveActiveLayer(activeLayer: Layer, actiontype: LayerListDisplacement) {\n    const layersToMove = [activeLayer];\n    const sortedLayersToMove = [];\n    this.getLinkedLayers(activeLayer, layersToMove);\n    this.layers.map(layer => {\n      if (layersToMove.indexOf(layer) !== -1) {\n        sortedLayersToMove.push(layer);\n      }\n    });\n\n    if (actiontype === LayerListDisplacement.Raise) {\n      this.raiseLayers(sortedLayersToMove, false);\n    } else if (actiontype === LayerListDisplacement.Lower) {\n      this.lowerLayers(sortedLayersToMove, false);\n    }\n  }\n\n  private getLinkedLayers(activeLayer: Layer, layersList: Layer[]) {\n    const linkedLayers = activeLayer.options.linkedLayers as LayersLink;\n    if (!linkedLayers) {\n      return;\n    }\n    const currentLinkedId = linkedLayers.linkId;\n    const currentLinks = linkedLayers.links;\n    const isParentLayer = currentLinks ? true : false;\n\n    if (isParentLayer) {\n      // search for child layers\n      currentLinks.map(link => {\n        if (!link.properties || link.properties.indexOf(LinkedProperties.ZINDEX) === -1) {\n          return;\n        }\n        link.linkedIds.map(linkedId => {\n          const childLayer = this.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\n          if (childLayer) {\n            if (!layersList.includes(childLayer)) {\n              layersList.push(childLayer);\n            }\n          }\n        });\n      });\n    } else {\n      // search for parent layer\n      this.layers.map(parentLayer => {\n        if (parentLayer.options.linkedLayers?.links) {\n          parentLayer.options.linkedLayers.links.map(l => {\n            if (\n              l.properties?.indexOf(LinkedProperties.ZINDEX) !== -1 &&\n              l.bidirectionnal !== false &&\n              l.linkedIds.indexOf(currentLinkedId) !== -1) {\n              layersList.push(parentLayer);\n              this.getLinkedLayers(parentLayer, layersList);\n            }\n          });\n        }\n      });\n    }\n  }\n\n  /*\n   * For selection mode disabled attribute\n   */\n  raisableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const previousLayer = this.layers[mapIndex - 1];\n      if (\n        previousLayer &&\n        previousLayer.baseLayer !== true &&\n        !layers.find((lay) => previousLayer.id === lay.id) &&\n        currentLayer.baseLayer !== true\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  raisableLayer(index: number) {\n    if (index < 1) {\n      return false;\n    }\n\n    if (this.layers[index - 1].options.check) {\n      return this.raisableLayer(index - 1);\n    }\n    return true;\n  }\n\n  raiseLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToRaise = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.raisableLayer(index)) {\n        layersToRaise.push(layer);\n      }\n    }\n    this.map.raiseLayers(layersToRaise);\n    if (fromUi) {\n      setTimeout(() => {\n        const elements = this.computeElementRef();\n        if (!this.isScrolledIntoView(elements[0], elements[1].offsetParent)) {\n          elements[0].scrollTop = elements[1].offsetParent.offsetTop;\n        }\n      }, 100);\n    }\n  }\n  /*\n   * For selection mode disabled attribute\n   */\n  lowerableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const nextLayer = this.layers[mapIndex + 1];\n      if (\n        nextLayer &&\n        nextLayer.baseLayer !== true &&\n        !layers.find((lay) => nextLayer.id === lay.id)\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  lowerableLayer(index: number) {\n    if (\n      index >\n      this.layers.filter((lay) => lay.baseLayer !== true).length - 2\n    ) {\n      return false;\n    }\n\n    if (this.layers[index + 1].options.check) {\n      return this.lowerableLayer(index + 1);\n    }\n    return true;\n  }\n\n  lowerLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToLower = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.lowerableLayer(index)) {\n        layersToLower.push(layer);\n      }\n    }\n    this.map.lowerLayers(layersToLower);\n    if (fromUi) {\n      setTimeout(() => {\n        const elements = this.computeElementRef('lower');\n        if (!this.isScrolledIntoView(elements[0], elements[1].offsetParent)) {\n          elements[0].scrollTop =\n            elements[1].offsetParent.offsetTop +\n            elements[1].offsetParent.offsetHeight -\n            elements[0].clientHeight;\n        }\n      }, 100);\n    }\n  }\n  private next() {\n    this.change$.next();\n  }\n\n  private computeLayers(layers: Layer[]): Layer[] {\n    let layersOut = this.filterLayers(layers);\n    if (this.sortAlpha) {\n      layersOut = this.sortLayersByTitle(layersOut);\n    } else {\n      layersOut = this.sortLayersByZindex(layersOut);\n    }\n    return layersOut;\n  }\n\n  onKeywordChange(term) {\n    this.keyword = term;\n  }\n\n  onAppliedFilterAndSortChange(appliedFilter: LayerListControlsOptions) {\n    this.keyword = appliedFilter.keyword;\n    this.onlyVisible = appliedFilter.onlyVisible;\n    this.sortAlpha = appliedFilter.sortAlpha;\n  }\n\n  private filterLayers(layers: Layer[]): Layer[] {\n    if (\n      this.layerFilterAndSortOptions.showToolbar === LayerListControlsEnum.never\n    ) {\n      return layers;\n    }\n    if (!this.keyword && !this.onlyVisible) {\n      return layers;\n    }\n\n    const keepLayerIds = layers.map((layer: Layer) => layer.id);\n\n    layers.forEach((layer: Layer) => {\n      const layerOptions = (layer.options as MetadataLayerOptions) || {};\n      const dataSourceOptions = layer.dataSource.options || {};\n      const metadata = layerOptions.metadata || ({} as MetadataOptions);\n      const keywords = metadata.keywordList || [];\n      const layerKeywords = keywords.map((kw: string) => {\n        return kw.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      });\n\n      if (this.keyword && layer.title) {\n        const localKeyword = this.keyword\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const layerTitle = layer.title\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const dataSourceType = dataSourceOptions.type || '';\n        const keywordRegex = new RegExp(localKeyword, 'gi');\n        const keywordInList =\n          layerKeywords.find((kw: string) => keywordRegex.test(kw)) !==\n          undefined;\n        if (\n          !keywordRegex.test(layerTitle) &&\n          !(this.keyword.toLowerCase() === dataSourceType.toLowerCase()) &&\n          !keywordInList\n        ) {\n          const index = keepLayerIds.indexOf(layer.id);\n          if (index > -1) {\n            keepLayerIds.splice(index, 1);\n          }\n        }\n      }\n\n      if (this.onlyVisible && layer.visible === false) {\n        const index = keepLayerIds.indexOf(layer.id);\n        if (index > -1) {\n          keepLayerIds.splice(index, 1);\n        }\n      }\n    });\n\n    return layers.filter(\n      (layer: Layer) => keepLayerIds.indexOf(layer.id) !== -1\n    );\n  }\n\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  private sortLayersByTitle(layers: Layer[]) {\n    return layers.sort((a, b) => {\n      if (this.normalize(a.title) < this.normalize(b.title)) {\n        return -1;\n      }\n      if (this.normalize(a.title) > this.normalize(b.title)) {\n        return 1;\n      }\n      return 0;\n    });\n  }\n\n  private normalize(str: string) {\n    return str\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .toLowerCase();\n  }\n\n  private computeShowToolbar(): boolean {\n    switch (this.layerFilterAndSortOptions.showToolbar) {\n      case LayerListControlsEnum.always:\n        return true;\n      case LayerListControlsEnum.never:\n        return false;\n      default:\n        if (\n          this.layers.length >= this.thresholdToFilterAndSort ||\n          this.keyword ||\n          this.onlyVisible\n        ) {\n          return true;\n        }\n        return false;\n    }\n  }\n\n  toggleLayerTool(layer) {\n    this.toggleOpacity = false;\n    if (this.layerTool && layer === this.activeLayer) {\n      this.layerTool = false;\n    } else {\n      this.layerTool = true;\n    }\n\n    for (const lay of this.layers) {\n      lay.options.active = false;\n    }\n    layer.options.active = true;\n    this.activeLayer = layer;\n  }\n\n  removeLayers(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      this.layersChecked = [];\n      for (const layer of layers) {\n        if (layer.options.removable !== false) {\n          layer.map.removeLayer(layer);\n        } else {\n          this.layersChecked.push(layer);\n        }\n      }\n    } else if (!layers && this.activeLayer.options.removable !== false) {\n      this.activeLayer.map.removeLayer(this.activeLayer);\n      this.layerTool = false;\n    }\n  }\n\n  toggleVisibility(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      for (const layer of layers) {\n        layer.visible = this.hideSelectedLayers;\n      }\n    }\n    this.layerItemChangeDetection$.next(true);\n  }\n\n  isLayerRemovable(layer: Layer): boolean {\n    return layer.options.removable !== false;\n  }\n\n  isAllLayersRemovable(layers: Layer[]): boolean {\n    return layers.every(l => this.isLayerRemovable(l));\n  }\n\n  get statusSelectedLayersCheck(): LayerListSelectVisibleEnum {\n    let statusSelectedLayers: LayerListSelectVisibleEnum =\n      LayerListSelectVisibleEnum.NULL;\n    let findTrue: boolean = false;\n    let findFalse: boolean = false;\n\n    if (this.layersChecked.length === 0) {\n      statusSelectedLayers = LayerListSelectVisibleEnum.NULL;\n    } else {\n      statusSelectedLayers = LayerListSelectVisibleEnum.MIXED;\n      this.hideSelectedLayers = false;\n\n      for (const layer2 of this.layersChecked) {\n        if (layer2.visible === true) {\n          findTrue = true;\n        }\n        if (layer2.visible === false) {\n          findFalse = true;\n        }\n      }\n\n      if (findTrue === true && findFalse === false) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_VISIBLE;\n      }\n      if (findTrue === false && findFalse === true) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_HIDDEN;\n        this.hideSelectedLayers = true;\n      }\n    }\n\n    return statusSelectedLayers;\n  }\n\n  layersCheck(event: { layer: Layer; check: boolean }) {\n    event.layer.options.check = event.check;\n    if (event.check === true) {\n      const eventMapIndex = this.layers.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      for (const layer of this.layersChecked) {\n        const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n        if (eventMapIndex < mapIndex) {\n          this.layersChecked.splice(\n            this.layersChecked.findIndex((lay) => layer.id === lay.id),\n            0,\n            event.layer\n          );\n\n          if (this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter(\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\n              ).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          } else if (!this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter((lay) => lay.showInLayerList).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          }\n          return;\n        }\n      }\n      this.layersChecked.push(event.layer);\n    } else {\n      const index = this.layersChecked.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      this.layersChecked.splice(index, 1);\n    }\n\n    if (this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter(\n          (lay) => lay.baseLayer !== true && lay.showInLayerList\n        ).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    } else if (!this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter((lay) => lay.showInLayerList).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    }\n  }\n\n  toggleSelectionMode(value: boolean) {\n    this.selection = value;\n    this.activeLayer = undefined;\n    if (value === true) {\n      this.layerTool = false;\n      for (const layer of this.layers) {\n        if (layer.options.check) {\n          this.layersChecked.push(layer);\n        }\n      }\n    }\n  }\n\n  layersCheckedOpacity(): any {\n    if (this.layersChecked.length > 1) {\n      return 1;\n    } else {\n      const opacity = [];\n      for (const layer of this.layersChecked) {\n        opacity.push(layer.opacity);\n      }\n      return opacity;\n    }\n  }\n\n  selectAll() {\n    if (!this.selectAllCheck) {\n      for (const layer of this.layers) {\n        if (\n          this.excludeBaseLayers &&\n          layer.baseLayer !== true &&\n          layer.showInLayerList\n        ) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        } else if (!this.excludeBaseLayers && layer.showInLayerList) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        }\n      }\n      this.selectAllCheck$.next(true);\n    } else {\n      for (const layer of this.layers) {\n        layer.options.check = false;\n      }\n      this.layersChecked = [];\n      this.selectAllCheck$.next(false);\n    }\n  }\n\n  isScrolledIntoView(elemSource, elem) {\n    const docViewTop = elemSource.scrollTop;\n    const docViewBottom = docViewTop + elemSource.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.clientHeight;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  computeElementRef(type?: string) {\n    const checkItems = this.elRef.nativeElement.getElementsByClassName(\n      'mat-checkbox-checked'\n    );\n    const checkItem =\n      type === 'lower'\n        ? this.elRef.nativeElement.getElementsByClassName(\n          'mat-checkbox-checked'\n        )[checkItems.length - 1]\n        : this.elRef.nativeElement.getElementsByClassName(\n          'mat-checkbox-checked'\n        )[0];\n    const igoList = this.elRef.nativeElement.getElementsByTagName(\n      'igo-list'\n    )[0];\n\n    return [igoList, checkItem];\n  }\n\n  removeProblemLayerInList(layersList: Layer[]): Layer[] {\n    for (const layer of layersList) {\n      if (layer.olLoadingProblem === true) {\n        this.map.removeLayer(layer);\n      }\n    }\n    return layersList;\n  }\n}\n","  <mat-list-item>\n      <mat-form-field class=\"inputFilter\" [floatLabel]=\"floatLabel\">\n        <input\n          matInput\n          [placeholder]=\"'igo.geo.layer.filterPlaceholder' | translate\"\n          [matTooltip]=\"'igo.geo.layer.subsetLayersListKeyword' | translate\"\n          matTooltipShowDelay=\"500\"\n          type=\"text\" [(ngModel)]=\"term\">\n        <button\n          mat-button\n          *ngIf=\"term\"\n          matSuffix\n          mat-icon-button\n          aria-label=\"Clear\"\n          color=\"warn\"\n          (click)=\"clearTerm()\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n        </button>\n      </mat-form-field>\n\n      <div [matTooltip]=\"sortAlpha ?\n      ('igo.geo.layer.sortMapOrder' | translate) :\n      ('igo.geo.layer.sortAlphabetically' | translate)\" matTooltipShowDelay=\"500\">\n        <button class=\"sort-alpha\" [color]=\"sortAlpha ? 'warn' : 'primary'\" mat-icon-button (click)=\"toggleSortAlpha()\">\n          <mat-icon [svgIcon]=\"sortAlpha ? 'sort-ascending' : 'sort-alphabetical-ascending'\"></mat-icon>\n        </button>\n      </div>\n\n       <div [matTooltip]=\"onlyVisible ?\n        ('igo.geo.layer.resetLayersList' | translate) :\n        ('igo.geo.layer.subsetLayersListOnlyVisible' | translate)\" matTooltipShowDelay=\"500\">\n         <button class=\"only-visible\" mat-icon-button [disabled]=\"layersAreAllVisible && !onlyVisible\"\n           [color]=\"onlyVisible ? 'warn' : 'primary'\" (click)=\"toggleOnlyVisible()\">\n           <mat-icon\n             matBadge=\"icon\"\n             igoMatBadgeIcon=\"eye\"\n             igoMatBadgeInverseColor=\"true\"\n             igoMatBadgeInheritColor=\"true\"\n             [svgIcon]=\"onlyVisible ? 'filter-remove' : 'filter'\">\n           </mat-icon>\n         </button>\n       </div>\n\n       <div [matTooltip]=\"selectionMode ?\n        ('igo.geo.layer.deactivateSelectionMode' | translate) :\n        ('igo.geo.layer.activateSelectionMode' | translate)\" matTooltipShowDelay=\"500\">\n         <button class=\"selection-mode\" mat-icon-button\n           color=\"primary\" (click)=\"toggleSelectionMode()\">\n           <mat-icon [svgIcon]=\"selectionMode ? 'checkbox-multiple-marked-outline' : 'checkbox-multiple-blank-outline'\"></mat-icon>\n         </button>\n       </div>\n\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit,\n  EventEmitter,\n  Output,\n  OnDestroy\n} from '@angular/core';\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LayerListControlsOptions } from './layer-list-tool.interface';\n\n@Component({\n  selector: 'igo-layer-list-tool',\n  templateUrl: './layer-list-tool.component.html',\n  styleUrls: ['./layer-list-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerListToolComponent implements OnInit, OnDestroy {\n  public onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public term$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n  onlyVisible$$: Subscription;\n  sortAlpha$$: Subscription;\n  term$$: Subscription;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input()\n  set onlyVisible(value: boolean) {\n    this.onlyVisible$.next(value);\n  }\n  get onlyVisible(): boolean {\n    return this.onlyVisible$.value;\n  }\n\n  @Input()\n  set sortAlpha(value: boolean) {\n    this.sortAlpha$.next(value);\n  }\n  get sortAlpha(): boolean {\n    return this.sortAlpha$.value;\n  }\n\n  @Input()\n  set term(value: string) {\n    this.term$.next(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n\n  public selectionMode = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n  @Output() selection = new EventEmitter<boolean>();\n\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe(keyword => {\n      this.appliedFilterAndSort.emit({\n        keyword,\n        onlyVisible: this.onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n\n    this.onlyVisible$$ = this.onlyVisible$.subscribe(onlyVisible => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n    this.sortAlpha$$ = this.sortAlpha$.subscribe(sortAlpha => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible: this.onlyVisible,\n        sortAlpha\n      });\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.onlyVisible$$.unsubscribe();\n    this.sortAlpha$$.unsubscribe();\n    this.term$$.unsubscribe();\n  }\n\n  clearTerm() {\n    this.term = undefined;\n  }\n  toggleSortAlpha() {\n    this.sortAlpha = !this.sortAlpha;\n  }\n\n  toggleOnlyVisible() {\n    this.onlyVisible = !this.onlyVisible;\n  }\n\n  toggleSelectionMode() {\n    this.selectionMode = !this.selectionMode;\n    this.selection.emit(this.selectionMode);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy, Optional } from '@angular/core';\nimport { Subscription, combineLatest } from 'rxjs';\n\nimport { RouteService } from '@igo2/core';\nimport { MapService } from '../../map/shared/map.service';\nimport { LayerListComponent } from './layer-list.component';\nimport { Layer } from '../shared/layers/layer';\nimport { map, debounceTime } from 'rxjs/operators';\n\n@Directive({\n  selector: '[igoLayerListBinding]'\n})\nexport class LayerListBindingDirective implements OnInit, OnDestroy {\n  private component: LayerListComponent;\n  private layersOrResolutionChange$$: Subscription;\n  layersVisibility$$: Subscription;\n\n  constructor(\n    @Self() component: LayerListComponent,\n    private mapService: MapService,\n    @Optional() private route: RouteService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    // this.component.layers = [];\n    this.layersOrResolutionChange$$ = combineLatest([\n      this.mapService.getMap().layers$,\n      this.mapService.getMap().viewController.resolution$]\n    ).pipe(\n      debounceTime(10)\n    ).subscribe((bunch: [Layer[], number]) => {\n      const shownLayers = bunch[0].filter((layer: Layer) => {\n        return layer.showInLayerList === true;\n      });\n      this.component.layers = shownLayers;\n      this.setLayersVisibilityStatus(shownLayers, this.component.excludeBaseLayers);\n    });\n  }\n\n  private setLayersVisibilityStatus(layers: Layer[], excludeBaseLayers: boolean) {\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n    this.layersVisibility$$ = combineLatest(layers\n      .filter(layer => layer.baseLayer !== excludeBaseLayers )\n      .map((layer: Layer) => layer.visible$))\n      .pipe(map((visibles: boolean[]) => visibles.every(Boolean)))\n      .subscribe((allLayersAreVisible: boolean) =>\n        this.component.layersAreAllVisible = allLayersAreVisible);\n  }\n\n  ngOnDestroy() {\n    this.layersOrResolutionChange$$.unsubscribe();\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n  }\n\n}\n","\n<div class=\"layer-legend-list-container\">\n  <mat-slide-toggle \n  tooltip-position=\"above\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.layer.legend.showAll' | translate\"\n  [checked]=\"showAllLegendsValue\" class=\"mat-typography\" \n  *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\" [labelPosition]=\"'before'\" (change)=\"toggleShowAllLegends($event.checked)\">\n    {{'igo.geo.layer.legend.showAll' | translate}}\n  </mat-slide-toggle>\n  <mat-divider *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"></mat-divider>\n  <igo-list [navigation]=\"false\" [selection]=\"false\">\n    <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n      <igo-layer-legend-item *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n          igoListItem [layer]=\"layer\"\n          [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n      </igo-layer-legend-item>\n    </ng-template>\n  </igo-list>\n  <p class=\"layers-empty mat-typography\" \n    *ngIf=\"!showAllLegendsValue && (layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async)===false && allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleWithShowAllButton' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\" \n    *ngIf=\"!showAllLegendsValue && (layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async) && allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\"\n    *ngIf=\"(layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async)===false && !allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisible' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\"\n    *ngIf=\"(layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async) && !allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleButZoom' | translate}} \n  </p>\n\n</div>","import { Component, Input, ChangeDetectionStrategy, OnInit, OnDestroy, EventEmitter, Output } from '@angular/core';\nimport { Layer } from '../shared';\nimport { BehaviorSubject, ReplaySubject, Subscription, EMPTY, timer } from 'rxjs';\nimport { debounce } from 'rxjs/operators';\n\n@Component({\n  selector: 'igo-layer-legend-list',\n  templateUrl: './layer-legend-list.component.html',\n  styleUrls: ['./layer-legend-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendListComponent implements OnInit, OnDestroy {\n  orderable = true;\n\n  hasVisibleOrInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  hasVisibleAndNotInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  layersInUi$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  showAllLegend: boolean = false;\n  public change$ = new ReplaySubject<void>(1);\n  private change$$: Subscription;\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() allowShowAllLegends: boolean = false;\n\n  @Input() showAllLegendsValue: boolean = false;\n\n  @Output() allLegendsShown = new EventEmitter<boolean>(false);\n\n  constructor() { }\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(debounce(() => {\n        return this.layers.length === 0 ? EMPTY : timer(50);\n      }))\n      .subscribe(() => {\n        const layers = this.computeShownLayers(this.layers.slice(0));\n        this.layers$.next(layers);\n        this.hasVisibleOrInRangeLayers$.next(\n          this.layers.slice(0)\n            .filter(layer => layer.baseLayer !== true)\n            .filter(layer => layer.visible$.value && layer.isInResolutionsRange$.value).length > 0\n        );\n        this.hasVisibleAndNotInRangeLayers$.next(\n          this.layers.slice(0)\n            .filter(layer => layer.baseLayer !== true)\n            .filter(layer => layer.visible$.value && !layer.isInResolutionsRange$.value).length > 0\n        );\n\n        this.layersInUi$.next(\n          this.layers.slice(0).filter(layer => layer.showInLayerList !== false && (!this.excludeBaseLayers || !layer.baseLayer))\n        );\n      });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n  }\n  private next() {\n    this.change$.next();\n  }\n  private computeShownLayers(layers: Layer[]) {\n    let shownLayers = layers.filter((layer: Layer) => layer.visible && layer.isInResolutionsRange);\n    if (this.showAllLegendsValue) {\n      shownLayers = layers;\n    }\n    return this.sortLayersByZindex(shownLayers);\n  }\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  toggleShowAllLegends(toggle: boolean) {\n      this.showAllLegendsValue = toggle;\n      this.next();\n      this.allLegendsShown.emit(toggle);\n  }\n}\n","<button *ngIf=\"options.trackFeature\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.layer.trackFeature' | translate\"\n  [color]=\"color\"\n  (click)=\"toggleTrackFeature()\">\n  <mat-icon svgIcon=\"crosshairs-gps\"></mat-icon>\n</button>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { VectorLayer } from '../shared/layers';\nimport { VectorLayerOptions } from '../shared/layers/vector-layer.interface';\n\n@Component({\n  selector: 'igo-track-feature-button',\n  templateUrl: './track-feature-button.component.html',\n  styleUrls: ['./track-feature-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TrackFeatureButtonComponent implements OnInit {\n\n  @Input() layer: VectorLayer;\n\n  @Input() trackFeature = false;\n\n  get options(): VectorLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n\n  public color: string = 'primary';\n\n  constructor() {}\n\n  ngOnInit() {\n    this.color = this.trackFeature ? 'primary' : 'basic';\n  }\n\n  toggleTrackFeature() {\n    if (this.trackFeature) {\n      this.layer.disableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'basic';\n    } else {\n      this.layer.enableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'primary';\n    }\n    this.trackFeature = !this.trackFeature;\n  }\n}\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { Layer, TooltipType } from '../shared/layers';\nimport { NetworkService, ConnectionState } from '@igo2/core';\n\n@Component({\n  selector: 'igo-layer-legend-item',\n  templateUrl: './layer-legend-item.component.html',\n  styleUrls: ['./layer-legend-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendItemComponent implements OnInit, OnDestroy {\n\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n\n  @Input() layer: Layer;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  constructor(private networkService: NetworkService) {}\n\n  ngOnInit() {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.state = state;\n      this.onResolutionChange();\n    });\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n}\n","<mat-list-item class= \"igo-layer-list-item\">\n  <h4 matLine class=\"igo-layer-title\" [matTooltip]=\"tooltipText\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n  </igo-layer-legend>\n</div>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatSliderModule } from '@angular/material/slider';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoListModule,\n  IgoCollapsibleModule,\n  IgoImageModule,\n  IgoPanelModule,\n  IgoMatBadgeIconModule\n} from '@igo2/common';\n\nimport { LayerService } from './shared/layer.service';\nimport { StyleService } from './shared/style.service';\nimport { LayerListToolService } from './layer-list-tool/layer-list-tool.service';\nimport { LayerItemComponent } from './layer-item/layer-item.component';\nimport { LayerLegendComponent } from './layer-legend/layer-legend.component';\nimport { LayerListComponent } from './layer-list/layer-list.component';\nimport { LayerListToolComponent } from './layer-list-tool/layer-list-tool.component';\nimport { LayerListBindingDirective } from './layer-list/layer-list-binding.directive';\nimport { LayerLegendListBindingDirective } from './layer-legend-list/layer-legend-list-binding.directive';\nimport { TrackFeatureButtonComponent } from './track-feature-button/track-feature-button.component';\nimport { LayerLegendListComponent } from './layer-legend-list/layer-legend-list.component';\nimport { LayerLegendItemComponent } from './layer-legend-item/layer-legend-item.component';\n\n@NgModule({\n  imports: [\n    MatInputModule,\n    MatFormFieldModule,\n    CommonModule,\n    FormsModule,\n    MatDividerModule,\n    MatMenuModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSlideToggleModule,\n    MatSelectModule,\n    MatTooltipModule,\n    MatListModule,\n    MatSliderModule,\n    MatBadgeModule,\n    MatCheckboxModule,\n    IgoLanguageModule,\n    IgoListModule,\n    IgoCollapsibleModule,\n    IgoImageModule,\n    IgoPanelModule,\n    IgoMatBadgeIconModule\n  ],\n  exports: [\n    LayerItemComponent,\n    LayerLegendItemComponent,\n    LayerLegendComponent,\n    LayerListComponent,\n    LayerListToolComponent,\n    LayerLegendListComponent,\n    LayerListBindingDirective,\n    LayerLegendListBindingDirective,\n    TrackFeatureButtonComponent\n  ],\n  declarations: [\n    LayerItemComponent,\n    LayerLegendItemComponent,\n    LayerLegendComponent,\n    LayerListComponent,\n    LayerListToolComponent,\n    LayerLegendListComponent,\n    LayerListBindingDirective,\n    LayerLegendListBindingDirective,\n    TrackFeatureButtonComponent\n  ]\n})\nexport class IgoLayerModule {\n  static forRoot(): ModuleWithProviders<IgoLayerModule> {\n    return {\n      ngModule: IgoLayerModule,\n      providers: [LayerService, StyleService, LayerListToolService]\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoMatBadgeIconModule,\n  IgoCollapsibleModule,\n  IgoListModule\n} from '@igo2/common';\n\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\nimport { CatalogBrowserComponent } from './catalog-browser.component';\nimport { CatalogBrowserLayerComponent } from './catalog-browser-layer.component';\nimport { CatalogBrowserGroupComponent } from './catalog-browser-group.component';\nimport { IgoLayerModule } from '../../layer/layer.module';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatButtonModule,\n    MatIconModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoMatBadgeIconModule,\n    IgoLanguageModule,\n    IgoListModule,\n    IgoCollapsibleModule,\n    IgoMetadataModule,\n    IgoLayerModule\n  ],\n  exports: [\n    CatalogBrowserComponent\n  ],\n  declarations: [\n    CatalogBrowserComponent,\n    CatalogBrowserGroupComponent,\n    CatalogBrowserLayerComponent\n  ]\n})\nexport class IgoCatalogBrowserModule {}\n","<h1 mat-dialog-title class=\"mat-typography\">{{'igo.geo.catalog.library.addTitle' | translate}}</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input type=\"text\" formControlName=\"title\" placeholder=\"{{'igo.geo.printForm.title' | translate}}\" matInput [matAutocomplete]=\"auto2\">\n        <mat-autocomplete #auto2=\"matAutocomplete\" (optionSelected)='changeUrlOrTitle($event.option.value)'>\n          <mat-option *ngFor=\"let predefinedCatalog of (predefinedCatalogsList$ | async)\" matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.title\" [value]=\"predefinedCatalog\">\n            {{predefinedCatalog.title}}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input type=\"text\" formControlName=\"url\" placeholder=\"URL\" matInput [matAutocomplete]=\"auto\">\n        <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)='changeUrlOrTitle($event.option.value)'>\n          <mat-option *ngFor=\"let predefinedCatalog of (predefinedCatalogsList$ | async)\" matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.url\" [value]=\"predefinedCatalog\">\n            {{predefinedCatalog.url}}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <mat-select\n          formControlName=\"type\"\n          placeholder=\"Type\">\n          <mat-option\n            *ngFor=\"let type of typeCapabilities\"\n            [value]=\"type\"\n            (click)=\"$event.stopPropagation()\">\n              <p mat-line>{{type}}</p>\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </form>\n  <span *ngIf=\"error && addedCatalog && emailAddress\">\n    <p class=\"error\">{{languageService.translate.instant('igo.geo.catalog.externalProvider.unavailableWithEmail', { value: addedCatalog.url, email: emailAddress })}}</p>\n  </span>\n  <span *ngIf=\"error && addedCatalog && !emailAddress\">\n    <p class=\"error\">{{languageService.translate.instant('igo.geo.catalog.unavailable', { value: addedCatalog.url })}}</p>\n  </span>\n</div>\n<div mat-dialog-actions style=\"justify-content: center\">\n  <div class=\"igo-form-button-group add-catalog-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      (click)=\"cancel()\">\n      {{'igo.geo.catalog.library.cancel' | translate}}\n    </button>\n    <button\n      id=\"addCatalogBtnDialog\"\n      mat-raised-button\n      type=\"button\"\n      color=\"primary\"\n      [disabled]=\"!form.valid\"\n      (click)=\"addCatalog(form.value)\">\n      {{'igo.geo.catalog.library.add' | translate}}\n    </button>\n  </div>\n</div>","import { LanguageService, ConfigService } from '@igo2/core';\nimport { Component, OnInit, OnDestroy, Optional, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { EntityStore } from '@igo2/common';\nimport { TypeCapabilities } from '../../datasource';\nimport { Catalog } from '../shared/catalog.abstract';\n\n@Component({\n  selector: 'igo-add-catalog-dialog',\n  templateUrl: './add-catalog-dialog.component.html',\n  styleUrls: ['./add-catalog-dialog.component.scss']\n})\nexport class AddCatalogDialogComponent implements OnInit, OnDestroy {\n  public form: FormGroup;\n  private defaultAddedCatalogType = 'wms';\n  private addedCatalogType$$: Subscription;\n  public predefinedCatalogsList$ = new BehaviorSubject<Catalog[]>([]);\n  typeCapabilities: string[];\n  predefinedCatalogs: Catalog[] = [];\n  store: EntityStore<Catalog>;\n  error = false;\n  addedCatalog: Catalog;\n  emailAddress: string;\n  private storeViewAll$$: Subscription;\n\n  constructor(\n    private formBuilder: FormBuilder,\n    public languageService: LanguageService,\n    private configService: ConfigService,\n    public dialogRef: MatDialogRef<AddCatalogDialogComponent>,\n    @Optional()\n    @Inject(MAT_DIALOG_DATA)\n    public data: { predefinedCatalogs: Catalog[]; store: EntityStore<Catalog>; error: boolean; addedCatalog: Catalog }\n  ) {\n    this.store = data.store;\n    this.predefinedCatalogs = data.predefinedCatalogs;\n    this.error = data.error;\n    this.addedCatalog = data.addedCatalog;\n    this.form = this.formBuilder.group({\n      id: ['', []],\n      title: ['', []],\n      url: ['', [Validators.required]],\n      type: [this.defaultAddedCatalogType, [Validators.required]]\n    });\n  }\n\n  ngOnInit() {\n    this.store.state.clear();\n    this.typeCapabilities = Object.keys(TypeCapabilities);\n\n    this.addedCatalogType$$ = this.form\n      .get('type')\n      .valueChanges.subscribe((value) => {\n        if (value === 'wmts') {\n          this.form.get('title').setValidators(Validators.required);\n        } else {\n          this.form.get('title').setValidators([]);\n        }\n        this.form.get('title').updateValueAndValidity();\n      });\n\n    this.computePredefinedCatalogList();\n    this.storeViewAll$$ = this.store.view\n      .all$()\n      .subscribe(() => this.computePredefinedCatalogList());\n\n    this.emailAddress = this.configService.getConfig('emailAddress');\n  }\n\n  ngOnDestroy() {\n    this.addedCatalogType$$.unsubscribe();\n    this.storeViewAll$$.unsubscribe();\n  }\n\n  changeUrlOrTitle(catalog: Catalog) {\n    this.form.patchValue(catalog);\n    this.error = false;\n    this.computePredefinedCatalogList();\n  }\n\n  computePredefinedCatalogList() {\n    this.predefinedCatalogsList$.next(\n      this.predefinedCatalogs.filter((c) => !this.store.get(c.id))\n    );\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    this.error = false;\n    this.dialogRef.close(addedCatalog);\n  }\n\n  cancel() {\n    this.error = false;\n    this.dialogRef.close();\n  }\n}\n","<igo-list [navigation]=\"false\">\n  <ng-template ngFor let-catalog [ngForOf]=\"getCatalogs() | async\">\n    <igo-catalog-library-item\n      igoListItem\n      color=\"accent\"\n      [map]=\"map\"\n      [catalog]=\"catalog\"\n      (catalogRemove)=\"onCatalogRemove(catalog)\"\n      (select)=\"onCatalogSelect(catalog)\">\n    </igo-catalog-library-item>\n  </ng-template>\n</igo-list>\n\n<div *ngIf=\"addCatalogAllowed\" class=btnAddCatalog>\n  <button\n    mat-raised-button\n    [matTooltip]=\"'igo.geo.catalog.library.addBtn' | translate\"\n    matTooltipPosition=\"above\"\n    color=\"primary\"\n    (click)=\"addCatalogDialog()\">\n    {{'igo.geo.catalog.library.addBtn' | translate}}\n    <mat-icon svgIcon=\"earth-plus\"></mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { EntityStore } from '@igo2/common';\nimport { LanguageService, MessageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\nimport { Observable, Subscription } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { Md5 } from 'ts-md5';\nimport { CapabilitiesService } from '../../datasource';\nimport { IgoMap } from '../../map';\nimport { standardizeUrl } from '../../utils/id-generator';\nimport { Catalog } from '../shared/catalog.abstract';\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\n\n/**\n * Component to browse a list of available catalogs\n */\n@Component({\n  selector: 'igo-catalog-library',\n  templateUrl: './catalog-library.component.html',\n  styleUrls: ['./catalog-library.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogLibaryComponent implements OnInit, OnDestroy {\n  /**\n   * Store holding the catalogs\n   */\n  @Input() store: EntityStore<Catalog>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() addCatalogAllowed: boolean = false;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() predefinedCatalogs: Catalog[] = [];\n\n  /**\n   * Event emitted a catalog is selected or unselected\n   */\n  @Output() catalogSelectChange = new EventEmitter<{\n    selected: boolean;\n    catalog: Catalog;\n  }>();\n\n  submitDisabled = true;\n  private addingCatalog$$: Subscription;\n\n  get addedCatalogs(): Catalog[] {\n    return (this.storageService.get('addedCatalogs') || []) as Catalog[];\n  }\n  set addedCatalogs(catalogs: Catalog[]) {\n    this.storageService.set('addedCatalogs', catalogs);\n  }\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private storageService: StorageService,\n    private dialog: MatDialog\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.state.clear();\n\n    this.predefinedCatalogs = this.predefinedCatalogs.map(c => {\n      c.id = Md5.hashStr(\n        (c.type || 'wms') + standardizeUrl(c.url)\n      ) as string;\n      c.title = c.title === '' || !c.title ? c.url : c.title;\n      return c;\n    });\n  }\n\n  getCatalogs(): Observable<Catalog[]> {\n    return this.store.view.all$();\n  }\n\n  /**\n   * When a catalog is selected, update it's state in the store\n   * and emit the catalog select change event\n   * @internal\n   */\n  onCatalogSelect(catalog: Catalog) {\n    this.store.state.update(\n      catalog,\n      {\n        selected: true,\n        focused: true\n      },\n      true\n    );\n    this.catalogSelectChange.emit({ selected: true, catalog });\n  }\n\n  private unsubscribeAddingCatalog() {\n    if (this.addingCatalog$$) {\n      this.addingCatalog$$.unsubscribe();\n    }\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    if (!addedCatalog) {\n      return;\n    }\n    let id = Md5.hashStr(\n      addedCatalog.type + standardizeUrl(addedCatalog.url)\n    ) as string;\n    const predefinedCatalog = this.predefinedCatalogs.find(\n      (c) => c.id === addedCatalog.id\n    );\n\n    if (predefinedCatalog) {\n      addedCatalog.version = predefinedCatalog.version;\n      addedCatalog.externalProvider = predefinedCatalog.externalProvider;\n      id = predefinedCatalog.id;\n    }\n\n    if (this.store.get(id)) {\n      const title = this.languageService.translate.instant(\n        'igo.geo.catalog.library.inlist.title'\n      );\n      const message = this.languageService.translate.instant(\n        'igo.geo.catalog.library.inlist.message'\n      );\n      this.messageService.alert(message, title);\n      return;\n    }\n    this.unsubscribeAddingCatalog();\n\n    this.addingCatalog$$ = this.capabilitiesService\n    .getCapabilities(addedCatalog.type as any, addedCatalog.url, addedCatalog.version)\n      .pipe(\n        catchError((e) => {\n          const title = this.languageService.translate.instant(\n            'igo.geo.catalog.unavailableTitle'\n          );\n          if (e.error) {\n            this.addCatalogDialog(true, addedCatalog);\n            e.error.caught = true;\n            return e;\n          }\n          const message = this.languageService.translate.instant(\n            'igo.geo.catalog.unavailable',\n            { value: addedCatalog.url }\n          );\n          this.messageService.error(message, title);\n          throw e;\n        })\n      )\n      .subscribe((capabilies) => {\n        let title;\n        let version;\n        switch (addedCatalog.type) {\n          case 'wms':\n            title = addedCatalog.title || capabilies.Service.Title;\n            version = addedCatalog.version || capabilies.version;\n            break;\n          case 'arcgisrest':\n          case 'imagearcgisrest':\n          case 'tilearcgisrest':\n            title = addedCatalog.title || capabilies.mapName;\n            break;\n          case 'wmts':\n            title =\n              addedCatalog.title ||\n              capabilies.ServiceIdentification.ServiceType;\n            break;\n          default:\n            title = addedCatalog.title;\n        }\n\n        const catalogToAdd = ObjectUtils.removeUndefined(\n          Object.assign({},\n            predefinedCatalog,\n            ObjectUtils.removeUndefined({\n              id,\n              title,\n              url: addedCatalog.url,\n              type: addedCatalog.type || 'wms',\n              externalProvider: addedCatalog.externalProvider || false,\n              removable: true,\n              version\n            })) as Catalog);\n        this.store.insert(catalogToAdd);\n        const newCatalogs = this.addedCatalogs.slice(0);\n        newCatalogs.push(catalogToAdd);\n        this.addedCatalogs = newCatalogs;\n        this.unsubscribeAddingCatalog();\n      });\n  }\n\n  ngOnDestroy() {\n    this.unsubscribeAddingCatalog();\n  }\n\n  onCatalogRemove(catalog) {\n    this.store.delete(catalog);\n    this.addedCatalogs = this.addedCatalogs\n      .slice(0)\n      .filter((c) => c.id !== catalog.id);\n  }\n\n  addCatalogDialog(error?, addedCatalog?: Catalog) {\n    const dialogRef = this.dialog.open(AddCatalogDialogComponent, {\n      width: '700px',\n      data: {\n        predefinedCatalogs: this.predefinedCatalogs,\n        store: this.store,\n        error,\n        addedCatalog\n      }\n    });\n\n    dialogRef.afterClosed().subscribe((catalog) => {\n      this.addCatalog(catalog);\n    });\n  }\n}\n","<mat-list-item>\n  <h4 mat-line>\n    {{title}}\n  </h4>\n  <mat-icon\n    class=\"igo-external-provider\"\n    *ngIf=\"catalog.externalProvider\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.catalog.externalProvider.catalog' | translate\"\n    color=\"primary\"\n    (click)=\"$event.stopPropagation()\"\n    svgIcon=\"earth-arrow-right\">\n  </mat-icon>\n\n  <button\n  *ngIf=\"catalog.removable\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.catalog.library.remove' | translate\"\n  color=\"warn\"\n  (click)=\"removeCatalogFromLibrary($event)\">\n  <mat-icon svgIcon=\"delete\"></mat-icon>\n</button>\n\n<button\n  class=\"igo-blank\"\n  *ngIf=\"!catalog.removable\"\n  disabled=\"true\"\n  mat-icon-button>\n  <mat-icon svgIcon=\"blank\"></mat-icon>\n</button>\n</mat-list-item>\n","import { Component, Input, ChangeDetectionStrategy, Output, EventEmitter } from '@angular/core';\n\nimport { getEntityTitle } from '@igo2/common';\nimport { IgoMap } from '../../map';\nimport { Catalog } from '../shared/catalog.abstract';\n\n/**\n * Catalog library item\n */\n@Component({\n  selector: 'igo-catalog-library-item',\n  templateUrl: './catalog-library-item.component.html',\n  styleUrls: ['./catalog-library-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogLibaryItemComponent {\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  @Output() catalogRemove = new EventEmitter();\n\n  /**\n   * @internal\n   */\n  get title(): string { return getEntityTitle(this.catalog); }\n\n  removeCatalogFromLibrary(event) {\n    event.stopPropagation();\n    this.catalogRemove.emit();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoListModule } from '@igo2/common';\n\nimport { CatalogLibaryComponent, } from './catalog-library.component';\nimport { CatalogLibaryItemComponent } from './catalog-library-item.component';\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatDialogModule } from '@angular/material/dialog';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatBadgeModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoListModule,\n    IgoLanguageModule,\n    MatButtonModule,\n    MatFormFieldModule,\n    ReactiveFormsModule,\n    MatInputModule,\n    MatSelectModule,\n    MatAutocompleteModule,\n    MatDialogModule\n  ],\n  exports: [\n    CatalogLibaryComponent,\n    AddCatalogDialogComponent\n  ],\n  declarations: [\n    CatalogLibaryComponent,\n    CatalogLibaryItemComponent,\n    AddCatalogDialogComponent\n  ]\n})\nexport class IgoCatalogLibraryModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoListModule, IgoCollapsibleModule, IgoMatBadgeIconModule } from '@igo2/common';\n\nimport { IgoCatalogBrowserModule } from './catalog-browser/catalog-browser.module';\nimport { IgoCatalogLibraryModule } from './catalog-library/catalog-library.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatIconModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoMatBadgeIconModule,\n    IgoListModule,\n    IgoCollapsibleModule\n  ],\n  exports: [\n    IgoCatalogBrowserModule,\n    IgoCatalogLibraryModule\n  ],\n  declarations: []\n})\nexport class IgoCatalogModule {}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\nimport { TimeFilterableDataSource } from './time-filter.interface';\n\n@Pipe({\n  name: 'filterableDataSource'\n})\nexport class FilterableDataSourcePipe implements PipeTransform {\n  transform(value: Layer[], arg: string): Layer[] {\n    let layers;\n\n    if (arg === 'time') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as TimeFilterableDataSource;\n        return (\n          this.isTimeFilterable(datasource) &&\n          datasource.options.timeFilter !== undefined &&\n          Object.keys(datasource.options.timeFilter).length\n        );\n      });\n    }\n    if (arg === 'ogc') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as OgcFilterableDataSource;\n        return this.isOgcFilterable(datasource);\n      });\n    }\n    return layers;\n  }\n\n  private isTimeFilterable(dataSource: TimeFilterableDataSource) {\n    if (dataSource.options.type !== 'wms') {\n      return false;\n    }\n    return dataSource.options.timeFilterable;\n  }\n\n  private isOgcFilterable(dataSource: OgcFilterableDataSource): boolean {\n    let isOgcFilterable = false;\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      dataSource.options.ogcFilters.editable\n    ) {\n      isOgcFilterable = true;\n    }\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      (\n        dataSource.options.ogcFilters.pushButtons ||\n        dataSource.options.ogcFilters.checkboxes ||\n        dataSource.options.ogcFilters.radioButtons ||\n        dataSource.options.ogcFilters.select)) {\n        isOgcFilterable = true;\n    }\n    return isOgcFilterable;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { TileArcGISRestDataSource } from '../../datasource/shared/datasources/tilearcgisrest-datasource';\n\n@Injectable()\nexport class TimeFilterService {\n  constructor() {}\n\n  filterByDate(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    date: Date | [Date, Date]\n  ) {\n    let time;\n    let newdateform;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(date)) {\n      const dates = [];\n      if (date[0]) {\n        newdateformStart = this.reformatDateTime(date[0]);\n        dates.push(date[0]);\n      }\n      if (date[1]) {\n        newdateformEnd = this.reformatDateTime(date[1]);\n        dates.push(date[1]);\n      }\n      if (dates.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else if (date) {\n      newdateform = this.reformatDateTime(date);\n      time = newdateform;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  filterByYear(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    year: string | [string, string]\n  ) {\n    let time;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(year)) {\n      const years = [];\n      if (year[0]) {\n        newdateformStart = year[0];\n        years.push(year[0]);\n      }\n      if (year[1]) {\n        newdateformEnd = year[1];\n        years.push(year[1]);\n      }\n      if (years.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else { // to reset filter.\n      time = year;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  private reformatDateTime(value) {\n    const year = value.getFullYear();\n    let month = value.getMonth() + 1;\n    let day = value.getUTCDate();\n    let hour = value.getUTCHours();\n    let minute = value.getUTCMinutes();\n\n    if (Number(month) < 10) {\n      month = '0' + month;\n    }\n\n    if (Number(day) < 10) {\n      day = '0' + day;\n    }\n\n    if (Number(hour) < 10) {\n      hour = '0' + hour;\n    }\n\n    if (Number(minute) < 10) {\n      minute = '0' + minute;\n    }\n\n    return year + '-' + month + '-' + day + 'T' + hour + ':' + minute + ':00Z';\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from './ogc-filter';\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterService {\n  constructor() {}\n\n  public filterByOgc(wmsDatasource: WMSDataSource, filterString: string) {\n    const appliedFilter = new OgcFilterWriter().formatProcessedOgcFilter(filterString, wmsDatasource.options.params.LAYERS);\n    wmsDatasource.ol.updateParams({ FILTER: appliedFilter });\n  }\n\n  public setOgcWFSFiltersOptions(wfsDatasource: OgcFilterableDataSource) {\n    const options: any = wfsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.paramsWFS.fieldNameGeometry,\n        new olProjection({ code: options.paramsWFS.srsName }),\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters = ogcFilterWriter.defineInterfaceFilterSequence(\n          options.ogcFilters.filters,\n          options.paramsWFS.fieldNameGeometry\n        );\n      }\n    }\n  }\n\n  public setOgcWMSFiltersOptions(wmsDatasource: OgcFilterableDataSource) {\n    const options: any = wmsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.fieldNameGeometry,\n        undefined,\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters = ogcFilterWriter.defineInterfaceFilterSequence(\n          // With some wms server, this param must be set to make spatials call.\n          options.ogcFilters.filters,\n          options.fieldNameGeometry\n        );\n      }\n      this.filterByOgc(\n        wmsDatasource as WMSDataSource,\n        ogcFilterWriter.buildFilter(options.ogcFilters.filters,\n        undefined,\n        undefined,\n        undefined,\n        wmsDatasource.options\n        )\n      );\n      options.filtered = true;\n    } else {\n      options.ogcFilters.filters = undefined;\n      options.ogcFilters.interfaceOgcFilters = [];\n      options.filtered = false;\n    }\n  }\n}\n","export enum SpatialFilterQueryType {\n    AdmRegion = 'AdmRegion',\n    Mun = 'Mun',\n    Arrond = 'Arrond',\n    CircFed = 'CircFed',\n    CircProv = 'CircProv',\n    DirReg = 'DirReg',\n    MRC = 'MRC',\n    RegTour = 'RegTour'\n}\n\nexport enum SpatialFilterType {\n    Predefined = 'Predefined',\n    Polygon = 'Polygon',\n    Point = 'Point'\n}\n\nexport enum SpatialFilterItemType {\n    Address = 'Address',\n    Thematics = 'Thematics'\n}\n","import { Injectable } from '@angular/core';\n\nimport { HttpClient } from '@angular/common/http';\nimport { ConfigService, LanguageService } from '@igo2/core';\nimport { map } from 'rxjs/operators';\nimport { Observable } from 'rxjs';\nimport { Feature } from '../../feature/shared';\nimport {\n  SpatialFilterQueryType,\n  SpatialFilterItemType,\n  SpatialFilterType\n} from './spatial-filter.enum';\nimport { SpatialFilterThematic } from './spatial-filter.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SpatialFilterService {\n  public baseUrl: string = 'https://geoegl.msp.gouv.qc.ca/apis/terrapi/';\n\n  /*\n   * Type association with URL\n   */\n  public urlFilterList = {\n    AdmRegion: 'regadmin',\n    Arrond: 'arrondissements',\n    CircFed: 'circ-fed',\n    CircProv: 'circ-prov',\n    DirReg: 'dir-reg',\n    MRC: 'mrc',\n    Mun: 'municipalites',\n    RegTour: 'tourisme',\n    bornes: 'bornes-sumi',\n    hydro: 'hydro',\n    routes: 'routes'\n  };\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    private configService: ConfigService\n  ) {\n    this.baseUrl =\n      this.configService.getConfig('spatialFilter.url') || this.baseUrl;\n  }\n\n  getKeyByValue(object, value) {\n    return Object.keys(object).find(key => object[key] === value);\n  }\n\n  /*\n   * Loading data for spatial filter list component (NO GEOMETRY)\n   */\n  loadFilterList(type: SpatialFilterQueryType): Observable<Feature[]> {\n    const urlPath = type as string;\n    if (urlPath) {\n      return this.http\n        .get<{ features: Feature[] }>(\n          this.baseUrl + this.urlFilterList[urlPath]\n        )\n        .pipe(\n          map(featureCollection =>\n            featureCollection.features.map(f => {\n              f.meta = {\n                id: f.properties.code\n              };\n              return f;\n            })\n          )\n        );\n    }\n  }\n\n  /*\n   * Loading item list (STRING)\n   */\n  loadThematicsList() {\n    const url = 'types';\n    const items: SpatialFilterThematic[] = [];\n    return this.http.get(this.baseUrl + url).pipe(\n      map((types: string[]) => {\n        types.forEach(type => {\n          if (type.startsWith('lieux')) {\n            const item: SpatialFilterThematic = {\n              name: undefined,\n              source: type\n            };\n            let substr = type.substring(6, type.length);\n            let name = substr;\n            if (substr.includes('.')) {\n              const index = substr.indexOf('.');\n              name = substr.substring(index + 1, substr.length);\n              substr = substr.substring(0, index);\n            }\n            try {\n              item.name = this.languageService.translate.instant(\n                'igo.geo.terrapi.' + name\n              );\n            } catch (e) {\n              item.name = name.substring(0, 1).toUpperCase() + name.substring(1, name.length - 1);\n            }\n\n            try {\n              item.group = this.languageService.translate.instant(\n                'igo.geo.spatialFilter.group.' + substr\n              );\n            } catch (e) {\n              item.group = substr.substring(0, 1).toUpperCase() + substr.substring(1, name.length - 1);\n            }\n\n            items.push(item);\n          } else {\n            if (this.getKeyByValue(this.urlFilterList, type)) {\n              const item: SpatialFilterThematic = {\n                name: undefined,\n                source: type\n              };\n              const name = this.getKeyByValue(this.urlFilterList, type);\n              try {\n                item.name = this.languageService.translate.instant(\n                  'igo.geo.terrapi.' + name\n                );\n              } catch (e) {\n                item.name = name.substring(0, 1).toUpperCase() + name.substring(1, name.length - 1);\n              }\n              item.source = type;\n\n              items.push(item);\n            }\n          }\n        });\n        return items;\n      })\n    );\n  }\n\n  /*\n   * Loading data for spatial filter item component (Address or Thematics) depends on predefined zone or draw zone (feature)\n   */\n  loadFilterItem(\n    feature,\n    itemType: SpatialFilterItemType,\n    type?: SpatialFilterQueryType,\n    thematic?: SpatialFilterThematic,\n    buffer?: number\n  ) {\n    if (type) {\n      // Predefined type\n      const urlType = type as string;\n      const url = this.baseUrl + this.urlFilterList[urlType];\n      let urlItem = '';\n      if (itemType === SpatialFilterItemType.Address) {\n        urlItem = 'adresses';\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        urlItem = thematic.source;\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    } else {\n      // Draw type\n      const url = this.baseUrl + 'locate';\n      if (itemType === SpatialFilterItemType.Address) {\n        const urlItem = '?type=adresses';\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        const urlItem = '?type=' + thematic.source;\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    }\n  }\n\n  /*\n   * Get one territory by id (WITH GEOMETRY)\n   */\n  loadItemById(\n    feature: Feature,\n    type: SpatialFilterQueryType\n  ): Observable<Feature> {\n    const featureType = this.urlFilterList[type];\n    const featureCode = '/' + feature.properties.code;\n    if (featureType && featureCode) {\n      return this.http\n        .get<Feature>(this.baseUrl + featureType + featureCode, {\n          params: {\n            geometry: 'true'\n          }\n        })\n        .pipe(\n          map(f => {\n            f.meta = {\n              id: f.properties.code,\n              alias: f.properties.nom,\n              title: f.properties.nom\n            };\n            return f;\n          })\n        );\n    }\n  }\n\n  /*\n   * Get buffer geometry\n   */\n  loadBufferGeometry(\n    feature: Feature,\n    filterType: SpatialFilterType,\n    buffer?: number,\n    type?: SpatialFilterQueryType,\n  ): Observable<Feature> {\n    if (filterType === SpatialFilterType.Predefined) {\n      const featureType = this.urlFilterList[type];\n      const featureCode = '/' + feature.properties.code;\n      if (featureType && featureCode) {\n        return this.http\n          .get<Feature>(this.baseUrl + featureType + featureCode,\n            {\n              params: {\n                geometry: '100',\n                bufferOutput: buffer.toString()\n              }\n            }\n          )\n          .pipe(\n            map(f => {\n              f.meta = {\n                id: f.properties.code,\n                alias: f.properties.nom,\n                title: f.properties.nom\n              };\n              return f;\n            })\n          );\n      }\n    } else {\n      return this.http\n        .post<Feature>(this.baseUrl + 'geospatial/buffer?', {\n          buffer,\n          loc: JSON.stringify(feature)\n        })\n        .pipe(\n          map(f => {\n            return f;\n          })\n        );\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\n\nimport { MessageService, LanguageService } from '@igo2/core';\n\nimport { Layer } from '../../layer/shared';\nimport { OgcFilterWriter, OgcFilterableDataSourceOptions } from '../../filter/shared';\n\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DownloadService {\n\n  constructor(\n    private messageService: MessageService,\n    private languageService: LanguageService\n  ) {}\n\n  open(layer: Layer) {\n    const translate = this.languageService.translate;\n    const title = translate.instant('igo.geo.download.title');\n    this.messageService.success(\n      translate.instant('igo.geo.download.start'),\n      title\n    );\n\n    const DSOptions: DataSourceOptions = layer.dataSource.options;\n    if (Object.keys(DSOptions.download).length > 0) {\n      if (\n        DSOptions.download.dynamicUrl &&\n        DSOptions.download.url === undefined\n      ) {\n        let wfsOptions;\n        let currentProj = new olProjection({ code: layer.map.projection });\n        const paramsWFS = (layer.dataSource.options as any).paramsWFS;\n        if (paramsWFS && Object.keys(paramsWFS).length > 0\n        ) {\n          currentProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : currentProj;\n          wfsOptions = (layer.dataSource.options as any).paramsWFS;\n        } else {\n          wfsOptions = (layer.dataSource.options as any).params;\n        }\n\n        const currentExtent = olproj.transformExtent(\n          layer.map.viewController.getExtent(),\n          new olProjection({ code: layer.map.projection }),\n          currentProj\n        );\n        const outputFormatDownload =\n          wfsOptions.outputFormatDownload === undefined\n            ? wfsOptions.outputFormat === undefined ? '' : 'outputformat=' + wfsOptions.outputFormat\n            : 'outputformat=' + wfsOptions.outputFormatDownload;\n\n        const baseurl = DSOptions.download.dynamicUrl\n          .replace(/&?outputformat=[^&]*/gi, '')\n          .replace(/&?filter=[^&]*/gi, '')\n          .replace(/&?bbox=[^&]*/gi, '');\n\n        const ogcFilters = (layer.dataSource.options as OgcFilterableDataSourceOptions).ogcFilters;\n\n        let filterQueryString;\n        filterQueryString = new OgcFilterWriter()\n        .handleOgcFiltersAppliedValue(\n          layer.dataSource.options,\n          ogcFilters.geometryName,\n          currentExtent as [number, number, number, number],\n          currentProj);\n        if (!filterQueryString) {\n          // Prevent getting all the features for empty filter\n            filterQueryString = new OgcFilterWriter().buildFilter(\n            undefined,\n            currentExtent as [number, number, number, number],\n            currentProj,\n            ogcFilters.geometryName\n          );\n        } else {\n          filterQueryString = 'filter=' + encodeURIComponent(filterQueryString);\n        }\n        window.open(\n          `${baseurl}&${filterQueryString}&${outputFormatDownload}`,\n          '_blank'\n        );\n      } else if (DSOptions.download) {\n        window.open(DSOptions.download.url, '_blank');\n      }\n    }\n  }\n}\n","<button\n  *ngIf=\"options && options.download && (options.download['dynamicUrl'] || options.download['url']) \"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\n  [color]=\"color\"\n  (click)=\"openDownload(layer)\">\n  <mat-icon svgIcon=\"download\"></mat-icon>\n</button>\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { DownloadDataSourceOptions } from '../shared/download.interface';\nimport { DownloadService } from '../shared/download.service';\n\n@Component({\n  selector: 'igo-download-button',\n  templateUrl: './download-button.component.html',\n  styleUrls: ['./download-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DownloadButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(private downloadService: DownloadService) {}\n\n  openDownload(layer: Layer) {\n    this.downloadService.open(layer);\n  }\n\n  get options(): DownloadDataSourceOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.dataSource.options;\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { DownloadButtonComponent } from './download-button/download-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule\n  ],\n  exports: [DownloadButtonComponent],\n  declarations: [DownloadButtonComponent]\n})\nexport class IgoDownloadModule {\n  static forRoot(): ModuleWithProviders<IgoDownloadModule> {\n    return {\n      ngModule: IgoDownloadModule\n    };\n  }\n}\n","<table class=\"igo-striped mat-typography\" *ngIf=\"ready && feature && isObject(feature.properties) && feature.properties.target !== 'iframe'\">\n  <tbody>\n    <tr *ngFor=\"let property of filterFeatureProperties(feature) | keyvalue\">\n\n      <td *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\">\n        <mat-icon mat-list-avatar svgIcon=\"{{icon}}\"></mat-icon>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\">\n        <a href=\"{{property.value}}\" target='_blank' rel=\"noopener noreferrer\"> {{ 'igo.geo.targetHtmlUrl' | translate }} {{title}}</a>\n      </td>\n\n      <td id=\"keyValue\" *ngIf=\"feature.properties.target === undefined\">\n        {{property.key }}\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && !isUrl(property.value)\" [innerHTML]=\"property.value\">\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && isUrl(property.value)\">\n        <a href=\"{{property.value}}\" target='_blank' rel=\"noopener noreferrer\">\n          <img *ngIf=\"isImg(property.value);else notImg\" src=\"{{(property.value | secureImage) | async}}\" width=\"225\" heigth=\"auto\">\n          <ng-template #notImg><span>{{ 'igo.geo.targetHtmlUrl' | translate }} </span></ng-template>\n        </a>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && isObject(property.value)\" [innerHTML]=\"property.value | json\">\n      </td>\n\n    </tr>\n  </tbody>\n</table>\n\n<iframe *ngIf=\"isHtmlDisplay()\" [srcdoc]=\"htmlSanitizer(feature.properties)\" [src]=\"urlSanitizer(feature.properties.url)\"></iframe>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Output,\n  EventEmitter,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\n\nimport { userAgent } from '@igo2/utils';\nimport { NetworkService, ConnectionState } from '@igo2/core';\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\nimport type { Toolbox } from '@igo2/common';\n\nimport { Feature } from '../shared';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { IgoMap } from '../../map/shared/map';\n\n@Component({\n  selector: 'igo-feature-details',\n  templateUrl: './feature-details.component.html',\n  styleUrls: ['./feature-details.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\n\nexport class FeatureDetailsComponent implements OnInit, OnDestroy {\n  private state: ConnectionState;\n  private unsubscribe$ = new Subject<void>();\n  ready = false;\n\n  @Input()\n  get source(): SearchSource {\n    return this._source;\n  }\n  set source(value: SearchSource) {\n    this._source = value;\n    this.cdRef.detectChanges();\n  }\n\n  @Input() map: IgoMap;\n\n  @Input() toolbox: Toolbox;\n\n  @Input()\n  get feature(): Feature {\n    return this._feature;\n  }\n  set feature(value: Feature) {\n    this._feature = value;\n    this.cdRef.detectChanges();\n    this.selectFeature.emit();\n  }\n\n  private _feature: Feature;\n  private _source: SearchSource;\n\n  @Output() routeEvent = new EventEmitter<boolean>();\n  @Output() selectFeature = new EventEmitter<boolean>();\n  @Output() htmlDisplayEvent = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.feature);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.feature) || 'link';\n  }\n\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private sanitizer: DomSanitizer,\n    private networkService: NetworkService\n  ) {\n    this.networkService.currentState().pipe(takeUntil(this.unsubscribe$)).subscribe((state: ConnectionState) => {\n      this.state = state;\n    });\n  }\n\n  ngOnInit() {\n    this.ready = true;\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  urlSanitizer(value): SafeResourceUrl {\n    return this.sanitizer.bypassSecurityTrustResourceUrl(value);\n  }\n\n\n  isHtmlDisplay(): boolean {\n    if (this.feature && this.isObject(this.feature.properties) && this.feature.properties.target === 'iframe') {\n      this.htmlDisplayEvent.emit(true);\n      return true;\n    } else {\n      this.htmlDisplayEvent.emit(false);\n      return false;\n    }\n  }\n\n  htmlSanitizer(value): SafeResourceUrl {\n    if (!value.body || userAgent.getBrowserName() === 'Internet Explorer') {\n      return;\n    }\n    const regexBase = /<base href=\"[\\w:\\/\\.]+\">/;\n    if (!regexBase.test(value.body)) {\n      const url = new URL(value.url, window.location.origin);\n      value.body = value.body.replace('<head>', `<head><base href=\"${url.origin}\">`);\n    }\n\n    return this.sanitizer.bypassSecurityTrustHtml(value.body);\n  }\n\n  isObject(value) {\n    return typeof value === 'object';\n  }\n\n  isUrl(value) {\n    if (typeof value === 'string') {\n      return (\n        value.slice(0, 8) === 'https://' || value.slice(0, 7) === 'http://'\n      );\n    } else {\n      return false;\n    }\n  }\n\n  isImg(value) {\n    if (this.isUrl(value)) {\n      return (\n        ['jpg', 'png', 'gif'].includes(value.split('.').pop().toLowerCase())\n      );\n    } else {\n      return false;\n    }\n  }\n\n  filterFeatureProperties(feature) {\n    const allowedFieldsAndAlias = feature.meta ? feature.meta.alias : undefined;\n    const properties = {};\n    let offlineButtonState;\n\n    if (this.map) {\n      this.map.offlineButtonToggle$.pipe(takeUntil(this.unsubscribe$)).subscribe(state => {\n        offlineButtonState = state;\n      });\n    }\n\n    if (feature.properties && feature.properties.Route && this.toolbox && !this.toolbox.getTool('directions')) {\n      delete feature.properties.Route;\n    }\n\n    if (allowedFieldsAndAlias) {\n      Object.keys(allowedFieldsAndAlias).forEach(field => {\n        properties[allowedFieldsAndAlias[field]] = feature.properties[field];\n      });\n      return properties;\n    } else if (offlineButtonState !== undefined) {\n      if (!offlineButtonState) {\n        if (this.state.connection && feature.meta && feature.meta.excludeAttribute) {\n          const excludeAttribute = feature.meta.excludeAttribute;\n          excludeAttribute.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        } else if (!this.state.connection && feature.meta && feature.meta.excludeAttributeOffline) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        }\n      } else {\n        if (feature.meta && feature.meta.excludeAttributeOffline) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        }\n      }\n    } else {\n      if (this.state.connection && feature.meta && feature.meta.excludeAttribute) {\n        const excludeAttribute = feature.meta.excludeAttribute;\n        excludeAttribute.forEach(attribute => {\n          delete feature.properties[attribute];\n        });\n      } else if (!this.state.connection && feature.meta && feature.meta.excludeAttributeOffline) {\n        const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n        excludeAttributeOffline.forEach(attribute => {\n          delete feature.properties[attribute];\n        });\n      }\n    }\n    return feature.properties;\n  }\n}\n","export enum GeometryType {\n    Point = 'Point',\n    LineString = 'LineString',\n    Polygon = 'Polygon',\n    Circle = 'Circle'\n}\n","import OlCircle from 'ol/geom/Circle';\nimport OlPoint from 'ol/geom/Point';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\nimport OlLineString from 'ol/geom/LineString';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlPolygon from 'ol/geom/Polygon';\nimport BasicEvent from 'ol/events/Event';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport lineIntersect from '@turf/line-intersect';\nimport { lineString } from '@turf/helpers';\n\nimport {\n  GeometrySliceMultiPolygonError,\n  GeometrySliceLineStringError,\n  GeometrySliceTooManyIntersectionError\n } from './geometry.errors';\n\n/**\n * Create a default style for draw and modify interactions\n * @param color Style color (R, G, B)\n * @returns OL style\n */\nexport function createDrawInteractionStyle(color?: [number, number, number]): olstyle.Circle {\n  color = color || [0, 153, 255];\n  return new olstyle.Circle({\n    stroke: new olstyle.Stroke({\n      color: color.concat([1]),\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: color.concat([0.2])\n    }),\n    radius: 8\n  });\n}\n\n/**\n * Create a default style for drawing a hole\n * @returns OL style\n */\nexport function createDrawHoleInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color:  [0, 153, 255, 1],\n      width: 2\n    })\n  });\n}\n\n/**\n * Slice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function sliceOlGeometry(\n  olGeometry: OlLineString | OlPolygon,\n  olSlicer: OlLineString\n): Array<OlLineString | OlPolygon> {\n  if (olGeometry instanceof OlPolygon) {\n    return sliceOlPolygon(olGeometry, olSlicer);\n  } else if (olGeometry instanceof OlLineString) {\n    return sliceOlLineString(olGeometry, olSlicer);\n  }\n  return [];\n}\n\n/**\n * Slice OL LineString into one or more lines\n * @param olLineString OL line string\n * @param olSlicer Slicing line\n * @returns New OL line strings\n */\nexport function sliceOlLineString(olLineString: OlLineString, olSlicer: OlLineString): OlLineString[] {\n  return [];\n}\n\n/**\n * Slice OL Polygon into one or more polygons\n * @param olPolygon OL polygon\n * @param olSlicer Slicing line\n * @returns New OL polygons\n */\nexport function sliceOlPolygon(olPolygon: OlPolygon, olSlicer: OlLineString): OlPolygon[] {\n  if (olPolygon.getLinearRingCount() > 1) {\n    throw new GeometrySliceMultiPolygonError();\n  }\n\n  if (olSlicer.getCoordinates().length > 2) {\n    throw new GeometrySliceLineStringError();\n  }\n\n  const olGeoJSON = new OlGeoJSON();\n  const slicer = olGeoJSON.writeGeometryObject(olSlicer) as any;\n  const outerCoordinates = olPolygon.getLinearRing(0).getCoordinates();\n\n  const parts = [[], []];\n  let totalIntersectionCount = 0;\n  for (let i = 0, ii = outerCoordinates.length - 1; i < ii; i++) {\n    const segmentCoordinates = [outerCoordinates[i], outerCoordinates[i + 1]];\n    const segment = lineString(segmentCoordinates);\n    const intersections = lineIntersect(segment, slicer).features;\n\n    const intersectionCount = intersections.length;\n    totalIntersectionCount += intersectionCount;\n    if (intersectionCount > 1 || totalIntersectionCount > 2) {\n      throw new GeometrySliceTooManyIntersectionError();\n    }\n\n    parts[0].push(segmentCoordinates[0]);\n    if (intersectionCount === 1) {\n      const intersection = intersections[0].geometry.coordinates;\n      parts[0].push(intersection);\n      parts[1].push(intersection);\n      parts.reverse();\n    }\n  }\n\n  if (totalIntersectionCount <= 1) {\n    return [];\n  }\n\n  parts[0].push(parts[0][0]);\n  parts[1].push(parts[1][0]);\n\n  return [new OlPolygon([parts[0]]), new OlPolygon([parts[1]])];\n}\n\n/**\n * Splice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function addLinearRingToOlPolygon(olPolygon: OlPolygon, olLinearRing: OlLinearRing ) {\n  // TODO: make some validation and support updating an existing linear ring\n  olPolygon.appendLinearRing(olLinearRing);\n}\n\nexport function getMousePositionFromOlGeometryEvent(\n  olEvent: BasicEvent\n) {\n  const olGeometry = olEvent.target as OlGeometry;\n  if (olGeometry instanceof OlPolygon) {\n    return olGeometry.getFlatCoordinates().slice(-4, -2) as [number, number];\n  }\n  const olGeometryCast = olGeometry as OlPoint | OlLineString | OlCircle;\n  return olGeometryCast.getFlatCoordinates().slice(-2) as [number, number];\n}\n","/* eslint-disable */\n// See this issue: https://github.com/Microsoft/TypeScript/issues/13965\n// And the solution: https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\n// for an explanation as to why the prototype is set manually\n/* eslint-enable */\n\nexport class GeometrySliceError extends Error {}\n\nexport class GeometrySliceMultiPolygonError extends GeometrySliceError {\n  constructor() {\n    super('Can\\'t slice a MultiPolygon.');\n    Object.setPrototypeOf(this, GeometrySliceMultiPolygonError.prototype);\n  }\n}\n\nexport class GeometrySliceLineStringError extends GeometrySliceError {\n  constructor() {\n    super('Can\\'t slice with a line that has more than 2 points.');\n    Object.setPrototypeOf(this, GeometrySliceLineStringError.prototype);\n  }\n}\n\nexport class GeometrySliceTooManyIntersectionError extends GeometrySliceError {\n  constructor() {\n    super('More than 2 intersections found between the target polygon and the slicing line.');\n    Object.setPrototypeOf(this, GeometrySliceTooManyIntersectionError.prototype);\n  }\n}\n","import { EventsKey } from 'ol/events';\nimport OlMap from 'ol/Map';\nimport OlFeature from 'ol/Feature';\nimport * as OlStyle from 'ol/style';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlDraw from 'ol/interaction/Draw';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlModify from 'ol/interaction/Modify';\nimport OlSelect from 'ol/interaction/Select';\nimport BasicEvent from 'ol/events/Event';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport { SelectEvent as OlSelectEvent } from 'ol/interaction/Select';\nimport { unByKey } from 'ol/Observable';\nimport { doubleClick } from 'ol/events/condition';\n\nimport { Subject, Subscription, fromEvent, BehaviorSubject } from 'rxjs';\n\nimport { getMousePositionFromOlGeometryEvent } from '../geometry.utils';\n\nexport interface DrawControlOptions {\n  geometryType: typeof OlGeometryType | string;\n  drawingLayerSource?: OlVectorSource<OlGeometry>;\n  drawingLayer?: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  drawingLayerStyle?: OlStyle.Style | ((olFeature: OlFeature<OlGeometry>) => OlStyle.Style);\n  interactionStyle?: OlStyle.Style | ((olFeature: OlFeature<OlGeometry>) => OlStyle.Style);\n  maxPoints?: number;\n}\n\n/**\n * Control to draw entities\n */\nexport class DrawControl {\n  /**\n   * Draw start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw changes observable (while drawing)\n   */\n  public changes$: Subject<any> = new Subject();\n\n  /**\n   * Draw modify observable (modify drawn features)\n   */\n  public modify$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw select observable (modify drawn features)\n   */\n  public select$: Subject<any> = new Subject();\n\n  /**\n   * Freehand mode observable (defaults to false)\n   */\n  freehand$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  private keyDown$$: Subscription;\n\n  private olGeometryType: typeof OlGeometryType | undefined | string;\n  private olMap: OlMap;\n  private olDrawingLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  private olDrawInteraction: OlDraw;\n  private olSelectInteraction: OlSelect;\n  private olModifyInteraction: OlModify;\n  private onDrawStartKey: EventsKey;\n  private onDrawEndKey: EventsKey;\n  private onDrawKey: EventsKey;\n\n  private mousePosition: [number, number];\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olDrawingLayerSource(): OlVectorSource<OlGeometry> {\n    return this.olDrawingLayer.getSource();\n  }\n\n  constructor(private options: DrawControlOptions) {\n    this.olDrawingLayer = options.drawingLayer ? options.drawingLayer : this.createOlInnerOverlayLayer();\n    this.olGeometryType = this.options.geometryType;\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined, activateModifyAndSelect?: boolean) {\n    if (!olMap) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlInteractions();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n    this.addOlInteractions(activateModifyAndSelect);\n  }\n\n  /**\n   * Return the drawing layer source\n   */\n  getSource(): OlVectorSource<OlGeometry> {\n    return this.olDrawingLayerSource;\n  }\n\n  /**\n   * Set the current geometry type\n   * @param geometryType the geometry type\n   */\n  setGeometryType(geometryType: typeof OlGeometryType) {\n    this.olGeometryType = geometryType;\n  }\n\n  /**\n   * Create a drawing source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<OlVectorSource<OlGeometry>> {\n    return new OlVectorLayer({\n      source: this.options.drawingLayerSource ? this.options.drawingLayerSource : new OlVectorSource(),\n      style: this.options.drawingLayerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Clear the drawing layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer && this.olMap) {\n      this.olMap.removeLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Add the drawing layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer) {\n      this.olMap.addLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Clear the drawing layer source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (!this.options.drawingLayer && !this.options.drawingLayerSource) {\n      this.olDrawingLayerSource.clear(true);\n    }\n  }\n\n  /**\n   * Add interactions to the map an set up some listeners\n   */\n  addOlInteractions(activateModifyAndSelect?: boolean) {\n    // Create Draw interaction\n    let olDrawInteraction;\n    if (!this.freehand$.getValue()) {\n      olDrawInteraction = new OlDraw({\n        type: this.olGeometryType,\n        source: this.getSource(),\n        stopClick: true,\n        style: this.options.interactionStyle,\n        maxPoints: this.options.maxPoints,\n        freehand: false,\n        freehandCondition: () => false\n      });\n\n    } else {\n      if (this.olGeometryType === 'Point') {\n        olDrawInteraction = new OlDraw({\n          type: 'Circle',\n          source: this.getSource(),\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n\n      } else {\n        olDrawInteraction = new OlDraw({\n          type: this.olGeometryType,\n          source: this.getSource(),\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n      }\n    }\n\n    // Add Draw interaction to map and create listeners\n    this.olMap.addInteraction(olDrawInteraction);\n    this.olDrawInteraction = olDrawInteraction;\n\n    this.onDrawStartKey = olDrawInteraction.on('drawstart', (event: OlDrawEvent) => this.onDrawStart(event));\n    this.onDrawEndKey = olDrawInteraction.on('drawend', (event: OlDrawEvent) => this.onDrawEnd(event));\n\n    if (activateModifyAndSelect) {\n      // Create a Modify interaction, add it to map and create a listener\n      const olModifyInteraction = new OlModify({\n        source: this.getSource()\n      });\n\n      this.olMap.addInteraction(olModifyInteraction);\n      this.olModifyInteraction = olModifyInteraction;\n\n      // Create a select interaction and add it to map\n      if (!this.olSelectInteraction) {\n        const olSelectInteraction = new OlSelect({\n          condition: doubleClick,\n          style: undefined\n        });\n        this.olMap.addInteraction(olSelectInteraction);\n        this.olSelectInteraction = olSelectInteraction;\n\n        this.olSelectInteraction.on('select', (event: OlSelectEvent) => this.onSelect(event));\n      }\n    }\n  }\n\n  /**\n   * Remove interactions\n   */\n  private removeOlInteractions() {\n    this.unsubscribeKeyDown();\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey]);\n\n    if (this.olMap) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n\n    this.olDrawInteraction = undefined;\n    this.olModifyInteraction = undefined;\n  }\n\n  /**\n   * When drawing starts, clear the overlay and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.start$.next(olGeometry);\n    this.clearOlInnerOverlaySource();\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\n      this.changes$.next(olGeometryEvent.target);\n    });\n    this.subscribeKeyDown();\n  }\n\n  /**\n   * When drawing ends, update the drawing (feature) geometry observable and add\n   * @param event Draw event (drawend)\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    this.unsubscribeKeyDown();\n    unByKey(this.onDrawKey);\n    const olGeometry = event.feature.getGeometry();\n    olGeometry.on('change', () => {\n      this.modify$.next(olGeometry);\n    });\n    this.end$.next(olGeometry);\n  }\n\n  /**\n   * When a feature is selected, update the selected feature observable\n   * @param event Modify event (modifyend)\n   */\n  private onSelect(event: OlSelectEvent) {\n    if (event.selected.length === 1) {\n      this.select$.next(event.selected[0]);\n    }\n  }\n\n  /**\n   * Subscribe to key downs used as drawing interaction shorcuts\n   */\n  private subscribeKeyDown() {\n    this.unsubscribeKeyDown();\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe((event: KeyboardEvent) => {\n      // On Escape or 'c' keydowns, abort the current drawing\n      if (event.key === 'Escape') {\n        this.olDrawInteraction.abortDrawing();\n        return;\n      }\n\n      // On Backspace or 'u' keydowns, remove last vertex of current drawing\n      if (event.key === 'Backspace') {\n        this.olDrawInteraction.removeLastPoint();\n      }\n\n      // On Enter or 'f' keydowns, finish current drawing\n      if (event.key === 'Enter') {\n        this.olDrawInteraction.finishDrawing();\n      }\n\n      // On space bar key down, pan to the current mouse position\n      if (event.key === ' ') {\n        this.olMap.getView().animate({\n          center: this.mousePosition,\n          duration: 100\n        });\n        return;\n      }\n    });\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeKeyDown() {\n    if (this.keyDown$$) {\n      this.keyDown$$.unsubscribe();\n      this.keyDown$$ = undefined;\n    }\n  }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nexport interface DialogData {\n  label: string;\n}\n\n@Component({\n    selector: 'igo-draw-popup-component',\n    templateUrl: './draw-popup.component.html',\n    styleUrls: ['./draw-popup.component.scss'],\n  })\n  export class DrawPopupComponent {\n\n    constructor(\n      public dialogRef: MatDialogRef<DrawPopupComponent>,\n      @Inject(MAT_DIALOG_DATA) public data: {currentLabel: string}) {}\n\n    noLabel() {\n      this.dialogRef.close();\n    }\n  }\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">{{'igo.geo.draw.dialogInstruction' | translate}}</p>\n  <mat-form-field class=\"example-full-width\">\n    <input\n      #input\n      matInput\n      placeholder=\"{{'igo.geo.draw.dialogTitle' | translate}}\"\n      value=\"{{data.currentLabel}}\">\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button\n    mat-raised-button\n    (click)=\"noLabel()\">{{'igo.geo.draw.noLabel' | translate}}\n  </button>\n  <button\n    mat-raised-button\n    color=\"primary\"\n    [mat-dialog-close]=\"input.value\">OK\n  </button>\n</div>","import { Component } from '@angular/core';\n\n@Component({\n  selector: 'igo-draw-shorcuts',\n  templateUrl: './draw-shorcuts.component.html',\n  styleUrls: ['./draw-shorcuts.component.scss']\n})\n\nexport class DrawShorcutsComponent {}\n","<mat-dialog-content>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-return\"></mat-icon>{{'igo.geo.draw.finish' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"backspace-outline\"></mat-icon>{{'igo.geo.draw.undo' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-esc\"></mat-icon>{{'igo.geo.draw.abort' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-space\"></mat-icon>{{'igo.geo.draw.move' | translate}}</span>\n  </div>\n</mat-dialog-content>\n<mat-dialog-actions class=\"shortcuts-close\">\n  <button mat-raised-button mat-dialog-close color=\"primary\">OK</button>\n</mat-dialog-actions>","\nexport const MEASURE_UNIT_AUTO = 'auto';\n\nexport enum MeasureType {\n  Length = 'length',\n  Area = 'area'\n}\n\nexport enum MeasureLengthUnit {\n  Meters = 'meters',\n  Kilometers = 'kilometers',\n  Miles = 'miles',\n  Feet = 'feet'\n}\n\nexport const MeasureLengthUnitAbbreviation = {\n  [MeasureLengthUnit.Meters]: 'm',\n  [MeasureLengthUnit.Kilometers]: 'km',\n  [MeasureLengthUnit.Miles]: 'mi',\n  [MeasureLengthUnit.Feet]: 'ft'\n};\n\nexport enum MeasureAreaUnit {\n  SquareMeters = 'squareMeters',\n  SquareKilometers = 'squareKilometers',\n  SquareMiles = 'squareMiles',\n  SquareFeet = 'squareFeet',\n  Hectares = 'hectares',\n  Acres = 'acres'\n}\n\nexport const MeasureAreaUnitAbbreviation = {\n  [MeasureAreaUnit.SquareMeters]: 'm²',\n  [MeasureAreaUnit.SquareKilometers]: 'km²',\n  [MeasureAreaUnit.SquareMiles]: 'mi²',\n  [MeasureAreaUnit.SquareFeet]: 'ft²',\n  [MeasureAreaUnit.Hectares]: 'ha',\n  [MeasureAreaUnit.Acres]: 'ac'\n};\n","import { LanguageService } from '@igo2/core';\nimport * as olstyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport OlOverlay from 'ol/Overlay';\nimport { getCenter as olGetCenter } from 'ol/extent';\nimport {\n  getLength as olGetLength,\n  getArea as olGetArea\n} from 'ol/sphere';\n\nimport { Measure } from './measure.interfaces';\nimport {\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation\n} from './measure.enum';\n\n/**\n * Convert value from meters to kilometers\n * @param value Value in meters\n * @returns Value in kilometers\n */\nexport function metersToKilometers(value: number): number {\n  return value * 0.001;\n}\n\n/**\n * Convert value from meters to feet\n * @param value Value in meters\n * @returns Value in feet\n */\nexport function metersToFeet(value: number): number {\n  return value * 3.2808;\n}\n\n/**\n * Convert value from meters to miles\n * @param value Value in meters\n * @returns Value in miles\n */\nexport function metersToMiles(value: number): number {\n  return value * 0.000621;\n}\n\n/**\n * Convert value from square meters to square kilometers\n * @param value Value in square meters\n * @returns Value in square kilometers\n */\nexport function squareMetersToSquareKilometers(value: number): number {\n  return value * 0.000001;\n}\n\n/**\n * Convert value from square meters to square miles\n * @param value Value in square meters\n * @returns Value in square miles\n */\nexport function squareMetersToSquareMiles(value: number): number {\n  return value * 0.0000003861;\n}\n\n/**\n * Convert value from square meters to square feet\n * @param value Value in square meters\n * @returns Value in square feet\n */\nexport function squareMetersToSquareFeet(value: number): number {\n  return value * 10.764;\n}\n\n/**\n * Convert value from square meters to hectares\n * @param value Value in square meters\n * @returns Value in hectares\n */\nexport function squareMetersToHectares(value: number): number {\n  return value * 0.0001;\n}\n\n/**\n * Convert value from square meters to acres\n * @param value Value in square meters\n * @returns Value in acres\n */\nexport function squareMetersToAcres(value: number): number {\n  return value * 0.00024711;\n}\n\n/**\n * Convert value from meters to the specified length unit\n * @param value Value in meters\n * @param unit Length unit\n * @returns Value in unit\n */\nexport function metersToUnit(value: number, unit: MeasureLengthUnit): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureLengthUnit.Meters, (val: number) => val],\n    [MeasureLengthUnit.Kilometers, metersToKilometers],\n    [MeasureLengthUnit.Miles, metersToMiles],\n    [MeasureLengthUnit.Feet, metersToFeet],\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * Convert value from square meters to the specified area unit\n * @param value Value in meters\n * @param unit Area unit\n * @returns Value in unit\n */\nexport function squareMetersToUnit(value: number, unit: MeasureAreaUnit): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureAreaUnit.SquareMeters, (val: number) => val],\n    [MeasureAreaUnit.SquareKilometers, squareMetersToSquareKilometers],\n    [MeasureAreaUnit.SquareMiles, squareMetersToSquareMiles],\n    [MeasureAreaUnit.SquareFeet, squareMetersToSquareFeet],\n    [MeasureAreaUnit.Hectares, squareMetersToHectares],\n    [MeasureAreaUnit.Acres, squareMetersToAcres],\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * This method format a measure to a readable format\n * @param measure Measure\n * @param options Formatting options\n * @returns Formatted measure\n */\nexport function formatMeasure(\n  measure: number,\n  options?: {\n    decimal?: number;\n    unit?: MeasureAreaUnit | MeasureLengthUnit;\n    unitAbbr?: boolean;\n    locale?: string;\n  },\n  languageService?: LanguageService) {\n  let decimal = options.decimal;\n  if (decimal === undefined || decimal < 0) {\n    decimal = 1;\n  }\n\n  const parts = [];\n  if (options.locale !== undefined) {\n    parts.push(measure.toLocaleString(options.locale, {\n      minimumFractionDigits: decimal,\n      maximumFractionDigits: decimal\n    }));\n  } else {\n    parts.push(measure.toFixed(decimal).toString());\n  }\n\n  if (options.unit !== undefined && options.unitAbbr === true) {\n    if (languageService) {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit] ?\n          languageService.translate.instant('igo.geo.measure.' + MeasureLengthUnitAbbreviation[options.unit]) :\n          languageService.translate.instant('igo.geo.measure.' + MeasureAreaUnitAbbreviation[options.unit])\n      );\n    } else {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit] || MeasureAreaUnitAbbreviation[options.unit]\n      );\n    }\n  }\n\n  return parts.filter(p => p !== undefined).join(' ');\n}\n\n/**\n * Compute best length measure unit for a given measure in meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestLengthUnit(value: number): MeasureLengthUnit {\n  let unit = MeasureLengthUnit.Meters;\n  let converted = value;\n  const possibleUnits = [MeasureLengthUnit.Kilometers];\n  while (converted > 1000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = metersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Compute best length measure unit for a given measure in square meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestAreaUnit(value: number): MeasureAreaUnit {\n  let unit = MeasureAreaUnit.SquareMeters;\n  let converted = value;\n  const possibleUnits = [MeasureAreaUnit.SquareKilometers];\n  while (converted > 1000000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = squareMetersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Create a default style for a measure interaction\n * @returns OL style\n */\nexport function createMeasureInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      lineDash: [10, 10],\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    }),\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke: new olstyle.Stroke({\n        color: '#ffcc33',\n      }),\n      fill: new olstyle.Fill({\n        color: 'rgba(255, 255, 255, 0.2)'\n      })\n    })\n  });\n}\n\n/**\n * Create a default style for a measure layer\n * @returns OL style\n */\nexport function createMeasureLayerStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    })\n  });\n}\n\n/**\n * Compute the length in meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Length in meters\n */\nexport function measureOlGeometryLength(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): number | undefined {\n  if (olGeometry instanceof OlPoint) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetLength(olGeometry, {projection});\n}\n\n/**\n * Compute the area in square meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Area in square meters\n */\nexport function measureOlGeometryArea(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): number | undefined {\n  if (olGeometry instanceof OlPoint || olGeometry instanceof OlLineString) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetArea(olGeometry, {projection});\n}\n\n/**\n * Compute the area (square meters), length (meters) and last length (meters)\n * of an OL geometry with a given projection.\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Computed measure\n */\nexport function measureOlGeometry(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): Measure {\n  const length = measureOlGeometryLength(olGeometry, projection);\n  const area = measureOlGeometryArea(olGeometry, projection);\n\n  const lengths = [];\n  const coordinates = olGeometry.getFlatCoordinates();\n  const coordinatesLength = coordinates.length;\n  for (let i = 0; i <= coordinatesLength - 4; i += 2) {\n    const olSegment = new OlLineString([\n      [coordinates[i], coordinates[i + 1]],\n      [coordinates[i + 2], coordinates[i + 3]]\n    ]);\n\n    lengths.push(measureOlGeometryLength(olSegment, projection));\n  }\n\n  return {\n    area,\n    length,\n    lengths\n  };\n}\n\n/**\n * Update an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nexport function updateOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n  } else {\n    olMidpoints = getOlGeometryMidpoints(olGeometry);\n    // TODO: handle multi geometries\n    const coordinates = olGeometry.getFlatCoordinates();\n    const midpointsLength = olMidpoints.length;\n    for (let i = 0; i < midpointsLength; i++) {\n      const j = i * 2;\n      const olSegment = new OlLineString([\n        [coordinates[j], coordinates[j + 1]],\n        [coordinates[j + 2], coordinates[j + 3]]\n      ]);\n\n      const midpointCoordinate = olSegment.getCoordinateAt(0.5);\n      const olMidpoint = olMidpoints[i];\n      if (olMidpoint !== undefined) {\n        olMidpoint.setCoordinates(midpointCoordinate);\n      } else {\n        olMidpoints[i] = new OlPoint(midpointCoordinate);\n      }\n    }\n  }\n  return olMidpoints;\n}\n\n/**\n * Clear an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n */\nexport function clearOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle) {\n  const olMidpoints = olGeometry.get('_midpoints') || [];\n  const midpointsLength = olMidpoints.length;\n  for (let i = 0; i < midpointsLength; i++) {\n    const olMidpoint = olMidpoints[i];\n    if (olMidpoint !== undefined) {\n      if (olMidpoint !== undefined) {\n        clearOlMidpointTooltip(olMidpoint);\n      }\n    }\n  }\n\n  olGeometry.set('_midpoints', undefined, true);\n\n  return olMidpoints;\n}\n\n/**\n * Return an array of  OL geometry midpoints, if any\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nfunction getOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint[] {\n  let expectedNumber;\n  if (olGeometry instanceof OlCircle) {\n    expectedNumber = 0;\n  } else {\n    expectedNumber = Math.max((olGeometry.getFlatCoordinates().length / 2) - 1, 0);\n  }\n  // TODO: This works but it's quite messy. If time permits,\n  // clean this. Maybe a Tooltip class could handle that\n  let olMidpoints = olGeometry.get('_midpoints');\n\n  if (olMidpoints === undefined) {\n    if (olGeometry instanceof OlPoint) {\n      olMidpoints = new Array(1);\n    } else {\n      olMidpoints = new Array(expectedNumber);\n    }\n    olGeometry.set('_midpoints', olMidpoints, true);\n    return olMidpoints;\n  }\n\n  if (expectedNumber === 0) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber === olMidpoints.length) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber > olMidpoints.length) {\n    olMidpoints.push(...new Array(expectedNumber - olMidpoints.length));\n    return olMidpoints;\n  }\n\n  for (let i = expectedNumber; i < olMidpoints.length; i++) {\n    const olMidpoint = olMidpoints[expectedNumber];\n    if (olMidpoint !== undefined) {\n      clearOlMidpointTooltip(olMidpoint);\n    }\n  }\n  olMidpoints.splice(expectedNumber);\n\n  return olMidpoints;\n}\n\n/**\n * Remove an OL midpoint's tooltip from the map\n * @param olMidpoint OL Point\n */\nfunction clearOlMidpointTooltip(olMidpoint: OlPoint) {\n  const olTooltip = olMidpoint.get('_tooltip');\n  if (olTooltip !== undefined) {\n    const olMap = olTooltip.getMap();\n    if (olMap !== undefined) {\n      olMap.removeOverlay(olTooltip);\n    }\n  }\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  let typeGeom = '';\n  if (olGeometry instanceof OlLineString) {\n  typeGeom = 'line-';\n  } else if (olGeometry instanceof OlPolygon) {\n    typeGeom = 'polygone-';\n    }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipAtPoint(olMidpoint, false, typeGeom);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipsAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olMidpoints = getOlGeometryMidpoints(olGeometry);\n  return olMidpoints.map((olMidpoint: OlPoint) => {\n    return olMidpoint ? olMidpoint.get('_tooltip') : undefined;\n  });\n}\n\n/**\n * Update an OL geometry center and return it\n * @param olGeometry OL Geometry\n * @returns OL point\n */\nexport function updateOlGeometryCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint {\n  let olCenter = olGeometry.get('_center');\n  const centerCoordinate = olGetCenter(olGeometry.getExtent());\n  if (olCenter !== undefined) {\n    olCenter.setCoordinates(centerCoordinate);\n  } else {\n    olCenter = new OlPoint(centerCoordinate);\n    olGeometry.set('_center', olCenter);\n  }\n\n  return olCenter;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipAtCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipAtPoint(olCenter, true);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipAtCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay {\n  const olCenter = olGeometry.get('_center');\n  return olCenter ? olCenter.get('_tooltip') : undefined;\n}\n\n/**\n * Get all the tooltips of an OL geometry\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getTooltipsOfOlGeometry(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olTooltips = [].concat(getOlTooltipsAtMidpoints(olGeometry) || []);\n  const olCenterTooltip = getOlTooltipAtCenter(olGeometry);\n  if (olCenterTooltip !== undefined) {\n    olTooltips.push(olCenterTooltip);\n  }\n  return olTooltips;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipAtPoint(olPoint: OlPoint, center: boolean = false, srcGeomType: string= ''): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: (center ?\n    [ 'igo-map-tooltip',\n      'igo-map-tooltip-measure', 'igo-map-tooltip-measure-area'] : ['igo-map-tooltip', 'igo-map-tooltip-measure',\n      `igo-map-tooltip-measure-${srcGeomType}segments`]).join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n","import * as Olstyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport OlOverlay from 'ol/Overlay';\nimport {\n  updateOlGeometryMidpoints,\n  updateOlGeometryCenter\n} from '../../measure/shared/measure.utils';\n\n\n/**\n * Create a default style\n * @param fillColor the fill color\n * @param strokeColor the stroke color\n * @param strokeWidth the stroke width\n * @param label a label\n * @returns OL style\n */\nexport function createInteractionStyle(fillColor?: string, strokeColor?: string, strokeWidth?: number, label?: string): Olstyle.Style {\n  return new Olstyle.Style({\n    stroke: new Olstyle.Stroke({\n      color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n      width: strokeWidth ? strokeWidth : 1\n    }),\n    fill: new Olstyle.Fill({\n      color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n    }),\n    image: new Olstyle.Circle({\n      radius: 5,\n      stroke: new Olstyle.Stroke({\n        color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n        width: strokeWidth ? strokeWidth : 1\n      }),\n      fill: new Olstyle.Fill({\n        color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n      })\n    })\n  });\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsDrawAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({_midpoints: olMidpoints}, true);\n  } else if (olGeometry instanceof OlCircle) {\n    const olMidpointPoint = new OlPoint(olGeometry.getCenter());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({_midpoints: olMidpoints}, true);\n  } else {\n    olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipDrawAtPoint(olMidpoint);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipDrawAtCenter(olGeometry: OlLineString | OlPolygon): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipDrawAtPoint(olCenter);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipDrawAtPoint(olPoint: OlPoint): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: [\n      'igo-map-tooltip',\n      'igo-map-tooltip-draw'\n    ].join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n","import { Injectable } from '@angular/core';\n\nimport * as OlStyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport { transform } from 'ol/proj';\nimport { MapService } from '../../map/shared/map.service';\n\n@Injectable({\n    providedIn: 'root'\n  })\nexport class DrawStyleService {\n\n  private fillColor = 'rgba(255,255,255,0.4)';\n  private strokeColor = 'rgba(143,7,7,1)';\n  private strokeWidth: number = 1;\n  private labelsAreShown = true;\n  private icon: string;\n\n  constructor(\n    private mapService: MapService\n  ) {}\n\n  getFillColor(): string {\n    return this.fillColor;\n  }\n\n  setFillColor(fillColor: string) {\n    this.fillColor = fillColor;\n  }\n\n  getStrokeColor(): string {\n    return this.strokeColor;\n  }\n\n  setStrokeColor(strokeColor: string) {\n    this.strokeColor = strokeColor;\n  }\n\n  getStrokeWidth(): number {\n    return this.strokeWidth;\n  }\n\n  getLabelsAreShown() {\n    return this.labelsAreShown;\n  }\n\n  toggleLabelsAreShown() {\n    this.labelsAreShown = !this.labelsAreShown;\n  }\n\n  setIcon(icon: string) {\n    this.icon = icon;\n  }\n\n  getIcon() {\n    return this.icon;\n  }\n\n  createDrawingLayerStyle(feature, resolution, labelsAreShown?: boolean, icon?: string): OlStyle.Style {\n    let style;\n    let labelsAreOffset: boolean = false;\n    const proj = this.mapService.getMap().projection;\n    const geom = feature.getGeometry();\n\n    if (geom instanceof OlPoint) {\n      labelsAreOffset = !labelsAreOffset;\n    }\n\n    // if feature is a circle\n    if (feature.get('rad')) {\n      const coordinates = transform(feature.getGeometry().flatCoordinates, proj, 'EPSG:4326');\n\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: '20px sans-serif',\n          overflow: true\n        }),\n\n        image: new OlStyle.Circle({\n          radius: feature.get('rad') / Math.cos((Math.PI / 180) * coordinates[1]) / resolution,\n          stroke: new OlStyle.Stroke({\n            color: this.strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: this.fillColor\n          })\n        })\n      });\n      return style;\n\n    // if feature is an icon\n    } else if (icon) {\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          offsetY: -26,\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: '20px sans-serif',\n          overflow: true\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: this.strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill:  new OlStyle.Fill({\n          color: this.fillColor\n        }),\n\n        image: new OlStyle.Icon({\n          src: icon\n        })\n      });\n      return style;\n\n    // if feature is a point, a linestring or a polygon\n    } else {\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: '20px sans-serif',\n          overflow: true,\n          offsetY: labelsAreOffset ? -15 : 0\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: this.strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill: new OlStyle.Fill({\n          color: this.fillColor\n        }),\n\n        image: new OlStyle.Circle({\n          radius: 5,\n          stroke: new OlStyle.Stroke({\n            color: this.strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: this.fillColor\n          })\n        })\n      });\n      return style;\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\n\n@Injectable({\n    providedIn: 'root'\n  })\nexport class DrawIconService {\n\n    protected icons: Array<string>;\n\n    constructor(\n      protected config: ConfigService\n    ) {\n        this.getIconsList();\n    }\n\n    getIcons() {\n        return this.icons;\n    }\n\n    getPath(): any {\n      return this.config.getConfig('drawingTool.icons') || [];\n    }\n\n    getIconsList() {\n      this.icons = this.getPath();\n    }\n}\n","<div>\n  <div class=\"geometry-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      (change)=\"onGeometryTypeChange($event.value)\" [value]=\"geometryType.Point\">\n      <mat-button-toggle [value]=\"geometryType.Point\">\n        {{('igo.geo.draw.' + geometryType.Point) | translate}}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.LineString\">\n        {{('igo.geo.draw.' + geometryType.LineString) | translate}}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Polygon\">\n        {{('igo.geo.draw.' + geometryType.Polygon) | translate}}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Circle\">\n        {{('igo.geo.draw.' + geometryType.Circle) | translate}}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"draw-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\">\n      {{'igo.geo.spatialFilter.drawControl' | translate}}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      [checked]=\"labelsAreShown\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleLabels()\">\n      {{'igo.geo.draw.toggleMapTooltips' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <form class=\"igo-form\" [formGroup]=\"form\" >\n    <div class=\"fill-color-picker mat-typography\">\n      <span>\n        <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square\"></mat-icon>\n        {{'igo.geo.draw.fill' | translate}}\n      </span>\n\n      <mat-form-field\n        class=\"fill-field\"\n        appearance=\"outline\"\n        floatLabel=\"always\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.draw.colorPicker' | translate\">\n        <mat-label>{{fillColor}}</mat-label>\n\n        <input\n          formControlName=\"fill\"\n          matInput\n          type=\"text\"\n          [(colorPicker)]=\"fillColor\"\n          [style.background]=\"fillColor\"\n          [readonly]=\"true\"\n          [colorPicker]=\"fillColor\"\n          [cpWidth]=\"('200px')\"\n          [cpOutputFormat]=\"'rgba'\"\n          [cpPosition]=\"'bottom'\"\n          [cpPositionOffset]=\"'-75%'\"\n          [cpCancelButton]=\"true\"\n          [cpCancelButtonText]=\"'igo.geo.draw.cancelColorPicker' | translate\"\n          [cpOKButton]=\"true\"\n          (colorPickerChange)=\"onColorChange(labelsAreShown, false)\">\n      </mat-form-field>\n    </div>\n\n    <div class=\"stroke-color-picker mat-typography\">\n      <span>\n        <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square-outline\"></mat-icon>\n        {{'igo.geo.draw.stroke' | translate}}\n      </span>\n\n      <mat-form-field\n        class=\"stroke-field\"\n        appearance=\"outline\"\n        floatLabel=\"always\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.draw.colorPicker' | translate\">\n        <mat-label>{{strokeColor}}</mat-label>\n\n        <input\n          formControlName=\"stroke\"\n          matInput\n          type=\"text\"\n          [(colorPicker)]=\"strokeColor\"\n          [style.background]=\"strokeColor\"\n          [readonly]=\"true\"\n          [colorPicker]=\"strokeColor\"\n          [cpWidth]=\"('200px')\"\n          [cpPosition]=\"'bottom'\"\n          [cpPositionOffset]=\"'-75%'\"\n          [cpOutputFormat]=\"'rgba'\"\n          [cpCancelButton]=\"true\"\n          [cpCancelButtonText]=\"'igo.geo.draw.cancelColorPicker' | translate\"\n          [cpOKButton]=\"true\"\n          (colorPickerChange)=\"onColorChange(labelsAreShown, false)\">\n      </mat-form-field>\n    </div>\n\n    <div>\n      <mat-form-field *ngIf=\"icons.length >= 1\">\n        <mat-label>{{'igo.geo.draw.icon' | translate}}</mat-label>\n        <mat-select>\n          <mat-select-trigger>\n            <div *ngIf=\"icon\" class=\"box\">\n              <img src={{icon}}>\n            </div>\n          </mat-select-trigger>\n          <mat-option value=\"\" (click)=\"onIconChange()\">{{'igo.geo.draw.noIcon' | translate}}</mat-option>\n          <mat-option\n            *ngFor=\"let icon_html of icons\"\n            [value]=\"icon_html\"\n            (click)=\"onIconChange(icon_html)\">\n            <div class=\"box\">\n              <img src={{icon_html}}>\n            </div>\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </form>\n\n  <mat-divider></mat-divider>\n\n  <div>\n    <button *ngIf=\"store.count$.getValue() > 0\"\n      class=\"deleteBtn\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.draw.delete' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      (click)=\"deleteDrawings()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <igo-entity-table\n      #table\n      class=\"table-compact\"\n      [store]=\"store\"\n      [template]=\"tableTemplate\">\n    </igo-entity-table>\n  </div>\n\n  <button\n    mat-icon-button\n    color=\"accent\"\n    disableRipple=\"true\"\n    (click)=\"openShorcutsDialog()\">\n    <mat-icon\n      class=\"shortcuts-icon\"\n      svgIcon=\"keyboard-outline\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.draw.shortcuts' | translate\">\n    </mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output\n} from '@angular/core';\n\nimport {\n    FEATURE,\n    FeatureStore,\n    FeatureStoreSelectionStrategy,\n    tryBindStoreLayer,\n    tryAddLoadingStrategy,\n    tryAddSelectionStrategy,\n    FeatureMotion,\n    FeatureStoreLoadingStrategy\n  } from '../../feature';\n\nimport { LanguageService } from '@igo2/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { GeometryType } from '../shared/draw.enum';\nimport { IgoMap } from '../../map/shared/map';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { Draw, FeatureWithDraw } from '../shared/draw.interface';\nimport { FormGroup, FormBuilder } from '@angular/forms';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { DrawControl } from '../../geometry/shared/controls/draw';\nimport { EntityRecord, EntityTableTemplate } from '@igo2/common';\n\nimport * as OlStyle from 'ol/style';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlCircle from 'ol/geom/Circle';\nimport OlPoint from 'ol/geom/Point';\nimport OlFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlOverlay from 'ol/Overlay';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { getDistance } from 'ol/sphere';\nimport { DrawStyleService } from '../shared/draw-style.service';\nimport { skip } from 'rxjs/operators';\nimport { DrawPopupComponent } from './draw-popup.component';\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\nimport { getTooltipsOfOlGeometry } from '../../measure/shared/measure.utils';\nimport { createInteractionStyle } from '../shared/draw.utils';\nimport { transform } from 'ol/proj';\nimport { DrawIconService } from '../shared/draw-icon.service';\n\n@Component ({\n  selector: 'igo-draw',\n  templateUrl: './draw.component.html',\n  styleUrls: ['./draw.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\n\nexport class DrawComponent implements OnInit, OnDestroy {\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate = {\n    selection: true,\n    selectMany: true,\n    selectionCheckbox: true,\n    sort: true,\n    columns: [{\n      name: 'Drawing',\n      title: this.languageService.translate.instant('igo.geo.draw.labels'),\n      valueAccessor: (feature: FeatureWithDraw) => {\n        return feature.properties.draw;\n      }\n    }]\n  };\n\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n\n  @Output() fillColor: string;\n  @Output() strokeColor: string;\n  @Output() strokeWidth: number;\n\n  @Input() map: IgoMap; // Map to draw on\n\n  @Input() store: FeatureStore<FeatureWithDraw>; // Drawing store\n\n  public draw$: BehaviorSubject<Draw> = new BehaviorSubject({}); // Observable of draw\n\n  private olDrawingLayerSource = new OlVectorSource();\n  private drawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private drawSelect$$: Subscription;\n  private olDrawingLayer: VectorLayer;\n  public selectedFeatures$: BehaviorSubject<FeatureWithDraw[]> = new BehaviorSubject([]);\n  public fillForm: string;\n  public strokeForm: string;\n  public drawControlIsDisabled: boolean = true;\n  public drawControlIsActive: boolean = false;\n  public labelsAreShown: boolean;\n  private subscriptions$$: Subscription[] = [];\n\n  public position: string = 'bottom';\n  public form: FormGroup;\n  public icons: Array<string>;\n  public icon: string;\n\n  constructor(\n    private languageService: LanguageService,\n    private formBuilder: FormBuilder,\n    private drawStyleService: DrawStyleService,\n    private dialog: MatDialog,\n    private drawIconService: DrawIconService\n  ) {\n    this.buildForm();\n    this.fillColor = this.drawStyleService.getFillColor();\n    this.strokeColor = this.drawStyleService.getStrokeColor();\n    this.strokeWidth = this.drawStyleService.getStrokeWidth();\n    this.labelsAreShown = this.drawStyleService.getLabelsAreShown();\n    this.icons = this.drawIconService.getIcons();\n    this.icon = this.drawStyleService.getIcon();\n  }\n\n  // Initialize the store that will contain the entities and create the Draw control\n  ngOnInit() {\n    this.initStore();\n    this.drawControl = this.createDrawControl(this.fillColor, this.strokeColor, this.strokeWidth);\n    this.drawControl.setGeometryType(this.geometryType.Point as any);\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Remove the drawing layer and the interactions\n   * @internal\n   */\n  ngOnDestroy() {\n    this.drawControl.setOlMap(undefined);\n    this.subscriptions$$.map(s => s.unsubscribe());\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(fillColor?: string, strokeColor?: string, strokeWidth?: number) {\n    const drawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.olDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(fillColor, strokeColor, strokeWidth),\n    });\n\n    return drawControl;\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(geometryType: typeof OlGeometryType) {\n    this.drawControl.setGeometryType(geometryType);\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Store initialization, including drawing layer creation\n   */\n  private initStore() {\n    this.map.removeLayer(this.olDrawingLayer);\n\n    this.olDrawingLayer = new VectorLayer({\n      id: 'igo-draw-layer',\n      title: this.languageService.translate.instant('igo.geo.draw.drawing'),\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: (feature, resolution) => {\n        return this.drawStyleService.createDrawingLayerStyle(feature, resolution, this.labelsAreShown, this.icon);\n      },\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: {\n        enabled: false\n      },\n    });\n    tryBindStoreLayer(this.store, this.olDrawingLayer);\n\n    tryAddLoadingStrategy(this.store, new FeatureStoreLoadingStrategy({\n      motion: FeatureMotion.None\n    }));\n\n    tryAddSelectionStrategy(this.store, new FeatureStoreSelectionStrategy({\n      map: this.map,\n      motion: FeatureMotion.None,\n      many: true\n    }));\n    this.store.layer.visible = true;\n    this.store.source.ol.on('removefeature', (event: OlVectorSourceEvent<OlGeometry>) => {\n      const olGeometry = event.feature.getGeometry();\n      this.clearLabelsOfOlGeometry(olGeometry);\n    });\n\n    this.subscriptions$$.push(this.store.stateView.manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n      return record.state.selected === true;\n    }).pipe(\n      skip(1) // Skip initial emission\n    ).subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n      this.selectedFeatures$.next(records.map(record => record.entity));\n    }));\n\n    this.subscriptions$$.push(this.store.count$.subscribe(cnt => {\n      cnt >= 1 ? this.store.layer.options.showInLayerList = true : this.store.layer.options.showInLayerList = false;\n    }));\n  }\n\n  /**\n   * Called when the user changes the color in a color picker\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param isAnIcon wheter the feature is an icon or not\n   */\n  onColorChange(labelsAreShown: boolean, isAnIcon: boolean) {\n    this.fillForm = this.fillColor;\n    this.strokeForm = this.strokeColor;\n    this.drawStyleService.setFillColor(this.fillColor);\n    this.drawStyleService.setStrokeColor(this.strokeColor);\n\n    if (isAnIcon) {\n      this.store.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createDrawingLayerStyle(feature, resolution, labelsAreShown, this.icon);\n      });\n      this.icon = undefined;\n\n    } else {\n      this.store.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createDrawingLayerStyle(feature, resolution, labelsAreShown);\n      });\n    }\n    this.createDrawControl();\n  }\n\n  /**\n   * Called when the user toggles the Draw control is toggled\n   * @internal\n   */\n  onToggleDrawControl(toggleIsChecked: boolean) {\n    toggleIsChecked ? this.toggleDrawControl() : this.deactivateDrawControl();\n  }\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    this.activateDrawControl();\n  }\n\n  /**\n   * Open a dialog box to enter label and do something\n   * @param olGeometry geometry at draw end or selected geometry\n   * @param drawEnd event fired at drawEnd?\n   */\n  private openDialog(olGeometryFeature, isDrawEnd: boolean) {\n    setTimeout(() => {\n      // open the dialog box used to enter label\n      const dialogRef = this.dialog.open(DrawPopupComponent, {\n        disableClose: false,\n        data: {currentLabel: olGeometryFeature.get('draw')}\n      });\n\n      // when dialog box is closed, get label and set it to geometry\n      dialogRef.afterClosed().subscribe((label: string) => {\n        this.updateLabelOfOlGeometry(olGeometryFeature, label);\n\n        // if event was fired at draw end\n        if (isDrawEnd) {\n          this.onDrawEnd(olGeometryFeature);\n\n        // if event was fired at select\n        } else {\n          this.onSelectDraw(olGeometryFeature, label);\n        }\n      });\n    }, 250);\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl() {\n    this.drawControlIsDisabled = false;\n    this.drawControlIsActive = true;\n    this.drawEnd$$ = this.drawControl.end$.subscribe((olGeometry: OlGeometry) => {\n      this.openDialog(olGeometry, true);\n    });\n\n    this.drawControl.modify$.subscribe((olGeometry: OlGeometry) => {\n      this.onModifyDraw(olGeometry);\n    });\n\n    if (!this.drawSelect$$) {\n      this.drawSelect$$ = this.drawControl.select$.subscribe((olFeature: OlFeature<OlGeometry>) => {\n        this.openDialog(olFeature, false);\n      });\n    }\n\n    this.drawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (!this.drawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.drawControl.setOlMap(undefined);\n    this.drawControlIsActive = false;\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlGeometry, radius?: number) {\n    this.addFeatureToStore(olGeometry, radius);\n    this.clearLabelsOfOlGeometry(olGeometry);\n    this.store.layer.ol.getSource().refresh();\n  }\n\n  private onModifyDraw(olGeometry) {\n    const entities = this.store.all();\n\n    entities.forEach(entity => {\n      const entityId = entity.properties.id;\n\n      const olGeometryId = olGeometry.ol_uid;\n\n      if (entityId === olGeometryId) {\n        this.updateLabelOfOlGeometry(olGeometry, entity.properties.draw);\n        this.replaceFeatureInStore(entity, olGeometry);\n      }\n    });\n  }\n\n  private onSelectDraw(olFeature: OlFeature<OlGeometry>, label: string) {\n    const entities = this.store.all();\n\n    const olGeometry = olFeature.getGeometry() as any;\n    olGeometry.ol_uid = olFeature.get('id');\n\n    const olGeometryCoordinates = JSON.stringify(olGeometry.getCoordinates()[0]);\n\n    entities.forEach(entity => {\n      const entityCoordinates = JSON.stringify(entity.geometry.coordinates[0]);\n\n      if (olGeometryCoordinates === entityCoordinates) {\n        const rad: number = entity.properties.rad ? entity.properties.rad : undefined;\n\n        this.updateLabelOfOlGeometry(olGeometry, label);\n        this.replaceFeatureInStore(entity, olGeometry, rad);\n      }\n    });\n  }\n\n  /**\n   * Add a feature with draw label to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(olGeometry, radius?: number, feature?: FeatureWithDraw) {\n    let rad: number;\n    let center4326: Array<number>;\n    let point4326: Array<number>;\n    let lon4326: number;\n    let lat4326: number;\n    const featureId = feature ? feature.properties.id : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n\n    if (olGeometry instanceof OlCircle || radius) {\n      if (radius) {\n        rad = radius;\n      } else {\n        geometry.type = 'Point';\n        geometry.coordinates = olGeometry.getCenter();\n        const extent4326 = transform([olGeometry.getFlatCoordinates()[2], olGeometry.getFlatCoordinates()[3]], projection, 'EPSG:4326');\n        center4326 = transform([olGeometry.getFlatCoordinates()[0], olGeometry.getFlatCoordinates()[1]], projection, 'EPSG:4326');\n        lon4326 = center4326[0];\n        lat4326 = center4326[1];\n        rad = getDistance(center4326, extent4326);\n      }\n    }\n\n    if (olGeometry instanceof OlPoint) {\n      point4326 = transform(olGeometry.getFlatCoordinates(), projection, 'EPSG:4326');\n      lon4326 = point4326[0];\n      lat4326 = point4326[1];\n    }\n\n    this.store.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        draw: olGeometry.get('_label'),\n        longitude: lon4326 ? lon4326 : null,\n        latitude: lat4326 ? lat4326 : null,\n        rad: rad ? rad : null\n      },\n      meta: {\n       id: featureId\n      }\n    });\n  }\n\n  /**\n   * Replace the feature in the store\n   * @param entity the entity to replace\n   * @param olGeometry the new geometry to insert in the store\n   */\n  private replaceFeatureInStore(entity, olGeometry: OlGeometry, radius?: number) {\n    this.store.delete(entity);\n    this.onDrawEnd(olGeometry, radius);\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [''],\n      stroke: ['']\n    });\n  }\n\n  deleteDrawings() {\n    this.store.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach(selectedFeature => {\n      this.olDrawingLayerSource.getFeatures().forEach(drawingLayerFeature => {\n        const geometry = drawingLayerFeature.getGeometry() as any;\n        if (selectedFeature.properties.id === geometry.ol_uid) {\n          this.olDrawingLayerSource.removeFeature(drawingLayerFeature);\n        }\n      });\n    });\n  }\n\n  /**\n   * Clear the tooltips of an OL geometry\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearLabelsOfOlGeometry(olGeometry) {\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\n      if (olTooltip && olTooltip.getMap()) {\n        this.map.ol.removeOverlay(olTooltip);\n      }\n    });\n  }\n\n  /**\n   * Called when the user toggles the labels toggle\n   */\n  onToggleLabels() {\n    this.drawStyleService.toggleLabelsAreShown();\n    this.labelsAreShown = !this.labelsAreShown;\n    this.icon ? this.onColorChange(this.labelsAreShown, true) : this.onColorChange(this.labelsAreShown, false);\n    }\n\n  /**\n   * Update the label of a geometry when a label is entered in a dialog box\n   * @param olGeometry the geometry\n   * @param label the label\n   */\n  private updateLabelOfOlGeometry(olGeometry: OlGeometry, label: string) {\n    olGeometry.setProperties({\n      _label: label\n    }, true);\n  }\n\n  onIconChange(event?) {\n    this.icon = event;\n    this.drawStyleService.setIcon(this.icon);\n    this.store.layer.ol.setStyle((feature, resolution) => {\n      return this.drawStyleService.createDrawingLayerStyle(feature, resolution, true, this.icon);\n    });\n  }\n\n  openShorcutsDialog() {\n    this.dialog.open(DrawShorcutsComponent);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { ColorPickerModule } from 'ngx-color-picker';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoEntityTableModule } from '@igo2/common';\nimport { DrawComponent } from './draw.component';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { DrawPopupComponent } from './draw-popup.component';\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatListModule,\n    MatSelectModule,\n    MatSlideToggleModule,\n    MatDialogModule,\n    IgoLanguageModule,\n    IgoEntityTableModule,\n    ColorPickerModule\n  ],\n  declarations: [\n    DrawComponent,\n    DrawPopupComponent,\n    DrawShorcutsComponent\n  ],\n  exports: [\n    DrawComponent\n  ]\n})\nexport class IgoDrawModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule, IgoImageModule } from '@igo2/common';\n\nimport { FeatureDetailsComponent } from './feature-details.component';\nimport { FeatureDetailsDirective } from './feature-details.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    IgoLanguageModule,\n    IgoKeyValueModule,\n    IgoImageModule\n  ],\n  exports: [\n    FeatureDetailsComponent,\n    FeatureDetailsDirective],\n  declarations: [\n    FeatureDetailsComponent,\n    FeatureDetailsDirective]\n})\nexport class IgoFeatureDetailsModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFormModule } from '@igo2/common';\n\nimport { FeatureFormComponent } from './feature-form.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoFormModule\n  ],\n  exports: [\n    IgoFormModule,\n    FeatureFormComponent\n  ],\n  declarations: [\n    FeatureFormComponent\n  ]\n})\nexport class IgoFeatureFormModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFeatureDetailsModule } from './feature-details/feature-details.module';\nimport { IgoFeatureFormModule } from './feature-form/feature-form.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoFeatureDetailsModule,\n    IgoFeatureFormModule\n  ],\n  declarations: [],\n  providers: []\n})\nexport class IgoFeatureModule {}\n","import OlMap from 'ol/Map';\nimport OlFeature from 'ol/Feature';\nimport * as OlStyle from 'ol/style';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlModify from 'ol/interaction/Modify';\nimport OlTranslate from 'ol/interaction/Translate';\nimport OlDraw from 'ol/interaction/Draw';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlLineString from 'ol/geom/LineString';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlInteraction from 'ol/interaction/Interaction';\nimport OlDragBoxInteraction from 'ol/interaction/DragBox';\nimport MapBrowserEvent from 'ol/MapBrowserEvent';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport BasicEvent from 'ol/events/Event';\nimport { ModifyEvent as OlModifyEvent } from 'ol/interaction/Modify';\nimport { TranslateEvent as OlTranslateEvent } from 'ol/interaction/Translate';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport { unByKey } from 'ol/Observable';\n\nimport { Subject, Subscription, fromEvent } from 'rxjs';\n\nimport {\n  addLinearRingToOlPolygon,\n  createDrawHoleInteractionStyle,\n  getMousePositionFromOlGeometryEvent\n} from '../geometry.utils';\n\nexport interface ModifyControlOptions {\n  source?: OlVectorSource<any>;\n  layer?: OlVectorLayer<any>;\n  layerStyle?: OlStyle.Style | ((olfeature: OlFeature<any>) => OlStyle.Style);\n  drawStyle?: OlStyle.Style | ((olfeature: OlFeature<any>) => OlStyle.Style) | OlStyle.Circle |\n    ((olfeature: OlFeature<OlGeometry>) => OlStyle.Circle);\n  modify?: boolean;\n  translate?: boolean;\n}\n\n/**\n * Control to modify geometries\n */\nexport class ModifyControl {\n  /**\n   * Modify start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Modify end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Geometry changes observable\n   */\n  public changes$: Subject<OlGeometry> = new Subject();\n\n  private olMap: OlMap;\n  private olOverlayLayer: OlVectorLayer<any>;\n  public olModifyInteraction: OlModify;\n  private onModifyStartKey: any;\n  private onModifyEndKey: any;\n  private onModifyKey: any;\n  private olModifyInteractionIsActive: boolean = false;\n  private olTranslateInteraction: OlTranslate;\n  private onTranslateStartKey: any;\n  private onTranslateEndKey: any;\n  private onTranslateKey: any;\n  private olTranslateInteractionIsActive: boolean = false;\n  private olDrawInteraction: OlDraw;\n  private onDrawStartKey: any;\n  private onDrawEndKey: any;\n  private onDrawKey: any;\n  private olDrawInteractionIsActive: boolean = false;\n\n  private mousePosition: [number, number];\n\n  private keyDown$$: Subscription;\n  private drawKeyUp$$: Subscription;\n  private drawKeyDown$$: Subscription;\n\n  private removedOlInteractions: OlInteraction[] = [];\n  private olLinearRingsLayer: OlVectorLayer<any>;\n\n  // This is the geometry to test against when drawing holes\n  private olOuterGeometry: OlGeometry;\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<any> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  /**\n   * OL linear rings source\n   * @internal\n   */\n  get olLinearRingsSource(): OlVectorSource<any> {\n    return this.olLinearRingsLayer.getSource();\n  }\n\n  /**\n   * Whether a modify control should be available\n   */\n  private modify: boolean = true;\n\n  /**\n   * Whether a translate control should be available\n   */\n  private translate: boolean = true;\n\n  constructor(private options: ModifyControlOptions) {\n    if (options.modify !== undefined) {\n      this.modify = options.modify;\n    }\n    if (options.translate !== undefined) {\n      this.translate = options.translate;\n    }\n\n    if (options.layer !== undefined) {\n      this.olOverlayLayer = options.layer;\n    } else {\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\n    }\n    this.olLinearRingsLayer = this.createOlLinearRingsLayer();\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap === undefined) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlModifyInteraction();\n      this.removeOlTranslateInteraction();\n      this.removeOlDrawInteraction();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n\n    // The order in which these interactions\n    // are added is important\n    if (this.modify === true) {\n      this.addOlDrawInteraction();\n    }\n\n    if (this.translate === true) {\n      this.addOlTranslateInteraction();\n      this.activateTranslateInteraction();\n    }\n\n    if (this.modify === true) {\n      this.addOlModifyInteraction();\n      this.activateModifyInteraction();\n    }\n  }\n\n  /**\n   * Return the overlay source\n   */\n  getSource(): OlVectorSource<any> {\n    return this.olOverlaySource;\n  }\n\n  /**\n   * Add an OL geometry to the overlay and start modifying it\n   * @param olGeometry Ol Geometry\n   */\n  setOlGeometry(olGeometry: OlGeometry) {\n    const olFeature = new OlFeature({ geometry: olGeometry });\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create an overlay source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: this.options.source ? this.options.source : new OlVectorSource(),\n      style: this.options.layerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the overlay layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (this.options.layer === undefined) {\n      this.olMap.addLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (this.options.layer === undefined && this.olMap !== undefined) {\n      this.olMap.removeLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (this.options.layer === undefined && this.options.source === undefined) {\n      this.olOverlaySource.clear(true);\n    }\n  }\n\n  private createOlLinearRingsLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: new OlVectorSource(),\n      style: createDrawHoleInteractionStyle(),\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the linear rings layer\n   */\n  private addOlLinearRingsLayer() {\n    this.olMap.addLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings layer\n   */\n  private removeOlLinearRingsLayer() {\n    this.olMap.removeLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings source\n   */\n  private clearOlLinearRingsSource() {\n    this.olLinearRingsSource.clear(true);\n  }\n\n  /**\n   * Add a modify interaction to the map an set up some listeners\n   */\n  private addOlModifyInteraction() {\n    const olModifyInteraction = new OlModify({\n      source: this.olOverlaySource,\n      style: this.options.drawStyle as OlStyle.Style\n    });\n    this.olModifyInteraction = olModifyInteraction;\n  }\n\n  /**\n   * Remove the modify interaction\n   */\n  private removeOlModifyInteraction() {\n    if (this.olModifyInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateModifyInteraction();\n    this.olModifyInteraction = undefined;\n  }\n\n  private activateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === true) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = true;\n    this.onModifyStartKey = this.olModifyInteraction.on(\n      'modifystart',\n      (event: OlModifyEvent) => this.onModifyStart(event)\n    );\n    this.onModifyEndKey = this.olModifyInteraction.on(\n      'modifyend',\n      (event: OlModifyEvent) => this.onModifyEnd(event)\n    );\n    this.olMap.addInteraction(this.olModifyInteraction);\n  }\n\n  private deactivateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === false) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = false;\n\n    unByKey([this.onModifyStartKey, this.onModifyEndKey, this.onModifyKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n  }\n\n  /**\n   * When modifying starts, clear the overlay and start watching for changes\n   * @param event Modify start event\n   */\n  private onModifyStart(event: OlModifyEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onModifyKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        this.mousePosition = getMousePositionFromOlGeometryEvent(\n          olGeometryEvent\n        );\n        this.changes$.next(olGeometryEvent.target as OlLineString | OlCircle | OlPolygon);\n      }\n    );\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When modifying ends, update the geometry observable and stop watching for changes\n   * @param event Modify end event\n   */\n  private onModifyEnd(event: OlModifyEvent) {\n    unByKey(this.onModifyKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Subscribe to space key down to pan the map\n   */\n  private subscribeToKeyDown() {\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key === ' ') {\n          // On space bar, pan to the current mouse position\n          this.olMap.getView().animate({\n            center: this.mousePosition,\n            duration: 0\n          });\n          return;\n        }\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeToKeyDown() {\n    if (this.keyDown$$ !== undefined) {\n      this.keyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a translate interaction to the map an set up some listeners\n   */\n  private addOlTranslateInteraction() {\n    const olTranslateInteraction = new OlTranslate({\n      layers: [this.olOverlayLayer]\n    });\n    this.olTranslateInteraction = olTranslateInteraction;\n  }\n\n  /**\n   * Remove the translate interaction\n   */\n  private removeOlTranslateInteraction() {\n    if (this.olTranslateInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateTranslateInteraction();\n    this.olTranslateInteraction = undefined;\n  }\n\n  private activateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === true) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = true;\n    this.onTranslateStartKey = this.olTranslateInteraction.on(\n      'translatestart',\n      (event: OlTranslateEvent) => this.onTranslateStart(event)\n    );\n    this.onTranslateEndKey = this.olTranslateInteraction.on(\n      'translateend',\n      (event: OlTranslateEvent) => this.onTranslateEnd(event)\n    );\n    this.olMap.addInteraction(this.olTranslateInteraction);\n  }\n\n  private deactivateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === false) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = false;\n    unByKey([\n      this.onTranslateStartKey,\n      this.onTranslateEndKey,\n      this.onTranslateKey\n    ]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olTranslateInteraction);\n    }\n  }\n\n  /**\n   * When translation starts, clear the overlay and start watching for changes\n   * @param event Translate start event\n   */\n  private onTranslateStart(event: OlTranslateEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onTranslateKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        // this.changes$.next(olGeometryEvent.target);\n      }\n    );\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Translate end event\n   */\n  private onTranslateEnd(event: OlTranslateEvent) {\n    unByKey(this.onTranslateKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n  }\n\n  /**\n   * Add a draw interaction to the map an set up some listeners\n   */\n  private addOlDrawInteraction() {\n    const olDrawInteraction = new OlDraw({\n      type: 'Polygon',\n      source: this.olLinearRingsSource,\n      stopClick: true,\n      style: createDrawHoleInteractionStyle(),\n      condition: (event: MapBrowserEvent<any>) => {\n        const olOuterGeometry = this.olOuterGeometry || this.getOlGeometry();\n        const intersects = olOuterGeometry.intersectsCoordinate(\n          event.coordinate\n        );\n        return intersects;\n      }\n    });\n\n    this.olDrawInteraction = olDrawInteraction;\n    this.subscribeToDrawKeyDown();\n  }\n\n  /**\n   * Subscribe to CTRL key down to activate the draw control\n   */\n  private subscribeToDrawKeyDown() {\n    this.drawKeyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyDown();\n\n        const olGeometry = this.getOlGeometry();\n        if (!olGeometry || !(olGeometry instanceof OlPolygon)) {\n          return;\n        }\n\n        this.subscribeToDrawKeyUp();\n\n        this.deactivateModifyInteraction();\n        this.deactivateTranslateInteraction();\n        this.activateDrawInteraction();\n      }\n    );\n  }\n\n  /**\n   * Subscribe to CTRL key up to deactivate the draw control\n   */\n  private subscribeToDrawKeyUp() {\n    this.drawKeyUp$$ = fromEvent(document, 'keyup').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyUp();\n        this.unsubscribeToKeyDown();\n        this.deactivateDrawInteraction();\n\n        this.activateModifyInteraction();\n        if (this.translate === true) {\n          this.activateTranslateInteraction();\n        }\n        this.subscribeToDrawKeyDown();\n\n        this.olOuterGeometry = undefined;\n        this.clearOlLinearRingsSource();\n        this.end$.next(this.getOlGeometry());\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to draw key down\n   */\n  private unsubscribeToDrawKeyDown() {\n    if (this.drawKeyDown$$ !== undefined) {\n      this.drawKeyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Unsubscribe to key up\n   */\n  private unsubscribeToDrawKeyUp() {\n    if (this.drawKeyUp$$ !== undefined) {\n      this.drawKeyUp$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Remove the draw interaction\n   */\n  private removeOlDrawInteraction() {\n    if (this.olDrawInteraction === undefined) {\n      return;\n    }\n\n    this.unsubscribeToKeyDown();\n    this.unsubscribeToDrawKeyUp();\n    this.unsubscribeToDrawKeyDown();\n    this.deactivateDrawInteraction();\n    this.clearOlLinearRingsSource();\n    this.olDrawInteraction = undefined;\n  }\n\n  /**\n   * Activate the draw interaction\n   */\n  private activateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === true) {\n      return;\n    }\n\n    this.clearOlLinearRingsSource();\n    this.addOlLinearRingsLayer();\n\n    this.olMap.getInteractions().forEach((olInteraction: OlInteraction) => {\n      if (olInteraction instanceof OlDragBoxInteraction) {\n        this.olMap.removeInteraction(olInteraction);\n        this.removedOlInteractions.push(olInteraction);\n      }\n    });\n\n    this.olDrawInteractionIsActive = true;\n    this.onDrawStartKey = this.olDrawInteraction.on(\n      'drawstart',\n      (event: OlDrawEvent) => this.onDrawStart(event)\n    );\n    this.onDrawEndKey = this.olDrawInteraction.on(\n      'drawend',\n      (event: OlDrawEvent) => this.onDrawEnd(event)\n    );\n    this.olMap.addInteraction(this.olDrawInteraction);\n  }\n\n  /**\n   * Deactivate the draw interaction\n   */\n  private deactivateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === false) {\n      return;\n    }\n\n    this.removeOlLinearRingsLayer();\n\n    this.removedOlInteractions.forEach((olInteraction: OlInteraction) => {\n      this.olMap.addInteraction(olInteraction);\n    });\n    this.removedOlInteractions = [];\n\n    this.olDrawInteractionIsActive = false;\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n    }\n  }\n\n  /**\n   * When draw start, add a new linerar ring to the geometry and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.olOuterGeometry = this.getOlGeometry().clone();\n\n    const linearRingCoordinates = olGeometry.getLinearRing().getCoordinates();\n    this.addLinearRingToOlGeometry(linearRingCoordinates);\n    this.start$.next(this.getOlGeometry());\n\n    this.onDrawKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        this.mousePosition = getMousePositionFromOlGeometryEvent(\n          olGeometryEvent\n        );\n        const olGeometryTarget = olGeometryEvent.target as OlPolygon;\n        const _linearRingCoordinates = olGeometryTarget\n          .getLinearRing(0)\n          .getCoordinates();\n        this.updateLinearRingOfOlGeometry(_linearRingCoordinates);\n        this.changes$.next(this.getOlGeometry());\n      }\n    );\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Draw end event\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    unByKey(this.onDrawKey);\n    this.olOuterGeometry = undefined;\n\n    const linearRingCoordinates = event.feature\n      .getGeometry()\n      .getLinearRing()\n      .getCoordinates();\n    this.updateLinearRingOfOlGeometry(linearRingCoordinates);\n    this.clearOlLinearRingsSource();\n    this.end$.next(this.getOlGeometry());\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Add a linear ring to the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private addLinearRingToOlGeometry(coordinates: number[]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    const olLinearRing = new OlLinearRing(coordinates);\n    addLinearRingToOlPolygon(olGeometry, olLinearRing);\n  }\n\n  /**\n   * Update the last linear ring of the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private updateLinearRingOfOlGeometry(coordinates: number[][]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    // Remove the last linear ring (the one we are updating)\n    const olLinearRings = olGeometry.getLinearRings().slice(0, -1);\n    const newCoordinates = olLinearRings.map((olLinearRing: OlLinearRing) => {\n      return olLinearRing.getCoordinates();\n    });\n    newCoordinates.push(coordinates);\n    olGeometry.setCoordinates(newCoordinates);\n  }\n\n  /**\n   * Get the geometry being modified\n   * @returns OL Geometry\n   */\n  private getOlGeometry(): OlGeometry {\n    const olFeatures = this.olOverlaySource.getFeatures();\n    return olFeatures.length > 0 ? olFeatures[0].getGeometry() : undefined;\n  }\n}\n","export const LAYER = 'Layer';\n","<h3 mat-dialog-title>{{'igo.geo.measure.dialog.title' | translate}}</h3>\n\n<table *ngIf=\"data.length > 0\"\n  class=\"mat-typography\">\n  <thead>\n    <tr>\n      <th colspan=\"2\">{{'igo.geo.measure.dialog.length.title' | translate}}</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Meters}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInMeters' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Kilometers}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInKilometers' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Miles}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInMiles' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Feet}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInFeet' | translate}}</td>\n    </tr>\n  </tbody>\n</table>\n\n<table *ngIf=\"data.area > 0\"\n  class=\"mat-typography\">\n  <thead>\n    <tr>\n      <th colspan=\"2\">{{'igo.geo.measure.dialog.area.title' | translate}}</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.SquareMeters}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareMeters' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat:measureAreaUnit.SquareKilometers}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareKilometers' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.SquareMiles}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareMiles' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.Acres}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInAcres' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.Hectares}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInHectares' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{'igo.geo.measure.dialog.perimeterInMeters' | translate}}</td>\n      <td>{{data.perimeter | measureFormat: measureLengthUnit.Meters}}</td>\n    </tr>\n  </tbody>\n</table>\n","import { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { MeasurerDialogData } from '../shared/measure.interfaces';\n\nimport { MeasureAreaUnit, MeasureLengthUnit} from '../shared/measure.enum';\n\n@Component({\n  selector: 'igo-measurer-dialog',\n  templateUrl: 'measurer-dialog.component.html',\n  styleUrls: ['./measurer-dialog.component.scss']\n})\nexport class MeasurerDialogComponent {\n\n  measureAreaUnit = MeasureAreaUnit;\n\n  measureLengthUnit = MeasureLengthUnit;\n\n  constructor(\n    public dialogRef: MatDialogRef<MeasurerDialogComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: MeasurerDialogData\n  ) {}\n\n  onNoClick(): void {\n    this.dialogRef.close();\n  }\n\n}\n","<div>\n  <div class=\"measure-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      [value]=\"activeMeasureType\"\n      (change)=\"onMeasureTypeChange($event.value)\">\n      <mat-button-toggle [value]=\"measureType.Length\">\n        {{('igo.geo.measure.' + measureType.Length) | translate}}\n      </mat-button-toggle>\n      <mat-button-toggle [value]=\"measureType.Area\">\n        {{('igo.geo.measure.' + measureType.Area) | translate}}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"measure-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\">\n      {{'igo.geo.measure.toggleActive' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasLine$ | async)\"></mat-divider>\n\n    <mat-slide-toggle *ngIf=\"(hasLine$ | async)\"\n      [checked]=\"displayLines\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayLines($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayLines' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n    <mat-slide-toggle *ngIf=\"(hasArea$ | async)\"\n      [checked]=\"displayDistance\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayDistance($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayDistance' | translate}}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle *ngIf=\"(hasArea$ | async)\"\n      [checked]=\"displayAreas\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayAreas($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayAreas' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasArea$ | async)\"></mat-divider>\n\n    <mat-slide-toggle\n      [checked]=\"measureUnitsAuto\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleMeasureUnitsAuto($event.checked)\">\n      {{'igo.geo.measure.toggleAutoUnits' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <ng-container *ngIf=\"measure$ | async as measure\">\n    <igo-measurer-item *ngIf=\"activeMeasureType === measureType.Length || activeMeasureType === measureType.Area\"\n      [measureType]=\"measureType.Length\"\n      [measureUnit]=\"measureLengthUnit.Meters\"\n      [measure]=\"measure.length\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"(activeMeasureType === measureType.Area ? 'igo.geo.measure.perimeter' : 'igo.geo.measure.length') | translate\"\n      (measureUnitChange)=\"onLengthUnitChange($event)\">\n    </igo-measurer-item>\n\n    <igo-measurer-item *ngIf=\"activeMeasureType === measureType.Area\"\n      [measureType]=\"measureType.Area\"\n      [measureUnit]=\"measureAreaUnit.SquareMeters\"\n      [measure]=\"measure.area\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"'igo.geo.measure.area' | translate\"\n      (measureUnitChange)=\"onAreaUnitChange($event)\">\n    </igo-measurer-item>\n  </ng-container>\n\n  <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n  <div class=\"measure-store-buttons\">\n    <button *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.calculate.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"accent\"\n      (click)=\"onCalculateClick()\">\n      <mat-icon svgIcon=\"calculator\"></mat-icon>\n    </button>\n\n    <button *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.delete.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"warn\"\n      (click)=\"onDeleteClick()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <!--button\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.modify.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length !== 1\"\n      (click)=\"onModifyClick()\">\n      <mat-icon svgIcon=\"edit\"></mat-icon>\n    </button-->\n  </div>\n\n  <igo-entity-table\n    #table\n    class=\"table-compact\"\n    [store]=\"store\"\n    [template]=\"tableTemplate\">\n  </igo-entity-table>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  ViewChild\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skip } from 'rxjs/operators';\n\nimport OlStyle from 'ol/style/Style';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlVectorSource from 'ol/source/Vector';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlOverlay from 'ol/Overlay';\nimport { unByKey } from 'ol/Observable';\n\nimport { LanguageService, StorageScope, StorageService } from '@igo2/core';\nimport { EntityRecord, EntityTableTemplate } from '@igo2/common';\nimport type { EntityTableComponent } from '@igo2/common';\nimport { uuid } from '@igo2/utils';\n\nimport { FeatureDataSource } from '../../datasource';\nimport {\n  FEATURE,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  tryBindStoreLayer,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy\n} from '../../feature';\nimport { DrawControl, ModifyControl } from '../../geometry/shared';\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nimport { Measure, MeasurerDialogData, FeatureWithMeasure } from '../shared/measure.interfaces';\nimport {\n  MeasureType,\n  MeasureAreaUnit,\n  MeasureLengthUnit,\n} from '../shared/measure.enum';\nimport {\n  measureOlGeometry,\n  createMeasureInteractionStyle,\n  createMeasureLayerStyle,\n  updateOlTooltipsAtMidpoints,\n  updateOlTooltipAtCenter,\n  getTooltipsOfOlGeometry,\n  squareMetersToUnit,\n  metersToUnit,\n  formatMeasure\n} from '../shared/measure.utils';\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\n\n/**\n * Tool to measure lengths and areas\n */\n@Component({\n  selector: 'igo-measurer',\n  templateUrl: './measurer.component.html',\n  styleUrls: ['./measurer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MeasurerComponent implements OnInit, OnDestroy {\n\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate = {\n    selection: true,\n    selectMany: true,\n    selectionCheckbox: true,\n    sort: true,\n    columns: [\n      {\n        name: 'length',\n        title: this.languageService.translate.instant('igo.geo.measure.lengthHeader'),\n        valueAccessor: (localFeature: FeatureWithMeasure) => {\n          const unit = this.activeLengthUnit;\n          const measure = metersToUnit(localFeature.properties.measure.length, unit);\n          return formatMeasure(measure, {\n            decimal: 1,\n            unit,\n            unitAbbr: false,\n            locale: 'fr'\n          });\n        }\n      },\n      {\n        name: 'area',\n        title: this.languageService.translate.instant('igo.geo.measure.areaHeader'),\n        valueAccessor: (localFeature: FeatureWithMeasure) => {\n          const unit = this.activeAreaUnit;\n          const measure = squareMetersToUnit(localFeature.properties.measure.area, unit);\n          return measure ? formatMeasure(measure, {\n            decimal: 1,\n            unit,\n            unitAbbr: false,\n            locale: 'fr'\n          }) : '';\n        }\n      }\n    ]\n  };\n\n  private subscriptions$$: Subscription[] = [];\n\n  /**\n   * Reference to the MeasureType enum\n   * @internal\n   */\n  public measureType = MeasureType;\n\n  /**\n   * Reference to the AreaMeasureUnit enum\n   * @internal\n   */\n  public measureAreaUnit = MeasureAreaUnit;\n\n  /**\n   * Reference to the LengthMeasureUnit enum\n   * @internal\n   */\n  public measureLengthUnit = MeasureLengthUnit;\n\n  /**\n   * Whether measure units should be automatically determined\n   * @internal\n   */\n  public measureUnitsAuto: boolean = false;\n\n  /**\n   * Whether display of distances of areas\n   * @internal\n   */\n  public displayDistance: boolean = true;\n\n  /**\n   * Whether display of distances of lines\n   * @internal\n   */\n  public displayLines: boolean = true;\n\n  /**\n   * Whether display of areas\n   * @internal\n   */\n  public displayAreas: boolean = true;\n\n  /**\n   * Observable of line boolean\n   * @internal\n   */\n   public hasLine$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area boolean\n   * @internal\n   */\n  public hasArea$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area\n   * @internal\n   */\n  public measure$: BehaviorSubject<Measure> = new BehaviorSubject({});\n\n  /**\n   * Observable of selected features\n   * @internal\n   */\n  public selectedFeatures$: BehaviorSubject<FeatureWithMeasure[]> = new BehaviorSubject([]);\n\n  /**\n   * OL draw source\n   * @internal\n   */\n  public showTooltips: boolean = true;\n\n  /**\n   * Whether draw control toggle is disabled or not\n   * @internal\n   */\n  public drawControlIsDisabled: boolean = true;\n\n  /**\n   * Draw line control\n   */\n  private drawLineControl: DrawControl;\n\n  /**\n   * Draw polygon control\n   */\n  private drawPolygonControl: DrawControl;\n\n  /**\n   * Modify control\n   */\n  private modifyControl: ModifyControl;\n\n  /**\n   * Active OL geometry\n   */\n  private activeOlGeometry: OlLineString | OlPolygon;\n\n  /**\n   * Active mlength unit\n   */\n  private activeLengthUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  /**\n   * Active area unit\n   */\n  private activeAreaUnit: MeasureAreaUnit = MeasureAreaUnit.SquareMeters;\n\n  /**\n   * Feature added listener key\n   */\n  private onFeatureAddedKey;\n\n  /**\n   * Feature removed listener key\n   */\n  private onFeatureRemovedKey;\n\n  /**\n   * Active draw control\n   * @internal\n   */\n  private activeDrawControl: DrawControl;\n\n  /**\n   * Subscription to draw start\n   */\n  private drawStart$$: Subscription;\n\n  /**\n   * Subscription to draw end\n   */\n  private drawEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private drawChanges$$: Subscription;\n\n  /**\n   * Subscription to modify start\n   */\n  private modifyStart$$: Subscription;\n\n  /**\n   * Subscription to modify end\n   */\n  private modifyEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private modifyChanges$$: Subscription;\n\n  /**\n   * Subscription to measures selection\n   */\n  private selectedFeatures$$: Subscription;\n\n  /**\n   * OL draw source\n   */\n  private olDrawSource = new OlVectorSource();\n\n  /**\n   * The map to measure on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The measures store\n   */\n  @Input() store: FeatureStore<FeatureWithMeasure>;\n\n  /**\n   * Measure type\n   * @internal\n   */\n  @Input()\n  set activeMeasureType(value: MeasureType) { this.setActiveMeasureType(value); }\n  get activeMeasureType(): MeasureType { return this._activeMeasureType; }\n  private _activeMeasureType: MeasureType;\n\n  /**\n   * The minimum length a segment must have to display a tooltip.\n   * It also applies to area tooltips.\n   */\n  @Input() minSegmentLength: number = 10;\n\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\n\n  /**\n   * Wheter one of the draw control is active\n   * @internal\n   */\n  get drawControlIsActive(): boolean {\n    return this.activeDrawControl !== undefined;\n  }\n\n  get projection(): string {\n    return this.map.ol.getView().getProjection().getCode();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dialog: MatDialog,\n    private storageService: StorageService\n  ) {}\n\n  /**\n   * Add draw controls and activate one\n   * @internal\n   */\n  ngOnInit() {\n    this.initStore();\n    this.createDrawLineControl();\n    this.createDrawPolygonControl();\n    this.createModifyControl();\n    this.toggleDrawControl();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    this.checkDistanceAreaToggle();\n    this.setActiveMeasureType(MeasureType.Length);\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.setActiveMeasureType(undefined);\n    this.deactivateModifyControl();\n    this.freezeStore();\n    this.subscriptions$$.map(s => s.unsubscribe());\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onMeasureTypeChange(measureType: MeasureType) {\n    this.activeMeasureType = measureType;\n  }\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n  onToggleDrawControl(toggle: boolean) {\n    if (toggle === true) {\n      this.toggleDrawControl();\n    } else {\n      this.deactivateDrawControl();\n    }\n  }\n\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n   onToggleMeasureUnitsAuto(toggle: boolean) {\n    this.measureUnitsAuto = toggle;\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the areas\n   * @internal\n   */\n  onToggleDisplayDistance(toggle: boolean) {\n    this.displayDistance = toggle;\n    this.onDisplayDistance();\n    toggle ? (this.storageService.set('distanceToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('distanceToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the lines\n   * @internal\n   */\n  onToggleDisplayLines(toggle: boolean) {\n    this.displayLines = toggle;\n    this.onDisplayLines();\n    toggle ? (this.storageService.set('linesToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('linesToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onToggleDisplayAreas(toggle: boolean) {\n    this.displayAreas = toggle;\n    this.onDisplayAreas();\n    toggle ? (this.storageService.set('areasToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('areasToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Set display parametres in current values\n   * @internal\n   */\n  checkDistanceAreaToggle(){\n    if (this.storageService.get('distanceToggle') === false){\n      this.displayDistance = false;\n    }\n    if (this.storageService.get('linesToggle') === false){\n      this.displayLines = false;\n    }\n    if (this.storageService.get('areasToggle') === false){\n      this.displayAreas = false;\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of areas\n   * @internal\n   */\n  onDisplayDistance() {\n    if (this.displayDistance) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-polygone-segments')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-polygone-segments')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of lines\n   * @internal\n   */\n  onDisplayLines() {\n    if (this.displayLines) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-line-segments')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-line-segments')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onDisplayAreas() {\n    if (this.displayAreas) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-area')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-area')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onLengthUnitChange(unit: MeasureLengthUnit) {\n    this.activeLengthUnit = unit;\n    this.table.refresh();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    if (this.activeOlGeometry !== undefined) {\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onAreaUnitChange(unit: MeasureAreaUnit) {\n    this.activeAreaUnit = unit;\n    this.table.refresh();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    if (this.activeOlGeometry !== undefined) {\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n  }\n\n  onCalculateClick() {\n    const features = this.selectedFeatures$.value;\n    const area = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      return sum + localFeature.properties.measure.area || 0;\n    }, 0);\n    const length = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      if (localFeature.geometry.type === 'Polygon') {\n        return sum;\n      }\n      return sum + localFeature.properties.measure.length || 0;\n    }, 0);\n    const perimeter = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      if (localFeature.geometry.type === 'LineString') {\n        return sum;\n      }\n      return sum + localFeature.properties.measure.length || 0;\n    }, 0);\n\n    this.openDialog({\n      area,\n      length,\n      perimeter\n    });\n  }\n\n  onDeleteClick() {\n    this.store.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach(selectedFeature => {\n      this.olDrawSource.getFeatures().forEach(drawingLayerFeature => {\n        const geometry = drawingLayerFeature.getGeometry() as any;\n        if (selectedFeature.properties.id === geometry.ol_uid) {\n          this.olDrawSource.removeFeature(drawingLayerFeature);\n        }\n      });\n    });\n  }\n\n  onModifyClick() {\n    if (this.selectedFeatures$.value.length !== 1) { return; }\n\n    if (this.modifyControl.active === true) {\n      this.deactivateModifyControl();\n      this.toggleDrawControl();\n    } else {\n      const localFeature = this.selectedFeatures$.value[0];\n      const olFeatures = this.store.layer.ol.getSource().getFeatures();\n      const olFeature = olFeatures.find((_olFeature: OlFeature<OlGeometry>) => {\n        return _olFeature.get('id') === localFeature.properties.id;\n      });\n\n      if (olFeature !== undefined) {\n        this.deactivateDrawControl();\n        this.activateModifyControl();\n\n        const olGeometry = olFeature.getGeometry();\n        this.clearTooltipsOfOlGeometry(olGeometry as (OlLineString | OlPolygon));\n        this.modifyControl.setOlGeometry(olGeometry);\n      }\n    }\n  }\n\n  private openDialog(data: MeasurerDialogData): void {\n    this.dialog.open(MeasurerDialogComponent, {data});\n  }\n\n  /**\n   * Initialize the measure store and set up some listeners\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      title: this.languageService.translate.instant('igo.geo.measure.layerTitle'),\n      id: `igo-measures-${uuid()}`,\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: createMeasureLayerStyle(),\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: { enabled: false }\n    });\n    tryBindStoreLayer(store, layer);\n    store.layer.visible = true;\n    layer.visible$.subscribe(visible => {\n      if (visible) {\n        Array.from(document.getElementsByClassName('igo-map-tooltip-measure')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-measure-by-display'));\n      }\n      else {\n        Array.from(document.getElementsByClassName('igo-map-tooltip-measure')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-measure-by-display'));\n      }\n    });\n\n    tryAddLoadingStrategy(store);\n\n    tryAddSelectionStrategy(store, new FeatureStoreSelectionStrategy({\n      map: this.map,\n      many: true\n    }));\n\n    this.onFeatureAddedKey = store.source.ol.on('addfeature', (event: OlVectorSourceEvent<OlGeometry>) => {\n      const localFeature = event.feature;\n      const olGeometry = localFeature.getGeometry() as any;\n      this.updateMeasureOfOlGeometry(olGeometry, localFeature.get('measure'));\n      this.onDisplayDistance();\n    });\n\n    this.onFeatureRemovedKey = store.source.ol.on('removefeature', (event: OlVectorSourceEvent<OlGeometry>) => {\n      const olGeometry = event.feature.getGeometry() as any;\n      this.clearTooltipsOfOlGeometry(olGeometry);\n    });\n\n    this.selectedFeatures$$ = store.stateView.manyBy$((record: EntityRecord<FeatureWithMeasure>) => {\n      return record.state.selected === true;\n    }).pipe(\n      skip(1) // Skip initial emission\n    )\n    .subscribe((records: EntityRecord<FeatureWithMeasure>[]) => {\n      if (this.modifyControl.active === true) {\n        this.deactivateModifyControl();\n      }\n      this.selectedFeatures$.next(records.map(record => record.entity));\n    });\n\n    this.subscriptions$$.push(this.store.entities$.subscribe(objectsExists => {\n      if (objectsExists.find(objectExist => objectExist.geometry.type === 'Polygon')){\n        this.hasArea$.next(true);\n      } else {\n        this.hasArea$.next(false);\n      }\n\n      if (objectsExists.find(objectExist => objectExist.geometry.type === 'LineString')){\n        this.hasLine$.next(true);\n      } else {\n        this.hasLine$.next(false);\n      }\n    }));\n\n    this.subscriptions$$.push(this.store.count$.subscribe(cnt => {\n      cnt >= 1 ?\n        this.store.layer.options.showInLayerList = true :\n        this.store.layer.options.showInLayerList = false;\n    }));\n  }\n\n  /**\n   * Freeze any store, meaning the layer is removed, strategies are deactivated\n   * and some listener removed\n   * @internal\n   */\n  private freezeStore() {\n    const store = this.store;\n    this.selectedFeatures$$.unsubscribe();\n    unByKey(this.onFeatureAddedKey);\n    unByKey(this.onFeatureRemovedKey);\n    store.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    store.deactivateStrategyOfType(FeatureStoreSelectionStrategy);\n  }\n\n  /**\n   * Create a draw line control\n   */\n  private createDrawLineControl() {\n    this.drawLineControl = new DrawControl({\n      geometryType: 'LineString',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createDrawPolygonControl() {\n    this.drawPolygonControl = new DrawControl({\n      geometryType: 'Polygon',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createModifyControl() {\n    this.modifyControl = new ModifyControl({\n      source: this.olDrawSource,\n      drawStyle: createMeasureInteractionStyle(),\n      layerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Activate the right control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    // this.deactivateModifyControl();\n    if (this.activeMeasureType === MeasureType.Length) {\n      this.activateDrawControl(this.drawLineControl);\n    } else if (this.activeMeasureType === MeasureType.Area) {\n      this.activateDrawControl(this.drawPolygonControl);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param drawControl Draw control\n   */\n  private activateDrawControl(drawControl: DrawControl) {\n    this.drawControlIsDisabled = false;\n    this.activeDrawControl = drawControl;\n    this.drawStart$$ = drawControl.start$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawStart(olGeometry));\n    this.drawEnd$$ = drawControl.end$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawEnd(olGeometry));\n    this.drawChanges$$ = drawControl.changes$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawChanges(olGeometry));\n\n    drawControl.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (this.activeDrawControl === undefined) {\n      return;\n    }\n\n    this.olDrawSource.clear();\n    if (this.drawStart$$ !== undefined ) { this.drawStart$$.unsubscribe(); }\n    if (this.drawEnd$$ !== undefined ) { this.drawEnd$$.unsubscribe(); }\n    if (this.drawChanges$$ !== undefined ) { this.drawChanges$$.unsubscribe(); }\n\n    this.clearTooltipsOfOlSource(this.olDrawSource);\n    if (this.activeOlGeometry !== undefined) {\n      this.clearTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n    this.activeDrawControl.setOlMap(undefined);\n    this.activeDrawControl = undefined;\n    this.activeOlGeometry = undefined;\n  }\n\n  private setActiveMeasureType(measureType: MeasureType) {\n    this._activeMeasureType = measureType;\n    this.clearMeasures();\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawStart(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = olGeometry;\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = undefined;\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n    this.addFeatureToStore(olGeometry);\n    this.clearTooltipsOfOlGeometry(olGeometry);\n    this.olDrawSource.clear(true);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawChanges(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(olGeometry, Object.assign({}, measure, {\n      area: undefined // We don't want to display an area tooltip while drawing.\n    }));\n    this.measure$.next(measure);\n  }\n\n  /**\n   * Activate a given control\n   * @param modifyControl Modify control\n   */\n  private activateModifyControl() {\n    const selection = this.store.getStrategyOfType(FeatureStoreSelectionStrategy) as FeatureStoreSelectionStrategy;\n    selection.deactivate();\n    selection.clear();\n\n    this.modifyStart$$ = this.modifyControl.start$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyStart(olGeometry));\n    this.modifyEnd$$ = this.modifyControl.end$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyEnd(olGeometry));\n    this.modifyChanges$$ = this.modifyControl.changes$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyChanges(olGeometry));\n    this.modifyControl.setOlMap(this.map.ol);\n  }\n\n  /**\n   * Deactivate the active modify control\n   */\n  private deactivateModifyControl() {\n    if (this.modifyStart$$ !== undefined ) { this.modifyStart$$.unsubscribe(); }\n    if (this.modifyEnd$$ !== undefined ) { this.modifyEnd$$.unsubscribe(); }\n    if (this.modifyChanges$$ !== undefined ) { this.modifyChanges$$.unsubscribe(); }\n\n    if (this.activeOlGeometry !== undefined) {\n      if (this.selectedFeatures$.value.length === 1) {\n        const localFeature = this.selectedFeatures$.value[0];\n        this.addFeatureToStore(this.activeOlGeometry, localFeature);\n      }\n      this.finalizeMeasureOfOlGeometry(this.activeOlGeometry);\n    }\n\n    this.olDrawSource.clear();\n\n    this.store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n\n    this.activeOlGeometry = undefined;\n    this.modifyControl.setOlMap(undefined);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyStart(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawStart(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyChanges(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawChanges(olGeometry);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyEnd(olGeometry: OlLineString | OlPolygon) {\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n  }\n\n  private finalizeMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(olGeometry, measure);\n  }\n\n  /**\n   * Update measures observables\n   * @param olGeometry Ol linestring or polygon\n   * @param measure Measure\n   */\n  private updateMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon, measure: Measure) {\n    olGeometry.setProperties({_measure: measure}, true);\n    this.updateTooltipsOfOlGeometry(olGeometry);\n  }\n\n  /**\n   * Clear the measures observables\n   */\n  private clearMeasures() {\n    this.measure$.next({});\n  }\n\n  /**\n   * Add a feature with measures to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(olGeometry, localFeature?: FeatureWithMeasure) {\n    const featureId = localFeature ? localFeature.properties.id : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n    this.store.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        measure: olGeometry.get('_measure')\n      },\n      meta: {\n        id: featureId\n      }\n    });\n  }\n\n  /**\n   * Update all the tooltips of an OL geometry\n   * @param olGeometry OL Geometry\n   * @param lengths Lengths of the OL geometry's segments\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = olGeometry.get('_measure');\n    const lengths = measure.lengths;\n    const area = measure.area;\n\n    const olMidpointsTooltips = updateOlTooltipsAtMidpoints(olGeometry);\n    if (lengths.length === olMidpointsTooltips.length) {\n      for (let i = 0; i < olMidpointsTooltips.length; i++) {\n        const length = lengths[i];\n        if (length !== undefined) {\n          this.updateOlTooltip(\n            olMidpointsTooltips[i],\n            metersToUnit(length, this.activeLengthUnit),\n            this.activeLengthUnit,\n            MeasureType.Length\n          );\n        }\n      }\n    }\n\n    if (area !== undefined) {\n      this.updateOlTooltip(\n        updateOlTooltipAtCenter(olGeometry),\n        squareMetersToUnit(area, this.activeAreaUnit),\n        this.activeAreaUnit,\n        MeasureType.Area\n      );\n    }\n  }\n\n  /**\n   * Show the map tooltips of a geoemtry\n   */\n  private showTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\n      if (this.shouldShowTooltip(olTooltip)) {\n        this.map.ol.addOverlay(olTooltip);\n      }\n    });\n  }\n\n  /**\n   * Clear the tooltips of an OL geometrys\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\n      if (olTooltip !== undefined && olTooltip.getMap() !== undefined) {\n        this.map.ol.removeOverlay(olTooltip);\n      }\n    });\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private updateTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      this.updateTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private showTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      this.showTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Clear the map tooltips\n   * @param olDrawSource OL vector source\n   */\n  private clearTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry !== undefined) {\n        this.clearTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n      }\n    });\n  }\n\n  /**\n   * Update an OL tooltip properties and inner HTML and add it to the map if possible\n   * @param olTooltip OL tooltip\n   * @param measure The measure valeu ti display\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateOlTooltip(\n    olTooltip: OlOverlay,\n    measure: number,\n    unit: MeasureAreaUnit | MeasureLengthUnit,\n    type: MeasureType\n  ) {\n    olTooltip.setProperties({_measure: measure, _unit: unit, _type: type}, true);\n    olTooltip.getElement().innerHTML = this.computeTooltipInnerHTML(olTooltip);\n    if (this.shouldShowTooltip(olTooltip)) {\n      this.map.ol.addOverlay(olTooltip);\n    }\n  }\n\n  /**\n   * Compute a tooltip's content\n   * @param olTooltip OL overlay\n   * @returns Inner HTML\n   */\n  private computeTooltipInnerHTML(olTooltip: OlOverlay): string {\n    const properties = olTooltip.getProperties() as any;\n    return formatMeasure(properties._measure, {\n      decimal: 1,\n      unit: properties._unit,\n      unitAbbr: true,\n      locale: 'fr'\n    }, this.languageService);\n  }\n\n  /**\n   * Whether a tooltip should be showned based on the length\n   * of the segment it is bound to.\n   * @param olTooltip OL overlay\n   * @returns True if the tooltip should be shown\n   */\n  private shouldShowTooltip(olTooltip: OlOverlay): boolean {\n    if (this.showTooltips === false) {\n      return false;\n    }\n\n    const properties = olTooltip.getProperties() as any;\n    const measure = properties._measure;\n    if (measure === undefined) {\n      return false;\n    }\n\n    if (properties._unit === MeasureType.Length) {\n      const minSegmentLength = metersToUnit(this.minSegmentLength, properties._unit) || 0;\n      return measure > Math.max(minSegmentLength, 0);\n    }\n\n    return true;\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\nimport { metersToUnit, squareMetersToUnit, formatMeasure } from '../shared/measure.utils';\n\n/**\n * This pipe returns a measure converted from meters (or square meters)\n * to the specified unit. It also keeps a certain number of decimals.\n */\n@Pipe({\n  name: 'measureFormat'\n})\nexport class MeasureFormatPipe implements PipeTransform {\n\n  /**\n   * @ignore\n   */\n  transform(\n    value: number, unit: MeasureAreaUnit | MeasureLengthUnit,\n    unitAbbr: boolean = false,\n    decimal: number = 1\n  ): number {\n    let out;\n    if (Object.values(MeasureAreaUnit).indexOf(unit as MeasureAreaUnit) >= 0) {\n      out = squareMetersToUnit(value, unit as MeasureAreaUnit);\n    } else if (Object.values(MeasureLengthUnit).indexOf(unit as MeasureLengthUnit) >= 0) {\n      out = metersToUnit(value, unit as MeasureLengthUnit);\n    }\n\n    return out ? formatMeasure(out, {\n      decimal: 1,\n      unit,\n      unitAbbr,\n      locale: 'fr'\n    }) : out;\n  }\n}\n","import { DrawControlOptions } from './../shared/controls/draw';\nimport {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  Optional,\n  Self,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { NgControl, ControlValueAccessor } from '@angular/forms';\n\nimport { Subscription } from 'rxjs';\n\nimport * as OlStyle from 'ol/style';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlGeometry from 'ol/geom/Geometry';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport OlFeature from 'ol/Feature';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlOverlay from 'ol/Overlay';\nimport * as olproj from 'ol/proj';\nimport Point from 'ol/geom/Point';\n\nimport { IgoMap } from '../../map';\nimport {\n  MeasureLengthUnit,\n  updateOlGeometryMidpoints,\n  formatMeasure,\n  measureOlGeometry\n} from '../../measure';\nimport { DrawControl, ModifyControl, ModifyControlOptions } from '../shared/controls';\nimport { createDrawInteractionStyle } from '../shared/geometry.utils';\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\n\n/**\n * This input allows a user to draw a new geometry or to edit\n * an existing one on a map. A text input is also displayed in the\n * form with some instructions.\n * This is still WIP.\n */\n@Component({\n  selector: 'igo-geometry-form-field-input',\n  templateUrl: './geometry-form-field-input.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class GeometryFormFieldInputComponent implements OnInit, OnDestroy, ControlValueAccessor {\n\n  private olOverlayLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  private olGeoJSON = new OlGeoJSON();\n  private ready = false;\n\n  private drawControl: DrawControl;\n  private modifyControl: ModifyControl;\n  private defaultDrawStyleRadius: number;\n  private olGeometryEnds$$: Subscription;\n  private olGeometryChanges$$: Subscription;\n  private olTooltip = this.createMeasureTooltip();\n\n  /**\n   * Active control\n   * @internal\n   */\n  public activeControl: DrawControl | ModifyControl;\n\n  /**\n   * The map to draw the geometry on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The geometry type\n   */\n  @Input()\n  set geometryType(value: typeof OlGeometryType) {\n    this._geometryType = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get geometryType(): typeof OlGeometryType { return this._geometryType; }\n  private _geometryType: typeof OlGeometryType;\n\n  /**\n   * The drawGuide around the mouse pointer to help drawing\n   */\n  @Input() drawGuide: number = null;\n\n  /**\n   * Whether a measure tooltip should be displayed\n   */\n  @Input() measure: boolean = false;\n\n  /**\n   * Whether draw control should be active or not\n   */\n  @Input()\n  get drawControlIsActive(): boolean { return this._drawControlIsActive; }\n  set drawControlIsActive(value: boolean) {\n    this._drawControlIsActive = value;\n    if (this.ready === false) {\n      return;\n    }\n    this.deactivateControl();\n    if (!this._drawControlIsActive) {\n      return;\n    } else {\n      this.toggleControl();\n    }\n  }\n  private _drawControlIsActive: boolean = true;\n\n  /**\n   * Whether freehand draw control should be active or not\n   */\n  @Input()\n  get freehandDrawIsActive(): boolean { return this._freehandDrawIsActive; }\n  set freehandDrawIsActive(value: boolean) {\n    this._freehandDrawIsActive = value;\n    this.deactivateControl();\n\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n\n    if (this.ready === false) {\n      return;\n    }\n\n    if (!this.drawControlIsActive) {\n      return;\n    }\n    this.toggleControl();\n  }\n  private _freehandDrawIsActive: boolean;\n\n  /**\n   * Control options\n   */\n  @Input() controlOptions: {[key: string]: any} = {};\n\n  /**\n   * Style for the draw control (applies while the geometry is being drawn)\n   */\n  @Input()\n  set drawStyle(value: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle) {\n    if (value === undefined) {\n      value = createDrawInteractionStyle();\n    }\n    this._drawStyle = value;\n\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(value) as OlStyle.Circle;\n    if (olGuideStyle !== undefined) {\n      this.defaultDrawStyleRadius = olGuideStyle.getRadius();\n    } else {\n      this.defaultDrawStyleRadius = null;\n    }\n\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get drawStyle(): OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle { return this._drawStyle; }\n  private _drawStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle;\n\n  /**\n   * Style for the overlay layer (applies once the geometry is added to the map)\n   * If not specified, drawStyle applies\n   */\n  @Input()\n  set overlayStyle(value: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle) { this._overlayStyle = value; }\n  get overlayStyle(): OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle { return this._overlayStyle; }\n  private _overlayStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle;\n\n  /**\n   * The geometry value (GeoJSON)\n   * Implemented as part of ControlValueAccessor.\n   */\n  @Input()\n  set value(value: GeoJSONGeometry) {\n    this._value = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    if (value) {\n      this.addGeoJSONToOverlay(value);\n    } else {\n      this.olOverlaySource.clear(true);\n    }\n    this.onChange(value);\n    this.toggleControl();\n    this.cdRef.detectChanges();\n  }\n  get value(): GeoJSONGeometry { return this._value; }\n  private _value: GeoJSONGeometry;\n\n  /**\n   * The vector source to add the geometry to\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<OlGeometry> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  @Input()\n  set radius(value: any) {\n    if (this.ready === false) {\n      return;\n    }\n    if (this.modifyControl.getSource()) {\n      this.modifyControl.getSource().refresh();\n    }\n    if (this.freehandDrawIsActive) {\n      let olModify;\n      setTimeout(() => {\n        olModify = this.modifyControl.olModifyInteraction;\n        if (olModify) {\n          if (olModify.features_) {\n            olModify.features_.clear();\n            this.addGeoJSONToOverlay(this.value);\n          }\n        }\n      }, 0);\n    }\n  }\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    @Optional() @Self() public ngControl: NgControl\n  ) {\n    if (this.ngControl !== undefined) {\n      // Setting the value accessor directly (instead of using\n      // the providers) to avoid running into a circular import.\n      this.ngControl.valueAccessor = this;\n    }\n  }\n\n  /**\n   * Create an overlay layer, add the initial geometry to it (if any)\n   * and toggle the right interaction.\n   * @internal\n   */\n  ngOnInit() {\n    if (this.drawStyle === undefined) {\n      this.drawStyle = createDrawInteractionStyle();\n    }\n\n    if (this.overlayStyle === undefined) {\n      this.overlayStyle = this.drawStyle;\n    }\n\n    this.addOlOverlayLayer();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    if (this.value) {\n      this.addGeoJSONToOverlay(this.value);\n    }\n    this.toggleControl();\n\n    this.ready = true;\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    // This is mandatory when the form control is reused after\n    // this component has been destroyed. It seems like the control\n    // keeps a reference to this component even after it's destroyed\n    // and it attempts to set it's value\n    this.ready = false;\n\n    this.deactivateControl();\n    this.olOverlaySource.clear();\n    this.map.ol.removeLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  registerOnChange(fn: Function) {\n    this.onChange = fn;\n  }\n  private onChange: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  registerOnTouched(fn: Function) {\n    this.onTouched = fn;\n  }\n  private onTouched: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  writeValue(value: GeoJSONGeometry) {\n    this.value = value;\n  }\n\n  /**\n   * Add an overlay layer to the map\n   */\n  private addOlOverlayLayer() {\n    this.olOverlayLayer = new OlVectorLayer({\n      source: new OlVectorSource(),\n      zIndex: 500,\n      style: null\n    });\n    this.map.ol.addLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Create a draw control and subscribe to it's geometry\n   */\n  private createDrawControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      geometryType: this.geometryType || 'Point',\n      drawingLayer: this.olOverlayLayer,\n      interactionStyle: typeof this.drawStyle === 'function' ? this.drawStyle : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n        const style = this.drawStyle;\n        this.updateDrawStyleWithDrawGuide(style, resolution);\n        return style;\n      }\n    }) as DrawControlOptions;\n    this.drawControl = new DrawControl(controlOptions);\n  }\n\n  /**\n   * Create a modify control and subscribe to it's geometry\n   */\n  private createModifyControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      layer: this.olOverlayLayer,\n      drawStyle: typeof this.drawStyle === 'function' ? this.drawStyle : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n        const style = this.drawStyle;\n        this.updateDrawStyleWithDrawGuide(style, resolution);\n        return style;\n      }\n    }) as ModifyControlOptions;\n    this.modifyControl = new ModifyControl(controlOptions);\n  }\n\n  /**\n   * Toggle the proper control (draw or modify)\n   */\n  private toggleControl() {\n    let activate;\n    if (!this.value && this.geometryType) {\n      activate = this.drawControl;\n    } else {\n      activate = this.modifyControl;\n    }\n\n    // If the control that should be activated\n    // is not the same as the current active control,\n    // deactivate the current control and activate the new one\n    // Otherwise, do nothing and keep the current control active\n    if (activate !== this.activeControl) {\n      this.deactivateControl();\n      this.activateControl(activate);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param control Control\n   */\n  private activateControl(control: DrawControl | ModifyControl) {\n    this.activeControl = control;\n    this.olGeometryEnds$$ = control.end$\n      .subscribe((olGeometry: OlGeometry) => this.onOlGeometryEnds(olGeometry));\n    if (this.measure === true && control === this.drawControl) {\n      this.olGeometryChanges$$ = control.changes$\n        .subscribe((olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) => this.onOlGeometryChanges(olGeometry));\n    }\n    control.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active control\n   */\n  private deactivateControl() {\n    this.removeMeasureTooltip();\n    if (this.activeControl !== undefined) {\n      this.activeControl.setOlMap(undefined);\n    }\n    if (this.olGeometryEnds$$ !== undefined) {\n      this.olGeometryEnds$$.unsubscribe();\n    }\n    if (this.olGeometryChanges$$ !== undefined) {\n      this.olGeometryChanges$$.unsubscribe();\n    }\n    this.activeControl = undefined;\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryEnds(olGeometry: OlGeometry | undefined) {\n    this.removeMeasureTooltip();\n    this.setOlGeometry(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryChanges(olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) {\n    if (olGeometry.getType() !== 'Point') {\n      this.updateMeasureTooltip(olGeometry);\n    }\n  }\n\n  /**\n   * When drawing ends, convert the output value to GeoJSON and keep it.\n   * Restore the double click interaction.\n   * @param olGeometry OL geometry\n   */\n  private setOlGeometry(olGeometry: OlGeometry | undefined) {\n    let value;\n    if (olGeometry === undefined) {\n      return;\n    }\n\n    if (olGeometry.getType() === 'Circle') { // Because Circle doesn't exist as a GeoJSON object\n      olGeometry = this.circleToPoint(olGeometry);\n    }\n\n    value = this.olGeoJSON.writeGeometryObject(olGeometry, {\n      featureProjection: this.map.projection,\n      dataProjection: 'EPSG:4326'\n    });\n    if (olGeometry.get('radius')) {\n      value.radius = olGeometry.get('radius');\n      olGeometry.set('radius', value.radius);\n    }\n    this.writeValue(value);\n  }\n\n  private circleToPoint(olGeometry) {\n    const center = olGeometry.getCenter();\n    const coordinates = olproj.transform(center, this.map.projection, 'EPSG:4326');\n    const radius = Math.round(olGeometry.getRadius() * (Math.cos((Math.PI / 180) * coordinates[1])));\n\n    // Convert it to a point object\n    olGeometry = new Point(center);\n    olGeometry.set('radius', radius, true);\n    return olGeometry;\n  }\n\n  /**\n   * Add a GeoJSON geometry to the overlay\n   * @param geometry GeoJSON geometry\n   */\n  private addGeoJSONToOverlay(geometry: GeoJSONGeometry) {\n    const olGeometry = this.olGeoJSON.readGeometry(geometry, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: this.map.projection\n    });\n    const olFeature = new OlFeature({\n      geometry: olGeometry\n    });\n    olFeature.setStyle(this.overlayStyle as OlStyle.Style);\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create the measure tooltip\n   */\n  private createMeasureTooltip() {\n    return new OlOverlay({\n      element: document.createElement('div'),\n      offset: [-30, -10],\n      className: [\n        'igo-map-tooltip',\n        'igo-map-tooltip-measure'\n      ].join(' '),\n      stopEvent: false\n    });\n  }\n\n  /**\n   * Update the measure tooltip of an OL geometry\n   * @param olGeometry OL Geometry\n   */\n  private updateMeasureTooltip(olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) {\n    const measure = measureOlGeometry(olGeometry, this.map.projection);\n    const lengths = measure.lengths;\n    const lastIndex = olGeometry.getType() === 'Polygon' ? lengths.length - 2 : lengths.length - 1;\n    const lastLength = lengths[lastIndex];\n\n    const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n    const olLastMidpoint = olMidpoints[lastIndex];\n    if (olMidpoints.length === 0 || olLastMidpoint === undefined) {\n      this.removeMeasureTooltip();\n      return;\n    }\n\n    this.olTooltip.setPosition(olLastMidpoint.getFlatCoordinates());\n\n    const innerHtml = formatMeasure(lastLength, {\n      decimal: 1,\n      unit: MeasureLengthUnit.Meters,\n      unitAbbr: true,\n      locale: 'fr'\n    });\n    this.olTooltip.getElement().innerHTML = innerHtml;\n    if (this.olTooltip.getMap() === undefined) {\n      this.map.ol.addOverlay(this.olTooltip);\n    }\n  }\n\n  /**\n   * Remove the measure tooltip from the map\n   */\n  private removeMeasureTooltip() {\n    if (this.olTooltip.getMap && this.olTooltip.getMap() !== undefined) {\n      this.map.ol.removeOverlay(this.olTooltip);\n      this.olTooltip.setMap(undefined);\n    }\n  }\n\n  /**\n   * Adjust the draw style with the specified draw guide distance, if possible\n   * @param olStyle Draw style to update\n   * @param resolution Resolution (to make the screen size of symbol fit the drawGuide value)\n   */\n  private updateDrawStyleWithDrawGuide(\n    olStyle: OlStyle.Style |\n    ((feature, resolution) => OlStyle.Style) |\n    OlStyle.Circle,\n    resolution: number) {\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(olStyle) as OlStyle.Circle;\n    if (olGuideStyle === undefined) {\n      return;\n    }\n\n    const drawGuide = this.drawGuide;\n    let radius;\n    if (!drawGuide || drawGuide < 0) {\n      radius = this.defaultDrawStyleRadius;\n    } else {\n      radius = drawGuide > 0 ? drawGuide / resolution : drawGuide;\n    }\n    olGuideStyle.setRadius(radius);\n  }\n\n  /**\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\n   * @param olStyle The style on which to perform the check\n   */\n  private isStyleWithRadius(olStyle) {\n    return typeof olStyle !== 'function' && olStyle.setRadius;\n  }\n\n  /**\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\n   * @param olStyle The style on which to perform the check\n   */\n  private getGuideStyleFromDrawStyle(\n    olStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle |\n    OlStyle.Style[] | ((feature, resolution) => OlStyle.Style)[] | OlStyle.Circle[]\n  ) {\n    if (Array.isArray(olStyle)) {\n      olStyle = olStyle[0];\n    }\n    if (this.isStyleWithRadius(olStyle)) {\n      return olStyle;\n    }\n    return undefined;\n  }\n}\n","<ng-template></ng-template>","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { GeometryFormFieldComponent } from './geometry-form-field.component';\nimport { GeometryFormFieldInputComponent } from './geometry-form-field-input.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    IgoLanguageModule\n  ],\n  exports: [\n    GeometryFormFieldComponent,\n    GeometryFormFieldInputComponent\n  ],\n  declarations: [\n    GeometryFormFieldComponent,\n    GeometryFormFieldInputComponent\n  ]\n})\nexport class IgoGeometryFormFieldModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoGeometryFormFieldModule } from './geometry-form-field/geometry-form-field.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoGeometryFormFieldModule\n  ],\n  exports: [\n    IgoGeometryFormFieldModule\n  ],\n  declarations: [],\n  providers: []\n})\nexport class IgoGeometryModule {}\n","<button *ngIf=\"header && options.timeFilterable && options.timeFilter\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\">\n  <mat-icon [matBadge]=\"badge\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" svgIcon=\"history\"></mat-icon>\n</button>\n\n<div #ogcFilter class=\"igo-layer-actions-container\"\n*ngIf=\"header && options.timeFilterable && options.timeFilter\">\n  <igo-time-filter-item\n    *ngIf=\"timeFilterCollapse && options.timeFilter\"\n    igoListItem\n    [header]=\"false\"\n    [layer]=\"layer\">\n  </igo-time-filter-item>\n</div>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\nimport { TimeFilterableDataSourceOptions } from '../shared/time-filter.interface';\nimport { WMSDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\n\n@Component({\n  selector: 'igo-time-filter-button',\n  templateUrl: './time-filter-button.component.html',\n  styleUrls: ['./time-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TimeFilterButtonComponent implements OnInit {\n\n  public options: TimeFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.timeFilter as any;\n    if (filter && filter.enabled) {\n      return 1;\n    } else {\n      return;\n    }\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: IgoMap;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean = true;\n\n  public timeFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n  }\n}\n","<div *ngIf=\"style === 'calendar' && type !=='year'\">\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n    <mat-form-field>\n      <mat-datetimepicker-toggle [for]=\"datetimePicker\" matSuffix></mat-datetimepicker-toggle>\n      <mat-datetimepicker #datetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n      <input matInput autocomplete=\"false\"\n        placeholder=\"{{'igo.geo.timeFilter.date' | translate}}\"\n        [matDatetimepicker]=\"datetimePicker\"\n        [(ngModel)]=\"date\"\n        [min]=\"min\"\n        [max]=\"max\"\n        readonly=\"readonly\"\n        (dateChange)=\"handleDateChange($event)\">\n    </mat-form-field>\n\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle [for]=\"minDatetimePicker\" matSuffix></mat-datetimepicker-toggle>\n        <mat-datetimepicker #minDatetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n        <input matInput autocomplete=\"false\"\n          placeholder=\"{{'igo.geo.timeFilter.startDate' | translate}}\"\n          [matDatetimepicker]=\"minDatetimePicker\"\n          [(ngModel)]=\"startDate\"\n          [min]=\"min\"\n          [max]=\"getRangeMaxDate()\"\n          readonly=\"readonly\"\n          (input)=\"startDate\"\n          (dateChange)=\"handleDateChange($event)\">\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle [for]=\"maxDatetimePicker\" matSuffix></mat-datetimepicker-toggle>\n        <mat-datetimepicker #maxDatetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n        <input matInput autocomplete=\"false\"\n          placeholder=\"{{'igo.geo.timeFilter.endDate' | translate}}\"\n          [matDatetimepicker]=\"maxDatetimePicker\"\n          [(ngModel)]=\"endDate\"\n          [min]=\"getRangeMinDate()\"\n          [max]=\"max\"\n          readonly=\"readonly\"\n          (dateChange)=\"handleDateChange($event)\">\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n\n<div *ngIf=\"style === 'calendar' && type ==='year'\">\n\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n        <mat-form-field>\n            <mat-select placeholder=\"{{'igo.geo.timeFilter.date' | translate}}\" [(ngModel)]=\"year\" (selectionChange)=\"handleYearChange($event)\">\n                  <mat-option [value]=\"year\" *ngFor=\"let year of listYears\">{{year}}</mat-option>\n            </mat-select>\n        </mat-form-field>\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n        <mat-form-field>\n            <mat-select placeholder=\"{{'igo.geo.timeFilter.startDate' | translate}}\" [(ngModel)]=\"startYear\" (selectionChange)=\"handleYearChange($event)\">\n              <mat-option [value]=\"startYear\" *ngFor=\"let startYear of startListYears\">{{startYear}}</mat-option>\n            </mat-select>\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n    <mat-form-field>\n        <mat-select placeholder=\"{{'igo.geo.timeFilter.endDate' | translate}}\" [(ngModel)]=\"endYear\" (selectionChange)=\"handleYearChange($event)\">\n              <mat-option [value]=\"endYear\" *ngFor=\"let endYear of endListYears\">{{endYear}}</mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n\n</div>\n\n\n  <br>\n  <div *ngIf=\"!isRange && style === 'slider' && type === 'year'\" class=\"igo-col igo-col-100 igo-col-100-m mat-typography\">\n    <span>{{startYear}}</span>\n    <mat-slider\n        id=\"time-slider\"\n        tickInterval=\"auto\"\n        step=\"{{step}}\"\n        [min]=\"startYear\"\n        [max]=\"endYear\"\n        [value]=\"handleSliderValue()\"\n        [color]=\"color\"\n        thumbLabel\n        (input)=\"handleSliderYearChange($event)\"\n        (change)=\"handleSliderYearChange($event)\"\n        [disabled]= \"!options.enabled || !layer.visible\">\n    </mat-slider>\n    <span>{{endYear}}</span>\n    <p *ngIf= \"options.enabled\" class=\"date-below\">{{year}}</p>\n    <div #actions class=\"igo-layer-actions-container\">\n      <mat-slide-toggle (change)=\"toggleFilterState()\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" [color]=\"color\" [checked]=\"options.enabled\"\n        [disabled]=\"!layer.visible\">\n      </mat-slide-toggle>\n      <button [disabled]= \"!options.enabled  || !layer.visible\" mat-icon-button color=\"primary\" (click)=\"playYear($event)\">\n        <mat-icon svgIcon=\"{{playIcon}}\"></mat-icon>\n       </button>\n      <button [disabled]=\"!options.enabled  || !layer.visible\" mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n      </button>\n    </div>\n  </div>\n\n<div *ngIf=\"style === 'slider' && type !== 'year'\" class=\"igo-col igo-col-100 igo-col-100-m\">\n  <mat-slider\n      id=\"time-slider\"\n      tickInterval=\"auto\"\n      step=\"{{step}}\"\n      [min]=\"dateToNumber(min)\"\n      [max]=\"dateToNumber(max)\"\n      [value]=\"handleSliderValue()\"\n      thumbLabel\n      (input)=\"handleSliderDateChange($event)\"\n      (selectionChange)=\"handleSliderDateChange($event)\">\n  </mat-slider>\n  <p class=\"date-below\">{{handleSliderTooltip()}}</p>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n   <mat-icon svgIcon=\"{{playIcon}}\"></mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  OnInit,\n  Input,\n  Output,\n  EventEmitter,\n  ViewChild\n} from '@angular/core';\nimport { DateAdapter } from '@angular/material/core';\nimport { MatSlider } from '@angular/material/slider';\nimport * as moment from 'moment';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterOptions } from '../shared/time-filter.interface';\nimport { TimeFilterType, TimeFilterStyle } from '../shared/time-filter.enum';\n\n@Component({\n  selector: 'igo-time-filter-form',\n  templateUrl: './time-filter-form.component.html',\n  styleUrls: ['./time-filter-form.component.scss']\n})\nexport class TimeFilterFormComponent implements OnInit {\n  @Input() layer: Layer;\n\n  @Input() options: TimeFilterOptions;\n\n  public color = 'primary';\n  public date: Date;\n  public startDate: Date;\n  public endDate: Date;\n  public year: any;\n  public startYear: any;\n  public endYear: any;\n  public initStartYear: any;\n  public initEndYear: any;\n  public listYears: Array<string> = [];\n  public startListYears: Array<string> = [];\n  public endListYears: Array<string> = [];\n\n  @Input()\n  set currentValue(value: string) {\n    if (value) {\n      if (this.type !== TimeFilterType.YEAR) {\n        const valueArray = value.split('/');\n        if (valueArray.length > 0) {\n          const startDate = new Date(valueArray[0]);\n          const endDate = new Date(valueArray[1]);\n          if (!isNaN(startDate.valueOf())) {\n            this.startDate = startDate;\n          }\n          if (!isNaN(endDate.valueOf())) {\n            this.endDate = endDate;\n          }\n        }\n      }\n    }\n  }\n\n  public interval: any;\n  public playIcon = 'play-circle';\n  public resetIcon = 'replay';\n\n  @Output() change: EventEmitter<Date | [Date, Date]> = new EventEmitter();\n  @Output()\n  yearChange: EventEmitter<string | [string, string]> = new EventEmitter();\n  @ViewChild(MatSlider) mySlider;\n\n  get type(): TimeFilterType {\n    return this.options.type === undefined\n      ? TimeFilterType.DATE\n      : this.options.type;\n  }\n\n  get isRange(): boolean {\n    return this.options.range === undefined ||\n      this.options.style === TimeFilterStyle.SLIDER\n      ? false\n      : this.options.range;\n  }\n\n  get style(): TimeFilterStyle {\n    return this.options.style === undefined\n      ? TimeFilterStyle.SLIDER\n      : this.options.style;\n  }\n\n  get step(): number {\n    let step = 10800000;\n    if (this.options.step === undefined) {\n      switch (this.type) {\n        case TimeFilterType.DATE:\n        case TimeFilterType.DATETIME:\n          step = 10800000;\n          break;\n        case TimeFilterType.TIME:\n          step = 3600000;\n          break;\n        case TimeFilterType.YEAR:\n          step = 31536000000;\n          break;\n        default:\n          step = 10800000;\n      }\n    } else {\n      step = this.getStepDefinition(this.options.step);\n    }\n\n    return step;\n  }\n\n  get timeInterval(): number {\n    return this.options.timeInterval === undefined\n      ? 2000\n      : this.options.timeInterval;\n  }\n\n  get min(): Date {\n    if (this.options.min) {\n      const min = new Date(this.options.min);\n      return new Date(min.getTime() + min.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get max(): Date {\n    if (this.options.max) {\n      const max = new Date(this.options.max);\n      return new Date(max.getTime() + max.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get is(): boolean {\n    return this.options.range === undefined ? false : this.options.range;\n  }\n\n  constructor(private dateAdapter: DateAdapter<Date>) {\n    this.dateAdapter.setLocale('fr');\n  }\n\n  ngOnInit() {\n    if (this.startDate === undefined) {\n      this.startDate = new Date(this.min);\n    }\n    if (this.endDate === undefined) {\n      this.endDate = new Date(this.max);\n    }\n    if (this.startYear === undefined) {\n      this.startYear = new Date(this.startDate).getFullYear();\n      this.initStartYear = this.startYear;\n    }\n    if (this.endYear === undefined) {\n      this.endYear = new Date(this.endDate).getFullYear();\n      this.initEndYear = this.endYear;\n    }\n\n    if (!this.isRange) {\n      for (let i = this.startYear; i <= this.endYear + 1; i++) {\n        this.listYears.push(i);\n      }\n    } else {\n      for (let i = this.startYear; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      for (let i = this.startYear + 1; i <= this.endYear; i++) {\n        this.endListYears.push(i);\n      }\n    }\n    this.options.enabled =\n      this.options.enabled === undefined ? true : this.options.enabled;\n    this.checkFilterValue();\n    if (this.options.enabled) {\n      if (!this.isRange && this.style === 'slider' && this.type === 'year') {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.storeCurrentFilterValue();\n      this.yearChange.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  storeCurrentFilterValue() {\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.options.value = this.year.toString();\n    }\n  }\n\n  checkFilterValue() {\n    const olSource = this.layer.dataSource.ol as olSourceImageWMS;\n    const timeFromWms = olSource.getParams().TIME;\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.year = new Date(timeFromWms.toString()).getFullYear() + 1;\n      } else if (this.options.value) {\n        this.year = new Date(this.options.value.toString()).getFullYear() + 1;\n      } else {\n        this.year = new Date(this.min).getFullYear() + 1;\n      }\n    } else if (\n      this.isRange &&\n      this.style === TimeFilterStyle.CALENDAR &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.startYear = parseInt(timeFromWms.substr(0, 4), 10);\n        this.endYear = parseInt(timeFromWms.substr(5, 4), 10);\n        const newStartListYears: any[] = [];\n        const newEndListYears: any[] = [];\n        for (let i = this.initStartYear; i < this.endYear; i++) {\n          newStartListYears.push(i);\n        }\n        for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n          newEndListYears.push(i);\n        }\n        this.startListYears = newStartListYears;\n        this.endListYears = newEndListYears;\n      }\n    }\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n  }\n\n  handleDateChange(event: any) {\n    this.setupDateOutput();\n    this.applyTypeChange();\n\n    // Only if is range, use 2 dates to make the range\n    if (this.isRange) {\n      this.change.emit([this.startDate, this.endDate]);\n    } else {\n      this.change.emit(this.startDate);\n    }\n  }\n\n  handleYearChange(event: any) {\n    if (this.isRange) {\n      this.endListYears = [];\n      for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n        this.endListYears.push(i);\n      }\n      this.startListYears = [];\n      for (let i = this.initStartYear + 1; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      this.yearChange.emit([this.startYear, this.endYear]);\n    } else {\n      this.yearChange.emit(this.year);\n    }\n  }\n\n  handleListYearChange(event: any) {\n    this.handleYearChange([this.startYear, this.endYear]);\n  }\n\n  handleListYearStartChange(event: any) {\n    this.change.emit([this.startDate, this.endDate]);\n  }\n\n  dateToNumber(date: Date): number {\n    let newDate;\n    if (date) {\n      newDate = new Date(date);\n    } else {\n      newDate = new Date(this.min);\n    }\n\n    return newDate.getTime();\n  }\n\n  setSliderThumbLabel(label: string) {\n    const thumbLabel = this.findThumbLabel(\n      this.mySlider._elementRef.nativeElement.childNodes\n    );\n    if (thumbLabel) {\n      thumbLabel.textContent = label;\n    }\n  }\n\n  findThumbLabel(test: any[]): any {\n    let thumbLabel;\n\n    test.forEach(value => {\n      if (value.className === 'mat-slider-thumb-label-text') {\n        thumbLabel = value;\n      }\n\n      if (value.children.length > 0 && !thumbLabel) {\n        thumbLabel = this.findThumbLabel(value.childNodes);\n      }\n    }, this);\n    return thumbLabel;\n  }\n\n  toggleFilterState() {\n    this.options.enabled = !this.options.enabled;\n\n    if (this.options.enabled) {\n      if (\n        !this.isRange &&\n        TimeFilterStyle.SLIDER &&\n        this.type === TimeFilterType.YEAR\n      ) {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.stopFilter();\n      this.storeCurrentFilterValue();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  resetFilter(event: any) {\n    this.date = new Date(this.min);\n    this.year = this.date.getFullYear();\n    if (\n      !this.isRange &&\n      TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.yearChange.emit(this.year);\n    } else {\n      this.setupDateOutput();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(\n        that => {\n          let newMinDateNumber;\n          const maxDateNumber = new Date(that.max);\n\n          newMinDateNumber =\n            that.date === undefined ? that.min.getTime() : that.date.getTime();\n          newMinDateNumber += that.mySlider.step;\n          that.date = new Date(newMinDateNumber);\n\n          if (newMinDateNumber > maxDateNumber.getTime()) {\n            that.stopFilter();\n          }\n\n          that.handleDateChange({ value: that.date, date: that.date });\n        },\n        this.timeInterval,\n        this\n      );\n    }\n  }\n\n  playYear(event: any) {\n    if (\n      this.year + this.mySlider.step >\n      this.max.getFullYear() + this.mySlider.step\n    ) {\n      this.stopFilter();\n      this.resetFilter(event);\n    }\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(() => {\n        if (\n          (this.year + this.mySlider.step) > this.max.getFullYear()) {\n          this.stopFilter();\n        } else {\n          this.year = this.year + this.mySlider.step;\n        }\n        this.yearChange.emit(this.year);\n\n      }, this.timeInterval, this);\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n  }\n\n  handleSliderDateChange(event: any) {\n    this.date = new Date(event.value);\n    this.setSliderThumbLabel(this.handleSliderTooltip());\n    this.handleDateChange(event);\n  }\n\n  handleSliderYearChange(event: any) {\n    this.year = event.value;\n    this.yearChange.emit(this.year);\n  }\n\n  handleSliderValue(): number {\n    if (this.options.current === true || !this.min) {\n      const currentDate = new Date();\n      this.date = this.getRoundedDate(currentDate);\n    }\n    if (this.type === TimeFilterType.YEAR) {\n      return this.year;\n    } else {\n      return this.date === undefined ? this.min.getTime() : this.date.getTime();\n    }\n  }\n\n  handleSliderTooltip() {\n    let label: string;\n\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        label =\n          this.date === undefined\n            ? this.min.toDateString()\n            : this.date.toDateString();\n        break;\n      case TimeFilterType.TIME:\n        label =\n          this.date === undefined\n            ? this.min.toTimeString()\n            : this.date.toTimeString();\n        break;\n      // datetime\n      default:\n        label =\n          this.date === undefined\n            ? this.min.toUTCString()\n            : this.date.toUTCString();\n        break;\n    }\n\n    return label;\n  }\n\n  setupDateOutput() {\n    if (this.style === TimeFilterStyle.SLIDER) {\n      this.startDate = new Date(this.date);\n      this.startDate.setSeconds(-(this.step / 1000));\n      this.endDate = new Date(this.startDate);\n      this.endDate.setSeconds(this.step / 1000);\n    } else if (!this.isRange && !!this.date) {\n      this.endDate = new Date(this.date);\n      this.startDate = new Date(this.date);\n    } else if (this.isRange && (!!this.date || !this.date)) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    } else if (!this.date) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    }\n  }\n\n  applyTypeChange() {\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        if (this.startDate !== undefined || this.endDate !== undefined) {\n          this.startDate.setHours(0);\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setHours(23);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      case TimeFilterType.TIME:\n        if (this.style === TimeFilterStyle.CALENDAR) {\n          if (this.startDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.startDate.getHours();\n            const selectedMinute = this.startDate.getMinutes();\n            this.startDate = this.min;\n            this.startDate.setHours(selectedHour);\n            this.startDate.setMinutes(selectedMinute);\n          }\n\n          if (this.endDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.endDate.getHours();\n            const selectedMinute = this.endDate.getMinutes();\n            this.endDate = this.min;\n            this.endDate.setHours(selectedHour);\n            this.endDate.setMinutes(selectedMinute);\n          }\n        }\n\n        if (!this.isRange && this.step > 60 * 60 * 1000) {\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      // datetime\n      default:\n      // do nothing\n    }\n  }\n\n  getRangeMinDate(): Date {\n    return this.startDate === undefined ? this.min : this.startDate;\n  }\n\n  getRangeMaxDate(): Date {\n    return this.endDate === undefined ? this.max : this.endDate;\n  }\n\n  /**\n   * Round date at a certain time, 10 minutes by Default\n   * @param date - Date to Round\n   * @param atMinute - round to closest 'atMinute' minute, rounded 10 by default\n   * @return the rounded date\n   */\n  getRoundedDate(date, atMinute = 10) {\n    const coeff = 1000 * 60 * atMinute;\n    return new Date(Math.round(date.getTime() / coeff) * coeff);\n  }\n\n  /**\n   * Get the step (period) definition from the layer dimension tag\n   * @param step The step as ISO 8601 example: PT10M for 10 Minutes\n   * @return the duration in milliseconds\n   */\n  getStepDefinition(step) {\n    return moment.duration(step).asMilliseconds();\n  }\n}\n","<mat-list-item *ngIf=\"header\">\n  <mat-icon\n    class=\"igo-chevron\"\n    mat-list-avatar\n    igoCollapse\n    [target]=\"filters\"\n    [collapsed]=\"filtersCollapsed\"\n    (click)=\"toggleFiltersCollapsed()\"\n    svgIcon=\"chevron-up\" >\n  </mat-icon>\n  <h4 (click)=\"toggleLegendOnClick()\" [ngStyle]=\"{'cursor': filtersCollapsed ? 'default' : 'pointer'}\"  matLine>{{layer.title}}</h4>\n  \n  <button *ngIf=\"header\"\n    mat-icon-button\n    [color]=\"layer.visible ? 'primary' : 'default'\"\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"layer.visible ?\n                  ('igo.geo.layer.hideLayer' | translate) :\n                  ('igo.geo.layer.showLayer' | translate)\"\n    (click)=\"layer.visible = !layer.visible\">\n    <mat-icon\n      [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n      [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n    </mat-icon>\n  </button>\n\n</mat-list-item>\n\n<div #filters class=\"igo-datasource-filters-container\">\n  <div #legend class=\"igo-layer-legend-container\">\n    <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n    </igo-layer-legend>\n  </div>\n  <igo-time-filter-form\n    [layer]= \"layer\"\n    [options]=\"datasource.options.timeFilter\"\n    [currentValue]=\"datasource.options.params.TIME\"\n    (change)=\"handleDateChange($event)\"\n    (yearChange)=\"handleYearChange($event)\">\n  </igo-time-filter-form>\n</div>\n","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterableDataSource } from '../shared/time-filter.interface';\nimport { TimeFilterService } from '../shared/time-filter.service';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n@Component({\n  selector: 'igo-time-filter-item',\n  templateUrl: './time-filter-item.component.html',\n  styleUrls: ['./time-filter-item.component.scss']\n})\nexport class TimeFilterItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n\n  filtersCollapsed: boolean = false;\n\n  @Input() header: boolean = true;\n\n  @Input() layer: Layer;\n\n  get datasource(): TimeFilterableDataSource {\n    return this.layer.dataSource as TimeFilterableDataSource;\n  }\n  constructor(private timeFilterService: TimeFilterService) {}\n\n  ngOnInit(): void {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  handleYearChange(year: string | [string, string]) {\n    this.timeFilterService.filterByYear(this.datasource, year);\n  }\n\n  handleDateChange(date: Date | [Date, Date]) {\n    this.timeFilterService.filterByDate(this.datasource, date);\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'time'\">\n    <igo-time-filter-item [header]=\"true\" igoListItem [layer]=\"layer\"></igo-time-filter-item>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\n@Component({\n  selector: 'igo-time-filter-list',\n  templateUrl: './time-filter-list.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TimeFilterListComponent {\n  @Input()\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.cdRef.detectChanges();\n  }\n  private _layers: Layer[] = [];\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n}\n","import { Injectable } from '@angular/core';\n\nimport * as olproj from 'ol/proj';\nimport olWKT from 'ol/format/WKT';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WktService {\n  constructor() {}\n\n  public wktToFeature(wkt, wktProj, featureProj) {\n    return new olWKT().readFeature(wkt, {\n      dataProjection: wktProj,\n      featureProjection: featureProj\n    });\n  }\n  public extentToWkt(epsgTO, extent, extentProj) {\n    let currentExtent = olproj.transformExtent(extent, extentProj, epsgTO);\n    currentExtent = this.roundCoordinateArray(currentExtent, epsgTO, 0);\n    const wktPoly = `POLYGON((\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]}))`;\n    const wktLine = `LINESTRING(\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]})`;\n    const wktMultiPoints = `MULTIPOINT(\n        ${extent[0]} ${extent[1]},\n        ${extent[0]} ${extent[3]},\n        ${extent[2]} ${extent[3]},\n        ${extent[2]} ${extent[1]})`;\n    return {\n      wktPoly,\n      wktLine,\n      wktMultiPoints\n    };\n  }\n\n  private roundCoordinateArray(coordinateArray, projection, decimal = 0) {\n    const lproj = olproj.get(projection);\n    const units = lproj.getUnits();\n    const olUnits = ['ft', 'm', 'us-ft'];\n    if (olUnits.indexOf(units) !== -1) {\n      coordinateArray = this.roundArray(coordinateArray, decimal);\n    }\n    return coordinateArray;\n  }\n\n  private roundArray(array, decimal = 0) {\n    let x = 0;\n    while (x < array.length) {\n      array[x] = array[x].toFixed(decimal);\n      x++;\n    }\n    return array;\n  }\n\n  public snrcToWkt(snrc, epsgTO) {\n    snrc = snrc.toLowerCase();\n    let wktPoly;\n    const ew = {\n      1: { from: -56, to: -64 },\n      2: { from: -64, to: -72 },\n      3: { from: -72, to: -80 },\n      4: { from: -80, to: -88 },\n      5: { from: -88, to: -96 },\n      6: { from: -96, to: -104 },\n      7: { from: -104, to: -112 },\n      8: { from: -112, to: -120 },\n      9: { from: -120, to: -128 },\n      10: { from: -128, to: -136 }\n    };\n    const sn = {\n      1: { from: 44, to: 48 },\n      2: { from: 48, to: 52 },\n      3: { from: 52, to: 56 },\n      4: { from: 56, to: 60 },\n      5: { from: 60, to: 64 },\n      6: { from: 64, to: 68 },\n      7: { from: 68, to: 72 },\n      8: { from: 72, to: 76 },\n      9: { from: 76, to: -128 }\n    };\n    const snrc250kIndex = [\n      ['m', 'n', 'o', 'p'],\n      ['l', 'k', 'j', 'i'],\n      ['e', 'f', 'g', 'h'],\n      ['d', 'c', 'b', 'a']\n    ];\n\n    const snrc50kIndex = [\n      ['13', '14', '15', '16'],\n      ['12', '11', '10', '09'],\n      ['05', '06', '07', '08'],\n      ['04', '03', '02', '01']\n    ];\n    const checkSNRC50k = /\\d{2,3}[a-p][0,1][0-9]/gi;\n    const checkSNRC250k = /\\d{2,3}[a-p]/gi;\n    const checkSNRC1m = /\\d{2,3}/gi;\n\n    let snrc1m = false;\n    let snrc250k = false;\n    let snrc50k = false;\n\n    if (checkSNRC50k.test(snrc)) {\n      snrc50k = true;\n    } else {\n      if (checkSNRC250k.test(snrc)) {\n        snrc250k = true;\n      } else {\n        if (checkSNRC1m.test(snrc)) {\n          snrc1m = true;\n        }\n      }\n    }\n\n    if (snrc1m) {\n      snrc += 'a01';\n    } else if (snrc250k) {\n      snrc += '01';\n    }\n    if (/\\d{2,3}[a-p][0,1][0-9]/gi.test(snrc)) {\n      const regex1m = /(?=[a-p])/gi;\n      const ar1m = snrc.split(regex1m);\n      const part1m = ar1m[0];\n      const part250k = ar1m[1][0];\n      const part50k = ar1m[1].split(part250k)[1];\n      let separator = 1;\n      if (part1m.length === 3) {\n        separator = 2;\n      }\n      const partEW = part1m.substring(0, separator);\n      const partSN = part1m.substring(separator);\n      const unit1mEW = 8;\n      const unit1mSN = 4;\n      const unit250kEW = 2;\n      const unit250kSN = 1;\n      const unit50kEW = 0.5;\n      const unit50kSN = 0.25;\n      let index250kEW = 0;\n      let index250kSN = 0;\n      let index50kEW = 0;\n      let index50kSN = 0;\n      snrc250kIndex.forEach(element => {\n        if (element.indexOf(part250k) !== -1) {\n          index250kSN = snrc250kIndex.indexOf(element);\n          index250kEW = element.indexOf(part250k);\n        }\n      });\n      snrc50kIndex.forEach(element => {\n        if (element.indexOf(part50k) !== -1) {\n          index50kSN = snrc50kIndex.indexOf(element);\n          index50kEW = element.indexOf(part50k);\n        }\n      });\n\n      let increment250kEW = 0;\n      let increment250kSN = 0;\n      let increment50kEW = 0;\n      let increment50kSN = 0;\n      let unitPerTypeEW = unit1mEW;\n      let unitPerTypeSN = unit1mSN;\n      if (snrc250k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = 0;\n        increment50kSN = 0;\n        unitPerTypeEW = unit250kEW;\n        unitPerTypeSN = unit250kSN;\n      } else if (snrc50k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = index50kEW * unit50kEW;\n        increment50kSN = index50kSN * unit50kSN;\n        unitPerTypeEW = unit50kEW;\n        unitPerTypeSN = unit50kSN;\n      }\n\n      const coord: {ul?: any, lr?: any, ur?: any, ll?: any} = {\n        ul: [\n          ew[partEW].to + increment250kEW + increment50kEW,\n          sn[partSN].to - increment250kSN - increment50kSN\n        ]\n      };\n\n      coord.lr = [\n        coord.ul[0] + unitPerTypeEW,\n        coord.ul[1] - unitPerTypeSN\n      ];\n      coord.ur = [coord.ul[0], coord.ul[1] - unitPerTypeSN];\n      coord.ll = [coord.ul[0] + unitPerTypeEW, coord.ul[1]];\n\n      coord.ul = olproj.transform(\n        [coord.ul[0], coord.ul[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.lr = olproj.transform(\n        [coord.lr[0], coord.lr[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ur = olproj.transform(\n        [coord.ur[0], coord.ur[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ll = olproj.transform(\n        [coord.ll[0], coord.ll[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n\n      // Rounded coordinate to shorten url in get\n      coord.ul = this.roundCoordinateArray(coord.ul, epsgTO, 0);\n      coord.lr = this.roundCoordinateArray(coord.lr, epsgTO, 0);\n      coord.ur = this.roundCoordinateArray(coord.ur, epsgTO, 0);\n      coord.ll = this.roundCoordinateArray(coord.ll, epsgTO, 0);\n\n      wktPoly =\n        'POLYGON((' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        '))';\n      const wktLine =\n        'LINESTRING(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        ')';\n\n      const wktMultiPoints =\n        'MULTIPOINT(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' ')\n        ].join(',') +\n        ')';\n      return {\n        wktPoly,\n        wktLine,\n        wktMultiPoints\n      };\n    }\n  }\n}\n","<mat-checkbox\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n  (click)=\"$event.stopPropagation()\"\n  (change)=\"toggleFilterState($event)\"\n  [checked]=\"currentFilter.active\">\n</mat-checkbox>\n\n<mat-form-field\n  [ngClass]=\"{'logical': activeFilters.indexOf(currentFilter) !== 0 && currentFilter.active===true, 'logicalHidden': activeFilters.indexOf(currentFilter) === 0 || currentFilter.active!==true}\">\n  <mat-select\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.parentLogical\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.parentLogical ? (('igo.geo.operators.tooltip.'+ currentFilter.parentLogical) | translate) : ''\"\n    (selectionChange)=\"changeLogical($event.value)\">\n      <mat-option\n        [value]=ogcFilterOperator.And\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.And' | translate\">\n          {{'igo.geo.operators.And' | translate}}\n      </mat-option>\n      <mat-option\n        [value]=ogcFilterOperator.Or\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.Or' | translate\">\n          {{'igo.geo.operators.Or' | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\n  class=\"field\"\n  *ngIf=\"(currentFilterIsSpatial$ | async)===false && (fields$ | async) && (fields$| async).length > 0 && (fields$| async)[0].name !== ''\"\n  (mouseenter)=\"inputClearable = 'selectField'\"\n  (mouseleave)=\"inputClearable = undefined\"\n  [floatLabel]=\"floatLabel\">\n  <input\n  matInput\n  [placeholder]=\"'igo.geo.sourceFields.selectField' | translate\"\n  [disabled]=\"!currentFilter.active\"\n  [matAutocomplete]=\"autoCompleteField\"\n  [value]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ''\"\n  tooltip-position=\"above\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ('igo.geo.sourceFields.selectField' | translate)\"\n  (input)=\"updateFieldsList($event.target.value)\">\n  <mat-autocomplete #autoCompleteField=\"matAutocomplete\"\n  (optionSelected)='changeField($event.option.id)'>\n    <mat-option\n      *ngFor=\"let field of filteredFields$ | async\"\n      matTooltipShowDelay=\"500\"\n      [value]=\"field.alias\"\n      [id]=\"field.name\"\n      [matTooltip]=\"field.alias\">\n      {{field.alias}}\n    </mat-option>\n  </mat-autocomplete>\n  <button mat-button\n    *ngIf=\"currentFilter.propertyName && inputClearable === 'selectField' && currentFilter.active\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"clearSelectedField()\">\n        <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n</mat-form-field>\n\n\n<mat-form-field\n  [ngClass]=\"{'operator': (currentFilterIsSpatial$ | async)===false , 'dualInput': (currentFilterIsSpatial$ | async)}\"\n  [floatLabel]=\"floatLabel\">\n  <mat-select\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.operator ? (('igo.geo.operators.tooltip.'+ currentFilter.operator) | translate) : ('igo.geo.filter.selectOperator' | translate)\"\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.operator\"\n    (selectionChange)=\"changeOperator($event.value)\">\n      <mat-option\n        *ngFor=\"let operator of (ogcFilterOperators$ | async) | keyvalue\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"operator.key\"\n        [matTooltip]=\"('igo.geo.operators.tooltip.'+ operator.key) | translate\">\n          {{('igo.geo.operators.'+ operator.key) | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\nclass=\"spatialSelector\"\n*ngIf=\"currentFilterIsSpatial$ | async\">\n  <mat-select\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.igoSpatialSelector\"\n    (selectionChange)=\"changeSpatialSelector($event.value)\">\n      <mat-option\n        *ngFor=\"let igoSpatialSelector of igoSpatialSelectors\"\n        [value]=\"igoSpatialSelector.type\">\n          {{('igo.geo.spatialSelector.'+ igoSpatialSelector.type) | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\nclass=\"singleInput\"\n*ngIf=\"['expression','pattern'].indexOf(detectProperty()) !== -1\"\n(mouseenter)=\"inputClearable = 'selectProperty'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n    [disabled]=\"!currentFilter.active\"\n    [matAutocomplete]=\"autoCompleteValues\"\n    [value]=\"detectProperty() === 'expression' ? currentFilter.expression : currentFilter.pattern\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"detectProperty() === 'expression' ? currentFilter.expression || '' : currentFilter.pattern || ''\"\n    (input)=\"updateValuesList($event.target.value)\">\n  <mat-autocomplete #autoCompleteValues=\"matAutocomplete\"\n    (optionSelected)=\"changeProperty($event.option.value)\">\n    <mat-option\n      *ngFor=\"let value of filteredValues$ | async\"\n      matTooltipShowDelay=\"500\"\n      [value]=\"value\"\n      [matTooltip]=\"value\">\n      {{value}}\n    </mat-option>\n  </mat-autocomplete>\n  <button mat-button\n    *ngIf=\"isClearable() && inputClearable === 'selectProperty' && currentFilter.active\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"clearProperty()\">\n        <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n</mat-form-field>\n\n<div class=\"igo-layer-button-group\">\n  <button\n    mat-icon-button\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.filter.removeFilter' | translate\"\n    color=\"warn\"\n    (click)=\"deleteFilter()\">\n    <mat-icon svgIcon=\"delete\"></mat-icon>\n  </button>\n</div>\n\n<mat-form-field\nclass=\"snrc\"\n*ngIf=\"(currentFilterIsSpatial$ | async) && currentFilter.igoSpatialSelector === 'snrc'\"\n(mouseenter)=\"inputClearable = 'selectSNRC'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.filter.placeholderSnrc' | translate\"\n    [value]=\"currentFilter.igoSNRC\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.igoSNRC ? currentFilter.igoSNRC : ''\"\n    (input)=\"changeSNRC($event.target.value)\">\n  <button\n    mat-button\n    *ngIf=\"currentFilter.igoSNRC\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active && inputClearable === 'selectSNRC' && currentFilter.active\"\n    (click)=\"currentFilter.igoSNRC=''\">\n      <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n  </mat-form-field>\n\n  <ng-container *ngIf=\"(currentFilterIsSpatial$ | async) && currentFilter.igoSpatialSelector === 'fixedExtent'\">\n    <button\n    mat-button\n    [disabled]=\"!currentFilter.active\"\n    *ngIf=\"currentFilter.igoSpatialSelector === 'fixedExtent'\"\n    matSuffix\n    mat-icon-button\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"changeMapExtentGeometry()\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.spatialSelector.btnSetExtent' | translate\">\n      <mat-icon svgIcon=\"arrow-expand-all\"></mat-icon>\n  </button>\n</ng-container>\n\n<br/>\n\n<mat-form-field\nclass=\"dualInput\"\n*ngIf=\"!isTemporalOperator() && ['lowerBoundary','begin'].indexOf(detectProperty(1)) !== -1\"\n(mouseenter)=\"inputClearable = 'selectProperty1'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator1\"\n      type=\"number\"\n      [value]=\"detectProperty(1) === 'lowerBoundary' ? currentFilter.lowerBoundary : currentFilter.begin\"\n      (input)=\"updateValuesList($event.target.value,1)\">\n    <mat-autocomplete #autoDualValueOperator1=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value,1)\">\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\">\n        {{value}}\n      </mat-option>\n    </mat-autocomplete>\n    <button mat-button\n      *ngIf=\"isClearable(1) && inputClearable === 'selectProperty1' && currentFilter.active\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(1)\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n</mat-form-field>\n\n<mat-form-field\n  class=\"dualInput\"\n  *ngIf=\"!isTemporalOperator() && ['upperBoundary','end'].indexOf(detectProperty(2)) !== -1\"\n  (mouseenter)=\"inputClearable = 'selectProperty2'\"\n  (mouseleave)=\"inputClearable = undefined\"\n  [floatLabel]=\"floatLabel\">\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator2\"\n      type=\"number\"\n      [value]=\"detectProperty(2) === 'upperBoundary' ? currentFilter.upperBoundary : currentFilter.end\"\n      (input)=\"updateValuesList($event.target.value,2)\">\n    <mat-autocomplete #autoDualValueOperator2=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value,2)\">\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\">\n        {{value}}\n      </mat-option>\n    </mat-autocomplete>\n    <button mat-button\n      *ngIf=\"isClearable(2) && inputClearable === 'selectProperty2' && currentFilter.active\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(2)\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n</mat-form-field>\n\n<igo-ogc-filter-time *ngIf=\"isTemporalOperator()\"\n  [(datasource)]=\"datasource\"\n  [(currentFilter)]=\"currentFilter\"\n  (changeProperty)=\"changeProperty($event.value, $event.pos)\">\n</igo-ogc-filter-time>\n\n<!--\nTODO C'EST PERTINENT je crois\n<mat-form-field class=\"field\" *ngIf=\"!(currentFilterIsSpatial$ | async) && (fields$| async) && (fields$| async).length === 1 &&  (fields$| async)[0].name === ''\">\n<input [disabled]=\"!currentFilter.active\" matInput #fieldPerUser (keyup)=\"changeProperty(currentFilter,'propertyName',fieldPerUser.value)\"\n  (blur)=\"changeProperty(currentFilter,'propertyName',fieldPerUser.value)\" [(ngModel)]=\"currentFilter.propertyName\">\n<button mat-button *ngIf=\"currentFilter.propertyName\" matSuffix mat-icon-button aria-label=\"Clear\" (click)=\"currentFilter.propertyName=''\">\n  <mat-icon svgIcon=\"close\"></mat-icon>\n</button>\n</mat-form-field>\n\n\n\n<mat-checkbox labelPosition='before' (change)=\"changeCaseSensitive($event)\" [(ngModel)]=\"currentFilter.matchCase\">\n  {{('igo.geo.operators.caseSensitive') | translate}}\n</mat-checkbox>\n\n</mat-list-item> -->\n","import { Component, Input, OnInit } from '@angular/core';\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\n\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions\n} from '../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { WktService } from '../../wkt/shared/wkt.service';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\n\n@Component({\n  selector: 'igo-ogc-filter-form',\n  templateUrl: './ogc-filter-form.component.html',\n  styleUrls: ['./ogc-filter-form.component.scss']\n})\nexport class OgcFilterFormComponent implements OnInit {\n  ogcFilterOperator = OgcFilterOperator;\n  filteredValues$: Observable<string[]>;\n  filteredFields$: Observable<SourceFieldsOptionsParams[]>;\n  public allOgcFilterOperators;\n  public ogcFilterOperators$ = new BehaviorSubject<{ [key: string]: any }>(\n    undefined\n  );\n  public igoSpatialSelectors;\n  public value = '';\n  public inputOperator;\n  public selectedField$ = new BehaviorSubject<SourceFieldsOptionsParams>(\n    undefined\n  );\n  public fields$ = new BehaviorSubject<SourceFieldsOptionsParams[]>([]);\n  public color = 'primary';\n  public disabled;\n  public currentFilterIsSpatial$ = new BehaviorSubject<boolean>(false);\n  public defaultStepMillisecond = 6000;\n  public inputClearable: string;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() currentFilter: any;\n\n  set snrc(value: any) {\n    const checkSNRC50k = /^\\d{2}[a-l][0,1][0-9]$/gi;\n    const checkSNRC250k = /^\\d{2}[a-p]$/gi;\n    const checkSNRC1m = /^\\d{2}$/gi;\n    if (\n      checkSNRC1m.test(value) ||\n      checkSNRC250k.test(value) ||\n      checkSNRC50k.test(value)\n    ) {\n      this._snrc = value;\n      this.currentFilter.igoSNRC = value;\n    }\n  }\n\n  get snrc(): any {\n    return this._snrc;\n  }\n\n  private _snrc = '';\n\n  @Input() floatLabel: FloatLabelType = 'never';\n\n  get activeFilters() {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.active === true\n    );\n  }\n\n  get allowedOperators() {\n    return new OgcFilterWriter().computeAllowedOperators(\n      this.fields$.value,\n      this.currentFilter.propertyName,\n      this.datasource.options.ogcFilters.allowedOperatorsType\n    );\n  }\n\n  constructor(private wktService: WktService) {\n    // TODO: Filter permitted operator based on wfscapabilities\n    // Need to work on regex on XML capabilities because\n    // comaparison operator's name varies between WFS servers...\n    // Ex: IsNull vs PropertyIsNull vs IsNil ...\n    this.allOgcFilterOperators = new OgcFilterWriter().operators;\n    this.ogcFilterOperators$.next(this.allOgcFilterOperators);\n    this.igoSpatialSelectors = [\n      {\n        type: 'fixedExtent'\n      },\n      {\n        type: 'snrc'\n      }\n    ];\n    // TODO: selectFeature & drawFeature\n  }\n\n  ngOnInit() {\n\n    if ( this.datasource.options.sourceFields) {\n      const sFields = this.datasource.options.sourceFields.filter(\n        (sf) =>\n          sf.excludeFromOgcFilters === undefined || !sf.excludeFromOgcFilters\n      );\n      sFields.map((sfs) => {\n        if (sfs.values) {\n          sfs.values.sort();\n        }\n      });\n      this.fields$.next(sFields);\n    }\n\n    this.updateFieldsList();\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.updateValuesList();\n    this.selectedField$.subscribe((f) => {\n      this.ogcFilterOperators$.next(this.allowedOperators);\n      if (\n        Object.keys(this.allowedOperators).indexOf(\n          this.currentFilter.operator\n        ) === -1\n      ) {\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n      }\n      this.updateValuesList();\n    });\n    this.currentFilterIsSpatial();\n  }\n\n  updateFieldsList(value?: string) {\n    this.filteredFields$ =\n      value && value.length > 0 ? of(this._filterFields(value)) : this.fields$;\n    if (this.fields$.value.find((f) => f.name === value)) {\n      this.changeField(value);\n    }\n  }\n\n  updateValuesList(value?: string, pos?: number) {\n    this.filteredValues$ =\n      value && value.length > 0\n        ? of(this._filterValues(value))\n        : this.selectedField$.value\n        ? of(this.selectedField$.value.values)\n        : of([]);\n    if (value && value.length >= 1) {\n      this.changeProperty(value, pos);\n    }\n  }\n\n  private _filterFields(value: string): SourceFieldsOptionsParams[] {\n    const keywordRegex = new RegExp(\n      value.normalize('NFD').replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n    return this.fields$.value.filter((val) =>\n      keywordRegex.test(\n        val.alias.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\n      )\n    );\n  }\n\n  private _filterValues(value: string): string[] {\n    const keywordRegex = new RegExp(\n      value\n        .toString()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n    return this.selectedField$.value.values.filter((val) =>\n      val && keywordRegex.test(\n        val\n          .toString()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '')\n      )\n    );\n  }\n\n  clearSelectedField() {\n    this.currentFilter.propertyName = '';\n    this.selectedField$.next(undefined);\n    this.clearProperty();\n  }\n\n  isClearable(pos?: number) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return this.currentFilter[detectedProperty];\n    }\n  }\n  clearProperty(pos?: number) {\n    // this.autoCompleteInputValues.closePanel();\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return (this.currentFilter[detectedProperty] = '');\n    }\n  }\n\n  toggleFilterState(event) {\n    this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    ).active = event.checked;\n    this.refreshFilters();\n  }\n\n  deleteFilter() {\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    ogcFilters.interfaceOgcFilters = ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.filterid !== this.currentFilter.filterid\n    );\n    this.refreshFilters();\n  }\n\n  changeLogical(logical: string) {\n    this.currentFilter.parentLogical = logical;\n    this.refreshFilters();\n  }\n\n  changeOperator(operator: string) {\n    this.currentFilter.operator = operator;\n    this.currentFilterIsSpatial();\n\n    if (\n      this.currentFilterIsSpatial$.value &&\n      this.currentFilter.wkt_geometry.length === 0\n    ) {\n      this.changeSpatialSelector(this.currentFilter.igoSpatialSelector);\n    } else {\n      this.refreshFilters();\n    }\n  }\n\n  changeField(field: string) {\n    this.currentFilter.propertyName = field;\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.refreshFilters();\n  }\n\n  // Issue with mapserver 7.2 and Postgis layers. Fixed in 7.4\n  // Due to this issue, the checkbox is hide.\n  changeCaseSensitive(matchCase) {\n    this.currentFilter.matchCase = matchCase.checked;\n    this.refreshFilters();\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (f) => f.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if ( refreshFilter ) {\n        this.refreshFilters();\n      }\n    }\n  }\n\n  changeNumericProperty(value, pos: number) {\n    this.changeProperty(parseFloat(value), pos);\n  }\n\n  changeSpatialSelector(value: any) {\n    this.currentFilter.igoSpatialSelector = value;\n\n    if (value === 'fixedExtent') {\n      this.changeMapExtentGeometry(false);\n    }\n    this.currentFilterIsSpatial();\n    this.refreshFilters();\n  }\n\n  changeSNRC(value: any) {\n    this.snrc = value;\n    this.changeSNRCGeometry();\n  }\n\n  changeSNRCGeometry() {\n    const interfaceOgcFilter = this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.snrc && this.currentFilter.igoSpatialSelector === 'snrc') {\n      this.currentFilter.wkt_geometry = this.wktService.snrcToWkt(\n        this.snrc,\n        this.map.projection\n      ).wktPoly;\n    }\n    this.refreshFilters();\n  }\n\n  changeMapExtentGeometry(refresh: boolean = true) {\n    const interfaceOgcFilter = this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.currentFilter.igoSpatialSelector === 'fixedExtent') {\n      this.currentFilter.wkt_geometry = this.wktService.extentToWkt(\n        this.map.projection,\n        this.map.viewController.getExtent(),\n        this.map.projection\n      ).wktPoly;\n    }\n    if (refresh) {\n      this.refreshFilters();\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n          ? 'upperBoundary'\n          : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n          ? 'end'\n          : undefined;\n      default:\n        return;\n    }\n  }\n\n  private currentFilterIsSpatial() {\n    let isSpatial = false;\n    if (this.currentFilter) {\n      isSpatial =\n        [\n          OgcFilterOperator.Contains,\n          OgcFilterOperator.Intersects,\n          OgcFilterOperator.Within\n        ].indexOf(this.currentFilter.operator) !== -1;\n    }\n    this.currentFilterIsSpatial$.next(isSpatial);\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter.operator.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n}\n","<igo-ogc-filter-selection\n  *ngIf=\"!advancedOgcFilters\"\n  igoListItem\n  [refreshFilters]=\"refreshFunc\"\n  [datasource]=\"datasource\"\n  [map]=\"map\"\n  [currentFilter]=\"currentFilter\">\n</igo-ogc-filter-selection>\n\n<ng-template \n*ngIf=\"advancedOgcFilters && datasource.options.ogcFilters.editable\"\nngFor let-currentFilter \n[ngForOf]=\"datasource.options.ogcFilters.interfaceOgcFilters\">\n<igo-ogc-filter-form\n  [currentFilter]=\"currentFilter\"\n  [refreshFilters]=\"refreshFunc\"\n  [datasource]=\"datasource\"\n  [map]=\"map\">\n</igo-ogc-filter-form>\n</ng-template>","import { Component, Input } from '@angular/core';\nimport { OgcFilterableDataSource } from '../shared/ogc-filter.interface';\nimport { IgoMap } from '../../map';\n\n@Component({\n  selector: 'igo-ogc-filterable-form',\n  templateUrl: './ogc-filterable-form.component.html'\n})\nexport class OgcFilterableFormComponent {\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() refreshFilters: () => void;\n\n  get refreshFunc() {\n    return this.refreshFilters;\n  }\n\n  get advancedOgcFilters(): boolean {\n    if (this.datasource.options.ogcFilters) {\n      return this.datasource.options.ogcFilters.advancedOgcFilters;\n    }\n    return;\n  }\n\n  get currentFilter(): any {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters ?\n    this.datasource.options.ogcFilters.interfaceOgcFilters[0] : undefined;\n  }\n\n  public color = 'primary';\n\n  constructor() {}\n}\n","<mat-list-item>\n\n  <mat-icon\n    *ngIf=\"header\"\n    class=\"igo-chevron\"\n    mat-list-avatar\n    igoCollapse [target]=\"ogcFilters\"\n    [collapsed]=\"filtersCollapsed\"\n    (click)=\"toggleFiltersCollapsed()\"\n    svgIcon=\"chevron-up\">\n  </mat-icon>\n  <h4 (click)=\"toggleLegendOnClick()\" *ngIf=\"header\" [ngStyle]=\"{'cursor': filtersCollapsed ? 'default' : 'pointer'}\" matLine [matTooltip]=\"layer.title\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n    <button *ngIf=\"isAdvancedOgcFilters() && filtersAreEditable\" [disabled]=\"addFilterDisabled()\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.filter.addFilter' | translate\" [color]=\"color\" (click)=\"addFilterToSequence()\">\n      <mat-icon svgIcon=\"plus\"></mat-icon>\n    </button>\n    <button *ngIf=\"header\"\n      mat-icon-button\n      [color]=\"layer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"layer.visible ?\n                    ('igo.geo.layer.hideLayer' | translate) :\n                    ('igo.geo.layer.showLayer' | translate)\"\n      (click)=\"layer.visible = !layer.visible\">\n      <mat-icon\n        [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n        [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n      </mat-icon>\n    </button>\n</mat-list-item>\n\n<div #ogcFilters>\n    <div *ngIf=\"header\" #legend class=\"igo-layer-legend-container\">\n      <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n      </igo-layer-legend>\n    </div>\n  <igo-ogc-filterable-form [datasource]=\"datasource\" [map]=\"map\" [refreshFilters]=\"refreshFunc\">\n  </igo-ogc-filterable-form>\n\n  <section *ngIf=\"hasSelector && filtersAreEditable\" class=\"mat-typography advancedOgcFilters\">\n    <mat-divider></mat-divider>\n    <mat-checkbox labelPosition='before' (change)=\"changeOgcFilterType($event)\"\n      [(ngModel)]=\"datasource.options.ogcFilters.advancedOgcFilters\">\n      {{'igo.geo.filter.advancedOgcFilters' | translate}}\n    </mat-checkbox>\n  </section>\n</div>","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { WFSDataSourceOptionsParams } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\n\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions,\n  OgcInterfaceFilterOptions\n} from '../shared/ogc-filter.interface';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\nimport { IgoMap } from '../../map';\nimport { OgcFilterWriter } from '../shared/ogc-filter';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n@Component({\n  selector: 'igo-ogc-filterable-item',\n  templateUrl: './ogc-filterable-item.component.html',\n  styleUrls: ['./ogc-filterable-item.component.scss']\n})\nexport class OgcFilterableItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  private lastRunOgcFilter;\n  private defaultLogicalParent = OgcFilterOperator.And;\n  public hasActiveSpatialFilter = false;\n  public filtersAreEditable = true;\n  public filtersCollapsed = true;\n  public hasSelector: boolean = false;\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n  private ogcFilterWriter;\n\n  @Input() layer: Layer;\n\n  @Input() map: IgoMap;\n\n  @Input() header: boolean = true;\n\n  get refreshFunc() {\n    return this.refreshFilters.bind(this);\n  }\n\n  get datasource(): OgcFilterableDataSource {\n    return this.layer.dataSource as OgcFilterableDataSource;\n  }\n\n  constructor(private ogcFilterService: OGCFilterService) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n  }\n\n  ngOnInit() {\n    const ogcFilters = this.datasource.options.ogcFilters;\n    if (\n      (ogcFilters.pushButtons && ogcFilters.pushButtons.bundles.length > 0) ||\n      (ogcFilters.checkboxes && ogcFilters.checkboxes.bundles.length > 0) ||\n      (ogcFilters.radioButtons && ogcFilters.radioButtons.bundles.length > 0) ||\n      (ogcFilters.select && ogcFilters.select.bundles.length > 0)) {\n      if (ogcFilters.advancedOgcFilters === undefined) {\n        ogcFilters.advancedOgcFilters = false;\n      }\n      this.hasSelector = true;\n    }\n\n    switch (this.datasource.options.type) {\n      case 'wms':\n        this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);\n        break;\n      case 'wfs':\n        this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource);\n        break;\n      default:\n        break;\n    }\n\n    if (ogcFilters) {\n      if (ogcFilters.interfaceOgcFilters) {\n        this.lastRunOgcFilter = JSON.parse(\n          JSON.stringify(ogcFilters.interfaceOgcFilters)\n        );\n        if (\n          ogcFilters.interfaceOgcFilters.filter(f => f.wkt_geometry).length >= 1\n        ) {\n          this.hasActiveSpatialFilter = true;\n        }\n      }\n\n      this.filtersAreEditable = ogcFilters.editable\n        ? ogcFilters.editable\n        : false;\n    }\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  addFilterToSequence() {\n    this.filtersCollapsed = false;\n    const interfaceOgcFilters: OgcInterfaceFilterOptions[] = this.datasource\n      .options.ogcFilters.interfaceOgcFilters;\n    const arr = interfaceOgcFilters || [];\n    const lastLevel = arr.length === 0 ? 0 : arr[arr.length - 1].level;\n    let firstFieldName = '';\n    const includedFields = this.datasource.options.sourceFields.filter(f => !f.excludeFromOgcFilters);\n    if (includedFields.length > 0) {\n      firstFieldName =\n        includedFields[0].name === undefined ? '' : includedFields[0].name;\n    }\n    let fieldNameGeometry;\n    const datasourceOptions = this.datasource\n      .options as WFSDataSourceOptionsParams;\n    if (datasourceOptions.fieldNameGeometry) {\n      fieldNameGeometry = datasourceOptions.fieldNameGeometry;\n    } else if (\n      (this.datasource.options as any).paramsWFS &&\n      (this.datasource.options as any).paramsWFS.fieldNameGeometry\n    ) {\n      fieldNameGeometry = (this.datasource.options as any).paramsWFS\n        .fieldNameGeometry;\n    }\n    const allowedOperators = this.ogcFilterWriter.computeAllowedOperators(\n      this.datasource.options.sourceFields,\n      firstFieldName,\n      this.datasource.options.ogcFilters.allowedOperatorsType);\n    const firstOperatorName = Object.keys(allowedOperators)[0];\n\n    arr.push(\n      this.ogcFilterWriter.addInterfaceFilter(\n        {\n          propertyName: firstFieldName,\n          operator: firstOperatorName,\n          active: true,\n          igoSpatialSelector: 'fixedExtent',\n          srsName: this.map.projection,\n        } as OgcInterfaceFilterOptions,\n        fieldNameGeometry,\n        lastLevel,\n        this.defaultLogicalParent\n      )\n    );\n    this.datasource.options.ogcFilters.interfaceOgcFilters = arr;\n  }\n\n  refreshFilters(force?: boolean) {\n    if (force === true) {\n      this.lastRunOgcFilter = undefined;\n    }\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    const activeFilters = ogcFilters.interfaceOgcFilters ?\n      ogcFilters.interfaceOgcFilters.filter(f => f.active === true) : [];\n    if (activeFilters.length === 0) {\n      ogcFilters.filters = undefined;\n      ogcFilters.filtered = false;\n    }\n    if (activeFilters.length > 1) {\n      activeFilters[0].parentLogical = activeFilters[1].parentLogical;\n    }\n    if (\n      activeFilters.filter(\n        af => ['Contains', 'Intersects', 'Within'].indexOf(af.operator) !== -1\n      ).length === 0\n    ) {\n      this.hasActiveSpatialFilter = false;\n    } else {\n      this.hasActiveSpatialFilter = true;\n    }\n\n    if (\n      !(JSON.stringify(this.lastRunOgcFilter) === JSON.stringify(activeFilters))\n    ) {\n      if (this.layer.dataSource.options.type === 'wfs') {\n        const ogcDataSource: any = this.layer.dataSource;\n        const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n        ogcLayer.filters = this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n          activeFilters\n        );\n        this.layer.dataSource.ol.refresh();\n      } else if (\n        this.layer.dataSource.options.type === 'wms' &&\n        ogcFilters.enabled\n      ) {\n        let rebuildFilter = '';\n        if (activeFilters.length >= 1) {\n          const ogcDataSource: any = this.layer.dataSource;\n          const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n          ogcLayer.filters = this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n            activeFilters\n          );\n          rebuildFilter = this.ogcFilterWriter.buildFilter(\n            ogcLayer.filters,\n            undefined,\n            undefined,\n            (this.layer.dataSource.options as any).fieldNameGeometry,\n            ogcDataSource.options\n          );\n        }\n        this.ogcFilterService.filterByOgc(\n          this.datasource as WMSDataSource,\n          rebuildFilter\n        );\n        this.datasource.options.ogcFilters.filtered =\n          activeFilters.length === 0 ? false : true;\n      }\n\n      this.lastRunOgcFilter = JSON.parse(JSON.stringify(activeFilters));\n    } else {\n      // identical filter. Nothing triggered\n    }\n    (this.layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  public isAdvancedOgcFilters(): boolean {\n    return this.datasource.options.ogcFilters.advancedOgcFilters;\n  }\n\n  public addFilterDisabled(): boolean {\n    return (\n      !this.datasource.options.sourceFields ||\n      this.datasource.options.sourceFields.length === 0\n    );\n  }\n\n  private changeOgcFiltersAdvancedOgcFilters(value: boolean) {\n    this.datasource.options.ogcFilters.advancedOgcFilters = value;\n  }\n\n  changeOgcFilterType(isAdvancedOgcFilters) {\n    this.changeOgcFiltersAdvancedOgcFilters(isAdvancedOgcFilters.checked);\n    if (isAdvancedOgcFilters.checked) {\n      this.refreshFilters(true);\n    }\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'ogc'\">\n    <igo-ogc-filterable-item igoListItem [header]=\"true\" [layer]=\"layer\" \n    [map]=\"layer.map\" ></igo-ogc-filterable-item>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\n\n@Component({\n  selector: 'igo-ogc-filterable-list',\n  templateUrl: './ogc-filterable-list.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterableListComponent {\n\n  @Input() layers: Layer[];\n\n  @Input() map: IgoMap;\n\n  constructor() {}\n}\n","<button\n  *ngIf=\"header && options.ogcFilters && options.ogcFilters.enabled &&\n  (options.ogcFilters.pushButtons || options.ogcFilters.checkboxes || options.ogcFilters.radioButtons || options.ogcFilters.select || options.ogcFilters.editable)\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\">\n  <mat-icon [matBadge]=\"badge\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" svgIcon=\"filter\"></mat-icon>\n</button>\n\n<div #ogcFilter class=\"igo-layer-actions-container\"\n*ngIf=\"options.ogcFilters && options.ogcFilters.enabled &&\n(options.ogcFilters.pushButtons || options.ogcFilters.checkboxes || options.ogcFilters.radioButtons || options.ogcFilters.select || options.ogcFilters.editable)\">\n  <igo-ogc-filterable-item\n    *ngIf=\"ogcFilterCollapse && options.ogcFilters.enabled\"\n    igoListItem\n    [header]=\"false\"\n    [map]=\"layer.map\"\n    [layer]=\"layer\">\n  </igo-ogc-filterable-item>\n</div>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\nimport { OgcFilterableDataSourceOptions, IgoOgcSelector } from '../shared/ogc-filter.interface';\n\n@Component({\n  selector: 'igo-ogc-filter-button',\n  templateUrl: './ogc-filter-button.component.html',\n  styleUrls: ['./ogc-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterButtonComponent implements OnInit {\n\n  public options: OgcFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.ogcFilters as any;\n    let cnt = 0;\n    if (filter && !filter.advancedOgcFilters) {\n      if (filter.pushButtons) {\n        const pushButtons = filter.pushButtons as IgoOgcSelector;\n        const currentPushButtonGroup = pushButtons.groups.find(gr => gr.enabled);\n        let cntPushButtons = 0;\n        if (currentPushButtonGroup) {\n          currentPushButtonGroup.computedSelectors.map(cb => cntPushButtons += (cb.selectors as any).filter(\n            button => button.enabled).length);\n        }\n        cnt += cntPushButtons;\n      }\n      if (filter.checkboxes) {\n        const checkboxes = filter.checkboxes as IgoOgcSelector;\n        const currentCheckboxGroup = checkboxes.groups.find(gr => gr.enabled);\n        let cntCheckboxes = 0;\n        if (currentCheckboxGroup) {\n          currentCheckboxGroup.computedSelectors.map(cb => cntCheckboxes += (cb.selectors as any).filter(\n            checkbox => checkbox.enabled).length);\n        }\n        cnt += cntCheckboxes;\n      }\n      if (filter.radioButtons) {\n        const radioButtons = filter.radioButtons as IgoOgcSelector;\n        const currentRadioButtonsGroup = radioButtons.groups.find(gr => gr.enabled);\n        let cntRadioButtons = 0;\n        if (currentRadioButtonsGroup) {\n          currentRadioButtonsGroup.computedSelectors.map(cb => cntRadioButtons += (cb.selectors as any).filter(\n            radio => radio.enabled).length);\n        }\n        cnt += cntRadioButtons;\n      }\n      if (filter.select) {\n        const select = filter.select as IgoOgcSelector;\n        const currentSelectGroup = select.groups.find(gr => gr.enabled);\n        let cntSelect = 0;\n        if (currentSelectGroup) {\n          currentSelectGroup.computedSelectors.map(cb => cntSelect += (cb.selectors as any).filter(\n            multi => multi.enabled).length);\n        }\n        cnt += cntSelect;\n      }\n    } else if (filter && filter.filters && !filter.filters.filters) {\n      return 1;\n    } else if (filter && filter.filters && filter.filters.filters) {\n      return filter.filters.filters.length;\n    }\n    return cnt > 0 ? cnt : undefined;\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource.options as OgcFilterableDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: IgoMap;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean;\n\n  public ogcFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource.options as OgcFilterableDataSourceOptions;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport * as moment_ from 'moment';\nconst moment = moment_;\n\nimport {\n    OgcFilterableDataSource\n  } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterTimeService {\n\n    readonly defaultStepMillisecond = 60000;\n\n    constructor() {}\n\n    step(datasource: OgcFilterableDataSource, currentFilter): string {\n    return datasource.options.stepDate\n      ? datasource.options.stepDate\n      : currentFilter.step;\n    }\n\n    stepMillisecond(dataSource: OgcFilterableDataSource, currentFilter): number {\n        const step = moment.duration(this.step(dataSource, currentFilter)).asMilliseconds();\n        return step === 0 ? this.defaultStepMillisecond : step;\n    }\n\n    stepIsYearDuration(step: string) {\n        const year = moment.duration(step);\n        return (\n            year.years() !== 0 &&\n            year.months() === 0 &&\n            year.weeks() === 0 &&\n            year.days() === 0 &&\n            year.hours() === 0 &&\n            year.minutes() === 0\n        );\n    }\n\n    stepIsMonthDuration(step: string) {\n        const month = moment.duration(step);\n        return (\n            month.months() !== 0 &&\n            month.weeks() === 0 &&\n            month.days() === 0 &&\n            month.hours() === 0 &&\n            month.minutes() === 0\n        );\n    }\n\n    stepIsWeekDuration(step: string) {\n        const week = moment.duration(step);\n        return (\n            week.weeks() !== 0 &&\n            week.days() === 7 &&\n            week.hours() === 0 &&\n            week.minutes() === 0\n        );\n    }\n\n    stepIsDayDuration(step: string) {\n        const day = moment.duration(step);\n        return day.days() !== 0 && day.hours() === 0 && day.minutes() === 0;\n    }\n\n    stepIsHourDuration(step: string) {\n        const hour = moment.duration(step);\n        return hour.hours() !== 0 && hour.minutes() === 0;\n    }\n\n    stepIsMinuteDuration(step: string) {\n        const minute = moment.duration(step);\n        return minute.minutes() !== 0;\n    }\n\n    dateToNumber(date: Date): number {\n        let newDate = new Date();\n        if (date) {\n          newDate = new Date(date);\n        }\n        return newDate.getTime();\n    }\n\n    public addStep(value, stepMillisecond) {\n        return moment(value).add(stepMillisecond, 'milliseconds').toDate();\n    }\n\n    public subtractStep(value, stepMillisecond) {\n        return moment(value).subtract(stepMillisecond, 'milliseconds').toDate();\n    }\n}\n","<form [formGroup]=\"form\">\n  <div *ngFor=\"let selector of ogcFiltersSelectors\">\n    <div class=\"pushButtonGroups\" *ngIf=\"selector.selectorType === 'pushButton'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getPushButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"pushButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentPushButtonsGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getPushButtonsGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentPushButtonsGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <mat-button-toggle-group\n          formControlName=\"pushButtons\" class=\"mat-typography\" appearance=\"legacy\" vertical={{bundleIsVertical(bundle)}} multiple=\"true\">\n          <mat-button-toggle *ngFor=\"let ogcPushButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcPushButton)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\" matTooltipClass=\"material-tooltip\"\n            [ngStyle]=\"getButtonColor(ogcPushButton)\"\n            [checked]=\"ogcPushButton.enabled\" (change)=\"onSelectionChange(ogcPushButton, selector.selectorType)\"\n            [value]=\"ogcPushButton\">{{ogcPushButton.title}}\n          </mat-button-toggle>\n        </mat-button-toggle-group>\n      </ng-container>\n    </div>\n\n    <div class=\"checkboxGroups\" *ngIf=\"selector.selectorType === 'checkbox'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getCheckboxesGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"checkboxesGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentCheckboxesGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getCheckboxesGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentCheckboxesGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <div class=\"checkboxes mat-typography\">\n          <mat-checkbox *ngFor=\"let ogcCheckbox of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcCheckbox)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcCheckbox.enabled\" (change)=\"onSelectionChange(ogcCheckbox, selector.selectorType)\"\n            [value]=\"ogcCheckbox\">{{ogcCheckbox.title}}\n          </mat-checkbox>\n        </div>\n        <p *ngIf=\"isLessResults(bundle, 'checkbox') || isMoreResults(bundle, 'checkbox')\">\n          <u *ngIf=\"isLessResults(bundle, 'checkbox')\"\n            class=\"lessResults mat-typography\"\n            (click)=\"displayLessResults('checkbox')\">{{ 'igo.geo.filter.displayLessResults' | translate }}\n          </u>\n          <u *ngIf=\"isMoreResults(bundle, 'checkbox')\"\n            class=\"moreResults mat-typography\"\n            (click)=\"displayMoreResults('checkbox')\">{{ 'igo.geo.filter.displayMoreResults' | translate }}\n          </u>\n        </p>\n      </ng-container>\n    </div>\n\n    <div class=\"radioButtonGroups\" *ngIf=\"selector.selectorType === 'radioButton'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getRadioButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"radioButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentRadioButtonsGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getRadioButtonsGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentRadioButtonsGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <mat-radio-group\n          formControlName=\"radioButtons\" class=\"mat-typography\">\n          <mat-radio-button *ngIf=\"bundle.unfiltered\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            (change)=\"emptyRadioButtons()\">{{ 'igo.geo.filter.resetFilters' | translate }}\n          </mat-radio-button>\n          <mat-radio-button *ngFor=\"let ogcRadioButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcRadioButton)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcRadioButton.enabled\" (change)=\"onSelectionChange(ogcRadioButton, selector.selectorType)\"\n            [value]=\"ogcRadioButton\">{{ogcRadioButton.title}}\n          </mat-radio-button>\n          <p *ngIf=\"isLessResults(bundle, 'radio') || isMoreResults(bundle, 'radio')\">\n            <u *ngIf=\"isLessResults(bundle, 'radio')\"\n              class=\"lessResults mat-typography\"\n              (click)=\"displayLessResults('radio')\">{{ 'igo.geo.filter.displayLessResults' | translate }}\n            </u>\n            <u *ngIf=\"isMoreResults(bundle, 'radio')\"\n              class=\"moreResults mat-typography\"\n              (click)=\"displayMoreResults('radio')\">{{ 'igo.geo.filter.displayMoreResults' | translate }}\n            </u>\n          </p>\n        </mat-radio-group>\n      </ng-container>\n    </div>\n\n    <div class=\"selectGroups\" *ngIf=\"selector.selectorType === 'select'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getSelectGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"selectGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentSelectGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getSelectGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentSelectGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <div class=\"groupsSelector\">\n          <mat-button *ngIf=\"bundle.unfiltered && !bundle.multiple\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            (click)=\"emptySelect()\">\n            <mat-icon svgIcon=\"filter-remove\"></mat-icon>\n          </mat-button>\n          <mat-form-field>\n            <div *ngIf=\"bundle.multiple; else notMulti\">\n              <mat-select\n                #selection [multiple]=\"bundle.multiple\" [placeholder]=\"bundle.title\"\n                [formControl]=\"select\" [(ngModel)]=\"enableds\">\n                <div class=\"checkboxes mat-typography\">\n                  <mat-checkbox *ngIf=\"bundle.multiple\"\n                    [(ngModel)]=\"allSelected\" [ngModelOptions]=\"{standalone: true}\"\n                    (change)=\"toggleAllSelection()\">Tous\n                  </mat-checkbox>\n                </div>\n                <mat-option *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\" tooltip-position=\"below\" matTooltipDelay=\"500\" matTooltipClass=\"material-tooltip\"\n                  (onSelectionChange)=\"optionClick()\"\n                  [value]=\"ogcSelect\">{{ogcSelect.title}}\n                </mat-option>\n              </mat-select>\n            </div>\n            <ng-template #notMulti>\n              <mat-select\n                [placeholder]=\"bundle.title\"\n                [formControl]=\"select\" [(ngModel)]=\"enabled\">\n                <mat-option *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\" tooltip-position=\"below\" matTooltipDelay=\"500\" matTooltipClass=\"material-tooltip\"\n                  [value]=\"ogcSelect\">{{ogcSelect.title}}\n                </mat-option>\n              </mat-select>\n            </ng-template>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n  </div>\n</form>\n\n<div *ngIf=\"isTemporalOperator()\">\n  <mat-divider></mat-divider>\n  <h4>{{ 'igo.geo.filter.reportingDate' | translate }}</h4>\n  <igo-ogc-filter-time\n    [(datasource)]=\"datasource\"\n    [(currentFilter)]=\"currentFilter\"\n    (changeProperty)=\"changeProperty($event.value, $event.pos)\">\n  </igo-ogc-filter-time>\n</div>","import {\n  Component,\n  Input,\n  OnInit,\n  ViewChild\n} from '@angular/core';\n\nimport {\n  OgcFilterableDataSource,\n  IgoOgcFilterObject,\n  OgcPushButton,\n  OgcSelectorBundle,\n  SelectorGroup\n\n} from '../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { IgoMap } from '../../map';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { FormBuilder, FormControl, FormGroup, Validators } from '@angular/forms';\nimport { debounceTime } from 'rxjs/operators';\nimport { OgcFilterOperator } from '../shared/ogc-filter.enum';\nimport { MatSelect } from '@angular/material/select';\nimport { MatOption } from '@angular/material/core';\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'igo-ogc-filter-selection',\n  templateUrl: './ogc-filter-selection.component.html',\n  styleUrls: ['./ogc-filter-selection.component.scss']\n})\nexport class OgcFilterSelectionComponent implements OnInit {\n\n  @ViewChild('selection') sel: MatSelect;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() checkboxesIndex = 5;\n  @Input() radioButtonsIndex = 5;\n  @Input() baseIndex = 5;\n\n  @Input()\n  get currentFilter(): any {\n    return this._currentFilter;\n  }\n  set currentFilter(value) {\n    this._currentFilter = value;\n    if (this._currentFilter?.sliderOptions) {\n      this._currentFilter.sliderOptions.enabled = false; // remove slider toggle (animation temporelle)\n    }\n  }\n  private _currentFilter: any;\n\n  public ogcFilterOperator = OgcFilterOperator;\n\n  public form: FormGroup;\n  private ogcFilterWriter: OgcFilterWriter;\n  public color = 'primary';\n  public allSelected = false;\n  public select = new FormControl();\n  public enabled$ = new BehaviorSubject(undefined);\n  public enableds$ = new BehaviorSubject([]);\n\n  public applyFiltersTimeout;\n\n  get ogcFiltersSelectors() {\n    const ogcSelector = [];\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.pushButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.checkboxes);\n    }\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.radioButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.select) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.select);\n    }\n    ogcSelector.sort((a, b) => {\n      if (a.order < b.order) {\n        return -1;\n      }\n      if (a.order > b.order) {\n        return 1;\n      }\n      return 0;\n    });\n    return ogcSelector;\n  }\n\n  get currentPushButtonsGroup() {\n    return this.form.get('pushButtonsGroup').value;\n  }\n  set currentPushButtonsGroup(value) {\n    this.form.patchValue({ pushButtonsGroup: value });\n  }\n\n  get currentCheckboxesGroup() {\n    return this.form.get('checkboxesGroup').value;\n  }\n  set currentCheckboxesGroup(value) {\n    this.form.patchValue({ checkboxesGroup: value });\n  }\n\n  get currentRadioButtonsGroup() {\n    return this.form.get('radioButtonsGroup').value;\n  }\n  set currentRadioButtonsGroup(value) {\n    this.form.patchValue({ radioButtonsGroup: value });\n  }\n\n  get currentSelectGroup() {\n    return this.form.get('selectGroup').value;\n  }\n  set currentSelectGroup(value) {\n    this.form.patchValue({ selectGroup: value });\n  }\n\n  get enabled() {\n    return this.enabled$.value;\n  }\n\n  set enabled(value) {\n    this.enabled$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors.forEach(selector => {\n        value === selector ? selector.enabled = true : selector.enabled = false;\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  get enableds() {\n    return this.enableds$.value;\n  }\n\n  set enableds(value) {\n    this.enableds$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors.forEach(selector => {\n        value.includes(selector) ? selector.enabled = true : selector.enabled = false;\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  constructor(\n    private ogcFilterService: OGCFilterService,\n    private formBuilder: FormBuilder,\n  ) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n    this.buildForm();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      pushButtons: ['', [Validators.required]],\n      radioButtons: ['', [Validators.required]],\n      pushButtonsGroup: ['', [Validators.required]],\n      checkboxesGroup: ['', [Validators.required]],\n      radioButtonsGroup: ['', [Validators.required]],\n      selectGroup: ['', [Validators.required]],\n    });\n  }\n\n  getPushButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      return this.datasource.options.ogcFilters.pushButtons.groups;\n    }\n  }\n\n  getCheckboxesGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      return this.datasource.options.ogcFilters.checkboxes.groups;\n    }\n  }\n\n  getRadioButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      return this.datasource.options.ogcFilters.radioButtons.groups;\n    }\n  }\n\n  getSelectGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.select) {\n      return this.datasource.options.ogcFilters.select.groups;\n    }\n  }\n\n  ngOnInit() {\n    if (this.datasource.options.ogcFilters) {\n      if (this.datasource.options.ogcFilters.pushButtons) {\n        this.currentPushButtonsGroup =\n          this.datasource.options.ogcFilters.pushButtons.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.pushButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.checkboxes) {\n        this.currentCheckboxesGroup =\n          this.datasource.options.ogcFilters.checkboxes.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.checkboxes.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.radioButtons) {\n        this.currentRadioButtonsGroup =\n          this.datasource.options.ogcFilters.radioButtons.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.radioButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.select) {\n        this.currentSelectGroup =\n          this.datasource.options.ogcFilters.select.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.select.groups[0];\n        this.getSelectEnabled();\n      }\n      this.applyFilters();\n    }\n\n    this.form\n    .get('pushButtonsGroup')\n    .valueChanges\n    .pipe(debounceTime(750))\n    .subscribe(() => {\n      this.onPushButtonsChangeGroup();\n      this.applyFilters();\n      });\n    this.form\n    .get('checkboxesGroup')\n    .valueChanges\n    .pipe(debounceTime(750))\n    .subscribe(() => {\n      this.onCheckboxesChangeGroup();\n      this.applyFilters();\n      });\n    this.form\n      .get('radioButtonsGroup')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onRadioButtonsChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('selectGroup')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onSelectChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('pushButtons')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n    this.form\n      .get('radioButtons')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n  }\n\n  private getSelectEnabled() {\n    const enableds = [];\n    let enabled;\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      if (compSelect.multiple) {\n        compSelect.selectors.forEach(selector => {\n          if (selector.enabled) {\n            enableds.push(selector);\n          }\n        });\n        this.enableds = enableds;\n      } else {\n        compSelect.selectors.forEach(selector => {\n          if (selector.enabled) {\n            enabled = selector;\n          }\n        });\n        this.enabled = enabled;\n      }\n    });\n  }\n\n  getToolTip(selector): string {\n    let toolTip;\n    if (selector.tooltip) {\n      if (Array.isArray(selector.tooltip)) {\n        toolTip = selector.tooltip.join('\\n');\n      } else {\n        toolTip = selector.tooltip;\n      }\n    }\n    return toolTip || '';\n  }\n\n  // getButtonStyle(pb: OgcPushButton): {} {\n\n  //   let styles;\n  //   if (pb.color) {\n  //     styles = {\n  //       'background-color': pb.enabled ? `rgba(${pb.color})` : `rgba(255,255,255,0)`\n  //     };\n  //   } else {\n  //     styles = {\n  //       'background-color': pb.enabled ? 'accent': `rgba(255,255,255,0)`,\n  //       'color': pb.enabled ? `rgba(0,0,0,0.9)` : `rgba(33,33,33,0.38)`\n  //     }\n  //   }\n  //   return styles;\n  // }\n\n  getButtonColor(pushButton: OgcPushButton): {} {\n    let styles;\n    if (pushButton.color && pushButton.enabled) {\n      styles = {\n        'background-color': `rgba(${pushButton.color})`\n      };\n    }\n    return styles;\n  }\n\n  bundleIsVertical(bundle: OgcSelectorBundle): boolean {\n    return bundle.vertical ? bundle.vertical : false;\n  }\n\n  private onPushButtonsChangeGroup() {\n    this.getPushButtonsGroups().map(group => group.enabled = false);\n    this.getPushButtonsGroups().find(group => group === this.currentPushButtonsGroup).enabled = true;\n  }\n\n  private onCheckboxesChangeGroup() {\n    this.getCheckboxesGroups().map(group => group.enabled = false);\n    this.getCheckboxesGroups().find(group => group === this.currentCheckboxesGroup).enabled = true;\n  }\n\n  private onRadioButtonsChangeGroup() {\n    this.getRadioButtonsGroups().map(group => group.enabled = false);\n    this.getRadioButtonsGroups().find(group => group === this.currentRadioButtonsGroup).enabled = true;\n  }\n\n  private onSelectChangeGroup() {\n    this.getSelectGroups().map(group => group.enabled = false);\n    this.getSelectGroups().find(group => group === this.currentSelectGroup).enabled = true;\n  }\n\n  onSelectionChange(currentOgcSelection?, selectorType?) {\n    clearTimeout(this.applyFiltersTimeout);\n    if (selectorType === 'radioButton') {\n      this.emptyRadioButtons();\n    }\n\n    if (currentOgcSelection) {\n      currentOgcSelection.enabled = !currentOgcSelection.enabled;\n    }\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  emptyRadioButtons() {\n    this.currentRadioButtonsGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors.map(selector => selector.enabled = false);\n\n      this.applyFiltersTimeout = setTimeout(() => {\n        this.applyFilters();\n      }, 750);\n   });\n  }\n\n  emptySelect() {\n    this.enabled = [];\n  }\n\n  toggleAllSelection() {\n    if (this.allSelected) {\n      this.sel.options.forEach((item: MatOption) => item.select());\n    } else {\n      this.sel.options.forEach((item: MatOption) => item.deselect());\n    }\n  }\n\n  optionClick() {\n    let newStatus = true;\n    this.sel.options.forEach((item: MatOption) => {\n      if (!item.selected) {\n        newStatus = false;\n      }\n    });\n    this.allSelected = newStatus;\n  }\n\n  private applyFilters() {\n    let filterQueryString = '';\n    const conditions = [];\n    const currentGroups = [this.currentPushButtonsGroup, this.currentCheckboxesGroup,\n      this.currentRadioButtonsGroup, this.currentSelectGroup];\n    for (const currentGroup of currentGroups) {\n      if (currentGroup.computedSelectors) {\n        currentGroup.computedSelectors.map(selectorBundle => {\n          const bundleCondition = [];\n          selectorBundle.selectors\n          .filter(ogcSelector => ogcSelector.enabled === true)\n          .forEach(enabledSelector => bundleCondition.push(enabledSelector.filters));\n          if (bundleCondition.length >= 1 ) {\n            if (bundleCondition.length === 1) {\n              conditions.push(bundleCondition[0]);\n            } else {\n              conditions.push({logical: selectorBundle.logical, filters: bundleCondition});\n            }\n          }\n        });\n      }\n    }\n    if (this.isTemporalOperator()) {\n      conditions.push(this.datasource.options.ogcFilters.interfaceOgcFilters[0]);\n    }\n    if (conditions.length >= 1) {\n      filterQueryString = this.ogcFilterWriter\n        .buildFilter(conditions.length === 1 ?\n          conditions[0] : {logical: 'And', filters: conditions } as IgoOgcFilterObject);\n    }\n    if (this.datasource.options.type === 'wms') {\n      this.ogcFilterService.filterByOgc(this.datasource as WMSDataSource, filterQueryString );\n    }\n    if (this.datasource.options.type === 'wfs') {\n      // TODO: Check how to prevent wfs to refresh when filter icon is pushed...\n      this.datasource.ol.refresh();\n    }\n    this.datasource.setOgcFilters(this.datasource.options.ogcFilters, true);\n  }\n\n  isMoreResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index = type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return selectorsLength > index;\n  }\n\n  displayMoreResults(type) {\n    type === 'radio' ? this.radioButtonsIndex += 5 : this.checkboxesIndex += 5;\n    return;\n  }\n\n  isLessResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index = type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return this.baseIndex !== index && selectorsLength > this.baseIndex;\n  }\n\n  displayLessResults(type) {\n    type === 'radio' ? this.radioButtonsIndex = this.baseIndex : this.checkboxesIndex = this.baseIndex;\n    return;\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter?.operator?.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        filter => filter.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if ( refreshFilter ) {\n        this.applyFilters();\n      }\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n          ? 'upperBoundary'\n          : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n          ? 'end'\n          : undefined;\n      default:\n        return;\n    }\n  }\n}\n","<mat-tab-group\n  [selectedIndex]=\"selectedTypeIndex.value\"\n  (selectedIndexChange)=\"selectedTypeIndex.setValue($event)\"\n  (selectedTabChange)=\"onTypeChange($event)\">\n\n  <mat-tab [label]=\"'igo.geo.spatialFilter.predefined' | translate\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.spatialFilter.searchLabel' | translate}}</mat-label>\n      <mat-select (selectionChange)=\"onSelectionChange()\" [(value)]=\"selectedQueryType\">\n        <mat-option *ngFor=\"let queryType of queryType\" [value]=\"queryType\">\n          {{('igo.geo.terrapi.' + queryType) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <igo-spatial-filter-list\n      [store]=\"store\"\n      [queryType]=\"selectedQueryType\"\n      [zone]=\"zone\"\n      [layers]=\"layers\"\n      (zoneChange)=\"zoneChange.emit($event)\"\n      (zoneWithBufferChange)=\"zoneWithBufferChange.emit($event)\"\n      (bufferChange)=\"bufferChange.emit($event)\"\n      (measureUnitChange)=\"measureUnitChange.emit($event)\">\n    </igo-spatial-filter-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.geo.spatialFilter.draw' | translate\">\n    <div class=\"spatial-type-toggle\">\n      <mat-button-toggle-group\n        [value]=\"activeDrawType\"\n        (change)=\"onDrawTypeChange($event.value)\">\n        <mat-button-toggle [value]=\"spatialType.Polygon\" [matTooltip]=\"'igo.geo.spatialFilter.drawPolygon' | translate\">\n            <mat-icon svgIcon=\"pentagon-outline\"></mat-icon>\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"spatialType.Point\" [matTooltip]=\"'igo.geo.spatialFilter.drawCircle' | translate\">\n            <mat-icon svgIcon=\"record-circle-outline\"></mat-icon>\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n  </mat-tab>\n\n</mat-tab-group>\n","import {\n  Component,\n  Input,\n  OnInit,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { SpatialFilterQueryType, SpatialFilterType } from '../../shared/spatial-filter.enum';\nimport { FormControl } from '@angular/forms';\nimport { EntityStore } from '@igo2/common';\nimport { Feature } from '../../../feature';\nimport { MeasureLengthUnit } from '../../../measure';\nimport { Layer } from '../../../layer';\n\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'igo-spatial-filter-type',\n  templateUrl: './spatial-filter-type.component.html',\n  styleUrls: ['./spatial-filter-type.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterTypeComponent implements OnInit {\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  public queryType: string[] = ['Arrond', 'CircFed', 'CircProv', 'DirReg', 'Mun', 'MRC', 'AdmRegion', 'RegTour'];\n  public selectedTypeIndex = new FormControl(0);\n\n  /**\n   * Reference to the SpatialFIlterType enum\n   * @internal\n   */\n  public spatialType = SpatialFilterType;\n\n  public activeDrawType: SpatialFilterType = this.spatialType.Polygon;\n\n  @Input() selectedQueryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() layers: Layer[] = [];\n\n  public type: SpatialFilterType;\n\n  @Output() eventType = new EventEmitter<SpatialFilterType>();\n\n  @Output() eventQueryType = new EventEmitter<SpatialFilterQueryType>();\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  constructor() {}\n\n  ngOnInit() {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = this.spatialType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onTypeChange(event) {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = SpatialFilterType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onDrawTypeChange(spatialType: SpatialFilterType) {\n    this.activeDrawType = spatialType;\n    this.eventType.emit(this.activeDrawType);\n  }\n\n  onSelectionChange() {\n    this.eventQueryType.emit(this.selectedQueryType);\n    this.zoneChange.emit(undefined);\n  }\n}\n","<form class=\"form-list\">\n    <mat-form-field class=\"zone-list\">\n        <input #input type=\"text\" placeholder=\"{{'igo.geo.spatialFilter.listLabel' | translate}}\" matInput\n        [formControl]=\"formControl\" [matAutocomplete]=\"auto\">\n        <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)=\"onZoneChange($event.option.value)\"\n        [displayWith]=\"displayFn\">\n            <mat-option *ngFor=\"let entities of this.store.view.all$() | async\" [value]=\"entities\">\n                {{entities.properties.nom}}\n            </mat-option>\n        </mat-autocomplete>\n    </mat-form-field>\n<form>\n\n<div class=\"buffer-div\">\n    <form class=\"buffer-form\">\n        <mat-form-field class=\"buffer\">\n            <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.buffer' | translate}}\" [formControl]=\"bufferFormControl\"\n            [value]=\"0\" [readonly]=\"!zone\">\n        </mat-form-field>\n    </form>\n\n    <mat-form-field class=\"unit-field\">\n        <mat-select\n        [value]=\"measureUnit\"\n        (selectionChange)=\"onMeasureUnitChange($event.value)\">\n        <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n            {{('igo.geo.measure.' + measureUnit) | translate}}\n        </mat-option>\n        </mat-select>\n    </mat-form-field>\n</div>\n","import { debounceTime, distinctUntilChanged } from 'rxjs/operators';\nimport { EntityStore } from '@igo2/common';\nimport { SpatialFilterService } from './../../shared/spatial-filter.service';\nimport { SpatialFilterQueryType, SpatialFilterType } from './../../shared/spatial-filter.enum';\nimport {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { FormControl } from '@angular/forms';\nimport { Feature } from '../../../feature';\nimport { MeasureLengthUnit } from '../../../measure/shared';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { Layer } from '../../../layer';\n\n@Component({\n  selector: 'igo-spatial-filter-list',\n  templateUrl: './spatial-filter-list.component.html',\n  styleUrls: ['./spatial-filter-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterListComponent implements OnInit, OnDestroy {\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  @Input()\n  get queryType(): SpatialFilterQueryType {\n    return this._queryType;\n  }\n  set queryType(queryType: SpatialFilterQueryType) {\n    this.formControl.setValue('');\n    this._queryType = queryType;\n  }\n  private _queryType: SpatialFilterQueryType;\n\n  @Input()\n  get zone() {\n    return this._zone;\n  }\n  set zone(value) {\n    this._zone = value;\n    if (!value) {\n      this.zoneWithBuffer = undefined;\n      this.bufferFormControl.setValue(0);\n    }\n  }\n  private _zone;\n\n  @Input() layers: Layer[] = [];\n\n  public zoneWithBuffer;\n  public selectedZone: any;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  public formControl = new FormControl();\n\n  public bufferFormControl = new FormControl();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  formValueChanges$$: Subscription;\n  bufferValueChanges$$: Subscription;\n\n  constructor(\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService,\n    private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe((value) => {\n      if (value.length) {\n        this.store.view.filter((feature) => {\n          const filterNormalized = value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n          const featureNameNormalized = feature.properties.nom.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n          return featureNameNormalized.includes(filterNormalized);\n        });\n      }\n    });\n\n    this.bufferValueChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(\n        debounceTime(500),\n        distinctUntilChanged()\n      )\n      .subscribe((value) => {\n        if (this.measureUnit === MeasureLengthUnit.Meters && value > 0 && value <= 100000) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.selectedZone,\n            SpatialFilterType.Predefined,\n            value,\n            this.queryType\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (this.measureUnit === MeasureLengthUnit.Kilometers && value > 0 && value <= 100) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.selectedZone,\n            SpatialFilterType.Predefined,\n            value * 1000,\n            this.queryType\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (value === 0 && this.layers.length > 0) {\n          this.bufferChange.emit(value);\n          this.zoneWithBufferChange.emit(this.selectedZone);\n        } else if (\n            value < 0 ||\n            (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n            (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)) {\n            this.bufferFormControl.setValue(0);\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.bufferAlert'),\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n        }\n    });\n  }\n\n  ngOnDestroy() {\n    this.formValueChanges$$.unsubscribe();\n  }\n\n  displayFn(feature?: Feature): string | undefined {\n    return feature ? feature.properties.nom : undefined;\n  }\n\n  onZoneChange(feature) {\n    if (feature && this.queryType) {\n      this.spatialFilterService.loadItemById(feature, this.queryType)\n      .subscribe((featureGeom: Feature) => {\n        this.selectedZone = featureGeom;\n        this.zoneChange.emit(featureGeom);\n      });\n    }\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      this.measureUnit === MeasureLengthUnit.Meters ?\n        this.bufferFormControl.setValue(this.bufferFormControl.value * 1000) :\n        this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\n    }\n  }\n}\n","<igo-geometry-form-field-input\n  [formControl]=\"formControl\"\n  [map]=\"map\"\n  [geometryType]=\"geometryType\"\n  [drawGuide]=\"drawGuide$ | async\"\n  [measure]=\"measure\"\n  [drawControlIsActive]=\"drawControlIsActive\"\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\n  [drawStyle]=\"drawStyle$ | async\"\n  [overlayStyle]=\"overlayStyle$ | async\"\n  [radius]=\"radius\">\n</igo-geometry-form-field-input>\n\n<div class=\"header\">\n    <mat-slide-toggle *ngIf=\"!isPredefined()\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onDrawControlChange()\">\n      {{'igo.geo.spatialFilter.drawControl' | translate}}\n    </mat-slide-toggle>\n    <mat-slide-toggle *ngIf=\"!isPredefined()\"\n      [checked]=\"freehandDrawIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onfreehandControlChange()\">\n      {{'igo.geo.spatialFilter.freehandControl' | translate}}\n    </mat-slide-toggle>\n</div>\n\n<div class=\"buffer-unit\" *ngIf=\"isPolygon()\">\n  <form class=\"buffer-form\">\n    <mat-form-field class=\"buffer\">\n      <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.buffer' | translate}}\" [formControl]=\"bufferFormControl\"\n      [value]=\"0\" [readonly]=\"this.formControl.value === null\">\n    </mat-form-field>\n  </form>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n    [value]=\"measureUnit\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n        {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<div class=\"radius-unit\" *ngIf=\"isPoint()\">\n  <form class=\"radius-form\">\n    <mat-form-field class=\"radius\">\n      <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.radius' | translate}}\" [formControl]=\"radiusFormControl\"\n      [value]=\"1000\" (input)=\"getRadius()\" [readonly]=\"this.freehandDrawIsActive && this.formControl.value === null\">\n    </mat-form-field>\n  </form>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n    [value]=\"measureUnit\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n        {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<mat-label class=\"title mat-typography\">{{'igo.geo.spatialFilter.search' | translate}} : </mat-label>\n<mat-radio-group [value]=\"selectedItemType\">\n    <mat-radio-button *ngFor=\"let item of itemType\"\n      [value]=\"item\"\n      (change)=\"onItemTypeChange($event)\">\n      {{'igo.geo.spatialFilter.' + item | translate}}\n    </mat-radio-button>\n</mat-radio-group>\n\n<div class=\"thematics\" *ngIf=\"selectedItemType==='Thematics'\">\n  <mat-table>\n      <!-- Name Column -->\n      <ng-container matColumnDef=\"name\">\n        <mat-header-cell *matHeaderCellDef class=\"thematics-header\">{{'igo.geo.spatialFilter.Thematics' | translate}}</mat-header-cell>\n      </ng-container>\n\n      <!-- Select Column -->\n      <ng-container matColumnDef=\"select\">\n        <mat-header-cell *matHeaderCellDef class=\"checks-header\">\n          <mat-checkbox (change)=\"$event ? masterToggle() : null\"\n                        [checked]=\"isAllSelected()\"\n                        [indeterminate]=\"selectedThematics.hasValue() && !isAllSelected()\">\n          </mat-checkbox>\n        </mat-header-cell>\n    </ng-container>\n\n    <mat-header-row *matHeaderRowDef=\"displayedColumns\"></mat-header-row>\n    <mat-row *matRowDef=\"let row; columns: displayedColumns;\"></mat-row>\n\n  </mat-table>\n\n  <mat-tree [dataSource]=\"dataSource\" [treeControl]=\"treeControl\">\n    <!-- This is the tree node template for leaf nodes -->\n    <mat-tree-node *matTreeNodeDef=\"let node\" matTreeNodeToggle>\n      <li class=\"mat-tree-node\">\n        <!-- use a disabled button to provide padding for tree leaf -->\n        <button mat-icon-button disabled></button>\n        {{node.name}}\n        <mat-checkbox class=\"tree-check\" (click)=\"$event.stopPropagation()\"\n                      (change)=\"$event ? onToggleChange(node) : null\"\n                      [checked]=\"selectedThematics.isSelected(node)\">\n        </mat-checkbox>\n      </li>\n    </mat-tree-node>\n\n    <!-- This is the tree node template for expandable nodes -->\n    <mat-nested-tree-node *matTreeNodeDef=\"let node; when: hasChild\">\n        <div class=\"mat-tree-node\">\n          <button mat-icon-button\n            (click)=\"onToggleClick(node)\">\n            <mat-icon [svgIcon]=\"treeControl.isExpanded(node) ? 'chevron-down' : 'chevron-right'\"></mat-icon>\n          </button>\n          {{node.name}}\n          <mat-checkbox class=\"tree-check-2\" (change)=\"$event ? childrensToggle(node) : null\"\n                        [checked]=\"isAllSelected(node)\"\n                        [indeterminate]=\"hasChildrenSelected(node) && !isAllSelected(node)\">\n          </mat-checkbox>\n        </div>\n        <ul class=\"tree-ul\" [class.example-tree-invisible]=\"!treeControl.isExpanded(node)\">\n          <ng-container matTreeNodeOutlet></ng-container>\n        </ul>\n    </mat-nested-tree-node>\n\n  </mat-tree>\n</div>\n\n<div class=\"buttons\">\n\n  <button *ngIf=\"isPredefined()\" mat-raised-button class=\"clear-search-button\" [disabled]=\"disabledClearSearch()\"\n    (click)=\"clearSearch()\">\n      {{'igo.geo.spatialFilter.clearSearch' | translate}}\n  </button>\n\n  <button *ngIf=\"isPolygon() || isPoint()\" mat-raised-button class=\"clear-form-button\" [disabled]=\"this.formControl.value === null\"\n    (click)=\"clearDrawZone()\">\n    {{'igo.geo.spatialFilter.clearForm' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"search-button\" [disabled]=\"disableSearchButton()\" color=\"primary\"\n    (click)=\"toggleSearchButton()\">\n    {{'igo.geo.spatialFilter.goSearch' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"remove-button\" [disabled]=\"allLayers.length === 0\" (click)=\"clearButton()\">\n    {{'igo.geo.spatialFilter.removeLayer' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"export-button\" [disabled]=\"!store.entities$.getValue().length\" (click)=\"export.emit()\">\n    {{'igo.geo.spatialFilter.exportLayer' | translate}}\n  </button>\n\n</div>","import OlFeature from 'ol/Feature';\nimport {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { SpatialFilterQueryType, SpatialFilterType } from '../../shared/spatial-filter.enum';\nimport { SelectionModel } from '@angular/cdk/collections';\nimport { IgoMap } from '../../../map';\nimport { SpatialFilterItemType } from './../../shared/spatial-filter.enum';\nimport { Feature } from './../../../feature/shared/feature.interfaces';\nimport { FormControl } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { GeoJSONGeometry } from '../../../geometry/shared/geometry.interfaces';\nimport * as olStyle from 'ol/style';\nimport * as olproj from 'ol/proj';\nimport OlPoint from 'ol/geom/Point';\nimport { MatTreeNestedDataSource } from '@angular/material/tree';\nimport { SpatialFilterService } from '../../shared/spatial-filter.service';\nimport { MeasureLengthUnit } from '../../../measure';\nimport { EntityStore } from '@igo2/common';\nimport { Layer } from '../../../layer/shared';\nimport { NestedTreeControl } from '@angular/cdk/tree';\nimport { SpatialFilterThematic } from './../../shared/spatial-filter.interface';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { debounceTime } from 'rxjs/operators';\n\n/**\n * Spatial-Filter-Item (search parameters)\n */\n@Component({\n  selector: 'igo-spatial-filter-item',\n  templateUrl: './spatial-filter-item.component.html',\n  styleUrls: ['./spatial-filter-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterItemComponent implements OnDestroy, OnInit {\n\n  @Input() map: IgoMap;\n\n  @Input()\n  get type(): SpatialFilterType {\n    return this._type;\n  }\n  set type(type: SpatialFilterType) {\n    this._type = type;\n    const index = this.geometryTypes.findIndex(geom => geom === this.type);\n    this.geometryType = this.geometryTypes[index];\n    this.formControl.reset();\n    this.radius = undefined;\n    this.drawGuide$.next(null);\n    this.drawStyle$.next(undefined);\n\n    // Necessary to keep reference to the geometry form field input\n    if (this.type === SpatialFilterType.Predefined) {\n      const geojson: GeoJSONGeometry = {\n        type: 'Point',\n        coordinates: ''\n      };\n      this.formControl.setValue(geojson);\n    }\n\n    // Necessary to apply the right style when geometry type is Point\n    if (this.type === SpatialFilterType.Point) {\n      this.radius = 1000; // Base radius\n      this.radiusFormControl.setValue(this.radius);\n      this.PointStyle = (feature: OlFeature<OlGeometry>, resolution: number) => {\n        const geom = feature.getGeometry() as OlPoint;\n        const coordinates = olproj.transform(geom.getCoordinates(), this.map.projection, 'EPSG:4326');\n        return new olStyle.Style ({\n          image: new olStyle.Circle ({\n            radius: this.radius / (Math.cos((Math.PI / 180) * coordinates[1])) / resolution, // Latitude correction\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          })\n        });\n      };\n      this.overlayStyle = this.PointStyle;\n      this.drawStyle$.next(this.overlayStyle);\n    } else {\n      // If geometry types is Polygon\n      this.radius = undefined;\n      this.PolyStyle = () => {\n        return new olStyle.Style ({\n          stroke: new olStyle.Stroke({\n            width: 2,\n            color: 'rgba(0, 153, 255)'\n          }),\n          fill: new olStyle.Fill({\n            color: 'rgba(0, 153, 255, 0.2)'\n          })\n        });\n      };\n      const color = [0, 153, 255];\n      const drawStyle = () => {\n        return new olStyle.Style({\n          image: new olStyle.Circle ({\n            radius: 8,\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          }),\n          stroke: new olStyle.Stroke({\n            color: color.concat([1]),\n            width: 2\n          }),\n          fill:  new olStyle.Fill({\n            color: color.concat([0.2])\n          })\n        });\n      };\n      this.overlayStyle = this.PolyStyle;\n      this.drawStyle$.next(drawStyle);\n    }\n    this.overlayStyle$.next(this.overlayStyle);\n  }\n  private _type: SpatialFilterType;\n\n  @Input() queryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() loading;\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n    this._store.entities$.subscribe(() => { this.cdRef.detectChanges(); });\n  }\n  private _store: EntityStore<Feature>;\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Input() layers: Layer[] = [];\n\n  @Input() allLayers: Layer[] = [];\n\n  @Input()\n  get thematicLength(): number {\n    return this._thematicLength;\n  }\n  set thematicLength(value: number) {\n    this._thematicLength = value;\n  }\n  private _thematicLength: number;\n\n  @Output() toggleSearch = new EventEmitter();\n\n  @Output() itemTypeChange = new EventEmitter<SpatialFilterItemType>();\n\n  @Output() thematicChange = new EventEmitter<SpatialFilterThematic[]>();\n\n  @Output() drawZoneEvent = new EventEmitter<Feature>();\n\n  @Output() bufferEvent = new EventEmitter<number>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  @Output() radiusEvent = new EventEmitter<number>();\n  @Output() freehandControl = new EventEmitter<boolean>();\n\n  @Output() clearButtonEvent = new EventEmitter();\n\n  @Output() clearSearchEvent = new EventEmitter();\n\n  @Output() export = new EventEmitter();\n\n  @Output() openWorkspace = new EventEmitter();\n\n  public itemType: SpatialFilterItemType[] = [SpatialFilterItemType.Address, SpatialFilterItemType.Thematics];\n  public selectedItemType: SpatialFilterItemType = SpatialFilterItemType.Address;\n  public selectedSourceAddress;\n\n  treeControl: NestedTreeControl<SpatialFilterThematic> = new NestedTreeControl<SpatialFilterThematic>(node => node.children);\n\n  // For thematics and results tables\n  public displayedColumns: string[] = ['name', 'select'];\n  public childrens: SpatialFilterThematic[] = [];\n  public groups: string[] = [];\n  public thematics: SpatialFilterThematic[] = [];\n  public dataSource = new MatTreeNestedDataSource<SpatialFilterThematic>();\n  public selectedThematics = new SelectionModel<SpatialFilterThematic>(true, []);\n\n  // For geometry form field input\n  value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(undefined);\n  drawGuide$: BehaviorSubject<number> = new BehaviorSubject(null);\n  overlayStyle$: BehaviorSubject<olStyle.Style | ((feature, resolution) => olStyle.Style)> = new BehaviorSubject(undefined);\n  drawStyle$: BehaviorSubject<olStyle.Style | ((feature, resolution) => olStyle.Style)> = new BehaviorSubject(undefined);\n\n  private value$$: Subscription;\n  private radiusChanges$$: Subscription;\n  private bufferChanges$$: Subscription;\n\n  public formControl = new FormControl();\n  public geometryType: typeof OlGeometryType | string;\n  public geometryTypeField = false;\n  public geometryTypes: string[] = ['Point', 'Polygon'];\n  public drawGuideField = false;\n  public drawGuide: number = null;\n  public drawGuidePlaceholder = '';\n  public measure = false;\n  public drawControlIsActive = true;\n  public freehandDrawIsActive = false;\n  public drawStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public drawZone;\n  public overlayStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PointStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PolyStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n\n  public radius: number;\n  public buffer: number = 0;\n  public radiusFormControl = new FormControl();\n  public bufferFormControl = new FormControl();\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  public zoneWithBuffer;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService,\n    private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.spatialFilterService.loadThematicsList()\n    .subscribe((items: SpatialFilterThematic[]) => {\n      for (const item of items) {\n        this.childrens.push(item);\n        this.childrens.sort((a, b) => {\n          return a.name.localeCompare(b.name);\n        });\n      }\n      this.groups.push(this.languageService.translate.instant('igo.geo.terrapi.limites'));\n      const limits: SpatialFilterThematic = {\n        name: this.groups[0],\n        children: []\n      };\n      this.thematics.push(limits);\n      this.childrens.forEach(child => {\n        if (child.group && (this.groups.indexOf(child.group) === -1)) {\n          this.groups.push(child.group);\n          const thematic: SpatialFilterThematic = {\n            name: child.group,\n            children: []\n          };\n          this.thematics.push(thematic);\n        }\n\n        if (!child.group) {\n          if (\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.AdmRegion') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.Mun') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.Arrond') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.CircFed') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.CircProv') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.DirReg') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.MRC') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.RegTour')) {\n              child.group = limits.name;\n          } else if (child.name === this.languageService.translate.instant('igo.geo.terrapi.routes')) {\n            child.group = this.languageService.translate.instant('igo.geo.spatialFilter.group.transport');\n          } else {\n            const thematic: SpatialFilterThematic = {\n              name: child.name,\n              children: [],\n              source: child.source\n            };\n            this.thematics.push(thematic);\n          }\n        }\n        this.thematics.sort((a, b) => {\n          return a.name.localeCompare(b.name);\n        });\n      });\n      this.thematics.forEach(thematic => {\n        for (const child of this.childrens) {\n          if (child.group === thematic.name) {\n            thematic.children.push(child);\n          }\n        }\n      });\n    });\n\n    this.dataSource.data = this.thematics;\n\n    this.drawGuide$.next(null);\n    this.value$.next(this.formControl.value ? this.formControl.value : undefined);\n    this.value$$ = this.formControl.valueChanges.subscribe((value: GeoJSONGeometry) => {\n      if (value) {\n        this.value$.next(value);\n        this.drawZone = this.formControl.value as Feature;\n        if (this.buffer !== 0) {\n          this.drawZoneEvent.emit(this.drawZone);\n          this.bufferFormControl.setValue(this.buffer);\n        }\n      } else {\n        this.value$.next(undefined);\n        this.drawZone = undefined;\n      }\n    });\n\n    this.value$.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.radiusChanges$$ = this.radiusFormControl.valueChanges.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.bufferChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(\n        debounceTime(500)\n      )\n      .subscribe((value) => {\n        if (this.measureUnit === MeasureLengthUnit.Meters && value > 0 && value <= 100000) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.drawZone,\n            SpatialFilterType.Polygon,\n            value\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (this.measureUnit === MeasureLengthUnit.Kilometers && value > 0 && value <= 100) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.drawZone,\n            SpatialFilterType.Polygon,\n            value * 1000\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (value === 0) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.drawZoneEvent.emit(this.drawZone);\n        } else if (\n          value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)) {\n            this.bufferFormControl.setValue(0);\n            this.buffer = 0;\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.bufferAlert'),\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n        }\n    });\n  }\n\n  /**\n   * Unsubscribe to the value stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.value$$.unsubscribe();\n    this.radiusChanges$$.unsubscribe();\n    this.bufferChanges$$.unsubscribe();\n    this.cdRef.detach();\n    if (this.radiusChanges$$) {\n      this.radiusChanges$$.unsubscribe();\n    }\n    if (this.value$$) {\n      this.value$$.unsubscribe();\n    }\n  }\n\n  onItemTypeChange(event) {\n    this.selectedItemType = event.value;\n    this.itemTypeChange.emit(this.selectedItemType);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      if (this.isPolygon()) {\n        this.measureUnit === MeasureLengthUnit.Meters ?\n          this.bufferFormControl.setValue(this.bufferFormControl.value * 1000) :\n          this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\n      } else if (this.isPoint()) {\n        this.measureUnit === MeasureLengthUnit.Meters ?\n          this.radiusFormControl.setValue(this.radiusFormControl.value * 1000) :\n          this.radiusFormControl.setValue(this.radiusFormControl.value / 1000);\n      }\n    }\n  }\n\n  isPredefined() {\n    return this.type === SpatialFilterType.Predefined;\n  }\n\n  isPolygon() {\n    return this.type === SpatialFilterType.Polygon;\n  }\n\n  isPoint() {\n    return this.type === SpatialFilterType.Point;\n  }\n\n  hasChild(_: number, node: SpatialFilterThematic) {\n    if (node.children) {\n      return node.children.length;\n    }\n    return false;\n  }\n\n  onToggleClick(node: SpatialFilterThematic) {\n    this.treeControl.isExpanded(node) ? this.treeControl.collapse(node) : this.treeControl.expand(node);\n  }\n\n  isAllSelected(node?: SpatialFilterThematic) {\n    let numSelected;\n    let numNodes = 0;\n    if (!node) {\n      numSelected = this.selectedThematics.selected.length;\n      this.thematics.forEach(thematic => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          numNodes++;\n        }\n      });\n      this.childrens.forEach(children => {\n        if (!this.thematics.find(thematic => thematic.source === children.source)) {\n          numNodes++;\n        }\n      });\n    } else {\n      numSelected = node.children.length;\n      node.children.forEach(children => {\n        if (this.selectedThematics.selected.find(thematic => thematic === children)) {\n          numNodes++;\n        }\n      });\n    }\n\n    if (numNodes >= 1) {\n      return numSelected === numNodes;\n    } else {\n      return false;\n    }\n  }\n\n  hasChildrenSelected(node: SpatialFilterThematic) {\n    let bool = false;\n    node.children.forEach(child => {\n      if (this.selectedThematics.selected.find(thematic => thematic.source === child.source)) {\n        bool = true;\n      }\n    });\n    return bool;\n  }\n\n  /**\n   * Apply header checkbox\n   */\n  masterToggle() {\n    this.isAllSelected() ?\n      this.selectedThematics.clear() :\n      this.selectAll();\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n\n    if (this.isAllSelected()) {\n      this.thematics.forEach(thematic => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.expand(thematic);\n        }\n      });\n    } else {\n      this.thematics.forEach(thematic => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.collapse(thematic);\n        }\n      });\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  selectAll(node?: SpatialFilterThematic) {\n    if (!node) {\n      this.thematics.forEach(thematic => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          this.selectedThematics.select(thematic);\n        }\n      });\n      this.childrens.forEach(children => {\n        if (!this.selectedThematics.selected.find(thematic => thematic.source === children.source)) {\n          this.selectedThematics.select(children);\n        }\n      });\n    } else {\n      if (this.hasChild(0, node)) {\n        node.children.forEach(children => this.selectedThematics.select(children));\n      }\n    }\n  }\n\n  childrensToggle(node: SpatialFilterThematic) {\n    this.isAllSelected(node) ?\n    node.children.forEach(child => this.selectedThematics.deselect(child)) :\n    this.selectAll(node);\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.treeControl.expand(node);\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  /**\n   * Apply changes to the thematics selected tree and emit event\n   */\n  onToggleChange(nodeSelected: SpatialFilterThematic) {\n    let selected = false;\n    if (this.selectedThematics.selected.find(thematic => thematic.source === nodeSelected.source) !== undefined) {\n      selected = true;\n    }\n\n    this.childrens.forEach(children => {\n      if (children === nodeSelected && selected === false) {\n        this.selectedThematics.select(children);\n      }\n      if (children === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(children);\n      }\n    });\n    this.thematics.forEach(thematic => {\n      if (thematic === nodeSelected && selected === false) {\n        this.selectedThematics.select(thematic);\n      }\n      if (thematic === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(thematic);\n      }\n    });\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  onDrawControlChange() {\n    this.drawControlIsActive = !this.drawControlIsActive;\n  }\n\n  onfreehandControlChange() {\n    this.freehandDrawIsActive = !this.freehandDrawIsActive;\n    this.freehandControl.emit(this.freehandDrawIsActive);\n  }\n\n  /**\n   * Launch search button\n   */\n  toggleSearchButton() {\n    if (!this.isPredefined()) {\n      if (this.buffer > 0) {\n        this.zoneWithBuffer.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.zoneWithBuffer.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.zoneWithBuffer);\n      } else {\n        this.drawZone.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.drawZone.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.drawZone);\n      }\n    }\n    if (this.isPoint()) {\n      this.radiusEvent.emit(this.radius);\n    } else if (this.isPolygon()) {\n      this.bufferEvent.emit(this.buffer);\n    }\n    this.toggleSearch.emit();\n    this.store.entities$.subscribe((value) => {\n      if (value.length && this.layers.length === this.thematicLength + 1) {\n        this.openWorkspace.emit();\n      }\n    });\n  }\n\n  /**\n   * Launch clear button (clear store and map layers)\n   */\n  clearButton() {\n    this.loading = true;\n    if (this.store) {\n      this.store.clear();\n    }\n    if (this.isPoint() || this.isPolygon()) {\n      this.drawZone = undefined;\n      this.formControl.reset();\n    }\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.clearButtonEvent.emit();\n    this.loading = false;\n  }\n\n  clearDrawZone() {\n    this.formControl.reset();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n  }\n\n  /**\n   * Launch clear search (clear field if type is predefined)\n   */\n  clearSearch() {\n    this.selectedThematics.clear();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.thematicChange.emit([]);\n    this.clearSearchEvent.emit();\n  }\n\n  /**\n   * Verify conditions of incomplete fields or busy service\n   */\n  disableSearchButton(): boolean {\n    if (this.type === SpatialFilterType.Predefined) {\n      if (this.selectedItemType === SpatialFilterItemType.Address) {\n        if (this.queryType !== undefined && this.zone !== undefined) {\n          return this.loading;\n        }\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (this.queryType !== undefined && this.zone !== undefined && this.selectedThematics.selected.length > 0) {\n          return this.loading;\n        }\n      }\n    }\n    if (this.type === SpatialFilterType.Polygon || this.type === SpatialFilterType.Point) {\n      if (this.selectedItemType === SpatialFilterItemType.Address && this.formControl.value !== null) {\n        return this.loading;\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (this.selectedThematics.selected.length > 0 && this.formControl.value !== null) {\n          return this.loading;\n        }\n      }\n    }\n    return true;\n  }\n\n  disabledClearSearch() {\n    let disable = true;\n    this.selectedItemType === SpatialFilterItemType.Address ?\n      disable = this.queryType === undefined :\n      disable = this.queryType === undefined && this.selectedThematics.selected.length === 0;\n\n    return disable;\n  }\n\n  /**\n   * Manage radius value at user change\n   */\n  getRadius() {\n    let formValue;\n    if (this.formControl.value !== null) {\n      this.measureUnit === MeasureLengthUnit.Meters ?\n        formValue = this.formControl.value.radius :\n        formValue = this.formControl.value.radius / 1000;\n    } else {\n      formValue = undefined;\n    }\n\n    if (this.type === SpatialFilterType.Point) {\n      if (!this.freehandDrawIsActive) {\n        if (\n          this.radiusFormControl.value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && this.radiusFormControl.value >= 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && this.radiusFormControl.value >= 100)) {\n          this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.radiusAlert'),\n            this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n          this.radius = 1000;\n          this.measureUnit === MeasureLengthUnit.Meters ?\n            this.radiusFormControl.setValue(this.radius) :\n            this.radiusFormControl.setValue(this.radius / 1000);\n          this.drawGuide$.next(this.radius);\n          return;\n        }\n      } else {\n        if (formValue) {\n          if (formValue >= 100000) {\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.radiusAlert'),\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n            this.formControl.reset();\n            return;\n          }\n          if (formValue !== this.radiusFormControl.value) {\n            this.radiusFormControl.setValue(formValue);\n            return;\n          }\n        }\n      }\n      if (this.measureUnit === MeasureLengthUnit.Meters) {\n        this.radius = this.radiusFormControl.value;\n        this.drawGuide$.next(this.radius);\n      } else {\n        this.radius = this.radiusFormControl.value * 1000;\n        this.drawGuide$.next(this.radius * 1000);\n      }\n      this.overlayStyle$.next(this.PointStyle);\n      this.drawStyle$.next(this.PointStyle);\n    }\n  }\n}\n","<div class=\"datetime-container\">\n\n  <mat-slide-toggle \n    *ngIf=\"this.currentFilter.sliderOptions?.enabled\"\n    [(ngModel)]=\"sliderMode\"\n    (change)=\"modeChange($event)\">\n    {{'igo.geo.filter.sliderModeTitle' | translate}}\n  </mat-slide-toggle>\n\n  <div class=\"slider-container\" *ngIf=\"sliderMode\">\n    <igo-ogc-filter-time-slider\n      [begin]=\"beginValue\"\n      [max]=\"this.restrictedToStep() ? this.maxDate : this.endValue\"\n      [currentFilter]=\"currentFilter\" \n      [datasource]=\"datasource\"\n      (changeProperty)=\"changePropertyByPass($event)\"\n    >\n    </igo-ogc-filter-time-slider>\n    \n  </div>\n\n  <div *ngIf=\"!sliderMode\">\n            \n      <div class=\"year-input-container\" *ngIf=\"calendarTypeYear\">\n        <!-- to emulate a year-picker, 2 input: first input to show user just year and second input hiden and bind \n          with the datepicker  -->\n        <mat-form-field  class=\"year-input\">\n          <mat-label>{{'igo.geo.timeFilter.startYear'| translate}}</mat-label>\n          <input \n            matInput \n            class=\"year-input-only-year\" \n            value=\"{{onlyYearBegin}}\"\n            (change)= \"yearOnlyInputChange($event, beginDatepicker, 'begin')\"\n            >\n          <mat-datepicker-toggle matSuffix [for]=\"beginDatepicker\"></mat-datepicker-toggle>\n    \n          <mat-datepicker\n            panelClass=\"datepicker-year\"\n            #beginDatepicker\n            [startView]=\"calendarView()\"\n            [startAt]=\"beginValue\"\n            (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n            >\n          </mat-datepicker>\n\n          <input #beginYear\n            class= \"year-input-hide\"\n            matInput\n            [matDatepicker]=\"beginDatepicker\"\n            enabled= false\n            readonly= true\n            [value]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n            [min]=\"handleDate(datasource.options.minDate)\"\n            [max]=\"(endValue && (!restrictedToStep()))?endValue:handleDate(datasource.options.maxDate)\"\n            >\n \n        </mat-form-field>\n\n        <mat-form-field  class=\"year-input\">\n          <mat-label>{{'igo.geo.timeFilter.endYear'| translate}}</mat-label>\n          <input \n            matInput \n            class=\"year-input-only-year\" \n            value=\"{{onlyYearEnd}}\">\n          <mat-datepicker-toggle matSuffix [for]=\"endDatepicker\"></mat-datepicker-toggle>\n          <mat-datepicker\n            panelClass=\"datepicker-year\"\n            #endDatepicker\n            [startView]=\"calendarView()\"\n            [startAt]=\"endValue\"\n            (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n            >\n          </mat-datepicker>\n\n          <input #endYear\n            class= \"year-input-hide\"\n            matInput\n            [matDatepicker]=\"endDatepicker\"\n            enabled= false\n            readonly= true\n            [value]=\"endValue?endValue:handleDate(datasource.options.maxDate)\"\n            [min]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n            [max]=\"handleDate(datasource.options.maxDate)\"\n            >\n        </mat-form-field>\n\n      </div>\n\n      <div class=\"datetime-input\" *ngIf=\"calendarType()!=='year'\">\n      <mat-form-field class=\"date-input\">\n        <mat-datepicker-toggle matSuffix [for]=\"beginDatepicker\"></mat-datepicker-toggle>\n        <input #begin\n          matInput\n          [matDatepicker]=\"beginDatepicker\"\n          [placeholder]=\"'igo.geo.timeFilter.startDate' | translate\"\n          [attr.disabled]=\"!currentFilter.active\"\n          (dateChange)=\"changeTemporalProperty(begin.value, 1)\"\n          [matDatepickerFilter]=\"dateFilter.bind(this, 'begin')\"\n          [value]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n          [min]=\"handleDate(datasource.options.minDate)\"\n          [max]=\"(endValue && (!restrictedToStep()))?endValue:handleDate(datasource.options.maxDate)\" >\n        <span class=\"filler\"></span>\n        <mat-datepicker\n          #beginDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"beginValue\"\n          (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n          (monthSelected)=\"monthSelected($event, beginDatepicker, 'begin')\">\n        </mat-datepicker>\n      </mat-form-field>\n      <div class=\"time-input\">\n        <mat-form-field class=\"hour-input\" *ngIf=\"calendarType()==='datetime'\">\n          <mat-label>{{'igo.geo.timeFilter.hour' | translate}}</mat-label>\n          <mat-select\n            [formControl]=\"beginHourFormControl\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (selectionChange)=\"changeTemporalProperty(begin.value, 1)\">\n            <mat-option *ngFor=\"let hour of beginHours\" [value]=\"hour\">{{hour}}</mat-option>\n          </mat-select>\n        </mat-form-field>\n        <mat-form-field class=\"minute-input\" *ngIf=\"calendarType()==='datetime'\">\n          <mat-label>{{'igo.geo.timeFilter.minute' | translate}}</mat-label>\n          <mat-select\n            [formControl]=\"beginMinuteFormControl\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (selectionChange)=\"changeTemporalProperty(begin.value, 1)\">\n            <mat-option *ngFor=\"let minute of beginMinutes\" [value]=\"minute\">{{minute}}</mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <div class=\"datetime-input\" *ngIf=\"!restrictedToStep() && calendarType()!=='year'\">\n      <mat-form-field class=\"date-input\">\n        <mat-datepicker-toggle matSuffix [for]=\"endDatepicker\"></mat-datepicker-toggle>\n          <input #end\n            matInput\n            [matDatepicker]=\"endDatepicker\"\n            [placeholder]=\"'igo.geo.timeFilter.endDate' | translate\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (dateChange)=\"changeTemporalProperty(end.value, 2)\"\n            [matDatepickerFilter]=\"dateFilter.bind(this, 'end')\"\n            [value]=\"endValue?endValue:handleDate(datasource.options.maxDate)\"\n            [min]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n            [max]=\"handleDate(datasource.options.maxDate)\" >\n          <span class=\"filler\"></span>\n          <mat-datepicker #endDatepicker\n            [startView]=\"calendarView()\"\n            [startAt]=\"endValue\"\n            (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n            (monthSelected)=\"monthSelected($event, endDatepicker, 'end')\">\n        </mat-datepicker>\n      </mat-form-field>\n      <div class=\"time-input\">\n        <mat-form-field class=\"hour-input\" *ngIf=\"calendarType()==='datetime'\" >\n          <mat-label>{{'igo.geo.timeFilter.hour' | translate}}</mat-label>\n          <mat-select\n            [formControl]=\"endHourFormControl\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (selectionChange)=\"changeTemporalProperty(end.value, 2)\">\n            <mat-option *ngFor=\"let hour of endHours\" [value]=\"hour\">{{hour}}</mat-option>\n          </mat-select>\n        </mat-form-field>\n        <mat-form-field class=\"minute-input\" *ngIf=\"calendarType()==='datetime'\">\n          <mat-label>{{'igo.geo.timeFilter.minute' | translate}}</mat-label>\n          <mat-select\n            [formControl]=\"endMinuteFormControl\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (selectionChange)=\"changeTemporalProperty(end.value, 2)\">\n            <mat-option *ngFor=\"let minute of endMinutes\" [value]=\"minute\">{{minute}}</mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n    </div>\n  </div>\n\n</div>\n","import {\n  Component,\n  Input,\n  ViewChild,\n  ElementRef,\n  Output,\n  EventEmitter,\n  OnInit\n} from '@angular/core';\nimport { FormControl } from '@angular/forms';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\nimport {\n  OgcFilterableDataSourceOptions,\n  OgcFilterableDataSource\n} from '../shared/ogc-filter.interface';\n\nimport * as moment_ from 'moment';\nconst moment = moment_;\n\n@Component({\n  selector: 'igo-ogc-filter-time',\n  templateUrl: './ogc-filter-time.component.html',\n  styleUrls: ['./ogc-filter-time.component.scss']\n})\nexport class OgcFilterTimeComponent implements OnInit {\n  @Input() datasource: OgcFilterableDataSource;\n  @Input() currentFilter: any;\n  @Output() changeProperty: EventEmitter<{\n    value: string;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n\n  beginHours: number[];\n  endHours: number[];\n  beginMinutes: number[];\n  endMinutes: number[];\n  beginHourFormControl = new FormControl();\n  beginMinuteFormControl = new FormControl();\n  endHourFormControl = new FormControl();\n  endMinuteFormControl = new FormControl();\n  _beginValue: Date;\n  _endValue: Date;\n  readonly _defaultMin: string = '1900-01-01';\n  readonly _defaultMax: string = '2052-01-06';\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderModeEnabled: boolean = true;\n  ogcFilterOperator = OgcFilterOperator;\n  public sliderMode = false;\n\n  readonly defaultStepMillisecond = 60000;\n  public options: OgcFilterableDataSourceOptions;\n\n  public onlyYearBegin: number;\n  public onlyYearEnd: number;\n  public calendarTypeYear = false;\n\n  @ViewChild('endDatepickerTime') endDatepickerTime: ElementRef;\n  @ViewChild('beginDatepickerTime') beginDatepickerTime: ElementRef;\n  @ViewChild('beginTime') beginTime: HTMLInputElement;\n  @ViewChild('endTime') endTime: HTMLInputElement;\n\n  get step(): string {\n    return this.datasource.options.stepDate\n      ? this.datasource.options.stepDate\n      : this.currentFilter.step;\n  }\n\n  get stepMilliseconds(): number {\n    const step = moment.duration(this.step).asMilliseconds();\n    return step === 0 ? this.defaultStepMillisecond : step;\n  }\n\n  set beginValue(begin: Date) {\n    this._beginValue = begin;\n  }\n\n  get beginValue(): Date {\n    return this._beginValue;\n  }\n\n  set endValue(end: Date) {\n    this._endValue = end;\n  }\n\n  get endValue(): Date {\n    return this._endValue;\n  }\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? 2000\n      : this.currentFilter.sliderInterval;\n  }\n\n  get maxDate(): string {\n    return this.datasource.options.maxDate ? this.datasource.options.maxDate : this._defaultMax;\n  }\n\n  get displayFormat(): string {\n    return this.currentFilter.displayFormat ? this.currentFilter.displayFormat : this._defaultDisplayFormat;\n  }\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {}\n\n  ngOnInit(){\n    if (this.currentFilter.sliderOptions) {\n      this.currentFilter.sliderOptions.enabled = this.currentFilter.sliderOptions.enabled !== undefined ?\n        this.currentFilter.sliderOptions.enabled : this._defaultSliderModeEnabled;\n    }\n    this.beginValue = this.parseFilter(this.handleMin());\n    this.endValue = this.parseFilter(this.handleMax());\n\n    this.onlyYearBegin = this.beginValue.getUTCFullYear();\n    this.onlyYearEnd = this.endValue.getUTCFullYear();\n    this.calendarTypeYear = this.isCalendarYearMode();\n\n    this.updateHoursMinutesArray();\n    // update value for now value\n    this.updateValues();\n    if (this.currentFilter.calendarModeYear) {\n      this.beginValue.setUTCFullYear(this.beginValue.getUTCFullYear() + 1);\n    }\n  }\n\n  parseFilter(filter): Date {\n    if (!filter){\n      return new Date();\n    } else if ( isNaN( new Date(filter).getTime() ) ) {\n      if (filter.search('now') >= 0 ) {\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if (filter.match(/\\+/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.search('+') + 1, interval.index),\n            10\n          );\n          return moment().add(intervalInt, interval[0]).toDate();\n        }\n        if (filter.match(/\\-/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.search('-') + 1, interval.index),\n            10\n          );\n          return moment().subtract(intervalInt, interval[0]).toDate();\n        }\n        return new Date();\n      }\n      if (filter.search('today') >= 0){\n        const _now = moment().endOf('day').toDate();\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if ( filter.match(/\\+/) ) {\n          const intervalInt = parseInt( filter.substring(filter.search('+') + 1, interval.index), 10 );\n          return moment(_now).add(intervalInt, interval[0]).toDate();\n        }\n        if ( filter.match(/\\-/) ) {\n          const intervalInt = parseInt(filter.substring(filter.search('-') + 1, interval.index), 10);\n          return moment(_now).subtract(intervalInt, interval[0]).toDate();\n        }\n        return _now;\n      }\n      return new Date();\n    }\n    return filter ? new Date(filter) : new Date();\n  }\n\n  changeTemporalProperty(value, position?, refreshFilter = true) {\n    let valueTmp = this.getDateTime(value, position);\n    if (position === 2 && this.calendarType() === 'date' && !this.sliderMode) {\n      /* Above month: see yearSelected or monthSelected */\n      valueTmp = moment(valueTmp).endOf('day').toDate();\n    }\n\n    if (position === 1) {\n      this.beginValue = valueTmp;\n      if (this.restrictedToStep()) {\n        this.changeTemporalProperty(this.ogcFilterTimeService.addStep(valueTmp, this.stepMilliseconds), 2, refreshFilter);\n      }\n    } else {\n      this.endValue = valueTmp;\n    }\n    this.updateHoursMinutesArray();\n    this.changeProperty.next({ value: valueTmp.toISOString(), pos: position, refreshFilter });\n  }\n\n  handleDate(value): Date {\n    if (!value || value === '') {\n      return undefined;\n    }\n    return new Date(value);\n  }\n\n  calendarType() {\n    if (this.currentFilter.calendarModeYear) {\n      return 'year';\n    }\n    if (this.stepMilliseconds < 86400000) {\n      return 'datetime';\n    }\n    return 'date';\n  }\n\n  isCalendarYearMode(): boolean {\n    if (this.calendarType() === 'year') {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  yearOnlyInputChange(changeEvent, datePicker?: any, property?: string) {\n    const year = changeEvent.target.value;\n    const dateString = `${year}-01-01T05:00:00.000Z`;\n    const dateUtc = new Date(dateString);\n    this.yearSelected(dateUtc, datePicker, property);\n  }\n\n  yearSelected(year, datePicker?: any, property?: string, refreshFilter = true) {\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      const yearInt = year.getUTCFullYear();\n      if (property === 'begin' && this.currentFilter.calendarModeYear) {\n\n        this.onlyYearBegin = yearInt;\n        // in year mode, change begin date -1 to include day 1 of same year in filter\n        const yearPast = year.getUTCFullYear() - 1;\n        year = moment().set('year', yearPast).toDate();\n        year = moment(year).endOf('year').toDate();\n      }\n      if (property === 'end') {\n        this.onlyYearEnd = yearInt;\n        // change value 01 jan to 31 dec same year\n        year = moment(year).endOf('year').toDate();\n      } else if (property === 'begin' && this.restrictedToStep()) {\n        this.yearSelected(year, undefined, 'end');\n      }\n      this.changeTemporalProperty(year, property === 'begin' ? 1 : 2, refreshFilter);\n      if (property === 'begin' && this.currentFilter.calendarModeYear) {\n        // datepicker value set to original year not year-1\n        const newMoment = moment(year).startOf('year');\n        const newDate = newMoment.set('year', year.getFullYear() + 1).toDate();\n        this.beginValue = newDate;\n      }\n    }\n  }\n\n  monthSelected(month, datePicker?: any, property?: string, refreshFilter = true) {\n    if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        month = moment(month).endOf('month').toDate();\n      } else if (property === 'begin' && this.restrictedToStep()) {\n        this.monthSelected(month, undefined, 'end');\n      }\n      this.changeTemporalProperty(month, property === 'begin' ? 1 : 2, refreshFilter);\n    }\n  }\n\n  calendarView() {\n    const test = this.stepMilliseconds;\n    const diff = Math.abs(\n      this.parseFilter(this.currentFilter.end).getTime() -\n        this.parseFilter(this.currentFilter.begin).getTime()\n    );\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      return 'multi-year';\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      return 'year';\n    } else if (test < 86400000 && diff < 86400000) {\n      return 'clock';\n    } else {\n      return 'month';\n    }\n  }\n\n  dateFilter(type: string, date: string): boolean {\n    const dateValue = new Date(date);\n    const diff = dateValue.getTime() - new Date(this.handleMin()).getTime();\n\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(moment(this.handleMin()), 'years', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'years', true);\n        return (monthDiffPlus1 % moment.duration(this.step).asYears()) === 0;\n      } else if ( type === 'begin' ) {\n        return (monthDiff % moment.duration(this.step).asYears()) === 0;\n      }\n    }\n    else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(moment(this.handleMin()), 'months', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'months', true);\n        return (monthDiffPlus1 % moment.duration(this.step).asMonths()) === 0;\n      } else if ( type === 'begin' ) {\n        return (monthDiff % moment.duration(this.step).asMonths()) === 0;\n      }\n    } else if (this.ogcFilterTimeService.stepIsWeekDuration(this.step)) {\n      const weekDiff = moment(dateValue).diff(moment(this.handleMin()), 'weeks', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const weekDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'weeks', true);\n        return (weekDiffPlus1 % moment.duration(this.step).asWeeks()) === 0;\n      } else if ( type === 'begin' ) {\n        return (weekDiff % moment.duration(this.step).asWeeks()) === 0;\n      }\n    } else if (this.ogcFilterTimeService.stepIsDayDuration(this.step)) {\n      const dayDiff = moment(dateValue).diff(moment(this.handleMin()), 'days', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const dayDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'days', true);\n        const _mod = (dayDiffPlus1 % moment.duration(this.step).asDays());\n        return (_mod < 0.0000001 && _mod > -0.0000001) || _mod === 0 ; // 1 millisecond = 1.1574074074074076e-8\n      } else if ( type === 'begin' ) {\n        const _mod = ((dayDiff % moment.duration(this.step).asDays()) + 1);\n        return (_mod < 0.0000001 && _mod > -0.0000001 && _mod !== 0) || _mod === 1 ; // 1 millisecond = 1.1574074074074076e-8\n      }\n    } else if ( this.ogcFilterTimeService.stepIsHourDuration(this.step) ) {\n      const hourDiff = moment(dateValue).diff(moment(this.handleMin()), 'hours', true);\n      return (hourDiff % moment.duration(this.step).asHours()) === 0;\n\n    } else if ( this.ogcFilterTimeService.stepIsMinuteDuration(this.step) ) {\n      return true;\n    }\n\n    return diff % this.stepMilliseconds === 0;\n  }\n\n  getDateTime(date, pos) {\n    const valuetmp = new Date(date);\n    let valuetmp2;\n    if (!this.sliderMode) {\n      switch (pos) {\n        case 1: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n            this.beginHourFormControl.value,\n            this.beginMinuteFormControl.value\n            );\n            break;\n          }\n        }\n        case 2: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n              this.endHourFormControl.value,\n              this.endMinuteFormControl.value\n            );\n            break;\n          }\n        }\n      }\n    }\n    return new Date(valuetmp2 ? valuetmp2 : valuetmp);\n  }\n\n  handleMinuteIncrement() {\n    if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\n      if (this.stepMilliseconds < 3600000) {\n        return this.stepMilliseconds / 1000 === 60 ? 1 : this.stepMilliseconds / 1000;\n      } else {\n        return (this.stepMilliseconds % 3600000) / 60;\n      }\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return 60;\n    }\n    return 1;\n  }\n\n  handleHourIncrement() {\n    if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return this.stepMilliseconds / 1000 / 60 / 60;\n    }\n    return 1;\n  }\n\n  fullBeginHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginHours = Array.from(\n        {\n          length:\n            (this.endHourFormControl.value - 0) / this.handleHourIncrement() + 1\n        },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    } else {\n      this.beginHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.beginHourFormControl.setValue(this.beginValue.getHours());\n  }\n\n  fullEndHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endHours = Array.from(\n        {\n          length:\n            (23 - this.beginHourFormControl.value) /\n              this.handleHourIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginHourFormControl.value + i * this.handleHourIncrement()\n      );\n    } else {\n      this.endHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.endHourFormControl.setValue(this.endValue.getHours());\n  }\n\n  fullBeginMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginMinutes = Array.from(\n        {\n          length:\n            (this.endMinuteFormControl.value - 0) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.beginMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.beginMinuteFormControl.setValue(this.beginValue.getMinutes());\n  }\n\n  fullEndMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endMinutes = Array.from(\n        {\n          length:\n            (59 - this.beginMinuteFormControl.value) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginMinuteFormControl.value + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.endMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.endMinuteFormControl.setValue(this.endValue.getMinutes());\n  }\n\n  updateHoursMinutesArray() {\n    const beginTmp = new Date(this.beginValue);\n    const endTmp = new Date(this.endValue);\n    if (beginTmp.setHours(0, 0) === endTmp.setHours(0, 0)) {\n      this.fullBeginHoursArray(true);\n      this.fullEndHoursArray(true);\n      if (this.beginValue.getHours() === this.endValue.getHours()) {\n        this.fullBeginMinutesArray(true);\n        this.fullEndMinutesArray(true);\n      }\n    } else {\n      this.fullBeginHoursArray();\n      this.fullEndHoursArray();\n      this.fullBeginMinutesArray();\n      this.fullEndMinutesArray();\n    }\n  }\n\n  private updateValues() {\n    this.changeTemporalProperty(this.beginValue, 1, false);\n    this.changeTemporalProperty(this.endValue, 2, true);\n  }\n\n  public restrictedToStep(): boolean {\n    return this.currentFilter.restrictToStep\n      ? this.currentFilter.restrictToStep : false;\n  }\n\n  public handleMin() {\n    return this.currentFilter.begin ? this.currentFilter.begin :\n              (this.datasource.options.minDate ? this.datasource.options.minDate : this._defaultMin);\n  }\n\n  public handleMax() {\n    return this.currentFilter.end ? this.currentFilter.end :\n              (this.datasource.options.maxDate ? this.datasource.options.maxDate : this._defaultMax);\n  }\n\n  changePropertyByPass(event) {\n    this.changeProperty.next(event);\n  }\n\n  modeChange(event) {\n    if (!event.checked) {\n      this.updateValues();\n    }\n  }\n\n}\n","import {\n  Component,\n  Input,\n  ViewChild,\n  Output,\n  EventEmitter,\n  OnInit\n} from '@angular/core';\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\n\nimport * as moment_ from 'moment';\nimport { MatSlider } from '@angular/material/slider';\nconst moment = moment_;\n\n@Component({\n  selector: 'igo-ogc-filter-time-slider',\n  templateUrl: './ogc-filter-time-slider.component.html',\n  styleUrls: ['./ogc-filter-time-slider.component.scss']\n})\nexport class OgcFilterTimeSliderComponent implements OnInit {\n  @Input() currentFilter: any;\n  @Input() begin: any;\n  @Input() max: any;\n  @Input() datasource: any;\n  @Output() changeProperty: EventEmitter<{\n    value: any;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n  @ViewChild(MatSlider) slider: MatSlider;\n\n  interval;\n  sliderValue: number = 1;\n  calculatedStep: number = 0;\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderInterval: number = 2000;\n  public playIcon = 'play-circle';\n  public resetIcon = 'replay';\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? this._defaultSliderInterval\n      : this.currentFilter.sliderInterval;\n  }\n\n  get displayFormat(): string {\n    if (this.currentFilter.sliderOptions?.displayFormat){\n      return this.currentFilter.sliderOptions.displayFormat;\n    }\n    if (this.currentFilter.displayFormat) {\n      return this.currentFilter.displayFormat;\n    }\n    return this._defaultDisplayFormat;\n  }\n\n  get beginMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.begin);\n  }\n\n  get maxMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.max);\n  }\n\n  get stepMillisecond(): number {\n    return this.ogcFilterTimeService.stepMillisecond(this.datasource, this.currentFilter);\n  }\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {\n    this.sliderDisplayWith = this.sliderDisplayWith.bind(this);\n  }\n\n  ngOnInit(){\n    this.calculateStep();\n    this.handleSliderInput({value: 1});\n  }\n\n  sliderDisplayWith(value) {\n    let dateTmp = new Date(this.beginMillisecond + ((value - 1) * this.stepMillisecond));\n\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter))) {\n      const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).years();\n      dateTmp = moment(this.beginMillisecond).add((value - 1) * toAdd, 'year').toDate();\n    } else if ( this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter))) {\n      const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).months();\n      dateTmp = moment(this.beginMillisecond).add((value - 1) * toAdd, 'month').toDate();\n    }\n\n    return moment(dateTmp).format(this.displayFormat);\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(\n        that => {\n\n          if (this.slider.value < this.calculatedStep) {\n            const _increment = '_increment';\n            const _emitInputEvent = '_emitInputEvent';\n            this.slider[_increment](1);\n            this.slider[_emitInputEvent]();\n          } else {\n            this.stopFilter();\n          }\n        },\n        this.sliderInterval,\n        this\n      );\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n  }\n\n  resetFilter(event: any) {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n    this.slider.value = 1;\n    const _increment = '_increment';\n    const _emitInputEvent = '_emitInputEvent';\n    this.slider[_emitInputEvent]();\n  }\n\n  handleSliderInput(matSliderChange) {\n    if (matSliderChange) {\n\n      if ( this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n        const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).years();\n        const dateBeginTmp = moment(this.beginMillisecond).add((matSliderChange.value - 1) * toAdd, 'year').toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'year').toDate();\n        this.changeProperty.next({value: moment(dateBeginTmp).toDate().toISOString(),\n                                    pos: 1, refreshFilter: false});\n        this.changeProperty.next({value: moment(dateEndTmp).toDate().toISOString(),\n                                    pos: 2, refreshFilter: true});\n\n      } else if ( this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n        const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).months();\n        const dateBeginTmp = moment(this.beginMillisecond).add((matSliderChange.value - 1) * toAdd, 'month').toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'month').toDate();\n        this.changeProperty.next({value: moment(dateBeginTmp).startOf('month').toDate().toISOString(),\n                                    pos: 1, refreshFilter: false});\n        this.changeProperty.next({value: moment(dateEndTmp).toDate().toISOString(),\n                                    pos: 2, refreshFilter: true});\n\n      } else if ( this.ogcFilterTimeService.stepIsDayDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ||\n          this.ogcFilterTimeService.stepIsHourDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ||\n          this.ogcFilterTimeService.stepIsMinuteDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n            const dateTmp = new Date(this.beginMillisecond + (this.stepMillisecond * (matSliderChange.value - 1)));\n            this.changeProperty.next({value: dateTmp.toISOString(), pos: 1, refreshFilter: false});\n            this.changeProperty.next({value: new Date(this.ogcFilterTimeService.addStep(dateTmp.toISOString(),\n                                        this.stepMillisecond)).toISOString(),\n                                        pos: 2, refreshFilter: true});\n      }\n    }\n  }\n\n  calculateStep(){\n    for (let i = 1; (this.maxMillisecond - (this.beginMillisecond + (i * this.stepMillisecond))) >= -1; i++) {\n      this.calculatedStep = i;\n    }\n  }\n\n}\n","<div class=\"slider-container\">\n  <mat-slider\n    id=\"time-slider\"\n    [step]=\"1\"\n    [min]=\"1\"\n    [max]=\"calculatedStep\"\n    [(ngModel)]=\"sliderValue\"\n    [displayWith]=\"sliderDisplayWith\"\n    (input)=\"handleSliderInput($event)\"\n    thumbLabel\n    >\n  </mat-slider>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n    <mat-icon [svgIcon]=\"playIcon\"></mat-icon>\n  </button>\n  <button mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\n    <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n  </button>\n  \n</div>","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule, MatNativeDateModule, MAT_DATE_LOCALE } from '@angular/material/core';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatSliderModule } from '@angular/material/slider';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatTreeModule } from '@angular/material/tree';\n\nimport {\n  MatDatetimepickerModule,\n  MatNativeDatetimeModule\n} from '@mat-datetimepicker/core';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoCollapsibleModule,\n  IgoListModule,\n  IgoKeyValueModule\n} from '@igo2/common';\nimport { IgoGeometryModule } from './../geometry/geometry.module';\n\nimport { FilterableDataSourcePipe } from './shared/filterable-datasource.pipe';\nimport { IgoLayerModule } from '../layer/layer.module';\nimport { TimeFilterButtonComponent } from './time-filter-button/time-filter-button.component';\nimport { TimeFilterFormComponent } from './time-filter-form/time-filter-form.component';\nimport { TimeFilterItemComponent } from './time-filter-item/time-filter-item.component';\nimport { TimeFilterListBindingDirective } from './time-filter-list/time-filter-list-binding.directive';\nimport { TimeFilterListComponent } from './time-filter-list/time-filter-list.component';\nimport { TimeFilterService } from './shared/time-filter.service';\n\nimport { OgcFilterFormComponent } from './ogc-filter-form/ogc-filter-form.component';\nimport { OgcFilterableFormComponent } from './ogc-filterable-form/ogc-filterable-form.component';\nimport { OgcFilterableItemComponent } from './ogc-filterable-item/ogc-filterable-item.component';\nimport { OgcFilterableListBindingDirective } from './ogc-filterable-list/ogc-filterable-list-binding.directive';\nimport { OgcFilterableListComponent } from './ogc-filterable-list/ogc-filterable-list.component';\nimport { OgcFilterButtonComponent } from './ogc-filter-button/ogc-filter-button.component';\nimport { OGCFilterService } from './shared/ogc-filter.service';\nimport { OGCFilterTimeService } from './shared/ogc-filter-time.service';\nimport { OgcFilterSelectionComponent } from './ogc-filter-selection/ogc-filter-selection.component';\n\nimport { SpatialFilterTypeComponent } from './spatial-filter/spatial-filter-type/spatial-filter-type.component';\nimport { SpatialFilterListComponent } from './spatial-filter/spatial-filter-list/spatial-filter-list.component';\nimport { SpatialFilterItemComponent } from './spatial-filter/spatial-filter-item/spatial-filter-item.component';\nimport { SpatialFilterService } from './shared/spatial-filter.service';\nimport { OgcFilterTimeComponent } from './ogc-filter-time/ogc-filter-time.component';\nimport { OgcFilterTimeSliderComponent } from './ogc-filter-time/ogc-filter-time-slider.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatAutocompleteModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTabsModule,\n    MatRadioModule,\n    MatMenuModule,\n    MatTableModule,\n    MatTreeModule,\n    MatButtonToggleModule,\n    MatCheckboxModule,\n    MatSliderModule,\n    MatSlideToggleModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatOptionModule,\n    MatSelectModule,\n    MatListModule,\n    MatTooltipModule,\n    MatDatepickerModule,\n    MatNativeDateModule,\n    MatDatetimepickerModule,\n    MatNativeDatetimeModule,\n    IgoLanguageModule,\n    IgoLayerModule,\n    IgoCollapsibleModule,\n    IgoListModule,\n    IgoKeyValueModule,\n    IgoGeometryModule,\n    MatBadgeModule\n  ],\n  exports: [\n    FilterableDataSourcePipe,\n    TimeFilterButtonComponent,\n    TimeFilterFormComponent,\n    TimeFilterItemComponent,\n    TimeFilterListComponent,\n    TimeFilterListBindingDirective,\n    OgcFilterFormComponent,\n    OgcFilterButtonComponent,\n    OgcFilterSelectionComponent,\n    OgcFilterableFormComponent,\n    OgcFilterableItemComponent,\n    OgcFilterableListComponent,\n    OgcFilterableListBindingDirective,\n    SpatialFilterTypeComponent,\n    SpatialFilterListComponent,\n    SpatialFilterItemComponent,\n    OgcFilterTimeComponent,\n    OgcFilterTimeSliderComponent\n  ],\n  declarations: [\n    FilterableDataSourcePipe,\n    TimeFilterButtonComponent,\n    TimeFilterFormComponent,\n    TimeFilterItemComponent,\n    TimeFilterListComponent,\n    TimeFilterListBindingDirective,\n    OgcFilterFormComponent,\n    OgcFilterButtonComponent,\n    OgcFilterSelectionComponent,\n    OgcFilterableFormComponent,\n    OgcFilterableItemComponent,\n    OgcFilterableListComponent,\n    OgcFilterableListBindingDirective,\n    SpatialFilterTypeComponent,\n    SpatialFilterListComponent,\n    SpatialFilterItemComponent,\n    OgcFilterTimeComponent,\n    OgcFilterTimeSliderComponent\n  ],\n  providers: [TimeFilterService, OGCFilterService, OGCFilterTimeService, SpatialFilterService]\n})\nexport class IgoFilterModule {\n  static forRoot(): ModuleWithProviders<IgoFilterModule> {\n    return {\n      ngModule: IgoFilterModule,\n      providers: [\n        {\n          provide: MAT_DATE_LOCALE,\n          useValue: 'fr-FR'\n        }\n      ]\n    };\n  }\n}\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const ExportFormat = strEnum(['URL', 'GeoJSON', 'GML', 'GPX', 'KML', 'Shapefile', 'CSVcomma', 'CSVsemicolon']);\nexport type ExportFormat = keyof typeof ExportFormat;\n\nexport const EncodingFormat = strEnum(['UTF8', 'LATIN1']);\nexport type EncodingFormat = keyof typeof EncodingFormat;\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport { downloadContent } from '@igo2/utils';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport * as olformat from 'ol/format';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { ExportFormat, EncodingFormat } from './export.type';\n\nimport {\n  ExportInvalidFileError,\n  ExportNothingToExportError\n} from './export.errors';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ExportService {\n  static ogreFormats = {\n    GML: 'gml',\n    GPX: 'gpx',\n    KML: 'kml',\n    Shapefile: 'ESRI Shapefile',\n    CSVcomma: 'CSVcomma',\n    CSVsemicolon: 'CSVsemicolon'\n  };\n\n  static noOgreFallbacks = ['GML', 'GPX', 'KML'];\n\n  private ogreUrl: string;\n  private aggregateInComment: boolean = true;\n\n  constructor(private config: ConfigService) {\n    this.ogreUrl = this.config.getConfig('importExport.url');\n    const gpxAggregateInComment = this.config.getConfig(\n      'importExport.gpxAggregateInComment'\n    );\n    if (gpxAggregateInComment !== undefined) {\n      this.aggregateInComment = gpxAggregateInComment;\n    }\n  }\n\n  export(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<void> {\n    const exportOlFeatures = this.generateFeature(olFeatures, format);\n\n    return this.exportAsync(exportOlFeatures, format, title, encoding, projectionIn, projectionOut);\n  }\n\n  private generateFeature(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat\n  ): OlFeature<OlGeometry>[] {\n    if (format === ExportFormat.GPX && this.aggregateInComment) {\n      return this.generateAggregatedFeature(olFeatures);\n    }\n\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      const keys = olFeature\n        .getKeys()\n        .filter((key: string) => !key.startsWith('_'));\n      const properties = keys.reduce(\n        (acc: object, key: string) => {\n          acc[key] = olFeature.get(key);\n          return acc;\n        },\n        { geometry: olFeature.getGeometry() }\n      );\n      return new OlFeature(properties);\n    });\n  }\n\n  private generateAggregatedFeature(olFeatures: OlFeature<OlGeometry>[]): OlFeature<OlGeometry>[] {\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      const keys = olFeature.getKeys().filter((key: string) => !key.startsWith('_'));\n      let comment: string = '';\n      const properties = keys.reduce((acc: object, key: string) => {\n        if (key && key !== 'geometry') {\n          key === 'id' && olFeature.get('draw') ? comment += key + ':' + olFeature.get('draw') + '   \\r\\n'\n          : comment += key + ':' + olFeature.get(key) + '   \\r\\n';\n        }\n        acc[key] = olFeature.get(key);\n        return acc;\n      },\n      {\n        geometry: olFeature.getGeometry()\n      });\n      const newFeature = new OlFeature(properties);\n      newFeature.set('name', olFeature.getId());\n      newFeature.set('cmt', comment);\n\n      return newFeature;\n    });\n  }\n\n  private exportAsync(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<void> {\n    const doExport = (observer: Observer<void>) => {\n      const nothingToExport = this.nothingToExport(olFeatures, format);\n      if (nothingToExport) {\n        observer.error(new ExportNothingToExportError());\n        return;\n      }\n\n      const ogreFormats = Object.keys(ExportService.ogreFormats);\n      if (ogreFormats.indexOf(format) >= 0) {\n        if (!this.ogreUrl) {\n          if (ExportService.noOgreFallbacks.indexOf(format) >= 0) {\n            this.exportToFile(olFeatures, observer, format, title, projectionIn, projectionOut);\n          } else {\n            observer.error(new ExportInvalidFileError());\n          }\n          return;\n        }\n        this.exportWithOgre(olFeatures, observer, format, title, encoding, projectionIn, projectionOut);\n      } else {\n        this.exportToFile(olFeatures, observer, format, title, projectionIn, projectionOut);\n      }\n    };\n\n    return new Observable(doExport);\n  }\n\n  protected exportToFile(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: ExportFormat,\n    title: string,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const olFormat = new olformat[format]();\n    const featuresText = olFormat.writeFeatures(olFeatures, {\n      dataProjection: projectionOut,\n      featureProjection: projectionIn,\n      featureType: 'feature',\n      featureNS: 'http://example.com/feature'\n    });\n\n    const fileName = `${title}.${format.toLowerCase()}`;\n\n    downloadContent(featuresText, 'text/plain;charset=utf-8', fileName);\n    observer.complete();\n  }\n\n  private exportWithOgre(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: string,\n    title: string,\n    encodingType: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const featuresText: string = new olformat.GeoJSON().writeFeatures(\n      olFeatures,\n      {\n        dataProjection: projectionOut,\n        featureProjection: projectionIn\n      }\n    );\n\n    const url = `${this.ogreUrl}/convertJson`;\n    const form = document.createElement('form');\n    form.style.display = 'none';\n    document.body.appendChild(form);\n    form.setAttribute('method', 'post');\n    form.setAttribute('target', '_blank');\n    form.setAttribute('action', url);\n\n    if (encodingType === EncodingFormat.UTF8) {\n      form.acceptCharset = 'UTF-8';\n      form.enctype = 'application/x-www-form-urlencoded; charset=utf-8;';\n    } else if (encodingType === EncodingFormat.LATIN1) {\n      const enctype = 'ISO-8859-1';\n      const encoding = document.createElement('input');\n      encoding.setAttribute('type', 'hidden');\n      encoding.setAttribute('name', 'encoding');\n      encoding.setAttribute('value', enctype);\n      form.appendChild(encoding);\n    }\n\n    if (format === 'CSVsemicolon') {\n      const options = document.createElement('input');\n      options.setAttribute('type', 'hidden');\n      options.setAttribute('name', 'lco');\n      options.setAttribute('value', 'SEPARATOR=SEMICOLON');\n      form.appendChild(options);\n    }\n\n    const geojsonField = document.createElement('input');\n    geojsonField.setAttribute('type', 'hidden');\n    geojsonField.setAttribute('name', 'json');\n    geojsonField.setAttribute('value', featuresText);\n    form.appendChild(geojsonField);\n\n    const outputNameField = document.createElement('input');\n    let outputName = format === 'Shapefile' ? `${title}.zip` : `${title}.${format.toLowerCase()}`;\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      outputName = `${title}.csv`;\n    }\n    outputName = outputName.replace(' ', '_');\n    outputName = outputName.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n    outputNameField.setAttribute('type', 'hidden');\n    outputNameField.setAttribute('name', 'outputName');\n    outputNameField.setAttribute('value', outputName);\n    form.appendChild(outputNameField);\n\n    let ogreFormat = ExportService.ogreFormats[format];\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      ogreFormat = 'CSV';\n    }\n    const outputFormatField = document.createElement('input');\n    outputFormatField.setAttribute('type', 'hidden');\n    outputFormatField.setAttribute('name', 'format');\n    outputFormatField.setAttribute('value', ogreFormat);\n    form.appendChild(outputFormatField);\n\n    form.submit();\n    document.body.removeChild(form);\n\n    observer.complete();\n  }\n\n  private nothingToExport(olFeatures: OlFeature<OlGeometry>[], format: string): boolean {\n    if (olFeatures.length === 0) {\n      return true;\n    }\n    if (format === 'GPX') {\n      const pointOrLine = olFeatures.find(olFeature => {\n        return (\n          ['Point', 'LineString', 'MultiLineString'].indexOf(olFeature.getGeometry().getType()) >= 0\n        );\n      });\n      return pointOrLine === undefined;\n    }\n    return false;\n  }\n}\n","/**\n * Trigger download of a file\n *\n * @param content File content\n * @param mimeType File mime type\n * @param fileName File name\n */\nexport function downloadContent(content: string, mimeType: string, fileName: string) {\n  const uri = `data:${mimeType},${encodeURIComponent(content)}`;\n  downloadFromUri(uri, fileName);\n}\n\n/**\n * Trigger download of a file\n *\n * @param content File content\n * @param mimeType File mime type\n * @param fileName File name\n */\nexport function downloadFromUri(uri: string, fileName: string) {\n  const element = document.createElement('a');\n  element.setAttribute('href', uri);\n  element.setAttribute('download', fileName);\n  element.style.display = 'none';\n  document.body.appendChild(element);\n\n  element.click();\n\n  document.body.removeChild(element);\n}\n","import * as olStyle from 'ol/style';\n\nimport { MessageService, LanguageService } from '@igo2/core';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { FeatureDataSourceOptions } from '../../datasource/shared/datasources/feature-datasource.interface';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  featureToOl,\n  moveToOlFeatures\n} from '../../feature/shared/feature.utils';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { StyleByAttribute } from '../../layer/shared/vector-style.interface';\nimport { StyleListService } from '../style-list/style-list.service';\nimport { ClusterParam } from '../../layer/shared/clusterParam';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { ClusterDataSourceOptions } from '../../datasource/shared/datasources/cluster-datasource.interface';\n\nexport function addLayerAndFeaturesToMap(\n  features: Feature[],\n  map: IgoMap,\n  layerTitle: string\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n\n  const r = Math.floor(Math.random() * 255);\n  const g = Math.floor(Math.random() * 255);\n  const b = Math.floor(Math.random() * 255);\n  const stroke = new olStyle.Stroke({\n    color: [r, g, b, 1],\n    width: 2\n  });\n\n  const fill = new olStyle.Fill({\n    color: [r, g, b, 0.4]\n  });\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n    type: 'vector',\n    queryable: true\n  };\n  const source = new FeatureDataSource(sourceOptions);\n  source.ol.addFeatures(olFeatures);\n  const layer = new VectorLayer({\n    title: layerTitle,\n    source,\n    style: new olStyle.Style({\n      stroke,\n      fill,\n      image: new olStyle.Circle({\n        radius: 5,\n        stroke,\n        fill\n      })\n    })\n  });\n  map.addLayer(layer);\n  moveToOlFeatures(map, olFeatures);\n\n  return layer;\n}\n\nexport function addLayerAndFeaturesStyledToMap(\n  features: Feature[],\n  map: IgoMap,\n  layerTitle: string,\n  styleListService: StyleListService,\n  styleService: StyleService\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n  let style;\n  let distance: number;\n\n  if (\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\n  ) {\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\n      layerTitle.toString() + '.styleByAttribute'\n    );\n\n    style = feature => {\n      return styleService.createStyleByAttribute(feature, styleByAttribute);\n    };\n  } else if (\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      layerTitle.toString() + '.clusterParam'\n    );\n    distance = styleListService.getStyleList(\n      layerTitle.toString() + '.distance'\n    );\n\n    const baseStyle = styleService.createStyle(\n      styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n    );\n\n    style = feature => {\n      return styleService.createClusterStyle(feature, clusterParam, baseStyle);\n    };\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\n    style = styleService.createStyle(\n      styleListService.getStyleList(layerTitle.toString() + '.style')\n    );\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      'default.clusterParam'\n    );\n    distance = styleListService.getStyleList('default.distance');\n\n    const baseStyle = styleService.createStyle(\n      styleListService.getStyleList('default.clusterStyle')\n    );\n\n    style = feature => {\n      return styleService.createClusterStyle(feature, clusterParam, baseStyle);\n    };\n  } else {\n    style = styleService.createStyle(\n      styleListService.getStyleList('default.style')\n    );\n  }\n\n  let source;\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\n    const sourceOptions: ClusterDataSourceOptions &\n      QueryableDataSourceOptions = {\n      distance,\n      type: 'cluster',\n      queryable: true\n    };\n    source = new ClusterDataSource(sourceOptions);\n    source.ol.source.addFeatures(olFeatures);\n  } else if (styleListService.getStyleList(layerTitle.toString())) {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n      type: 'vector',\n      queryable: true\n    };\n    source = new FeatureDataSource(sourceOptions);\n    source.ol.addFeatures(olFeatures);\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const sourceOptions: ClusterDataSourceOptions &\n      QueryableDataSourceOptions = {\n      distance,\n      type: 'cluster',\n      queryable: true\n    };\n    source = new ClusterDataSource(sourceOptions);\n    source.ol.source.addFeatures(olFeatures);\n  } else {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n      type: 'vector',\n      queryable: true\n    };\n    source = new FeatureDataSource(sourceOptions);\n    source.ol.addFeatures(olFeatures);\n  }\n\n  const layer = new VectorLayer({\n    title: layerTitle,\n    source,\n    style\n  });\n  map.addLayer(layer);\n  moveToOlFeatures(map, olFeatures);\n\n  return layer;\n}\n\nexport function handleFileImportSuccess(\n  file: File,\n  features: Feature[],\n  map: IgoMap,\n  messageService: MessageService,\n  languageService: LanguageService,\n  styleListService?: StyleListService,\n  styleService?: StyleService\n) {\n  if (features.length === 0) {\n    handleNothingToImportError(file, messageService, languageService);\n    return;\n  }\n\n  const layerTitle = computeLayerTitleFromFile(file);\n\n  if (!styleListService) {\n    addLayerAndFeaturesToMap(features, map, layerTitle);\n  } else {\n    addLayerAndFeaturesStyledToMap(\n      features,\n      map,\n      layerTitle,\n      styleListService,\n      styleService\n    );\n  }\n\n  const translate = languageService.translate;\n  const messageTitle = translate.instant('igo.geo.dropGeoFile.success.title');\n  const message = translate.instant('igo.geo.dropGeoFile.success.text', {\n    value: layerTitle\n  });\n  messageService.success(message, messageTitle);\n}\n\nexport function handleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService,\n  sizeMb?: number\n) {\n  sizeMb = sizeMb ? sizeMb : 30;\n  const errMapping = {\n    'Invalid file': handleInvalidFileImportError,\n    'File is too large': handleSizeFileImportError,\n    'Failed to read file': handleUnreadbleFileImportError,\n    'Invalid SRS definition': handleSRSImportError,\n    'Error 500 with OGRE': handleOgreServerImportError\n  };\n  errMapping[error.message](\n    file,\n    error,\n    messageService,\n    languageService,\n    sizeMb\n  );\n}\n\nexport function handleInvalidFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.invalid.title');\n  const message = translate.instant('igo.geo.dropGeoFile.invalid.text', {\n    value: file.name,\n    mimeType: file.type\n  });\n  messageService.error(message, title);\n}\n\nexport function handleUnreadbleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.unreadable.title');\n  const message = translate.instant('igo.geo.dropGeoFile.unreadable.text', {\n    value: file.name\n  });\n  messageService.error(message, title);\n}\n\nexport function handleSizeFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService,\n  sizeMb: number\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.tooLarge.title');\n  const message = translate.instant('igo.geo.dropGeoFile.tooLarge.text', {\n    value: file.name,\n    size: sizeMb\n  });\n  messageService.error(message, title);\n}\n\nexport function handleNothingToImportError(\n  file: File,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.empty.title');\n  const message = translate.instant('igo.geo.dropGeoFile.empty.text', {\n    value: file.name,\n    mimeType: file.type\n  });\n  messageService.error(message, title);\n}\n\nexport function handleSRSImportError(\n  file: File,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.invalidSRS.title');\n  const message = translate.instant('igo.geo.dropGeoFile.invalidSRS.text', {\n    value: file.name,\n    mimeType: file.type\n  });\n  messageService.error(message, title);\n}\n\nexport function handleOgreServerImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const title = languageService.translate.instant('igo.geo.dropGeoFile.ogreServer.title');\n  const message = languageService.translate.instant('igo.geo.dropGeoFile.ogreServer.text');\n  messageService.error(message, title);\n}\n\nexport function getFileExtension(file: File): string {\n  return file.name\n    .split('.')\n    .pop()\n    .toLowerCase();\n}\n\nexport function computeLayerTitleFromFile(file: File): string {\n  return file.name.substr(0, file.name.lastIndexOf('.'));\n}\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n      super('Failed to read file');\n      Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n      super('Nothing to import');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n      super('File is too large');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n      super('Invalid SRS definition');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportOgreServerError extends ImportError {\n  constructor() {\n      super('Error 500 with OGRE');\n      Object.setPrototypeOf(this, ImportOgreServerError.prototype);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\nimport { uuid } from '@igo2/utils';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport * as olformat from 'ol/format';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  ImportInvalidFileError,\n  ImportUnreadableFileError,\n  ImportSizeError,\n  ImportSRSError,\n  ImportOgreServerError\n} from './import.errors';\nimport { computeLayerTitleFromFile, getFileExtension } from './import.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ImportService {\n  static allowedMimeTypes = [\n    'application/gml+xml',\n    'application/vnd.google-earth.kml+xml',\n    'application/gpx+xml',\n    'application/json'\n  ];\n\n  static allowedZipMimeTypes = [\n    'application/zip',\n    'application/x-zip-compressed',\n    'application/x-zip'\n  ];\n\n  static allowedExtensions = ['geojson', 'kml', 'gpx', 'json', 'gml'];\n\n  private ogreUrl: string;\n  private clientSideFileSizeMax: number;\n\n  constructor(private http: HttpClient, private config: ConfigService) {\n    this.ogreUrl = this.config.getConfig('importExport.url');\n    const configFileSizeMb = this.config.getConfig('importExport.clientSideFileSizeMaxMb');\n    this.clientSideFileSizeMax = (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n  }\n\n  import(\n    file: File,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<Feature[]> {\n    return this.importAsync(file, projectionIn, projectionOut);\n  }\n\n  private getFileImporter(\n    file: File\n  ): (\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) => void {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n    const allowedMimeTypes = [\n      ...ImportService.allowedMimeTypes,\n      ...ImportService.allowedZipMimeTypes\n    ];\n    const allowedExtensions = ImportService.allowedExtensions;\n\n    if (\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\n      allowedExtensions.indexOf(extension) < 0\n    ) {\n      return undefined;\n    } else if (\n      mimeType === 'application/json' ||\n      ['json', 'geojson', 'kml', 'gpx'].indexOf(extension) >= 0\n    ) {\n      return this.importFile;\n    } else if (this.ogreUrl !== undefined) {\n      return this.importFileWithOgre;\n    }\n\n    return undefined;\n  }\n\n  private importAsync(\n    file: File,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<Feature[]> {\n    const doImport = (observer: Observer<Feature[]>) => {\n      if (file.size >= this.clientSideFileSizeMax) {\n        observer.error(new ImportSizeError());\n        return;\n      }\n      const importer = this.getFileImporter(file);\n      if (importer === undefined) {\n        observer.error(new ImportInvalidFileError());\n        return;\n      }\n\n      importer.call(this, file, observer, projectionIn, projectionOut);\n    };\n\n    return new Observable(doImport);\n  }\n\n  private importFile(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const reader = new FileReader();\n\n    reader.onload = (event: any) => {\n      try {\n        const features = this.parseFeaturesFromFile(\n          file,\n          event.target.result,\n          projectionIn,\n          projectionOut\n        );\n        observer.next(features);\n      } catch (e) {\n        observer.error(new ImportUnreadableFileError());\n      }\n\n      observer.complete();\n    };\n\n    reader.onerror = evt => {\n      observer.error(new ImportUnreadableFileError());\n    };\n\n    reader.readAsText(file, 'UTF-8');\n  }\n\n  private importFileWithOgre(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const url = `${this.ogreUrl}/convert`;\n    const formData = new FormData();\n    formData.append('upload', file);\n    formData.append('sourceSrs', projectionIn);\n    formData.append('targetSrs', projectionOut);\n    formData.append('formatOutput', 'GEOJSON');\n    formData.append('skipFailures', '');\n\n    this.http.post(url, formData, { headers: new HttpHeaders() })\n    .subscribe(\n      (response: { errors?: string[] } | object | null) => {\n        if (response === null) {\n          observer.error(new ImportUnreadableFileError());\n          return;\n        }\n\n        const errors = (response as any).errors || [];\n        if (errors.length > 0) {\n          observer.error(new ImportUnreadableFileError());\n        } else {\n          const features = this.parseFeaturesFromGeoJSON(\n            file,\n            response,\n            projectionOut\n          );\n          observer.next(features);\n          observer.complete();\n        }\n      },\n      (error: any) => {\n        error.error.caught = true;\n        const errMsg = error.error.msg || '';\n        if (errMsg === 'No valid files found') {\n          observer.error(new ImportInvalidFileError());\n        } else if (errMsg && errMsg.startWith('ERROR 1: Failed to process SRS definition')\n        ) {\n          observer.error(new ImportSRSError());\n        } else if (error.status === 500) {\n          observer.error(new ImportOgreServerError());\n        } else {\n          observer.error(new ImportUnreadableFileError());\n        }\n      }\n    );\n  }\n\n  private parseFeaturesFromFile(\n    file: File,\n    data: string,\n    projectionIn: string,\n    projectionOut: string\n  ): Feature[] {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n\n    const GeoJSON = new olformat.GeoJSON();\n\n    let format;\n    if (mimeType === 'application/vnd.google-earth.kml+xml') {\n      format = new olformat.KML();\n    } else if (mimeType === 'application/gml+xml') {\n      format = new olformat.GML();\n    } else if (mimeType === 'application/gpx+xml') {\n      format = new olformat.GPX();\n    } else {\n      switch (extension) {\n        case 'kml':\n          format = new olformat.KML();\n          break;\n        case 'gpx':\n          format = new olformat.GPX();\n          break;\n        case 'gml':\n          format = new olformat.GML();\n          break;\n        default:\n          format = GeoJSON;\n          break;\n      }\n    }\n\n    const olFeatures = format.readFeatures(data, {\n      dataProjection: projectionIn,\n      featureProjection: projectionOut\n    });\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(GeoJSON.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features;\n  }\n\n  private parseFeaturesFromGeoJSON(\n    file: File,\n    data: object,\n    projectionOut: string\n  ): Feature[] {\n    const olFormat = new olformat.GeoJSON();\n    const olFeatures = olFormat.readFeatures(data);\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(olFormat.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features as Feature[];\n  }\n}\n","import { Injectable, Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { StyleListOptions } from './style-list.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleListService {\n  private styleList: object = {};\n\n  constructor(private injector: Injector) {}\n\n  /**\n   * Use to get the data found in styleList file\n   */\n  public getStyleList(key: string): any {\n    return ObjectUtils.resolve(this.styleList, key);\n  }\n\n  /**\n   * This method loads \"[path]\" to get all styleList's variables\n   */\n  public load(options: StyleListOptions) {\n    const baseStyleList = options.default || {};\n    if (!options.path) {\n      this.styleList = baseStyleList;\n      return true;\n    }\n\n    const http = this.injector.get(HttpClient);\n\n    return new Promise((resolve, _reject) => {\n      http\n        .get(options.path)\n        .pipe(\n          catchError((error: any): any => {\n            console.log(`StyleList file ${options.path} could not be read`);\n            resolve(true);\n            return throwError(error.error || 'Server error');\n          })\n        )\n        .subscribe((styleListResponse: object) => {\n          this.styleList = ObjectUtils.mergeDeep(baseStyleList, styleListResponse);\n          resolve(true);\n        });\n    });\n  }\n}\n","<div class=\"import-export-toggle mat-typography\">\n  <mat-button-toggle-group\n        [value]=\"selectedMode\"\n        (change)=\"onImportExportChange($event)\">\n        <mat-button-toggle [value]=\"'import'\">\n          {{'igo.geo.importExportForm.importTabTitle' | translate}}\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"'export'\">\n          {{'igo.geo.importExportForm.exportTabTitle' | translate}}\n        </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<form class=\"igo-form\" [formGroup]=\"importForm\" *ngIf=\"selectedMode === 'import'\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.importProjPlaceholder' | translate}}</mat-label>\n      <mat-select\n        [(value)]=\"inputProj\">\n        <mat-option\n          *ngFor=\"let projection of (projections$ | async)\"\n          [value]=\"projection\"\n          (click)=\"$event.stopPropagation()\">\n          <p mat-line *ngIf=\"projection.translateKey\">{{('igo.geo.importExportForm.projections.' + projection.translateKey) | translate: projection}}</p>\n          <p mat-line *ngIf=\"!projection.translateKey\">{{projection.alias}}</p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"importForm.invalid ? ('igo.geo.importExportForm.projections.choose' | translate) : ('igo.geo.importExportForm.importButton' | translate)\"\n    class=\"igo-form-button-group\">\n    <button\n      [disabled]=\"importForm.invalid || (loading$ | async)\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"fileInput.click()\">\n        {{'igo.geo.importExportForm.importButton' | translate}}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n    <input\n      hidden\n      #fileInput\n      type=\"file\"\n      [style.display]=\"'none'\"\n      (click)=\"fileInput.value = null\"\n      (change)=\"importFiles($event.target.files)\">\n  </div>\n</form>\n<section class=\"mat-typography\" *ngIf=\"selectedMode === 'import'\">\n  <h4>{{'igo.geo.importExportForm.importClarifications' | translate}}</h4>\n  <ul>\n    <li>{{'igo.geo.importExportForm.importSizeMax' | translate: {size: fileSizeMb} }}</li>\n    <li>{{'igo.geo.importExportForm.importFormatAuthorized' | translate}}</li>\n    <li>{{'igo.geo.importExportForm.importShpZip' | translate}}</li>\n  </ul>\n</section>\n\n<section class=\"mat-typography\" *ngIf=\"(exportableLayers$ | async).length === 0 && selectedMode === 'export'\">\n  <h4>{{'igo.geo.importExportForm.exportNoLayersExportable' | translate}}</h4>\n</section>\n\n<form class=\"igo-form\" [formGroup]=\"form\" *ngIf=\"(exportableLayers$ | async).length > 0 && selectedMode === 'export'\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.exportLayerPlaceholder' | translate}}</mat-label>\n      <mat-select\n        [(value)]=\"layers\" multiple>\n        <mat-select-trigger>\n          {{layers.length ? getLayerTitleById(layers[0]) : ''}}\n          <span *ngIf=\"layers.length > 1\" class=\"export-select-trigger\">\n            (+{{layers.length - 1}} {{(layers?.length === 2 ? 'igo.geo.importExportForm.other' : 'igo.geo.importExportForm.others') | translate }})\n          </span>\n        </mat-select-trigger>\n        <mat-option\n          *ngFor=\"let layer of (exportableLayers$ | async)\"\n          [ngClass]=\"{'igo-export-layer-mat-option': layerHasSelectedFeatures(layer)}\"\n          [value]=\"layer.id\"\n          (click)=\"$event.stopPropagation()\">\n          <p mat-line>{{layer.title}}</p>\n          <p mat-line>\n            <mat-slide-toggle *ngIf=\"layerHasSelectedFeatures(layer)\"\n              [labelPosition]=\"'after'\"\n              (click)=\"onlySelectedClick($event,layer.id)\"\n              (checked)=\"inLayersIdToExportSelectionOnly(layer)\"\n              (change)=\"onlySelected($event,layer.id)\">\n              <small>{{'igo.geo.importExportForm.exportSelectedFeature' | translate}}</small>\n            </mat-slide-toggle>\n          </p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.exportFormatPlaceholder' | translate}}</mat-label>\n      <mat-select\n        formControlName=\"format\">\n        <ng-container *ngIf=\"(formats$ | async).length !== 0\">\n          <mat-option *ngFor=\"let format of (formats$ | async) | keyvalue\" [value]=\"format.key\">\n            {{'igo.geo.export.format.' + format.value | translate}}\n          </mat-option>\n        </ng-container>\n        <mat-option *ngIf=\"(formats$ | async).length === 0\" disabled=\"true\">\n          {{'igo.geo.export.noFormat.title' | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" *ngIf=\"forceNaming && form.value.format !== 'URL'\">\n    <mat-form-field>\n        <input matInput formControlName=\"name\" placeholder=\"{{'igo.geo.importExportForm.exportFileNamePlaceholder' | translate}}\">\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" *ngIf=\"form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon'\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.encodingPlaceholder' | translate}}</mat-label>\n      <mat-select\n        formControlName=\"encoding\">\n        <ng-container *ngIf=\"(encodings$ | async).length !== 0\">\n          <mat-option *ngFor=\"let encoding of (encodings$ | async) | keyvalue\" [value]=\"encoding.key\">\n            {{'igo.geo.export.encoding.' + encoding.value | translate}}\n          </mat-option>\n        </ng-container>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"export-options mat-typography\" *ngIf=\"form.value.format !== 'URL'\">\n    <mat-slide-toggle\n        formControlName=\"featureInMapExtent\"\n        [labelPosition]=\"'before'\">\n          {{'igo.geo.importExportForm.exportFeatureInExtent' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (loading$ | async)\"\n      (click)=\"handleExportFormSubmit(form.value)\">\n      {{form.value.format !== 'URL'  ? ('igo.geo.importExportForm.exportButton' | translate): (form.value.layers.length > 1  ? ('igo.geo.importExportForm.exportButtonLinks' | translate): ('igo.geo.importExportForm.exportButtonLink' | translate))}}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n  </div>\n\n</form>\n","import {\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  EventEmitter,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { FormGroup, FormBuilder, Validators } from '@angular/forms';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport {\n  MessageService,\n  LanguageService,\n  ConfigService,\n  StorageService\n} from '@igo2/core';\nimport { strEnum } from '@igo2/utils';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { IgoMap } from '../../map/shared/map';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\nimport olPoint from 'ol/geom/Point';\nimport { circular } from 'ol/geom/Polygon';\n\nimport {\n  handleFileExportError,\n  handleFileExportSuccess\n} from '../shared/export.utils';\nimport { ExportOptions } from '../shared/export.interface';\nimport { ExportFormat, EncodingFormat } from '../shared/export.type';\nimport { ExportService } from '../shared/export.service';\nimport { ImportService } from '../shared/import.service';\nimport {\n  handleFileImportSuccess,\n  handleFileImportError\n} from '../shared/import.utils';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { StyleListService } from '../style-list/style-list.service';\nimport { skipWhile } from 'rxjs/operators';\nimport { EntityRecord, Workspace } from '@igo2/common';\nimport type { WorkspaceStore } from '@igo2/common';\nimport { WfsWorkspace } from '../../workspace/shared/wfs-workspace';\nimport { FeatureWorkspace } from '../../workspace/shared/feature-workspace';\nimport { MatSlideToggleChange } from '@angular/material/slide-toggle';\nimport { InputProjections, ProjectionsLimitationsOptions } from '../../map/';\nimport { DownloadService } from '../../download/shared/download.service';\nimport { computeProjectionsConstraints } from '../../map';\n\nimport olVectorSource from 'ol/source/Vector';\nimport olClusterSource from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Component({\n  selector: 'igo-import-export',\n  templateUrl: './import-export.component.html',\n  styleUrls: ['./import-export.component.scss']\n})\nexport class ImportExportComponent implements OnDestroy, OnInit {\n  public form: FormGroup;\n  public importForm: FormGroup;\n  public formats$ = new BehaviorSubject(undefined);\n  public encodings$ = new BehaviorSubject(undefined);\n  public exportableLayers$: BehaviorSubject<AnyLayer[]> = new BehaviorSubject(\n    []\n  );\n  public loading$ = new BehaviorSubject(false);\n  public forceNaming = false;\n  public controlFormat = 'format';\n\n  private layers$$: Subscription;\n  private exportableLayers$$: Subscription;\n  private formats$$: Subscription;\n  private encodings$$: Subscription;\n  private formLayer$$: Subscription;\n  private exportOptions$$: Subscription;\n\n\n  private espgCodeRegex = new RegExp('^\\\\d{4,6}');\n  private clientSideFileSizeMax: number;\n  public fileSizeMb: number;\n\n  public projections$: BehaviorSubject<InputProjections[]> = new BehaviorSubject([]);\n  private projectionsConstraints: ProjectionsLimitationsOptions;\n\n  public popupChecked: boolean = false;\n\n  private previousLayerSpecs$: BehaviorSubject<\n    {\n      id: string;\n      visible: boolean;\n      opacity: number;\n      queryable: boolean;\n    }[]\n  > = new BehaviorSubject(undefined);\n\n  @Input() selectFirstProj: boolean = false;\n\n  @Input() map: IgoMap;\n\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\n  @Input()\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\n    this._projectionsLimitations = value;\n    this.computeProjections();\n  }\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\n    return this._projectionsLimitations || {};\n  }\n\n  /**\n   * Store that holds the available workspaces.\n   */\n  @Input() store: WorkspaceStore;\n\n  @Input() selectedMode = 'import';\n\n  @Output() selectMode = new EventEmitter<string>();\n\n  @Input() exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\n    undefined\n  );\n\n  @Output() exportOptionsChange = new EventEmitter<ExportOptions>();\n\n  get layers() {\n    return this.form.get('layers').value;\n  }\n  set layers(value) {\n    this.form.patchValue({ layers: value });\n  }\n\n  get inputProj() {\n    return this.importForm.get('inputProj').value;\n  }\n  set inputProj(value) {\n    this.importForm.patchValue({ inputProj: value });\n  }\n\n  get popupAllowed(): boolean {\n    return this.storageService.get('importExportPopupAllowed') as boolean || false;\n  }\n\n  set popupAllowed(value: boolean) {\n    this.storageService.set('importExportPopupAllowed', value);\n  }\n\n  constructor(\n    private importService: ImportService,\n    private exportService: ExportService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    private formBuilder: FormBuilder,\n    private config: ConfigService,\n    private cdRef: ChangeDetectorRef,\n    private storageService: StorageService,\n    private downloadService: DownloadService\n  ) {\n    this.loadConfig();\n    this.buildForm();\n    this.computeProjections();\n  }\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      this.exportableLayers$.next(\n        layers.filter((layer: Layer) => {\n          return (\n            (layer instanceof VectorLayer && layer.exportable === true) ||\n            (layer.dataSource.options.download &&\n              layer.dataSource.options.download.url)\n          );\n        }) as AnyLayer[]\n      );\n    });\n    const configFileSizeMb = this.config.getConfig(\n      'importExport.clientSideFileSizeMaxMb'\n    );\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\n\n    this.exportOptions$$ = this.exportOptions$\n      .pipe(skipWhile((exportOptions) => !exportOptions))\n      .subscribe((exportOptions) => {\n        this.form.patchValue(exportOptions, { emitEvent: true });\n        if (exportOptions.layers) {\n          this.computeFormats(\n            exportOptions.layers.map((l) => this.map.getLayerById(l))\n          );\n        }\n      });\n    this.formLayer$$ = this.form\n      .get('format')\n      .valueChanges\n      .subscribe((format) => {\n        const ogreFormats = Object.keys(ExportService.ogreFormats);\n        if (\n          !this.popupChecked &&\n          this.form.get('layers').value?.length > 1 &&\n          (ogreFormats.indexOf(format) >= 0 || format === ExportFormat.URL)) {\n          if (!this.handlePopup(true)) {\n            this.form.patchValue({ format: undefined }, { emitEvent: false });\n          }\n        }\n      });\n\n    this.formLayer$$ = this.form\n      .get('layers')\n      .valueChanges.subscribe((layersId) => {\n        this.handlePreviousLayerSpecs();\n        const selectedLayers = layersId instanceof Array ? layersId : [layersId];\n        this.form.patchValue({ layers: selectedLayers }, { emitEvent: false });\n        const layers = selectedLayers.map((l) => this.map.getLayerById(l));\n        this.computeFormats(layers);\n\n        if (\n          Object.keys(this.formats$.value).indexOf(this.form.value.format) ===\n          -1\n        ) {\n          this.form.patchValue({ format: undefined });\n        }\n\n        this.loading$.next(true);\n        const previousSpecs: {\n          id: string;\n          visible: boolean;\n          opacity: number;\n          queryable: boolean;\n        }[] = [];\n        layers.forEach((layer) => {\n          if (\n            layer instanceof VectorLayer &&\n            layer.dataSource.ol.getFeatures().length === 0\n          ) {\n            previousSpecs.push({\n              id: layer.id,\n              visible: layer.visible,\n              opacity: layer.opacity,\n              queryable: (layer as any).queryable\n            });\n            layer.opacity = 0;\n            layer.visible = true;\n          }\n        });\n\n        this.previousLayerSpecs$.next(previousSpecs);\n        setTimeout(() => {\n          this.loading$.next(false);\n        }, 500);\n      });\n\n    this.formats$$ = this.formats$\n      .pipe(skipWhile((formats) => !formats))\n      .subscribe((formats) => {\n        if (Object.keys(formats).length === 1) {\n          this.form.patchValue({ format: formats[Object.keys(formats)[0]] });\n        }\n      });\n\n    this.encodings$$ = this.encodings$\n      .pipe(skipWhile((encodings) => !encodings))\n      .subscribe((encodings) => {\n        if (Object.keys(encodings).length === 1) {\n          this.form.patchValue({ encoding: encodings[Object.keys(encodings)[0]] });\n        }\n      });\n\n    this.exportableLayers$$ = this.exportableLayers$\n      .pipe(skipWhile((layers) => !layers))\n      .subscribe((layers) => {\n        if (layers.length === 1) {\n          this.form.patchValue({ layers: layers[0].id });\n        }\n      });\n\n    this.form.controls[this.controlFormat].valueChanges.subscribe((format) => {\n      if (format === ExportFormat.CSVcomma || format === ExportFormat.CSVsemicolon) {\n        this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      } else {\n        this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      }\n      this.cdRef.detectChanges();\n    });\n\n    if (this.selectFirstProj) {\n      if (this.projections$.value.length === 0) {\n        this.importForm.patchValue({ inputProj: { translateKey: 'nad83', alias: 'NAD83', code: 'EPSG:4326', zone: '' } });\n      } else {\n        this.importForm.patchValue({ inputProj: this.projections$.value[0] });\n      }\n    } else {\n      this.importForm.patchValue({ inputProj: undefined });\n    }\n  }\n\n  private computeProjections() {\n    this.projectionsConstraints = computeProjectionsConstraints(this.projectionsLimitations);\n    const projections: InputProjections[] = [];\n\n    if (this.projectionsConstraints.nad83) {\n      projections.push({ translateKey: 'nad83', alias: 'NAD83', code: 'EPSG:4269', zone: '' });\n    }\n    if (this.projectionsConstraints.wgs84) {\n      projections.push({ translateKey: 'wgs84', alias: 'WGS84', code: 'EPSG:4326', zone: '' });\n    }\n    if (this.projectionsConstraints.webMercator) {\n      projections.push({ translateKey: 'webMercator', alias: 'Web Mercator', code: 'EPSG:3857', zone: '' });\n    }\n\n    if (this.projectionsConstraints.mtm) {\n      // all mtm zones\n      const minZone = this.projectionsConstraints.mtmZone.minZone;\n      const maxZone = this.projectionsConstraints.mtmZone.maxZone;\n\n      for (let mtmZone = minZone; mtmZone <= maxZone; mtmZone++) {\n        const code = mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n        projections.push({ translateKey: 'mtm', alias: `MTM ${mtmZone}`, code, zone: `${mtmZone}` });\n      }\n    }\n\n    if (this.projectionsConstraints.utm) {\n      // all utm zones\n      const minZone = this.projectionsConstraints.utmZone.minZone;\n      const maxZone = this.projectionsConstraints.utmZone.maxZone;\n\n      for (let utmZone = minZone; utmZone <= maxZone; utmZone++) {\n        const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n        projections.push({ translateKey: 'utm', alias: `UTM ${utmZone}`, code, zone: `${utmZone}` });\n      }\n    }\n\n    let configProjection = [];\n    if (this.projectionsConstraints.projFromConfig) {\n      configProjection = this.config.getConfig('projections') || [];\n    }\n\n    this.projections$.next(configProjection.concat(projections));\n  }\n\n  private getWorkspaceByLayerId(id: string): Workspace {\n    const wksFromLayerId = this.store\n      .all()\n      .find(workspace => (workspace as WfsWorkspace | FeatureWorkspace).layer.id === id);\n    if (wksFromLayerId) {\n      return wksFromLayerId;\n    }\n    return;\n  }\n\n  public getLayerTitleById(id): string {\n    return this.map.getLayerById(id).title;\n  }\n\n\n  layerHasSelectedFeatures(layer: Layer): boolean {\n    const wksFromLayer = this.getWorkspaceByLayerId(layer.id);\n    if (wksFromLayer) {\n      const recs = wksFromLayer.entityStore.stateView\n        .firstBy((record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        });\n      return recs ? true : false;\n    }\n  }\n\n  public onlySelected(event: MatSlideToggleChange, id: string) {\n    let layersWithSelection = this.form.value.layersWithSelection;\n    if (event.checked) {\n      layersWithSelection.push(id);\n    } else {\n      layersWithSelection = layersWithSelection.filter(layerId => layerId !== id);\n    }\n    this.form.patchValue({ layersWithSelection });\n  }\n\n  public onlySelectedClick(event, id: string) {\n    if (this.form.value.layers.find(layerId => layerId === id)) {\n      event.stopPropagation();\n    }\n  }\n\n  public inLayersIdToExportSelectionOnly(layer: Layer): boolean {\n    return this.form.value.layersWithSelection.find(layerId => layerId === layer.id) ? true : false;\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.exportableLayers$$.unsubscribe();\n    this.formats$$.unsubscribe();\n    this.encodings$$.unsubscribe();\n    this.formLayer$$.unsubscribe();\n    if (this.exportOptions$$) {\n      this.exportOptions$$.unsubscribe();\n    }\n    this.exportOptionsChange.emit(this.form.value);\n    this.handlePreviousLayerSpecs();\n  }\n\n  private handlePreviousLayerSpecs() {\n    const previousSpecs = this.previousLayerSpecs$.value;\n    if (previousSpecs && previousSpecs.length) {\n      previousSpecs.forEach((specs) => {\n        const previousLayer = this.map.getLayerById(specs.id);\n        previousLayer.visible = specs.visible;\n        previousLayer.opacity = specs.opacity;\n        (previousLayer as any).queryable = specs.queryable;\n      });\n    }\n    this.previousLayerSpecs$.next(undefined);\n  }\n\n  importFiles(files: File[]) {\n    let inputProj = this.inputProj.code;\n    if (this.espgCodeRegex.test(inputProj)) {\n      inputProj = `EPSG:${inputProj}`;\n    }\n\n    this.loading$.next(true);\n    for (const file of files) {\n      this.importService.import(file, inputProj).subscribe(\n        (features: Feature[]) => this.onFileImportSuccess(file, features),\n        (error: Error) => this.onFileImportError(file, error),\n        () => {\n          this.loading$.next(false);\n        }\n      );\n    }\n  }\n\n  handlePopup(preCheck: boolean = true): boolean {\n    const p1 = window.open('', 'popup', 'width=1, height=1');\n    p1.close();\n    const p2 = window.open('', 'popup', 'width=1, height=1');\n    if (!p2 || p2.closed || typeof p2.closed === 'undefined' || p2 === null) {\n      this.onPopupBlockedError(preCheck);\n      this.popupAllowed = false;\n    } else {\n      p2.close();\n      this.popupAllowed = true;\n      this.popupChecked = true;\n    }\n    return this.popupAllowed;\n  }\n\n  handleExportFormSubmit(data: ExportOptions) {\n    this.loading$.next(true);\n\n    const ogreFormats = Object.keys(ExportService.ogreFormats);\n    if (!this.popupChecked && data.layers.length > 1 &&\n      (ogreFormats.indexOf(data.format) >= 0 || data.format === ExportFormat.URL) && !this.popupAllowed) {\n      this.handlePopup();\n    }\n\n    data.layers.forEach((layer) => {\n      const lay = this.map.getLayerById(layer);\n      let filename = lay.title;\n      if (data.name !== undefined) {\n        filename = data.name;\n      }\n      const dSOptions: DataSourceOptions = lay.dataSource.options;\n      if (data.format === ExportFormat.URL && dSOptions.download && (dSOptions.download.url || dSOptions.download.dynamicUrl)) {\n        setTimeout(() => {\n          // better look an feel\n          const url = dSOptions.download.url || dSOptions.download.dynamicUrl;\n          url.match(/service=wfs/gi) ? this.downloadService.open(lay) : window.open(url , '_blank');\n          this.loading$.next(false);\n        }, 500);\n        return;\n      }\n      const wks = this.getWorkspaceByLayerId(layer);\n      let olFeatures;\n      if (wks && wks.entityStore && wks.entityStore.stateView.all().length) {\n\n        if (data.layersWithSelection.indexOf(layer) !== -1 && data.featureInMapExtent) {\n          // Only export selected feature && into map extent\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent && e.state.selected).map(e => (e.entity as Feature).ol);\n        } else if (data.layersWithSelection.indexOf(layer) !== -1 && !data.featureInMapExtent) {\n          // Only export selected feature &&  (into map extent OR not)\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.selected).map(e => (e.entity as Feature).ol);\n        } else if (data.featureInMapExtent) {\n          // Only into map extent\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent).map(e => (e.entity as Feature).ol);\n        } else {\n          // All features\n          olFeatures = wks.entityStore.stateView.all().map(e => (e.entity as Feature).ol);\n        }\n      }\n      else {\n        const ol = lay.dataSource.ol as olVectorSource<OlGeometry> | olClusterSource ;\n        if (data.featureInMapExtent) {\n          olFeatures = ol.getFeaturesInExtent(\n            lay.map.viewController.getExtent()\n          );\n        } else {\n          olFeatures = ol.getFeatures();\n        }\n        if (lay.dataSource instanceof ClusterDataSource) {\n          olFeatures = olFeatures.flatMap((cluster: any) =>\n            cluster.get('features')\n          );\n        }\n      }\n\n      const translate = this.languageService.translate;\n      let geomTypes: { geometryType: string, features: any[] }[] = [];\n      if (data.format === ExportFormat.Shapefile || data.format === ExportFormat.GPX) {\n        olFeatures.forEach((olFeature) => {\n          const featureGeomType = olFeature.getGeometry().getType();\n          const currentGeomType = geomTypes.find(geomType => geomType.geometryType === featureGeomType);\n          if (currentGeomType) {\n            currentGeomType.features.push(olFeature);\n          } else {\n            geomTypes.push({ geometryType: featureGeomType, features: [olFeature] });\n          }\n        });\n      } else {\n        geomTypes = [{ geometryType: '', features: olFeatures }];\n      }\n\n      geomTypes.forEach(geomType => {\n        geomType.features.forEach(feature => {\n          const radius: number = feature.get('rad');\n\n          if (radius) {\n            const center4326: Array<number> = [feature.get('longitude'), feature.get('latitude')];\n            const circle = circular(center4326, radius, 500);\n            circle.transform('EPSG:4326', feature.get('_projection'));\n            feature.setGeometry(circle);\n          }\n        });\n      });\n\n      if (data.format === ExportFormat.GPX) {\n        const gpxFeatureCnt = geomTypes.length;\n        geomTypes = geomTypes.filter(geomType => ['LineString', 'Point'].includes(geomType.geometryType));\n        const gpxFeatureCntPointOrPoly = geomTypes.length;\n        if (gpxFeatureCnt > gpxFeatureCntPointOrPoly) {\n          const title = translate.instant('igo.geo.export.gpx.error.poly.title');\n          const message = translate.instant('igo.geo.export.gpx.error.poly.text');\n          this.messageService.error(message, title, { timeOut: 20000 });\n        }\n      }\n\n      if (geomTypes.length === 0) {\n        this.loading$.next(false);\n        const title = translate.instant('igo.geo.export.nothing.title');\n        const message = translate.instant('igo.geo.export.nothing.text');\n        this.messageService.error(message, title, { timeOut: 20000 });\n\n      } else {\n        geomTypes.map(geomType =>\n          this.exportService.export(geomType.features, data.format, filename + geomType.geometryType, data.encoding, this.map.projection)\n          .subscribe(\n            () => {},\n            (error: Error) => this.onFileExportError(error),\n            () => {\n              this.onFileExportSuccess();\n\n              geomType.features.forEach(feature => {\n                const radius: number = feature.get('rad');\n\n                if (radius) {\n                  const point = new olPoint([feature.get('longitude'), feature.get('latitude')]);\n                  point.transform('EPSG:4326', feature.get('_projection'));\n                  feature.setGeometry(point);\n                }\n              });\n\n              this.loading$.next(false);\n            }\n        ));\n      }\n    });\n  }\n\n  private buildForm() {\n    this.importForm = this.formBuilder.group({\n      inputProj: ['', [Validators.required]]\n    });\n\n    if (this.forceNaming) {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]],\n        name: ['', [Validators.required]]\n      });\n    } else {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]],\n      });\n    }\n  }\n\n  private onFileImportSuccess(file: File, features: Feature[]) {\n    if (!this.config.getConfig('importWithStyle')) {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.messageService,\n        this.languageService\n      );\n    } else {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.messageService,\n        this.languageService,\n        this.styleListService,\n        this.styleService\n      );\n    }\n  }\n\n  private onFileImportError(file: File, error: Error) {\n    this.loading$.next(false);\n    handleFileImportError(\n      file,\n      error,\n      this.messageService,\n      this.languageService,\n      this.fileSizeMb\n    );\n  }\n\n  private onPopupBlockedError(preCheck: boolean = true) {\n    this.loading$.next(false);\n    const translate = this.languageService.translate;\n    const title = translate.instant('igo.geo.export.popupBlocked.title');\n    const extraMessage = preCheck ?\n      translate.instant('igo.geo.export.popupBlocked.selectAgain') :\n      translate.instant('igo.geo.export.popupBlocked.retry');\n    const message = translate.instant('igo.geo.export.popupBlocked.text', { extraMessage });\n    this.messageService.error(message, title, { timeOut: 20000 });\n  }\n\n  private onFileExportError(error: Error) {\n    this.loading$.next(false);\n    handleFileExportError(error, this.messageService, this.languageService);\n  }\n\n  private loadConfig() {\n    if (this.config.getConfig('importExport.forceNaming') !== undefined) {\n      this.forceNaming = this.config.getConfig('importExport.forceNaming');\n    }\n    this.computeFormats();\n    this.loadEncodings();\n  }\n\n  public encodingDefaultValue(format: ExportFormat) {\n    if (format === ExportFormat.CSVcomma || format === ExportFormat.CSVsemicolon) {\n      this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      return EncodingFormat.LATIN1;\n    } else {\n      this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      return EncodingFormat.UTF8;\n    }\n  }\n\n  private loadEncodings() {\n    this.encodings$.next(EncodingFormat);\n  }\n\n  private computeFormats(layers?: AnyLayer[]) {\n    let appliedformats: string[] = Object.keys(ExportFormat);\n    const formatsType = {\n      onlyUrl: false,\n      onlyVector: false,\n      vectorAndUrl: false,\n      customList: false\n    };\n    const customList = [];\n    if (layers && layers.length) {\n      layers.forEach((layer) => {\n        if (!layer) {\n          return;\n        }\n        if (layer.dataSource.options.download?.allowedFormats) {\n          formatsType.customList = true;\n          customList.push({layer: layer.title, formats: this.validateListFormat(layer.dataSource.options.download.allowedFormats)});\n        } else if (\n          !(layer instanceof VectorLayer) &&\n          layer.dataSource.options.download &&\n          layer.dataSource.options.download.url\n        ) {\n          formatsType.onlyUrl = true;\n        } else if (\n          layer.dataSource.options.download &&\n          (layer.dataSource.options.download.url || layer.dataSource.options.download.dynamicUrl)\n        ) {\n          formatsType.vectorAndUrl = true;\n        } else if (layer instanceof VectorLayer) {\n          formatsType.onlyVector = true;\n        }\n      });\n\n      if (formatsType.onlyUrl === true && formatsType.onlyVector === false) {\n        appliedformats = ['URL'];\n      } else if (\n        formatsType.onlyVector === true &&\n        formatsType.onlyUrl === false\n      ) {\n        this.computeFormats(); // reset\n        if (ExportFormat.URL in this.formats$.value) {\n          const keys = Object.keys(this.formats$.value).filter(\n            (key) => key !== 'URL'\n          );\n          appliedformats = keys;\n        }\n      } else if (\n        formatsType.vectorAndUrl === true &&\n        formatsType.onlyUrl === false &&\n        formatsType.onlyVector === false\n      ) {\n        this.computeFormats(); // reset\n        if (!(ExportFormat.URL in this.formats$.value)) {\n          const keys = Object.keys(this.formats$.value);\n          keys.push('URL');\n          appliedformats = keys;\n        }\n      }\n    }\n    if (this.config.getConfig('importExport.formats') !== undefined) {\n      const validatedListFormat = this.validateListFormat(\n        this.config.getConfig('importExport.formats')\n      );\n      appliedformats = validatedListFormat;\n    }\n    if (formatsType.customList) {\n      let commonFormats;\n      const layersWithCustomFormats = [];\n      let previousCustomListFormats = customList[0].formats;\n      customList.map(list => {\n        layersWithCustomFormats.push(list.layer);\n        commonFormats = list.formats.filter(value => previousCustomListFormats.includes(value));\n        previousCustomListFormats = list.formats;\n      });\n      const finalFormats = commonFormats.filter(value => appliedformats.includes(value));\n      if (finalFormats.length > 0) {\n        this.formats$.next(strEnum(finalFormats));\n\n        if (layers && layers.length) {\n          if (layers.length > 1) {\n            this.messageService.alert(\n              this.languageService.translate.instant('igo.geo.export.customList.text', { value: layersWithCustomFormats.join() }),\n              this.languageService.translate.instant('igo.geo.export.customList.title')\n            );\n          }\n        }\n      } else {\n        this.formats$.next([]);\n        this.messageService.alert(\n          this.languageService.translate.instant('igo.geo.export.noFormat.text'),\n          this.languageService.translate.instant('igo.geo.export.noFormat.title')\n        );\n      }\n      return;\n    } else {\n      this.formats$.next(strEnum(appliedformats));\n    }\n  }\n\n  private validateListFormat(formats: string[]): string[] {\n    return formats\n      .filter((format) => {\n        if (\n          format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GPX.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.KML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.Shapefile.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.URL.toUpperCase()\n        ) {\n          return format;\n        }\n      })\n      .map((format) => {\n        if (format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase()) {\n          format = ExportFormat.CSVcomma;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase()) {\n          format = ExportFormat.CSVsemicolon;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GML.toUpperCase()) {\n          format = ExportFormat.GML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GPX.toUpperCase()) {\n          format = ExportFormat.GPX;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase()) {\n          format = ExportFormat.GeoJSON;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.KML.toUpperCase()) {\n          format = ExportFormat.KML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.Shapefile.toUpperCase()) {\n          format = ExportFormat.Shapefile;\n          return format;\n        }\n\n        if (format.toUpperCase() === ExportFormat.URL.toUpperCase()) {\n          format = ExportFormat.URL;\n          return format;\n        }\n      });\n  }\n\n  public modeChanged(mode) {\n    this.selectMode.emit(mode);\n  }\n\n  private onFileExportSuccess() {\n    handleFileExportSuccess(this.messageService, this.languageService);\n  }\n\n  onImportExportChange(event) {\n    this.selectedMode = event.value;\n  }\n}\n","import { ProjectionsLimitationsOptions } from './projection.interfaces';\n\n/**\n * Return a number of zone MTM for a longitude for province of Quebec only\n * @param lon number\n * @returns zone\n */\nexport function zoneMtm(lon: number): number {\n    let lonMin = -54;\n    const lonMax = -81;\n    if (lon < lonMax || lon > lonMin) {\n      return 0;\n    }\n    else {\n      const deltaLon = 3;\n      let zone = 2;\n      while (Math.abs(lon - lonMin) > deltaLon) {\n        lonMin = lonMin - deltaLon;\n        zone++;\n      }\n      return zone;\n    }\n  }\n/**\n * Return a number of zone UTM for a longitude\n * @param lon number\n * @returns zone\n */\nexport function zoneUtm(lon: number): number {\n  let lonMin = -180;\n  const lonMax = 180;\n  const deltaLon = 6;\n  let zone = 1;\n  while (Math.abs(lon - lonMin) > deltaLon) {\n    lonMin = lonMin + deltaLon;\n    zone++;\n  }\n  return zone;\n}\n\n/**\n * Compute the contraints of projections\n * @param projectionsLimitations: ProjectionsLimitationsOptions\n * @returns projectionsContraints: ProjectionsLimitationsOptions\n */\nexport function computeProjectionsConstraints(\n    projectionsLimitations: ProjectionsLimitationsOptions):\n    ProjectionsLimitationsOptions {\n    const mtmZone = projectionsLimitations.mtmZone;\n    const utmZone = projectionsLimitations.utmZone;\n    const projectionsConstraints = {\n        projFromConfig: projectionsLimitations.projFromConfig === false ? false : true,\n        nad83: projectionsLimitations.nad83 === false ? false : true,\n        wgs84: projectionsLimitations.wgs84 === false ? false : true,\n        webMercator: projectionsLimitations.webMercator === false ? false : true,\n        utm: projectionsLimitations.utm === false ? false : true,\n        mtm: projectionsLimitations.mtm === false ? false : true,\n        utmZone: {\n        minZone: utmZone && utmZone.minZone ? utmZone.minZone : 17,\n        maxZone: utmZone && utmZone.maxZone ? utmZone.maxZone : 21,\n        },\n        mtmZone: {\n        minZone: mtmZone && mtmZone.minZone ? mtmZone.minZone : 2,\n        maxZone: mtmZone && mtmZone.maxZone ? mtmZone.maxZone : 10,\n        }\n    };\n    return projectionsConstraints;\n  }\n","import {\n  getEntityProperty,\n  EntityTableColumn,\n  EntityTableColumnRenderer\n} from '@igo2/common';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { downloadContent } from '@igo2/utils';\n\nimport { ExportNothingToExportError } from './export.errors';\n\nexport function handleFileExportError(\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  if (error instanceof ExportNothingToExportError) {\n    handleNothingToExportError(messageService, languageService);\n    return;\n  }\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.export.failed.title');\n  const message = translate.instant('igo.geo.export.failed.text');\n  messageService.error(message, title);\n}\n\nexport function handleFileExportSuccess(\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.export.success.title');\n  const message = translate.instant('igo.geo.export.success.text');\n  messageService.success(message, title);\n}\n\nexport function handleNothingToExportError(\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.export.nothing.title');\n  const message = translate.instant('igo.geo.export.nothing.text');\n  messageService.error(message, title);\n}\n\n/**\n * Export array to CSV\n *\n * @param rows Array of arrays to export as CSV\n * @param separator Cell separator\n */\nexport function exportToCSV(rows: any[][], fileName: string, separator: string = ';') {\n  const lines = rows.map((row: any[][], index: number) => row.join(separator));\n  const csvContent = lines.join('\\n');\n  downloadContent(csvContent, 'text/csv;charset=utf-8', fileName);\n}\n\n/**\n * Return an array of values from an array of entities.\n *\n * @param entities Array of entities\n * @param scolumns Columns definition of the output data\n */\nexport function entitiesToRowData(entities: object[], columns: EntityTableColumn[]) {\n  return entities.map((entity: object) => {\n    return columns.map((column: EntityTableColumn) => {\n      let valueAccessor;\n      if (column.renderer === undefined || column.renderer === EntityTableColumnRenderer.Default) {\n        valueAccessor = column.valueAccessor;\n      }\n      valueAccessor = valueAccessor ? valueAccessor : getEntityProperty;\n      return valueAccessor(entity, column.name);\n    });\n  });\n}\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\n\nimport { StyleListService } from './style-list.service';\nimport { StyleListOptions } from './style-list.interface';\n\nexport let STYLELIST_OPTIONS = new InjectionToken<StyleListOptions>('styleListOptions');\n\nexport function provideStyleListOptions(options: StyleListOptions) {\n  return {\n    provide: STYLELIST_OPTIONS,\n    useValue: options\n  };\n}\n\nexport function styleListFactory(\n  styleListService: StyleListService,\n  options: StyleListOptions\n) {\n  return () => styleListService.load(options);\n}\n\nexport function provideStyleListLoader() {\n  return {\n    provide: APP_INITIALIZER,\n    useFactory: styleListFactory,\n    multi: true,\n    deps: [StyleListService, STYLELIST_OPTIONS]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { provideStyleListOptions, provideStyleListLoader } from './style-list.provider';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoStyleListModule {\n  static forRoot(): ModuleWithProviders<IgoStyleListModule> {\n    return {\n      ngModule: IgoStyleListModule,\n      providers: [provideStyleListOptions({}), provideStyleListLoader()]\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule, IgoDrapDropModule, IgoSpinnerModule } from '@igo2/common';\n\nimport { ExportButtonComponent } from './export-button/export-button.component';\nimport { ImportExportComponent } from './import-export/import-export.component';\nimport { DropGeoFileDirective } from './shared/drop-geo-file.directive';\nimport { IgoStyleListModule } from './style-list/style-list.module';\n\n@NgModule({\n  imports: [\n    MatIconModule,\n    MatTooltipModule,\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatTabsModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSlideToggleModule,\n    IgoLanguageModule,\n    IgoSpinnerModule,\n    IgoKeyValueModule,\n    IgoDrapDropModule,\n    IgoStyleListModule.forRoot()\n  ],\n  exports: [ImportExportComponent, DropGeoFileDirective, IgoStyleListModule, ExportButtonComponent],\n  declarations: [ImportExportComponent, DropGeoFileDirective, ExportButtonComponent]\n})\nexport class IgoImportExportModule {\n  static forRoot(): ModuleWithProviders<IgoImportExportModule> {\n    return {\n      ngModule: IgoImportExportModule\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoConfirmDialogModule } from '@igo2/common';\nimport { MapBrowserComponent } from './map-browser/map-browser.component';\nimport { ZoomButtonComponent } from './zoom-button/zoom-button.component';\nimport { GeolocateButtonComponent } from './geolocate-button/geolocate-button.component';\nimport { RotationButtonComponent } from './rotation-button/rotation-button.component';\nimport { BaseLayersSwitcherComponent } from './baselayers-switcher/baselayers-switcher.component';\nimport { MiniBaseMapComponent } from './baselayers-switcher/mini-basemap.component';\nimport { MapOfflineDirective } from './shared/mapOffline.directive';\nimport { OfflineButtonComponent } from './offline-button/offline-button.component';\nimport { PointerPositionDirective } from './shared/map-pointer-position.directive';\nimport { HoverFeatureDirective } from './shared/hover-feature.directive';\nimport { SwipeControlComponent } from './swipe-control/swipe-control.component';\nimport { MapCenterComponent } from './map-center/map-center.component';\nimport { MenuButtonComponent } from './menu-button/menu-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoConfirmDialogModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule\n  ],\n  exports: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    GeolocateButtonComponent,\n    RotationButtonComponent,\n    BaseLayersSwitcherComponent,\n    MiniBaseMapComponent,\n    MapOfflineDirective,\n    OfflineButtonComponent,\n    PointerPositionDirective,\n    HoverFeatureDirective,\n    SwipeControlComponent,\n    MapCenterComponent,\n    MenuButtonComponent\n  ],\n  declarations: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    GeolocateButtonComponent,\n    RotationButtonComponent,\n    BaseLayersSwitcherComponent,\n    MiniBaseMapComponent,\n    MapOfflineDirective,\n    OfflineButtonComponent,\n    PointerPositionDirective,\n    HoverFeatureDirective,\n    SwipeControlComponent,\n    MapCenterComponent,\n    MenuButtonComponent\n  ]\n})\nexport class IgoMapModule {}\n","<mat-form-field\n  class=\"measure-field\"\n  appearance=\"outline\"\n  floatLabel=\"always\">\n  <mat-label>{{placeholder}}</mat-label>\n  <input\n    matInput\n    [readonly]=\"true\"\n    [value]=\"((measure$ | async) || 0) | measureFormat: measureUnit\">\n</mat-form-field>\n<mat-form-field class=\"unit-field\">\n  <mat-select\n    [value]=\"measureUnit\"\n    [disabled]=\"auto\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n      {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n  </mat-select>\n</mat-form-field>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport {\n  MeasureType,\n  MeasureAreaUnit,\n  MeasureLengthUnit\n} from '../shared/measure.enum';\nimport { computeBestAreaUnit, computeBestLengthUnit } from '../shared/measure.utils';\n\n/**\n * Measurer item\n */\n@Component({\n  selector: 'igo-measurer-item',\n  templateUrl: './measurer-item.component.html',\n  styleUrls: ['./measurer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MeasurerItemComponent implements OnDestroy {\n\n  /**\n   * Measure observable\n   * @internal\n   */\n  public measure$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the measure observable when the auto mode is on\n   * @internal\n   */\n  public measure$$: Subscription;\n\n  /**\n   * Measure type\n   */\n  @Input() measureType: MeasureType;\n\n  /**\n   * Measure unit\n   */\n  @Input() measureUnit: MeasureAreaUnit | MeasureLengthUnit;\n\n  /**\n   * Measure\n   */\n  @Input()\n  set measure(value: number) {\n    this.measure$.next(value);\n  }\n  get measure(): number { return this.measure$.value; }\n\n  /**\n   * Whther measure units should be automatically determined\n   */\n  @Input()\n  set auto(value: boolean) { this.toggleAutoUnit(value); }\n  get auto(): boolean { return this._auto; }\n  private _auto: boolean = false;\n\n  /**\n   * Placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Event emitted when the measure unit changes\n   */\n  @Output() measureUnitChange = new EventEmitter<MeasureAreaUnit | MeasureLengthUnit>();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    if (this.measureType === MeasureType.Area) {\n      return Object.values(MeasureAreaUnit);\n    }\n    return Object.values(MeasureLengthUnit);\n  }\n\n  constructor() {}\n\n  /**\n   * Toggle the auto unit off\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toggleAutoUnit(false);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureAreaUnit | MeasureLengthUnit) {\n    this.measureUnit = unit;\n    this.measureUnitChange.emit(unit);\n  }\n\n  private toggleAutoUnit(toggle: boolean) {\n    if (this.measure$$ !== undefined) {\n      this.measure$$.unsubscribe();\n    }\n    if (toggle === true) {\n      this.measure$$ = this.measure$.subscribe((measure: number) => {\n        this.computeBestMeasureUnit(measure);\n      });\n    }\n    this._auto = toggle;\n  }\n\n  private computeBestMeasureUnit(measure: number) {\n    let measureUnit = this.measureUnit;\n    if (this.measureType === MeasureType.Area) {\n      measureUnit = computeBestAreaUnit(measure);\n    } else if (this.measureType === MeasureType.Length) {\n      measureUnit = computeBestLengthUnit(measure);\n    }\n    if (measureUnit !== this.measureUnit) {\n      this.onMeasureUnitChange(measureUnit);\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatDividerModule } from '@angular/material/divider';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoEntityTableModule } from '@igo2/common';\n\nimport { MeasureFormatPipe } from './measure-format.pipe';\nimport { MeasurerItemComponent } from './measurer-item.component';\nimport { MeasurerComponent } from './measurer.component';\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    MatSlideToggleModule,\n    MatDividerModule,\n    IgoLanguageModule,\n    IgoEntityTableModule\n  ],\n  declarations: [\n    MeasureFormatPipe,\n    MeasurerItemComponent,\n    MeasurerComponent,\n    MeasurerDialogComponent\n  ],\n  exports: [\n    MeasureFormatPipe,\n    MeasurerComponent\n  ]\n})\nexport class IgoMeasurerModule {}\n","import { NgModule } from '@angular/core';\n\nimport { IgoMeasurerModule } from './measurer/measurer.module';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [\n    IgoMeasurerModule\n  ]\n})\nexport class IgoMeasureModule {}\n","export enum OverlayAction {\n    None,\n    Move,\n    Zoom,\n    ZoomIfOutMapExtent\n  }\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport { OverlayAction } from './overlay.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class OverlayService {\n  public features$ = new BehaviorSubject<[Feature[], OverlayAction]>([\n    [],\n    undefined\n  ]);\n\n  constructor() {}\n\n  setFeatures(features: Feature[], action: OverlayAction = OverlayAction.None) {\n    this.features$.next([features, action]);\n  }\n\n  clear() {\n    this.features$.next([[], OverlayAction.None]);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport { OverlayService } from '../shared/overlay.service';\nimport { OverlayAction } from '../shared/overlay.enum';\n\n@Directive({\n  selector: '[igoOverlay]'\n})\nexport class OverlayDirective implements OnInit, OnDestroy {\n  private features$$: Subscription;\n  private format = new olFormatGeoJSON();\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private overlayService: OverlayService\n  ) {}\n\n  ngOnInit() {\n    this.features$$ = this.overlayService.features$.subscribe(res =>\n      this.handleFeatures(res[0], res[1])\n    );\n  }\n\n  ngOnDestroy() {\n    this.features$$.unsubscribe();\n  }\n\n  private handleFeatures(features: Feature[], action: OverlayAction) {}\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\n\nimport { OverlayDirective } from './shared/overlay.directive';\n\n@NgModule({\n  imports: [],\n  exports: [OverlayDirective],\n  declarations: [OverlayDirective]\n})\nexport class IgoOverlayModule {\n  static forRoot(): ModuleWithProviders<IgoOverlayModule> {\n    return {\n      ngModule: IgoOverlayModule\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { Observable, Subject, forkJoin } from 'rxjs';\nimport { map as rxMap } from 'rxjs/operators';\n\nimport { saveAs } from 'file-saver';\nimport jspdf from 'jspdf';\nimport html2canvas from 'html2canvas';\nimport * as JSZip from 'jszip';\n\nimport { SubjectStatus } from '@igo2/utils';\nimport { SecureImagePipe } from '@igo2/common';\nimport { MessageService, ActivityService, LanguageService } from '@igo2/core';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { formatScale } from '../../map/shared/map.utils';\nimport { LegendMapViewOptions } from '../../layer/shared/layers/layer.interface';\nimport { getLayersLegends } from '../../layer/utils/outputLegend';\n\nimport { PrintOptions } from './print.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PrintService {\n  zipFile: JSZip;\n  nbFileToProcess: number;\n  activityId: string;\n  constructor(\n    private http: HttpClient,\n    private messageService: MessageService,\n    private activityService: ActivityService,\n    private languageService: LanguageService\n  ) {}\n\n  print(map: IgoMap, options: PrintOptions): Subject<any> {\n    const status$ = new Subject();\n\n    const paperFormat: string = options.paperFormat;\n    const resolution = +options.resolution; // Default is 96\n    const orientation = options.orientation;\n    const legendPostion = options.legendPosition;\n\n    this.activityId = this.activityService.register();\n    const doc = new jspdf({\n      orientation,\n      format: paperFormat.toLowerCase()\n    });\n\n    const dimensions = [\n      doc.internal.pageSize.width,\n      doc.internal.pageSize.height\n    ];\n\n    const margins = [10, 10, 10, 10];\n    const width = dimensions[0] - margins[3] - margins[1];\n    const height = dimensions[1] - margins[0] - margins[2];\n    const size = [width, height];\n    let titleSizeResults = [0, 0];\n\n    if (options.title !== undefined) {\n      titleSizeResults = this.getTitleSize(options.title, width, height, doc); // return : size(pt) and left margin (mm)\n      this.addTitle(doc, options.title, titleSizeResults[0], margins[3] + titleSizeResults[1], titleSizeResults[0] * (25.4 / 72));\n    }\n    if (options.subtitle !== undefined) {\n      let subtitleSizeResult = 0;\n      const titleH = titleSizeResults[0];\n      subtitleSizeResult = this.getSubTitleSize(options.subtitle, width, height, doc); // return : size(pt) and left margin (mm)\n      this.addSubTitle(doc, options.subtitle, titleH * 0.7, margins[3] + subtitleSizeResult, titleH * 1.7 * (25.4 / 72));\n      margins[0] = margins[0] + titleSizeResults[0] * 0.7 * (25.4 / 72);\n    }\n    if (options.showProjection === true || options.showScale === true) {\n      this.addProjScale(\n        doc,\n        map,\n        resolution,\n        options.showProjection,\n        options.showScale\n        );\n    }\n    if (options.comment !== '') {\n      this.addComment(doc, options.comment);\n    }\n\n    this.addMap(doc, map, resolution, size, margins).subscribe(\n      async (status: SubjectStatus) => {\n        if (status === SubjectStatus.Done) {\n          await this.addScale(doc, map, margins);\n          await this.handleMeasureLayer(doc, map, margins);\n          if (options.legendPosition !== 'none') {\n            if (['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(options.legendPosition) > -1 ) {\n              await this.addLegendSamePage(doc, map, margins, resolution, options.legendPosition);\n            } else if (options.legendPosition === 'newpage') {\n              await this.addLegend(doc, map, margins, resolution);\n            }\n          } else {\n            await this.saveDoc(doc);\n          }\n        }\n\n        if (status === SubjectStatus.Done || status === SubjectStatus.Error) {\n          this.activityService.unregister(this.activityId);\n          status$.next(SubjectStatus.Done);\n        }\n      }\n    );\n\n    return status$;\n  }\n\n  /**\n   * Add measure overlay on the map on the document when the measure layer is present\n   * @param  doc - Pdf document where measure tooltip will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async handleMeasureLayer(\n    doc: jspdf,\n    map: IgoMap,\n    margins: Array<number>\n  ) {\n    if (map.layers.find(layer => layer.visible && layer.id.startsWith('igo-measures-'))) {\n      let canvasOverlayHTMLMeasures;\n      const mapOverlayMeasuresHTML = map.ol.getOverlayContainer();\n      await html2canvas(mapOverlayMeasuresHTML, {\n        scale: 1,\n        backgroundColor: null\n      }).then(e => {\n        canvasOverlayHTMLMeasures = e;\n      });\n      this.addCanvas(doc, canvasOverlayHTMLMeasures, margins); // this adds measure overlays\n    }\n  }\n\n  /**\n   * Get html code for all layers legend\n   * @param  map IgoMap\n   * @param  width The width that the legend need to be\n   * @return Html code for the legend\n   */\n  getLayersLegendHtml(\n    map: IgoMap,\n    width: number,\n    resolution: number\n  ): Observable<string> {\n    return new Observable((observer) => {\n      let html = '';\n      const legends = getLayersLegends(\n        map.layers,\n        {\n          resolution: map.viewController.getResolution(),\n          extent: map.viewController.getExtent(),\n          projection: map.viewController.getOlProjection().getCode(),\n          scale: map.viewController.getScale(resolution),\n          size: map.ol.getSize()\n        } as LegendMapViewOptions\n      );\n      if (legends.length === 0) {\n        observer.next(html);\n        observer.complete();\n        return;\n      }\n      // Define important style to be sure that all container is convert\n      // to image not just visible part\n      html += '<style media=\"screen\" type=\"text/css\">';\n      html += '.html2canvas-container { width: ' + width + 'mm !important; height: 2000px !important; }';\n      html += 'table.tableLegend {table-layout: auto;}';\n      html += 'div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}';\n      html += '</style>';\n      // The font size will also be lowered afterwards (globally along the legend size)\n      // this allows having a good relative font size here and to keep ajusting the legend size\n      // while keeping good relative font size\n      html += '<font size=\"3\" face=\"Times\" >';\n      html += '<div class=\"styleLegend\">';\n      html += '<table class=\"tableLegend\" >';\n\n      // For each legend, define an html table cell\n      const images$ = legends.map((legend) =>\n        this.getDataImage(legend.url).pipe(\n          rxMap((dataImage) => {\n            let htmlImg = '<tr><td>' + legend.title.toUpperCase() + '</td></tr>';\n            htmlImg += '<tr><td><img src=\"' + dataImage + '\"></td></tr>';\n            return htmlImg;\n          })\n        )\n      );\n      forkJoin(images$).subscribe((dataImages) => {\n        html = dataImages.reduce((acc, current) => (acc += current), html);\n        html += '</table>';\n        html += '</div>';\n        observer.next(html);\n        observer.complete();\n      });\n    });\n  }\n\n  getDataImage(url: string): Observable<string> {\n    const secureIMG = new SecureImagePipe(this.http);\n    return secureIMG.transform(url);\n  }\n\n  /**\n   * Get all the legend in a single image\n   * * @param  format - Image format. default value to \"png\"\n   * @return The image of the legend\n   */\n  async getLayersLegendImage(\n    map,\n    format: string = 'png',\n    doZipFile: boolean,\n    resolution: number\n  ) {\n    const status$ = new Subject();\n    // Get html code for the legend\n    const width = 200; // milimeters unit, originally define for document pdf\n    let html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    format = format.toLowerCase();\n\n    // If no legend show No LEGEND in an image\n    if (html.length === 0) {\n      html = '<font size=\"12\" face=\"Courier New\" >';\n      html += '<div align=\"center\"><b>NO LEGEND</b></div>';\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n\n    if (canvas) {\n      let status = SubjectStatus.Done;\n      try {\n        if (!doZipFile) {\n          // Save the canvas as file\n          this.saveCanvasImageAsFile(canvas, 'legendImage', format);\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(canvas, 'legendImage' + '.' + format);\n        }\n        div.parentNode.removeChild(div); // remove temp div (IE)\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n      status$.next(status);\n    }\n\n    return status$;\n  }\n\n  getTitleSize(title: string, pageWidth: number, pageHeight: number, doc: jspdf) {\n    const pdfResolution = 96;\n    const titleSize = Math.round(2 * (pageHeight + 145) * 0.05) / 2;\n    doc.setFont('Times', 'bold');\n    const width = doc.getTextWidth(title);\n\n    const titleWidth = doc.getStringUnitWidth(title) * titleSize / doc.internal.scaleFactor;\n    const titleTailleMinimale = Math.round( 2 * (pageHeight + 150 ) * 0.037) / 2;\n    let titleFontSize = 0;\n\n    let titleMarginLeft;\n    if (titleWidth >= (pageWidth)) {\n      titleMarginLeft = 0;\n      titleFontSize = Math.round(((pageWidth / title.length) * pdfResolution) / 25.4);\n      // If the formula to find the font size gives below the defined minimum size\n      if (titleFontSize < titleTailleMinimale) {\n        titleFontSize = titleTailleMinimale;\n      }\n    } else {\n      titleMarginLeft = (pageWidth - titleWidth) / 2 ;\n      titleFontSize = titleSize;\n    }\n    return [titleFontSize, titleMarginLeft];\n  }\n\n  getSubTitleSize(subtitle: string, pageWidth: number, pageHeight: number, doc: jspdf) {\n    const subtitleSize = 0.7 * Math.round(2 * (pageHeight + 145) * 0.05) / 2; // 70% of the title's font size\n\n    doc.setFont('Times', 'bold');\n\n    const subtitleWidth = doc.getStringUnitWidth(subtitle) * subtitleSize / doc.internal.scaleFactor;\n\n    let subtitleMarginLeft;\n    if (subtitleWidth >= (pageWidth)) {\n      subtitleMarginLeft = 0;\n    } else {\n      subtitleMarginLeft = (pageWidth - subtitleWidth) / 2 ;\n    }\n    return subtitleMarginLeft;\n  }\n\n  private addTitle(doc: jspdf, title: string, titleFontSize: number, titleMarginLeft: number, titleMarginTop: number) {\n    doc.setFont('Times', 'bold');\n    doc.setFontSize(titleFontSize);\n    doc.text(title, titleMarginLeft, titleMarginTop);\n  }\n\n  private addSubTitle(doc: jspdf, subtitle: string, subtitleFontSize: number, subtitleMarginLeft: number, subtitleMarginTop: number) {\n    doc.setFont('Times', 'bold');\n    doc.setFontSize(subtitleFontSize);\n    doc.text(subtitle, subtitleMarginLeft, subtitleMarginTop);\n  }\n  /**\n   * Add comment to the document\n   * * @param  doc - pdf document\n   * * @param  comment - Comment to add in the document\n   * * @param  size - Size of the document\n   */\n  private addComment(doc: jspdf, comment: string) {\n    const commentSize = 16;\n    const commentMarginLeft = 20;\n    const marginBottom = 5;\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\n\n    doc.setFont('courier');\n    doc.setFontSize(commentSize);\n    doc.text(comment, commentMarginLeft, heightPixels);\n  }\n  /**\n   * Add projection and/or scale to the document\n   * @param  doc - pdf document\n   * @param  map - Map of the app\n   * @param  dpi - DPI resolution of the document\n   * @param  projection - Bool to indicate if projection need to be added\n   * @param  scale - Bool to indicate if scale need to be added\n   */\n  private addProjScale(\n    doc: jspdf,\n    map: IgoMap,\n    dpi: number,\n    projection: boolean,\n    scale: boolean\n  ) {\n    const translate = this.languageService.translate;\n    const projScaleSize = 16;\n    const projScaleMarginLeft = 20;\n    const marginBottom = 15;\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\n\n    let textProjScale: string = '';\n    if (projection === true) {\n      const projText = translate.instant('igo.geo.printForm.projection');\n      textProjScale += projText + ': ' + map.projection;\n    }\n    if (scale === true) {\n      if (projection === true) {\n        textProjScale += '   ';\n      }\n      const scaleText = translate.instant('igo.geo.printForm.scale');\n      const mapScale = map.viewController.getScale(dpi);\n      textProjScale += scaleText + ': ~ 1 / ' + formatScale(mapScale);\n    }\n    doc.setFont('courier');\n    doc.setFontSize(projScaleSize);\n    doc.text(textProjScale, projScaleMarginLeft, heightPixels);\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async addLegend(\n    doc: jspdf,\n    map: IgoMap,\n    margins: Array<number>,\n    resolution: number\n  ) {\n    // Get html code for the legend\n    const width = doc.internal.pageSize.width;\n    const html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveDoc(doc);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n\n    if (canvas) {\n      const pourcentageReduction = 0.85;\n      const imageSize = [pourcentageReduction * (25.4 * canvas.width) / resolution, pourcentageReduction\n        * (25.4 * canvas.height) / resolution];\n      let imgData;\n      doc.addPage();\n      imgData = canvas.toDataURL('image/png');\n      doc.addImage(imgData, 'PNG', 10, 10, imageSize[0], imageSize[1]);\n      div.parentNode.removeChild(div); // remove temp div (IE style)\n    }\n\n    await this.saveDoc(doc);\n\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n     private async addLegendSamePage(\n      doc: jspdf,\n      map: IgoMap,\n      margins: Array<number>,\n      resolution: number,\n      legendPosition: string\n    ) {\n      // Get html code for the legend\n      const width = doc.internal.pageSize.width;\n      const html = await this.getLayersLegendHtml(\n        map,\n        width,\n        resolution\n      ).toPromise();\n      // If no legend, save the map directly\n      if (html === '') {\n        await this.saveDoc(doc);\n        return true;\n      }\n      // Create div to contain html code for legend\n      const div = window.document.createElement('div');\n      div.style.position = 'absolute';\n      div.style.top = '0';\n      // Add html code to convert in the new window\n      window.document.body.appendChild(div);\n      div.innerHTML = html;\n      await this.timeout(1);\n      const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n        console.log(e);\n      });\n      let marginsLegend;\n      if (canvas) {\n        const pourcentageReduction = 0.85;\n        const imageSize = [pourcentageReduction * (25.4 * canvas.width) / resolution,\n           pourcentageReduction * (25.4 * canvas.height) / resolution];\n        // Move the legend to the correct position on the page\n        if ( legendPosition === 'bottomright') {\n          marginsLegend = [doc.internal.pageSize.height - margins[2] - imageSize[1], margins[1],\n           margins[2], doc.internal.pageSize.width - margins[1] - imageSize[0]];\n        } else if (legendPosition === 'topright') {\n          marginsLegend = [margins[0], margins[1], doc.internal.pageSize.height - margins[0] - imageSize[1],\n          doc.internal.pageSize.width - margins[1] - imageSize[0] ];\n        } else if (legendPosition === 'bottomleft') {\n          // When the legend is in the bottom left, raise the legend slightly upward so that attributions are visible\n          marginsLegend = [doc.internal.pageSize.height - margins[2] - imageSize[1] - 15,\n          doc.internal.pageSize.width - margins[3] - imageSize[0], margins[2] + 15, margins[3] ];\n        } else if (legendPosition === 'topleft') {\n          marginsLegend = [margins[0], doc.internal.pageSize.width - margins[3] - imageSize[0],\n           doc.internal.pageSize.height - margins[0] - imageSize[1], margins[3] ];\n        }\n        this.addCanvas(doc, canvas, marginsLegend); // this adds the legend\n        div.parentNode.removeChild(div); // remove temp div (IE style)\n        await this.saveDoc(doc);\n      }\n    }\n\n  /**\n   * Add scale and attributions on the map on the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async addScale(\n    doc: jspdf,\n    map: IgoMap,\n    margins: Array<number>\n    ) {\n      const mapSize = map.ol.getSize();\n      const extent = map.ol.getView().calculateExtent(mapSize);\n      // Get the scale and attribution\n      // we use cloneNode to modify the nodes to print without modifying it on the page, using deep:true to get children\n      let canvasOverlayHTML;\n      const mapOverlayHTML = map.ol.getOverlayContainerStopEvent();\n      // Remove the UI buttons from the nodes\n      const OverlayHTMLButtons = mapOverlayHTML.getElementsByTagName('button');\n      const OverlayHTMLButtonsarr = Array.from(OverlayHTMLButtons);\n      for (const OverlayHTMLButton of OverlayHTMLButtonsarr) {\n        OverlayHTMLButton.setAttribute('data-html2canvas-ignore', 'true');\n      }\n      // Change the styles of hyperlink in the printed version\n      // Transform the Overlay into a canvas\n      // scale is necessary to make it in google chrome\n      // background as null because otherwise it is white and cover the map\n      // allowtaint is to allow rendering images in the attributions\n      // useCORS: true pour permettre de renderer les images (ne marche pas en local)\n      const canvas = await html2canvas(mapOverlayHTML, {\n        scale: 1,\n        backgroundColor: null,\n        allowTaint: true,\n        useCORS: true,\n      }).then( e => {\n        canvasOverlayHTML = e;\n      });\n      this.addCanvas(doc, canvasOverlayHTML, margins); // this adds scales and attributions\n }\n\n  defineNbFileToProcess(nbFileToProcess) {\n    this.nbFileToProcess = nbFileToProcess;\n  }\n\n  private timeout(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n\n  private addCanvas(\n    doc: jspdf,\n    canvas: HTMLCanvasElement,\n    margins: Array<number>\n  ) {\n    let image;\n    if (canvas) {\n      image = canvas.toDataURL('image/png');\n    }\n\n    if (image !== undefined) {\n      const imageSize = this.getImageSizeToFitPdf(doc, canvas, margins);\n      doc.addImage(\n        image,\n        'PNG',\n        margins[3],\n        margins[0],\n        imageSize[0],\n        imageSize[1]\n      );\n      doc.rect(margins[3], margins[0], imageSize[0], imageSize[1]);\n    }\n  }\n\n  // TODO fix printing with image resolution\n  private addMap(\n    doc: jspdf,\n    map: IgoMap,\n    resolution: number,\n    size: Array<number>,\n    margins: Array<number>\n  ) {\n    const status$ = new Subject();\n\n    const mapSize = map.ol.getSize();\n    const extent = map.ol.getView().calculateExtent(mapSize);\n\n    const widthPixels = Math.round((size[0] * resolution) / 25.4);\n    const heightPixels = Math.round((size[1] * resolution) / 25.4);\n\n    let timeout;\n\n    map.ol.once('rendercomplete', (event: any) => {\n      const canvases = event.target.getViewport().getElementsByTagName('canvas');\n      const mapStatus$$ = map.status$.subscribe((mapStatus: SubjectStatus) => {\n        clearTimeout(timeout);\n\n        if (mapStatus !== SubjectStatus.Done) {\n          return;\n        }\n\n        mapStatus$$.unsubscribe();\n\n        let status = SubjectStatus.Done;\n        try {\n          for (const canvas of canvases) {\n            if (canvas.width !== 0) {\n              this.addCanvas(doc, canvas, margins);\n            }\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error(\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageBody'\n            ),\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageHeader'\n            )\n          );\n        }\n        this.renderMap(map, mapSize, extent);\n        status$.next(status);\n      });\n\n      // If no loading as started after 200ms, then probably no loading\n      // is required.\n      timeout = window.setTimeout(() => {\n        mapStatus$$.unsubscribe();\n\n        let status = SubjectStatus.Done;\n        try {\n          for (const canvas of canvases) {\n            if (canvas.width !== 0) {\n              this.addCanvas(doc, canvas, margins);\n            }\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error(\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageBody'\n            ),\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageHeader'\n            )\n          );\n        }\n        this.renderMap(map, mapSize, extent);\n        status$.next(status);\n      }, 200);\n    });\n\n    this.renderMap(map, [widthPixels, heightPixels], extent);\n\n    return status$;\n  }\n\n  /**\n   * Download an image of the map with addition of informations\n   * @param  map - Map of the app\n   * @param  format - Image format. default value to \"png\"\n   * @param  projection - Indicate if projection need to be add. Default to false\n   * @param  scale - Indicate if scale need to be add. Default to false\n   * @param  legend - Indicate if the legend of layers need to be download. Default to false\n   * @param  title - Title to add for the map - Default to blank\n   * @param  subtitle - Subtitle to add for the map - Default to blank\n   * @param  comment - Comment to add for the map - Default to blank\n   * @param  doZipFile - Indicate if we do a zip with the file\n   * @return Image file of the map with extension format given as parameter\n   */\n  downloadMapImage(\n    map: IgoMap,\n    resolution: number,\n    format = 'png',\n    projection = false,\n    scale = false,\n    legend = false,\n    title = '',\n    subtitle = '',\n    comment = '',\n    doZipFile = true\n  ) {\n    const status$ = new Subject();\n    // const resolution = map.ol.getView().getResolution();\n    this.activityId = this.activityService.register();\n    const translate = this.languageService.translate;\n    map.ol.once('rendercomplete', (event: any) => {\n      format = format.toLowerCase();\n      const oldCanvas = event.target\n        .getViewport()\n        .getElementsByTagName('canvas')[0];\n      const newCanvas = document.createElement('canvas');\n      const newContext = newCanvas.getContext('2d');\n      // Postion in height to set the canvas in new canvas\n      let positionHCanvas = 0;\n      // Position in width to set the Proj/Scale in new canvas\n      let positionWProjScale = 10;\n      // Get height/width of map canvas\n      const width = oldCanvas.width;\n      let height = oldCanvas.height;\n      // Set Font to calculate comment width\n      newContext.font = '20px Calibri';\n      const commentWidth = newContext.measureText(comment).width;\n      // Add height for title if defined\n      height = title !== '' ? height + 30 : height;\n      // Add height for title if defined\n      height = subtitle !== '' ? height + 30 : height;\n      // Add height for projection or scale (same line) if defined\n      height = projection !== false || scale !== false ? height + 30 : height;\n      const positionHProjScale = height - 10;\n      // Define number of line depending of the comment length\n      const commentNbLine = Math.ceil(commentWidth / width);\n      // Add height for multiline comment if defined\n      height = comment !== '' ? height + commentNbLine * 30 : height;\n      let positionHComment = height - commentNbLine * 20 + 5;\n      // Set the new canvas with the new calculated size\n      newCanvas.width = width;\n      newCanvas.height = height;\n      // Patch Jpeg default black background to white\n      if (format === 'jpeg') {\n        newContext.fillStyle = '#ffffff';\n        newContext.fillRect(0, 0, width, height);\n        newContext.fillStyle = '#000000';\n      }\n      // If a title need to be added to canvas\n      if (title !== '') {\n        // Set font for title\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 30;\n        newContext.textAlign = 'center';\n        newContext.fillText(title, width / 2, 20, width * 0.9);\n      }\n      if (subtitle !== '') {\n        // Set font for subtitle\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 60;\n        newContext.textAlign = 'center';\n        newContext.fillText(subtitle, width / 2, 50, width * 0.9);\n      }\n      // Set font for next section\n      newContext.font = '20px Calibri';\n      // If projection need to be added to canvas\n      if (projection !== false) {\n        const projText = translate.instant('igo.geo.printForm.projection');\n        newContext.textAlign = 'start';\n        newContext.fillText(\n          projText + ': ' + map.projection,\n          positionWProjScale,\n          positionHProjScale\n        );\n        positionWProjScale += 200; // Width position change for scale position\n      }\n\n      // If scale need to be added to canvas\n      if (scale !== false) {\n        const scaleText = translate.instant('igo.geo.printForm.scale');\n        const mapScale = map.viewController.getScale(resolution);\n        newContext.textAlign = 'start';\n        newContext.fillText(\n          scaleText + ': ~ 1 / ' + formatScale(mapScale),\n          positionWProjScale,\n          positionHProjScale\n        );\n      }\n      // If a comment need to be added to canvas\n      if (comment !== '') {\n        newContext.textAlign = 'center';\n        // If only one line, no need to multiline the comment\n        if (commentNbLine === 1) {\n          newContext.fillText(comment, width / 2, positionHComment);\n        } else {\n          // Separate the setenses to be approx. the same length\n          const nbCommentChar = comment.length;\n          const CommentLengthToCut = Math.floor(nbCommentChar / commentNbLine);\n          let commentCurrentLine = '';\n          let positionFirstCutChar = 0;\n          let positionLastBlank;\n          // Loop for the number of line calculated\n          for (let i = 0; i < commentNbLine; i++) {\n            // For all line except last\n            if (commentNbLine - 1 > i) {\n              // Get comment current line to find the right place tu cut comment\n              commentCurrentLine = comment.substr(\n                positionFirstCutChar,\n                CommentLengthToCut\n              );\n              // Cut the setence at blank\n              positionLastBlank = commentCurrentLine.lastIndexOf(' ');\n              newContext.fillText(\n                commentCurrentLine.substr(0, positionLastBlank),\n                width / 2,\n                positionHComment\n              );\n              positionFirstCutChar += positionLastBlank;\n              // Go to next line for insertion\n              positionHComment += 20;\n            } else {\n              // Don't cut last part\n              newContext.fillText(\n                comment.substr(positionFirstCutChar),\n                width / 2,\n                positionHComment\n              );\n            }\n          }\n        }\n      }\n      // Add map to new canvas\n      newContext.drawImage(oldCanvas, 0, positionHCanvas);\n\n      let status = SubjectStatus.Done;\n      try {\n        // Save the canvas as file\n        if (!doZipFile) {\n          this.saveCanvasImageAsFile(newCanvas, 'map', format);\n        } else if (format.toLowerCase() === 'tiff') {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(\n            newCanvas,\n            'map' + map.projection.replace(':', '_') + '.' + format\n          );\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(newCanvas, 'map' + '.' + format);\n        }\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n\n      status$.next(status);\n\n      if (format.toLowerCase() === 'tiff') {\n        const tiwContent = this.getWorldFileInformation(map);\n        const blob = new Blob([tiwContent], {\n          type: 'text/plain;charset=utf-8'\n        });\n        if (!doZipFile) {\n          // saveAs automaticly replace ':' for '_'\n          saveAs(blob, 'map' + map.projection + '.tfw');\n          this.saveFileProcessing();\n        } else {\n          // Add the canvas to zip\n          this.addFileToZip(\n            'map' + map.projection.replace(':', '_') + '.tfw',\n            blob\n          );\n        }\n      }\n    });\n    map.ol.renderSync();\n\n    return status$;\n  }\n\n  private renderMap(map, size, extent) {\n    map.ol.updateSize();\n    map.ol.renderSync();\n  }\n\n  /**\n   * Save document\n   * @param  doc - Document to save\n   */\n  protected async saveDoc(doc: jspdf) {\n    await doc.save('map.pdf', { returnPromise: true });\n  }\n\n  /**\n   * Calculate the best Image size to fit in pdf\n   * @param doc - Pdf Document\n   * @param canvas - Canvas of image\n   * @param margins - Page margins\n   */\n  private getImageSizeToFitPdf(doc, canvas, margins) {\n    // Define variable to calculate best size to fit in one page\n    const pageHeight =\n      doc.internal.pageSize.getHeight() - (margins[0] + margins[2]);\n    const pageWidth =\n      doc.internal.pageSize.getWidth() - (margins[1] + margins[3]);\n    const canHeight = canvas.height;\n    const canWidth = canvas.width;\n    const heightRatio = canHeight / pageHeight;\n    const widthRatio = canWidth / pageWidth;\n    const maxRatio = heightRatio > widthRatio ? heightRatio : widthRatio;\n    const imgHeigh = maxRatio > 1 ? canHeight / maxRatio : canHeight;\n    const imgWidth = maxRatio > 1 ? canWidth / maxRatio : canWidth;\n\n    return [imgWidth, imgHeigh];\n  }\n\n  /**\n   * Get a world file information for tiff\n   * @param  map - Map of the app\n   */\n  private getWorldFileInformation(map) {\n    const currentResolution = map.viewController.getResolution();\n    const currentExtent = map.viewController.getExtent(); // Return [minx, miny, maxx, maxy]\n    return [\n      currentResolution,\n      0,\n      0,\n      -currentResolution,\n      currentExtent[0] + currentResolution / 0.5,\n      currentExtent[3] - currentResolution / 0.5\n    ].join('\\n');\n  }\n\n  /**\n   * Save canvas image as file\n   * @param canvas - Canvas to save\n   * @param name - Name of the file\n   * @param format - file format\n   */\n  private saveCanvasImageAsFile(canvas, name, format) {\n    const blobFormat = 'image/' + format;\n    const that = this;\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      // If navigator is Internet Explorer\n      if (navigator.msSaveBlob) {\n        navigator.msSaveBlob(canvas.msToBlob(), name + '.' + format);\n        this.saveFileProcessing();\n      } else {\n        canvas.toBlob((blob) => {\n          // download image\n          saveAs(blob, name + '.' + format);\n          that.saveFileProcessing();\n        }, blobFormat);\n      }\n    } catch (err) {\n      this.messageService.error(\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageBody'\n        ),\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageHeader'\n        )\n      );\n    }\n  }\n\n  /**\n   * Add file to a zip\n   * @param canvas - File to add to the zip\n   * @param  name -Name of the fileoverview\n   */\n  private generateCanvaFileToZip(canvas, name) {\n    const blobFormat = 'image/' + 'jpeg';\n    const that = this;\n    if (\n      !this.hasOwnProperty('zipFile') ||\n      typeof this.zipFile === 'undefined'\n    ) {\n      this.zipFile = new JSZip();\n    }\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      if (navigator.msSaveBlob) {\n        this.addFileToZip(name, canvas.msToBlob());\n      } else {\n        canvas.toBlob((blob) => {\n          that.addFileToZip(name, blob);\n        }, blobFormat);\n      }\n    } catch (err) {\n      this.messageService.error(\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageBody'\n        ),\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageHeader'\n        )\n      );\n    }\n  }\n\n  /**\n   * Add file to zip, if all file are zipped, download\n   * @param name - Name of the files\n   * @param blob - Contain of file\n   */\n  private addFileToZip(name, blob) {\n    // add file to zip\n    this.zipFile.file(name, blob);\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Download zip file\n      this.getZipFile();\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  private saveFileProcessing() {\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  /**\n   * Get the zipped file\n   * @return Retun a zip file\n   */\n  private getZipFile() {\n    const that = this;\n    this.zipFile.generateAsync({ type: 'blob' }).then((blob) => {\n      // 1) generate the zip file\n      saveAs(blob, 'map.zip');\n      delete that.zipFile;\n    });\n  }\n}\n","import { Layer } from '../shared/layers/layer';\nimport { LegendMapViewOptions, OutputLayerLegend } from '../shared/layers/layer.interface';\n\n/**\n * Get all the layers legend\n * @return Array of legend\n */\nexport function getLayersLegends(layers: Layer[], view?: LegendMapViewOptions): OutputLayerLegend[] {\n  const legends = [];\n\n  for (const layer of layers) {\n    if (layer.visible === false) { continue; }\n\n    const legendUrls = layer.dataSource.getLegend(undefined, view) || [];\n    for (const legendUrl of legendUrls) {\n      if (legendUrl.url === undefined) { continue; }\n\n      // Add legend info to the list\n      legends.push({\n        title: layer.title,\n        url: legendUrl.url\n      });\n    }\n  }\n\n  return legends;\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const PrintOutputFormat = strEnum(['Pdf', 'Image']);\n\nexport type PrintOutputFormat = keyof typeof PrintOutputFormat;\n\nexport const PrintPaperFormat = strEnum([\n  'A0',\n  'A1',\n  'A2',\n  'A3',\n  'A4',\n  'A5',\n  'Letter',\n  'Legal'\n]);\nexport type PrintPaperFormat = keyof typeof PrintPaperFormat;\n\nexport const PrintOrientation = strEnum(['landscape', 'portrait']);\nexport type PrintOrientation = keyof typeof PrintOrientation;\n\nexport const PrintResolution = strEnum(['72', '96', '150', '300']);\nexport type PrintResolution = keyof typeof PrintResolution;\n\nexport const PrintSaveImageFormat = strEnum([\n  'Bmp',\n  'Gif',\n  'Jpeg',\n  'Png',\n  'Tiff'\n]);\nexport type PrintSaveImageFormat = keyof typeof PrintSaveImageFormat;\n\nexport const PrintLegendPosition = strEnum([\n  'none',\n  'topright',\n  'topleft',\n  'bottomleft',\n  'bottomright',\n  'newpage'\n]);\nexport type PrintLegendPosition = keyof typeof PrintLegendPosition;\n","<form class=\"igo-form\" [formGroup]=\"form\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"title\"\n        placeholder=\"{{'igo.geo.printForm.title' | translate}}\">\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"subtitle\"\n        placeholder=\"{{'igo.geo.printForm.subtitle' | translate}}\">\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"comment\"\n        placeholder=\"{{'igo.geo.printForm.comment' | translate}}\">\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <div class=\"print-slide-toggle-container mat-typography\">\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showProjection\"\n        [labelPosition]=\"'before'\">\n        {{'igo.geo.printForm.showProjection' | translate}}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showScale\"\n        [labelPosition]=\"'before'\">\n        {{'igo.geo.printForm.showScale' | translate}}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"doZipFile\"\n        [labelPosition]=\"'before'\"\n        [style.display]=\"isPrintService ? 'none' : ''\">\n        {{'igo.geo.printForm.doZipFile' | translate}}\n      </mat-slide-toggle>\n    </div>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"legendPosition\"\n        placeholder=\"{{'igo.geo.printForm.legendPosition' | translate}}\">\n        <mat-option *ngFor=\"let legendPosition of legendPositions | keyvalue \" [value]=\"legendPosition.key\">\n            {{'igo.geo.printForm.legendPositions.' + legendPosition.value | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-select (selectionChange)=\"toggleImageSaveProp()\"\n        formControlName=\"outputFormat\"\n        placeholder=\"{{'igo.geo.printForm.outputFormat' | translate}}\">\n        <mat-option *ngFor=\"let outputFormat of outputFormats | keyvalue \" [value]=\"outputFormat.key\">\n            {{outputFormat.value}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'block' : 'none'\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"paperFormat\"\n        placeholder=\"{{'igo.geo.printForm.paperFormat' | translate}}\">\n        <mat-option *ngFor=\"let paperFormat of paperFormats | keyvalue \" [value]=\"paperFormat.key\">\n          {{('igo.geo.printForm.paperFormats.' + paperFormat.value) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'none' : 'block'\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"imageFormat\"\n        placeholder=\"{{'igo.geo.printForm.imageFormat' | translate}}\">\n        <mat-option *ngFor=\"let imageFormat of imageFormats | keyvalue \" [value]=\"imageFormat.key\">\n          {{imageFormat.value}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" style=\"display: none;\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"resolution\"\n        placeholder=\"{{'igo.geo.printForm.resolution' | translate}}\">\n        <mat-option *ngFor=\"let resolution of resolutions | keyvalue \" [value]=\"resolution.key\">\n          {{resolution.value + ' PPI'}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'block' : 'none'\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"orientation\"\n        placeholder=\"{{'igo.geo.printForm.orientation' | translate}}\">\n        <mat-option *ngFor=\"let orientation of orientations | keyvalue \" [value]=\"orientation.key\">\n          {{('igo.geo.printForm.' + orientation.value) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-form-button-group print-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (disabled$ | async)\"\n      (click)=\"handleFormSubmit(form.value, form.valid)\">\n      {{'igo.geo.printForm.saveBtn' | translate}}\n    </button>\n  </div>\n\n</form>\n","import { Component, Input, Output, EventEmitter, OnInit } from '@angular/core';\nimport {\n  FormGroup,\n  FormBuilder,\n  FormControl,\n  Validators\n} from '@angular/forms';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { PrintOptions } from '../shared/print.interface';\n\nimport {\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintOrientation,\n  PrintResolution,\n  PrintSaveImageFormat,\n  PrintLegendPosition\n} from '../shared/print.type';\n\n@Component({\n  selector: 'igo-print-form',\n  templateUrl: './print-form.component.html',\n  styleUrls: ['./print-form.component.scss']\n})\nexport class PrintFormComponent implements OnInit {\n  public form: FormGroup;\n  public outputFormats = PrintOutputFormat;\n  public paperFormats = PrintPaperFormat;\n  public orientations = PrintOrientation;\n  public resolutions = PrintResolution;\n  public imageFormats = PrintSaveImageFormat;\n  public legendPositions = PrintLegendPosition;\n  public isPrintService = true;\n\n  @Input() disabled$: BehaviorSubject<boolean>;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this.imageFormatField.value;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this.imageFormatField.setValue(value || PrintSaveImageFormat.Jpeg, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this.outputFormatField.value;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this.outputFormatField.setValue(value || PrintOutputFormat.Pdf, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this.paperFormatField.value;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this.paperFormatField.setValue(value || PrintPaperFormat.Letter, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this.orientationField.value;\n  }\n  set orientation(value: PrintOrientation) {\n    this.orientationField.setValue(value || PrintOrientation.landscape, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this.resolutionField.value;\n  }\n  set resolution(value: PrintResolution) {\n    this.resolutionField.setValue(value || PrintResolution['96'], {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this.legendPositionField.value;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this.legendPositionField.setValue(value || PrintLegendPosition.none, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get title(): string {\n    return this.titleField.value;\n  }\n  set title(value: string) {\n    this.titleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get subtitle(): string {\n    return this.subtitleField.value;\n  }\n  set subtitle(value: string) {\n    this.subtitleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get comment(): string {\n    return this.commentField.value;\n  }\n  set comment(value: string) {\n    this.commentField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showProjection(): boolean {\n    return this.showProjectionField.value;\n  }\n  set showProjection(value: boolean) {\n    this.showProjectionField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showScale(): boolean {\n    return this.showScaleField.value;\n  }\n  set showScale(value: boolean) {\n    this.showScaleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showLegend(): boolean {\n    return this.showLegendField.value;\n  }\n  set showLegend(value: boolean) {\n    this.showLegendField.setValue(value, { onlySelf: true });\n  }\n\n  @Input()\n  get doZipFile(): boolean {\n    return this.doZipFileField.value;\n  }\n  set doZipFile(value: boolean) {\n    this.doZipFileField.setValue(value, { onlySelf: true });\n  }\n\n  get outputFormatField() {\n    return (this.form.controls as any).outputFormat as FormControl;\n  }\n\n  get paperFormatField() {\n    return (this.form.controls as any).paperFormat as FormControl;\n  }\n\n  get imageFormatField() {\n    return (this.form.controls as any).imageFormat as FormControl;\n  }\n\n  get orientationField() {\n    return (this.form.controls as any).orientation as FormControl;\n  }\n\n  get resolutionField() {\n    return (this.form.controls as any).resolution as FormControl;\n  }\n\n  get commentField() {\n    return (this.form.controls as any).comment as FormControl;\n  }\n\n  get showProjectionField() {\n    return (this.form.controls as any).showProjection as FormControl;\n  }\n\n  get showScaleField() {\n    return (this.form.controls as any).showScale as FormControl;\n  }\n\n  get showLegendField() {\n    return (this.form.controls as any).showLegend as FormControl;\n  }\n\n  get doZipFileField() {\n    return (this.form.controls as any).doZipFile as FormControl;\n  }\n\n  get titleField() {\n    return (this.form.controls as any).title as FormControl;\n  }\n\n  get subtitleField() {\n    return (this.form.controls as any).subtitle as FormControl;\n  }\n\n  get legendPositionField() {\n    return (this.form.controls as any).legendPosition as FormControl;\n  }\n\n  @Output() submit: EventEmitter<PrintOptions> = new EventEmitter();\n\n  constructor(private formBuilder: FormBuilder) {\n    this.form = this.formBuilder.group({\n      title: ['', []],\n      subtitle: ['', []],\n      comment: ['', []],\n      outputFormat: ['', [Validators.required]],\n      paperFormat: ['', [Validators.required]],\n      imageFormat: [ '', [Validators.required]],\n      resolution: ['', [Validators.required]],\n      orientation: ['', [Validators.required]],\n      legendPosition: ['', [Validators.required]],\n      showProjection: false,\n      showScale: false,\n      showLegend: false,\n      doZipFile: [{hidden: this.isPrintService }]\n    });\n  }\n\n  ngOnInit() {\n    this.doZipFileField.setValue(false);\n  }\n\n  handleFormSubmit(data: PrintOptions, isValid: boolean) {\n    data.isPrintService = this.isPrintService;\n    if (isValid) {\n      this.submit.emit(data);\n    }\n  }\n\n  toggleImageSaveProp() {\n    if (this.outputFormatField.value === 'Image') {\n      this.isPrintService = false;\n    } else {\n      this.isPrintService = true;\n    }\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { PrintOptions } from '../shared/print.interface';\n\nimport {\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintOrientation,\n  PrintResolution,\n  PrintSaveImageFormat,\n  PrintLegendPosition\n} from '../shared/print.type';\n\nimport { PrintService } from '../shared/print.service';\n\n@Component({\n  selector: 'igo-print',\n  templateUrl: './print.component.html'\n})\nexport class PrintComponent {\n  public disabled$ = new BehaviorSubject(false);\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this._outputFormat;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this._outputFormat = value;\n  }\n  private _outputFormat: PrintOutputFormat;\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this._paperFormat;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this._paperFormat = value;\n  }\n  private _paperFormat: PrintPaperFormat;\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this._orientation;\n  }\n  set orientation(value: PrintOrientation) {\n    this._orientation = value;\n  }\n  private _orientation: PrintOrientation;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this._imageFormat;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this._imageFormat = value;\n  }\n  private _imageFormat: PrintSaveImageFormat;\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this._legendPosition;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this._legendPosition = value;\n  }\n  private _legendPosition: PrintLegendPosition;\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this._resolution;\n  }\n  set resolution(value: PrintResolution) {\n    this._resolution = value;\n  }\n  private _resolution: PrintResolution;\n\n  constructor(private printService: PrintService) {}\n\n  handleFormSubmit(data: PrintOptions) {\n\n    this.disabled$.next(true);\n\n    if (data.isPrintService === true) {\n      this.printService\n        .print(this.map, data)\n        .pipe(take(1))\n        .subscribe(() => {\n          this.disabled$.next(false);\n        });\n    } else {\n      let nbFileToProcess = 1;\n\n      if (data.showLegend) {\n        nbFileToProcess++;\n      }\n      if (data.imageFormat.toLowerCase() === 'tiff') {\n        nbFileToProcess++;\n      }\n\n      this.printService.defineNbFileToProcess(nbFileToProcess);\n\n      const resolution = +data.resolution;\n\n      let nbRequests = data.showLegend ? 2 : 1;\n      this.printService\n        .downloadMapImage(\n          this.map,\n          resolution,\n          data.imageFormat,\n          data.showProjection,\n          data.showScale,\n          data.showLegend,\n          data.title,\n          data.subtitle,\n          data.comment,\n          data.doZipFile\n        )\n        .pipe(take(1))\n        .subscribe(() => {\n          nbRequests--;\n          if (!nbRequests) {\n            this.disabled$.next(false);\n          }\n        });\n      if (data.showLegend) {\n        this.printService\n          .getLayersLegendImage(\n            this.map,\n            data.imageFormat,\n            data.doZipFile,\n            +resolution\n          )\n          .then(() => {\n            nbRequests--;\n            if (!nbRequests) {\n              this.disabled$.next(false);\n            }\n          });\n      }\n    }\n  }\n}\n","<igo-print-form\n  [outputFormat]=\"outputFormat\"\n  [paperFormat]=\"paperFormat\"\n  [orientation]=\"orientation\"\n  [imageFormat]=\"imageFormat\"\n  [resolution]=\"resolution\"\n  [legendPosition]=\"legendPosition\"\n  [disabled$]=\"disabled$\"\n  (submit)=\"handleFormSubmit($event)\">\n</igo-print-form>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule } from '@igo2/common';\n\nimport { PrintComponent } from './print/print.component';\nimport { PrintFormComponent } from './print-form/print-form.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatInputModule,\n    MatFormFieldModule,\n    MatSlideToggleModule,\n    IgoLanguageModule,\n    IgoKeyValueModule\n  ],\n  exports: [PrintComponent, PrintFormComponent],\n  declarations: [PrintComponent, PrintFormComponent]\n})\nexport class IgoPrintModule {}\n","import { ConfigService } from '@igo2/core';\n\nimport { SearchSource } from '../../search/shared/sources/source';\n\nimport { QuerySearchSource } from './query-search-source';\n\n/**\n * Map search source factory\n * @ignore\n */\nexport function querySearchSourceFactory(config: ConfigService) {\n  return new QuerySearchSource(\n    config.getConfig(`searchSources.${QuerySearchSource.id}`) || {}\n  );\n}\n\n/**\n * Function that returns a provider for the map search source\n */\nexport function provideQuerySearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: querySearchSourceFactory,\n    multi: true,\n    deps: [ConfigService]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { QueryDirective } from './shared/query.directive';\nimport { QueryService } from './shared/query.service';\nimport { provideQuerySearchSource } from './shared/query-search-source.providers';\n\n@NgModule({\n  imports: [CommonModule],\n  exports: [QueryDirective],\n  declarations: [QueryDirective],\n  providers: [QueryService]\n})\nexport class IgoQueryModule {\n  static forRoot(): ModuleWithProviders<IgoQueryModule> {\n    return {\n      ngModule: IgoQueryModule,\n      providers: [provideQuerySearchSource()]\n    };\n  }\n}\n","import { DirectionsSource } from '../directions-sources/directions-source';\n\nexport class DirectionsSourceService {\n  constructor(public sources: DirectionsSource[]) {}\n}\n\nexport function directionsSourceServiceFactory(sources: DirectionsSource[]) {\n  return new DirectionsSourceService(sources);\n}\n\nexport function provideDirectionsSourceService() {\n  return {\n    provide: DirectionsSourceService,\n    useFactory: directionsSourceServiceFactory,\n    deps: [DirectionsSource]\n  };\n}\n","export enum DirectionsFormat {\n  GeoJSON,\n  JSON\n}\nexport enum SourceDirectionsType {\n  Route = 'route',\n  Trip = 'trip'\n}\n\nexport enum ProposalType {\n  Coord = 'coord',\n  Text = 'text'\n}\n\nexport enum DirectionType {\n  Stop = 'stop',\n  Route = 'route',\n  Vertex = 'vertex'\n}\n\nexport enum DirectionRelativePositionType {\n  Start = 'start',\n  Intermediate = 'intermediate',\n  End = 'end'\n}\n","import olFeature from 'ol/Feature';\nimport * as olStyle from 'ol/style';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olGeom from 'ol/geom';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olProj from 'ol/proj';\n\nimport { uuid, NumberUtils } from '@igo2/utils';\n\nimport { Direction, FeatureWithDirection, FeatureWithStop, Stop } from './directions.interface';\nimport { createOverlayMarkerStyle } from '../../overlay/shared/overlay-marker-style.utils';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { tryAddLoadingStrategy } from '../../feature/shared/strategies.utils';\nimport { FeatureStoreLoadingStrategy } from '../../feature/shared/strategies/loading';\nimport { FEATURE, FeatureMotion } from '../../feature/shared/feature.enums';\nimport { LanguageService } from '@igo2/core';\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { DirectionRelativePositionType, DirectionType } from './directions.enum';\nimport { RoutesFeatureStore, StepFeatureStore, StopsFeatureStore, StopsStore } from './store';\n\n/**\n * Function that updat the sort of the list base on the provided field.\n * @param source stop store\n * @param direction asc / desc sort order\n * @param field the field to use to sort the view\n */\nexport function updateStoreSorting(stopsStore: StopsStore, direction: 'asc' | 'desc' = 'asc', field = 'position') {\n  stopsStore.view.sort({\n    direction,\n    valueAccessor: (entity: Stop) => entity[field]\n  });\n}\n\nexport function computeRelativePosition(index: number, totalLength): DirectionRelativePositionType {\n  let relativePosition = DirectionRelativePositionType.Intermediate;\n  if (index === 0) {\n    relativePosition = DirectionRelativePositionType.Start;\n  } else if (index === totalLength - 1) {\n    relativePosition = DirectionRelativePositionType.End;\n  }\n  return relativePosition;\n}\n\nexport function computeStopsPosition(stopsStore: StopsStore) {\n\n  const stopsToComputePosition = [...stopsStore.all()];\n  stopsToComputePosition.sort((a, b) => a.position - b.position);\n  stopsToComputePosition.map((stop, i) => {\n    stop.position = i;\n    stop.relativePosition = computeRelativePosition(stop.position, stopsToComputePosition.length);\n  });\n  if (stopsToComputePosition) {\n    stopsStore.updateMany(stopsToComputePosition);\n  }\n}\n\n/**\n * Function that add a stop to the stop store. Stop are always added before the last stop.\n * @param stopsStore stop store as an EntityStore\n */\nexport function addStopToStore(stopsStore: StopsStore): Stop {\n\n  const id = uuid();\n  const stops = stopsStore.all();\n  let positions: number[];\n  if (stopsStore.count === 0) {\n    positions = [0];\n  } else {\n    positions = stops.map(stop => stop.position);\n  }\n  const maxPosition: number = Math.max(...positions);\n  const insertPosition: number = maxPosition;\n  const lastPosition: number = maxPosition + 1;\n\n  const stopToUpdate = stopsStore.all().find(stop => stop.position === maxPosition);\n  if (stopToUpdate) {\n    stopToUpdate.position = lastPosition;\n    stopToUpdate.relativePosition = computeRelativePosition(lastPosition, stopsStore.count + 1);\n  }\n\n  stopsStore.insert({ id, position: insertPosition, relativePosition: computeRelativePosition(insertPosition, stopsStore.count + 1) });\n\n  updateStoreSorting(stopsStore);\n  return stopsStore.get(id);\n}\n\nexport function removeStopFromStore(stopsStore: StopsStore, stop: Stop) {\n  stopsStore.delete(stop);\n  computeStopsPosition(stopsStore);\n}\n\n/**\n * Create a style for the directions stops and routes\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function directionsStyle(\n  feature: olFeature<OlGeometry>,\n  resolution: number\n): olStyle.Style | olStyle.Style[] {\n  const vertexStyle = [\n    new olStyle.Style({\n      geometry: feature.getGeometry(),\n      image: new olStyle.Circle({\n        radius: 7,\n        stroke: new olStyle.Stroke({ color: '#FF0000', width: 3 })\n      })\n    })\n  ];\n\n  const stopStyle = createOverlayMarkerStyle({\n    text: feature.get('stopText'),\n    opacity: feature.get('stopOpacity'),\n    markerColor: feature.get('stopColor'),\n    markerOutlineColor: [255, 255, 255]\n  });\n\n  const routeStyle = [\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({ color: `rgba(106, 121, 130, ${feature.get('active') ? 0.75 : 0})`, width: 10 })\n    }),\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({ color: `rgba(79, 169, 221, ${feature.get('active') ? 0.75 : 0})`, width: 6 })\n    })\n  ];\n\n  if (feature.get('type') === DirectionType.Stop) {\n    return stopStyle;\n  }\n  if (feature.get('type') === 'vertex') {\n    return vertexStyle;\n  }\n  if (feature.get('type') === DirectionType.Route) {\n    return routeStyle;\n  }\n}\n\nexport function initStopsFeatureStore(stopsFeatureStore: StopsFeatureStore, languageService: LanguageService) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stopsLayer = new VectorLayer({\n    id: 'igo-direction-stops-layer',\n    title: languageService.translate.instant('igo.geo.directionsForm.stopLayer'),\n    zIndex: 911,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-stops-layer',\n      links: [\n        {\n          bidirectionnal: false,\n          syncedDelete: true,\n          linkedIds: ['igo-direction-route-layer'],\n          properties: []\n        }\n      ]\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stopsFeatureStore, stopsLayer);\n  stopsFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stopsFeatureStore, loadingStrategy);\n}\n\nexport function initRoutesFeatureStore(routesFeatureStore: RoutesFeatureStore, languageService: LanguageService) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const routeLayer = new VectorLayer({\n    id: 'igo-direction-route-layer',\n    title: languageService.translate.instant('igo.geo.directionsForm.routeLayer'),\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(routesFeatureStore, routeLayer);\n  routesFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(routesFeatureStore, loadingStrategy);\n}\n\nexport function initStepFeatureStore(stepFeatureStore: StepFeatureStore) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stepLayer = new VectorLayer({\n    id: 'igo-direction-step-layer',\n    title: '',\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: false,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: false,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stepFeatureStore, stepLayer);\n  stepFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stepFeatureStore, loadingStrategy);\n}\n\n\nexport function addStopToStopsFeatureStore(\n  stop: Stop,\n  stopsStore: StopsStore,\n  stopsFeatureStore: StopsFeatureStore,\n  projection: string,\n  languageService: LanguageService) {\n  let stopColor;\n  let stopText;\n\n\n  switch (stop.relativePosition) {\n    case DirectionRelativePositionType.Start:\n      stopColor = '#008000';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.start');\n      break;\n    case DirectionRelativePositionType.End:\n      stopColor = '#f64139';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.end');\n      break;\n    default:\n      stopColor = '#ffd700';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.intermediate') + ' #' + stop.position;\n      break;\n  }\n\n  const geometry = new olGeom.Point(\n    olProj.transform(stop.coordinates, projection, stopsFeatureStore.map.projection)\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: stopsFeatureStore.map.projection,\n    dataProjection: stopsFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n  const previousStop = stopsFeatureStore.get(stop.id);\n  const previousStopRevision = previousStop ? previousStop.meta.revision : 0;\n\n  const stopFeatureStore: FeatureWithStop = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: stopsFeatureStore.map.projection,\n    properties: {\n      id: stop.id,\n      type: DirectionType.Stop,\n      stopText,\n      stopColor,\n      stopOpacity: 1,\n      stop\n    },\n    meta: {\n      id: stop.id,\n      revision: previousStopRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  stopsFeatureStore.update(stopFeatureStore);\n}\n\nexport function addDirectionToRoutesFeatureStore(\n  routesFeatureStore: RoutesFeatureStore,\n  direction: Direction,\n  projection: string,\n  active: boolean = false,\n  moveToExtent = false) {\n  const geom = direction.geometry.coordinates;\n  const geometry4326 = new olGeom.LineString(geom);\n  const geometry = geometry4326.transform(\n    projection,\n    routesFeatureStore.map.projection\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: routesFeatureStore.map.projection,\n    dataProjection: routesFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n\n  const previousRoute = routesFeatureStore.get(direction.id);\n  const previousRouteRevision = previousRoute\n    ? previousRoute.meta.revision\n    : 0;\n\n  const routeFeatureStore: FeatureWithDirection = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: routesFeatureStore.map.projection,\n    properties: {\n      id: direction.id,\n      type: DirectionType.Route,\n      active,\n      direction\n    },\n    meta: {\n      id: direction.id,\n      revision: previousRouteRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  routesFeatureStore.update(routeFeatureStore);\n}\n\nexport function formatDistance(distance: number): string {\n  if (distance === 0) {\n    return;\n  }\n  if (distance >= 100000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 1000, 1) + ' km';\n  }\n  if (distance >= 10000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km';\n  }\n  if (distance >= 1000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km';\n  }\n  return NumberUtils.roundToNDecimal(distance, 0) + ' m';\n}\n\nexport function formatDuration(duration: number): string {\n  if (duration >= 3600) {\n    const hour = Math.floor(duration / 3600);\n    const minute = Math.round((duration / 3600 - hour) * 60);\n    if (minute === 60) {\n      return hour + 1 + ' h';\n    }\n    return hour + ' h ' + minute + ' min';\n  }\n\n  if (duration >= 60) {\n    return Math.round(duration / 60) + ' min';\n  }\n  return duration + ' s';\n}\n\nexport function formatInstruction(\n  type,\n  modifier,\n  route,\n  direction,\n  stepPosition,\n  exit,\n  languageService: LanguageService,\n  lastStep = false\n) {\n  const translate = languageService.translate;\n  let directive;\n  let image = 'forward';\n  let cssClass = 'rotate-270';\n  const translatedDirection = translateBearing(direction, languageService);\n  const translatedModifier = translateModifier(modifier, languageService);\n  const prefix = modifier === 'straight' ? '' : translate.instant('igo.geo.directions.modifier.prefix');\n\n  let aggregatedDirection = prefix + translatedModifier;\n\n\n  if (modifier?.search('slight') >= 0) {\n    aggregatedDirection = translatedModifier;\n  }\n\n  if (modifier === 'uturn') {\n    image = 'forward';\n    cssClass = 'rotate-90';\n  } else if (modifier === 'sharp right') {\n    image = 'subdirectory-arrow-right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'right') {\n    image = 'subdirectory-arrow-right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'slight right') {\n    image = 'forward';\n    cssClass = 'rotate-290';\n  } else if (modifier === 'straight') {\n    image = 'forward';\n  } else if (modifier === 'slight left') {\n    image = 'forward';\n    cssClass = 'rotate-250';\n  } else if (modifier === 'left') {\n    image = 'subdirectory-arrow-left';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'sharp left') {\n    image = 'subdirectory-arrow-left';\n    cssClass = 'icon-flipped';\n  }\n\n  if (type === 'turn') {\n    if (modifier === 'straight') {\n      directive = translate.instant('igo.geo.directions.turn.straight', { route });\n    } else if (modifier === 'uturn') {\n      directive = translate.instant('igo.geo.directions.turn.uturn', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.turn.else', { route, aggregatedDirection, translatedModifier });\n    }\n  } else if (type === 'new name') {\n    directive = translate.instant('igo.geo.directions.new name', { route, translatedDirection });\n    image = 'compass';\n    cssClass = '';\n  } else if (type === 'depart') {\n    directive = translate.instant('igo.geo.directions.depart', { route, translatedDirection });\n    image = 'compass';\n    cssClass = '';\n  } else if (type === 'arrive') {\n    if (lastStep) {\n      const coma = !translatedModifier ? '' : ', ';\n      aggregatedDirection = !translatedModifier ? '' : aggregatedDirection;\n      directive = translate.instant('igo.geo.directions.arrive.lastStep', { coma, aggregatedDirection });\n    } else {\n      directive = translate.instant('igo.geo.directions.arrive.intermediate', { route });\n      image = 'map-marker';\n      cssClass = '';\n    }\n  } else if (type === 'merge') {\n    directive = translate.instant('igo.geo.directions.merge', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'on ramp') {\n    directive = translate.instant('igo.geo.directions.on ramp', { aggregatedDirection });\n  } else if (type === 'off ramp') {\n    directive = translate.instant('igo.geo.directions.off ramp', { aggregatedDirection });\n  } else if (type === 'fork') {\n    if (modifier.search('left') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.left', { route });\n    } else if (modifier.search('right') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.right', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.fork.else', { route });\n    }\n  } else if (type === 'end of road') {\n    directive = translate.instant('igo.geo.directions.end of road', { translatedModifier, route });\n  } else if (type === 'use lane') {\n    directive = translate.instant('igo.geo.directions.use lane');\n  } else if (type === 'continue' && modifier !== 'uturn') {\n    directive = translate.instant('igo.geo.directions.continue.notUturn', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'roundabout') {\n    const cntSuffix = exit === 1 ?\n      translate.instant('igo.geo.directions.cntSuffix.first') :\n      translate.instant('igo.geo.directions.cntSuffix.secondAndMore');\n    directive = translate.instant('igo.geo.directions.roundabout', { exit, cntSuffix, route });\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'rotary') {\n    directive = translate.instant('igo.geo.directions.rotary');\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'roundabout turn') {\n    directive = translate.instant('igo.geo.directions.roundabout turn');\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'exit roundabout') {\n    directive = translate.instant('igo.geo.directions.exit roundabout', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'notification') {\n    directive = translate.instant('igo.geo.directions.notification');\n  } else if (modifier === 'uturn') {\n    directive = translate.instant('igo.geo.directions.uturnText', { translatedDirection, route });\n  } else {\n    directive = translate.instant('igo.geo.directions.unknown');\n  }\n\n  image = lastStep ? 'flag-variant' : image;\n  cssClass = lastStep ? '' : cssClass;\n  image = stepPosition === 0 ? 'compass' : image;\n  cssClass = stepPosition === 0 ? '' : cssClass;\n\n  return { instruction: directive, image, cssClass };\n}\n\nexport function translateModifier(modifier, languageService: LanguageService) {\n  const translate = languageService.translate;\n  if (modifier === 'uturn') {\n    return translate.instant('igo.geo.directions.uturn');\n  } else if (modifier === 'sharp right') {\n    return translate.instant('igo.geo.directions.sharp right');\n  } else if (modifier === 'right') {\n    return translate.instant('igo.geo.directions.right');\n  } else if (modifier === 'slight right') {\n    return translate.instant('igo.geo.directions.slight right');\n  } else if (modifier === 'sharp left') {\n    return languageService.translate.instant('igo.geo.directions.sharp left');\n  } else if (modifier === 'left') {\n    return languageService.translate.instant('igo.geo.directions.left');\n  } else if (modifier === 'slight left') {\n    return languageService.translate.instant('igo.geo.directions.slight left');\n  } else if (modifier === 'straight') {\n    return languageService.translate.instant('igo.geo.directions.straight');\n  } else {\n    return modifier;\n  }\n}\n\nexport function translateBearing(bearing: number, languageService: LanguageService) {\n  const translate = languageService.translate;\n  if (bearing >= 337 || bearing < 23) {\n    return translate.instant('igo.geo.cardinalPoints.n');\n  } else if (bearing < 67) {\n    return translate.instant('igo.geo.cardinalPoints.ne');\n  } else if (bearing < 113) {\n    return translate.instant('igo.geo.cardinalPoints.e');\n  } else if (bearing < 157) {\n    return translate.instant('igo.geo.cardinalPoints.se');\n  } else if (bearing < 203) {\n    return translate.instant('igo.geo.cardinalPoints.s');\n  } else if (bearing < 247) {\n    return translate.instant('igo.geo.cardinalPoints.sw');\n  } else if (bearing < 293) {\n    return translate.instant('igo.geo.cardinalPoints.w');\n  } else if (bearing < 337) {\n    return translate.instant('igo.geo.cardinalPoints.nw');\n  } else {\n    return;\n  }\n}\n\n\n","<div cdkDropList class=\"stops-list\" (cdkDropListDropped)=\"drop($event)\">\n  <div touchleave  \n  (touchenter)=\"onStopEnter(stop)\"\n  (touchleave)=\"onStopLeave()\"\n  (mouseover)=\"onStopEnter(stop)\"\n  (mouseleave)=\"onStopLeave()\"\n  (cdkDragStarted)=\"stopIsDragged=true\"\n  (cdkDragEnded)=\"stopIsDragged=false\"\n  cdkDragLockAxis=\"y\" class=\"stop-box mat-typography\" *ngFor=\"let stop of stopsStore.view.all$() | async; let i = index;\" cdkDrag>\n    <div [ngClass]=\"getNgClass(stop)\">\n      <mat-form-field>\n        <input id=\"{{stop.id}}\" type=\"text\"\n            [placeholder]=\"getPlaceholder(stop)\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"stop.text\"\n            aria-label=\"Number\"\n            matInput\n            (focus)=\"onInputFocus(stop)\"\n            [(ngModel)]=\"stop.text\"\n            (keyup)=\"setStopText($event,stop)\"\n            (keydown.enter)=\"$event.preventDefault()\"\n            [matAutocomplete]=\"auto\">\n        <button \n            mat-button \n            *ngIf=\"(stop.text || stop.coordinates) && stopWithHover && stop.id===stopWithHover.id\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"'igo.geo.directionsForm.clearStop' | translate\"\n            matSuffix mat-icon-button color=\"warn\" aria-label=\"Clear\" (click)=\"clearStop(stop)\">\n            <mat-icon svgIcon=\"close\"></mat-icon>\n        </button>\n      \n        <mat-autocomplete [displayWith]=\"getOptionText\" #auto=\"matAutocomplete\" (optionSelected)=\"chooseProposal($event,stop)\">\n          <mat-optgroup *ngFor=\"let source of stop.searchProposals\" [label]=\"source.source.title\" [disabled]=\"source.source.enabled === false\">\n          <mat-option *ngFor=\"let result of source.results\" [value]=\"result\" \n          matTooltipShowDelay=\"500\" [matTooltip]=\"result.meta ? result.meta.title : ''\">\n            {{ result.meta ? result.meta.title : '' }}\n          </mat-option>\n          </mat-optgroup>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n\n\n\n\n    <div class=\"igo-form-button-group\" *ngIf=\"!stopIsDragged && stopWithHover && stop.id === stopWithHover.id\">\n      <button class=\"swipe-vertical\" cdkDragHandle mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.moveStop' | translate\" color=\"primary\">\n        <mat-icon svgIcon=\"gesture-swipe-vertical\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"(stopsStore.count$ | async)> 2\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\" color=\"warn\" (click)=\"removeStop(stop)\">\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n      <button *ngIf=\"(stopsStore.count$ | async)<= 2\" disabled=\"true\" mat-icon-button tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\" color=\"warn\">\n        <mat-icon svgIcon=\"blank\"></mat-icon>\n      </button>\n    </div>\n  </div>\n</div>","import { Component, EventEmitter, Input, OnDestroy, Output } from '@angular/core';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\n\nimport * as olProj from 'ol/proj';\nimport * as olObservable from 'ol/Observable';\n\nimport { Stop } from '../shared/directions.interface';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport pointOnFeature from '@turf/point-on-feature';\nimport { computeRelativePosition, removeStopFromStore, updateStoreSorting } from '../shared/directions.utils';\nimport { MatAutocomplete } from '@angular/material/autocomplete';\nimport { MatOption } from '@angular/material/core';\nimport { StopsFeatureStore, StopsStore } from '../shared/store';\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { LanguageService } from '@igo2/core';\nimport { DirectionRelativePositionType } from '../shared/directions.enum';\n\n@Component({\n  selector: 'igo-directions-inputs',\n  templateUrl: './directions-inputs.component.html',\n  styleUrls: ['./directions-inputs.component.scss']\n})\nexport class DirectionsInputsComponent implements OnDestroy {\n\n  private readonly invalidKeys = ['Control', 'Shift', 'Alt'];\n  private onMapClickEventKeys = [];\n  public stopWithHover: Stop;\n  public stopIsDragged: boolean = false;\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() projection: string;\n  @Input() coordRoundedDecimals: number = 6;\n\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n\n  @Output() stopInputHasFocus: EventEmitter<boolean> = new EventEmitter<boolean>(false);\n  constructor(private languageService: LanguageService) { }\n\n  ngOnDestroy(): void {\n    this.unlistenMapSingleClick();\n  }\n  onStopEnter(stop: Stop) {\n    this.stopWithHover = stop;\n  }\n  onStopLeave() {\n    this.stopWithHover = undefined;\n  }\n\n  getOptionText(option) {\n    if (option instanceof Object) {\n      return option?.meta ? option.meta.title : '';\n    }\n    return option;\n  }\n\n  chooseProposal(event: { source: MatAutocomplete, option: MatOption }, stop: Stop) {\n    const result: Feature = event.option.value;\n    if (result) {\n      let geomCoord;\n      const geom = result.geometry;\n      if (geom.type === 'Point') {\n        geomCoord = geom.coordinates;\n      } else {\n        const point = pointOnFeature(result.geometry);\n        geomCoord = [\n          point.geometry.coordinates[0],\n          point.geometry.coordinates[1]\n        ];\n      }\n      if (geomCoord) {\n        stop.coordinates = geomCoord;\n        stop.text = result.meta.title;\n        this.stopsStore.update(stop);\n      }\n    }\n  }\n\n  setStopText(event: KeyboardEvent, stop: Stop) {\n    this.unlistenMapSingleClick();\n    const term = (event.target as HTMLInputElement).value;\n    if (term.length === 0) {\n      this.clearStop(stop);\n    } else if (this.validateTerm(term)) {\n      stop.text = term;\n      this.stopsStore.update(stop);\n    }\n  }\n\n  validateTerm(term: string) {\n    if (\n      this.keyIsValid(term) &&\n      (term.length >= this.length || term.length === 0)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  private keyIsValid(key: string) {\n    return this.invalidKeys.find(value => value === key) === undefined;\n  }\n\n  getNgClass(stop: Stop): string {\n    if (!this.stopWithHover) {\n      return 'igo-input-container';\n    } else if (stop.id === this.stopWithHover.id) {\n      return 'igo-input-container reduce';\n    } else {\n      return 'igo-input-container';\n    }\n  }\n\n  getPlaceholder(stop: Stop): string {\n    let extra = '';\n    if (stop.relativePosition) {\n      if (stop.relativePosition === DirectionRelativePositionType.Intermediate) {\n        extra = ' #' + stop.position;\n      }\n      return this.languageService.translate.instant('igo.geo.directionsForm.' + stop.relativePosition) + extra;\n    } else {\n      return '';\n    }\n  }\n\n  removeStop(stop: Stop) {\n    removeStopFromStore(this.stopsStore, stop);\n  }\n\n  clearStop(stop: Stop) {\n    this.stopsStore.update({ id: stop.id, relativePosition: stop.relativePosition, position: stop.position });\n  }\n\n  drop(event: CdkDragDrop<string[]>) {\n    this.moveStops(event.previousIndex, event.currentIndex);\n  }\n\n  private moveStops(fromIndex, toIndex) {\n    if (fromIndex !== toIndex) {\n      const stops = [...this.stopsStore.view.all()];\n      moveItemInArray(stops, fromIndex, toIndex);\n      stops.map((stop, i) => {\n        stop.relativePosition = computeRelativePosition(i, stops.length);\n        stop.position = i;\n      });\n      this.stopsStore.updateMany(stops);\n      updateStoreSorting(this.stopsStore);\n    }\n  }\n\n  onInputFocus(stop: Stop) {\n    if (!stop.text || stop.text?.length === 0) {\n      this.unlistenMapSingleClick();\n      this.stopInputHasFocus.emit(true);\n      this.listenMapSingleClick(stop);\n    }\n  }\n\n  private listenMapSingleClick(stop: Stop) {\n    const key = this.stopsFeatureStore.layer.map.ol.once('singleclick', event => {\n      const clickCoordinates = olProj.transform(\n        event.coordinate,\n        this.stopsFeatureStore.layer.map.projection,\n        this.projection\n      );\n      const roundedCoord = roundCoordTo(clickCoordinates as [number, number], this.coordRoundedDecimals);\n      stop.text = roundedCoord.join(',');\n      stop.coordinates = roundedCoord;\n      this.stopsStore.update(stop);\n      setTimeout(() => {\n        this.stopInputHasFocus.emit(false);\n      }, 500);\n    });\n    this.onMapClickEventKeys.push(key);\n  }\n\n  private unlistenMapSingleClick() {\n    this.onMapClickEventKeys.map(key => {\n      olObservable.unByKey(key);\n    });\n    this.onMapClickEventKeys = [];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\n\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsSource } from '../directions-sources/directions-source';\nimport { DirectionsSourceService } from './directions-source.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DirectionsService {\n  constructor(private directionsSourceService: DirectionsSourceService) {}\n\n  route(coordinates: [number, number][], directionsOptions: DirectionOptions = {}): Observable<Direction[]>[] {\n    if (coordinates.length === 0) {\n      return;\n    }\n    return this.directionsSourceService.sources\n      .filter((source: DirectionsSource) => source.enabled)\n      .map((source: DirectionsSource) => this.routeSource(source, coordinates, directionsOptions));\n  }\n\n  routeSource(\n    source: DirectionsSource,\n    coordinates: [number, number][],\n    directionsOptions: DirectionOptions = {}\n  ): Observable<Direction[]> {\n    const request = source.route(coordinates, directionsOptions );\n    return request;\n  }\n}\n","import { FEATURE } from '../../feature/shared/feature.enums';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { SearchSource } from './sources/source';\nimport { SearchResult } from './search.interfaces';\n\n/**\n * Function that checks whether a search source implements TextSearch\n * @param source Search source\n * @returns True if the search source implements TextSearch\n */\nexport function sourceCanSearch(source: SearchSource): boolean {\n  return (source as any).search !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch\n * @param source Search source\n * @returns True if the search source implements ReverseSearch\n */\nexport function sourceCanReverseSearch(source: SearchSource): boolean {\n  return (source as any).reverseSearch !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch AND is shown in the pointer summary\n * @param source Search source\n * @returns True if the search source implements ReverseSearch AND is shown in the pointer summary\n */\nexport function sourceCanReverseSearchAsSummary(source: SearchSource): boolean {\n  return (source as any).reverseSearch !== undefined && source.showInPointerSummary === true;\n}\n\n/**\n * Return a search result out of an Feature. This is used to adapt\n * the IGO query module to the new Feature/SearchResult interfaces\n * @param feature feature\n * @param source Search source\n * @returns SearchResult\n */\nexport function featureToSearchResult(\n  feature: Feature,\n  source: SearchSource\n): SearchResult<Feature> {\n  feature.sourceId = source.getId();\n  return {\n    source,\n    data: feature,\n    meta: {\n      dataType: FEATURE,\n      id: feature.meta.id as string,\n      title: feature.meta.title,\n      icon: feature.meta.icon || 'map-marker'\n    }\n  };\n}\n\nexport function findDiff(str1: string, str2: string){\n  let diff = '';\n  str2.split('').forEach((val, i) => {\n    if (val !== str1.charAt(i)) {\n      diff += val;\n    }\n  });\n  return diff;\n}\n\n\n/**\n * Return a score calculation based on \"from\" term with the \"to\" term,\n * where the perfect match is 100 and a total difference is 0 or under.\n * @param from string\n * @param to string\n * @param caseSensitive boolean\n * @returns number\n */\nexport function computeTermSimilarity(from, to, caseSensitive: boolean = false): number {\n  if (!from || !to) {\n    return 0;\n  }\n  const termFrom = caseSensitive ? from : from.toLowerCase();\n  const termTo = caseSensitive ? to : to.toLowerCase();\n  const fromToDiff = findDiff(termFrom, termTo);\n  const toFromDiff = findDiff(termTo, termFrom);\n  const totalDiff = fromToDiff + toFromDiff;\n\n  let delta = 0;\n  if (totalDiff.length) {\n    delta = totalDiff.length / termFrom.length * 100;\n  }\n\n  return 100 - Math.floor(delta);\n}\n","import { SearchSource } from './sources/source';\nimport { SearchSourceSettings } from './sources/source.interfaces';\n\n/**\n * Service where all available search sources are registered.\n */\nexport class SearchSourceService {\n\n  constructor(private sources: SearchSource[]) {}\n\n  /**\n   * Return available search sources\n   * @returns Search sources\n   */\n  getSources(): SearchSource[] {\n    return this.sources;\n  }\n\n  /**\n   * Return enabled search sources\n   * @returns Search sources\n   */\n  getEnabledSources(): SearchSource[] {\n    return this.getSources().filter(\n      (source: SearchSource) => source.enabled === true\n    );\n  }\n\n  /**\n   * Enable search sources of given type\n   * @param type Search type\n   * @todo It would be better to track the enabled search sources\n   *  without updating their 'enabled' property.\n   */\n  enableSourcesByType(type: string) {\n    this.getSources().forEach((source: SearchSource) => {\n      if ((source.constructor as typeof SearchSource).type === type) {\n        source.enabled = true;\n      } else {\n        source.enabled = false;\n      }\n    });\n  }\n\n  /**\n   * Set Param from the selected settings\n   * @param source search-source\n   * @param setting settings\n   */\n  setParamFromSetting(source: SearchSource, setting: SearchSourceSettings) {\n    source.setParamFromSetting(setting);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { stringToLonLat } from '../../map';\nimport { MapService } from '../../map/shared/map.service';\n\nimport { SearchSource, TextSearch, ReverseSearch } from './sources/source';\nimport {\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './sources/source.interfaces';\nimport { SearchSourceService } from './search-source.service';\nimport { Research } from './search.interfaces';\nimport {\n  sourceCanSearch,\n  sourceCanReverseSearch,\n  sourceCanReverseSearchAsSummary\n} from './search.utils';\n\n/**\n * This service perform researches in all the search sources enabled.\n * It returns Research objects who's 'request' property needs to be\n * subscribed to in order to trigger the research. This services has\n * keeps internal state of the researches it performed\n * and the results they yielded.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class SearchService {\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mapService: MapService\n  ) {}\n\n  /**\n   * Perform a research by text\n   * @param term Any text\n   * @returns Researches\n   */\n  search(term: string, options: TextSearchOptions = {}): Research[] {\n    if (!this.termIsValid(term)) {\n      return [];\n    }\n\n    const proj = this.mapService.getMap()?.projection || 'EPSG:3857';\n    const response = stringToLonLat(term, proj, {\n      forceNA: options.forceNA\n    });\n    if (response.lonLat) {\n      return this.reverseSearch(response.lonLat, { distance: response.radius, conf: response.conf });\n    } else if (response.message) {\n      console.log(response.message);\n    }\n\n    options.extent = this.mapService\n      .getMap()\n      ?.viewController.getExtent('EPSG:4326');\n\n    let sources;\n\n    if (options.getEnabledOnly || options.getEnabledOnly === undefined) {\n      sources = this.searchSourceService.getEnabledSources();\n    } else {\n      sources = this.searchSourceService.getSources();\n    }\n\n    if (options.sourceId) {\n      sources = sources.filter((source) => source.getId() === options.sourceId);\n    } else if (options.searchType) {\n      sources = sources.filter(\n        (source) => source.getType() === options.searchType\n      );\n    }\n\n    sources = sources.filter(sourceCanSearch);\n    return this.searchSources(sources, term, options);\n  }\n\n  /**\n   * Perform a research by lon/lat\n   * @param lonLat Any lon/lat coordinates\n   * @returns Researches\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions,\n    asPointerSummary: boolean = false\n  ) {\n    const reverseSourceFonction = asPointerSummary\n      ? sourceCanReverseSearchAsSummary\n      : sourceCanReverseSearch;\n    const sources = this.searchSourceService\n      .getEnabledSources()\n      .filter(reverseSourceFonction);\n    return this.reverseSearchSources(sources, lonLat, options || {});\n  }\n\n  /**\n   * Create a text research out of all given search sources\n   * @param sources Search sources that implement TextSearch\n   * @param term Search term\n   * @returns Observable of Researches\n   */\n  private searchSources(\n    sources: SearchSource[],\n    term: string,\n    options: TextSearchOptions\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: ((source as any) as TextSearch).search(term, options),\n        reverse: false,\n        source\n      };\n    });\n  }\n\n  /**\n   * Create a reverse research out of all given search sources\n   * @param sources Search sources that implement ReverseSearch\n   * @param lonLat Any lon/lat coordinates\n   * @returns Observable of Researches\n   */\n  private reverseSearchSources(\n    sources: SearchSource[],\n    lonLat: [number, number],\n    options: ReverseSearchOptions\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: ((source as any) as ReverseSearch).reverseSearch(\n          lonLat,\n          options\n        ),\n        reverse: true,\n        source\n      };\n    });\n  }\n\n  /**\n   * Validate that a search term is valid\n   * @param term Search term\n   * @returns True if the search term is valid\n   */\n  private termIsValid(term: string): boolean {\n    return typeof term === 'string' && term !== '';\n  }\n}\n","<div class=\"igo-form-button-group\">\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.directionsForm.addStop' | translate\" color=\"primary\" (click)=\"addStop()\">\n    <mat-icon svgIcon=\"map-marker-plus\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1 || (stopsStore.count$ | async)>=1\"\n    [matTooltip]=\"'igo.geo.directionsForm.resetDirectionsBtn' | translate\" color=\"warn\" (click)=\"resetStops()\">\n    <mat-icon svgIcon=\"file-restore\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"zoomRoute()\"\n    [matTooltip]=\"'igo.geo.directionsForm.zoomRoute' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"magnify-plus-outline\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"copyDirectionsToClipboard()\"\n    [matTooltip]=\"'igo.geo.directionsForm.copy' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"content-copy\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"copyLinkToClipboard()\" \n    [matTooltip]=\"'igo.geo.directionsForm.link' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"link\"></mat-icon>\n  </button>\n</div>","import { Component, Input, Optional } from '@angular/core';\nimport { LanguageService, MessageService, RouteService } from '@igo2/core';\nimport { Clipboard } from '@igo2/utils';\nimport { Subject } from 'rxjs';\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { FeatureWithDirection } from '../shared/directions.interface';\n\nimport { addStopToStore, formatDistance, formatDuration, formatInstruction } from '../shared/directions.utils';\nimport { RoutesFeatureStore, StopsStore } from '../shared/store';\n\n@Component({\n  selector: 'igo-directions-buttons',\n  templateUrl: './directions-buttons.component.html',\n  styleUrls: ['./directions-buttons.component.scss']\n})\nexport class DirectionsButtonsComponent {\n\n  get activeRoute() {\n    return this.routesFeatureStore.all().find(route => route.properties.active);\n  }\n\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n  @Input() stopsStore: StopsStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  constructor(\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    @Optional() private route: RouteService) { }\n\n  resetStops() {\n    this.stopsStore.clearStops();\n  }\n\n  // stop are always added before the last stop.\n  addStop(): void {\n    addStopToStore(this.stopsStore);\n  }\n\n\n  copyLinkToClipboard() {\n    const successful = Clipboard.copy(this.getUrl());\n    if (successful) {\n      const translate = this.languageService.translate;\n      const title = translate.instant(\n        'igo.geo.directionsForm.dialog.copyTitle'\n      );\n      const msg = translate.instant(\n        'igo.geo.directionsForm.dialog.copyMsgLink'\n      );\n      this.messageService.success(msg, title);\n    }\n  }\n\n  zoomRoute() {\n    this.zoomToActiveRoute$.next();\n  }\n\n  copyDirectionsToClipboard() {\n    const directionsBody = this.directionsToText();\n    const successful = Clipboard.copy(directionsBody);\n    if (successful) {\n      const translate = this.languageService.translate;\n      const title = translate.instant(\n        'igo.geo.directionsForm.dialog.copyTitle'\n      );\n      const msg = translate.instant('igo.geo.directionsForm.dialog.copyMsg');\n      this.messageService.success(msg, title);\n    }\n  }\n\n  private directionsToText() {\n    const indent = '\\t';\n    let activeRouteDirective =\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.instructions'\n      ) + ':\\n';\n    let wayPointList = '';\n    const summary =\n      this.languageService.translate.instant('igo.geo.directionsForm.summary') +\n      ': \\n' +\n      indent +\n      this.activeRoute.properties.direction.title +\n      '\\n' +\n      indent +\n      formatDistance(this.activeRoute.properties.direction.distance) +\n      '\\n' +\n      indent +\n      formatDuration(this.activeRoute.properties.direction.duration) +\n      '\\n\\n' +\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.stopsList'\n      ) +\n      ':\\n';\n\n    const url =\n      this.languageService.translate.instant('igo.geo.directionsForm.link') +\n      ':\\n' +\n      indent +\n      this.getUrl();\n\n    let wayPointsCnt = 1;\n    this.stopsStore.view.all().forEach(stop => {\n      let coord = '';\n      let stopText = '';\n      if (stop.text !== roundCoordTo(stop.coordinates).join(',')) {\n        stopText = stop.text;\n        coord = ` ( ${roundCoordTo(stop.coordinates).join(',')} )`;\n      } else {\n        stopText = roundCoordTo(stop.coordinates).join(\n          ','\n        );\n      }\n\n      wayPointList =\n        wayPointList +\n        indent +\n        wayPointsCnt.toLocaleString() +\n        '. ' +\n        stopText +\n        coord +\n        '\\n';\n      wayPointsCnt++;\n    });\n\n    let localCnt = 0;\n    this.activeRoute.properties.direction.steps.forEach(step => {\n      const instruction = this.formatStep(step, localCnt).instruction;\n      const distance =\n        formatDistance(step.distance) === undefined\n          ? ''\n          : ' (' + formatDistance(step.distance) + ')';\n      activeRouteDirective =\n        activeRouteDirective +\n        indent +\n        (localCnt + 1).toLocaleString() +\n        '. ' +\n        instruction +\n        distance +\n        '\\n';\n      localCnt++;\n    });\n\n    const directionsBody =\n      summary + wayPointList + '\\n' + url + '\\n\\n' + activeRouteDirective;\n\n    return directionsBody;\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeRoute.properties.direction.steps.length - 1\n    );\n  }\n\n  private getUrl() {\n    if (!this.route) {\n      return;\n    }\n\n    const pos = this.routesFeatureStore.all()\n    .map((direction: FeatureWithDirection) => direction.properties.id).indexOf(this.activeRoute.properties.id);\n    let routingOptions = '';\n    if (pos !== 0) {\n      const routingOptionsKey = this.route.options.directionsOptionsKey;\n      routingOptions = `&${routingOptionsKey}=result:${pos}`;\n    }\n    const directionsKey = this.route.options.directionsCoordKey;\n    const stopsCoordinates = this.stopsStore.view.all().map(stop => roundCoordTo(stop.coordinates, 6));\n    let directionsUrl = '';\n    if (stopsCoordinates.length >= 2) {\n      directionsUrl = `${directionsKey}=${stopsCoordinates.join(';')}`;\n      return `${location.origin}${location.pathname}?tool=directions&sidenav=1&${directionsUrl}${routingOptions}`;\n    }\n    return;\n  }\n}\n","<div class=\"igo-input-container\" *ngIf=\"directions && activeDirection\">\n    <mat-form-field *ngIf=\"directions && directions.length > 1\">\n        <mat-select placeholder=\"{{'igo.geo.directionsForm.drivingOptions' | translate}}\"\n            (selectionChange)=\"changeRoute()\" [(ngModel)]=\"activeDirection\">\n            <mat-option *ngFor=\"let direction of directions; let cnt = index;\" [value]=\"direction\">\n                Option {{cnt + 1}} : {{formatDistance(direction.distance)}}\n                ({{formatDuration(direction.duration)}})\n            </mat-option>\n        </mat-select>\n    </mat-form-field>\n\n    <mat-divider *ngIf=\"directions && directions.length === 0\"></mat-divider>\n\n    <mat-list (mouseleave)=\"onStepsListBlur()\">\n        <h2 mat-header class=\"igo-route-title mat-typography\">{{activeDirection.title}}</h2>\n        <h2 mat-subheader>{{formatDistance(activeDirection.distance)}}, {{formatDuration(activeDirection.duration)}}</h2>\n        <mat-list-item class=\"igo-steps\" \n            (mouseenter)=\"showSegment(step)\" \n            (click)=\"showSegment(step,true)\" \n            *ngFor=\"let step of activeDirection.steps; let cnt = index;\" igoListItem>\n            <mat-icon [ngClass]=\"formatStep(step,cnt).cssClass\" mat-list-icon svgIcon=\"{{formatStep(step,cnt).image}}\">\n            </mat-icon>\n\n            <h4 mat-line>{{cnt +1}}. {{formatStep(step,cnt).instruction}}</h4>\n            <h4 mat-line class=\"right\">{{formatDistance(step.distance)}}</h4>\n        </mat-list-item>\n\n        <mat-divider></mat-divider>\n\n    </mat-list>\n\n</div>","import { ChangeDetectorRef, Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport { LanguageService } from '@igo2/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { Direction, FeatureWithStep, IgoStep } from '../shared/directions.interface';\nimport { formatDistance, formatDuration, formatInstruction } from '../shared/directions.utils';\nimport { RoutesFeatureStore, StepFeatureStore } from '../shared/store';\n\nimport olFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olGeom from 'ol/geom';\n\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { DirectionType } from '../shared/directions.enum';\n\n@Component({\n  selector: 'igo-directions-results',\n  templateUrl: './directions-results.component.html',\n  styleUrls: ['./directions-results.component.scss']\n})\nexport class DirectionsResultsComponent implements OnInit, OnDestroy {\n\n  public activeDirection: Direction;\n  public directions: Direction[];\n\n  private entities$$: Subscription;\n\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n\n  constructor(\n    private languageService: LanguageService,\n    private cdRef: ChangeDetectorRef\n  ) { }\n\n  ngOnInit(): void {\n    this.entities$$ = this.routesFeatureStore.entities$\n      .pipe(debounceTime(200))\n      .subscribe(entities => {\n        const activeFeatureWithDirection = entities.find(entity => entity.properties.active);\n        this.directions = entities.map(entity => entity.properties.direction);\n        if (activeFeatureWithDirection) {\n          this.activeDirection = activeFeatureWithDirection.properties.direction;\n        } else {\n          this.activeDirection = undefined;\n        }\n        this.cdRef.detectChanges();\n      });\n  }\n\n  ngOnDestroy(): void {\n    this.entities$$.unsubscribe();\n  }\n\n  changeRoute() {\n    this.routesFeatureStore.entities$.value.map(entity =>\n      entity.properties.active = !entity.properties.active\n    );\n    this.routesFeatureStore.layer.ol.getSource().getFeatures().map(feature =>\n      feature.set('active', !feature.get('active'))\n    );\n  }\n\n  formatDistance(distance: number): string {\n    return formatDistance(distance);\n  }\n\n  formatDuration(duration: number): string {\n    return formatDuration(duration);\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeDirection.steps.length - 1\n    );\n  }\n\n  onStepsListBlur() {\n    this.stepFeatureStore.clear();\n  }\n\n  showSegment(step: IgoStep, zoomToExtent = false) {\n    this.showRouteSegmentGeometry(step, zoomToExtent);\n  }\n\n  showRouteSegmentGeometry(step: IgoStep, zoomToExtent = false) {\n\n    const coordinates = step.geometry.coordinates;\n    const vertexId = 'vertex';\n    const geometry4326 = new olGeom.LineString(coordinates);\n    const geometryMapProjection = geometry4326.transform(\n      'EPSG:4326',\n      this.stepFeatureStore.layer.map.projection\n    );\n    const routeSegmentCoordinates = (geometryMapProjection as any).getCoordinates();\n    const lastPoint = routeSegmentCoordinates[0];\n\n    const geometry = new olGeom.Point(lastPoint);\n    const feature = new olFeature({ geometry });\n\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.stepFeatureStore.layer.map.projection,\n      dataProjection: this.stepFeatureStore.layer.map.projection\n    }) as FeatureGeometry;\n\n    const previousVertex = this.stepFeatureStore.get(vertexId);\n    const previousVertexRevision = previousVertex\n      ? previousVertex.meta.revision\n      : 0;\n\n    const stepFeature: FeatureWithStep = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.stepFeatureStore.layer.map.projection,\n      properties: {\n        id: vertexId,\n        step,\n        type: DirectionType.Vertex\n      },\n      meta: {\n        id: vertexId,\n        revision: previousVertexRevision + 1\n      },\n      ol: feature\n    };\n    this.stepFeatureStore.update(stepFeature);\n    if (zoomToExtent) {\n      this.stepFeatureStore.layer.map.viewController.zoomToExtent(feature.getGeometry().getExtent() as [number, number, number, number]);\n    }\n  }\n\n}\n","import { ChangeDetectorRef, Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { debounceTime, distinctUntilChanged, map } from 'rxjs/operators';\n\nimport { LanguageService } from '@igo2/core';\nimport { EntityStoreWatcher } from '@igo2/common';\n\nimport * as olCondition from 'ol/events/condition';\nimport * as olInteraction from 'ol/interaction';\nimport * as olProj from 'ol/proj';\nimport { TranslateEvent } from 'ol/interaction/Translate';\nimport Collection from 'ol/Collection';\nimport { SelectEvent } from 'ol/interaction/Select';\n\nimport { DirectionOptions, FeatureWithStopProperties, Stop } from './shared/directions.interface';\nimport { Subject, Subscription } from 'rxjs';\nimport { addDirectionToRoutesFeatureStore, addStopToStopsFeatureStore, addStopToStore,\n  initRoutesFeatureStore, initStepFeatureStore, initStopsFeatureStore, updateStoreSorting } from './shared/directions.utils';\nimport { Feature } from '../feature/shared/feature.interfaces';\nimport { DirectionsService } from './shared/directions.service';\nimport { DirectionType, ProposalType } from './shared/directions.enum';\nimport { roundCoordTo, stringToLonLat } from '../map';\nimport { SearchService } from '../search/shared/search.service';\nimport { ChangeUtils, ObjectUtils } from '@igo2/utils';\nimport { RoutesFeatureStore, StepFeatureStore, StopsFeatureStore, StopsStore } from './shared/store';\nimport { FeatureStoreLoadingStrategy } from '../feature/shared/strategies/loading';\nimport { Research, SearchResult } from '../search/shared/search.interfaces';\nimport { QueryService } from '../query/shared/query.service';\n\n@Component({\n  selector: 'igo-directions',\n  templateUrl: './directions.component.html',\n  styleUrls: ['./directions.component.scss']\n})\nexport class DirectionsComponent implements OnInit, OnDestroy {\n\n  private watcher: EntityStoreWatcher<Stop>;\n\n  public projection: string = 'EPSG:4326';\n\n  private zoomRoute$$: Subscription;\n  private storeEmpty$$: Subscription;\n  private storeChange$$: Subscription;\n  private routesQueries$$: Subscription[] = [];\n\n  private selectStopInteraction: olInteraction.Select;\n  private translateStop: olInteraction.Translate;\n  private selectedRoute;\n  private focusOnStop: boolean = false;\n  private isTranslating: boolean = false;\n\n  public previousStops: Stop[] = [];\n\n  private searchs$$: Subscription[] = [];\n\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n  @Input() coordRoundedDecimals: number = 6;\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private languageService: LanguageService,\n    private directionsService: DirectionsService,\n    private searchService: SearchService,\n    private queryService: QueryService\n  ) { }\n\n\n  ngOnInit(): void {\n    this.queryService.queryEnabled = false;\n    this.initEntityStores();\n    setTimeout(() => {\n      initStopsFeatureStore(this.stopsFeatureStore, this.languageService);\n      initRoutesFeatureStore(this.routesFeatureStore, this.languageService);\n      initStepFeatureStore(this.stepFeatureStore);\n      this.initOlInteraction();\n    }, 1);\n\n  }\n\n  ngOnDestroy(): void {\n    this.queryService.queryEnabled = true;\n    this.storeEmpty$$.unsubscribe();\n    this.storeChange$$.unsubscribe();\n    this.routesQueries$$.map((u) => u.unsubscribe());\n    this.zoomRoute$$.unsubscribe();\n    this.freezeStores();\n  }\n\n  private freezeStores() {\n    this.stopsFeatureStore.layer.map.ol.removeInteraction(this.selectStopInteraction);\n    this.stopsFeatureStore.layer.map.ol.removeInteraction(this.translateStop);\n    this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute);\n    this.stopsFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    this.routesFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    this.stepFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n  }\n\n  private initEntityStores() {\n    this.watcher = new EntityStoreWatcher(this.stopsStore, this.cdRef);\n    this.monitorEmptyEntityStore();\n    this.monitorEntityStoreChange();\n    this.monitorActiveRouteZoom();\n  }\n\n  private monitorActiveRouteZoom() {\n    this.zoomRoute$$ = this.zoomToActiveRoute$.subscribe(() => {\n      if (this.routesFeatureStore.count >= 1) {\n        const activeRoute = this.routesFeatureStore.all().find(route => route.properties.active);\n\n        if (activeRoute) {\n          activeRoute.ol.getGeometry();\n          const routeExtent = activeRoute.ol.getGeometry().getExtent();\n          this.routesFeatureStore.layer.map.viewController.zoomToExtent(routeExtent as [number, number, number, number]);\n        }\n      }\n    });\n  }\n\n  private initOlInteraction() {\n    this.selectStopInteraction = new olInteraction.Select({\n      layers: [this.stopsFeatureStore.layer.ol],\n      hitTolerance: 7,\n      condition: (event) => {\n        return event.type === 'pointermove' && !event.dragging;\n      }\n    });\n\n    this.translateStop = new olInteraction.Translate({\n      features: this.selectStopInteraction.getFeatures()\n    });\n    this.translateStop.on('translating', (evt: TranslateEvent) => {\n      this.isTranslating = true;\n      this.executeStopTranslation(evt.features);\n    });\n    this.translateStop.on('translateend', (evt: TranslateEvent) => {\n      this.isTranslating = false;\n      this.executeStopTranslation(evt.features);\n    });\n\n    this.selectedRoute = new olInteraction.Select({\n      layers: [this.routesFeatureStore.layer.ol],\n      condition: olCondition.click,\n      hitTolerance: 7,\n      filter: feature => {\n        return feature.get('type') === DirectionType.Route &&\n          feature.get('active') &&\n          !this.isTranslating;\n      }\n    });\n    this.selectedRoute.on('select', (evt: SelectEvent) => {\n      if (this.focusOnStop === false) {\n        const selectCoordinates = roundCoordTo(\n          olProj.transform(\n            (evt as any).mapBrowserEvent.coordinate,\n            this.routesFeatureStore.layer.map.projection,\n            this.projection\n          ) as [number, number], this.coordRoundedDecimals);\n        const addedStop = addStopToStore(this.stopsStore);\n        addedStop.text = selectCoordinates.join(',');\n        addedStop.coordinates = [selectCoordinates[0], selectCoordinates[1]];\n      }\n    });\n\n    this.stopsFeatureStore.layer.map.ol.addInteraction(this.selectStopInteraction);\n    this.stopsFeatureStore.layer.map.ol.addInteraction(this.translateStop);\n    this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\n  }\n\n  onStopInputHasFocusChange(stopInputHasFocus: boolean) {\n    stopInputHasFocus ?\n      this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute) :\n      this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\n  }\n\n  private executeStopTranslation(\n    features: Collection<any>\n  ) {\n    if (features.getLength() === 0) {\n      return;\n    }\n    const firstFeature = features.getArray()[0];\n    const translatedStopId = firstFeature.getId();\n\n    const translationCoordinates = olProj.transform(\n      firstFeature.getGeometry().getCoordinates(),\n      this.stopsFeatureStore.layer.map.projection,\n      this.projection\n    );\n    const translatedStop = this.stopsStore.get(translatedStopId);\n    const roundedCoord = roundCoordTo(translationCoordinates as [number, number], this.coordRoundedDecimals);\n    translatedStop.coordinates = roundedCoord;\n    translatedStop.text = roundedCoord.join(',');\n    this.stopsStore.update(translatedStop);\n  }\n\n\n  private monitorEmptyEntityStore() {\n    // Watch if the store is empty to reset it\n    this.storeEmpty$$ = this.stopsStore.count$\n      .pipe(\n        distinctUntilChanged()\n      ).subscribe((count) => {\n        if (count < 2) {\n          addStopToStore(this.stopsStore);\n          if (this.stopsStore.count === 2) {\n            this.stopsStore.storeInitialized$.next(true);\n            return;\n          }\n          this.stopsStore.storeInitialized$.next(false);\n        }\n        this.routesQueries$$.map((u) => u.unsubscribe());\n      });\n  }\n\n  private monitorEntityStoreChange() {\n    this.storeChange$$ = this.stopsStore.entities$\n      .pipe(debounceTime(this.debounce))\n      .subscribe((stops: Stop[]) => {\n        this.handleStopDiff(stops);\n        updateStoreSorting(this.stopsStore);\n        this.handleStopsFeature();\n        this.getRoutes(this.isTranslating);\n      });\n  }\n\n  cancelSearch() {\n    this.searchs$$.map(s => s.unsubscribe());\n  }\n\n  private handleStopDiff(stops: Stop[]) {\n    const simplifiedStops = stops.map((stop: Stop) => {\n      return ObjectUtils.removeUndefined({ ...{ id: stop.id, text: stop.text, coordinates: stop.coordinates } });\n    });\n    const diff = ChangeUtils.findChanges(this.previousStops, simplifiedStops, ['coordinates']);\n    const stopIdToProcess = diff.added.concat(diff.modified);\n    if (stopIdToProcess) {\n      stopIdToProcess.map((change) => {\n        const changedStop = (change.newValue as Stop);\n        if (changedStop) {\n          const stop: Stop = this.stopsStore.get(changedStop.id);\n          const term = stop.text;\n          if (!term || term.length === 0) {\n            return;\n          }\n          const response = stringToLonLat(term, this.stopsFeatureStore.layer.map.projection);\n          let researches: Research[];\n          let isCoord = false;\n          if (response.lonLat) {\n            isCoord = true;\n          }\n          researches = this.searchService.search(term, { searchType: 'Feature' });\n          this.cancelSearch();\n          const requests$ = researches.map(res => res.request\n            .pipe(map((results: SearchResult[]) => results.filter(r =>\n              isCoord ? r.data.geometry.type === 'Point' && r.data.geometry : r.data.geometry)))\n\n          );\n          this.searchs$$ = requests$.map((request) => {\n            return request.pipe(map((results: SearchResult[]) => results.filter(r =>\n              isCoord ? r.data.geometry.type === 'Point' && r.data.geometry : r.data.geometry)))\n              .subscribe((res: SearchResult[]) => {\n                if (res.length > 0) {\n                  const source = res[0].source;\n                  const meta = res[0].meta;\n                  const results = res.map(r => r.data);\n                  if (!stop.searchProposals) {\n                    stop.searchProposals = [];\n                  }\n                  stop.searchProposals = stop.searchProposals.filter(sp => sp.type === (isCoord ? ProposalType.Coord : ProposalType.Text));\n                  let storedSource = stop.searchProposals.find(sp => sp.source === source);\n                  if (storedSource) {\n                    storedSource.results = results;\n                  } else {\n                    stop.searchProposals.push({\n                      type: isCoord ? ProposalType.Coord : ProposalType.Text,\n                      source,\n                      meta,\n                      results\n                    });\n                  }\n                }\n                this.cdRef.detectChanges();\n              });\n          });\n        }\n      });\n    }\n    this.previousStops = simplifiedStops;\n  }\n\n  private handleStopsFeature() {\n    const stops = this.stopsStore.all();\n    const stopsWithCoordinates = stops.filter(stop => stop.coordinates);\n    stopsWithCoordinates.map(stop => this.addStopOverlay(stop));\n    this.stopsFeatureStore.all().map(\n      (stopFeature: Feature<FeatureWithStopProperties>) => {\n        if (!this.stopsStore.get(stopFeature.properties.id)) {\n          this.stopsFeatureStore.delete(stopFeature);\n        }\n      });\n    const stopsWithoutCoordinates = stops.filter(stop => !stop.coordinates);\n    stopsWithoutCoordinates.map(stop => {\n      const stopFeature = this.stopsFeatureStore.get(stop.id);\n      if (stopFeature) {\n        this.stopsFeatureStore.delete(stopFeature);\n      }\n    });\n  }\n\n  private getRoutes(isOverview: boolean = false) {\n    const stopsWithCoordinates = this.stopsStore.view\n      .all()\n      .filter(stop => stop.coordinates);\n    if (stopsWithCoordinates.length < 2) {\n      this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n      return;\n    }\n\n    const roundedCoordinates = stopsWithCoordinates.map((stop) => {\n      const roundedCoord = roundCoordTo(stop.coordinates, this.coordRoundedDecimals);\n      return roundedCoord;\n    });\n    const overviewDirectionsOptions: DirectionOptions = {\n      overview: true,\n      steps: false,\n      alternatives: false,\n      continue_straight: false\n    };\n    this.routesQueries$$.map((u) => u.unsubscribe());\n    const routeResponse = this.directionsService.route(\n      roundedCoordinates,\n      isOverview ? overviewDirectionsOptions : undefined\n    );\n    if (routeResponse) {\n      routeResponse.map(res =>\n        this.routesQueries$$.push(\n          res.subscribe(directions => {\n            this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n            directions.map(direction =>\n              addDirectionToRoutesFeatureStore(\n                this.routesFeatureStore,\n                direction,\n                this.projection,\n                direction === directions[0] ? true : false)\n            );\n          })\n        )\n      );\n    }\n  }\n\n  public addStopOverlay(stop: Stop) {\n    addStopToStopsFeatureStore(stop, this.stopsStore, this.stopsFeatureStore, this.projection, this.languageService);\n  }\n}\n","<igo-directions-buttons [zoomToActiveRoute$]=\"zoomToActiveRoute$\" [routesFeatureStore]=\"routesFeatureStore\" [stopsStore]=\"stopsStore\"></igo-directions-buttons>\n\n<igo-directions-inputs (stopInputHasFocus)=\"onStopInputHasFocusChange($event)\" [coordRoundedDecimals]=\"coordRoundedDecimals\" [projection]=\"projection\" [stopsFeatureStore]=\"stopsFeatureStore\" [stopsStore]=\"stopsStore\" [debounce]=\"debounce\" [length]=\"length\"></igo-directions-inputs>\n<br>\n<igo-directions-results [stepFeatureStore]=\"stepFeatureStore\" [routesFeatureStore]=\"routesFeatureStore\"></igo-directions-results>","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { provideDirectionsSourceService } from './shared/directions-source.service';\nimport { DragDropModule } from '@angular/cdk/drag-drop';\nimport { DirectionsInputsComponent } from './directions-inputs/directions-inputs.component';\nimport { DirectionsComponent } from './directions.component';\nimport { DirectionsButtonsComponent } from './directions-buttons/directions-buttons.component';\nimport { DirectionsResultsComponent } from './directions-results/directions-results.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    DragDropModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatListModule,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatOptionModule,\n    MatSelectModule,\n    MatTooltipModule,\n    MatAutocompleteModule,\n    IgoLanguageModule\n  ],\n  exports: [\n    DirectionsComponent,\n    DirectionsInputsComponent,\n    DirectionsButtonsComponent,\n    DirectionsResultsComponent\n  ],\n  declarations: [\n     DirectionsComponent,\n    DirectionsInputsComponent,\n    DirectionsButtonsComponent,\n    DirectionsResultsComponent\n  ],\n  providers: [provideDirectionsSourceService()]\n})\nexport class IgoDirectionsModule {\n  static forRoot(): ModuleWithProviders<IgoDirectionsModule> {\n    return {\n      ngModule: IgoDirectionsModule\n    };\n  }\n}\n","import { SearchSource } from './sources/source';\nimport { SearchSourceService } from './search-source.service';\n\n/**\n * Search source factory\n * @ignore\n */\nexport function searchSourceServiceFactory(sources: SearchSource[]) {\n  return new SearchSourceService(sources);\n}\n\n/**\n * Function that returns a provider for the SearchSource service\n */\nexport function provideSearchSourceService() {\n  return {\n    provide: SearchSourceService,\n    useFactory: searchSourceServiceFactory,\n    deps: [SearchSource]\n  };\n}\n","import { Injectable, Inject, Injector } from '@angular/core';\nimport { HttpClient, HttpParams, HttpParameterCodec } from '@angular/common/http';\n\nimport { Observable, of, BehaviorSubject } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { AuthService } from '@igo2/auth';\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport pointOnFeature from '@turf/point-on-feature';\n\nimport { FEATURE, Feature } from '../../../feature';\nimport { GoogleLinks } from './../../../utils/googleLinks';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch, ReverseSearch } from './source';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './source.interfaces';\nimport {\n  IChercheData,\n  IChercheResponse,\n  IChercheReverseData,\n  IChercheReverseResponse\n} from './icherche.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class IChercheSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n\n// Fix the \"+\" is replaced with space \" \" in a query string\n// https://github.com/angular/angular/issues/11058\nexport class IgoHttpParameterCodec implements HttpParameterCodec {\n  encodeKey(key: string): string {\n    return encodeURIComponent(key);\n  }\n\n  encodeValue(value: string): string {\n    return encodeURIComponent(value);\n  }\n\n  decodeKey(key: string): string {\n    return decodeURIComponent(key);\n  }\n\n  decodeValue(value: string): string {\n    return decodeURIComponent(value);\n  }\n}\n\n/**\n * ICherche search source\n */\n@Injectable()\nexport class IChercheSearchSource extends SearchSource implements TextSearch {\n  static id = 'icherche';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  private hashtagsLieuxToKeep = [];\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    @Inject(IChercheSearchResultFormatter)\n    private formatter: IChercheSearchResultFormatter,\n    injector: Injector\n  ) {\n    super(options, storageService);\n\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe((title) => this.title$.next(title));\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n  }\n\n  getId(): string {\n    return IChercheSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n\n    const types = this.options.params?.type\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n        : [\n            'adresses',\n            'codes-postaux',\n            'routes',\n            'intersections',\n            'municipalites',\n            'mrc',\n            'regadmin',\n            'lieux'\n          ];\n\n    return {\n      title: 'igo.geo.search.icherche.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1,\n              hashtags: ['adresse']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldAddress',\n              value: 'anciennes-adresses',\n              enabled: types.indexOf('anciennes-adresses') !== -1,\n              hashtags: ['anciennes-adresses']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.postalCode',\n              value: 'codes-postaux',\n              enabled: types.indexOf('codes-postaux') !== -1,\n              hashtags: ['code-postal']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              hashtags: ['route']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.intersection',\n              value: 'intersections',\n              enabled: types.indexOf('intersections') !== -1,\n              hashtags: ['intersection', '+']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1,\n              hashtags: ['municipalité', 'mun']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldCity',\n              value: 'anciennes-municipalites',\n              enabled: types.indexOf('anciennes-municipalites') !== -1,\n              hashtags: ['anciennes-municipalites']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1,\n              hashtags: ['mrc']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1,\n              hashtags: ['région-administrative', 'regadmin']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.entreprise',\n              value: 'entreprises',\n              enabled: types.indexOf('entreprises') !== -1,\n              available: false,\n              hashtags: ['entreprise']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.place',\n              value: 'lieux',\n              enabled: types.indexOf('lieux') !== -1,\n              hashtags: ['lieu']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.exit',\n              value: 'sorties-autoroute',\n              enabled: types.indexOf('sorties-autoroute') !== -1,\n              hashtags: ['sortie', 'sorties', 'exit']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.km',\n              value: 'bornes-km',\n              enabled: types.indexOf('bornes-km') !== -1,\n              hashtags: ['borne', 'bornes', 'repère', 'km']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.gcc',\n              value: 'bornes-gcc',\n              enabled: types.indexOf('bornes-gcc') !== -1,\n              hashtags: ['borne', 'bornes', 'repère', 'gcc', 'ccg']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cn',\n              value: 'bornes-cn',\n              enabled: types.indexOf('bornes-cn') !== -1,\n              hashtags: ['borne', 'bornes', 'cn']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.sumi',\n              value: 'bornes-sumi',\n              enabled: types.indexOf('bornes-sumi') !== -1,\n              hashtags: ['borne', 'bornes', 'sumi']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.hq',\n              value: 'hq',\n              enabled: types.indexOf('hq') !== -1,\n              hashtags: ['hq']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cadastre',\n              value: 'cadastre',\n              enabled: types.indexOf('cadastre') !== -1,\n              hashtags: ['cadastre']\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'ecmax',\n          name: 'ecmax',\n          values: [\n            {\n              title: '10 %',\n              value: 10,\n              enabled: ecmax === 10\n            },\n            {\n              title: '30 %',\n              value: 30,\n              enabled: ecmax === 30 || !ecmax\n            },\n            {\n              title: '50 %',\n              value: 50,\n              enabled: ecmax === 50\n            },\n            {\n              title: '75 %',\n              value: 75,\n              enabled: ecmax === 75\n            },\n            {\n              title: '100 %',\n              value: 100,\n              enabled: ecmax === 100\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'loc',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.map',\n              value: 'true',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.quebec',\n              value: 'false',\n              enabled: true\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(term, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n\n    return this.http.get(`${this.searchUrl}/geocode`, { params }).pipe(\n      map((response: IChercheResponse) => this.extractResults(response, term)),\n      catchError((err) => {\n        err.error.toDisplay = true;\n        err.error.title = this.languageService.translate.instant(\n          this.getDefaultOptions().title\n        );\n        throw err;\n      })\n    );\n  }\n\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          const regex = new RegExp(`^${v.value}(\\\\.|$)`);\n          const typesMatched = types.filter((value) => regex.test(value));\n          v.available = typesMatched.length > 0;\n          if (v.value === 'lieux') {\n            this.hashtagsLieuxToKeep = [\n              ...(new Set(\n                typesMatched\n                  .map((t) => t.split('.'))\n                  .reduce((a, b) => a.concat(b))\n                  .filter((t) => t !== 'lieux')\n              ) as any)\n            ];\n          }\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    const queryParams: any = Object.assign(\n      {\n        geometry: true,\n        bbox: true,\n        icon: true,\n        type:\n          'adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi'\n      },\n      this.params,\n      this.computeOptionsParam(term, options || {}).params,\n      {\n        q: this.computeTerm(term),\n        page: options.page\n      }\n    );\n\n    if (queryParams.loc === 'true') {\n      const [xMin, yMin, xMax, yMax] = options.extent;\n      queryParams.loc = `${xMin},${yMin};${xMax},${yMin};${xMax},${yMax};${xMin},${yMax};${xMin},${yMin}`;\n    } else if (queryParams.loc === 'false') {\n      delete queryParams.loc;\n    }\n\n    if (/#[A-Za-z]+/.test(queryParams.q)) {\n      queryParams.type = 'lieux';\n    }\n\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(queryParams),\n      encoder: new IgoHttpParameterCodec()\n    });\n  }\n\n  private extractResults(response: IChercheResponse, term: string): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheData) => {\n      return this.formatter.formatResult(this.dataToResult(data, term, response));\n    });\n  }\n\n  private dataToResult(\n    data: IChercheData,\n    term: string,\n    response?: IChercheResponse\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.highlight.title || data.properties.nom;\n    const subtitleHtml = data.highlight.title2\n      ? ' <small> ' + data.highlight.title2 + '</small>'\n      : '';\n    const subtitleHtml2 = data.highlight.title3\n      ? '<br><small> ' + data.highlight.title3 + '</small>'\n      : '';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml + subtitleHtml2,\n        icon: data.icon || 'map-marker',\n        score: data.score || computeTermSimilarity(term.trim(), data.properties.nom),\n        nextPage:\n          response.features.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheSearchSource.propertiesBlacklist\n    );\n\n    if (!data.geometry) {\n      return Object.assign({ type: data.index }, properties);\n    }\n\n    const googleLinksProperties: {\n      GoogleMaps: string;\n      GoogleStreetView?: string;\n    } = {\n      GoogleMaps: ''\n    };\n\n    let googleMaps;\n    if (data.geometry.type === 'Point') {\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        data.geometry.coordinates[0],\n        data.geometry.coordinates[1]\n      );\n    } else {\n      const point = pointOnFeature(data.geometry);\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        point.geometry.coordinates[0],\n        point.geometry.coordinates[1]\n      );\n    }\n\n    let googleMapsNom;\n    if (data.index === 'routes') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + data.properties.municipalite\n      );\n    } else if (data.index === 'municipalites') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + 'ville'\n      );\n    } else if (data.index === 'mrc') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        'mrc+' + data.properties.nom\n      );\n    } else if (data.index === 'regadmin') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ',+QC'\n      );\n    } else {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom || data.highlight.title\n      );\n    }\n\n    googleLinksProperties.GoogleMaps =\n      '<a href=' +\n      googleMaps +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\n      '</a> <br /> <a href=' +\n      googleMapsNom +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByName') +\n      '</a>';\n\n    if (data.geometry.type === 'Point') {\n      googleLinksProperties.GoogleStreetView = GoogleLinks.getGoogleStreetViewLink(\n        data.geometry.coordinates[0],\n        data.geometry.coordinates[1]\n      );\n    }\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(\n      { type: data.index },\n      properties,\n      googleLinksProperties,\n      routing\n    );\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    // Keep hashtags for \"lieux\"\n    const hashtags = term.match(/(#[A-Za-z]+)/g) || [];\n    let keep = false;\n    keep = hashtags.some((hashtag) => {\n      const hashtagKey = hashtag.substring(1);\n      return this.hashtagsLieuxToKeep.some(\n        (h) =>\n          h\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '') ===\n          hashtagKey\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n      );\n    });\n\n    if (!keep) {\n      term = term.replace(/(#[A-Za-z]+)/g, '');\n    }\n\n    return term.replace(/[^\\wÀ-ÿ !\\-\\+\\(\\)\\.\\/½¼¾,'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n}\n\n/**\n * IChercheReverse search source\n */\n@Injectable()\nexport class IChercheReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'icherchereverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    injector: Injector,\n  ) {\n    super(options, storageService);\n\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe((title) => this.title$.next(title));\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n  }\n\n  getId(): string {\n    return IChercheReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const types =\n      this.options.params && this.options.params.type\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n        : ['adresses', 'municipalites', 'mrc', 'regadmin'];\n\n    return {\n      title: 'igo.geo.search.ichercheReverse.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              available: false\n            },\n            {\n              title: 'igo.geo.search.icherche.type.district',\n              value: 'arrondissements',\n              enabled: types.indexOf('arrondissements') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'radius',\n          name: 'bufferInput',\n          values: [\n            {\n              title: '100 m',\n              value: 100,\n              enabled: !this.options.distance || this.options.distance === 100\n            },\n            {\n              title: '500 m',\n              value: 500,\n              enabled: this.options.distance === 500\n            },\n            {\n              title: '1 km',\n              value: 1000,\n              enabled: this.options.distance === 1000\n            },\n            {\n              title: '2 km',\n              value: 2000,\n              enabled: this.options.distance === 2000\n            },\n            {\n              title: '5 km',\n              value: 5000,\n              enabled: this.options.distance === 5000\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    return this.http.get(`${this.searchUrl}/locate`, { params }).pipe(\n      map((response: IChercheReverseResponse) => {\n        return this.extractResults(response);\n      })\n    );\n  }\n\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          v.available = types.indexOf(v.value as string) > -1;\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    if (options.distance || this.options.distance) {\n      options.params = Object.assign(options.params || {}, {\n        bufferInput: options.distance || this.options.distance\n      });\n    }\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          loc: lonLat.join(','),\n          sort: 'distance',\n          geometry: true,\n          icon: true\n        },\n        options.params || {},\n        this.params\n      )\n    });\n  }\n\n  private extractResults(\n    response: IChercheReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private getSubtitle(data: IChercheReverseData) {\n    if (!this.settings.length) {\n      return '';\n    }\n    let subtitle = '';\n    switch (data.properties.type) {\n      case 'arrondissements':\n        subtitle = data.properties.municipalite + ' (Arrondissement)';\n        break;\n      default:\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        const type = typeSetting.values.find(\n          (t) => t.value === data.properties.type\n        );\n        if (type) {\n          subtitle = this.languageService.translate.instant(type.title);\n        }\n    }\n    return subtitle;\n  }\n\n  private dataToResult(data: IChercheReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.properties.nom;\n    const subtitleHtml = ' <small> ' + this.getSubtitle(data) + '</small>';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.icon || 'map-marker'\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheReverseData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheReverseSearchSource.propertiesBlacklist\n    );\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(properties, routing);\n  }\n\n  private computeExtent(\n    data: IChercheReverseData\n  ): [number, number, number, number] | undefined {\n    return data.bbox\n      ? [data.bbox[0], data.bbox[2], data.bbox[1], data.bbox[3]]\n      : undefined;\n  }\n}\n","import { Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  IChercheSearchSource,\n  IChercheSearchResultFormatter,\n  IChercheReverseSearchSource\n} from './icherche';\n\n/**\n * ICherche search result formatter factory\n * @ignore\n */\nexport function defaultIChercheSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new IChercheSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ICherche search result formatter\n */\nexport function provideDefaultIChercheSearchResultFormatter() {\n  return {\n    provide: IChercheSearchResultFormatter,\n    useFactory: defaultIChercheSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ICherche search source factory\n * @ignore\n */\nexport function ichercheSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: IChercheSearchResultFormatter,\n  injector: Injector\n) {\n  return new IChercheSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheSearchSource.id}`),\n    formatter,\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the ICherche search source\n */\nexport function provideIChercheSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheSearchSourceFactory,\n    multi: true,\n    deps: [\n      HttpClient,\n      LanguageService,\n      StorageService,\n      ConfigService,\n      IChercheSearchResultFormatter,\n      Injector\n    ]\n  };\n}\n\n/**\n * IChercheReverse search source factory\n * @ignore\n */\nexport function ichercheReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  injector: Injector\n) {\n  return new IChercheReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheReverseSearchSource.id}`),\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the IChercheReverse search source\n */\nexport function provideIChercheReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, Injector]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport * as olproj from 'ol/proj';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport * as olformat from 'ol/format';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, ReverseSearch } from './source';\nimport { SearchSourceOptions, ReverseSearchOptions } from './source.interfaces';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { GoogleLinks } from '../../../utils/googleLinks';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { lonLatConversion, roundCoordTo, convertDDToDMS } from '../../../map/shared/map.utils';\nimport { OsmLinks } from '../../../utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class CoordinatesSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n/**\n * CoordinatesReverse search source\n */\n@Injectable()\nexport class CoordinatesReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'coordinatesreverse';\n  static type = FEATURE;\n\n  private projections;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    @Inject('options') options: SearchSourceOptions,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('projections') projections: Projection[],\n  ) {\n    super(options, storageService);\n    this.projections = projections;\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe(title => this.title$.next(title));\n  }\n\n  getId(): string {\n    return CoordinatesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return CoordinatesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'igo.geo.search.coordinates.name',\n      order: 1,\n      showInSettings: false\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param options options of ReverseSearchOptions (distance, conf, zoom, params)\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    return of([this.dataToResult(lonLat, options)]);\n  }\n\n  private dataToResult(data: [number, number], options: ReverseSearchOptions): SearchResult<Feature> {\n    const dataDMS = convertDDToDMS(data);\n    const convertedCoord = lonLatConversion(data, this.projections);\n    const coords = convertedCoord.reduce((obj, item) => (\n      obj[item.alias] = item.igo2CoordFormat, obj), {});\n\n    const roundedCoordString = roundCoordTo(data, 6).join(', ');\n    const roundedCoordStringDMS = dataDMS.join(', ');\n\n    let geometry: FeatureGeometry = {\n      type: 'Point',\n      coordinates: [data[0], data[1]]\n    };\n\n    const properties = {};\n    let subtitleHtml = '';\n    if (options.distance) {\n      const radiusKey = this.languageService.translate.instant('igo.geo.search.coordinates.radius');\n      properties[radiusKey] = options.distance;\n      subtitleHtml = '<br><small>Rayon: ' + options.distance + ' m</small>';\n\n      // Create polygon\n      const center = olproj.transform([data[0], data[1]], 'EPSG:4326', 'EPSG:3857');\n      const circleGeometry = new OlCircle(center, options.distance);\n      const polygonGeometry = fromCircle(circleGeometry);\n      const writer = new olformat.GeoJSON();\n      geometry = JSON.parse(writer.writeGeometry(polygonGeometry.transform('EPSG:3857', 'EPSG:4326')));\n    }\n\n    if (options.conf) {\n      const confKey = this.languageService.translate.instant('igo.geo.search.coordinates.conf');\n      properties[confKey] = options.conf;\n      subtitleHtml += subtitleHtml === '' ? '<br>' : '<small> - </small>';\n      subtitleHtml += '<small>Confiance: ' + options.conf + '%</small>';\n    }\n\n    const coordKey = this.languageService.translate.instant('igo.geo.search.coordinates.coord');\n    properties[coordKey] = roundedCoordString;\n\n    const coordKeyDMS = this.languageService.translate.instant('igo.geo.search.coordinates.coordDMS');\n    properties[coordKeyDMS] = roundedCoordStringDMS;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent: undefined,\n        properties: Object.assign(\n          properties,\n          coords,\n          {\n            GoogleMaps: GoogleLinks.getGoogleMapsCoordLink(data[0], data[1]),\n            GoogleStreetView: GoogleLinks.getGoogleStreetViewLink(\n              data[0],\n              data[1]\n            ),\n            OpenStreetMap: OsmLinks.getOpenStreetMapLink(data[0], data[1], 14),\n            Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n          }\n        ),\n        meta: {\n          id: data[0].toString() + ',' + data[1].toString(),\n          title: roundedCoordString\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id: data[0].toString() + ',' + data[1].toString(),\n        title: roundedCoordString,\n        titleHtml: roundedCoordString + subtitleHtml,\n        icon: 'map-marker',\n        score: 100, // every coord exists\n      }\n    };\n  }\n}\n","import { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  CoordinatesReverseSearchSource,\n  CoordinatesSearchResultFormatter\n} from './coordinates';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { ProjectionService } from '../../../map/shared/projection.service';\n\n/**\n * ICherche search result formatter factory\n * @ignore\n */\nexport function defaultCoordinatesSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new CoordinatesSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ICherche search result formatter\n */\nexport function provideDefaultCoordinatesSearchResultFormatter() {\n  return {\n    provide: CoordinatesSearchResultFormatter,\n    useFactory: defaultCoordinatesSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * CoordinatesReverse search source factory\n * @ignore\n */\nexport function CoordinatesReverseSearchSourceFactory(\n  config: ConfigService,\n  languageService: LanguageService,\n  storageService: StorageService,\n  _projectionService: ProjectionService\n) {\n  return new CoordinatesReverseSearchSource(\n    config.getConfig(`searchSources.${CoordinatesReverseSearchSource.id}`),\n    languageService,\n    storageService,\n    (config.getConfig('projections') as Projection[]) || []\n  );\n}\n\n/**\n * Function that returns a provider for the IChercheReverse search source\n */\nexport function provideCoordinatesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: CoordinatesReverseSearchSourceFactory,\n    multi: true,\n    deps: [ConfigService, LanguageService, StorageService, ProjectionService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\nimport { LAYER } from '../../../layer';\nimport { QueryableDataSourceOptions, QueryFormat } from '../../../query';\nimport { QueryHtmlTarget } from './../../../query/shared/query.enums';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { TextSearchOptions } from './source.interfaces';\nimport {\n  ILayerSearchSourceOptions,\n  ILayerData,\n  ILayerItemResponse,\n  ILayerServiceResponse,\n  ILayerDataSource\n} from './ilayer.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class ILayerSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(data: ILayerData): ILayerData {\n    const allowedKey = [\n      'title',\n      'abstract',\n      'groupTitle',\n      'metadataUrl',\n      'downloadUrl',\n      'urlInfo',\n      'name'\n    ];\n\n    const property = Object.entries(data.properties)\n      .filter(([key]) => allowedKey.indexOf(key) !== -1)\n      .reduce((out: { [key: string]: any }, entries: [string, any]) => {\n        const [key, value] = entries;\n        let newKey;\n        try {\n          newKey = this.languageService.translate.instant(\n            'igo.geo.search.ilayer.properties.' + key\n          );\n        } catch (e) {\n          newKey = key;\n        }\n        out[newKey] = value ? value : '';\n        return out;\n      }, {});\n\n    const dataR = Object.assign({}, data);\n    dataR.properties = property as ILayerDataSource;\n\n    return dataR;\n  }\n}\n\n/**\n * ILayer search source\n */\n@Injectable()\nexport class ILayerSearchSource extends SearchSource implements TextSearch {\n  static id = 'ilayer';\n  static type = LAYER;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: ILayerSearchSourceOptions,\n    @Inject(ILayerSearchResultFormatter)\n    private formatter: ILayerSearchResultFormatter\n  ) {\n    super(options, storageService);\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe(title => this.title$.next(title));\n  }\n\n  getId(): string {\n    return ILayerSearchSource.id;\n  }\n\n  getType(): string {\n    return ILayerSearchSource.type;\n  }\n\n  protected getDefaultOptions(): ILayerSearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n    return {\n      title: 'igo.geo.search.ilayer.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.ilayer.type.layer',\n              value: 'layer',\n              enabled: true,\n              hashtags: ['layer', 'layers', 'couche', 'couches']\n            },\n            {\n              title: 'igo.geo.search.ilayer.type.groupLayer',\n              value: 'group',\n              enabled: false,\n              hashtags: ['gr-layer', 'gr-layers', 'gr-couche', 'gr-couches']\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'ecmax',\n          name: 'ecmax',\n          values: [\n            {\n              title: '10 %',\n              value: 10,\n              enabled: ecmax === 10\n            },\n            {\n              title: '30 %',\n              value: 30,\n              enabled: ecmax === 30\n            },\n            {\n              title: '50 %',\n              value: 50,\n              enabled: ecmax === 50 || !ecmax\n            },\n            {\n              title: '75 %',\n              value: 75,\n              enabled: ecmax === 75\n            },\n            {\n              title: '100 %',\n              value: 100,\n              enabled: ecmax === 100\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a layer by name or keyword\n   * @param term Layer name or keyword\n   * @returns Observable of <SearchResult<LayerOptions>[]\n   */\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q') || !params.get('type')) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(\n        map((response: ILayerServiceResponse) => this.extractResults(response, term))\n      );\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(\n        Object.assign(\n          {\n            q: this.computeTerm(term)\n          },\n          this.params,\n          this.computeOptionsParam(term, options || {}).params,\n          {\n            page: options.page\n          }\n        )\n      )\n    });\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    return term.replace(/(#[^\\s]*)/g, '').replace(/[^\\wÀ-ÿ !\\-\\(\\),'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n\n  private extractResults(\n    response: ILayerServiceResponse, term: string\n  ): SearchResult<ILayerItemResponse>[] {\n    return response.items.map((data: ILayerData) =>\n    this.dataToResult(data, term, response)\n    );\n  }\n\n  private dataToResult(\n    data: ILayerData,\n    term: string,\n    response?: ILayerServiceResponse\n  ): SearchResult<ILayerItemResponse> {\n    const layerOptions = this.computeLayerOptions(data);\n\n    const titleHtml = data.highlight.title || data.properties.title;\n    const groupTitle = data.highlight.groupTitle || data.properties.groupTitle;\n    const subtitleHtml = groupTitle\n      ? ' <small style=\"color: #6f6969\"> ' + groupTitle + '</small>'\n      : '';\n\n    return {\n      source: this,\n      meta: {\n        dataType: LAYER,\n        id: [this.getId(), data.properties.id].join('.'),\n        title: data.properties.title,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.properties.type === 'Layer' ? 'layers' : 'map',\n        score: data.score || computeTermSimilarity(term.trim(), data.properties.name),\n        nextPage:\n          response.items.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      },\n      data: layerOptions\n    };\n  }\n\n  private computeLayerOptions(data: ILayerData): ILayerItemResponse {\n    const url = data.properties.url;\n    const queryParams: QueryableDataSourceOptions = this.extractQueryParamsFromSourceUrl(\n      url\n    );\n    return ObjectUtils.removeUndefined({\n      sourceOptions: {\n        id: data.properties.id,\n        type: data.properties.format,\n        url,\n        queryFormat: queryParams.queryFormat,\n        queryHtmlTarget: queryParams.queryHtmlTarget,\n        params: data.properties.format === 'wms' ? {LAYERS: data.properties.name} : undefined,\n        layer: data.properties.format === 'wms' ? undefined : data.properties.name,\n        optionsFromCapabilities: true,\n        crossOrigin: 'anonymous'\n      },\n      title: data.properties.title,\n      maxResolution: getResolutionFromScale(\n        Number(data.properties.maxScaleDenom)\n      ),\n      minResolution: getResolutionFromScale(\n        Number(data.properties.minScaleDenom)\n      ),\n      metadata: {\n        url: data.properties.metadataUrl,\n        extern: data.properties.metadataUrl ? true : undefined,\n        abstract: data.properties.abstract || undefined\n      },\n      properties: this.formatter.formatResult(data).properties\n    });\n  }\n\n  private extractQueryParamsFromSourceUrl(\n    url: string\n  ): { queryFormat: QueryFormat; queryHtmlTarget: QueryHtmlTarget } {\n    let queryFormat;\n    let queryHtmlTarget;\n    const formatOpt = (this.options as ILayerSearchSourceOptions).queryFormat;\n    if (formatOpt) {\n      for (const key of Object.keys(formatOpt)) {\n        const value = formatOpt[key];\n        if (value === '*') {\n          queryFormat = QueryFormat[key.toUpperCase()];\n          break;\n        }\n\n        const urls = ((value as any) as { urls: string[] }).urls;\n        if (Array.isArray(urls)) {\n          urls.forEach(urlOpt => {\n            if (url.indexOf(urlOpt) !== -1) {\n              queryFormat = QueryFormat[key.toUpperCase()];\n            }\n          });\n          break;\n        }\n      }\n\n      if (\n        queryFormat === QueryFormat.HTML ||\n        queryFormat === QueryFormat.HTMLGML2\n      ) {\n        queryHtmlTarget = 'iframe';\n      }\n    }\n\n    return {\n      queryFormat,\n      queryHtmlTarget\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { ILayerSearchSource, ILayerSearchResultFormatter } from './ilayer';\n\n/**\n * ILayer search result formatter factory\n * @ignore\n */\nexport function ilayerSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new ILayerSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ILayer search result formatter\n */\nexport function provideILayerSearchResultFormatter() {\n  return {\n    provide: ILayerSearchResultFormatter,\n    useFactory: ilayerSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ILayer search source factory\n * @ignore\n */\nexport function ilayerSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: ILayerSearchResultFormatter\n) {\n  return new ILayerSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${ILayerSearchSource.id}`),\n    formatter\n  );\n}\n\n/**\n * Function that returns a provider for the ILayer search source\n */\nexport function provideILayerSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ilayerSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, ILayerSearchResultFormatter]\n  };\n}\n","import { FEATURE } from '../../feature';\nimport { LAYER } from '../../layer';\n\nexport const SEARCH_TYPES = [FEATURE, LAYER];\n","<div class=\"igo-search-selector\">\n  <button\n    mat-icon-button\n    class=\"igo-search-selector-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSelectorMenu\">\n    <mat-icon svgIcon=\"menu-down\"></mat-icon>\n  </button>\n\n  <mat-menu\n    #searchSelectorMenu=\"matMenu\"\n    class=\"no-border-radius\"\n    xPosition=\"before\"\n    yPosition=\"above\">\n    <mat-radio-group\n      class=\"igo-search-selector-radio-group\"\n      [value]=\"searchType$ | async\"\n      (change)=\"onSearchTypeChange($event.value)\">\n      <mat-radio-button *ngFor=\"let searchType of searchTypes\" [value]=\"searchType\">\n        {{getSearchTypeTitle(searchType) | translate}}\n      </mat-radio-button>\n    </mat-radio-group>\n  </mat-menu>\n\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { SEARCH_TYPES } from '../shared/search.enums';\nimport { SearchSourceService } from '../shared/search-source.service';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-selector',\n  templateUrl: './search-selector.component.html',\n  styleUrls: ['./search-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchSelectorComponent implements OnInit, OnDestroy {\n\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  /**\n   * The search type enabled\n   */\n  @Input()\n  set searchType(value: string) { this.setSearchType(value); }\n  get searchType(): string { return this.searchType$.value; }\n\n  /**\n   * Event emitted when the enabled search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  constructor(private searchSourceService: SearchSourceService) {}\n\n  ngOnInit() {\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n  }\n\n  ngOnDestroy() {\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * Enable the selected search type\n   * @param searchType Search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Get a search type's title. The title\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Search type\n   * @internal\n   */\n  getSearchTypeTitle(searchType: string) {\n    return `igo.geo.search.${searchType.toLowerCase()}.title`;\n  }\n\n  /**\n   * Emit an event and enable the search sources of the given type.\n   * @param searchType Search type\n   */\n  private setSearchType(searchType: string | undefined) {\n    this.searchType$.next(searchType);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchSourceService.enableSourcesByType(searchType);\n    this.searchTypeChange.emit(searchType);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { SearchSelectorComponent } from './search-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatTabsModule,\n    MatCheckboxModule,\n    IgoLanguageModule\n  ],\n  exports: [SearchSelectorComponent],\n  declarations: [SearchSelectorComponent]\n})\nexport class IgoSearchSelectorModule {}\n","<div class=\"igo-search-settings\">\n\n  <button\n    mat-icon-button\n    class=\"igo-search-settings-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSettingsMenu\">\n    <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n  </button>\n  <mat-menu\n    #searchSettingsMenu=\"matMenu\"\n    class=\"no-border-radius\">\n    <div class=\"checkAllButton\" *ngIf=\"getSearchSources().length>4\">\n      <button mat-raised-button\n        (click)=\"checkUncheckAllSources($event)\">{{!searchSourcesAllEnabled  ? ('igo.geo.search.searchSources.unselectAll' | translate): ('igo.geo.search.searchSources.selectAll' | translate)}}</button>\n    </div>\n      <ng-container *ngFor=\"let source of getSearchSources()\">\n        <span class=\"igo-search-settings-search-source\">\n          <mat-checkbox\n            class=\"igo-search-settings-checkbox\"\n            [checked]=\"source.enabled\"\n            [value]=\"source\"\n            (click)=\"$event.stopPropagation()\"\n            (change)=\"onCheckSearchSource($event, source)\">\n          </mat-checkbox>\n          <button *ngIf=\"source.settings.length > 0\"\n            [matMenuTriggerFor]=\"sub_menu\"\n            mat-menu-item>{{source.title}}\n          </button>\n          <button\n            mat-menu-item\n            *ngIf=\"source.settings.length === 0\">\n            {{source.title}}\n          </button>\n        </span>\n          <mat-menu #sub_menu=\"matMenu\">\n            <ng-container *ngFor=\"let setting of source.settings\">\n              <button\n                  mat-menu-item\n                  [matMenuTriggerFor]=\"test_sub_menu\">\n                {{'igo.geo.search.searchSources.settings.'+ setting.title | translate}}\n              </button>\n              <mat-menu #test_sub_menu=\"matMenu\"\n                [ngSwitch]=\"setting.type\"\n                yPosition=\"above\">\n                <span *ngSwitchCase=\"'radiobutton'\">\n                  <mat-radio-group\n                    class=\"igo-search-settings-radio-group\"\n                    [value]=\"setting\">\n                    <mat-radio-button *ngFor=\"let settingValue of setting.values\"\n                      class=\"mat-typography\"\n                      [value]=\"settingValue\"\n                      [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                      [checked]=\"settingValue.enabled\"\n                      (click)=\"$event.stopPropagation()\"\n                      (change)=\"settingsValueCheckedRadioButton($event, source, setting, settingValue)\">\n                      {{settingValue.title | translate}}\n                    </mat-radio-button>\n                  </mat-radio-group>\n                </span>\n                <span *ngSwitchCase=\"'checkbox'\">\n                  <div class=\"checkAllButton\" *ngIf=\"setting.values.length > 3\">\n                    <button mat-raised-button\n                      (click)=\"checkUncheckAll($event, source, setting)\">{{setting.allEnabled || setting.allEnabled === undefined  ? ('igo.geo.search.searchSources.settings.unselectAll' | translate): ('igo.geo.search.searchSources.settings.selectAll' | translate)}}</button>\n                  </div>\n                  <mat-checkbox *ngFor=\"let settingValue of getAvailableValues(setting)\"\n                    class=\"mat-menu-item\"\n                    [style.display]=\"displayBlock\"\n                    [checked]=\"settingValue.enabled\"\n                    [value]=\"setting\"\n                    [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                    (click)=\"$event.stopPropagation()\"\n                    (change)=\"settingsValueCheckedCheckbox($event, source, setting, settingValue)\">\n                    {{settingValue.title | translate}}\n                  </mat-checkbox>\n                </span>\n              </mat-menu>\n            </ng-container>\n          </mat-menu>\n      </ng-container>\n      <span *ngIf=\"hasPointerReverseSearchSource && !isTouchScreen\">\n        <mat-divider></mat-divider>\n        <span class=\"pointer-summary-slide-toggle-container mat-typography\">\n          <mat-slide-toggle class=\"pointer-summary-option\" (change)=\"changePointerReverseSearch($event)\" tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.search.pointerSearchSummary.tooltip' | translate\"\n            (click)=\"$event.stopPropagation()\" [checked]=\"pointerSummaryEnabled\" [labelPosition]=\"'after'\">\n            {{'igo.geo.search.pointerSearchSummary.title' | translate}}\n          </mat-slide-toggle>\n          <mat-slide-toggle class=\"pointer-summary-option\" (change)=\"changeSearchResultsGeometry($event)\" tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.search.searchResultsGeometry.tooltip' | translate\"\n            (click)=\"$event.stopPropagation()\" [checked]=\"searchResultsGeometryEnabled\" [labelPosition]=\"'after'\">\n            {{'igo.geo.search.searchResultsGeometry.title' | translate}}\n          </mat-slide-toggle>\n        </span>\n      </span>\n  </mat-menu>\n</div>\n","import { MatCheckboxChange } from '@angular/material/checkbox';\nimport { MatRadioChange } from '@angular/material/radio';\n\nimport {\n  Component,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  HostListener,\n  Input\n} from '@angular/core';\n\nimport { SearchSourceService } from '../shared/search-source.service';\nimport { SearchSource } from '../shared/sources/source';\nimport {\n  SearchSourceSettings,\n  SettingOptions\n} from '../shared/sources/source.interfaces';\nimport {\n  sourceCanReverseSearchAsSummary,\n  sourceCanSearch,\n  sourceCanReverseSearch\n} from '../shared/search.utils';\nimport { MediaService, StorageService } from '@igo2/core';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-settings',\n  templateUrl: './search-settings.component.html',\n  styleUrls: ['./search-settings.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchSettingsComponent implements OnInit {\n  public hasPointerReverseSearchSource: boolean = false;\n  public searchSourcesAllEnabled: boolean = false;\n\n  public buffer = [];\n  public lastKeyTime = Date.now();\n\n  public displayBlock = 'block';\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n\n  /**\n   * Event emitted when the enabled search source changes\n   */\n  @Output() searchSourceChange = new EventEmitter<SearchSource>();\n\n  /**\n   * Event emitted when the pointer summary is activated\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry summary is changed\n   */\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n  @HostListener('document:keydown', ['$event'])\n  handleKeyboardEvent(event: KeyboardEvent) {\n    if (event.key === 'F2') {\n      this.pointerSummaryEnabled = !this.pointerSummaryEnabled;\n      this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n    }\n  }\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService,\n    private storageService: StorageService\n  ) {}\n\n  ngOnInit(): void {\n    this.hasPointerReverseSearchSource = this.hasReverseSearchSourcesForPointerSummary();\n  }\n\n  /**\n   * Get all search sources\n   * @internal\n   */\n  getSearchSources(): SearchSource[] {\n    const textSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n\n    const reverseSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanReverseSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n    const sources = textSearchSources.concat(reverseSearchSources);\n    this.computeSourcesCheckAllBehavior(sources);\n    return sources;\n  }\n\n  /**\n   * Get all search sources usable for pointer summary\n   * @internal\n   */\n  hasReverseSearchSourcesForPointerSummary(): boolean {\n    if (\n      this.searchSourceService\n        .getEnabledSources()\n        .filter(sourceCanReverseSearchAsSummary).length\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Triggered when a setting is checked (checkbox style)\n   * @internal\n   */\n  settingsValueCheckedCheckbox(\n    event: MatCheckboxChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    settingValue.enabled = event.checked;\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (settings)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSettingCheckAllBehavior(setting: SearchSourceSettings) {\n    if (setting.allEnabled === undefined) {\n      if (setting.values.find((settingValue) => settingValue.enabled)) {\n        setting.allEnabled = false;\n      } else {\n        setting.allEnabled = true;\n      }\n    } else {\n      setting.allEnabled = !setting.allEnabled;\n    }\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (sources)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSourcesCheckAllBehavior(sources: SearchSource[]) {\n    const enabledSourcesCnt = sources.filter((source) => source.enabled).length;\n    const disabledSourcesCnt = sources.filter((source) => !source.enabled)\n      .length;\n    this.searchSourcesAllEnabled =\n      enabledSourcesCnt >= disabledSourcesCnt ? false : true;\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAll(event, source: SearchSource, setting: SearchSourceSettings) {\n    event.stopPropagation();\n    this.computeSettingCheckAllBehavior(setting);\n    setting.values.forEach((settingValue) => {\n      settingValue.enabled = setting.allEnabled;\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAllSources(event) {\n    event.stopPropagation();\n    this.getSearchSources().map((source) => {\n      source.enabled = this.searchSourcesAllEnabled;\n      this.searchSourceChange.emit(source);\n    });\n  }\n\n  /**\n   * Triggered when a setting is checked (radiobutton style)\n   * @internal\n   */\n  settingsValueCheckedRadioButton(\n    event: MatRadioChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    setting.values.forEach((conf) => {\n      if (conf.value !== settingValue.value) {\n        conf.enabled = !event.source.checked;\n      } else {\n        conf.enabled = event.source.checked;\n      }\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  onCheckSearchSource(event: MatCheckboxChange, source: SearchSource) {\n    source.enabled = event.checked;\n    const storage = (this.storageService.get(source.getId() + '.options') || {}) as SettingOptions;\n    storage.enabled = source.enabled;\n    this.storageService.set(\n      source.getId() + '.options',\n      storage\n    );\n    this.searchSourceChange.emit(source);\n  }\n\n  getAvailableValues(setting: SearchSourceSettings) {\n    return setting.values.filter((s) => s.available !== false);\n  }\n\n  getAvailableHashtagsValues(setting: SettingOptions) {\n    if (setting.hashtags) {\n      return setting.hashtags.map((h) => '#' + h).join(', ');\n    }\n    return;\n  }\n\n  stopPropagation(event) {\n    event.stopPropagation();\n  }\n\n  changePointerReverseSearch(event) {\n    this.pointerSummaryEnabled = event.checked;\n    this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n  }\n\n  changeSearchResultsGeometry(event) {\n    this.searchResultsGeometryEnabled = event.checked;\n    this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { SearchSettingsComponent } from './search-settings.component';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\n/**\n * @ignore\n */\n@NgModule({\n  declarations: [SearchSettingsComponent],\n  imports: [\n    CommonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatCheckboxModule,\n    MatDividerModule,\n    MatSlideToggleModule,\n    IgoLanguageModule\n  ],\n  exports: [SearchSettingsComponent]\n})\nexport class IgoSearchSettingsModule { }\n","<div class=\"igo-search-bar-container\" [ngClass]=\"{empty: empty$ | async}\">\n  <mat-form-field [floatLabel]=\"floatLabel\" [appearance]=\"appearance\">\n    <mat-label *ngIf=\"label\">{{label}}</mat-label>\n    <input\n      #input\n      matInput\n      autocomplete=\"off\"\n      [ngClass]=\"{'hasSearchIcon': searchIcon}\"\n      [disabled]=\"disabled$ | async\"\n      [placeholder]=\"placeholder ? placeholder : (placeholder$ | async) ? (placeholder$.value | translate) : undefined\"\n      [value]=\"term$ | async\"\n      (keyup)=\"onKeyup($event)\"\n      (touchend)=\"onKeyup($event)\">\n  </mat-form-field>\n\n  <div class=\"search-bar-buttons\">\n    <button\n      mat-icon-button\n      [color]=\"color\"\n      *ngIf=\"searchIcon !== undefined\">\n      <mat-icon svgIcon=\"{{searchIcon}}\"></mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"(empty$ | async)===false\"\n      mat-icon-button\n      [color]=\"color\"\n      (click)=\"onClearButtonClick()\">\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n\n    <igo-search-selector\n      *ngIf=\"searchSelector\"\n      [searchTypes]=\"searchTypes\"\n      [searchType]=\"searchType$ | async\"\n      (searchTypeChange)=\"onSearchTypeChange($event)\">\n    </igo-search-selector>\n\n    <igo-search-settings\n      *ngIf=\"searchSettings\"\n      [pointerSummaryEnabled]=\"pointerSummaryEnabled\"\n      (pointerSummaryStatus)=\"pointerSummaryStatus.emit($event)\"\n      [searchResultsGeometryEnabled]=\"searchResultsGeometryEnabled\"\n      (searchResultsGeometryStatus)=\"searchResultsGeometryStatus.emit($event)\"\n      (searchSourceChange)=\"onSearchSettingsChange()\">\n    </igo-search-settings>\n  </div>\n</div>\n","import {\n  Component,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Input,\n  Output,\n  EventEmitter,\n  ViewChild,\n  ElementRef\n} from '@angular/core';\nimport {\n  FloatLabelType,\n  MatFormFieldAppearance\n} from '@angular/material/form-field';\nimport { BehaviorSubject, Subscription, EMPTY, timer } from 'rxjs';\nimport { debounce, distinctUntilChanged } from 'rxjs/operators';\n\nimport { LanguageService } from '@igo2/core';\nimport { EntityStore } from '@igo2/common';\n\nimport { SEARCH_TYPES } from '../shared/search.enums';\nimport { SearchResult, Research } from '../shared/search.interfaces';\nimport { SearchService } from '../shared/search.service';\nimport { SearchSourceService } from '../shared/search-source.service';\n\n/**\n * Searchbar that triggers a research in all search sources enabled.\n * If the store input is defined, the search results will be loaded\n * into that store. An event is always emitted when a research is completed.\n */\n@Component({\n  selector: 'igo-search-bar',\n  templateUrl: './search-bar.component.html',\n  styleUrls: ['./search-bar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchBarComponent implements OnInit, OnDestroy {\n  /**\n   * Invalid keys\n   */\n  static invalidKeys = [\n    'Control',\n    'Shift',\n    'Alt',\n    'ArrowDown',\n    'ArrowUp',\n    'ArrowRight',\n    'ArrowLeft'\n  ];\n\n  readonly placeholder$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.search.placeholder'\n  );\n\n  readonly empty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  /**\n   * Subscription to the ssearch bar term\n   */\n  private term$$: Subscription;\n\n  /**\n   * Search term stream\n   */\n  private stream$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Subscription to the search term stream\n   */\n  private stream$$: Subscription;\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  private researches$$: Subscription[];\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  /**\n   * Search term\n   */\n  @Input()\n  set searchType(value: string) {\n    this.setSearchType(value);\n  }\n  get searchType(): string {\n    return this.searchType$.value;\n  }\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Event emitted when the pointer summary is activated by the searchbar setting\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry setting is changed\n   */\n   @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Search term\n   */\n  @Input()\n  set term(value: string) {\n    this.setTerm(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n  readonly term$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Whether this component is disabled\n   */\n  @Input()\n  set disabled(value: boolean) {\n    this.disabled$.next(value);\n  }\n  get disabled(): boolean {\n    return this.disabled$.value;\n  }\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n  /**\n   * Whether a float label should be displayed\n   */\n  @Input() floatLabel: FloatLabelType = 'never';\n\n  @Input() appearance: MatFormFieldAppearance = 'legacy';\n\n  @Input() placeholder: string;\n\n  @Input() label: string;\n\n  /**\n   * Icons color (search and clear)\n   */\n  @Input() color = 'primary';\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Debounce time between each keystroke\n   */\n  @Input() debounce = 200;\n\n  /**\n   * Minimum term length required to trigger a research\n   */\n  @Input() minLength = 2;\n\n  /**\n   * Search icon\n   */\n  @Input() searchIcon: string;\n\n  /**\n   * Search Selector\n   */\n  @Input() searchSelector = false;\n\n  /**\n   * Search Settings\n   */\n  @Input() searchSettings = false;\n\n  /**\n   * Force coordinates in north america\n   */\n  @Input() forceNA = false;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * Event emitted when the search term changes\n   */\n  @Output() searchTermChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when a research is completed\n   */\n  @Output() search = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() clearFeature = new EventEmitter();\n\n  /**\n   * Event emitted when the search settings changes\n   */\n  @Output() searchSettingsChange = new EventEmitter();\n\n  /**\n   * Input element\n   * @internal\n   */\n  @ViewChild('input', { static: true }) input: ElementRef;\n\n  /**\n   * Whether the search bar is empty\n   * @internal\n   */\n  get empty(): boolean {\n    return this.term.length === 0;\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService\n  ) {}\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe((term: string) => {\n      this.empty$.next(term === undefined || term.length === 0);\n    });\n\n    this.stream$$ = this.stream$\n      .pipe(\n        debounce((term: string) => (term === '' ? EMPTY : timer(this.debounce)))\n      )\n      .subscribe((term: string) => this.onSetTerm(term));\n\n    this.handlePlaceholder();\n\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n  }\n\n  /**\n   * Unsubscribe to the search term stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.term$$.unsubscribe();\n    this.stream$$.unsubscribe();\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * When a user types, validates the key and send it into the\n   * stream if it's valid\n   * @param event Keyboard event\n   * @internal\n   */\n  onKeyup(event: KeyboardEvent) {\n    const key = event.key;\n    if (!this.keyIsValid(key)) {\n      return;\n    }\n    const term = (event.target as HTMLInputElement).value;\n    this.setTerm(term);\n  }\n\n  /**\n   * Clear the stream and the input\n   * @internal\n   */\n  onClearButtonClick() {\n    this.clear();\n    this.clearFeature.emit();\n  }\n\n  /**\n   * Update search type\n   * @param searchType Enabled search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Update the placeholder with the enabled search type. The placeholder\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Enabled search type\n   * @internal\n   */\n  setSearchType(searchType: string) {\n    this.searchType$.next(searchType);\n  }\n\n  onSearchSettingsChange() {\n    this.doSearch(this.term);\n    this.searchSettingsChange.emit();\n    this.handlePlaceholder();\n  }\n\n  /**\n   * Send the term into the stream only if this component is not disabled\n   * @param term Search term\n   */\n  setTerm(term: string) {\n    if (this.disabled) {\n      return;\n    }\n\n    term = term || '';\n\n    if (term !== this.term) {\n      this.term$.next(term);\n    }\n\n    const slug = term.replace(/(#[^\\s]*)/g, '').trim();\n    if (slug.length >= this.minLength || slug.length === 0) {\n      this.stream$.next(term);\n    }\n  }\n\n  /**\n   * Clear the stream and the input\n   */\n  private clear() {\n    this.term$.next('');\n    this.stream$.next('');\n    this.input.nativeElement.focus();\n  }\n\n  /**\n   * Validate if a given key stroke is a valid input\n   */\n  private keyIsValid(key: string) {\n    return SearchBarComponent.invalidKeys.indexOf(key) === -1;\n  }\n\n  /**\n   * When the search term changes, emit an event and trigger a\n   * research in every enabled search sources.\n   * @param term Search term\n   */\n  private onSetTerm(term: string | undefined) {\n    this.searchTermChange.emit(term);\n    this.doSearch(term);\n  }\n\n  private handlePlaceholder() {\n    const searchTypes = [\n      ...new Set(\n        this.searchSourceService\n          .getEnabledSources()\n          .filter((ss) => !['map', 'coordinatesreverse'].includes(ss.getId()))\n          .map((ss) => ss.getType())\n      )\n    ];\n\n    let placeholder = `igo.geo.search.placeholder`;\n    if (searchTypes.length === 1) {\n      placeholder = `igo.geo.search.${searchTypes[0].toLowerCase()}.placeholder`;\n    } else if (searchTypes.length === 0) {\n      placeholder = `igo.geo.search.emptyType.placeholder`;\n    }\n    this.placeholder$.next(placeholder);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchTypeChange.emit(searchType);\n\n    const placeholder = `igo.geo.search.${searchType.toLowerCase()}.placeholder`;\n    this.placeholder$.next(placeholder);\n\n    this.setTerm(this.term);\n  }\n\n  /**\n   * Execute the search\n   * @param term Search term\n   */\n  private doSearch(rawTerm: string | undefined) {\n    if (this.researches$$) {\n      this.researches$$.map((research) => research.unsubscribe());\n      this.researches$$ = undefined;\n    }\n\n    let terms;\n    if (this.termSplitter && rawTerm.match(new RegExp(this.termSplitter, 'g'))) {\n      terms = rawTerm.split(this.termSplitter).filter((t) => t.length >= this.minLength);\n      this.store.clear();\n    } else {\n      terms = [rawTerm];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      const slug = term ? term.replace(/(#[^\\s]*)/g, '').trim() : '';\n      if (slug === '') {\n        if (this.store !== undefined) {\n          this.store.clear();\n        }\n        return;\n      }\n\n      researches = researches.concat(this.searchService.search(term, {\n        forceNA: this.forceNA\n      }));\n    });\n    this.researches$$ = researches.map((research) => {\n      return research.request.subscribe((results: SearchResult[]) => {\n        this.onResearchCompleted(research, results);\n      });\n    });\n  }\n\n  /**\n   * When a research  is completed, emit an event and update\n   * the store's items.\n   * @param research Research\n   * @param results Research results\n   */\n  private onResearchCompleted(research: Research, results: SearchResult[]) {\n    this.search.emit({ research, results });\n\n    if (this.store !== undefined) {\n      const newResults = this.store\n        .all()\n        .filter((result) => result.source !== research.source)\n        .concat(results);\n      this.store.updateMany(newResults);\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoSearchSelectorModule } from '../search-selector/search-selector.module';\nimport { IgoSearchSettingsModule } from '../search-settings/search-settings.module';\nimport { SearchBarComponent } from './search-bar.component';\nimport { SearchUrlParamDirective } from './search-url-param.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatFormFieldModule,\n    MatInputModule,\n    IgoLanguageModule,\n    IgoSearchSelectorModule,\n    IgoSearchSettingsModule\n  ],\n  exports: [\n    SearchBarComponent,\n  ],\n  declarations: [\n    SearchBarComponent,\n    SearchUrlParamDirective\n  ]\n})\nexport class IgoSearchBarModule {}\n","<mat-list-item>\n  <mat-icon *ngIf=\"icon\" mat-list-avatar svgIcon=\"{{showIcons ? icon : 'blank'}}\"></mat-icon>\n\n  <h4 matLine *ngIf=\"titleHtml\" [innerHtml]=\"titleHtml\" matTooltipShowDelay=\"500\" [matTooltip]=\"tooltipHtml\" matTooltipClass=\"search-result-tooltip\"></h4>\n  <h4 matLine *ngIf=\"!titleHtml\" matTooltipShowDelay=\"500\" [matTooltip]=\"title\">{{title}}</h4>\n\n  <button *ngIf=\"withZoomButton\"\n    igoStopPropagation\n    mat-icon-button\n    (click)=\"onZoomHandler()\">\n    <mat-icon svgIcon=\"magnify\"></mat-icon>\n  </button>\n\n  <ng-content\n    select=[igoSearchItemToolbar]>\n  </ng-content>\n\n</mat-list-item>\n","import { Component, Input, ChangeDetectionStrategy, EventEmitter, Output } from '@angular/core';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport {\n  getEntityTitle,\n  getEntityTitleHtml,\n  getEntityIcon\n} from '@igo2/common';\n\nimport { SearchResult } from '../shared/search.interfaces';\nimport { FeatureMotion, moveToOlFeatures } from '../../feature';\nimport { IgoMap } from '../../map';\n\n/**\n * Search results list item\n */\n@Component({\n  selector: 'igo-search-results-item',\n  templateUrl: './search-results-item.component.html',\n  styleUrls: ['./search-results-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultsItemComponent {\n  /**\n   * Search result item\n   */\n  @Input() result: SearchResult;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search result title\n   * @internal\n   */\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  @Output() zoomEvent = new EventEmitter<boolean>();\n\n  private format = new olFormatGeoJSON();\n\n  get title(): string {\n    return getEntityTitle(this.result);\n  }\n\n  /**\n   * Search result HTML title\n   * @internal\n   */\n  get titleHtml(): string {\n    return getEntityTitleHtml(this.result);\n  }\n\n  /**\n   * Search result tooltip\n   * @internal\n   */\n  get tooltipHtml(): string {\n    return this.titleHtml\n      .replace(/<small?[^>]+(>|$)/g, '\\n')\n      .replace(/<\\/?[^>]+(>|$)/g, '');\n  }\n\n  /**\n   * Search result icon\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.result);\n  }\n\n  constructor() {}\n\n  onZoomHandler() {\n    const olFeature = this.format.readFeature(this.result.data, {\n      dataProjection: this.result.data.projection,\n      featureProjection: this.map.projection\n    });\n    moveToOlFeatures(this.map, [olFeature], FeatureMotion.Default);\n  }\n}\n","<igo-list [navigation]=\"true\">\n  <ng-template\n    #groupTemplate\n    ngFor let-group\n    [ngForOf]=\"results$ | async\">\n\n    <igo-collapsible [class]=\"group.source.getId()\"\n      *ngIf=\"mode === searchResultMode.Grouped; else flatTemplate\"\n      [title]=\"computeGroupTitle(group)\"\n      [collapsed]=\"collapsed[group.source.title]\"\n      (toggle)=\"collapsed[group.source.title] = $event\">\n      <ng-container *ngTemplateOutlet=\"storeItemTemplate; context: {results: group.results}\"></ng-container>\n    </igo-collapsible>\n\n    <ng-template #flatTemplate>\n      <ng-container *ngTemplateOutlet=\"storeItemTemplate; context: {results: group.results}\"></ng-container>\n    </ng-template>\n\n    <ng-template #storeItemTemplate let-results=\"results\">\n      <ng-template ngFor let-result [ngForOf]=\"results\">\n        <igo-search-results-item\n          igoListItem\n          color=\"accent\"\n          [map]=\"map\"\n          [result]=\"result\"\n          [showIcons]=\"showIcons\"\n          [withZoomButton]=\"withZoomButton\"\n          [focused]=\"store.state.get(result).focused\"\n          [selected]=\"store.state.get(result).selected\"\n          (focus)=\"resultFocus.emit(result)\"\n          (unfocus)=\"resultUnfocus.emit(result)\"\n          (select)=\"onResultSelect(result)\"\n          (mouseenter)=\"resultFocus.emit(result)\"\n          (mouseleave)=\"resultUnfocus.emit(result)\">\n\n          <ng-container igoSearchItemToolbar\n            [ngTemplateOutlet]=\"templateSearchToolbar\"\n            [ngTemplateOutletContext]=\"{result: result}\">\n          </ng-container>\n\n        </igo-search-results-item>\n      </ng-template>\n      <span class=\"moreResults mat-typography\" *ngIf=\"isMoreResults(group)\" (click)=\"displayMoreResults(group)\">\n        <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\n      </span>\n    </ng-template>\n\n  </ng-template>\n\n</igo-list>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ContentChild,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { Observable, EMPTY, timer, BehaviorSubject, Subscription } from 'rxjs';\nimport { debounce, map } from 'rxjs/operators';\n\nimport { EntityState, EntityStore, EntityStoreFilterCustomFuncStrategy, EntityStoreWatcher } from '@igo2/common';\n\nimport { IgoMap } from '../../map';\n\nimport { TextSearchOptions } from '../shared/sources/source.interfaces';\nimport { SearchService } from '../shared/search.service';\nimport { SearchResult, Research } from '../shared/search.interfaces';\nimport { SearchSource } from '../shared/sources/source';\n\nexport enum SearchResultMode {\n  Grouped = 'grouped',\n  Flat = 'flat'\n}\n\n/**\n * List of search results with focus and selection capabilities.\n * This component is dumb and only emits events.\n */\n@Component({\n  selector: 'igo-search-results',\n  templateUrl: './search-results.component.html',\n  styleUrls: ['./search-results.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultsComponent implements OnInit, OnDestroy {\n  /**\n   * Reference to the SearchResultMode enum\n   * @internal\n   */\n  public searchResultMode = SearchResultMode;\n\n  /**\n   * Search results store watcher\n   */\n  private watcher: EntityStoreWatcher<SearchResult>;\n\n  private settingsChange$$: Subscription;\n\n  public pageIterator: {sourceId: string}[] = [];\n\n  public collapsed: {sourceId: string}[] = [];\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Search results display mode\n   */\n  @Input() mode: SearchResultMode = SearchResultMode.Grouped;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  /**\n   * Search term\n   */\n  @Input()\n  get term(): string {\n    return this._term;\n  }\n  set term(value: string) {\n    this._term = value;\n    this.pageIterator = [];\n  }\n  public _term: string;\n\n  @Input() settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Event emitted when a result is focused\n   */\n  @Output() resultFocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is unfocused\n   */\n  @Output() resultUnfocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is selected\n   */\n  @Output() resultSelect = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a research is completed after displaying more results is clicked\n   */\n  @Output() moreResults = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Events emitted when a result is focus or unfocus by mouse event\n   */\n  @Output() resultMouseenter = new EventEmitter<SearchResult>();\n  @Output() resultMouseleave = new EventEmitter<SearchResult>();\n\n  @ContentChild('igoSearchItemToolbar', /* TODO: add static flag */ {}) templateSearchToolbar: TemplateRef<any>;\n\n  get results$(): Observable<{source: SearchSource; results: SearchResult[]}[]> {\n    if (this._results$ === undefined) {\n      this._results$ = this.liftResults();\n    }\n    return this._results$;\n  }\n  private _results$: Observable<\n    {source: SearchSource; results: SearchResult[]}[]\n  >;\n\n  constructor(private cdRef: ChangeDetectorRef,\n              private searchService: SearchService) {}\n\n  /**\n   * Bind the search results store to the watcher\n   * @internal\n   */\n  ngOnInit() {\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n    this.settingsChange$$ = this.settingsChange$.subscribe(() => {\n      this.pageIterator = [];\n    });\n  }\n\n  /**\n   * Unbind the search results store from the watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n    this.settingsChange$$.unsubscribe();\n  }\n\n  /**\n   * Compute a group title\n   * @param group Search results group\n   * @returns Group title\n   * @internal\n   */\n  computeGroupTitle(group: {source: SearchSource; results: SearchResult[]}): string {\n    const parts = [group.source.title];\n    const count = group.results.length;\n    if (count > 1) {\n      parts.push(`(${count})`);\n    }\n    return parts.join(' ');\n  }\n\n  /**\n   * When a result is selected, update it's state in the store and emit\n   * an event. A selected result is also considered focused\n   * @param result Search result\n   * @internal\n   */\n  onResultSelect(result: SearchResult) {\n    if (this.store.state.get(result)) {\n      if (this.store.state.get(result).selected === true) {\n        return;\n      }\n    }\n    this.store.state.update(result, {focused: true, selected: true}, true);\n    this.resultSelect.emit(result);\n  }\n\n  /**\n   * Return an observable of the search results, grouped by search source\n   * @returns Observable of grouped search results\n   * @internal\n   */\n   private liftResults(): Observable<{source: SearchSource; results: SearchResult[]}[]> {\n    return this.store.stateView.all$().pipe(\n      debounce((results: {entity: SearchResult, state: EntityState}[]) => {\n        return results.length === 0 ? EMPTY : timer(200);\n      }),\n      map((results: {entity: SearchResult, state: EntityState}[]) => {\n        return this.groupResults(results.map(r => r.entity).sort(this.sortByOrder));\n      })\n    );\n  }\n\n  /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\n    return r1.source.displayOrder - r2.source.displayOrder;\n  }\n\n  /**\n   * Group results by search source\n   * @param results Search results from all sources\n   * @returns Search results grouped by source\n   */\n  private groupResults(results: SearchResult[]): {source: SearchSource; results: SearchResult[]}[] {\n    const grouped = new Map<SearchSource, SearchResult[]>();\n    results.forEach((result: SearchResult) => {\n      const source = result.source;\n      let sourceResults = grouped.get(source);\n      if (sourceResults === undefined) {\n        sourceResults = [];\n        grouped.set(source, sourceResults);\n      }\n      sourceResults.push(result);\n    });\n\n    return Array.from(grouped.keys()).map((source: SearchSource) => {\n      if (this.pageIterator[source.getId()] === undefined) {\n        this.pageIterator[source.getId()] = 1;\n      }\n      return {source, results: grouped.get(source)};\n    });\n  }\n\n  isMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\n    // getStrategyOfType is to avoid display more result based on a filtered state\n    const stategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n    const active = stategy?.active || false;\n    return !active && group.results &&\n      group.results[group.results.length - 1].meta.nextPage === true;\n  }\n\n  displayMoreResults(group: {source: SearchSource; results: SearchResult[]}) {\n    const options: TextSearchOptions = {\n      sourceId: group.source.getId(),\n      page: ++this.pageIterator[group.source.getId()]\n    };\n\n    let terms;\n    if (this.termSplitter && this.term.match(new RegExp(this.termSplitter, 'g'))) {\n      terms = this.term.split(this.termSplitter);\n    } else {\n      terms = [this.term];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      researches = researches.concat(this.searchService.search(term, options));\n    });\n\n    researches.map(research => {\n      research.request.subscribe((results: SearchResult[]) => {\n        const newResults = group.results.concat(results);\n        if (!results.length) {\n          newResults[newResults.length - 1].meta.nextPage = false;\n        }\n        this.moreResults.emit({research, results: newResults});\n      });\n    });\n    return;\n  }\n}\n","<button\n(mouseenter)=\"onMouseEvent($event)\" (mouseleave)=\"onMouseEvent($event)\"\n*ngIf=\"layer.meta.dataType === 'Layer'\"\nmat-icon-button\ntooltip-position=\"below\"\nmatTooltipShowDelay=\"500\"\n[matTooltip]=\"(tooltip$ | async) | translate\"\n[color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n(click)=\"onToggleClick($event)\">\n<mat-icon\n  matBadge=\"icon\"\n  igoMatBadgeIcon=\"eye-off\"\n  igoMatBadgeInverseColor=\"true\"\n  [matBadgeHidden]=\"(inRange$ | async)\"\n  matBadgeDisabled=\"true\"\n  matBadgeSize=\"small\"\n  matBadgePosition=\"after\"\n  [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\">\n</mat-icon>\n</button>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { SearchResult } from '../shared/search.interfaces';\nimport { IgoMap } from '../../map/shared/map';\nimport { LayerOptions } from '../../layer/shared/layers/layer.interface';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { LAYER } from '../../layer/shared/layer.enums';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'igo-search-add-button',\n  templateUrl: './search-results-add-button.component.html',\n  styleUrls: ['./search-results-add-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultAddButtonComponent implements OnInit, OnDestroy {\n  public tooltip$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.catalog.layer.addToMap'\n  );\n\n  private resolution$$: Subscription;\n\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  private layersSubcriptions = [];\n\n  private lastTimeoutRequest;\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() layer: SearchResult;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added: boolean;\n\n  /**\n   * The map to add the search result layer to\n   */\n  @Input() map: IgoMap;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(private layerService: LayerService) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit(): void {\n    if (this.layer.meta.dataType === 'Layer') {\n      this.added =\n        this.map.layers.findIndex(\n          lay => lay.id === this.layer.data.sourceOptions.id\n        ) !== -1;\n    }\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(value => {\n      this.isInResolutionsRange(value);\n      this.tooltip$.next(this.computeTooltip());\n    });\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n\n    if (event.type === 'mouseenter' && this.mouseInsideAdd ) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove();\n          } else {\n            this.add();\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add();\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove();\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  private add() {\n    if (!this.added) {\n      this.added = true;\n      this.addLayerToMap();\n    }\n  }\n\n  private remove() {\n    if (this.added) {\n      this.added = false;\n      this.removeLayerFromMap();\n      this.layersSubcriptions.map(s => s.unsubscribe());\n      this.layersSubcriptions = [];\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private addLayerToMap() {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const layerOptions = (this.layer as SearchResult<LayerOptions>).data;\n    if (layerOptions.sourceOptions.optionsFromApi === undefined) {\n      layerOptions.sourceOptions.optionsFromApi = true;\n    }\n    this.layersSubcriptions.push(\n      this.layerService\n        .createAsyncLayer(layerOptions)\n        .subscribe(layer => this.map.addLayer(layer))\n    );\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private removeLayerFromMap() {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\n    this.map.removeLayer(oLayer);\n  }\n\n  isInResolutionsRange(resolution: number) {\n    const minResolution = this.layer.data.minResolution || 0;\n    const maxResolution = this.layer.data.maxResolution || Infinity;\n    this.inRange$.next(\n      resolution >= minResolution && resolution <= maxResolution\n    );\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.removeFromMap'\n        : 'igo.geo.catalog.layer.removeFromMapOutRange';\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport {\n  IgoCollapsibleModule,\n  IgoListModule,\n  IgoMatBadgeIconModule,\n  IgoStopPropagationModule\n} from '@igo2/common';\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\nimport { SearchResultsComponent } from './search-results.component';\nimport { SearchResultsItemComponent } from './search-results-item.component';\nimport { SearchResultAddButtonComponent } from './search-results-add-button.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatListModule,\n    MatButtonModule,\n    IgoCollapsibleModule,\n    IgoListModule,\n    IgoStopPropagationModule,\n    IgoLanguageModule,\n    IgoMatBadgeIconModule,\n    IgoMetadataModule,\n  ],\n  exports: [\n    SearchResultsComponent,\n    SearchResultAddButtonComponent\n  ],\n  declarations: [\n    SearchResultsComponent,\n    SearchResultsItemComponent,\n    SearchResultAddButtonComponent\n  ]\n})\nexport class IgoSearchResultsModule {}\n","import { FeatureGeometry } from './../../feature/shared/feature.interfaces';\nimport {\n  Directive,\n  Input,\n  OnDestroy,\n  Self,\n  OnInit,\n  AfterContentChecked\n} from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { SearchService } from './search.service';\n\nimport olFeature from 'ol/Feature';\nimport { transform } from 'ol/proj';\nimport * as olstyle from 'ol/style';\nimport * as olgeom from 'ol/geom';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { SearchResult, Research } from './search.interfaces';\nimport { EntityStore } from '@igo2/common';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { take } from 'rxjs/operators';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureMotion, FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSourceService } from './search-source.service';\nimport { sourceCanReverseSearchAsSummary } from './search.utils';\nimport { MediaService } from '@igo2/core';\nimport { unByKey } from 'ol/Observable';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoSearchPointerSummary]'\n})\nexport class SearchPointerSummaryDirective implements OnInit, OnDestroy, AfterContentChecked {\n\n  public store: FeatureStore<Feature>;\n  private lonLat: [number, number];\n  private pointerSearchStore: EntityStore<SearchResult> = new EntityStore<SearchResult>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n  private reverseSearch$$: Subscription[] = [];\n  private hasPointerReverseSearchSource: boolean = false;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private searchPointerSummaryFeatureId: string = 'searchPointerSummaryFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoSearchPointerSummaryDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoSearchPointerSummaryEnabled: boolean = false;\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService\n  ) { }\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.listenToMapPointerMove();\n    this.subscribeToPointerStore();\n\n    this.map.status$.pipe(take(1)).subscribe(() => {\n      this.store = new FeatureStore<Feature>([], {map: this.map});\n      this.initStore();\n    });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      if (this.store && !layers.find(l => l.id === 'searchPointerSummaryId')) {\n        this.initStore();\n      }\n    });\n\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      id : 'searchPointerSummaryId',\n      title: 'searchPointerSummary',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: pointerPositionSummaryMarker\n    });\n    tryBindStoreLayer(store, layer);\n  }\n\n  ngAfterContentChecked(): void {\n      if (!this.searchSourceService.getEnabledSources().filter(sourceCanReverseSearchAsSummary).length) {\n        this.hasPointerReverseSearchSource = false;\n      } else {\n        this.hasPointerReverseSearchSource = true;\n      }\n    }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unsubscribeReverseSearch();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerSearchStore.entities$.subscribe(resultsUnderPointerPosition => {\n      this.entitiesToPointerOverlay(resultsUnderPointerPosition);\n    });\n  }\n\n  /**\n   * Build an object based on the closest feature by type (base on type and distance properties )\n   * @param results SearchResult[]\n   * @returns OL style function\n   */\n  private computeSummaryClosestFeature(results: SearchResult[]): {} {\n    const closestResultByType = {};\n\n    results.map(result => {\n      if (result.data.properties.type && result.data.properties.distance >= 0) {\n        if (closestResultByType.hasOwnProperty(result.data.properties.type)) {\n          const prevDistance = closestResultByType[result.data.properties.type].distance;\n          if (result.data.properties.distance < prevDistance) {\n            closestResultByType[result.data.properties.type] = { distance: result.data.properties.distance, title: result.meta.title };\n          }\n        } else {\n          closestResultByType[result.data.properties.type] = { distance: result.data.properties.distance, title: result.meta.title };\n        }\n      }\n    });\n\n    return closestResultByType;\n  }\n\n  /**\n   * convert store entities to a pointer position overlay with label summary on.\n   * @param event OL map browser pointer event\n   */\n  private entitiesToPointerOverlay(resultsUnderPointerPosition: SearchResult[]) {\n    const closestResultByType = this.computeSummaryClosestFeature(resultsUnderPointerPosition);\n    const summarizedClosestType = Object.keys(closestResultByType);\n    const processedSummarizedClosestType = [];\n    const summary = [];\n    resultsUnderPointerPosition.map(result => {\n      const typeIndex = summarizedClosestType.indexOf(result.data.properties.type);\n      if (typeIndex !== -1) {\n        summary.push(closestResultByType[result.data.properties.type].title);\n        summarizedClosestType.splice(typeIndex, 1);\n        processedSummarizedClosestType.push(result.data.properties.type);\n      } else {\n        if (processedSummarizedClosestType.indexOf(result.data.properties.type) === -1) {\n          summary.push(result.meta.title);\n        }\n      }\n    });\n    if (summary.length) {\n      this.addPointerOverlay(summary.join('\\n'));\n    }\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n  /**\n   * Unsubscribe to reverse seatch store.\n   * @internal\n   */\n  unsubscribeReverseSearch() {\n    this.reverseSearch$$.map(s => s.unsubscribe());\n    this.reverseSearch$$ = [];\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Trigger reverse search when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    if (\n      event.dragging || !this.igoSearchPointerSummaryEnabled ||\n      !this.hasPointerReverseSearchSource || this.mediaService.isTouchScreen()) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n      this.clearLayer();\n      this.unsubscribeReverseSearch();\n    }\n\n    this.lonLat = transform(event.coordinate, this.mapProjection, 'EPSG:4326') as [number, number];\n\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.onSearchCoordinate();\n    }, this.igoSearchPointerSummaryDelay);\n  }\n\n  private onSearchCoordinate() {\n    this.pointerSearchStore.clear();\n    const results = this.searchService.reverseSearch(this.lonLat, { params: { geometry: 'false', icon: 'false' } }, true);\n\n    for (const i in results) {\n      if (results.length > 0) {\n        this.reverseSearch$$.push(\n          results[i].request.subscribe((_results: SearchResult<Feature>[]) => {\n            this.onSearch({ research: results[i], results: _results });\n          }));\n      }\n    }\n  }\n\n  private onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    const newResults = this.pointerSearchStore.all()\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n    this.pointerSearchStore.load(newResults);\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addPointerOverlay(text: string) {\n    this.clearLayer();\n\n    const geometry = new olgeom.Point(\n      transform(this.lonLat, 'EPSG:4326', this.mapProjection)\n    );\n    const feature = new olFeature({ geometry });\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.mapProjection,\n      dataProjection: this.mapProjection\n    }) as FeatureGeometry;\n\n    const f: Feature = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.mapProjection,\n      properties: {\n        id: this.searchPointerSummaryFeatureId,\n        pointerSummary: text\n      },\n      meta: {\n        id: this.searchPointerSummaryFeatureId\n      },\n      ol: feature\n    };\n    this.store.setLayerFeatures([f], FeatureMotion.None);\n  }\n\n/**\n * Clear the pointer store features\n */\nprivate clearLayer() {\n  if (this.store) {\n    this.store.clearLayer();\n  }\n}\n\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function pointerPositionSummaryMarker(feature: olFeature<OlGeometry>, resolution: number): olstyle.Style {\n  return new olstyle.Style({\n    image: new olstyle.Icon({\n      src: './assets/igo2/geo/icons/cross_black_18px.svg',\n      imgSize: [18, 18], // for ie\n    }),\n\n    text: new olstyle.Text({\n      text: feature.get('pointerSummary'),\n      textAlign: 'left',\n      textBaseline: 'bottom',\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      backgroundFill: new olstyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n      backgroundStroke: new olstyle.Stroke({ color: 'rgba(200, 200, 200, 0.75)', width: 2 }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true,\n      offsetX: 10,\n      offsetY: -10,\n      padding: [2.5, 2.5, 2.5, 2.5]\n    })\n  });\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { SearchService } from './shared/search.service';\nimport { provideSearchSourceService } from './shared/search-source-service.providers';\nimport { provideDefaultIChercheSearchResultFormatter } from './shared/sources/icherche.providers';\nimport { provideDefaultCoordinatesSearchResultFormatter } from './shared/sources/coordinates.providers';\nimport { provideILayerSearchResultFormatter } from './shared/sources/ilayer.providers';\n\nimport { IgoSearchBarModule } from './search-bar/search-bar.module';\nimport { IgoSearchSelectorModule } from './search-selector/search-selector.module';\nimport { IgoSearchResultsModule } from './search-results/search-results.module';\nimport { IgoSearchSettingsModule } from './search-settings/search-settings.module';\nimport { SearchPointerSummaryDirective } from './shared/search-pointer-summary.directive';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule\n  ],\n  exports: [\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule,\n    SearchPointerSummaryDirective\n  ],\n  declarations: [SearchPointerSummaryDirective]\n})\nexport class IgoSearchModule {\n  static forRoot(): ModuleWithProviders<IgoSearchModule> {\n    return {\n      ngModule: IgoSearchModule,\n      providers: [\n        SearchService,\n        provideSearchSourceService(),\n        provideDefaultIChercheSearchResultFormatter(),\n        provideDefaultCoordinatesSearchResultFormatter(),\n        provideILayerSearchResultFormatter()\n      ]\n    };\n  }\n}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { OnUpdateInputs, WidgetComponent } from '@igo2/common';\n\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { IgoMap } from '../../../map/shared/map';\n\n@Component({\n  selector: 'igo-ogc-filter',\n  templateUrl: './ogc-filter.component.html',\n  styleUrls: ['./ogc-filter.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterComponent implements OnUpdateInputs, WidgetComponent {\n\n  @Input() layer: Layer;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Event emitted on complete\n   */\n  @Output() complete = new EventEmitter<void>();\n\n  /**\n   * Event emitted on cancel\n   */\n  @Output() cancel = new EventEmitter<void>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Implemented as part of OnUpdateInputs\n   */\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * On close, emit the cancel event\n   */\n  onClose() {\n    this.cancel.emit();\n  }\n\n}\n","<igo-ogc-filterable-item\n  igoListItem\n  [layer]=\"layer\"\n  [header]=\"false\" \n  [map]=\"map\" >\n</igo-ogc-filterable-item>","import { InjectionToken } from '@angular/core';\n\nimport { Widget, WidgetService } from '@igo2/common';\n\nimport { OgcFilterComponent } from './ogc-filter/ogc-filter.component';\n\nexport const OgcFilterWidget = new InjectionToken<Widget>('OgcFilterWidget');\n\nexport function ogcFilterWidgetFactory(widgetService: WidgetService): Widget {\n  return widgetService.create(OgcFilterComponent);\n}\n\nexport function provideOgcFilterWidget() {\n  return {\n    provide: OgcFilterWidget,\n    useFactory: ogcFilterWidgetFactory,\n    deps: [WidgetService]\n  };\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoFilterModule } from '../../../filter/filter.module';\nimport { OgcFilterComponent } from './ogc-filter.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    IgoFilterModule\n  ],\n  exports: [OgcFilterComponent],\n  declarations: [OgcFilterComponent]\n})\nexport class IgoOgcFilterModule {}\n","import {\n  Workspace,\n  WorkspaceOptions\n} from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nexport interface WfsWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class WfsWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  constructor(protected options: WfsWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport {\n  ActionStore,\n  EntityTableTemplate,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityRecord,\n  EntityStoreStrategyFuncOptions,\n  EntityStoreFilterSelectionStrategy,\n  EntityTableColumnRenderer\n} from '@igo2/common';\n\nimport {\n  FeatureStore,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureStoreInMapExtentStrategy,\n  Feature,\n  FeatureMotion,\n  FeatureStoreInMapResolutionStrategy\n} from '../../feature';\nimport { VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams, FeatureDataSource } from '../../datasource';\n\nimport { WfsWorkspace } from './wfs-workspace';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { StorageService } from '@igo2/core';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WfsWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(private storageService: StorageService) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): WfsWorkspace {\n    if (layer.options.workspace?.enabled === false) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace,\n      {\n        enabled: true,\n        srcId: layer.id,\n        workspaceId: layer.id\n      } as GeoWorkspaceOptions);\n\n    const wks = new WfsWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    this.createTableTemplate(wks, layer);\n    return wks;\n\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], {map});\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: WfsWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n        .filter(\n          col => !col.startsWith('_') &&\n          col !== 'geometry' &&\n          col !== ol.getGeometryName() &&\n          !col.match(/boundedby/gi))\n        .map(key => {\n          return {\n            name: `properties.${key}`,\n            title: key,\n            renderer: EntityTableColumnRenderer.UnsanitizedHTML\n          };\n        });\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML\n      };\n    });\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport {\n  ActionStore,\n  EntityRecord,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  EntityStoreStrategyFuncOptions,\n  EntityTableColumnRenderer,\n  EntityTableTemplate } from '@igo2/common';\nimport { StorageService } from '@igo2/core';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { SourceFieldsOptionsParams, WMSDataSource } from '../../datasource';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy } from '../../feature';\n\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport { ImageLayer, LayerService, LayersLinkProperties, LinkedProperties, VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { WfsWorkspace } from './wfs-workspace';\n\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WmsWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(private layerService: LayerService, private storageService: StorageService) { }\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): WfsWorkspace {\n    if (layer.options.workspace?.enabled !== true) {\n      return;\n    }\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource ;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      bidirectionnal: true,\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [\n        LinkedProperties.ZINDEX,\n        LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n       linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if ((dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(JSON.stringify(layer.options.linkedLayers.links));\n    }\n    clonedLinks.push(linkProperties);\n\n    layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId ? layer.options.linkedLayers.linkId : wmsLinkId,\n      layer.options.linkedLayers.links = clonedLinks;\n    interface WFSoptions extends WFSDataSourceOptions, OgcFilterableDataSourceOptions { }\n    let wks;\n    this.layerService\n      .createAsyncLayer({\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: {\n          srcId: layer.id,\n          workspaceId: undefined,\n          enabled: false,\n        },\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution: layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution: layer.options.workspace?.maxResolution || layer.maxResolution || Infinity,\n        sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions).queryTitle,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters$.value, {enabled: hasOgcFilters}),\n          sourceFields: dataSource.options.sourceFields || undefined\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties({ linkedLayers: { linkId: layer.options.linkedLayers.linkId, links: clonedLinks } }, false);\n        workspaceLayer.dataSource.ol.refresh();\n\n        wks = new WfsWorkspace({\n          id: layer.id,\n          title: layer.title,\n          layer: workspaceLayer,\n          map,\n          entityStore: this.createFeatureStore(workspaceLayer, map),\n          actionStore: new ActionStore([]),\n          meta: {\n            tableTemplate: undefined\n          }\n        });\n        this.createTableTemplate(wks, workspaceLayer);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace,\n          {\n            enabled: true,\n            srcId: layer.id,\n            workspaceId: workspaceLayer.id\n          } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: WfsWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n          .filter(\n            col => !col.startsWith('_') &&\n              col !== 'geometry' &&\n              col !== ol.getGeometryName() &&\n              !col.match(/boundedby/gi))\n          .map(key => {\n            return {\n              name: `properties.${key}`,\n              title: key,\n              renderer: EntityTableColumnRenderer.UnsanitizedHTML\n            };\n          });\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML\n      };\n    });\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import {\n  Workspace,\n  WorkspaceOptions\n} from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nexport interface FeatureWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class FeatureWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  constructor(protected options: FeatureWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport {\n  ActionStore,\n  EntityTableTemplate,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityRecord,\n  EntityStoreStrategyFuncOptions,\n  EntityStoreFilterSelectionStrategy,\n  EntityTableColumnRenderer\n} from '@igo2/common';\n\nimport {\n  FeatureStore,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureStoreInMapExtentStrategy,\n  Feature,\n  FeatureMotion,\n  FeatureStoreInMapResolutionStrategy\n} from '../../feature';\nimport { VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams, FeatureDataSource } from '../../datasource';\n\nimport { FeatureWorkspace } from './feature-workspace';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { StorageService } from '@igo2/core';\n\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FeatureWorkspaceService {\n\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(private storageService: StorageService) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): FeatureWorkspace {\n    if (layer.options.workspace?.enabled === false) {\n      return;\n    }\n    layer.options.workspace = Object.assign({}, layer.options.workspace, {enabled: true});\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace,\n      {\n        enabled: true,\n        srcId: layer.id,\n        workspaceId: layer.id\n      } as GeoWorkspaceOptions);\n\n\n    const wks = new FeatureWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    this.createTableTemplate(wks, layer);\n    return wks;\n\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], {map});\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: FeatureWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n        .filter(\n          col => !col.startsWith('_') &&\n          col !== 'geometry' &&\n          col !== ol.getGeometryName() &&\n          !col.match(/boundedby/gi))\n        .map(key => {\n          return {\n            name: `properties.${key}`,\n            title: key,\n            renderer: EntityTableColumnRenderer.UnsanitizedHTML\n          };\n        });\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML\n      };\n    });\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { Directive, Input, OnInit, OnDestroy } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { Workspace, WorkspaceStore, WorkspaceSelectorComponent } from '@igo2/common';\n\nimport { Layer, ImageLayer, VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\nimport { WFSDataSource, WMSDataSource, FeatureDataSource } from '../../datasource';\nimport { OgcFilterableDataSourceOptions } from '../../filter';\n\nimport { WfsWorkspaceService } from '../shared/wfs-workspace.service';\nimport { WmsWorkspaceService } from '../shared/wms-workspace.service';\nimport { FeatureWorkspaceService } from '../shared/feature-workspace.service';\nimport { FeatureStoreInMapExtentStrategy } from '../../feature/shared/strategies/in-map-extent';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\n\n@Directive({\n  selector: '[igoWorkspaceSelector]'\n})\nexport class WorkspaceSelectorDirective implements OnInit, OnDestroy {\n\n  private layers$$: Subscription;\n  private entities$$: Subscription[] = [];\n\n  @Input() map: IgoMap;\n\n  get workspaceStore(): WorkspaceStore {\n    return this.component.store;\n  }\n\n  constructor(\n    private component: WorkspaceSelectorComponent,\n    private wfsWorkspaceService: WfsWorkspaceService,\n    private wmsWorkspaceService: WmsWorkspaceService,\n    private featureWorkspaceService: FeatureWorkspaceService\n  ) {}\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$\n      .pipe(debounceTime(50))\n      .subscribe((layers: Layer[]) =>\n        this.onLayersChange(layers)\n      );\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.entities$$.map(entities => entities.unsubscribe());\n  }\n\n  private onLayersChange(layers: Layer[]) {\n    const editableLayers = layers.filter((layer: Layer) =>\n      this.layerIsEditable(layer)\n    );\n    const editableLayersIds = editableLayers.map((layer: Layer) => layer.id);\n\n    const workspacesToAdd = editableLayers\n      .map((layer: VectorLayer) => this.getOrCreateWorkspace(layer))\n      .filter((workspace: Workspace | undefined) => workspace !== undefined);\n\n    const workspacesToRemove = this.workspaceStore.all()\n      .filter((workspace: Workspace) => {\n        return editableLayersIds.indexOf(workspace.id) < 0;\n      });\n\n    if (workspacesToRemove.length > 0) {\n      workspacesToRemove.forEach((workspace: Workspace) => {\n        workspace.entityStore.deactivateStrategyOfType(FeatureStoreInMapExtentStrategy);\n        workspace.deactivate();\n      });\n      this.workspaceStore.state.updateMany(workspacesToRemove, {active: false, selected: false});\n      this.workspaceStore.deleteMany(workspacesToRemove);\n    }\n\n    if (workspacesToAdd.length > 0) {\n      this.workspaceStore.insertMany(workspacesToAdd);\n    }\n  }\n\n  private getOrCreateWorkspace(layer: VectorLayer | ImageLayer): Workspace | undefined {\n    const workspace = this.workspaceStore.get(layer.id);\n    if (workspace !== undefined) {\n      return;\n    }\n    if (layer.dataSource instanceof WFSDataSource) {\n      const wfsWks = this.wfsWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\n      return wfsWks;\n    } else if (layer.dataSource instanceof WMSDataSource) {\n      if (!layer.dataSource.options.paramsWFS) { return; }\n      const wmsWks = this.wmsWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\n      wmsWks?.inResolutionRange$.subscribe((inResolutionRange) => {\n        (layer.dataSource.options as QueryableDataSourceOptions).queryable = !inResolutionRange;\n        (wmsWks.layer.dataSource.options as QueryableDataSourceOptions).queryable = inResolutionRange;\n      });\n      return wmsWks;\n    } else if (layer.dataSource instanceof FeatureDataSource && (layer as VectorLayer).exportable === true) {\n      const featureWks = this.featureWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\n      return featureWks;\n    }\n\n    return;\n  }\n\n  private layerIsEditable(layer: Layer): boolean {\n    const dataSource = layer.dataSource;\n    if (dataSource instanceof WFSDataSource) {\n      return true;\n    }\n    if (dataSource instanceof FeatureDataSource) {\n      return true;\n    }\n    if (dataSource instanceof WMSDataSource) {\n      const dataSourceOptions = (dataSource.options ||\n        {}) as OgcFilterableDataSourceOptions;\n      return (dataSourceOptions.ogcFilters?.enabled || dataSource.options.paramsWFS?.featureTypes !== undefined);\n    }\n\n    return false;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { WorkspaceSelectorDirective } from './workspace-selector.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n   WorkspaceSelectorDirective\n  ],\n  declarations: [\n    WorkspaceSelectorDirective\n  ]\n})\nexport class IgoWorkspaceSelectorModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { WorkspaceUpdatorDirective } from './workspace-updator.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n   WorkspaceUpdatorDirective\n  ],\n  declarations: [\n    WorkspaceUpdatorDirective\n  ]\n})\nexport class IgoWorkspaceUpdatorModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { IgoWidgetModule } from '@igo2/common';\n\nimport { provideOgcFilterWidget } from './widgets/widgets';\n\nimport { IgoOgcFilterModule } from './widgets/ogc-filter/ogc-filter.module';\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\nimport { IgoWorkspaceUpdatorModule } from './workspace-updator/workspace-updator.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoWidgetModule,\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceUpdatorModule,\n    IgoOgcFilterModule\n  ],\n  exports: [\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceUpdatorModule,\n    IgoOgcFilterModule\n  ],\n  declarations: [],\n  providers: [\n    provideOgcFilterWidget()\n  ]\n})\nexport class IgoGeoWorkspaceModule {}\n","import { EntityStore } from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureWithDirection, FeatureWithStep, FeatureWithStop, Stop } from './directions.interface';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * stops.\n */\nexport class StopsStore extends EntityStore<Stop> {\n\n    public storeInitialized$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n    public clearStops() {\n        this.storeInitialized$.next(false);\n        this.clear();\n    }\n\n}\n\nexport class StopsFeatureStore extends FeatureStore<FeatureWithStop> {\n\n}\nexport class RoutesFeatureStore extends FeatureStore<FeatureWithDirection> {\n\n}\nexport class StepFeatureStore extends FeatureStore<FeatureWithStep> {\n\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Cacheable } from 'ts-cacheable';\n\nimport { uuid } from '@igo2/utils';\nimport { ConfigService } from '@igo2/core';\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsFormat, SourceDirectionsType } from '../shared/directions.enum';\n\nimport { DirectionsSource } from './directions-source';\nimport { DirectionsSourceOptions } from './directions-source.interface';\n\n@Injectable()\nexport class OsrmDirectionsSource extends DirectionsSource {\n  get enabled(): boolean {\n    return this.options.enabled !== false;\n  }\n  set enabled(value: boolean) {\n    this.options.enabled = value;\n  }\n  static _name = 'OSRM Québec';\n  private directionsUrl =\n    'https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/';\n  private options: DirectionsSourceOptions;\n\n  constructor(private http: HttpClient, private config: ConfigService) {\n    super();\n    this.options = this.config.getConfig('directionsSources.osrm') || {};\n    this.directionsUrl = this.options.url || this.directionsUrl;\n  }\n\n  getName(): string {\n    return OsrmDirectionsSource._name;\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  route(coordinates: [number, number][], directionsOptions: DirectionOptions = {}): Observable<Direction[]> {\n    const directionsParams = this.getRouteParams(directionsOptions);\n    return this.http\n      .get<JSON[]>(this.directionsUrl + coordinates.join(';'), {\n        params: directionsParams\n      })\n      .pipe(map(res => this.extractRoutesData(res)));\n  }\n\n  private extractRoutesData(response): Direction[] {\n    const routeResponse = [];\n    response.routes.forEach(route => {\n      routeResponse.push(this.formatRoute(route, response.waypoints));\n    });\n    return routeResponse;\n  }\n\n  private getRouteParams(directionsOptions: DirectionOptions = {}): HttpParams {\n\n    directionsOptions.alternatives = directionsOptions.alternatives !== undefined ? directionsOptions.alternatives : true;\n    directionsOptions.steps = directionsOptions.steps !== undefined ? directionsOptions.steps : true;\n    directionsOptions.geometries = directionsOptions.geometries !== undefined ? directionsOptions.geometries : 'geojson';\n    directionsOptions.overview = directionsOptions.overview !== undefined ? directionsOptions.overview : false;\n    directionsOptions.continue_straight = directionsOptions.continue_straight !== undefined ? directionsOptions.continue_straight : false;\n\n    return new HttpParams({\n      fromObject: {\n        alternatives: directionsOptions.alternatives ? 'true' : 'false',\n        overview: directionsOptions.overview ? 'simplified' : 'full',\n        steps: directionsOptions.steps ? 'true' : 'false',\n        geometries: directionsOptions.geometries ? directionsOptions.geometries : 'geojson',\n        continue_straight: directionsOptions.continue_straight ? 'true' : 'false',\n      }\n    });\n  }\n\n  private formatRoute(roadNetworkRoute: any, waypoints: any): Direction {\n    const stepsUI = [];\n    roadNetworkRoute.legs.forEach(leg => {\n      leg.steps.forEach(step => {\n        stepsUI.push(step);\n      });\n    });\n    return {\n      id: uuid(),\n      title: roadNetworkRoute.legs[0].summary,\n      source: OsrmDirectionsSource._name,\n      sourceType: SourceDirectionsType.Route,\n      order: 1,\n      format: DirectionsFormat.GeoJSON,\n      icon: 'directions',\n      projection: 'EPSG:4326',\n      waypoints,\n      distance: roadNetworkRoute.distance,\n      duration: roadNetworkRoute.duration,\n      geometry: roadNetworkRoute.geometry,\n      legs: roadNetworkRoute.legs,\n      steps: stepsUI,\n      weight: roadNetworkRoute.weight,\n      weight_name: roadNetworkRoute.weight_name\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { DirectionsSource } from './directions-source';\nimport { OsrmDirectionsSource } from './osrm-directions-source';\n\nexport function osrmDirectionsSourcesFactory(\n  http: HttpClient,\n  config: ConfigService\n) {\n  return new OsrmDirectionsSource(http, config);\n}\n\nexport function provideOsrmDirectionsSource() {\n  return {\n    provide: DirectionsSource,\n    useFactory: osrmDirectionsSourcesFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport olWKT from 'ol/format/WKT';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n/**\n * Cadastre search source\n */\n@Injectable()\nexport class CadastreSearchSource extends SearchSource implements TextSearch {\n  static id = 'cadastre';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return CadastreSearchSource.id;\n  }\n\n  getType(): string {\n    return CadastreSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Cadastre (Québec)',\n      searchUrl: 'https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?'\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    term = term.endsWith(',') ? term.slice(0, -1) : term;\n    term = term.startsWith(',') ? term.substr(1) : term;\n    term = term.replace(/ /g, '');\n\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('numero') || !params.get('numero').match(/^[0-9,]+$/g)) {\n      return of([]);\n    }\n    return this.http\n      .get(this.searchUrl, { params, responseType: 'text' })\n      .pipe(map((response: string) => this.extractResults(response, term)));\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          numero: term,\n          epsg: '4326'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(response: string, term: string): SearchResult<Feature>[] {\n    return response\n      .split('<br />')\n      .filter((lot: string) => lot.length > 0)\n      .map((lot: string) => this.dataToResult(lot, term));\n  }\n\n  private dataToResult(data: string, term: string): SearchResult<Feature> {\n    const lot = data.split(';');\n    const numero = lot[0];\n    const wkt = lot[7];\n    const geometry = this.computeGeometry(wkt);\n\n    const properties = {\n      NoLot: numero,\n      Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n    };\n    const id = [this.getId(), 'cadastre', numero].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: numero,\n        score: computeTermSimilarity(term.trim(), numero),\n        icon: 'map-marker'\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        properties,\n        meta: {\n          id,\n          title: numero\n        }\n      }\n    };\n  }\n\n  private computeGeometry(wkt: string): FeatureGeometry {\n    const feature = new olWKT().readFeature(wkt, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: 'EPSG:4326'\n    });\n    return {\n      type: feature.getGeometry().getType(),\n      coordinates: feature.getGeometry().getCoordinates()\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { CadastreSearchSource } from './cadastre';\n\n/**\n * Cadastre search source factory\n * @ignore\n */\nexport function cadastreSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new CadastreSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${CadastreSearchSource.id}`),\n  );\n}\n\n/**\n * Function that returns a provider for the Cadastre search source\n */\nexport function provideCadastreSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: cadastreSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { StorageService } from '@igo2/core';\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\nimport { NominatimData } from './nominatim.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n/**\n * Nominatim search source\n */\n@Injectable()\nexport class NominatimSearchSource extends SearchSource implements TextSearch {\n  static id = 'nominatim';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    @Inject('options') options: SearchSourceOptions,\n    storageService: StorageService\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return NominatimSearchSource.id;\n  }\n\n  getType(): string {\n    return NominatimSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Nominatim (OSM)',\n      searchUrl: 'https://nominatim.openstreetmap.org/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'amenity',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.type.food',\n              value:\n                'bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.health',\n              value:\n                'baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.entertainment',\n              value:\n                'arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium \\\n                          ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.finance',\n              value: 'atm,bank,bureau_de_change',\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '10',\n              value: 10,\n              enabled: true\n            },\n            {\n              title: '20',\n              value: 20,\n              enabled: false\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'countrycodes',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.country.canada',\n              value: 'CA',\n              enabled: true\n            },\n            {\n              title: 'igo.geo.search.nominatim.country.all',\n              value: null,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'multiple object',\n          name: 'dedupe',\n          values: [\n            {\n              title: 'igo.geo.search.searchSources.settings.true',\n              value: 0,\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.searchSources.settings.false',\n              value: 1,\n              enabled: true\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q')) {\n      return of([]);\n    }\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(map((response: NominatimData[]) => this.extractResults(response, term)));\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          q: this.computeTerm(term),\n          format: 'json'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(response: NominatimData[], term: string): SearchResult<Feature>[] {\n    return response.map((data: NominatimData) => this.dataToResult(data, term));\n  }\n\n  private dataToResult(data: NominatimData, term: string): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const geometry = this.computeGeometry(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), 'place', data.place_id].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.display_name,\n        icon: 'map-marker',\n        score: computeTermSimilarity(term.trim(), data.display_name)\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.display_name\n        }\n      }\n    };\n  }\n\n  private computeProperties(data: NominatimData): { [key: string]: any } {\n    return {\n      display_name: data.display_name,\n      place_id: data.place_id,\n      osm_type: data.osm_type,\n      class: data.class,\n      type: data.type\n    };\n  }\n\n  private computeGeometry(data: NominatimData): FeatureGeometry {\n    return {\n      type: 'Point',\n      coordinates: [parseFloat(data.lon), parseFloat(data.lat)]\n    };\n  }\n\n  private computeExtent(data: NominatimData): [number, number, number, number] {\n    return [\n      parseFloat(data.boundingbox[2]),\n      parseFloat(data.boundingbox[0]),\n      parseFloat(data.boundingbox[3]),\n      parseFloat(data.boundingbox[1])\n    ];\n  }\n\n  private computeTerm(term: string): string {\n    return this.computeTermTags(term);\n  }\n\n  /**\n   * Add hashtag from query in Nominatim's format (+[])\n   * @param term Query with hashtag\n   */\n  private computeTermTags(term: string): string {\n    const hashtags = super.getHashtagsValid(term, 'amenity');\n    if (!hashtags) {\n      return this.computeTermSettings(term);\n    }\n\n    if (!hashtags.length) {\n      return null;\n    }\n\n    term = term.replace(/(#[^\\s]*)/g, '');\n    hashtags.forEach(tag => {\n      term += '+[' + tag + ']';\n    });\n\n    return term;\n  }\n\n  /**\n   * Add hashtag from settings in Nominatim's format (+[])\n   * @param term Query\n   */\n  private computeTermSettings(term: string): string {\n    this.options.settings.forEach(settings => {\n      if (settings.name === 'amenity') {\n        settings.values.forEach(conf => {\n          if (conf.enabled && typeof conf.value === 'string') {\n            const splitted = conf.value.split(',');\n            splitted.forEach(value => {\n              term += '+[' + value + ']';\n            });\n          }\n        });\n      }\n    });\n    return term;\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { NominatimSearchSource } from './nominatim';\n\n/**\n * Nominatim search source factory\n * @ignore\n */\nexport function nominatimSearchSourceFactory(\n  http: HttpClient,\n  config: ConfigService,\n  storageService: StorageService\n) {\n  return new NominatimSearchSource(\n    http,\n    config.getConfig(`searchSources.${NominatimSearchSource.id}`),\n    storageService\n  );\n}\n\n/**\n * Function that returns a provider for the Nominatim search source\n */\nexport function provideNominatimSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: nominatimSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService, StorageService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { FEATURE, Feature } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch, ReverseSearch } from './source';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './source.interfaces';\nimport {\n  StoredQueriesData,\n  StoredQueriesResponse,\n  StoredQueriesReverseData,\n  StoredQueriesReverseResponse,\n  StoredQueriesSearchSourceOptions,\n  StoredQueriesFields,\n  StoredQueriesReverseSearchSourceOptions\n} from './storedqueries.interfaces';\n\nimport * as olformat from 'ol/format';\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n/**\n * StoredQueries search source\n */\n@Injectable()\nexport class StoredQueriesSearchSource extends SearchSource\n  implements TextSearch {\n  static id = 'storedqueries';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [\n    'boundedBy',\n    'id',\n    'coord_x',\n    'coord_y'\n  ];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions = options as StoredQueriesSearchSourceOptions;\n    if (this.storedQueriesOptions && !this.storedQueriesOptions.available) {\n      return;\n    }\n\n    const defaultStoredqueryId = 'rtss';\n    const defaultFieldSplitter: StoredQueriesFields[] = [\n      { name: 'rtss', defaultValue: '-99' },\n      { name: 'chainage', defaultValue: '0', splitPrefix: '\\\\+' }\n    ];\n    const defaultOutputformat = 'text/xml; subtype=gml/3.1.1';\n    const defaultSrsname = 'EPSG:4326';\n    const defaultResultTitle = 'title';\n\n    if (!this.storedQueriesOptions) {\n      console.log(\n        ' No configuration for this search source (storedqueries). You will use the default values'\n      );\n      this.storedQueriesOptions = {\n        storedquery_id: defaultStoredqueryId,\n        fields: defaultFieldSplitter,\n        outputformat: defaultOutputformat,\n        srsname: defaultSrsname,\n        resultTitle: defaultResultTitle\n      };\n      this.resultTitle = defaultResultTitle;\n      console.log('Default values', this.storedQueriesOptions);\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.fields) {\n      throw new Error(\n        'Stored Queries :You have to set \"fields\" into options. ex: fields: {\"name\": \"rtss\", \"defaultValue\": \"-99\"}'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n\n    const storedQueryId = this.storedQueriesOptions.storedquery_id.toLowerCase();\n    if (\n      storedQueryId.includes('getfeaturebyid') &&\n      this.storedQueriesOptions.outputformat\n        .toLowerCase()\n        .includes('getfeaturebyid')\n    ) {\n      let err =\n        'You must set a geojson format for your stored query. This is due to an openlayers issue)';\n      err += ' (wfs 1.1.0 & gml 3.1.1 limitation)';\n      throw new Error(err);\n    }\n\n    if (!(this.storedQueriesOptions.fields instanceof Array)) {\n      this.storedQueriesOptions.fields = [this.storedQueriesOptions.fields];\n    }\n\n    this.multipleFieldsQuery =\n      this.storedQueriesOptions.fields.length > 1 ? true : false;\n\n    this.storedQueriesOptions.fields.forEach((field, index) => {\n      if (this.multipleFieldsQuery && !field.splitPrefix && index !== 0) {\n        throw new Error(\n          'Stored Queries :You must set a field spliter into your field definition (optional for the first one!)'\n        );\n      }\n      if (!field.defaultValue) {\n        throw new Error(\n          'Stored Queries :You must set a field default value into your field definition'\n        );\n      }\n    });\n\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  // URL CALL EXAMPLES:\n  //  GetFeatureById (mandatory storedquery for wfs server) (outputformat must be in geojson)\n /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=2.0.0&request=GetFeature&storedquery_id=urn:ogc:def:query:OGC-WFS::GetFeatureById&srsname=epsg:4326&outputformat=geojson&ID=a_num_route.132\n  //  Custom StoredQuery\n /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=rtss&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&rtss=0013801110000c&chainage=12\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const storedqueriesParams = this.termSplitter(\n      term,\n      this.storedQueriesOptions.fields\n    );\n    const params = this.computeRequestParams(\n      options || {},\n      storedqueriesParams\n    );\n    this.options.params = this.options.params ? this.options.params : {};\n    this.options.params.page = !options.page ? String(options.page) : '1';\n\n    if (\n      new RegExp('.*?gml.*?', 'i').test(this.storedQueriesOptions.outputformat)\n    ) {\n      return this.http\n        .get(this.searchUrl, { params, responseType: 'text' })\n        .pipe(\n          map(response => {\n            let resultArray = this.extractResults(this.extractWFSData(response), term);\n            resultArray.sort((a, b) =>\n              (a.meta.score > b.meta.score) ? 1 :\n              (a.meta.score === b.meta.score) ? ((a.meta.titleHtml < b.meta.titleHtml) ? 1 : -1) : -1);\n            resultArray.reverse();\n            if (resultArray.length > Number(this.options.params.limit)) {\n              const idxEnd = Number(this.options.params.limit) * Number(this.options.params.page);\n              const resultTotLenght = resultArray.length;\n              resultArray = resultArray.slice(0, idxEnd);\n              if (idxEnd < resultTotLenght) {\n                resultArray[resultArray.length - 1 ].meta.nextPage = true;\n              } else {\n                resultArray[resultArray.length - 1 ].meta.nextPage = false;\n              }\n            }\n            return resultArray;\n          })\n        );\n    } else {\n      return this.http.get(this.searchUrl, { params }).pipe(\n        map(response => {\n          return this.extractResults(this.extractWFSData(response), term);\n        })\n      );\n    }\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private termSplitter(term: string, fields: StoredQueriesFields[]): {} {\n    const splittedTerm = {};\n    let remainingTerm = term;\n    let cnt = 0;\n\n    // Used to build the default values\n    fields.forEach(field => {\n      splittedTerm[field.name] = field.defaultValue;\n      const splitterRegex = new RegExp(field.splitPrefix + '(.+)', 'i');\n      if (splitterRegex.test(remainingTerm)) {\n        cnt = field.splitPrefix ? (cnt += 1) : cnt;\n        remainingTerm = remainingTerm.split(splitterRegex)[1];\n      }\n    });\n    if (cnt === 0) {\n      splittedTerm[fields[0].name] = term;\n      return splittedTerm;\n    }\n    remainingTerm = term;\n    const localFields = [...fields].reverse();\n    localFields.forEach(field => {\n      const splitterRegex = new RegExp(field.splitPrefix || '' + '(.+)', 'i');\n      if (remainingTerm || remainingTerm !== '') {\n        const values = remainingTerm.split(splitterRegex);\n        remainingTerm = values[0];\n        if (values[1]) {\n          splittedTerm[field.name] = values[1].trim();\n        }\n      }\n    });\n    return splittedTerm;\n  }\n\n  private computeRequestParams(\n    options: TextSearchOptions,\n    queryParams\n  ): HttpParams {\n    const wfsversion = this.storedQueriesOptions.storedquery_id\n      .toLowerCase()\n      .includes('getfeaturebyid')\n      ? '2.0.0'\n      : '1.1.0';\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'wfs',\n          version: wfsversion,\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        queryParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesResponse, term: string\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesData) => {\n      return this.dataToResult(data, term);\n    });\n  }\n\n  private dataToResult(data: StoredQueriesData, term: string): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        // extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.title,\n        titleHtml: data.properties[title],\n        icon: 'map-marker',\n        score: (data.properties.title) ?\n        computeTermSimilarity(term.trim(), data.properties.title) :\n        computeTermSimilarity(term.trim(), data.properties[title]),\n\n      }\n    };\n  }\n\n  private computeProperties(data: StoredQueriesData): { [key: string]: any } {\n    const properties = Object.assign(\n      {},\n      ObjectUtils.removeKeys(\n        data.properties,\n        StoredQueriesSearchSource.propertiesBlacklist\n      ),\n      { Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>' }\n    );\n    return properties;\n  }\n}\n\n/**\n * StoredQueriesReverse search source\n */\n\n// EXAMPLE CALLS\n /* eslint-disable max-len */\n// https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=lim_adm&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&long=-71.292469&lat=46.748107\n//\n\n@Injectable()\nexport class StoredQueriesReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'storedqueriesreverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesReverseSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions = options as StoredQueriesReverseSearchSourceOptions;\n\n    if (!this.storedQueriesOptions || (this.storedQueriesOptions && !this.storedQueriesOptions.available) ) {\n      return;\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.longField) {\n      throw new Error(\n        'Stored Queries :You have to set \"longField\" to map the longitude coordinate to the query params.'\n      );\n    }\n    if (!this.storedQueriesOptions.latField) {\n      throw new Error(\n        'Stored Queries :You have to set \"latField\" to map the latitude coordinate to the query params.'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries (reverse)',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n\n    if (\n      new RegExp('.*?gml.*?', 'i').test(this.storedQueriesOptions.outputformat)\n    ) {\n      return this.http\n        .get(this.searchUrl, { params, responseType: 'text' })\n        .pipe(\n          map(response => {\n            return this.extractResults(this.extractWFSData(response));\n          })\n        );\n    } else {\n      return this.http.get(this.searchUrl, { params }).pipe(\n        map(response => {\n          return this.extractResults(this.extractWFSData(response));\n        })\n      );\n    }\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    const longLatParams = {};\n    longLatParams[this.storedQueriesOptions.longField] = lonLat[0];\n    longLatParams[this.storedQueriesOptions.latField] = lonLat[1];\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'WFS',\n          version: '1.1.0',\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        longLatParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private dataToResult(data: StoredQueriesReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties[title],\n        icon: 'map-marker'\n      }\n    };\n  }\n\n  private computeProperties(\n    data: StoredQueriesReverseData\n  ): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      StoredQueriesReverseSearchSource.propertiesBlacklist\n    );\n    const routing = {\n      Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n    };\n    return Object.assign(properties, { type: data.properties.doc_type }, routing);\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  StoredQueriesSearchSource,\n  StoredQueriesReverseSearchSource\n} from './storedqueries';\n\n/**\n * StoredQueries search source factory\n * @ignore\n */\nexport function storedqueriesSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new StoredQueriesSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${StoredQueriesSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the StoredQueries search source\n */\nexport function provideStoredQueriesSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: storedqueriesSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n\n/**\n * StoredQueriesReverse search source factory\n * @ignore\n */\n\nexport function storedqueriesReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new StoredQueriesReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${StoredQueriesReverseSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the StoredQueriesReverse search source\n */\nexport function provideStoredQueriesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: storedqueriesReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n","import { WfsWorkspace } from './wfs-workspace';\nimport { FeatureWorkspace } from './feature-workspace';\nimport { Observable } from 'rxjs';\nimport { EntityStoreFilterCustomFuncStrategy, EntityRecord } from '@igo2/common';\nimport { map } from 'rxjs/operators';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { StorageScope } from '@igo2/core';\n\n\nexport function getRowsInMapExtent(layerId, storageService): boolean {\n  return storageService.get(`workspace.rowsInMapExtent.${layerId}`) as boolean || true;\n}\n\nexport function setRowsInMapExtent(value, layerId, storageService) {\n  storageService.set(`workspace.rowsInMapExtent.${layerId}`, value, StorageScope.SESSION);\n}\n\nexport function getSelectedOnly(layerId, storageService): boolean {\n  return storageService.get(`workspace.selectedOnly.${layerId}`) as boolean || false;\n}\n\nexport function setSelectedOnly(value, layerId, storageService) {\n  storageService.set(`workspace.selectedOnly.${layerId}`, value, StorageScope.SESSION);\n}\n\nexport function mapExtentStrategyActiveToolTip(ws: WfsWorkspace | FeatureWorkspace): Observable<string> {\n  return ws.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy).active$.pipe(\n    map((active: boolean) => active ? 'igo.geo.workspace.inMapExtent.active.tooltip' : 'igo.geo.workspace.inMapExtent.inactive.tooltip')\n  );\n}\n\nexport function noElementSelected(ws: WfsWorkspace | FeatureWorkspace): Observable<boolean> {\n  return ws.entityStore.stateView.manyBy$((record: EntityRecord<Feature>) => {\n    return record.state.selected === true;\n  }).pipe(\n    map((entities: EntityRecord<Feature>[]) => entities.length >= 1)\n  );\n}\n\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/simple-map\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\"\n  igoPointerPosition\n  [pointerPositionDelay]=\"pointerCoordDelay\"\n  (pointerPositionCoord)=\"onPointerMove($event)\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"true\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n</mat-card>\n\n<p *ngIf=\"!isTouchScreen\">{{pointerCoord}}</p>","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppSimpleMapComponent } from './simple-map.component';\n\nconst routes: Routes = [\n  {\n    path: 'simple-map',\n    component: AppSimpleMapComponent\n  }\n];\n\nexport const AppSimpleMapRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService, MediaService } from '@igo2/core';\nimport { IgoMap, DataSourceService, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-simple-map',\n  templateUrl: './simple-map.component.html',\n  styleUrls: ['./simple-map.component.scss']\n})\nexport class AppSimpleMapComponent {\n  public pointerCoord;\n  public pointerCoordDelay: number = 0;\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6,\n    rotation: 0.75\n  };\n\n  get media() {\n    return this.mediaService.getMedia();\n  }\n\n  get isTouchScreen() {\n    return this.mediaService.isTouchScreen();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mediaService: MediaService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n\n  onPointerMove(event) {\n    this.pointerCoord = event;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule } from '@igo2/geo';\n\nimport { AppSimpleMapComponent } from './simple-map.component';\nimport { AppSimpleMapRoutingModule } from './simple-map-routing.module';\nimport { CommonModule } from '@angular/common';\n\n@NgModule({\n  declarations: [AppSimpleMapComponent],\n  imports: [\n    CommonModule,\n    AppSimpleMapRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMapModule\n  ],\n  exports: [AppSimpleMapComponent]\n})\nexport class AppSimpleMapModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/layer\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Layers\">\n    <igo-layer-list\n    [map]=\"map\"\n    [layers]=\"map.layers\"\n    [expandLegendOfVisibleLayers]=\"false\"\n    floatLabel=\"never\"\n    [queryBadge]=\"true\">\n\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n        <igo-download-button [layer]=\"layer\"></igo-download-button>\n        <igo-ogc-filter-button [header]=\"true\" [layer]=\"layer\"></igo-ogc-filter-button>\n        <igo-time-filter-button [header]=\"true\" [layer]=\"layer\"></igo-time-filter-button>\n        <igo-track-feature-button [layer]=\"layer\" [trackFeature]=\"true\"></igo-track-feature-button>\n      </ng-template>\n\n    </igo-layer-list>\n  </igo-panel>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppLayerComponent } from './layer.component';\n\nconst routes: Routes = [\n  {\n    path: 'layer',\n    component: AppLayerComponent\n  }\n];\n\nexport const AppLayerRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WMSDataSourceOptions,\n  LayerOptions,\n  WFSDataSourceOptions,\n  OgcFilterableDataSourceOptions,\n  MetadataLayerOptions\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-layer',\n  templateUrl: './layer.component.html',\n  styleUrls: ['./layer.component.scss']\n})\nexport class AppLayerComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    maxLayerZoomExtent: [-11000000, 4500000, -4500000, 10000000],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            visible: true,\n            baseLayer: true,\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const wfsDatasource: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '10043'\n        }\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasource)\n      .subscribe(dataSource => {\n        const layer: LayerOptions = {\n          title: 'WFS ',\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    const wfsDatasourceCustomEPSG: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: 'geojson_utf8',\n        srsName: 'EPSG:32198',\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '12072'\n        }\n      },\n      formatOptions: {\n        dataProjection: 'EPSG:32198'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourceCustomEPSG)\n      .subscribe(dataSource => {\n        const layer: LayerOptions = {\n          title: 'WFS (Custom EPSG)',\n          visible: true,\n          source: dataSource,\n          removable: false\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'parc_routier',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Réseau routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'lieu habité',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'lieuhabite',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'sh_dis_eco',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'sh_dis_eco',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'nurc:Arc_Sample_Parent',\n        visible: false,\n        legendOptions: {\n          // collapsed: false,\n          display: true,\n          // url: 'https://v.seloger.com/s/width/1144/visuels/0/m/l/4/0ml42xbt1n3itaboek3qec5dtskdgw6nlscu7j69k.jpg',\n          stylesAvailable: [\n            { name: 'rain', title: 'Pluie' },\n            { name: 'raster', title: 'Défaut' }\n          ] //\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://demo.geo-solutions.it/geoserver/ows',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'nurc:Arc_Sample', // , test:Linea_costa\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Avertissements routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'evenements',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    const datasource: WMSDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      refreshIntervalSec: 15,\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      }\n    };\n\n    interface LayerOptionsWithMetadata\n      extends LayerOptions,\n        MetadataLayerOptions {}\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe(dataSource => {\n        const layer: LayerOptionsWithMetadata = {\n          title: 'Embâcle',\n          source: dataSource,\n          metadata: {\n            url:\n              'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\n            extern: true\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoFilterModule,\n  IgoMetadataModule,\n  IgoDownloadModule\n} from '@igo2/geo';\n\nimport { AppLayerComponent } from './layer.component';\nimport { AppLayerRoutingModule } from './layer-routing.module';\n\n@NgModule({\n  declarations: [AppLayerComponent],\n  imports: [\n    AppLayerRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoFilterModule,\n    IgoMetadataModule,\n    IgoDownloadModule\n  ],\n  exports: [AppLayerComponent]\n})\nexport class AppLayerModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppLegendComponent } from './legend.component';\n\nconst routes: Routes = [\n  {\n    path: 'legend',\n    component: AppLegendComponent\n  }\n];\n\nexport const AppLegendRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WMSDataSourceOptions,\n  LayerOptions,\n  WFSDataSourceOptions,\n  OgcFilterableDataSourceOptions,\n  MetadataLayerOptions\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-legend',\n  templateUrl: './legend.component.html',\n  styleUrls: ['./legend.component.scss']\n})\nexport class AppLegendComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            visible: true,\n            baseLayer: true,\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const wfsDatasource: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '10043'\n        }\n      }\n    };\n\n    this.layerService\n    .createAsyncLayer({\n      title: 'legend with display:false',\n      visible: true,\n      legendOptions: {\n        display: false,\n        html: 'test html'\n      },\n      sourceOptions: {\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n        optionsFromCapabilities: true,\n        params: {\n          LAYERS: 'sh_dis_eco',\n          VERSION: '1.3.0'\n        }\n      }\n    })\n    .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n    .createAsyncLayer({\n      title: 'legend in html',\n      visible: true,\n      legendOptions: {\n        display: true,\n        html: '<h2>HTML légende</h2>'\n      },\n      sourceOptions: {\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n        optionsFromCapabilities: true,\n        params: {\n          LAYERS: 'sh_sreg_eco',\n          VERSION: '1.3.0'\n        }\n      }\n    })\n    .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n    .createAsyncLayer({\n      title: 'legend with url param',\n      visible: true,\n      legendOptions: {\n        url: `data:image/jpeg;base64,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`\n\n      },\n      sourceOptions: {\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n        optionsFromCapabilities: true,\n        params: {\n          LAYERS: 'sh_reg_eco',\n          VERSION: '1.3.0'\n        }\n      }\n    })\n    .subscribe(l => this.map.addLayer(l));\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasource)\n      .subscribe(dataSource => {\n        const layer: LayerOptions = {\n          title: 'WFS ',\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'MELS_CS_ANGLO_S',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Réseau routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'lieu habité',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'lieuhabite',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: '2 styles nurc:Arc_Sample_Parent',\n        visible: true,\n        legendOptions: {\n          // collapsed: false,\n          display: true,\n          // url: 'https://v.seloger.com/s/width/1144/visuels/0/m/l/4/0ml42xbt1n3itaboek3qec5dtskdgw6nlscu7j69k.jpg',\n          stylesAvailable: [\n            { name: 'rain', title: 'Pluie' },\n            { name: 'raster', title: 'Défaut' }\n          ] //\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://demo.geo-solutions.it/geoserver/ows',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'nurc:Arc_Sample', // , test:Linea_costa\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Avertissements routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'evenements',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    const datasource: WMSDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      refreshIntervalSec: 15,\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      }\n    };\n\n    interface LayerOptionsWithMetadata\n      extends LayerOptions,\n        MetadataLayerOptions {}\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe(dataSource => {\n        const layer: LayerOptionsWithMetadata = {\n          title: 'Embâcle',\n          visible: true,\n          source: dataSource,\n          metadata: {\n            url:\n              'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\n            extern: true\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map with a legend list</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/layer\">code of this\n      example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Legends\">\n    <igo-layer-legend-list [layers]=\"map.layers\"\n    [excludeBaseLayers]=\"true\"\n    [allowShowAllLegends]=\"true\"\n    [updateLegendOnResolutionChange]=\"false\"\n    [showAllLegendsValue]=\"false\">\n  </igo-layer-legend-list>\n\n  </igo-panel>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoFilterModule,\n  IgoMetadataModule,\n  IgoDownloadModule\n} from '@igo2/geo';\n\nimport { AppLegendComponent } from './legend.component';\nimport { AppLegendRoutingModule } from './legend-routing.module';\n\n@NgModule({\n  declarations: [AppLegendComponent],\n  imports: [\n    AppLegendRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoFilterModule,\n    IgoMetadataModule,\n    IgoDownloadModule\n  ],\n  exports: [AppLegendComponent]\n})\nexport class AppLegendModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppOverlayComponent } from './overlay.component';\n\nconst routes: Routes = [\n  {\n    path: 'overlay',\n    component: AppOverlayComponent\n  }\n];\n\nexport const AppOverlayRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, AfterViewInit } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  FEATURE,\n  Feature,\n  FeatureMotion\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-overlay',\n  templateUrl: './overlay.component.html',\n  styleUrls: ['./overlay.component.scss']\n})\nexport class AppOverlayComponent implements OnInit, AfterViewInit {\n  public map = new IgoMap({\n    overlay: true,\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit() {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n\n  ngAfterViewInit() {\n    const feature1: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 1\n      },\n      properties: {},\n      geometry: {\n        type: 'Point',\n        coordinates: [-73, 46.6]\n      }\n    };\n\n    const feature2: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 2\n      },\n      properties: {},\n      geometry: {\n        type: 'LineString',\n        coordinates: [[-72, 47.8], [-73.5, 47.4], [-72.4, 48.6]]\n      }\n    };\n\n    const feature3: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 3\n      },\n      properties: {},\n      geometry: {\n        type: 'Polygon',\n        coordinates: [[[-71, 46.8], [-73, 47], [-71.2, 46.6]]]\n      }\n    };\n\n    this.map.overlay.setFeatures(\n      [feature1, feature2, feature3],\n      FeatureMotion.None\n    );\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Overlay</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/overlay\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule, IgoOverlayModule } from '@igo2/geo';\n\nimport { AppOverlayComponent } from './overlay.component';\nimport { AppOverlayRoutingModule } from './overlay-routing.module';\n\n@NgModule({\n  declarations: [AppOverlayComponent],\n  imports: [\n    AppOverlayRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMapModule,\n    IgoOverlayModule\n  ],\n  exports: [AppOverlayComponent]\n})\nexport class AppOverlayModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Geometry Form</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/form\">code of this example</a>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-form\n    *ngIf=\"form$ | async as form\"\n    [form]=\"form\"\n    [formData]=\"data$ | async\"\n    (submitForm)=\"onSubmit($event)\">\n\n    <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n    <div formButtons>\n      <button\n        mat-stroked-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"fillForm()\">\n        Fill Form\n      </button>\n      <button\n        mat-stroked-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"clearForm()\">\n        Clear Form\n      </button>\n      <button\n        mat-flat-button\n        type=\"submit\"\n        color=\"primary\"\n        [disabled]=\"submitDisabled\">\n        Submit\n      </button>\n    </div>\n  </igo-form>\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppGeometryComponent } from './geometry.component';\n\nconst routes: Routes = [\n  {\n    path: 'geometry',\n    component: AppGeometryComponent\n  }\n];\n\nexport const AppGeometryRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport * as olstyle from 'ol/style';\n\nimport { LanguageService } from '@igo2/core';\nimport { Form, FormService } from '@igo2/common';\nimport { IgoMap, DataSourceService, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-geometry',\n  templateUrl: './geometry.component.html',\n  styleUrls: ['./geometry.component.scss']\n})\nexport class AppGeometryComponent implements OnInit, OnDestroy {\n\n  map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  view = {\n    center: [-73, 47.2],\n    zoom: 15\n  };\n\n  form$ = new BehaviorSubject<Form>(undefined);\n\n  data$ = new BehaviorSubject<{[key: string]: any}>(undefined);\n\n  submitDisabled = true;\n\n  private valueChanges$$: Subscription;\n\n  constructor(\n    private languageService: LanguageService,\n    private formService: FormService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit() {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    const fieldConfigs = [\n      {\n        name: 'geometry',\n        title: 'Geometry',\n        options:  {\n          validator: Validators.required\n        },\n        type: 'geometry',\n        inputs: {\n          map: this.map,\n          geometryTypeField: true,\n          geometryType: 'Polygon',\n          drawGuideField: true,\n          drawGuide: 50,\n          drawGuidePlaceholder: 'Draw Guide',\n          drawStyle: new olstyle.Style({\n            stroke: new olstyle.Stroke({\n              color: [255, 0, 0, 1],\n              width: 2\n            }),\n            fill:  new olstyle.Fill({\n              color: [255, 0, 0, 0.2]\n            }),\n            image: new olstyle.Circle({\n              radius: 8,\n              stroke: new olstyle.Stroke({\n                color: [255, 0, 0, 1]\n              }),\n              fill: new olstyle.Fill({\n                color: [255, 0, 0, 0.2]\n              })\n            })\n          })\n        }\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        options:  {\n          validator: Validators.required\n        }\n      }\n    ];\n\n    const fields = fieldConfigs.map((config) => this.formService.field(config));\n    const form = this.formService.form([], [this.formService.group({name: 'info'}, fields)]);\n\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\n      this.submitDisabled = !form.control.valid;\n    });\n\n    this.form$.next(form);\n  }\n\n  ngOnDestroy() {\n    this.valueChanges$$.unsubscribe();\n  }\n\n  fillForm() {\n    this.data$.next({\n      name: 'Place',\n      geometry: JSON.stringify({type: 'Polygon', coordinates: [[\n        [-106, 42],\n        [-107, 31],\n        [-81, 32],\n        [-82, 42],\n        [-106, 42]\n      ]]})\n    });\n  }\n\n  clearForm() {\n    this.form$.value.control.reset();\n  }\n\n  onSubmit(data: {[key: string]: any}) {\n    alert(JSON.stringify(data));\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoFormModule } from '@igo2/common';\nimport { IgoGeometryModule, IgoMapModule } from '@igo2/geo';\n\nimport { AppGeometryComponent } from './geometry.component';\nimport { AppGeometryRoutingModule } from './geometry-routing.module';\n\n@NgModule({\n  declarations: [AppGeometryComponent],\n  imports: [\n    CommonModule,\n    AppGeometryRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoFormModule,\n    IgoGeometryModule,\n    IgoMapModule\n  ],\n  exports: [AppGeometryComponent]\n})\nexport class AppGeometryModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppFeatureComponent } from './feature.component';\n\nconst routes: Routes = [\n  {\n    path: 'feature',\n    component: AppFeatureComponent\n  }\n];\n\nexport const AppFeatureRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  VectorLayer,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureMotion\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-feature',\n  templateUrl: './feature.component.html',\n  styleUrls: ['./feature.component.scss']\n})\nexport class AppFeatureComponent implements OnInit, OnDestroy {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  public tableTemplate = {\n    selection: true,\n    selectMany: true,\n    sort: true,\n    columns: [\n      {\n        name: 'properties.id',\n        title: 'ID'\n      },\n      {\n        name: 'properties.name',\n        title: 'Name'\n      },\n      {\n        name: 'properties.description',\n        title: 'Description'\n      }\n    ]\n  };\n\n  public store = new FeatureStore([], { map: this.map });\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit() {\n    const loadingStrategy = new FeatureStoreLoadingStrategy({});\n    this.store.addStrategy(loadingStrategy);\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      map: this.map,\n      motion: FeatureMotion.Default\n    });\n    this.store.addStrategy(selectionStrategy);\n\n    this.store.load([\n      {\n        meta: { id: 1 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-72, 47.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 1,\n          name: 'Name 1',\n          description: 'Description 1'\n        }\n      },\n      {\n        meta: { id: 2 },\n        type: 'Feature',\n        geometry: {\n          type: 'LineString',\n          coordinates: [[-72, 47.8], [-73.5, 47.4], [-72.4, 48.6]]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 2,\n          name: 'Name 2',\n          description: 'Description 2'\n        }\n      },\n      {\n        meta: { id: 3 },\n        type: 'Feature',\n        geometry: {\n          type: 'Polygon',\n          coordinates: [[[-71, 46.8], [-73, 47], [-71.2, 46.6]]]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 3,\n          name: 'Name 3',\n          description: 'Description 3'\n        }\n      }\n    ]);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'MVT test',\n        visible: true,\n        sourceOptions: {\n          type: 'mvt',\n          url:\n            'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\n          queryable: true\n        },\n        mapboxStyle: {\n          url: 'assets/mapboxStyleExample-vectortile.json',\n          source: 'ahocevar'\n        }\n      } as any)\n      .subscribe(l => this.map.addLayer(l));\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector'\n      })\n      .subscribe(dataSource => {\n        const layer = this.layerService.createLayer({\n          title: 'Vector Layer',\n          source: dataSource,\n          animation: {\n            duration: 2000\n          },\n          mapboxStyle: {\n            url: 'assets/mapboxStyleExample-feature.json',\n            source: 'source_nameX'\n          }\n        }) as VectorLayer;\n        this.map.addLayer(layer);\n        this.store.bindLayer(layer);\n        loadingStrategy.activate();\n        selectionStrategy.activate();\n      });\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Feature</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geom/feature\">code of this example</a>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-entity-table\n    [store]=\"store\"\n    [template]=\"tableTemplate\">\n  </igo-entity-table>\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule, IgoEntityTableModule } from '@igo2/common';\nimport { IgoMapModule, IgoFeatureModule } from '@igo2/geo';\n\nimport { AppFeatureComponent } from './feature.component';\nimport { AppFeatureRoutingModule } from './feature-routing.module';\n\n@NgModule({\n  declarations: [AppFeatureComponent],\n  imports: [\n    AppFeatureRoutingModule,\n    CommonModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoEntityTableModule,\n    IgoMapModule,\n    IgoFeatureModule\n  ],\n  exports: [AppFeatureComponent]\n})\nexport class AppFeatureModule {}\n","import { Routes, RouterModule } from '@angular/router';\nimport { AppHoverComponent } from './hover.component';\n\nconst routes: Routes = [\n  {\n    path: 'hover',\n    component: AppHoverComponent\n  }\n];\n\nexport const AppHoverRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService, MediaService } from '@igo2/core';\nimport { IgoMap, DataSourceService, LayerService, WFSDataSourceOptions, VectorLayerOptions, WFSDataSource } from '@igo2/geo';\n\n@Component({\n  selector: 'app-hover',\n  templateUrl: './hover.component.html',\n  styleUrls: ['./hover.component.scss']\n})\nexport class AppHoverComponent {\n  public selected;\n  public pointerCoord;\n  public pointerCoordDelay: number = 0;\n  public pointerHoverFeatureDelay: number = 0;\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 8,\n    projection: 'EPSG:3857'\n  };\n\n\n  get media() {\n    return this.mediaService.getMedia();\n  }\n\n  get isTouchScreen() {\n    return this.mediaService.isTouchScreen();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mediaService: MediaService\n  ) {\n\n    this.dataSourceService\n    .createAsyncDataSource({\n      type: 'wmts',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts',\n      layer: 'carte_gouv_qc_public',\n      matrixSet: 'EPSG_3857',\n      version: '1.3.0'\n    })\n    .subscribe(dataSource => {\n      this.map.addLayer(\n        this.layerService.createLayer({\n          title: 'Quebec',\n          visible: true,\n          baseLayer: true,\n          source: dataSource\n        })\n      );\n    });\n\n    interface WFSDataOptions\n      extends WFSDataSourceOptions {}\n\n    const wfsDatasourcePolygon: WFSDataOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'adn_bassin_n1_public_v',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '3.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourcePolygon)\n      .subscribe((dataSource: WFSDataSource) => {\n        const layer: VectorLayerOptions = {\n          title: 'WFS (polygon)',\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    const wfsDatasourcePoint: WFSDataOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'CASERNE',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourcePoint)\n      .subscribe((dataSource: WFSDataSource) => {\n        const layer: VectorLayerOptions = {\n          title: 'WFS (point)',\n          visible: true,\n          source: dataSource,\n          styleByAttribute: {\n            attribute: 'en_caserne',\n            data: ['true', 'false'],\n            stroke: ['red', 'blue'],\n            fill: ['#ffffff', '#ffffff'],\n            radius: [7, 7],\n            width: [2, 2],\n            hoverStyle: {\n                label: {\n                  attribute: 'Caserne: ${nom_service_incendie} \\n Mun: ${ville}',\n                  style: {\n                    textAlign: 'left',\n                    textBaseline: 'bottom',\n                    font: '12px Calibri,sans-serif',\n                    fill: { color: '#000' },\n                    backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\n                    backgroundStroke: { color: 'rgba(200, 200, 200, 0.75)', width: 2 },\n                    stroke: { color: '#fff', width: 3 },\n                    overflow: true,\n                    offsetX: 10,\n                    offsetY: -10,\n                    padding: [2.5, 2.5, 2.5, 2.5]\n                  }\n                },\n                baseStyle: {\n                  circle: {\n                    stroke: {\n                      color: 'orange',\n                      width: 5\n                    },\n                    width: [5],\n                    radius: 15\n                  }\n                }\n            }\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Hover</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/hover\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\"\n  igoHoverFeature\n  [igoHoverFeatureDelay]=\"pointerHoverFeatureDelay\"\n  [igoHoverFeatureEnabled]=\"true\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"true\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule } from '@igo2/geo';\n\nimport { AppHoverComponent } from './hover.component';\nimport { AppHoverRoutingModule } from './hover-routing.module';\nimport { CommonModule } from '@angular/common';\n\n@NgModule({\n  declarations: [AppHoverComponent],\n  imports: [\n    CommonModule,\n    AppHoverRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMapModule\n  ],\n  exports: [AppHoverComponent]\n})\nexport class AppHoverModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppMeasureComponent } from './measure.component';\n\nconst routes: Routes = [\n  {\n    path: 'measure',\n    component: AppMeasureComponent\n  }\n];\n\nexport const AppMeasureRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  FeatureStore,\n  FeatureWithMeasure\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-measure',\n  templateUrl: './measure.component.html',\n  styleUrls: ['./measure.component.scss']\n})\nexport class AppMeasureComponent {\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6,\n    projection: 'EPSG:3857'\n  };\n\n  public store = new FeatureStore<FeatureWithMeasure>([], {map: this.map});\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/measure\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-measurer [store]=\"store\" [map]=\"map\"></igo-measurer>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule, IgoMeasureModule } from '@igo2/geo';\n\nimport { AppMeasureComponent } from './measure.component';\nimport { AppMeasureRoutingModule } from './measure-routing.module';\n\n@NgModule({\n  declarations: [AppMeasureComponent],\n  imports: [\n    AppMeasureRoutingModule,\n    MatCardModule,\n    IgoMapModule,\n    IgoMeasureModule\n  ],\n  exports: [AppMeasureComponent]\n})\nexport class AppMeasureModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppDrawComponent } from './draw.component';\n\nconst routes: Routes = [\n  {\n    path: 'draw',\n    component: AppDrawComponent\n  }\n];\n\nexport const AppDrawRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  FeatureStore,\n  FeatureWithDraw\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-draw',\n  templateUrl: './draw.component.html',\n  styleUrls: ['./draw.component.scss']\n})\nexport class AppDrawComponent {\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6,\n    projection: 'EPSG:3857'\n  };\n\n  public store = new FeatureStore<FeatureWithDraw>([], {map: this.map});\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/draw\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-draw [store]=\"store\" [map]=\"map\"></igo-draw>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule, IgoDrawModule } from '@igo2/geo';\n\nimport { AppDrawComponent } from './draw.component';\nimport { AppDrawRoutingModule } from './draw-routing.module';\n\n@NgModule({\n  declarations: [AppDrawComponent],\n  imports: [\n    AppDrawRoutingModule,\n    MatCardModule,\n    IgoMapModule,\n    IgoDrawModule\n  ],\n  exports: [AppDrawComponent]\n})\nexport class AppDrawModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Query</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/query\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser\n    [map]=\"map\"\n    [view]=\"view\"\n    igoOverlay\n    igoQuery\n    [queryFeatures]=\"true\"\n    (query)=\"handleQueryResults($event)\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Details\">\n    <ng-container *ngIf=\"feature$ | async as feature\">\n      <h1>Query Title : <span style=\"background-color: #e0e0e0;\">{{getTitle(feature)}}</span></h1>\n      <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n    </ng-container>\n  </igo-panel>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppQueryComponent } from './query.component';\n\nconst routes: Routes = [\n  {\n    path: 'query',\n    component: AppQueryComponent\n  }\n];\n\nexport const AppQueryRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport olFeature from 'ol/Feature';\nimport olPoint from 'ol/geom/Point';\nimport olPolygon from 'ol/geom/Polygon';\nimport olLineString from 'ol/geom/LineString';\nimport * as olproj from 'ol/proj';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  FeatureDataSource,\n  DataSourceService,\n  LayerService,\n  OverlayService,\n  Feature,\n  QueryableDataSourceOptions,\n  QueryFormat,\n  QueryHtmlTarget,\n  SearchResult,\n  FeatureMotion\n} from '@igo2/geo';\n\nimport { getEntityTitle } from '@igo2/common';\n\n@Component({\n  selector: 'app-query',\n  templateUrl: './query.component.html',\n  styleUrls: ['./query.component.scss']\n})\nexport class AppQueryComponent {\n  public feature$ = new BehaviorSubject<Feature>(undefined);\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private overlayService: OverlayService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n        queryable: true,\n        queryTitle: 'num_rts',\n        params: {\n          layers: 'bgr_v_sous_route_res_sup_act',\n          version: '1.3.0'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n        queryable: true,\n        queryFormat: QueryFormat.HTMLGML2,\n        queryHtmlTarget: QueryHtmlTarget.IFRAME,\n        params: {\n          layers: 'bgr_v_sous_route_res_sup_act',\n          version: '1.3.0'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS html with a pre call in GML',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector',\n        queryable: true,\n        queryTitle: 'So beautiful ${name}',\n        sourceFields: [\n          { name: 'name', alias: 'Alias name' },\n          { name: 'description', alias: 'Alias description' }\n        ]\n      } as QueryableDataSourceOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Vector Layer',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n        this.addFeatures(dataSource as FeatureDataSource);\n      });\n  }\n\n  addFeatures(dataSource: FeatureDataSource) {\n    const feature1 = new olFeature({\n      name: 'feature1',\n      geometry: new olLineString([\n        olproj.transform([-72, 47.8], 'EPSG:4326', 'EPSG:3857'),\n        olproj.transform([-73.5, 47.4], 'EPSG:4326', 'EPSG:3857'),\n        olproj.transform([-72.4, 48.6], 'EPSG:4326', 'EPSG:3857')\n      ]),\n    });\n\n    const feature2 = new olFeature({\n      name: 'feature2',\n      geometry: new olPoint(\n        olproj.transform([-73, 46.6], 'EPSG:4326', 'EPSG:3857')\n      ),\n    });\n\n    const feature3 = new olFeature({\n      name: 'feature3',\n      geometry: new olPolygon([\n        [\n          olproj.transform([-71, 46.8], 'EPSG:4326', 'EPSG:3857'),\n          olproj.transform([-73, 47], 'EPSG:4326', 'EPSG:3857'),\n          olproj.transform([-71.2, 46.6], 'EPSG:4326', 'EPSG:3857')\n        ]\n      ]),\n    });\n\n    dataSource.ol.addFeatures([feature1, feature2, feature3]);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Vector tile with custom getfeatureinfo url',\n        visible: true,\n        sourceOptions: {\n          type: 'mvt',\n          url:\n            'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\n          queryable: true,\n          queryUrl: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=SDA_REGION_S_20K&LAYERS=SDA_REGION_S_20K&DPI=96&MAP_RESOLUTION=96&FORMAT_OPTIONS=dpi%3A96&INFO_FORMAT=geojson&FEATURE_COUNT=5&I=50&J=50&CRS=EPSG:{srid}&STYLES=&WIDTH=101&HEIGHT=101&BBOX={xmin},{ymin},{xmax},{ymax}',\n          queryFeature: false,\n          queryFormat: 'geojson'\n        },\n        mapboxStyle: {\n          url: 'assets/mapboxStyleExample-vectortile.json',\n          source: 'ahocevar'\n        }\n      } as any)\n      .subscribe(l => this.map.addLayer(l));\n\n\n      this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/incendie.fcgi',\n        queryable: true,\n        queryUrl: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=SDA_MUNIC_S_20K&LAYERS=SDA_MUNIC_S_20K&DPI=96&MAP_RESOLUTION=96&FORMAT_OPTIONS=dpi%3A96&INFO_FORMAT=geojson&FEATURE_COUNT=5&I=50&J=50&CRS=EPSG:{srid}&STYLES=&WIDTH=101&HEIGHT=101&BBOX={xmin},{ymin},{xmax},{ymax}',\n        queryFormat: 'geojson',\n        params: {\n          layers: 'caserne',\n          version: '1.3.0'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS with custom getfeatureinfo url',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n      });\n\n  }\n\n  handleQueryResults(results) {\n    const features: Feature[] = results.features;\n    let feature: Feature;\n    if (features.length && features[0]) {\n      feature = features[0];\n      this.feature$.next(feature);\n      this.map.queryResultsOverlay.setFeatures([feature], FeatureMotion.None);\n    }\n\n  }\n\n  getTitle(result: SearchResult) {\n    return getEntityTitle(result);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoOverlayModule,\n  IgoQueryModule,\n  IgoFeatureModule\n} from '@igo2/geo';\n\nimport { AppQueryComponent } from './query.component';\nimport { AppQueryRoutingModule } from './query-routing.module';\n\n@NgModule({\n  declarations: [AppQueryComponent],\n  imports: [\n    AppQueryRoutingModule,\n    CommonModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoOverlayModule,\n    IgoQueryModule,\n    IgoFeatureModule\n  ],\n  exports: [AppQueryComponent]\n})\nexport class AppQueryModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppCatalogComponent } from './catalog.component';\n\nconst routes: Routes = [\n  {\n    path: 'catalog',\n    component: AppCatalogComponent\n  }\n];\n\nexport const AppCatalogRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit } from '@angular/core';\n\nimport { LanguageService, ConfigService, StorageService } from '@igo2/core';\nimport { IgoMap, LayerService, Catalog, CatalogItem, CatalogService } from '@igo2/geo';\nimport { EntityStore } from '@igo2/common';\n\n@Component({\n  selector: 'app-catalog',\n  templateUrl: './catalog.component.html',\n  styleUrls: ['./catalog.component.scss']\n})\nexport class AppCatalogComponent implements OnInit {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  public catalogStore = new EntityStore<Catalog>([]);\n\n  public catalogItemStore = new EntityStore<CatalogItem>([]);\n\n  constructor(\n    private configService: ConfigService,\n    private languageService: LanguageService,\n    private layerService: LayerService,\n    private catalogService: CatalogService,\n    private storageService: StorageService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe(layer => this.map.addLayer(layer));\n\n    this.loadCatalogs();\n  }\n\n  /**\n   * When the selected catalog changes, toggle the the CatalogBrowser tool.\n   * @internal\n   * @param event Select event\n   */\n  onCatalogSelectChange(event: {selected: boolean; catalog: Catalog}) {\n    this.loadCatalogItems(event.catalog);\n  }\n\n  /**\n   * Get all the available catalogs from the CatalogService and\n   * load them into the store.\n   */\n  private loadCatalogs() {\n    this.catalogService.loadCatalogs()\n      .subscribe((catalogs: Catalog[]) => {\n        this.catalogStore.clear();\n        this.catalogStore.load(catalogs.concat((this.storageService.get('addedCatalogs') || []) as Catalog[]));\n      });\n  }\n\n  /**\n   * Get the selected catalog's items from the CatalogService and\n   * load them into the store.\n   * @param catalog Selected catalog\n   */\n  private loadCatalogItems(catalog: Catalog) {\n    this.catalogService.loadCatalogItems(catalog)\n      .subscribe((items: CatalogItem[]) => {\n        this.catalogItemStore.clear();\n        this.catalogItemStore.load(items);\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Catalog</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: ConfigService, LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/catalog\">code of this example</a><br>\n    See catalog section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Catalog Library\">\n    <igo-catalog-library\n      [store]=\"catalogStore\"\n      (catalogSelectChange)=\"onCatalogSelectChange($event)\">\n    </igo-catalog-library>\n  </igo-panel>\n\n  <igo-panel title=\"Catalog Browser\">\n    <igo-catalog-browser\n      [store]=\"catalogItemStore\"\n      [map]=\"map\">\n    </igo-catalog-browser>\n  </igo-panel>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoConfigModule, provideConfigOptions } from '@igo2/core';\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoCatalogModule } from '@igo2/geo';\n\nimport { environment } from '../../../environments/environment';\nimport { AppCatalogComponent } from './catalog.component';\nimport { AppCatalogRoutingModule } from './catalog-routing.module';\n\n@NgModule({\n  declarations: [AppCatalogComponent],\n  imports: [\n    CommonModule,\n    AppCatalogRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    IgoConfigModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoCatalogModule\n  ],\n  exports: [AppCatalogComponent],\n  providers: [\n    provideConfigOptions({\n      default: environment.igo\n    })\n  ]\n})\nexport class AppCatalogModule {}\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid context');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n      super('Failed to read file');\n      Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n      super('Nothing to import');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n      super('File is too large');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n      super('Invalid SRS definition');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n","export enum TypePermission {\n  null,\n  read,\n  write\n}\n\nexport enum Scope {\n  public,\n  protected,\n  private\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\n\nimport { BehaviorSubject, Observable, of, Subject } from 'rxjs';\nimport {\n  map,\n  tap,\n  catchError,\n  debounceTime,\n  mergeMap,\n  first,\n  skip\n} from 'rxjs/operators';\n\nimport olPoint from 'ol/geom/Point';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport Cluster from 'ol/source/Cluster';\nimport olVectorSource from 'ol/source/Vector';\n\nimport { Tool } from '@igo2/common';\nimport { uuid, ObjectUtils } from '@igo2/utils';\nimport {\n  ConfigService,\n  RouteService,\n  Message,\n  MessageService,\n  Notification,\n  LanguageService\n} from '@igo2/core';\n\nimport { AuthService } from '@igo2/auth';\nimport type { IgoMap, Layer } from '@igo2/geo';\n\nimport { TypePermission } from './context.enum';\nimport {\n  ContextsList,\n  ContextServiceOptions,\n  Context,\n  DetailedContext,\n  ContextMapView,\n  ContextPermission,\n  ContextProfils\n} from './context.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextService {\n  public context$ = new BehaviorSubject<DetailedContext>(undefined);\n  public contexts$ = new BehaviorSubject<ContextsList>({ ours: [] });\n  public defaultContextId$ = new BehaviorSubject<string>(undefined);\n  public editedContext$ = new BehaviorSubject<DetailedContext>(undefined);\n  public importedContext: Array<DetailedContext> = [];\n  public toolsChanged$ = new Subject<DetailedContext>();\n  private mapViewFromRoute: ContextMapView = {};\n  private options: ContextServiceOptions;\n  private baseUrl: string;\n  private contextMessage: Notification;\n\n  // Until the ContextService is completely refactored, this is needed\n  // to track the current tools\n  private tools: Tool[];\n  private toolbar: string[];\n\n  get defaultContextUri(): string {\n    return this._defaultContextUri || this.options.defaultContextUri;\n  }\n  set defaultContextUri(uri: string) {\n    this._defaultContextUri = uri;\n  }\n  private _defaultContextUri: string;\n\n  constructor(\n    private http: HttpClient,\n    private authService: AuthService,\n    private languageService: LanguageService,\n    private config: ConfigService,\n    private messageService: MessageService,\n    @Optional() private route: RouteService\n  ) {\n    this.options = Object.assign(\n      {\n        basePath: 'contexts',\n        contextListFile: '_contexts.json',\n        defaultContextUri: '_default'\n      },\n      this.config.getConfig('context')\n    );\n\n    this.baseUrl = this.options.url;\n\n    this.readParamsFromRoute();\n\n    if (this.authService.hasAuthService) {\n      this.authService.logged$.subscribe((logged) => {\n        if (logged) {\n          this.contexts$.pipe(skip(1), first()).subscribe((c) => {\n            this.handleContextsChange();\n          });\n          this.loadContexts();\n        }\n      });\n    } else {\n      this.loadContexts();\n      this.handleContextsChange(false);\n    }\n  }\n\n  get(permissions?: string[], hidden?: boolean): Observable<ContextsList> {\n    let url = this.baseUrl + '/contexts';\n    if (permissions && this.authService.authenticated) {\n      url += '?permission=' + permissions.join();\n      if (hidden) {\n        url += '&hidden=true';\n      }\n    }\n    return this.http.get<ContextsList>(url);\n  }\n\n  getById(id: string): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.get<Context>(url);\n  }\n\n  getDetails(id: string): Observable<DetailedContext> {\n    const url = `${this.baseUrl}/contexts/${id}/details`;\n    return this.http.get<DetailedContext>(url).pipe(\n      catchError((res) => {\n        return this.handleError(res, id);\n      })\n    );\n  }\n\n  getDefault(): Observable<DetailedContext> {\n    const url = this.baseUrl + '/contexts/default';\n    return this.http.get<DetailedContext>(url).pipe(\n      tap((context) => {\n        this.defaultContextId$.next(context.id);\n      })\n    );\n  }\n\n  getProfilByUser(): Observable<ContextProfils[]> {\n    if (this.baseUrl) {\n      const url = this.baseUrl + '/profils?';\n      return this.http.get<ContextProfils[]>(url);\n    }\n    return of([]);\n  }\n\n  setDefault(id: string): Observable<any> {\n    const url = this.baseUrl + '/contexts/default';\n    return this.http.post(url, { defaultContextId: id });\n  }\n\n  hideContext(id: string) {\n    const url = this.baseUrl + '/contexts/' + id + '/hide';\n    return this.http.post(url, {});\n  }\n\n  showContext(id: string) {\n    const url = this.baseUrl + '/contexts/' + id + '/show';\n    return this.http.post(url, {});\n  }\n\n  delete(id: string, imported = false): Observable<void> {\n    const contexts: ContextsList = { ours: [] };\n    Object.keys(this.contexts$.value).forEach(\n      (key) =>\n        (contexts[key] = this.contexts$.value[key].filter((c) => c.id !== id))\n    );\n\n    if (imported) {\n      this.importedContext = this.importedContext.filter((c) => c.id !== id);\n      return of(this.contexts$.next(contexts));\n    }\n\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.delete<void>(url).pipe(\n      tap((res) => {\n        this.contexts$.next(contexts);\n      })\n    );\n  }\n\n  create(context: DetailedContext): Observable<Context> {\n    const url = this.baseUrl + '/contexts';\n    return this.http.post<Context>(url, context).pipe(\n      map((contextCreated) => {\n        if (this.authService.authenticated) {\n          contextCreated.permission = TypePermission[TypePermission.write];\n        } else {\n          contextCreated.permission = TypePermission[TypePermission.read];\n        }\n        this.contexts$.value.ours.unshift(contextCreated);\n        this.contexts$.next(this.contexts$.value);\n        return contextCreated;\n      })\n    );\n  }\n\n  clone(id: string, properties = {}): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id + '/clone';\n    return this.http.post<Context>(url, properties).pipe(\n      map((contextCloned) => {\n        contextCloned.permission = TypePermission[TypePermission.write];\n        this.contexts$.value.ours.unshift(contextCloned);\n        this.contexts$.next(this.contexts$.value);\n        return contextCloned;\n      })\n    );\n  }\n\n  update(id: string, context: Context): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.patch<Context>(url, context);\n  }\n\n  // =================================================================\n\n  addToolAssociation(contextId: string, toolId: string): Observable<void> {\n    const url = `${this.baseUrl}/contexts/${contextId}/tools`;\n    const association = {\n      toolId\n    };\n    return this.http.post<void>(url, association);\n  }\n\n  deleteToolAssociation(contextId: string, toolId: string): Observable<any> {\n    const url = `${this.baseUrl}/contexts/${contextId}/tools/${toolId}`;\n    return this.http.delete(url);\n  }\n\n  getPermissions(id: string): Observable<ContextPermission[]> {\n    const url = this.baseUrl + '/contexts/' + id + '/permissions';\n    return this.http.get<ContextPermission[]>(url);\n  }\n\n  addPermissionAssociation(\n    contextId: string,\n    profil: string,\n    type: TypePermission\n  ): Observable<ContextPermission[] | Message[]> {\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions`;\n    const association = {\n      profil,\n      typePermission: type\n    };\n\n    return this.http.post<ContextPermission[]>(url, association).pipe(\n      catchError((res) => {\n        return [this.handleError(res, undefined, true)];\n      })\n    );\n  }\n\n  deletePermissionAssociation(\n    contextId: string,\n    permissionId: string\n  ): Observable<void> {\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions/${permissionId}`;\n    return this.http.delete<void>(url);\n  }\n\n  // ======================================================================\n\n  getLocalContexts(): Observable<ContextsList> {\n    const url = this.getPath(this.options.contextListFile);\n    return this.http.get<ContextsList>(url).pipe(\n      map((res: any) => {\n        return { ours: res };\n      })\n    );\n  }\n\n  getLocalContext(uri: string): Observable<DetailedContext> {\n    const url = this.getPath(`${uri}.json`);\n    return this.http.get<DetailedContext>(url).pipe(\n      mergeMap((res) => {\n        if (!res.base) {\n          return of(res);\n        }\n        const urlBase = this.getPath(`${res.base}.json`);\n        return this.http.get<DetailedContext>(urlBase).pipe(\n          map((resBase: DetailedContext) => {\n            const resMerge = res;\n            resMerge.map = ObjectUtils.mergeDeep(resBase.map, res.map);\n            resMerge.layers = (resBase.layers || [])\n              .concat(res.layers || [])\n              .reverse()\n              .filter(\n                (l, index, self) =>\n                  !l.id || self.findIndex((l2) => l2.id === l.id) === index\n              )\n              .reverse();\n            resMerge.toolbar = res.toolbar || resBase.toolbar;\n            resMerge.message = res.message || resBase.message;\n            resMerge.messages = res.messages || resBase.messages;\n            resMerge.tools = (res.tools || [])\n              .concat(resBase.tools || [])\n              .filter(\n                (t, index, self) =>\n                  self.findIndex((t2) => t2.name === t.name) === index\n              );\n            return resMerge;\n          }),\n          catchError((err) => {\n            return this.handleError(err, uri);\n          })\n        );\n      }),\n      catchError((err2) => {\n        return this.handleError(err2, uri);\n      })\n    );\n  }\n\n  loadContexts(permissions?: string[], hidden?: boolean) {\n    let request;\n    if (this.baseUrl) {\n      request = this.get(permissions, hidden);\n    } else {\n      request = this.getLocalContexts();\n    }\n    request.subscribe((contexts) => {\n      contexts.ours = this.importedContext.concat(contexts.ours);\n      this.contexts$.next(contexts);\n    });\n  }\n\n  loadDefaultContext() {\n    const loadFct = (direct = false) => {\n      if (!direct && this.baseUrl && this.authService.authenticated) {\n        this.getDefault().subscribe(\n          (_context: DetailedContext) => {\n            this.defaultContextUri = _context.uri;\n            this.addContextToList(_context);\n            this.setContext(_context);\n          },\n          () => {\n            this.defaultContextId$.next(undefined);\n            this.loadContext(this.defaultContextUri);\n          }\n        );\n      } else {\n        this.loadContext(this.defaultContextUri);\n      }\n    };\n\n    if (this.route && this.route.options.contextKey) {\n      this.route.queryParams.pipe(debounceTime(100)).subscribe((params) => {\n        const contextParam = params[this.route.options.contextKey as string];\n        let direct = false;\n        if (contextParam) {\n          this.defaultContextUri = contextParam;\n          direct = true;\n        }\n        loadFct(direct);\n      });\n    } else {\n      loadFct();\n    }\n  }\n\n  loadContext(uri: string) {\n    const context = this.context$.value;\n\n    if (context && context.uri === uri) {\n      return;\n    }\n\n    this.getContextByUri(uri)\n      .pipe(first())\n      .subscribe(\n        (_context: DetailedContext) => {\n          this.addContextToList(_context);\n          this.setContext(_context);\n        },\n        (err) => {\n          if (uri !== this.options.defaultContextUri) {\n            this.loadContext(this.options.defaultContextUri);\n          }\n        }\n      );\n  }\n\n  setContext(context: DetailedContext) {\n    this.handleContextMessage(context);\n    const currentContext = this.context$.value;\n    if (currentContext && context && context.id === currentContext.id) {\n      if (context.map.view.keepCurrentView === undefined) {\n        context.map.view.keepCurrentView = true;\n      }\n      this.context$.next(context);\n      return;\n    }\n\n    if (!context.map) {\n      context.map = { view: {} };\n    }\n\n    Object.assign(context.map.view, this.mapViewFromRoute);\n\n    this.context$.next(context);\n  }\n\n  loadEditedContext(uri: string) {\n    this.getContextByUri(uri).subscribe((_context: DetailedContext) => {\n      this.setEditedContext(_context);\n    });\n  }\n\n  setEditedContext(context: DetailedContext) {\n    this.editedContext$.next(context);\n  }\n\n  getContextFromMap(igoMap: IgoMap, empty?: boolean): DetailedContext {\n    const view = igoMap.ol.getView();\n    const proj = view.getProjection().getCode();\n    const center: any = new olPoint(view.getCenter()).transform(\n      proj,\n      'EPSG:4326'\n    );\n\n    const context = {\n      uri: uuid(),\n      title: '',\n      scope: 'private',\n      map: {\n        view: {\n          center: center.getCoordinates(),\n          zoom: view.getZoom(),\n          projection: proj,\n          maxZoomOnExtent: igoMap.viewController.maxZoomOnExtent\n        }\n      },\n      layers: [],\n      tools: []\n    };\n\n    let layers = [];\n    if (empty === true) {\n      layers = igoMap.layers$\n        .getValue()\n        .filter(\n          (lay) =>\n            lay.baseLayer === true ||\n            lay.options.id === 'searchPointerSummaryId'\n        )\n        .sort((a, b) => a.zIndex - b.zIndex);\n    } else {\n      layers = igoMap.layers$.getValue().filter(lay => !lay.id.includes('WfsWorkspaceTableDest')).sort((a, b) => a.zIndex - b.zIndex);\n    }\n\n    let i = 0;\n    for (const l of layers) {\n      const layer: any = l;\n      const opts = {\n        id: layer.options.id ? String(layer.options.id) : undefined,\n        layerOptions: {\n          title: layer.options.title,\n          zIndex: ++i,\n          visible: layer.visible\n        },\n        sourceOptions: {\n          type: layer.dataSource.options.type,\n          params: layer.dataSource.options.params,\n          url: layer.dataSource.options.url,\n          queryable: layer.queryable\n        }\n      };\n      if (opts.sourceOptions.type) {\n        context.layers.push(opts);\n      }\n    }\n\n    context.tools = this.tools.map((tool) => {\n      return { id: String(tool.id), global: tool.global };\n    });\n\n    return context;\n  }\n\n  getContextFromLayers(\n    igoMap: IgoMap,\n    layers: Layer[],\n    name: string\n  ): DetailedContext {\n    const currentContext = this.context$.getValue();\n    const view = igoMap.ol.getView();\n    const proj = view.getProjection().getCode();\n    const center: any = new olPoint(view.getCenter()).transform(\n      proj,\n      'EPSG:4326'\n    );\n\n    const context = {\n      uri: name,\n      title: name,\n      map: {\n        view: {\n          center: center.getCoordinates(),\n          zoom: view.getZoom(),\n          projection: proj\n        }\n      },\n      layers: [],\n      toolbar: [],\n      tools: [],\n      extraFeatures: []\n    };\n\n    const currentLayers = igoMap.layers$.getValue();\n    context.layers = currentLayers\n      .filter((l) => l.baseLayer)\n      .map((l) => {\n        return {\n          baseLayer: true,\n          sourceOptions: l.options.sourceOptions,\n          title: l.options.title,\n          visible: l.visible\n        };\n      });\n\n    layers.forEach((layer) => {\n      const layerFound = currentContext.layers.find(\n        (contextLayer) =>\n          layer.id === contextLayer.source.id && !contextLayer.baseLayer\n      );\n\n      if (layerFound) {\n        let layerStyle = layerFound[`style`];\n        if (layerFound[`styleByAttribute`]) {\n          layerStyle = undefined;\n        } else if (layerFound[`clusterBaseStyle`]) {\n          layerStyle = undefined;\n          delete layerFound.sourceOptions[`source`];\n          delete layerFound.sourceOptions[`format`];\n        }\n        const opts = {\n          baseLayer: layerFound.baseLayer,\n          title: layer.options.title,\n          zIndex: layer.zIndex,\n          styleByAttribute: layerFound[`styleByAttribute`],\n          clusterBaseStyle: layerFound[`clusterBaseStyle`],\n          style: layerStyle,\n          clusterParam: layerFound[`clusterParam`],\n          visible: layer.visible,\n          opacity: layer.opacity,\n          sourceOptions: layerFound.sourceOptions\n        };\n        context.layers.push(opts);\n      } else {\n        if (!(layer.ol.getSource() instanceof olVectorSource)) {\n          const catalogLayer = layer.options;\n          catalogLayer.zIndex = layer.zIndex;\n          delete catalogLayer.source;\n          context.layers.push(catalogLayer);\n        } else {\n          let features;\n          const writer = new GeoJSON();\n          if (layer.ol.getSource() instanceof Cluster) {\n            const clusterSource = layer.ol.getSource() as Cluster;\n            features = writer.writeFeatures(\n              clusterSource.getFeatures(),\n              {\n                dataProjection: 'EPSG:4326',\n                featureProjection: 'EPSG:3857'\n              }\n            );\n          } else {\n            const source = layer.ol.getSource() as any;\n            features = writer.writeFeatures(\n              source.getFeatures(),\n              {\n                dataProjection: 'EPSG:4326',\n                featureProjection: 'EPSG:3857'\n              }\n            );\n          }\n          features = JSON.parse(features);\n          features.name = layer.options.title;\n          context.extraFeatures.push(features);\n        }\n      }\n    });\n\n    context.toolbar = this.toolbar;\n    context.tools = this.tools;\n\n    return context;\n  }\n\n  setTools(tools: Tool[]) {\n    this.tools = tools;\n  }\n\n  setToolbar(toolbar: string[]) {\n    this.toolbar = toolbar;\n  }\n\n  private handleContextMessage(context: DetailedContext) {\n    if (this.contextMessage) {\n      this.messageService.remove(this.contextMessage.id);\n    }\n    if (this.context$.value && context.uri && this.context$.value.uri !== context.uri) {\n      this.messageService.removeAllAreNotError();\n    }\n\n    context.messages = context.messages ? context.messages : [];\n    context.messages.push(context.message);\n    context.messages.map(message => {\n      if (message) {\n        message.title = message.title\n          ? this.languageService.translate.instant(message.title)\n          : undefined;\n        message.text = message.text\n          ? this.languageService.translate.instant(message.text)\n          : undefined;\n        this.messageService.message(message as Message);\n      }\n    });\n  }\n\n  private getContextByUri(uri: string): Observable<DetailedContext> {\n    if (this.baseUrl) {\n      let contextToLoad;\n      for (const key of Object.keys(this.contexts$.value)) {\n        contextToLoad = this.contexts$.value[key].find((c) => {\n          return c.uri === uri;\n        });\n        if (contextToLoad) {\n          break;\n        }\n      }\n\n      if (contextToLoad && contextToLoad.imported) {\n        return of(contextToLoad);\n      }\n\n      // TODO : use always id or uri\n      const id = contextToLoad ? contextToLoad.id : uri;\n      return this.getDetails(id);\n    }\n\n    const importedContext = this.contexts$.value.ours.find((currentContext) => {\n      return currentContext.uri === uri && currentContext.imported === true;\n    });\n\n    if (importedContext) {\n      return of(importedContext);\n    } else {\n      return this.getLocalContext(uri);\n    }\n  }\n\n  getContextLayers(igoMap: IgoMap) {\n    const layers: Layer[] = [];\n    const mapLayers = igoMap.layers$.getValue();\n    mapLayers.forEach((layer) => {\n      if (!layer.baseLayer && layer.options.id !== 'searchPointerSummaryId') {\n        layers.push(layer);\n      }\n    });\n    return layers;\n  }\n\n  private readParamsFromRoute() {\n    if (!this.route) {\n      return;\n    }\n\n    this.route.queryParams.subscribe((params) => {\n      const centerKey = this.route.options.centerKey;\n      if (centerKey && params[centerKey as string]) {\n        const centerParams = params[centerKey as string];\n        this.mapViewFromRoute.center = centerParams.split(',').map(Number);\n        this.mapViewFromRoute.geolocate = false;\n      }\n\n      const projectionKey = this.route.options.projectionKey;\n      if (projectionKey && params[projectionKey as string]) {\n        const projectionParam = params[projectionKey as string];\n        this.mapViewFromRoute.projection = projectionParam;\n      }\n\n      const zoomKey = this.route.options.zoomKey;\n      if (zoomKey && params[zoomKey as string]) {\n        const zoomParam = params[zoomKey as string];\n        this.mapViewFromRoute.zoom = Number(zoomParam);\n      }\n    });\n  }\n\n  private getPath(file: string) {\n    const basePath = this.options.basePath.replace(/\\/$/, '');\n\n    return `${basePath}/${file}`;\n  }\n\n  private handleError(\n    error: HttpErrorResponse,\n    uri: string,\n    permissionError?: boolean\n  ): Message[] {\n    const context = this.contexts$.value.ours.find((obj) => obj.uri === uri);\n    const titleContext = context ? context.title : uri;\n    error.error.title = this.languageService.translate.instant(\n      'igo.context.contextManager.invalid.title'\n    );\n\n    error.error.message = this.languageService.translate.instant(\n      'igo.context.contextManager.invalid.text',\n      { value: titleContext }\n    );\n\n    error.error.toDisplay = true;\n\n    if (permissionError) {\n      error.error.title = this.languageService.translate.instant(\n        'igo.context.contextManager.errors.addPermissionTitle'\n      );\n      error.error.message = this.languageService.translate.instant(\n        'igo.context.contextManager.errors.addPermission'\n      );\n    }\n\n    throw error;\n  }\n\n  private handleContextsChange(\n    keepCurrentContext = true\n  ) {\n    const context = this.context$.value;\n    const editedContext = this.editedContext$.value;\n    if (!context || context.uri === this.options.defaultContextUri) {\n      keepCurrentContext = false;\n    }\n    if (!keepCurrentContext || !this.findContext(context)) {\n      this.defaultContextUri = undefined;\n      this.loadDefaultContext();\n    } else {\n      this.getContextByUri(context.uri)\n        .pipe(first())\n        .subscribe(\n          (newContext: DetailedContext) => {\n            this.toolsChanged$.next(newContext);\n          }\n        );\n\n      if (this.baseUrl && this.authService.authenticated) {\n        this.getDefault().subscribe();\n      }\n    }\n    const editedFound = this.findContext(editedContext);\n    if (!editedFound || editedFound.permission !== 'write') {\n      this.setEditedContext(undefined);\n    }\n  }\n\n  private addContextToList(context: Context) {\n    const contextFound = this.findContext(context);\n    if (!contextFound) {\n      const contextSimplifie = {\n        id: context.id,\n        uri: context.uri,\n        title: context.title,\n        scope: context.scope,\n        permission: TypePermission[TypePermission.read]\n      };\n\n      if (this.contexts$.value && this.contexts$.value.public) {\n        this.contexts$.value.public.push(contextSimplifie);\n        this.contexts$.next(this.contexts$.value);\n      }\n    }\n  }\n\n  private findContext(context: Context) {\n    if (!context) {\n      return false;\n    }\n\n    const contexts = this.contexts$.value;\n    let found;\n    for (const key of Object.keys(contexts)) {\n      const value = contexts[key];\n      found = value.find(\n        (c) =>\n          (context.id && c.id === context.id) ||\n          (context.uri && c.uri === context.uri)\n      );\n      if (found) {\n        break;\n      }\n    }\n\n    return found;\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { ContextImportExportComponent } from './context-import-export/context-import-export.component';\nimport { IgoSpinnerModule } from '@igo2/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\n@NgModule({\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatDividerModule,\n    MatTabsModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatCheckboxModule,\n    IgoLanguageModule,\n    IgoSpinnerModule,\n    MatTooltipModule,\n  ],\n  exports: [\n    ContextImportExportComponent\n  ],\n  declarations: [\n    ContextImportExportComponent\n  ]\n})\nexport class IgoContextImportExportModule {\n  static forRoot(): ModuleWithProviders<IgoContextImportExportModule> {\n    return {\n      ngModule: IgoContextImportExportModule\n    };\n  }\n}\n","import { Directive, OnInit, OnDestroy } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { filter } from 'rxjs/operators';\n\nimport { MapViewOptions, MapBrowserComponent, MapControlsOptions, MapScaleLineOptions } from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { ContextService } from './context.service';\nimport { DetailedContext, ContextMapView } from './context.interface';\nimport { MediaService } from '@igo2/core';\n\n@Directive({\n  selector: '[igoMapContext]'\n})\nexport class MapContextDirective implements OnInit, OnDestroy {\n  private component: MapBrowserComponent;\n  private context$$: Subscription;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    component: MapBrowserComponent,\n    private contextService: ContextService,\n    private mediaService: MediaService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.context$$ = this.contextService.context$\n      .pipe(filter(context => context !== undefined))\n      .subscribe(context => this.handleContextChange(context));\n  }\n\n  ngOnDestroy() {\n    this.context$$.unsubscribe();\n  }\n\n  private handleContextChange(context: DetailedContext) {\n    if (context.map === undefined) {\n      return;\n    }\n\n    // This creates a new ol.Map when the context changes. Doing that\n    // allows the print tool to work properly even when the map's canvas\n    // has been tainted (CORS) with the layers of another context. This could\n    // have some side effects such as unbinding all listeners on the first map.\n    // A better solution would be to create a new map (preview) before\n    // printing and avoid the tainted canvas issue. This will come later so\n    // this snippet of code is kept here in case it takes too long becomes\n    // an issue\n\n    // const target = this.component.map.ol.getTarget();\n    // this.component.map.ol.setTarget(undefined);\n    // this.component.map.init();\n    // this.component.map.ol.setTarget(target);\n\n    const viewContext: ContextMapView = context.map.view;\n    if (!this.component.view || viewContext.keepCurrentView !== true) {\n      this.component.view = viewContext as MapViewOptions;\n    }\n\n    const controlsContext: MapControlsOptions = context.map.controls;\n    if (!this.component.controls && controlsContext) {\n      if (this.mediaService.isMobile()) {\n        if (typeof(controlsContext.scaleLine) !== 'boolean') {\n          const scaleLineOption = controlsContext.scaleLine as MapScaleLineOptions;\n          if (!scaleLineOption.minWidth) {\n            scaleLineOption.minWidth = Math.min(64, scaleLineOption.minWidth);\n            controlsContext.scaleLine = scaleLineOption;\n          }\n        }\n      }\n      this.component.controls = controlsContext;\n    }\n  }\n}\n","import { Directive, OnInit, OnDestroy, Optional, Input } from '@angular/core';\n\nimport { Subscription, merge } from 'rxjs';\nimport { buffer, debounceTime, filter } from 'rxjs/operators';\n\nimport { RouteService, ConfigService } from '@igo2/core';\nimport {\n  MapBrowserComponent,\n  Layer,\n  LayerService,\n  LayerOptions,\n  StyleListService,\n  StyleService\n} from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { ContextService } from './context.service';\nimport { DetailedContext } from './context.interface';\nimport {\n  addImportedFeaturesToMap,\n  addImportedFeaturesStyledToMap\n} from '../../context-import-export/shared/context-import.utils';\nimport GeoJSON from 'ol/format/GeoJSON';\n\n@Directive({\n  selector: '[igoLayerContext]'\n})\nexport class LayerContextDirective implements OnInit, OnDestroy {\n  private context$$: Subscription;\n  private queryParams: any;\n\n  private contextLayers: Layer[] = [];\n\n  @Input() removeLayersOnContextChange: boolean = true;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    private component: MapBrowserComponent,\n    private contextService: ContextService,\n    private layerService: LayerService,\n    private configService: ConfigService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    @Optional() private route: RouteService\n  ) {}\n\n  ngOnInit() {\n    this.context$$ = this.contextService.context$\n      .pipe(filter((context) => context !== undefined))\n      .subscribe((context) => this.handleContextChange(context));\n\n    if (\n      this.route &&\n      this.route.options.visibleOnLayersKey &&\n      this.route.options.visibleOffLayersKey &&\n      this.route.options.contextKey\n    ) {\n      const queryParams$$ = this.route.queryParams.subscribe((params) => {\n        if (Object.keys(params).length > 0) {\n          this.queryParams = params;\n          queryParams$$.unsubscribe();\n        }\n      });\n    }\n  }\n\n  ngOnDestroy() {\n    this.context$$.unsubscribe();\n  }\n\n  private handleContextChange(context: DetailedContext) {\n    if (context.layers === undefined) {\n      return;\n    }\n    if (this.removeLayersOnContextChange === true) {\n      this.map.removeAllLayers();\n    } else {\n      this.map.removeLayers(this.contextLayers);\n    }\n    this.contextLayers = [];\n\n    const layersAndIndex$ = merge(\n      ...context.layers.map((layerOptions: LayerOptions, index: number) => {\n        return this.layerService.createAsyncLayer(layerOptions, context.uri);\n      })\n    );\n\n    layersAndIndex$\n      .pipe(buffer(layersAndIndex$.pipe(debounceTime(500))))\n      .subscribe((layers: Layer[]) => {\n        layers = layers\n          .filter((layer: Layer) => layer !== undefined)\n          .map((layer) => {\n            layer.visible = this.computeLayerVisibilityFromUrl(layer);\n            layer.zIndex = layer.zIndex;\n\n            return layer;\n          });\n\n        this.contextLayers.concat(layers);\n        this.map.addLayers(layers);\n\n        if (context.extraFeatures) {\n          context.extraFeatures.forEach((featureCollection) => {\n            const format = new GeoJSON();\n            const title = featureCollection.name;\n            featureCollection = JSON.stringify(featureCollection);\n            featureCollection = format.readFeatures(featureCollection, {\n              dataProjection: 'EPSG:4326',\n              featureProjection: 'EPSG:3857'\n            });\n            if (!this.configService.getConfig('importWithStyle')) {\n              addImportedFeaturesToMap(featureCollection, this.map, title);\n            } else {\n              addImportedFeaturesStyledToMap(\n                featureCollection,\n                this.map,\n                title,\n                this.styleListService,\n                this.styleService\n              );\n            }\n          });\n        }\n      });\n  }\n\n  private computeLayerVisibilityFromUrl(layer: Layer): boolean {\n    const params = this.queryParams;\n    const currentContext = this.contextService.context$.value.uri;\n    const currentLayerid: string = layer.id;\n\n    let visible = layer.visible;\n    if (!params || !currentLayerid) {\n      return visible;\n    }\n\n    const contextParams = params[this.route.options.contextKey as string];\n    if (contextParams === currentContext || !contextParams) {\n      let visibleOnLayersParams = '';\n      let visibleOffLayersParams = '';\n      let visiblelayers: string[] = [];\n      let invisiblelayers: string[] = [];\n\n      if (\n        this.route.options.visibleOnLayersKey &&\n        params[this.route.options.visibleOnLayersKey as string]\n      ) {\n        visibleOnLayersParams =\n          params[this.route.options.visibleOnLayersKey as string];\n      }\n      if (\n        this.route.options.visibleOffLayersKey &&\n        params[this.route.options.visibleOffLayersKey as string]\n      ) {\n        visibleOffLayersParams =\n          params[this.route.options.visibleOffLayersKey as string];\n      }\n\n      /* This order is important because to control whichever\n       the order of * param. First whe open and close everything.*/\n      if (visibleOnLayersParams === '*') {\n        visible = true;\n      }\n      if (visibleOffLayersParams === '*') {\n        visible = false;\n      }\n\n      // After, managing named layer by id (context.json OR id from datasource)\n      visiblelayers = visibleOnLayersParams.split(',');\n      invisiblelayers = visibleOffLayersParams.split(',');\n      if (visiblelayers.indexOf(currentLayerid) > -1 || visiblelayers.indexOf(currentLayerid.toString()) > -1) {\n        visible = true;\n      }\n      if (invisiblelayers.indexOf(currentLayerid) > -1 || invisiblelayers.indexOf(currentLayerid.toString()) > -1) {\n        visible = false;\n      }\n    }\n\n    return visible;\n  }\n}\n","import * as olStyle from 'ol/style';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  IgoMap,\n  VectorLayer,\n  QueryableDataSourceOptions,\n  StyleService,\n  StyleListService,\n  StyleByAttribute,\n  ClusterParam,\n  ClusterDataSourceOptions,\n  ClusterDataSource\n} from '@igo2/geo';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\nimport { ContextService } from '../../context-manager/shared/context.service';\nimport OlFeature from 'ol/Feature';\n\nexport function handleFileImportSuccess(\n  file: File,\n  context: DetailedContext,\n  messageService: MessageService,\n  languageService: LanguageService,\n  contextService: ContextService\n) {\n  if (Object.keys(context).length <= 0) {\n    handleNothingToImportError(file, messageService, languageService);\n    return;\n  }\n\n  const contextTitle = computeLayerTitleFromFile(file);\n\n  addContextToContextList(context, contextTitle, contextService);\n\n  const translate = languageService.translate;\n  const messageTitle = translate.instant(\n    'igo.context.contextImportExport.import.success.title'\n  );\n  const message = translate.instant(\n    'igo.context.contextImportExport.import.success.text',\n    {\n      value: contextTitle\n    }\n  );\n  messageService.success(message, messageTitle);\n}\n\nexport function handleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService,\n  sizeMb?: number\n) {\n  sizeMb = sizeMb ? sizeMb : 30;\n  const errMapping = {\n    'Invalid file': handleInvalidFileImportError,\n    'File is too large': handleSizeFileImportError,\n    'Failed to read file': handleUnreadbleFileImportError\n  };\n  errMapping[error.message](\n    file,\n    error,\n    messageService,\n    languageService,\n    sizeMb\n  );\n}\n\nexport function handleInvalidFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant(\n    'igo.context.contextImportExport.import.invalid.title'\n  );\n  const message = translate.instant(\n    'igo.context.contextImportExport.import.invalid.text',\n    {\n      value: file.name,\n      mimeType: file.type\n    }\n  );\n  messageService.error(message, title);\n}\n\nexport function handleSizeFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService,\n  sizeMb: number\n) {\n  const translate = languageService.translate;\n  const title = translate.instant(\n    'igo.context.contextImportExport.import.tooLarge.title'\n  );\n  const message = translate.instant(\n    'igo.context.contextImportExport.import.tooLarge.text',\n    {\n      value: file.name,\n      size: sizeMb\n    }\n  );\n  messageService.error(message, title);\n}\n\nexport function handleUnreadbleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant(\n    'igo.context.contextImportExport.import.unreadable.title'\n  );\n  const message = translate.instant(\n    'igo.context.contextImportExport.import.unreadable.text',\n    {\n      value: file.name\n    }\n  );\n  messageService.error(message, title);\n}\n\nexport function handleNothingToImportError(\n  file: File,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant(\n    'igo.context.contextImportExport.import.empty.title'\n  );\n  const message = translate.instant(\n    'igo.context.contextImportExport.import.empty.text',\n    {\n      value: file.name\n    }\n  );\n  messageService.error(message, title);\n}\n\nexport function addContextToContextList(\n  context: DetailedContext,\n  contextTitle: string,\n  contextService: ContextService\n) {\n  context.title = contextTitle;\n  context.imported = true;\n  contextService.contexts$.value.ours.unshift(context);\n  contextService.contexts$.next(contextService.contexts$.value);\n  contextService.importedContext.unshift(context);\n  contextService.loadContext(context.uri);\n}\n\nexport function getFileExtension(file: File): string {\n  return file.name.split('.').pop().toLowerCase();\n}\n\nexport function computeLayerTitleFromFile(file: File): string {\n  return file.name.substr(0, file.name.lastIndexOf('.'));\n}\n\nexport function addImportedFeaturesToMap(\n  olFeatures: OlFeature<OlGeometry>[],\n  map: IgoMap,\n  layerTitle: string\n): VectorLayer {\n  const r = Math.floor(Math.random() * 255);\n  const g = Math.floor(Math.random() * 255);\n  const b = Math.floor(Math.random() * 255);\n  const stroke = new olStyle.Stroke({\n    color: [r, g, b, 1],\n    width: 2\n  });\n\n  const fill = new olStyle.Fill({\n    color: [r, g, b, 0.4]\n  });\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n    type: 'vector',\n    queryable: true\n  };\n  const source = new FeatureDataSource(sourceOptions);\n  source.ol.addFeatures(olFeatures);\n  const layer = new VectorLayer({\n    title: layerTitle,\n    source,\n    style: new olStyle.Style({\n      stroke,\n      fill,\n      image: new olStyle.Circle({\n        radius: 5,\n        stroke,\n        fill\n      })\n    })\n  });\n  map.addLayer(layer);\n\n  return layer;\n}\n\nexport function addImportedFeaturesStyledToMap(\n  olFeatures: OlFeature<OlGeometry>[],\n  map: IgoMap,\n  layerTitle: string,\n  styleListService: StyleListService,\n  styleService: StyleService\n): VectorLayer {\n  let style;\n  let distance: number;\n\n  if (\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\n  ) {\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\n      layerTitle.toString() + '.styleByAttribute'\n    );\n\n    style = (feature) => {\n      return styleService.createStyleByAttribute(feature, styleByAttribute);\n    };\n  } else if (\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      layerTitle.toString() + '.clusterParam'\n    );\n    distance = styleListService.getStyleList(\n      layerTitle.toString() + '.distance'\n    );\n\n    const baseStyle = styleService.createStyle(\n      styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n    );\n\n    style = (feature) => {\n      return styleService.createClusterStyle(feature, clusterParam, baseStyle);\n    };\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\n    style = styleService.createStyle(\n      styleListService.getStyleList(layerTitle.toString() + '.style')\n    );\n  } else {\n    style = styleService.createStyle(\n      styleListService.getStyleList('default.style')\n    );\n  }\n  let source;\n\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\n    const sourceOptions: ClusterDataSourceOptions &\n      QueryableDataSourceOptions = {\n      distance,\n      type: 'cluster',\n      queryable: true\n    };\n    source = new ClusterDataSource(sourceOptions);\n    source.ol.source.addFeatures(olFeatures);\n  } else {\n    const sourceOptions: FeatureDataSourceOptions &\n      QueryableDataSourceOptions = {\n      type: 'vector',\n      queryable: true\n    };\n    source = new FeatureDataSource(sourceOptions);\n    source.ol.addFeatures(olFeatures);\n  }\n\n  const layer = new VectorLayer({\n    title: layerTitle,\n    source,\n    style\n  });\n  map.addLayer(layer);\n\n  return layer;\n}\n","export enum ContextListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\n","import { Component } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\n@Component({\n  selector: 'igo-bookmark-dialog',\n  templateUrl: './bookmark-dialog.component.html'\n})\nexport class BookmarkDialogComponent {\n  public title: string;\n\n  constructor(public dialogRef: MatDialogRef<BookmarkDialogComponent>) {}\n}\n","<h1 mat-dialog-title class=\"mat-typography\">{{ 'igo.context.bookmarkButton.dialog.title' | translate }}</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <mat-form-field>\n    <input matInput required autocomplete=\"off\"\n      maxlength=\"128\"\n      [placeholder]=\"'igo.context.bookmarkButton.dialog.placeholder' | translate\"\n      [(ngModel)]=\"title\">\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button mat-button color=\"primary\"\n         [disabled]=\"!title\"\n         (click)=\"dialogRef.close(title)\">\n    {{'igo.common.confirmDialog.confirmBtn' | translate}}\n  </button>\n  <button mat-button\n          (click)=\"dialogRef.close(false)\">\n    {{'igo.common.confirmDialog.cancelBtn' | translate}}\n  </button>\n</div>\n","<mat-list-item\n  class=\"mat-list-item\"\n  [ngClass]=\"{'mat-list-item-light': hidden}\">\n  <button mat-list-avatar\n    *ngIf=\"auth.authenticated\"\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"auth.authenticated ? ('igo.context.contextManager.favorite' | translate) : ''\"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\">\n    <mat-icon *ngIf=\"!context.iconImage\" svgIcon=\"{{context.icon ? context.icon : context.scope === 'public' ? 'earth' : 'star'}}\"></mat-icon>\n    <img *ngIf=\"context.iconImage\" [src]=\"context.iconImage\">\n  </button>\n  <h4 matLine>{{context.title}}</h4>\n\n  <div *ngIf=\"auth.authenticated\"\n       igoStopPropagation\n       class=\"igo-actions-container\">\n\n     <button *ngIf=\"collapsed && selected && (context.permission === typePermission[typePermission.write] || context.imported)\"\n       class=\"save-button\"\n       mat-icon-button\n       [matTooltip]=\"'igo.context.contextManager.save' | translate\"\n       matTooltipShowDelay=\"500\"\n       [color]=\"color\"\n       (click)=\"save.emit(context)\">\n       <mat-icon svgIcon=\"content-save\"></mat-icon>\n     </button>\n\n    <div #actions class=\"igo-actions-expand-container\">\n\n      <button *ngIf=\"canShare && !context.imported\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.managePermissions' | translate\"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"managePermissions.emit(context)\">\n        <mat-icon svgIcon=\"account-arrow-right\"></mat-icon>\n      </button>\n\n      <!--button\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.manageTools' | translate\"\n        [color]=\"color\"\n        (click)=\"manageTools.emit(context)\">\n        <mat-icon svgIcon=\"widgets\"></mat-icon>\n      </button-->\n\n      <button *ngIf=\"!context.imported\"\n        class=\"clone-button\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.clone' | translate\"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"clone.emit(context)\">\n        <mat-icon svgIcon=\"content-copy\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"context.permission === typePermission[typePermission.write] && !context.imported\"\n        class=\"edit-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.edit' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"edit.emit(context)\">\n        <mat-icon svgIcon=\"pencil\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"!context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.hide' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"hide.emit(context)\">\n        <mat-icon svgIcon=\"eye\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.show' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"show.emit(context)\">\n        <mat-icon svgIcon=\"eye-off\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"context.permission === typePermission[typePermission.write] || context.imported\"\n        class=\"delete-button\"\n        mat-icon-button\n        color=\"warn\"\n        [matTooltip]=\"'igo.context.contextManager.delete' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"delete.emit(context)\">\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n    </div>\n\n    <button\n      class=\"actions-button\"\n      mat-icon-button\n      igoCollapse\n      [color]=\"color\"\n      [target]=\"actions\"\n      [collapsed]=collapsed\n      (click)=\"collapsed = !collapsed\">\n      <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\n    </button>\n\n  </div>\n\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { StorageService } from '@igo2/core';\nimport { AuthService } from '@igo2/auth';\nimport { TypePermission } from '../shared/context.enum';\nimport { DetailedContext } from '../shared/context.interface';\n\n@Component({\n  selector: 'igo-context-item',\n  templateUrl: './context-item.component.html',\n  styleUrls: ['./context-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ContextItemComponent {\n  public typePermission = TypePermission;\n  public color = 'primary';\n  public collapsed = true;\n\n  @Input()\n  get context(): DetailedContext {\n    return this._context;\n  }\n  set context(value: DetailedContext) {\n    this._context = value;\n  }\n  private _context: DetailedContext;\n\n  @Input()\n  get default(): boolean {\n    return this._default;\n  }\n  set default(value: boolean) {\n    this._default = value;\n  }\n  private _default = false;\n\n  @Input() selected: boolean;\n\n  @Output() edit = new EventEmitter<DetailedContext>();\n  @Output() delete = new EventEmitter<DetailedContext>();\n  @Output() save = new EventEmitter<DetailedContext>();\n  @Output() clone = new EventEmitter<DetailedContext>();\n  @Output() hide = new EventEmitter<DetailedContext>();\n  @Output() show = new EventEmitter<DetailedContext>();\n  @Output() favorite = new EventEmitter<DetailedContext>();\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\n  @Output() manageTools = new EventEmitter<DetailedContext>();\n\n  get hidden(): boolean {\n    return this.context.hidden;\n  }\n\n  get canShare(): boolean {\n    return this.storageService.get('canShare') === true;\n  }\n\n  constructor(\n    public auth: AuthService,\n    private storageService: StorageService\n  ) {}\n\n  favoriteClick(context) {\n    if (this.auth.authenticated) {\n      this.favorite.emit(context);\n    }\n  }\n}\n","<igo-list [navigation]=\"true\">\n  <mat-form-field *ngIf=\"showFilter()\" [ngClass]=\"auth.authenticated && configService.getConfig('context') ? 'context-filter-min-width' : 'context-filter-max-width'\">\n    <input\n      matInput\n      type=\"text\"\n      [placeholder]=\"'igo.context.contextManager.filterPlaceHolder' | translate\"\n      [(ngModel)]=\"term\">\n    <button\n      mat-button\n      mat-icon-button\n      matSuffix\n      class=\"clear-button\"\n      *ngIf=\"term.length\"\n      aria-label=\"Clear\"\n      color=\"warn\"\n      (click)=\"clearFilter()\">\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <button\n  *ngIf=\"!sortedAlpha\"\n  class=\"sort-alpha\"\n  mat-icon-button\n  [matTooltip]=\"'igo.context.contextManager.sortAlphabetically' | translate\"\n  matTooltipShowDelay=\"500\"\n  (click)=\"toggleSort(true)\">\n  <mat-icon color=\"primary\" svgIcon=\"sort-alphabetical-variant\"></mat-icon>\n  </button>\n  <button\n    *ngIf=\"sortedAlpha\"\n    class=\"sort-alpha\"\n    mat-icon-button\n    [matTooltip]=\"'igo.context.contextManager.sortContextOrder' | translate\"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleSort(false)\">\n    <mat-icon color=\"warn\" svgIcon=\"sort-variant-remove\"></mat-icon>\n  </button>\n\n  <igo-actionbar *ngIf=\"auth.authenticated && configService.getConfig('context')\"\n    class=\"add-context-button\"\n    [iconColor]=\"color\"\n    [store]=\"actionStore\"\n    [withIcon]=\"true\"\n    icon=\"plus\"\n    [withTitle]=\"actionbarMode === 'overlay'\"\n    [horizontal]=\"false\"\n    [mode]=\"actionbarMode\">\n  </igo-actionbar>\n\n  <button *ngIf=\"auth.authenticated && configService.getConfig('context')\"\n    class=\"users-filter\"\n    mat-icon-button\n    [matTooltip]=\"'igo.context.contextManager.filterUser' | translate\"\n    matTooltipShowDelay=\"500\"\n    [matMenuTriggerFor]=\"accountMenu\">\n    <mat-icon color=\"primary\" svgIcon=\"filter-menu\"></mat-icon>\n  </button>\n\n  <mat-menu #accountMenu=\"matMenu\">\n    <ng-container *ngFor=\"let user of users\">\n      <span class=\"profilsMenu\">\n        <mat-checkbox\n          class=\"mat-menu-item\"\n          [checked]=\"getPermission(user).checked\"\n          [indeterminate]=\"getPermission(user).indeterminate\"\n          (click)=\"$event.stopPropagation()\"\n          (change)=\"userSelection(user)\">\n        </mat-checkbox>\n        <button *ngIf=\"user.childs\"\n          [matMenuTriggerFor]=\"subAccountMenu\"\n          mat-menu-item>\n          {{user.title}}\n        </button>\n        <button\n          mat-menu-item\n          *ngIf=\"!user.childs\">\n          {{user.title}}\n        </button>\n      </span>\n\n      <mat-menu #subAccountMenu=\"matMenu\">\n        <mat-checkbox *ngFor=\"let child of user.childs\"\n          class=\"mat-menu-item\"\n          [checked]=\"getPermission(child).checked\"\n          (click)=\"$event.stopPropagation()\"\n          (change)=\"userSelection(child, user)\">\n          {{child.title}}\n        </mat-checkbox>\n      </mat-menu>\n    </ng-container>\n\n    <span class=\"profilsMenu\">\n      <mat-checkbox\n        class=\"mat-menu-item\"\n        [checked]=\"showHidden\"\n        (click)=\"$event.stopPropagation()\"\n        (change)=\"showHiddenContexts.emit()\">\n      </mat-checkbox>\n      <button mat-menu-item>\n        {{ 'igo.context.contextManager.showHidden' | translate }}\n      </button>\n    </span>\n  </mat-menu>\n\n  <ng-template ngFor let-groupContexts [ngForOf]=\"contexts$ | async | keyvalue\">\n\n    <igo-collapsible *ngIf=\"groupContexts.value.length && auth.authenticated\" [title]=\"titleMapping[groupContexts.key] | translate\"\n      [collapsed]=\"collapsed[titleMapping[groupContexts.key]]\" (toggle)=\"collapsed[titleMapping[groupContexts.key]] = $event\">\n\n      <ng-template ngFor let-context [ngForOf]=\"groupContexts.value\">\n        <igo-context-item\n          igoListItem\n          color=\"accent\"\n          [selected]=\"selectedContext && selectedContext.uri === context.uri\"\n          [context]=\"context\"\n          [default]=\"context.id && this.defaultContextId && this.defaultContextId === context.id\"\n          (edit)=\"edit.emit(context)\"\n          (delete)=\"delete.emit(context)\"\n          (clone)=\"clone.emit(context)\"\n          (save)=\"save.emit(context)\"\n          (hide)=\"hideContext(context)\"\n          (show)=\"showContext(context)\"\n          (favorite)=\"favorite.emit(context)\"\n          (manageTools)=\"manageTools.emit(context)\"\n          (managePermissions)=\"managePermissions.emit(context)\"\n          (select)=\"select.emit(context)\"\n          (unselect)=\"unselect.emit(context)\">\n        </igo-context-item>\n      </ng-template>\n\n    </igo-collapsible>\n\n    <ng-template *ngIf=\"groupContexts.value.length && !auth.authenticated\" ngFor let-context [ngForOf]=\"groupContexts.value\">\n      <igo-context-item\n        igoListItem\n        color=\"accent\"\n        [selected]=\"selectedContext && selectedContext.uri === context.uri\"\n        [context]=\"context\"\n        [default]=\"this.defaultContextId === context.id\"\n        (select)=\"select.emit(context)\"\n        (unselect)=\"unselect.emit(context)\">\n      </igo-context-item>\n    </ng-template>\n\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectorRef,\n  OnInit,\n  ChangeDetectionStrategy,\n  OnDestroy\n} from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\nimport type { IgoMap } from '@igo2/geo';\n\nimport {\n  DetailedContext,\n  ContextsList,\n  ContextUserPermission,\n  ContextProfils\n} from '../shared/context.interface';\nimport { ContextListControlsEnum } from './context-list.enum';\nimport {\n  Subscription,\n  BehaviorSubject,\n  ReplaySubject,\n  EMPTY,\n  timer\n} from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { MatDialog } from '@angular/material/dialog';\nimport { BookmarkDialogComponent } from '../../context-map-button/bookmark-button/bookmark-dialog.component';\nimport { debounce } from 'rxjs/operators';\nimport { ActionStore, ActionbarMode } from '@igo2/common';\nimport { ContextService } from '../shared/context.service';\n\n@Component({\n  selector: 'igo-context-list',\n  templateUrl: './context-list.component.html',\n  styleUrls: ['./context-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ContextListComponent implements OnInit, OnDestroy {\n  private contextsInitial: ContextsList = { ours: [] };\n  contexts$: BehaviorSubject<ContextsList> = new BehaviorSubject(\n    this.contextsInitial\n  );\n\n  change$ = new ReplaySubject<void>(1);\n\n  private change$$: Subscription;\n\n  @Input()\n  get contexts(): ContextsList {\n    return this._contexts;\n  }\n  set contexts(value: ContextsList) {\n    this._contexts = value;\n    this.cdRef.detectChanges();\n    this.next();\n  }\n  private _contexts: ContextsList = { ours: [] };\n\n  @Input()\n  get selectedContext(): DetailedContext {\n    return this._selectedContext;\n  }\n  set selectedContext(value: DetailedContext) {\n    this._selectedContext = value;\n    this.cdRef.detectChanges();\n  }\n  private _selectedContext: DetailedContext;\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get defaultContextId(): string {\n    return this._defaultContextId;\n  }\n  set defaultContextId(value: string) {\n    this._defaultContextId = value;\n  }\n  private _defaultContextId: string;\n\n  public collapsed: { contextScope }[] = [];\n\n  @Output() select = new EventEmitter<DetailedContext>();\n  @Output() unselect = new EventEmitter<DetailedContext>();\n  @Output() edit = new EventEmitter<DetailedContext>();\n  @Output() delete = new EventEmitter<DetailedContext>();\n  @Output() save = new EventEmitter<DetailedContext>();\n  @Output() clone = new EventEmitter<DetailedContext>();\n  @Output() create = new EventEmitter<{ title: string; empty: boolean }>();\n  @Output() hide = new EventEmitter<DetailedContext>();\n  @Output() show = new EventEmitter<DetailedContext>();\n  @Output() showHiddenContexts = new EventEmitter<boolean>();\n  @Output() favorite = new EventEmitter<DetailedContext>();\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\n  @Output() manageTools = new EventEmitter<DetailedContext>();\n  @Output() filterPermissionsChanged = new EventEmitter<\n    ContextUserPermission[]\n  >();\n\n  public titleMapping = {\n    ours: 'igo.context.contextManager.ourContexts',\n    shared: 'igo.context.contextManager.sharedContexts',\n    public: 'igo.context.contextManager.publicContexts'\n  };\n\n  public users: ContextProfils[];\n  public permissions: ContextUserPermission[] = [];\n\n  public actionStore = new ActionStore([]);\n  public actionbarMode = ActionbarMode.Overlay;\n\n  public color = 'primary';\n\n  public showHidden = false;\n\n  /**\n   * Context filter term\n   */\n  @Input()\n  set term(value: string) {\n    this._term = value;\n    this.next();\n  }\n  get term(): string {\n    return this._term;\n  }\n  public _term: string = '';\n\n  get sortedAlpha(): boolean {\n    return this._sortedAlpha;\n  }\n  set sortedAlpha(value: boolean) {\n    this._sortedAlpha = value;\n    this.next();\n  }\n  private _sortedAlpha: boolean = undefined;\n\n  public showContextFilter = ContextListControlsEnum.always;\n\n  public thresholdToFilter = 5;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private contextService: ContextService,\n    public configService: ConfigService,\n    public auth: AuthService,\n    private dialog: MatDialog,\n    private languageService: LanguageService,\n    private storageService: StorageService\n  ) {}\n\n  ngOnInit() {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.contexts.ours.length === 0 ? EMPTY : timer(50);\n        })\n      )\n      .subscribe(() => {\n        this.contexts$.next(this.filterContextsList(this.contexts));\n      });\n\n    this.actionStore.load([\n      {\n        id: 'emptyContext',\n        title: this.languageService.translate.instant(\n          'igo.context.contextManager.emptyContext'\n        ),\n        icon: 'map-outline',\n        tooltip: this.languageService.translate.instant(\n          'igo.context.contextManager.emptyContextTooltip'\n        ),\n        handler: () => {\n          this.createContext(true);\n        }\n      },\n      {\n        id: 'contextFromMap',\n        title: this.languageService.translate.instant(\n          'igo.context.contextManager.contextMap'\n        ),\n        icon: 'map-check',\n        tooltip: this.languageService.translate.instant(\n          'igo.context.contextManager.contextMapTooltip'\n        ),\n        handler: () => {\n          this.createContext(false);\n        }\n      }\n    ]);\n  }\n\n  private next() {\n    this.change$.next();\n  }\n\n  private filterContextsList(contexts: ContextsList) {\n    if (this.term === '') {\n      if (this.sortedAlpha) {\n        contexts = this.sortContextsList(contexts);\n      }\n      return contexts;\n    } else {\n      const ours = contexts.ours.filter((context) => {\n        const filterNormalized = this.term\n          .toLowerCase()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const contextTitleNormalized = context.title\n          .toLowerCase()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        return contextTitleNormalized.includes(filterNormalized);\n      });\n\n      let updateContexts: ContextsList = {\n        ours\n      };\n\n      if (this.contexts.public) {\n        const publics = contexts.public.filter((context) => {\n          const filterNormalized = this.term\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          const contextTitleNormalized = context.title\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          return contextTitleNormalized.includes(filterNormalized);\n        });\n        updateContexts.public = publics;\n      }\n\n      if (this.contexts.shared) {\n        const shared = contexts.shared.filter((context) => {\n          const filterNormalized = this.term\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          const contextTitleNormalized = context.title\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          return contextTitleNormalized.includes(filterNormalized);\n        });\n        updateContexts.shared = shared;\n      }\n\n      if (this.sortedAlpha) {\n        updateContexts = this.sortContextsList(updateContexts);\n      }\n      return updateContexts;\n    }\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n  }\n\n  public showFilter() {\n    switch (this.showContextFilter) {\n      case ContextListControlsEnum.always:\n        return true;\n      case ContextListControlsEnum.never:\n        return false;\n      default:\n        let totalLength = this.contexts.ours.length;\n        this.contexts.public\n          ? (totalLength += this.contexts.public.length)\n          : (totalLength += 0);\n        this.contexts.shared\n          ? (totalLength += this.contexts.shared.length)\n          : (totalLength += 0);\n        if (totalLength >= this.thresholdToFilter) {\n          return true;\n        }\n        return false;\n    }\n  }\n\n  sortContextsList(contexts: ContextsList) {\n    if (contexts) {\n      const contextsList = JSON.parse(JSON.stringify(contexts));\n      contextsList.ours.sort((a, b) => {\n        if (this.normalize(a.title) < this.normalize(b.title)) {\n          return -1;\n        }\n        if (this.normalize(a.title) > this.normalize(b.title)) {\n          return 1;\n        }\n        return 0;\n      });\n\n      if (contextsList.shared) {\n        contextsList.shared.sort((a, b) => {\n          if (this.normalize(a.title) < this.normalize(b.title)) {\n            return -1;\n          }\n          if (this.normalize(a.title) > this.normalize(b.title)) {\n            return 1;\n          }\n          return 0;\n        });\n      } else if (contextsList.public) {\n        contextsList.public.sort((a, b) => {\n          if (this.normalize(a.title) < this.normalize(b.title)) {\n            return -1;\n          }\n          if (this.normalize(a.title) > this.normalize(b.title)) {\n            return 1;\n          }\n          return 0;\n        });\n      }\n      return contextsList;\n    }\n  }\n\n  normalize(str: string) {\n    return str\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .toLowerCase();\n  }\n\n  toggleSort(sortAlpha: boolean) {\n    this.sortedAlpha = sortAlpha;\n  }\n\n  clearFilter() {\n    this.term = '';\n  }\n\n  createContext(empty?: boolean) {\n    this.dialog\n      .open(BookmarkDialogComponent, { disableClose: false })\n      .afterClosed()\n      .pipe(take(1))\n      .subscribe((title: string) => {\n        if (title) {\n          this.create.emit({ title, empty });\n        }\n      });\n  }\n\n  getPermission(user?): ContextUserPermission {\n    if (user) {\n      const permission = this.permissions.find((p) => p.name === user.name);\n      return permission;\n    }\n  }\n\n  userSelection(user, parent?) {\n    const permission = this.getPermission(user);\n    if (permission) {\n      permission.checked = !permission.checked;\n      this.storageService.set(\n        'contexts.permissions.' + permission.name,\n        permission.checked\n      );\n      permission.indeterminate = false;\n    }\n\n    if (parent) {\n      let indeterminate = false;\n\n      for (const c of parent.childs) {\n        const cPermission = this.getPermission(c);\n        if (cPermission.checked !== permission.checked) {\n          indeterminate = true;\n          break;\n        }\n      }\n      const parentPermission = this.getPermission(parent);\n      if (parentPermission) {\n        parentPermission.checked = permission.checked;\n        this.storageService.set(\n          'contexts.permissions.' + parentPermission.name,\n          permission.checked\n        );\n        parentPermission.indeterminate = indeterminate;\n      }\n    }\n\n    if (user.childs) {\n      for (const c of user.childs) {\n        const childrenPermission = this.getPermission(c);\n        if (\n          childrenPermission &&\n          childrenPermission.checked !== permission.checked\n        ) {\n          childrenPermission.checked = permission.checked;\n          this.storageService.set(\n            'contexts.permissions.' + childrenPermission.name,\n            permission.checked\n          );\n        }\n      }\n    }\n\n    this.filterPermissionsChanged.emit(this.permissions);\n  }\n\n  hideContext(context: DetailedContext) {\n    context.hidden = true;\n    if (!this.showHidden) {\n      const contexts: ContextsList = { ours: [], shared: [], public: [] };\n      contexts.ours = this.contexts.ours.filter((c) => c.id !== context.id);\n      contexts.shared = this.contexts.shared.filter((c) => c.id !== context.id);\n      contexts.public = this.contexts.public.filter((c) => c.id !== context.id);\n      this.contexts = contexts;\n    }\n    this.hide.emit(context);\n  }\n\n  showContext(context: DetailedContext) {\n    context.hidden = false;\n    this.show.emit(context);\n  }\n}\n","import {\n  Directive,\n  Self,\n  OnInit,\n  OnDestroy,\n  HostListener\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { MessageService, LanguageService, StorageService } from '@igo2/core';\nimport { AuthService } from '@igo2/auth';\nimport { ConfirmDialogService } from '@igo2/common';\nimport { MapService } from '@igo2/geo';\n\nimport {\n  Context,\n  DetailedContext,\n  ContextsList,\n  ContextUserPermission\n} from '../shared/context.interface';\nimport { ContextService } from '../shared/context.service';\nimport { ContextListComponent } from './context-list.component';\n\n@Directive({\n  selector: '[igoContextListBinding]'\n})\nexport class ContextListBindingDirective implements OnInit, OnDestroy {\n  private component: ContextListComponent;\n  private contexts$$: Subscription;\n  private selectedContext$$: Subscription;\n  private defaultContextId$$: Subscription;\n\n  @HostListener('select', ['$event'])\n  onSelect(context: Context) {\n    this.contextService.loadContext(context.uri);\n  }\n\n  @HostListener('edit', ['$event'])\n  onEdit(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('save', ['$event'])\n  onSave(context: Context) {\n    const map = this.mapService.getMap();\n    const contextFromMap = this.contextService.getContextFromMap(map);\n\n    const msgSuccess = () => {\n      const translate = this.languageService.translate;\n      const message = translate.instant(\n        'igo.context.contextManager.dialog.saveMsg',\n        {\n          value: context.title\n        }\n      );\n      const title = translate.instant(\n        'igo.context.contextManager.dialog.saveTitle'\n      );\n      this.messageService.success(message, title);\n    };\n\n    if (context.imported) {\n      contextFromMap.title = context.title;\n      this.contextService.delete(context.id, true);\n      this.contextService.create(contextFromMap).subscribe((contextCreated) => {\n        this.contextService.loadContext(contextCreated.uri);\n        msgSuccess();\n      });\n      return;\n    }\n\n    const changes: any = {\n      layers: contextFromMap.layers,\n      map: {\n        view: contextFromMap.map.view\n      }\n    };\n\n    this.contextService.update(context.id, changes).subscribe(() => {\n      msgSuccess();\n    });\n  }\n\n  @HostListener('favorite', ['$event'])\n  onFavorite(context: Context) {\n    this.contextService.setDefault(context.id).subscribe(() => {\n      this.contextService.defaultContextId$.next(context.id);\n      const translate = this.languageService.translate;\n      const message = translate.instant(\n        'igo.context.contextManager.dialog.favoriteMsg',\n        {\n          value: context.title\n        }\n      );\n      const title = translate.instant(\n        'igo.context.contextManager.dialog.favoriteTitle'\n      );\n      this.messageService.success(message, title);\n    });\n  }\n\n  @HostListener('manageTools', ['$event'])\n  onManageTools(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('managePermissions', ['$event'])\n  onManagePermissions(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('delete', ['$event'])\n  onDelete(context: Context) {\n    const translate = this.languageService.translate;\n    this.confirmDialogService\n      .open(\n        translate.instant('igo.context.contextManager.dialog.confirmDelete')\n      )\n      .subscribe((confirm) => {\n        if (confirm) {\n          this.contextService\n            .delete(context.id, context.imported)\n            .subscribe(() => {\n              const message = translate.instant(\n                'igo.context.contextManager.dialog.deleteMsg',\n                {\n                  value: context.title\n                }\n              );\n              const title = translate.instant(\n                'igo.context.contextManager.dialog.deleteTitle'\n              );\n              this.messageService.info(message, title);\n            });\n        }\n      });\n  }\n\n  @HostListener('clone', ['$event'])\n  onClone(context: DetailedContext) {\n    const properties = {\n      title: context.title + '-copy',\n      uri: context.uri + '-copy'\n    };\n    this.contextService.clone(context.id, properties).subscribe(() => {\n      const translate = this.languageService.translate;\n      const message = translate.instant(\n        'igo.context.contextManager.dialog.cloneMsg',\n        {\n          value: context.title\n        }\n      );\n      const title = translate.instant(\n        'igo.context.contextManager.dialog.cloneTitle'\n      );\n      this.messageService.success(message, title);\n    });\n  }\n\n  @HostListener('create', ['$event'])\n  onCreate(opts: { title: string; empty: boolean }) {\n    const { title, empty } = opts;\n    const context = this.contextService.getContextFromMap(\n      this.component.map,\n      empty\n    );\n    context.title = title;\n    this.contextService.create(context).subscribe(() => {\n      const translate = this.languageService.translate;\n      const titleD = translate.instant(\n        'igo.context.bookmarkButton.dialog.createTitle'\n      );\n      const message = translate.instant(\n        'igo.context.bookmarkButton.dialog.createMsg',\n        {\n          value: context.title\n        }\n      );\n      this.messageService.success(message, titleD);\n      this.contextService.loadContext(context.uri);\n    });\n  }\n\n  @HostListener('filterPermissionsChanged')\n  loadContexts() {\n    const permissions = ['none'];\n    for (const p of this.component.permissions) {\n      if (p.checked === true || p.indeterminate === true) {\n        permissions.push(p.name);\n      }\n    }\n    this.component.showHidden\n      ? this.contextService.loadContexts(permissions, true)\n      : this.contextService.loadContexts(permissions, false);\n  }\n\n  @HostListener('showHiddenContexts')\n  showHiddenContexts() {\n    this.component.showHidden = !this.component.showHidden;\n    this.storageService.set('contexts.showHidden', this.component.showHidden);\n    this.loadContexts();\n  }\n\n  @HostListener('show', ['$event'])\n  onShowContext(context: DetailedContext) {\n    this.contextService.showContext(context.id).subscribe();\n  }\n\n  @HostListener('hide', ['$event'])\n  onHideContext(context: DetailedContext) {\n    this.contextService.hideContext(context.id).subscribe();\n  }\n\n  constructor(\n    @Self() component: ContextListComponent,\n    private contextService: ContextService,\n    private mapService: MapService,\n    private languageService: LanguageService,\n    private confirmDialogService: ConfirmDialogService,\n    private messageService: MessageService,\n    private auth: AuthService,\n    private storageService: StorageService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input contexts\n    this.component.contexts = { ours: [] };\n    this.component.showHidden = this.storageService.get(\n      'contexts.showHidden'\n    ) as boolean;\n\n    this.contexts$$ = this.contextService.contexts$.subscribe((contexts) =>\n      this.handleContextsChange(contexts)\n    );\n\n    this.defaultContextId$$ = this.contextService.defaultContextId$.subscribe(\n      (id) => {\n        this.component.defaultContextId = id;\n      }\n    );\n\n    // See feature-list.component for an explanation about the debounce time\n    this.selectedContext$$ = this.contextService.context$\n      .pipe(debounceTime(100))\n      .subscribe((context) => (this.component.selectedContext = context));\n\n    this.auth.authenticate$.subscribe((authenticate) => {\n      if (authenticate) {\n        this.contextService.getProfilByUser().subscribe((profils) => {\n          this.component.users = profils;\n          this.component.permissions = [];\n          const profilsAcc = this.component.users.reduce((acc, cur) => {\n            acc = acc.concat(cur);\n            acc = cur.childs ? acc.concat(cur.childs) : acc;\n            return acc;\n          }, []);\n\n          for (const user of profilsAcc) {\n            const permission: ContextUserPermission = {\n              name: user.name,\n              checked: this.storageService.get(\n                'contexts.permissions.' + user.name\n              ) as boolean\n            };\n            if (permission.checked === null) {\n              permission.checked = true;\n            }\n            this.component.permissions.push(permission);\n          }\n\n          const permissions = ['none'];\n          for (const p of this.component.permissions) {\n            if (p.checked === true || p.indeterminate === true) {\n              permissions.push(p.name);\n            }\n          }\n\n          this.component.showHidden\n            ? this.contextService.loadContexts(permissions, true)\n            : this.contextService.loadContexts(permissions, false);\n        });\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.contexts$$.unsubscribe();\n    this.selectedContext$$.unsubscribe();\n    this.defaultContextId$$.unsubscribe();\n  }\n\n  private handleContextsChange(contexts: ContextsList) {\n    this.component.contexts = contexts;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, EMPTY } from 'rxjs';\n\nimport { ConfigService } from '@igo2/core';\nimport { Poi } from './poi.interface';\n\n@Injectable()\nexport class PoiService {\n  private baseUrl: string;\n\n  constructor(private http: HttpClient, private config: ConfigService) {\n    this.baseUrl = this.config.getConfig('context.url');\n  }\n\n  get(): Observable<Poi[]> {\n    if (!this.baseUrl) {\n      return EMPTY;\n    }\n\n    const url = this.baseUrl + '/pois';\n    return this.http.get<Poi[]>(url);\n  }\n\n  delete(id: string): Observable<void> {\n    const url = this.baseUrl + '/pois/' + id;\n    return this.http.delete<void>(url);\n  }\n\n  create(context: Poi): Observable<Poi> {\n    const url = this.baseUrl + '/pois';\n    return this.http.post<Poi>(url, context);\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoConfirmDialogModule, IgoStopPropagationModule } from '@igo2/common';\nimport { IgoAuthModule } from '@igo2/auth';\n\nimport { BookmarkButtonComponent } from './bookmark-button/bookmark-button.component';\nimport { BookmarkDialogComponent } from './bookmark-button/bookmark-dialog.component';\nimport { PoiButtonComponent } from './poi-button/poi-button.component';\nimport { PoiDialogComponent } from './poi-button/poi-dialog.component';\nimport { PoiService } from './poi-button/shared/poi.service';\nimport { UserDialogComponent } from './user-button/user-dialog.component';\nimport { UserButtonComponent } from './user-button/user-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoConfirmDialogModule,\n    IgoStopPropagationModule,\n    IgoAuthModule,\n    FormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatDialogModule,\n    MatInputModule\n  ],\n  exports: [BookmarkButtonComponent, PoiButtonComponent, UserButtonComponent, BookmarkDialogComponent],\n  declarations: [\n    BookmarkButtonComponent,\n    BookmarkDialogComponent,\n    PoiButtonComponent,\n    PoiDialogComponent,\n    UserButtonComponent,\n    UserDialogComponent\n  ],\n  providers: [PoiService]\n})\nexport class IgoContextMapButtonModule {\n  static forRoot(): ModuleWithProviders<IgoContextMapButtonModule> {\n    return {\n      ngModule: IgoContextMapButtonModule\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoAuthModule } from '@igo2/auth';\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoListModule,\n  IgoKeyValueModule,\n  IgoCollapsibleModule,\n  IgoStopPropagationModule,\n  IgoActionbarModule\n} from '@igo2/common';\n\nimport { MapContextDirective } from './shared/map-context.directive';\nimport { LayerContextDirective } from './shared/layer-context.directive';\nimport { ContextListComponent } from './context-list/context-list.component';\nimport { ContextListBindingDirective } from './context-list/context-list-binding.directive';\nimport { ContextItemComponent } from './context-item/context-item.component';\nimport { ContextFormComponent } from './context-form/context-form.component';\nimport { ContextEditComponent } from './context-edit/context-edit.component';\nimport { ContextEditBindingDirective } from './context-edit/context-edit-binding.directive';\nimport { ContextPermissionsComponent } from './context-permissions/context-permissions.component';\nimport { ContextPermissionsBindingDirective } from './context-permissions/context-permissions-binding.directive';\nimport { IgoContextMapButtonModule } from '../context-map-button/context-map-button.module';\nimport { IgoContextImportExportModule } from '../context-import-export/context-import-export.module';\n\nconst CONTEXT_DIRECTIVES = [\n  MapContextDirective,\n  LayerContextDirective\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    MatListModule,\n    MatCheckboxModule,\n    MatRadioModule,\n    MatDialogModule,\n    MatMenuModule,\n    MatOptionModule,\n    MatAutocompleteModule,\n    IgoAuthModule,\n    IgoListModule,\n    IgoKeyValueModule,\n    IgoCollapsibleModule,\n    IgoStopPropagationModule,\n    IgoLanguageModule,\n    IgoContextImportExportModule,\n    IgoContextMapButtonModule,\n    IgoActionbarModule\n  ],\n  exports: [\n    ContextListComponent,\n    ContextListBindingDirective,\n    ContextItemComponent,\n    ContextFormComponent,\n    ContextEditComponent,\n    ContextEditBindingDirective,\n    ContextPermissionsComponent,\n    ContextPermissionsBindingDirective,\n\n    ...CONTEXT_DIRECTIVES\n  ],\n  declarations: [\n    ContextListComponent,\n    ContextListBindingDirective,\n    ContextItemComponent,\n    ContextFormComponent,\n    ContextEditComponent,\n    ContextEditBindingDirective,\n    ContextPermissionsComponent,\n    ContextPermissionsBindingDirective,\n\n    ...CONTEXT_DIRECTIVES\n  ]\n})\nexport class IgoContextManagerModule {\n  static forRoot(): ModuleWithProviders<IgoContextManagerModule> {\n    return {\n      ngModule: IgoContextManagerModule\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\nimport { ExportOptions } from '@igo2/geo';\n\nexport enum ImportExportType {\n  layer = 'layer',\n  context = 'context'\n}\n\nexport enum ImportExportMode {\n  import = 'import',\n  export = 'export'\n}\n\n/**\n * Service that holds the state of the importExport module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ImportExportState {\n\n  readonly importExportType$: BehaviorSubject<ImportExportType> = new BehaviorSubject(ImportExportType.layer);\n  readonly selectedMode$: BehaviorSubject<ImportExportMode> = new BehaviorSubject(ImportExportMode.import);\n  readonly exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(undefined);\n\n  setImportExportType(type: ImportExportType) {\n    this.importExportType$.next(type);\n  }\n\n  setMode(mode: ImportExportMode) {\n    this.selectedMode$.next(mode);\n  }\n\n  setsExportOptions(exportOptions: ExportOptions) {\n      this.exportOptions$.next(exportOptions);\n    }\n\n}\n","import { Injectable } from '@angular/core';\n\nimport { Toolbox, ToolService } from '@igo2/common';\n\nimport { ExportOptions } from '@igo2/geo';\nimport { BehaviorSubject } from 'rxjs';\nimport { ImportExportMode, ImportExportState } from '../import-export/import-export.state';\n\n/**\n * Service that holds the state of the search module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ToolState {\n  get toolbox(): Toolbox {\n    return this.toolService.toolbox;\n  }\n\n  public openSidenav$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  constructor(\n    private toolService: ToolService,\n    private importExportState: ImportExportState\n    ) {}\n\n    toolToActivateFromOptions(toolToActivate: { tool: string; options: {[key: string]: any} }) {\n    if (!toolToActivate) { return; }\n    if (toolToActivate.tool === 'importExport') {\n      let exportOptions: ExportOptions = this.importExportState.exportOptions$.value;\n      if (!exportOptions) {\n        exportOptions = {\n          layers: toolToActivate.options.layers,\n          featureInMapExtent: toolToActivate.options.featureInMapExtent\n        };\n      } else {\n        exportOptions.layers = toolToActivate.options.layers;\n        exportOptions.featureInMapExtent = toolToActivate.options.featureInMapExtent;\n      }\n      this.importExportState.setsExportOptions(exportOptions);\n      this.importExportState.setMode(ImportExportMode.export);\n    }\n\n    if (this.toolbox.getTool(toolToActivate.tool)) {\n      this.toolbox.activateTool(toolToActivate.tool);\n      this.openSidenav$.next(true);\n    }\n  }\n}\n","import {\n    FeatureMotion,\n    FeatureStoreSelectionStrategy,\n    FeatureWorkspace,\n    WfsWorkspace\n} from '@igo2/geo';\n\n\nexport function handleZoomAuto(workspace: FeatureWorkspace | WfsWorkspace, storageService) {\n    const zoomStrategy = workspace.entityStore\n        .getStrategyOfType(FeatureStoreSelectionStrategy) as FeatureStoreSelectionStrategy;\n    zoomStrategy.setMotion(storageService.get('zoomAuto') as boolean ? FeatureMotion.Default : FeatureMotion.None);\n}\n\n\n","import { Injectable } from '@angular/core';\n\nimport { StorageService } from '@igo2/core';\n\n/**\n * Service that holds the state of storage service\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageState {\n  get storageService(): StorageService {\n    return this.igoStorageService;\n  }\n\n  constructor(private igoStorageService: StorageService) {}\n}\n","import { Injectable, OnDestroy } from '@angular/core';\n\nimport {\n  Action,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy\n} from '@igo2/common';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport {\n  FeatureWorkspace,\n  mapExtentStrategyActiveToolTip,\n  noElementSelected,\n  ExportOptions\n} from '@igo2/geo';\nimport { StorageService, StorageServiceEvent, StorageServiceEventEnum, LanguageService, MediaService} from '@igo2/core';\nimport { StorageState } from '../../storage/storage.state';\nimport { map, skipWhile } from 'rxjs/operators';\nimport { ToolState } from '../../tool/tool.state';\nimport { handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FeatureActionsService implements OnDestroy {\n\n  public maximize$: BehaviorSubject<boolean> = new BehaviorSubject(\n    this.storageService.get('workspaceMaximize') as boolean\n  );\n\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private toolState: ToolState,\n    private mediaService: MediaService\n  ) {}\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: FeatureWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n      );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: FeatureWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(\n        skipWhile(\n          (storageChange: StorageServiceEvent) =>\n            storageChange.key !== 'zoomAuto' || storageChange.event === StorageServiceEventEnum.CLEARED\n        )\n      )\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    return [\n      {\n        id: 'zoomAuto',\n        checkbox: true,\n        title: 'igo.integration.workspace.zoomAuto.title',\n        tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\n        checkCondition: this.zoomAuto$,\n        handler: () => {\n          handleZoomAuto(workspace, this.storageService);\n          this.storageService.set(\n            'zoomAuto',\n            !this.storageService.get('zoomAuto') as boolean\n          );\n        }\n      },\n      {\n        id: 'filterInMapExtent',\n        checkbox: true,\n        title: 'igo.integration.workspace.inMapExtent.title',\n        tooltip: mapExtentStrategyActiveToolTip(workspace),\n        checkCondition: rowsInMapExtentCheckCondition$,\n        handler: () => rowsInMapExtentCheckCondition$.next(!rowsInMapExtentCheckCondition$.value)\n      },\n      {\n        id: 'selectedOnly',\n        checkbox: true,\n        title: 'igo.integration.workspace.selected.title',\n        tooltip: 'igo.integration.workspace.selected.tooltip',\n        checkCondition: selectOnlyCheckCondition$,\n        handler: () => selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\n      },\n      {\n        id: 'clearselection',\n        icon: 'select-off',\n        title: 'igo.integration.workspace.clearSelection.title',\n        tooltip: 'igo.integration.workspace.clearSelection.tooltip',\n        handler: (ws: FeatureWorkspace) => {\n          ws.entityStore.state.updateMany(ws.entityStore.view.all(), {\n            selected: false\n          });\n        },\n        args: [workspace],\n        availability: (ws: FeatureWorkspace) => noElementSelected(ws)\n      },\n      {\n        id: 'featureDownload',\n        icon: 'file-export',\n        title: 'igo.integration.workspace.download.title',\n        tooltip: 'igo.integration.workspace.download.tooltip',\n        handler: (ws: FeatureWorkspace) => {\n          const filterStrategy = ws.entityStore.getStrategyOfType(\n            EntityStoreFilterCustomFuncStrategy\n          );\n          const filterSelectionStrategy = ws.entityStore.getStrategyOfType(\n            EntityStoreFilterSelectionStrategy\n          );\n          const layersWithSelection = filterSelectionStrategy.active\n            ? [ws.layer.id]\n            : [];\n          this.toolState.toolToActivateFromOptions({\n            tool: 'importExport',\n            options: {\n              layers: [ws.layer.id],\n              featureInMapExtent: filterStrategy.active,\n              layersWithSelection\n            } as ExportOptions\n          });\n        },\n        args: [workspace]\n      },\n      {\n        id: 'maximize',\n        title: this.languageService.translate.instant('igo.integration.workspace.maximize'),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.maximizeTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => !v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          if (!this.mediaService.isMobile()) {\n            this.maximize$.next(true);\n          }\n        },\n      },\n      {\n        id: 'standardExtent',\n        title: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtent'\n        ),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtentTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          this.maximize$.next(false);\n        }\n      }\n    ];\n  }\n}\n","import { Inject, Injectable, OnDestroy } from '@angular/core';\n\nimport {\n  Action,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  Widget\n} from '@igo2/common';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport {\n  WfsWorkspace,\n  mapExtentStrategyActiveToolTip,\n  noElementSelected,\n  ExportOptions,\n  OgcFilterWidget,\n  OgcFilterableDataSource,\n} from '@igo2/geo';\nimport { StorageService, StorageServiceEvent, StorageServiceEventEnum, LanguageService, MediaService} from '@igo2/core';\nimport { StorageState } from '../../storage/storage.state';\nimport { map, skipWhile } from 'rxjs/operators';\nimport { ToolState } from '../../tool/tool.state';\nimport { handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WfsActionsService implements OnDestroy {\n\n  public maximize$: BehaviorSubject<boolean> = new BehaviorSubject(\n    this.storageService.get('workspaceMaximize') as boolean\n  );\n\n  selectOnlyCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  // rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    @Inject(OgcFilterWidget) private ogcFilterWidget: Widget,\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private mediaService: MediaService,\n    private toolState: ToolState) {}\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: WfsWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n      );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: WfsWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(skipWhile((storageChange: StorageServiceEvent) =>\n        storageChange.key !== 'zoomAuto' || storageChange.event === StorageServiceEventEnum.CLEARED))\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    const actions = [\n      {\n        id: 'zoomAuto',\n        checkbox: true,\n        title: 'igo.integration.workspace.zoomAuto.title',\n        tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\n        checkCondition: this.zoomAuto$,\n        handler: () => {\n          handleZoomAuto(workspace, this.storageService);\n          this.storageService.set('zoomAuto', !this.storageService.get('zoomAuto') as boolean);\n        }\n      },\n      {\n        id: 'filterInMapExtent',\n        checkbox: true,\n        title: 'igo.integration.workspace.inMapExtent.title',\n        tooltip: mapExtentStrategyActiveToolTip(workspace),\n        checkCondition: rowsInMapExtentCheckCondition$,\n        handler: () => rowsInMapExtentCheckCondition$.next(!rowsInMapExtentCheckCondition$.value)\n      },\n      {\n        id: 'selectedOnly',\n        checkbox: true,\n        title: 'igo.integration.workspace.selected.title',\n        tooltip: 'igo.integration.workspace.selected.title',\n        checkCondition: selectOnlyCheckCondition$,\n        handler: () => selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\n      },\n      {\n        id: 'clearselection',\n        icon: 'select-off',\n        title: 'igo.integration.workspace.clearSelection.title',\n        tooltip: 'igo.integration.workspace.clearSelection.tooltip',\n        handler: (ws: WfsWorkspace) => {\n          ws.entityStore.state.updateMany(ws.entityStore.view.all(), { selected: false });\n        },\n        args: [workspace],\n        availability: (ws: WfsWorkspace) => noElementSelected(ws)\n      },\n      {\n        id: 'wfsDownload',\n        icon: 'file-export',\n        title: 'igo.integration.workspace.download.title',\n        tooltip: 'igo.integration.workspace.download.tooltip',\n        handler: (ws: WfsWorkspace) => {\n          const filterStrategy = ws.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n          const filterSelectionStrategy = ws.entityStore.getStrategyOfType(EntityStoreFilterSelectionStrategy);\n          const layersWithSelection = filterSelectionStrategy.active ? [ws.layer.id] : [];\n          this.toolState.toolToActivateFromOptions({\n            tool: 'importExport',\n            options: { layers: [ws.layer.id], featureInMapExtent: filterStrategy.active, layersWithSelection } as ExportOptions\n          });\n        },\n        args: [workspace]\n      },\n      {\n        id: 'ogcFilter',\n        icon: 'filter',\n        title: 'igo.integration.workspace.ogcFilter.title',\n        tooltip: 'igo.integration.workspace.ogcFilter.tooltip',\n        handler: (widget: Widget, ws: WfsWorkspace) => {\n          ws.activateWidget(widget, {\n            map: ws.map,\n            layer: ws.layer\n          });\n        },\n        args: [this.ogcFilterWidget, workspace]\n      },\n      {\n        id: 'maximize',\n        title: this.languageService.translate.instant('igo.integration.workspace.maximize'),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.maximizeTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => !v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          if (!this.mediaService.isMobile()) {\n            this.maximize$.next(true);\n          }\n        },\n      },\n      {\n        id: 'standardExtent',\n        title: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtent'\n        ),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtentTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          this.maximize$.next(false);\n        }\n      }\n    ];\n    return (workspace.layer.dataSource as OgcFilterableDataSource).ogcFilters$?.value?.enabled ?\n    actions : actions.filter(action => action.id !== 'ogcFilter');\n  }\n}\n","import { Injectable, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport {\n  EntityRecord,Workspace, WorkspaceStore, Widget,\n  EntityStoreFilterCustomFuncStrategy, EntityStoreFilterSelectionStrategy } from '@igo2/common';\nimport { WfsWorkspace, FeatureWorkspace } from '@igo2/geo';\nimport { FeatureActionsService } from './shared/feature-actions.service';\nimport { WfsActionsService } from './shared/wfs-actions.service';\nimport { StorageService } from '@igo2/core';\n\n/**\n * Service that holds the state of the workspace module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class WorkspaceState implements OnDestroy {\n\n  public workspacePanelExpanded: boolean = false;\n\n  readonly workspaceEnabled$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n  readonly rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(true);\n  readonly selectOnlyCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n\n  readonly workspaceMaximize$: BehaviorSubject<boolean> = new BehaviorSubject(\n    this.storageService.get('workspaceMaximize') as boolean\n  );\n  private actionMaximize$$: Subscription[] = [];\n\n  private rowsInMapExtentCheckCondition$$: Subscription;\n  private selectOnlyCheckCondition$$: Subscription;\n\n  /** Subscription to the active workspace */\n  private activeWorkspace$$: Subscription;\n\n  /** Subscription to the active workspace widget */\n  private activeWorkspaceWidget$$: Subscription;\n\n  /** Active widget observable. Only one may be active for all available workspaces */\n  readonly activeWorkspaceWidget$: BehaviorSubject<Widget> = new BehaviorSubject<Widget>(undefined);\n\n  /**\n   * Observable of the active workspace\n   */\n  public workspace$ = new BehaviorSubject<Workspace>(undefined);\n\n  /**\n   * Store that holds all the available workspaces\n   */\n  get store(): WorkspaceStore { return this._store; }\n  private _store: WorkspaceStore;\n\n  constructor(\n    private featureActionsService: FeatureActionsService,\n    private wfsActionsService: WfsActionsService,\n    private storageService: StorageService\n  ) {\n    this.initWorkspaces();\n  }\n\n  /**\n   * Initialize the workspace store. Each time a workspace is activated,\n   * subscribe to it's active widget. Tracking the active widget is useful\n   * to make sure only one widget is active at a time.\n   */\n  private initWorkspaces() {\n    this._store = new WorkspaceStore([]);\n    this._store.stateView\n      .firstBy$((record: EntityRecord<Workspace>) => record.state.active === true)\n      .subscribe((record: EntityRecord<Workspace>) => {\n        const workspace = record ? record.entity : undefined;\n        this.workspace$.next(workspace);\n      });\n\n    this._store.stateView.all$()\n    .subscribe((workspaces: EntityRecord<Workspace>[]) => {\n      workspaces.map((wks: EntityRecord<Workspace>) => {\n        if (wks.entity.actionStore.empty) {\n          if (wks.entity instanceof WfsWorkspace) {\n            this.wfsActionsService.loadActions(\n              wks.entity,\n              this.rowsInMapExtentCheckCondition$,\n              this.selectOnlyCheckCondition$);\n          } else if (wks.entity instanceof FeatureWorkspace) {\n            this.featureActionsService.loadActions(\n              wks.entity,\n              this.rowsInMapExtentCheckCondition$,\n              this.selectOnlyCheckCondition$);\n          }\n        }\n\n      });\n    });\n\n    this.actionMaximize$$.push(this.featureActionsService.maximize$.subscribe(maximized => {\n      this.setWorkspaceIsMaximized(maximized);\n    }));\n\n    this.actionMaximize$$.push(this.wfsActionsService.maximize$.subscribe(maximized => {\n      this.setWorkspaceIsMaximized(maximized);\n    }));\n\n    this.activeWorkspace$$ = this.workspace$\n      .subscribe((workspace: Workspace) => {\n        if (this.activeWorkspaceWidget$$ !== undefined) {\n          this.activeWorkspaceWidget$$.unsubscribe();\n          this.activeWorkspaceWidget$$ = undefined;\n        }\n\n        if (workspace !== undefined) {\n          this.activeWorkspaceWidget$$ = workspace.widget$\n            .subscribe((widget: Widget) => this.activeWorkspaceWidget$.next(widget));\n        }\n      });\n\n    this.rowsInMapExtentCheckCondition$$ = this.rowsInMapExtentCheckCondition$.subscribe((rowsInMapExtent) => {\n      this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\n        if (!wks.entity.actionStore.empty) {\n          const filterStrategy = wks.entity.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n          if (filterStrategy) {\n            if (rowsInMapExtent) {\n              filterStrategy.activate();\n            } else {\n              filterStrategy.deactivate();\n            }\n          }\n        }\n      });\n    });\n\n    this.selectOnlyCheckCondition$$ = this.selectOnlyCheckCondition$.subscribe((selectOnly) => {\n      this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\n        if (!wks.entity.actionStore.empty) {\n          const filterStrategy = wks.entity.entityStore.getStrategyOfType(EntityStoreFilterSelectionStrategy);\n          if (filterStrategy) {\n            if (selectOnly) {\n              filterStrategy.activate();\n            } else {\n              filterStrategy.deactivate();\n            }\n          }\n        }\n      });\n    });\n  }\n\n  private setWorkspaceIsMaximized(maximized: boolean) {\n    this.storageService.set('workspaceMaximize', maximized);\n    this.workspaceMaximize$.next(maximized);\n  }\n\n  public setActiveWorkspaceById(id: string) {\n    const wksFromId = this.store\n    .all()\n    .find(workspace => workspace.id === id);\n    if (wksFromId) {\n      this.store.activateWorkspace(wksFromId);\n    }\n  }\n\n  /**\n   * Teardown all the workspaces\n   * @internal\n   */\n  ngOnDestroy() {\n    this.teardownWorkspaces();\n    this.actionMaximize$$.map(a => a.unsubscribe());\n    if (this.rowsInMapExtentCheckCondition$$) {\n      this.selectOnlyCheckCondition$$.unsubscribe();\n    }\n    if (this.selectOnlyCheckCondition$$) {\n      this.selectOnlyCheckCondition$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Teardown the workspace store and any subscribers\n   */\n  private teardownWorkspaces() {\n    this.store.clear();\n    if (this.activeWorkspaceWidget$$ !== undefined) {\n      this.activeWorkspaceWidget$$.unsubscribe();\n    }\n    if (this.activeWorkspace$$ !== undefined) {\n      this.activeWorkspace$$.unsubscribe();\n    }\n  }\n\n}\n","import { Injectable } from '@angular/core';\n\nimport { EntityRecord, EntityStore, EntityStoreFilterCustomFuncStrategy, EntityStoreStrategyFuncOptions } from '@igo2/common';\nimport { ConfigService, StorageService } from '@igo2/core';\nimport { SearchResult, SearchSourceService, SearchSource, CommonVectorStyleOptions } from '@igo2/geo';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n/**\n * Service that holds the state of the search module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class SearchState {\n  public searchOverlayStyle: CommonVectorStyleOptions = {};\n  public searchOverlayStyleSelection: CommonVectorStyleOptions = {};\n  public searchOverlayStyleFocus: CommonVectorStyleOptions = {};\n\n  public focusedOrResolution$$: Subscription;\n  public selectedOrResolution$$: Subscription;\n\n  readonly searchTermSplitter$: BehaviorSubject<string> = new BehaviorSubject('|');\n\n  readonly searchTerm$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly searchDisabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly searchResultsGeometryEnabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly searchSettingsChange$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  readonly selectedResult$: BehaviorSubject<SearchResult> = new BehaviorSubject(undefined);\n\n  /**\n   * Store that holds the search results\n   */\n  readonly store: EntityStore<SearchResult> = new EntityStore<SearchResult>([]);\n\n  /**\n   * Search types currently enabled in the search source service\n   */\n  get searchTypes(): string[] {\n    return this.searchSourceService\n      .getEnabledSources()\n      .map((source: SearchSource) => (source.constructor as any).type);\n  }\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private storageService: StorageService,\n    private configService: ConfigService) {\n    const searchOverlayStyle = this.configService.getConfig('searchOverlayStyle') as {\n      base?: CommonVectorStyleOptions,\n      selection?: CommonVectorStyleOptions,\n      focus?: CommonVectorStyleOptions\n    };\n    if (searchOverlayStyle) {\n      this.searchOverlayStyle = searchOverlayStyle.base;\n      this.searchOverlayStyleSelection = searchOverlayStyle.selection;\n      this.searchOverlayStyleFocus = searchOverlayStyle.focus;\n    }\n\n    const searchResultsGeometryEnabled = this.storageService.get('searchResultsGeometryEnabled') as boolean;\n    if (searchResultsGeometryEnabled) {\n      this.searchResultsGeometryEnabled$.next(searchResultsGeometryEnabled);\n    }\n    this.store.addStrategy(this.createCustomFilterTermStrategy(), false);\n  }\n\n  private createCustomFilterTermStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<SearchResult>) => {\n      return record.entity.meta.score === 100;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n\n  /**\n   * Activate custom strategy\n   *\n   */\n  activateCustomFilterTermStrategy() {\n    const strategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n    if (strategy !== undefined) {\n      strategy.activate();\n    }\n  }\n\n  /**\n   * Deactivate custom strategy\n   *\n   */\n  deactivateCustomFilterTermStrategy() {\n    const strategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n    if (strategy !== undefined) {\n      strategy.deactivate();\n    }\n  }\n\n  enableSearch() {\n    this.searchDisabled$.next(false);\n  }\n\n  disableSearch() {\n    this.searchDisabled$.next(true);\n  }\n\n  setSearchTerm(searchTerm: string) {\n    this.searchTerm$.next(searchTerm);\n  }\n\n  setSearchType(searchType: string) {\n    this.searchSourceService.enableSourcesByType(searchType);\n    this.searchType$.next(searchType);\n  }\n\n  setSearchSettingsChange() {\n    this.searchSettingsChange$.next(true);\n  }\n\n  setSelectedResult(result: SearchResult) {\n    this.selectedResult$.next(result);\n  }\n\n  setSearchResultsGeometryStatus(value) {\n    this.storageService.set('searchResultsGeometryEnabled', value);\n    this.searchResultsGeometryEnabled$.next(value);\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { IgoSearchModule } from '@igo2/geo';\n\nimport { SearchBarBindingDirective } from './search-bar-binding.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [IgoSearchModule],\n  declarations: [SearchBarBindingDirective],\n  exports: [SearchBarBindingDirective],\n})\nexport class IgoAppSearchBarModule {}\n","import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoFlexibleModule, IgoCustomHtmlModule, IgoPanelModule } from '@igo2/common';\nimport {\n  IgoFeatureModule,\n  IgoSearchModule,\n  IgoFeatureDetailsModule\n} from '@igo2/geo';\n\nimport { SearchResultsToolComponent } from './search-results-tool.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatBadgeModule,\n    MatTooltipModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    IgoFeatureModule,\n    IgoSearchModule,\n    IgoFlexibleModule,\n    IgoPanelModule,\n    IgoFeatureDetailsModule,\n    IgoCustomHtmlModule\n  ],\n  declarations: [SearchResultsToolComponent],\n  exports: [SearchResultsToolComponent],\n  schemas: [CUSTOM_ELEMENTS_SCHEMA]\n})\nexport class IgoAppSearchResultsToolModule {}\n","import { NgModule } from '@angular/core';\n\nimport { IgoAppSearchBarModule } from './search-bar/search-bar.module';\nimport { IgoAppSearchResultsToolModule } from './search-results-tool/search-results-tool.module';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [\n   IgoAppSearchBarModule,\n   IgoAppSearchResultsToolModule\n  ],\n})\nexport class IgoAppSearchModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Search</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: ConfigService, LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/search\">code of this example</a><br>\n    See search section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\n    <hr>\n    <br>\n    <span *ngIf=\"!isTouchScreen\" title=\"Details\">\n      F2 activate/deactivate the pointer location.\n    </span>\n  </mat-card-content>\n\n  <igo-map-browser #mapBrowser [map]=\"map\" [view]=\"view\" igoOverlay [igoContextMenu]=actionbarMenu\n\n    igoSearchPointerSummary\n    [igoSearchPointerSummaryDelay]=\"500\"\n    [igoSearchPointerSummaryEnabled]=\"igoSearchPointerSummaryEnabled\"\n    (menuPosition)=\"onContextMenuOpen($event)\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Search\">\n    <igo-search-bar\n      (pointerSummaryStatus)=\"onPointerSummaryStatusChange($event)\"\n      [searchSettings]=\"true\"\n      [store]=\"searchStore\"\n      [termSplitter]=\"termSplitter\"\n      (searchTermChange)=\"onSearchTermChange($event)\"\n      (search)=\"onSearch($event)\"\n      (clearFeature)=\"removeFeatureFromMap()\"\n      (searchSettingsChange)=\"onSearchSettingsChange()\">\n    </igo-search-bar>\n\n    <igo-search-results\n      [store]=\"searchStore\"\n      [term]=\"term\"\n      [termSplitter]=\"termSplitter\"\n      placeholder=\"false\"\n      [settingsChange$]=\"settingsChange$\"\n      (resultFocus)=\"onResultFocus($event)\"\n      (resultSelect)=\"onResultFocus($event)\"\n      (moreResults)=\"onSearch($event)\">\n        <ng-template #igoSearchItemToolbar let-result=\"result\">\n          <igo-search-add-button\n            [map]=\"map\"\n            [layer]=\"result\">\n          </igo-search-add-button>\n        </ng-template>\n    </igo-search-results>\n\n  </igo-panel>\n\n  <igo-panel *ngIf=\"selectedFeature\" title=\"Details\">\n    <igo-feature-details [feature]=\"selectedFeature\"></igo-feature-details>\n  </igo-panel>\n\n</mat-card>\n\n<ng-template #actionbarMenu>\n  <igo-actionbar\n    [store]=\"store\"\n    [withIcon]=\"false\"\n    [horizontal]=\"true\"\n    [mode]=\"'context'\">\n  </igo-actionbar>\n</ng-template>\n\n<igo-message-center></igo-message-center>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppSearchComponent } from './search.component';\n\nconst routes: Routes = [\n  {\n    path: 'search',\n    component: AppSearchComponent\n  }\n];\n\nexport const AppSearchRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { BehaviorSubject } from 'rxjs';\nimport {\n  Component,\n  ElementRef,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport * as proj from 'ol/proj';\n\nimport { LanguageService, MediaService } from '@igo2/core';\nimport { EntityStore, ActionStore } from '@igo2/common';\nimport {\n  FEATURE,\n  Feature,\n  FeatureMotion,\n  GoogleLinks,\n  IgoMap,\n  LayerService,\n  MapService,\n  Layer,\n  ProjectionService,\n  Research,\n  SearchResult,\n  SearchService\n} from '@igo2/geo';\n\nimport { SearchState } from '@igo2/integration';\n\n@Component({\n  selector: 'app-search',\n  templateUrl: './search.component.html',\n  styleUrls: ['./search.component.scss']\n})\nexport class AppSearchComponent implements OnInit, OnDestroy {\n  public store = new ActionStore([]);\n\n  public igoSearchPointerSummaryEnabled: boolean = false;\n\n  public termSplitter: string = '|';\n\n  public map = new IgoMap({\n    overlay: true,\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  public osmLayer: Layer;\n\n  @ViewChild('mapBrowser', { read: ElementRef, static: true }) mapBrowser: ElementRef;\n\n  public lonlat;\n  public mapProjection: string;\n  public term: string;\n\n  public settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  get searchStore(): EntityStore<SearchResult> {\n    return this.searchState.store;\n  }\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  public selectedFeature: Feature;\n\n  constructor(\n    private languageService: LanguageService,\n    private projectionService: ProjectionService,\n    private mapService: MapService,\n    private layerService: LayerService,\n    private searchState: SearchState,\n    private searchService: SearchService,\n    private mediaService: MediaService\n  ) {\n    this.mapService.setMap(this.map);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe(layer => {\n        this.osmLayer = layer;\n        this.map.addLayer(layer);\n      });\n  }\n\n  onPointerSummaryStatusChange(value) {\n    this.igoSearchPointerSummaryEnabled = value;\n  }\n\n  onSearchTermChange(term = '') {\n    this.term = term;\n    const termWithoutHashtag = term.replace(/(#[^\\s]*)/g, '').trim();\n    if (termWithoutHashtag.length < 2) {\n      this.searchStore.clear();\n      this.selectedFeature = undefined;\n    }\n  }\n\n  onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    this.searchStore.state.updateAll({ focused: false, selected: false });\n    const newResults = this.searchStore.entities$.value\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n    this.searchStore.updateMany(newResults);\n  }\n\n  onSearchSettingsChange() {\n    this.settingsChange$.next(true);\n  }\n\n  /**\n   * Try to add a feature to the map when it's being focused\n   * @internal\n   * @param result A search result that could be a feature\n   */\n  onResultFocus(result: SearchResult) {\n    this.tryAddFeatureToMap(result);\n    this.selectedFeature = (result as SearchResult<Feature>).data;\n  }\n\n  /**\n   * Try to add a feature to the map overlay\n   * @param layer A search result that could be a feature\n   */\n  private tryAddFeatureToMap(layer: SearchResult) {\n    if (layer.meta.dataType !== FEATURE) {\n      return undefined;\n    }\n\n    // Somethimes features have no geometry. It happens with some GetFeatureInfo\n    if (layer.data.geometry === undefined) {\n      return;\n    }\n\n    this.map.searchResultsOverlay.setFeatures(\n      [layer.data] as Feature[],\n      FeatureMotion.Default\n    );\n  }\n\n  ngOnInit() {\n    this.store.load([\n      {\n        id: 'coordinates',\n        title: 'coordinates',\n        handler: this.onSearchCoordinate.bind(this)\n      },\n      {\n        id: 'googleMaps',\n        title: 'googleMap',\n        handler: this.onOpenGoogleMaps.bind(this),\n        args: ['1']\n      },\n      {\n        id: 'googleStreetView',\n        title: 'googleStreetView',\n        handler: this.onOpenGoogleStreetView.bind(this)\n      }\n    ]);\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  /*\n   * Remove a feature to the map overlay\n   */\n  removeFeatureFromMap() {\n    this.map.searchResultsOverlay.clear();\n  }\n\n  onContextMenuOpen(event: { x: number; y: number }) {\n    const position = this.mapPosition(event);\n    const coord = this.mapService.getMap().ol.getCoordinateFromPixel(position);\n    this.mapProjection = this.mapService.getMap().projection;\n    this.lonlat = proj.transform(coord, this.mapProjection, 'EPSG:4326');\n  }\n\n  mapPosition(event: { x: number; y: number }) {\n    const contextmenuPoint = event;\n    contextmenuPoint.y =\n      contextmenuPoint.y -\n      this.mapBrowser.nativeElement.getBoundingClientRect().top +\n      window.scrollY;\n    contextmenuPoint.x =\n      contextmenuPoint.x -\n      this.mapBrowser.nativeElement.getBoundingClientRect().left +\n      window.scrollX;\n    const position = [contextmenuPoint.x, contextmenuPoint.y];\n    return position;\n  }\n\n  onPointerSearch(event) {\n    this.lonlat = event;\n    this.onSearchCoordinate();\n  }\n\n  onSearchCoordinate() {\n    this.searchStore.clear();\n    const results = this.searchService.reverseSearch(this.lonlat);\n\n    for (const i in results) {\n      if (results.length > 0) {\n        results[i].request.subscribe((_results: SearchResult<Feature>[]) => {\n          this.onSearch({ research: results[i], results: _results });\n        });\n      }\n    }\n  }\n\n  onOpenGoogleMaps() {\n    window.open(GoogleLinks.getGoogleMapsCoordLink(this.lonlat[0], this.lonlat[1]));\n  }\n\n  onOpenGoogleStreetView() {\n    window.open(\n      GoogleLinks.getGoogleStreetViewLink(this.lonlat[0], this.lonlat[1])\n    );\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoMessageModule } from '@igo2/core';\n\nimport {\n  IgoPanelModule,\n  IgoActionbarModule,\n  IgoContextMenuModule\n} from '@igo2/common';\n\nimport {\n  IgoFeatureModule,\n  IgoMapModule,\n  IgoSearchModule,\n  provideIChercheSearchSource,\n  provideILayerSearchSource,\n  provideNominatimSearchSource,\n  provideIChercheReverseSearchSource,\n  provideCoordinatesReverseSearchSource,\n  provideCadastreSearchSource,\n  provideStoredQueriesSearchSource,\n  provideStoredQueriesReverseSearchSource\n} from '@igo2/geo';\n\nimport { IgoAppSearchModule } from '@igo2/integration';\n\nimport { AppSearchComponent } from './search.component';\nimport { AppSearchRoutingModule } from './search-routing.module';\n\n@NgModule({\n  declarations: [AppSearchComponent],\n  imports: [\n    CommonModule,\n    AppSearchRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    IgoMessageModule.forRoot(),\n    IgoPanelModule,\n    IgoMapModule,\n    IgoSearchModule.forRoot(),\n    IgoAppSearchModule,\n    IgoActionbarModule,\n    IgoContextMenuModule,\n    IgoFeatureModule\n  ],\n  exports: [AppSearchComponent],\n  providers: [\n    provideCoordinatesReverseSearchSource(),\n    provideCadastreSearchSource(),\n    provideIChercheSearchSource(),\n    provideILayerSearchSource(),\n    provideNominatimSearchSource(),\n    provideIChercheReverseSearchSource(),\n    provideStoredQueriesSearchSource(),\n    provideStoredQueriesReverseSearchSource()\n  ]\n})\nexport class AppSearchModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppPrintComponent } from './print.component';\n\nconst routes: Routes = [\n  {\n    path: 'print',\n    component: AppPrintComponent\n  }\n];\n\nexport const AppPrintRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { IgoMap, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-print',\n  templateUrl: './print.component.html',\n  styleUrls: ['./print.component.scss']\n})\nexport class AppPrintComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: false\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 9\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private layerService: LayerService\n  ) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'Quebec Base Map',\n        sourceOptions: {\n          type: 'wmts',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts',\n          layer: 'carte_gouv_qc_ro',\n          matrixSet: 'EPSG_3857',\n          version: '1.3.0',\n          crossOrigin: 'anonymous',\n          attributions: \"© <a href='http://www.droitauteur.gouv.qc.ca/copyright.php' target='_blank'><img src='https://geoegl.msp.gouv.qc.ca/gouvouvert/public/images/quebec/gouv_qc_logo.png' width='64' height='14'>Gouvernement du Québec</a> / <a href='https://www.igouverte.org/' target='_blank'>IGO2</a>\"\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'School board',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          params: {\n            LAYERS: 'MELS_CS_ANGLO_S',\n            VERSION: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n    //\n    this.layerService\n      .createAsyncLayer({\n        title: 'Embacle',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          params: {\n            LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n            VERSION: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    // this.layerService\n    //   .createAsyncLayer({\n    //     title: 'Geomet',\n    //     sourceOptions: {\n    //       type: 'wms',\n    //       url: 'http://geo.weather.gc.ca/geomet/?lang=fr',\n    //       params: {\n    //         LAYERS: 'RADAR_1KM_RDBR',\n    //         VERSION: '1.3.0'\n    //       },\n    //       crossOrigin: 'anonymous'\n    //     }\n    //   })\n    //   .subscribe(l => this.map.addLayer(l));\n\n    /*\n        //CORS error if activate (for test)\n        this.layerService\n          .createAsyncLayer({\n            title: 'Geomet',\n            sourceOptions: {\n              type: 'wms',\n              url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wms',\n              params: {\n                layers: 'swtq',\n                version: '1.3.0',\n              }\n            }\n          })\n          .subscribe(l => this.map.addLayer(l));\n    */\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Print</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/print\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"false\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n  <igo-print [map]=\"map\"></igo-print>\n\n</mat-card>\n\n<igo-message-center></igo-message-center>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport { IgoMapModule, IgoPrintModule } from '@igo2/geo';\n\nimport { AppPrintComponent } from './print.component';\nimport { AppPrintRoutingModule } from './print-routing.module';\n\n@NgModule({\n  declarations: [AppPrintComponent],\n  imports: [\n    AppPrintRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoPrintModule\n  ],\n  exports: [AppPrintComponent]\n})\nexport class AppPrintModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppImportExportComponent } from './import-export.component';\n\nconst routes: Routes = [\n  {\n    path: 'import-export',\n    component: AppImportExportComponent\n  }\n];\n\nexport const AppImportExportRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { IgoMap, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-import-export',\n  templateUrl: './import-export.component.html',\n  styleUrls: ['./import-export.component.scss']\n})\nexport class AppImportExportComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 9\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private layerService: LayerService\n  ) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Import / Export</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/import-export\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-import-export [map]=\"map\"></igo-import-export>\n\n</mat-card>\n\n<igo-message-center></igo-message-center>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport {\n  IgoMapModule,\n  IgoImportExportModule,\n  provideStyleListOptions\n} from '@igo2/geo';\n\nimport { AppImportExportComponent } from './import-export.component';\nimport { AppImportExportRoutingModule } from './import-export-routing.module';\n\n@NgModule({\n  declarations: [AppImportExportComponent],\n  imports: [\n    AppImportExportRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoImportExportModule\n  ],\n  exports: [AppImportExportComponent],\n  providers: [\n    provideStyleListOptions({\n      path: './assets/import-style.json'\n    })\n  ]\n})\nexport class AppImportExport {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppDirectionsComponent } from './directions.component';\n\nconst routes: Routes = [\n  {\n    path: 'directions',\n    component: AppDirectionsComponent\n  }\n];\n\nexport const AppDirectionsRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  LayerService,\n  MapService,\n  ProjectionService,\n  StopsStore,\n  StopsFeatureStore,\n  RoutesFeatureStore,\n  StepFeatureStore\n} from '@igo2/geo';\nimport { Subject } from 'rxjs';\n\n@Component({\n  selector: 'app-directions',\n  templateUrl: './directions.component.html',\n  styleUrls: ['./directions.component.scss']\n})\nexport class AppDirectionsComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 9,\n    geolocate: false\n  };\n\n  public stopsStore: StopsStore = new StopsStore([]);\n  public stopsFeatureStore: StopsFeatureStore = new StopsFeatureStore([], { map: this.map });\n  public stepFeatureStore: StepFeatureStore = new StepFeatureStore([], { map: this.map });\n  public routesFeatureStore: RoutesFeatureStore = new RoutesFeatureStore([], { map: this.map });\n  public zoomToActiveRoute$: Subject<void> = new Subject();\n\n  constructor(\n    private projectionService: ProjectionService,\n    private languageService: LanguageService,\n    private layerService: LayerService,\n    private mapService: MapService\n  ) {\n    this.mapService.setMap(this.map);\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Directions</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/directions\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"false\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n  <igo-directions\n    [stopsStore]=\"stopsStore\"\n    [stopsFeatureStore]=\"stopsFeatureStore\"\n    [stepFeatureStore]=\"stepFeatureStore\"\n    [routesFeatureStore]=\"routesFeatureStore\"\n    [zoomToActiveRoute$]=\"zoomToActiveRoute$\">  \n  </igo-directions>\n\n\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport {\n  IgoMapModule,\n  IgoDirectionsModule,\n  provideOsrmDirectionsSource\n} from '@igo2/geo';\n\nimport { AppDirectionsComponent } from './directions.component';\nimport { AppDirectionsRoutingModule } from './directions-routing.module';\n\n@NgModule({\n  declarations: [AppDirectionsComponent],\n  imports: [\n    AppDirectionsRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoDirectionsModule\n  ],\n  exports: [AppDirectionsComponent],\n  providers: [provideOsrmDirectionsSource()]\n})\nexport class AppDirectionsModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppTimeFilterComponent } from './time-filter.component';\n\nconst routes: Routes = [\n  {\n    path: 'time-filter',\n    component: AppTimeFilterComponent\n  }\n];\n\nexport const AppTimeFilterRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  TimeFilterableDataSourceOptions,\n  TimeFilterType,\n  TimeFilterStyle\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-time-filter',\n  templateUrl: './time-filter.component.html',\n  styleUrls: ['./time-filter.component.scss']\n})\nexport class AppTimeFilterComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    // const datasource: TimeFilterableDataSourceOptions = {\n    //   type: 'wms',\n    //   url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\n    //   params: {\n    //     layers: 'vg_observation_v_inondation_embacle_wmst',\n    //     version: '1.3.0'\n    //   },\n    //   timeFilterable: true,\n    //   timeFilter: {\n    //     min: '2017-01-01',\n    //     max: '2018-01-01',\n    //     range: true,\n    //     type: TimeFilterType.DATETIME,\n    //     style: TimeFilterStyle.SLIDER,\n    //     step: 86400000,\n    //     timeInterval: 2000\n    //   }\n    // };\n\n    const datasourceYear: TimeFilterableDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      },\n      timeFilterable: true,\n      timeFilter: {\n        min: '2013',\n        max: '2019',\n        range: false,\n        type: TimeFilterType.YEAR,\n        style: TimeFilterStyle.SLIDER,\n        step: 1,\n        timeInterval: 2000\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceYear)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle YEAR',\n            visible: true,\n            source: dataSource\n          })\n        );\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Time filter</mat-card-title>\n  <mat-card-content>\n    <li>npm install --save moment@2.22.2</li>\n    <li>npm install --save @mat-datetimepicker/core@3.0.0-beta.0</li>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/time-filter\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Layers\">\n    <igo-time-filter-list [layers]=\"map.layers\"></igo-time-filter-list>\n  </igo-panel>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoFilterModule } from '@igo2/geo';\n\nimport { AppTimeFilterComponent } from './time-filter.component';\nimport { AppTimeFilterRoutingModule } from './time-filter-routing.module';\n\n@NgModule({\n  declarations: [AppTimeFilterComponent],\n  imports: [\n    AppTimeFilterRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoFilterModule\n  ],\n  exports: [AppTimeFilterComponent]\n})\nexport class AppTimeFilterModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppOgcFilterComponent } from './ogc-filter.component';\n\nconst routes: Routes = [\n  {\n    path: 'ogc-filter',\n    component: AppOgcFilterComponent\n  }\n];\n\nexport const AppOgcFilterRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WMSDataSourceOptions,\n  WFSDataSourceOptions,\n  WFSDataSourceOptionsParams,\n  OgcFilterableDataSourceOptions,\n  AnyBaseOgcFilterOptions,\n  OgcFilterOperatorType,\n  OgcFilterDuringOptions\n} from '@igo2/geo';\n\nimport {Fill, Stroke, Circle, Style} from 'ol/style';\n\n@Component({\n  selector: 'app-ogc-filter',\n  templateUrl: './ogc-filter.component.html',\n  styleUrls: ['./ogc-filter.component.scss']\n})\nexport class AppOgcFilterComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const datasource: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'code_municipalite', alias: '# de la municipalitée' },\n        { name: 'date_observation', excludeFromOgcFilters: true },\n        { name: 'urgence', values: ['immédiate', 'inconnue'] }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          logical: 'Or',\n          filters: [\n            {\n              operator: 'PropertyIsEqualTo',\n              propertyName: 'code_municipalite',\n              expression: '10043'\n            },\n            {\n              operator: 'Intersects',\n              geometryName: 'the_geom',\n              wkt_geometry: `MULTIPOLYGON(((\n              -8379441.158019895 5844447.897707146,\n              -8379441.158019895 5936172.331649357,\n              -8134842.66750733 5936172.331649357,\n              -8134842.66750733 5844447.897707146,\n              -8379441.158019895 5844447.897707146\n            ), (\n              -8015003 5942074,\n              -8015003 5780349,\n              -7792364 5780349,\n              -7792364 5942074,\n              -8015003 5942074\n            )))`\n            }\n          ] as AnyBaseOgcFilterOptions[]\n        }\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (PropertyIsEqualTo OR Intersects)',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'orange',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilter: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2016-01-21T00:00:00-05:00',\n            end: '2016-01-26T00:00:00-05:00'\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2016-02-10T00:00:00-05:00',\n      stepDate: 'P2D'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilter)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, Step: P2D)',\n            id: '1',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'red',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n\n    const datasourceDuringFilterTime: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2016-01-01T04:00:00-05:00',\n            end: '2016-01-12T16:00:00-05:00'\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2016-02-14T20:00:00-05:00',\n      stepDate: 'PT4H'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTime)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, Step: PT4H)',\n            id: '2',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'blue',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeMonth: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2016-01-01T00:00:00-05:00',\n            end: '2016-03-31T00:00:00-05:00',\n            displayFormat: 'MMMM'\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2018-12-31T00:00:00-05:00',\n      stepDate: 'P1M'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeMonth)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, Step: P1M)',\n            id: '3',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'yellow',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeYear: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2014-01-01T00:00:00-05:00',\n            end: '2019-12-31T00:00:00-05:00',\n            sliderOptions: {\n              interval: 2000,\n              displayFormat: 'YY'\n            },\n            displayFormat: 'YYYY'\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2014-01-01T00:00:00-05:00',\n      maxDate: '2019-12-31T00:00:00-05:00',\n      stepDate: 'P1Y'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeYear)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, Step: P1Y)',\n            id: '4',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'green',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeInterval: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: 'today - 2 days', // \"now\" can also be used. Instead of midnight, the current time will be used\n            end: 'today', // \"now\" can also be used. Instead of midnight, the current time will be used\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2025-12-31T00:00:00-05:00',\n      stepDate: 'P1D'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeInterval)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, Interval from Now, Step: P1D)',\n            id: '5',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'black',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeRestrictedToStep: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2019-01-01 00:00:00',\n            restrictToStep: true\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2025-12-31T00:00:00-05:00',\n      stepDate: 'P1M'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeRestrictedToStep)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embâcle (During, RestrictToStep, Step: P1M)',\n            id: '6',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'black'\n                }),\n                stroke: new Stroke({\n                  color: 'red',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const wmsOgcFilterOptions: WMSoptions = {\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n        optionsFromCapabilities: true,\n        params: {\n          LAYERS: 'vg_observation_v_inondation23avril2017_wmst',\n          VERSION: '1.3.0'\n        },\n        sourceFields: [\n          { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n        ],\n        ogcFilters: {\n          enabled: true,\n          editable: true,\n          filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation'\n          } as OgcFilterDuringOptions,\n          allowedOperatorsType: OgcFilterOperatorType.Time\n        }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wmsOgcFilterOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Inondation (During, optionsFromCapabilities)',\n            source: dataSource\n          })\n        );\n      });\n\n    interface WMSoptions\n      extends WMSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const filterableWMSwithPushButtons: WMSoptions = {\n      type: 'wms',\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      params: {\n        LAYERS: 'radars_photos',\n        VERSION: '1.3.0'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        pushButtons: {\n          selectorType: 'pushButton',\n          order: 2,\n          groups : [\n            {title: 'Nom du group1 - push', name: '1 - push', ids : ['id1']},\n          ],\n          bundles: [\n            {\n              id: 'id1',\n              title: 'Régions',\n              logical: 'Or',\n              vertical: true,\n              selectors: [\n                {\n                  title: 'Montréal & Laval',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    logical: 'Or',\n                    filters: [\n                      {\n                        operator: 'PropertyIsEqualTo',\n                        propertyName: 'region',\n                        expression: 'Montréal'\n                      },\n                      {\n                        operator: 'PropertyIsEqualTo',\n                        propertyName: 'region',\n                        expression: 'Laval'\n                      }\n                    ]\n                  }\n                },\n                {\n                  title: 'Outside Montréal & Laval',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    logical: 'And',\n                    filters: [\n                      {\n                        operator: 'PropertyIsNotEqualTo',\n                        propertyName: 'region',\n                        expression: 'Montréal'\n                      },\n                      {\n                        operator: 'PropertyIsNotEqualTo',\n                        propertyName: 'region',\n                        expression: 'Laval'\n                      }\n                    ]\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        checkboxes: {\n          selectorType: 'checkbox',\n          order: 1,\n          groups : [\n            {title: 'Nom du group1 - checkbox', name: '1 - checkbox', ids : ['id1']},\n          ],\n          bundles: [\n            {\n              id: 'id1',\n              title: 'Type de radar photo',\n              logical: 'Or',\n              selectors: [\n                {\n                  title: 'Radar photo fixe',\n                  enabled: true,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo fixe'\n                  }\n                },\n                {\n                  title: 'Radar photo mobile',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo mobile'\n                  }\n                },\n                {\n                  title: 'Radar photo fixe + feu rouge',\n                  enabled: false,\n                  color: '0,200,0',\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo fixe et surveillance au feu rouge'\n                  }\n                },\n                {\n                  title: 'Radar feu rouge',\n                  enabled: false,\n                  color: '255,0,0',\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Appareil de surveillance au feu rouge'\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        allowedOperatorsType: OgcFilterOperatorType.Basic\n        },\n      paramsWFS: {\n        featureTypes: 'radars_photos',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '1.1.0',\n        outputFormat: 'geojson',\n        outputFormatDownload: 'shp'\n      } as WFSDataSourceOptionsParams\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(filterableWMSwithPushButtons)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Filterable WMS layers with predefined filters (push buttons)',\n            source: dataSource\n          })\n        );\n      });\n\n    // const datasourceWmsWith2Layers: WMSoptions = {\n    //   type: 'wms',\n    //   url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n    //   urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n    //   params: {\n    //     layers: 'stations_meteoroutieres,histo_stations_meteoroutieres',\n    //     version: '1.3.0'\n    //   },\n    //   ogcFilters: {\n    //     enabled: true,\n    //     editable: true\n    //   },\n    //   paramsWFS: {\n    //     featureTypes: 'histo_stations_meteoroutieres',\n    //     fieldNameGeometry: 'geometry',\n    //     maxFeatures: 10000,\n    //     version: '1.1.0',\n    //     outputFormat: 'geojson',\n    //     outputFormatDownload: 'shp'\n    //   } as WFSDataSourceOptionsParams\n    // };\n    //\n    // this.dataSourceService\n    //   .createAsyncDataSource(datasourceWmsWith2Layers)\n    //   .subscribe(dataSource => {\n    //     this.map.addLayer(\n    //       this.layerService.createLayer({\n    //         title: 'Layer build from 2 WMS layers',\n    //         source: dataSource\n    //       })\n    //     );\n    //   });\n\n    // const datasourceWms: WMSoptions = {\n    //   type: 'wms',\n    //   url: '/geoserver/wms',\n    //   urlWfs: '/geoserver/wfs',\n    //   params: {\n    //     LAYERS: 'water_areas',\n    //     VERSION: '1.3.0'\n    //   },\n    //   ogcFilters: {\n    //     enabled: true,\n    //     editable: true,\n    //     filters: {\n    //       operator: 'PropertyIsEqualTo',\n    //       propertyName: 'waterway',\n    //       expression: 'riverbank'\n    //     }\n    //   },\n    //   sourceFields: [\n    //     { name: 'waterway', alias: 'Chemin d eau' },\n    //     { name: 'osm_id' },\n    //     { name: 'landuse', values: ['yes', 'no'] }\n    //   ],\n    //   paramsWFS: {\n    //     featureTypes: 'water_areas',\n    //     fieldNameGeometry: 'the_geom',\n    //     maxFeatures: 10000,\n    //     version: '1.1.0',\n    //     outputFormat: 'application/json',\n    //     outputFormatDownload: 'application/vnd.google-earth.kml+xml'\n    //   } as WFSDataSourceOptionsParams\n    // };\n    //\n    // this.dataSourceService\n    //   .createAsyncDataSource(datasourceWms)\n    //   .subscribe(dataSource => {\n    //     this.map.addLayer(\n    //       this.layerService.createLayer({\n    //         title: 'Geoserver water_areas',\n    //         source: dataSource\n    //       })\n    //     );\n    //   });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Ogc filter</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/ogc-filter\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Layers\">\n    <igo-ogc-filterable-list [map]=\"map\" [layers]=\"map.layers\">\n\n    </igo-ogc-filterable-list>\n  </igo-panel>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoFilterModule } from '@igo2/geo';\n\nimport { AppOgcFilterComponent } from './ogc-filter.component';\nimport { AppOgcFilterRoutingModule } from './ogc-filter-routing.module';\n\n@NgModule({\n  declarations: [AppOgcFilterComponent],\n  imports: [\n    AppOgcFilterRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoFilterModule\n  ],\n  exports: [AppOgcFilterComponent]\n})\nexport class AppOgcFilterModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Spatial filter</mat-card-title>\n  <mat-card-content>\n    <li>npm install --save moment@2.22.2</li>\n    <li>npm install --save @mat-datetimepicker/core@3.0.0-beta.0</li>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/spatial-filter\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser\n    [map]=\"map\"\n    [view]=\"view\"\n    igoOverlay igoQuery\n    (query)=\"handleQueryResults($event)\"\n    [queryFeatures]=\"true\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Spatial Filter\">\n    <igo-spatial-filter-type\n      [store]=\"spatialListStore\"\n      [selectedQueryType]=\"queryType\"\n      [zone]=\"zone\"\n      (eventType)=\"getOutputType($event)\"\n      (eventQueryType)=\"getOutputQueryType($event)\"\n      (zoneChange)=\"onZoneChange($event)\">\n    </igo-spatial-filter-type>\n\n    <igo-spatial-filter-item\n      [type]=\"type\"\n      [queryType]=\"queryType\"\n      [map]=\"map\"\n      [zone]=\"zone\"\n      [loading]=\"loading\"\n      [store]=\"store\"\n      [layers]=\"layers\"\n      (radiusEvent)=\"radius = $event\"\n      (freehandControl)=\"freehandDrawIsActive = $event\"\n      (drawZoneEvent)=\"zone = $event\"\n      (itemTypeChange)=\"itemType = $event\"\n      (thematicChange)=\"thematics = $event\"\n      (toggleSearch)=\"getOutputToggleSearch()\"\n      (clearButtonEvent)=\"layers = $event\"\n      (clearSearchEvent)=\"getOutputClearSearch()\">\n    </igo-spatial-filter-item>\n  </igo-panel>\n\n  <igo-panel title=\"Details\">\n    <ng-container *ngIf=\"selectedFeature$ | async as feature\">\n      <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n    </ng-container>\n  </igo-panel>\n\n  <igo-message-center></igo-message-center>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppSpatialFilterComponent } from './spatial-filter.component';\n\nconst routes: Routes = [\n  {\n    path: 'spatial-filter',\n    component: AppSpatialFilterComponent\n  }\n];\n\nexport const AppSpatialFilterRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, Input } from '@angular/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  Feature,\n  moveToOlFeatures,\n  FeatureMotion,\n  ClusterDataSource,\n  featureToOl,\n  DataSource,\n  QueryableDataSourceOptions,\n  Layer,\n  SpatialFilterService,\n  SpatialFilterQueryType,\n  SpatialFilterType,\n  SpatialFilterItemType,\n  SpatialFilterThematic\n} from '@igo2/geo';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { EntityStore } from '@igo2/common';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\nimport { BehaviorSubject } from 'rxjs';\nimport * as olstyle from 'ol/style';\nimport olSourceCluster from 'ol/source/Cluster';\nimport olSourceVector from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Component({\n  selector: 'app-spatial-filter',\n  templateUrl: './spatial-filter.component.html',\n  styleUrls: ['./spatial-filter.component.scss']\n})\nexport class AppSpatialFilterComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  view = {\n    center: [-71.9, 46.9],\n    zoom: 10\n  };\n\n  @Input() type: SpatialFilterType;\n  @Input() itemType: SpatialFilterItemType = SpatialFilterItemType.Address;\n  @Input() freehandDrawIsActive: boolean;\n\n  public layers: Layer[] = [];\n\n  public queryType: SpatialFilterQueryType;\n  public thematics: SpatialFilterThematic[];\n  public zone: Feature;\n  public radius: number;\n\n  public selectedFeature$: BehaviorSubject<Feature> = new BehaviorSubject(\n    undefined\n  );\n\n  private format = new olFormatGeoJSON();\n\n  public store = new EntityStore<Feature>([]); // Store to print results at the end\n\n  public spatialListStore = new EntityStore<Feature>([]);\n\n  public loading = false;\n\n  constructor(\n    private spatialFilterService: SpatialFilterService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private messageService: MessageService,\n    private languageService: LanguageService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          })\n        );\n      });\n  }\n\n  getOutputType(event: SpatialFilterType) {\n    this.type = event;\n    this.queryType = undefined;\n    this.radius = undefined;\n  }\n\n  getOutputQueryType(event: SpatialFilterQueryType) {\n    this.queryType = event;\n    if (this.queryType) {\n      this.loadFilterList();\n    }\n  }\n\n  private loadFilterList() {\n    this.spatialFilterService\n      .loadFilterList(this.queryType)\n      .subscribe((features: Feature[]) => {\n        features.sort((a, b) => {\n          if (a.properties.nom < b.properties.nom) {\n            return -1;\n          }\n          if (a.properties.nom > b.properties.nom) {\n            return 1;\n          }\n          return 0;\n        });\n        this.spatialListStore.clear();\n        this.spatialListStore.load(features);\n      });\n  }\n\n  getOutputToggleSearch() {\n    this.loadThematics();\n  }\n\n  getOutputClearSearch() {\n    this.zone = undefined;\n    this.queryType = undefined;\n  }\n\n  private loadThematics() {\n    this.loading = true;\n    this.tryAddFeaturesToMap([this.zone]);\n    if (!this.thematics) {\n      const theme: SpatialFilterThematic = {\n        name: ''\n      };\n      this.thematics = [theme];\n    }\n    if (this.type === SpatialFilterType.Polygon) {\n      this.radius = undefined;\n    }\n    this.thematics.forEach(thematic => {\n      this.spatialFilterService\n        .loadFilterItem(\n          this.zone,\n          this.itemType,\n          this.queryType,\n          thematic,\n          this.radius\n        )\n        .subscribe((features: Feature[]) => {\n          this.store.insertMany(features);\n          const featuresPoint: Feature[] = [];\n          const featuresLinePoly: Feature[] = [];\n          let idPoint;\n          let idLinePoly;\n          features.forEach(feature => {\n            if (feature.geometry.type === 'Point') {\n              featuresPoint.push(feature);\n              idPoint = feature.meta.id;\n            } else {\n              featuresLinePoly.push(feature);\n              idLinePoly = feature.meta.id;\n            }\n          });\n          this.tryAddPointToMap(featuresPoint, idPoint);\n          this.tryAddLayerToMap(featuresLinePoly, idLinePoly);\n          this.loading = false;\n          if (features.length >= 10000) {\n            this.messageService.alert(\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.maxSizeAlert'\n              ),\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.warning'\n              ),\n              { timeOut: 10000 }\n            );\n          }\n          if (!features.length) {\n            this.messageService.alert(\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.zeroResults'\n              ),\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.warning'\n              ),\n              { timeOut: 10000 }\n            );\n          }\n        });\n    });\n  }\n\n  onZoneChange(feature: Feature) {\n    this.zone = feature;\n    if (feature) {\n      this.tryAddFeaturesToMap([feature]);\n      this.zoomToFeatureExtent(feature);\n    }\n  }\n\n  /**\n   * Try to add zone feature to the map overlay\n   */\n  public tryAddFeaturesToMap(features: Feature[]) {\n    let i = 1;\n    for (const feature of features) {\n      if (this.type === SpatialFilterType.Predefined) {\n        for (const layer of this.map.layers) {\n          if (\n            layer.options._internal &&\n            layer.options._internal.code === feature.properties.code\n          ) {\n            return;\n          }\n          if (layer.title.startsWith('Zone')) {\n            this.map.removeLayer(layer);\n          }\n        }\n      }\n      for (const layer of this.map.layers) {\n        if (layer.title.startsWith('Zone')) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .subscribe((dataSource: DataSource) => {\n          const olLayer = this.layerService.createLayer({\n            title: ('Zone ' + i) as string,\n            _internal: {\n              code:\n                this.type === SpatialFilterType.Predefined\n                  ? feature.properties.code\n                  : undefined\n            },\n            source: dataSource,\n            visible: true,\n            style: (_feature, resolution) => {\n              const coordinates = (features[0] as any).coordinates;\n              return new olstyle.Style({\n                image: new olstyle.Circle({\n                  radius: coordinates\n                    ? this.radius /\n                      Math.cos((Math.PI / 180) * coordinates[1]) /\n                      resolution\n                    : undefined,\n                  fill: new olstyle.Fill({\n                    color: 'rgba(200, 200, 20, 0.2)'\n                  }),\n                  stroke: new olstyle.Stroke({\n                    width: 1,\n                    color: 'orange'\n                  })\n                }),\n                stroke: new olstyle.Stroke({\n                  width: 1,\n                  color: 'orange'\n                }),\n                fill: new olstyle.Fill({\n                  color: 'rgba(200, 200, 20, 0.2)'\n                })\n              });\n            }\n          });\n          const featuresOl = features.map(f => {\n            return featureToOl(f, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceVector<OlGeometry> | olSourceCluster;\n          ol.addFeatures(featuresOl);\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n        });\n    }\n  }\n\n  /**\n   * Try to point features to the map\n   * Necessary to create clusters\n   */\n  private tryAddPointToMap(features: Feature[], id) {\n    let i = 1;\n    if (features.length >= 1) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.map.layers) {\n        if (layer.title.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'cluster',\n          id,\n          queryable: true,\n          distance: 120,\n          meta: {\n            title: 'Cluster'\n          }\n        } as QueryableDataSourceOptions)\n        .subscribe((dataSource: ClusterDataSource) => {\n          const olLayer = this.layerService.createLayer({\n            title: (features[0].meta.title + ' ' + i) as string,\n            source: dataSource,\n            visible: true,\n            clusterParam: {\n              clusterRanges: [{ minRadius: 1, maxRadius: 5, style: {} }]\n            }\n          });\n          const featuresOl = features.map(feature => {\n            return featureToOl(feature, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceCluster;\n          ol.getSource().addFeatures(featuresOl);\n          if (this.map.layers.find(layer => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.map.layers.find(layer => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title + ' ' + i) as string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n        });\n    }\n  }\n\n  /**\n   * Try to add line or polygon features to the map\n   */\n  private tryAddLayerToMap(features: Feature[], id) {\n    let i = 1;\n    if (features.length > 1) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.map.layers) {\n        if (layer.title.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          id,\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .subscribe((dataSource: DataSource) => {\n          const olLayer = this.layerService.createLayer({\n            title: (features[0].meta.title + ' ' + i) as string,\n            source: dataSource,\n            visible: true\n          });\n          const featuresOl = features.map(feature => {\n            return featureToOl(feature, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceVector<OlGeometry> | olSourceCluster;\n          ol.addFeatures(featuresOl);\n          if (this.map.layers.find(layer => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.map.layers.find(layer => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title + ' ' + i) as string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n        });\n    }\n  }\n\n  zoomToFeatureExtent(feature) {\n    if (feature) {\n      const olFeature = this.format.readFeature(feature, {\n        dataProjection: feature.projection,\n        featureProjection: this.map.projection\n      });\n      moveToOlFeatures(this.map, [olFeature], FeatureMotion.Zoom);\n    }\n  }\n\n  /**\n   * Permit the query action on one item result\n   */\n  handleQueryResults(results) {\n    const features: Feature[] = results.features;\n    let feature;\n    if (features.length) {\n      feature = features[0];\n    }\n    this.selectedFeature$.next(feature);\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule, IgoFormModule } from '@igo2/common';\nimport { IgoMapModule, IgoFilterModule, IgoQueryModule, IgoFeatureModule, IgoFeatureDetailsModule } from '@igo2/geo';\nimport { IgoMessageModule } from '@igo2/core';\n\nimport { AppSpatialFilterComponent } from './spatial-filter.component';\nimport { AppSpatialFilterRoutingModule } from './spatial-filter-routing.module';\n\n@NgModule({\n  declarations: [AppSpatialFilterComponent],\n  imports: [\n    AppSpatialFilterRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoMessageModule,\n    IgoQueryModule,\n    IgoFeatureModule,\n    IgoFeatureDetailsModule,\n    IgoFilterModule,\n    IgoFormModule,\n    CommonModule\n  ],\n  exports: [AppSpatialFilterComponent]\n})\nexport class AppSpatialFilterModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Workspace</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/workspace\">code of this example</a>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-workspace-selector\n    igoWorkspaceSelector\n    [store]=\"workspaceStore\"\n    [map]=\"map\">\n  </igo-workspace-selector>\n\n  <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\n    <igo-entity-table-paginator\n      *ngIf=\"workspace.inResolutionRange$ | async\"\n      [store]=\"workspace.entityStore\"\n      [paginatorOptions]=\"paginatorOptions\"\n      [entitySortChange$]=\"entitySortChange$\"\n      (paginatorChange)=\"paginatorChange($event)\">\n    </igo-entity-table-paginator>\n  </ng-container>\n\n  <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\n    <igo-actionbar\n      *ngIf=\"workspace.actionStore\"\n      [store]=\"workspace.actionStore\"\n      [horizontal]=\"true\"\n      [withToggleButton]=\"true\"\n      [withTitle]=\"true\"\n      [mode]=\"actionbarMode\">\n    </igo-actionbar>\n\n    <igo-entity-table\n      *ngIf=\"workspace.entityStore && workspace.meta && workspace.meta.tableTemplate && (workspace.inResolutionRange$ | async)\"\n      class=\"table-compact table-centered\"\n      [paginator]=\"workspacePaginator\"\n      [scrollBehavior]=\"scrollBehavior\"\n      [store]=\"workspace.entityStore\"\n      [template]=\"workspace.meta.tableTemplate\">\n    </igo-entity-table>\n    <mat-card-content\n    *ngIf=\"(workspace.inResolutionRange$ | async) === false\">\n      No data available at this scale. Please zoom in. \n    </mat-card-content>\n\n    <igo-workspace-widget-outlet [workspace]=\"workspace\"></igo-workspace-widget-outlet>\n\n  </ng-container>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppWorkspaceComponent } from './workspace.component';\n\nconst routes: Routes = [\n  {\n    path: 'workspace',\n    component: AppWorkspaceComponent\n  }\n];\n\nexport const AppWorkspaceRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit } from '@angular/core';\n\nimport { Observable, BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  ActionbarMode,\n  EntityRecord,\n  EntityTableScrollBehavior,\n  Workspace,\n  WorkspaceStore,\n  EntityTablePaginatorOptions\n} from '@igo2/common';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WFSDataSourceOptions\n} from '@igo2/geo';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { WorkspaceState } from '@igo2/integration';\n\n@Component({\n  selector: 'app-workspace',\n  templateUrl: './workspace.component.html',\n  styleUrls: ['./workspace.component.scss']\n})\nexport class AppWorkspaceComponent implements OnInit {\n\n  public workspacePaginator: MatPaginator;\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public paginatorOptions: EntityTablePaginatorOptions = {\n    pageSize: 5, // Number of items to display on a page.\n    pageSizeOptions: [1, 5, 10, 15, 30, 50, 100], // The set of provided page size options to display to the user.\n    showFirstLastButtons: true // Whether to show the first/last buttons UI to the user.\n  };\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-72, 47.2],\n    zoom: 5\n  };\n\n  get workspaceStore(): WorkspaceStore {\n    return this.workspaceState.store;\n  }\n\n  public selectedWorkspace$: Observable<Workspace>;\n\n  public actionbarMode = ActionbarMode.Overlay;\n\n  public scrollBehavior = EntityTableScrollBehavior.Instant;\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    public workspaceState: WorkspaceState,\n  ) {}\n\n  ngOnInit() {\n    this.selectedWorkspace$ = this.workspaceStore.stateView\n      .firstBy$(\n        (record: EntityRecord<Workspace>) => record.state.selected === true\n      )\n      .pipe(\n        map((record: EntityRecord<Workspace>) => {\n          const entity = record === undefined ? undefined : record.entity;\n          if (entity) {\n            // In fact, the download action is not fully functionnal into the igo2-lib demo\n            // The reason why it's has been remove is that this button trigger a tool (importExport)\n            // and this tool is not available in the igo2-lib demo.\n            // This is why it's has been removed frome the actions's list.\n            // Refer to the igo2 demo at https://infra-geo-ouverte.github.io/igo2/\n            entity.actionStore.view.filter((action) => {\n              return action.id !== 'wfsDownload';\n            });\n          }\n          return entity;\n\n        })\n      );\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    // const wmsDataSourceOptions = {\n    //   type: 'wms',\n    //   url: 'https://ahocevar.com/geoserver/wms',\n    //   urlWfs: 'https://ahocevar.com/geoserver/wfs',\n    //   params: {\n    //     LAYERS: 'water_areas',\n    //     VERSION: '1.3.0'\n    //   },\n    //   paramsWFS: {\n    //     featureTypes: 'water_areas',\n    //     fieldNameGeometry: 'the_geom',\n    //     maxFeatures: 10000,\n    //     version: '1.1.0',\n    //     outputFormat: 'application/json',\n    //     outputFormatDownload: 'application/vnd.google-earth.kml+xml'\n    //   },\n    //   sourceFields: [\n    //     {name: 'waterway', alias: 'Chemin d eau'},\n    //     {name: 'osm_id'},\n    //     {name: 'landuse'}\n    //   ],\n    //   ogcFilters: {\n    //     enabled: true,\n    //     editable: true\n    //   },\n    //   serverType: 'geoserver'\n    // };\n    //\n    // this.dataSourceService\n    //   .createAsyncDataSource(wmsDataSourceOptions as OgcFilterableDataSourceOptions)\n    //   .subscribe(dataSource => {\n    //     const layer = {\n    //       optionsFromCapabilities: true,\n    //       title: 'WMS Geoserver filterable ',\n    //       visible: true,\n    //       source: dataSource\n    //     };\n    //     this.map.addLayer(this.layerService.createLayer(layer));\n    //   });\n\n    const wfsDataSourceOptions: WFSDataSourceOptions = {\n      type: 'wfs',\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      params: {\n        featureTypes: 'etablissement_mtq',\n        fieldNameGeometry: 'geometry',\n        version: '2.0.0',\n        outputFormat: 'geojson'\n      },\n      sourceFields: [\n        { name: 'idetablis', alias: 'ID' },\n        { name: 'nometablis', alias: 'Name' },\n        { name: 'typetablis', alias: 'Type' }\n      ]\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDataSourceOptions)\n      .subscribe(dataSource => {\n        const layer = {\n          title: 'Simple WFS ',\n          maxResolution: 3000,\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.workspacePaginator = event;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport {\n  IgoActionModule,\n  IgoEntityModule,\n  IgoWorkspaceModule,\n  IgoPanelModule\n} from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoGeoWorkspaceModule\n} from '@igo2/geo';\n\nimport { AppWorkspaceComponent } from './workspace.component';\nimport { AppWorkspaceRoutingModule } from './workspace-routing.module';\n\n@NgModule({\n  declarations: [AppWorkspaceComponent],\n  imports: [\n    CommonModule,\n    AppWorkspaceRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoActionModule,\n    IgoEntityModule,\n    IgoWorkspaceModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoGeoWorkspaceModule\n  ],\n  exports: [AppWorkspaceComponent]\n})\nexport class AppWorkspaceModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Context</mat-card-title>\n  <mat-card-content>\n    <p>* Dependencies: LanguageService</p>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/context/context\">code of this example</a><br>\n    See <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/contexts\"> contexts</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser\n    igoMapContext\n    igoLayerContext\n    [map]=\"map\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"true\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Contexts list\">\n    <igo-context-list igoContextListBinding [map]=\"map\"></igo-context-list>\n  </igo-panel>\n\n  <igo-panel title=\"Layers\">\n    <igo-layer-list igoLayerListBinding [map]=\"map\">\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n      </ng-template>\n    </igo-layer-list>\n  </igo-panel>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppContextComponent } from './context.component';\n\nconst routes: Routes = [\n  {\n    path: 'context',\n    component: AppContextComponent\n  }\n];\n\nexport const AppContextRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { IgoMap, OverlayService, MapService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-context',\n  templateUrl: './context.component.html',\n  styleUrls: ['./context.component.scss']\n})\nexport class AppContextComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private mapService: MapService,\n    private overlayService: OverlayService\n  ) {\n    this.mapService.setMap(this.map);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\nimport { HttpClientJsonpModule } from '@angular/common/http';\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoMetadataModule,\n  IgoOverlayModule,\n  IgoQueryModule,\n  IgoFeatureModule\n} from '@igo2/geo';\nimport { IgoContextManagerModule } from '@igo2/context';\n\nimport { AppContextComponent } from './context.component';\nimport { AppContextRoutingModule } from './context-routing.module';\n\n@NgModule({\n  declarations: [AppContextComponent],\n  imports: [\n    HttpClientJsonpModule,\n    AppContextRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoMetadataModule,\n    IgoOverlayModule,\n    IgoQueryModule,\n    IgoFeatureModule,\n    IgoContextManagerModule\n  ],\n  exports: [AppContextComponent]\n})\nexport class AppContextModule {}\n","import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\n\nconst routes: Routes = [\n  { path: '', redirectTo: '/home', pathMatch: 'full' },\n  { path: '**', redirectTo: '/home' }\n];\n\n@NgModule({\n  imports: [RouterModule.forRoot(routes, { useHash: true })],\n  exports: [RouterModule]\n})\nexport class AppRoutingModule {}\n","import { MediaMatcher } from '@angular/cdk/layout';\nimport {\n  ChangeDetectorRef,\n  Component,\n  OnDestroy,\n  Renderer2\n} from '@angular/core';\n\nimport { userAgent } from '@igo2/utils';\nimport { version } from '@igo2/core';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.scss']\n})\nexport class AppComponent implements OnDestroy {\n  mobileQuery: MediaQueryList;\n\n  public title = 'IGO';\n  public version = version;\n  private themeClass = 'deeppurple-theme';\n  private _mobileQueryListener: () => void;\n\n  constructor(\n    private changeDetectorRef: ChangeDetectorRef,\n    private media: MediaMatcher,\n    private renderer: Renderer2\n  ) {\n    this.mobileQuery = media.matchMedia('(max-width: 600px)');\n    this._mobileQueryListener = () => changeDetectorRef.detectChanges();\n    this.mobileQuery.addEventListener('change', this._mobileQueryListener);\n\n    this.renderer.addClass(document.body, this.themeClass);\n\n    this.detectOldBrowser();\n  }\n\n  ngOnDestroy(): void {\n    this.mobileQuery.removeEventListener('change', this._mobileQueryListener);\n  }\n\n  private detectOldBrowser() {\n    const oldBrowser = userAgent.satisfies({\n      ie: '<11',\n      chrome: '<64',\n      firefox: '<60'\n    });\n\n    if (oldBrowser) {\n      console.log('Very old browser ! ', userAgent.getBrowser());\n    }\n  }\n}\n","<div class=\"example-container\" [class.example-is-mobile]=\"mobileQuery.matches\">\n  <mat-toolbar color=\"primary\" class=\"example-toolbar\">\n    <button mat-icon-button (click)=\"snav.toggle()\"><mat-icon svgIcon=\"menu\"></mat-icon></button>\n    <h1>{{title}}</h1>\n    <h5>{{version.lib}}</h5>\n  </mat-toolbar>\n\n  <mat-sidenav-container class=\"example-sidenav-container\" [style.marginTop.px]=\"mobileQuery.matches ? 56 : 0\">\n    <mat-sidenav #snav opened=\"true\" [mode]=\"mobileQuery.matches ? 'over' : 'side'\" [fixedInViewport]=\"mobileQuery.matches\" fixedTopGap=\"56\">\n      <mat-nav-list>\n        <a mat-list-item routerLink=\".\">Home</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"activity\">Activity</a>\n        <a mat-list-item routerLink=\"config\">Config</a>\n        <a mat-list-item routerLink=\"language\">Language</a>\n        <a mat-list-item routerLink=\"media\">Media</a>\n        <a mat-list-item routerLink=\"message\">Message</a>\n        <a mat-list-item routerLink=\"request\">Request</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"auth-form\">Authentification</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"action\">Action</a>\n        <a mat-list-item routerLink=\"dynamic-component\">Dynamic Component</a>\n        <a mat-list-item routerLink=\"entity-table\">Entity Table</a>\n        <a mat-list-item routerLink=\"entity-selector\">Entity Selector</a>\n        <a mat-list-item routerLink=\"form\">Form</a>\n        <a mat-list-item routerLink=\"table\">Table</a>\n        <a mat-list-item routerLink=\"tool\">Tool</a>\n        <a mat-list-item routerLink=\"widget\">Widget</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"simple-map\">Simple map</a>\n        <a mat-list-item routerLink=\"layer\">Layer</a>\n        <a mat-list-item routerLink=\"legend\">Legend</a>\n        <a mat-list-item routerLink=\"overlay\">Overlay</a>\n        <a mat-list-item routerLink=\"geometry\">Geometry</a>\n        <a mat-list-item routerLink=\"feature\">Feature</a>\n        <a mat-list-item routerLink=\"hover\">Hover</a>\n        <a mat-list-item routerLink=\"measure\">Measure</a>\n        <a mat-list-item routerLink=\"draw\">Draw</a>\n        <a mat-list-item routerLink=\"query\">Query</a>\n        <a mat-list-item routerLink=\"catalog\">Catalog</a>\n        <a mat-list-item routerLink=\"search\">Search</a>\n        <a mat-list-item routerLink=\"print\">Print</a>\n        <a mat-list-item routerLink=\"import-export\">Import/Export</a>\n        <a mat-list-item routerLink=\"directions\">Directions</a>\n        <a mat-list-item routerLink=\"time-filter\">Time filter</a>\n        <a mat-list-item routerLink=\"ogc-filter\">OGC filter</a>\n        <a mat-list-item routerLink=\"spatial-filter\">Spatial filter</a>\n        <a mat-list-item routerLink=\"workspace\">Workspace</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"context\">Context</a>\n\n      </mat-nav-list>\n    </mat-sidenav>\n\n    <mat-sidenav-content>\n      <router-outlet></router-outlet>\n    </mat-sidenav-content>\n\n  </mat-sidenav-container>\n</div>\n","import { BrowserModule, DomSanitizer } from '@angular/platform-browser';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\nimport { NgModule } from '@angular/core';\nimport { HammerModule } from '@angular/platform-browser';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconRegistry, MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSidenavModule } from '@angular/material/sidenav';\nimport { MatToolbarModule } from '@angular/material/toolbar';\nimport { AppHomeModule } from './core/home/home.module';\nimport { AppActivityModule } from './core/activity/activity.module';\nimport { AppConfigModule } from './core/config/config.module';\nimport { AppLanguageModule } from './core/language/language.module';\nimport { AppMediaModule } from './core/media/media.module';\nimport { AppMessageModule } from './core/message/message.module';\nimport { AppRequestModule } from './core/request/request.module';\n\nimport { AppActionModule } from './common/action/action.module';\nimport { AppDynamicComponentModule } from './common/dynamic-component/dynamic-component.module';\nimport { AppEntityTableModule } from './common/entity-table/entity-table.module';\nimport { AppEntitySelectorModule } from './common/entity-selector/entity-selector.module';\nimport { AppFormModule } from './common/form/form.module';\nimport { AppTableModule } from './common/table/table.module';\nimport { AppToolModule } from './common/tool/tool.module';\nimport { AppWidgetModule } from './common/widget/widget.module';\n\nimport { AppAuthFormModule } from './auth/auth-form/auth-form.module';\n\nimport { AppSimpleMapModule } from './geo/simple-map/simple-map.module';\nimport { AppLayerModule } from './geo/layer/layer.module';\nimport { AppLegendModule } from './geo/legend/legend.module';\nimport { AppOverlayModule } from './geo/overlay/overlay.module';\nimport { AppGeometryModule } from './geo/geometry/geometry.module';\nimport { AppFeatureModule } from './geo/feature/feature.module';\nimport { AppHoverModule } from './geo/hover/hover.module';\nimport { AppMeasureModule } from './geo/measure/measure.module';\nimport { AppDrawModule } from './geo/draw/draw.module';\nimport { AppQueryModule } from './geo/query/query.module';\nimport { AppCatalogModule } from './geo/catalog/catalog.module';\nimport { AppSearchModule } from './geo/search/search.module';\nimport { AppPrintModule } from './geo/print/print.module';\nimport { AppImportExport } from './geo/import-export/import-export.module';\nimport { AppDirectionsModule } from './geo/directions/directions.module';\nimport { AppTimeFilterModule } from './geo/time-filter/time-filter.module';\nimport { AppOgcFilterModule } from './geo/ogc-filter/ogc-filter.module';\nimport { AppSpatialFilterModule } from './geo/spatial-filter/spatial-filter.module';\nimport { AppWorkspaceModule } from './geo/workspace/workspace.module';\n\nimport { AppContextModule } from './context/context/context.module';\n\nimport { AppRoutingModule } from './app-routing.module';\nimport { AppComponent } from './app.component';\n\n@NgModule({\n  declarations: [AppComponent],\n  imports: [\n    BrowserModule,\n    BrowserAnimationsModule,\n    MatSidenavModule,\n    MatToolbarModule,\n    MatButtonModule,\n    MatIconModule,\n    MatListModule,\n\n    AppHomeModule,\n    AppActivityModule,\n    AppConfigModule,\n    AppLanguageModule,\n    AppMediaModule,\n    AppMessageModule,\n    AppRequestModule,\n\n    AppActionModule,\n    AppDynamicComponentModule,\n    AppEntityTableModule,\n    AppEntitySelectorModule,\n    AppFormModule,\n    AppTableModule,\n    AppToolModule,\n    AppWidgetModule,\n\n    AppAuthFormModule,\n\n    AppSimpleMapModule,\n    AppLayerModule,\n    AppLegendModule,\n    AppOverlayModule,\n    AppGeometryModule,\n    AppFeatureModule,\n    AppHoverModule,\n    AppMeasureModule,\n    AppDrawModule,\n    AppQueryModule,\n    AppCatalogModule,\n    AppSearchModule,\n    AppPrintModule,\n    AppImportExport,\n    AppDirectionsModule,\n    AppTimeFilterModule,\n    AppOgcFilterModule,\n    AppSpatialFilterModule,\n    AppWorkspaceModule,\n\n    AppContextModule,\n\n    AppRoutingModule,\n\n    HammerModule\n  ],\n  bootstrap: [AppComponent]\n})\nexport class AppModule {\n  constructor(matIconRegistry: MatIconRegistry, domSanitizer: DomSanitizer) {\n    matIconRegistry.addSvgIconSet(\n      domSanitizer.bypassSecurityTrustResourceUrl(\n        './assets/igo2/core/icons/mdi.svg'\n      )\n    );\n  }\n}\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nimport 'hammerjs';\n\nif (environment.production) {\n  enableProdMode();\n}\n\nplatformBrowserDynamic()\n  .bootstrapModule(AppModule)\n  .catch(err => console.log(err));\n","var map = {\n\t\"./af\": 62275,\n\t\"./af.js\": 62275,\n\t\"./ar\": 90857,\n\t\"./ar-dz\": 11218,\n\t\"./ar-dz.js\": 11218,\n\t\"./ar-kw\": 14754,\n\t\"./ar-kw.js\": 14754,\n\t\"./ar-ly\": 66680,\n\t\"./ar-ly.js\": 66680,\n\t\"./ar-ma\": 92178,\n\t\"./ar-ma.js\": 92178,\n\t\"./ar-sa\": 56522,\n\t\"./ar-sa.js\": 56522,\n\t\"./ar-tn\": 95682,\n\t\"./ar-tn.js\": 95682,\n\t\"./ar.js\": 90857,\n\t\"./az\": 70164,\n\t\"./az.js\": 70164,\n\t\"./be\": 79774,\n\t\"./be.js\": 79774,\n\t\"./bg\": 60947,\n\t\"./bg.js\": 60947,\n\t\"./bm\": 21832,\n\t\"./bm.js\": 21832,\n\t\"./bn\": 89650,\n\t\"./bn-bd\": 74477,\n\t\"./bn-bd.js\": 74477,\n\t\"./bn.js\": 89650,\n\t\"./bo\": 66005,\n\t\"./bo.js\": 66005,\n\t\"./br\": 98492,\n\t\"./br.js\": 98492,\n\t\"./bs\": 70534,\n\t\"./bs.js\": 70534,\n\t\"./ca\": 52061,\n\t\"./ca.js\": 52061,\n\t\"./cs\": 84737,\n\t\"./cs.js\": 84737,\n\t\"./cv\": 61167,\n\t\"./cv.js\": 61167,\n\t\"./cy\": 77996,\n\t\"./cy.js\": 77996,\n\t\"./da\": 9528,\n\t\"./da.js\": 9528,\n\t\"./de\": 14540,\n\t\"./de-at\": 49430,\n\t\"./de-at.js\": 49430,\n\t\"./de-ch\": 67978,\n\t\"./de-ch.js\": 67978,\n\t\"./de.js\": 14540,\n\t\"./dv\": 83426,\n\t\"./dv.js\": 83426,\n\t\"./el\": 6616,\n\t\"./el.js\": 6616,\n\t\"./en-au\": 63816,\n\t\"./en-au.js\": 63816,\n\t\"./en-ca\": 32162,\n\t\"./en-ca.js\": 32162,\n\t\"./en-gb\": 83305,\n\t\"./en-gb.js\": 83305,\n\t\"./en-ie\": 61954,\n\t\"./en-ie.js\": 61954,\n\t\"./en-il\": 43060,\n\t\"./en-il.js\": 43060,\n\t\"./en-in\": 59923,\n\t\"./en-in.js\": 59923,\n\t\"./en-nz\": 13540,\n\t\"./en-nz.js\": 13540,\n\t\"./en-sg\": 16505,\n\t\"./en-sg.js\": 16505,\n\t\"./eo\": 41907,\n\t\"./eo.js\": 41907,\n\t\"./es\": 86640,\n\t\"./es-do\": 41246,\n\t\"./es-do.js\": 41246,\n\t\"./es-mx\": 56131,\n\t\"./es-mx.js\": 56131,\n\t\"./es-us\": 36430,\n\t\"./es-us.js\": 36430,\n\t\"./es.js\": 86640,\n\t\"./et\": 62551,\n\t\"./et.js\": 62551,\n\t\"./eu\": 32711,\n\t\"./eu.js\": 32711,\n\t\"./fa\": 54572,\n\t\"./fa.js\": 54572,\n\t\"./fi\": 33390,\n\t\"./fi.js\": 33390,\n\t\"./fil\": 87860,\n\t\"./fil.js\": 87860,\n\t\"./fo\": 48216,\n\t\"./fo.js\": 48216,\n\t\"./fr\": 99291,\n\t\"./fr-ca\": 98527,\n\t\"./fr-ca.js\": 98527,\n\t\"./fr-ch\": 58407,\n\t\"./fr-ch.js\": 58407,\n\t\"./fr.js\": 99291,\n\t\"./fy\": 47054,\n\t\"./fy.js\": 47054,\n\t\"./ga\": 49540,\n\t\"./ga.js\": 49540,\n\t\"./gd\": 73917,\n\t\"./gd.js\": 73917,\n\t\"./gl\": 51486,\n\t\"./gl.js\": 51486,\n\t\"./gom-deva\": 56245,\n\t\"./gom-deva.js\": 56245,\n\t\"./gom-latn\": 48868,\n\t\"./gom-latn.js\": 48868,\n\t\"./gu\": 59652,\n\t\"./gu.js\": 59652,\n\t\"./he\": 89019,\n\t\"./he.js\": 89019,\n\t\"./hi\": 42040,\n\t\"./hi.js\": 42040,\n\t\"./hr\": 63402,\n\t\"./hr.js\": 63402,\n\t\"./hu\": 79322,\n\t\"./hu.js\": 79322,\n\t\"./hy-am\": 27609,\n\t\"./hy-am.js\": 27609,\n\t\"./id\": 57942,\n\t\"./id.js\": 57942,\n\t\"./is\": 98275,\n\t\"./is.js\": 98275,\n\t\"./it\": 73053,\n\t\"./it-ch\": 4378,\n\t\"./it-ch.js\": 4378,\n\t\"./it.js\": 73053,\n\t\"./ja\": 46176,\n\t\"./ja.js\": 46176,\n\t\"./jv\": 679,\n\t\"./jv.js\": 679,\n\t\"./ka\": 92726,\n\t\"./ka.js\": 92726,\n\t\"./kk\": 72953,\n\t\"./kk.js\": 72953,\n\t\"./km\": 86957,\n\t\"./km.js\": 86957,\n\t\"./kn\": 59181,\n\t\"./kn.js\": 59181,\n\t\"./ko\": 47148,\n\t\"./ko.js\": 47148,\n\t\"./ku\": 27752,\n\t\"./ku.js\": 27752,\n\t\"./ky\": 65675,\n\t\"./ky.js\": 65675,\n\t\"./lb\": 41263,\n\t\"./lb.js\": 41263,\n\t\"./lo\": 65746,\n\t\"./lo.js\": 65746,\n\t\"./lt\": 11143,\n\t\"./lt.js\": 11143,\n\t\"./lv\": 38753,\n\t\"./lv.js\": 38753,\n\t\"./me\": 44054,\n\t\"./me.js\": 44054,\n\t\"./mi\": 31573,\n\t\"./mi.js\": 31573,\n\t\"./mk\": 30202,\n\t\"./mk.js\": 30202,\n\t\"./ml\": 68523,\n\t\"./ml.js\": 68523,\n\t\"./mn\": 79794,\n\t\"./mn.js\": 79794,\n\t\"./mr\": 56681,\n\t\"./mr.js\": 56681,\n\t\"./ms\": 56975,\n\t\"./ms-my\": 39859,\n\t\"./ms-my.js\": 39859,\n\t\"./ms.js\": 56975,\n\t\"./mt\": 3691,\n\t\"./mt.js\": 3691,\n\t\"./my\": 5152,\n\t\"./my.js\": 5152,\n\t\"./nb\": 7607,\n\t\"./nb.js\": 7607,\n\t\"./ne\": 21526,\n\t\"./ne.js\": 21526,\n\t\"./nl\": 86368,\n\t\"./nl-be\": 40076,\n\t\"./nl-be.js\": 40076,\n\t\"./nl.js\": 86368,\n\t\"./nn\": 68420,\n\t\"./nn.js\": 68420,\n\t\"./oc-lnc\": 51906,\n\t\"./oc-lnc.js\": 51906,\n\t\"./pa-in\": 94504,\n\t\"./pa-in.js\": 94504,\n\t\"./pl\": 54721,\n\t\"./pl.js\": 54721,\n\t\"./pt\": 74645,\n\t\"./pt-br\": 54548,\n\t\"./pt-br.js\": 54548,\n\t\"./pt.js\": 74645,\n\t\"./ro\": 71977,\n\t\"./ro.js\": 71977,\n\t\"./ru\": 26042,\n\t\"./ru.js\": 26042,\n\t\"./sd\": 78849,\n\t\"./sd.js\": 78849,\n\t\"./se\": 27739,\n\t\"./se.js\": 27739,\n\t\"./si\": 50084,\n\t\"./si.js\": 50084,\n\t\"./sk\": 92449,\n\t\"./sk.js\": 92449,\n\t\"./sl\": 23086,\n\t\"./sl.js\": 23086,\n\t\"./sq\": 33139,\n\t\"./sq.js\": 33139,\n\t\"./sr\": 30607,\n\t\"./sr-cyrl\": 30063,\n\t\"./sr-cyrl.js\": 30063,\n\t\"./sr.js\": 30607,\n\t\"./ss\": 40131,\n\t\"./ss.js\": 40131,\n\t\"./sv\": 21665,\n\t\"./sv.js\": 21665,\n\t\"./sw\": 5642,\n\t\"./sw.js\": 5642,\n\t\"./ta\": 33622,\n\t\"./ta.js\": 33622,\n\t\"./te\": 74825,\n\t\"./te.js\": 74825,\n\t\"./tet\": 48336,\n\t\"./tet.js\": 48336,\n\t\"./tg\": 39238,\n\t\"./tg.js\": 39238,\n\t\"./th\": 99463,\n\t\"./th.js\": 99463,\n\t\"./tk\": 39986,\n\t\"./tk.js\": 39986,\n\t\"./tl-ph\": 29672,\n\t\"./tl-ph.js\": 29672,\n\t\"./tlh\": 40043,\n\t\"./tlh.js\": 40043,\n\t\"./tr\": 51212,\n\t\"./tr.js\": 51212,\n\t\"./tzl\": 50110,\n\t\"./tzl.js\": 50110,\n\t\"./tzm\": 80482,\n\t\"./tzm-latn\": 38309,\n\t\"./tzm-latn.js\": 38309,\n\t\"./tzm.js\": 80482,\n\t\"./ug-cn\": 42495,\n\t\"./ug-cn.js\": 42495,\n\t\"./uk\": 54157,\n\t\"./uk.js\": 54157,\n\t\"./ur\": 80984,\n\t\"./ur.js\": 80984,\n\t\"./uz\": 64141,\n\t\"./uz-latn\": 43662,\n\t\"./uz-latn.js\": 43662,\n\t\"./uz.js\": 64141,\n\t\"./vi\": 12607,\n\t\"./vi.js\": 12607,\n\t\"./x-pseudo\": 66460,\n\t\"./x-pseudo.js\": 66460,\n\t\"./yo\": 92948,\n\t\"./yo.js\": 92948,\n\t\"./zh-cn\": 62658,\n\t\"./zh-cn.js\": 62658,\n\t\"./zh-hk\": 39352,\n\t\"./zh-hk.js\": 39352,\n\t\"./zh-mo\": 38274,\n\t\"./zh-mo.js\": 38274,\n\t\"./zh-tw\": 98451,\n\t\"./zh-tw.js\": 98451\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 46700;"]}